<!doctype html><html class=theme-light lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content><meta name=copyright content="1995-2024 The FreeBSD Foundation"><link rel=canonical href=https://docs.freebsd.org/zh-cn/articles/remote-install/><title>FreeBSD 操作系统在无远程控制台下的远程安装 | FreeBSD Documentation Portal</title>
<meta name=theme-color content="#790000"><meta name=color-scheme content="system light dark high-contrast"><link rel="shortcut icon" href=https://docs.freebsd.org/favicon.ico><link rel=stylesheet href=https://docs.freebsd.org/styles/main.min.css><link rel=stylesheet href=https://docs.freebsd.org/css/font-awesome-min.css><script defer src=/js/theme-chooser.min.js></script><script defer src=/js/copy-clipboard.min.js></script><script defer src=/js/search.min.js></script><meta name=twitter:card content="summary"><meta name=twitter:domain content="docs.FreeBSD.org"><meta name=twitter:site content="@freebsd"><meta name=twitter:url content="https://twitter.com/freebsd"><meta property="og:title" content="FreeBSD 操作系统在无远程控制台下的远程安装"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:image" content="https://docs.freebsd.org/favicon.ico"><meta property="og:image:alt" content="FreeBSD Logo"><meta property="og:locale" content="zh-cn"><meta property="og:url" content="https://docs.freebsd.org/zh-cn/articles/remote-install/"><meta property="og:site_name" content="FreeBSD Documentation Portal"><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","url":"https:\/\/docs.freebsd.org\/zh-cn\/articles\/remote-install\/","name":"FreeBSD Documentation Portal","headline":"FreeBSD Documentation Portal","description":"FreeBSD Documentation Portal"}</script></head><body><header><div class=header-container><div class=logo-menu-bars-container><a href=https://www.FreeBSD.org class=logo><img src=https://docs.freebsd.org/images/FreeBSD-monochromatic.svg width=160 height=50 alt="FreeBSD logo">
</a><label class=menu-bars for=menu-bars><i class="fa fa-bars" aria-hidden=true></i></label></div><input id=menu-bars type=checkbox><nav><ul class=menu><li class=menu-item><input id=about type=checkbox>
<a href=# aria-label="Navigate to About section"><label class=menu-item-description for=about>About
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/about/ target=_blank>About</a></li><li><a href=https://www.freebsd.org/about/ target=_blank>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/about-us/about-the-foundation/ target=_blank>FreeBSD Foundation</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct/ target=_blank>Code of Conduct</a></li></ul></li><li class=menu-item><input id=download type=checkbox>
<a href=# aria-label="Navigate to get FreeBSD section"><label class=menu-item-description for=download>Get FreeBSD
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/where/ target=_blank>Get FreeBSD</a></li><li><a href=https://www.freebsd.org/releases/ target=_blank>Release Information</a></li><li><a href=https://www.freebsd.org/releng/ target=_blank>Release Engineering</a></li><li><a href=https://www.freebsd.org/security/ target=_blank>Security Advisories</a></li></ul></li><li class=menu-item><input id=documentation type=checkbox>
<a href=# aria-label="Navigate to get Documentation section"><label class=menu-item-description for=documentation>Documentation
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=/zh-cn>Documentation portal</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/handbook>FreeBSD Handbook</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook>Porter's Handbook</a></li><li><a href=https://docs.FreeBSD.org/en/books/fdp-primer>Documentation Project Handbook</a></li><li><a href=https://man.FreeBSD.org target=_blank>Manual pages</a></li><li><a href=https://papers.FreeBSD.org target=_blank>Presentations and papers</a></li><li><a href=https://wiki.FreeBSD.org target=_blank>Wiki</a></li><li><a href=https://docs.freebsd.org/zh-cn/books>Books</a></li><li><a href=https://docs.freebsd.org/zh-cn/articles>Articles</a></li></ul></li><li class=menu-item><input id=community type=checkbox>
<a href=# aria-label="Navigate to get Community section"><label class=menu-item-description for=community>Community
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/community/>Community</a></li><li><a href=https://docs.freebsd.org/zh-cn/articles/contributing>Get involved</a></li><li><a href=https://forums.freebsd.org/ target=_blank>Forum</a></li><li><a href=https://lists.freebsd.org/ target=_blank>Mailing lists</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank>IRC Channels</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank>Bug Tracker</a></li><li><a href=https://www.freebsd.org/support/ target=_blank>Support</a></li></ul></li></ul></nav><div class=search-donate-container><form class=search method=get id=search-header-form action=https://docs.freebsd.org/search name=search-header-form><input type=hidden name=DB value=zh-cn>
<input id=words name=P type=text size=20 maxlength=255>
<button>
<i class="fa fa-search" aria-hidden=true></i></button></form><div class=donate><a href=https://freebsdfoundation.org/donate/ target=_blank><span class=heart>♥</span>
Donate</a></div></div></div></header><main class=main-wrapper-article><div class=article><h1 class=title>FreeBSD 操作系统在无远程控制台下的远程安装</h1><div class="admonitionblock note"><p><i class="fa fa-exclamation-circle" aria-hidden=true></i>
This translation may be out of date. To help with the translations please access the <a href=https://translate-dev.freebsd.org/ target=_blank>FreeBSD translations instance</a>.</p></div><div class=copyright>Copyright © 2008 The FreeBSD Documentation Project</div><div class=legalnotice><a id=trademarks></a><details><summary>trademarks</summary><p>FreeBSD 是 FreeBSD 基金会的注册商标</p><p>许多制造商和经销商使用一些称为商标的图案或文字设计来彰显自己的产品。 本文档中出现的， 为 FreeBSD Project 所知晓的商标，后面将以 “™” 或 “®” 符号来标注。</p></details></div><div class=toc-mobile><h3>Table of Contents</h3><nav id=TableOfContents><ul><li><a href=#background>1. 背景</a></li><li><a href=#intro>2. 简介</a></li><li><a href=#preparation>3. 准备工作 - mfsBSD</a></li><li><a href=#installation>4. FreeBSD 操作系统的安装</a></li><li><a href=#zfs>5. ZFS</a></li></ul></nav></div><div id=preamble><div class=sectionbody><div class="paragraph abstract-title"><p>摘要</p></div><div class=paragraph><p>本文归档了当远程控制台不可用的情况下 FreeBSD 操作系统的远程安装。 文章背后的主要灵感归功于和 <code>Martin Matuska</code> 还有由 <code>Paweł Jakub Dawidek</code> 提供的宝贵输入合作的结果。</p></div><hr></div></div><div class=sect1><h2 id=background>1. 背景<a class=anchor href=#background></a></h2><div class=sectionbody><div class=paragraph><p>世界上有很多的服务器主机供应商， 但是他们中只有很少的一部分正式支持 FreeBSD， 他们通常为他们提供的服务器上安装 Linux® 发行版提供支持。</p></div><div class=paragraph><p>在某些情况下，如果你请求这些公司他们会安装一个你首选的 Linux® 发行版。有了这个选择，我们将试图安装 FreeBSD。 在其他情况下，他们可能提供一个急救系统用于紧急情况。 使用这个可能将有利于我们的目的更好的实现。</p></div><div class=paragraph><p>本文涵盖了引导一个包含 RAID-1 及 ZFS 性能的 FreeBSD 系统的远程安装的基本安装配置所必须的步骤。</p></div></div></div><div class=sect1><h2 id=intro>2. 简介<a class=anchor href=#intro></a></h2><div class=sectionbody><div class=paragraph><p>这一节会摘要本文的目的以及更好阐述这里所概括的东西。 本文中的这些指令将有益于那些使用不支持 FreeBSD 的托管设施提供的服务的人。</p></div><div class="olist arabic procedure"><ol class=arabic><li><p>如我们提到过的 <a href=#background>背景</a> 的那一节，许多的有声望的服务器主机托管公司提供了各种的急救系统。 可以从他们自己的 <code>局域网</code> 启动并可以通过 SSH 访问。 他们通常提供这种支持目的用于帮助他们的顾客修正损坏的操作系统。 如文章将说明的，我们将能够通过这些急救系统的帮助来安装 FreeBSD。</p></li><li><p>文章的下一小节会描述如何配置，并在本地机器上构建最小限度的 FreeBSD。该版本最终会从随机存储盘运行到远程机器上面去。 这将允许我们使用 Sysinstall 实用程序从一个 FTP 镜像安装一套完整的 FreeBSD 操作系统。</p></li><li><p>文章的剩余内容除了描述 ZFS 文件系统的配置还将描述系统本身的安装步骤。</p></li></ol></div><div class=sect2><h3 id=requirements>2.1. 需求<a class=anchor href=#requirements></a></h3><div class=paragraph><p>想要成功地做下去，你必须：</p></div><div class=ulist><ul><li><p>拥有一个可通过 SSH 网络访问的操作系统。</p></li><li><p>理解 FreeBSD 的安装过程</p></li><li><p>熟悉 <a href="https://man.freebsd.org/cgi/man.cgi?query=sysinstall&amp;sektion=8&amp;format=html">sysinstall(8)</a> 实用程序</p></li><li><p>拥有 FreeBSD 安张的 ISO 镜像文件或者易于使用的 CD</p></li></ul></div></div></div></div><div class=sect1><h2 id=preparation>3. 准备工作 - mfsBSD<a class=anchor href=#preparation></a></h2><div class=sectionbody><div class=paragraph><p>在 FreeBSD 可能安装到目标系统上之前， 需要先构建一个最小化的从磁盘启动的 FreeBSD 操作系统映像文件。 此方法中新系统必须能够从网络访问， 并且安装的其他过程能够在没有远程访问到系统控制台的情况下完成。</p></div><div class=paragraph><p>mfsBSD 设置工具能够被用来构建一个微小的 FreeBSD 映像。如 mfsBSD 名字的含义 ("mfs" 的意思是 "memory file system" 内存文件系统)， 最后的映像全部从随机存储器运行。多亏了这个特性， 磁盘的操作将不会有任何限制，因此它能够被用来安装一个完整的 FreeBSD 操作系统。 mfsBSD 的主页在 <a href=http://people.freebsd.org/~mm/mfsbsd/>http://people.freebsd.org/~mm/mfsbsd/</a>， 包含了指向最新释出的设置工具。</p></div><div class=paragraph><p>请注意关于 mfsBSD 内幕以及它所有的适用都超出了本文的内容， 感兴趣的读者应该去查阅 mfs 的原始文档得到更多详细内容。</p></div><div class=paragraph><p>下载并解压出最新的 mfsBSD 版本，并改变自己的当前工作目录到存在 mfsBSD 脚本文件的目录：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># fetch http://people.freebsd.org/~mm/mfsbsd/mfsbsd-latest.tar.gz</span>
<span class=c># tar xvzf mfsbsd-1.0-beta1.tar.gz</span>
<span class=c># cd mfsbsd-1.0-beta1/</span></code></pre></div></div><div class=sect2><h3 id=mfsbsd-config>3.1. mfsBSD 的配置<a class=anchor href=#mfsbsd-config></a></h3><div class=paragraph><p>引导 mfsBSD 之前， 必须设置一些重要的配置选项。 最重要的是我们必须有正确地，自然地，网络配置。 最适合的方法配置网络选项取决于我们是否事先知道我们会用到的网络接口， 而且网络接口驱动程序应被系统为我们的硬件载入。 我们将看到 mfsBSD 如何能够在任一种情况下被配置。</p></div><div class=paragraph><p>另外一件重要的事情是设置 <code>root</code> 的密码。 这将通过编辑 <span class=filename>conf/rootpw.conf</span> 文件来完成。 请记住该文件将把你的密码保存在简单的文本中， 所以在此我们不推荐你使用真实的密码。然而， 这只是一个临时使用一次的密码，你可以在随后安装好的系统中更改它。</p></div><div class=sect3><h4 id=_编辑_confinterfaces_conf_的方法>3.1.1. 编辑 <span class=filename>conf/interfaces.conf</span> 的方法<a class=anchor href=#_编辑_confinterfaces_conf_的方法></a></h4><div class=paragraph><p>如果我们安装好的网卡是未知类型的， 我们可以使用 mfsBSD 的自动探测功能。 mfsBSD 启动脚本能够探测到正确的驱动来使用， 基于网络接口的 MAC 地址，我们假设在 <span class=filename>conf/interfaces.conf</span> 文件中设置如下选项：</p></div><div class="literalblock programlisting"><div class=content><pre>initconf_interfaces=&#34;ext1&#34;
initconf_mac_ext1=&#34;00:00:00:00:00:00&#34;
initconf_ip_ext1=&#34;192.168.0.2&#34;
initconf_netmask_ext1=&#34;255.255.255.0&#34;</pre></div></div><div class=paragraph><p>别忘了添加 <code>defaultrouter</code> 信息到 <span class=filename>conf/rc.conf</span> 文件中：</p></div><div class="literalblock programlisting"><div class=content><pre>defaultrouter=&#34;192.168.0.1&#34;</pre></div></div></div><div class=sect3><h4 id=_编辑_confrc_conf_的方法>3.1.2. 编辑 <span class=filename>conf/rc.conf</span> 的方法<a class=anchor href=#_编辑_confrc_conf_的方法></a></h4><div class=paragraph><p>当网络接口的驱动是已知类型的，使用 <span class=filename>conf/rc.conf</span> 文件添加联网选项会更加方便。 该文件的语法跟 FreeBSD 中标准的 <a href="https://man.freebsd.org/cgi/man.cgi?query=rc.conf&amp;sektion=5&amp;format=html">rc.conf(5)</a> 文件的语法相同。</p></div><div class=paragraph><p>例如，当你知道被使用的将是一个 <a href="https://man.freebsd.org/cgi/man.cgi?query=re&amp;sektion=4&amp;format=html">re(4)</a> 网络接口设备， 你可以在 <span class=filename>conf/rc.conf</span> 文件中设置如下选项：</p></div><div class="literalblock programlisting"><div class=content><pre>defaultrouter=&#34;192.168.0.1&#34;
ifconfig_re0=&#34;inet 192.168.0.2 netmask 255.255.255.0&#34;</pre></div></div></div></div><div class=sect2><h3 id=mfsbsd-build>3.2. 构建一个 mfsBSD 映像<a class=anchor href=#mfsbsd-build></a></h3><div class=paragraph><p>构建一个 mfsBSD 映像文件的过程是非常简单明了的。</p></div><div class=paragraph><p>第一步是挂载 FreeBSD 的安装 CD， 或者挂载安装 ISO 文件到 <span class=filename>/cdrom</span>。 因为例子的缘故，在文章中我们将假定你下载的是 FreeBSD 7.0-RELEASE ISO 文件。使用 <a href="https://man.freebsd.org/cgi/man.cgi?query=mdconfig&amp;sektion=8&amp;format=html">mdconfig(8)</a> 实用程序挂载 ISO 映像文件到 <span class=filename>/cdrom</span> 目录非常简单：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mdconfig -a -t vnode -u 10 -f 7.0-RELEASE-amd64-disc1.iso</span>
<span class=c># mount_cd9660 /dev/md10 /cdrom</span></code></pre></div></div><div class=paragraph><p>紧接着，构建可启动的 mfsBSD 映像：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># make BASE=/cdrom/7.0-RELEASE</span></code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>上面的 make 命令必须在 mfsBSD 目录树的最高一层运行，也就是： <span class=filename>~/mfsbsd-1.0-beta1/</span>。</p></div></td></tr></tbody></table></div></div><div class=sect2><h3 id=_启动_mfsbsd>3.3. 启动 mfsBSD<a class=anchor href=#_启动_mfsbsd></a></h3><div class=paragraph><p>现在 mfsBSD 映像已经准备好了， 必须把它上传到远程的一个正在运行的急救系统上或者一个预安装了 Linux® 发行版的系统上。最适合做这个工作的工具是 scp：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># scp disk.img root@192.168.0.2:.</span></code></pre></div></div><div class=paragraph><p>想要正确的引导 mfsBSD 映像， 必须把它安放在机器的第一块（可启动）设备上。 这可能会和使用的例子我们假定的一样，第一块可启动磁盘设备是 <span class=filename>sda</span>：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># dd if=/root/disk.img of=/dev/sda bs=1m</span></code></pre></div></div><div class=paragraph><p>如果一切正常，该映像现在应该存在于第一块设备的 MBR（主引导区）而机器也应该能够被启动了。 使用工具 <a href="https://man.freebsd.org/cgi/man.cgi?query=ping&amp;sektion=8&amp;format=html">ping(8)</a> 来查看机器是否被正确启动。 一旦它回复在线状态，就应该能够使用 <code>root</code> 用户和配置好的密码通过 <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;format=html">ssh(1)</a> 来访问它了。</p></div></div></div></div><div class=sect1><h2 id=installation>4. FreeBSD 操作系统的安装<a class=anchor href=#installation></a></h2><div class=sectionbody><div class=paragraph><p>mfsBSD 成功被引导后它就应该能够通过 <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;format=html">ssh(1)</a> 登入了。这一节会描述如何创建 slices 并标记 slices 的 label， 为 RAID-1 配置 gmirror， 还有如何使用 Sysinstall 来安装一个最小的FreeBSD操作系统版本。</p></div><div class=sect2><h3 id=_准备磁盘>4.1. 准备磁盘<a class=anchor href=#_准备磁盘></a></h3><div class=paragraph><p>首要的任务是为 FreeBSD 分配磁盘空间，也就是， 创建 slices 和 partitions。很显然， 当前运行的系统是全部被载入到系统内存中的因此操作磁盘将没有任何问题。 要完成这个任务，可以是使用 Sysinstall 或者 <a href="https://man.freebsd.org/cgi/man.cgi?query=fdisk&amp;sektion=8&amp;format=html">fdisk(8)</a> 中的二者任一并结合工具 <a href="https://man.freebsd.org/cgi/man.cgi?query=bsdlabel&amp;sektion=8&amp;format=html">bsdlabel(8)</a>。</p></div><div class=paragraph><p>在开始时，将所有磁盘都标记成空的， 在每个磁盘上重复如下命令：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># dd if=/dev/zero of=/dev/ad0 count=2</span></code></pre></div></div><div class=paragraph><p>下面，使用你喜欢的工具创建 slices 并标记磁盘 label。 比较简单的方法是使用 Sysinstall， 强大也可能几乎没有漏洞方法是使用标准的基于文本的 UNIX® 工具， 类似于 <a href="https://man.freebsd.org/cgi/man.cgi?query=fdisk&amp;sektion=8&amp;format=html">fdisk(8)</a> 和 <a href="https://man.freebsd.org/cgi/man.cgi?query=bsdlabel&amp;sektion=8&amp;format=html">bsdlabel(8)</a> 这些工具的使用也会在这一节中包括。前者已经被包括在 FreeBSD 手册的 <a href=https://docs.freebsd.org/zh-cn/books/handbook/install-steps#install>安装FreeBSD</a> 一章中了。如本节中刚提到的，这篇文章会展示如何设置一个带有 RAID-1 和 ZFS 性能的系统。我们的设置由一个小工具 <a href="https://man.freebsd.org/cgi/man.cgi?query=gmirror&amp;sektion=8&amp;format=html">gmirror(8)</a> 镜像为 <span class=filename>/</span> (root)， <span class=filename>/usr</span> 和 <span class=filename>/var</span> 文件系统， 并把剩余的磁盘空间被分配为 <a href="https://man.freebsd.org/cgi/man.cgi?query=zpool&amp;sektion=8&amp;format=html">zpool(8)</a> 镜像出的 ZFS 文件系统。请注意， ZFS 文件系统将在 FreeBSD 操作系统成功安装并启动后才会被配置。</p></div><div class=paragraph><p>下面的例子会描述如何去创建 slices 和 labels， 在每个 partition 上初始化 <a href="https://man.freebsd.org/cgi/man.cgi?query=gmirror&amp;sektion=8&amp;format=html">gmirror(8)</a> 并如何在每个被镜像过的 partition 上创建 UFS2 文件系统：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># fdisk -BI /dev/ad0 </span><i class=conum data-value=1></i><b>(1)</b>
<span class=c># fdisk -BI /dev/ad1</span>
<span class=c># bsdlabel -wB /dev/ad0s1 </span><i class=conum data-value=2></i><b>(2)</b>
<span class=c># bsdlabel -wB /dev/ad1s1</span>
<span class=c># bsdlabel -e /dev/ad0s1 </span><i class=conum data-value=3></i><b>(3)</b>
<span class=c># bsdlabel /dev/ad0s1 &gt; /tmp/bsdlabel.txt &amp;&amp; bsdlabel -R /dev/ad1s1 /tmp/bsdlabel.txt </span><i class=conum data-value=4></i><b>(4)</b>
<span class=c># gmirror label root /dev/ad[01]s1a </span><i class=conum data-value=5></i><b>(5)</b>
<span class=c># gmirror label var /dev/ad[01]s1d</span>
<span class=c># gmirror label usr /dev/ad[01]s1e</span>
<span class=c># gmirror label -F swap /dev/ad[01]s1b </span><i class=conum data-value=6></i><b>(6)</b>
<span class=c># newfs /dev/mirror/root </span><i class=conum data-value=7></i><b>(7)</b>
<span class=c># newfs /dev/mirror/var</span>
<span class=c># newfs /dev/mirror/usr</span></code></pre></div></div><div class="colist arabic"><table><tbody><tr><td><i class=conum data-value=1></i><b>1</b></td><td>在整个磁盘上创建一个 slice 并初始化包含在磁盘第一个扇区启动代码。 重复在系统上全部的磁盘上执行此命令。</td></tr><tr><td><i class=conum data-value=2></i><b>2</b></td><td>为每块磁盘写入一个包括启动代码的内容的标准 label。</td></tr><tr><td><i class=conum data-value=3></i><b>3</b></td><td>现在，手动去编辑磁盘的 label。可以查阅 <a href="https://man.freebsd.org/cgi/man.cgi?query=bsdlabel&amp;sektion=8&amp;format=html">bsdlabel(8)</a> 的联机手册来找到如何建立 partitions 的方法。创建如下 partions，<code>a</code> 为 <span class=filename>/</span> (root) 文件系统， <code>b</code> 为 swap 交换空间， <code>d</code> 为 <span class=filename>/usr</span> 还有最后 <code>f</code> 被用于 ZFS。</td></tr><tr><td><i class=conum data-value=4></i><b>4</b></td><td>引入你刚才创建的 label 到第二块磁盘， 所以两块磁盘会使用同样的 label。</td></tr><tr><td><i class=conum data-value=5></i><b>5</b></td><td>在每个 partition 上初始化 <a href="https://man.freebsd.org/cgi/man.cgi?query=gmirror&amp;sektion=8&amp;format=html">gmirror(8)</a>。</td></tr><tr><td><i class=conum data-value=6></i><b>6</b></td><td>注意 <code>-F</code> 选项被用在 swap 交换分区的 partition。 <a href="https://man.freebsd.org/cgi/man.cgi?query=gmirror&amp;sektion=8&amp;format=html">gmirror(8)</a> 这个指令认为设备处于可靠的状态除非电源系统故障。</td></tr><tr><td><i class=conum data-value=7></i><b>7</b></td><td>在每个被镜像的分区上创建一个 UFS2 的文件系统。</td></tr></tbody></table></div></div><div class=sect2><h3 id=_系统安装>4.2. 系统安装<a class=anchor href=#_系统安装></a></h3><div class=paragraph><p>这是最重要的一部分。 此节将描述如何在我们上一小节已经准备好的磁盘上安装一个最小的 FreeBSD 版本。要达成这个目的，所有的文件安系统需要被挂载乃至于 Sysinstall 可以把 FreeBSD 系统的内容写到磁盘上：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mount /dev/mirror/root /mnt</span>
<span class=c># mkdir /mnt/var /mnt/usr</span>
<span class=c># mount /dev/mirror/var /mnt/var</span>
<span class=c># mount /dev/mirror/usr /mnt/usr</span></code></pre></div></div><div class=paragraph><p>当你做完这些时，打开 <a href="https://man.freebsd.org/cgi/man.cgi?query=sysinstall&amp;sektion=8&amp;format=html">sysinstall(8)</a>。 从主菜单选择自定义 <span class=guimenuitem>Custom</span> 安装。 选中 <span class=guimenuitem>Options</span> 选项然后按回车确认。 使用方向键获取帮助，移动鼠标指针到 <code>Install Root</code> 选项，按 <kbd>空格</kbd> 更改为 <span class=filename>/mnt</span>。 按 <kbd>回车</kbd> 提交你的更改并使用 <kbd>q</kbd> 退出 <span class=guimenuitem>Options</span> （选项）菜单。</p></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>注意这一步骤非常重要，如果被跳过了， Sysinstall 将不能安装 FreeBSD。</p></div></td></tr></tbody></table></div><div class=paragraph><p>到 <span class=guimenuitem>Distributions</span>（发行版）菜单选项， 使用方向键移动鼠标指针到 <code>Minimal</code>（最小化）选项， 并使用 <kbd>空格键</kbd> 选中该选项。 本文使用了最小版本来保存网络联通信息，因为系统本身会通过 ftp 来安装。使用 <code>Exit</code>（退出）选项退出这个菜单。</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p><span class=guimenuitem>Partition</span> 和 <span class=guimenuitem>Label</span> 菜单将被跳过， 这些没有多少价值了。</p></div></td></tr></tbody></table></div><div class=paragraph><p><span class=guimenuitem>Media</span>（媒介）菜单， 选择 <code>FTP</code> 选项。 选择一个距离你最近的镜像站点并交给 Sysinstall 假定网络已经配置完好。你将再回到 <span class=guimenuitem>Custom</span> （自定义）菜单。</p></div><div class=paragraph><p>最后，选择最后的选项来执行系统的安装过程， <span class=guimenuitem>Commit</span>， 当安装完成后退出 Sysinstall 即可。</p></div></div><div class=sect2><h3 id=_后期安装步骤>4.3. 后期安装步骤<a class=anchor href=#_后期安装步骤></a></h3><div class=paragraph><p>FreeBSD 操作系统现在应该安装完毕了；通常情况下， 安装过程还没有结束。还需要进行一些安装后期的步骤使得容许 FreeBSD 在将来启动并能够登入系统。</p></div><div class=paragraph><p>你现在必须 <a href="https://man.freebsd.org/cgi/man.cgi?query=chroot&amp;sektion=8&amp;format=html">chroot(8)</a> 到刚安装的全新的系统中来完成安装。 使用如下命令：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># chroot /mnt</span></code></pre></div></div><div class=paragraph><p>要达到我们的目的，进行如下步骤：</p></div><div class=ulist><ul><li><p>拷贝 <code>GENERIC</code>（通用）内核到 <span class=filename>/boot/kernel</span> 目录：</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cp -Rp /boot/GENERIC/* /boot/kernel</span></code></pre></div></div></li><li><p>创建 <span class=filename>/etc/rc.conf</span>， <span class=filename>/etc/resolv.conf</span> 还有 <span class=filename>/etc/fstab</span> 文件。 不要忘记正确地设置网络信息并在 <span class=filename>/etc/rc.conf</span> 文件中启用 sshd。 <span class=filename>/etc/fstab</span> 文件内容类似于下面的内容：</p><div class="literalblock programlisting"><div class=content><pre># Device                Mountpoint      FStype  Options         Dump    Pass#
/dev/mirror/swap        none            swap    sw              0       0
/dev/mirror/root        /               ufs     rw              1       1
/dev/mirror/usr         /usr            ufs     rw              2       2
/dev/mirror/var         /var            ufs     rw              2       2
/dev/cd0                /cdrom          cd9660  ro,noauto       0       0</pre></div></div></li><li><p>创建 <span class=filename>/boot/loader.conf</span> 文件，并写入如下内容：</p><div class="literalblock programlisting"><div class=content><pre>geom_mirror_load=&#34;YES&#34;
zfs_load=&#34;YES&#34;</pre></div></div></li><li><p>执行下面的命令，使得 ZFS 在下次启动后可用：</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># echo &#39;zfs_enable=&#34;YES&#34;&#39; &gt;&gt; /etc/rc.conf</span></code></pre></div></div></li><li><p>可以用 <a href="https://man.freebsd.org/cgi/man.cgi?query=adduser&amp;sektion=8&amp;format=html">adduser(8)</a> 工具来添加额外的用户。 不要忘记添加一个用户到 <code>wheel</code> 组，这样你可以在重新启动后获得 root 权限。</p></li><li><p>反复检验你的设置是否正确。</p></li></ul></div><div class=paragraph><p>现在你的系统在下次启动后应该可用了。使用 <a href="https://man.freebsd.org/cgi/man.cgi?query=reboot&amp;sektion=8&amp;format=html">reboot(8)</a> 命令重新启动你的系统。</p></div></div></div></div><div class=sect1><h2 id=zfs>5. ZFS<a class=anchor href=#zfs></a></h2><div class=sectionbody><div class=paragraph><p>如果你的系统重新启动后还完好，现在应该能够登入了。 欢迎来到崭新的 FreeBSD 安装，进行远程的不使用远程控制台的安装。</p></div><div class=paragraph><p>最后还剩下的步骤是配置 <a href="https://man.freebsd.org/cgi/man.cgi?query=zpool&amp;sektion=8&amp;format=html">zpool(8)</a> 并创建一些 <a href="https://man.freebsd.org/cgi/man.cgi?query=zfs&amp;sektion=8&amp;format=html">zfs(8)</a> 文件系统。建立并管理 ZFS 非常简单。 首先，创建一个镜像的pool：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zpool create tank mirror /dev/ad[01]s1f</span></code></pre></div></div><div class=paragraph><p>再接着,创建一些文件系统：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zfs create tank/ports</span>
<span class=c># zfs create tank/src</span>
<span class=c># zfs set compression=gzip tank/ports</span>
<span class=c># zfs set compression=on tank/src</span>
<span class=c># zfs set mountpoint=/usr/ports tank/ports</span>
<span class=c># zfs set mountpoint=/usr/src tank/src</span></code></pre></div></div><div class=paragraph><p>这就是全部步骤了。如果你对 FreeBSD 上的 ZFS 感兴趣，请查阅 FreeBSD WIKI 中的 <a href=http://wiki.freebsd.org/ZFS>ZFS</a> 一节。</p></div></div></div><hr><div class=last-modified><p><strong>Last modified on</strong>: November 3, 2021 by <a href="https://cgit.freebsd.org/doc/commit/?id=64acd169b8" target=_blank>Sergio Carlavilla Delgado</a></p></div></div><aside class=toc><div class=toc-content><h3>Table of Contents</h3><nav id=TableOfContents><ul><li><a href=#background>1. 背景</a></li><li><a href=#intro>2. 简介</a></li><li><a href=#preparation>3. 准备工作 - mfsBSD</a></li><li><a href=#installation>4. FreeBSD 操作系统的安装</a></li><li><a href=#zfs>5. ZFS</a></li></ul></nav><hr><div class=resources><h3>Resources</h3><ul class=contents><li><i class="fa fa-file-pdf-o" aria-hidden=true title="Download PDF"></i><a href=https://download.freebsd.org/doc/zh-cn/articles/remote-install/remote-install_zh-cn.pdf>Download PDF</a></li><li><i class="fa fa-pencil-square-o" aria-hidden=true title="Edit this page"></i><a href=https://github.com/freebsd/freebsd-doc/blob/main/documentation/content/zh-cn/_index target=_blank>Edit this page</a></li></ul></div></div></aside></main><footer><div class=footer-container><section class=logo-column><img src=https://docs.freebsd.org/images/FreeBSD-colors.svg width=160 height=50 alt="FreeBSD logo"><div class=options-container><div class=language-container><a id=languages href=https://docs.freebsd.org/zh-cn/languages><img src=https://docs.freebsd.org/images/language.png class=language-image alt="Choose language">
<span>简体中文</span></a></div><div class=theme-container><select id=theme-chooser><option value=theme-system>System</option><option value=theme-light>Light</option><option value=theme-dark>Dark</option><option value=theme-high-contrast>High contrast</option></select></div></div></section><section class=about-column><h3 class=column-title>About</h3><ul class=column-elements-container><li><a href=https://www.freebsd.org/about/ target=_blank class=column-element>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/ target=_blank class=column-element>FreeBSD Foundation</a></li><li><a href=https://www.freebsd.org/where/ target=_blank class=column-element>Get FreeBSD</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct target=_blank class=column-element>Code of Conduct</a></li><li><a href=https://www.freebsd.org/security/ target=_blank class=column-element>Security Advisories</a></li></ul></section><section class=documentation-column><h3 class=column-title>Documentation</h3><ul class=column-elements-container><li><a href=/zh-cn class=column-element>Documentation portal</a></li><li><a href=https://man.FreeBSD.org target=_blank class=column-element>Manual pages</a></li><li><a href=https://papers.FreeBSD.org target=_blank class=column-element>Presentations and papers</a></li><li><a href=https://docs-archive.freebsd.org/doc/ target=_blank class=column-element>Previous versions</a></li><li><a href=https://docs-archive.freebsd.org/44doc/ target=_blank class=column-element>4.4BSD Documents</a></li><li><a href=https://wiki.freebsd.org/ target=_blank class=column-element>Wiki</a></li></ul></section><section class=community-column><h3 class=column-title>Community</h3><ul class=column-elements-container><li><a href=https://docs.freebsd.org/zh-cn/articles/contributing class=column-element>Get involved</a></li><li><a href=https://forums.freebsd.org/ target=_blank class=column-element>Community forum</a></li><li><a href=https://lists.freebsd.org/ target=_blank class=column-element>Mailing lists</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank class=column-element>IRC Channels</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank class=column-element>Bug Tracker</a></li></ul></section><section class=legal-column><h3 class=column-title>Legal</h3><ul class=column-elements-container><li><a href=https://freebsdfoundation.org/donate/ target=_blank class=column-element>Donations</a></li><li><a href=https://www.freebsd.org/copyright/freebsd-license/ target=_blank class=column-element>Licensing</a></li><li><a href=https://www.freebsd.org/privacy/ target=_blank class=column-element>Privacy Policy</a></li><li><a href=https://www.freebsd.org/copyright/ target=_blank class=column-element>Legal notices</a></li></ul></section><section class=copyright-column><p>&copy; 1994-2024 The FreeBSD Project. All rights reserved</p><span>Made with <span class=heart>♥</span> by the FreeBSD Community</span></section></div></footer></body></html>