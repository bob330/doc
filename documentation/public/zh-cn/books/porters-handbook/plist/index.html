<!doctype html><html class=theme-light lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content><meta name=copyright content="1995-2024 The FreeBSD Foundation"><link rel=canonical href=https://docs.freebsd.org/zh-cn/books/porters-handbook/plist/><title>第 7 章 高级 pkg-plist 用法 | FreeBSD Documentation Portal</title>
<meta name=theme-color content="#790000"><meta name=color-scheme content="system light dark high-contrast"><link rel="shortcut icon" href=https://docs.freebsd.org/favicon.ico><link rel=stylesheet href=https://docs.freebsd.org/styles/main.min.css><link rel=stylesheet href=https://docs.freebsd.org/css/font-awesome-min.css><script defer src=/js/theme-chooser.min.js></script><script defer src=/js/copy-clipboard.min.js></script><script defer src=/js/search.min.js></script><meta name=twitter:card content="summary"><meta name=twitter:domain content="docs.FreeBSD.org"><meta name=twitter:site content="@freebsd"><meta name=twitter:url content="https://twitter.com/freebsd"><meta property="og:title" content="第 7 章 高级 pkg-plist 用法"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:image" content="https://docs.freebsd.org/favicon.ico"><meta property="og:image:alt" content="FreeBSD Logo"><meta property="og:locale" content="zh-cn"><meta property="og:url" content="https://docs.freebsd.org/zh-cn/books/porters-handbook/plist/"><meta property="og:site_name" content="FreeBSD Documentation Portal"><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","url":"https:\/\/docs.freebsd.org\/zh-cn\/books\/porters-handbook\/plist\/","name":"FreeBSD Documentation Portal","headline":"FreeBSD Documentation Portal","description":"FreeBSD Documentation Portal"}</script></head><body><header><div class=header-container><div class=logo-menu-bars-container><a href=https://www.FreeBSD.org class=logo><img src=https://docs.freebsd.org/images/FreeBSD-monochromatic.svg width=160 height=50 alt="FreeBSD logo">
</a><label class=menu-bars for=menu-bars><i class="fa fa-bars" aria-hidden=true></i></label></div><input id=menu-bars type=checkbox><nav><ul class=menu><li class=menu-item><input id=about type=checkbox>
<a href=# aria-label="Navigate to About section"><label class=menu-item-description for=about>About
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/about/ target=_blank>About</a></li><li><a href=https://www.freebsd.org/about/ target=_blank>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/about-us/about-the-foundation/ target=_blank>FreeBSD Foundation</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct/ target=_blank>Code of Conduct</a></li></ul></li><li class=menu-item><input id=download type=checkbox>
<a href=# aria-label="Navigate to get FreeBSD section"><label class=menu-item-description for=download>Get FreeBSD
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/where/ target=_blank>Get FreeBSD</a></li><li><a href=https://www.freebsd.org/releases/ target=_blank>Release Information</a></li><li><a href=https://www.freebsd.org/releng/ target=_blank>Release Engineering</a></li><li><a href=https://www.freebsd.org/security/ target=_blank>Security Advisories</a></li></ul></li><li class=menu-item><input id=documentation type=checkbox>
<a href=# aria-label="Navigate to get Documentation section"><label class=menu-item-description for=documentation>Documentation
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=/zh-cn>Documentation portal</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/handbook>FreeBSD Handbook</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook>Porter's Handbook</a></li><li><a href=https://docs.FreeBSD.org/en/books/fdp-primer>Documentation Project Handbook</a></li><li><a href=https://man.FreeBSD.org target=_blank>Manual pages</a></li><li><a href=https://papers.FreeBSD.org target=_blank>Presentations and papers</a></li><li><a href=https://wiki.FreeBSD.org target=_blank>Wiki</a></li><li><a href=https://docs.freebsd.org/zh-cn/books>Books</a></li><li><a href=https://docs.freebsd.org/zh-cn/articles>Articles</a></li></ul></li><li class=menu-item><input id=community type=checkbox>
<a href=# aria-label="Navigate to get Community section"><label class=menu-item-description for=community>Community
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/community/>Community</a></li><li><a href=https://docs.freebsd.org/zh-cn/articles/contributing>Get involved</a></li><li><a href=https://forums.freebsd.org/ target=_blank>Forum</a></li><li><a href=https://lists.freebsd.org/ target=_blank>Mailing lists</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank>IRC Channels</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank>Bug Tracker</a></li><li><a href=https://www.freebsd.org/support/ target=_blank>Support</a></li></ul></li></ul></nav><div class=search-donate-container><form class=search method=get id=search-header-form action=https://docs.freebsd.org/search name=search-header-form><input type=hidden name=DB value=zh-cn>
<input id=words name=P type=text size=20 maxlength=255>
<button>
<i class="fa fa-search" aria-hidden=true></i></button></form><div class=donate><a href=https://freebsdfoundation.org/donate/ target=_blank><span class=heart>♥</span>
Donate</a></div></div></div></header><input type=checkbox class="hidden toggle" id=menu-control><main class=main-wrapper-book><a id=top></a><aside class=book-menu><div class=book-menu-content><input id=search-book type=text placeholder=Search aria-label=Search maxlength=128><nav id=MenuContents><ul><li><input type=checkbox id=chapter-89897b13690206c8d016b08d866ebe49 class=toggle>
<label for=chapter-89897b13690206c8d016b08d866ebe49><a role=button></a></label><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/why-port/>第 1 章 介绍</a></li><li><input type=checkbox id=chapter-6619d34d40746c4cdcc07a792381c027 class=toggle>
<label for=chapter-6619d34d40746c4cdcc07a792381c027><a role=button></a></label><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/own-port/>第 2 章 自行制作新 port</a></li><li><input type=checkbox id=chapter-c0d52b9121b517084e01f59cefa725e1 class=toggle>
<label class="icon cursor" for=chapter-c0d52b9121b517084e01f59cefa725e1><a role=button></a></label><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/quick-porting/>第 3 章 简单的 port</a><ul><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/quick-porting/#porting-makefile>3.1. 编写 <span class=filename>Makefile</span></a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/quick-porting/#porting-desc>3.2. 创建描述文件</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/quick-porting/#porting-checksum>3.3. 创建校验和文件</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/quick-porting/#porting-testing>3.4. 测试 port</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/quick-porting/#porting-portlint>3.5. 用 <code>portlint</code> 来检查 port</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/quick-porting/#porting-submitting>3.6. 提交新 port</a></li></ul></li><li><input type=checkbox id=chapter-78c64b7f0aa40d4648859dde83f4ee13 class=toggle>
<label class="icon cursor" for=chapter-78c64b7f0aa40d4648859dde83f4ee13><a role=button></a></label><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/slow/>第 4 章 复杂的 Porting</a><ul><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/slow/#slow-work>4.1. 整个系统是如何运转的?</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/slow/#slow-sources>4.2. 获取源代码</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/slow/#slow-modifying>4.3. 修改 port</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/slow/#slow-patch>4.4. 打补丁</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/slow/#slow-configure>4.5. 配置</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/slow/#slow-user-input>4.6. 处理用户输入</a></li></ul></li><li><input type=checkbox id=chapter-869403c3f74bf6ec89e800963596e31a class=toggle>
<label class="icon cursor" for=chapter-869403c3f74bf6ec89e800963596e31a><a role=button></a></label><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/makefile/>第 5 章 配置 Makefile</a><ul><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/makefile/#makefile-source>5.1. 作者发布的代码</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/makefile/#makefile-naming>5.2. 命名</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/makefile/#makefile-categories>5.3. 分类</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/makefile/#makefile-distfiles>5.4. 源码包文件</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/makefile/#makefile-maintainer>5.5. <code>MAINTAINER</code> (监护人)</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/makefile/#makefile-comment>5.6. <code>COMMENT</code> (一句话说明)</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/makefile/#makefile-depend>5.7. 依赖关系</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/makefile/#makefile-masterdir>5.8. <code>MASTERDIR</code> (主 port 所在的目录)</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/makefile/#makefile-manpages>5.9. 联机手册</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/makefile/#makefile-info>5.10. Info 文件</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/makefile/#makefile-options>5.11. Makefile 选项</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/makefile/#makefile-wrkdir>5.12. 指定工作临时目录</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/makefile/#conflicts>5.13. 处理冲突</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/makefile/#install>5.14. 安装文件</a></li></ul></li><li><input type=checkbox id=chapter-19e3150e00beb84341d8ac1a73936ef0 class=toggle>
<label class="icon cursor" for=chapter-19e3150e00beb84341d8ac1a73936ef0><a role=button></a></label><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/special/>第 6 章 特殊情况</a><ul><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/special/#porting-shlibs>6.1. 共享库</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/special/#porting-restrictions>6.2. Ports 的发行限制</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/special/#building>6.3. 联编机制</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/special/#using-autotools>6.4. 利用 GNU autotools</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/special/#using-gettext>6.5. 使用 GNU <code>gettext</code></a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/special/#using-perl>6.6. 使用 <code>perl</code></a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/special/#using-x11>6.7. 使用 X11</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/special/#using-gnome>6.8. 使用 GNOME</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/special/#using-qt>6.9. 使用 Qt</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/special/#using-kde>6.10. 使用 KDE</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/special/#using-java>6.11. 使用 Java</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/special/#using-php>6.12. Web 应用， Apache 和 PHP</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/special/#using-python>6.13. 使用 Python</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/special/#using-tcl>6.14. 使用 Tcl/Tk</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/special/#using-emacs>6.15. 使用 Emacs</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/special/#using-ruby>6.16. 使用 Ruby</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/special/#using-sdl>6.17. 使用 SDL</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/special/#using-wx>6.18. 使用 wxWidgets</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/special/#using-lua>6.19. 使用 Lua</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/special/#using-xfce>6.20. 使用 Xfce</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/special/#using-mozilla>6.21. 使用 Mozilla</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/special/#using-databases>6.22. 使用数据库</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/special/#rc-scripts>6.23. 启动和停止服务 (rc 脚本)</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/special/#users-and-groups>6.24. 添加用户和用户组</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/special/#_依赖内核源代码的_ports>6.25. 依赖内核源代码的 Ports</a></li></ul></li><li><input type=checkbox id=chapter-154554011c772e1e6cc0108eef5e0b2b class=toggle checked>
<label class="icon cursor" for=chapter-154554011c772e1e6cc0108eef5e0b2b><a role=button></a></label><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/plist/>第 7 章 高级 pkg-plist 用法</a><ul><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/plist/#plist-sub>7.1. 根据 make 变量对 <span class=filename>pkg-plist</span> 进行修改</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/plist/#plist-cleaning>7.2. 空目录</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/plist/#plist-config>7.3. 配置文件</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/plist/#plist-dynamic>7.4. 动态装箱单与静态装箱单的对比</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/plist/#plist-autoplist>7.5. 装箱单 (package list) 的自动化制作</a></li></ul></li><li><input type=checkbox id=chapter-5955b0791ccd51005b5bc5bebeec91e5 class=toggle>
<label class="icon cursor" for=chapter-5955b0791ccd51005b5bc5bebeec91e5><a role=button></a></label><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/pkg-files/>第 8 章 pkg-* 文件</a><ul><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/pkg-files/#porting-message>8.1. <span class=filename>pkg-message</span> (安装预编译包时显示的消息文件)</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/pkg-files/#pkg-install>8.2. <span class=filename>pkg-install</span> (安装预编译包时执行的脚本文件)</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/pkg-files/#pkg-deinstall>8.3. <span class=filename>pkg-deinstall</span> (卸载时执行的脚本文件)</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/pkg-files/#pkg-req>8.4. <span class=filename>pkg-req</span> (安装预编译包时检测是否应执行操作的脚本文件)</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/pkg-files/#pkg-names>8.5. 改变 <span class=filename>pkg-*</span> 文件的名字</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/pkg-files/#using-sub-files>8.6. 使用 <code>SUB_FILES</code> 和 <code>SUB_LIST</code></a></li></ul></li><li><input type=checkbox id=chapter-ee86a11caedb6395ed82b94ec7a9c6cd class=toggle>
<label class="icon cursor" for=chapter-ee86a11caedb6395ed82b94ec7a9c6cd><a role=button></a></label><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/testing/>第 9 章 测试您的 port</a><ul><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/testing/#make-describe>9.1. 运行 <code>make describe</code></a></li></ul></li><li><input type=checkbox id=chapter-24703a9f2b5ab277e796cbfa6f5fd1e4 class=toggle>
<label class="icon cursor" for=chapter-24703a9f2b5ab277e796cbfa6f5fd1e4><a role=button></a></label><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/port-upgrading/>第 10 章 升级一个 port</a><ul><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/port-upgrading/#cvs-diff>10.1. 使用 CVS 制作补丁</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/port-upgrading/#moved-and-updating-files>10.2. UPDATING 和 MOVED 文件</a></li></ul></li><li><input type=checkbox id=chapter-1023911bc0041506653280b832dea3b2 class=toggle>
<label class="icon cursor" for=chapter-1023911bc0041506653280b832dea3b2><a role=button></a></label><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/security/>第 11 章 Ports 的安全</a><ul><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/security/#security-intro>11.1. 安全为何如此重要</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/security/#security-fix>11.2. 修复安全漏洞</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/security/#security-notify>11.3. 通知整个用户群体</a></li></ul></li><li><input type=checkbox id=chapter-9a8875d5d59aa92f1e5a78e9ecd1fbe7 class=toggle>
<label class="icon cursor" for=chapter-9a8875d5d59aa92f1e5a78e9ecd1fbe7><a role=button></a></label><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/porting-dads/>第 12 章 该做什么和不该做什么</a><ul><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/porting-dads/#dads-intro>12.1. 介绍</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/porting-dads/#porting-wrkdir>12.2. <code>WRKDIR</code> (联编时使用的临时目录)</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/porting-dads/#porting-wrkdirprefix>12.3. <code>WRKDIRPREFIX</code> (用于联编的临时目录的父目录名)</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/porting-dads/#porting-versions>12.4. 区分不同的操作系统， 以及 OS 的版本</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/porting-dads/#freebsd-versions>12.5. __FreeBSD_version 值</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/porting-dads/#dads-after-port-mk>12.6. 在 <span class=filename>bsd.port.mk</span> 之后写一些内容</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/porting-dads/#dads-sh-exec>12.7. 在 wrapper 脚本中使用 <code>exec</code> 语句</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/porting-dads/#dads-rational>12.8. 理性行事</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/porting-dads/#dads-cc>12.9. 遵循 <code>CC</code> 和 <code>CXX</code> 设置</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/porting-dads/#dads-cflags>12.10. 遵循 <code>CFLAGS</code></a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/porting-dads/#dads-pthread>12.11. 线程库</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/porting-dads/#dads-freedback>12.12. 反馈</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/porting-dads/#dads-readme>12.13. <span class=filename>README.html</span></a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/porting-dads/#dads-noinstall>12.14. 使用 <code>BROKEN</code>、 <code>FORBIDDEN</code> 或 <code>IGNORE</code> 阻止用户安装 port</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/porting-dads/#dads-deprecated>12.15. 使用 <code>DEPRECATED</code> 或 <code>EXPIRATION_DATE</code> 表示某个 port 将被删除</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/porting-dads/#dads-dot-error>12.16. 避免使用 <code>.error</code> 结构</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/porting-dads/#dads-sysctl>12.17. 对于 <span class=filename>sysctl</span> 的使用</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/porting-dads/#dads-rerolling-distfiles>12.18. 重新发布的 distfiles</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/porting-dads/#dads-misc>12.19. 杂记</a></li></ul></li><li><input type=checkbox id=chapter-5ef4c4c471a3f55c74fb71881f9d8713 class=toggle>
<label for=chapter-5ef4c4c471a3f55c74fb71881f9d8713><a role=button></a></label><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/porting-samplem/>第 13 章 示范的 Makefile</a></li><li><input type=checkbox id=chapter-70f5a4755700a24529175d26e65871bf class=toggle>
<label class="icon cursor" for=chapter-70f5a4755700a24529175d26e65871bf><a role=button></a></label><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/keeping-up/>第 14 章 保持同步</a><ul><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/keeping-up/#freshports>14.1. FreshPorts</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/keeping-up/#cvsweb>14.2. 代码库的 Web 访问界面</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/keeping-up/#ports-mailling-list>14.3. FreeBSD Ports 邮件列表</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/keeping-up/#build-cluster>14.4. 位于 <code>pointyhat.FreeBSD.org</code> 的 FreeBSD Port 联编集群</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/keeping-up/#distfile-survey>14.5. FreeBSD 的 Ports Distfile 扫描器</a></li><li><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/keeping-up/#portsmon>14.6. FreeBSD 的 Ports 追踪系统</a></li></ul></li><li></li></ul></nav></div></aside><div class=book><div class=book-menu-mobile><label for=menu-control><span class=menu-control-button><i class="fa fa-list" aria-hidden=true title="Book menu"></i>
Book menu</span></label></div><h1 class=title>第 7 章 高级 pkg-plist 用法</h1><div class="admonitionblock note"><p><i class="fa fa-exclamation-circle" aria-hidden=true></i>
This translation may be out of date. To help with the translations please access the <a href=https://translate-dev.freebsd.org/ target=_blank>FreeBSD translations instance</a>.</p></div><div class=toc-mobile><h3>Table of Contents</h3><nav id=TableOfContents><ul><li><a href=#plist-sub>7.1. 根据 make 变量对 <span class=filename>pkg-plist</span> 进行修改</a></li><li><a href=#plist-cleaning>7.2. 空目录</a></li><li><a href=#plist-config>7.3. 配置文件</a></li><li><a href=#plist-dynamic>7.4. 动态装箱单与静态装箱单的对比</a></li><li><a href=#plist-autoplist>7.5. 装箱单 (package list) 的自动化制作</a></li></ul></nav></div><div class=book-content><div id=preamble><div class=sectionbody></div></div><div class=sect1><h2 id=plist-sub>7.1. 根据 make 变量对 <span class=filename>pkg-plist</span> 进行修改<a class=anchor href=#plist-sub></a></h2><div class=sectionbody><div class=paragraph><p>某些 port， 特别是 <code>p5-</code> port， 会需要根据配置选项 (或对于 <code>p5-</code> port 而言， <code>perl</code> 的版本) 来修改它们的 <span class=filename>pkg-plist</span>。 为简化这一工作， 在 <span class=filename>pkg-plist</span> 中的 <code>%%OSREL%%</code>、 <code>%%PERL_VER%%</code>， 以及 <code>%%PERL_VERSION%%</code> 将自动进行相应的替换。 其中， <code>%%OSREL%%</code> 的值是操作系统以数值表示的版本 (例如 <code>4.9</code>)。 <code>%%PERL_VERSION%%</code> 和 <code>%%PERL_VER%%</code> 是 <code>perl</code> 的完整版本号 (例如 <code>5.8.9</code>)。许多其它与 port 文档文件有关的 <code>%%变量%%</code> 在 <a href=#install-documentation>相应章节</a> 中进行了介绍。</p></div><div class=paragraph><p>如果您还需要进行其它的替换， 可以通过将 <code>PLIST_SUB</code> 变量设置为一组 <code>变量=值</code> 对来实现。 其中， <code>%%VAR%%</code> 表示在 <span class=filename>pkg-plist</span> 中将被 <em>值</em> 替换的那些文字。</p></div><div class=paragraph><p>举例来说， 如果 port 需要把很多文件放到和版本有关的目录中， 可以在 <span class=filename>Makefile</span> 中按照类似下面的例子：</p></div><div class="literalblock programlisting"><div class=content><pre>OCTAVE_VERSION= 2.0.13
PLIST_SUB=      OCTAVE_VERSION=${OCTAVE_VERSION}</pre></div></div><div class=paragraph><p>并在 <span class=filename>pkg-plist</span> 中将具体的版本替换为 <code>%%OCTAVE_VERSION%%</code>。 这样， 在升级 port 时， 就不需要再到 <span class=filename>pkg-plist</span> 中修改那几十 (或者， 有时甚至是上百) 行的内容了。</p></div><div class=paragraph><p>如果您的 port 需要根据一定的配置来有条件地安装一些文件， 通常的做法是在 <span class=filename>pkg-plist</span> 中列出这些文件时， 在对应行的开头加上 <code>%%TAG%%</code>， 并将 <code>TAG</code> 写到 <span class=filename>Makefile</span> 中的 <code>PLIST_SUB</code> 变量中， 根据需要替换掉， 或替换为 <code>@comment</code>， 后者表示让打包工具忽略这行：</p></div><div class="literalblock programlisting"><div class=content><pre>.if defined(WITH_X11)
PLIST_SUB+=	X11=&#34;&#34;
.else
PLIST_SUB+=	X11=&#34;@comment &#34;
.endif</pre></div></div><div class=paragraph><p>与之对应， 在 <span class=filename>pkg-plist</span> 中：</p></div><div class="literalblock programlisting"><div class=content><pre>%%X11%%bin/foo-gui</pre></div></div><div class=paragraph><p>这一替换过程 (以及加入 <a href=#makefile-manpages>联机手册</a> 的过程)， 会在 <code>pre-install</code> 和 <code>do-install</code> 两个 target 之间， 通过读取 <span class=filename>PLIST</span> 并写入 <span class=filename>TMPPLIST</span> (默认情况下， 是： <span class=filename>WRKDIR/.PLIST.mktmp</span>) 来完成。 因此， 如果您的 port 动态生成 <span class=filename>PLIST</span>， 就需要在 <code>pre-install</code> 之前完成。 另外， 如果您的 port 需要编辑所生成的文件， 则需要在 <code>post-install</code> 中操作名为 <span class=filename>TMPPLIST</span> 的那个文件。</p></div><div class=paragraph><p>另一种可行的修改装箱单的方法， 则是根据 <code>PLIST_FILES</code> 和 <code>PLIST_DIRS</code> 这两个变量的设置来进行。 它们的值会作为目录名连同 <span class=filename>PLIST</span> 的内容一起写入 <span class=filename>TMPPLIST</span>。 在 <code>PLIST_FILES</code> 和 <code>PLIST_DIRS</code> 中列出的名字， 会经历前面所介绍的 <code>%%变量%%</code> 替换过程。 除此之外， 在 <code>PLIST_FILES</code> 中列出的文件， 会不加任何修改第出现在最终的装箱单中， 而 <code>@dirrm</code> 将作为前缀加到 <code>PLIST_DIRS</code> 所列的名字之前。 为了达到目的， <code>PLIST_FILES</code> 和 <code>PLIST_DIRS</code> 必须在写 <span class=filename>TMPPLIST</span> 之前， 也就是在 <code>pre-install</code> 或更早的阶段进行设置。</p></div></div></div><div class=sect1><h2 id=plist-cleaning>7.2. 空目录<a class=anchor href=#plist-cleaning></a></h2><div class=sectionbody><div class=sect2><h3 id=plist-dir-cleaning>7.2.1. 清理空目录<a class=anchor href=#plist-dir-cleaning></a></h3><div class=paragraph><p>一定要让 port 在卸载时进行清理空目录。 通常， 可以通过为所有由 port 创建的目录增加对应的 <code>@dirrm</code> 行来实现。 在删除父目录之前， 需要首先删除它的子目录。</p></div><div class="literalblock programlisting"><div class=content><pre> :
lib/X11/oneko/pixmaps/cat.xpm
lib/X11/oneko/sounds/cat.au
 :
@dirrm lib/X11/oneko/pixmaps
@dirrm lib/X11/oneko/sounds
@dirrm lib/X11/oneko</pre></div></div><div class=paragraph><p>然而， 有时 <code>@dirrm</code> 会由于其它 port 使用了同一个目录而发生错误。 利用 <code>@dirrmtry</code> 可以只删除那些空目录， 而避免给出警告。</p></div><div class="literalblock programlisting"><div class=content><pre>@dirrmtry share/doc/gimp</pre></div></div><div class=paragraph><p>按照上面的写法， 将不会显示任何错误信息， 而且，即使在 <span class=filename>${PREFIX}/shared/doc/gimp</span> 由于其它 port 在其中安装了一些别的文件的时候， 也不会导致 <a href="https://man.freebsd.org/cgi/man.cgi?query=pkg_delete&amp;sektion=1&amp;format=html">pkg_delete(1)</a> 异常退出。</p></div></div><div class=sect2><h3 id=plist-dir-empty>7.2.2. 如何建立空目录<a class=anchor href=#plist-dir-empty></a></h3><div class=paragraph><p>在 port 安装过程中创建的空目录需要特别留意。 安装 package 时并不会自动创建这些目录， 这是因为 package 只保存文件。 要确保安装 package 时会自动创建这些空目录， 需要在 <span class=filename>pkg-plist</span> 中加入与 <code>@dirrm</code> 对应的行：</p></div><div class="literalblock programlisting"><div class=content><pre>@exec mkdir -p %D/shared/foo/templates</pre></div></div></div></div></div><div class=sect1><h2 id=plist-config>7.3. 配置文件<a class=anchor href=#plist-config></a></h2><div class=sectionbody><div class=paragraph><p>如果 port 需要把一些文件放到 <span class=filename>PREFIX/etc</span>， <em>不要</em> 简单地安装它们， 并将其列入 <span class=filename>pkg-plist</span>， 因为这样会导致 <a href="https://man.freebsd.org/cgi/man.cgi?query=pkg_delete&amp;sektion=1&amp;format=html">pkg_delete(1)</a> 删除用户精心编辑的文件， 而新安装时则又会把这些文件覆盖。</p></div><div class=paragraph><p>因此， 您应把配置文件的例子按其它的后缀来安装 (例如 <span class=filename>filename.sample</span> 就是一个不错的选择) 并显示一条 <a href=#porting-message>消息</a> 告诉用户如何复制并编辑这个配置文件， 以便让软件能够正确工作。</p></div><div class=paragraph><p>因此， 应按其它的后缀来安装配置文件的例子 (<span class=filename>filename.sample</span> 就是一个不错的选择)。 如果实际的配置文件不存在， 则将其复制为实际文件的名字。 卸载时， 如果发现用户没有修改配置文件， 则将其删除。 您需要在 port 的 <span class=filename>Makefile</span>， 以及 <span class=filename>pkg-plist</span> (对于从 package 安装的情形) 进行处理。</p></div><div class=paragraph><p>示例的 <span class=filename>Makefile</span> 部分：</p></div><div class="literalblock programlisting"><div class=content><pre>post-install:
	@if [ ! -f ${PREFIX}/etc/orbit.conf ]; then \
		${CP} -p ${PREFIX}/etc/orbit.conf.sample ${PREFIX}/etc/orbit.conf ; \
	fi</pre></div></div><div class=paragraph><p>示例的 <span class=filename>pkg-plist</span> 部分：</p></div><div class="literalblock programlisting"><div class=content><pre>@unexec if cmp -s %D/etc/orbit.conf.sample %D/etc/orbit.conf; then rm -f %D/etc/orbit.conf; fi
etc/orbit.conf.sample
@exec if [ ! -f %D/etc/orbit.conf ] ; then cp -p %D/%F %B/orbit.conf; fi</pre></div></div><div class=paragraph><p>另外， 还应显示一条 <a href=#porting-message>消息</a> 指出用户应在何处复制并编辑这个文件， 以便让软件能开始正常工作。</p></div></div></div><div class=sect1><h2 id=plist-dynamic>7.4. 动态装箱单与静态装箱单的对比<a class=anchor href=#plist-dynamic></a></h2><div class=sectionbody><div class=paragraph><p><em>静态装箱单</em> 是指在 Ports Collection 中以 <span class=filename>pkg-plist</span> 文件 (可能包含变量替换)， 或以 <code>PLIST_FILES</code> 和 <code>PLIST_DIRS</code> 的形式嵌入到 <span class=filename>Makefile</span> 出现的装箱单。 即使它是由工具或 Makefile 中的某个 target 在经由 committer 加入到 Ports Collection <em>之前</em> 自动生成的也是如此， 因为可以在不下载或编译源代码包的前提下对其进行检视。</p></div><div class=paragraph><p><em>动态装箱单</em> 是指在 port 编译并安装时生成的装箱单。 在下载并编译您所移植的应用程序的源代码之前， 或在执行了 <code>make clean</code> 之后， 就无法查看其内容了。</p></div><div class=paragraph><p>尽管使用动态装箱单并不被禁止， 但监护人应尽可能使用静态装箱单， 因为它能够让用户使用 <a href="https://man.freebsd.org/cgi/man.cgi?query=grep&amp;sektion=1&amp;format=html">grep(1)</a>来发现所需的 ports， 例如， 它是否会安装某个特定文件。 动态列表主要应用于复杂的， 其装箱单随所选功能会发生巨变 (因而使得维护静态装箱单不再可行)， 或那些随版本而改变装箱单内容的 port (例如， 使用 Javadoc 来生成文档的那些 ports)。</p></div><div class=paragraph><p>我们鼓励那些选择使用动态装箱单的监护人提供一个能够生成 <span class=filename>pkg-plist</span> 的 target， 以便于用户检视其内容。</p></div></div></div><div class=sect1><h2 id=plist-autoplist>7.5. 装箱单 (package list) 的自动化制作<a class=anchor href=#plist-autoplist></a></h2><div class=sectionbody><div class=paragraph><p>首先， 请确认已经基本上完成了 port 的工作， 仅缺 <span class=filename>pkg-plist</span>。</p></div><div class=paragraph><p>接下来， 建立一个用于安装您的 port 的临时目录， 并在其中安装它所依赖的所有其他软件包：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mkdir /var/tmp/`make -V PORTNAME`</span>
<span class=c># mtree -U -f `make -V MTREE_FILE` -d -e -p /var/tmp/`make -V PORTNAME`</span>
<span class=c># make depends PREFIX=/var/tmp/`make -V PORTNAME`</span></code></pre></div></div><div class=paragraph><p>将目录结构保存到一新文件中。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># (cd /var/tmp/`make -V PORTNAME` &amp;&amp; find -d * -type d) | sort &gt; OLD-DIRS</span></code></pre></div></div><div class=paragraph><p>建立一空白 <span class=filename>pkg-plist</span> 文件：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># :&gt;pkg-plist</span></code></pre></div></div><div class=paragraph><p>如果您的 port 遵循 <code>PREFIX</code> (应该如此) 则接下来应安装该 port 并创建装箱单。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># make install PREFIX=/var/tmp/`make -V PORTNAME`</span>
<span class=c># (cd /var/tmp/`make -V PORTNAME` &amp;&amp; find -d * \! -type d) | sort &gt; pkg-plist</span></code></pre></div></div><div class=paragraph><p>此外还应把新建立的目录加入装箱单。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># (cd /var/tmp/`make -V PORTNAME` &amp;&amp; find -d * -type d) | sort | comm -13 OLD-DIRS - | sort -r | sed -e &#39;s#^#@dirrm #&#39; &gt;&gt; pkg-plist</span></code></pre></div></div><div class=paragraph><p>最后需要手工整理 packing list； 这一过程不是 <em>完全</em> 自动的。 联机手册应列入 port 的 <span class=filename>Makefile</span> 中的 <code>MAN<em>n</em></code>， 而不是装箱单。 用户配置文件应被删除， 或以 <span class=filename>filename.sample</span> 这样的名字来安装。 <span class=filename>info/dir</span> 文件， 也不应列入， 同时应按照 <a href=#makefile-info>info 文件</a> 的说明来增加一些 <span class=filename>install-info</span> 行。 所有由 port 安装的库， 应按照 <a href=#porting-shlibs>动态连接库</a> 小节中介绍的方法处理。</p></div><div class=paragraph><p>另外， 也可以使用 <span class=filename>/usr/ports/Tools/scripts/</span> 中的 <code>plist</code> 脚本来自动创建 package list。 <span class=filename>plist</span> 脚本是一个 Ruby 脚本， 它能够将前面介绍的手工操作自动化。</p></div><div class=paragraph><p>开始的步骤和上面的前三行一样， 也就是 <code>mkdir</code>， <code>mtree</code> 并 <code>make depends</code>。 然后联编和安装 port：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># make install PREFIX=/var/tmp/`make -V PORTNAME`</span></code></pre></div></div><div class=paragraph><p>然后让 <code>plist</code> 生成 <span class=filename>pkg-plist</span> 文件：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># /usr/ports/Tools/scripts/plist -Md -m `make -V MTREE_FILE` /var/tmp/`make -V PORTNAME` &gt; pkg-plist</span></code></pre></div></div><div class=paragraph><p>与前面类似， 如此生成的装箱单也需要手工进行一些清理工作。</p></div><div class=paragraph><p>另一个可以用来创建最初的 <span class=filename>pkg-plist</span> 的工具是 <a class=package href=https://cgit.freebsd.org/ports/tree/ports-mgmt/genplist/>ports-mgmt/genplist</a>。 和其他自动化工具类似， 您应对它生成的 <span class=filename>pkg-plist</span> 应手工检查并根据需要进行修改。</p></div></div></div></div><hr><div class=last-modified><p><strong>Last modified on</strong>: March 9, 2024 by <a href="https://cgit.freebsd.org/doc/commit/?id=6199af92e7" target=_blank>Danilo G. Baio</a></p></div><div class=buttons><div class=prev><i class="fa fa-angle-left" aria-hidden=true title=Prev></i><div class=container><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/special class=direction>Prev</a></div></div><div class=home><i class="fa fa-home" aria-hidden=true title=Home></i><div class=container><a href=../ class=direction>Home</a></div></div><div class=next><div class=container><a href=https://docs.freebsd.org/zh-cn/books/porters-handbook/pkg-files class=direction>Next</a></div><i class="fa fa-angle-right" aria-hidden=true title=Next></i></div></div><label class="hidden book-menu-overlay" for=menu-control></label></div><aside class=toc><div class=toc-content><h3>Table of Contents</h3><nav id=TableOfContents><ul><li><a href=#plist-sub>7.1. 根据 make 变量对 <span class=filename>pkg-plist</span> 进行修改</a></li><li><a href=#plist-cleaning>7.2. 空目录</a></li><li><a href=#plist-config>7.3. 配置文件</a></li><li><a href=#plist-dynamic>7.4. 动态装箱单与静态装箱单的对比</a></li><li><a href=#plist-autoplist>7.5. 装箱单 (package list) 的自动化制作</a></li></ul></nav><hr><div class=resources><h3>Resources</h3><ul class=contents><li><i class="fa fa-file-pdf-o" aria-hidden=true title="Download PDF"></i><a href=https://download.freebsd.org/doc/zh-cn/books/porters-handbook/porters-handbook_zh-cn.pdf>Download PDF</a></li><li><i class="fa fa-pencil-square-o" aria-hidden=true title="Edit this page"></i><a href=https://github.com/freebsd/freebsd-doc/blob/main/documentation/content/zh-cn/_index target=_blank>Edit this page</a></li></ul></div></div></aside><a class=to-top href=#top><i class="fa fa-arrow-circle-up" aria-hidden=true></i></a></main><footer><div class=footer-container><section class=logo-column><img src=https://docs.freebsd.org/images/FreeBSD-colors.svg width=160 height=50 alt="FreeBSD logo"><div class=options-container><div class=language-container><a id=languages href=https://docs.freebsd.org/zh-cn/languages><img src=https://docs.freebsd.org/images/language.png class=language-image alt="Choose language">
<span>简体中文</span></a></div><div class=theme-container><select id=theme-chooser><option value=theme-system>System</option><option value=theme-light>Light</option><option value=theme-dark>Dark</option><option value=theme-high-contrast>High contrast</option></select></div></div></section><section class=about-column><h3 class=column-title>About</h3><ul class=column-elements-container><li><a href=https://www.freebsd.org/about/ target=_blank class=column-element>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/ target=_blank class=column-element>FreeBSD Foundation</a></li><li><a href=https://www.freebsd.org/where/ target=_blank class=column-element>Get FreeBSD</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct target=_blank class=column-element>Code of Conduct</a></li><li><a href=https://www.freebsd.org/security/ target=_blank class=column-element>Security Advisories</a></li></ul></section><section class=documentation-column><h3 class=column-title>Documentation</h3><ul class=column-elements-container><li><a href=/zh-cn class=column-element>Documentation portal</a></li><li><a href=https://man.FreeBSD.org target=_blank class=column-element>Manual pages</a></li><li><a href=https://papers.FreeBSD.org target=_blank class=column-element>Presentations and papers</a></li><li><a href=https://docs-archive.freebsd.org/doc/ target=_blank class=column-element>Previous versions</a></li><li><a href=https://docs-archive.freebsd.org/44doc/ target=_blank class=column-element>4.4BSD Documents</a></li><li><a href=https://wiki.freebsd.org/ target=_blank class=column-element>Wiki</a></li></ul></section><section class=community-column><h3 class=column-title>Community</h3><ul class=column-elements-container><li><a href=https://docs.freebsd.org/zh-cn/articles/contributing class=column-element>Get involved</a></li><li><a href=https://forums.freebsd.org/ target=_blank class=column-element>Community forum</a></li><li><a href=https://lists.freebsd.org/ target=_blank class=column-element>Mailing lists</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank class=column-element>IRC Channels</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank class=column-element>Bug Tracker</a></li></ul></section><section class=legal-column><h3 class=column-title>Legal</h3><ul class=column-elements-container><li><a href=https://freebsdfoundation.org/donate/ target=_blank class=column-element>Donations</a></li><li><a href=https://www.freebsd.org/copyright/freebsd-license/ target=_blank class=column-element>Licensing</a></li><li><a href=https://www.freebsd.org/privacy/ target=_blank class=column-element>Privacy Policy</a></li><li><a href=https://www.freebsd.org/copyright/ target=_blank class=column-element>Legal notices</a></li></ul></section><section class=copyright-column><p>&copy; 1994-2024 The FreeBSD Project. All rights reserved</p><span>Made with <span class=heart>♥</span> by the FreeBSD Community</span></section></div></footer></body></html>