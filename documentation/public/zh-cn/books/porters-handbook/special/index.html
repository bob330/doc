<!doctype html><html class=theme-light lang=zh-cn><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content><meta name=copyright content="1995-2024 The FreeBSD Foundation"><link rel=canonical href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/special/><title>第 6 章 特殊情况 | FreeBSD Documentation Portal</title>
<meta name=theme-color content="#790000"><meta name=color-scheme content="system light dark high-contrast"><link rel="shortcut icon" href=http://172.16.201.134:1313/favicon.ico><link rel=stylesheet href=http://172.16.201.134:1313/styles/main.min.css><link rel=stylesheet href=http://172.16.201.134:1313/css/font-awesome-min.css><script defer src=/js/theme-chooser.min.js></script><script defer src=/js/copy-clipboard.min.js></script><script defer src=/js/search.min.js></script><meta name=twitter:card content="summary"><meta name=twitter:domain content="docs.FreeBSD.org"><meta name=twitter:site content="@freebsd"><meta name=twitter:url content="https://twitter.com/freebsd"><meta property="og:title" content="第 6 章 特殊情况"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:image" content="http://172.16.201.134:1313/favicon.ico"><meta property="og:image:alt" content="FreeBSD Logo"><meta property="og:locale" content="zh-cn"><meta property="og:url" content="http://172.16.201.134:1313/zh-cn/books/porters-handbook/special/"><meta property="og:site_name" content="FreeBSD Documentation Portal"><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","url":"http:\/\/172.16.201.134:1313\/zh-cn\/books\/porters-handbook\/special\/","name":"FreeBSD Documentation Portal","headline":"FreeBSD Documentation Portal","description":"FreeBSD Documentation Portal"}</script></head><body><header><div class=header-container><div class=logo-menu-bars-container><a href=https://www.FreeBSD.org class=logo><img src=http://172.16.201.134:1313/images/FreeBSD-monochromatic.svg width=160 height=50 alt="FreeBSD logo">
</a><label class=menu-bars for=menu-bars><i class="fa fa-bars" aria-hidden=true></i></label></div><input id=menu-bars type=checkbox><nav><ul class=menu><li class=menu-item><input id=about type=checkbox>
<a href=# aria-label="Navigate to About section"><label class=menu-item-description for=about>About
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/about/ target=_blank>About</a></li><li><a href=https://www.freebsd.org/about/ target=_blank>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/about-us/about-the-foundation/ target=_blank>FreeBSD Foundation</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct/ target=_blank>Code of Conduct</a></li></ul></li><li class=menu-item><input id=download type=checkbox>
<a href=# aria-label="Navigate to get FreeBSD section"><label class=menu-item-description for=download>Get FreeBSD
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/where/ target=_blank>Get FreeBSD</a></li><li><a href=https://www.freebsd.org/releases/ target=_blank>Release Information</a></li><li><a href=https://www.freebsd.org/releng/ target=_blank>Release Engineering</a></li><li><a href=https://www.freebsd.org/security/ target=_blank>Security Advisories</a></li></ul></li><li class=menu-item><input id=documentation type=checkbox>
<a href=# aria-label="Navigate to get Documentation section"><label class=menu-item-description for=documentation>Documentation
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=/zh-cn>Documentation portal</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/handbook>FreeBSD Handbook</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook>Porter's Handbook</a></li><li><a href=https://docs.FreeBSD.org/en/books/fdp-primer>Documentation Project Handbook</a></li><li><a href=https://man.FreeBSD.org target=_blank>Manual pages</a></li><li><a href=https://papers.FreeBSD.org target=_blank>Presentations and papers</a></li><li><a href=https://wiki.FreeBSD.org target=_blank>Wiki</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books>Books</a></li><li><a href=http://172.16.201.134:1313/zh-cn/articles>Articles</a></li></ul></li><li class=menu-item><input id=community type=checkbox>
<a href=# aria-label="Navigate to get Community section"><label class=menu-item-description for=community>Community
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/community/>Community</a></li><li><a href=http://172.16.201.134:1313/zh-cn/articles/contributing>Get involved</a></li><li><a href=https://forums.freebsd.org/ target=_blank>Forum</a></li><li><a href=https://lists.freebsd.org/ target=_blank>Mailing lists</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank>IRC Channels</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank>Bug Tracker</a></li><li><a href=https://www.freebsd.org/support/ target=_blank>Support</a></li></ul></li></ul></nav><div class=search-donate-container><form class=search method=get id=search-header-form action=https://docs.freebsd.org/search name=search-header-form><input type=hidden name=DB value=zh-cn>
<input id=words name=P type=text size=20 maxlength=255>
<button>
<i class="fa fa-search" aria-hidden=true></i></button></form><div class=donate><a href=https://freebsdfoundation.org/donate/ target=_blank><span class=heart>♥</span>
Donate</a></div></div></div></header><input type=checkbox class="hidden toggle" id=menu-control><main class=main-wrapper-book><a id=top></a><aside class=book-menu><div class=book-menu-content><input id=search-book type=text placeholder=Search aria-label=Search maxlength=128><nav id=MenuContents><ul><li><input type=checkbox id=chapter-89897b13690206c8d016b08d866ebe49 class=toggle>
<label for=chapter-89897b13690206c8d016b08d866ebe49><a role=button></a></label><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/why-port/>第 1 章 介绍</a></li><li><input type=checkbox id=chapter-6619d34d40746c4cdcc07a792381c027 class=toggle>
<label for=chapter-6619d34d40746c4cdcc07a792381c027><a role=button></a></label><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/own-port/>第 2 章 自行制作新 port</a></li><li><input type=checkbox id=chapter-c0d52b9121b517084e01f59cefa725e1 class=toggle>
<label class="icon cursor" for=chapter-c0d52b9121b517084e01f59cefa725e1><a role=button></a></label><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/quick-porting/>第 3 章 简单的 port</a><ul><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/quick-porting/#porting-makefile>3.1. 编写 <span class=filename>Makefile</span></a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/quick-porting/#porting-desc>3.2. 创建描述文件</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/quick-porting/#porting-checksum>3.3. 创建校验和文件</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/quick-porting/#porting-testing>3.4. 测试 port</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/quick-porting/#porting-portlint>3.5. 用 <code>portlint</code> 来检查 port</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/quick-porting/#porting-submitting>3.6. 提交新 port</a></li></ul></li><li><input type=checkbox id=chapter-78c64b7f0aa40d4648859dde83f4ee13 class=toggle>
<label class="icon cursor" for=chapter-78c64b7f0aa40d4648859dde83f4ee13><a role=button></a></label><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/slow/>第 4 章 复杂的 Porting</a><ul><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/slow/#slow-work>4.1. 整个系统是如何运转的?</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/slow/#slow-sources>4.2. 获取源代码</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/slow/#slow-modifying>4.3. 修改 port</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/slow/#slow-patch>4.4. 打补丁</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/slow/#slow-configure>4.5. 配置</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/slow/#slow-user-input>4.6. 处理用户输入</a></li></ul></li><li><input type=checkbox id=chapter-869403c3f74bf6ec89e800963596e31a class=toggle>
<label class="icon cursor" for=chapter-869403c3f74bf6ec89e800963596e31a><a role=button></a></label><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/makefile/>第 5 章 配置 Makefile</a><ul><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/makefile/#makefile-source>5.1. 作者发布的代码</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/makefile/#makefile-naming>5.2. 命名</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/makefile/#makefile-categories>5.3. 分类</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/makefile/#makefile-distfiles>5.4. 源码包文件</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/makefile/#makefile-maintainer>5.5. <code>MAINTAINER</code> (监护人)</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/makefile/#makefile-comment>5.6. <code>COMMENT</code> (一句话说明)</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/makefile/#makefile-depend>5.7. 依赖关系</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/makefile/#makefile-masterdir>5.8. <code>MASTERDIR</code> (主 port 所在的目录)</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/makefile/#makefile-manpages>5.9. 联机手册</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/makefile/#makefile-info>5.10. Info 文件</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/makefile/#makefile-options>5.11. Makefile 选项</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/makefile/#makefile-wrkdir>5.12. 指定工作临时目录</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/makefile/#conflicts>5.13. 处理冲突</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/makefile/#install>5.14. 安装文件</a></li></ul></li><li><input type=checkbox id=chapter-19e3150e00beb84341d8ac1a73936ef0 class=toggle checked>
<label class="icon cursor" for=chapter-19e3150e00beb84341d8ac1a73936ef0><a role=button></a></label><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/special/>第 6 章 特殊情况</a><ul><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/special/#porting-shlibs>6.1. 共享库</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/special/#porting-restrictions>6.2. Ports 的发行限制</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/special/#building>6.3. 联编机制</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/special/#using-autotools>6.4. 利用 GNU autotools</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/special/#using-gettext>6.5. 使用 GNU <code>gettext</code></a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/special/#using-perl>6.6. 使用 <code>perl</code></a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/special/#using-x11>6.7. 使用 X11</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/special/#using-gnome>6.8. 使用 GNOME</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/special/#using-qt>6.9. 使用 Qt</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/special/#using-kde>6.10. 使用 KDE</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/special/#using-java>6.11. 使用 Java</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/special/#using-php>6.12. Web 应用， Apache 和 PHP</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/special/#using-python>6.13. 使用 Python</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/special/#using-tcl>6.14. 使用 Tcl/Tk</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/special/#using-emacs>6.15. 使用 Emacs</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/special/#using-ruby>6.16. 使用 Ruby</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/special/#using-sdl>6.17. 使用 SDL</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/special/#using-wx>6.18. 使用 wxWidgets</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/special/#using-lua>6.19. 使用 Lua</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/special/#using-xfce>6.20. 使用 Xfce</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/special/#using-mozilla>6.21. 使用 Mozilla</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/special/#using-databases>6.22. 使用数据库</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/special/#rc-scripts>6.23. 启动和停止服务 (rc 脚本)</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/special/#users-and-groups>6.24. 添加用户和用户组</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/special/#_依赖内核源代码的_ports>6.25. 依赖内核源代码的 Ports</a></li></ul></li><li><input type=checkbox id=chapter-154554011c772e1e6cc0108eef5e0b2b class=toggle>
<label class="icon cursor" for=chapter-154554011c772e1e6cc0108eef5e0b2b><a role=button></a></label><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/plist/>第 7 章 高级 pkg-plist 用法</a><ul><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/plist/#plist-sub>7.1. 根据 make 变量对 <span class=filename>pkg-plist</span> 进行修改</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/plist/#plist-cleaning>7.2. 空目录</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/plist/#plist-config>7.3. 配置文件</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/plist/#plist-dynamic>7.4. 动态装箱单与静态装箱单的对比</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/plist/#plist-autoplist>7.5. 装箱单 (package list) 的自动化制作</a></li></ul></li><li><input type=checkbox id=chapter-5955b0791ccd51005b5bc5bebeec91e5 class=toggle>
<label class="icon cursor" for=chapter-5955b0791ccd51005b5bc5bebeec91e5><a role=button></a></label><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/pkg-files/>第 8 章 pkg-* 文件</a><ul><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/pkg-files/#porting-message>8.1. <span class=filename>pkg-message</span> (安装预编译包时显示的消息文件)</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/pkg-files/#pkg-install>8.2. <span class=filename>pkg-install</span> (安装预编译包时执行的脚本文件)</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/pkg-files/#pkg-deinstall>8.3. <span class=filename>pkg-deinstall</span> (卸载时执行的脚本文件)</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/pkg-files/#pkg-req>8.4. <span class=filename>pkg-req</span> (安装预编译包时检测是否应执行操作的脚本文件)</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/pkg-files/#pkg-names>8.5. 改变 <span class=filename>pkg-*</span> 文件的名字</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/pkg-files/#using-sub-files>8.6. 使用 <code>SUB_FILES</code> 和 <code>SUB_LIST</code></a></li></ul></li><li><input type=checkbox id=chapter-ee86a11caedb6395ed82b94ec7a9c6cd class=toggle>
<label class="icon cursor" for=chapter-ee86a11caedb6395ed82b94ec7a9c6cd><a role=button></a></label><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/testing/>第 9 章 测试您的 port</a><ul><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/testing/#make-describe>9.1. 运行 <code>make describe</code></a></li></ul></li><li><input type=checkbox id=chapter-24703a9f2b5ab277e796cbfa6f5fd1e4 class=toggle>
<label class="icon cursor" for=chapter-24703a9f2b5ab277e796cbfa6f5fd1e4><a role=button></a></label><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/port-upgrading/>第 10 章 升级一个 port</a><ul><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/port-upgrading/#cvs-diff>10.1. 使用 CVS 制作补丁</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/port-upgrading/#moved-and-updating-files>10.2. UPDATING 和 MOVED 文件</a></li></ul></li><li><input type=checkbox id=chapter-1023911bc0041506653280b832dea3b2 class=toggle>
<label class="icon cursor" for=chapter-1023911bc0041506653280b832dea3b2><a role=button></a></label><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/security/>第 11 章 Ports 的安全</a><ul><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/security/#security-intro>11.1. 安全为何如此重要</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/security/#security-fix>11.2. 修复安全漏洞</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/security/#security-notify>11.3. 通知整个用户群体</a></li></ul></li><li><input type=checkbox id=chapter-9a8875d5d59aa92f1e5a78e9ecd1fbe7 class=toggle>
<label class="icon cursor" for=chapter-9a8875d5d59aa92f1e5a78e9ecd1fbe7><a role=button></a></label><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/porting-dads/>第 12 章 该做什么和不该做什么</a><ul><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/porting-dads/#dads-intro>12.1. 介绍</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/porting-dads/#porting-wrkdir>12.2. <code>WRKDIR</code> (联编时使用的临时目录)</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/porting-dads/#porting-wrkdirprefix>12.3. <code>WRKDIRPREFIX</code> (用于联编的临时目录的父目录名)</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/porting-dads/#porting-versions>12.4. 区分不同的操作系统， 以及 OS 的版本</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/porting-dads/#freebsd-versions>12.5. __FreeBSD_version 值</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/porting-dads/#dads-after-port-mk>12.6. 在 <span class=filename>bsd.port.mk</span> 之后写一些内容</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/porting-dads/#dads-sh-exec>12.7. 在 wrapper 脚本中使用 <code>exec</code> 语句</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/porting-dads/#dads-rational>12.8. 理性行事</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/porting-dads/#dads-cc>12.9. 遵循 <code>CC</code> 和 <code>CXX</code> 设置</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/porting-dads/#dads-cflags>12.10. 遵循 <code>CFLAGS</code></a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/porting-dads/#dads-pthread>12.11. 线程库</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/porting-dads/#dads-freedback>12.12. 反馈</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/porting-dads/#dads-readme>12.13. <span class=filename>README.html</span></a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/porting-dads/#dads-noinstall>12.14. 使用 <code>BROKEN</code>、 <code>FORBIDDEN</code> 或 <code>IGNORE</code> 阻止用户安装 port</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/porting-dads/#dads-deprecated>12.15. 使用 <code>DEPRECATED</code> 或 <code>EXPIRATION_DATE</code> 表示某个 port 将被删除</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/porting-dads/#dads-dot-error>12.16. 避免使用 <code>.error</code> 结构</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/porting-dads/#dads-sysctl>12.17. 对于 <span class=filename>sysctl</span> 的使用</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/porting-dads/#dads-rerolling-distfiles>12.18. 重新发布的 distfiles</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/porting-dads/#dads-misc>12.19. 杂记</a></li></ul></li><li><input type=checkbox id=chapter-5ef4c4c471a3f55c74fb71881f9d8713 class=toggle>
<label for=chapter-5ef4c4c471a3f55c74fb71881f9d8713><a role=button></a></label><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/porting-samplem/>第 13 章 示范的 Makefile</a></li><li><input type=checkbox id=chapter-70f5a4755700a24529175d26e65871bf class=toggle>
<label class="icon cursor" for=chapter-70f5a4755700a24529175d26e65871bf><a role=button></a></label><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/keeping-up/>第 14 章 保持同步</a><ul><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/keeping-up/#freshports>14.1. FreshPorts</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/keeping-up/#cvsweb>14.2. 代码库的 Web 访问界面</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/keeping-up/#ports-mailling-list>14.3. FreeBSD Ports 邮件列表</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/keeping-up/#build-cluster>14.4. 位于 <code>pointyhat.FreeBSD.org</code> 的 FreeBSD Port 联编集群</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/keeping-up/#distfile-survey>14.5. FreeBSD 的 Ports Distfile 扫描器</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/keeping-up/#portsmon>14.6. FreeBSD 的 Ports 追踪系统</a></li></ul></li><li></li></ul></nav></div></aside><div class=book><div class=book-menu-mobile><label for=menu-control><span class=menu-control-button><i class="fa fa-list" aria-hidden=true title="Book menu"></i>
Book menu</span></label></div><h1 class=title>第 6 章 特殊情况</h1><div class="admonitionblock note"><p><i class="fa fa-exclamation-circle" aria-hidden=true></i>
This translation may be out of date. To help with the translations please access the <a href=https://translate-dev.freebsd.org/ target=_blank>FreeBSD translations instance</a>.</p></div><div class=toc-mobile><h3>Table of Contents</h3><nav id=TableOfContents><ul><li><a href=#porting-shlibs>6.1. 共享库</a></li><li><a href=#porting-restrictions>6.2. Ports 的发行限制</a></li><li><a href=#building>6.3. 联编机制</a></li><li><a href=#using-autotools>6.4. 利用 GNU autotools</a></li><li><a href=#using-gettext>6.5. 使用 GNU <code>gettext</code></a></li><li><a href=#using-perl>6.6. 使用 <code>perl</code></a></li><li><a href=#using-x11>6.7. 使用 X11</a></li><li><a href=#using-gnome>6.8. 使用 GNOME</a></li><li><a href=#using-qt>6.9. 使用 Qt</a></li><li><a href=#using-kde>6.10. 使用 KDE</a></li><li><a href=#using-java>6.11. 使用 Java</a></li><li><a href=#using-php>6.12. Web 应用， Apache 和 PHP</a></li><li><a href=#using-python>6.13. 使用 Python</a></li><li><a href=#using-tcl>6.14. 使用 Tcl/Tk</a></li><li><a href=#using-emacs>6.15. 使用 Emacs</a></li><li><a href=#using-ruby>6.16. 使用 Ruby</a></li><li><a href=#using-sdl>6.17. 使用 SDL</a></li><li><a href=#using-wx>6.18. 使用 wxWidgets</a></li><li><a href=#using-lua>6.19. 使用 Lua</a></li><li><a href=#using-xfce>6.20. 使用 Xfce</a></li><li><a href=#using-mozilla>6.21. 使用 Mozilla</a></li><li><a href=#using-databases>6.22. 使用数据库</a></li><li><a href=#rc-scripts>6.23. 启动和停止服务 (rc 脚本)</a></li><li><a href=#users-and-groups>6.24. 添加用户和用户组</a></li><li><a href=#_依赖内核源代码的_ports>6.25. 依赖内核源代码的 Ports</a></li></ul></nav></div><div class=book-content><div id=preamble><div class=sectionbody><div class=paragraph><p>有一些您在创建port时的特殊情况，我们在这里提一下。</p></div></div></div><div class=sect1><h2 id=porting-shlibs>6.1. 共享库<a class=anchor href=#porting-shlibs></a></h2><div class=sectionbody><div class=paragraph><p>如果您的port安装了一个或多个共享库,那么请定义一个 <code>USE_LDCONFIG</code> make 变量， 在<code>post-install</code>标记把它注册进共享库 缓冲时会调用<span class=filename>bsd.port.mk</span>去运行 <code>${LDCONFIG} -m</code>来指向新库的安装目录。 (通常是 <span class=filename>PREFIX/lib</span>) 同样，您也可以适当的在您的 <span class=filename>pke-plist</span>文件 中定义一组<code>@exec /sbin/ldconfig -m</code> 和<code>@unexec /sbin/ldconfig -R，</code> 那么用户可以在安装后马上 就能使用，并且在卸载软件包后系统也不会认为这些共享库仍然存在。</p></div><div class="literalblock programlisting"><div class=content><pre>USE_LDCONFIG= yes</pre></div></div><div class=paragraph><p>如果您需要把共享库安装在缺省的位置之外， 可以通过定义 make 变量 <code>USE_LDCONFIG</code> 来改变默认的安装路径， 它包含安装共享库的目录列表 例如： 如果您的共享库安装到 <span class=filename>PREFIX/lib/foo</span> 和 <span class=filename>PREFIX/lib/bar</span> directories目录，您可以在您的 <span class=filename>Makefile</span>中这样设置:</p></div><div class="literalblock programlisting"><div class=content><pre>USE_LDCONFIG= ${PREFIX}/lib/foo ${PREFIX}/lib/bar</pre></div></div><div class=paragraph><p>请务必仔细检查， 通常这是完全不必要的， 或者可以通过 <code>-rpath</code> 或在连接时设置 <code>LD_RUN_PATH</code> 来避免 (参见 <a class=package href=https://cgit.freebsd.org/ports/tree/lang/moscow_ml/>lang/moscow_ml</a> 给出的例子)， 或者用一个 shell 封装程序来在执行可执行文件之前设置 <code>LD_LIBRARY_PATH</code>， 类似 <a class=package href=https://cgit.freebsd.org/ports/tree/www/seamonkey/>www/seamonkey</a> 那样。</p></div><div class=paragraph><p>当在 64-位系统上安装 32-位 的函数库时， 请使用 <code>USE_LDCONFIG32</code>。</p></div><div class=paragraph><p>尽量将共享库版本号保持为 <span class=filename>libfoo.so.0</span> 这样的格式。 我们的运行环境连接器只会检查主 (第一个) 版本数字。</p></div><div class=paragraph><p>如果在更新 port 时升级了其库的主版本号， 则其它所有连接了受影响的库的 port 的 <code>PORTREVISION</code> 都应递增， 以强制它们采用新版本的库重新编译。</p></div></div></div><div class=sect1><h2 id=porting-restrictions>6.2. Ports 的发行限制<a class=anchor href=#porting-restrictions></a></h2><div class=sectionbody><div class=paragraph><p>众多协议，并且其中的一些致力于 限制怎样的应用程序能被打包， 是否能用于销售赢利等等。</p></div><div class="admonitionblock important"><table><tbody><tr><td class=icon><i class="fa icon-important" title=Important></i></td><td class=content><div class=paragraph><p>做为一名porter您有义务去阅读软件的协议 并且确保FreeBSD 项目不必为通过FTP/HTTP 或CD-ROM重新发布源码或编译的二进制而解释 什么。如果有任何疑问， 请联系 <a href=https://lists.FreeBSD.org/subscription/freebsd-ports>FreeBSD ports 邮件列表</a>。</p></div></td></tr></tbody></table></div><div class=paragraph><p>处于这种情况，就可以设置以下描述 的变量。</p></div><div class=sect2><h3 id=_no_package_禁止编译结果打包>6.2.1. <code>NO_PACKAGE</code> (禁止编译结果打包)<a class=anchor href=#_no_package_禁止编译结果打包></a></h3><div class=paragraph><p>这个变量表示我们可能不能生成这个应用 程序的二进制文件。例如，他的协议不允许 二进制文件的再次发行，或者他可能禁止从 补丁过的源代码打包的发行。</p></div><div class=paragraph><p>不管怎么样，port的 <code>DISTFILES</code> 可以 随意的镜像到FTP/HTTP。除非<code>NO_CDROM</code> 变量也被设置，软件包也可以发行在一张CD-ROM （或类似的媒介上）。</p></div><div class=paragraph><p><code>NO_PACKAGE</code>也能用在当二进制包 不是非常有用，并且这个应用软件经常要 从源代码编译。例如：当这个应用软件在 编译的时候要在配置信息中指定特定的硬件 代码时，可以设置<code>NO_PACKAGE</code>。</p></div><div class=paragraph><p><code>NO_PACKAGE</code>应该设置成字符串 来描述为什么这个软件 不能打包。</p></div></div><div class=sect2><h3 id=_no_cdrom_禁止以_cdrom_发行预编译包>6.2.2. <code>NO_CDROM</code> (禁止以 CDROM 发行预编译包)<a class=anchor href=#_no_cdrom_禁止以_cdrom_发行预编译包></a></h3><div class=paragraph><p>这个变量仅仅指出虽然我们允许 生成二进制包，但也许我们既不能把这个 软件包也不能把port的<code>DISTFILES</code> 放在光盘（或类似的媒介）上销售。但不管怎么样， 二进制包和port的<code>DISTFILES</code> 可以从FTP/HTTP上获得。</p></div><div class=paragraph><p>如果这个变量和 <code>NO_PACKAGE</code>一起被设置， 那么这个port的<code>DISTFIELS</code> 将只能从FTP/HTTP上获得。</p></div><div class=paragraph><p><code>NO_CDROM</code> 应该被设置成一个字符串 来描述为什么这个port不能重新发布在CD-ROM上。 例如：如果这个port的协议仅仅是用于"非商业活动" ,那么这个变量就能设置了。</p></div></div><div class=sect2><h3 id=_nofetchfiles_不自动抓取指定的文件>6.2.3. <code>NOFETCHFILES</code> (不自动抓取指定的文件)<a class=anchor href=#_nofetchfiles_不自动抓取指定的文件></a></h3><div class=paragraph><p>在 <code>NOFETCHFILES</code> 变量中定义的文件， 不会自动从 <code>MASTER_SITES</code> 抓取。 一种典型的用例是， 使用来自某个软件供应商提供的 CD-ROM 上的文件。</p></div><div class=paragraph><p>用于检查在 <code>MASTER_SITES</code> 上是否包含了所需文件的工具， 应忽略这些文件， 而不是报告它们不存在。</p></div></div><div class=sect2><h3 id=_restricted_禁止任何形式的再分发>6.2.4. <code>RESTRICTED</code> (禁止任何形式的再分发)<a class=anchor href=#_restricted_禁止任何形式的再分发></a></h3><div class=paragraph><p>如果应用程序既不允许镜像其 <code>DISTFILES</code>， 也不允许发布其预编译版本的包， 设置它就可以了。</p></div><div class=paragraph><p><code>NO_CDROM</code> 或 <code>NO_PACKAGE</code> 不应与 <code>RESTRICTED</code> 同时设置， 因为它包含了这些情形。</p></div><div class=paragraph><p><code>RESTRICTED</code> 应设置为一个说明 port 为何不能发布的串。 典型情况可能是由于 port 包含了专有的软件， 因而用户需要自行下载 <code>DISTFILES</code>， 可能是注册或者同意某一 EULA 的条款。</p></div></div><div class=sect2><h3 id=_restricted_files_禁止某些文件的再分发>6.2.5. <code>RESTRICTED_FILES</code> (禁止某些文件的再分发)<a class=anchor href=#_restricted_files_禁止某些文件的再分发></a></h3><div class=paragraph><p>当设置了 <code>RESTRICTED</code> 或 <code>NO_CDROM</code> 时， 这个变量会默认设置为 <code>${DISTFILES} ${PATCHFILES}</code>， 否则它会为空。 如果只有某些源码包文件是受限的， 则可以用这个变量来指明它们。</p></div><div class=paragraph><p>注意， port committer 应该在 <span class=filename>/usr/ports/LEGAL</span> 中为每一个源码包文件撰写对应的项目， 并介绍这些限制的原因。</p></div></div></div></div><div class=sect1><h2 id=building>6.3. 联编机制<a class=anchor href=#building></a></h2><div class=sectionbody><div class=sect2><h3 id=parallel-builds>6.3.1. Ports 的并行联编<a class=anchor href=#parallel-builds></a></h3><div class=paragraph><p>FreeBSD ports 框架支持使用多个 <code>make</code> 子进程来进行并行编译， 在 SMP 上这可以全面地利用系统的 CPU 计算能力， 令 port 的联编过程更快、 更有效率。</p></div><div class=paragraph><p>目前这是通过向原作者的代码传递 <a href="https://man.freebsd.org/cgi/man.cgi?query=make&amp;sektion=1&amp;format=html">make(1)</a> 参数 <code>-jX</code> 来实现的。 遗憾的是， 并不是所有的 port 都能够很好地处理这个选项。 因此， 必须通过明确地在 <span class=filename>Makefile</span> 中指定 <code>MAKE_JOBS_SAFE=yes</code> 来启用这一功能。</p></div><div class=paragraph><p>从 port 监护人的角度还有一个控制的方法是设置 <code>MAKE_JOBS_UNSAFE=yes</code> 变量。 这个变量主要是用于已知不能与 <code>-jX</code> 配合使用的 port， 即使用户在 <span class=filename>/etc/make.conf</span> 中定义了 <code>FORCE_MAKE_JOBS=yes</code> 变量， 系统也不会使用并行编译。</p></div></div><div class=sect2><h3 id=using-make>6.3.2. <code>make</code>、 <code>gmake</code>， 以及 <code>imake</code><a class=anchor href=#using-make></a></h3><div class=paragraph><p>如果 port 用到了 GNU make， 应设置 <code>USE_GMAKE=yes</code>。</p></div><table class="tableblock frame-none grid-all stretch"><caption class=title>表 1. 与 gmake 有关的 port 变量</caption><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">变量</th><th class="tableblock halign-left valign-top">意义</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>USE_GMAKE</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>此 port 需要使用 <code>gmake</code> 来完成联编过程。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>GMAKE</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>不在 <code>PATH</code> 中时， <code>gmake</code> 的完整路径。</p></td></tr></tbody></table><div class=paragraph><p>对于 X 应用程序的 port， 如果它使用 imake 根据 <span class=filename>Imakefile</span> 文件来生成 <span class=filename>Makefile</span>， 则应设置 <code>USE_IMAKE=yes</code>。 这会使联编过程中的配置 (configure) 阶段自动执行 <code>xmkmf -a</code>。 如果 <code>-a</code> 标志会给您的 port 带来麻烦， 则需设置 <code>XMKMF=xmkmf</code>。 如果 port 用到了 imake 但并不使用 <code>install.man</code> target， 则应设置 <code>NO_INSTALL_MANPAGES=yes</code>。</p></div><div class=paragraph><p>如果 port 源文件的 <span class=filename>Makefile</span> 的主联编 target 是 <code>all</code> 以外的名字， 应对应地设置 <code>ALL_TARGET</code>。 对于 <code>install</code> 而言， 对应的变量是 <code>INSTALL_TARGET</code>。</p></div></div><div class=sect2><h3 id=using-configure>6.3.3. <code>configure</code> 脚本<a class=anchor href=#using-configure></a></h3><div class=paragraph><p>假如 port 使用 <code>configure</code> 脚本来从 <span class=filename>Makefile.in</span> 生成 <span class=filename>Makefile</span> 文件， 需要设置 <code>GNU_CONFIGURE=yes</code>。 如果希望传额外的参数给 <code>configure</code> 脚本 (默认参数为 <code>--prefix=${PREFIX} --infodir=${PREFIX}/${INFO_PATH} --mandir=${MANPREFIX}/man --build=${CONFIGURE_TARGET}</code>)， 应通过 <code>CONFIGURE_ARGS</code> 来指定这些参数。 类似地， 可以通过 <code>CONFIGURE_ENV</code> 变量来传递一些环境变量。</p></div><div class=paragraph><p>如果您的软件包使用 GNU <code>configure</code>， 而生成的可执行文件命名方式 "怪异" 如 <span class=filename>i386-portbld-freebsd4.7-</span><em>应用程序名</em>， 则需要更进一步地通过改变 <code>CONFIGURE_TARGET</code> 变量来按照较新版本的 <code>autoconf</code> 生成的脚本所希望的方式指定 target。 其方法是， 紧随 <span class=filename>Makefile</span> 中 <code>GNU_CONFIGURE=yes</code> 一行之后加入：</p></div><div class=paragraph><p><code>CONFIGURE_TARGET=--build=${MACHINE_ARCH}-portbld-freebsd${OSREL}</code></p></div><table class="tableblock frame-none grid-all stretch"><caption class=title>表 2. 用于用到了 <code>configure</code> 脚本的 port 的变量</caption><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">变量</th><th class="tableblock halign-left valign-top">意义</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>GNU_CONFIGURE</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>此 port 需要用 <code>configure</code> 脚本来准备联编。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>HAS_CONFIGURE</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>与 <code>GNU_CONFIGURE</code> 类似， 但默认的 configure target 并不加入 <code>CONFIGURE_ARGS</code>。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>CONFIGURE_ARGS</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>希望传给 <code>configure</code> 脚本的额外参数。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>CONFIGURE_ENV</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>希望在执行 <code>configure</code> 脚本时设置的环境变量。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>CONFIGURE_TARGET</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>替换默认的 configure target。 其默认值是 <code>${MACHINE_ARCH}-portbld-freebsd${OSREL}</code>。</p></td></tr></tbody></table></div><div class=sect2><h3 id=using-scons>6.3.4. 使用 <code>scons</code><a class=anchor href=#using-scons></a></h3><div class=paragraph><p>如果您的 port 使用 SCons， 就需要定义 <code>USE_SCONS=yes</code> 了。</p></div><table class="tableblock frame-none grid-all stretch"><caption class=title>表 3. 使用 <code>scons</code> 的 port 会用到的变量</caption><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">变量</th><th class="tableblock halign-left valign-top">含义</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>SCONS_ARGS</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>当前 port 希望传给 SCons 环境的参数。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>SCONS_BUILDENV</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>希望在系统环境中设置的变量。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>SCONS_ENV</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>希望在 SCons 环境中设置的变量。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>SCONS_TARGET</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>传递给 SCons 的最后一个参数， 类似于 <code>MAKE_TARGET</code>。</p></td></tr></tbody></table><div class=paragraph><p>如果希望让第三方的 <span class=filename>SConstruct</span> 尊重通过 <code>SCONS_ENV</code> (其中最重要的是 <code>CC/CXX/CFLAGS/CXXFLAGS</code> 配置) 传给 Scons 的配置， 则需要对 <span class=filename>SConstruct</span> 进行修改， 使联编的 <code>Environment</code> 按下列方式建立：</p></div><div class="literalblock programlisting"><div class=content><pre>env = Environment(**ARGUMENTS)</pre></div></div><div class=paragraph><p>其后， 可以通过 <code>env.Append</code> 和 <code>env.Replace</code> 来对它进行修改。</p></div></div></div></div><div class=sect1><h2 id=using-autotools>6.4. 利用 GNU autotools<a class=anchor href=#using-autotools></a></h2><div class=sectionbody><div class=sect2><h3 id=using-autotools-introduction>6.4.1. 入门<a class=anchor href=#using-autotools-introduction></a></h3><div class=paragraph><p>众多 GNU autotools 提供了一种在多重操作系统和机器架构之上联编软件的抽象机制。 在 Ports Collection 中， port 可以通过简单的方法来使用这些工具：</p></div><div class="literalblock programlisting"><div class=content><pre>USE_AUTOTOOLS= 工具:版本[:操作] ...</pre></div></div><div class=paragraph><p>撰写本书时， <em>工具</em> 可以设置为 <code>libtool</code>、 <code>libltdl</code>、 <code>autoconf</code>、 <code>autoheader</code>、 <code>automake</code> 或 <code>aclocal</code> 之一。</p></div><div class=paragraph><p><em>版本</em> 用来指定希望使用的工具的特定版本 (参见 <code>devel/{automake,autoconf,libtool}[0-9]+</code> 以了解有效的版本号)。</p></div><div class=paragraph><p><em>操作</em> 是一个可选的扩展选项， 用于修改如何使用工具。</p></div><div class=paragraph><p>可以同时指定多个不同的工具， 可以在一行中指定， 也可以用 Makefile 的 <code>+=</code> 结构。</p></div><div class=paragraph><p>最后， 可以使用一个特殊的名为 <code>autotools</code> 的工具， 它会安装全部可用的 autotools 版本， 以适应跨平台开发的需要。 您可以通过安装 <code>devel/autotools</code> port 来达到这一目的。</p></div></div><div class=sect2><h3 id=using-libtool>6.4.2. <code>libtool</code><a class=anchor href=#using-libtool></a></h3><div class=paragraph><p>使用 GNU 联编框架的共享库通常会使用 <code>libtool</code> 来调整共享库的编译和安装， 以便与所运行的操作系统相匹配。 通常的做法是使用应用程序所附带的 <code>libtool</code> 副本。 如果需要使用外部的 <code>libtool</code>， 则可以使用 Ports 套件提供的版本：</p></div><div class="literalblock programlisting"><div class=content><pre>USE_AUTOTOOLS= libtool:版本[:env]</pre></div></div><div class=paragraph><p>如果不使用额外的操作符， <code>libtool:版本</code> 表示希望联编框架使用 configure 脚本来对系统所安装的 <code>libtool</code> 进行修补。 这会暗含地定义 <code>GNU_CONFIGURE</code>。 更进一步， 联编框架还会设置一系列 make 和 shell 变量用于 port 后续的操作。 请参见 <span class=filename>bsd.autotools.mk</span> 了解进一步的详情。</p></div><div class=paragraph><p>如果指定了 <code>:env</code> 操作符， 则表示只设置环境， 而跳过其他的操作。</p></div><div class=paragraph><p>最后， <code>LIBTOOLFLAGS</code> 和 <code>LIBTOOLFILES</code> 可以用来替换最常修改的参数， 以及将被 <code>libtool</code> 修补的文件。 多数 port 不需要这样做。 请参见 <span class=filename>bsd.autotools.mk</span> 以了解进一步的细节。</p></div></div><div class=sect2><h3 id=using-libltdl>6.4.3. <code>libltdl</code><a class=anchor href=#using-libltdl></a></h3><div class=paragraph><p>一些 ports 会使用 <code>libltdl</code> 库， 后者是 <code>libtool</code> 软件包的一部分。 使用这个库并不意味着必须使用 <code>libtool</code> 本身， 因此提供了另一组结构。</p></div><div class="literalblock programlisting"><div class=content><pre>USE_AUTOTOOLS= libltdl:版本</pre></div></div><div class=paragraph><p>目前， 这一设置所做的全部工作是将 <code>LIB_DEPENDS</code> 设置为适当的 <code>libltdl</code> port， 并作为一项方便的功能， 协助开发人员消除在 <code>USE_AUTOTOOLS</code> 框架以外的， 对于 autotools port 的依赖。 这个工具并不提供其它的操作符。</p></div></div><div class=sect2><h3 id=using-autoconf>6.4.4. <code>autoconf</code> 和 <code>autoheader</code><a class=anchor href=#using-autoconf></a></h3><div class=paragraph><p>某些 port 并没有直接提供 configure 脚本， 但包含了作为 autoconf 模板的 <span class=filename>configure.ac</span> 文件。 可以用下列设置来要求 <code>autoconf</code> 创建 configure 脚本， 并使用 <code>autoheader</code> 来为 configure 脚本创建模板头文件。</p></div><div class="literalblock programlisting"><div class=content><pre>USE_AUTOTOOLS=	autoconf:版本[:env]</pre></div></div><div class=paragraph><p>以及</p></div><div class="literalblock programlisting"><div class=content><pre>USE_AUTOTOOLS=	autoheader:版本</pre></div></div><div class=paragraph><p>上述设置会暗含使用 <code>autoconf:版本</code>。</p></div><div class=paragraph><p>对于 <code>libtool</code>， 设置与前面类似。 如果指定可选的 <code>:env</code> 操作符， 则表示只设置用于后续工作的环境。 如果不指定， 则会对 port 进行相应的修补和重新配置。</p></div><div class=paragraph><p>其它的可选变量， 如 <code>AUTOCONF_ARGS</code> 和 <code>AUTOHEADER_ARGS</code> 可以通过 port 的 <span class=filename>Makefile</span> 来显式地指定替换。 类似 <code>libtool</code>， 多数 port 并不需要这样做。</p></div></div><div class=sect2><h3 id=using-automake>6.4.5. <code>automake</code> 和 <code>aclocal</code><a class=anchor href=#using-automake></a></h3><div class=paragraph><p>某些软件包只提供了 <span class=filename>Makefile.am</span> 文件。 这些文件必须首先用 <code>automake</code> 转换为 <span class=filename>Makefile.in</span> 并使用 <code>configure</code> 来生成实际的 <span class=filename>Makefile</span>。</p></div><div class=paragraph><p>类似地， 偶尔会有一些软件包不提供联编所需的 <span class=filename>aclocal.m4</span> 文件。 这些文件可以通过使用 <code>aclocal</code> 来扫描 <span class=filename>configure.ac</span> 或 <span class=filename>configure.in</span> 自动生成。</p></div><div class=paragraph><p><code>aclocal</code> 与 <code>automake</code> 有和 <code>autoheader</code> 与 <code>autoconf</code> 在前面一节中所介绍的相类似的关系。 <code>aclocal</code> 会暗含使用 <code>automake</code>， 因此：</p></div><div class="literalblock programlisting"><div class=content><pre>USE_AUTOTOOLS=	automake:版本[:env]</pre></div></div><div class=paragraph><p>和</p></div><div class="literalblock programlisting"><div class=content><pre>USE_AUTOTOOLS=	aclocal:版本</pre></div></div><div class=paragraph><p>也自动暗含使用 <code>automake:版本</code>。</p></div><div class=paragraph><p>与 <code>libtool</code> 类似， <code>autoconf</code> 如果使用了可选的 <code>:env</code> 操作符表示仅仅设置用于后续使用的环境， 如果不设置， 则会对 port 进行重新配置。</p></div><div class=paragraph><p>对于 <code>autoconf</code> 和 <code>autoheader</code> 而言， <code>automake</code> 和 <code>aclocal</code> 提供了对应的可选参数变量 <code>AUTOMAKE_ARGS</code> 和 <code>ACLOCAL_ARGS</code>， 如果需要的话， 可以在 port 的 <span class=filename>Makefile</span> 中指定。</p></div></div></div></div><div class=sect1><h2 id=using-gettext>6.5. 使用 GNU <code>gettext</code><a class=anchor href=#using-gettext></a></h2><div class=sectionbody><div class=sect2><h3 id=_基本用法>6.5.1. 基本用法<a class=anchor href=#_基本用法></a></h3><div class=paragraph><p>如果您的 port 需要使用 <code>gettext</code>， 只要将 <code>USE_GETTEXT</code> 设置为 <code>yes</code>， 您的 port 就会增加对 <a class=package href=https://cgit.freebsd.org/ports/tree/devel/gettext/>devel/gettext</a> 的依赖。 <code>USE_GETTEXT</code> 也可以指定为所需的 <code>libintl</code> 库的版本， 它是 <code>gettext</code> 的基本组成部分， 尽管如此， <em>强烈建议您不要</em> 使用这个功能： 您的 port 应能与目前版本的 <a class=package href=https://cgit.freebsd.org/ports/tree/devel/gettext/>devel/gettext</a> 配合工作。</p></div><div class=paragraph><p>在 port 中相当常见的情况下， 会需要同时使用 <code>gettext</code> 和 <code>configure</code>。 一般而言， GNU <code>configure</code> 能够自动定位到 <code>gettext</code>。 如果它没有成功地完成这项工作， 则可以通过类似下面这样的 <code>CPPFLAGS</code> 和 <code>LDFLAGS</code> 将 <code>gettext</code> 的位置告诉它：</p></div><div class="literalblock programlisting"><div class=content><pre>USE_GETTEXT=    yes
CPPFLAGS+=      -I${LOCALBASE}/include
LDFLAGS+=       -L${LOCALBASE}/lib

GNU_CONFIGURE=  yes
CONFIGURE_ENV=  CPPFLAGS=&#34;${CPPFLAGS}&#34; \
                LDFLAGS=&#34;${LDFLAGS}&#34;</pre></div></div><div class=paragraph><p>当然， 不需要传参数给 <code>configure</code> 时， 代码可以更为简练：</p></div><div class="literalblock programlisting"><div class=content><pre>USE_GETTEXT=    yes
GNU_CONFIGURE=  yes
CONFIGURE_ENV=  CPPFLAGS=&#34;-I${LOCALBASE}/include&#34; \
                LDFLAGS=&#34;-L${LOCALBASE}/lib&#34;</pre></div></div></div><div class=sect2><h3 id=_可选用法>6.5.2. 可选用法<a class=anchor href=#_可选用法></a></h3><div class=paragraph><p>一些软件产品提供了禁用 NLS 的能力， 例如， 在 <code>configure</code> 时， 指定 <code>--disable-nls</code> 参数。 如果您 port 的软件支持这种配置， 则应根据 <a href=#knobs-without-nls><code>WITHOUT_NLS</code></a> 的设置来有条件地使用 <code>gettext</code>。 对于比较简单和不太复杂的 port， 您可以使用下列结构：</p></div><div class="literalblock programlisting"><div class=content><pre>GNU_CONFIGURE=          yes

.if !defined(WITHOUT_NLS)
USE_GETTEXT=            yes
PLIST_SUB+=             NLS=&#34;&#34;
.else
CONFIGURE_ARGS+=        --disable-nls
PLIST_SUB+=             NLS=&#34;@comment &#34;
.endif</pre></div></div><div class=paragraph><p>您要做的下一件事是合理地安排装箱单文件， 使其根据用户配置来决定是否将消息编录 (message catalog) 文件放入最终的装箱单。 前面已经介绍了在 <span class=filename>Makefile</span> 中所需的写法， 这种做法在 <a href=../plist/#plist-sub>高级 <span class=filename>pkg-plist</span> 用法</a> 这节中进行了介绍。 简单地说， 在 <span class=filename>pkg-plist</span> 中出现的 <code>%%NLS%%</code> 均会在禁用 NLS 时自动替换为 “`@comment `”， 反之则替换为空串。 这样， 在最终的装箱单中带 <code>%%NLS%%</code> 的行， 在 NLS 关闭的情况下就会变为注释， 反之， 这些前缀就会自动删掉。 现在需要做的事情就是把 <code>%%NLS%%</code> 插到 <span class=filename>pkg-plist</span> 中的消息编录文件的那些行开头， 例如：</p></div><div class="literalblock programlisting"><div class=content><pre>%%NLS%%share/locale/fr/LC_MESSAGES/foobar.mo
%%NLS%%share/locale/no/LC_MESSAGES/foobar.mo</pre></div></div><div class=paragraph><p>在比较复杂的情形中， 您可能需要使用更高级的技术， 例如 <a href=../plist/#plist-dynamic>动态生成装箱单</a> 等。</p></div></div><div class=sect2><h3 id=_处理消息编录目录>6.5.3. 处理消息编录目录<a class=anchor href=#_处理消息编录目录></a></h3><div class=paragraph><p>在安装消息编录文件时还有一个需要注意的地方。 这些文件会放到 <span class=filename>LOCALBASE/shared/locale</span> 下与语言对应的目录中， 这些目录一般您的 port 不需要创建和删除。 最常用的语言的目录已经在 <span class=filename>/etc/mtree/BSD.local.dist</span> 中列出； 也就是说， 它们是基本系统的一部分。 其他一些语言的目录， 则由 <a class=package href=https://cgit.freebsd.org/ports/tree/devel/gettext/>devel/gettext</a> 控制。 您最好查看一下 <span class=filename>pkg-plist</span>， 以确定是否正在安装某种不常用语言的文件。</p></div></div></div></div><div class=sect1><h2 id=using-perl>6.6. 使用 <code>perl</code><a class=anchor href=#using-perl></a></h2><div class=sectionbody><div class=paragraph><p>如果 <code>MASTER_SITES</code> 设为 <code>MASTER_SITE_PERL_CPAN</code>， 则应尽量把 <code>MASTER_SITE_SUBDIR</code> 设置为顶级目录的名字。 例如， 对 <code>p5-Module-Name</code> 而言推荐的名字是 <code>Module</code>。 您可以在 <a href=http://cpan.org/modules/by-module/>cpan.org</a> 找到顶级目录的名字。 这可以确保在模块的作者发生变化时， 保持 port 继续可用。</p></div><div class=paragraph><p>以上规则有一个例外， 即对应目录不存在或源码包不在那个目录中时， 允许使用作者的 id 作为 <code>MASTER_SITE_SUBDIR</code>。</p></div><div class=paragraph><p>所有这些选项均同时接受 <code>YES</code> 和版本串， 类似 <code>5.8.0+</code> 这样的写法。 使用 <code>YES</code> 表示 port 能够配合所有受支持的 Perl 版本来使用。 如果 port 只能配合特定版本的 Perl 来使用， 则可以用版本串来表示， 例如最低版本 (如 <code>5.7.3+</code>)、 最高版本 (如 <code>5.8.0-</code>) 或某个具体的版本 (如 <code>5.8.3</code>)。</p></div><table class="tableblock frame-none grid-all stretch"><caption class=title>表 4. 用于用到 <code>perl</code> 的 port 的变量</caption><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">变量</th><th class="tableblock halign-left valign-top">意义</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>USE_PERL5</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>表示 port 将 <code>perl 5</code> 用于联编和运行。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>USE_PERL5_BUILD</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>表示 port 将 <code>perl 5</code> 用于联编。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>USE_PERL5_RUN</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>表示 port 将 <code>perl 5</code> 用于运行。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>PERL</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>perl 5</code> 的完整路径， 可能是系统自带的， 或者从 port 安装， 但没有版本号。 如果您需要在脚本中替换 “#!” 行， 则应使用这个变量。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>PERL_CONFIGURE</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>采用 Perl 的 MakeMaker 进行配置。 这一变量隐含设置 <code>USE_PERL5</code>。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>PERL_MODBUILD</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>使用 Module::Build 进行配置、 联编并安装。 这一变量隐含设置 <code>PERL_CONFIGURE</code>。</p></td></tr></tbody></table><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Perl 模块通常并没有官方网站， 这些 port 应将 <code>cpan.org</code> 作为其 <span class=filename>pkg-descr</span> WWW 行的内容。 推荐的 URL 格式为 <code><a href=http://search.cpan.org/dist/Module-Name/ class=bare>http://search.cpan.org/dist/Module-Name/</a></code> (保留最后的斜线)。</p></div></td></tr></tbody></table></div></div></div><div class=sect1><h2 id=using-x11>6.7. 使用 X11<a class=anchor href=#using-x11></a></h2><div class=sectionbody><div class=sect2><h3 id=x11-variables>6.7.1. X.Org 组件<a class=anchor href=#x11-variables></a></h3><div class=paragraph><p>在 Ports 套件中提供的 X11 实现是 X.Org。 如果您的应用程序用到了 X 组件， 则应将 <code>USE_XORG</code> 设为所需要的那些组件。 目前可用的组件包括：</p></div><div class=paragraph><p><code>bigreqsproto compositeproto damageproto dmx dmxproto evieproto fixesproto fontcacheproto fontenc fontsproto fontutil glproto ice inputproto kbproto libfs oldx printproto randrproto recordproto renderproto resourceproto scrnsaverproto sm trapproto videoproto x11 xau xaw xaw6 xaw7 xaw8 xbitmaps xcmiscproto xcomposite xcursor xdamage xdmcp xevie xext xextproto xf86bigfontproto xf86dgaproto xf86driproto xf86miscproto xf86rushproto xf86vidmodeproto xfixes xfont xfontcache xft xi xinerama xineramaproto xkbfile xkbui xmu xmuu xorg-server xp xpm xprintapputil xprintutil xpr oto xproxymngproto xrandr xrender xres xscrnsaver xt xtrans xtrap xtst xv xvmc xxf86dga xxf86misc xxf86vm</code>.</p></div><div class=paragraph><p>最新的列表， 可以在 <span class=filename>/usr/ports/Mk/bsd.xorg.mk</span> 中找到。</p></div><div class=paragraph><p>The Mesa Project 是一个致力于自由的 OpenGL 实现的计划。 您可以使用 <code>USE_GL</code> 变量来让 port 依赖其不同的组件。 可用的选项包括： <code>glut, glu, glw, glew, gl</code> 和 <code>linux</code>。 为了实现向前兼容， 当使用 <code>yes</code> 时系统会自动将其映射为 <code>glu</code>。</p></div><div id=use-xorg-example class=exampleblock><div class=title>例 1. 使用 USE_XORG 的例子</div><div class=content><div class="literalblock programlisting"><div class=content><pre>USE_XORG=   xrender xft xkbfile xt xaw
USE_GL=     glu</pre></div></div></div></div><div class=paragraph><p>许多 ports 会定义 <code>USE_XLIB</code>， 这会导致 port 依赖 50 多个动态连接库。 由于它出现于 X.org 模块化之前， 因此这个变量仅为向前兼容的原因提供， 新的 port 不应再使用它。</p></div><table class="tableblock frame-none grid-all stretch"><caption class=title>表 5. 用到 X 的 port 可以使用的变量</caption><col style=width:50%><col style=width:50%><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>USE_XLIB</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>此 port 用到了 X 库。 已过时 - 您应使用 <code>USE_XORG</code> 变量列出用到的 X.Org 组件， 而不是使用这个变量。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>USE_IMAKE</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>此 port 用到了 <code>imake</code>。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>USE_X_PREFIX</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>已过时。 目前其作用与 <code>USE_XLIB</code> 相同， 并可以直接用后者替换。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>XMKMF</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>设置为 <code>xmkmf</code> 的完整路径名， 如果它不在 <code>PATH</code> 中的话。 默认值是 <code>xmkmf -a</code>。</p></td></tr></tbody></table><table class="tableblock frame-none grid-all stretch"><caption class=title>表 6. 用于表示对 X11 某些组件的依赖关系的变量</caption><col style=width:50%><col style=width:50%><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>X_IMAKE_PORT</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>用以提供 <code>imake</code> 以及许多其它用于联编 X11 的工具的 port。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>X_LIBRARIES_PORT</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>用以提供 X11 库的 port。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>X_CLIENTS_PORT</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>用以提供 X 客户的 port。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>X_SERVER_PORT</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>用以提供 X 服务的 port。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>X_FONTSERVER_PORT</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>用以提供字体服务的 port。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>X_PRINTSERVER_PORT</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>用以提供打印服务的 port。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>X_VFBSERVER_PORT</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>用以提供在虚拟帧缓存服务(virtual framebuffer server) 的 port。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>X_NESTSERVER_PORT</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>用以提供嵌套 X 服务的 port。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>X_FONTS_ENCODINGS_PORT</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>用以为字体提供编码的 port。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>X_FONTS_MISC_PORT</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>用以提供多种位图字体的 port。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>X_FONTS_100DPI_PORT</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>用以提供 100dpi 位图字体的 port。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>X_FONTS_75DPI_PORT</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>用以提供 75dpi 位图字体的 port。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>X_FONTS_CYRILLIC_PORT</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>用以提供西里尔位图字体的 port。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>X_FONTS_TTF_PORT</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>用以提供 TrueType® 字体的 port。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>X_FONTS_TYPE1_PORT</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>用以提供 Type1 字体的 port。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>X_MANUALS_PORT</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>用以提供面向开发人员的联机手册的 port。</p></td></tr></tbody></table><div id=using-x11-vars class=exampleblock><div class=title>例 2. 在变量中使用与 X11 有关的变量</div><div class=content><div class="literalblock programlisting"><div class=content><pre># 使用某些 X11 库并依赖字体服务和西里尔字体。
RUN_DEPENDS=   ${LOCALBASE}/bin/xfs:${X_FONTSERVER_PORT} \
               ${LOCALASE}/lib/X11/fonts/cyrillic/crox1c.pcf.gz:${X_FONTS_CYRILLIC_PORT}

USE_XORG=      x11 xpm</pre></div></div></div></div></div><div class=sect2><h3 id=x11-motif>6.7.2. 需要使用 Motif 的 port<a class=anchor href=#x11-motif></a></h3><div class=paragraph><p>如果您的 port 需要 Motif 库， 则应在 <span class=filename>Makefile</span> 中定义 <code>USE_MOTIF</code>。 默认的 Motif 实现是 <a class=package href=https://cgit.freebsd.org/ports/tree/x11-toolkits/open-motif/>x11-toolkits/open-motif</a>。 用户可以通过设置 <code>WANT_LESSTIF</code> 变量来选择 <a class=package href=https://cgit.freebsd.org/ports/tree/x11-toolkits/lesstif/>x11-toolkits/lesstif</a> 代替它。</p></div><div class=paragraph><p><span class=filename>bsd.port.mk</span> 会将 <code>MOTIFLIB</code> 变量设置为到合适的 Motif 库的引用。 请使用补丁将您 port 中 <span class=filename>Makefile</span> 或 <span class=filename>Imakefile</span> 提到 Motif 库的地方改为 <code>${MOTIFLIB}</code>。</p></div><div class=paragraph><p>有两种比较常见的情况：</p></div><div class=ulist><ul><li><p>如果 port 中将 Motif 在其 <span class=filename>Makefile</span> 或 <span class=filename>Imakefile</span> 表达为 <code>-lXm</code>， 则简单地将其替换为 <code>${MOTIFLIB}</code>。</p></li><li><p>如果 port 在其 <span class=filename>Imakefile</span> 中使用 <code>XmClientLibs</code>， 则将其改为 <code>${MOTIFLIB} ${XTOOLLIB} ${XLIB}</code>.</p></li></ul></div><div class=paragraph><p>注意 <code>MOTIFLIB</code> (通常) 会展开为 <code>-L/usr/X11R6/lib -lXm</code> 或 <code>/usr/X11R6/lib/libXm.a</code>， 所以不需要在其前加入 <code>-L</code> 或 <code>-l</code>。</p></div></div><div class=sect2><h3 id=_x11_字体>6.7.3. X11 字体<a class=anchor href=#_x11_字体></a></h3><div class=paragraph><p>如果 port 将为 X Window 系统安装字体， 将这些字体放到 <span class=filename>LOCALBASE/lib/X11/fonts/local</span>。</p></div></div><div class=sect2><h3 id=_通过_xvfb_来获得虚拟的_display>6.7.4. 通过 Xvfb 来获得虚拟的 <code>DISPLAY</code><a class=anchor href=#_通过_xvfb_来获得虚拟的_display></a></h3><div class=paragraph><p>某些应用程序必须在有可用的 X11 显示的时候才能成功编译。 当编译的机器没有控制台时， 这会带来问题。 为了解决这个问题， 如果定义了适当的变量， 联编基础设施会启动采用虚拟帧缓存的 X server。 此时， 编译过程中将会传出可用的 <code>DISPLAY</code>。</p></div><div class="literalblock programlisting"><div class=content><pre>USE_DISPLAY=  yes</pre></div></div></div><div class=sect2><h3 id=desktop-entries>6.7.5. 桌面项<a class=anchor href=#desktop-entries></a></h3><div class=paragraph><p>通过利用 <code>DESKTOP_ENTRIES</code> 变量， 可以很容易地在您的 port 中创建桌面项 (<a href=http://standards.freedesktop.org/desktop-entry-spec/latest/>Freedesktop 标准</a>)。 这些项会在类似 GNOME 或 KDE 这样的符合这一标准的桌面环境中显示在应用程序菜单中。 这样做会自动创建、 安装 <span class=filename>.desktop</span> 文件， 并将其加入 <span class=filename>pkg-plist</span>。 其语法为：</p></div><div class="literalblock programlisting"><div class=content><pre>DESKTOP_ENTRIES=  &#34;NAME&#34; &#34;COMMENT&#34; &#34;ICON&#34; &#34;COMMAND&#34; &#34;CATEGORY&#34; StartupNotify</pre></div></div><div class=paragraph><p>您可以在 <a href=http://standards.freedesktop.org/menu-spec/latest/apa.html>Freedesktop 网站上</a> 找到可用的分类名称。 <code>StartupNotify</code> 表示应用程序在支持启动通知的环境中清除状态信息。</p></div><div class=paragraph><p>例子：</p></div><div class="literalblock programlisting"><div class=content><pre>DESKTOP_ENTRIES=  &#34;ToME&#34; &#34;Roguelike game based on JRR Tolkien&#39;s work&#34; \
                  &#34;${DATADIR}/xtra/graf/tome-128.png&#34; \
                  &#34;tome -v -g&#34; &#34;Application;Game;RolePlaying;&#34; \
                  false</pre></div></div></div></div></div><div class=sect1><h2 id=using-gnome>6.8. 使用 GNOME<a class=anchor href=#using-gnome></a></h2><div class=sectionbody><div class=paragraph><p>FreeBSD/GNOME 项目组使用一组自己的变量来定义 port 所使用的 GNOME 组件。 <a href=http://www.FreeBSD.org/gnome/docs/porting/>这些变量的详细列表</a> 可以在 FreeBSD/GNOME 项目的主页找到。</p></div></div></div><div class=sect1><h2 id=using-qt>6.9. 使用 Qt<a class=anchor href=#using-qt></a></h2><div class=sectionbody><div class=sect2><h3 id=qt-common>6.9.1. 在 port 中使用 Qt<a class=anchor href=#qt-common></a></h3><table class="tableblock frame-none grid-all stretch"><caption class=title>表 7. 用于使用 Qt 的 port 的变量</caption><col style=width:50%><col style=width:50%><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>USE_QT_VER</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>表示 port 用到了 Qt 工具套件。 可用的值包括 <code>3</code> 和 <code>4</code>； 用于指定使用的 Qt 的主版本。 此外， 系统会自动为 <code>configure</code> 脚本和 <code>make</code> 命令提供必要的参数。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>QT_PREFIX</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>这个变量会自动设为 Qt 的安装路径 (只读变量)。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>MOC</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>这个变量会自动设为 <code>moc</code> 的路径 (只读变量)。 默认值与 <code>USE_QT_VER</code> 变量的值有关。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>QTCPPFLAGS</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>通过 <code>CONFIGURE_ENV</code> 传给 Qt 工具套件的编译参数。 默认配置与 <code>USE_QT_VER</code> 有关。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>QTCFGLIBS</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>通过 <code>CONFIGURE_ENV</code> 传给 Qt 工具套件的连接库。 默认配置与 <code>USE_QT_VER</code> 有关。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>QTNONSTANDARD</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>禁止系统自动修改 <code>CONFIGURE_ENV</code>、 <code>CONFIGURE_ARGS</code> 和 <code>MAKE_ENV</code>。</p></td></tr></tbody></table><table class="tableblock frame-none grid-all stretch"><caption class=title>表 8. 其他用于使用 Qt 4.x 的变量</caption><col style=width:50%><col style=width:50%><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>QT_COMPONENTS</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>用于指定 Qt4 工具和函数库的依赖。 详情见后。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>UIC</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>这个变量会自动设为 <code>uic</code> 的路径 (只读变量)。 默认值与 <code>USE_QT_VER</code> 有关。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>QMAKE</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>这个变量会自动设为 <code>qmake</code> 的路径 (只读变量)。 其默认值与 <code>USE_QT_VER</code> 有关。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>QMAKESPEC</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>这个变量会自动设为 <code>qmake</code> 配置文件的路径 (只读变量)。 其默认值与 <code>USE_QT_VER</code> 有关。</p></td></tr></tbody></table><div class=paragraph><p>当设置了 <code>USE_QT_VER</code> 时， 系统自动会给 <code>configure</code> 脚本传一系列有用的参数：</p></div><div class="literalblock programlisting"><div class=content><pre>CONFIGURE_ARGS+= --with-qt-includes=${QT_PREFIX}/include \
                 --with-qt-libraries=${QT_PREFIX}/lib \
                 --with-extra-libs=${LOCALBASE}/lib \
                 --with-extra-includes=${LOCALBASE}/include
CONFIGURE_ENV+=  MOC=&#34;${MOC}&#34; CPPFLAGS=&#34;${CPPFLAGS} ${QTCPPFLAGS}&#34; LIBS=&#34;${QTCFGLIBS}&#34; \
                 QTDIR=&#34;${QT_PREFIX}&#34; KDEDIR=&#34;${KDE_PREFIX}&#34;</pre></div></div><div class=paragraph><p>如果将 <code>USE_QT_VER</code> 设为 <code>4</code>， 则还会进行下列配置：</p></div><div class="literalblock programlisting"><div class=content><pre>CONFIGURE_ENV+= UIC=&#34;${UIC}&#34; QMAKE=&#34;${QMAKE}&#34; QMAKESPEC=&#34;${QMAKESPEC}&#34;
MAKE_ENV+=      QMAKESPEC=&#34;${QMAKESPEC}&#34;</pre></div></div></div><div class=sect2><h3 id=qt4-components>6.9.2. 组件的选择 (仅限 Qt 4.x)<a class=anchor href=#qt4-components></a></h3><div class=paragraph><p>当把 <code>USE_QT_VER</code> 设为 4 时， 就可以通过 <code>QT_COMPONENTS</code> 变量来指定对 Qt4 工具和函数库的依赖了。 通过在组件的名称后面添加 <code>_build</code> 或 <code>_run</code> 这样的后缀， 则可相应地将这依赖关系限于联编或运行时刻。 在没有指定后缀时， 系统默认在联编和运行时刻均依赖该组件。 通常情况下在指明函数库一类的组件时应不使用后缀， 联编工具类组件应使用 <code>_build</code> 后缀， 而插件类组件， 则应使用 <code>_run</code> 后缀。 下表中列出了一些最常用的组件 (全部可用的组件， 则在 <span class=filename>/usr/ports/Mk/bsd.qt.mk</span> 中的 <code>_QT_COMPONENTS_ALL</code> 列出)：</p></div><table class="tableblock frame-none grid-all stretch"><caption class=title>表 9. 可用的 Qt4 函数库组件</caption><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">名字</th><th class="tableblock halign-left valign-top">描述</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>corelib</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>核心库 (在 port 只使用 <code>corelib</code> 而没有用到其他库时可以省略)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>gui</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>图形用户界面库</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>network</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>网络函数库</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>opengl</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>OpenGL 函数库</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>qt3support</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Qt3 兼容支持函数库</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>qtestlib</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>单元测试函数库</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>script</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>脚本函数库</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>sql</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>SQL 函数库</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>xml</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>XML 函数库</p></td></tr></tbody></table><div class=paragraph><p>您可以通过在成功编译之后， 通过在主可执行文件上运行 <code>ldd</code> 来确定所需的库。</p></div><table class="tableblock frame-none grid-all stretch"><caption class=title>表 10. 可用的 Qt4 工具组件</caption><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">名字</th><th class="tableblock halign-left valign-top">描述</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>moc</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>元对象编译器 (几乎所有的 Qt 应用程序在联编过程中都需要它)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>qmake</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Makefile 生成器 / 联编工具</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>rcc</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>资源编译器 (如果应用程序中包含 <span class=filename><strong>.rc</strong></span><strong> 或 <span class=filename></span></strong>.qrc 文件， 就需要它)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>uic</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>用户界面编译器 (如果应用程序中包含使用 Qt Designer 创建的 <span class=filename>*.ui</span> 文件时就需要它 - 一般说来 Qt 应用程序都会使用 GUI 的)</p></td></tr></tbody></table><table class="tableblock frame-none grid-all stretch"><caption class=title>表 11. 可用的 Qt4 插件组件</caption><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">名字</th><th class="tableblock halign-left valign-top">描述</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>iconengines</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>SVG 图标引擎插件 (如果应用程序使用 SVG 图标)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>imageformats</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>用于 GIF、 JPEG、 MNG 和 SVG 的 imageformat 插件 (如果应用程序使用图片文件)</p></td></tr></tbody></table><div id=qt4-components-example class=exampleblock><div class=title>例 3. 选择 Qt4 组件</div><div class=content><div class=paragraph><p>在这个例子中， 我们将要移植的应用程序用到了 Qt4 图形用户界面函数库、 Qt4 核心 (core) 函数库、 所有 Qt4 代码生成工具以及 Qt4 的 Makefile 生成器。 由于 gui 函数库会自动附带对核心函数库的依赖， 因此并不需要明确指出需要 corelib 的依赖关系。 Qt4 代码生成工具 moc、 uic 和 rcc 以及 Makefile 生成器 qmake 只在联编过程中才会用到， 因此可以指定 <code>_build</code> 后缀：</p></div><div class="literalblock programlisting"><div class=content><pre>USE_QT_VER=    4
QT_COMPONENTS= gui moc_build qmake_build rcc_build uic_build</pre></div></div></div></div></div><div class=sect2><h3 id=qt-additional>6.9.3. 其他考虑<a class=anchor href=#qt-additional></a></h3><div class=paragraph><p>如果应用程序没有提供 <span class=filename>configure</span> 文件， 而是给了一个 <span class=filename>.pro</span> 文件， 则应这样：</p></div><div class="literalblock programlisting"><div class=content><pre>HAS_CONFIGURE=	yes

do-configure:
        @cd ${WRKSRC} &amp;&amp; ${SETENV} ${CONFIGURE_ENV} \
                ${QMAKE} -unix PREFIX=${PREFIX} texmaker.pro</pre></div></div><div class=paragraph><p>请注意， 这与系统提供的 <span class=filename>BUILD.sh</span> 中的 <code>qmake</code> 类似。 传递 <code>CONFIGURE_ENV</code> 能够确保 <code>qmake</code> 可以看到 <code>QMAKESPEC</code> 变量， 否则它可能无法正常工作。 <code>qmake</code> 会生成标准的 Makefile， 因此无需自行编写 <code>build</code> target。</p></div><div class=paragraph><p>Qt 应用程序通常会编写为能够跨平台使用， 通常 X11/Unix 并不是开发它的平台， 有时这会导致一些边边角角的问题， 例如：</p></div><div class=ulist><ul><li><p><em>缺少必要的 includepaths。</em> 许多应用程序会使用托盘图标支持， 但忽略了这些头或库文件需要在 X11 目录中查找。 您可以通过命令行告诉 <code>qmake</code> 将这些头文件和函数库加入到搜索路径中， 例如：</p><div class="literalblock programlisting"><div class=content><pre>${QMAKE} -unix PREFIX=${PREFIX} INCLUDEPATH+=${LOCALBASE}/include \
	LIBS+=-L${LOCALBASE}/lib sillyapp.pro</pre></div></div></li><li><p><em>有问题的安装路径。</em> 有时， 类似图标或 .desktop 文件这样的一些数据， 默认情况下没有安装到 XDG-兼容的程序会扫描的路径中。 <a class=package href=https://cgit.freebsd.org/ports/tree/editors/texmaker/>editors/texmaker</a> 就是一个这样的例子 - 请参考这个 port 的 <span class=filename>files</span> 目录中的 <span class=filename>patch-texmaker.pro</span>， 以了解如何在 Qmake 工程文件中修正这个问题。</p></li></ul></div></div></div></div><div class=sect1><h2 id=using-kde>6.10. 使用 KDE<a class=anchor href=#using-kde></a></h2><div class=sectionbody><div class=sect2><h3 id=kde-variables>6.10.1. 变量定义 (只用于 KDE 3.x)<a class=anchor href=#kde-variables></a></h3><table class="tableblock frame-none grid-all stretch"><caption class=title>表 12. 用于使用 KDE 3.x 的 port 的变量</caption><col style=width:50%><col style=width:50%><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>USE_KDELIBS_VER</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>表示 port 用到了 KDE 库。 这个变量可以指定希望使用的 KDE 主版本号， 如果设置了这个变量， 则系统也会将 <code>USE_QT_VER</code> 设为适当的版本。 该变量目前唯一有效的值是 <code>3</code>。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>USE_KDEBASE_VER</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>表示 port 用到了 KDE 的基本系统。 这个变量可以指定希望使用的 KDE 主版本号， 如果设置了这个变量， 则系统也会将 <code>USE_QT_VER</code> 设为适当的版本。 该变量目前唯一有效的值是 <code>3</code>。</p></td></tr></tbody></table></div><div class=sect2><h3 id=kde4-variables>6.10.2. 用于 KDE 4 的变量定义<a class=anchor href=#kde4-variables></a></h3><div class=paragraph><p>如果您的应用程序需要使用 KDE 4.x， 则应将 <code>USE_KDE4</code> 设为所需组件的列表。 下面列出一些最常用到的组件 (最新的组件列表位于 <span class=filename>/usr/ports/Mk/bsd.kde4.mk</span> 中的 <code>_USE_KDE4_ALL</code>)：</p></div><table class="tableblock frame-none grid-all stretch"><caption class=title>表 13. 可用的 KDE4 组件</caption><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">名称</th><th class="tableblock halign-left valign-top">说明</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>akonadi</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>个人信息管理 (PIM)存储服务</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>automoc4</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>令 port 使用 automoc4 联编工具集</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>kdebase</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>基本的 KDE 应用程序 (Konqueror、 Dolphin、 Konsole)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>kdeexp</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>试验性的 KDE 库 (包含尚未完全确定不变的 API)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>kdehier</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>常用的 KDE 目录层次结构</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>kdelibs</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>基本 KDE 库</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>kdeprefix</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>如果设置了这个选项， 则 port 将安装到 <code>${KDE4_PREFIX}</code> 而不是 <code>${LOCALBASE}</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>pimlibs</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>PIM 函数库</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>workspace</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>用于组成桌面的应用程序和函数库 (Plasma、 KWin)</p></td></tr></tbody></table><div class=paragraph><p>KDE 4.x port 会安装到 <code>${KDE4_PREFIX}</code>， 目前是 <span class=filename>/usr/local/kde4</span>， 以避免与 KDE 3.x ports 冲突。 这是通过指定 <code>kdeprefix</code> 组件来实现的， 它表示替换默认的 <code>PREFIX</code>。 不过， port 仍会遵循通过 <code>MAKEFLAGS</code> 环境变量设置的 <code>PREFIX</code> 以及其它 make 参数。</p></div><div class=paragraph><p>KDE 4.x ports 有可能和 KDE 3.x ports 冲突， 因此如果启用了 <code>kdeprefix</code> 组件， 它们会安装到 <code>${KDE4_PREFIX}</code>。 目前 <code>KDE4_PREFIX</code> 的默认值是 <span class=filename>/usr/local/kde4</span>。 也可以将 KDE 4.x ports 安装到自定义的 <code>PREFIX</code>。 当 <code>PREFIX</code> 是通过 <code>MAKEFLAGS</code> 环境变量， 或直接在 make 命令行指定时， 它会替换 <code>kdeprefix</code> 提供的配置。</p></div><div id=kde4-components-example class=exampleblock><div class=title>例 4. <code>USE_KDE4</code> 示例</div><div class=content><div class=paragraph><p>下面是一个简单的 KDE 4 port。 <code>USE_CMAKE</code> 指定 port 使用 CMake - 许多 KDE 4 项目所使用的配置工具。 <code>USE_KDE4</code> 则引入 KDE 函数库， 并令 port 在联编阶段使用 automoc4。 需要的 KDE 组件， 以及其他依赖的组件可以从 configure 的日志中获知。 <code>USE_KDE4</code> 并不会自动设置 <code>USE_QT_VER</code>。 如果 port 需要使用某些 Qt4 组件， 则需要设置 <code>USE_QT_VER</code> 并指定所需要的组件。</p></div><div class="literalblock programlisting"><div class=content><pre>USE_CMAKE=     yes
USE_KDE4=      automoc4 kdelibs kdeprefix
USE_QT_VER=    4
QT_COMPONENTS= qmake_build moc_build rcc_build uic_build</pre></div></div></div></div></div></div></div><div class=sect1><h2 id=using-java>6.11. 使用 Java<a class=anchor href=#using-java></a></h2><div class=sectionbody><div class=sect2><h3 id=java-variables>6.11.1. 变量定义<a class=anchor href=#java-variables></a></h3><div class=paragraph><p>如果您的 port 需要 Java™ 开发包 (JDK™) 来完成联编、 支持运行， 甚至完成解开源代码包这样的工作， 就应该定义 <code>USE_JAVA</code>。</p></div><div class=paragraph><p>在 Ports Collection 中有许多不同的 JDK， 它们的版本各不相同， 或是来自不同的供应商。 如果您的 port 必须使用其中的某个特定的版本， 也可以予以定义。 最新的稳定版本是 <a class=package href=https://cgit.freebsd.org/ports/tree/java/jdk16/>java/jdk16</a>。</p></div><table class="tableblock frame-none grid-all stretch"><caption class=title>表 14. 用到 Java 的 port 可以使用的变量</caption><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">变量</th><th class="tableblock halign-left valign-top">意义</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>USE_JAVA</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>只有定义它才能使其它变量生效。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>JAVA_VERSION</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>用空格分开的适合 port 使用的 Java 版本。 可选的 <code>""` 可以用于指定某个范围的版本 (可以用： `1.5[] 1.6[] 1.7[]</code>)。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>JAVA_OS</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>用空格分开的适应 port 的 JDK port 操作系统类型 (可以用： <code>native linux</code>)。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>JAVA_VENDOR</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>用空格分开的适应 port 的 JDK port 供应商 (可以用： <code>freebsd bsdjava sun openjdk</code>)。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>JAVA_BUILD</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>设置这个变量表示所选的 JDK port 应被列入 port 的联编依赖关系。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>JAVA_RUN</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>设置这个变量表示所选的 JDK port 应被列入 port 的运行环境依赖关系。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>JAVA_EXTRACT</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>设置这个变量表示所选的 JDK port 应被列入 port 的解压缩支持依赖关系。</p></td></tr></tbody></table><div class=paragraph><p>下面是在设置了 <code>USE_JAVA</code> 之后， port 能够从系统中获得的配置：</p></div><table class="tableblock frame-none grid-all stretch"><caption class=title>表 15. 向使用了 Java 的 port 提供的变量</caption><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">变量</th><th class="tableblock halign-left valign-top">值</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>JAVA_PORT</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>JDK port 的名字 (例如 <code>'java/diablo-jdk16'</code>)。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>JAVA_PORT_VERSION</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>JDK port 的完整版本 (例如 <code>'1.6.0'</code>)。 如果您只需要版本号的前两位， 则可用 <code>${JAVA_PORT_VERSION:C/^([0-9])\.([0-9])(.*)$/\1.\2/}</code>。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>JAVA_PORT_OS</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>所用 JDK port 的操作系统 (例如 <code>'native'</code>)。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>JAVA_PORT_VENDOR</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>所用 JDK port 的供应商 (例如 <code>'freebsd'</code>)。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>JAVA_PORT_OS_DESCRIPTION</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>所用 JDK port 操作系统的描述 (例如 <code>'Native'</code>)。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>JAVA_PORT_VENDOR_DESCRIPTION</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>所用 JDK port 供应商的描述 (例如 <code>'FreeBSD Foundation'</code>)。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>JAVA_HOME</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>JDK 的安装目录 (例如 <span class=filename>'/usr/local/diablo-jdk1.6.0'</span>)。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>JAVAC</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>所用 Java 编译器的完整路径 (例如 <span class=filename>'/usr/local/diablo-jdk1.6.0/bin/javac'</span>)。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>JAR</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>所用 <code>jar</code> 工具的完整路径 (例如 <span class=filename>'/usr/local/diablo-jdk1.6.0/bin/jar'</span> 或 <span class=filename>'/usr/local/bin/fastjar'</span>)。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>APPLETVIEWER</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>所用 <code>appletviewer</code> 工具的完整路径 (例如 <span class=filename>'/usr/local/diablo-jdk1.6.0/bin/appletviewer'</span>)。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>JAVA</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>所用 <code>java</code> 执行文件的完整路径。 您应使用它来执行 Java 程序 (例如 <span class=filename>'/usr/local/diablo-jdk1.6.0/bin/java'</span>)。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>JAVADOC</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>所用 <code>javadoc</code> 工具的完整路径。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>JAVAH</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>所用 <code>javah</code> 程序的完整路径。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>JAVAP</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>所用 <code>javap</code> 程序的完整路径。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>JAVA_KEYTOOL</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>所用 <code>keytool</code> 工具的完整路径。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>JAVA_N2A</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>所用 <code>native2ascii</code> 工具的完整路径。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>JAVA_POLICYTOOL</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>所用 <code>policytool</code> 程序的完整路径。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>JAVA_SERIALVER</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>所用 <code>serialver</code> 程序的完整路径。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>RMIC</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>所用 RMI 桩/架 生成器， <code>rmic</code> 的完整路径。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>RMIREGISTRY</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>所用 RMI 注册表程序， <code>rmiregistry</code> 的完整路径。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>RMID</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>所用 RMI 服务程序 <code>rmid</code> 的完整路径。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>JAVA_CLASSES</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>所用 JDK 类文件目录的完整路径。 <span class=filename>${JAVA_HOME}/jre/lib/rt.jar</span>。</p></td></tr></tbody></table><div class=paragraph><p>您可以使用 <code>java-debug</code> make target 以获取用于调试 port 的信息。 大多数前述变量的值皆会予以呈现。</p></div><div class=paragraph><p>此外， 还会定义下述常量， 以确保所有的 Java port 均以一致之方式安装：</p></div><table class="tableblock frame-none grid-all stretch"><caption class=title>表 16. 为使用 Java 的 port 定义的常量</caption><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">常量</th><th class="tableblock halign-left valign-top">值</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>JAVASHAREDIR</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>所有 Java 相关资料的安装根目录。 默认值： <span class=filename>${PREFIX}/shared/java</span>.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>JAVAJARDIR</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>用以安装 JAR 文件的目录。 默认值： <span class=filename>${JAVASHAREDIR}/classes</span>。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>JAVALIBDIR</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>其它 port 安装的 JAR 文件所在的目录。 默认值： <span class=filename>${LOCALBASE}/shared/java/classes</span>。</p></td></tr></tbody></table><div class=paragraph><p>相关的项也会定义在 <code>PLIST_SUB</code> (在 <a href=../plist/#plist-sub>根据 <code>make</code> 变量对 pkg-plist 进行修改</a> 中进行介绍) 和 <code>SUB_LIST</code> 中。</p></div></div><div class=sect2><h3 id=java-building-with-ant>6.11.2. 采用 Ant 进行联编<a class=anchor href=#java-building-with-ant></a></h3><div class=paragraph><p>如果 port 采用 Apache Ant 进行联编， 则需要定义 <code>USE_ANT</code>。 如是， 则 Ant 将作为 子-make 命令来使用。 如果 port 未定义 <code>do-build</code> target， 则将默认依 <code>MAKE_ENV</code>、 <code>MAKE_ARGS</code> 和 <code>ALL_TARGET</code>。 的设置执行 Ant。 这类似于 <a href=#building>联编机制</a> 中介绍的关于 <code>USE_GMAKE</code> 的机制。</p></div></div><div class=sect2><h3 id=java-best-practices>6.11.3. 最佳实践<a class=anchor href=#java-best-practices></a></h3><div class=paragraph><p>如果您正移植某个 Java 库， 您的 port 应把 JAR 文件安装到 <span class=filename>${JAVAJARDIR}</span>， 而其它文件则应放在 <span class=filename>${JAVASHAREDIR}/${PORTNAME}</span> 下 (除了文档， 参见下文)。 要减少打包文件的尺寸， 您可以直接在 <span class=filename>Makefile</span> 中引用这些 JAR 文件， 具体做法是使用下面的语句 (此处的 <span class=filename>myport.jar</span> 是作为 port 一部分安装的 JAR 文件的名字)：</p></div><div class="literalblock programlisting"><div class=content><pre>PLIST_FILES+= %%JAVAJARDIR%%/myport.jar</pre></div></div><div class=paragraph><p>移植 Java 应用程序时， port 通常会希望将所有文件安装到同一目录 (包括其依赖的 JAR)。 这时强烈建议使用 <span class=filename>${JAVASHAREDIR}/${PORTNAME}</span>。 移植软件的开发人员， 可以自行决定是否将所依赖的其它 JAR 安装到此目录， 或直接使用已经装好的那些 (来自 <span class=filename>${JAVAJARDIR}</span>)。</p></div><div class=paragraph><p>无论您正制作哪一类的 port (库或者应用程序)， 附加的文档都应安装到和其它 port <a href=#install-documentation>同样的位置</a>。 已经知道， JavaDoc 会根据 JDK 版本的不同而产生不同的文件。 对于那些不打算强制使用某一特定版本 JDK 的 port 而言， 这无疑提高了制作装箱单 (<span class=filename>pkg-plist</span>) 的难度。 这是为什么强烈建议使用 <code>PORTDOCS</code> 宏的原因。 更进一步， 即使您能够预测 <code>javadoc</code> 将要生成的文件， 所需的 <span class=filename>pkg-plist</span> 的尺寸， 也是鼓吹使用 <code>PORTDOCS</code> 的一大理由。</p></div><div class=paragraph><p><code>DATADIR</code> 的默认值是 <span class=filename>${PREFIX}/shared/${PORTNAME}</span>。 对 Java port 而言将 <code>DATADIR</code> 改为 <span class=filename>${JAVASHAREDIR}/${PORTNAME}</span> 是一个好主意。 当然， <code>DATADIR</code> 会自动加到 <code>PLIST_SUB</code> 中 (在 <a href=../plist/#plist-sub>根据 <code>make</code> 变量对 pkg-plist 进行修改</a> 有所介绍) 因此您可以在 <span class=filename>pkg-plist</span> 中直接使用 <code>%%DATADIR%%</code>。</p></div><div class=paragraph><p>撰写本文时， 对是应该从源代码联编， 还是直接安装预编译的 Java ports 安装包并没有明确的规定。 尽管如此， <a href=http://www.freebsd.org/java/>FreeBSD Java Project</a> 的开发人员仍鼓励移植软件的开发者在不麻烦的情况下尽可能从源代码完成联编。</p></div><div class=paragraph><p>本节中所介绍的全部特性， 均是在 <span class=filename>bsd.java.mk</span> 中实现的。 如果您感觉自己的 port 需要更为复杂的 Java 支持， 请首先参阅 <a href=http://www.freebsd.org/cgi/cvsweb.cgi/ports/Mk/bsd.java.mk>bsd.java.mk CVS 日志</a>， 因为通常撰文介绍最新特性需要一些时间。 此外， 如果您认为所缺少的支持对许多其它 Java port 亦属有益， 请在 freebsd-java 对其进行讨论。</p></div><div class=paragraph><p>在 PR 中的 <code>java</code> 类别， 主要是用于 FreeBSD Java project 移植 JDK 本身之用。 因而， 提交您的 Java port 时， 应归入 <code>ports</code> 类别， 除非您正尝试解决的问题是 JDK 实现本身或 <span class=filename>bsd.java.mk</span> 的。</p></div><div class=paragraph><p>类似地， 您应参考 <a href=../makefile/#makefile-categories>分类</a> 中所详述的关于 <code>CATEGORIES</code> 在 Java port 中的使用规则。</p></div></div></div></div><div class=sect1><h2 id=using-php>6.12. Web 应用， Apache 和 PHP<a class=anchor href=#using-php></a></h2><div class=sectionbody><div class=sect2><h3 id=using-apache>6.12.1. Apache<a class=anchor href=#using-apache></a></h3><table class="tableblock frame-none grid-all stretch"><caption class=title>表 17. 用到 Apache 的 port 可以使用的变量</caption><col style=width:50%><col style=width:50%><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>USE_APACHE</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>此 port 需要 Apache。 可用的值： <code>yes</code> (任意可用版本)、 <code>1.3</code>、 <code>2.0</code>、 <code>2.2</code>、 <code>2.0+</code>、 等等。 默认依赖的版本是 <code>1.3</code>。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>WITH_APACHE2</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>此 port 需要 Apache 2.0。 如果没有这个变量， 则 port 将依赖 Apache 1.3。 这一变量目前已经过时， 因而不应继续使用。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>APXS</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>到 <code>apxs</code> 可执行文件的完整路径。 您可以在 port 中替代该值。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>HTTPD</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>到 <code>httpd</code> 可执行文件的完整路径。 您可以在 port 中替代该值。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>APACHE_VERSION</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>目前系统中安装的 Apache 版本 (只读变量)。 这一变量只有在引用了 <span class=filename>bsd.port.pre.mk</span> 之后才能使用， 其可能的值为： <code>13</code>、 <code>20</code>、 <code>22</code>。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>APACHEMODDIR</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Apache 模块所在的文件夹。 在 pkg-plist 中， 这一变量会自动展开。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>APACHEINCLUDEDIR</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Apache 头文件所在的文件夹。 在 pkg-plist 中， 这一变量会自动展开。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>APACHEETCDIR</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Apache 配置文件所在的文件夹。 在 pkg-plist 中， 这一变量会自动展开。</p></td></tr></tbody></table><table class="tableblock frame-none grid-all stretch"><caption class=title>表 18. 在移植 Apache 模块时比较有用的变量</caption><col style=width:50%><col style=width:50%><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>MODULENAME</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>模块的名称。 默认值为 <code>PORTNAME</code>。 例如： <code>mod_hello</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>SHORTMODNAME</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>模块的简略名字。 默认情况下会自动根据 <code>MODULENAME</code> 计算， 但您也可以自行设置值来替代它。 例如： <code>hello</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>AP_FAST_BUILD</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>使用 <code>apxs</code> 来编译和安装模块。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>AP_GENPLIST</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>同时自动创建 <span class=filename>pkg-plist</span>。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>AP_INC</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>在编译过程中， 将指定的目录加入到搜索头文件的目录中。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>AP_LIB</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>在编译过程中， 将指定的目录加入到搜索函数库的目录中。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>AP_EXTRAS</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>传递给 <code>apxs</code> 的额外参数。</p></td></tr></tbody></table></div><div class=sect2><h3 id=web-apps>6.12.2. Web 应用<a class=anchor href=#web-apps></a></h3><div class=paragraph><p>Web 应用程序应安装到 <span class=filename>PREFIX/www/应用程序的名字</span>。 为方便起见， 这个路径在 <span class=filename>Makefile</span> 和 <span class=filename>pkg-plist</span> 均以 <code>WWWDIR</code> 变量的形式提供。 在 <span class=filename>Makefile</span> 中可以使用 <code>WWWDIR_REL</code> 来表示包含了 <code>PREFIX</code> 的该变量值。</p></div><div class=paragraph><p>web 服务器进程所用的用户和用户组， 分别以 <code>WWWOWN</code> 和 <code>WWWGRP</code> 变量的形式提供， 如果您需要修改某些文件的属主的话。 这两个变量的默认值均为 <code>www</code>。 如果您的 port 希望使用其他值， 请使用 <code>WWWOWN?= myuser</code> 这种写法， 以便让用户能够更容易地修改它。</p></div><div class=paragraph><p>除非您的 port 必需使用 Apache， 否则不要将其写入依赖关系。 请尊重运行您的应用程序的用户选择 Apache 以外的其他 web 服务器的需求。</p></div></div><div class=sect2><h3 id=php-variables>6.12.3. PHP<a class=anchor href=#php-variables></a></h3><table class="tableblock frame-none grid-all stretch"><caption class=title>表 19. 用到 PHP 的 port 中可以使用的变量</caption><col style=width:50%><col style=width:50%><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>USE_PHP</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>此 port 需要 PHP。 取值为 <code>yes</code> 将把 PHP 加入依赖关系。 此外， 还可以在此指定将所需要的 PHP 扩展模块。 例如： <code>pcre xml gettext</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>DEFAULT_PHP_VER</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>选择在没有安装 PHP 时自动安装的 PHP 主版本。 默认是 <code>4</code>。 可选 <code>4</code>、 <code>5</code> 之一。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>IGNORE_WITH_PHP</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>此 port 无法与给定版本的 PHP 一同工作。 可选值为 <code>4</code>、 <code>5</code> 之一。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>USE_PHPIZE</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>此 port 将作为 PHP 扩展模块进行联编。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>USE_PHPEXT</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>此 port 将作为 PHP 扩展， 且需要作为扩展模块注册。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>USE_PHP_BUILD</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>联编依赖于 PHP。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>WANT_PHP_CLI</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>希望使用 CLI (命令行) 版本的 PHP。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>WANT_PHP_CGI</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>希望使用 CGI 版本的 PHP。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>WANT_PHP_MOD</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>希望使用 Apache 模块版本的 PHP。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>WANT_PHP_SCR</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>希望使用 CLI 或 CGI 版本的 PHP。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>WANT_PHP_WEB</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>希望使用 Apache 模块或 CGI 版本的 PHP。</p></td></tr></tbody></table></div><div class=sect2><h3 id=_pear_模块>6.12.4. PEAR 模块<a class=anchor href=#_pear_模块></a></h3><div class=paragraph><p>移植 PEAR 模块的过程非常简单。</p></div><div class=paragraph><p>使用 <code>FILES</code>、 <code>TESTS</code>、 <code>DATA</code>、 <code>SQLS</code>、 <code>SCRIPTFILES</code>、 <code>DOCS</code> 以及 <code>EXAMPLES</code> 这些变量来指明您希望安装的文件。 所有这里列出的文件都会自动安装到合适的位置， 并加入 <span class=filename>pkg-plist</span>。</p></div><div class=paragraph><p>在 <span class=filename>Makefile</span> 文件的最后一行引入 <span class=filename>${PORTSDIR}/devel/pear/bsd.pear.mk</span>。</p></div><div id=pear-makefile class=exampleblock><div class=title>例 5. 用于 PEAR 类的 Makefile 例子</div><div class=content><div class="literalblock programlisting"><div class=content><pre>PORTNAME=       Date
PORTVERSION=    1.4.3
CATEGORIES=     devel www pear

MAINTAINER=     example@domain.com
COMMENT=        PEAR Date and Time Zone Classes

BUILD_DEPENDS=  ${PEARDIR}/PEAR.php:${PORTSDIR}/devel/pear-PEAR
RUN_DEPENDS=    ${BUILD_DEPENDS}

FILES=          Date.php Date/Calc.php Date/Human.php Date/Span.php     \
                Date/TimeZone.php
TESTS=          test_calc.php test_date_methods_span.php testunit.php   \
                testunit_date.php testunit_date_span.php wknotest.txt   \
                bug674.php bug727_1.php bug727_2.php bug727_3.php       \
                bug727_4.php bug967.php weeksinmonth_4_monday.txt       \
                weeksinmonth_4_sunday.txt weeksinmonth_rdm_monday.txt   \
                weeksinmonth_rdm_sunday.txt
DOCS=           TODO
_DOCSDIR=       .

.include &lt;bsd.port.pre.mk&gt;
.include &#34;${PORTSDIR}/devel/pear/bsd.pear.mk&#34;
.include &lt;bsd.port.post.mk&gt;</pre></div></div></div></div></div></div></div><div class=sect1><h2 id=using-python>6.13. 使用 Python<a class=anchor href=#using-python></a></h2><div class=sectionbody><div class=paragraph><p>Ports 套件支持同时并行安装多个不同的 Python 版本。 Ports 应确保能够根据用户配置的 <code>PYTHON_VERSION</code> 变量使用正确的 <code>python</code> 解释器。 一般说来， 这是通过将脚本中的 <code>python</code> 路径名替换为 <code>PYTHON_CMD</code> 变量的值来实现的。</p></div><div class=paragraph><p>在 <code>PYTHON_SITELIBDIR</code> 下安装文件的 ports 应在包名上使用 <code>pyXY-</code> 前缀， 以便明示它们将会配合哪个 Python 版本使用。</p></div><div class="literalblock programlisting"><div class=content><pre>PKGNAMEPREFIX= ${PYTHON_PKGNAMEPREFIX}</pre></div></div><table class="tableblock frame-none grid-all stretch"><caption class=title>表 20. 对用到 Python 的 port 最有用的一些变量</caption><col style=width:50%><col style=width:50%><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>USE_PYTHON</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>此 port 需要 Python。 可以用 <code>2.3+</code> 这样的形式来指定所希望的版本。 除此之外， 也可以用横线来分隔两个版本号， 以表示某个范围的版本， 例如： <code>2.1-2.3</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>USE_PYDISTUTILS</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>使用 Python distutils 来完成配置、 编译和安装。 对包含 <span class=filename>setup.py</span> 的 port 而言这是必需的。 它会自动覆盖默认的 <code>do-build</code> 以及 <code>do-install</code> 这两个 target。 如未定义 <code>GNU_CONFIGURE</code>， 它还会改变 <code>do-configure</code>。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>PYTHON_PKGNAMEPREFIX</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>作为 <code>PKGNAMEPREFIX</code> 来区分不同 Python 版本的 package。 例如： <code>py24-</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>PYTHON_SITELIBDIR</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>全站 package 所在的目录， 它包括了 Python 的安装目录 (通常是 <code>LOCALBASE</code>)。 在安装 Python 模块时， <code>PYTHON_SITELIBDIR</code> 变量会非常有用。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>PYTHONPREFIX_SITELIBDIR</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>去掉了 PREFIX 部分的 PYTHON_SITELIBDIR。 应尽可能在 <span class=filename>pkg-plist</span> 中使用 <code>%%PYTHON_SITELIBDIR%%</code>。 <code>%%PYTHON_SITELIBDIR%%</code> 的默认值是 <code>lib/python%%PYTHON_VERSION%%/site-packages</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>PYTHON_CMD</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Python 解释器的命令行， 包括版本号。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>PYNUMERIC</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>将数值处理扩展模块加入依赖关系。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>PYNUMPY</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>对新增的数值计算扩展, numpy的依赖。 (PYNUMERIC 目前已被作者淘汰)。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>PYXML</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>将 XML 扩展模块加入依赖关系。 (对于 Python 2.0 和更高版本不再需要， 因为它已经成为了标准组件)。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>USE_TWISTED</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>将 twistedCore 加入依赖关系。 也可以用这个变量指定所需的组件， 例如： <code>web lore pair flow</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>USE_ZOPE</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>加入对 Zope， 一种 web 应用平台的依赖。 这会把 Python 依赖改为 Python 2.3。 此外 <code>ZOPEBASEDIR</code> 也会自动设为 Zope 安装目录的位置。</p></td></tr></tbody></table><div class=paragraph><p>完整的可用变量列表， 可以在 <span class=filename>/usr/ports/Mk/bsd.python.mk</span> 中找到。</p></div></div></div><div class=sect1><h2 id=using-tcl>6.14. 使用 Tcl/Tk<a class=anchor href=#using-tcl></a></h2><div class=sectionbody><div class=paragraph><p>Ports 套件支持同时安装多个 Tcl/Tk 版本。 Ports 应至少支持默认的 Tcl/Tk 版本， 以及通过 <code>USE_TCL</code> 和 <code>USE_TK</code> 变量指定的更高版本。 希望使用的 <code>tcl</code> 版本， 则可以通过 <code>WITH_TCL_VER</code> 变量来使用。</p></div><table class="tableblock frame-none grid-all stretch"><caption class=title>表 21. 用到 Tcl/Tk 的 port 可以使用的变量</caption><col style=width:50%><col style=width:50%><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>USE_TCL</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>表示 port 依赖于 Tcl 函数库 (不是 shell)。 可以指定需要的最低版本， 例如 84+。 不支持的版本， 可以在 <code>INVALID_TCL_VER</code> 变量中逐个指定。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>USE_TCL_BUILD</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>表示 port 在联编过程中需要使用 Tcl。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>USE_TCL_WRAPPER</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>需要使用 Tcl shell 而不需要特定版本的 <code>tclsh</code> 的 port 可以使用这个新变量。 系统中会安装 <code>tclsh</code> wrapper， 用户则可以指定所希望的 <code>tcl</code> shell。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>WITH_TCL_VER</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>由用户定义的、 希望使用的 Tcl 版本。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>UNIQUENAME_WITH_TCL_VER</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>和 <code>WITH_TCL_VER</code> 类似， 但是针对 port 指定的。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>USE_TCL_THREADS</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>需要包含线程支持的 Tcl/Tk。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>USE_TK</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>表示 port 依赖于 Tk 库 (不是 wish shell)。 它同时会隐含将 <code>USE_TCL</code> 设置为相同的值。 更多的描述， 请参考 <code>USE_TCL</code> 变量。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>USE_TK_BUILD</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>与 <code>USE_TCL_BUILD</code> 变量表达类似的含义。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>USE_TK_WRAPPER</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>与 <code>USE_TCL_WRAPPER</code> 变量表达类似的含义。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>WITH_TK_VER</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>表达与 <code>WITH_TCL_VER</code> 变量类似的含义， 它同时会隐含将 <code>WITH_TCL_VER</code> 设置为相同的值。</p></td></tr></tbody></table><div class=paragraph><p>可用的变量的完整列表， 可以在 <span class=filename>/usr/ports/Mk/bsd.tcl.mk</span> 中找到。</p></div></div></div><div class=sect1><h2 id=using-emacs>6.15. 使用 Emacs<a class=anchor href=#using-emacs></a></h2><div class=sectionbody><div class=paragraph><p>本节尚有待撰写。</p></div></div></div><div class=sect1><h2 id=using-ruby>6.16. 使用 Ruby<a class=anchor href=#using-ruby></a></h2><div class=sectionbody><table class="tableblock frame-none grid-all stretch"><caption class=title>表 22. 使用 Ruby 的 port 可以使用的变量</caption><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">变量</th><th class="tableblock halign-left valign-top">说明</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>USE_RUBY</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>此 port 需要 Ruby。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>USE_RUBY_EXTCONF</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>此 port 使用 <span class=filename>extconf.rb</span> 来完成配置。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>USE_RUBY_SETUP</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>此 port 使用 <span class=filename>setup.rb</span> 来完成配置。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>RUBY_SETUP</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>将此变量名设置为所用的 <span class=filename>setup.rb</span> 的文件名。 通常会是 <span class=filename>install.rb</span>。</p></td></tr></tbody></table><div class=paragraph><p>下表展示了 ports 系统提供给 port 作者的一些变量。 您应使用这些变量， 以便把文件装到合适的位置。 请尽可能多地在 <span class=filename>pkg-plist</span> 中使用它们。 这些变量不应在 port 中重新定义。</p></div><table class="tableblock frame-none grid-all stretch"><caption class=title>表 23. 使用 Ruby 的 port 中的一些可用的只读变量</caption><col style=width:33.3333%><col style=width:33.3333%><col style=width:33.3334%><thead><tr><th class="tableblock halign-left valign-top">变量</th><th class="tableblock halign-left valign-top">说明</th><th class="tableblock halign-left valign-top">示范值</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>RUBY_PKGNAMEPREFIX</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>作为 <code>PKGNAMEPREFIX</code> 以区分用于不同 Ruby 版本的 package。</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>ruby18-</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>RUBY_VERSION</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>x.y.z</code> 形式的完整 ruby 版本。</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>1.8.2</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>RUBY_SITELIBDIR</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>平台无关库的安装路径。</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>/usr/local/lib/ruby/site_ruby/1.8</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>RUBY_SITEARCHLIBDIR</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>平台相关的库的安装路径。</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>/usr/local/lib/ruby/site_ruby/1.8/amd64-freebsd6</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>RUBY_MODDOCDIR</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>模块文档的安装路径。</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>/usr/local/shared/doc/ruby18/patsy</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>RUBY_MODEXAMPLESDIR</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>模块用例的安装路径。</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>/usr/local/shared/examples/ruby18/patsy</code></p></td></tr></tbody></table><div class=paragraph><p>可用变量的完整列表， 可以在 <span class=filename>/usr/ports/Mk/bsd.ruby.mk</span> 中找到。</p></div></div></div><div class=sect1><h2 id=using-sdl>6.17. 使用 SDL<a class=anchor href=#using-sdl></a></h2><div class=sectionbody><div class=paragraph><p>变量 <code>USE_SDL</code> 可以用于自动配置 port 的依赖关系， 以适应使用类似 <a class=package href=https://cgit.freebsd.org/ports/tree/devel/sdl12/>devel/sdl12</a> 和 <a class=package href=https://cgit.freebsd.org/ports/tree/x11-toolkits/sdl_gui/>x11-toolkits/sdl_gui</a> 这些依赖 SDL 的库的情形。</p></div><div class=paragraph><p>目前系统能够识别下列 SDL 库：</p></div><div class=ulist><ul><li><p>sdl: <a class=package href=https://cgit.freebsd.org/ports/tree/devel/sdl12/>devel/sdl12</a></p></li><li><p>gfx: <a class=package href=https://cgit.freebsd.org/ports/tree/graphics/sdl_gfx/>graphics/sdl_gfx</a></p></li><li><p>gui: <a class=package href=https://cgit.freebsd.org/ports/tree/x11-toolkits/sdl_gui/>x11-toolkits/sdl_gui</a></p></li><li><p>image: <a class=package href=https://cgit.freebsd.org/ports/tree/graphics/sdl_image/>graphics/sdl_image</a></p></li><li><p>ldbad: <a class=package href=https://cgit.freebsd.org/ports/tree/devel/sdl_ldbad/>devel/sdl_ldbad</a></p></li><li><p>mixer: <a class=package href=https://cgit.freebsd.org/ports/tree/audio/sdl_mixer/>audio/sdl_mixer</a></p></li><li><p>mm: <a class=package href=https://cgit.freebsd.org/ports/tree/devel/sdlmm/>devel/sdlmm</a></p></li><li><p>net: <a class=package href=https://cgit.freebsd.org/ports/tree/net/sdl_net/>net/sdl_net</a></p></li><li><p>sound: <a class=package href=https://cgit.freebsd.org/ports/tree/audio/sdl_sound/>audio/sdl_sound</a></p></li><li><p>ttf: <a class=package href=https://cgit.freebsd.org/ports/tree/graphics/sdl_ttf/>graphics/sdl_ttf</a></p></li></ul></div><div class=paragraph><p>因此， 如果 port 需要依赖 <a class=package href=https://cgit.freebsd.org/ports/tree/net/sdl_net/>net/sdl_net</a> 和 <a class=package href=https://cgit.freebsd.org/ports/tree/audio/sdl_mixer/>audio/sdl_mixer</a>， 则对应的写法将是：</p></div><div class="literalblock programlisting"><div class=content><pre>USE_SDL=        net mixer</pre></div></div><div class=paragraph><p>同时， <a class=package href=https://cgit.freebsd.org/ports/tree/net/sdl_net/>net/sdl_net</a> 和 <a class=package href=https://cgit.freebsd.org/ports/tree/audio/sdl_mixer/>audio/sdl_mixer</a> 所依赖的 <a class=package href=https://cgit.freebsd.org/ports/tree/devel/sdl12/>devel/sdl12</a> 也会被自动地加入。</p></div><div class=paragraph><p>加入您使用 <code>USE_SDL</code>， 它将自动地：</p></div><div class=ulist><ul><li><p>将对于 sdl12-config 的依赖关系加入到 <code>BUILD_DEPENDS</code></p></li><li><p>将变量 <code>SDL_CONFIG</code> 加入到 <code>CONFIGURE_ENV</code></p></li><li><p>将对所选的库的依赖， 加入到 <code>LIB_DEPENDS</code></p></li></ul></div><div class=paragraph><p>要检查某个特定的 SDL 库是否可用， 可以通过 <code>WANT_SDL</code> 变量来达到目的：</p></div><div class="literalblock programlisting"><div class=content><pre>WANT_SDL=yes

.include &lt;bsd.port.pre.mk&gt;

.if ${HAVE_SDL:Mmixer}!=&#34;&#34;
USE_SDL+=   mixer
.endif

.include &lt;bsd.port.post.mk&gt;</pre></div></div></div></div><div class=sect1><h2 id=using-wx>6.18. 使用 wxWidgets<a class=anchor href=#using-wx></a></h2><div class=sectionbody><div class=paragraph><p>这一节介绍了在 ports tree 中的 wxWidgets 库的现状， 以及它与 ports 系统的集成。</p></div><div class=sect2><h3 id=wx-introduction>6.18.1. 介绍<a class=anchor href=#wx-introduction></a></h3><div class=paragraph><p>许多不同版本的 wxWidgets 库之间是存在相互冲突的 (它们会安装同名的文件) 在 ports 系统中， 这一问题是通过将不同的版本以包含版本号后缀的名字安装来解决的。</p></div><div class=paragraph><p>这样做的一个最明显的缺点是， 应用程序必须进行修改， 才能找到所希望的版本。 幸运的是， 多数应用程序会调用 <code>wx-config</code> 脚本来确定需要的编译器和连接器选项。 这个脚本会随可用的版本不同而有不同的名字。 主要的应用程序都会尊重环境变量的配置， 或提供一个 configure 参数， 用以指定调用哪个 <code>wx-config</code>。 如果不是这样的话， 就需要对应用程序打补丁了。</p></div></div><div class=sect2><h3 id=wx-version>6.18.2. 版本的选择<a class=anchor href=#wx-version></a></h3><div class=paragraph><p>为了让您的 port 使用指定版本的 wxWidgets， 可以定义两个变量 (如果只定义了一个， 则另一个会取默认值)：</p></div><table id=wx-ver-sel-table class="tableblock frame-none grid-all stretch"><caption class=title>表 24. 用于选择 wxWidgets 版本的变量</caption><col style=width:33.3333%><col style=width:33.3333%><col style=width:33.3334%><thead><tr><th class="tableblock halign-left valign-top">变量</th><th class="tableblock halign-left valign-top">说明</th><th class="tableblock halign-left valign-top">默认值</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>USE_WX</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>列出这个 port 能使用的版本</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>全部版本</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>USE_WX_NOT</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>列出这个 port 不能使用的版本</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>无</p></td></tr></tbody></table><div class=paragraph><p>下面是可用的 wxWidgets 版本， 以及对应的 ports：</p></div><table class="tableblock frame-none grid-all stretch"><caption class=title>表 25. 可用的 wxWidgets versions</caption><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">版本</th><th class="tableblock halign-left valign-top">Port</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>2.4</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><a class=package href=https://cgit.freebsd.org/ports/tree/x11-toolkits/wxgtk24/>x11-toolkits/wxgtk24</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>2.6</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><a class=package href=https://cgit.freebsd.org/ports/tree/x11-toolkits/wxgtk26/>x11-toolkits/wxgtk26</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>2.8</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><a class=package href=https://cgit.freebsd.org/ports/tree/x11-toolkits/wxgtk28/>x11-toolkits/wxgtk28</a></p></td></tr></tbody></table><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>从 <code>2.5</code> 版开始， 也提供了对应的 Unicode 版本， 这种版本可以通过 slave port 安装， 与普通版本相比， 它会多一个 <code>-unicode</code> 后缀， 不过这可以通过使用变量来处理 (请参见 <a href=#wx-unicode>Unicode</a>)。</p></div></td></tr></tbody></table></div><div class=paragraph><p>在 <a href=#wx-ver-sel-table>用于选择 wxWidgets 版本的变量</a> 中的变量， 可以设为下列值或由空格分隔的组合：</p></div><table class="tableblock frame-none grid-all stretch"><caption class=title>表 26. wxWidgets 版本</caption><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">说明</th><th class="tableblock halign-left valign-top">例子</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock>单个版本</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>2.4</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>某版本以上版本</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>2.4+</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>某版本以下版本</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>2.6-</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>某段版本 (版本号较小的必须在前)</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>2.4-2.6</code></p></td></tr></tbody></table><div class=paragraph><p>除此之外， 还有一些用以从可用的本那本中选择所希望的版本的变量。 这种变量也可以设为一组版本， 而靠前的版本的优先级更高。</p></div><table class="tableblock frame-none grid-all stretch"><caption class=title>表 27. 用于选择希望的版本的 wxWidgets versions</caption><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">变量名</th><th class="tableblock halign-left valign-top">用于</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>WANT_WX_VER</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>port</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>WITH_WX_VER</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>用户</p></td></tr></tbody></table></div><div class=sect2><h3 id=wx-components>6.18.3. 选择组件<a class=anchor href=#wx-components></a></h3><div class=paragraph><p>也有一些其他应用， 尽管它们本身并不是 wxWidgets 库， 但却与之相关。 这些应用程序可以在 <code>WX_COMPS</code> 变量中使用， 以下是可用的组件：</p></div><table class="tableblock frame-none grid-all stretch"><caption class=title>表 28. 可用的 wxWidgets 组件</caption><col style=width:33.3333%><col style=width:33.3333%><col style=width:33.3334%><thead><tr><th class="tableblock halign-left valign-top">名称</th><th class="tableblock halign-left valign-top">说明</th><th class="tableblock halign-left valign-top">版本限制</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>wx</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>主库</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>无</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>contrib</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>第三方库</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>无</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>python</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>wxPython (Python 绑定)</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>2.4-2.6</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>mozilla</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>wxMozilla</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>2.4</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>svg</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>wxSVG</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>2.6</code></p></td></tr></tbody></table><div class=paragraph><p>您可以为每个依赖的组件， 通过冒号分隔的后缀指定其类型。 如果没有指定， 则会使用默认的依赖类型 (参见 <a href=#wx-def-dep-types>默认的 wxWidgets 依赖关系类型</a>)。 下面是可用的类型：</p></div><table class="tableblock frame-none grid-all stretch"><caption class=title>表 29. 可用的 wxWidgets 依赖类型</caption><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">名称</th><th class="tableblock halign-left valign-top">说明</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>build</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>联编时需要该组件， 相当于 <code>BUILD_DEPENDS</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>run</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>运行时需要该组件， 相当于 <code>RUN_DEPENDS</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>lib</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>联编和运行时均需要该组件， 相当于 <code>LIB_DEPENDS</code></p></td></tr></tbody></table><div class=paragraph><p>组件的默认依赖关系类型， 如下表所示：</p></div><table id=wx-def-dep-types class="tableblock frame-none grid-all stretch"><caption class=title>表 30. 默认的 wxWidgets 依赖关系类型</caption><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">组件</th><th class="tableblock halign-left valign-top">依赖关系类型</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>wx</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>lib</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>contrib</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>lib</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>python</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>run</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>mozilla</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>lib</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>svg</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>lib</code></p></td></tr></tbody></table><div id=wx-components-example class=exampleblock><div class=title>例 6. 选择 wxWidgets 组件</div><div class=content><div class=paragraph><p>下面的片段展示了使用 wxWidgets 版本 <code>2.4</code> 及第三方库的方法。</p></div><div class="literalblock programlisting"><div class=content><pre>USE_WX=       2.4
WX_COMPS=     wx contrib</pre></div></div></div></div></div><div class=sect2><h3 id=wx-unicode>6.18.4. Unicode<a class=anchor href=#wx-unicode></a></h3><div class=paragraph><p>wxWidgets 库从其 <code>2.5</code> 版开始支持 Unicode 了。 在 ports 系统中， 这两种版本均有提供， 并可以通过下列变量来选择：</p></div><table id=wx-unicode-var-table class="tableblock frame-none grid-all stretch"><caption class=title>表 31. 用以在 Unicode 版本的 wxWidgets 的变量</caption><col style=width:33.3333%><col style=width:33.3333%><col style=width:33.3334%><thead><tr><th class="tableblock halign-left valign-top">变量</th><th class="tableblock halign-left valign-top">说明</th><th class="tableblock halign-left valign-top">作用</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>WX_UNICODE</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>该 port <em>只能</em> 配合 Unicode 版本使用</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>port</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>WANT_UNICODE</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>port 能够与两种版本配合使用， 但希望使用 Unicode 版本</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>port</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>WITH_UNICODE</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>令 port 使用 Unicode 版本</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>用户</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>WITHOUT_UNICODE</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>令 port 使用普通版本， 如果支持的话 (即未定义 <code>WX_UNICODE</code>)</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>用户</p></td></tr></tbody></table><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>如果 port 同时支持 Unicode 和普通版本， 请不要使用 <code>WX_UNICODE</code>。 如果希望默认启用 Unicode， 应定义 <code>WANT_UNICODE</code>。</p></div></td></tr></tbody></table></div></div><div class=sect2><h3 id=wx-version-detection>6.18.5. 检测已安装的版本<a class=anchor href=#wx-version-detection></a></h3><div class=paragraph><p>要检测系统中安装的版本， 就需要定义 <code>WANT_WX</code>。 如果没有将其设置为特定的版本， 则组件将包含版本后缀。 <code>HAVE_WX</code> 变量在检测完成后会自动填入内容。</p></div><div id=wx-ver-det-example class=exampleblock><div class=title>例 7. 检测已安装的 wxWidgets 版本和组件</div><div class=content><div class=paragraph><p>下面的片段可以在安装 wxWidgets 的系统中令 port 使用它， 反之则作为一项选项提供。</p></div><div class="literalblock programlisting"><div class=content><pre>WANT_WX=        yes

.include &lt;bsd.port.pre.mk&gt;

.if defined(WITH_WX) || ${HAVE_WX:Mwx-2.4} != &#34;&#34;
USE_WX=         2.4
CONFIGURE_ARGS+=--enable-wx
.endif</pre></div></div><div class=paragraph><p>下面的片段在系统中有安装过时启用 wxPython 支持， 或在没有安装时作为选项提供； 对 wxWidgets 也是如此办理， 版本皆为 <code>2.6</code>。</p></div><div class="literalblock programlisting"><div class=content><pre>USE_WX=         2.6
WX_COMPS=       wx
WANT_WX=        2.6

.include &lt;bsd.port.pre.mk&gt;

.if defined(WITH_WXPYTHON) || ${HAVE_WX:Mpython} != &#34;&#34;
WX_COMPS+=      python
CONFIGURE_ARGS+=--enable-wxpython
.endif</pre></div></div></div></div></div><div class=sect2><h3 id=wx-defined-variables>6.18.6. 定义的变量<a class=anchor href=#wx-defined-variables></a></h3><div class=paragraph><p>以下是一些可以在 port 中使用的变量 (这之前需要定义 <a href=#wx-ver-sel-table>用于选择 wxWidgets 版本的变量</a> 中的至少一个变量)。</p></div><table class="tableblock frame-none grid-all stretch"><caption class=title>表 32. 为使用 wxWidgets 的 port 定义的变量</caption><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">变量名</th><th class="tableblock halign-left valign-top">说明</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>WX_CONFIG</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>到 wxWidgets <code>wx-config</code> 脚本的路径 (名字会随版本不同而不同)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>WXRC_CMD</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>到 wxWidgets <code>wxrc</code> 程序的路径 (名字会随版本不同而不同)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>WX_VERSION</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>将要用到的 wxWidgets 版本 (例如， <code>2.6</code>)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>WX_UNICODE</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>如果没有定义， 而将会使用 Unicode 时， 系统将自动定义此变量。</p></td></tr></tbody></table></div><div class=sect2><h3 id=wx-premk>6.18.7. 在 <span class=filename>bsd.port.pre.mk</span> 中进行处理<a class=anchor href=#wx-premk></a></h3><div class=paragraph><p>如果您需要在引用了 <span class=filename>bsd.port.pre.mk</span> 之后立即对一些变量进行处理， 则需要定义 <code>WX_PREMK</code>。</p></div><div class="admonitionblock important"><table><tbody><tr><td class=icon><i class="fa icon-important" title=Important></i></td><td class=content><div class=paragraph><p>如果定义了 <code>WX_PREMK</code>， 则在此 <em>之后</em> 定义的依赖关系、 组件和变量将不会生效， 您在引用 <span class=filename>bsd.port.pre.mk</span> 之前的 wxWidgets port 变量将直接起作用。</p></div></td></tr></tbody></table></div><div id=wx-premk-example class=exampleblock><div class=title>例 8. 在命令中使用 wxWidgets 变量</div><div class=content><div class=paragraph><p>下面的片段以执行 <code>wx-config</code> 脚本来得到完整的版本号， 将其赋值到变量中， 并传递给一个程序举例说明了 <code>WX_PREMK</code> 的用法。</p></div><div class="literalblock programlisting"><div class=content><pre>USE_WX=         2.4
WX_PREMK=       yes

.include &lt;bsd.port.pre.mk&gt;

.if exists(${WX_CONFIG})
VER_STR!=       ${WX_CONFIG} --release

PLIST_SUB+=     VERSION=&#34;${VER_STR}&#34;
.endif</pre></div></div></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>在 target 中的 wxWidgets 变量可以直接使用， 而无需 <code>WX_PREMK</code> 的参与。</p></div></td></tr></tbody></table></div></div><div class=sect2><h3 id=wx-additional-config-args>6.18.8. 额外的 <code>configure</code> 参数<a class=anchor href=#wx-additional-config-args></a></h3><div class=paragraph><p>某些 GNU <code>configure</code> 脚本在只设置了 <code>WX_CONFIG</code> 环境变量时， 无法自动找到 wxWidgets， 而需要使用额外的参数来加以指定。 您可以使用 <code>WX_CONF_ARGS</code> 变量来给出这些参数。</p></div><table class="tableblock frame-none grid-all stretch"><caption class=title>表 33. 可用于 <code>WX_CONF_ARGS</code> 的值</caption><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">可用值</th><th class="tableblock halign-left valign-top">结果</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>absolute</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>--with-wx-config=${WX_CONFIG}</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>relative</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>--with-wx=${LOCALBASE} --with-wx-config=${WX_CONFIG:T}</code></p></td></tr></tbody></table></div></div></div><div class=sect1><h2 id=using-lua>6.19. 使用 Lua<a class=anchor href=#using-lua></a></h2><div class=sectionbody><div class=paragraph><p>这一节描述了在 ports 系统中的 Lua 库的现状， 以及它与 ports 系统的集成。</p></div><div class=sect2><h3 id=lua-introduction>6.19.1. 介绍<a class=anchor href=#lua-introduction></a></h3><div class=paragraph><p>许多不同版本的 Lua 库和相关的解释器之间是相互冲突的 (它们会安装同名的文件)。 在 ports 系统中， 这一问题是通过将不同版本的文件以不同的版本号作为后缀名解决的。</p></div><div class=paragraph><p>这样做最大的一个问题是， 每个程序都需要进行修改才能找到它所需要的版本。 不过， 通过将适当的参数传给编译器和连接器很容易解决这个问题。</p></div></div><div class=sect2><h3 id=lua-version>6.19.2. 选择版本<a class=anchor href=#lua-version></a></h3><div class=paragraph><p>要让您的 port 使用指定版本的 Lua， 可以定义两个变量的值 (如果只定义了其中的一个， 则另一个会使用默认值)：</p></div><table id=lua-ver-sel-table class="tableblock frame-none grid-all stretch"><caption class=title>表 34. 用于选择 Lua 版本的变量</caption><col style=width:33.3333%><col style=width:33.3333%><col style=width:33.3334%><thead><tr><th class="tableblock halign-left valign-top">变量</th><th class="tableblock halign-left valign-top">说明</th><th class="tableblock halign-left valign-top">默认值</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>USE_LUA</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>port 能够使用的 Lua 版本列表</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>全部可用版本</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>USE_LUA_NOT</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>与 port 不兼容的版本列表</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>无</p></td></tr></tbody></table><div class=paragraph><p>下面是目前 ports 系统提供的可用 Lua 版本和对应的目录：</p></div><table class="tableblock frame-none grid-all stretch"><caption class=title>表 35. 可用的 Lua 版本</caption><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">版本</th><th class="tableblock halign-left valign-top">Port</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>4.0</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><a class=package href=https://cgit.freebsd.org/ports/tree/lang/lua4/>lang/lua4</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>5.0</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><a class=package href=https://cgit.freebsd.org/ports/tree/lang/lua50/>lang/lua50</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>5.1</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><a class=package href=https://cgit.freebsd.org/ports/tree/lang/lua/>lang/lua</a></p></td></tr></tbody></table><div class=paragraph><p>在 <a href=#lua-ver-sel-table>用于选择 Lua 版本的变量</a> 中的变量， 可以设置为下面的版本之一， 或用空格分隔的若干版本：</p></div><table class="tableblock frame-none grid-all stretch"><caption class=title>表 36. 指定 Lua 版本</caption><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">说明</th><th class="tableblock halign-left valign-top">例子</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock>一个版本</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>4.0</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>某个版本或更高版本</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>5.0+</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>不高于某个版本</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>5.0-</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>版本范围 (低版本必须在前)</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>5.0-5.1</code></p></td></tr></tbody></table><div class=paragraph><p>除此之外， 也有一些用来从可用版本中选择推荐版本的其它变量。 这些变量也可以设置为一组版本， 而前面的版本优先级较高。</p></div><table class="tableblock frame-none grid-all stretch"><caption class=title>表 37. 用于选择推荐 Lua 版本的变量</caption><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">变量名</th><th class="tableblock halign-left valign-top">用于</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>WANT_LUA_VER</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>port</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>WITH_LUA_VER</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>用户</p></td></tr></tbody></table><div id=lua-version-example class=exampleblock><div class=title>例 9. 选择 Lua 版本</div><div class=content><div class=paragraph><p>下面是一个用到 Lua 版本 <code>5.0</code> 或 <code>5.1</code>， 并默认使用 <code>5.0</code> 的 port 的片段。 这个默认值可以通过 <code>WITH_LUA_VER</code> 来另外指定。</p></div><div class="literalblock programlisting"><div class=content><pre>USE_LUA=      5.0-5.1
WANT_LUA_VER= 5.0</pre></div></div></div></div></div><div class=sect2><h3 id=lua-components>6.19.3. 组件的选择<a class=anchor href=#lua-components></a></h3><div class=paragraph><p>也有一些其它的应用， 尽管本身并不是 Lua 库， 但却与它们相关。 这些应用可以通过 <code>LUA_COMPS</code> 变量来指定。 可用的组件如下：</p></div><table class="tableblock frame-none grid-all stretch"><caption class=title>表 38. 可用的 Lua 组件</caption><col style=width:33.3333%><col style=width:33.3333%><col style=width:33.3334%><thead><tr><th class="tableblock halign-left valign-top">名字</th><th class="tableblock halign-left valign-top">说明</th><th class="tableblock halign-left valign-top">版本限制</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>lua</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>主库</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>无</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>tolua</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>用于访问 C/C++ 代码的库</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>4.0-5.0</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>ruby</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Ruby 绑定</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>4.0-5.0</code></p></td></tr></tbody></table><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>还有一些其它的组件， 但这些组件是由解释器， 而不是由应用程序使用的 (也就是不被其它模块使用)。</p></div></td></tr></tbody></table></div><div class=paragraph><p>每个组件的依赖关系类型可以通过手工添加分隔符为冒号的后缀来指定。 如果不指定， 则会采用默认类型 (请参见 <a href=#lua-def-dep-types>默认的 Lua 依赖关系类型</a>)。 以下是可用的依赖关系类型：</p></div><table class="tableblock frame-none grid-all stretch"><caption class=title>表 39. 可用的 Lua 依赖关系类型</caption><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">名字</th><th class="tableblock halign-left valign-top">说明</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>build</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>这个组件是联编过程所必需的， 相当于 <code>BUILD_DEPENDS</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>run</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>在运行时需要这个组件， 相当于 <code>RUN_DEPENDS</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>lib</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>这个组件在联编和运行时都需要， 相当于 <code>LIB_DEPENDS</code></p></td></tr></tbody></table><div class=paragraph><p>组件的默认依赖关系类型如下：</p></div><table id=lua-def-dep-types class="tableblock frame-none grid-all stretch"><caption class=title>表 40. 默认的 Lua 依赖关系类型</caption><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">组件</th><th class="tableblock halign-left valign-top">依赖关系类型</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>lua</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>对于 <code>4.0-5.0</code> 是 <code>lib</code> (动态连接) 而对于 <code>5.1</code> 则是 <code>build</code> (静态连接)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>tolua</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>build</code> (静态连接)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>ruby</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>lib</code> (动态连接)</p></td></tr></tbody></table><div id=lua-components-example class=exampleblock><div class=title>例 10. 选择 Lua 组件</div><div class=content><div class=paragraph><p>下面是一个使用了 Lua 版本 <code>4.0</code> 及其 Ruby 绑定的 port 片段。</p></div><div class="literalblock programlisting"><div class=content><pre>USE_LUA=      4.0
LUA_COMPS=    lua ruby</pre></div></div></div></div></div><div class=sect2><h3 id=lua-version-detection>6.19.4. 检测系统中已安装的版本<a class=anchor href=#lua-version-detection></a></h3><div class=paragraph><p>要检测系统中已安装的版本， 您必须定义 <code>WANT_LUA</code>。 如果没有将其设定为具体的版本， 则组件会包含版本后缀。 在检测之后， <code>HAVE_LUA</code> 变量将设为检测到的版本。</p></div><div id=lua-ver-det-example class=exampleblock><div class=title>例 11. 检测已安装的 Lua 版本和组件</div><div class=content><div class=paragraph><p>下面是一个如果系统中有安装 Lua 或选择了选项时使用它的 port 片段。</p></div><div class="literalblock programlisting"><div class=content><pre>WANT_LUA=       yes

.include &lt;bsd.port.pre.mk&gt;

.if defined(WITH_LUA5) || ${HAVE_LUA:Mlua-5.[01]} != &#34;&#34;
USE_LUA=        5.0-5.1
CONFIGURE_ARGS+=--enable-lua5
.endif</pre></div></div><div class=paragraph><p>下面的这段 port 在系统中已经有安装， 或用户选择了 tolua 和 Lua 支持时加以安装， 版本均选择 <code>4.0</code>。</p></div><div class="literalblock programlisting"><div class=content><pre>USE_LUA=        4.0
LUA_COMPS=      lua
WANT_LUA=       4.0

.include &lt;bsd.port.pre.mk&gt;

.if defined(WITH_TOLUA) || ${HAVE_LUA:Mtolua} != &#34;&#34;
LUA_COMPS+=     tolua
CONFIGURE_ARGS+=--enable-tolua
.endif</pre></div></div></div></div></div><div class=sect2><h3 id=lua-defined-variables>6.19.5. 定义的变量<a class=anchor href=#lua-defined-variables></a></h3><div class=paragraph><p>在 port 中可以使用下列变量 (在定义了 <a href=#lua-ver-sel-table>用于选择 Lua 版本的变量</a> 中至少一个变量之后)。</p></div><table class="tableblock frame-none grid-all stretch"><caption class=title>表 41. 为用到 Lua 的 port 定义的变量</caption><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">变量名</th><th class="tableblock halign-left valign-top">说明</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>LUA_VER</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>将要使用的 Lua 版本。 (例如， <code>5.1</code>)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>LUA_VER_SH</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Lua 动态连接库的主版本 (例如， <code>1</code>)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>LUA_VER_STR</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>不带点的 Lua 版本 (例如， <code>51</code>)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>LUA_PREFIX</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>安装 Lua (及其组件) 使用的后缀</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>LUA_SUBDIR</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>在 <span class=filename>${PREFIX}/bin</span>、 <span class=filename>${PREFIX}/share</span> 和 <span class=filename>${PREFIX}/lib</span> 中用于安装 Lua 的子目录</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>LUA_INCDIR</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>用以安装 Lua 和 tolua 头文件的目录</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>LUA_LIBDIR</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>用以安装 Lua 和 tolua 库文件的目录</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>LUA_MODLIBDIR</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>用以安装 Lua 模块动态连接库 (<span class=filename>.so</span>) 的目录</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>LUA_MODSHAREDIR</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>用以安装 Lua 模块 (<span class=filename>.lua</span>) 的目录</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>LUA_PKGNAMEPREFIX</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Lua 模块包的后缀名</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>LUA_CMD</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>到 Lua 解释器的路径</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>LUAC_CMD</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>到 Lua 编译器的路径</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>TOLUA_CMD</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>到 tolua 程序的路径</p></td></tr></tbody></table><div id=lua-variables-example class=exampleblock><div class=title>例 12. 告诉 port 到什么地方去找 Lua</div><div class=content><div class=paragraph><p>下面的 port 片段展示了如何告诉使用的 configure 脚本去什么地方查找 Lua 的头文件和库文件。</p></div><div class="literalblock programlisting"><div class=content><pre>USE_LUA=        4.0
GNU_CONFIGURE=  yes
CONFIGURE_ENV=  CPPFLAGS=&#34;-I${LUA_INCDIR}&#34; LDFLAGS=&#34;-L${LUA_LIBDIR}&#34;</pre></div></div></div></div></div><div class=sect2><h3 id=lua-premk>6.19.6. 在 <span class=filename>bsd.port.pre.mk</span> 时进行处理<a class=anchor href=#lua-premk></a></h3><div class=paragraph><p>如果您需要在使用引用 <span class=filename>bsd.port.pre.mk</span> 之后就得到变量， 以便将其用于执行一些命令， 需要定义 <code>LUA_PREMK</code>。</p></div><div class="admonitionblock important"><table><tbody><tr><td class=icon><i class="fa icon-important" title=Important></i></td><td class=content><div class=paragraph><p>如果您定义了 <code>LUA_PREMK</code>， 则在您引用 <span class=filename>bsd.port.pre.mk</span><em>之后</em>， 即使修改了 Lua port 变量， 版本和依赖关系也都不会随之发生变化了。</p></div></td></tr></tbody></table></div><div id=lua-premk-example class=exampleblock><div class=title>例 13. 在命令中使用 Lua 变量</div><div class=content><div class=paragraph><p>下面的片段展示了如何利用 <code>LUA_PREMK</code>， 并运行 Lua 解释器得到完整的版本串， 将其赋值给一个变量， 并传递给程序。</p></div><div class="literalblock programlisting"><div class=content><pre>USE_LUA=        5.0
LUA_PREMK=      yes

.include &lt;bsd.port.pre.mk&gt;

.if exists(${LUA_CMD})
VER_STR!=       ${LUA_CMD} -v

CFLAGS+=        -DLUA_VERSION_STRING=&#34;${VER_STR}&#34;
.endif</pre></div></div></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>在 target 中的 Lua 变量可以在命令中安全的使用， 而无需使用 <code>LUA_PREMK</code>。</p></div></td></tr></tbody></table></div></div></div></div><div class=sect1><h2 id=using-xfce>6.20. 使用 Xfce<a class=anchor href=#using-xfce></a></h2><div class=sectionbody><div class=paragraph><p><code>USE_XFCE</code> 变量可以用来自动配置使用基于 Xfce 库或应用程序， 如 <a class=package href=https://cgit.freebsd.org/ports/tree/x11-toolkits/libxfce4gui/>x11-toolkits/libxfce4gui</a> 和 <a class=package href=https://cgit.freebsd.org/ports/tree/x11-wm/xfce4-panel/>x11-wm/xfce4-panel</a> 的 port 的依赖关系。</p></div><div class=paragraph><p>目前， 系统能够识别下列 Xfce 库和应用程序：</p></div><div class=ulist><ul><li><p>libexo：<a class=package href=https://cgit.freebsd.org/ports/tree/x11/libexo/>x11/libexo</a></p></li><li><p>libgui：<a class=package href=https://cgit.freebsd.org/ports/tree/x11-toolkits/libxfce4gui/>x11-toolkits/libxfce4gui</a></p></li><li><p>libutil：<a class=package href=https://cgit.freebsd.org/ports/tree/x11/libxfce4util/>x11/libxfce4util</a></p></li><li><p>libmcs：<a class=package href=https://cgit.freebsd.org/ports/tree/x11/libxfce4mcs/>x11/libxfce4mcs</a></p></li><li><p>mcsmanager：<a class=package href=https://cgit.freebsd.org/ports/tree/sysutils/xfce4-mcs-manager/>sysutils/xfce4-mcs-manager</a></p></li><li><p>panel：<a class=package href=https://cgit.freebsd.org/ports/tree/x11-wm/xfce4-panel/>x11-wm/xfce4-panel</a></p></li><li><p>thunar：<a class=package href=https://cgit.freebsd.org/ports/tree/x11-fm/thunar/>x11-fm/thunar</a></p></li><li><p>wm：<a class=package href=https://cgit.freebsd.org/ports/tree/x11-wm/xfce4-wm/>x11-wm/xfce4-wm</a></p></li><li><p>xfdev：<a class=package href=https://cgit.freebsd.org/ports/tree/dev/xfce4-dev-tools/>dev/xfce4-dev-tools</a></p></li></ul></div><div class=paragraph><p>除此之外， 还能够使用下列参数：</p></div><div class=ulist><ul><li><p>configenv： 如果您的 port 需要使用特殊的 <code>CONFIGURE_ENV</code> 来查找所需的库。</p><div class="literalblock programlisting"><div class=content><pre>-I${LOCALBASE}/include -L${LOCALBASE}/lib</pre></div></div></li></ul></div><div class=paragraph><p>会加到 <code>CONFIGURE_ENV</code> 的 CPPFLAGS。</p></div><div class=paragraph><p>因此， 如果 port 有到 <a class=package href=https://cgit.freebsd.org/ports/tree/sysutils/xfce4-mcs-manager/>sysutils/xfce4-mcs-manager</a> 的依赖关系， 并需要在 configure 的环境中指定特殊的饿 CPPFLAGS， 则所用的语法为：</p></div><div class="literalblock programlisting"><div class=content><pre>USE_XFCE=        mcsmanager configenv</pre></div></div></div></div><div class=sect1><h2 id=using-mozilla>6.21. 使用 Mozilla<a class=anchor href=#using-mozilla></a></h2><div class=sectionbody><table class="tableblock frame-none grid-all stretch"><caption class=title>表 42. 用到 Mozilla 的 port 使用的变量</caption><col style=width:50%><col style=width:50%><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>USE_GECKO</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>port 支持的 Gecko 后端。 可选值： <code>libxul</code> (<span class=filename>libxul.so</span>)、 <code>seamonkey</code> (<span class=filename>libgtkembedmoz.so</span>， 过时， 新 port 应避免使用)。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>USE_FIREFOX</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>port 需要使用 Firefox 作为运行环境依赖。 可选值： <code>yes</code> (使用默认版本)、 <code>40</code>、 <code>36</code>、 <code>35</code>。 默认的依赖采用的是版本 <code>40</code>。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>USE_FIREFOX_BUILD</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>port 需要使用 Firefox 作为联编环境依赖。 可选值： 参见 USE_FIREFOX。 这个变量会自动设置 USE_FIREFOX 使用相同的值。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>USE_SEAMONKEY</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>port 需要使用 SeaMonkey 作为运行环境依赖。 可选值： <code>yes</code> (使用默认版本)、 <code>20</code>、 <code>11</code> (过时， 新 port 应避免使用)。 默认的依赖采用的是版本 <code>20</code>。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>USE_SEAMONKEY_BUILD</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>port 需要使用 SeaMonkey 作为联编环境依赖。 可选值： 参见 USE_SEAMONKEY。 这个变量会自动设置 USE_SEAMONKEY 使用相同的值。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>USE_THUNDERBIRD</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>port 需要使用 Thunderbird 作为运行环境依赖。 可选值： <code>yes</code> (使用默认版本)、 <code>31</code>、 <code>30</code> (过时， 新 port 应避免使用)。 默认的依赖采用的是版本 <code>31</code>。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>USE_THUNDERBIRD_BUILD</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>port 需要使用 Thunderbird 作为联编环境依赖。 可选值： 参见 USE_THUNDERBIRD。 这个变量会自动设置 USE_THUNDERBIRD 使用相同的值。</p></td></tr></tbody></table><div class=paragraph><p>可用变量的完整列表， 请参阅 <span class=filename>/usr/ports/Mk/bsd.gecko.mk</span>。</p></div></div></div><div class=sect1><h2 id=using-databases>6.22. 使用数据库<a class=anchor href=#using-databases></a></h2><div class=sectionbody><table class="tableblock frame-none grid-all stretch"><caption class=title>表 43. ports 中有关数据库的变量</caption><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">Variable</th><th class="tableblock halign-left valign-top">Means</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>USE_BDB</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>如果这个变量为 <code>yes</code>， 则把 <a class=package href=https://cgit.freebsd.org/ports/tree/databases/db41/>databases/db41</a> 列为依赖关系。 这个变量还可以被设置成的值有： 40，41， 42、 43、 44、 46、 47、 48 或 51。 您可以声明可接受值的范围， <code>USE_BDB</code>=42+ 将寻找已安装的最高版本， 如果没有找到则退回到 42。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>USE_MYSQL</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>如果这个变量为 <code>yes</code>， 则把 <a class=package href=https://cgit.freebsd.org/ports/tree/databases/mysql55-server/>databases/mysql55-server</a> 列为依赖关系。还有一个相关的变量，<code>WANT_MYSQL_VER</code>, 可以设置的值有 323，40，41，50，51， 52， 55 或者 60。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>USE_PGSQL</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>如果设置成 <code>yes</code>，则把 <a class=package href=https://cgit.freebsd.org/ports/tree/databases/postgresql82/>databases/postgresql82</a> 列为依赖关系。还有一个相关的变量，<code>WANT_PGSQL_VER</code>， 可以设置的值有 73，74，80，81，82， 83 或 90。</p></td></tr></tbody></table><div class=paragraph><p>更多详情请参阅 <a href=http://www.freebsd.org/cgi/cvsweb.cgi/ports/Mk/bsd.database.mk>bsd.database.mk</a>。</p></div></div></div><div class=sect1><h2 id=rc-scripts>6.23. 启动和停止服务 (rc 脚本)<a class=anchor href=#rc-scripts></a></h2><div class=sectionbody><div class=paragraph><p><span class=filename>rc.d</span> 脚本在系统启动时用于启动服务， 并为管理员提供停止、 启动和重新启动某个服务的标准方法。 Ports 安装的脚本会集成到系统的 <span class=filename>rc.d</span> 框架中。 关于如何使用它的说明， 可以在 <a href=https://docs.freebsd.org/zh-cn/books/handbook/config-tuning/#configtuning-rcd>使用手册的 rc.d 章节</a> 找到。 关于可用命令的详细解释， 则可以在 <a href="https://man.freebsd.org/cgi/man.cgi?query=rc&amp;sektion=8&amp;format=html">rc(8)</a> 和 <a href="https://man.freebsd.org/cgi/man.cgi?query=rc.subr&amp;sektion=8&amp;format=html">rc.subr(8)</a> 找到。 最后， 您可以参阅 <a href=https://docs.freebsd.org/zh-cn/articles/rc-scripting/>这篇文章</a> 了解撰写 <span class=filename>rc.d</span> 脚本的最佳实践。</p></div><div class=paragraph><p>可以安装一或多个 <span class=filename>rc.d</span> 脚本：</p></div><div class="literalblock programlisting"><div class=content><pre>USE_RC_SUBR=	doormand</pre></div></div><div class=paragraph><p>这些脚本必须放到 <span class=filename>files</span> 目录， 并附加 <code>.in</code>。 这个文件中可以使用标准的 <code>SUB_LIST</code> 替换展开。 除此之外， 我们还强烈推荐使用 <code>%%PREFIX%%</code> 和 <code>%%LOCALBASE%%</code> 替换展开。 关于 <code>SUB_LIST</code> 的介绍可以在 <a href=#using-sub-files>本书的相关章节</a> 找到。</p></div><div class=paragraph><p>在 FreeBSD 6.1-RELEASE 之前， 与 <a href="https://man.freebsd.org/cgi/man.cgi?query=rcorder&amp;sektion=8&amp;format=html">rcorder(8)</a> 的集成是通过 <code>USE_RCORDER</code> 而不是 <code>USE_RC_SUBR</code> 来完成的。 不过， 除非 port 需要提供安装进基本系统这样的选项， 或者服务需要在 <span class=filename>rc.d</span> 脚本 <span class=filename>FILESYSTEMS</span> 之前运行这类特殊情况， 一般来说是不需要使用这个功能的。</p></div><div class=paragraph><p>从 FreeBSD 6.1-RELEASE 开始， 本地安装的 <span class=filename>rc.d</span> 脚本 (包括由 port 安装的脚本) 会纳入基本系统的 <a href="https://man.freebsd.org/cgi/man.cgi?query=rcorder&amp;sektion=8&amp;format=html">rcorder(8)</a>。</p></div><div class=paragraph><p>以下是一个简单的 <span class=filename>rc.d</span> 脚本：</p></div><div class="literalblock programlisting"><div class=content><pre>#!/bin/sh

# $FreeBSD$
#
# PROVIDE: doormand
# REQUIRE: LOGIN
# KEYWORD: shutdown
#
# 在 /etc/rc.conf.local 或 /etc/rc.conf 中增加下述设置可以启用这一服务：
#
# doormand_enable (bool):	默认设为 NO。
#				设为 YES 可以启用 doormand。
# doormand_config (path):	默认设为 %%PREFIX%%/etc/doormand/doormand.cf。
#

. /etc/rc.subr

name=&#34;doormand&#34;
rcvar=${name}_enable

command=%%PREFIX%%/sbin/${name}
pidfile=/var/run/${name}.pid

load_rc_config $name

: ${doormand_enable=&#34;NO&#34;}
: ${doormand_config=&#34;%%PREFIX%%/etc/doormand/doormand.cf&#34;}

command_args=&#34;-p $pidfile -f $doormand_config&#34;

run_rc_command &#34;$1&#34;</pre></div></div><div class=paragraph><p>除非有很站得住脚的理由提前启动服务，所有的 ports 脚本应使用</p></div><div class="literalblock programlisting"><div class=content><pre>REQUIRE: LOGIN</pre></div></div><div class=paragraph><p>。 如果服务需要以特定用户 (除 root 之外) 身份启动， 则必须这样做。 在前面的例子中， 我们还使用了</p></div><div class="literalblock programlisting"><div class=content><pre>KEYWORD: shutdown</pre></div></div><div class=paragraph><p>以便让 mythical port 在系统停机的过程中以正常的方式终止， 因为它需要在系统引导过程中启动服务。 如果脚本没有启动任何服务， 则并不需要这样做。</p></div><div class=paragraph><p>这里， 对变量的默认赋值方法应采用 "="， 而非 ":=" 这样的形式。 这是因为， 前一种赋值方法只有在变量未被设置时才设置默认值， 而后一种方法则会在变量没有设置， <em>或者</em> 其值为空时都设置默认值。 用户非常可能在其 <span class=filename>rc.conf.local</span> 中使用类似</p></div><div class="literalblock programlisting"><div class=content><pre>doormand_flags=&#34;&#34;</pre></div></div><div class=paragraph><p>这样的设置， 而采用 ":=" 来进行赋值， 则会在不经意间覆盖用户所希望的设置。</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>新增的脚本均不应使用 <span class=filename>.sh</span> 后缀。 未来， 仍然包含这一后缀的脚本将被批量改名。</p></div></td></tr></tbody></table></div><div class=sect2><h3 id=_卸载时停止服务>6.23.1. 卸载时停止服务<a class=anchor href=#_卸载时停止服务></a></h3><div class=paragraph><p>可以在卸载的过程中自动地停止服务。 我们建议只有在绝对必要， 例如必须在删除文件之前停止服务这类的情况下才使用这一功能。 通常来说， 决定是否在卸载时停止服务是系统管理员需要考虑的事情。 另外要注意， 这个功能也会影响升级过程。</p></div><div class=paragraph><p>需要时可以在 <span class=filename>pkg-plist</span> 中加入：</p></div><div class="literalblock programlisting"><div class=content><pre>@stopdaemon doormand</pre></div></div><div class=paragraph><p>这里的参数必须与 <code>USE_RC_SUBR</code> 变量的内容匹配。</p></div></div></div></div><div class=sect1><h2 id=users-and-groups>6.24. 添加用户和用户组<a class=anchor href=#users-and-groups></a></h2><div class=sectionbody><div class=paragraph><p>一些 port 需要在安装的系统中创建特定的用户或用户组。 如果有这种情况， 请从 50 到 999 之间选择一个尚未使用的 UID， 并在 <span class=filename>ports/UIDs</span> (针对用户) 或 <span class=filename>ports/GIDs</span> (针对组) 中予以记录。 请务必确保您没有使用系统中已经在其他 ports 中使用的 UID。</p></div><div class=paragraph><p>如果您的 port 需要创建新用户或用户组， 请在提交补丁的时候一并提交这两个文件的补丁。</p></div><div class=paragraph><p>接下来， 可以在您的 <span class=filename>Makefile</span> 中使用 <code>USERS</code> 和 <code>GROUPS</code> 这两个变量， 系统会在安装时自动创建用户或组。</p></div><div class="literalblock programlisting"><div class=content><pre>USERS=	pulse
GROUPS=	pulse pulse-access pulse-rt</pre></div></div><div class=paragraph><p>现有的保留 UID 和 GID 列表， 可以在 <span class=filename>ports/UIDs</span> 和 <span class=filename>ports/GIDs</span> 找到。</p></div></div></div><div class=sect1><h2 id=_依赖内核源代码的_ports>6.25. 依赖内核源代码的 Ports<a class=anchor href=#_依赖内核源代码的_ports></a></h2><div class=sectionbody><div class=paragraph><p>某些 ports (例如可加载式内核模块) 需要内核的源文件才能编译。 下面是检测用户是否安装了源代码的例子：</p></div><div class="literalblock programlisting"><div class=content><pre>.if !exists(${SRC_BASE}/sys/Makefile)
IGNORE=         requires kernel sources to be installed
.endif</pre></div></div></div></div></div><hr><div class=last-modified><p><strong>Last modified on</strong>: March 9, 2024 by <a href="https://cgit.freebsd.org/doc/commit/?id=6199af92e7" target=_blank>Danilo G. Baio</a></p></div><div class=buttons><div class=prev><i class="fa fa-angle-left" aria-hidden=true title=Prev></i><div class=container><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/makefile class=direction>Prev</a></div></div><div class=home><i class="fa fa-home" aria-hidden=true title=Home></i><div class=container><a href=../ class=direction>Home</a></div></div><div class=next><div class=container><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook/plist class=direction>Next</a></div><i class="fa fa-angle-right" aria-hidden=true title=Next></i></div></div><label class="hidden book-menu-overlay" for=menu-control></label></div><aside class=toc><div class=toc-content><h3>Table of Contents</h3><nav id=TableOfContents><ul><li><a href=#porting-shlibs>6.1. 共享库</a></li><li><a href=#porting-restrictions>6.2. Ports 的发行限制</a></li><li><a href=#building>6.3. 联编机制</a></li><li><a href=#using-autotools>6.4. 利用 GNU autotools</a></li><li><a href=#using-gettext>6.5. 使用 GNU <code>gettext</code></a></li><li><a href=#using-perl>6.6. 使用 <code>perl</code></a></li><li><a href=#using-x11>6.7. 使用 X11</a></li><li><a href=#using-gnome>6.8. 使用 GNOME</a></li><li><a href=#using-qt>6.9. 使用 Qt</a></li><li><a href=#using-kde>6.10. 使用 KDE</a></li><li><a href=#using-java>6.11. 使用 Java</a></li><li><a href=#using-php>6.12. Web 应用， Apache 和 PHP</a></li><li><a href=#using-python>6.13. 使用 Python</a></li><li><a href=#using-tcl>6.14. 使用 Tcl/Tk</a></li><li><a href=#using-emacs>6.15. 使用 Emacs</a></li><li><a href=#using-ruby>6.16. 使用 Ruby</a></li><li><a href=#using-sdl>6.17. 使用 SDL</a></li><li><a href=#using-wx>6.18. 使用 wxWidgets</a></li><li><a href=#using-lua>6.19. 使用 Lua</a></li><li><a href=#using-xfce>6.20. 使用 Xfce</a></li><li><a href=#using-mozilla>6.21. 使用 Mozilla</a></li><li><a href=#using-databases>6.22. 使用数据库</a></li><li><a href=#rc-scripts>6.23. 启动和停止服务 (rc 脚本)</a></li><li><a href=#users-and-groups>6.24. 添加用户和用户组</a></li><li><a href=#_依赖内核源代码的_ports>6.25. 依赖内核源代码的 Ports</a></li></ul></nav><hr><div class=resources><h3>Resources</h3><ul class=contents><li><i class="fa fa-file-pdf-o" aria-hidden=true title="Download PDF"></i><a href=https://download.freebsd.org/doc/zh-cn/books/porters-handbook/porters-handbook_zh-cn.pdf>Download PDF</a></li><li><i class="fa fa-pencil-square-o" aria-hidden=true title="Edit this page"></i><a href=https://github.com/freebsd/freebsd-doc/blob/main/documentation/content/zh-cn/_index target=_blank>Edit this page</a></li></ul></div></div></aside><a class=to-top href=#top><i class="fa fa-arrow-circle-up" aria-hidden=true></i></a></main><footer><div class=footer-container><section class=logo-column><img src=http://172.16.201.134:1313/images/FreeBSD-colors.svg width=160 height=50 alt="FreeBSD logo"><div class=options-container><div class=language-container><a id=languages href=http://172.16.201.134:1313/zh-cn/languages><img src=http://172.16.201.134:1313/images/language.png class=language-image alt="Choose language">
<span>简体中文</span></a></div><div class=theme-container><select id=theme-chooser><option value=theme-system>System</option><option value=theme-light>Light</option><option value=theme-dark>Dark</option><option value=theme-high-contrast>High contrast</option></select></div></div></section><section class=about-column><h3 class=column-title>About</h3><ul class=column-elements-container><li><a href=https://www.freebsd.org/about/ target=_blank class=column-element>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/ target=_blank class=column-element>FreeBSD Foundation</a></li><li><a href=https://www.freebsd.org/where/ target=_blank class=column-element>Get FreeBSD</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct target=_blank class=column-element>Code of Conduct</a></li><li><a href=https://www.freebsd.org/security/ target=_blank class=column-element>Security Advisories</a></li></ul></section><section class=documentation-column><h3 class=column-title>Documentation</h3><ul class=column-elements-container><li><a href=/zh-cn class=column-element>Documentation portal</a></li><li><a href=https://man.FreeBSD.org target=_blank class=column-element>Manual pages</a></li><li><a href=https://papers.FreeBSD.org target=_blank class=column-element>Presentations and papers</a></li><li><a href=https://docs-archive.freebsd.org/doc/ target=_blank class=column-element>Previous versions</a></li><li><a href=https://docs-archive.freebsd.org/44doc/ target=_blank class=column-element>4.4BSD Documents</a></li><li><a href=https://wiki.freebsd.org/ target=_blank class=column-element>Wiki</a></li></ul></section><section class=community-column><h3 class=column-title>Community</h3><ul class=column-elements-container><li><a href=http://172.16.201.134:1313/zh-cn/articles/contributing class=column-element>Get involved</a></li><li><a href=https://forums.freebsd.org/ target=_blank class=column-element>Community forum</a></li><li><a href=https://lists.freebsd.org/ target=_blank class=column-element>Mailing lists</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank class=column-element>IRC Channels</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank class=column-element>Bug Tracker</a></li></ul></section><section class=legal-column><h3 class=column-title>Legal</h3><ul class=column-elements-container><li><a href=https://freebsdfoundation.org/donate/ target=_blank class=column-element>Donations</a></li><li><a href=https://www.freebsd.org/copyright/freebsd-license/ target=_blank class=column-element>Licensing</a></li><li><a href=https://www.freebsd.org/privacy/ target=_blank class=column-element>Privacy Policy</a></li><li><a href=https://www.freebsd.org/copyright/ target=_blank class=column-element>Legal notices</a></li></ul></section><section class=copyright-column><p>&copy; 1994-2024 The FreeBSD Project. All rights reserved</p><span>Made with <span class=heart>♥</span> by the FreeBSD Community</span></section></div></footer></body></html>