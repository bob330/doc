<!doctype html><html class=theme-light lang=zh-cn><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content><meta name=copyright content="1995-2024 The FreeBSD Foundation"><link rel=canonical href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/pccard/><title>第 16 章 PC Card | FreeBSD Documentation Portal</title>
<meta name=theme-color content="#790000"><meta name=color-scheme content="system light dark high-contrast"><link rel="shortcut icon" href=http://172.16.201.134:1313/favicon.ico><link rel=stylesheet href=http://172.16.201.134:1313/styles/main.min.css><link rel=stylesheet href=http://172.16.201.134:1313/css/font-awesome-min.css><script defer src=/js/theme-chooser.min.js></script><script defer src=/js/copy-clipboard.min.js></script><script defer src=/js/search.min.js></script><meta name=twitter:card content="summary"><meta name=twitter:domain content="docs.FreeBSD.org"><meta name=twitter:site content="@freebsd"><meta name=twitter:url content="https://twitter.com/freebsd"><meta property="og:title" content="第 16 章 PC Card"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:image" content="http://172.16.201.134:1313/favicon.ico"><meta property="og:image:alt" content="FreeBSD Logo"><meta property="og:locale" content="zh-cn"><meta property="og:url" content="http://172.16.201.134:1313/zh-cn/books/arch-handbook/pccard/"><meta property="og:site_name" content="FreeBSD Documentation Portal"><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","url":"http:\/\/172.16.201.134:1313\/zh-cn\/books\/arch-handbook\/pccard\/","name":"FreeBSD Documentation Portal","headline":"FreeBSD Documentation Portal","description":"FreeBSD Documentation Portal"}</script></head><body><header><div class=header-container><div class=logo-menu-bars-container><a href=https://www.FreeBSD.org class=logo><img src=http://172.16.201.134:1313/images/FreeBSD-monochromatic.svg width=160 height=50 alt="FreeBSD logo">
</a><label class=menu-bars for=menu-bars><i class="fa fa-bars" aria-hidden=true></i></label></div><input id=menu-bars type=checkbox><nav><ul class=menu><li class=menu-item><input id=about type=checkbox>
<a href=# aria-label="Navigate to About section"><label class=menu-item-description for=about>About
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/about/ target=_blank>About</a></li><li><a href=https://www.freebsd.org/about/ target=_blank>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/about-us/about-the-foundation/ target=_blank>FreeBSD Foundation</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct/ target=_blank>Code of Conduct</a></li></ul></li><li class=menu-item><input id=download type=checkbox>
<a href=# aria-label="Navigate to get FreeBSD section"><label class=menu-item-description for=download>Get FreeBSD
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/where/ target=_blank>Get FreeBSD</a></li><li><a href=https://www.freebsd.org/releases/ target=_blank>Release Information</a></li><li><a href=https://www.freebsd.org/releng/ target=_blank>Release Engineering</a></li><li><a href=https://www.freebsd.org/security/ target=_blank>Security Advisories</a></li></ul></li><li class=menu-item><input id=documentation type=checkbox>
<a href=# aria-label="Navigate to get Documentation section"><label class=menu-item-description for=documentation>Documentation
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=/zh-cn>Documentation portal</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/handbook>FreeBSD Handbook</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/porters-handbook>Porter's Handbook</a></li><li><a href=https://docs.FreeBSD.org/en/books/fdp-primer>Documentation Project Handbook</a></li><li><a href=https://man.FreeBSD.org target=_blank>Manual pages</a></li><li><a href=https://papers.FreeBSD.org target=_blank>Presentations and papers</a></li><li><a href=https://wiki.FreeBSD.org target=_blank>Wiki</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books>Books</a></li><li><a href=http://172.16.201.134:1313/zh-cn/articles>Articles</a></li></ul></li><li class=menu-item><input id=community type=checkbox>
<a href=# aria-label="Navigate to get Community section"><label class=menu-item-description for=community>Community
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/community/>Community</a></li><li><a href=http://172.16.201.134:1313/zh-cn/articles/contributing>Get involved</a></li><li><a href=https://forums.freebsd.org/ target=_blank>Forum</a></li><li><a href=https://lists.freebsd.org/ target=_blank>Mailing lists</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank>IRC Channels</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank>Bug Tracker</a></li><li><a href=https://www.freebsd.org/support/ target=_blank>Support</a></li></ul></li></ul></nav><div class=search-donate-container><form class=search method=get id=search-header-form action=https://docs.freebsd.org/search name=search-header-form><input type=hidden name=DB value=zh-cn>
<input id=words name=P type=text size=20 maxlength=255>
<button>
<i class="fa fa-search" aria-hidden=true></i></button></form><div class=donate><a href=https://freebsdfoundation.org/donate/ target=_blank><span class=heart>♥</span>
Donate</a></div></div></div></header><input type=checkbox class="hidden toggle" id=menu-control><main class=main-wrapper-book><a id=top></a><aside class=book-menu><div class=book-menu-content><input id=search-book type=text placeholder=Search aria-label=Search maxlength=128><nav id=MenuContents><ul><li><input type=checkbox id=chapter-6dcd22d99f78db2a9aacae23be13866e class=toggle>
<label for=chapter-6dcd22d99f78db2a9aacae23be13866e><a role=button></a></label><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/parti/>Part I. 内核</a></li><li><input type=checkbox id=chapter-9cc61bc35df69063dc03a5911e1ad9c9 class=toggle>
<label class="icon cursor" for=chapter-9cc61bc35df69063dc03a5911e1ad9c9><a role=button></a></label><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/boot/>第 1 章 引导过程与内核初始化</a><ul><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/boot/#boot-synopsis>1.1. 概述</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/boot/#boot-overview>1.2. 总览</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/boot/#boot-bios>1.3. BIOS POST</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/boot/#boot-boot0>1.4. <code>boot0</code>阶段</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/boot/#boot-boot2>1.5. <code>boot2</code>阶段</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/boot/#boot-loader>1.6. loader阶段</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/boot/#boot-kernel>1.7. 内核初始化</a></li></ul></li><li><input type=checkbox id=chapter-3a651b0a4b9f6238336624d3c0fa5187 class=toggle>
<label class="icon cursor" for=chapter-3a651b0a4b9f6238336624d3c0fa5187><a role=button></a></label><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/locking/>第 2 章 内核中的锁</a><ul><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/locking/#locking-mutexes>2.1. Mutex</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/locking/#locking-sx>2.2. 共享互斥锁</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/locking/#locking-atomic>2.3. 原子保护变量</a></li></ul></li><li><input type=checkbox id=chapter-bf0b823c107a80f3035dfd6fae09d023 class=toggle>
<label class="icon cursor" for=chapter-bf0b823c107a80f3035dfd6fae09d023><a role=button></a></label><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/kobj/>第 3 章 内核对象</a><ul><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/kobj/#kernel-objects-term>3.1. 术语</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/kobj/#kernel-objects-operation>3.2. Kobj的工作流程</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/kobj/#kernel-objects-using>3.3. 使用Kobj</a></li></ul></li><li><input type=checkbox id=chapter-41dab1afed6cf3ffa54628db4227e196 class=toggle>
<label class="icon cursor" for=chapter-41dab1afed6cf3ffa54628db4227e196><a role=button></a></label><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/jail/>第 4 章 Jail子系统</a><ul><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/jail/#jail-arch>4.1. Jail的系统结构</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/jail/#jail-restrictions>4.2. 系统对被囚禁程序的限制</a></li></ul></li><li><input type=checkbox id=chapter-e7d9ebcb448b0045179ebe22f8e2e9d8 class=toggle>
<label class="icon cursor" for=chapter-e7d9ebcb448b0045179ebe22f8e2e9d8><a role=button></a></label><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/sysinit/>第 5 章 SYSINIT框架</a><ul><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/sysinit/#sysinit-term>5.1. 术语</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/sysinit/#sysinit-operation>5.2. SYSINIT操作</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/sysinit/#sysinit-using>5.3. 使用SYSINIT</a></li></ul></li><li><input type=checkbox id=chapter-8b57b16ba53538421a8fb2152b25976f class=toggle>
<label class="icon cursor" for=chapter-8b57b16ba53538421a8fb2152b25976f><a role=button></a></label><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/mac/>第 6 章 TrustedBSD MAC 框架</a><ul><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/mac/#mac-copyright>6.1. MAC 文档版权声明</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/mac/#mac-synopsis>6.2. 术语解析</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/mac/#mac-introduction>6.3. 概述</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/mac/#mac-background>6.4. 安全策略背景知识</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/mac/#mac-framework-kernel-arch>6.5. MAC 框架的内核体系结构</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/mac/#mac-policy-architecture>6.6. MAC策略模块体系结构</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/mac/#mac-entry-point-reference>6.7. MAC策略入口函数参考</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/mac/#mac-userland-arch>6.8. 应用层体系结构</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/mac/#mac-conclusion>6.9. 小结</a></li></ul></li><li><input type=checkbox id=chapter-28609916419208e3a19d240cf7593906 class=toggle>
<label class="icon cursor" for=chapter-28609916419208e3a19d240cf7593906><a role=button></a></label><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/vm/>第 7 章 虚拟内存系统</a><ul><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/vm/#vm-physmem>7.1. 物理内存的管理-<code>vm_page_t</code></a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/vm/#vm-cache>7.2. 统一的缓存信息结构体-<code>vm_object_t</code></a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/vm/#vm-fileio>7.3. 文件系统输入/输出-<code>buf</code>结构体</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/vm/#vm-pagetables>7.4. 映射页表-<code>vm_map_t, vm_entry_t</code></a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/vm/#vm-kvm>7.5. KVM存储映射</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/vm/#vm-tuning>7.6. 调整FreeBSD的虚拟内存系统</a></li></ul></li><li><input type=checkbox id=chapter-716edd44e8ad22ea57cdf273d2578872 class=toggle>
<label class="icon cursor" for=chapter-716edd44e8ad22ea57cdf273d2578872><a role=button></a></label><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/smp/>第 8 章 SMPng 设计文档</a><ul><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/smp/#smp-intro>8.1. 绪论</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/smp/#smp-lock-fundamentals>8.2. 基本工具与上锁的基础知识</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/smp/#smp-design>8.3. 架构与设计概览</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/smp/#smp-lock-strategies>8.4. 特定数据的锁策略</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/smp/#smp-implementation-notes>8.5. 实现说明</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/smp/#smp-misc>8.6. 其它话题</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/smp/#smp-glossary>术语表</a></li></ul></li><li><input type=checkbox id=chapter-448f803e40f97b1ff8336db9ba637745 class=toggle>
<label for=chapter-448f803e40f97b1ff8336db9ba637745><a role=button></a></label><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/partii/>Part II. 设备驱动程序</a></li><li><input type=checkbox id=chapter-6971d35b0bbe2a0bdb005a02546cd580 class=toggle>
<label class="icon cursor" for=chapter-6971d35b0bbe2a0bdb005a02546cd580><a role=button></a></label><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/driverbasics/>第 9 章 编写 FreeBSD 设备驱动程序</a><ul><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/driverbasics/#driverbasics-intro>9.1. 简介</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/driverbasics/#driverbasics-kld>9.2. 动态内核链接工具-KLD</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/driverbasics/#driverbasics-access>9.3. 访问设备驱动程序</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/driverbasics/#driverbasics-char>9.4. 字符设备</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/driverbasics/#driverbasics-block>9.5. 块设备(消亡中)</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/driverbasics/#driverbasics-net>9.6. 网络设备驱动程序</a></li></ul></li><li><input type=checkbox id=chapter-9cc7968be065b256e57086439d93e9a4 class=toggle>
<label class="icon cursor" for=chapter-9cc7968be065b256e57086439d93e9a4><a role=button></a></label><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/isa/>第 10 章 ISA设备驱动程序</a><ul><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/isa/#isa-driver-synopsis>10.1. 概述</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/isa/#isa-driver-basics>10.2. 基本信息</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/isa/#isa-driver-device-t>10.3. Device_t指针</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/isa/#isa-driver-config>10.4. 配置文件与自动配置期间识别和探测的顺序</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/isa/#isa-driver-resources>10.5. 资源</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/isa/#isa-driver-busmem>10.6. 总线内存映射</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/isa/#isa-driver-dma>10.7. DMA</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/isa/#isa-driver-probe>10.8. xxx_isa_probe</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/isa/#isa-driver-attach>10.9. xxx_isa_attach</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/isa/#isa-driver-detach>10.10. xxx_isa_detach</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/isa/#isa-driver-shutdown>10.11. xxx_isa_shutdown</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/isa/#isa-driver-intr>10.12. xxx_intr</a></li></ul></li><li><input type=checkbox id=chapter-0b427d421e89aa3107f62d5b70f6a0f2 class=toggle>
<label class="icon cursor" for=chapter-0b427d421e89aa3107f62d5b70f6a0f2><a role=button></a></label><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/pci/>第 11 章 PCI设备</a><ul><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/pci/#pci-probe>11.1. 探测与连接</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/pci/#pci-bus>11.2. 总线资源</a></li></ul></li><li><input type=checkbox id=chapter-0b7eb8d45a0ea6bc9c2882e903b93959 class=toggle>
<label class="icon cursor" for=chapter-0b7eb8d45a0ea6bc9c2882e903b93959><a role=button></a></label><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/scsi/>第 12 章 通用访问方法SCSI控制器</a><ul><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/scsi/#scsi-synopsis>12.1. 提纲</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/scsi/#scsi-general>12.2. 通用基础结构</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/scsi/#scsi-polling>12.3. 轮询</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/scsi/#scsi-async>12.4. 异步事件</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/scsi/#scsi-interrupts>12.5. 中断</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/scsi/#scsi-errors>12.6. 错误总览</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/scsi/#scsi-timeout>12.7. 超时处理</a></li></ul></li><li><input type=checkbox id=chapter-bdaa4909dfbdcec8d7be976fd87cb00e class=toggle>
<label class="icon cursor" for=chapter-bdaa4909dfbdcec8d7be976fd87cb00e><a role=button></a></label><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/usb/>第 13 章 USB设备</a><ul><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/usb/#usb-intro>13.1. 简介</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/usb/#usb-hc>13.2. 主控器</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/usb/#usb-dev>13.3. USB设备信息</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/usb/#usb-devprobe>13.4. 设备的探测和连接</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/usb/#usb-protocol>13.5. USB驱动程序的协议信息</a></li></ul></li><li><input type=checkbox id=chapter-5fc5c179f5014d968a5c8feec7e10e59 class=toggle>
<label class="icon cursor" for=chapter-5fc5c179f5014d968a5c8feec7e10e59><a role=button></a></label><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/newbus/>第 14 章 Newbus</a><ul><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/newbus/#newbus-devdrivers>14.1. 设备驱动程序</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/newbus/#newbus-overview>14.2. Newbus概览</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/newbus/#newbus-api>14.3. Newbus API</a></li></ul></li><li><input type=checkbox id=chapter-7d3796cced00105c77e7f87e84edd73b class=toggle>
<label class="icon cursor" for=chapter-7d3796cced00105c77e7f87e84edd73b><a role=button></a></label><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/sound/>第 15 章 声音子系统</a><ul><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/sound/#oss-intro>15.1. 简介</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/sound/#oss-files>15.2. 文件</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/sound/#pcm-probe-and-attach>15.3. 探测，连接等</a></li><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/sound/#oss-interfaces>15.4. 接口</a></li></ul></li><li><input type=checkbox id=chapter-41c74c3e72fcf5116f6d999c36ef185b class=toggle checked>
<label class="icon cursor" for=chapter-41c74c3e72fcf5116f6d999c36ef185b><a role=button></a></label><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/pccard/>第 16 章 PC Card</a><ul><li><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/pccard/#pccard-adddev>16.1. 添加设备</a></li></ul></li><li><input type=checkbox id=chapter-2a7cf37011599a8e3d62d1e3008c3c5d class=toggle>
<label for=chapter-2a7cf37011599a8e3d62d1e3008c3c5d><a role=button></a></label><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/partiii/>Part III. 附录</a></li><li><input type=checkbox id=chapter-d4c82056f0235da9fde0d29203d44f9a class=toggle>
<label for=chapter-d4c82056f0235da9fde0d29203d44f9a><a role=button></a></label><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/bibliography/>参考书目</a></li><li></li></ul></nav></div></aside><div class=book><div class=book-menu-mobile><label for=menu-control><span class=menu-control-button><i class="fa fa-list" aria-hidden=true title="Book menu"></i>
Book menu</span></label></div><h1 class=title>第 16 章 PC Card</h1><div class="admonitionblock note"><p><i class="fa fa-exclamation-circle" aria-hidden=true></i>
This translation may be out of date. To help with the translations please access the <a href=https://translate-dev.freebsd.org/ target=_blank>FreeBSD translations instance</a>.</p></div><div class=toc-mobile><h3>Table of Contents</h3><nav id=TableOfContents><ul><li><a href=#pccard-adddev>16.1. 添加设备</a></li></ul></nav></div><div class=book-content><div id=preamble><div class=sectionbody><div class=paragraph><p>本章将讨论FreeBSD为编写PC Card或CardBus设备的驱动程序而提供的机制。 但目前本文只记录了如何向现有的pccard驱动程序中添加驱动程序。</p></div></div></div><div class=sect1><h2 id=pccard-adddev>16.1. 添加设备<a class=anchor href=#pccard-adddev></a></h2><div class=sectionbody><div class=paragraph><p>向所支持的pccard设备列表中添加新设备的步骤已经与系统在FreeBSD 4 中使用的方法不同了。在以前的版本中，需要编辑 <span class=filename>/etc</span>中的一个文件来列出设备。从FreeBSD 5.0开始， 设备驱动程序知道它们支持什么设备。现在内核中有一个受支持设备的表， 驱动程序用它来连接设备。</p></div><div class=sect2><h3 id=pccard-overview>16.1.1. 概览<a class=anchor href=#pccard-overview></a></h3><div class=paragraph><p>可以有两种方法来识别PC Card，他们都基于卡上的 CIS信息。第一种方法是使用制造商和产品的数字编号。 第二种方法是使用人可读的字符串，字符串也是包含在CIS中。PC Card总线 使用集中式数据库和一些宏来提供一个易用的设计模式，让驱动程序的编写 者很容易地确定匹配其驱动程序的设备。</p></div><div class=paragraph><p>一个很普遍的实际情况是，某个公司为一款PC Card产品开发出参考 设计，然后把这个设计卖给另外的公司，以便在市场上出售。那些公司改进 原设计，把向他们的目标客户群或地理区域出售产品，并将他们自己的名字 放到卡中。然而所谓的对现有卡的改进，即使做过任何修改，这些修改通常 也微乎其微。然而，为了强化他们自己版本的品牌，这些供货商常常会把他们 公司的名字放入CIS空间的可读字符串中，却不会改动制造商和产品的ID。</p></div><div class=paragraph><p>鉴于以上情况，对于FreeBSD来说使用数字ID可以减小工作量。同时也 会减小将ID加入到系统的过程中所带来的复杂性。必须仔细检查谁是卡的 真正制造者，尤其当提供原卡的供货商在中心数据库中已经有一个不同的ID 时。Linksys，D-Link和NetGear是经常出售相同设计的几个美国制造商。 相同的设计可能在日本以诸如Buffalo和Corega的名字出售。然而，这些 设备常常具有相同的制造商和产品ID。</p></div><div class=paragraph><p>PC Card总线在其中心数据库 <span class=filename>/sys/dev/pccard/pccarddevs</span>中保存了卡的信息， 但不包含哪个驱动程序与它们关联的信息。它也提供了一套宏，以允许在 驱动程序用来声明设备的表中容易地创建简单条目。</p></div><div class=paragraph><p>最后，某些非常低端的设备根本不包含制造商标识。这些设备需要使用 可读CIS字符串来匹配它们。如果我们不需要这种应急办法该有多好，但对于 某些非常低端却非常流行的CD-ROM播放器来说却是必需的。通常应当避免 使用这种方法，但本节中还是列出了很多设备，因为它们是在认识到PC Card商业的OEM本质之前加入的，应当优先使用 数字方法。</p></div></div><div class=sect2><h3 id=pccard-pccarddevs>16.1.2. <span class=filename>pccarddevs</span>的格式<a class=anchor href=#pccard-pccarddevs></a></h3><div class=paragraph><p><span class=filename>pccarddevs</span>文件有四节。第一节为使用 它们的那些供货商列出了制造商号码。本节按数字排序。下一节包含了 这些供货商使用的所有产品，包括他们的产品ID号码和描述字符串。 描述字符串通常不会被使用（相反，即使我们可以匹配数字版本号，我们 仍然基于人可读的CIS设置设备的描述）。然后为使用字符串匹配方法的 那些设备重复这两节的东西。最后，文件任何地方可以使用C风格的注释。</p></div><div class=paragraph><p>文件的第一节包含供货商ID。请保持列表按数字排序。此外，为了 能有一个通用清晰的保存地来方便地保存这些信息，我们与NetBSD共享此 文件，因此请协调对此文件的任何更改。例如：</p></div><div class="literalblock programlisting"><div class=content><pre>vendor FUJITSU			0x0004  Fujitsu Corporation
vendor NETGEAR_2		0x000b  Netgear
vendor PANASONIC		0x0032	Matsushita Electric Industrial Co.
vendor SANDISK			0x0045	Sandisk Corporation</pre></div></div><div class=paragraph><p>显示了几个供货商ID。很凑巧的是<code>NETGEAR_2</code> 实际上是NETGEAR从其购买卡的OEM，对那些卡提供支持的作者那时并不知道 NETgear使用的是别人的ID。这些条目相当直接易懂。每行上都有供货商 关键字来指示本行的类别。也有供货商的名字。名字将会在pccarddevs文件 的后面重复出现，名字也会用在驱动程序的匹配表中，因此保持它的短小 并且是有效的C标识符。还有一个给供货商的十六进制数字ID。不要添加 <code>0xffffffff</code>或<code>0xffff</code>形式的ID， 因为它们是保留ID（前者是’空ID集合'，而后者有时会在质量极其差的卡中 看到，用来指示none）。最后还有关于制卡公司的描述字符串。这个字符串 在FreeBSD中除了用于注释目的外并没有被使用过。</p></div><div class=paragraph><p>文件的第二节包含产品. 如你在下面例子中看到的:</p></div><div class="literalblock programlisting"><div class=content><pre>/* Allied Telesis K.K. */
product ALLIEDTELESIS LA_PCM	0x0002 Allied Telesis LA-PCM

/* Archos */
product	ARCHOS ARC_ATAPI	0x0043 MiniCD</pre></div></div><div class=paragraph><p>格式与供货商的那些行相似。其中有产品关键字。然后是供货商名字， 由上面重复而来。后面跟着产品名字，此名字在驱动程序中使用，且应当 是一个有效C标识符，但可以以数字开头。然后是卡的十六进制产品ID。 供货商通常对<code>0xffffffff</code>和 <code>0xffff</code>有相同的约定。最后是关于设备自身的字符串 描述。由于FreeBSD的pccard总线驱动程序会从人可读的CIS条目创建一个 字符串，因此这个字符串在FreeBSD中通常不被使用，但某些CIS条目不能 满足要求的情况下还可能使用。产品按制造商的字母顺序排序，然后再按 产品ID的数字排序。每个制造商条目前有一条C注释，条目之间有一个空行。</p></div><div class=paragraph><p>第三节很象前面的供货商一节，但所由的制造商ID为 <code>-1</code>。<code>-1</code>在FreeBSD pccard总线 代码中意味着"匹配发现的任何东西"。由于它们是C标识符， 它们的名字必须唯一。除此之外格式等同于文件的第一节。</p></div><div class=paragraph><p>最后一节包含那些必须用字符串匹配的卡。这一节的格式与通用 节的格式有点不同：</p></div><div class="literalblock programlisting"><div class=content><pre>product ADDTRON AWP100		{ &#34;Addtron&#34;, &#34;AWP-100spWirelessspPCMCIA&#34;, &#34;Versionsp01.02&#34;, NULL }
product ALLIEDTELESIS WR211PCM	{ &#34;AlliedspTelesisspK.K.&#34;, &#34;WR211PCM&#34;, NULL, NULL } Allied Telesis WR211PCM</pre></div></div><div class=paragraph><p>我们已经熟悉了产品关键字，后跟供货商名字，然后再跟卡的名字， 就象在文件第二节中那样。然而，这之后就与那格式不同了。有一个 {}分组，后跟几个字符串。这些字符串对应CIS_INFO三元组中定义的 供货商，产品和额外信息。这些字符串被产生 <span class=filename>pccarddevs.h</span>的程序过滤，将 sp替换为 实际的空格。空条目意味着条目的这部分应当被忽略。在我选择的例子中 有一个错误的条目。除非对卡的操作来说至关重要，否则不应当在其中 包含版本号。有时供货商在这个字段中会有卡的很多不同版本，这些版本 都能工作，这种情况下那些信息只会让那些拥有相似卡的人在FreeBSD中 更难以使用。有时当供货商出于市场考虑（可用性，价格等等），希望出售 同一品牌下的很多不同部分时，这也是有必要的。如果这样，则在那些 供货商仍然保持相同的制造商/产品对的少见情况下，能否区分开卡至关 重要. 此时不能使用正则表达式匹配。</p></div></div><div class=sect2><h3 id=pccard-probe>16.1.3. 探测例程样例<a class=anchor href=#pccard-probe></a></h3><div class=paragraph><p>要懂得如何向所支持的设备列表中添加设备，就必须懂得很多驱动程序 都有的探测和/或匹配例程。由于也为老卡提供了一个兼容层，这在 FreeBSD 5.x中有一点复杂。由于只是window-dressing不同，这儿给出了 一个理想化的版本。</p></div><div class="literalblock programlisting"><div class=content><pre>static const struct pccard_product wi_pccard_products[] = {
	PCMCIA_CARD(3COM, 3CRWE737A, 0),
	PCMCIA_CARD(BUFFALO, WLI_PCM_S11, 0),
	PCMCIA_CARD(BUFFALO, WLI_CF_S11G, 0),
	PCMCIA_CARD(TDK, LAK_CD011WL, 0),
	{ NULL }
};

static int
wi_pccard_probe(dev)
	device_t	dev;
{
	const struct pccard_product *pp;

	if ((pp = pccard_product_lookup(dev, wi_pccard_products,
	    sizeof(wi_pccard_products[0]), NULL)) != NULL) {
		if (pp-pp_name != NULL)
			device_set_desc(dev, pp-pp_name);
		return (0);
	}
	return (ENXIO);
}</pre></div></div><div class=paragraph><p>这儿我们有一个可以匹配少数几个设备的简单pccard探测例程。如上面 所提到，名字可能不同（如果不是 <code>foo_pccard_probe()</code>则就是 <code>foo_pccard_match()</code>）。函数 <code>pccard_product_lookup()</code>是一个通用函数，它遍历 表并返回指向它所匹配的第一项的指针。一些驱动程序可能使用这个机制来 将某些卡的附加信息传递到驱动程序的其它部分，因此表中可能有些变体。 唯一的要求就是如果你有一个不同的表，则让表的结构的第一个元素为 结构pccard_product。</p></div><div class=paragraph><p>观察一下表<code>wi_pccard_products</code>就会发现， 所有条目都是 <code>PCMCIA_CARD(<em>foo</em>， <em>bar</em>， <em>baz</em>)</code>的形式。 <em>foo</em>部分为来自 <span class=filename>pccarddevs</span>的制造商ID。 <em>bar</em>部分为产品。 <em>baz</em>为此卡所期望的功能号。许多pccards 可以有多个功能，需要有办法区分开功能1和功能0。你可以看一下 <code>PCMCIA_CARD_D</code>，它包括了来自 <span class=filename>pccarddevs</span>文件的设备描述。你也可以看看 <code>PCMCIA_CARD2</code>和 <code>PCMCIA_CARD2_D</code>，当你需要按 "使用默认描述"和"从pccarddevs中取得" 做法，同时匹配CIS字符串和制造商号码时就会用到它们。</p></div></div><div class=sect2><h3 id=pccard-add>16.1.4. 将它合在一起<a class=anchor href=#pccard-add></a></h3><div class=paragraph><p>因此，为了一个增加新设备，必须进行下面步骤。首先，必须从设备 获得标识信息。完成这个最容易的方法就是将设备插入到PC Card或CF槽中， 并发出<code>devinfo -v</code>。你可能会看到一些类似下面的 东西：</p></div><div class="literalblock programlisting"><div class=content><pre>        cbb1 pnpinfo vendor=0x104c device=0xac51 subvendor=0x1265 subdevice=0x0300 class=0x060700 at slot=10 function=1
          cardbus1
          pccard1
            unknown pnpinfo manufacturer=0x026f product=0x030c cisvendor=&#34;BUFFALO&#34; cisproduct=&#34;WLI2-CF-S11&#34; function_type=6 at function=0</pre></div></div><div class=paragraph><p>作为输出的一部分。制造商和产品为产品的数字ID。而cisvender和 cisproduct为CIS中提供的描述本产品的字符串。</p></div><div class=paragraph><p>由于我们首先想优先使用数字选项，因此首先尝试创建基于此的条目。 为了示例，上面的卡已经被稍稍虚构化了。我们看到的供货商为BUFFALO， 它已经有一个条目了：</p></div><div class="literalblock programlisting"><div class=content><pre>vendor BUFFALO			0x026f	BUFFALO (Melco Corporation)</pre></div></div><div class=paragraph><p>这样我们就可以了。为这个卡查找一个条目，但我们没有发现。但我们 发现：</p></div><div class="literalblock programlisting"><div class=content><pre>/* BUFFALO */
product BUFFALO WLI_PCM_S11	0x0305	BUFFALO AirStation 11Mbps WLAN
product BUFFALO LPC_CF_CLT	0x0307	BUFFALO LPC-CF-CLT
product	BUFFALO	LPC3_CLT	0x030a	BUFFALO LPC3-CLT Ethernet Adapter
product BUFFALO WLI_CF_S11G	0x030b	BUFFALO AirStation 11Mbps CF WLAN</pre></div></div><div class=paragraph><p>我们就可以向<span class=filename>pccarddevs</span>中添加：</p></div><div class="literalblock programlisting"><div class=content><pre>product BUFFALO WLI2_CF_S11G	0x030c	BUFFALO AirStation ultra 802.11b CF</pre></div></div><div class=paragraph><p>目前，需要一个手动步骤来 重新产生<span class=filename>pccarddevs.h</span>，用来将这些标识符转换 到客户驱动程序。你在驱动程序中使用它们之前必须完成下面步骤：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd src/sys/dev/pccard</span>
<span class=c># make -f Makefile.pccarddevs</span></code></pre></div></div><div class=paragraph><p>一旦完成了这些步骤，你就可以向驱动程序中添加卡了。这只是一个 添加一行的简单操作：</p></div><div class="literalblock programlisting"><div class=content><pre>static const struct pccard_product wi_pccard_products[] = {
	PCMCIA_CARD(3COM, 3CRWE737A, 0),
	PCMCIA_CARD(BUFFALO, WLI_PCM_S11, 0),
	PCMCIA_CARD(BUFFALO, WLI_CF_S11G, 0),
+	PCMCIA_CARD(BUFFALO, WLI_CF2_S11G, 0),
	PCMCIA_CARD(TDK, LAK_CD011WL, 0),
	{ NULL }
};</pre></div></div><div class=paragraph><p>注意，我在我添加的行前面包含了<code>+</code>，但这只是 用来强调这一行。不要把它添加到实际驱动程序中。一旦你添加了这行，就 可以重新编译内核或模块，并试着看它是否能识别设备。如果它识别出设备 并能工作，请提交补丁。如果它不工作，请找出让它工作所需要的东西并 提交一个补丁。如果它根本不识别设备，那么你可能做错了什么，应当重新 检查每一步。</p></div><div class=paragraph><p>如果你是一个FreeBSD源代码的committer，并且所有东西看起来都 正常工作，则你应当把这些改变提交到树中。然而有些小技巧的东西你 需要考虑。首先，你必须提交<span class=filename>pccarddevs</span>文件到 树中。完成后，你必须重新产生<span class=filename>pccarddevs.h</span> 并将它作为另一次提交来提交（这是为了确保正确的 $FreeBSD$标签会留在后面的文件中）。最后，你需要把 其它东西提交到驱动程序。</p></div></div><div class=sect2><h3 id=pccard-pr>16.1.5. 提交新设备<a class=anchor href=#pccard-pr></a></h3><div class=paragraph><p>很多人直接把新设备的条目发送给作者。请不要那样做。请将它们作为 PR来提交，并将PR号码发送给作者用于记录。这样确保条目不会丢失。提交 PR时，补丁中没有必要包含<span class=filename>pccardevs.h</span>的diff， 因为那些东西可以重新产生。包含设备的描述和客户驱动程序的补丁是必要 的。如果你不知道名字，使用OEM99作为名字，作者将会调查后相应地调整 OEM99。提交者不应当提交OEM99，而应该找到最高的OEM条目并提交高于那个 的一个。</p></div></div></div></div></div><hr><div class=last-modified><p><strong>Last modified on</strong>: March 9, 2024 by <a href="https://cgit.freebsd.org/doc/commit/?id=6199af92e7" target=_blank>Danilo G. Baio</a></p></div><div class=buttons><div class=prev><i class="fa fa-angle-left" aria-hidden=true title=Prev></i><div class=container><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/sound class=direction>Prev</a></div></div><div class=home><i class="fa fa-home" aria-hidden=true title=Home></i><div class=container><a href=../ class=direction>Home</a></div></div><div class=next><div class=container><a href=http://172.16.201.134:1313/zh-cn/books/arch-handbook/partiii class=direction>Next</a></div><i class="fa fa-angle-right" aria-hidden=true title=Next></i></div></div><label class="hidden book-menu-overlay" for=menu-control></label></div><aside class=toc><div class=toc-content><h3>Table of Contents</h3><nav id=TableOfContents><ul><li><a href=#pccard-adddev>16.1. 添加设备</a></li></ul></nav><hr><div class=resources><h3>Resources</h3><ul class=contents><li><i class="fa fa-file-pdf-o" aria-hidden=true title="Download PDF"></i><a href=https://download.freebsd.org/doc/zh-cn/books/arch-handbook/arch-handbook_zh-cn.pdf>Download PDF</a></li><li><i class="fa fa-pencil-square-o" aria-hidden=true title="Edit this page"></i><a href=https://github.com/freebsd/freebsd-doc/blob/main/documentation/content/zh-cn/_index target=_blank>Edit this page</a></li></ul></div></div></aside><a class=to-top href=#top><i class="fa fa-arrow-circle-up" aria-hidden=true></i></a></main><footer><div class=footer-container><section class=logo-column><img src=http://172.16.201.134:1313/images/FreeBSD-colors.svg width=160 height=50 alt="FreeBSD logo"><div class=options-container><div class=language-container><a id=languages href=http://172.16.201.134:1313/zh-cn/languages><img src=http://172.16.201.134:1313/images/language.png class=language-image alt="Choose language">
<span>简体中文</span></a></div><div class=theme-container><select id=theme-chooser><option value=theme-system>System</option><option value=theme-light>Light</option><option value=theme-dark>Dark</option><option value=theme-high-contrast>High contrast</option></select></div></div></section><section class=about-column><h3 class=column-title>About</h3><ul class=column-elements-container><li><a href=https://www.freebsd.org/about/ target=_blank class=column-element>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/ target=_blank class=column-element>FreeBSD Foundation</a></li><li><a href=https://www.freebsd.org/where/ target=_blank class=column-element>Get FreeBSD</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct target=_blank class=column-element>Code of Conduct</a></li><li><a href=https://www.freebsd.org/security/ target=_blank class=column-element>Security Advisories</a></li></ul></section><section class=documentation-column><h3 class=column-title>Documentation</h3><ul class=column-elements-container><li><a href=/zh-cn class=column-element>Documentation portal</a></li><li><a href=https://man.FreeBSD.org target=_blank class=column-element>Manual pages</a></li><li><a href=https://papers.FreeBSD.org target=_blank class=column-element>Presentations and papers</a></li><li><a href=https://docs-archive.freebsd.org/doc/ target=_blank class=column-element>Previous versions</a></li><li><a href=https://docs-archive.freebsd.org/44doc/ target=_blank class=column-element>4.4BSD Documents</a></li><li><a href=https://wiki.freebsd.org/ target=_blank class=column-element>Wiki</a></li></ul></section><section class=community-column><h3 class=column-title>Community</h3><ul class=column-elements-container><li><a href=http://172.16.201.134:1313/zh-cn/articles/contributing class=column-element>Get involved</a></li><li><a href=https://forums.freebsd.org/ target=_blank class=column-element>Community forum</a></li><li><a href=https://lists.freebsd.org/ target=_blank class=column-element>Mailing lists</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank class=column-element>IRC Channels</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank class=column-element>Bug Tracker</a></li></ul></section><section class=legal-column><h3 class=column-title>Legal</h3><ul class=column-elements-container><li><a href=https://freebsdfoundation.org/donate/ target=_blank class=column-element>Donations</a></li><li><a href=https://www.freebsd.org/copyright/freebsd-license/ target=_blank class=column-element>Licensing</a></li><li><a href=https://www.freebsd.org/privacy/ target=_blank class=column-element>Privacy Policy</a></li><li><a href=https://www.freebsd.org/copyright/ target=_blank class=column-element>Legal notices</a></li></ul></section><section class=copyright-column><p>&copy; 1994-2024 The FreeBSD Project. All rights reserved</p><span>Made with <span class=heart>♥</span> by the FreeBSD Community</span></section></div></footer></body></html>