<!doctype html><html class=theme-light lang=es><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Guía para la configuración de un servidor de autenticación LDAP en FreeBSD"><meta name=keywords content="LDAP,Authentication,OpenLDAP,configuration,guide,tutorial,FreeBSD"><meta name=copyright content="1995-2024 The FreeBSD Foundation"><link rel=canonical href=http://172.16.201.134:1313/es/articles/ldap-auth/><title>Autenticación LDAP | Portal de documentación de FreeBSD</title>
<meta name=theme-color content="#790000"><meta name=color-scheme content="system light dark high-contrast"><link rel="shortcut icon" href=http://172.16.201.134:1313/favicon.ico><link rel=stylesheet href=http://172.16.201.134:1313/styles/main.min.css><link rel=stylesheet href=http://172.16.201.134:1313/css/font-awesome-min.css><script defer src=/js/theme-chooser.min.js></script><script defer src=/js/copy-clipboard.min.js></script><script defer src=/js/search.min.js></script><meta name=twitter:card content="summary"><meta name=twitter:domain content="docs.FreeBSD.org"><meta name=twitter:site content="@freebsd"><meta name=twitter:url content="https://twitter.com/freebsd"><meta property="og:title" content="Autenticación LDAP"><meta property="og:description" content="Guía para la configuración de un servidor de autenticación LDAP en FreeBSD"><meta property="og:type" content="website"><meta property="og:image" content="http://172.16.201.134:1313/favicon.ico"><meta property="og:image:alt" content="FreeBSD Logo"><meta property="og:locale" content="es"><meta property="og:url" content="http://172.16.201.134:1313/es/articles/ldap-auth/"><meta property="og:site_name" content="Portal de documentación de FreeBSD"><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","url":"http:\/\/172.16.201.134:1313\/es\/articles\/ldap-auth\/","name":"Portal de documentación de FreeBSD","headline":"Portal de documentación de FreeBSD","description":"FreeBSD Documentation Portal"}</script></head><body><header><div class=header-container><div class=logo-menu-bars-container><a href=https://www.FreeBSD.org class=logo><img src=http://172.16.201.134:1313/images/FreeBSD-monochromatic.svg width=160 height=50 alt="FreeBSD logo">
</a><label class=menu-bars for=menu-bars><i class="fa fa-bars" aria-hidden=true></i></label></div><input id=menu-bars type=checkbox><nav><ul class=menu><li class=menu-item><input id=about type=checkbox>
<a href=# aria-label="Navigate to About section"><label class=menu-item-description for=about>About
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/about/ target=_blank>About</a></li><li><a href=https://www.freebsd.org/about/ target=_blank>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/about-us/about-the-foundation/ target=_blank>FreeBSD Foundation</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct/ target=_blank>Code of Conduct</a></li></ul></li><li class=menu-item><input id=download type=checkbox>
<a href=# aria-label="Navigate to get FreeBSD section"><label class=menu-item-description for=download>Get FreeBSD
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/where/ target=_blank>Get FreeBSD</a></li><li><a href=https://www.freebsd.org/releases/ target=_blank>Release Information</a></li><li><a href=https://www.freebsd.org/releng/ target=_blank>Release Engineering</a></li><li><a href=https://www.freebsd.org/security/ target=_blank>Security Advisories</a></li></ul></li><li class=menu-item><input id=documentation type=checkbox>
<a href=# aria-label="Navigate to get Documentation section"><label class=menu-item-description for=documentation>Documentation
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=/es>Documentation portal</a></li><li><a href=http://172.16.201.134:1313/es/books/handbook>FreeBSD Handbook</a></li><li><a href=http://172.16.201.134:1313/es/books/porters-handbook>Porter's Handbook</a></li><li><a href=https://docs.FreeBSD.org/en/books/fdp-primer>Documentation Project Handbook</a></li><li><a href=https://man.FreeBSD.org target=_blank>Manual pages</a></li><li><a href=https://papers.FreeBSD.org target=_blank>Presentations and papers</a></li><li><a href=https://wiki.FreeBSD.org target=_blank>Wiki</a></li><li><a href=http://172.16.201.134:1313/es/books>Books</a></li><li><a href=http://172.16.201.134:1313/es/articles>Articles</a></li></ul></li><li class=menu-item><input id=community type=checkbox>
<a href=# aria-label="Navigate to get Community section"><label class=menu-item-description for=community>Community
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/community/>Community</a></li><li><a href=http://172.16.201.134:1313/es/articles/contributing>Get involved</a></li><li><a href=https://forums.freebsd.org/ target=_blank>Forum</a></li><li><a href=https://lists.freebsd.org/ target=_blank>Mailing lists</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank>IRC Channels</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank>Bug Tracker</a></li><li><a href=https://www.freebsd.org/support/ target=_blank>Support</a></li></ul></li></ul></nav><div class=search-donate-container><form class=search method=get id=search-header-form action=https://docs.freebsd.org/search name=search-header-form><input type=hidden name=DB value=es>
<input id=words name=P type=text size=20 maxlength=255>
<button>
<i class="fa fa-search" aria-hidden=true></i></button></form><div class=donate><a href=https://freebsdfoundation.org/donate/ target=_blank><span class=heart>♥</span>
Donate</a></div></div></div></header><main class=main-wrapper-article><div class=article><h1 class=title>Autenticación LDAP</h1><div class="admonitionblock note"><p><i class="fa fa-exclamation-circle" aria-hidden=true></i>
This translation may be out of date. To help with the translations please access the <a href=https://translate-dev.freebsd.org/ target=_blank>FreeBSD translations instance</a>.</p></div><div class=copyright>Copyright © 2007-2008 The FreeBSD Documentation Project</div><div class=legalnotice><a id=trademarks></a><details><summary>Marcas registradas</summary><p>FreeBSD es una marca registrada de la Fundación FreeBSD</p><p>Muchos de los nombres usados por los fabricantes y vendedores para diferenciar sus productos son designados como marcas comerciales. Allí donde estos nombres aparezcan en este documento y el Proyecto FreeBSD fuera consciente de la alegación de marca comercial, los nombres tienen a continuación el símbolo “™” o “®”.</p></details></div><div class=toc-mobile><h3>Tabla de contenidos</h3><nav id=TableOfContents><ul><li><a href=#preface>1. Prólogo</a></li><li><a href=#ldap>2. Configurando LDAP</a></li><li><a href=#client>3. Configuración del Cliente</a></li><li><a href=#secure>4. Consideraciones de Seguridad</a></li><li><a href=#useful>Apéndice A: Consideraciones Útiles</a></li><li><a href=#ssl-ca>Apéndice B: Certificados OpenSSL para LDAP</a></li></ul></nav></div><div id=preamble><div class=sectionbody><div class="paragraph abstract-title"><p>Resumen</p></div><div class=paragraph><p>Este documento pretende ser una guía para la configuración de un servidor LDAP (principalmente un servidor OpenLDAP) para la autenticación en FreeBSD. Esto es útil para situaciones en las que muchos servidores necesitan las mismas cuentas de usuario, por ejemplo, como reemplazo de NIS.</p></div><hr></div></div><div class=sect1><h2 id=preface>1. Prólogo<a class=anchor href=#preface></a></h2><div class=sectionbody><div class=paragraph><p>Este documento está destinado a proporcionar al lector una comprensión suficiente de LDAP para configurar un servidor LDAP. Este documento intentará proporcionar una explicación de <a class=package href=https://cgit.freebsd.org/ports/tree/net/nss_ldap/>net/nss_ldap</a> y <a class=package href=https://cgit.freebsd.org/ports/tree/security/pam_ldap/>security/pam_ldap</a> para usarlos con los servicios de la máquina del cliente para su uso con el servidor LDAP.</p></div><div class=paragraph><p>Cuando termine, el lector debería poder configurar e implementar un servidor FreeBSD que pueda alojar un directorio LDAP, y configurar e implementar un servidor FreeBSD que pueda autenticarse en un directorio LDAP.</p></div><div class=paragraph><p>Este artículo no pretende ser una explicación exhaustiva de las consideraciones de seguridad, robustez o mejores prácticas para configurar LDAP u otros de los servicios que se explican aquí. Aunque el autor tiene cuidado de hacer todo correctamente, no aborda los problemas de seguridad más allá del alcance general. Este artículo debe tenerse en cuenta para sentar las bases teóricas únicamente, y cualquier implementación real debe ir acompañado de un análisis cuidadoso de los requisitos.</p></div></div></div><div class=sect1><h2 id=ldap>2. Configurando LDAP<a class=anchor href=#ldap></a></h2><div class=sectionbody><div class=paragraph><p>LDAP significa "Lightweight Directory Access Protocol" (Protocolo Ligero de Acceso a Directorio) y es un subconjunto del Protocolo de Acceso a Directorio X.500. Su especificación más reciente se encuentra en <a href=http://www.ietf.org/rfc/rfc4510.txt>RFC4510</a>. En esencia es una base de datos que espera recibir muchas más consultas que escrituras.</p></div><div class=paragraph><p>En los ejemplos de este documento se utilizará el servidor LDAP <a href=http://www.openldap.org/>OpenLDAP</a>; aunque los procedimientos deberían ser aplicables a los diferentes servidores, la mayor parte de la administración es específica de OpenLDAP. Hay varias versiones del servidor en la colección de ports, por ejemplo, <a class=package href=https://cgit.freebsd.org/ports/tree/net/openldap24-server/>net/openldap24-server</a>. Los clientes necesitarán las librerías necesarias del paquete <a class=package href=https://cgit.freebsd.org/ports/tree/net/openldap24-client/>net/openldap24-client</a>.</p></div><div class=paragraph><p>Hay (básicamente) dos áreas del servicio LDAP que necesitan configuración. Lo primero es configurar un servidor para recibir conexiones correctamente, y lo segundo es añadir entradas al directorio del servidor para que las herramientas de FreeBSD sepan como interactuar con él.</p></div><div class=sect2><h3 id=ldap-connect>2.1. Configurar el Servidor para recibir Conexiones<a class=anchor href=#ldap-connect></a></h3><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Esta sección es específica de OpenLDAP. Si usas otro servidor, necesitarás consultar su propia documentación.</p></div></td></tr></tbody></table></div><div class=sect3><h4 id=ldap-connect-install>2.1.1. Instalando OpenLDAP<a class=anchor href=#ldap-connect-install></a></h4><div class=paragraph><p>Primero, instala OpenLDAP:</p></div><div id=oldap-install class=exampleblock><div class=title>Ejemplo 1. Instalando OpenLDAP</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/ports/net/openldap24-server</span>
<span class=c># make install clean</span></code></pre></div></div></div></div><div class=paragraph><p>Esto instala los binarios <code>slapd</code> y <code>slurpd</code>, junto con las librerías OpenLDAP necesarias.</p></div></div><div class=sect3><h4 id=ldap-connect-config>2.1.2. Configurando OpenLDAP<a class=anchor href=#ldap-connect-config></a></h4><div class=paragraph><p>Después necesitamos configurar OpenLDAP.</p></div><div class=paragraph><p>Es necesario que hagas obligatorio el uso de cifrado en tus conexiones al servidor LDAP; de lo contrario, las contraseñas de sus usuarios se transferirán en texto plano, lo que se considera inseguro. Las herramientas que utilizaremos admiten dos tipos muy similares de encriptación, SSL y TLS.</p></div><div class=paragraph><p>TLS significa "Seguridad en Capa de Transporte" (Transportation Layer Security). Los servicios que utilizan TLS suelen conectarse <em>a los mismos</em> puertos que los servicios que no utilizan TLS; por lo tanto un servidor SMTP que soporta TLS escuchará conexiones en el puerto 25 y un servidor LDAP escuchará conexiones en 389.</p></div><div class=paragraph><p>SSL significa "Capa de Sockets Seguros" (Secure Sockets Layer) y los servicios que implementan SSL <em>no</em> escuchan en los mismos puertos que sus equivalentes sin SSL. Por lo tanto SMTPS escucha en el puerto 465 (no en el 25), HTTPS escucha en el 443 y LDAPS en el 636.</p></div><div class=paragraph><p>La razón por la que SSL utiliza un puerto diferente a TLS es porque una conexión TLS empieza como texto plano y cambia al tráfico cifrado después de la directiva <code>STARTTLS</code>. Las conexiones SSL se cifran desde el principio. Aparte de eso, no hay diferencias sustanciales entre ambos.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Ajustaremos OpenLDAP para que utilice TLS ya que SSL se considera obsoleto.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Una vez que hemos instalado OpenLDAP, los siguientes parámetros en <span class=filename>/usr/local/etc/openldap/slapd.conf</span> habilitarán el uso de TLS:</p></div><div class="literalblock programlisting"><div class=content><pre>security ssf=128

TLSCertificateFile /path/to/your/cert.crt
TLSCertificateKeyFile /path/to/your/cert.key
TLSCACertificateFile /path/to/your/cacert.crt</pre></div></div><div class=paragraph><p>En este caso, <code>ssf=128</code> indica a OpenLDAP que solicite una encriptación de 128 bits para todas las conexiones, tanto para búsquedas como para actualizaciones. Este parámetro se podría configurar según las necesidades de seguridad de tu sitio web, pero es raro que necesites rebajarlo ya que la mayoría de las librerías cliente de LDAP soportan encriptación fuerte.</p></div><div class=paragraph><p>Los ficheros <span class=filename>cert.crt</span>, <span class=filename>cert.key</span>, y <span class=filename>cacert.crt</span> son necesarios para que los clientes te autentiquen <em>a ti</em> como el servidor LDAP válido. Si sólo quieres ejecutar un servidor, puedes crear un certificado auto firmado con OpenSSL:</p></div><div id=genrsa class=exampleblock><div class=title>Ejemplo 2. Generar una Clave RSA</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% openssl genrsa <span class=nt>-out</span> cert.key 1024
Generating RSA private key, 1024 bit long modulus
....................++++++
...++++++
e is 65537 <span class=o>(</span>0x10001<span class=o>)</span>

% openssl req <span class=nt>-new</span> <span class=nt>-key</span> cert.key <span class=nt>-out</span> cert.csr</code></pre></div></div></div></div><div class=paragraph><p>En este punto se te deberían preguntar algunos valores. Podrías introducir los valores que quisieras; sin embargo, es importante que el valor de "Common Name" sea el nombre de dominio del servidor LDAP completamente cualificado. En nuestro caso, y en los ejemplos, el servidor es <em>server.example.org</em>. Establecer este valor incorrectamente hará que los clientes no puedan conectar. Esto puede causar una gran frustración así que asegúrate de que sigues estos pasos con cuidado.</p></div><div class=paragraph><p>Finalmente, el certificado debe firmarse:</p></div><div id=self-sign class=exampleblock><div class=title>Ejemplo 3. Autofirmar el certificado</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% openssl x509 <span class=nt>-req</span> <span class=nt>-in</span> cert.csr <span class=nt>-days</span> 365 <span class=nt>-signkey</span> cert.key <span class=nt>-out</span> cert.crt
Signature ok
<span class=nv>subject</span><span class=o>=</span>/C<span class=o>=</span>AU/ST<span class=o>=</span>Some-State/O<span class=o>=</span>Internet Widgits Pty Ltd
Getting Private key</code></pre></div></div></div></div><div class=paragraph><p>Esto creará un certificado auto firmado que puede ser usado para las directivas en <span class=filename>slapd.conf</span>, donde <span class=filename>cert.crt</span> y <span class=filename>cacert.crt</span> son el mismo fichero. Si vas a utilizar muchos servidores OpenLDA (para replicación vía <code>slurpd</code>) querrás echar un vistazo a <a href=#ssl-ca>Certificados OpenSSL para LDAP</a> para generar una clave CA y usarla para firmar los certificados de servidor individuales.</p></div><div class=paragraph><p>Una vez hecho esto, escribe lo siguiente en <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>slapd_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>Después ejecuta <code>/usr/local/etc/rc.d/slapd start</code>. Esto debería arrancar OpenLDAP. Confirma que está escuchando en el puerto 389 con</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% sockstat <span class=nt>-4</span> <span class=nt>-p</span> 389
ldap     slapd      3261  7  tcp4   <span class=k>*</span>:389                 <span class=k>*</span>:<span class=k>*</span></code></pre></div></div></div><div class=sect3><h4 id=ldap-connect-client>2.1.3. Configurar el Cliente<a class=anchor href=#ldap-connect-client></a></h4><div class=paragraph><p>Instala el port <a class=package href=https://cgit.freebsd.org/ports/tree/net/openldap24-client/>net/openldap24-client</a> para obtener las librerías de OpenLDAP. Las máquinas cliente siempre tendrán las librerías de OpenLDAP pues que eso es lo único que soportan <a class=package href=https://cgit.freebsd.org/ports/tree/security/pam_ldap/>security/pam_ldap</a> y <a class=package href=https://cgit.freebsd.org/ports/tree/net/nss_ldap/>net/nss_ldap</a>, al menos por el momento.</p></div><div class=paragraph><p>El fichero de configuración para las librerías de OpenLDAP es <span class=filename>/usr/local/etc/openldap/ldap.conf</span>. Edita este fichero para que contenga los siguientes valores:</p></div><div class="literalblock programlisting"><div class=content><pre>base dc=example,dc=org
uri ldap://server.example.org/
ssl start_tls
tls_cacert /path/to/your/cacert.crt</pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Es importante que tus clientes tengan acceso a <span class=filename>cacert.crt</span>, de lo contrario no podrán conectarse.</p></div></td></tr></tbody></table></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Hay dos ficheros que se llaman <span class=filename>ldap.conf</span>. El primero es este fichero, que es para las librerías OpenLDAP y define cómo hablar con el servidor. El segundo es <span class=filename>/usr/local/etc/ldap.conf</span> y es para pam_ldap.</p></div></td></tr></tbody></table></div><div class=paragraph><p>En este punto deberías ser capaz de ejecutar <code>ldapsearch -Z</code> en la maquina cliente; <code>-Z</code> significa "usa TLS". Si encuentras un error, entonces algo está mal configurado; seguramente sean tus certificados. Utiliza los comandos <code>s_client</code> y <code>s_server</code> de <a href="https://man.freebsd.org/cgi/man.cgi?query=openssl&amp;sektion=1&amp;format=html">openssl(1)</a> para asegurarte de que están correctamente configurados y firmados.</p></div></div></div><div class=sect2><h3 id=ldap-database>2.2. Entradas en la base de datos<a class=anchor href=#ldap-database></a></h3><div class=paragraph><p>La autenticación en un directorio LDAP se logra generalmente al intentar vincularse al directorio como el usuario que se conecta. Esto se realiza mediante el establecimiento de un enlace "simple" en el directorio con el nombre de usuario proporcionado. Si hay una entrada con el <code>uid</code> igual al nombre de usuario y el atributo <code>userPassword</code> de la entrada coincide con la contraseña proporcionada, el enlace tiene éxito.</p></div><div class=paragraph><p>Lo primero que tenemos que hacer es averiguar en qué parte del directorio estarán nuestros usuarios.</p></div><div class=paragraph><p>La entrada base de nuestra base de datos es <code>dc=example,dc=org</code>. La mayoría de los clientes esperan una localización para los usuarios que sea algo como <code>ou=people,<em>base</em></code> así que es lo que se usará aquí. Sin embargo, ten en cuenta que esto es configurable.</p></div><div class=paragraph><p>Así que la entrada ldif para la unidad organizacional <code>people</code> se parecerá a:</p></div><div class="literalblock programlisting"><div class=content><pre>dn: ou=people,dc=example,dc=org
objectClass: top
objectClass: organizationalUnit
ou: people</pre></div></div><div class=paragraph><p>Todos los usuarios se crearán como subentradas de esta unidad organizativa.</p></div><div class=paragraph><p>Se podría pensar en la clase de objeto a la que pertenecerán sus usuarios. Por defecto, la mayoría de las herramientas utilizarán <code>people</code>, lo cual está bien si simplemente quieres proporcionar entradas para la autenticación. Sin embargo, si también vas a almacenar información de usuario en la base de datos LDAP, probablemente quieras usar <code>inetOrgPerson</code>, el cual dispone de muchos atributos útiles. En cualquier caso, los esquemas relevantes deben introducirse en el archivo <span class=filename>slapd.conf</span>.</p></div><div class=paragraph><p>Para este ejemplo utilizaremos la clase de objeto <code>person</code>. Si usas <code>inetOrgPerson</code>, los pasos son básicamente iguales, con la excepción de que se requiere el atributo <code>sn</code>.</p></div><div class=paragraph><p>Para añadir un usuario de pruebas llamado <code>tuser</code>, el ldif sería:</p></div><div class="literalblock programlisting"><div class=content><pre>dn: uid=tuser,ou=people,dc=example,dc=org
objectClass: person
objectClass: posixAccount
objectClass: shadowAccount
objectClass: top
uidNumber: 10000
gidNumber: 10000
homeDirectory: /home/tuser
loginShell: /bin/csh
uid: tuser
cn: tuser</pre></div></div><div class=paragraph><p>Yo empiezo los UIDs de mis usuarios de LDAP en el 10000 para evitar conflictos con las cuentas del sistema; puedes establecer el número que desees aquí, siempre que sea inferior a 65536.</p></div><div class=paragraph><p>También necesitamos entradas grupales. Son tan configurables como las entradas de usuario, pero usaremos los valores predeterminados que se muestran a continuación:</p></div><div class="literalblock programlisting"><div class=content><pre>dn: ou=people,dc=example,dc=org
objectClass: top
objectClass: organizationalUnit
ou: people

dn: cn=tuser,ou=groups,dc=example,dc=org
objectClass: posixGroup
objectClass: top
gidNumber: 10000
cn: tuser</pre></div></div><div class=paragraph><p>Para introducir estos en tu base de datos, puedes utilizar <code>slapadd</code> o <code>ldapadd</code> en un fichero que contenga esas entradas. De forma alternativa, puedes utilizar <a class=package href=https://cgit.freebsd.org/ports/tree/sysutils/ldapvi/>sysutils/ldapvi</a>.</p></div><div class=paragraph><p>La utilidad <code>ldapsearch</code> en la máquina del cliente debería devolver estas entradas. Si es así, la base de datos está configurada correctamente para ser utilizada como un servidor de autenticación LDAP.</p></div></div></div></div><div class=sect1><h2 id=client>3. Configuración del Cliente<a class=anchor href=#client></a></h2><div class=sectionbody><div class=paragraph><p>El cliente ya debería tener las librerías de OpenLDAP de <a href=#ldap-connect-client>Configurar el Cliente</a>, pero si estás instalando varias máquinas cliente, necesitarás instalar <a class=package href=https://cgit.freebsd.org/ports/tree/net/openldap24-client/>net/openldap24-client</a> en cada una de ellas.</p></div><div class=paragraph><p>FreeBSD requiere de la instalación de dos ports para autenticarse en un servidor LDAP, <a class=package href=https://cgit.freebsd.org/ports/tree/security/pam_ldap/>security/pam_ldap</a> y <a class=package href=https://cgit.freebsd.org/ports/tree/net/nss_ldap/>net/nss_ldap</a>.</p></div><div class=sect2><h3 id=client-auth>3.1. Autenticación<a class=anchor href=#client-auth></a></h3><div class=paragraph><p><a class=package href=https://cgit.freebsd.org/ports/tree/security/pam_ldap/>security/pam_ldap</a> se configura en el fichero <span class=filename>/usr/local/etc/ldap.conf</span>.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Este fichero es <em>diferente</em> del fichero de configuración de las librerías de OpenLDAP, <span class=filename>/usr/local/etc/openldap/ldap.conf</span>; sin embargo, tiene muchas de las mismas opciones; de hecho es un superconjunto de ese fichero. En lo que queda de sección, referencias a <span class=filename>ldap.conf</span> se refieren a <span class=filename>/usr/local/etc/ldap.conf</span>.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Por lo tanto, queremos copiar todos nuestros parámetros de configuración originales de <span class=filename>openldap/ldap.conf</span> al nuevo <span class=filename>ldap.conf</span>. Una vez hecho esto, le indicaremos a <a class=package href=https://cgit.freebsd.org/ports/tree/security/pam_ldap/>security/pam_ldap</a> qué buscar en el servidor de directorio.</p></div><div class=paragraph><p>Estamos identificando nuestros usuarios mediante el atributo <code>uid</code>. Para configurarlo (aunque es el valor por defecto), establece la directiva <code>pam_login_attribute</code> en <span class=filename>ldap.conf</span>:</p></div><div id=set-pam-login-attr class=exampleblock><div class=title>Ejemplo 4. Estableciendo <code>pam_login_attribute</code></div><div class=content><div class="literalblock programlisting"><div class=content><pre>pam_login_attribute uid</pre></div></div></div></div><div class=paragraph><p>Con esto ya establecido, <a class=package href=https://cgit.freebsd.org/ports/tree/security/pam_ldap/>security/pam_ldap</a> buscará el valor <code>uid=<em>username</em></code> en todo el directorio LDAP bajo <code>base</code>. Si encuentra una sola entrada, intentará vincular a ese usuario con la contraseña que se le ha pasado. Se vincula correctamente, entonces permitirá el acceso. En cualquier otro caso fallará.</p></div><div class=paragraph><p>Los usuarios cuyo shell no esté en <span class=filename>/etc/shells</span> no podrán iniciar sesión. Esto es muy importante cuando se configura Bash como la shell de usuario en el servidor LDAP. Bash no está incluido en la instalación estándar de FreeBSD. Cuando se instala desde un paquete o port, se encuentra en el directorio <span class=filename>/usr/local/bin/bash</span>. Comprueba que la ruta a la shell en el servidor esté configurada correctamente:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% getent passwd username</code></pre></div></div><div class=paragraph><p>Hay dos opciones cuando en la salida se muestra <code>/bin/bash</code> en la última columna. La primera es cambiar en el servidor LDAP la entrada del usuario para que apunte a <span class=filename>/usr/local/bin/bash</span>. La segunda es crear un enlace simbólico en la máquina LDAP cliente de forma que se pueda encontrar Bash en el lugar correcto:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ln -s /usr/local/bin/bash /bin/bash</span></code></pre></div></div><div class=paragraph><p>Asegúrate de que <span class=filename>/etc/shells</span> contiene las entradas tanto para <code>/usr/local/bin/bash</code> como para <code>/bin/bash</code>. El usuario ya será capaz de logearse en el sistema utilizando Bash como shell.</p></div><div class=sect3><h4 id=client-auth-pam>3.1.1. PAM<a class=anchor href=#client-auth-pam></a></h4><div class=paragraph><p>PAM, que significa "Pluggable Authentication Modules", es el método por el cual FreeBSD autentica la mayoría de sus sesiones. Para decirle a FreeBSD que queremos usar un servidor LDAP, tendremos que añadir una línea al archivo PAM apropiado.</p></div><div class=paragraph><p>La mayoría de las veces el fichero PAM apropiado es <span class=filename>/etc/pam.d/sshd</span>, si quieres usar SSH (recuerda establecer las opciones correspondientes en <span class=filename>/etc/ssh/sshd_config</span>, de lo contrario SSH no usará PAM).</p></div><div class=paragraph><p>Para usar PAM para la autenticación, añade la línea</p></div><div class="literalblock programlisting"><div class=content><pre>auth  sufficient  /usr/local/lib/pam_ldap.so  no_warn</pre></div></div><div class=paragraph><p>El lugar exacto en el que aparece esta línea en el fichero y las opciones que aparecen en la cuarta columna determinan el comportamiento exacto del mecanismo de autenticación; lee <a href="https://man.freebsd.org/cgi/man.cgi?query=pam&amp;sektion=d&amp;format=html">pam(d)</a></p></div><div class=paragraph><p>Con esta configuración deberías ser capaz de autenticar un usuario contra un directorio LDAP. PAM realizará un vínculo con tus credenciales, y si tiene éxito le dirá a SSH que permita el acceso.</p></div><div class=paragraph><p>Sin embargo, no es buena idea permitir que <em>cada</em> usuario del directorio pueda acceder a <em>todos</em> las máquinas clientes. Con la configuración actual, todo lo que necesita un usuario para iniciar sesión en una máquina es una entrada LDAP. Afortunadamente, hay algunas formas de restringir el acceso de los usuarios.</p></div><div class=paragraph><p><span class=filename>ldap.conf</span> admite la directiva <code>pam_groupdn</code>; cada cuenta que se conecta a esta máquina debe ser miembro del grupo especificado aquí. Por ejemplo, si tienes</p></div><div class="literalblock programlisting"><div class=content><pre>pam_groupdn cn=servername,ou=accessgroups,dc=example,dc=org</pre></div></div><div class=paragraph><p>en <span class=filename>ldap.conf</span>, solo los miembros de este grupo podrán iniciar sesión. Sin embargo hay algunas cosas a tener en cuenta.</p></div><div class=paragraph><p>Los miembros de este grupo se especifican en uno o más atributos <code>memberUid</code> y cada atributo debe tener el nombre completamente unívoco del miembro. Entonces <code>memberUid: someuser</code> no funcionará; debe ser:</p></div><div class="literalblock programlisting"><div class=content><pre>memberUid: uid=someuser,ou=people,dc=example,dc=org</pre></div></div><div class=paragraph><p>Además, esta directiva no se verifica en PAM durante la autenticación, se verifica durante la administración de la cuenta, por lo que necesitarás añadir más configuraciones en tus archivos de PAM en la sección de <code>account</code>. Esto, a su vez, requerirá que <em>cada</em> usuario se incluya en el grupo, lo cual no es necesariamente lo que queremos. Para evitar bloquear usuarios que no están en LDAP, debes habilitar el atributo <code>ignore_unknown_user</code>. Finalmente, debes configurar la opción <code>ignore_authinfo_unavail</code> para que el usuario no quede bloqueado en todos los ordenadores cuando el servidor LDAP no esté disponible.</p></div><div class=paragraph><p>Tu <span class=filename>pam.d/sshd</span> podría parecerse a esto:</p></div><div id=pam class=exampleblock><div class=title>Ejemplo 5. Ejemplo de <span class=filename>pam.d/sshd</span></div><div class=content><div class="literalblock programlisting"><div class=content><pre>auth            required        pam_nologin.so          no_warn
auth            sufficient      pam_opie.so             no_warn no_fake_prompts
auth            requisite       pam_opieaccess.so       no_warn allow_local
auth            sufficient      /usr/local/lib/pam_ldap.so      no_warn
auth            required        pam_unix.so             no_warn try_first_pass

account         required        pam_login_access.so
account         required        /usr/local/lib/pam_ldap.so      no_warn ignore_authinfo_unavail ignore_unknown_user</pre></div></div></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Como estamos añadiendo estas líneas específicamente a <span class=filename>pam.d/sshd</span>, esto solo tendrá efecto en las sesiones SSH. Los usuarios de LDAP no podrán iniciar sesión por consola. Para cambiar este comportamiento, examina los otros archivos en <span class=filename>/etc/pam.d</span> y modifícalos como corresponda.</p></div></td></tr></tbody></table></div></div></div><div class=sect2><h3 id=client-nss>3.2. Name Service Switch<a class=anchor href=#client-nss></a></h3><div class=paragraph><p>NSS es el servicio que mapea atributos a nombres. Por ejemplo, si un fichero es propiedad del usuario <code>1001</code>, una aplicación preguntará a NSS por el nombre de <code>1001</code> y podría obtener <code>bob</code> o <code>ted</code> o el cualquiera que sea el nombre del usuario.</p></div><div class=paragraph><p>Ahora que tenemos nuestra información en LDAP, necesitamos decirle a NSS que mire ahí cuando se le hagan preguntas.</p></div><div class=paragraph><p>Est es lo que hace el port <a class=package href=https://cgit.freebsd.org/ports/tree/net/nss_ldap/>net/nss_ldap</a>. Utiliza el mismo archivo de configuración que <a class=package href=https://cgit.freebsd.org/ports/tree/security/pam_ldap/>security/pam_ldap</a>, y no debería necesitar ningún parámetro adicional después de su instalación. En cambio, solo quedaría editar el archivo <span class=filename>/etc/nsswitch.conf</span> para aprovechar el directorio. Simplemente cambia las siguientes líneas:</p></div><div class="literalblock programlisting"><div class=content><pre>group: compat
passwd: compat</pre></div></div><div class=paragraph><p>por</p></div><div class="literalblock programlisting"><div class=content><pre>group: files ldap
passwd: files ldap</pre></div></div><div class=paragraph><p>Esto te permitirá asignar nombres de usuario a UIDs y UIDs a nombres de usuario.</p></div><div class=paragraph><p>¡Felicidades! Ahora deberías tener la autenticación de LDAP en funcionamiento.</p></div></div><div class=sect2><h3 id=caveats>3.3. Advertencias<a class=anchor href=#caveats></a></h3><div class=paragraph><p>Desafortunadamente, en el momento de escribir esto FreeBSD no soportaba cambiar las contraseñas de usuario con <a href="https://man.freebsd.org/cgi/man.cgi?query=passwd&amp;sektion=1&amp;format=html">passwd(1)</a>. Como resultado, la mayoría de los administradores tienen que implementar una solución por ellos mismos. Aquí proporciono algunos ejemplos. Observa que si escribes tu propio script de cambio de contraseñas deberías tener en cuenta algunas consideraciones de seguridad; lee <a href=#security-passwd>Almacenamiento de Contraseña</a></p></div><div id=chpw-shell class=exampleblock><div class=title>Ejemplo 6. Shell Script para Cambiar Contraseñas</div><div class=content><div class="literalblock programlisting"><div class=content><pre>#!/bin/sh

stty -echo
read -p &#34;Old Password: &#34; oldp; echo
read -p &#34;New Password: &#34; np1; echo
read -p &#34;Retype New Password: &#34; np2; echo
stty echo

if [ &#34;$np1&#34; != &#34;$np2&#34; ]; then
  echo &#34;Passwords do not match.&#34;
  exit 1
fi

ldappasswd -D uid=&#34;$USER&#34;,ou=people,dc=example,dc=org \
  -w &#34;$oldp&#34; \
  -a &#34;$oldp&#34; \
  -s &#34;$np1&#34;</pre></div></div></div></div><div class="admonitionblock caution"><table><tbody><tr><td class=icon><i class="fa icon-caution" title=Caution></i></td><td class=content><div class=paragraph><p>Este script apenas verifica errores, pero lo más importante es el poco cuidado con el que almacena sus contraseñas. Si haces algo como esto, establece al menos el valor de <code>security.bsd.see_other_uids</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sysctl security.bsd.see_other_uids=0</span></code></pre></div></div></td></tr></tbody></table></div><div class=paragraph><p>Se puede utilizar un enfoque más flexible (y probablemente más seguro) escribiendo un programa personalizado o incluso una interfaz web. Lo siguiente es parte de una librería de Ruby que puede cambiar las contraseñas LDAP. Se puede usar por línea de comandos y en la web.</p></div><div id=chpw-ruby class=exampleblock><div class=title>Ejemplo 7. Script en Ruby para Cambiar las Contraseñas</div><div class=content><div class="literalblock programlisting"><div class=content><pre>require &#39;ldap&#39;
require &#39;base64&#39;
require &#39;digest&#39;
require &#39;password&#39; # ruby-password

ldap_server = &#34;ldap.example.org&#34;
luser = &#34;uid=#{ENV[&#39;USER&#39;]},ou=people,dc=example,dc=org&#34;

# get the new password, check it, and create a salted hash from it
def get_password
  pwd1 = Password.get(&#34;New Password: &#34;)
  pwd2 = Password.get(&#34;Retype New Password: &#34;)

  raise if pwd1 != pwd2
  pwd1.check # check password strength

  salt = rand.to_s.gsub(/0\./, &#39;&#39;)
  pass = pwd1.to_s
  hash = &#34;{SSHA}&#34;+Base64.encode64(Digest::SHA1.digest(&#34;#{pass}#{salt}&#34;)+salt).chomp!
  return hash
end

oldp = Password.get(&#34;Old Password: &#34;)
newp = get_password

# We&#39;ll just replace it.  That we can bind proves that we either know
# the old password or are an admin.

replace = LDAP::Mod.new(LDAP::LDAP_MOD_REPLACE | LDAP::LDAP_MOD_BVALUES,
                        &#34;userPassword&#34;,
                        [newp])

conn = LDAP::SSLConn.new(ldap_server, 389, true)
conn.set_option(LDAP::LDAP_OPT_PROTOCOL_VERSION, 3)
conn.bind(luser, oldp)
conn.modify(luser, [replace])</pre></div></div></div></div><div class=paragraph><p>Aunque no se garantiza que esté a salvo de agujeros de seguridad (la contraseña se guarda en memoria, por ejemplo), esto es más limpio y más flexible que un simple script <code>sh</code>.</p></div></div></div></div><div class=sect1><h2 id=secure>4. Consideraciones de Seguridad<a class=anchor href=#secure></a></h2><div class=sectionbody><div class=paragraph><p>Ahora que tus máquinas (y posiblemente otros servicios) se están autenticando contra su servidor LDAP, este servidor tiene que estar protegido, así como <span class=filename>/etc/master.passwd</span> estaría en un servidor normal, y posiblemente aún más puesto que un servidor LDAP corrupto o comprometido rompería todos los servicios del cliente.</p></div><div class=paragraph><p>Recuerda, esta sección no es exhaustiva. Debes revisar continuamente tu configuración y procedimientos para mejorarlos.</p></div><div class=sect2><h3 id=secure-readonly>4.1. Establecer Atributos de Solo Lectura<a class=anchor href=#secure-readonly></a></h3><div class=paragraph><p>Varios atributos en LDAP deberían ser de sólo lectura. Si el usuario pudiera escribirlos, por ejemplo, un usuario podría cambiar su <code>uidNumber</code> a <code>0</code> ¡y obtener acceso <code>root</code>!</p></div><div class=paragraph><p>Para empezar, el atributo <code>userPassword</code> no debe ser legible por todo el mundo. Por defecto, cualquiera que pueda conectarse al servidor LDAP puede leer este atributo. Para deshabilitar esto, usa la siguiente configuración en el archivo <span class=filename>slapd.conf</span>:</p></div><div id=hide-userpass class=exampleblock><div class=title>Ejemplo 8. Ocultar Contraseñas</div><div class=content><div class="literalblock programlisting"><div class=content><pre>access to dn.subtree=&#34;ou=people,dc=example,dc=org&#34;
  attrs=userPassword
  by self write
  by anonymous auth
  by * none

access to *
  by self write
  by * read</pre></div></div></div></div><div class=paragraph><p>Esto evitará que se pueda leer el atributo <code>userPassword</code>, a la vez que seguirá permitiendo a los usuarios cambiar sus propias contraseñas.</p></div><div class=paragraph><p>Además, querrás evitar que los usuarios cambien algunos de sus atributos. De forma predeterminada, los usuarios pueden cambiar cualquier atributo (excepto aquellos en los que los esquemas LDAP mismos niegan cambios), como <code>uidNumber</code>. Para cerrar este agujero, modifica lo anterior a</p></div><div id=attrib-readonly class=exampleblock><div class=title>Ejemplo 9. Atributos de Solo Lectura</div><div class=content><div class="literalblock programlisting"><div class=content><pre>access to dn.subtree=&#34;ou=people,dc=example,dc=org&#34;
  attrs=userPassword
  by self write
  by anonymous auth
  by * none

access to attrs=homeDirectory,uidNumber,gidNumber
  by * read

access to *
  by self write
  by * read</pre></div></div></div></div><div class=paragraph><p>Esto evitará que los usuarios puedan hacerse pasar por otros usuarios.</p></div></div><div class=sect2><h3 id=secure-root>4.2. Definición de la Cuenta <code>root</code><a class=anchor href=#secure-root></a></h3><div class=paragraph><p>Habitualmente la cuenta <code>root</code> o la cuenta del gestor para el servicio de LDAP estará definida en el fichero de configuración. Por ejemplo, OpenLDAP soporta esto y funciona, pero puede dar lugar a problemas si <span class=filename>slapd.conf</span> se ve comprometido. Sería mejor usar esto sólo para entrar en LDAP y después definir ahí una cuenta <code>root</code>.</p></div><div class=paragraph><p>Es incluso mejor definir cuentas que tengan permisos limitados y omitir completamente la cuenta <code>root</code>. Por ejemplo, los usuarios que pueden crear o eliminar cuentas de usuario se añaden a un grupo, pero ellos mismos no pueden cambiar la pertenencia a este grupo. Esta política de seguridad ayudaría a mitigar los efectos de una contraseña que se haya podido filtrar.</p></div><div class=sect3><h4 id=manager-acct>4.2.1. Crear un Grupo de Mantenimiento<a class=anchor href=#manager-acct></a></h4><div class=paragraph><p>Supongamos que quieres que tu departamento de TI pueda cambiar los directorios home de los usuarios, pero no quieres que todos puedan añadir o eliminar usuarios. La forma de hacerlo es agregar un grupo para estos administradores:</p></div><div id=manager-acct-dn class=exampleblock><div class=title>Ejemplo 10. Crear un Grupo de Mantenimiento</div><div class=content><div class="literalblock programlisting"><div class=content><pre>dn: cn=homemanagement,dc=example,dc=org
objectClass: top
objectClass: posixGroup
cn: homemanagement
gidNumber: 121 # required for posixGroup
memberUid: uid=tuser,ou=people,dc=example,dc=org
memberUid: uid=user2,ou=people,dc=example,dc=org</pre></div></div></div></div><div class=paragraph><p>Y luego cambia los atributos de los permisos en <span class=filename>slapd.conf</span>:</p></div><div id=management-acct-acl class=exampleblock><div class=title>Ejemplo 11. ACLs para el Grupo de Administración del Directorio Home</div><div class=content><div class="literalblock programlisting"><div class=content><pre>access to dn.subtree=&#34;ou=people,dc=example,dc=org&#34;
  attr=homeDirectory
  by dn=&#34;cn=homemanagement,dc=example,dc=org&#34;
  dnattr=memberUid write</pre></div></div></div></div><div class=paragraph><p>Ahora el usuario <code>tuser</code> y el <code>user2</code> pueden cambiar los directorios home del otro.</p></div><div class=paragraph><p>En este ejemplo hemos concedido un subconjunto de poderes administrativos a algunos usuarios sin darles poder en otros dominios. La idea es que pronto ninguna cuenta de usuario tenga el poder de la cuenta de <code>root</code>, pero cada poder que tenga root lo tiene como mínimo algún otro usuario. Entonces la cuenta <code>root</code> se hace innecesaria y se puede eliminar.</p></div></div></div><div class=sect2><h3 id=security-passwd>4.3. Almacenamiento de Contraseña<a class=anchor href=#security-passwd></a></h3><div class=paragraph><p>OpenLDAP almacenará por defecto el valor del atributo <code>userPssword</code> de la misma forma que cualquier otro dato: en plano. La mayoría de las veces está codificado en base 64 lo que proporciona suficiente protección para evitar que un administrador honesto conozca tu contraseña, pero poco más.</p></div><div class=paragraph><p>Por lo tanto, es buena idea almacenar las contraseñas en un formato más seguro, como SSHA (salted SHA). Esto lo hace cualquier programa que uses para cambiar las contraseñas de los usuarios.</p></div></div></div></div><div class=sect1><h2 id=useful>Apéndice A: Consideraciones Útiles<a class=anchor href=#useful></a></h2><div class=sectionbody><div class=paragraph><p>Hay otros programas que pueden ser útiles, especialmente si tienes muchos usuarios y no quieres configurarlo todo manualmente.</p></div><div class=paragraph><p><a class=package href=https://cgit.freebsd.org/ports/tree/security/pam_mkhomedir/>security/pam_mkhomedir</a> es un módulo de PAM que siempre funciona; su propósito es crear directorios home para los usuarios que no los tienen. Si tienes docenas de servidores cliente y cientos de usuarios, es mucho más fácil usarlo y configurar un directorio tipo plantilla para cada directorio home.</p></div><div class=paragraph><p><a class=package href=https://cgit.freebsd.org/ports/tree/sysutils/cpu/>sysutils/cpu</a> es una utilidad tipo <a href="https://man.freebsd.org/cgi/man.cgi?query=pw&amp;sektion=8&amp;format=html">pw(8)</a> que se puede usar para gestionar usuarios en el directorio LDAP. Puedes llamarlo directamente o envolverlo en un script. Puede gestionar tanto TLS (con el flag <code>-x</code>) como SSL (directamente).</p></div><div class=paragraph><p><a class=package href=https://cgit.freebsd.org/ports/tree/sysutils/ldapvi/>sysutils/ldapvi</a> es una utilidad de gran ayuda para editar valores LDAP en una sintaxis similar a LDIF. El directorio (o subsección del directorio) se muestra en el editor elegido por la variable de entorno <code>EDITOR</code>. Esto facilita la realización de cambios de directorio a gran escala sin escribir una herramienta personalizada.</p></div><div class=paragraph><p><a class=package href=https://cgit.freebsd.org/ports/tree/security/openssh-portable/>security/openssh-portable</a> tienen la capacidad de contactar con un servidor LDAP para verificar claves SSH. Esto es realmente útil si tienes muchos servidores y no quieres copiar tus claves públicas a todos ellos.</p></div></div></div><div class=sect1><h2 id=ssl-ca>Apéndice B: Certificados OpenSSL para LDAP<a class=anchor href=#ssl-ca></a></h2><div class=sectionbody><div class=paragraph><p>Si alojas dos o más servidores LDAP, probablemente no quieras utilizar certificados autofirmados, ya que cada cliente deberá estar configurado para funcionar con cada certificado. Si bien esto es posible, no es tan simple como crear tu propia autoridad de certificación y firmar con ella los certificados de tus servidores.</p></div><div class=paragraph><p>Los pasos se muestran aquí tal cual, sin ninguna intención de explicar lo que hacen - se puede encontrar más información en <a href="https://man.freebsd.org/cgi/man.cgi?query=openssl&amp;sektion=1&amp;format=html">openssl(1)</a> y amigos.</p></div><div class=paragraph><p>Para crear una autoridad de certificación, simplemente necesitamos un certificado autofirmado y una clave. De nuevo, las instrucciones son</p></div><div id=make-cert class=exampleblock><div class=title>Ejemplo 12. Crear un Certificado</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% openssl genrsa <span class=nt>-out</span> root.key 1024
% openssl req <span class=nt>-new</span> <span class=nt>-key</span> root.key <span class=nt>-out</span> root.csr
% openssl x509 <span class=nt>-req</span> <span class=nt>-days</span> 1024 <span class=nt>-in</span> root.csr <span class=nt>-signkey</span> root.key <span class=nt>-out</span> root.crt</code></pre></div></div></div></div><div class=paragraph><p>Estos serán tu clave CA y certificado root. Probablemente quieras cifrar la clave y almacenarla en un lugar freso y seco; cualquier persona con acceso a ella puede hacerse pasar por uno de tus servidores LDAP.</p></div><div class=paragraph><p>A continuación, utilizando los dos pasos anteriores, crea la clave <span class=filename>ldap-server-one.key</span> y la solicitud de firma de certificado <span class=filename>ldap-server-one.csr</span>. Una vez que firmes la solicitud con la clave <span class=filename>root.key</span>, podrás usar <span class=filename>ldap-server-one.*</span> en tus servidores LDAP.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>No olvides utilizar un fully qualified domain name (nombre de dominio completamente cualificado) para el atributo "common name" al generar la solicitud de firma del certificado; de lo contrario, los clientes rechazarán la conexión y esto puede ser muy difícil de diagnosticar.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Para firmar la clave utiliza <code>-CA</code> y <code>_CAkey</code> en lugar de <code>-signkey</code>:</p></div><div id=ca-sign class=exampleblock><div class=title>Ejemplo 13. Firmar como Autoridad Certificadora</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% openssl x509 <span class=nt>-req</span> <span class=nt>-days</span> 1024 <span class=se>\</span>
<span class=nt>-in</span> ldap-server-one.csr <span class=nt>-CA</span> root.crt <span class=nt>-CAkey</span> root.key <span class=se>\</span>
<span class=nt>-out</span> ldap-server-one.crt</code></pre></div></div></div></div><div class=paragraph><p>El archivo resultante será el certificado que puedes utilizar en sus servidores LDAP.</p></div><div class=paragraph><p>Por último, para que los clientes confíen en todos tus servidores, distribuye <span class=filename>root.crt</span> (el <em>certificado</em>, ¡no la clave!) a cada cliente y especifícalo en la directiva <code>TLSCACertificateFile</code> de <span class=filename>ldap.conf</span>.</p></div></div></div><hr><div class=last-modified><p><strong>Last modified on</strong>: 11 de agosto de 2022 by <a href="https://cgit.freebsd.org/doc/commit/?id=14987e1630" target=_blank>Fernando Apesteguía</a></p></div></div><aside class=toc><div class=toc-content><h3>Tabla de contenidos</h3><nav id=TableOfContents><ul><li><a href=#preface>1. Prólogo</a></li><li><a href=#ldap>2. Configurando LDAP</a></li><li><a href=#client>3. Configuración del Cliente</a></li><li><a href=#secure>4. Consideraciones de Seguridad</a></li><li><a href=#useful>Apéndice A: Consideraciones Útiles</a></li><li><a href=#ssl-ca>Apéndice B: Certificados OpenSSL para LDAP</a></li></ul></nav><hr><div class=resources><h3>Recursos</h3><ul class=contents><li><i class="fa fa-file-pdf-o" aria-hidden=true title="Descargar PDF"></i><a href=https://download.freebsd.org/doc/es/articles/ldap-auth/ldap-auth_es.pdf>Descargar PDF</a></li><li><i class="fa fa-pencil-square-o" aria-hidden=true title="Editar esta página"></i><a href=https://github.com/freebsd/freebsd-doc/blob/main/documentation/content/es/_index target=_blank>Editar esta página</a></li></ul></div></div></aside></main><footer><div class=footer-container><section class=logo-column><img src=http://172.16.201.134:1313/images/FreeBSD-colors.svg width=160 height=50 alt="FreeBSD logo"><div class=options-container><div class=language-container><a id=languages href=http://172.16.201.134:1313/es/languages><img src=http://172.16.201.134:1313/images/language.png class=language-image alt="Elegir idioma">
<span>Spanish</span></a></div><div class=theme-container><select id=theme-chooser><option value=theme-system>System</option><option value=theme-light>Claro</option><option value=theme-dark>Oscuro</option><option value=theme-high-contrast>Alto contraste</option></select></div></div></section><section class=about-column><h3 class=column-title>About</h3><ul class=column-elements-container><li><a href=https://www.freebsd.org/about/ target=_blank class=column-element>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/ target=_blank class=column-element>FreeBSD Foundation</a></li><li><a href=https://www.freebsd.org/where/ target=_blank class=column-element>Get FreeBSD</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct target=_blank class=column-element>Code of Conduct</a></li><li><a href=https://www.freebsd.org/security/ target=_blank class=column-element>Security Advisories</a></li></ul></section><section class=documentation-column><h3 class=column-title>Documentation</h3><ul class=column-elements-container><li><a href=/es class=column-element>Documentation portal</a></li><li><a href=https://man.FreeBSD.org target=_blank class=column-element>Manual pages</a></li><li><a href=https://papers.FreeBSD.org target=_blank class=column-element>Presentations and papers</a></li><li><a href=https://docs-archive.freebsd.org/doc/ target=_blank class=column-element>Previous versions</a></li><li><a href=https://docs-archive.freebsd.org/44doc/ target=_blank class=column-element>4.4BSD Documents</a></li><li><a href=https://wiki.freebsd.org/ target=_blank class=column-element>Wiki</a></li></ul></section><section class=community-column><h3 class=column-title>Community</h3><ul class=column-elements-container><li><a href=http://172.16.201.134:1313/es/articles/contributing class=column-element>Get involved</a></li><li><a href=https://forums.freebsd.org/ target=_blank class=column-element>Community forum</a></li><li><a href=https://lists.freebsd.org/ target=_blank class=column-element>Mailing lists</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank class=column-element>IRC Channels</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank class=column-element>Bug Tracker</a></li></ul></section><section class=legal-column><h3 class=column-title>Legal</h3><ul class=column-elements-container><li><a href=https://freebsdfoundation.org/donate/ target=_blank class=column-element>Donations</a></li><li><a href=https://www.freebsd.org/copyright/freebsd-license/ target=_blank class=column-element>Licensing</a></li><li><a href=https://www.freebsd.org/privacy/ target=_blank class=column-element>Privacy Policy</a></li><li><a href=https://www.freebsd.org/copyright/ target=_blank class=column-element>Legal notices</a></li></ul></section><section class=copyright-column><p>&copy; 1994-2024 The FreeBSD Project. All rights reserved</p><span>Made with <span class=heart>♥</span> by the FreeBSD Community</span></section></div></footer></body></html>