<!doctype html><html class=theme-light lang=es><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Este documento proporciona información sobre las herramientas NanoBSD, las cuales pueden ser usadas para crear imágenes de FreeBSD para aplicaciones embebidas, adecuadas para su uso en una memoria USB, tarjeta de memoria, u otro medio de almacenamiento."><meta name=keywords content="nanobsd,guide,embedded,FreeBSD"><meta name=copyright content="1995-2024 The FreeBSD Foundation"><link rel=canonical href=http://172.16.201.134:1313/es/articles/nanobsd/><title>Introducción a NanoBSD | Portal de documentación de FreeBSD</title>
<meta name=theme-color content="#790000"><meta name=color-scheme content="system light dark high-contrast"><link rel="shortcut icon" href=http://172.16.201.134:1313/favicon.ico><link rel=stylesheet href=http://172.16.201.134:1313/styles/main.min.css><link rel=stylesheet href=http://172.16.201.134:1313/css/font-awesome-min.css><script defer src=/js/theme-chooser.min.js></script><script defer src=/js/copy-clipboard.min.js></script><script defer src=/js/search.min.js></script><meta name=twitter:card content="summary"><meta name=twitter:domain content="docs.FreeBSD.org"><meta name=twitter:site content="@freebsd"><meta name=twitter:url content="https://twitter.com/freebsd"><meta property="og:title" content="Introducción a NanoBSD"><meta property="og:description" content="Este documento proporciona información sobre las herramientas NanoBSD, las cuales pueden ser usadas para crear imágenes de FreeBSD para aplicaciones embebidas, adecuadas para su uso en una memoria USB, tarjeta de memoria, u otro medio de almacenamiento."><meta property="og:type" content="website"><meta property="og:image" content="http://172.16.201.134:1313/favicon.ico"><meta property="og:image:alt" content="FreeBSD Logo"><meta property="og:locale" content="es"><meta property="og:url" content="http://172.16.201.134:1313/es/articles/nanobsd/"><meta property="og:site_name" content="Portal de documentación de FreeBSD"><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","url":"http:\/\/172.16.201.134:1313\/es\/articles\/nanobsd\/","name":"Portal de documentación de FreeBSD","headline":"Portal de documentación de FreeBSD","description":"FreeBSD Documentation Portal"}</script></head><body><header><div class=header-container><div class=logo-menu-bars-container><a href=https://www.FreeBSD.org class=logo><img src=http://172.16.201.134:1313/images/FreeBSD-monochromatic.svg width=160 height=50 alt="FreeBSD logo">
</a><label class=menu-bars for=menu-bars><i class="fa fa-bars" aria-hidden=true></i></label></div><input id=menu-bars type=checkbox><nav><ul class=menu><li class=menu-item><input id=about type=checkbox>
<a href=# aria-label="Navigate to About section"><label class=menu-item-description for=about>About
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/about/ target=_blank>About</a></li><li><a href=https://www.freebsd.org/about/ target=_blank>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/about-us/about-the-foundation/ target=_blank>FreeBSD Foundation</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct/ target=_blank>Code of Conduct</a></li></ul></li><li class=menu-item><input id=download type=checkbox>
<a href=# aria-label="Navigate to get FreeBSD section"><label class=menu-item-description for=download>Get FreeBSD
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/where/ target=_blank>Get FreeBSD</a></li><li><a href=https://www.freebsd.org/releases/ target=_blank>Release Information</a></li><li><a href=https://www.freebsd.org/releng/ target=_blank>Release Engineering</a></li><li><a href=https://www.freebsd.org/security/ target=_blank>Security Advisories</a></li></ul></li><li class=menu-item><input id=documentation type=checkbox>
<a href=# aria-label="Navigate to get Documentation section"><label class=menu-item-description for=documentation>Documentation
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=/es>Documentation portal</a></li><li><a href=http://172.16.201.134:1313/es/books/handbook>FreeBSD Handbook</a></li><li><a href=http://172.16.201.134:1313/es/books/porters-handbook>Porter's Handbook</a></li><li><a href=https://docs.FreeBSD.org/en/books/fdp-primer>Documentation Project Handbook</a></li><li><a href=https://man.FreeBSD.org target=_blank>Manual pages</a></li><li><a href=https://papers.FreeBSD.org target=_blank>Presentations and papers</a></li><li><a href=https://wiki.FreeBSD.org target=_blank>Wiki</a></li><li><a href=http://172.16.201.134:1313/es/books>Books</a></li><li><a href=http://172.16.201.134:1313/es/articles>Articles</a></li></ul></li><li class=menu-item><input id=community type=checkbox>
<a href=# aria-label="Navigate to get Community section"><label class=menu-item-description for=community>Community
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/community/>Community</a></li><li><a href=http://172.16.201.134:1313/es/articles/contributing>Get involved</a></li><li><a href=https://forums.freebsd.org/ target=_blank>Forum</a></li><li><a href=https://lists.freebsd.org/ target=_blank>Mailing lists</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank>IRC Channels</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank>Bug Tracker</a></li><li><a href=https://www.freebsd.org/support/ target=_blank>Support</a></li></ul></li></ul></nav><div class=search-donate-container><form class=search method=get id=search-header-form action=https://docs.freebsd.org/search name=search-header-form><input type=hidden name=DB value=es>
<input id=words name=P type=text size=20 maxlength=255>
<button>
<i class="fa fa-search" aria-hidden=true></i></button></form><div class=donate><a href=https://freebsdfoundation.org/donate/ target=_blank><span class=heart>♥</span>
Donate</a></div></div></div></header><main class=main-wrapper-article><div class=article><h1 class=title>Introducción a NanoBSD</h1><div class="admonitionblock note"><p><i class="fa fa-exclamation-circle" aria-hidden=true></i>
This translation may be out of date. To help with the translations please access the <a href=https://translate-dev.freebsd.org/ target=_blank>FreeBSD translations instance</a>.</p></div><div class=copyright>Copyright © 2006 The FreeBSD Documentation Project</div><div class=legalnotice><a id=trademarks></a><details><summary>Marcas registradas</summary><p>FreeBSD es una marca registrada de la Fundación FreeBSD</p><p>Muchos de los nombres usados por los fabricantes y vendedores para diferenciar sus productos son designados como marcas comerciales. Allí donde estos nombres aparezcan en este documento y el Proyecto FreeBSD fuera consciente de la alegación de marca comercial, los nombres tienen a continuación el símbolo “™” o “®”.</p></details></div><div class=toc-mobile><h3>Tabla de contenidos</h3><nav id=TableOfContents><ul><li><a href=#intro>1. Introducción a NanoBSD</a></li><li><a href=#howto>2. NanoBSD paso a paso</a></li></ul></nav></div><div id=preamble><div class=sectionbody><div class="paragraph abstract-title"><p>Resumen</p></div><div class=paragraph><p>Este documento proporciona información sobre las herramientas NanoBSD, las cuales pueden ser usadas para crear imágenes de FreeBSD para aplicaciones embebidas, adecuadas para su uso en una memoria USB, tarjeta de memoria, u otro medio de almacenamiento.</p></div><hr></div></div><div class=sect1><h2 id=intro>1. Introducción a NanoBSD<a class=anchor href=#intro></a></h2><div class=sectionbody><div class=paragraph><p>NanoBSD es una herramienta desarrollada por Poul-Henning Kamp &lt;<a href=mailto:phk@FreeBSD.org>phk@FreeBSD.org</a>> y mantenida ahora por Warner Losh &lt;<a href=mailto:imp@FreeBSD.org>imp@FreeBSD.org</a>>. La herramienta crea una imagen para aplicaciones embebidas, adecuada para su uso en una memoria USB, tarjeta de memoria, u otro medio de almacenamiento.</p></div><div class=paragraph><p>Puede usarse para crear imágenes de instalación especializadas, diseñadas para instalar y mantener sistemas comúnmente llamados "aparatos de computación" (computer appliances). Los aparatos de computación incluyen el hardware y software en el mismo producto, lo cual significa que todas las aplicaciones vienen preinstaladas. El aparato se conecta a una red existente y puede comenzar a funcionar (casi) de inmediato.</p></div><div class=paragraph><p>Las funcionalidades de NanoBSD incluyen:</p></div><div class=ulist><ul><li><p>Los ports y paquetes funcionan de la misma manera que en FreeBSD — Cada aplicación puede ser instalada y usada en una imagen de NanoBSD, de la misma manera que en FreeBSD.</p></li><li><p>No se pierde funcionalidad - Si es posible hacer algo con FreeBSD, es posible hacer lo mismo con NanoBSD, excepto si las funciones específicas fueron explícitamente eliminadas de la imagen de NanoBSD cuando fue creada.</p></li><li><p>El sistema es de sólo lectura en tiempo de ejecución, por lo tanto es seguro quitar el cable de alimentación. No hay necesidad de correr <a href="https://man.freebsd.org/cgi/man.cgi?query=fsck&amp;sektion=8&amp;format=html">fsck(8)</a> después de un apagado abrupto del sistema.</p></li><li><p>Es fácil de crear y personalizar — Haciendo uso de un único script y solamente un archivo de configuración, es posible crear imágenes reducidas y personalizadas para satisfacer un conjunto arbitrario de requisitos.</p></li></ul></div></div></div><div class=sect1><h2 id=howto>2. NanoBSD paso a paso<a class=anchor href=#howto></a></h2><div class=sectionbody><div class=sect2><h3 id=design>2.1. El Diseño de NanoBSD<a class=anchor href=#design></a></h3><div class=paragraph><p>Una vez que la imagen está presente en el medio, es posible arrancar NanoBSD. El medio de almacenamiento está dividido por defecto en tres partes:</p></div><div class=ulist><ul><li><p>Dos particiones de imagen: <code>code#1</code> y <code>code#2</code>.</p></li><li><p>La partición del archivo de configuración, que se puede montar bajo el directorio <span class=filename>/cfg</span> en tiempo de ejecución.</p></li></ul></div><div class=paragraph><p>Estas particiones normalmente se montan como solo lectura.</p></div><div class=paragraph><p>Los directorios <span class=filename>/etc</span> y <span class=filename>/var</span> son discos malloc (malloc disks) <a href="https://man.freebsd.org/cgi/man.cgi?query=md&amp;sektion=4&amp;format=html">md(4)</a>.</p></div><div class=paragraph><p>La partición del archivo de configuración reside en el directorio <span class=filename>/cfg</span>. Contiene archivos para el directorio <span class=filename>/etc</span> y se monta brevemente como una partición de solo lectura tras el arranque del sistema; por lo tanto, es necesaria para copiar archivos modificados desde <span class=filename>/etc</span> de vuelta hacia el directorio <span class=filename>/cfg</span> si se espera que los cambios persistan después de reiniciar el sistema.</p></div><div class=exampleblock><div class=title>Ejemplo 1. Haciendo Cambios Persistentes en <span class=filename>/etc/resolv.conf</span></div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># vi /etc/resolv.conf</span>
<span class=o>[</span>...]
<span class=c># mount /cfg</span>
<span class=c># cp /etc/resolv.conf /cfg</span>
<span class=c># umount /cfg</span></code></pre></div></div></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>La partición que contiene <span class=filename>/cfg</span> debería ser montada solo en el arranque y cuando se sustituyan las directivas de los archivos de configuración.</p></div><div class=paragraph><p>Mantener <span class=filename>/cfg</span> montado todo el tiempo no es una buena idea, especialmente si el sistema NanoBSD se ejecuta en un medio de almacenamiento masivo que puede verse afectado negativamente por un alto número de escrituras en la partición (como cuando el sincronizador del sistema de archivos vuelca los datos hacia los discos del sistema).</p></div></td></tr></tbody></table></div></div><div class=sect2><h3 id=_compilar_una_imagen_de_nanobsd>2.2. Compilar una Imagen de NanoBSD<a class=anchor href=#_compilar_una_imagen_de_nanobsd></a></h3><div class=paragraph><p>Una imagen de NanoBSD se construye usando el sencillo script <span class=filename>nanobsd.sh</span> que puede encontrarse en el directorio <span class=filename>/usr/src/tools/tools/nanobsd</span>. Este script crea una imagen que se puede copiar al medio de almacenamiento utilizando la herramienta <a href="https://man.freebsd.org/cgi/man.cgi?query=dd&amp;sektion=1&amp;format=html">dd(1)</a>.</p></div><div class=paragraph><p>Los comandos necesarios para construir una imagen NanoBSD son:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/src/tools/tools/nanobsd </span><i class=conum data-value=1></i><b>(1)</b>
<span class=c># sh nanobsd.sh </span><i class=conum data-value=2></i><b>(2)</b>
<span class=c># cd /usr/obj/nanobsd.full </span><i class=conum data-value=3></i><b>(3)</b>
<span class=c># dd if=_.disk.full of=/dev/da0 bs=64k </span><i class=conum data-value=4></i><b>(4)</b></code></pre></div></div><div class="colist arabic"><table><tbody><tr><td><i class=conum data-value=1></i><b>1</b></td><td>Cambia el directorio actual por el directorio base del script de construcción de NanoBSD.</td></tr><tr><td><i class=conum data-value=2></i><b>2</b></td><td>Comienza el proceso de compilación.</td></tr><tr><td><i class=conum data-value=3></i><b>3</b></td><td>Cambia el directorio actual por el lugar donde se encuentran las imágenes compiladas.</td></tr><tr><td><i class=conum data-value=4></i><b>4</b></td><td>Instala NanoBSD en el medio de almacenamiento.</td></tr></tbody></table></div><div class=sect3><h4 id=_opciones_al_construir_una_imagen_de_nanobsd>2.2.1. Opciones al Construir una Imagen de NanoBSD<a class=anchor href=#_opciones_al_construir_una_imagen_de_nanobsd></a></h4><div class=paragraph><p>Cuando se construye una imagen de NanoBSD, se pueden pasar varias opciones a <span class=filename>nanobsd.sh</span> en la línea de comando. Estas opciones pueden tener un impacto significativo en el proceso de construcción.</p></div><div class=paragraph><p>Algunas opciones tienen propósitos de verbosidad:</p></div><div class=ulist><ul><li><p><code>-h</code>: imprime un resumen de la página de ayuda.</p></li><li><p><code>-q</code>: hace que la salida sea más silenciosa.</p></li><li><p><code>-v</code>: hace que la salida sea más verbosa</p></li></ul></div><div class=paragraph><p>Otras opciones se pueden usar para restringir el proceso de construcción. A veces no es necesario reconstruir todo desde las fuentes, especialmente si ya se ha construido una imagen y sólo se han hecho pequeños cambios.</p></div><div class=ulist><ul><li><p><code>-k</code>: no construir el kernel</p></li><li><p><code>-w</code>: no construir world</p></li><li><p><code>-b</code>: no construir ni el kernel ni world</p></li><li><p><code>-i</code>: no construir una imagen de disco. Como no se creará un fichero, no será posible copiarlo con <a href="https://man.freebsd.org/cgi/man.cgi?query=dd&amp;sektion=1&amp;format=html">dd(1)</a> al medio de almacenamiento.</p></li><li><p><code>-f</code>: no construir una imagen de disco de la primera partición (útil para actualizaciones)</p></li><li><p><code>-n</code>: añade <code>-DNO_CLEAN</code> a <code>buildworld</code>, <code>buildkernel</code>. También se guardan todos los ficheros que se hayan construido en una ejecución previa.</p></li></ul></div><div class=paragraph><p>Se puede usar un fichero de configuración para ajustar cuantos elementos como se quiera. Cárgalo con <code>-c</code></p></div><div class=paragraph><p>Las últimas opciones son:</p></div><div class=ulist><ul><li><p><code>-K</code>: no instalar un kernel. Una imagen de disco sin un kernel no será capaz de realizar una secuencia normal de arranque.</p></li></ul></div></div><div class=sect3><h4 id=_el_proceso_completo_de_creación_de_imágenes>2.2.2. El Proceso Completo de Creación de Imágenes<a class=anchor href=#_el_proceso_completo_de_creación_de_imágenes></a></h4><div class=paragraph><p>El proceso completo de creación de imágenes tiene muchos pasos. Los pasos exactos dependerán de las opciones escogidas cuando se inicia el script. Asumiendo que el script se ejecuta sin opciones particulares, esto es lo que pasará.</p></div><div class="olist arabic"><ol class=arabic><li><p><code>run_early_customize</code>: comandos que se definen en un fichero de configuración que se ha proporcionado.</p></li><li><p><code>clean_build</code>: Simplemente limpia el entorno de construcción mediante el borrado de ficheros construidos previamente.</p></li><li><p><code>make_conf_build</code>: Ensambla make.conf a partir de las variables <code>CONF_WORLD</code> y <code>CONF_BUILD</code>.</p></li><li><p><code>build_world</code>: Construye world.</p></li><li><p><code>build_kernel</code>: Construye los ficheros del kernel.</p></li><li><p><code>clean_world</code>: Limpia el directorio de destino.</p></li><li><p><code>make_conf_install</code>: Ensambla make.conf a partir de las variables <code>CONF_WORLD</code> y <code>CONF_INSTALL</code>.</p></li><li><p><code>install_world</code>: Instala todos los ficheros construidos durante la fase <code>buildworld</code>.</p></li><li><p><code>install_etc</code>: Instala los ficheros necesarios en el directorio <span class=filename>/etc</span> basándose en el comando <code>make distribution</code>.</p></li><li><p><code>setup_nanobsd_etc</code>: la primera configuración específica de NanoBSD tiene lugar en esta fase. Se crea <span class=filename>/etc/diskless</span> y se define el sistema de ficheros raíz como sólo lectura.</p></li><li><p><code>install_kernel</code>: se instalan los ficheros del kernel y los módulos.</p></li><li><p><code>run_customize</code>: se llama a todas las rutinas personalizadas definidas por el usuario.</p></li><li><p><code>setup_nanobsd</code>: se configura un esquema especial de directorios de configuración. <span class=filename>/usr/local/etc</span> se mueve a <span class=filename>/etc/local</span> y se crea un enlace simbólico de vuelta desde <span class=filename>/etc/local</span> a <span class=filename>/usr/local/etc</span>.</p></li><li><p><code>prune_usr</code>: se eliminan los directorios vacíos de <span class=filename>/usr</span>.</p></li><li><p><code>run_late_customize</code>: en este punto se ejecutan los últimos scripts personalizados.</p></li><li><p><code>fixup_before_diskimage</code>: Lista todos los ficheros instalados en un metalog.</p></li><li><p><code>create_diskimage</code>: crea la imagen de disco real basada en los parámetros proporcionados sobre las geometrías del disco.</p></li><li><p><code>last_orders</code>: no hace nada de momento.</p></li></ol></div></div></div><div class=sect2><h3 id=_personalizar_una_imagen_de_nanobsd>2.3. Personalizar una Imagen de NanoBSD<a class=anchor href=#_personalizar_una_imagen_de_nanobsd></a></h3><div class=paragraph><p>Esta es probablemente la característica más importante y más interesante de NanoBSD. Es también donde pasarás la mayor parte del tiempo cuando desarrolles con NanoBSD.</p></div><div class=paragraph><p>Invocar el siguiente comando forzará a <span class=filename>nanobsd.sh</span> a leer su configuración desde el archivo <span class=filename>myconf.nano</span> situado en el directorio actual:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sh nanobsd.sh -c myconf.nano</span></code></pre></div></div><div class=paragraph><p>La personalización puede realizarse de dos formas:</p></div><div class=ulist><ul><li><p>Opciones de configuración</p></li><li><p>Funciones personalizadas</p></li></ul></div><div class=sect3><h4 id=_opciones_de_configuración>2.3.1. Opciones de Configuración<a class=anchor href=#_opciones_de_configuración></a></h4><div class=paragraph><p>Con las opciones de ajuste, es posible configurar opciones que se pasan tanto a la fase <code>buildworld</code> como a la fase <code>installworld</code> del proceso de construcción de NanoBSD, así como opciones internas pasadas al proceso principal de construcción de NanoBSD. Mediante estas opciones es posible hacer más pequeño el sistema de forma que quepa en tan solo 64 MB. Puedes utilizar las opciones de configuración para hacer FreeBSD incluso más pequeño hasta que consista sólo en el kernel y en dos o tres ficheros en espacio de usuario.</p></div><div class=paragraph><p>El archivo de configuración consiste en opciones de configuración que sobrescriben los valores por defecto. Las directivas más importantes son:</p></div><div class=ulist><ul><li><p><code>NANO_NAME</code> - Nombre de la construcción (utilizado para los nombres de los directorios de construcción).</p></li><li><p><code>NANO_SRC</code> - Ruta al árbol de fuentes utilizado para construir la imagen.</p></li><li><p><code>NANO_KERNEL</code> - Nombre del fichero de configuración del kernel utilizado para construir el kernel.</p></li><li><p><code>CONF_BUILD</code> - Opciones pasadas a la fase de construcción <code>buildworld</code>.</p></li><li><p><code>CONF_INSTALL</code> - Opciones pasadas a la fase de construcción <code>installworld</code>.</p></li><li><p><code>CONF_WORLD</code> - Opciones pasadas a las fases de construcción <code>buildworld</code> e <code>installworld</code>.</p></li><li><p><code>FlashDevice</code> - Define el tipo de medio a utilizar. Consulta <span class=filename>FlashDevice.sub</span> para más detalles.</p></li></ul></div><div class=paragraph><p>Hay muchas más opciones de configuración que podrían ser relevantes dependiendo del tipo de NanoBSD que se desea.</p></div><div class=sect4><h5 id=_personalización_general>2.3.1.1. Personalización General<a class=anchor href=#_personalización_general></a></h5><div class=paragraph><p>Hay tres etapas, por diseño, en las cuales es posible hacer cambios que afectan al proceso de construcción, simplemente estableciendo una variable en el fichero de configuración proporcionado:</p></div><div class=ulist><ul><li><p><code>run_early_customize</code>: antes de que se haga cualquier otra cosa.</p></li><li><p><code>run_customize</code>: después de que se hayan dispuesto todos los ficheros estándar</p></li><li><p><code>run_late_customize</code>: al final del proceso, justo antes de que se cree la imagen definitiva de NanoBSD.</p></li></ul></div><div class=paragraph><p>Para personalizar una imagen de NanoBSD, en cualquiera de estos pasos, es mejor añadir un valor específico a la variable que corresponda.</p></div><div class=paragraph><p>La variable <code>NANO_EARLY_CUSTOMIZE</code> se utiliza en el primer paso del proceso de construcción. En este momento no hay un ejemplo de lo que se puede hacer con esta variable, pero esto podría cambiar en el futuro.</p></div><div class=paragraph><p>La variable <code>NANO_CUSTOMIZE</code> se utiliza después de que se hayan instalados los ficheros del kernel, world y configuración y de que los ficheros de etc se hayan configurado para que sean una instalación de NanoBSD. Así que es el paso correcto del proceso de construcción para ajustar las opciones de configuración y añadir paquetes como se hace en el ejemplo cust_nobeastie.</p></div><div class=paragraph><p>La variable <code>NANO_LATE_CUSTOMIZE</code> se usa justo antes de que se cree la imagen de disco, así que es el último momento para poder cambiar algo. Recuerda que la rutina <code>setup_nanobsd</code> ya se ha ejecutado y que los directorios <span class=filename>etc</span>, <span class=filename>conf</span> and <span class=filename>cfg</span> y subdirectorios ya se han modificado, así que no es el momento de cambiar nada. Más bien es posible añadir o eliminar ficheros específicos.</p></div></div><div class=sect4><h5 id=_opciones_de_arranque>2.3.1.2. Opciones de Arranque<a class=anchor href=#_opciones_de_arranque></a></h5><div class=paragraph><p>También hay variables que pueden cambiar la forma en la que arranca una imagen de NanoBSD. Se pasan dos opciones a <a href="https://man.freebsd.org/cgi/man.cgi?query=boot0cfg&amp;sektion=8&amp;format=html">boot0cfg(8)</a> para inicializar el sector de arranque de la imagen de disco:</p></div><div class=ulist><ul><li><p><code>NANO_BOOT0CFG</code></p></li><li><p><code>NANO_BOOTLOADER</code></p></li></ul></div><div class=paragraph><p>Con <code>NANO_BOOTLOADER</code> se puede escoger un fichero de bootloader. Las opciones posibles más habituales son <span class=filename>boot0sio</span> y <span class=filename>boot0</span> dependiendo de si el dispositivo tiene o no puerto serie. Es mejor evitar proporcionar un bootloader diferente, pero es posible. Para hacerlo, lo mejor es consultar el capítulo sobre el proceso de arranque en el <a href=https://docs.freebsd.org/es/books/handbook/boot>FreeBSD Handbook</a>.</p></div><div class=paragraph><p>Con <code>NANO_BOOT0CFG</code> se puede modificar el proceso de arranque como por ejemplo seleccionar desde qué partición arrancará la imagen de NanoBSD. Es mejor consultar la página <a href="https://man.freebsd.org/cgi/man.cgi?query=boot0cfg&amp;sektion=8&amp;format=html">boot0cfg(8)</a> antes de cambiar el valor por defecto de esta variable. Una opción que podría ser interesante cambiar es el tiempo de espera del procedimiento de arranque. Para ello, se puede cambiar la variable <code>NANO_BOOT0CFG</code> a <code>"-o packet -s 1 -m 3 -t 36"</code>. De este modo el proceso de arranque empezaría después de aproximadamente 2 segundos; porque es raro que se quiera esperar 10 segundos antes de arrancar.</p></div><div class=paragraph><p>Está bien saber esto: la variable <code>NANO_BOOT2CFG</code> sólo se usa en la rutina <code>cust_comconsole</code> que se puede llamar en el paso <code>NANO_CUSTOMIZE</code> si el dispositivo tiene un puerto serie y toda la entrada y salida de la consola tiene que ir a través de él. Asegúrate de comprobar los parámetros relevantes del puerto serie ya que establecer un parámetro a un valor erróneo puede inhabilitar el puerto.</p></div></div><div class=sect4><h5 id=_creación_de_una_imagen_de_disco>2.3.1.3. Creación de una Imagen de Disco<a class=anchor href=#_creación_de_una_imagen_de_disco></a></h5><div class=paragraph><p>Al final del proceso de arranque se encuentra la creación de la imagen de disco. Con este paso, el script de Nano BSD proporciona un fichero que puede ser copiado simplemente en el disco del dispositivo y que hará que arranque.</p></div><div class=paragraph><p>Hay muchas variables que se tienen que configurar bien para que el script produzca una imagen de disco que sea utilizable.</p></div><div class=ulist><ul><li><p>La variable <code>NANO_DRIVE</code> tiene que establecerse al nombre de la unidad del medio en tiempo de ejecución. Normalmente, el valor por defecto <code>ada0</code>, que representa al primer dispositivo <code>IDE</code>/<code>ATA</code>/<code>SATA</code> en la unidad, se espera que sea correcto pero se podría usar un tipo diferente de almacenamiento - como una llave USB, en cuyo caso sería mejor usar da0.</p></li><li><p>La variable <code>NANO_MEDIASIZE</code> se tiene que establecer al tamaño (en sectores de 512 bytes) del medio de almacenamiento que se utilizará. Si lo estableces de forma incorrecta, es posible que la imagen de NanoBSD no arranque en absoluto y se mostrará un mensaje durante el arranque avisando de una geometría de disco incorrecta.</p></li><li><p>Los directorios <span class=filename>/etc</span>, <span class=filename>/var</span>, y <span class=filename>/tmp</span> se reservan como discos(malloc) <a href="https://man.freebsd.org/cgi/man.cgi?query=md&amp;sektion=4&amp;format=html">md(4)</a> en el arranque; de forma que sus tamaños se pueden ajustar par satisfacer las necesidades del dispositivo. La variable <code>NANO_RAM_ETCSIZE</code> establece el tamaño de <span class=filename>/etc</span>; y la variable <code>NANO_RAM_TMPVARSIZE</code> establece el tamaño de los directorios <span class=filename>/var</span> y <span class=filename>/tmp</span> puesto que <span class=filename>/tmp</span> está enlazado simbólicamente a <span class=filename>/var/tmp</span>. Por defecto, los tamaños de ambos discos malloc se establece a 20MB cada uno. Siempre se pueden cambiar, pero normalmente <span class=filename>/etc</span> no crece demasiado por lo que 20MB es un buen puntor de partida, mientras que <span class=filename>/var</span> y especialmente <span class=filename>/tmp</span> pueden crecer mucho más si no ponemos cuidado. Para sistemas con limitaciones de memoria, se pueden escoger sistemas de ficheros más pequeños.</p></li><li><p>Como NanoBSD está diseñado principalmente para construir una imagen de un sistema para un aparato, se asume que el medio de almacenamiento será relativamente pequeño. Por esa razón, el sistema de ficheros que se establece está configurado para tener un tamaño de bloque pequeño (4Kb) y un tamaño de fragmento pequeño (512b). Las opciones de configuración del sistema de ficheros se pueden configurar mediante la variable <code>NANO_NEWFS</code>, pero la sintaxis debe respetar el formato del comando <a href="https://man.freebsd.org/cgi/man.cgi?query=newfs&amp;sektion=8&amp;format=html">newfs(8)</a> . El sistema de ficheros también tiene Soft Updates activado por defecto. Se puede leer sobre esto en el <a href=https://docs.freebsd.org/es/books/handbook/>FreeBSD Handbook</a>.</p></li><li><p>Los diferentes tamaños de partición se pueden establecer mediante el uso de <code>NANO_CODESIZE</code>, <code>NANO_CONFSIZE</code>, y <code>NANO_DATASIZE</code> como múltiplos de sectores de 512 bytes. <code>NANO_SIZE</code> define el tamaño de las dos primeras particiones: <code>code#1</code> and <code>code#2</code>. Tienen que ser suficientemente grandes para contener todos los ficheros que se producirán como resultado de los procesos <code>buildworld</code> y <code>buildkernel</code>. <code>NANO_CONFSIZE</code> define el tamaño de la partición de ficheros de configuración por lo que no tiene que ser muy grande; pero no la hagas tan pequeña que no pueda albergar los ficheros. Por último <code>NANO_DATASIZE</code> define el tamaño de una partición opcional, que se puede usar en el dispositivo. Por ejemplo, se puede utilizar la última partición para mantener en disco ficheros creados al vuelo.</p></li></ul></div></div></div><div class=sect3><h4 id=_funciones_personalizadas>2.3.2. Funciones Personalizadas<a class=anchor href=#_funciones_personalizadas></a></h4><div class=paragraph><p>Es posible afinar NanoBSD utilizando funciones del shell en el fichero de configuración. El siguiente ejemplo ilustra el modelo básico de las funciones personalizadas:</p></div><div class="literalblock programlisting"><div class=content><pre>cust_foo () (
	echo &#34;bar=baz&#34; &gt; \
		${NANO_WORLDDIR}/etc/foo
)
customize_cmd cust_foo</pre></div></div><div class=paragraph><p>Un ejemplo más útil de una función de personalización es el siguiente, el cual cambia el tamaño por defecto del directorio <span class=filename>/etc</span> de 5MB a 30MB:</p></div><div class="literalblock programlisting"><div class=content><pre>cust_etc_size () (
	cd ${NANO_WORLDDIR}/conf
	echo 30000 &gt; default/etc/md_size
)
customize_cmd cust_etc_size</pre></div></div><div class=paragraph><p>Estas son algunas funciones de personalización incluidas por defecto y listas para ser usadas:</p></div><div class=ulist><ul><li><p><code>cust_comconsole</code> - Deshabilita <a href="https://man.freebsd.org/cgi/man.cgi?query=getty&amp;sektion=8&amp;format=html">getty(8)</a> en los dispositivos VGA (los nodos de dispositivo <span class=filename>/dev/ttyv*</span>) y habilita el uso del puerto serie COM1 como consola del sistema.</p></li><li><p><code>cust_allow_ssh_root</code> - Permite al usuario <code>root</code> hacer login vía <a href="https://man.freebsd.org/cgi/man.cgi?query=sshd&amp;sektion=8&amp;format=html">sshd(8)</a>.</p></li><li><p><code>cust_install_files</code> - Instala ficheros desde el directorio <span class=filename>nanobsd/Files</span>, el cual contiene algunos scripts útiles para la administración del sistema.</p></li></ul></div></div><div class=sect3><h4 id=_agregando_paquetes>2.3.3. Agregando Paquetes<a class=anchor href=#_agregando_paquetes></a></h4><div class=paragraph><p>Se pueden agregar paquetes a una imagen de NanoBSD para proporcionar funcionalidades específicas para el dispositivo. Para ello, o bien:</p></div><div class=ulist><ul><li><p>Añade <code>cust_pkgng</code> a la variable <code>NANO_CUSTOMIZE</code>, o</p></li><li><p>Añade el comando <code>'customize_cmd cust_pkgng'</code> en un fichero de configuración personalizado.</p></li></ul></div><div class=paragraph><p>Ambos métodos consiguen el mismo resultado: lanzar la rutina <code>cust_pkgng</code>. Esta rutina recorrerá el directorio <code>NANO_PACKAGE_DIR</code> para encontrar bien todos los paquetes o sólo la lista de paquetes de la variable <code>NANO_PACKAGE_LIST</code>.</p></div><div class=paragraph><p>Cuando se instalan aplicaciones mediante pkg en un entorno FreeBSD estándar, es habitual que el proceso de instalación cree ficheros de configuración en el directorio <span class=filename>/usr/local/etc</span>, y scripts de arranque en el directorio <span class=filename>/usr/local/etc/rc.d</span>. De modo que después de que se hayan instalado los paquetes necesarios, necesitan ser configurados para que estén listos para usar. Para ello se tienen que instalar los ficheros de configuración necesarios en los directorios correctos. Esto se puede conseguir escribiendo rutinas dedicadas o se puede utilizar la rutina genérica <code>cust_install_files</code> para copiar los ficheros desde el directorio <span class=filename>/usr/src/tools/tools/nanobsd/Files</span>. Para cada paquete normalmente se necesita añadir una línea (a veces varias) en <span class=filename>/etc/rc.conf</span>.</p></div></div><div class=sect3><h4 id=_ejemplo_de_archivo_de_configuración>2.3.4. Ejemplo de Archivo de Configuración<a class=anchor href=#_ejemplo_de_archivo_de_configuración></a></h4><div class=paragraph><p>Un ejemplo completo de un archivo de configuración para construir una imagen personalizada de NanoBSD podría ser:</p></div><div class="literalblock programlisting"><div class=content><pre>NANO_NAME=custom
NANO_SRC=/usr/src
NANO_KERNEL=MYKERNEL
NANO_IMAGES=2

CONF_BUILD=&#39;
WITHOUT_KLDLOAD=YES
WITHOUT_NETGRAPH=YES
WITHOUT_PAM=YES
&#39;

CONF_INSTALL=&#39;
WITHOUT_ACPI=YES
WITHOUT_BLUETOOTH=YES
WITHOUT_FORTRAN=YES
WITHOUT_HTML=YES
WITHOUT_LPR=YES
WITHOUT_MAN=YES
WITHOUT_SENDMAIL=YES
WITHOUT_SHAREDOCS=YES
WITHOUT_EXAMPLES=YES
WITHOUT_INSTALLLIB=YES
WITHOUT_CALENDAR=YES
WITHOUT_MISC=YES
WITHOUT_SHARE=YES
&#39;

CONF_WORLD=&#39;
WITHOUT_BIND=YES
WITHOUT_MODULES=YES
WITHOUT_KERBEROS=YES
WITHOUT_GAMES=YES
WITHOUT_RESCUE=YES
WITHOUT_LOCALES=YES
WITHOUT_SYSCONS=YES
WITHOUT_INFO=YES
&#39;

FlashDevice SanDisk 1G

cust_nobeastie() (
	touch ${NANO_WORLDDIR}/boot/loader.conf
	echo &#34;beastie_disable=\&#34;YES\&#34;&#34; &gt;&gt; ${NANO_WORLDDIR}/boot/loader.conf
)

customize_cmd cust_comconsole
customize_cmd cust_install_files
customize_cmd cust_allow_ssh_root
customize_cmd cust_nobeastie</pre></div></div><div class=paragraph><p>Todas las opciones de construcción e instalación se pueden encontrar en la página del manual de <a href="https://man.freebsd.org/cgi/man.cgi?query=src.conf&amp;sektion=5&amp;format=html">src.conf(5)</a>, pero no todas las opciones se pueden o se deben usar cuando se construye una imagen de NanoBSD. Las opciones de construcción e instalación se deberían definir de acuerdo a las necesidades de la imagen que se está construyendo.</p></div><div class=paragraph><p>Por ejemplo, el cliente y el servidor de ftp podrían no ser necesarios. Añadir <code>WITHOUT_FTP=TRUE</code> a un fichero de configuración en la sección <code>CONF_BUILD</code> evitará compilarlos. También, si el dispositivo NanoBSD no se va a usar para construir programas entonces es posible añadir <code>WITHOUT_BINUTILS=TRUE</code> en la sección <code>CONF_INSTALL</code>; pero no en la sección <code>CONF_BUILD</code> ya que serán usadas para construir la imagen de NanoBSD.</p></div><div class=paragraph><p>Evitar compilar un conjunto de programas en particular - mediante una opción de compilación - acorta el tiempo total de construcción y reduce el tamaño necesario para la imagen de disco, mientras que no instalar dicho conjunto de programas no disminuye el tiempo total de construcción.</p></div></div></div><div class=sect2><h3 id=_actualizando_nanobsd>2.4. Actualizando NanoBSD<a class=anchor href=#_actualizando_nanobsd></a></h3><div class=paragraph><p>El proceso de actualización de NanoBSD es relativamente simple:</p></div><div class="exampleblock procedure"><div class=content><div class="olist arabic"><ol class=arabic><li><p>Construye una nueva imagen de NanoBSD de forma habitual.</p></li><li><p>Sube la imagen nueva a una partición sin usar en el dispositivo que esté ejecutando NanoBSD.</p><div class=paragraph><p>La diferencia más importante entre este paso y la instalación inicial de NanoBSD es que ahora, en lugar de usar <span class=filename>_.disk.full</span> (que contiene la imagen completa del disco), se instala la imagen <span class=filename>_.disk.image</span> (la cual contiene la imagen de una sola partición del sistema).</p></div></li><li><p>Reinicia y arranca el sistema desde la partición recién instalada.</p></li><li><p>Si todo termina correctamente, la actualización habrá finalizado.</p></li><li><p>Si algo sale mal, reinicia en la partición anterior (que contiene la antigua imagen que funciona correctamente), para restaurar la funcionalidad del sistema tan rápido como sea posible. Arregla los problemas de la nueva imagen y repite el proceso.</p></li></ol></div></div></div><div class=paragraph><p>Para instalar una nueva imagen en un sistema que está ejecutando NanoBSD, es posible utilizar los scripts <span class=filename>updatep1</span> o <span class=filename>updatep2</span> que se encuentran en el directorio <span class=filename>/root</span>, dependiendo de la partición desde la que se esté ejecutando el sistema actual.</p></div><div class=paragraph><p>Dependiendo de los servicios disponibles en el host que ofrece la nueva imagen de NanoBSD y el tipo de transferencia preferido, es posible examinar uno de estos tres métodos:</p></div><div class=sect3><h4 id=_usar_ftp1>2.4.1. Usar <a href="https://man.freebsd.org/cgi/man.cgi?query=ftp&amp;sektion=1&amp;format=html">ftp(1)</a><a class=anchor href=#_usar_ftp1></a></h4><div class=paragraph><p>Si la velocidad de transferencia es una prioridad, utiliza este ejemplo:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ftp myhost</span>
get _.disk.image <span class=s2>&#34;| sh updatep1&#34;</span></code></pre></div></div></div><div class=sect3><h4 id=_usar_ssh1>2.4.2. Usar <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;format=html">ssh(1)</a><a class=anchor href=#_usar_ssh1></a></h4><div class=paragraph><p>Si prefieres una transferencia segura, considera usar este ejemplo:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ssh myhost cat _.disk.image.gz | zcat | sh updatep1</span></code></pre></div></div></div><div class=sect3><h4 id=_usar_nc1>2.4.3. Usar <a href="https://man.freebsd.org/cgi/man.cgi?query=nc&amp;sektion=1&amp;format=html">nc(1)</a><a class=anchor href=#_usar_nc1></a></h4><div class=paragraph><p>Prueba este ejemplo si el host remoto no está ejecutando ni el servicio <a href="https://man.freebsd.org/cgi/man.cgi?query=ftpd&amp;sektion=8&amp;format=html">ftpd(8)</a> ni el servicio <a href="https://man.freebsd.org/cgi/man.cgi?query=sshd&amp;sektion=8&amp;format=html">sshd(8)</a>:</p></div><div class="exampleblock procedure"><div class=content><div class="olist arabic"><ol class=arabic><li><p>En primer lugar, abre un puerto TCP en el host que se encuentra sirviendo la imagen y haz que envíe la imagen al cliente:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>myhost# nc <span class=nt>-l</span> 2222 &lt; _.disk.image</code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Asegúrate de que el puerto que usas no está bloqueado por ningún firewall para recibir conexiones entrantes desde el host NanoBSD.</p></div></td></tr></tbody></table></div></li><li><p>Conéctate al host que sirve la nueva imagen y ejecuta el script <span class=filename>updatep1</span>:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># nc myhost 2222 | sh updatep1</span></code></pre></div></div></li></ol></div></div></div></div></div></div></div><hr><div class=last-modified><p><strong>Last modified on</strong>: 27 de agosto de 2022 by <a href="https://cgit.freebsd.org/doc/commit/?id=88018e1c35" target=_blank>Fernando Apesteguía</a></p></div></div><aside class=toc><div class=toc-content><h3>Tabla de contenidos</h3><nav id=TableOfContents><ul><li><a href=#intro>1. Introducción a NanoBSD</a></li><li><a href=#howto>2. NanoBSD paso a paso</a></li></ul></nav><hr><div class=resources><h3>Recursos</h3><ul class=contents><li><i class="fa fa-file-pdf-o" aria-hidden=true title="Descargar PDF"></i><a href=https://download.freebsd.org/doc/es/articles/nanobsd/nanobsd_es.pdf>Descargar PDF</a></li><li><i class="fa fa-pencil-square-o" aria-hidden=true title="Editar esta página"></i><a href=https://github.com/freebsd/freebsd-doc/blob/main/documentation/content/es/_index target=_blank>Editar esta página</a></li></ul></div></div></aside></main><footer><div class=footer-container><section class=logo-column><img src=http://172.16.201.134:1313/images/FreeBSD-colors.svg width=160 height=50 alt="FreeBSD logo"><div class=options-container><div class=language-container><a id=languages href=http://172.16.201.134:1313/es/languages><img src=http://172.16.201.134:1313/images/language.png class=language-image alt="Elegir idioma">
<span>Spanish</span></a></div><div class=theme-container><select id=theme-chooser><option value=theme-system>System</option><option value=theme-light>Claro</option><option value=theme-dark>Oscuro</option><option value=theme-high-contrast>Alto contraste</option></select></div></div></section><section class=about-column><h3 class=column-title>About</h3><ul class=column-elements-container><li><a href=https://www.freebsd.org/about/ target=_blank class=column-element>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/ target=_blank class=column-element>FreeBSD Foundation</a></li><li><a href=https://www.freebsd.org/where/ target=_blank class=column-element>Get FreeBSD</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct target=_blank class=column-element>Code of Conduct</a></li><li><a href=https://www.freebsd.org/security/ target=_blank class=column-element>Security Advisories</a></li></ul></section><section class=documentation-column><h3 class=column-title>Documentation</h3><ul class=column-elements-container><li><a href=/es class=column-element>Documentation portal</a></li><li><a href=https://man.FreeBSD.org target=_blank class=column-element>Manual pages</a></li><li><a href=https://papers.FreeBSD.org target=_blank class=column-element>Presentations and papers</a></li><li><a href=https://docs-archive.freebsd.org/doc/ target=_blank class=column-element>Previous versions</a></li><li><a href=https://docs-archive.freebsd.org/44doc/ target=_blank class=column-element>4.4BSD Documents</a></li><li><a href=https://wiki.freebsd.org/ target=_blank class=column-element>Wiki</a></li></ul></section><section class=community-column><h3 class=column-title>Community</h3><ul class=column-elements-container><li><a href=http://172.16.201.134:1313/es/articles/contributing class=column-element>Get involved</a></li><li><a href=https://forums.freebsd.org/ target=_blank class=column-element>Community forum</a></li><li><a href=https://lists.freebsd.org/ target=_blank class=column-element>Mailing lists</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank class=column-element>IRC Channels</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank class=column-element>Bug Tracker</a></li></ul></section><section class=legal-column><h3 class=column-title>Legal</h3><ul class=column-elements-container><li><a href=https://freebsdfoundation.org/donate/ target=_blank class=column-element>Donations</a></li><li><a href=https://www.freebsd.org/copyright/freebsd-license/ target=_blank class=column-element>Licensing</a></li><li><a href=https://www.freebsd.org/privacy/ target=_blank class=column-element>Privacy Policy</a></li><li><a href=https://www.freebsd.org/copyright/ target=_blank class=column-element>Legal notices</a></li></ul></section><section class=copyright-column><p>&copy; 1994-2024 The FreeBSD Project. All rights reserved</p><span>Made with <span class=heart>♥</span> by the FreeBSD Community</span></section></div></footer></body></html>