<!doctype html><html class=theme-light lang=es><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Implementando UFS Journaling en un ordenador de escritorio"><meta name=keywords content="UFS,Journaling,Desktop,FreeBSD"><meta name=copyright content="1995-2024 The FreeBSD Foundation"><link rel=canonical href=http://172.16.201.134:1313/es/articles/gjournal-desktop/><title>Implementando UFS Journaling en un ordenador de escritorio | Portal de documentación de FreeBSD</title>
<meta name=theme-color content="#790000"><meta name=color-scheme content="system light dark high-contrast"><link rel="shortcut icon" href=http://172.16.201.134:1313/favicon.ico><link rel=stylesheet href=http://172.16.201.134:1313/styles/main.min.css><link rel=stylesheet href=http://172.16.201.134:1313/css/font-awesome-min.css><script defer src=/js/theme-chooser.min.js></script><script defer src=/js/copy-clipboard.min.js></script><script defer src=/js/search.min.js></script><meta name=twitter:card content="summary"><meta name=twitter:domain content="docs.FreeBSD.org"><meta name=twitter:site content="@freebsd"><meta name=twitter:url content="https://twitter.com/freebsd"><meta property="og:title" content="Implementando UFS Journaling en un ordenador de escritorio"><meta property="og:description" content="Implementando UFS Journaling en un ordenador de escritorio"><meta property="og:type" content="website"><meta property="og:image" content="http://172.16.201.134:1313/favicon.ico"><meta property="og:image:alt" content="FreeBSD Logo"><meta property="og:locale" content="es"><meta property="og:url" content="http://172.16.201.134:1313/es/articles/gjournal-desktop/"><meta property="og:site_name" content="Portal de documentación de FreeBSD"><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","url":"http:\/\/172.16.201.134:1313\/es\/articles\/gjournal-desktop\/","name":"Portal de documentación de FreeBSD","headline":"Portal de documentación de FreeBSD","description":"FreeBSD Documentation Portal"}</script></head><body><header><div class=header-container><div class=logo-menu-bars-container><a href=https://www.FreeBSD.org class=logo><img src=http://172.16.201.134:1313/images/FreeBSD-monochromatic.svg width=160 height=50 alt="FreeBSD logo">
</a><label class=menu-bars for=menu-bars><i class="fa fa-bars" aria-hidden=true></i></label></div><input id=menu-bars type=checkbox><nav><ul class=menu><li class=menu-item><input id=about type=checkbox>
<a href=# aria-label="Navigate to About section"><label class=menu-item-description for=about>About
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/about/ target=_blank>About</a></li><li><a href=https://www.freebsd.org/about/ target=_blank>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/about-us/about-the-foundation/ target=_blank>FreeBSD Foundation</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct/ target=_blank>Code of Conduct</a></li></ul></li><li class=menu-item><input id=download type=checkbox>
<a href=# aria-label="Navigate to get FreeBSD section"><label class=menu-item-description for=download>Get FreeBSD
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/where/ target=_blank>Get FreeBSD</a></li><li><a href=https://www.freebsd.org/releases/ target=_blank>Release Information</a></li><li><a href=https://www.freebsd.org/releng/ target=_blank>Release Engineering</a></li><li><a href=https://www.freebsd.org/security/ target=_blank>Security Advisories</a></li></ul></li><li class=menu-item><input id=documentation type=checkbox>
<a href=# aria-label="Navigate to get Documentation section"><label class=menu-item-description for=documentation>Documentation
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=/es>Documentation portal</a></li><li><a href=http://172.16.201.134:1313/es/books/handbook>FreeBSD Handbook</a></li><li><a href=http://172.16.201.134:1313/es/books/porters-handbook>Porter's Handbook</a></li><li><a href=https://docs.FreeBSD.org/en/books/fdp-primer>Documentation Project Handbook</a></li><li><a href=https://man.FreeBSD.org target=_blank>Manual pages</a></li><li><a href=https://papers.FreeBSD.org target=_blank>Presentations and papers</a></li><li><a href=https://wiki.FreeBSD.org target=_blank>Wiki</a></li><li><a href=http://172.16.201.134:1313/es/books>Books</a></li><li><a href=http://172.16.201.134:1313/es/articles>Articles</a></li></ul></li><li class=menu-item><input id=community type=checkbox>
<a href=# aria-label="Navigate to get Community section"><label class=menu-item-description for=community>Community
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/community/>Community</a></li><li><a href=http://172.16.201.134:1313/es/articles/contributing>Get involved</a></li><li><a href=https://forums.freebsd.org/ target=_blank>Forum</a></li><li><a href=https://lists.freebsd.org/ target=_blank>Mailing lists</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank>IRC Channels</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank>Bug Tracker</a></li><li><a href=https://www.freebsd.org/support/ target=_blank>Support</a></li></ul></li></ul></nav><div class=search-donate-container><form class=search method=get id=search-header-form action=https://docs.freebsd.org/search name=search-header-form><input type=hidden name=DB value=es>
<input id=words name=P type=text size=20 maxlength=255>
<button>
<i class="fa fa-search" aria-hidden=true></i></button></form><div class=donate><a href=https://freebsdfoundation.org/donate/ target=_blank><span class=heart>♥</span>
Donate</a></div></div></div></header><main class=main-wrapper-article><div class=article><h1 class=title>Implementando UFS Journaling en un ordenador de escritorio</h1><div class="admonitionblock note"><p><i class="fa fa-exclamation-circle" aria-hidden=true></i>
This translation may be out of date. To help with the translations please access the <a href=https://translate-dev.freebsd.org/ target=_blank>FreeBSD translations instance</a>.</p></div><div class=legalnotice><a id=trademarks></a><details><summary>Marcas registradas</summary><p>FreeBSD es una marca registrada de la Fundación FreeBSD</p><p>Muchos de los nombres usados por los fabricantes y vendedores para diferenciar sus productos son designados como marcas comerciales. Allí donde estos nombres aparezcan en este documento y el Proyecto FreeBSD fuera consciente de la alegación de marca comercial, los nombres tienen a continuación el símbolo “™” o “®”.</p></details></div><div class=toc-mobile><h3>Tabla de contenidos</h3><nav id=TableOfContents><ul><li><a href=#introduction>1. Introducción</a></li><li><a href=#understanding-journaling>2. Entendiendo el journaling en FreeBSD</a></li><li><a href=#reserve-space>3. Pasos durante la instalación de FreeBSD</a></li><li><a href=#configure-journal>4. Configurando el journaling</a></li><li><a href=#troubleshooting-gjournal>5. Resolución de problemas del journaling</a></li><li><a href=#further-reading>6. Lecturas adicionales</a></li></ul></nav></div><div id=preamble><div class=sectionbody><div class="paragraph abstract-title"><p>Resumen</p></div><div class=paragraph><p>Un sistema de archivos con journaling utiliza un log para registrar todas las transacciones que tienen lugar en el sistema de archivos y conserva su integridad en caso de un fallo del sistema o un corte de alimentación. Aunque existe la posibilidad de perder cambios que no hayan sido guardados en los archivos, el journaling elimina casi por completo la posibilidad de que el sistema de archivos se dañe debido a un cierre repentino. También minimiza el tiempo que lleva verificar el sistema de archivos después de un fallo. Aunque el sistema de archivos UFS empleado por FreeBSD no implementa el journaling en si mismo, la nueva clase journal del framework GEOM en FreeBSD 7.<em>X</em> se puede utilizar para proporcionar un journaling independiente del sistema de archivos. Este artículo explica cómo implementar el journaling UFS en un ordenador típico de escritorio.</p></div><hr></div></div><div class=sect1><h2 id=introduction>1. Introducción<a class=anchor href=#introduction></a></h2><div class=sectionbody><div class=paragraph><p>Si bien es cierto que los servidores profesionales, generalmente, están bien protegidos contra las paradas imprevistas, un ordenador típico de escritorio está a merced de problemas con la energía, reinicios accidentales y otros incidentes relacionados con el usuario que pueden terminar en paradas abruptas del sistema. Las actualizaciones de software, generalmente, protegen el sistema de archivos de manera eficiente en tales casos, aunque en la mayoría de ocasiones se requiere una larga verificación en segundo plano. En raras ocasiones, la corrupción del sistema de archivos llega a un punto en el cual se requiere la intervención del usuario y en el que podría producirse una perdida de datos.</p></div><div class=paragraph><p>La nueva función de journaling provista por GEOM puede ayudar en gran medida en esos escenarios, al eliminar, virtualmente, el tiempo requerido para la verificación del sistema de archivos, y garantizar que el sistema de archivos se restaure rápidamente a un estado consistente.</p></div><div class=paragraph><p>Este artículo describe un procedimiento para implementar UFS journaling en un escenario con un ordenador típico de escritorio (un solo disco duro utilizado para el sistema operativo y los datos). Debe seguirse durante una nueva instalación de FreeBSD. Los pasos son lo suficientemente simples y no requieren de un uso demasiado complejo de la línea de comandos.</p></div><div class=paragraph><p>Después de leer este artículo, sabrás:</p></div><div class=ulist><ul><li><p>Cómo reservar espacio para el journaling en una instalación nueva de FreeBSD.</p></li><li><p>Cómo cargar y activar el módulo <code>geom_journal</code> (o añadir soporte para él en un kernel personalizado).</p></li><li><p>Cómo hacer que tus sistemas de archivos ya existentes utilicen journaling, y qué opciones usar en el archivo <span class=filename>/etc/fstab</span> para montarlos.</p></li><li><p>Cómo implementar journaling en nuevas (vacías) particiones.</p></li><li><p>Cómo resolver problemas asociados con el journaling.</p></li></ul></div><div class=paragraph><p>Antes de leer este artículo, deberías poder:</p></div><div class=ulist><ul><li><p>Entender conceptos UNIX® y FreeBSD básicos.</p></li><li><p>Estar familiarizado con el procedimiento de instalación de FreeBSD y la utilidad sysinstall.</p></li></ul></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>El procedimiento descrito aquí está pensado para preparar una nueva instalación en la que todavía no se han almacenado datos reales del usuario en el disco. Aunque puedes modificar y ampliar este procedimiento a sistemas que ya están en producción, antes de hacerlo, debes realizar un <em>backup</em> de todos los datos que sean importantes. Jugar con discos y particiones a bajo nivel puede provocar errores fatales y pérdida de datos.</p></div></td></tr></tbody></table></div></div></div><div class=sect1><h2 id=understanding-journaling>2. Entendiendo el journaling en FreeBSD<a class=anchor href=#understanding-journaling></a></h2><div class=sectionbody><div class=paragraph><p>El journaling proporcionado por GEOM en FreeBSD 7.<em>X</em> no es específico de un sistema de ficheros (a diferencia de lo que ocurre en el sistema de ficheros ext3 de Linux®) pero funciona a nivel de bloque. Aunque esto significa que se puede aplicar a diferentes sistemas de ficheros, en FreeBSD 7.0-RELEASE sólo se puede aplicar en UFS2.</p></div><div class=paragraph><p>Esta funcionalidad se proporciona al cargar el módulo <span class=filename>geom_journal.ko</span> en el kernel (o añadirlo al compilar un kernel personalizado) y utilizando el comando <code>gjournal</code> para configurar los sistemas de archivos. En general, deberías añadir journal a los sistemas de archivos grandes, como <span class=filename>/usr</span>. Sin embargo, necesitarás (consulta la siguiente sección) reservar algo de espacio libre en el disco.</p></div><div class=paragraph><p>Cuando un sistema de archivos tiene journaling, se necesita algo de espacio en el disco para mantener el propio journaling. El espacio en disco que contiene los datos reales se conoce como <em>data provider</em>, mientras que el que contiene el journaling se conoce como <em>journal provider</em>. Los providers de data y journal deben estar en diferentes particiones cuando se hace journaling en una partición ya existente (que no esté vacía). Al hacer journaling en una partición nueva, tienes la opción de usar un solo provider para data y journal. En cualquier caso, el comando <code>gjournal</code> combina ambos providers para crear el sistema de archivos final, con el journaling. Por ejemplo:</p></div><div class=ulist><ul><li><p>Quieres crear un journal para tu sistema de ficheros <span class=filename>/usr</span>, almacenado en <span class=filename>/dev/ad0s1f</span> (que ya contiene datos).</p></li><li><p>Has reservado algo de espacio libre en la partición <span class=filename>/dev/ad0s1g</span>.</p></li><li><p>Al usar <code>gjournal</code> se crea un nuevo dispositivo <span class=filename>/dev/ad0s1f.journal</span> donde <span class=filename>/dev/ad0s1f</span> es el data provider, y <span class=filename>/dev/ad0s1g</span> es el journal provider. Este nuevo dispositivo es usado para todas las operaciones de fichero siguientes.</p></li></ul></div><div class=paragraph><p>La cantidad de espacio en disco que necesita reservar para el journal provider depende del uso del sistema de archivos y no del tamaño del data provider. Por ejemplo, un ordenador de oficina típico, con un journal provider de 1 GB para el sistema de archivos <span class=filename>/usr</span> será suficiente, mientras que un ordenador que haga un uso intensivo de E/S en el disco duro (por ejemplo, edición de video) podría necesitar más. Se producirá un kernel panic si el espacio del journal se agota antes de poder grabar los datos.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Es muy poco probable que los tamaños de journaling sugeridos aquí causen problemas con el uso de un ordenador de escritorio típico (como la navegación web, el procesamiento de textos y la reproducción de archivos multimedia). Si con tu trabajo se hace un uso intensivo del disco, usa la siguiente regla para una máxima fiabilidad: el tamaño de la RAM debe ajustarse al 30% del espacio del journal provider. Por ejemplo, si tu sistema tiene 1 GB de RAM, crea un journal provider de aproximadamente 3.3 GB. (Multiplica el tamaño total de tu RAM por 3.3 para obtener el tamaño del journal).</p></div></td></tr></tbody></table></div><div class=paragraph><p>Para más información sobre journaling, por favor lee la página de manual de <a href="https://man.freebsd.org/cgi/man.cgi?query=gjournal&amp;sektion=8&amp;format=html">gjournal(8)</a>.</p></div></div></div><div class=sect1><h2 id=reserve-space>3. Pasos durante la instalación de FreeBSD<a class=anchor href=#reserve-space></a></h2><div class=sectionbody><div class=sect2><h3 id=_reservando_espacio_para_el_journaling>3.1. Reservando espacio para el journaling<a class=anchor href=#_reservando_espacio_para_el_journaling></a></h3><div class=paragraph><p>Normalmente, un ordenador de escritorio típico tiene un disco duro donde se almacena el sistema operativo y los datos del usuario. Sin lugar a dudas, el esquema de partición predeterminado seleccionado por sysinstall es más o menos adecuado: un ordenador de escritorio no necesita una partición <span class=filename>/var</span> que tenga un gran tamaño, mientras que a <span class=filename>/usr</span> se le asigna la mayor parte del espacio en disco, ya que los datos del usuario y muchos paquetes están instalados en sus subdirectorios.</p></div><div class=paragraph><p>El particionamiento por defecto (el que se obtiene al presionar <kbd>A</kbd> en el editor de particiones de FreeBSD, llamado Disklabel) no deja ningún espacio sin asignar. Cada partición que tenga journal, necesita otra partición para el journal. Puesto que la partición más grande es <span class=filename>/usr</span>, tiene sentido hacer esta partición algo más pequeña para obtener el espacio necesario para el journaling.</p></div><div class=paragraph><p>En nuestro ejemplo se usa un disco de 80 GB. La siguiente captura de pantalla muestra las particiones por defecto creadas por Disklabel durante la instalación:</p></div><div class=imageblock><div class=content><img src=../../../images/articles/gjournal-desktop/disklabel1.png alt=disklabel1></div></div><div class=paragraph><p>Si esto es más o menos lo que necesitas, los ajustes para el journaling son muy fáciles de hacer. Simplemente utiliza las teclas de desplazamiento para mover la fila resaltada a la partición <span class=filename>/usr</span> y presiona la tecla <kbd>D</kbd> para eliminarla.</p></div><div class=paragraph><p>Ahora, mueve la fila resaltada al nombre del disco en la parte superior de la pantalla y presiona la tecla <kbd>C</kbd> para crear una nueva partición para <span class=filename>/usr</span>. Esta nueva partición debe ser 1 GB más pequeña (si deseas añadir journaling en <span class=filename>/usr</span> solo), o 2 GB (si deseas añadir journaling tanto en <span class=filename>/usr</span> como en <span class=filename>/var</span>). Desde la ventana emergente, elige crear un sistema de archivos y escribe <span class=filename>/usr</span> como punto de montaje.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>¿Deberías añadir journaling a la partición <span class=filename>/var</span>? Normalmente, el journaling tiene sentido en particiones que sean bastante grandes. Puedes decidir no añadir journaling a <span class=filename>/var</span>, hacerlo en un ordenador de escritorio no causará ningun daño. Si no se hace un uso intensivo del sistema de archivos (bastante probable para un ordenador de escritorio), es posible que prefieras asignar menos espacio en disco al journaling.</p></div><div class=paragraph><p>En nuestro ejemplo, utilizamos journaling tanto en <span class=filename>/usr</span> como en <span class=filename>/var</span>. Por supuesto puedes ajustar este procedimiento según tus propias necesidades.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Para mantener las cosas lo más sencillas posible, vamos a utilizar sysinstall para crear las particiones necesarias para el journaling. Sin embargo, durante la instalación, sysinstall insiste en pedirte un punto de montaje para cada partición que crees. En este punto, no tienes ningún punto de montaje para las particiones que mantendrán el journal, y en realidad, <em>ni siquiera las necesitas</em>. Estas particiones nunca van a ser montadas.</p></div><div class=paragraph><p>Para evitar estos problemas con sysinstall, vamos a crear las particiones de journal como particiones swap. La partición swap no se monta nunca, y sysinstall no tiene problemas para crear tantas particiones swap como sea necesario. Después del primer reinicio, será necesario editar el archivo <span class=filename>/etc/fstab</span>, y eliminar las entradas swap.</p></div><div class=paragraph><p>Para crear la partición swap, utiliza de nuevo las teclas de flechas para resaltar la parte superior de la pantalla de Disklabel, de forma que el nombre del disco en sí esté resaltado. Después presiona <kbd>N</kbd>, introduce el tamaño deseado (<em>1024M</em>) y selecciona "swap space" en el menú pop-up que aparecerá. Repite para cada journal que quieras crear. En nuestro ejemplo, creamos dos particiones para proporcionar el journal de <span class=filename>/usr</span> y <span class=filename>/var</span>. El resultado final se muestra en la siguiente captura de pantalla:</p></div><div class=imageblock><div class=content><img src=../../../images/articles/gjournal-desktop/disklabel2.png alt=disklabel2></div></div><div class=paragraph><p>Cuando hayas terminado de crear las particiones, te sugerimos que anotes los nombres de las particiones y los puntos de montaje para que puedas consultar fácilmente esa información durante la fase de configuración. Esto ayudará a reducir los errores que puedan dañar tu instalación. La siguiente tabla muestra nuestras notas para la configuración de ejemplo:</p></div><table class="tableblock frame-all grid-all stretch"><caption class=title>Tabla 1. Particiones y journals</caption><col style=width:33.3333%><col style=width:33.3333%><col style=width:33.3334%><thead><tr><th class="tableblock halign-left valign-top">Partición</th><th class="tableblock halign-left valign-top">Punto de Montaje</th><th class="tableblock halign-left valign-top">Journal</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock>ad0s1d</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>/var</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>ad0s1h</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>ad0s1f</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>/usr</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>ad0s1g</p></td></tr></tbody></table><div class=paragraph><p>Continua con la instalación como lo harías normalmente. Sin embargo, te sugerimos que pospongas la instalación de software (packages) de terceros hasta que hayas configurado completamente el journaling.</p></div></div><div class=sect2><h3 id=first-boot>3.2. Arrancando por primera vez<a class=anchor href=#first-boot></a></h3><div class=paragraph><p>Tu sistema se iniciará como lo haría normalmente, pero deberás editar el archivo <span class=filename>/etc/fstab</span> para eliminar las particiones swap que creaste para los journals. Normalmente, la partición swap que usarás es la que tiene el sufijo "b" (por ejemplo, ad0s1b en nuestro ejemplo). Elimina el reto de particiones swap y reinicia para que FreeBSD deje de utilizarlas.</p></div><div class=paragraph><p>Cuando el sistema vuelva a arrancar, entonces estaremos listos para configurar el journaling.</p></div></div></div></div><div class=sect1><h2 id=configure-journal>4. Configurando el journaling<a class=anchor href=#configure-journal></a></h2><div class=sectionbody><div class=sect2><h3 id=running-gjournal>4.1. Ejecutando <code>gjournal</code><a class=anchor href=#running-gjournal></a></h3><div class=paragraph><p>Habiendo preparado ya las particiones necesarias, es bastante sencillo configurar el journaling. Necesitaremos cambiar al modo de usuario único así que haz login como <code>root</code> y teclea:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># shutdown now</span></code></pre></div></div><div class=paragraph><p>Presiona <kbd>Enter</kbd> para obtener el shell por defecto. Necesitaremos desmontar las particiones a las que aplicaremos journaling, en nuestro ejemplo <span class=filename>/usr</span> y <span class=filename>/var</span>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># umount /usr /var</span></code></pre></div></div><div class=paragraph><p>Cargue el módulo requerido por el journaling:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># gjournal load</span></code></pre></div></div><div class=paragraph><p>Ahora, utiliza tus notas para determinar qué partición se utilizará con cada journal. En nuestro ejemplo, <span class=filename>/usr</span> es <span class=filename>ad0s1f</span> y su journal será <span class=filename>ad0s1g</span>, mientras que <span class=filename>/var</span> es <span class=filename>ad0s1d</span> y utilizará el journal en <span class=filename>ad0s1h</span>. Se necesitarán los siguientes comandos:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># gjournal label ad0s1f ad0s1g</span>
GEOM_JOURNAL: Journal 2948326772: ad0s1f contains data.
GEOM_JOURNAL: Journal 2948326772: ad0s1g contains journal.

<span class=c># gjournal label ad0s1d ad0s1h</span>
GEOM_JOURNAL: Journal 3193218002: ad0s1d contains data.
GEOM_JOURNAL: Journal 3193218002: ad0s1h contains journal.</code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Si se utiliza el último sector de cualquier partición, <code>gjournal</code> devolverá un error. Tendrás que ejecutar el comando utilizando el flag <code>-f</code> para forzar una sobrescritura, es decir:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># gjournal label -f ad0s1d ad0s1h</span></code></pre></div></div><div class=paragraph><p>Dado que se trata de una instalación nueva, es poco probable que se sobrescriba algo.</p></div></td></tr></tbody></table></div><div class=paragraph><p>En este punto, se crean dos nuevos dispositivos, con los nombres <span class=filename>ad0s1d.journal</span> y <span class=filename>ad0s1f.journal</span>. Estos representan las particiones <span class=filename>/var</span> y <span class=filename>/usr</span> que tenemos que montar. Antes de realizar el montaje, debemos establecer la flag de journal y borrar la flag de Soft Updates:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># tunefs -J enable -n disable ad0s1d.journal</span>
tunefs: gjournal <span class=nb>set
</span>tunefs: soft updates cleared

<span class=c># tunefs -J enable -n disable ad0s1f.journal</span>
tunefs: gjournal <span class=nb>set
</span>tunefs: soft updates cleared</code></pre></div></div><div class=paragraph><p>Ahora, monta los nuevos dispositivos manualmente en sus respectivas ubicaciones (ten en cuenta que ahora podemos usar la opción de montaje <code>async</code>):</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mount -o async /dev/ad0s1d.journal /var</span>
<span class=c># mount -o async /dev/ad0s1f.journal /usr</span></code></pre></div></div><div class=paragraph><p>Edita <span class=filename>/etc/fstab</span> y actualiza las entradas para <span class=filename>/usr</span> y <span class=filename>/var</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>/dev/ad0s1f.journal     /usr            ufs     rw,async      2       2
/dev/ad0s1d.journal     /var            ufs     rw,async      2       2</pre></div></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>¡Asegúrate de que las entradas anteriores sean correctas, o tendrás problemas para arrancar después de reiniciar!</p></div></td></tr></tbody></table></div><div class=paragraph><p>Por último, edita <span class=filename>/boot/loader.conf</span> y añade la siguiente línea para que el módulo <a href="https://man.freebsd.org/cgi/man.cgi?query=gjournal&amp;sektion=8&amp;format=html">gjournal(8)</a> se cargue en cada arranque:</p></div><div class="literalblock programlisting"><div class=content><pre>geom_journal_load=&#34;YES&#34;</pre></div></div><div class=paragraph><p>¡Felicidades! Tu sistema ahora está configurado para utilizar el journaling. Puedes escribir <code>exit</code> para volver al modo multiusuario o reiniciar para probar su configuración (recomendado). Durante el arranque verás mensajes como los siguientes:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>ad0: 76293MB XEC XE800JD-00HBC0 08.02D08 at ata0-master SATA150
GEOM_JOURNAL: Journal 2948326772: ad0s1g contains journal.
GEOM_JOURNAL: Journal 3193218002: ad0s1h contains journal.
GEOM_JOURNAL: Journal 3193218002: ad0s1d contains data.
GEOM_JOURNAL: Journal ad0s1d clean.
GEOM_JOURNAL: Journal 2948326772: ad0s1f contains data.
GEOM_JOURNAL: Journal ad0s1f clean.</code></pre></div></div><div class=paragraph><p>Después de un apagado forzoso, el mensaje variará ligeramente, por ejemplo:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>GEOM_JOURNAL: Journal ad0s1d consistent.</code></pre></div></div><div class=paragraph><p>Normalmente esto significa que <a href="https://man.freebsd.org/cgi/man.cgi?query=gjournal&amp;sektion=8&amp;format=html">gjournal(8)</a> ha utilizado la información del journal provider para devolver al sistema de ficheros a un estado consistente.</p></div></div><div class=sect2><h3 id=gjournal-new>4.2. Añadiendo journaling a las nuevas particiones<a class=anchor href=#gjournal-new></a></h3><div class=paragraph><p>Si bien el procedimiento anterior es necesario para las particiones con journaling que ya contengan datos, añadir journaling a una partición vacía es un poco más sencillo, ya que tanto los datos como el provider se pueden almacenar en la misma partición. Por ejemplo, supongamos que has instalado un nuevo disco, y que has creado una nueva partición, <span class=filename>/dev/ad1s1d</span> . Crear el journal sería tan simple como:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># gjournal label ad1s1d</span></code></pre></div></div><div class=paragraph><p>El tamaño por defecto del journal será de 1 GB. Puedes ajustarlo utilizando la opción <code>-s</code>. El valor se puede introducir en bytes o añadiéndole <code>K</code>, <code>M</code> or <code>G</code> para representar Kilobytes, Megabytes o Gigabytes respectivamente. Date cuenta de que <code>gjournal</code> no te permitirá crear tamaños de journal que no sean apropiados por ser demasiado pequeños.</p></div><div class=paragraph><p>Por ejemplo, para crear un journal de 2 GB, puede usar el siguiente comando:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># gjournal label -s 2G ad1s1d</span></code></pre></div></div><div class=paragraph><p>Puedes crear un sistema de archivos en tu nueva partición y habilitar el journaling utilizando la opción <code>-J</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># newfs -J /dev/ad1s1d.journal</span></code></pre></div></div></div><div class=sect2><h3 id=configure-kernel>4.3. Añadiendo soporte de journaling en un kernel personalizado<a class=anchor href=#configure-kernel></a></h3><div class=paragraph><p>Si no deseas cargar <code>geom_journal</code> como un módulo, puedes añadir la funcionalidad directamente a tu kernel. Edita el archivo de configuración del kernel personalizado y asegúrate de que incluyes estas dos líneas:</p></div><div class="literalblock programlisting"><div class=content><pre>options UFS_GJOURNAL # Note: This is already in GENERIC

options GEOM_JOURNAL # You will have to add this one</pre></div></div><div class=paragraph><p>Recompila e instala tu kernel siguiendo las instrucciones de <a href=https://docs.freebsd.org/es/books/handbook/#kernelconfig>instructions in the FreeBSD Handbook.</a></p></div><div class=paragraph><p>No te olvides de eliminar la entrada "load" apropiada de <span class=filename>/boot/loader.conf</span> si es que la has usado anteriormente.</p></div></div></div></div><div class=sect1><h2 id=troubleshooting-gjournal>5. Resolución de problemas del journaling<a class=anchor href=#troubleshooting-gjournal></a></h2><div class=sectionbody><div class=paragraph><p>En la siguiente sección se analizan las preguntas más frecuentes relacionadas con los problemas relacionados con el journaling.</p></div><div class=sect2><h3 id=_durante_los_periodos_de_mucha_actividad_en_el_disco_estoy_teniendo_un_kernel_panic_está_relacionado_con_el_journaling>5.1. Durante los periodos de mucha actividad en el disco estoy teniendo un kernel panic. ¿Está relacionado con el journaling?<a class=anchor href=#_durante_los_periodos_de_mucha_actividad_en_el_disco_estoy_teniendo_un_kernel_panic_está_relacionado_con_el_journaling></a></h3><div class=paragraph><p>Es probable que el journaling se llene antes de tener la oportunidad de grabarse (flushed) el disco. Ten en cuenta que el tamaño del journal depende del uso, no del tamaño del provider de datos. Si la actividad del disco es alta, necesitas una partición más grande para el journal. Consulta la nota en la sección <a href=#understanding-journaling>Entendiendo el journaling en FreeBSD</a>.</p></div></div><div class=sect2><h3 id=_cometí_algún_error_durante_la_configuración_y_ahora_no_puedo_arrancar_se_puede_arreglar_esto_de_alguna_manera>5.2. Cometí algún error durante la configuración, y ahora no puedo arrancar. ¿Se puede arreglar esto de alguna manera?<a class=anchor href=#_cometí_algún_error_durante_la_configuración_y_ahora_no_puedo_arrancar_se_puede_arreglar_esto_de_alguna_manera></a></h3><div class=paragraph><p>Has olvidado (o te has equivocado al escribir) la entrada en <span class=filename>/boot/loader.conf</span> o hay errores en tu fichero <span class=filename>/etc/fstab</span>. Normalmente son fáciles de arreglar. Presiona <kbd>Enter</kbd> para obtener un shell por defecto en modo usuario único. Después localiza la raíz del problema:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cat /boot/loader.conf</span></code></pre></div></div><div class=paragraph><p>Si la entrada <code>geom_journal_load</code> no está o está mal escrita, no se crearán los dispositivos que utilizan journaling. Carga el módulo manualmente, monta todas las particiones y continúa con el arranque en modo multiusuario:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># gjournal load</span>

ad0: 76293MB XEC XE800JD-00HBC0 08.02D08 at ata0-master SATA150
GEOM_JOURNAL: Journal 2948326772: ad0s1g contains journal.
GEOM_JOURNAL: Journal 3193218002: ad0s1h contains journal.
GEOM_JOURNAL: Journal 3193218002: ad0s1d contains data.
GEOM_JOURNAL: Journal ad0s1d clean.
GEOM_JOURNAL: Journal 2948326772: ad0s1f contains data.
GEOM_JOURNAL: Journal ad0s1f clean.

<span class=c># mount -a</span>
<span class=c># exit</span>
<span class=o>(</span>boot continues<span class=o>)</span></code></pre></div></div><div class=paragraph><p>Si, por otro lado, esta entrada es correcta, echa un vistazo al archivo <span class=filename>/etc/fstab</span>. Probablemente encontrarás una entrada que está mal escrita o directamente no está. En este caso, monta todas las particiones restantes a mano y continúa con el arranque en modo multiusuario.</p></div></div><div class=sect2><h3 id=_puedo_eliminar_el_journaling_y_volver_a_mi_sistema_de_archivos_estándar_con_soft_updates>5.3. ¿Puedo eliminar el journaling y volver a mi sistema de archivos estándar con Soft Updates?<a class=anchor href=#_puedo_eliminar_el_journaling_y_volver_a_mi_sistema_de_archivos_estándar_con_soft_updates></a></h3><div class=paragraph><p>Por supuesto. Utiliza el siguiente procedimiento, el cual revierte los cambios. Las particiones que has creado para los journal providers se pueden usar para otros fines, si así lo deseas.</p></div><div class=paragraph><p>Haz login como <code>root</code> y entra en modo usuario único:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># shutdown now</span></code></pre></div></div><div class=paragraph><p>Desmonta las particiones que tengan journaling:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># umount /usr /var</span></code></pre></div></div><div class=paragraph><p>Sincroniza los journals:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># gjournal sync</span></code></pre></div></div><div class=paragraph><p>Para los journaling providers:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># gjournal stop ad0s1d.journal</span>
<span class=c># gjournal stop ad0s1f.journal</span></code></pre></div></div><div class=paragraph><p>Borra los metadatos de journaling de datos los dispositivos que utilice:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># gjournal clear ad0s1d</span>
<span class=c># gjournal clear ad0s1f</span>
<span class=c># gjournal clear ad0s1g</span>
<span class=c># gjournal clear ad0s1h</span></code></pre></div></div><div class=paragraph><p>Borra el flag de journaling del sistema de archivos y restaure el flag de Soft Updates:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># tunefs -J disable -n enable ad0s1d</span>
tunefs: gjournal cleared
tunefs: soft updates <span class=nb>set</span>

<span class=c># tunefs -J disable -n enable ad0s1f</span>
tunefs: gjournal cleared
tunefs: soft updates <span class=nb>set</span></code></pre></div></div><div class=paragraph><p>Vuelve a montar los dispositivos antiguos a mano:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mount -o rw /dev/ad0s1d /var</span>
<span class=c># mount -o rw /dev/ad0s1f /usr</span></code></pre></div></div><div class=paragraph><p>Edita <span class=filename>/etc/fstab</span> y restáuralo a su estado original:</p></div><div class="literalblock programlisting"><div class=content><pre>/dev/ad0s1f     /usr            ufs     rw      2       2
/dev/ad0s1d     /var            ufs     rw      2       2</pre></div></div><div class=paragraph><p>Por último, edita <span class=filename>/boot/loader.conf</span>, elimina la entrada que carga el módulo <code>geom_journal</code> y reinicia.</p></div></div></div></div><div class=sect1><h2 id=further-reading>6. Lecturas adicionales<a class=anchor href=#further-reading></a></h2><div class=sectionbody><div class=paragraph><p>El Journaling es una característica relativamente nueva en FreeBSD, y como tal, todavía no está muy bien documentada. Sin embargo, puedes encontrar útiles las siguientes referencias:</p></div><div class=ulist><ul><li><p>Una <a href=https://docs.freebsd.org/es/books/handbook/#geom-gjournal>nueva sección sobre journaling</a> forma parte ahora del FreeBSD Handbook.</p></li><li><p><a href=https://lists.freebsd.org/pipermail/freebsd-current/2006-June/064043.html>This post</a> in <a href=https://lists.FreeBSD.org/subscription/freebsd-current>lista de correo de FreeBSD-CURRENT</a> by <a href="https://man.freebsd.org/cgi/man.cgi?query=gjournal&amp;sektion=8&amp;format=html">gjournal(8)</a>'s developer, <code>Paweł Jakub Dawidek &lt;<a href=mailto:pjd@FreeBSD.org>pjd@FreeBSD.org</a>></code>.</p></li><li><p><a href=https://lists.freebsd.org/pipermail/freebsd-questions/2008-April/173501.html>This post</a> in <a href=https://lists.FreeBSD.org/subscription/freebsd-questions>Lista de correo para preguntas generales sobre FreeBSD</a> by <code>Ivan Voras &lt;<a href=mailto:ivoras@FreeBSD.org>ivoras@FreeBSD.org</a>></code>.</p></li><li><p>Las páginas del manual de <a href="https://man.freebsd.org/cgi/man.cgi?query=gjournal&amp;sektion=8&amp;format=html">gjournal(8)</a> y de <a href="https://man.freebsd.org/cgi/man.cgi?query=geom&amp;sektion=8&amp;format=html">geom(8)</a>.</p></li></ul></div></div></div><hr><div class=last-modified><p><strong>Last modified on</strong>: 5 de agosto de 2022 by <a href="https://cgit.freebsd.org/doc/commit/?id=d4cdd15d59" target=_blank>Fernando Apesteguía</a></p></div></div><aside class=toc><div class=toc-content><h3>Tabla de contenidos</h3><nav id=TableOfContents><ul><li><a href=#introduction>1. Introducción</a></li><li><a href=#understanding-journaling>2. Entendiendo el journaling en FreeBSD</a></li><li><a href=#reserve-space>3. Pasos durante la instalación de FreeBSD</a></li><li><a href=#configure-journal>4. Configurando el journaling</a></li><li><a href=#troubleshooting-gjournal>5. Resolución de problemas del journaling</a></li><li><a href=#further-reading>6. Lecturas adicionales</a></li></ul></nav><hr><div class=resources><h3>Recursos</h3><ul class=contents><li><i class="fa fa-file-pdf-o" aria-hidden=true title="Descargar PDF"></i><a href=https://download.freebsd.org/doc/es/articles/gjournal-desktop/gjournal-desktop_es.pdf>Descargar PDF</a></li><li><i class="fa fa-pencil-square-o" aria-hidden=true title="Editar esta página"></i><a href=https://github.com/freebsd/freebsd-doc/blob/main/documentation/content/es/_index target=_blank>Editar esta página</a></li></ul></div></div></aside></main><footer><div class=footer-container><section class=logo-column><img src=http://172.16.201.134:1313/images/FreeBSD-colors.svg width=160 height=50 alt="FreeBSD logo"><div class=options-container><div class=language-container><a id=languages href=http://172.16.201.134:1313/es/languages><img src=http://172.16.201.134:1313/images/language.png class=language-image alt="Elegir idioma">
<span>Spanish</span></a></div><div class=theme-container><select id=theme-chooser><option value=theme-system>System</option><option value=theme-light>Claro</option><option value=theme-dark>Oscuro</option><option value=theme-high-contrast>Alto contraste</option></select></div></div></section><section class=about-column><h3 class=column-title>About</h3><ul class=column-elements-container><li><a href=https://www.freebsd.org/about/ target=_blank class=column-element>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/ target=_blank class=column-element>FreeBSD Foundation</a></li><li><a href=https://www.freebsd.org/where/ target=_blank class=column-element>Get FreeBSD</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct target=_blank class=column-element>Code of Conduct</a></li><li><a href=https://www.freebsd.org/security/ target=_blank class=column-element>Security Advisories</a></li></ul></section><section class=documentation-column><h3 class=column-title>Documentation</h3><ul class=column-elements-container><li><a href=/es class=column-element>Documentation portal</a></li><li><a href=https://man.FreeBSD.org target=_blank class=column-element>Manual pages</a></li><li><a href=https://papers.FreeBSD.org target=_blank class=column-element>Presentations and papers</a></li><li><a href=https://docs-archive.freebsd.org/doc/ target=_blank class=column-element>Previous versions</a></li><li><a href=https://docs-archive.freebsd.org/44doc/ target=_blank class=column-element>4.4BSD Documents</a></li><li><a href=https://wiki.freebsd.org/ target=_blank class=column-element>Wiki</a></li></ul></section><section class=community-column><h3 class=column-title>Community</h3><ul class=column-elements-container><li><a href=http://172.16.201.134:1313/es/articles/contributing class=column-element>Get involved</a></li><li><a href=https://forums.freebsd.org/ target=_blank class=column-element>Community forum</a></li><li><a href=https://lists.freebsd.org/ target=_blank class=column-element>Mailing lists</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank class=column-element>IRC Channels</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank class=column-element>Bug Tracker</a></li></ul></section><section class=legal-column><h3 class=column-title>Legal</h3><ul class=column-elements-container><li><a href=https://freebsdfoundation.org/donate/ target=_blank class=column-element>Donations</a></li><li><a href=https://www.freebsd.org/copyright/freebsd-license/ target=_blank class=column-element>Licensing</a></li><li><a href=https://www.freebsd.org/privacy/ target=_blank class=column-element>Privacy Policy</a></li><li><a href=https://www.freebsd.org/copyright/ target=_blank class=column-element>Legal notices</a></li></ul></section><section class=copyright-column><p>&copy; 1994-2024 The FreeBSD Project. All rights reserved</p><span>Made with <span class=heart>♥</span> by the FreeBSD Community</span></section></div></footer></body></html>