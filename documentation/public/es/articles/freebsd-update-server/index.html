<!doctype html><html class=theme-light lang=es><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Construir tu propio servidor para freebsd-update permite al administrador del sistema realizar actualizaciones rápidas para un determinado número de máquinas desde un mirror local"><meta name=keywords content="FreeBSD,Update,Server,internal"><meta name=copyright content="1995-2024 The FreeBSD Foundation"><link rel=canonical href=https://docs.freebsd.org/es/articles/freebsd-update-server/><title>Construye tu propio servidor de actualizaciones de FreeBSD | Portal de documentación de FreeBSD</title>
<meta name=theme-color content="#790000"><meta name=color-scheme content="system light dark high-contrast"><link rel="shortcut icon" href=https://docs.freebsd.org/favicon.ico><link rel=stylesheet href=https://docs.freebsd.org/styles/main.min.css><link rel=stylesheet href=https://docs.freebsd.org/css/font-awesome-min.css><script defer src=/js/theme-chooser.min.js></script><script defer src=/js/copy-clipboard.min.js></script><script defer src=/js/search.min.js></script><meta name=twitter:card content="summary"><meta name=twitter:domain content="docs.FreeBSD.org"><meta name=twitter:site content="@freebsd"><meta name=twitter:url content="https://twitter.com/freebsd"><meta property="og:title" content="Construye tu propio servidor de actualizaciones de FreeBSD"><meta property="og:description" content="Construir tu propio servidor para freebsd-update permite al administrador del sistema realizar actualizaciones rápidas para un determinado número de máquinas desde un mirror local"><meta property="og:type" content="website"><meta property="og:image" content="https://docs.freebsd.org/favicon.ico"><meta property="og:image:alt" content="FreeBSD Logo"><meta property="og:locale" content="es"><meta property="og:url" content="https://docs.freebsd.org/es/articles/freebsd-update-server/"><meta property="og:site_name" content="Portal de documentación de FreeBSD"><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","url":"https:\/\/docs.freebsd.org\/es\/articles\/freebsd-update-server\/","name":"Portal de documentación de FreeBSD","headline":"Portal de documentación de FreeBSD","description":"FreeBSD Documentation Portal"}</script></head><body><header><div class=header-container><div class=logo-menu-bars-container><a href=https://www.FreeBSD.org class=logo><img src=https://docs.freebsd.org/images/FreeBSD-monochromatic.svg width=160 height=50 alt="FreeBSD logo">
</a><label class=menu-bars for=menu-bars><i class="fa fa-bars" aria-hidden=true></i></label></div><input id=menu-bars type=checkbox><nav><ul class=menu><li class=menu-item><input id=about type=checkbox>
<a href=# aria-label="Navigate to About section"><label class=menu-item-description for=about>About
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/about/ target=_blank>About</a></li><li><a href=https://www.freebsd.org/about/ target=_blank>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/about-us/about-the-foundation/ target=_blank>FreeBSD Foundation</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct/ target=_blank>Code of Conduct</a></li></ul></li><li class=menu-item><input id=download type=checkbox>
<a href=# aria-label="Navigate to get FreeBSD section"><label class=menu-item-description for=download>Get FreeBSD
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/where/ target=_blank>Get FreeBSD</a></li><li><a href=https://www.freebsd.org/releases/ target=_blank>Release Information</a></li><li><a href=https://www.freebsd.org/releng/ target=_blank>Release Engineering</a></li><li><a href=https://www.freebsd.org/security/ target=_blank>Security Advisories</a></li></ul></li><li class=menu-item><input id=documentation type=checkbox>
<a href=# aria-label="Navigate to get Documentation section"><label class=menu-item-description for=documentation>Documentation
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=/es>Documentation portal</a></li><li><a href=https://docs.freebsd.org/es/books/handbook>FreeBSD Handbook</a></li><li><a href=https://docs.freebsd.org/es/books/porters-handbook>Porter's Handbook</a></li><li><a href=https://docs.FreeBSD.org/en/books/fdp-primer>Documentation Project Handbook</a></li><li><a href=https://man.FreeBSD.org target=_blank>Manual pages</a></li><li><a href=https://papers.FreeBSD.org target=_blank>Presentations and papers</a></li><li><a href=https://wiki.FreeBSD.org target=_blank>Wiki</a></li><li><a href=https://docs.freebsd.org/es/books>Books</a></li><li><a href=https://docs.freebsd.org/es/articles>Articles</a></li></ul></li><li class=menu-item><input id=community type=checkbox>
<a href=# aria-label="Navigate to get Community section"><label class=menu-item-description for=community>Community
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/community/>Community</a></li><li><a href=https://docs.freebsd.org/es/articles/contributing>Get involved</a></li><li><a href=https://forums.freebsd.org/ target=_blank>Forum</a></li><li><a href=https://lists.freebsd.org/ target=_blank>Mailing lists</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank>IRC Channels</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank>Bug Tracker</a></li><li><a href=https://www.freebsd.org/support/ target=_blank>Support</a></li></ul></li></ul></nav><div class=search-donate-container><form class=search method=get id=search-header-form action=https://docs.freebsd.org/search name=search-header-form><input type=hidden name=DB value=es>
<input id=words name=P type=text size=20 maxlength=255>
<button>
<i class="fa fa-search" aria-hidden=true></i></button></form><div class=donate><a href=https://freebsdfoundation.org/donate/ target=_blank><span class=heart>♥</span>
Donate</a></div></div></div></header><main class=main-wrapper-article><div class=article><h1 class=title>Construye tu propio servidor de actualizaciones de FreeBSD</h1><div class="admonitionblock note"><p><i class="fa fa-exclamation-circle" aria-hidden=true></i>
This translation may be out of date. To help with the translations please access the <a href=https://translate-dev.freebsd.org/ target=_blank>FreeBSD translations instance</a>.</p></div><div class=copyright>Copyright © 2009-2011, 2013 Jason Helfman</div><div class=legalnotice><a id=trademarks></a><details><summary>Marcas registradas</summary><p>FreeBSD es una marca registrada de la Fundación FreeBSD</p><p>AMD, AMD Athlon, AMD Opteron, AMD Phenom, AMD Sempron, AMD Turion, Athlon, Élan, Opteron, y PCnet son marcas registradas de Advanced Micro Devices, Inc.</p><p>Intel, Celeron, Centrino, Core, EtherExpress, i386, i486, Itanium, Pentium, y Xeon son marcas registradas de ntel Corporation o sus subsidiarias en los Estados Unidos de América y otros países.</p><p>Muchos de los nombres usados por los fabricantes y vendedores para diferenciar sus productos son designados como marcas comerciales. Allí donde estos nombres aparezcan en este documento y el Proyecto FreeBSD fuera consciente de la alegación de marca comercial, los nombres tienen a continuación el símbolo “™” o “®”.</p></details></div><div class=toc-mobile><h3>Tabla de contenidos</h3><nav id=TableOfContents><ul><li><a href=#acknowledgments>1. Reconocimientos</a></li><li><a href=#introduction>2. Introducción</a></li><li><a href=#prerequisites>3. Prerequisitos</a></li><li><a href=#Configuration>4. Configuración: Instalación & Preparación</a></li><li><a href=#build>5. Compilando el código de actualización</a></li><li><a href=#patch>6. Compilar un parche</a></li><li><a href=#tips>7. Consejos</a></li></ul></nav></div><div id=preamble><div class=sectionbody><div class="paragraph abstract-title"><p>Resumen</p></div><div class=paragraph><p>Este artículo describe cómo construir un Servidor de FreeBSD Update interno. El <a href=https://github.com/freebsd/freebsd-update-build/>freebsd-update-server</a> está escrito por <code>Colin Percival &lt;<a href=mailto:cperciva@FreeBSD.org>cperciva@FreeBSD.org</a>></code>, Security Officer Emérito de FreeBSD. Para los usuarios que consideran adecuado actualizar sus sistemas contra un servidor de actualizaciones oficial, construir su propio Servidor de FreeBSD Update podría ayudar a extender su funcionalidad mediante el soporte de versiones de FreeBSD ajustadas a mano o proporcionando un mirror local que permitirá actualizaciones más rápidas para un determinado número de máquinas.</p></div><hr></div></div><div class=sect1><h2 id=acknowledgments>1. Reconocimientos<a class=anchor href=#acknowledgments></a></h2><div class=sectionbody><div class=paragraph><p>Este artículo fue imprimido posteriormente en <a href=https://people.freebsd.org/~jgh/files/fus/BSD_03_2010_EN.pdf>BSD Magazine</a>.</p></div></div></div><div class=sect1><h2 id=introduction>2. Introducción<a class=anchor href=#introduction></a></h2><div class=sectionbody><div class=paragraph><p>Los usuarios experimentados o administradores a menudo son responsables de múltiples máquinas o entornos. Entienden las complicadas demandas y los desafíos de mantener una infraestructura de este tipo. Ejecutar un Servidor de Actualizaciones de FreeBSD facilita la implementación de parches de seguridad y software en las máquinas de pruebas seleccionadas antes de implementarlos en producción. Esto también significa que se pueden actualizar varios sistemas desde la red local en lugar de una conexión a Internet la cual sea potencialmente más lenta. Este artículo describe los pasos necesarios para crear un servidor de actualizaciones de FreeBSD propio.</p></div></div></div><div class=sect1><h2 id=prerequisites>3. Prerequisitos<a class=anchor href=#prerequisites></a></h2><div class=sectionbody><div class=paragraph><p>Para construir un Servidor de Actualizaciones de FreeBSD se tienen que cumplir algunos requisitos.</p></div><div class=ulist><ul><li><p>Un sistema FreeBSD en ejecución.</p><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Como mínimo, las actualizaciones requieren que cree una versión de FreeBSD que sea mayor o igual a la versión de la versión de destino para la distribución.</p></div></td></tr></tbody></table></div></li><li><p>Una cuenta de usuario con al menos 4 GB de espacio disponible. Esto permitirá la creación de actualizaciones para las versiones 7.1 y 7.2, los requisitos de espacio exactos pueden cambiar de una versión a otra.</p></li><li><p>Una cuneta <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;format=html">ssh(1)</a> en una máquina remota para subir los parches distribuidos.</p></li><li><p>Un servidor web, como <a href=https://docs.freebsd.org/es/books/handbook/#network-apache>Apache</a>, con más de la mitad del espacio requerido para la construcción. Por ejemplo, construcciones de prueba para 7.1 y 7.2 consumen un total de 4 GB, y el espacio necesario en el servidor web para distribuir estas actualizaciones es de 2.6 GB.</p></li><li><p>Conocimiento básico de shell scripting con el shell Bourne, <a href="https://man.freebsd.org/cgi/man.cgi?query=sh&amp;sektion=1&amp;format=html">sh(1)</a>.</p></li></ul></div></div></div><div class=sect1><h2 id=Configuration>4. Configuración: Instalación & Preparación<a class=anchor href=#Configuration></a></h2><div class=sectionbody><div class=paragraph><p>Descarga el software <a href=https://github.com/freebsd/freebsd-update-build/>freebsd-update-server</a> instalando los paquetes <a class=package href=https://cgit.freebsd.org/ports/tree/devel/git/>devel/git</a> y <a class=package href=https://cgit.freebsd.org/ports/tree/security/ca_root_nss/>security/ca_root_nss</a> y ejecuta:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git clone https://github.com/freebsd/freebsd-update-build.git freebsd-update-server</code></pre></div></div><div class=paragraph><p>Actualiza el fichero <span class=filename>scripts/build.conf</span> apropiadamente. Se crea durante todas las operaciones de construcción (build).</p></div><div class=paragraph><p>Aquí está el archivo <span class=filename>build.conf</span> predeterminado, que debe ser modificado para adaptarse a su entorno.</p></div><div class="literalblock programlisting"><div class=content><pre># Main configuration file for FreeBSD Update builds.  The
# release-specific configuration data is lower down in
# the scripts tree.

# Location from which to fetch releases
export FTP=ftp://ftp2.freebsd.org/pub/FreeBSD/releases <i class=conum data-value=1></i><b>(1)</b>

# Host platform
export HOSTPLATFORM=`uname -m`

# Host name to use inside jails
export BUILDHOSTNAME=${HOSTPLATFORM}-builder.daemonology.net <i class=conum data-value=2></i><b>(2)</b>

# Location of SSH key
export SSHKEY=/root/.ssh/id_dsa <i class=conum data-value=3></i><b>(3)</b>

# SSH account into which files are uploaded
MASTERACCT=builder@wadham.daemonology.net <i class=conum data-value=4></i><b>(4)</b>

# Directory into which files are uploaded
MASTERDIR=update-master.freebsd.org <i class=conum data-value=5></i><b>(5)</b></pre></div></div><div class=paragraph><p>Los parámetros a considerar son:</p></div><div class="colist arabic"><table><tbody><tr><td><i class=conum data-value=1></i><b>1</b></td><td>Este es el lugar desde donde se descargan las imágenes ISO (por la subrutina `fetchiso()`de <span class=filename>scripts/build.subr</span>). La localización configurada no se limita a URIs FTP. Cualquier esquema URI soportado por la utilidad estándar <a href="https://man.freebsd.org/cgi/man.cgi?query=fetch&amp;sektion=1&amp;format=html">fetch(1)</a> debería funcionar bien. Se pueden instalar adaptaciones al código de `fetchiso()`copiando el script por defecto <span class=filename>build.subr</span> a los áreas de release y específicos de la arquitectura en <span class=filename>scripts/RELEASE/ARCHITECTURE/build.subr</span> y aplicando cambios locales.</td></tr><tr><td><i class=conum data-value=2></i><b>2</b></td><td>El nombre del host de compilación. Esta información se mostrará en los sistemas que estén actualizados cuando se ejecute el comando:<div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% <span class=nb>uname</span> <span class=nt>-v</span></code></pre></div></div></td></tr><tr><td><i class=conum data-value=3></i><b>3</b></td><td>La clave SSH utilizada para subir los ficheros al servidor de actualizaciones. Se tiene que crear un par de claves tecleando <code>ssh-keygen -t dsa</code>. Este parámetro es opcional; se utilizará autenticación estándar por contraseña como mecanismo de reserva cuando <code>SSHKEY</code> no está definida. La página de manual de <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh-keygen&amp;sektion=1&amp;format=html">ssh-keygen(1)</a> tiene información más detallada acerca de SSH y los pasos apropiados para crear y utilizar una.</td></tr><tr><td><i class=conum data-value=4></i><b>4</b></td><td>Cuenta para subir archivos al servidor de actualizaciones.</td></tr><tr><td><i class=conum data-value=5></i><b>5</b></td><td>Directorio en el servidor de actualización donde se subirán los archivos.</td></tr></tbody></table></div><div class=paragraph><p>El archivo <span class=filename>build.conf</span> predeterminado incluido con el código fuente de freebsd-update-server es adecuado para compilar versiones i386 de FreeBSD. Como ejemplo de creación de un servidor de actualizaciones para otras arquitecturas, los siguientes pasos describen los cambios necesarios en la configuración para amd64:</p></div><div class="exampleblock procedure"><div class=content><div class="olist arabic"><ol class=arabic><li><p>Cree un entorno de compilación para amd64:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% <span class=nb>mkdir</span> <span class=nt>-p</span> /usr/local/freebsd-update-server/scripts/7.2-RELEASE/amd64</code></pre></div></div></li><li><p>Coloque el archivo <span class=filename>build.conf</span> en el directorio de compilación que acaba de crear. Las opciones de configuración de la compilación para FreeBSD 7.2-RELEASE en la arquitectura amd64 deberían de ser similares a:</p><div class="literalblock programlisting"><div class=content><pre># SHA256 hash of RELEASE disc1.iso image.
export RELH=1ea1f6f652d7c5f5eab7ef9f8edbed50cb664b08ed761850f95f48e86cc71ef5 <i class=conum data-value=1></i><b>(1)</b>
# Components of the world, source, and kernels
export WORLDPARTS=&#34;base catpages dict doc games info manpages proflibs lib32&#34;
export SOURCEPARTS=&#34;base bin contrib crypto etc games gnu include krb5  \
                lib libexec release rescue sbin secure share sys tools  \
                ubin usbin cddl&#34;
export KERNELPARTS=&#34;generic&#34;

# EOL date
export EOL=1275289200 <i class=conum data-value=2></i><b>(2)</b></pre></div></div><div class="colist arabic"><table><tbody><tr><td><i class=conum data-value=1></i><b>1</b></td><td>La clave hash <a href="https://man.freebsd.org/cgi/man.cgi?query=sha256&amp;sektion=1&amp;format=html">sha256(1)</a> para la versión deseada se publica con el respectivo <a href=https://www.FreeBSD.org/releases/>anuncio de lanzamiento</a>.</td></tr><tr><td><i class=conum data-value=2></i><b>2</b></td><td>Para generar el número de "End of Life" para <span class=filename>build.conf</span>, utiliza el "Estimated EOL" publicado en el <a href=https://www.FreeBSD.org/security/security/>FreeBSD Security Website</a>. El valor de <code>EOL</code> se puede derivar de la fecha establecida en el sitio web, usando la utilidad <a href="https://man.freebsd.org/cgi/man.cgi?query=date&amp;sektion=1&amp;format=html">date(1)</a>, por ejemplo:<div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% <span class=nb>date</span> <span class=nt>-j</span> <span class=nt>-f</span> <span class=s1>&#39;%Y%m%d-%H%M%S&#39;</span> <span class=s1>&#39;20090401-000000&#39;</span> <span class=s1>&#39;+%s&#39;</span></code></pre></div></div></td></tr></tbody></table></div></li></ol></div></div></div></div></div><div class=sect1><h2 id=build>5. Compilando el código de actualización<a class=anchor href=#build></a></h2><div class=sectionbody><div class=paragraph><p>El primer paso es ejecutar <span class=filename>scripts/make.sh</span>. Esto creará algunos binarios, creará directorios y generará una clave RSA utilizada para aprobar las compilaciones. En este paso, se deberá proporcionar una contraseña para la creación de la clave de firma.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sh scripts/make.sh</span>
cc <span class=nt>-O2</span> <span class=nt>-fno-strict-aliasing</span> <span class=nt>-pipe</span>   findstamps.c  <span class=nt>-o</span> findstamps
findstamps.c: In <span class=k>function</span> <span class=s1>&#39;usage&#39;</span>:
findstamps.c:45: warning: incompatible implicit declaration of built-in <span class=k>function</span> <span class=s1>&#39;exit&#39;</span>
cc <span class=nt>-O2</span> <span class=nt>-fno-strict-aliasing</span> <span class=nt>-pipe</span>   unstamp.c  <span class=nt>-o</span> unstamp
<span class=nb>install </span>findstamps ../bin
<span class=nb>install </span>unstamp ../bin
<span class=nb>rm</span> <span class=nt>-f</span> findstamps unstamp
Generating RSA private key, 4096 bit long modulus
................................................................................++
...................++
e is 65537 <span class=o>(</span>0x10001<span class=o>)</span>

Public key fingerprint:
27ef53e48dc869eea6c3136091cc6ab8589f967559824779e855d58a2294de9e

Encrypting signing key <span class=k>for </span>root
enter aes-256-cbc encryption password:
Verifying - enter aes-256-cbc encryption password:</code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Guarda una copia de seguridad de la huella digital generada. Este valor es necesario en el archivo <span class=filename>/etc/freebsd-update.conf</span> para las actualizaciones binarias.</p></div></td></tr></tbody></table></div><div class=paragraph><p>En este punto, estamos listos para empezar el build.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/local/freebsd-update-server</span>
<span class=c># sh scripts/init.sh amd64 7.2-RELEASE</span></code></pre></div></div><div class=paragraph><p>Lo que se muestra a continuación es un ejemplo de una ejecución de construcción <em>inicial</em>.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sh scripts/init.sh amd64 7.2-RELEASE</span>
Mon Aug 24 16:04:36 PDT 2009 Starting fetch <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
/usr/local/freebsd-update-server/work/7.2-RELE100 of  588 MB  359 kBps 00m00s
Mon Aug 24 16:32:38 PDT 2009 Verifying disc1 <span class=nb>hash </span><span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 16:32:44 PDT 2009 Extracting components <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 16:34:05 PDT 2009 Constructing world+src image <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 16:35:57 PDT 2009 Extracting world+src <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 23:36:24 UTC 2009 Building world <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Tue Aug 25 00:31:29 UTC 2009 Distributing world <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Tue Aug 25 00:32:36 UTC 2009 Building and distributing kernels <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Tue Aug 25 00:44:44 UTC 2009 Constructing world components <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Tue Aug 25 00:44:56 UTC 2009 Distributing <span class=nb>source </span><span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 17:46:18 PDT 2009 Moving components into staging area <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 17:46:33 PDT 2009 Identifying extra documentation <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 17:47:13 PDT 2009 Extracting extra docs <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 17:47:18 PDT 2009 Indexing release <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 17:50:44 PDT 2009 Indexing world0 <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE

Files built but not released:
Files released but not built:
Files which differ by more than contents:
Files which differ between release and build:
kernel|generic|/GENERIC/hptrr.ko
kernel|generic|/GENERIC/kernel
src|sys|/sys/conf/newvers.sh
world|base|/boot/loader
world|base|/boot/pxeboot
world|base|/etc/mail/freebsd.cf
world|base|/etc/mail/freebsd.submit.cf
world|base|/etc/mail/sendmail.cf
world|base|/etc/mail/submit.cf
world|base|/lib/libcrypto.so.5
world|base|/usr/bin/ntpq
world|base|/usr/lib/libalias.a
world|base|/usr/lib/libalias_cuseeme.a
world|base|/usr/lib/libalias_dummy.a
world|base|/usr/lib/libalias_ftp.a
...</code></pre></div></div><div class=paragraph><p>Entonces, se vuelve a realizar la construcción de todo (build world), con los parches de world. Puedes encontrar una explicación más detallada en <span class=filename>scripts/build.subr</span>.</p></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>Durante este segundo ciclo de construcción, el demonio del protocolo de tiempo de red, <a href="https://man.freebsd.org/cgi/man.cgi?query=ntpd&amp;sektion=8&amp;format=html">ntpd(8)</a>, se desactiva. Según <code>Colin Percival &lt;<a href=mailto:cperciva@FreeBSD.org>cperciva@FreeBSD.org</a>></code>, Security Officer Emérito de FreeBSD, "el código de construcción de <a href=https://github.com/freebsd/freebsd-update-build/>freebsd-update-server</a> necesita identificar timestamps que se almacenan en ficheros de forma que se puedan ignorar cuando se comparan distintas construcciones para determinar qué ficheros se han actualizado. Este trabajo de encontrar los timestamps funciona haciendo dos construcciones separadas 400 días y comparando los resultados."</p></div></td></tr></tbody></table></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>Mon Aug 24 17:54:07 PDT 2009 Extracting world+src <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Wed Sep 29 00:54:34 UTC 2010 Building world <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Wed Sep 29 01:49:42 UTC 2010 Distributing world <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Wed Sep 29 01:50:50 UTC 2010 Building and distributing kernels <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Wed Sep 29 02:02:56 UTC 2010 Constructing world components <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Wed Sep 29 02:03:08 UTC 2010 Distributing <span class=nb>source </span><span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Tue Sep 28 19:04:31 PDT 2010 Moving components into staging area <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 19:04:46 PDT 2009 Extracting extra docs <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 19:04:51 PDT 2009 Indexing world1 <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 19:08:04 PDT 2009 Locating build stamps <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 19:10:19 PDT 2009 Cleaning staging area <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 19:10:19 PDT 2009 Preparing to copy files into staging area <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 19:10:20 PDT 2009 Copying data files into staging area <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 12:16:57 PDT 2009 Copying metadata files into staging area <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 12:16:59 PDT 2009 Constructing metadata index and tag <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE

Files found which include build stamps:
kernel|generic|/GENERIC/hptrr.ko
kernel|generic|/GENERIC/kernel
world|base|/boot/loader
world|base|/boot/pxeboot
world|base|/etc/mail/freebsd.cf
world|base|/etc/mail/freebsd.submit.cf
world|base|/etc/mail/sendmail.cf
world|base|/etc/mail/submit.cf
world|base|/lib/libcrypto.so.5
world|base|/usr/bin/ntpq
world|base|/usr/include/osreldate.h
world|base|/usr/lib/libalias.a
world|base|/usr/lib/libalias_cuseeme.a
world|base|/usr/lib/libalias_dummy.a
world|base|/usr/lib/libalias_ftp.a
...</code></pre></div></div><div class=paragraph><p>Finalmente, el build termina.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>Values of build stamps, excluding library archive headers:
v1.2 <span class=o>(</span>Aug 25 2009 00:40:36<span class=o>)</span>
v1.2 <span class=o>(</span>Aug 25 2009 00:38:22<span class=o>)</span>
@<span class=o>()</span>FreeBSD 7.2-RELEASE 0: Tue Aug 25 00:38:29 UTC 2009
FreeBSD 7.2-RELEASE 0: Tue Aug 25 00:38:29 UTC 2009
    root@server.myhost.com:/usr/obj/usr/src/sys/GENERIC
7.2-RELEASE
Mon Aug 24 23:55:25 UTC 2009
Mon Aug 24 23:55:25 UTC 2009
 built by root@server.myhost.com on Tue Aug 25 00:16:15 UTC 2009
 built by root@server.myhost.com on Tue Aug 25 00:16:15 UTC 2009
 built by root@server.myhost.com on Tue Aug 25 00:16:15 UTC 2009
 built by root@server.myhost.com on Tue Aug 25 00:16:15 UTC 2009
Mon Aug 24 23:46:47 UTC 2009
ntpq 4.2.4p5-a Mon Aug 24 23:55:53 UTC 2009 <span class=o>(</span>1<span class=o>)</span>
 <span class=k>*</span> Copyright <span class=o>(</span>c<span class=o>)</span> 1992-2009 The FreeBSD Project.
Mon Aug 24 23:46:47 UTC 2009
Mon Aug 24 23:55:40 UTC 2009
Aug 25 2009
ntpd 4.2.4p5-a Mon Aug 24 23:55:52 UTC 2009 <span class=o>(</span>1<span class=o>)</span>
ntpdate 4.2.4p5-a Mon Aug 24 23:55:53 UTC 2009 <span class=o>(</span>1<span class=o>)</span>
ntpdc 4.2.4p5-a Mon Aug 24 23:55:53 UTC 2009 <span class=o>(</span>1<span class=o>)</span>
Tue Aug 25 00:21:21 UTC 2009
Tue Aug 25 00:21:21 UTC 2009
Tue Aug 25 00:21:21 UTC 2009
Mon Aug 24 23:46:47 UTC 2009

FreeBSD/amd64 7.2-RELEASE initialization build complete.  Please
review the list of build stamps printed above to confirm that
they look sensible, <span class=k>then </span>run
 sh <span class=nt>-e</span> approve.sh amd64 7.2-RELEASE
to sign the release.</code></pre></div></div><div class=paragraph><p>Aprobar la construcción si todo es correcto. Puedes encontrar más información sobre cómo determinar si es correcto en el archivo <span class=filename>USAGE</span>. Ejecuta <span class=filename>scripts/approve.sh</span>, como se indica. Esto firmará la versión y moverá los componentes a un área de preparación adecuada para la subida.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/local/freebsd-update-server</span>
<span class=c># sh scripts/mountkey.sh</span></code></pre></div></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sh -e scripts/approve.sh amd64 7.2-RELEASE</span>
Wed Aug 26 12:50:06 PDT 2009 Signing build <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Wed Aug 26 12:50:06 PDT 2009 Copying files to patch <span class=nb>source </span>directories <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Wed Aug 26 12:50:06 PDT 2009 Copying files to upload staging area <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Wed Aug 26 12:50:07 PDT 2009 Updating databases <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Wed Aug 26 12:50:07 PDT 2009 Cleaning staging area <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE</code></pre></div></div><div class=paragraph><p>Una vez finalizado el proceso de aprobación, se puede iniciar el proceso de subida.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/local/freebsd-update-server</span>
<span class=c># sh scripts/upload.sh amd64 7.2-RELEASE</span></code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>En el caso de que código de actualización necesite ser subido de nuevo, se puede hacer cambiando al directorio público de las distribuciones para la versión que se quiera y actualizando los atributos del fichero <em>uploaded</em>.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/local/freebsd-update-server/pub/7.2-RELEASE/amd64</span>
<span class=c># touch -t 200801010101.01 uploaded</span></code></pre></div></div></td></tr></tbody></table></div><div class=paragraph><p>Se necesita que los ficheros subidos se encuentren en el documento raíz del servidor web para que las actualizaciones sean distribuidas. La configuración exacta variará dependiendo del servidor web utilizado. Para el servidor web Apache, por favor lee la sección <a href=https://docs.freebsd.org/es/books/handbook/#network-apache>Configuration of Apache servers</a> en el Handbook.</p></div><div class=paragraph><p>Actualiza <code>KeyPrint</code> y <code>ServerName</code> del cliente en <span class=filename>/etc/freebsd-update.conf</span> y actualiza según se indica en la sección <a href=https://docs.freebsd.org/es/books/handbook/#updating-upgrading-freebsdupdate>FreeBSD Update</a> del Handbook.</p></div><div class="admonitionblock important"><table><tbody><tr><td class=icon><i class="fa icon-important" title=Important></i></td><td class=content><div class=paragraph><p>Para que el Servidor de Actualizaciones de FreeBSD funcione correctamente, se necesita construir tanto la versión <em>actual</em> como la versión <em>a la que se quiere actualizar</em>. Esto es necesario para determinar las diferencias entre dos versiones. Por ejemplo, cuando se actualiza un sistema FreeBSD de 7.1-RELEASE a 7.2-RELEASE, las actualizaciones necesitan construirse y subirse a tu servidor de distribución para ambas versiones.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Como referencia, se adjunta la ejecución completa de <a href=../../source/articles/freebsd-update-server/init.txt>init.sh</a>.</p></div></div></div><div class=sect1><h2 id=patch>6. Compilar un parche<a class=anchor href=#patch></a></h2><div class=sectionbody><div class=paragraph><p>Cada vez que se anuncia un <a href=https://www.FreeBSD.org/security/advisories/>security advisory</a> o un <a href=https://www.FreeBSD.org/security/notices/>security notice</a> se puede construir un parche de actualización.</p></div><div class=paragraph><p>Para este ejemplo, se utilizará 7.1-RELEASE.</p></div><div class=paragraph><p>Para una versión de lanzamiento diferente, se da por hecho un par de suposiciones:</p></div><div class=ulist><ul><li><p>Que ha configurado la estructura de directorios correcta para la compilación inicial.</p></li><li><p>Que ha realizado una compilación inicial para la versión 7.1-RELEASE.</p></li></ul></div><div class=paragraph><p>Cree el directorio de parches para la versión correspondiente en <span class=filename>/usr/local/freebsd-update-server/patches/</span>.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% <span class=nb>mkdir</span> <span class=nt>-p</span> /usr/local/freebsd-update-server/patches/7.1-RELEASE/
% <span class=nb>cd</span> /usr/local/freebsd-update-server/patches/7.1-RELEASE</code></pre></div></div><div class=paragraph><p>Toma como ejemplo el parche para <a href="https://man.freebsd.org/cgi/man.cgi?query=named&amp;sektion=8&amp;format=html">named(8)</a>. Lee la advertencia de seguridad y obtén el fichero necesario de <a href=https://www.FreeBSD.org/security/advisories/>FreeBSD Security Advisories</a>. Se puede encontrar más información acerca de cómo interpretar las advertencias en <a href=https://docs.freebsd.org/es/books/handbook/#security-advisories>FreeBSD Handbook</a>.</p></div><div class=paragraph><p>En el <a href=https://security.freebsd.org/advisories/FreeBSD-SA-09:12.bind.asc>security brief</a>, esta advertencia se llama <code>SA-09:12.bind</code>. Después de descargar el fichero, se necesita renombrar el fichero a un nivel de parcheado apropiado. Se sugiere mantenerlo consistente con los niveles de parche oficiales de FreeBSD, pero su nombre se puede escoger libremente. Para esta construcción, sigamos la práctica actualmente establecida en FreeBSD y llamemos a este <code>p7</code>. Renombra el fichero:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% <span class=nb>cd</span> /usr/local/freebsd-update-server/patches/7.1-RELEASE/<span class=p>;</span> <span class=nb>mv </span>bind.patch 7-SA-09:12.bind</code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Cuando se ejecuta la compilación del parche, se asume que los parches anteriores están en su sitio. Cuando se ejecute la compilación de los parches, se ejecutarán todos los parches que se encuentren en el directorio de parches.</p></div><div class=paragraph><p>Puede haber parches personalizados adjuntos a cualquier compilación. Usa el número cero, o cualquier otro número.</p></div></td></tr></tbody></table></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>Depende del administrador del Servidor de Actualizaciones de FreeBSD tomar las medidas apropiadas para verificar la autenticidad de cada parche.</p></div></td></tr></tbody></table></div><div class=paragraph><p>En este punto, ya se puede construir un <em>diff</em>. El software comprueba primero si se ha ejecutado un <span class=filename>scripts/init.sh</span> en la versión respectiva antes de ejecutar la construcción del diff.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/local/freebsd-update-server</span>
<span class=c># sh scripts/diff.sh amd64 7.1-RELEASE 7</span></code></pre></div></div><div class=paragraph><p>Lo siguiente es una muestra de una ejecución de construcción <em>differencial</em>.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sh -e scripts/diff.sh amd64 7.1-RELEASE 7</span>
Wed Aug 26 10:09:59 PDT 2009 Extracting world+src <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Wed Aug 26 17:10:25 UTC 2009 Building world <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Wed Aug 26 18:05:11 UTC 2009 Distributing world <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Wed Aug 26 18:06:16 UTC 2009 Building and distributing kernels <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Wed Aug 26 18:17:50 UTC 2009 Constructing world components <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Wed Aug 26 18:18:02 UTC 2009 Distributing <span class=nb>source </span><span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Wed Aug 26 11:19:23 PDT 2009 Moving components into staging area <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Wed Aug 26 11:19:37 PDT 2009 Extracting extra docs <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Wed Aug 26 11:19:42 PDT 2009 Indexing world0 <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Wed Aug 26 11:23:02 PDT 2009 Extracting world+src <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Thu Sep 30 18:23:29 UTC 2010 Building world <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Thu Sep 30 19:18:15 UTC 2010 Distributing world <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Thu Sep 30 19:19:18 UTC 2010 Building and distributing kernels <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Thu Sep 30 19:30:52 UTC 2010 Constructing world components <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Thu Sep 30 19:31:03 UTC 2010 Distributing <span class=nb>source </span><span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Thu Sep 30 12:32:25 PDT 2010 Moving components into staging area <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Wed Aug 26 12:32:39 PDT 2009 Extracting extra docs <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Wed Aug 26 12:32:43 PDT 2009 Indexing world1 <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Wed Aug 26 12:35:54 PDT 2009 Locating build stamps <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Wed Aug 26 12:36:58 PDT 2009 Reverting changes due to build stamps <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Wed Aug 26 12:37:14 PDT 2009 Cleaning staging area <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Wed Aug 26 12:37:14 PDT 2009 Preparing to copy files into staging area <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Wed Aug 26 12:37:15 PDT 2009 Copying data files into staging area <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Wed Aug 26 12:43:23 PDT 2009 Copying metadata files into staging area <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Wed Aug 26 12:43:25 PDT 2009 Constructing metadata index and tag <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
...
Files found which include build stamps:
kernel|generic|/GENERIC/hptrr.ko
kernel|generic|/GENERIC/kernel
world|base|/boot/loader
world|base|/boot/pxeboot
world|base|/etc/mail/freebsd.cf
world|base|/etc/mail/freebsd.submit.cf
world|base|/etc/mail/sendmail.cf
world|base|/etc/mail/submit.cf
world|base|/lib/libcrypto.so.5
world|base|/usr/bin/ntpq
world|base|/usr/include/osreldate.h
world|base|/usr/lib/libalias.a
world|base|/usr/lib/libalias_cuseeme.a
world|base|/usr/lib/libalias_dummy.a
world|base|/usr/lib/libalias_ftp.a
...
Values of build stamps, excluding library archive headers:
v1.2 <span class=o>(</span>Aug 26 2009 18:13:46<span class=o>)</span>
v1.2 <span class=o>(</span>Aug 26 2009 18:11:44<span class=o>)</span>
@<span class=o>()</span>FreeBSD 7.1-RELEASE-p7 0: Wed Aug 26 18:11:50 UTC 2009
FreeBSD 7.1-RELEASE-p7 0: Wed Aug 26 18:11:50 UTC 2009
    root@server.myhost.com:/usr/obj/usr/src/sys/GENERIC
7.1-RELEASE-p7
Wed Aug 26 17:29:15 UTC 2009
Wed Aug 26 17:29:15 UTC 2009
 built by root@server.myhost.com on Wed Aug 26 17:49:58 UTC 2009
 built by root@server.myhost.com on Wed Aug 26 17:49:58 UTC 2009
 built by root@server.myhost.com on Wed Aug 26 17:49:58 UTC 2009
 built by root@server.myhost.com on Wed Aug 26 17:49:58 UTC 2009
Wed Aug 26 17:20:39 UTC 2009
ntpq 4.2.4p5-a Wed Aug 26 17:29:42 UTC 2009 <span class=o>(</span>1<span class=o>)</span>
 <span class=k>*</span> Copyright <span class=o>(</span>c<span class=o>)</span> 1992-2009 The FreeBSD Project.
Wed Aug 26 17:20:39 UTC 2009
Wed Aug 26 17:29:30 UTC 2009
Aug 26 2009
ntpd 4.2.4p5-a Wed Aug 26 17:29:41 UTC 2009 <span class=o>(</span>1<span class=o>)</span>
ntpdate 4.2.4p5-a Wed Aug 26 17:29:42 UTC 2009 <span class=o>(</span>1<span class=o>)</span>
ntpdc 4.2.4p5-a Wed Aug 26 17:29:42 UTC 2009 <span class=o>(</span>1<span class=o>)</span>
Wed Aug 26 17:55:02 UTC 2009
Wed Aug 26 17:55:02 UTC 2009
Wed Aug 26 17:55:02 UTC 2009
Wed Aug 26 17:20:39 UTC 2009
...</code></pre></div></div><div class=paragraph><p>Se muestran las actualizaciones y se te solicita aprobación.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>New updates:
kernel|generic|/GENERIC/kernel.symbols|f|0|0|0555|0|7c8dc176763f96ced0a57fc04e7c1b8d793f27e006dd13e0b499e1474ac47e10|
kernel|generic|/GENERIC/kernel|f|0|0|0555|0|33197e8cf15bbbac263d17f39c153c9d489348c2c534f7ca1120a1183dec67b1|
kernel|generic|/|d|0|0|0755|0||
src|base|/|d|0|0|0755|0||
src|bin|/|d|0|0|0755|0||
src|cddl|/|d|0|0|0755|0||
src|contrib|/contrib/bind9/bin/named/update.c|f|0|10000|0644|0|4d434abf0983df9bc47435670d307fa882ef4b348ed8ca90928d250f42ea0757|
src|contrib|/contrib/bind9/lib/dns/openssldsa_link.c|f|0|10000|0644|0|c6805c39f3da2a06dd3f163f26c314a4692d4cd9a2d929c0acc88d736324f550|
src|contrib|/contrib/bind9/lib/dns/opensslrsa_link.c|f|0|10000|0644|0|fa0f7417ee9da42cc8d0fd96ad24e7a34125e05b5ae075bd6e3238f1c022a712|
...
FreeBSD/amd64 7.1-RELEASE update build complete.  Please review
the list of build stamps printed above and the list of updated
files to confirm that they look sensible, <span class=k>then </span>run
<span class=c># sh -e approve.sh amd64 7.1-RELEASE</span>
to sign the build.</code></pre></div></div><div class=paragraph><p>Sigue el mismo proceso descrito anteriormente para dar tu aprobación a una compilación:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sh -e scripts/approve.sh amd64 7.1-RELEASE</span>
Wed Aug 26 12:50:06 PDT 2009 Signing build <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE
Wed Aug 26 12:50:06 PDT 2009 Copying files to patch <span class=nb>source </span>directories <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE
Wed Aug 26 12:50:06 PDT 2009 Copying files to upload staging area <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE
Wed Aug 26 12:50:07 PDT 2009 Updating databases <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE
Wed Aug 26 12:50:07 PDT 2009 Cleaning staging area <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE

The FreeBSD/amd64 7.1-RELEASE update build has been signed and is
ready to be uploaded.  Remember to run
 sh <span class=nt>-e</span> umountkey.sh
to unmount the decrypted key once you have finished signing all
the new builds.</code></pre></div></div><div class=paragraph><p>Después de dar tu aprobación a la compilación, sube el software al servidor de actualizaciones:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/local/freebsd-update-server</span>
<span class=c># sh scripts/upload.sh amd64 7.1-RELEASE</span></code></pre></div></div><div class=paragraph><p>Se adjunta como referencia el resultado de la ejecución completa de <a href=../../source/articles/freebsd-update-server/diff.txt>diff.sh</a>.</p></div></div></div><div class=sect1><h2 id=tips>7. Consejos<a class=anchor href=#tips></a></h2><div class=sectionbody><div class=ulist><ul><li><p>Si se construye una versión personalizada utilizando el comando nativo <code>make release</code> <a href=https://docs.freebsd.org/en/articles/releng/#release-build>procedure</a>, el código de freebsd-update-server funcionará desde tu versión. Como ejemplo, se puede construir una versión sin ports o documentación eliminando funcionalidad que hace referencia a las rutinas de documentación <code>findextradocs ()</code>, <code>addextradocs ()</code> y alterando el lugar de descarga en <code>fetchiso ()</code>, respectivamente, en in <span class=filename>scripts/build.subr</span>. Como último paso, cambia el hash <a href="https://man.freebsd.org/cgi/man.cgi?query=sha256&amp;sektion=1&amp;format=html">sha256(1)</a> en <span class=filename>build.conf</span> en tu versión y arquitectura específica y ya estás listo para construir tu versión personalizada.</p><div class="literalblock programlisting"><div class=content><pre># Compare ${WORKDIR}/release y ${WORKDIR}/$1, identifique qué partes
# del subcomponente world|doc faltan en este último, y
# construya el tarball con ellas.
findextradocs () {
}
# Añadir documentos extra a ${WORKDIR}/$1
addextradocs () {
}</pre></div></div></li><li><p>Añadir flags <code>-j <em>NUMERO</em></code> a los objetivos <code>buildworld</code> y <code>obj</code> en el script <span class=filename>scripts/build.subr</span> puede acelerar el proceso dependiendo del hardware utilizado, sin embargo no es necesario. Utilizar estos flags en otros objetivos no está recomendado, ya que puede provocar que la construcción no sea correcta.</p><div class="literalblock programlisting"><div class=content><pre>              # Build the world
		   log &#34;Building world&#34;
		   cd /usr/src &amp;&amp;
		   make -j 2 ${COMPATFLAGS} buildworld 2&gt;&amp;1
		# Distribute the world
		   log &#34;Distributing world&#34;
		   cd /usr/src/release &amp;&amp;
		   make -j 2 obj &amp;&amp;
		   make ${COMPATFLAGS} release.1 release.2 2&gt;&amp;1</pre></div></div></li><li><p>Crea un registro <a href=https://docs.freebsd.org/es/books/handbook/#network-dns>DNS</a> SRV para el servidor de actualizaciones y pon otros detrás de él con pesos variables. Utilizar este mecanismo proporcionará mirrors de actualización, sin embargo, este truco no es necesario a menos que desees proporcionar servicio redundante.</p><div class="literalblock programlisting"><div class=content><pre>_http._tcp.update.myserver.com.		IN SRV   0 2 80   host1.myserver.com.
					IN SRV   0 1 80   host2.myserver.com.
					IN SRV   0 0 80   host3.myserver.com.</pre></div></div></li></ul></div></div></div><hr><div class=last-modified><p><strong>Last modified on</strong>: 11 de julio de 2022 by <a href="https://cgit.freebsd.org/doc/commit/?id=c53354cb48" target=_blank>Fernando Apesteguía</a></p></div></div><aside class=toc><div class=toc-content><h3>Tabla de contenidos</h3><nav id=TableOfContents><ul><li><a href=#acknowledgments>1. Reconocimientos</a></li><li><a href=#introduction>2. Introducción</a></li><li><a href=#prerequisites>3. Prerequisitos</a></li><li><a href=#Configuration>4. Configuración: Instalación & Preparación</a></li><li><a href=#build>5. Compilando el código de actualización</a></li><li><a href=#patch>6. Compilar un parche</a></li><li><a href=#tips>7. Consejos</a></li></ul></nav><hr><div class=resources><h3>Recursos</h3><ul class=contents><li><i class="fa fa-file-pdf-o" aria-hidden=true title="Descargar PDF"></i><a href=https://download.freebsd.org/doc/es/articles/freebsd-update-server/freebsd-update-server_es.pdf>Descargar PDF</a></li><li><i class="fa fa-pencil-square-o" aria-hidden=true title="Editar esta página"></i><a href=https://github.com/freebsd/freebsd-doc/blob/main/documentation/content/es/_index target=_blank>Editar esta página</a></li></ul></div></div></aside></main><footer><div class=footer-container><section class=logo-column><img src=https://docs.freebsd.org/images/FreeBSD-colors.svg width=160 height=50 alt="FreeBSD logo"><div class=options-container><div class=language-container><a id=languages href=https://docs.freebsd.org/es/languages><img src=https://docs.freebsd.org/images/language.png class=language-image alt="Elegir idioma">
<span>Spanish</span></a></div><div class=theme-container><select id=theme-chooser><option value=theme-system>System</option><option value=theme-light>Claro</option><option value=theme-dark>Oscuro</option><option value=theme-high-contrast>Alto contraste</option></select></div></div></section><section class=about-column><h3 class=column-title>About</h3><ul class=column-elements-container><li><a href=https://www.freebsd.org/about/ target=_blank class=column-element>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/ target=_blank class=column-element>FreeBSD Foundation</a></li><li><a href=https://www.freebsd.org/where/ target=_blank class=column-element>Get FreeBSD</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct target=_blank class=column-element>Code of Conduct</a></li><li><a href=https://www.freebsd.org/security/ target=_blank class=column-element>Security Advisories</a></li></ul></section><section class=documentation-column><h3 class=column-title>Documentation</h3><ul class=column-elements-container><li><a href=/es class=column-element>Documentation portal</a></li><li><a href=https://man.FreeBSD.org target=_blank class=column-element>Manual pages</a></li><li><a href=https://papers.FreeBSD.org target=_blank class=column-element>Presentations and papers</a></li><li><a href=https://docs-archive.freebsd.org/doc/ target=_blank class=column-element>Previous versions</a></li><li><a href=https://docs-archive.freebsd.org/44doc/ target=_blank class=column-element>4.4BSD Documents</a></li><li><a href=https://wiki.freebsd.org/ target=_blank class=column-element>Wiki</a></li></ul></section><section class=community-column><h3 class=column-title>Community</h3><ul class=column-elements-container><li><a href=https://docs.freebsd.org/es/articles/contributing class=column-element>Get involved</a></li><li><a href=https://forums.freebsd.org/ target=_blank class=column-element>Community forum</a></li><li><a href=https://lists.freebsd.org/ target=_blank class=column-element>Mailing lists</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank class=column-element>IRC Channels</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank class=column-element>Bug Tracker</a></li></ul></section><section class=legal-column><h3 class=column-title>Legal</h3><ul class=column-elements-container><li><a href=https://freebsdfoundation.org/donate/ target=_blank class=column-element>Donations</a></li><li><a href=https://www.freebsd.org/copyright/freebsd-license/ target=_blank class=column-element>Licensing</a></li><li><a href=https://www.freebsd.org/privacy/ target=_blank class=column-element>Privacy Policy</a></li><li><a href=https://www.freebsd.org/copyright/ target=_blank class=column-element>Legal notices</a></li></ul></section><section class=copyright-column><p>&copy; 1994-2024 The FreeBSD Project. All rights reserved</p><span>Made with <span class=heart>♥</span> by the FreeBSD Community</span></section></div></footer></body></html>