<!doctype html><html class=theme-light lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Building your own freebsd-update server allows a system administrator to perform fast updates for a number of machines from a local mirror"><meta name=keywords content="FreeBSD,Update,Server,internal"><meta name=copyright content="1995-2024 The FreeBSD Foundation"><link rel=canonical href=https://docs.freebsd.org/en/articles/freebsd-update-server/><title>Build Your Own FreeBSD Update Server | FreeBSD Documentation Portal</title>
<meta name=theme-color content="#790000"><meta name=color-scheme content="system light dark high-contrast"><link rel="shortcut icon" href=https://docs.freebsd.org/favicon.ico><link rel=stylesheet href=https://docs.freebsd.org/styles/main.min.css><link rel=stylesheet href=https://docs.freebsd.org/css/font-awesome-min.css><script defer src=/js/theme-chooser.min.js></script><script defer src=/js/copy-clipboard.min.js></script><script defer src=/js/search.min.js></script><meta name=twitter:card content="summary"><meta name=twitter:domain content="docs.FreeBSD.org"><meta name=twitter:site content="@freebsd"><meta name=twitter:url content="https://twitter.com/freebsd"><meta property="og:title" content="Build Your Own FreeBSD Update Server"><meta property="og:description" content="Building your own freebsd-update server allows a system administrator to perform fast updates for a number of machines from a local mirror"><meta property="og:type" content="website"><meta property="og:image" content="https://docs.freebsd.org/favicon.ico"><meta property="og:image:alt" content="FreeBSD Logo"><meta property="og:locale" content="en"><meta property="og:url" content="https://docs.freebsd.org/en/articles/freebsd-update-server/"><meta property="og:site_name" content="FreeBSD Documentation Portal"><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","url":"https:\/\/docs.freebsd.org\/en\/articles\/freebsd-update-server\/","name":"FreeBSD Documentation Portal","headline":"FreeBSD Documentation Portal","description":"FreeBSD Documentation Portal"}</script></head><body><header><div class=header-container><div class=logo-menu-bars-container><a href=https://www.FreeBSD.org class=logo><img src=https://docs.freebsd.org/images/FreeBSD-monochromatic.svg width=160 height=50 alt="FreeBSD logo">
</a><label class=menu-bars for=menu-bars><i class="fa fa-bars" aria-hidden=true></i></label></div><input id=menu-bars type=checkbox><nav><ul class=menu><li class=menu-item><input id=about type=checkbox>
<a href=# aria-label="Navigate to About section"><label class=menu-item-description for=about>About
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/about/ target=_blank>About</a></li><li><a href=https://www.freebsd.org/about/ target=_blank>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/about-us/about-the-foundation/ target=_blank>FreeBSD Foundation</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct/ target=_blank>Code of Conduct</a></li></ul></li><li class=menu-item><input id=download type=checkbox>
<a href=# aria-label="Navigate to get FreeBSD section"><label class=menu-item-description for=download>Get FreeBSD
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/where/ target=_blank>Get FreeBSD</a></li><li><a href=https://www.freebsd.org/releases/ target=_blank>Release Information</a></li><li><a href=https://www.freebsd.org/releng/ target=_blank>Release Engineering</a></li><li><a href=https://www.freebsd.org/security/ target=_blank>Security Advisories</a></li></ul></li><li class=menu-item><input id=documentation type=checkbox>
<a href=# aria-label="Navigate to get Documentation section"><label class=menu-item-description for=documentation>Documentation
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=/en>Documentation portal</a></li><li><a href=https://docs.freebsd.org/en/books/handbook>FreeBSD Handbook</a></li><li><a href=https://docs.freebsd.org/en/books/porters-handbook>Porter's Handbook</a></li><li><a href=https://docs.FreeBSD.org/en/books/fdp-primer>Documentation Project Handbook</a></li><li><a href=https://man.FreeBSD.org target=_blank>Manual pages</a></li><li><a href=https://papers.FreeBSD.org target=_blank>Presentations and papers</a></li><li><a href=https://wiki.FreeBSD.org target=_blank>Wiki</a></li><li><a href=https://docs.freebsd.org/en/books>Books</a></li><li><a href=https://docs.freebsd.org/en/articles>Articles</a></li></ul></li><li class=menu-item><input id=community type=checkbox>
<a href=# aria-label="Navigate to get Community section"><label class=menu-item-description for=community>Community
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/community/>Community</a></li><li><a href=https://docs.freebsd.org/en/articles/contributing>Get involved</a></li><li><a href=https://forums.freebsd.org/ target=_blank>Forum</a></li><li><a href=https://lists.freebsd.org/ target=_blank>Mailing lists</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank>IRC Channels</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank>Bug Tracker</a></li><li><a href=https://www.freebsd.org/support/ target=_blank>Support</a></li></ul></li></ul></nav><div class=search-donate-container><form class=search method=get id=search-header-form action=https://docs.freebsd.org/search name=search-header-form><input type=hidden name=DB value=en>
<input id=words name=P type=text size=20 maxlength=255>
<button>
<i class="fa fa-search" aria-hidden=true></i></button></form><div class=donate><a href=https://freebsdfoundation.org/donate/ target=_blank><span class=heart>♥</span>
Donate</a></div></div></div></header><main class=main-wrapper-article><div class=article><h1 class=title>Build Your Own FreeBSD Update Server</h1><div class=copyright>Copyright © 2009-2011, 2013 Jason Helfman</div><div class=legalnotice><a id=trademarks></a><details><summary>trademarks</summary><p>FreeBSD is a registered trademark of the FreeBSD Foundation.</p><p>AMD, AMD Athlon, AMD Opteron, AMD Phenom, AMD Sempron, AMD Turion, Athlon, Élan, Opteron, and PCnet are trademarks of Advanced Micro Devices, Inc.</p><p>Intel, Celeron, Centrino, Core, EtherExpress, i386, i486, Itanium, Pentium, and Xeon are trademarks or registered trademarks of Intel Corporation or its subsidiaries in the United States and other countries.</p><p>Many of the designations used by manufacturers and sellers to distinguish their products are claimed as trademarks. Where those designations appear in this document, and the FreeBSD Project was aware of the trademark claim, the designations have been followed by the “™” or the “®” symbol.</p></details></div><div class=toc-mobile><h3>Table of Contents</h3><nav id=TableOfContents><ul><li><a href=#acknowledgments>1. Acknowledgments</a></li><li><a href=#introduction>2. Introduction</a></li><li><a href=#prerequisites>3. Prerequisites</a></li><li><a href=#Configuration>4. Configuration: Installation & Setup</a></li><li><a href=#build>5. Building Update Code</a></li><li><a href=#patch>6. Building a Patch</a></li><li><a href=#tips>7. Tips</a></li></ul></nav></div><div id=preamble><div class=sectionbody><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>The instructions in this article refer to an older version of FreeBSD and may
not work properly on recent versions of the OS. With the availability of
pkgbase, the freebsd-update utility is scheduled to be removed from FreeBSD in
the future. When that happens, this article is either updated to reflect the
new procedures or removed entirely.</p></div></td></tr></tbody></table></div><div class="paragraph abstract-title"><p>Abstract</p></div><div class=paragraph><p>This article describes building an internal FreeBSD Update Server.
The <a href=https://github.com/freebsd/freebsd-update-build/>freebsd-update-server</a> is written by <code>Colin Percival &lt;<a href=mailto:cperciva@FreeBSD.org>cperciva@FreeBSD.org</a>></code>, Security Officer Emeritus of FreeBSD.
For users that think it is convenient to update their systems against an official update server, building their own FreeBSD Update Server may help to extend its functionality by supporting manually-tweaked FreeBSD releases or by providing a local mirror that will allow faster updates for a number of machines.</p></div><hr></div></div><div class=sect1><h2 id=acknowledgments>1. Acknowledgments<a class=anchor href=#acknowledgments></a></h2><div class=sectionbody><div class=paragraph><p>This article was subsequently printed at <a href=https://people.freebsd.org/~jgh/files/fus/BSD_03_2010_EN.pdf>BSD Magazine</a>.</p></div></div></div><div class=sect1><h2 id=introduction>2. Introduction<a class=anchor href=#introduction></a></h2><div class=sectionbody><div class=paragraph><p>Experienced users or administrators are often responsible for several machines or environments.
They understand the difficult demands and challenges of maintaining such an infrastructure.
Running a FreeBSD Update Server makes it easier to deploy security and software patches to selected test machines before rolling them out to production.
It also means a number of systems can be updated from the local network rather than a potentially slower Internet connection.
This article outlines the steps involved in creating an internal FreeBSD Update Server.</p></div></div></div><div class=sect1><h2 id=prerequisites>3. Prerequisites<a class=anchor href=#prerequisites></a></h2><div class=sectionbody><div class=paragraph><p>To build an internal FreeBSD Update Server some requirements should be met.</p></div><div class=ulist><ul><li><p>A running FreeBSD system.</p><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>At a minimum, updates require building on a FreeBSD release greater than or equal to the target release version for distribution.</p></div></td></tr></tbody></table></div></li><li><p>A user account with at least 4 GB of available space. This will allow the creation of updates for 7.1 and 7.2, but the exact space requirements may change from version to version.</p></li><li><p>An <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;format=html">ssh(1)</a> account on a remote machine to upload distributed updates.</p></li><li><p>A web server, like <a href=https://docs.freebsd.org/en/books/handbook/#network-apache>Apache</a>, with over half of the space required for the build. For instance, test builds for 7.1 and 7.2 consume a total amount of 4 GB, and the webserver space needed to distribute these updates is 2.6 GB.</p></li><li><p>Basic knowledge of shell scripting with Bourne shell, <a href="https://man.freebsd.org/cgi/man.cgi?query=sh&amp;sektion=1&amp;format=html">sh(1)</a>.</p></li></ul></div></div></div><div class=sect1><h2 id=Configuration>4. Configuration: Installation & Setup<a class=anchor href=#Configuration></a></h2><div class=sectionbody><div class=paragraph><p>Download the <a href=https://github.com/freebsd/freebsd-update-build/>freebsd-update-server</a> software by installing <a class=package href=https://cgit.freebsd.org/ports/tree/devel/git/>devel/git</a> and <a class=package href=https://cgit.freebsd.org/ports/tree/security/ca_root_nss/>security/ca_root_nss</a>, and execute:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git clone https://github.com/freebsd/freebsd-update-build.git freebsd-update-server</code></pre></div></div><div class=paragraph><p>Update <span class=filename>scripts/build.conf</span> appropriately.
It is sourced during all build operations.</p></div><div class=paragraph><p>Here is the default <span class=filename>build.conf</span>, which should be modified to suit your environment.</p></div><div class="literalblock programlisting"><div class=content><pre># Main configuration file for FreeBSD Update builds.  The
# release-specific configuration data is lower down in
# the scripts tree.

# Location from which to fetch releases
export FTP=ftp://ftp2.freebsd.org/pub/FreeBSD/releases <i class=conum data-value=1></i><b>(1)</b>

# Host platform
export HOSTPLATFORM=`uname -m`

# Host name to use inside jails
export BUILDHOSTNAME=${HOSTPLATFORM}-builder.daemonology.net <i class=conum data-value=2></i><b>(2)</b>

# Location of SSH key
export SSHKEY=/root/.ssh/id_dsa <i class=conum data-value=3></i><b>(3)</b>

# SSH account into which files are uploaded
MASTERACCT=builder@wadham.daemonology.net <i class=conum data-value=4></i><b>(4)</b>

# Directory into which files are uploaded
MASTERDIR=update-master.freebsd.org <i class=conum data-value=5></i><b>(5)</b></pre></div></div><div class=paragraph><p>Parameters for consideration would be:</p></div><div class="colist arabic"><table><tbody><tr><td><i class=conum data-value=1></i><b>1</b></td><td>This is the location where ISO images are downloaded from (by the <code>fetchiso()</code> subroutine of <span class=filename>scripts/build.subr</span>). The location configured is not limited to FTP URIs. Any URI scheme supported by standard <a href="https://man.freebsd.org/cgi/man.cgi?query=fetch&amp;sektion=1&amp;format=html">fetch(1)</a> utility should work fine.
Customizations to the <code>fetchiso()</code> code can be installed by copying the default <span class=filename>build.subr</span> script to the release and architecture-specific area at <span class=filename>scripts/RELEASE/ARCHITECTURE/build.subr</span> and applying local changes.</td></tr><tr><td><i class=conum data-value=2></i><b>2</b></td><td>The name of the build host. This information will be displayed on updated systems when issuing:<div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% <span class=nb>uname</span> <span class=nt>-v</span></code></pre></div></div></td></tr><tr><td><i class=conum data-value=3></i><b>3</b></td><td>The SSH key for uploading files to the update server. A key pair can be created by typing <code>ssh-keygen -t dsa</code>. This parameter is optional; standard password authentication will be used as a fallback authentication method when <code>SSHKEY</code> is not defined.
The <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh-keygen&amp;sektion=1&amp;format=html">ssh-keygen(1)</a> manual page has more detailed information about SSH and the appropriate steps for creating and using one.</td></tr><tr><td><i class=conum data-value=4></i><b>4</b></td><td>Account for uploading files to the update server.</td></tr><tr><td><i class=conum data-value=5></i><b>5</b></td><td>Directory on the update server where files are uploaded to.</td></tr></tbody></table></div><div class=paragraph><p>The default <span class=filename>build.conf</span> shipped with the freebsd-update-server sources is suitable for building i386 releases of FreeBSD. As an example of building an update server for other architectures, the following steps outline the configuration changes needed for amd64:</p></div><div class="exampleblock procedure"><div class=content><div class="olist arabic"><ol class=arabic><li><p>Create a build environment for amd64:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% <span class=nb>mkdir</span> <span class=nt>-p</span> /usr/local/freebsd-update-server/scripts/7.2-RELEASE/amd64</code></pre></div></div></li><li><p>Install a <span class=filename>build.conf</span> in the newly created build directory. The build configuration options for FreeBSD 7.2-RELEASE on amd64 should be similar to:</p><div class="literalblock programlisting"><div class=content><pre># SHA256 hash of RELEASE disc1.iso image.
export RELH=1ea1f6f652d7c5f5eab7ef9f8edbed50cb664b08ed761850f95f48e86cc71ef5 <i class=conum data-value=1></i><b>(1)</b>
# Components of the world, source, and kernels
export WORLDPARTS=&#34;base catpages dict doc games info manpages proflibs lib32&#34;
export SOURCEPARTS=&#34;base bin contrib crypto etc games gnu include krb5  \
                lib libexec release rescue sbin secure share sys tools  \
                ubin usbin cddl&#34;
export KERNELPARTS=&#34;generic&#34;

# EOL date
export EOL=1275289200 <i class=conum data-value=2></i><b>(2)</b></pre></div></div><div class="colist arabic"><table><tbody><tr><td><i class=conum data-value=1></i><b>1</b></td><td>The <a href="https://man.freebsd.org/cgi/man.cgi?query=sha256&amp;sektion=1&amp;format=html">sha256(1)</a> hash key for the desired release, is published within the respective <a href=https://www.FreeBSD.org/releases/>release announcement</a>.</td></tr><tr><td><i class=conum data-value=2></i><b>2</b></td><td>To generate the "End of Life" number for <span class=filename>build.conf</span>, refer to the "Estimated EOL" posted on the <a href=https://www.FreeBSD.org/security/security/>FreeBSD Security Website</a>. The value of <code>EOL</code> can be derived from the date listed on the web site, using the <a href="https://man.freebsd.org/cgi/man.cgi?query=date&amp;sektion=1&amp;format=html">date(1)</a> utility, for example:<div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% <span class=nb>date</span> <span class=nt>-j</span> <span class=nt>-f</span> <span class=s1>&#39;%Y%m%d-%H%M%S&#39;</span> <span class=s1>&#39;20090401-000000&#39;</span> <span class=s1>&#39;+%s&#39;</span></code></pre></div></div></td></tr></tbody></table></div></li></ol></div></div></div></div></div><div class=sect1><h2 id=build>5. Building Update Code<a class=anchor href=#build></a></h2><div class=sectionbody><div class=paragraph><p>The first step is to run <span class=filename>scripts/make.sh</span>.
This will build some binaries, create directories, and generate an RSA signing key used for approving builds.
In this step, a passphrase will have to be supplied for the final creation of the signing key.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sh scripts/make.sh</span>
cc <span class=nt>-O2</span> <span class=nt>-fno-strict-aliasing</span> <span class=nt>-pipe</span>   findstamps.c  <span class=nt>-o</span> findstamps
findstamps.c: In <span class=k>function</span> <span class=s1>&#39;usage&#39;</span>:
findstamps.c:45: warning: incompatible implicit declaration of built-in <span class=k>function</span> <span class=s1>&#39;exit&#39;</span>
cc <span class=nt>-O2</span> <span class=nt>-fno-strict-aliasing</span> <span class=nt>-pipe</span>   unstamp.c  <span class=nt>-o</span> unstamp
<span class=nb>install </span>findstamps ../bin
<span class=nb>install </span>unstamp ../bin
<span class=nb>rm</span> <span class=nt>-f</span> findstamps unstamp
Generating RSA private key, 4096 bit long modulus
................................................................................++
...................++
e is 65537 <span class=o>(</span>0x10001<span class=o>)</span>

Public key fingerprint:
27ef53e48dc869eea6c3136091cc6ab8589f967559824779e855d58a2294de9e

Encrypting signing key <span class=k>for </span>root
enter aes-256-cbc encryption password:
Verifying - enter aes-256-cbc encryption password:</code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Keep a note of the generated key fingerprint.
This value is required in <span class=filename>/etc/freebsd-update.conf</span> for binary updates.</p></div></td></tr></tbody></table></div><div class=paragraph><p>At this point, we are ready to stage a build.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/local/freebsd-update-server</span>
<span class=c># sh scripts/init.sh amd64 7.2-RELEASE</span></code></pre></div></div><div class=paragraph><p>What follows is a sample of an <em>initial</em> build run.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sh scripts/init.sh amd64 7.2-RELEASE</span>
Mon Aug 24 16:04:36 PDT 2009 Starting fetch <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
/usr/local/freebsd-update-server/work/7.2-RELE100 of  588 MB  359 kBps 00m00s
Mon Aug 24 16:32:38 PDT 2009 Verifying disc1 <span class=nb>hash </span><span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 16:32:44 PDT 2009 Extracting components <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 16:34:05 PDT 2009 Constructing world+src image <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 16:35:57 PDT 2009 Extracting world+src <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 23:36:24 UTC 2009 Building world <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Tue Aug 25 00:31:29 UTC 2009 Distributing world <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Tue Aug 25 00:32:36 UTC 2009 Building and distributing kernels <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Tue Aug 25 00:44:44 UTC 2009 Constructing world components <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Tue Aug 25 00:44:56 UTC 2009 Distributing <span class=nb>source </span><span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 17:46:18 PDT 2009 Moving components into staging area <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 17:46:33 PDT 2009 Identifying extra documentation <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 17:47:13 PDT 2009 Extracting extra docs <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 17:47:18 PDT 2009 Indexing release <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 17:50:44 PDT 2009 Indexing world0 <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE

Files built but not released:
Files released but not built:
Files which differ by more than contents:
Files which differ between release and build:
kernel|generic|/GENERIC/hptrr.ko
kernel|generic|/GENERIC/kernel
src|sys|/sys/conf/newvers.sh
world|base|/boot/loader
world|base|/boot/pxeboot
world|base|/etc/mail/freebsd.cf
world|base|/etc/mail/freebsd.submit.cf
world|base|/etc/mail/sendmail.cf
world|base|/etc/mail/submit.cf
world|base|/lib/libcrypto.so.5
world|base|/usr/bin/ntpq
world|base|/usr/lib/libalias.a
world|base|/usr/lib/libalias_cuseeme.a
world|base|/usr/lib/libalias_dummy.a
world|base|/usr/lib/libalias_ftp.a
...</code></pre></div></div><div class=paragraph><p>Then the build of the world is performed again, with world patches.
A more detailed explanation may be found in <span class=filename>scripts/build.subr</span>.</p></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>During this second build cycle, the network time protocol daemon, <a href="https://man.freebsd.org/cgi/man.cgi?query=ntpd&amp;sektion=8&amp;format=html">ntpd(8)</a>, is turned off.
Per <code>Colin Percival &lt;<a href=mailto:cperciva@FreeBSD.org>cperciva@FreeBSD.org</a>></code>, Security Officer Emeritus of FreeBSD, "the <a href=https://github.com/freebsd/freebsd-update-build/>freebsd-update-server</a> build code needs to identify timestamps which are stored in files so that they can be ignored when comparing builds to determine which files need to be updated.
This timestamp-finding works by doing two builds 400 days apart and comparing the results."</p></div></td></tr></tbody></table></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>Mon Aug 24 17:54:07 PDT 2009 Extracting world+src <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Wed Sep 29 00:54:34 UTC 2010 Building world <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Wed Sep 29 01:49:42 UTC 2010 Distributing world <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Wed Sep 29 01:50:50 UTC 2010 Building and distributing kernels <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Wed Sep 29 02:02:56 UTC 2010 Constructing world components <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Wed Sep 29 02:03:08 UTC 2010 Distributing <span class=nb>source </span><span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Tue Sep 28 19:04:31 PDT 2010 Moving components into staging area <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 19:04:46 PDT 2009 Extracting extra docs <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 19:04:51 PDT 2009 Indexing world1 <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 19:08:04 PDT 2009 Locating build stamps <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 19:10:19 PDT 2009 Cleaning staging area <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 19:10:19 PDT 2009 Preparing to copy files into staging area <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 19:10:20 PDT 2009 Copying data files into staging area <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 12:16:57 PDT 2009 Copying metadata files into staging area <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 12:16:59 PDT 2009 Constructing metadata index and tag <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE

Files found which include build stamps:
kernel|generic|/GENERIC/hptrr.ko
kernel|generic|/GENERIC/kernel
world|base|/boot/loader
world|base|/boot/pxeboot
world|base|/etc/mail/freebsd.cf
world|base|/etc/mail/freebsd.submit.cf
world|base|/etc/mail/sendmail.cf
world|base|/etc/mail/submit.cf
world|base|/lib/libcrypto.so.5
world|base|/usr/bin/ntpq
world|base|/usr/include/osreldate.h
world|base|/usr/lib/libalias.a
world|base|/usr/lib/libalias_cuseeme.a
world|base|/usr/lib/libalias_dummy.a
world|base|/usr/lib/libalias_ftp.a
...</code></pre></div></div><div class=paragraph><p>Finally, the build completes.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>Values of build stamps, excluding library archive headers:
v1.2 <span class=o>(</span>Aug 25 2009 00:40:36<span class=o>)</span>
v1.2 <span class=o>(</span>Aug 25 2009 00:38:22<span class=o>)</span>
@<span class=o>()</span>FreeBSD 7.2-RELEASE 0: Tue Aug 25 00:38:29 UTC 2009
FreeBSD 7.2-RELEASE 0: Tue Aug 25 00:38:29 UTC 2009
    root@server.myhost.com:/usr/obj/usr/src/sys/GENERIC
7.2-RELEASE
Mon Aug 24 23:55:25 UTC 2009
Mon Aug 24 23:55:25 UTC 2009
 built by root@server.myhost.com on Tue Aug 25 00:16:15 UTC 2009
 built by root@server.myhost.com on Tue Aug 25 00:16:15 UTC 2009
 built by root@server.myhost.com on Tue Aug 25 00:16:15 UTC 2009
 built by root@server.myhost.com on Tue Aug 25 00:16:15 UTC 2009
Mon Aug 24 23:46:47 UTC 2009
ntpq 4.2.4p5-a Mon Aug 24 23:55:53 UTC 2009 <span class=o>(</span>1<span class=o>)</span>
 <span class=k>*</span> Copyright <span class=o>(</span>c<span class=o>)</span> 1992-2009 The FreeBSD Project.
Mon Aug 24 23:46:47 UTC 2009
Mon Aug 24 23:55:40 UTC 2009
Aug 25 2009
ntpd 4.2.4p5-a Mon Aug 24 23:55:52 UTC 2009 <span class=o>(</span>1<span class=o>)</span>
ntpdate 4.2.4p5-a Mon Aug 24 23:55:53 UTC 2009 <span class=o>(</span>1<span class=o>)</span>
ntpdc 4.2.4p5-a Mon Aug 24 23:55:53 UTC 2009 <span class=o>(</span>1<span class=o>)</span>
Tue Aug 25 00:21:21 UTC 2009
Tue Aug 25 00:21:21 UTC 2009
Tue Aug 25 00:21:21 UTC 2009
Mon Aug 24 23:46:47 UTC 2009

FreeBSD/amd64 7.2-RELEASE initialization build complete.  Please
review the list of build stamps printed above to confirm that
they look sensible, <span class=k>then </span>run
 sh <span class=nt>-e</span> approve.sh amd64 7.2-RELEASE
to sign the release.</code></pre></div></div><div class=paragraph><p>Approve the build if everything is correct.
More information on determining this can be found in the distributed source file named <span class=filename>USAGE</span>. Execute <span class=filename>scripts/approve.sh</span>, as directed.
This will sign the release, and move components into a staging area suitable for uploading.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/local/freebsd-update-server</span>
<span class=c># sh scripts/mountkey.sh</span></code></pre></div></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sh -e scripts/approve.sh amd64 7.2-RELEASE</span>
Wed Aug 26 12:50:06 PDT 2009 Signing build <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Wed Aug 26 12:50:06 PDT 2009 Copying files to patch <span class=nb>source </span>directories <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Wed Aug 26 12:50:06 PDT 2009 Copying files to upload staging area <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Wed Aug 26 12:50:07 PDT 2009 Updating databases <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Wed Aug 26 12:50:07 PDT 2009 Cleaning staging area <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE</code></pre></div></div><div class=paragraph><p>After the approval process is complete, the upload procedure may be started.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/local/freebsd-update-server</span>
<span class=c># sh scripts/upload.sh amd64 7.2-RELEASE</span></code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>In the event update code needs to be re-uploaded, this may be done by changing to the public distributions directory for the target release and updating attributes of the <em>uploaded</em> file.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/local/freebsd-update-server/pub/7.2-RELEASE/amd64</span>
<span class=c># touch -t 200801010101.01 uploaded</span></code></pre></div></div></td></tr></tbody></table></div><div class=paragraph><p>The uploaded files will need to be in the document root of the webserver in order for updates to be distributed.
The exact configuration will vary depending on the web server used.
For the Apache web server, please refer to the <a href=https://docs.freebsd.org/en/books/handbook/#network-apache>Configuration of Apache servers</a> section in the Handbook.</p></div><div class=paragraph><p>Update client’s <code>KeyPrint</code> and <code>ServerName</code> in <span class=filename>/etc/freebsd-update.conf</span>, and perform updates as instructed in the <a href=https://docs.freebsd.org/en/books/handbook/#updating-upgrading-freebsdupdate>FreeBSD Update</a> section of the Handbook.</p></div><div class="admonitionblock important"><table><tbody><tr><td class=icon><i class="fa icon-important" title=Important></i></td><td class=content><div class=paragraph><p>In order for FreeBSD Update Server to work properly, updates for both the <em>current</em> release and the release <em>one wants to upgrade to</em> need to be built.
This is necessary for determining the differences of files between releases.
For example, when upgrading a FreeBSD system from 7.1-RELEASE to 7.2-RELEASE, updates will need to be built and uploaded to your distribution server for both versions.</p></div></td></tr></tbody></table></div><div class=paragraph><p>For reference, the entire run of <a href=../../source/articles/freebsd-update-server/init.txt>init.sh</a> is attached.</p></div></div></div><div class=sect1><h2 id=patch>6. Building a Patch<a class=anchor href=#patch></a></h2><div class=sectionbody><div class=paragraph><p>Every time a <a href=https://www.FreeBSD.org/security/advisories/>security advisory</a> or <a href=https://www.FreeBSD.org/security/notices/>security notice</a> is announced, a patch update can be built.</p></div><div class=paragraph><p>For this example, 7.1-RELEASE will be used.</p></div><div class=paragraph><p>A couple of assumptions are made for a different release build:</p></div><div class=ulist><ul><li><p>Setup the correct directory structure for the initial build.</p></li><li><p>Perform an initial build for 7.1-RELEASE.</p></li></ul></div><div class=paragraph><p>Create the patch directory of the respective release under <span class=filename>/usr/local/freebsd-update-server/patches/</span>.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% <span class=nb>mkdir</span> <span class=nt>-p</span> /usr/local/freebsd-update-server/patches/7.1-RELEASE/
% <span class=nb>cd</span> /usr/local/freebsd-update-server/patches/7.1-RELEASE</code></pre></div></div><div class=paragraph><p>As an example, take the patch for <a href="https://man.freebsd.org/cgi/man.cgi?query=named&amp;sektion=8&amp;format=html">named(8)</a>.
Read the advisory, and grab the necessary file from <a href=https://www.FreeBSD.org/security/advisories/>FreeBSD Security Advisories</a>.
More information on interpreting the advisory, can be found in the <a href=https://docs.freebsd.org/en/books/handbook/#security-advisories>FreeBSD Handbook</a>.</p></div><div class=paragraph><p>In the <a href=https://security.freebsd.org/advisories/FreeBSD-SA-09:12.bind.asc>security brief</a>, this advisory is called <code>SA-09:12.bind</code>.
After downloading the file, it is required to rename the file to an appropriate patch level.
It is suggested to keep this consistent with official FreeBSD patch levels, but its name may be freely chosen.
For this build, let us follow the currently established practice of FreeBSD and call this <code>p7</code>. Rename the file:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% <span class=nb>cd</span> /usr/local/freebsd-update-server/patches/7.1-RELEASE/<span class=p>;</span> <span class=nb>mv </span>bind.patch 7-SA-09:12.bind</code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>When running a patch level build, it is assumed that previous patches are in place.
When a patch build is run, it will run all patches contained in the patch directory.</p></div><div class=paragraph><p>There can be custom patches added to any build. Use the number zero, or any other number.</p></div></td></tr></tbody></table></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>It is up to the administrator of the FreeBSD Update Server to take appropriate measures to verify the authenticity of every patch.</p></div></td></tr></tbody></table></div><div class=paragraph><p>At this point, a <em>diff</em> is ready to be built.
The software checks first to see if a <span class=filename>scripts/init.sh</span> has been run on the respective release prior to running the diff build.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/local/freebsd-update-server</span>
<span class=c># sh scripts/diff.sh amd64 7.1-RELEASE 7</span></code></pre></div></div><div class=paragraph><p>What follows is a sample of a <em>differential</em> build run.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sh -e scripts/diff.sh amd64 7.1-RELEASE 7</span>
Wed Aug 26 10:09:59 PDT 2009 Extracting world+src <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Wed Aug 26 17:10:25 UTC 2009 Building world <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Wed Aug 26 18:05:11 UTC 2009 Distributing world <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Wed Aug 26 18:06:16 UTC 2009 Building and distributing kernels <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Wed Aug 26 18:17:50 UTC 2009 Constructing world components <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Wed Aug 26 18:18:02 UTC 2009 Distributing <span class=nb>source </span><span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Wed Aug 26 11:19:23 PDT 2009 Moving components into staging area <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Wed Aug 26 11:19:37 PDT 2009 Extracting extra docs <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Wed Aug 26 11:19:42 PDT 2009 Indexing world0 <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Wed Aug 26 11:23:02 PDT 2009 Extracting world+src <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Thu Sep 30 18:23:29 UTC 2010 Building world <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Thu Sep 30 19:18:15 UTC 2010 Distributing world <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Thu Sep 30 19:19:18 UTC 2010 Building and distributing kernels <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Thu Sep 30 19:30:52 UTC 2010 Constructing world components <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Thu Sep 30 19:31:03 UTC 2010 Distributing <span class=nb>source </span><span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Thu Sep 30 12:32:25 PDT 2010 Moving components into staging area <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Wed Aug 26 12:32:39 PDT 2009 Extracting extra docs <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Wed Aug 26 12:32:43 PDT 2009 Indexing world1 <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Wed Aug 26 12:35:54 PDT 2009 Locating build stamps <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Wed Aug 26 12:36:58 PDT 2009 Reverting changes due to build stamps <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Wed Aug 26 12:37:14 PDT 2009 Cleaning staging area <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Wed Aug 26 12:37:14 PDT 2009 Preparing to copy files into staging area <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Wed Aug 26 12:37:15 PDT 2009 Copying data files into staging area <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Wed Aug 26 12:43:23 PDT 2009 Copying metadata files into staging area <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Wed Aug 26 12:43:25 PDT 2009 Constructing metadata index and tag <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
...
Files found which include build stamps:
kernel|generic|/GENERIC/hptrr.ko
kernel|generic|/GENERIC/kernel
world|base|/boot/loader
world|base|/boot/pxeboot
world|base|/etc/mail/freebsd.cf
world|base|/etc/mail/freebsd.submit.cf
world|base|/etc/mail/sendmail.cf
world|base|/etc/mail/submit.cf
world|base|/lib/libcrypto.so.5
world|base|/usr/bin/ntpq
world|base|/usr/include/osreldate.h
world|base|/usr/lib/libalias.a
world|base|/usr/lib/libalias_cuseeme.a
world|base|/usr/lib/libalias_dummy.a
world|base|/usr/lib/libalias_ftp.a
...
Values of build stamps, excluding library archive headers:
v1.2 <span class=o>(</span>Aug 26 2009 18:13:46<span class=o>)</span>
v1.2 <span class=o>(</span>Aug 26 2009 18:11:44<span class=o>)</span>
@<span class=o>()</span>FreeBSD 7.1-RELEASE-p7 0: Wed Aug 26 18:11:50 UTC 2009
FreeBSD 7.1-RELEASE-p7 0: Wed Aug 26 18:11:50 UTC 2009
    root@server.myhost.com:/usr/obj/usr/src/sys/GENERIC
7.1-RELEASE-p7
Wed Aug 26 17:29:15 UTC 2009
Wed Aug 26 17:29:15 UTC 2009
 built by root@server.myhost.com on Wed Aug 26 17:49:58 UTC 2009
 built by root@server.myhost.com on Wed Aug 26 17:49:58 UTC 2009
 built by root@server.myhost.com on Wed Aug 26 17:49:58 UTC 2009
 built by root@server.myhost.com on Wed Aug 26 17:49:58 UTC 2009
Wed Aug 26 17:20:39 UTC 2009
ntpq 4.2.4p5-a Wed Aug 26 17:29:42 UTC 2009 <span class=o>(</span>1<span class=o>)</span>
 <span class=k>*</span> Copyright <span class=o>(</span>c<span class=o>)</span> 1992-2009 The FreeBSD Project.
Wed Aug 26 17:20:39 UTC 2009
Wed Aug 26 17:29:30 UTC 2009
Aug 26 2009
ntpd 4.2.4p5-a Wed Aug 26 17:29:41 UTC 2009 <span class=o>(</span>1<span class=o>)</span>
ntpdate 4.2.4p5-a Wed Aug 26 17:29:42 UTC 2009 <span class=o>(</span>1<span class=o>)</span>
ntpdc 4.2.4p5-a Wed Aug 26 17:29:42 UTC 2009 <span class=o>(</span>1<span class=o>)</span>
Wed Aug 26 17:55:02 UTC 2009
Wed Aug 26 17:55:02 UTC 2009
Wed Aug 26 17:55:02 UTC 2009
Wed Aug 26 17:20:39 UTC 2009
...</code></pre></div></div><div class=paragraph><p>Updates are printed, and approval is requested.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>New updates:
kernel|generic|/GENERIC/kernel.symbols|f|0|0|0555|0|7c8dc176763f96ced0a57fc04e7c1b8d793f27e006dd13e0b499e1474ac47e10|
kernel|generic|/GENERIC/kernel|f|0|0|0555|0|33197e8cf15bbbac263d17f39c153c9d489348c2c534f7ca1120a1183dec67b1|
kernel|generic|/|d|0|0|0755|0||
src|base|/|d|0|0|0755|0||
src|bin|/|d|0|0|0755|0||
src|cddl|/|d|0|0|0755|0||
src|contrib|/contrib/bind9/bin/named/update.c|f|0|10000|0644|0|4d434abf0983df9bc47435670d307fa882ef4b348ed8ca90928d250f42ea0757|
src|contrib|/contrib/bind9/lib/dns/openssldsa_link.c|f|0|10000|0644|0|c6805c39f3da2a06dd3f163f26c314a4692d4cd9a2d929c0acc88d736324f550|
src|contrib|/contrib/bind9/lib/dns/opensslrsa_link.c|f|0|10000|0644|0|fa0f7417ee9da42cc8d0fd96ad24e7a34125e05b5ae075bd6e3238f1c022a712|
...
FreeBSD/amd64 7.1-RELEASE update build complete.  Please review
the list of build stamps printed above and the list of updated
files to confirm that they look sensible, <span class=k>then </span>run
 sh <span class=nt>-e</span> approve.sh amd64 7.1-RELEASE
to sign the build.</code></pre></div></div><div class=paragraph><p>Follow the same process as noted before for approving a build:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sh -e scripts/approve.sh amd64 7.1-RELEASE</span>
Wed Aug 26 12:50:06 PDT 2009 Signing build <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE
Wed Aug 26 12:50:06 PDT 2009 Copying files to patch <span class=nb>source </span>directories <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE
Wed Aug 26 12:50:06 PDT 2009 Copying files to upload staging area <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE
Wed Aug 26 12:50:07 PDT 2009 Updating databases <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE
Wed Aug 26 12:50:07 PDT 2009 Cleaning staging area <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE

The FreeBSD/amd64 7.1-RELEASE update build has been signed and is
ready to be uploaded.  Remember to run
 sh <span class=nt>-e</span> umountkey.sh
to unmount the decrypted key once you have finished signing all
the new builds.</code></pre></div></div><div class=paragraph><p>After approving the build, upload the software:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/local/freebsd-update-server</span>
<span class=c># sh scripts/upload.sh amd64 7.1-RELEASE</span></code></pre></div></div><div class=paragraph><p>For reference, the entire run of <a href=../../source/articles/freebsd-update-server/diff.txt>diff.sh</a> is attached.</p></div></div></div><div class=sect1><h2 id=tips>7. Tips<a class=anchor href=#tips></a></h2><div class=sectionbody><div class=ulist><ul><li><p>If a custom release is built using the native <code>make release</code> <a href=https://docs.freebsd.org/en/articles/releng/#release-build>procedure</a>, freebsd-update-server code will work from your release. As an example, a release without ports or documentation can be built by clearing functionality pertaining to documentation subroutines <code>findextradocs ()</code>, <code>addextradocs ()</code> and altering the download location in <code>fetchiso ()</code>, respectively, in <span class=filename>scripts/build.subr</span>. As a last step, change the <a href="https://man.freebsd.org/cgi/man.cgi?query=sha256&amp;sektion=1&amp;format=html">sha256(1)</a> hash in <span class=filename>build.conf</span> under your respective release and architecture and you are ready to build off your custom release.</p><div class="literalblock programlisting"><div class=content><pre># Compare ${WORKDIR}/release and ${WORKDIR}/$1, identify which parts
# of the world|doc subcomponent are missing from the latter, and
# build a tarball out of them.
findextradocs () {
}
# Add extra docs to ${WORKDIR}/$1
addextradocs () {
}</pre></div></div></li><li><p>Adding <code>-j <em>NUMBER</em></code> flags to <code>buildworld</code> and <code>obj</code> targets in the <span class=filename>scripts/build.subr</span> script may speed up processing depending on the hardware used, however it is not necessary. Using these flags in other targets is not recommended, as it may cause the build to become unreliable.</p><div class="literalblock programlisting"><div class=content><pre>              # Build the world
		   log &#34;Building world&#34;
		   cd /usr/src &amp;&amp;
		   make -j 2 ${COMPATFLAGS} buildworld 2&gt;&amp;1
		# Distribute the world
		   log &#34;Distributing world&#34;
		   cd /usr/src/release &amp;&amp;
		   make -j 2 obj &amp;&amp;
		   make ${COMPATFLAGS} release.1 release.2 2&gt;&amp;1</pre></div></div></li><li><p>Create an appropriate <a href=https://docs.freebsd.org/en/books/handbook/#network-dns>DNS</a> SRV record for the update server, and put others behind it with variable weights. Using this facility will provide update mirrors, however this tip is not necessary unless you wish to provide a redundant service.</p><div class="literalblock programlisting"><div class=content><pre>_http._tcp.update.myserver.com.		IN SRV   0 2 80   host1.myserver.com.
					IN SRV   0 1 80   host2.myserver.com.
					IN SRV   0 0 80   host3.myserver.com.</pre></div></div></li></ul></div></div></div><hr><div class=last-modified><p><strong>Last modified on</strong>: November 15, 2023 by <a href="https://cgit.freebsd.org/doc/commit/?id=13d075cc05" target=_blank>Benedict Reuschling</a></p></div></div><aside class=toc><div class=toc-content><h3>Table of Contents</h3><nav id=TableOfContents><ul><li><a href=#acknowledgments>1. Acknowledgments</a></li><li><a href=#introduction>2. Introduction</a></li><li><a href=#prerequisites>3. Prerequisites</a></li><li><a href=#Configuration>4. Configuration: Installation & Setup</a></li><li><a href=#build>5. Building Update Code</a></li><li><a href=#patch>6. Building a Patch</a></li><li><a href=#tips>7. Tips</a></li></ul></nav><hr><div class=resources><h3>Resources</h3><ul class=contents><li><i class="fa fa-file-pdf-o" aria-hidden=true title="Download PDF"></i><a href=https://download.freebsd.org/doc/en/articles/freebsd-update-server/freebsd-update-server_en.pdf>Download PDF</a></li><li><i class="fa fa-pencil-square-o" aria-hidden=true title="Edit this page"></i><a href=https://github.com/freebsd/freebsd-doc/blob/main/documentation/content/en/_index target=_blank>Edit this page</a></li></ul></div></div></aside></main><footer><div class=footer-container><section class=logo-column><img src=https://docs.freebsd.org/images/FreeBSD-colors.svg width=160 height=50 alt="FreeBSD logo"><div class=options-container><div class=language-container><a id=languages href=https://docs.freebsd.org/en/languages><img src=https://docs.freebsd.org/images/language.png class=language-image alt="Choose language">
<span>English</span></a></div><div class=theme-container><select id=theme-chooser><option value=theme-system>System</option><option value=theme-light>Light</option><option value=theme-dark>Dark</option><option value=theme-high-contrast>High contrast</option></select></div></div></section><section class=about-column><h3 class=column-title>About</h3><ul class=column-elements-container><li><a href=https://www.freebsd.org/about/ target=_blank class=column-element>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/ target=_blank class=column-element>FreeBSD Foundation</a></li><li><a href=https://www.freebsd.org/where/ target=_blank class=column-element>Get FreeBSD</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct target=_blank class=column-element>Code of Conduct</a></li><li><a href=https://www.freebsd.org/security/ target=_blank class=column-element>Security Advisories</a></li></ul></section><section class=documentation-column><h3 class=column-title>Documentation</h3><ul class=column-elements-container><li><a href=/en class=column-element>Documentation portal</a></li><li><a href=https://man.FreeBSD.org target=_blank class=column-element>Manual pages</a></li><li><a href=https://papers.FreeBSD.org target=_blank class=column-element>Presentations and papers</a></li><li><a href=https://docs-archive.freebsd.org/doc/ target=_blank class=column-element>Previous versions</a></li><li><a href=https://docs-archive.freebsd.org/44doc/ target=_blank class=column-element>4.4BSD Documents</a></li><li><a href=https://wiki.freebsd.org/ target=_blank class=column-element>Wiki</a></li></ul></section><section class=community-column><h3 class=column-title>Community</h3><ul class=column-elements-container><li><a href=https://docs.freebsd.org/en/articles/contributing class=column-element>Get involved</a></li><li><a href=https://forums.freebsd.org/ target=_blank class=column-element>Community forum</a></li><li><a href=https://lists.freebsd.org/ target=_blank class=column-element>Mailing lists</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank class=column-element>IRC Channels</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank class=column-element>Bug Tracker</a></li></ul></section><section class=legal-column><h3 class=column-title>Legal</h3><ul class=column-elements-container><li><a href=https://freebsdfoundation.org/donate/ target=_blank class=column-element>Donations</a></li><li><a href=https://www.freebsd.org/copyright/freebsd-license/ target=_blank class=column-element>Licensing</a></li><li><a href=https://www.freebsd.org/privacy/ target=_blank class=column-element>Privacy Policy</a></li><li><a href=https://www.freebsd.org/copyright/ target=_blank class=column-element>Legal notices</a></li></ul></section><section class=copyright-column><p>&copy; 1994-2024 The FreeBSD Project. All rights reserved</p><span>Made with <span class=heart>♥</span> by the FreeBSD Community</span></section></div></footer></body></html>