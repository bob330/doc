<!doctype html><html class=theme-light lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Use Language Servers for development in the FreeBSD src tree to get precise go-to-definition and completion results."><meta name=keywords content="FreeBSD,Language Server,LSP"><meta name=copyright content="1995-2024 The FreeBSD Foundation"><link rel=canonical href=https://docs.freebsd.org/en/articles/freebsd-src-lsp/><title>Use Language Servers for Development in the FreeBSD Src Tree | FreeBSD Documentation Portal</title>
<meta name=theme-color content="#790000"><meta name=color-scheme content="system light dark high-contrast"><link rel="shortcut icon" href=https://docs.freebsd.org/favicon.ico><link rel=stylesheet href=https://docs.freebsd.org/styles/main.min.css><link rel=stylesheet href=https://docs.freebsd.org/css/font-awesome-min.css><script defer src=/js/theme-chooser.min.js></script><script defer src=/js/copy-clipboard.min.js></script><script defer src=/js/search.min.js></script><meta name=twitter:card content="summary"><meta name=twitter:domain content="docs.FreeBSD.org"><meta name=twitter:site content="@freebsd"><meta name=twitter:url content="https://twitter.com/freebsd"><meta property="og:title" content="Use Language Servers for Development in the FreeBSD Src Tree"><meta property="og:description" content="Use Language Servers for development in the FreeBSD src tree to get precise go-to-definition and completion results."><meta property="og:type" content="website"><meta property="og:image" content="https://docs.freebsd.org/favicon.ico"><meta property="og:image:alt" content="FreeBSD Logo"><meta property="og:locale" content="en"><meta property="og:url" content="https://docs.freebsd.org/en/articles/freebsd-src-lsp/"><meta property="og:site_name" content="FreeBSD Documentation Portal"><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","url":"https:\/\/docs.freebsd.org\/en\/articles\/freebsd-src-lsp\/","name":"FreeBSD Documentation Portal","headline":"FreeBSD Documentation Portal","description":"FreeBSD Documentation Portal"}</script></head><body><header><div class=header-container><div class=logo-menu-bars-container><a href=https://www.FreeBSD.org class=logo><img src=https://docs.freebsd.org/images/FreeBSD-monochromatic.svg width=160 height=50 alt="FreeBSD logo">
</a><label class=menu-bars for=menu-bars><i class="fa fa-bars" aria-hidden=true></i></label></div><input id=menu-bars type=checkbox><nav><ul class=menu><li class=menu-item><input id=about type=checkbox>
<a href=# aria-label="Navigate to About section"><label class=menu-item-description for=about>About
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/about/ target=_blank>About</a></li><li><a href=https://www.freebsd.org/about/ target=_blank>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/about-us/about-the-foundation/ target=_blank>FreeBSD Foundation</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct/ target=_blank>Code of Conduct</a></li></ul></li><li class=menu-item><input id=download type=checkbox>
<a href=# aria-label="Navigate to get FreeBSD section"><label class=menu-item-description for=download>Get FreeBSD
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/where/ target=_blank>Get FreeBSD</a></li><li><a href=https://www.freebsd.org/releases/ target=_blank>Release Information</a></li><li><a href=https://www.freebsd.org/releng/ target=_blank>Release Engineering</a></li><li><a href=https://www.freebsd.org/security/ target=_blank>Security Advisories</a></li></ul></li><li class=menu-item><input id=documentation type=checkbox>
<a href=# aria-label="Navigate to get Documentation section"><label class=menu-item-description for=documentation>Documentation
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=/en>Documentation portal</a></li><li><a href=https://docs.freebsd.org/en/books/handbook>FreeBSD Handbook</a></li><li><a href=https://docs.freebsd.org/en/books/porters-handbook>Porter's Handbook</a></li><li><a href=https://docs.FreeBSD.org/en/books/fdp-primer>Documentation Project Handbook</a></li><li><a href=https://man.FreeBSD.org target=_blank>Manual pages</a></li><li><a href=https://papers.FreeBSD.org target=_blank>Presentations and papers</a></li><li><a href=https://wiki.FreeBSD.org target=_blank>Wiki</a></li><li><a href=https://docs.freebsd.org/en/books>Books</a></li><li><a href=https://docs.freebsd.org/en/articles>Articles</a></li></ul></li><li class=menu-item><input id=community type=checkbox>
<a href=# aria-label="Navigate to get Community section"><label class=menu-item-description for=community>Community
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/community/>Community</a></li><li><a href=https://docs.freebsd.org/en/articles/contributing>Get involved</a></li><li><a href=https://forums.freebsd.org/ target=_blank>Forum</a></li><li><a href=https://lists.freebsd.org/ target=_blank>Mailing lists</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank>IRC Channels</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank>Bug Tracker</a></li><li><a href=https://www.freebsd.org/support/ target=_blank>Support</a></li></ul></li></ul></nav><div class=search-donate-container><form class=search method=get id=search-header-form action=https://docs.freebsd.org/search name=search-header-form><input type=hidden name=DB value=en>
<input id=words name=P type=text size=20 maxlength=255>
<button>
<i class="fa fa-search" aria-hidden=true></i></button></form><div class=donate><a href=https://freebsdfoundation.org/donate/ target=_blank><span class=heart>♥</span>
Donate</a></div></div></div></header><main class=main-wrapper-article><div class=article><h1 class=title>Use Language Servers for Development in the FreeBSD Src Tree</h1><div class=copyright>Copyright © 2021 The FreeBSD Foundation</div><div class=legalnotice><a id=trademarks></a><details><summary>trademarks</summary><p>FreeBSD is a registered trademark of the FreeBSD Foundation.</p></details></div><div class=toc-mobile><h3>Table of Contents</h3><nav id=TableOfContents><ul><li><a href=#intro>1. Introduction</a></li><li><a href=#requirements>2. Requirements</a></li><li><a href=#editor-settings>3. Editor settings</a></li><li><a href=#cdb>4. Compilation database</a></li><li><a href=#final>5. Final</a></li></ul></nav></div><div id=preamble><div class=sectionbody></div></div><div class=sect1><h2 id=intro>1. Introduction<a class=anchor href=#intro></a></h2><div class=sectionbody><div class=paragraph><p>This guide is about setting up a FreeBSD src tree with language servers performing source code indexing. The guide describes the steps for Vim/NeoVim and VSCode. If you use a different text editor you can use this guide as a reference and search the equivalent commands for your preferred editor.</p></div></div></div><div class=sect1><h2 id=requirements>2. Requirements<a class=anchor href=#requirements></a></h2><div class=sectionbody><div class=paragraph><p>In order to follow this guide we need to install certain requirements. We need a Language server, <code>ccls</code> or <code>clangd</code>, and optionally a compilation database.</p></div><div class=paragraph><p>The installation of the Language server can be performed via <code>pkg</code> or via ports. If we chose <code>clangd</code> we need to install <code>llvm</code>.</p></div><div class=paragraph><p>Using <code>pkg</code> to install <code>ccls</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pkg install ccls</span></code></pre></div></div><div class=paragraph><p>If we want to use <code>clangd</code> we need to install <code>llvm</code> (The example command uses <code>llvm15</code> but choose the version you desire):</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pkg install llvm15</span></code></pre></div></div><div class=paragraph><p>To install via ports choose a favorite combination of tools from each category below:</p></div><div class=ulist><ul><li><p>Language server implementations</p><div class=ulist><ul><li><p><a class=package href=https://cgit.freebsd.org/ports/tree/devel/ccls/>devel/ccls</a></p></li><li><p><a class=package href=https://cgit.freebsd.org/ports/tree/devel/llvm12/>devel/llvm12</a> (Other versions are okay, but newer is better. Replace <code>clangd12</code> with clangdN in case other versions are used.)</p></li></ul></div></li><li><p>Editors</p><div class=ulist><ul><li><p><a class=package href=https://cgit.freebsd.org/ports/tree/editors/vim/>editors/vim</a></p></li><li><p><a class=package href=https://cgit.freebsd.org/ports/tree/editors/neovim/>editors/neovim</a></p></li><li><p><a class=package href=https://cgit.freebsd.org/ports/tree/editors/vscode/>editors/vscode</a></p></li></ul></div></li><li><p>Compilation database generator</p><div class=ulist><ul><li><p><a class=package href=https://cgit.freebsd.org/ports/tree/devel/python/>devel/python</a> (For llvm’s scan-build-py implementation)</p></li><li><p><a class=package href=https://cgit.freebsd.org/ports/tree/devel/py-pip/>devel/py-pip</a> (For rizsotto’s scan-build implementation)</p></li><li><p><a class=package href=https://cgit.freebsd.org/ports/tree/devel/bear/>devel/bear</a></p></li></ul></div></li></ul></div></div></div><div class=sect1><h2 id=editor-settings>3. Editor settings<a class=anchor href=#editor-settings></a></h2><div class=sectionbody><div class=sect2><h3 id=settings-vim>3.1. Vim/Neovim<a class=anchor href=#settings-vim></a></h3><div class=sect3><h4 id=_lsp_client_plugins>3.1.1. LSP client plugins<a class=anchor href=#_lsp_client_plugins></a></h4><div class=paragraph><p>The built-in plugin manager is used for both editors in this example.
The LSP client plugin used is <a href=https://github.com/prabirshrestha/vim-lsp>prabirshrestha/vim-lsp</a>.</p></div><div class=paragraph><p>To set up the LSP client plugin for Neovim:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mkdir -p ~/.config/nvim/pack/lsp/start</span>
<span class=c># git clone https://github.com/prabirshrestha/vim-lsp ~/.config/nvim/pack/lsp/start/vim-lsp</span></code></pre></div></div><div class=paragraph><p>and for Vim:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mkdir -p ~/.vim/pack/lsp/start</span>
<span class=c># git clone https://github.com/prabirshrestha/vim-lsp ~/.vim/pack/lsp/start/vim-lsp</span></code></pre></div></div><div class=paragraph><p>To enable the LSP client plugin in the editor, add the following snippet into <span class=filepath>~/.config/nvim/init.vim</span> when using Neovim, or <span class=filepath>~/.vim/vimrc</span> when using Vim:</p></div><div class=listingblock><div class=title>For ccls</div><div class=content><pre class="rouge highlight"><code data-lang=vim><span class=k>au</span> <span class=nb>User</span> lsp_setup <span class=k>call</span> <span class=nb>lsp</span>#register_server<span class=p>({</span>
<span class=se>    \</span> <span class=s1>&#39;name&#39;</span><span class=p>:</span> <span class=s1>&#39;ccls&#39;</span><span class=p>,</span>
<span class=se>    \</span> <span class=s1>&#39;cmd&#39;</span><span class=p>:</span> <span class=p>{</span>server_info<span class=p>-&gt;[</span><span class=s1>&#39;ccls&#39;</span><span class=p>]},</span>
<span class=se>    \</span> <span class=s1>&#39;allowlist&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;c&#39;</span><span class=p>,</span> <span class=s1>&#39;cpp&#39;</span><span class=p>,</span> <span class=s1>&#39;objc&#39;</span><span class=p>],</span>
<span class=se>    \</span> <span class=s1>&#39;initialization_options&#39;</span><span class=p>:</span> <span class=p>{</span>
<span class=se>    \</span>     <span class=s1>&#39;cache&#39;</span><span class=p>:</span> <span class=p>{</span>
<span class=se>    \</span>         <span class=s1>&#39;hierarchicalPath&#39;</span><span class=p>:</span> <span class=k>v</span><span class=p>:</span>true
<span class=se>    \</span>     <span class=p>}</span>
<span class=se>    \</span> <span class=p>}})</span></code></pre></div></div><div class=listingblock><div class=title>For clangd</div><div class=content><pre class="rouge highlight"><code data-lang=vim><span class=k>au</span> <span class=nb>User</span> lsp_setup <span class=k>call</span> <span class=nb>lsp</span>#register_server<span class=p>({</span>
<span class=se>    \</span> <span class=s1>&#39;name&#39;</span><span class=p>:</span> <span class=s1>&#39;clangd&#39;</span><span class=p>,</span>
<span class=se>    \</span> <span class=s1>&#39;cmd&#39;</span><span class=p>:</span> <span class=p>{</span>server_info<span class=p>-&gt;[</span><span class=s1>&#39;clangd15&#39;</span><span class=p>,</span> <span class=s1>&#39;--background-index&#39;</span><span class=p>,</span> <span class=s1>&#39;--header-insertion=never&#39;</span><span class=p>]},</span>
<span class=se>    \</span> <span class=s1>&#39;allowlist&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;c&#39;</span><span class=p>,</span> <span class=s1>&#39;cpp&#39;</span><span class=p>,</span> <span class=s1>&#39;objc&#39;</span><span class=p>],</span>
<span class=se>    \</span> <span class=s1>&#39;initialization_options&#39;</span><span class=p>:</span> <span class=p>{},</span>
<span class=se>    \</span> <span class=p>})</span></code></pre></div></div><div class=paragraph><p>Depending on the version that you installed for <code>clangd</code> you might need to update the <code>server-info</code> to point to the correct binary.</p></div><div class=paragraph><p>Please refer to <a href=https://github.com/prabirshrestha/vim-lsp/blob/master/README.md#registering-servers class=bare>https://github.com/prabirshrestha/vim-lsp/blob/master/README.md#registering-servers</a> to learn about setting up key bindings and code completion.
The official site of clangd is <a href=https://clangd.llvm.org class=bare>https://clangd.llvm.org</a>, and the repository link of ccls is <a href=https://github.com/MaskRay/ccls/ class=bare>https://github.com/MaskRay/ccls/</a>.</p></div><div class=paragraph><p>Below are the reference settings of keybindings and code completions.
Put the following snippet into <span class=filepath>~/.config/nvim/init.vim</span>, or <span class=filepath>~/.vim/vimrc</span> for Vim users to use it:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=vim><span class=k>function</span><span class=p>!</span> <span class=nv>s:on_lsp_buffer_enabled</span><span class=p>()</span> abort
    <span class=k>setlocal</span> <span class=nb>omnifunc</span><span class=p>=</span><span class=nb>lsp</span>#<span class=nb>complete</span>
    <span class=k>setlocal</span> <span class=nb>completeopt</span><span class=p>-=</span>preview
    <span class=k>setlocal</span> <span class=nb>keywordprg</span><span class=p>=:</span>LspHover

    nmap <span class=p>&lt;</span><span class=k>buffer</span><span class=p>&gt;</span> <span class=p>&lt;</span>C<span class=p>-]&gt;</span> <span class=p>&lt;</span>plug<span class=p>&gt;(</span><span class=nb>lsp</span><span class=p>-</span>definition<span class=p>)</span>
    nmap <span class=p>&lt;</span><span class=k>buffer</span><span class=p>&gt;</span> <span class=p>&lt;</span>C<span class=p>-</span>W<span class=p>&gt;]</span> <span class=p>&lt;</span>plug<span class=p>&gt;(</span><span class=nb>lsp</span><span class=p>-</span>peek<span class=p>-</span>definition<span class=p>)</span>
    nmap <span class=p>&lt;</span><span class=k>buffer</span><span class=p>&gt;</span> <span class=p>&lt;</span>C<span class=p>-</span>W<span class=p>&gt;&lt;</span>C<span class=p>-]&gt;</span> <span class=p>&lt;</span>plug<span class=p>&gt;(</span><span class=nb>lsp</span><span class=p>-</span>peek<span class=p>-</span>definition<span class=p>)</span>
    nmap <span class=p>&lt;</span><span class=k>buffer</span><span class=p>&gt;</span> <span class=k>gr</span> <span class=p>&lt;</span>plug<span class=p>&gt;(</span><span class=nb>lsp</span><span class=p>-</span>references<span class=p>)</span>
    nmap <span class=p>&lt;</span><span class=k>buffer</span><span class=p>&gt;</span> <span class=p>&lt;</span>C<span class=p>-</span><span class=k>n</span><span class=p>&gt;</span> <span class=p>&lt;</span>plug<span class=p>&gt;(</span><span class=nb>lsp</span><span class=p>-</span><span class=k>next</span><span class=p>-</span>reference<span class=p>)</span>
    nmap <span class=p>&lt;</span><span class=k>buffer</span><span class=p>&gt;</span> <span class=p>&lt;</span>C<span class=p>-</span><span class=k>p</span><span class=p>&gt;</span> <span class=p>&lt;</span>plug<span class=p>&gt;(</span><span class=nb>lsp</span><span class=p>-</span><span class=k>previous</span><span class=p>-</span>reference<span class=p>)</span>
    nmap <span class=p>&lt;</span><span class=k>buffer</span><span class=p>&gt;</span> gI <span class=p>&lt;</span>plug<span class=p>&gt;(</span><span class=nb>lsp</span><span class=p>-</span>implementation<span class=p>)</span>
    nmap <span class=p>&lt;</span><span class=k>buffer</span><span class=p>&gt;</span> <span class=k>go</span> <span class=p>&lt;</span>plug<span class=p>&gt;(</span><span class=nb>lsp</span><span class=p>-</span>document<span class=p>-</span>symbol<span class=p>)</span>
    nmap <span class=p>&lt;</span><span class=k>buffer</span><span class=p>&gt;</span> gS <span class=p>&lt;</span>plug<span class=p>&gt;(</span><span class=nb>lsp</span><span class=p>-</span>workspace<span class=p>-</span>symbol<span class=p>)</span>
    nmap <span class=p>&lt;</span><span class=k>buffer</span><span class=p>&gt;</span> ga <span class=p>&lt;</span>plug<span class=p>&gt;(</span><span class=nb>lsp</span><span class=p>-</span>code<span class=p>-</span>action<span class=p>)</span>
    nmap <span class=p>&lt;</span><span class=k>buffer</span><span class=p>&gt;</span> gR <span class=p>&lt;</span>plug<span class=p>&gt;(</span><span class=nb>lsp</span><span class=p>-</span><span class=nb>rename</span><span class=p>)</span>
    nmap <span class=p>&lt;</span><span class=k>buffer</span><span class=p>&gt;</span> gm <span class=p>&lt;</span>plug<span class=p>&gt;(</span><span class=nb>lsp</span><span class=p>-</span>signature<span class=p>-</span><span class=k>help</span><span class=p>)</span>
<span class=k>endfunction</span>

augroup lsp_install
    <span class=k>au</span><span class=p>!</span>
    autocmd <span class=nb>User</span> lsp_buffer_enabled <span class=k>call</span> <span class=nv>s:on_lsp_buffer_enabled</span><span class=p>()</span>
augroup END</code></pre></div></div></div></div><div class=sect2><h3 id=settings-vscode>3.2. VSCode<a class=anchor href=#settings-vscode></a></h3><div class=sect3><h4 id=_lsp_client_plugins_2>3.2.1. LSP client plugins<a class=anchor href=#_lsp_client_plugins_2></a></h4><div class=paragraph><p>LSP client plugins are required to launch the language server daemon.
Press <code>Ctrl+Shift+X</code> to show the extension online search panel.
Enter <code>llvm-vs-code-extensions.vscode-clangd</code> when running clangd, or <code>ccls-project.ccls</code> when running ccls.</p></div><div class=paragraph><p>Then, press <code>Ctrl+Shift+P</code> to show the editor commands palette.
Enter <code>Preferences: Open Settings (JSON)</code> into the palette and hit <code>Enter</code> to open <span class=filepath>settings.json</span>.
Depending on the language server implementations, put one of the following JSON key/value pairs in <span class=filepath>settings.json</span>:</p></div><div class=listingblock><div class=title>For clangd</div><div class=content><pre class="rouge highlight"><code data-lang=json><span class=p>[</span><span class=w>
    </span><span class=err>/*</span><span class=w> </span><span class=err>Begin</span><span class=w> </span><span class=err>of</span><span class=w> </span><span class=err>your</span><span class=w> </span><span class=err>existing</span><span class=w> </span><span class=err>configurations</span><span class=w> </span><span class=err>*/</span><span class=w>
    </span><span class=err>...</span><span class=w>
    </span><span class=err>/*</span><span class=w> </span><span class=err>End</span><span class=w> </span><span class=err>of</span><span class=w> </span><span class=err>your</span><span class=w> </span><span class=err>existing</span><span class=w> </span><span class=err>configurations</span><span class=w> </span><span class=err>*/</span><span class=w>
    </span><span class=s2>&#34;clangd.arguments&#34;</span><span class=err>:</span><span class=w> </span><span class=p>[</span><span class=w>
        </span><span class=s2>&#34;--background-index&#34;</span><span class=p>,</span><span class=w>
        </span><span class=s2>&#34;--header-insertion=never&#34;</span><span class=w>
    </span><span class=p>],</span><span class=w>
    </span><span class=s2>&#34;clangd.path&#34;</span><span class=err>:</span><span class=w> </span><span class=s2>&#34;clangd12&#34;</span><span class=w>
</span><span class=p>]</span></code></pre></div></div><div class=listingblock><div class=title>For ccls</div><div class=content><pre class="rouge highlight"><code data-lang=json><span class=p>[</span><span class=w>
    </span><span class=err>/*</span><span class=w> </span><span class=err>Begin</span><span class=w> </span><span class=err>of</span><span class=w> </span><span class=err>your</span><span class=w> </span><span class=err>existing</span><span class=w> </span><span class=err>configurations</span><span class=w> </span><span class=err>*/</span><span class=w>
    </span><span class=err>...</span><span class=w>
    </span><span class=err>/*</span><span class=w> </span><span class=err>End</span><span class=w> </span><span class=err>of</span><span class=w> </span><span class=err>your</span><span class=w> </span><span class=err>existing</span><span class=w> </span><span class=err>configurations</span><span class=w> </span><span class=err>*/</span><span class=w>
    </span><span class=s2>&#34;ccls.cache.hierarchicalPath&#34;</span><span class=err>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span><span class=p>]</span></code></pre></div></div></div></div></div></div><div class=sect1><h2 id=cdb>4. Compilation database<a class=anchor href=#cdb></a></h2><div class=sectionbody><div class=paragraph><p>A Compilation database contains an array of compile command objects.
Each object specifies a way of compiling a source file.
The compilation database file is usually <span class=filename>compile_commands.json</span>.
The database is used by language server implementations for indexing purpose.</p></div><div class=paragraph><p>Please refer to <a href=https://clang.llvm.org/docs/JSONCompilationDatabase.html#format class=bare>https://clang.llvm.org/docs/JSONCompilationDatabase.html#format</a> for details on the format of the compilation database file.</p></div><div class=sect2><h3 id=cdb-generators>4.1. Generators<a class=anchor href=#cdb-generators></a></h3><div class=sect3><h4 id=generators-scan-build-py>4.1.1. Using scan-build-py<a class=anchor href=#generators-scan-build-py></a></h4><div class=sect4><h5 id=_installation>4.1.1.1. Installation<a class=anchor href=#_installation></a></h5><div class=paragraph><p><code>intercept-build</code> tool from scan-build-py is used to generate compilation
database.</p></div><div class=paragraph><p>Install <a class=package href=https://cgit.freebsd.org/ports/tree/devel/python/>devel/python</a> to get python interpreter first. To get
<code>intercept-build</code> from LLVM:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># git clone https://github.com/llvm/llvm-project /path/to/llvm-project</span></code></pre></div></div><div class=paragraph><p>where <span class=filename>/path/to/llvm-project/</span> is your desired path for the repository. Make an alias in the shell configuration file for convenience:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=nb>alias </span>intercept-build<span class=o>=</span><span class=s1>&#39;/path/to/llvm-project/clang/tools/scan-build-py/bin/intercept-build&#39;</span></code></pre></div></div><div class=paragraph><p><a href=https://github.com/rizsotto/scan-build>rizsotto/scan-build</a> can be used instead of LLVM’s scan-build-py.
The LLVM’s scan-build-py was rizsotto/scan-build merged into the LLVM tree.
This implementation can be installed by <code>pip install --user scan-build</code>.
The <code>intercept-build</code> script is in <span class=filename>~/.local/bin</span> by default.</p></div></div><div class=sect4><h5 id=_usage>4.1.1.2. Usage<a class=anchor href=#_usage></a></h5><div class=paragraph><p>In the top-level directory of the FreeBSD src tree, generate the compilation database with <code>intercept-build</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># intercept-build --append make buildworld buildkernel -j`sysctl -n hw.ncpu`</span></code></pre></div></div><div class=paragraph><p>The <code>--append</code> flag tells the <code>intercept-build</code> to read an existing compilation database (if a compilation database exists) and append the results to the database.
Entries with duplicated command keys are merged.
The generated compilation database by default is saved in the current working directory as <span class=filename>compile_commands.json</span>.</p></div></div></div><div class=sect3><h4 id=generators-bear>4.1.2. Using devel/bear<a class=anchor href=#generators-bear></a></h4><div class=sect4><h5 id=_usage_2>4.1.2.1. Usage<a class=anchor href=#_usage_2></a></h5><div class=paragraph><p>In the top-level directory of the FreeBSD src tree, to generate compilation database with <code>bear</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># bear --append -- make buildworld buildkernel -j`sysctl -n hw.ncpu`</span></code></pre></div></div><div class=paragraph><p>The <code>--append</code> flag tells <code>bear</code> to read an existing compilation database if it is present, and append the results to the database.
Entries with duplicated command keys are merged.
The generated compilation database by default is saved in the current working directory as <span class=filename>compile_commands.json</span>.</p></div></div></div></div></div></div><div class=sect1><h2 id=final>5. Final<a class=anchor href=#final></a></h2><div class=sectionbody><div class=paragraph><p>Once the compilation database is generated, open any source files in the FreeBSD src tree and LSP server daemon will be launched as well in background.
Opening source files in the src tree for the first time takes significantly longer time before the LSP server is able to give a complete result, due to initial background indexing by the LSP server compiling all the listed entries in the compilation database.
The language server daemon however does not index the source files not appearing in the compilation database, thus no complete results are shown on source files not being compiled during the <code>make</code>.</p></div></div></div><hr><div class=last-modified><p><strong>Last modified on</strong>: December 21, 2023 by <a href="https://cgit.freebsd.org/doc/commit/?id=139e052d84" target=_blank>rilysh</a></p></div></div><aside class=toc><div class=toc-content><h3>Table of Contents</h3><nav id=TableOfContents><ul><li><a href=#intro>1. Introduction</a></li><li><a href=#requirements>2. Requirements</a></li><li><a href=#editor-settings>3. Editor settings</a></li><li><a href=#cdb>4. Compilation database</a></li><li><a href=#final>5. Final</a></li></ul></nav><hr><div class=resources><h3>Resources</h3><ul class=contents><li><i class="fa fa-file-pdf-o" aria-hidden=true title="Download PDF"></i><a href=https://download.freebsd.org/doc/en/articles/freebsd-src-lsp/freebsd-src-lsp_en.pdf>Download PDF</a></li><li><i class="fa fa-pencil-square-o" aria-hidden=true title="Edit this page"></i><a href=https://github.com/freebsd/freebsd-doc/blob/main/documentation/content/en/_index target=_blank>Edit this page</a></li></ul></div></div></aside></main><footer><div class=footer-container><section class=logo-column><img src=https://docs.freebsd.org/images/FreeBSD-colors.svg width=160 height=50 alt="FreeBSD logo"><div class=options-container><div class=language-container><a id=languages href=https://docs.freebsd.org/en/languages><img src=https://docs.freebsd.org/images/language.png class=language-image alt="Choose language">
<span>English</span></a></div><div class=theme-container><select id=theme-chooser><option value=theme-system>System</option><option value=theme-light>Light</option><option value=theme-dark>Dark</option><option value=theme-high-contrast>High contrast</option></select></div></div></section><section class=about-column><h3 class=column-title>About</h3><ul class=column-elements-container><li><a href=https://www.freebsd.org/about/ target=_blank class=column-element>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/ target=_blank class=column-element>FreeBSD Foundation</a></li><li><a href=https://www.freebsd.org/where/ target=_blank class=column-element>Get FreeBSD</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct target=_blank class=column-element>Code of Conduct</a></li><li><a href=https://www.freebsd.org/security/ target=_blank class=column-element>Security Advisories</a></li></ul></section><section class=documentation-column><h3 class=column-title>Documentation</h3><ul class=column-elements-container><li><a href=/en class=column-element>Documentation portal</a></li><li><a href=https://man.FreeBSD.org target=_blank class=column-element>Manual pages</a></li><li><a href=https://papers.FreeBSD.org target=_blank class=column-element>Presentations and papers</a></li><li><a href=https://docs-archive.freebsd.org/doc/ target=_blank class=column-element>Previous versions</a></li><li><a href=https://docs-archive.freebsd.org/44doc/ target=_blank class=column-element>4.4BSD Documents</a></li><li><a href=https://wiki.freebsd.org/ target=_blank class=column-element>Wiki</a></li></ul></section><section class=community-column><h3 class=column-title>Community</h3><ul class=column-elements-container><li><a href=https://docs.freebsd.org/en/articles/contributing class=column-element>Get involved</a></li><li><a href=https://forums.freebsd.org/ target=_blank class=column-element>Community forum</a></li><li><a href=https://lists.freebsd.org/ target=_blank class=column-element>Mailing lists</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank class=column-element>IRC Channels</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank class=column-element>Bug Tracker</a></li></ul></section><section class=legal-column><h3 class=column-title>Legal</h3><ul class=column-elements-container><li><a href=https://freebsdfoundation.org/donate/ target=_blank class=column-element>Donations</a></li><li><a href=https://www.freebsd.org/copyright/freebsd-license/ target=_blank class=column-element>Licensing</a></li><li><a href=https://www.freebsd.org/privacy/ target=_blank class=column-element>Privacy Policy</a></li><li><a href=https://www.freebsd.org/copyright/ target=_blank class=column-element>Legal notices</a></li></ul></section><section class=copyright-column><p>&copy; 1994-2024 The FreeBSD Project. All rights reserved</p><span>Made with <span class=heart>♥</span> by the FreeBSD Community</span></section></div></footer></body></html>