<!doctype html><html class=theme-light lang=en><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Introductory information for FreeBSD committers"><meta name=keywords content="FreeBSD Committer's Guide,Guide,Community"><meta name=copyright content="1995-2024 The FreeBSD Foundation"><link rel=canonical href=http://172.16.201.134:1313/en/articles/committers-guide/><title>Committer's Guide | FreeBSD Documentation Portal</title>
<meta name=theme-color content="#790000"><meta name=color-scheme content="system light dark high-contrast"><link rel="shortcut icon" href=http://172.16.201.134:1313/favicon.ico><link rel=stylesheet href=http://172.16.201.134:1313/styles/main.min.css><link rel=stylesheet href=http://172.16.201.134:1313/css/font-awesome-min.css><script defer src=/js/theme-chooser.min.js></script><script defer src=/js/copy-clipboard.min.js></script><script defer src=/js/search.min.js></script><meta name=twitter:card content="summary"><meta name=twitter:domain content="docs.FreeBSD.org"><meta name=twitter:site content="@freebsd"><meta name=twitter:url content="https://twitter.com/freebsd"><meta property="og:title" content="Committer's Guide"><meta property="og:description" content="Introductory information for FreeBSD committers"><meta property="og:type" content="website"><meta property="og:image" content="http://172.16.201.134:1313/favicon.ico"><meta property="og:image:alt" content="FreeBSD Logo"><meta property="og:locale" content="en"><meta property="og:url" content="http://172.16.201.134:1313/en/articles/committers-guide/"><meta property="og:site_name" content="FreeBSD Documentation Portal"><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","url":"http:\/\/172.16.201.134:1313\/en\/articles\/committers-guide\/","name":"FreeBSD Documentation Portal","headline":"FreeBSD Documentation Portal","description":"FreeBSD Documentation Portal"}</script></head><body><header><div class=header-container><div class=logo-menu-bars-container><a href=https://www.FreeBSD.org class=logo><img src=http://172.16.201.134:1313/images/FreeBSD-monochromatic.svg width=160 height=50 alt="FreeBSD logo">
</a><label class=menu-bars for=menu-bars><i class="fa fa-bars" aria-hidden=true></i></label></div><input id=menu-bars type=checkbox><nav><ul class=menu><li class=menu-item><input id=about type=checkbox>
<a href=# aria-label="Navigate to About section"><label class=menu-item-description for=about>About
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/about/ target=_blank>About</a></li><li><a href=https://www.freebsd.org/about/ target=_blank>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/about-us/about-the-foundation/ target=_blank>FreeBSD Foundation</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct/ target=_blank>Code of Conduct</a></li></ul></li><li class=menu-item><input id=download type=checkbox>
<a href=# aria-label="Navigate to get FreeBSD section"><label class=menu-item-description for=download>Get FreeBSD
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/where/ target=_blank>Get FreeBSD</a></li><li><a href=https://www.freebsd.org/releases/ target=_blank>Release Information</a></li><li><a href=https://www.freebsd.org/releng/ target=_blank>Release Engineering</a></li><li><a href=https://www.freebsd.org/security/ target=_blank>Security Advisories</a></li></ul></li><li class=menu-item><input id=documentation type=checkbox>
<a href=# aria-label="Navigate to get Documentation section"><label class=menu-item-description for=documentation>Documentation
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=/en>Documentation portal</a></li><li><a href=http://172.16.201.134:1313/en/books/handbook>FreeBSD Handbook</a></li><li><a href=http://172.16.201.134:1313/en/books/porters-handbook>Porter's Handbook</a></li><li><a href=https://docs.FreeBSD.org/en/books/fdp-primer>Documentation Project Handbook</a></li><li><a href=https://man.FreeBSD.org target=_blank>Manual pages</a></li><li><a href=https://papers.FreeBSD.org target=_blank>Presentations and papers</a></li><li><a href=https://wiki.FreeBSD.org target=_blank>Wiki</a></li><li><a href=http://172.16.201.134:1313/en/books>Books</a></li><li><a href=http://172.16.201.134:1313/en/articles>Articles</a></li></ul></li><li class=menu-item><input id=community type=checkbox>
<a href=# aria-label="Navigate to get Community section"><label class=menu-item-description for=community>Community
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/community/>Community</a></li><li><a href=http://172.16.201.134:1313/en/articles/contributing>Get involved</a></li><li><a href=https://forums.freebsd.org/ target=_blank>Forum</a></li><li><a href=https://lists.freebsd.org/ target=_blank>Mailing lists</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank>IRC Channels</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank>Bug Tracker</a></li><li><a href=https://www.freebsd.org/support/ target=_blank>Support</a></li></ul></li></ul></nav><div class=search-donate-container><form class=search method=get id=search-header-form action=https://docs.freebsd.org/search name=search-header-form><input type=hidden name=DB value=en>
<input id=words name=P type=text size=20 maxlength=255>
<button>
<i class="fa fa-search" aria-hidden=true></i></button></form><div class=donate><a href=https://freebsdfoundation.org/donate/ target=_blank><span class=heart>♥</span>
Donate</a></div></div></div></header><main class=main-wrapper-article><div class=article><h1 class=title>Committer's Guide</h1><div class=copyright>Copyright © 1999-2022 The FreeBSD Documentation Project</div><div class=legalnotice><a id=trademarks></a><details><summary>trademarks</summary><p>FreeBSD is a registered trademark of the FreeBSD Foundation.</p><p>Coverity is a registered trademark; Coverity Extend, Coverity Prevent and Coverity Prevent SQS are trademarks of Coverity, Inc.</p><p>IBM, AIX, OS/2, PowerPC, PS/2, S/390, and ThinkPad are trademarks of International Business Machines Corporation in the United States, other countries, or both.</p><p>Git and the Git logo are either registered trademarks or trademarks of Software Freedom Conservancy, Inc., corporate home of the Git Project, in the United States and/or other countries.</p><p>GitHub is a trademark of GitHub Inc., registered in the United States and other countries.</p><p>GITLAB is a trademark of GitLab Inc. in the United States and other countries and regions.</p><p>Intel, Celeron, Centrino, Core, EtherExpress, i386, i486, Itanium, Pentium, and Xeon are trademarks or registered trademarks of Intel Corporation or its subsidiaries in the United States and other countries.</p><p>Many of the designations used by manufacturers and sellers to distinguish their products are claimed as trademarks. Where those designations appear in this document, and the FreeBSD Project was aware of the trademark claim, the designations have been followed by the “™” or the “®” symbol.</p></details></div><div class=toc-mobile><h3>Table of Contents</h3><nav id=TableOfContents><ul><li><a href=#admin>1. Administrative Details</a></li><li><a href=#pgpkeys>2. OpenPGP Keys for FreeBSD</a></li><li><a href=#kerberos-ldap>3. Kerberos and LDAP web Password for FreeBSD Cluster</a></li><li><a href=#committer.types>4. Commit Bit Types</a></li><li><a href=#git-primer>5. Git Primer</a></li><li><a href=#vcs-history>6. Version Control History</a></li><li><a href=#conventions>7. Setup, Conventions, and Traditions</a></li><li><a href=#pre-commit-review>8. Pre-Commit Review</a></li><li><a href=#commit-log-message>9. Commit Log Messages</a></li><li><a href=#pref-license>10. Preferred License for New Files</a></li><li><a href=#tracking.license.grants>11. Keeping Track of Licenses Granted to the FreeBSD Project</a></li><li><a href=#spdx.tags>12. SPDX Tags in the tree</a></li><li><a href=#developer.relations>13. Developer Relations</a></li><li><a href=#if-in-doubt>14. If in Doubt…​</a></li><li><a href=#bugzilla>15. Bugzilla</a></li><li><a href=#phabricator>16. Phabricator</a></li><li><a href=#people>17. Who’s Who</a></li><li><a href=#ssh.guide>18. SSH Quick-Start Guide</a></li><li><a href=#coverity>19. Coverity® Availability for FreeBSD Committers</a></li><li><a href=#rules>20. The FreeBSD Committers' Big List of Rules</a></li><li><a href=#archs>21. Support for Multiple Architectures</a></li><li><a href=#ports>22. Ports Specific FAQ</a></li><li><a href=#non-committers>23. Issues Specific to Developers Who Are Not Committers</a></li><li><a href=#google-analytics>24. Information About Google Analytics</a></li><li><a href=#misc>25. Miscellaneous Questions</a></li><li><a href=#benefits>26. Benefits and Perks for FreeBSD Committers</a></li></ul></nav></div><div id=preamble><div class=sectionbody><div class="paragraph abstract-title"><p>Abstract</p></div><div class=paragraph><p>This document provides information for the FreeBSD committer community.
All new committers should read this document before they start, and existing committers are strongly encouraged to review it from time to time.</p></div><div class=paragraph><p>Almost all FreeBSD developers have commit rights to one or more repositories.
However, a few developers do not, and some of the information here applies to them as well.
(For instance, some people only have rights to work with the Problem Report database.)
Please see <a href=../committers-guide/#non-committers>Issues Specific to Developers Who Are Not Committers</a> for more information.</p></div><div class=paragraph><p>This document may also be of interest to members of the FreeBSD community who want to learn more about how the project works.</p></div><hr></div></div><div class=sect1><h2 id=admin>1. Administrative Details<a class=anchor href=#admin></a></h2><div class=sectionbody><table class="tableblock frame-none grid-all stretch informaltable"><col style=width:50%><col style=width:50%><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><em>Login Methods</em></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><a href="https://man.freebsd.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;format=html">ssh(1)</a>, protocol 2 only</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><em>Main Shell Host</em></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>freefall.FreeBSD.org</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><em>Reference Machines</em></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>ref*.FreeBSD.org</code>, <code>universe*.freeBSD.org</code> (see also <a href=https://www.FreeBSD.org/internal/machines/>FreeBSD Project Hosts</a>)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><em>SMTP Host</em></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>smtp.FreeBSD.org:587</code> (see also <a href=../committers-guide/#smtp-setup>SMTP Access Setup</a>).</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code><em>src/</em></code> Git Repository</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>ssh://git@gitrepo.FreeBSD.org/src.git</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code><em>doc/</em></code> Git Repository</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>ssh://git@gitrepo.FreeBSD.org/doc.git</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code><em>ports/</em></code> Git Repository</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>ssh://git@gitrepo.FreeBSD.org/ports.git</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><em>Internal Mailing Lists</em></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>developers (technically called all-developers), doc-developers, doc-committers, ports-developers, ports-committers, src-developers, src-committers. (Each project repository has its own -developers and -committers mailing lists. Archives for these lists can be found in the files <span class=filename>/local/mail/repository-name-developers-archive</span> and <span class=filename>/local/mail/repository-name-committers-archive</span> on <code>freefall.FreeBSD.org</code>.)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><em>Core Team monthly reports</em></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/home/core/public/reports</span> on the <code>FreeBSD.org</code> cluster.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><em>Ports Management Team monthly reports</em></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/home/portmgr/public/monthly-reports</span> on the <code>FreeBSD.org</code> cluster.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><em>Noteworthy <code>src/</code> Git Branches:</em></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>stable/n</code> (<code>n</code>-STABLE), <code>main</code> (-CURRENT)</p></td></tr></tbody></table><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;format=html">ssh(1)</a> is required to connect to the project hosts. For more information,
see <a href=../committers-guide/#ssh.guide>SSH Quick-Start Guide</a>.</p></div><div class=paragraph><p>Useful links:</p></div><div class=ulist><ul><li><p><a href=https://www.FreeBSD.org/internal/>FreeBSD Project Internal Pages</a></p></li><li><p><a href=https://www.FreeBSD.org/internal/machines/>FreeBSD Project Hosts</a></p></li><li><p><a href=https://www.FreeBSD.org/administration/>FreeBSD Project Administrative Groups</a></p></li></ul></div></div></div><div class=sect1><h2 id=pgpkeys>2. OpenPGP Keys for FreeBSD<a class=anchor href=#pgpkeys></a></h2><div class=sectionbody><div class=paragraph><p>Cryptographic keys conforming to the OpenPGP (<em>Pretty Good Privacy</em>) standard are used by the FreeBSD project to authenticate committers.
Messages carrying important information like public SSH keys can be signed with the OpenPGP key to prove that they are really from the committer.
See <a href=https://nostarch.com/releases/pgp_release.pdf>PGP & GPG: Email for the Practical Paranoid by Michael Lucas</a> and <a href=https://en.wikipedia.org/wiki/Pretty_Good_Privacy class=bare>https://en.wikipedia.org/wiki/Pretty_Good_Privacy</a> for more information.</p></div><div class=sect2><h3 id=pgpkeys-creating>2.1. Creating a Key<a class=anchor href=#pgpkeys-creating></a></h3><div class=paragraph><p>Existing keys can be used, but should be checked with <span class=filename>documentation/tools/checkkey.sh</span> first.
In this case, make sure the key has a FreeBSD user ID.</p></div><div class=paragraph><p>For those who do not yet have an OpenPGP key, or need a new key to meet FreeBSD security requirements, here we show how to generate one.</p></div><div id=pgpkeys-create-steps class="exampleblock procedure"><div class=content><div class="olist arabic"><ol class=arabic><li><p>Install <span class=filename>security/gnupg</span>. Enter these lines in <span class=filename>~/.gnupg/gpg.conf</span> to set minimum acceptable defaults for signing and new key preferences (see the <a href=https://www.gnupg.org/documentation/manuals/gnupg/GPG-Options.html>GnuPG options documentation</a> for more details):</p><div class="literalblock programlisting"><div class=content><pre># Sorted list of preferred algorithms for signing (strongest to weakest).
personal-digest-preferences SHA512 SHA384 SHA256 SHA224
# Default preferences for new keys
default-preference-list SHA512 SHA384 SHA256 SHA224 AES256 CAMELLIA256 AES192 CAMELLIA192 AES CAMELLIA128 CAST5 BZIP2 ZLIB ZIP Uncompressed</pre></div></div></li><li><p>Generate a key:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% gpg <span class=nt>--full-gen-key</span>
gpg <span class=o>(</span>GnuPG<span class=o>)</span> 2.1.8<span class=p>;</span> Copyright <span class=o>(</span>C<span class=o>)</span> 2015 Free Software Foundation, Inc.
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

Warning: using insecure memory!
Please <span class=k>select </span>what kind of key you want:
   <span class=o>(</span>1<span class=o>)</span> RSA and RSA <span class=o>(</span>default<span class=o>)</span>
   <span class=o>(</span>2<span class=o>)</span> DSA and Elgamal
   <span class=o>(</span>3<span class=o>)</span> DSA <span class=o>(</span>sign only<span class=o>)</span>
   <span class=o>(</span>4<span class=o>)</span> RSA <span class=o>(</span>sign only<span class=o>)</span>
Your selection? 1
RSA keys may be between 1024 and 4096 bits long.
What keysize <span class=k>do </span>you want? <span class=o>(</span>2048<span class=o>)</span> 2048 <i class=conum data-value=1></i><b>(1)</b>
Requested keysize is 2048 bits
Please specify how long the key should be valid.
	 0 <span class=o>=</span> key does not expire
      &lt;n&gt;  <span class=o>=</span> key expires <span class=k>in </span>n days
      &lt;n&gt;w <span class=o>=</span> key expires <span class=k>in </span>n weeks
      &lt;n&gt;m <span class=o>=</span> key expires <span class=k>in </span>n months
      &lt;n&gt;y <span class=o>=</span> key expires <span class=k>in </span>n years
Key is valid <span class=k>for</span>? <span class=o>(</span>0<span class=o>)</span> 3y <i class=conum data-value=2></i><b>(2)</b>
Key expires at Wed Nov  4 17:20:20 2015 MST
Is this correct? <span class=o>(</span>y/N<span class=o>)</span> y
GnuPG needs to construct a user ID to identify your key.

Real name: Chucky Daemon <i class=conum data-value=3></i><b>(3)</b>
Email address: notreal@example.com
Comment:
You selected this USER-ID:
<span class=s2>&#34;Chucky Daemon &lt;notreal@example.com&gt;&#34;</span>

Change <span class=o>(</span>N<span class=o>)</span>ame, <span class=o>(</span>C<span class=o>)</span>omment, <span class=o>(</span>E<span class=o>)</span>mail or <span class=o>(</span>O<span class=o>)</span>kay/<span class=o>(</span>Q<span class=o>)</span>uit? o
You need a Passphrase to protect your secret key.</code></pre></div></div></li></ol></div><div class="colist arabic"><table><tbody><tr><td><i class=conum data-value=1></i><b>1</b></td><td>2048-bit keys with a three-year expiration provide adequate protection at present (2022-10).</td></tr><tr><td><i class=conum data-value=2></i><b>2</b></td><td>A three year key lifespan is short enough to obsolete keys weakened by advancing computer power, but long enough to reduce key management problems.</td></tr><tr><td><i class=conum data-value=3></i><b>3</b></td><td>Use your real name here, preferably matching that shown on government-issued ID to make it easier for others to verify your identity. Text that may help others identify you can be entered in the <code>Comment</code> section.<div class=paragraph><p>After the email address is entered, a passphrase is requested.
Methods of creating a secure passphrase are contentious.
Rather than suggest a single way, here are some links to sites that describe various methods: <a href=https://world.std.com/~reinhold/diceware.html class=bare>https://world.std.com/~reinhold/diceware.html</a>, <a href=https://www.iusmentis.com/security/passphrasefaq/ class=bare>https://www.iusmentis.com/security/passphrasefaq/</a>, <a href=https://xkcd.com/936/ class=bare>https://xkcd.com/936/</a>, <a href=https://en.wikipedia.org/wiki/Passphrase class=bare>https://en.wikipedia.org/wiki/Passphrase</a>.</p></div></td></tr></tbody></table></div></div></div><div class=paragraph><p>Protect the private key and passphrase.
If either the private key or passphrase may have been compromised or disclosed, immediately notify <a href=mailto:accounts@FreeBSD.org>accounts@FreeBSD.org</a> and revoke the key.</p></div><div class=paragraph><p>Committing the new key is shown in crossref:committers-guide[commit-steps, Steps
for New Committers].</p></div></div></div></div><div class=sect1><h2 id=kerberos-ldap>3. Kerberos and LDAP web Password for FreeBSD Cluster<a class=anchor href=#kerberos-ldap></a></h2><div class=sectionbody><div class=paragraph><p>The FreeBSD cluster requires a Kerberos password to access certain services.
The Kerberos password also serves as the LDAP web password, since LDAP is proxying to Kerberos in the cluster.
Some of the services which require this include:</p></div><div class=ulist><ul><li><p><a href=https://bugs.freebsd.org/bugzilla>Bugzilla</a></p></li><li><p><a href=https://ci.freebsd.org>Jenkins</a></p></li></ul></div><div class=paragraph><p>To create a new Kerberos account in the FreeBSD cluster, or to reset a Kerberos password for an existing account using a random password generator:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% ssh kpasswd.freebsd.org</code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>This must be done from a machine outside of the FreeBSD.org cluster.</p></div></td></tr></tbody></table></div><div class=paragraph><p>A Kerberos password can also be set manually by logging into <code>freefall.FreeBSD.org</code> and running:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% kpasswd</code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Unless the Kerberos-authenticated services of the FreeBSD.org cluster have been used previously, <code>Client unknown</code> will be shown.
This error means that the <code>ssh kpasswd.freebsd.org</code> method shown above must be used first to initialize the Kerberos account.</p></div></td></tr></tbody></table></div></div></div><div class=sect1><h2 id=committer.types>4. Commit Bit Types<a class=anchor href=#committer.types></a></h2><div class=sectionbody><div class=paragraph><p>The FreeBSD repository has a number of components which, when combined, support the basic operating system source, documentation, third party application ports infrastructure, and various maintained utilities.
When FreeBSD commit bits are allocated, the areas of the tree where the bit may be used are specified.
Generally, the areas associated with a bit reflect who authorized the allocation of the commit bit.
Additional areas of authority may be added at a later date: when this occurs, the committer should follow normal commit bit allocation procedures for that area of the tree, seeking approval from the appropriate entity and possibly getting a mentor for that area for some period of time.</p></div><table class="tableblock frame-none grid-all stretch informaltable"><col style=width:33.3333%><col style=width:33.3333%><col style=width:33.3334%><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><em>Committer Type</em></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><em>Responsible</em></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><em>Tree Components</em></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>src</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>core@</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>src/</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>doc</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>doceng@</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>doc/, ports/, src/ documentation</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>ports</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>portmgr@</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>ports/</p></td></tr></tbody></table><div class=paragraph><p>Commit bits allocated prior to the development of the notion of areas of authority may be appropriate for use in many parts of the tree.
However, common sense dictates that a committer who has not previously worked in an area of the tree seek review prior to committing, seek approval from the appropriate responsible party, and/or work with a mentor.
Since the rules regarding code maintenance differ by area of the tree, this is as much for the benefit of the committer working in an area of less familiarity as it is for others working on the tree.</p></div><div class=paragraph><p>Committers are encouraged to seek review for their work as part of the normal development process, regardless of the area of the tree where the work is occurring.</p></div><div class=sect2><h3 id=_policy_for_committer_activity_in_other_trees>4.1. Policy for Committer Activity in Other Trees<a class=anchor href=#_policy_for_committer_activity_in_other_trees></a></h3><div class=ulist><ul><li><p>All committers may modify <span class=filename>src/share/misc/committers-*.dot</span>, <span class=filename>src/usr.bin/calendar/calendars/calendar.freebsd</span>, and <span class=filename>ports/astro/xearth/files</span>.</p></li><li><p>doc committers may commit documentation changes to <span class=filename>src</span> files, such as manual pages, READMEs, fortune databases, calendar files, and comment fixes without approval from a src committer, subject to the normal care and tending of commits.</p></li><li><p>Any committer may make changes to any other tree with an "Approved by" from a non-mentored committer with the appropriate bit.
Mentored committers can provide a "Reviewed by" but not an "Approved by".</p></li><li><p>Committers can acquire an additional bit by the usual process of finding a mentor who will propose them to core, doceng, or portmgr, as appropriate. When approved, they will be added to 'access' and the normal mentoring period will ensue, which will involve a continuing of "Approved by" for some period.</p></li></ul></div><div class=sect3><h4 id=doc-blanket-approval>4.1.1. Documentation Implicit (Blanket) Approval<a class=anchor href=#doc-blanket-approval></a></h4><div class=paragraph><p>Some types of fixes have "blanket approval" from the Documentation Engineering Team &lt;<a href=mailto:doceng@FreeBSD.org>doceng@FreeBSD.org</a>>, allowing any committer to fix those categories of problems on any part of the doc tree.
These fixes do not need approval or review from a doc committer if the author doesn’t have a doc commit bit.</p></div><div class=paragraph><p>Blanket approval applies to these types of fixes:</p></div><div class=ulist><ul><li><p>Typos</p></li><li><p>Trivial fixes</p><div class=paragraph><p>Punctuation, URLs, dates, paths and file names with outdated or incorrect information, and other common mistakes that may confound the readers.</p></div></li></ul></div><div class=paragraph><p>Over the years, some implicit approvals were granted in the doc tree.
This list shows the most common cases:</p></div><div class=ulist><ul><li><p>Changes in <span class=filename>documentation/content/en/books/porters-handbook/versions/_index.adoc</span></p><div class=paragraph><p><a href=https://docs.freebsd.org/en/books/porters-handbook/versions/>__FreeBSD_version Values (Porter’s Handbook)</a>, mainly used for src committers.</p></div></li><li><p>Changes in <span class=filename>doc/shared/contrib-additional.adoc</span></p><div class=paragraph><p><a href=https://docs.freebsd.org/en/articles/contributors/#contrib-additional>Additional FreeBSD Contributors</a> maintenance.</p></div></li><li><p>All <a href=#commit-steps>Steps for New Committers</a>, doc related</p></li><li><p>Security advisories; Errata Notices; Releases;</p><div class=paragraph><p>Used by Security Officer Team &lt;<a href=mailto:security-officer@FreeBSD.org>security-officer@FreeBSD.org</a>> and Release Engineering Team &lt;<a href=mailto:re@FreeBSD.org>re@FreeBSD.org</a>>.</p></div></li><li><p>Changes in <span class=filename>website/content/en/donations/donors.adoc</span></p><div class=paragraph><p>Used by Donations Liaison Office &lt;<a href=mailto:donations@FreeBSD.org>donations@FreeBSD.org</a>>.</p></div></li></ul></div><div class=paragraph><p>Before any commit, a build test is necessary; see the 'Overview' and 'The FreeBSD Documentation Build Process' sections of the <a href=https://docs.freebsd.org/en/books/fdp-primer/>FreeBSD Documentation Project Primer for New Contributors</a> for more details.</p></div></div></div></div></div><div class=sect1><h2 id=git-primer>5. Git Primer<a class=anchor href=#git-primer></a></h2><div class=sectionbody><div class=sect2><h3 id=git-basics>5.1. Git basics<a class=anchor href=#git-basics></a></h3><div class=paragraph><p>When one searches for "Git Primer" a number of good ones come up.
Daniel Miessler’s <a href=https://danielmiessler.com/study/git/>A git primer</a> and Willie Willus' <a href=https://gist.github.com/williewillus/068e9a8543de3a7ef80adb2938657b6b>Git - Quick Primer</a> are both good overviews.
The Git book is also complete, but much longer <a href=https://git-scm.com/book/en/v2 class=bare>https://git-scm.com/book/en/v2</a>.
There is also this website <a href=https://dangitgit.com/ class=bare>https://dangitgit.com/</a> for common traps and pitfalls of Git, in case you need guidance to fix things up.
Finally, an introduction <a href=https://eagain.net/articles/git-for-computer-scientists/>targeted at computer scientists</a> has proven helpful to some at explaining the Git world view.</p></div><div class=paragraph><p>This document will assume that you’ve read through it and will try not to belabor the basics (though it will cover them briefly).</p></div></div><div class=sect2><h3 id=git-mini-primer>5.2. Git Mini Primer<a class=anchor href=#git-mini-primer></a></h3><div class=paragraph><p>This primer is less ambitiously scoped than the old Subversion Primer, but should cover the basics.</p></div><div class=sect3><h4 id=_scope>5.2.1. Scope<a class=anchor href=#_scope></a></h4><div class=paragraph><p>If you want to download FreeBSD, compile it from sources, and generally keep up to date that way, this primer is for you.
It covers getting the sources, updating the sources, bisecting and touches briefly on how to cope with a few local changes.
It covers the basics, and tries to give good pointers to more in-depth treatment for when the reader finds the basics insufficient.
Other sections of this guide cover more advanced topics related to contributing to the project.</p></div><div class=paragraph><p>The goal of this section is to highlight those bits of Git needed to track sources.
They assume a basic understanding of Git.
There are many primers for Git on the web, but the <a href=https://git-scm.com/book/en/v2>Git Book</a> provides one of the better treatments.</p></div></div><div class=sect3><h4 id=git-mini-primer-getting-started>5.2.2. Getting Started For Developers<a class=anchor href=#git-mini-primer-getting-started></a></h4><div class=paragraph><p>This section describes the read-write access for committers to push the commits from developers or contributors.</p></div><div class=sect4><h5 id=git-mini-daily-use>5.2.2.1. Daily use<a class=anchor href=#git-mini-daily-use></a></h5><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>In the examples below, replace <code>${repo}</code> with the name of the desired FreeBSD repository: <code>doc</code>, <code>ports</code>, or <code>src</code>.</p></div></td></tr></tbody></table></div><div class=ulist><ul><li><p>Clone the repository:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git clone <span class=nt>-o</span> freebsd <span class=nt>--config</span> remote.freebsd.fetch<span class=o>=</span><span class=s1>&#39;+refs/notes/*:refs/notes/*&#39;</span> https://git.freebsd.org/<span class=k>${</span><span class=nv>repo</span><span class=k>}</span>.git</code></pre></div></div><div class=paragraph><p>Then you should have the official mirrors as your remote:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git remote <span class=nt>-v</span>
freebsd  https://git.freebsd.org/<span class=k>${</span><span class=nv>repo</span><span class=k>}</span>.git <span class=o>(</span>fetch<span class=o>)</span>
freebsd  https://git.freebsd.org/<span class=k>${</span><span class=nv>repo</span><span class=k>}</span>.git <span class=o>(</span>push<span class=o>)</span></code></pre></div></div></li><li><p>Configure the FreeBSD committer data:</p><div class=paragraph><p>The commit hook in repo.freebsd.org checks the "Commit" field matches the committer’s information in FreeBSD.org.
The easiest way to get the suggested config is by executing <code>/usr/local/bin/gen-gitconfig.sh</code> script on freefall:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% gen-gitconfig.sh
<span class=o>[</span>...]
% git config user.name <span class=o>(</span>your name <span class=k>in </span>gecos<span class=o>)</span>
% git config user.email <span class=o>(</span>your login<span class=o>)</span>@FreeBSD.org</code></pre></div></div></li><li><p>Set the push URL:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git remote set-url <span class=nt>--push</span> freebsd git@gitrepo.freebsd.org:<span class=k>${</span><span class=nv>repo</span><span class=k>}</span>.git</code></pre></div></div><div class=paragraph><p>Then you should have separated fetch and push URLs as the most efficient setup:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git remote <span class=nt>-v</span>
freebsd  https://git.freebsd.org/<span class=k>${</span><span class=nv>repo</span><span class=k>}</span>.git <span class=o>(</span>fetch<span class=o>)</span>
freebsd  git@gitrepo.freebsd.org:<span class=k>${</span><span class=nv>repo</span><span class=k>}</span>.git <span class=o>(</span>push<span class=o>)</span></code></pre></div></div><div class=paragraph><p>Again, note that <code>gitrepo.freebsd.org</code> has been canonicalized to <code>repo.freebsd.org</code>.</p></div></li><li><p>Install commit message template hook:</p><div class=paragraph><p>For doc repository:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% <span class=nb>cd</span> .git/hooks
% <span class=nb>ln</span> <span class=nt>-s</span> ../../.hooks/prepare-commit-msg</code></pre></div></div><div class=paragraph><p>For ports repository:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git config <span class=nt>--add</span> core.hooksPath .hooks</code></pre></div></div><div class=paragraph><p>For src repository:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% <span class=nb>cd</span> .git/hooks
% <span class=nb>ln</span> <span class=nt>-s</span> ../../tools/tools/git/hooks/prepare-commit-msg</code></pre></div></div></li></ul></div></div><div class=sect4><h5 id=admin-branch>5.2.2.2. "admin" branch<a class=anchor href=#admin-branch></a></h5><div class=paragraph><p>The <code>access</code> and <code>mentors</code> files are stored in an orphan branch, <code>internal/admin</code>, in each repository.</p></div><div class=paragraph><p>Following example is how to check out the <code>internal/admin</code> branch to a local branch named <code>admin</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git config <span class=nt>--add</span> remote.freebsd.fetch <span class=s1>&#39;+refs/internal/*:refs/internal/*&#39;</span>
% git fetch
% git checkout <span class=nt>-b</span> admin internal/admin</code></pre></div></div><div class=paragraph><p>Alternatively, you can add a worktree for the <code>admin</code> branch:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>git worktree add <span class=nt>-b</span> admin ../<span class=k>${</span><span class=nv>repo</span><span class=k>}</span><span class=nt>-admin</span> internal/admin</code></pre></div></div><div class=paragraph><p>For browsing <code>internal/admin</code> branch on web:
<code><a href="https://cgit.freebsd.org/${repo}/log/?h=internal/admin" class=bare>https://cgit.freebsd.org/${repo}/log/?h=internal/admin</a></code></p></div><div class=paragraph><p>For pushing, specify the full refspec:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>git push freebsd HEAD:refs/internal/admin</code></pre></div></div></div></div><div class=sect3><h4 id=_keeping_current_with_the_freebsd_src_tree>5.2.3. Keeping Current With The FreeBSD src Tree<a class=anchor href=#_keeping_current_with_the_freebsd_src_tree></a></h4><div id=keeping_current class=paragraph><p>First step: cloning a tree.
This downloads the entire tree.
There are two ways to download.
Most people will want to do a deep clone of the repository.
However, there are times when you may wish to do a shallow clone.</p></div><div class=sect4><h5 id=_branch_names>5.2.3.1. Branch Names<a class=anchor href=#_branch_names></a></h5><div class=paragraph><p>FreeBSD-CURRENT uses the <code>main</code> branch.</p></div><div class=paragraph><p><code>main</code> is the default branch.</p></div><div class=paragraph><p>For FreeBSD-STABLE, branch names include <code>stable/12</code> and <code>stable/13</code>.</p></div><div class=paragraph><p>For FreeBSD-RELEASE, release engineering branch names include <code>releng/12.4</code> and <code>releng/13.2</code>.</p></div><div class=paragraph><p><a href=https://www.freebsd.org/releng/ class=bare>https://www.freebsd.org/releng/</a> shows:</p></div><div class=ulist><ul><li><p><code>main</code> and <code>stable/⋯</code> branches open</p></li><li><p><code>releng/⋯</code> branches, each of which is frozen when a release is tagged.</p></li></ul></div><div class=paragraph><p>Examples:</p></div><div class=ulist><ul><li><p>tag <a href="https://cgit.freebsd.org/src/tag/?h=release/13.1.0">release/13.1.0</a> on the <a href="https://cgit.freebsd.org/src/log/?h=releng/13.1">releng/13.1</a> branch</p></li><li><p>tag <a href="https://cgit.freebsd.org/src/tag/?h=release/13.2.0">release/13.2.0</a> on the <a href="https://cgit.freebsd.org/src/log/?h=releng/13.2">releng/13.2</a> branch.</p></li></ul></div></div><div class=sect4><h5 id=_repositories>5.2.3.2. Repositories<a class=anchor href=#_repositories></a></h5><div class=paragraph><p>Please see the <a href=../committers-guide/#admin>Administrative Details</a> for the latest information on where to get FreeBSD sources.
$URL below can be obtained from that page.</p></div><div class=paragraph><p>Note: The project doesn’t use submodules as they are a poor fit for our workflows and development model.
How we track changes in third-party applications is discussed elsewhere and generally of little concern to the casual user.</p></div></div><div class=sect4><h5 id=_deep_clone>5.2.3.3. Deep Clone<a class=anchor href=#_deep_clone></a></h5><div class=paragraph><p>A deep clone pulls in the entire tree, as well as all the history and branches.
It is the easiest to do.
It also allows you to use Git’s worktree feature to have all your active branches checked out into separate directories but with only one copy of the repository.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git clone <span class=nt>-o</span> freebsd <span class=nv>$URL</span> <span class=nt>-b</span> branch <span class=o>[</span>&lt;directory&gt;]</code></pre></div></div><div class=paragraph><p> — will create a deep clone.
<code>branch</code> should be one of the branches listed in the previous section.
If no <code>branch</code> is given: the default (<code>main</code>) will be used.
If no <code>&lt;directory></code> is given: the name of the new directory will match the name of the repo (<span class=filename>doc</span>, <span class=filename>ports</span> or <span class=filename>src</span>).</p></div><div class=paragraph><p>You will want a deep clone if you are interested in the history, plan on making local changes, or plan on working on more than one branch.
It is the easiest to keep up to date as well.
If you are interested in the history, but are working with only one branch and are short on space, you can also use --single-branch to only download the one branch
(though some merge commits will not reference the merged-from branch which may be important for some users who are interested in detailed versions of history).</p></div></div><div class=sect4><h5 id=_shallow_clone>5.2.3.4. Shallow Clone<a class=anchor href=#_shallow_clone></a></h5><div class=paragraph><p>A shallow clone copies just the most current code, but none or little of the history.
This can be useful when you need to build a specific revision of FreeBSD, or when you are just starting out and plan to track the tree more fully.
You can also use it to limit history to only so many revisions.
However, see below for a significant limitation of this approach.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git clone <span class=nt>-o</span> freebsd <span class=nt>-b</span> branch <span class=nt>--depth</span> 1 <span class=nv>$URL</span> <span class=o>[</span><span class=nb>dir</span><span class=o>]</span></code></pre></div></div><div class=paragraph><p>This clones the repository, but only has the most recent version in the repository.
The rest of the history is not downloaded.
Should you change your mind later, you can do <code>git fetch --unshallow</code> to get the old history.</p></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>When you make a shallow clone, you will lose the commit count in your uname output.
This can make it more difficult to determine if your system needs to be updated when a security advisory is issued.</p></div></td></tr></tbody></table></div></div><div class=sect4><h5 id=_building>5.2.3.5. Building<a class=anchor href=#_building></a></h5><div class=paragraph><p>Once you’ve downloaded, building is done as described in the handbook,
e.g.:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% <span class=nb>cd </span>src
% make buildworld
% make buildkernel
% make installkernel
% make installworld</code></pre></div></div><div class=paragraph><p>so that won’t be covered in depth here.</p></div><div class=paragraph><p>If you want to build a custom kernel, <a href=https://docs.freebsd.org/en/books/handbook/#kernelconfig>the kernel config section</a> of the FreeBSD Handbook recommends creating a file MYKERNEL under sys/${ARCH}/conf with your changes against GENERIC.
To have MYKERNEL disregarded by Git, it can be added to .git/info/exclude.</p></div></div><div class=sect4><h5 id=_updating>5.2.3.6. Updating<a class=anchor href=#_updating></a></h5><div class=paragraph><p>To update both types of trees uses the same commands.
This pulls in all the revisions since your last update.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git pull <span class=nt>--ff-only</span></code></pre></div></div><div class=paragraph><p>will update the tree.
In Git, a 'fast forward' merge is one that only needs to set a new branch pointer and doesn’t need to re-create the commits.
By always doing a fast forward merge/pull, you’ll ensure that you have an exact copy of the FreeBSD tree.
This will be important if you want to maintain local patches.</p></div><div class=paragraph><p>See below for how to manage local changes.
The simplest is to use <code>--autostash</code> on the <code>git pull</code> command, but more sophisticated options are available.</p></div></div></div><div class=sect3><h4 id=_selecting_a_specific_version>5.2.4. Selecting a Specific Version<a class=anchor href=#_selecting_a_specific_version></a></h4><div class=paragraph><p>In Git, <code>git checkout</code> checks out both branches and specific versions.
Git’s versions are the long hashes rather than a sequential number.</p></div><div class=paragraph><p>When you checkout a specific version, just specify the hash you want on the command line (the git log command can help you decide which hash you might want):</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git checkout 08b8197a74</code></pre></div></div><div class=paragraph><p>and you have that checked out.
You will be greeted with a message similar to the following:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>Note: checking out <span class=s1>&#39;08b8197a742a96964d2924391bf9fdfeb788865d&#39;</span><span class=nb>.</span>

You are <span class=k>in </span>a <span class=s1>&#39;detached HEAD&#39;</span> state. You can look around, make experimental
changes and commit them, and you can discard any commits you make <span class=k>in </span>this
state without impacting any branches by performing another checkout.

If you want to create a new branch to retain commits you create, you may
<span class=k>do </span>so <span class=o>(</span>now or later<span class=o>)</span> by using <span class=nt>-b</span> with the checkout <span class=nb>command </span>again. Example:

  git checkout <span class=nt>-b</span> &lt;new-branch-name&gt;

HEAD is now at 08b8197a742a hook gpiokeys.4 to the build</code></pre></div></div><div class=paragraph><p>where the last line is generated from the hash you are checking out and the first line of the commit message from that revision.
The hash can be abbreviated to the shortest unique length.
Git itself is inconsistent about how many digits it displays.</p></div></div><div class=sect3><h4 id=_bisecting>5.2.5. Bisecting<a class=anchor href=#_bisecting></a></h4><div class=paragraph><p>Sometimes, things go wrong.
The last version worked, but the one you just updated to does not.
A developer may ask you to bisect the problem to track down which commit caused the regression.</p></div><div class=paragraph><p>Git makes bisecting changes easy with a powerful <code>git bisect</code> command.
Here’s a brief outline of how to use it.
For more information, you can view <a href=https://www.metaltoad.com/blog/beginners-guide-git-bisect-process-elimination class=bare>https://www.metaltoad.com/blog/beginners-guide-git-bisect-process-elimination</a> or <a href=https://git-scm.com/docs/git-bisect class=bare>https://git-scm.com/docs/git-bisect</a> for more details.
The man git-bisect page is good at describing what can go wrong, what to do when versions won’t build, when you want to use terms other than 'good' and 'bad', etc, none of which will be covered here.</p></div><div class=paragraph><p><code>git bisect start --first-parent</code> will start the bisection process.
Next, you need to tell a range to go through.
<code>git bisect good XXXXXX</code> will tell it the working version and <code>git bisect bad XXXXX</code> will tell it the bad version.
The bad version will almost always be HEAD (a special tag for what you have checked out).
The good version will be the last one you checked out.
The <code>--first-parent</code> argument is necessary so that subsequent <code>git bisect</code> commands do not try to check out a vendor branch which lacks the full FreeBSD source tree.</p></div><div class="admonitionblock tip"><table><tbody><tr><td class=icon><i class="fa icon-tip" title=Tip></i></td><td class=content><div class=paragraph><p>If you want to know the last version you checked out, you should use <code>git reflog</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>5ef0bd68b515 <span class=o>(</span>HEAD -&gt; main, freebsd/main, freebsd/HEAD<span class=o>)</span> HEAD@<span class=o>{</span>0<span class=o>}</span>: pull <span class=nt>--ff-only</span>: Fast-forward
a8163e165c5b <span class=o>(</span>upstream/main<span class=o>)</span> HEAD@<span class=o>{</span>1<span class=o>}</span>: checkout: moving from b6fb97efb682994f59b21fe4efb3fcfc0e5b9eeb to main
...</code></pre></div></div><div class=paragraph><p>shows me moving the working tree to the <code>main</code> branch (a816…​) and then updating from upstream (to 5ef0…​).
In this case, bad would be HEAD (or 5ef0bd68b515) and good would be a8163e165c5b.
As you can see from the output, HEAD@{1} also often works, but isn’t foolproof if you have done other things to your Git tree after updating, but before you discover the need to bisect.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Set the 'good' version first, then set the bad (though the order doesn’t matter).
When you set the bad version, it will give you some statistics on the process:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git bisect start <span class=nt>--first-parent</span>
% git bisect good a8163e165c5b
% git bisect bad HEAD
Bisecting: 1722 revisions left to <span class=nb>test </span>after this <span class=o>(</span>roughly 11 steps<span class=o>)</span>
<span class=o>[</span>c427b3158fd8225f6afc09e7e6f62326f9e4de7e] Fixup r361997 by balancing parens.  Duh.</code></pre></div></div><div class=paragraph><p>You would then build/install that version.
If it’s good you’d type <code>git bisect good</code> otherwise <code>git bisect bad</code>.
If the version doesn’t compile, type <code>git bisect skip</code>.
You will get a similar message to the above after each step.
When you are done, report the bad version to the developer (or fix the bug yourself and send a patch).
<code>git bisect reset</code> will end the process and return you back to where you started (usually tip of <code>main</code>).
Again, the git-bisect manual (linked above) is a good resource for when things go wrong or for unusual cases.</p></div></div><div class=sect3><h4 id=git-gpg-signing>5.2.6. Signing the commits, tags, and pushes, with GnuPG<a class=anchor href=#git-gpg-signing></a></h4><div class=paragraph><p>Git knows how to sign commits, tags, and pushes.
When you sign a Git commit or a tag, you can prove that the code you submitted came from you and wasn’t altered while you were transferring it.
You also can prove that you submitted the code and not someone else.</p></div><div class=paragraph><p>A more in-depth documentation on signing commits and tags can be found in the <a href=https://git-scm.com/book/en/v2/Git-Tools-Signing-Your-Work>Git Tools - Signing Your Work</a> chapter of the Git’s book.</p></div><div class=paragraph><p>The rationale behind signing pushes can be found in the <a href=https://github.com/git/git/commit/a85b377d0419a9dfaca8af2320cc33b051cbed04>commit that introduced the feature</a>.</p></div><div class=paragraph><p>The best way is to simply tell Git you always want to sign commits, tags, and pushes.
You can do this by setting a few configuration variables:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git config <span class=nt>--add</span> user.signingKey LONG-KEY-ID
% git config <span class=nt>--add</span> commit.gpgSign <span class=nb>true</span>
% git config <span class=nt>--add</span> tag.gpgSign <span class=nb>true</span>
% git config <span class=nt>--add</span> push.gpgSign <span class=k>if</span><span class=nt>-asked</span></code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>To avoid possible collisions, make sure you give a long key id to Git.
You can get the long id with: <code>gpg --list-secret-keys --keyid-format LONG</code>.</p></div></td></tr></tbody></table></div><div class="admonitionblock tip"><table><tbody><tr><td class=icon><i class="fa icon-tip" title=Tip></i></td><td class=content><div class=paragraph><p>To use specific subkeys, and not have GnuPG to resolve the subkey to a primary key, attach <code>!</code> to the key.
For example, to encrypt for the subkey <code>DEADBEEF</code>, use <code>DEADBEEF!</code>.</p></div></td></tr></tbody></table></div><div class=sect4><h5 id=_verifying_signatures>5.2.6.1. Verifying signatures<a class=anchor href=#_verifying_signatures></a></h5><div class=paragraph><p>Commit signatures can be verified by running either <code>git verify-commit &lt;commit hash></code>, or <code>git log --show-signature</code>.</p></div><div class=paragraph><p>Tag signatures can be verified with <code>git verify-tag &lt;tag name></code>, or <code>git tag -v &lt;tag name></code>.</p></div></div></div><div class=sect3><h4 id=_ports_considerations>5.2.7. Ports Considerations<a class=anchor href=#_ports_considerations></a></h4><div class=paragraph><p>The ports tree operates the same way.
The branch names are different and the repositories are in different locations.</p></div><div class=paragraph><p>The cgit repository web interface for use with web browsers is at <a href=https://cgit.FreeBSD.org/ports/ class=bare>https://cgit.FreeBSD.org/ports/</a> .
The production Git repository is at <a href=https://git.FreeBSD.org/ports.git class=bare>https://git.FreeBSD.org/ports.git</a> and at ssh://anongit@git.FreeBSD.org/ports.git (or <a href=mailto:anongit@git.FreeBSD.org>anongit@git.FreeBSD.org</a>:ports.git).</p></div><div class=paragraph><p>There is also a mirror on GitHub, see <a href=https://docs.freebsd.org/en/books/handbook//mirrors#mirrors>External mirrors</a> for an overview.
The <em>latest</em> branch is <code>main</code>.
The <em>quarterly</em> branches are named <code>yyyyQn</code> for year 'yyyy' and quarter 'n'.</p></div><div class=sect4><h5 id=port-commit-message-formats>5.2.7.1. Commit message formats<a class=anchor href=#port-commit-message-formats></a></h5><div class=paragraph><p>A hook is available in the ports repository to help you write up your commit messages in <a href=https://cgit.freebsd.org/ports/tree/.hooks/prepare-commit-msg>.hooks/prepare-commit-message</a>.
It can be enabled by running <code>git config --add core.hooksPath .hooks</code>.</p></div><div class=paragraph><p>The main point being that a commit message should be formatted in the following way:</p></div><div class=literalblock><div class=content><pre>category/port: Summary.

Description of why the changes where made.

PR:	    12345</pre></div></div><div class="admonitionblock important"><table><tbody><tr><td class=icon><i class="fa icon-important" title=Important></i></td><td class=content><div class=paragraph><p>The first line is the subject of the commit, it contains what port was changed, and a summary of the commit.
It should contain 50 characters or less.</p></div><div class=paragraph><p>A blank line should separate it from the rest of the commit message.</p></div><div class=paragraph><p>The rest of the commit message should be wrapped at the 72 characters boundary.</p></div><div class=paragraph><p>Another blank line should be added if there are any metadata fields, so that they are easily distinguishable from the commit message.</p></div></td></tr></tbody></table></div></div></div><div class=sect3><h4 id=_managing_local_changes>5.2.8. Managing Local Changes<a class=anchor href=#_managing_local_changes></a></h4><div class=paragraph><p>This section addresses tracking local changes.
If you have no local changes you can skip this section.</p></div><div class=paragraph><p>One item that is important for all of them: all changes are local until pushed.
Unlike Subversion, Git uses a distributed model.
For users, for most things, there is very little difference.
However, if you have local changes, you can use the same tool to manage them as you use to pull in changes from FreeBSD.
All changes that you have not pushed are local and can easily be modified (git rebase, discussed below does this).</p></div><div class=sect4><h5 id=_keeping_local_changes>5.2.8.1. Keeping local changes<a class=anchor href=#_keeping_local_changes></a></h5><div class=paragraph><p>The simplest way to keep local changes (especially trivial ones) is to use <code>git stash</code>.
In its simplest form, you use <code>git stash</code> to record the changes (which pushes them onto the stash stack).
Most people use this to save changes before updating the tree as described above.
They then use <code>git stash apply</code> to re-apply them to the tree.
The stash is a stack of changes that can be examined with <code>git stash list</code>.
The git-stash man page (<a href=https://git-scm.com/docs/git-stash class=bare>https://git-scm.com/docs/git-stash</a>) has all the details.</p></div><div class=paragraph><p>This method is suitable when you have tiny tweaks to the tree.
When you have anything non trivial, you’ll likely be better off keeping a local branch and rebasing.
Stashing is also integrated with the <code>git pull</code> command: just add <code>--autostash</code> to the command line.</p></div></div><div class=sect4><h5 id=_keeping_a_local_branch>5.2.8.2. Keeping a local branch<a class=anchor href=#_keeping_a_local_branch></a></h5><div id=keeping_a_local_branch class=paragraph><p>It is much easier to keep a local branch with Git than Subversion.
In Subversion you need to merge the commit, and resolve the conflicts.
This is manageable, but can lead to a convoluted history that’s hard to upstream should that ever be necessary, or hard to replicate if you need to do so.
Git also allows one to merge, along with the same problems.
That’s one way to manage the branch, but it’s the least flexible.</p></div><div class=paragraph><p>In addition to merging, Git supports the concept of 'rebasing' which avoids these issues.
The <code>git rebase</code> command replays all the commits of a branch at a newer location on the parent branch.
We will cover the most common scenarios that arise using it.</p></div><div class=sect5><h6 id=_create_a_branch>5.2.8.2.1. Create a branch<a class=anchor href=#_create_a_branch></a></h6><div class=paragraph><p>Let’s say you want to make a change to FreeBSD’s ls command to never, ever do color.
There are many reasons to do this, but this example will use that as a baseline.
The FreeBSD ls command changes from time to time, and you’ll need to cope with those changes.
Fortunately, with Git rebase it usually is automatic.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% <span class=nb>cd </span>src
% git checkout main
% git checkout <span class=nt>-b</span> no-color-ls
% <span class=nb>cd </span>bin/ls
% vi ls.c     <span class=c># hack the changes in</span>
% git diff    <span class=c># check the changes</span>
diff <span class=nt>--git</span> a/bin/ls/ls.c b/bin/ls/ls.c
index 7378268867ef..cfc3f4342531 100644
<span class=nt>---</span> a/bin/ls/ls.c
+++ b/bin/ls/ls.c
@@ <span class=nt>-66</span>,6 +66,7 @@ __FBSDID<span class=o>(</span><span class=s2>&#34;</span><span class=nv>$FreeBSD</span><span class=s2>$&#34;</span><span class=o>)</span><span class=p>;</span>
 <span class=c>#include &lt;stdlib.h&gt;</span>
 <span class=c>#include &lt;string.h&gt;</span>
 <span class=c>#include &lt;unistd.h&gt;</span>
+#undef COLORLS
 <span class=c>#ifdef COLORLS</span>
 <span class=c>#include &lt;termcap.h&gt;</span>
 <span class=c>#include &lt;signal.h&gt;</span>
% <span class=c># these look good, make the commit...</span>
% git commit ls.c</code></pre></div></div><div class=paragraph><p>The commit will pop you into an editor to describe what you’ve done.
Once you enter that, you have your own <strong>local</strong> branch in the Git repo.
Build and install it like you normally would, following the directions in the handbook.
Git differs from other version control systems in that you have to tell it explicitly which files to commit.
I have opted to do it on the commit command line, but you can also do it with <code>git add</code> which many of the more in depth tutorials cover.</p></div></div><div class=sect5><h6 id=_time_to_update>5.2.8.2.2. Time to update<a class=anchor href=#_time_to_update></a></h6><div class=paragraph><p>When it is time to bring in a new version, it is almost the same as w/o the branches.
You would update like you would above, but there is one extra command before you update, and one after.
The following assumes you are starting with an unmodified tree.
It is important to start rebasing operations with a clean tree (Git requires this).</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git checkout main
% git pull <span class=nt>--ff-only</span>
% git rebase <span class=nt>-i</span> main no-color-ls</code></pre></div></div><div class=paragraph><p>This will bring up an editor that lists all the commits in it.
For this example, do not change it at all.
This is typically what you are doing while updating the baseline (though you also use the Git rebase command to curate the commits you have in the branch).</p></div><div class=paragraph><p>Once you are done with the above, you have to move the commits to ls.c forward from the old version of FreeBSD to the newer one.</p></div><div class=paragraph><p>Sometimes there are merge conflicts.
That is OK.
Do not panic.
Instead, handle them the same as any other merge conflicts.
To keep it simple, I will just describe a common issue that may arise.
A pointer to a complete treatment can be found at the end of this section.</p></div><div class=paragraph><p>Let’s say the includes changes upstream in a radical shift to terminfo as well as a name change for the option.
When you updated, you might see something like this:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>Auto-merging bin/ls/ls.c
CONFLICT <span class=o>(</span>content<span class=o>)</span>: Merge conflict <span class=k>in </span>bin/ls/ls.c
error: could not apply 646e0f9cda11... no color <span class=nb>ls
</span>Resolve all conflicts manually, mark them as resolved with
<span class=s2>&#34;git add/rm &lt;conflicted_files&gt;&#34;</span>, <span class=k>then </span>run <span class=s2>&#34;git rebase --continue&#34;</span><span class=nb>.</span>
You can instead skip this commit: run <span class=s2>&#34;git rebase --skip&#34;</span><span class=nb>.</span>
To abort and get back to the state before <span class=s2>&#34;git rebase&#34;</span>, run <span class=s2>&#34;git rebase --abort&#34;</span><span class=nb>.</span>
Could not apply 646e0f9cda11... no color <span class=nb>ls</span></code></pre></div></div><div class=paragraph><p>which looks scary.
If you bring up an editor, you will see it is a typical 3-way merge conflict resolution that you may be familiar with from other source code systems (the rest of ls.c has been omitted):</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell> <span class=o>&lt;&lt;&lt;&lt;&lt;&lt;</span>&lt; HEAD
 <span class=c>#ifdef COLORLS_NEW</span>
 <span class=c>#include &lt;terminfo.h&gt;</span>
 <span class=o>=======</span>
 <span class=c>#undef COLORLS</span>
 <span class=c>#ifdef COLORLS</span>
 <span class=c>#include &lt;termcap.h&gt;</span>
 <span class=o>&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span> 646e0f9cda11... no color <span class=nb>ls</span>
....
The new code is first, and your code is second.
The right fix here is to just add a <span class=c>#undef COLORLS_NEW before #ifdef and then delete the old changes:</span>
<span class=o>[</span><span class=nb>source</span>,shell]
....
<span class=c>#undef COLORLS_NEW</span>
<span class=c>#ifdef COLORLS_NEW</span>
<span class=c>#include &lt;terminfo.h&gt;</span>
....
save the file.
The rebase was interrupted, so you have to <span class=nb>complete </span>it:
<span class=o>[</span><span class=nb>source</span>,shell]
....
% git add ls.c
% git rebase <span class=nt>--continue</span>
....</code></pre></div></div><div class=paragraph><p>which tells Git that ls.c has been fixed and to continue the rebase operation.
Since there was a conflict, you will get kicked into the editor to update the commit message if necessary.
If the commit message is still accurate, just exit the editor.</p></div><div class=paragraph><p>If you get stuck during the rebase, do not panic.
git rebase --abort will take you back to a clean slate.
It is important, though, to start with an unmodified tree.
An aside: The above mentioned <code>git reflog</code> comes in handy here, as it will have a list of all the (intermediate) commits that you can view or inspect or cherry-pick.</p></div><div class=paragraph><p>For more on this topic, <a href=https://www.freecodecamp.org/news/the-ultimate-guide-to-git-merge-and-git-rebase/ class=bare>https://www.freecodecamp.org/news/the-ultimate-guide-to-git-merge-and-git-rebase/</a> provides a rather extensive treatment.
It is a good resource for issues that arise occasionally but are too obscure for this guide.</p></div></div></div><div class=sect4><h5 id=_switching_to_a_different_freebsd_branch>5.2.8.3. Switching to a Different FreeBSD Branch<a class=anchor href=#_switching_to_a_different_freebsd_branch></a></h5><div class=paragraph><p>If you wish to shift from stable/12 to the current branch.
If you have a deep clone, the following will suffice:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git checkout main
% <span class=c># build and install here...</span></code></pre></div></div><div class=paragraph><p>If you have a local branch, though, there are one or two caveats.
First, rebase will rewrite history, so you will likely want to do something to save it.
Second, jumping branches tends to cause more conflicts.
If we pretend the example above was relative to stable/12, then to move to <code>main</code>, I’d suggest the following:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git checkout no-color-ls
% git checkout <span class=nt>-b</span> no-color-ls-stable-12   <span class=c># create another name for this branch</span>
% git rebase <span class=nt>-i</span> stable/12 no-color-ls <span class=nt>--onto</span> main</code></pre></div></div><div class=paragraph><p>What the above does is checkout no-color-ls.
Then create a new name for it (no-color-ls-stable-12) in case you need to get back to it.
Then you rebase onto the <code>main</code> branch.
This will find all the commits to the current no-color-ls branch (back to where it meets up with the stable/12 branch) and then it will
replay them onto the <code>main</code> branch creating a new no-color-ls branch there (which is why I had you create a place holder name).</p></div></div></div></div><div class=sect2><h3 id=mfc-with-git>5.3. MFC (Merge From Current) Procedures<a class=anchor href=#mfc-with-git></a></h3><div class=sect3><h4 id=_summary>5.3.1. Summary<a class=anchor href=#_summary></a></h4><div class=paragraph><p>MFC workflow can be summarized as <code>git cherry-pick -x</code> plus <code>git commit --amend</code> to adjust the commit message.
For multiple commits, use <code>git rebase -i</code> to squash them together and edit the commit message.</p></div></div><div class=sect3><h4 id=_single_commit_mfc>5.3.2. Single commit MFC<a class=anchor href=#_single_commit_mfc></a></h4><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git checkout stable/X
% git cherry-pick <span class=nt>-x</span> <span class=nv>$HASH</span> <span class=nt>--edit</span></code></pre></div></div><div class=paragraph><p>For MFC commits, for example a vendor import, you would need to specify one parent for cherry-pick purposes.
Normally, that would be the "first parent" of the branch you are cherry-picking from, so:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git checkout stable/X
% git cherry-pick <span class=nt>-x</span> <span class=nv>$HASH</span> <span class=nt>-m</span> 1 <span class=nt>--edit</span></code></pre></div></div><div class=paragraph><p>If things go wrong, you’ll either need to abort the cherry-pick with <code>git cherry-pick --abort</code> or fix it up and do a <code>git cherry-pick --continue</code>.</p></div><div class=paragraph><p>Once the cherry-pick is finished, push with <code>git push</code>.
If you get an error due to losing the commit race, use <code>git pull --rebase</code> and try to push again.</p></div></div><div class=sect3><h4 id=_mfc_to_releng_branch>5.3.3. MFC to RELENG branch<a class=anchor href=#_mfc_to_releng_branch></a></h4><div class=paragraph><p>MFCs to branches that require approval require a bit more care.
The process is the same for either a typical merge or an exceptional direct commit.</p></div><div class=ulist><ul><li><p>Merge or direct commit to the appropriate <code>stable/X</code> branch first before merging to the <code>releng/X.Y</code> branch.</p></li><li><p>Use the hash that’s in the <code>stable/X</code> branch for the MFC to <code>releng/X.Y</code> branch.</p></li><li><p>Leave both "cherry picked from" lines in the commit message.</p></li><li><p>Be sure to add the <code>Approved by:</code> line when you are in the editor.</p></li></ul></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git checkout releng/13.0
% git cherry-pick <span class=nt>-x</span> <span class=nv>$HASH</span> <span class=nt>--edit</span></code></pre></div></div><div class=paragraph><p>If you forget to to add the <code>Approved by:</code> line, you can do a <code>git commit --amend</code> to edit the commit message before you push the change.</p></div></div><div class=sect3><h4 id=_multiple_commit_mfc>5.3.4. Multiple commit MFC<a class=anchor href=#_multiple_commit_mfc></a></h4><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git checkout <span class=nt>-b</span> tmp-branch stable/X
% <span class=k>for </span>h <span class=k>in</span> <span class=nv>$HASH_LIST</span><span class=p>;</span> <span class=k>do </span>git cherry-pick <span class=nt>-x</span> <span class=nv>$h</span><span class=p>;</span> <span class=k>done</span>
% git rebase <span class=nt>-i</span> stable/X
<span class=c># mark each of the commits after the first as &#39;squash&#39;</span>
<span class=c># Update the commit message to reflect all elements of commit, if necessary.</span>
<span class=c># Be sure to retain the &#34;cherry picked from&#34; lines.</span>
% git push freebsd HEAD:stable/X</code></pre></div></div><div class=paragraph><p>If the push fails due to losing the commit race, rebase and try again:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git checkout stable/X
% git pull
% git checkout tmp-branch
% git rebase stable/X
% git push freebsd HEAD:stable/X</code></pre></div></div><div class=paragraph><p>Once the MFC is complete, you can delete the temporary branch:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git checkout stable/X
% git branch <span class=nt>-d</span> tmp-branch</code></pre></div></div></div><div class=sect3><h4 id=_mfc_a_vendor_import>5.3.5. MFC a vendor import<a class=anchor href=#_mfc_a_vendor_import></a></h4><div class=paragraph><p>Vendor imports are the only thing in the tree that creates a merge commit in the <code>main</code> branch.
Cherry picking merge commits into stable/XX presents an additional difficulty because there are two parents for a merge commit.
Generally, you’ll want the first parent’s diff since that’s the diff to <code>main</code> (though there may be some exceptions).</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git cherry-pick <span class=nt>-x</span> <span class=nt>-m</span> 1 <span class=nv>$HASH</span></code></pre></div></div><div class=paragraph><p>is typically what you want.
This will tell cherry-pick to apply the correct diff.</p></div><div class=paragraph><p>There are some, hopefully, rare cases where it’s possible that the <code>main</code> branch was merged backwards by the conversion script.
Should that be the case (and we’ve not found any yet), you’d change the above to <code>-m 2</code> to pickup the proper parent.
Just do:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git cherry-pick <span class=nt>--abort</span>
% git cherry-pick <span class=nt>-x</span> <span class=nt>-m</span> 2 <span class=nv>$HASH</span></code></pre></div></div><div class=paragraph><p>to do that. The <code>--abort</code> will cleanup the failed first attempt.</p></div></div><div class=sect3><h4 id=_redoing_a_mfc>5.3.6. Redoing a MFC<a class=anchor href=#_redoing_a_mfc></a></h4><div class=paragraph><p>If you do a MFC, and it goes horribly wrong and you want to start over,
then the easiest way is to use <code>git reset --hard</code> like so:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git reset <span class=nt>--hard</span> freebsd/stable/12</code></pre></div></div><div class=paragraph><p>though if you have some revs you want to keep, and others you don’t,
using <code>git rebase -i</code> is better.</p></div></div><div class=sect3><h4 id=_considerations_when_mfcing>5.3.7. Considerations when MFCing<a class=anchor href=#_considerations_when_mfcing></a></h4><div class=paragraph><p>When committing source commits to stable and releng branches, we have the following goals:</p></div><div class=ulist><ul><li><p>Clearly mark direct commits distinct from commits that land a change from another branch.</p></li><li><p>Avoid introducing known breakage into stable and releng branches.</p></li><li><p>Allow developers to determine which changes have or have not been landed from one branch to another.</p></li></ul></div><div class=paragraph><p>With Subversion, we used the following practices to achieve these goals:</p></div><div class=ulist><ul><li><p>Using <code>MFC</code> and <code>MFS</code> tags to mark commits that merged changes from another branch.</p></li><li><p>Squashing fixup commits into the main commit when merging a change.</p></li><li><p>Recording mergeinfo so that <code>svn mergeinfo --show-revs</code> worked.</p></li></ul></div><div class=paragraph><p>With Git, we will need to use different strategies to achieve the same goals.
This document aims to define best practices when merging source commits using Git that achieve these goals.
In general, we aim to use Git’s native support to achieve these goals rather than enforcing practices built on Subversion’s model.</p></div><div class=paragraph><p>One general note: due to technical differences with Git, we will not be using Git "merge commits" (created via <code>git merge</code>) in stable or releng branches.
Instead, when this document refers to "merge commits", it means a commit originally made to <code>main</code> that is replicated or "landed" to a stable branch, or a commit from a stable branch that is replicated to a releng branch with some variation of <code>git cherry-pick</code>.</p></div></div><div class=sect3><h4 id=_finding_eligible_hashes_to_mfc>5.3.8. Finding Eligible Hashes to MFC<a class=anchor href=#_finding_eligible_hashes_to_mfc></a></h4><div class=paragraph><p>Git provides some built-in support for this via the <code>git cherry</code> and <code>git log --cherry</code> commands.
These commands compare the raw diffs of commits (but not other metadata such as log messages) to determine if two commits are identical.
This works well when each commit from <code>main</code> is landed as a single commit to a stable branch, but it falls over if multiple commits from <code>main</code> are squashed together as a single commit to a stable branch.
The project makes extensive use of <code>git cherry-pick -x</code> with all lines preserved to work around these difficulties and is working on automated tooling to take advantage of this.</p></div></div><div class=sect3><h4 id=_commit_message_standards>5.3.9. Commit message standards<a class=anchor href=#_commit_message_standards></a></h4><div class=sect4><h5 id=_marking_mfcs>5.3.9.1. Marking MFCs<a class=anchor href=#_marking_mfcs></a></h5><div class=paragraph><p>The project has adopted the following practice for marking MFCs:</p></div><div class=ulist><ul><li><p>Use the <code>-x</code> flag with <code>git cherry-pick</code>. This adds a line to the commit message that includes the hash of the original commit when merging. Since it is added by Git directly, committers do not have to manually edit the commit log when merging.</p></li></ul></div><div class=paragraph><p>When merging multiple commits, keep all the "cherry picked from" lines.</p></div></div><div class=sect4><h5 id=_trim_metadata>5.3.9.2. Trim Metadata?<a class=anchor href=#_trim_metadata></a></h5><div class=paragraph><p>One area that was not clearly documented with Subversion (or even CVS) is how to format metadata in log messages for MFC commits.
Should it include the metadata from the original commit unchanged, or should it be altered to reflect information about the MFC commit itself?</p></div><div class=paragraph><p>Historical practice has varied, though some of the variance is by field.
For example, MFCs that are relevant to a PR generally include the PR field in the MFC so that MFC commits are included in the bug tracker’s audit trail.
Other fields are less clear.
For example, Phabricator shows the diff of the last commit tagged to a review, so including Phabricator URLs replaces the main commit with the landed commits.
The list of reviewers is also not clear.
If a reviewer has approved a change to <code>main</code>, does that mean they have approved the MFC commit? Is that true if it’s identical code only, or with merely trivial rework? It’s clearly not true for more extensive reworks.
Even for identical code what if the commit doesn’t conflict but introduces an ABI change? A reviewer may have ok’d a commit for <code>main</code> due to the ABI breakage but may not approve of merging the same commit as-is.
One will have to use one’s best judgment until clear guidelines can be agreed upon.</p></div><div class=paragraph><p>For MFCs regulated by re@, new metadata fields are added, such as the Approved by tag for approved commits.
This new metadata will have to be added via <code>git commit --amend</code> or similar after the original commit has been reviewed and approved.
We may also want to reserve some metadata fields in MFC commits such as Phabricator URLs for use by re@ in the future.</p></div><div class=paragraph><p>Preserving existing metadata provides a very simple workflow.
Developers use <code>git cherry-pick -x</code> without having to edit the log message.</p></div><div class=paragraph><p>If instead we choose to adjust metadata in MFCs, developers will have to edit log messages explicitly via the use of <code>git cherry-pick --edit</code> or <code>git commit --amend</code>.
However, as compared to svn, at least the existing commit message can be pre-populated and metadata fields can be added or removed without having to re-enter the entire commit message.</p></div><div class=paragraph><p>The bottom line is that developers will likely need to curate their commit message for MFCs that are non-trivial.</p></div></div></div></div><div class=sect2><h3 id=vendor-import-git>5.4. Vendor Imports with Git<a class=anchor href=#vendor-import-git></a></h3><div class=paragraph><p>This section describes the vendor import procedure with Git in detail.</p></div><div class=sect3><h4 id=_branch_naming_convention>5.4.1. Branch naming convention<a class=anchor href=#_branch_naming_convention></a></h4><div class=paragraph><p>All vendor branches and tags start with <code>vendor/</code>. These branches and tags are visible by default.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>This chapter follows the convention that the <code>freebsd</code> origin is the origin name for the official FreeBSD Git repository.
If you use a different convention, replace <code>freebsd</code> with the name you use instead in the examples below.</p></div></td></tr></tbody></table></div><div class=paragraph><p>We will explore an example for updating NetBSD’s mtree that is in our tree.
The vendor branch for this is <code>vendor/NetBSD/mtree</code>.</p></div></div><div class=sect3><h4 id=_updating_an_old_vendor_import>5.4.2. Updating an old vendor import<a class=anchor href=#_updating_an_old_vendor_import></a></h4><div class=paragraph><p>The vendor trees usually have only the subset of the third-party software that is appropriate to FreeBSD.
These trees are usually tiny in comparison to the FreeBSD tree.
Git worktrees are thus quite small and fast and the preferred method to use.
Make sure that whatever directory you choose below (the <code>../mtree</code>) does not currently exist.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git worktree add ../mtree vendor/NetBSD/mtree</code></pre></div></div></div><div class=sect3><h4 id=_update_the_sources_in_the_vendor_branch>5.4.3. Update the Sources in the Vendor Branch<a class=anchor href=#_update_the_sources_in_the_vendor_branch></a></h4><div class=paragraph><p>Prepare a full, clean tree of the vendor sources. Import everything but merge only what is needed.</p></div><div class=paragraph><p>This example assumes the NetBSD source is checked out from their GitHub mirror in <code>~/git/NetBSD</code>.
Note that "upstream" might have added or removed files, so we want to make sure deletions are propagated as well.
<a class=package href=https://cgit.freebsd.org/ports/tree/net/rsync/>net/rsync</a> is commonly installed, so I’ll use that.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% <span class=nb>cd</span> ../mtree
% rsync <span class=nt>-va</span> <span class=nt>--del</span> <span class=nt>--exclude</span><span class=o>=</span><span class=s2>&#34;.git&#34;</span> ~/git/NetBSD/usr.sbin/mtree/ <span class=nb>.</span>
% git add <span class=nt>-A</span>
% git status
...
% git diff <span class=nt>--staged</span>
...
% git commit <span class=nt>-m</span> <span class=s2>&#34;Vendor import of NetBSD&#39;s mtree at 2020-12-11&#34;</span>
<span class=o>[</span>vendor/NetBSD/mtree 8e7aa25fcf1] Vendor import of NetBSD<span class=s1>&#39;s mtree at 2020-12-11
 7 files changed, 114 insertions(+), 82 deletions(-)
% git tag -a vendor/NetBSD/mtree/20201211</span></code></pre></div></div><div class=paragraph><p>It is critical to verify that the source code you are importing comes from a
trustworthy source. Many open-source projects use cryptographic signatures to
sign code changes, git tags, and/or source code tarballs. Always verify these
signatures, and use isolation mechanisms like jails, chroot, in combination with
a dedicated, non-privileged user account that is different from the one you
regularly use (see the Updating the FreeBSD source tree section below for
more details), until you are confident that the source code you are importing
looks safe. Following the upstream development and occasionally reviewing the
upstream code changes can greatly help in improving code quality and benefit
everyone involved. It is also a good idea to examine the git diff results
before importing them into the vendor area.</p></div><div class=paragraph><p>Always run the <code>git diff</code> and <code>git status</code> commands and examine the results
carefully. When in doubt, it is useful to do a <code>git annotate</code> on the vendor
branch or the upstream git repository to see who and why a change was made.</p></div><div class=paragraph><p>In the example above we used <code>-m</code> to illustrate, but you should compose a
proper message in an editor (using a commit message template).</p></div><div class=paragraph><p>It is also important to create an annotated tag using <code>git tag -a</code>, otherwise the push will be rejected.
Only annotated tags are allowed to be pushed.
The annotated tag gives you a chance to enter a commit message.
Enter the version you are importing, along with any salient new features or fixes in that version.</p></div></div><div class=sect3><h4 id=_updating_the_freebsd_copy>5.4.4. Updating the FreeBSD Copy<a class=anchor href=#_updating_the_freebsd_copy></a></h4><div class=paragraph><p>At this point you can push the import to <code>vendor</code> into our repo.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git push <span class=nt>--follow-tags</span> freebsd vendor/NetBSD/mtree</code></pre></div></div><div class=paragraph><p><code>--follow-tags</code> tells <code>git push</code> to also push tags associated with the locally committed revision.</p></div></div><div class=sect3><h4 id=_updating_the_freebsd_source_tree>5.4.5. Updating the FreeBSD source tree<a class=anchor href=#_updating_the_freebsd_source_tree></a></h4><div class=paragraph><p>Now you need to update the mtree in FreeBSD.
The sources live in <code>contrib/mtree</code> since it is upstream software.</p></div><div class=paragraph><p>From time to time, we may have to make changes to the contributed code to
better satisfy FreeBSD’s needs. Whenever possible, please try to contribute
the local changes back to the upstream projects, this helps them to better
support FreeBSD, and also saves your time for future conflict resolutions
when importing updates.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% <span class=nb>cd</span> ../src
% git subtree merge <span class=nt>-P</span> contrib/mtree vendor/NetBSD/mtree</code></pre></div></div><div class=paragraph><p>This would generate a subtree merge commit of <code>contrib/mtree</code> against the local <code>vendor/NetBSD/mtree</code> branch.
Examine the diff from the merge result and the contents of the
upstream branch. If the merge reduced our local changes to more
trivial difference like blank line or indenting changes, try amending
the local changes to reduce diff against upstream, or try to
contribute the remaining changes back to the upstream project.
If there were conflicts, you would need to fix them before committing.
Include details about the changes being merged in the merge commit message.</p></div><div class=paragraph><p>Some open-source software includes a <code>configure</code> script that generates files
used to define how the code is built; usually, these generated files like
<code>config.h</code> should be updated as part of the import process. When doing
this, always keep in mind that these scripts are executable code running
under the current user’s credentials. This process should always be run
in an isolated environment, ideally inside a jail that does not have
network access, and with an unprivileged account; or, at minimum, a
dedicated account that is different from the user account you normally
use for everyday purposes or for pushing to the FreeBSD source
code repository. This minimizes the risk of encountering bugs that can
cause data loss or, in worse cases, maliciously planted code. Using an
isolated jail also prevents the configure scripts from detecting locally
installed software packages, which may lead to unexpected results.</p></div><div class=paragraph><p>When testing your changes, run them in a chroot or jailed environment,
or even within a virtual machine first, especially for kernel or library
modifications. This approach helps prevent adverse interactions with
your working environment. It can be particularly beneficial for
changes to libraries that many base system components use,
among others.</p></div></div><div class=sect3><h4 id=_rebasing_your_change_against_latest_freebsd_source_tree>5.4.6. Rebasing your change against latest FreeBSD source tree<a class=anchor href=#_rebasing_your_change_against_latest_freebsd_source_tree></a></h4><div class=paragraph><p>Because the current policy recommends against using merges, if the upstream FreeBSD <code>main</code> moved forward before you get a chance to push, you would have to redo the merge.</p></div><div class=paragraph><p>Regular <code>git rebase</code> or <code>git pull --rebase</code> doesn’t know how to rebase a merge commit <strong>as a merge commit</strong>,
so instead of that you would have to recreate the commit.</p></div><div class=paragraph><p>The following steps should be taken to easily recreate the merge commit as if <code>git rebase --merge-commits</code> worked properly:</p></div><div class=ulist><ul><li><p>cd to the top of the repo</p></li><li><p>Create a side branch <code>XXX</code> with the <strong>contents</strong> of the merged tree.</p></li><li><p>Update this side branch <code>XXX</code> to be merged and up-to-date with FreeBSD’s <code>main</code> branch.</p><div class=ulist><ul><li><p>In the worst case scenario, you would still have to resolve merge conflicts, if there was any, but this should be really rare.</p></li><li><p>Resolve conflicts, and collapse multiple commits down to 1 if need be (without conflicts, there’s no collapse needed)</p></li></ul></div></li><li><p>checkout <code>main</code></p></li><li><p>create a branch <code>YYY</code> (allows for easier unwinding if things go wrong)</p></li><li><p>Re-do the subtree merge</p></li><li><p>Instead of resolving any conflicts from the subtree merge, checkout the contents of XXX on top of it.</p><div class=ulist><ul><li><p>The trailing <code>.</code> is important, as is being at the top level of the repo.</p></li><li><p>Rather than switching branches to XXX, it splats the contents of XXX on top of the repo</p></li></ul></div></li><li><p>Commit the results with the prior commit message (the example assumes there’s only one merge on the XXX branch).</p></li><li><p>Make sure the branches are the same.</p></li><li><p>Do whatever review you need, including having others check it out if you think that’s needed.</p></li><li><p>Push the commit, if you 'lost the race' again, just redo these steps again (see below for a recipe)</p></li><li><p>Delete the branches once the commit is upstream. They are throw-a-way.</p></li></ul></div><div class=paragraph><p>The commands one would use, following the above example of mtree, would be like so (the <code>#</code> starts a comment to help link commands to descriptions above):</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% <span class=nb>cd</span> ../src			<span class=c># CD to top of tree</span>
% git checkout <span class=nt>-b</span> XXX		<span class=c># create new throw-away XXX branch for merge</span>
% git fetch freebsd		<span class=c># Get changes from upstream from upstream</span>
% git merge freebsd/main	<span class=c># Merge the changes and resolve conflicts</span>
% git checkout <span class=nt>-b</span> YYY freebsd/main <span class=c># Create new throw-away YYY branch for redo</span>
% git subtree merge <span class=nt>-P</span> contrib/mtree vendor/NetBSD/mtree <span class=c># Redo subtree merge</span>
% git checkout XXX <span class=nb>.</span>		<span class=c># XXX branch has the conflict resolution</span>
% git commit <span class=nt>-c</span> XXX~1		<span class=c># -c reuses the commit message from commit before rebase</span>
% git diff XXX YYY		<span class=c># Should be empty</span>
% git show YYY			<span class=c># Should only have changes you want, and be a merge commit from vendor branch</span></code></pre></div></div><div class=paragraph><p>Note: if things go wrong with the commit, you can reset the <code>YYY</code> branch by reissuing the checkout command that created it with -B to start over:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git checkout <span class=nt>-B</span> YYY freebsd/main <span class=c># Create new throw-away YYY branch if starting over is just going to be easier</span></code></pre></div></div></div><div class=sect3><h4 id=_pushing_the_changes>5.4.7. Pushing the changes<a class=anchor href=#_pushing_the_changes></a></h4><div class=paragraph><p>Once you think you have a set of changes that are good, you can push it to a fork off GitHub or GitLab for others to review.
One nice thing about Git is that it allows you to publish rough drafts of your work for others to review.
While Phabricator is good for content review, publishing the updated vendor branch and merge commits lets others check the details as they will eventually appear in the repository.</p></div><div class=paragraph><p>After review, when you are sure it is a good change, you can push it to the FreeBSD repo:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git push freebsd YYY:main	<span class=c># put the commit on upstream&#39;s &#39;main&#39; branch</span>
% git branch <span class=nt>-D</span> XXX		<span class=c># Throw away the throw-a-way branches.</span>
% git branch <span class=nt>-D</span> YYY</code></pre></div></div><div class=paragraph><p>Note: I used <code>XXX</code> and <code>YYY</code> to make it obvious they are terrible names and should not leave your machine.
If you use such names for other work, then you’ll need to pick different names, or risk losing the other work.
There is nothing magic about these names.
Upstream will not allow you to push them, but never the less, please pay attention to the exact commands above.
Some commands use syntax that differs only slightly from typical uses and that different behavior is critical to this recipe working.</p></div></div><div class=sect3><h4 id=_how_to_redo_things_if_need_be>5.4.8. How to redo things if need be<a class=anchor href=#_how_to_redo_things_if_need_be></a></h4><div class=paragraph><p>If you’ve tried to do the push in the previous section and it fails, then you should do the following to 'redo' things.
This sequence keeps the commit with the commit message always at XXX~1 to make committing easier.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git checkout <span class=nt>-B</span> XXX YYY	<span class=c># recreate that throw-away-branch XXX and switch to it</span>
% git merge freebsd/main	<span class=c># Merge the changes and resolve conflicts</span>
% git checkout <span class=nt>-B</span> YYY freebsd/main <span class=c># Recreate new throw-away YYY branch for redo</span>
% git subtree merge <span class=nt>-P</span> contrib/mtree vendor/NetBSD/mtree <span class=c># Redo subtree merge</span>
% git checkout XXX <span class=nb>.</span>		<span class=c># XXX branch has the conflict resolution</span>
% git commit <span class=nt>-c</span> XXX~1		<span class=c># -c reuses the commit message from commit before rebase</span></code></pre></div></div><div class=paragraph><p>Then go check it out as above and push as above when ready.</p></div></div></div><div class=sect2><h3 id=_creating_a_new_vendor_branch>5.5. Creating a new vendor branch<a class=anchor href=#_creating_a_new_vendor_branch></a></h3><div class=paragraph><p>There are a number of ways to create a new vendor branch.
The recommended way is to create a new repository and then merge that with FreeBSD.
If one is importing <code>glorbnitz</code> into the FreeBSD tree, release 3.1415.
For the sake of simplicity, we will not trim this release.
It is a simple user command that puts the nitz device into different magical glorb states and is small enough trimming will not save much.</p></div><div class=sect3><h4 id=_create_the_repo>5.5.1. Create the repo<a class=anchor href=#_create_the_repo></a></h4><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% <span class=nb>cd</span> /some/where
% <span class=nb>mkdir </span>glorbnitz
% <span class=nb>cd </span>glorbnitz
% git init
% git checkout <span class=nt>-b</span> vendor/glorbnitz</code></pre></div></div><div class=paragraph><p>At this point, you have a new repo, where all new commits will go on the <code>vendor/glorbnitz</code> branch.</p></div><div class=paragraph><p>Git experts can also do this right in their FreeBSD clone, using <code>git checkout --orphan vendor/glorbnitz</code> if they are more comfortable with that.</p></div></div><div class=sect3><h4 id=_copy_the_sources_in>5.5.2. Copy the sources in<a class=anchor href=#_copy_the_sources_in></a></h4><div class=paragraph><p>Since this is a new import, you can just cp the sources in, or use tar or even rsync as shown above.
And we will add everything, assuming no dot files.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% <span class=nb>cp</span> <span class=nt>-r</span> ~/glorbnitz/<span class=k>*</span> <span class=nb>.</span>
% git add <span class=k>*</span></code></pre></div></div><div class=paragraph><p>At this point, you should have a pristine copy of glorbnitz ready to commit.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git commit <span class=nt>-m</span> <span class=s2>&#34;Import GlorbNitz frobnosticator revision 3.1415&#34;</span></code></pre></div></div><div class=paragraph><p>As above, I used <code>-m</code> for simplicity, but you should likely create a commit message that explains what a Glorb is and why you’d use a Nitz to get it.
Not everybody will know so, for your actual commit, you should follow the
<a href=../committers-guide/#commit-log-message>commit log message</a> section instead of emulating the brief style used here.</p></div></div><div class=sect3><h4 id=_now_import_it_into_our_repository>5.5.3. Now import it into our repository<a class=anchor href=#_now_import_it_into_our_repository></a></h4><div class=paragraph><p>Now you need to import the branch into our repository.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% <span class=nb>cd</span> /path/to/freebsd/repo/src
% git remote add glorbnitz /some/where/glorbnitz
% git fetch glorbnitz vendor/glorbnitz</code></pre></div></div><div class=paragraph><p>Note the vendor/glorbnitz branch is in the repo. At this point the <code>/some/where/glorbnitz</code> can be deleted, if you like.
It was only a means to an end.</p></div></div><div class=sect3><h4 id=_tag_and_push>5.5.4. Tag and push<a class=anchor href=#_tag_and_push></a></h4><div class=paragraph><p>Steps from here on out are much the same as they are in the case of updating a vendor branch, though without the updating the vendor branch step.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git worktree add ../glorbnitz vendor/glorbnitz
% <span class=nb>cd</span> ../glorbnitz
% git tag <span class=nt>--annotate</span> vendor/glorbnitz/3.1415
<span class=c># Make sure the commit is good with &#34;git show&#34;</span>
% git push <span class=nt>--follow-tags</span> freebsd vendor/glorbnitz</code></pre></div></div><div class=paragraph><p>By 'good' we mean:</p></div><div class="olist arabic"><ol class=arabic><li><p>All the right files are present</p></li><li><p>None of the wrong files are present</p></li><li><p>The vendor branch points at something sensible</p></li><li><p>The tag looks good, and is annotated</p></li><li><p>The commit message for the tag has a quick summary of what’s new since the last tag</p></li></ol></div></div><div class=sect3><h4 id=_time_to_finally_merge_it_into_the_base_tree>5.5.5. Time to finally merge it into the base tree<a class=anchor href=#_time_to_finally_merge_it_into_the_base_tree></a></h4><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% <span class=nb>cd</span> ../src
% git subtree add <span class=nt>-P</span> contrib/glorbnitz vendor/glorbnitz
<span class=c># Make sure the commit is good with &#34;git show&#34;</span>
% git commit <span class=nt>--amend</span>   <span class=c># one last sanity check on commit message</span>
% git push freebsd</code></pre></div></div><div class=paragraph><p>Here 'good' means:</p></div><div class="olist arabic"><ol class=arabic><li><p>All the right files, and none of the wrong ones, were merged into contrib/glorbnitz.</p></li><li><p>No other changes are in the tree.</p></li><li><p>The commit messages look <a href=../committers-guide/#commit-log-message>good</a>. It should contain a summary of what’s changed since the last merge to the FreeBSD <code>main</code> branch and any caveats.</p></li><li><p>UPDATING should be updated if there is anything of note, such as user visible changes, important upgrade concerns, etc.</p></li></ol></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>This hasn’t connected <code>glorbnitz</code> to the build yet.
How so do that is specific to the software being imported and is beyond the scope of this tutorial.</p></div></td></tr></tbody></table></div><div class=sect4><h5 id=_keeping_current>5.5.5.1. Keeping current<a class=anchor href=#_keeping_current></a></h5><div class=paragraph><p>So, time passes.
It’s time now to update the tree for the latest changes upstream.
When you checkout <code>main</code> make sure that you have no diffs.
It’s a lot easier to commit those to a branch (or use <code>git stash</code>) before doing the following.</p></div><div class=paragraph><p>If you are used to <code>git pull</code>, we strongly recommend using the <code>--ff-only</code> option, and further setting it as the default option.
Alternatively, <code>git pull --rebase</code> is useful if you have changes staged in the <code>main</code> branch.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git config <span class=nt>--global</span> pull.ff only</code></pre></div></div><div class=paragraph><p>You may need to omit the --global if you want this setting to apply to only this repository.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% <span class=nb>cd </span>freebsd-src
% git checkout main
% git pull <span class=o>(</span><span class=nt>--ff-only</span>|--rebase<span class=o>)</span></code></pre></div></div><div class=paragraph><p>There is a common trap, that the combination command <code>git pull</code> will try to perform a merge, which would sometimes creates a merge commit that didn’t exist before.
This can be harder to recover from.</p></div><div class=paragraph><p>The longer form is also recommended.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% <span class=nb>cd </span>freebsd-src
% git checkout main
% git fetch freebsd
% git merge <span class=nt>--ff-only</span> freebsd/main</code></pre></div></div><div class=paragraph><p>These commands reset your tree to the <code>main</code> branch, and then update it from where you pulled the tree from originally.
It’s important to switch to <code>main</code> before doing this so it moves forward.
Now, it’s time to move the changes forward:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git rebase <span class=nt>-i</span> main working</code></pre></div></div><div class=paragraph><p>This will bring up an interactive screen to change the defaults.
For now, just exit the editor.
Everything should just apply.
If not, then you’ll need to resolve the diffs.
<a href=https://docs.github.com/en/free-pro-team@latest/github/using-git/resolving-merge-conflicts-after-a-git-rebase>This github document</a> can help you navigate this process.</p></div></div><div class=sect4><h5 id=git-push-upstream>5.5.5.2. Time to push changes upstream<a class=anchor href=#git-push-upstream></a></h5><div class=paragraph><p>First, ensure that the push URL is properly configured for the upstream repository.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git remote set-url <span class=nt>--push</span> freebsd ssh://git@gitrepo.freebsd.org/src.git</code></pre></div></div><div class=paragraph><p>Then, verify that user name and email are configured right.
We require that they exactly match the passwd entry in FreeBSD cluster.</p></div><div class=paragraph><p>Use</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>freefall% gen-gitconfig.sh</code></pre></div></div><div class=paragraph><p>on freefall.freebsd.org to get a recipe that you can use directly, assuming /usr/local/bin is in the PATH.</p></div><div class=paragraph><p>The below command merges the <code>working</code> branch into the upstream <code>main</code> branch.
It’s important that you curate your changes to be just like you want them in the FreeBSD source repo before doing this.
This syntax pushes the <code>working</code> branch to <code>main</code>, moving the <code>main</code> branch forward.
You will only be able to do this if this results in a linear change to <code>main</code> (e.g. no merges).</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git push freebsd working:main</code></pre></div></div><div class=paragraph><p>If your push is rejected due to losing a commit race, rebase your branch before trying again:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git checkout working
% git fetch freebsd
% git rebase freebsd/main
% git push freebsd working:main</code></pre></div></div></div><div class=sect4><h5 id=git-push-upstream-alt>5.5.5.3. Time to push changes upstream (alternative)<a class=anchor href=#git-push-upstream-alt></a></h5><div class=paragraph><p>Some people find it easier to merge their changes to their local <code>main</code> before pushing to the remote repository.
Also, <code>git arc stage</code> moves changes from a branch to the local <code>main</code> when you need to do a subset of a branch.
The instructions are similar to the prior section:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git checkout main
% git merge <span class=nt>--ff-only</span> <span class=sb>`</span>working<span class=sb>`</span>
% git push freebsd</code></pre></div></div><div class=paragraph><p>If you lose the race, then try again with</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git pull <span class=nt>--rebase</span>
% git push freebsd</code></pre></div></div><div class=paragraph><p>These commands will fetch the most recent <code>freebsd/main</code> and then rebase the local <code>main</code> changes on top of that, which is what you want when you lose the commit race.
Note: merging vendor branch commits will not work with this technique.</p></div></div><div class=sect4><h5 id=_finding_the_subversion_revision>5.5.5.4. Finding the Subversion Revision<a class=anchor href=#_finding_the_subversion_revision></a></h5><div class=paragraph><p>You’ll need to make sure that you’ve fetched the notes (see the <a href=../committers-guide/#git-mini-daily-use>Daily use</a>for details).
Once you have these, notes will show up in the git log command like so:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git log</code></pre></div></div><div class=paragraph><p>If you have a specific version in mind, you can use this construct:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git log <span class=nt>--grep</span> <span class=nv>revision</span><span class=o>=</span>XXXX</code></pre></div></div><div class=paragraph><p>to find the specific revision.
The hex number after 'commit' is the hash you can use to refer to this commit.</p></div></div></div></div><div class=sect2><h3 id=git-faq>5.6. Git FAQ<a class=anchor href=#git-faq></a></h3><div class=paragraph><p>This section provides a number of targeted answers to questions that are likely to come up often for users and developers.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>We use the common convention of having the origin for the FreeBSD repository being 'freebsd' rather than the default 'origin' to allow
people to use that for their own development and to minimize "whoops" pushes to the wrong repository.</p></div></td></tr></tbody></table></div><div class=sect3><h4 id=_users>5.6.1. Users<a class=anchor href=#_users></a></h4><div class=sect4><h5 id=_how_do_i_track_current_and_stable_with_only_one_copy_of_the_repository>5.6.1.1. How do I track -current and -stable with only one copy of the repository?<a class=anchor href=#_how_do_i_track_current_and_stable_with_only_one_copy_of_the_repository></a></h5><div class=paragraph><p><strong>Q:</strong> Although disk space is not a huge issue, it’s more efficient to use only one copy of the repository.
With SVN mirroring, I could checkout multiple trees from the same repository.
How do I do this with Git?</p></div><div class=paragraph><p><strong>A:</strong> You can use Git worktrees.
There’s a number of ways to do this, but the simplest way is to use a clone to track -current, and a worktree to track stable releases.
While using a 'bare repository' has been put forward as a way to cope, it’s more complicated and will not be documented here.</p></div><div class=paragraph><p>First, you need to clone the FreeBSD repository, shown here cloning into <code>freebsd-current</code> to reduce confusion.
$URL is whatever mirror works best for you:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git clone <span class=nt>-o</span> freebsd <span class=nt>--config</span> remote.freebsd.fetch<span class=o>=</span><span class=s1>&#39;+refs/notes/*:refs/notes/*&#39;</span> <span class=nv>$URL</span> freebsd-current</code></pre></div></div><div class=paragraph><p>then once that’s cloned, you can simply create a worktree from it:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% <span class=nb>cd </span>freebsd-current
% git worktree add ../freebsd-stable-12 stable/12</code></pre></div></div><div class=paragraph><p>this will checkout <code>stable/12</code> into a directory named <code>freebsd-stable-12</code> that’s a peer to the <code>freebsd-current</code> directory.
Once created, it’s updated very similarly to how you might expect:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% <span class=nb>cd </span>freebsd-current
% git checkout main
% git pull <span class=nt>--ff-only</span>
<span class=c># changes from upstream now local and current tree updated</span>
% <span class=nb>cd</span> ../freebsd-stable-12
% git merge <span class=nt>--ff-only</span> freebsd/stable/12
<span class=c># now your stable/12 is up to date too</span></code></pre></div></div><div class=paragraph><p>I recommend using <code>--ff-only</code> because it’s safer and you avoid accidentally getting into a 'merge nightmare' where you have an extra change in your tree, forcing a complicated merge rather than a simple one.</p></div><div class=paragraph><p>Here’s <a href=https://adventurist.me/posts/00296>a good writeup</a> that goes into more detail.</p></div></div></div><div class=sect3><h4 id=_developers>5.6.2. Developers<a class=anchor href=#_developers></a></h4><div class=sect4><h5 id=_ooops_i_committed_to_main_instead_of_another_branch>5.6.2.1. Ooops! I committed to <code>main</code>, instead of another branch.<a class=anchor href=#_ooops_i_committed_to_main_instead_of_another_branch></a></h5><div class=paragraph><p><strong>Q:</strong> From time to time, I goof up and mistakenly commit to the <code>main</code> branch. What do I do?</p></div><div class=paragraph><p><strong>A:</strong> First, don’t panic.</p></div><div class=paragraph><p>Second, don’t push.
In fact, you can fix almost anything if you haven’t pushed.
All the answers in this section assume no push has happened.</p></div><div class=paragraph><p>The following answer assumes you committed to <code>main</code> and want to create a branch called <code>issue</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git branch issue                <span class=c># Create the &#39;issue&#39; branch</span>
% git reset <span class=nt>--hard</span> freebsd/main   <span class=c># Reset &#39;main&#39; back to the official tip</span>
% git checkout issue              <span class=c># Back to where you were</span></code></pre></div></div></div><div class=sect4><h5 id=_ooops_i_committed_something_to_the_wrong_branch>5.6.2.2. Ooops! I committed something to the wrong branch!<a class=anchor href=#_ooops_i_committed_something_to_the_wrong_branch></a></h5><div class=paragraph><p><strong>Q:</strong> I was working on feature on the <code>wilma</code> branch, but accidentally committed a change relevant to the <code>fred</code> branch in 'wilma'.
What do I do?</p></div><div class=paragraph><p><strong>A:</strong> The answer is similar to the previous one, but with cherry picking.
This assumes there’s only one commit on wilma, but will generalize to more complicated situations.
It also assumes that it’s the last commit on wilma (hence using wilma in the <code>git cherry-pick</code> command), but that too can be generalized.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># We&#39;re on branch wilma</span>
% git checkout fred		<span class=c># move to fred branch</span>
% git cherry-pick wilma		<span class=c># copy the misplaced commit</span>
% git checkout wilma		<span class=c># go back to wilma branch</span>
% git reset <span class=nt>--hard</span> HEAD^	<span class=c># move what wilma refers to back 1 commit</span></code></pre></div></div><div class=paragraph><p>Git experts would first rewind the wilma branch by 1 commit, switch over to fred and then use <code>git reflog</code> to see what that 1 deleted commit was and
cherry-pick it over.</p></div><div class=paragraph><p><strong>Q:</strong> But what if I want to commit a few changes to <code>main</code>, but keep the rest in <code>wilma</code> for some reason?</p></div><div class=paragraph><p><strong>A:</strong> The same technique above also works if you are wanting to 'land' parts of the branch you are working on into <code>main</code> before the rest of the branch is ready (say you noticed an unrelated typo, or fixed an incidental bug).
You can cherry pick those changes into <code>main</code>, then push to the parent repository.
Once you’ve done that, cleanup couldn’t be simpler: just <code>git rebase -i</code>.
Git will notice you’ve done this and skip the common changes automatically (even if you had to change the commit message or tweak the commit slightly).
There’s no need to switch back to wilma to adjust it: just rebase!</p></div><div class=paragraph><p><strong>Q:</strong> I want to split off some changes from branch <code>wilma</code> into branch <code>fred</code></p></div><div class=paragraph><p><strong>A:</strong> The more general answer would be the same as the previous.
You’d checkout/create the <code>fred</code> branch, cherry pick the changes you want from <code>wilma</code> one at a time, then rebase <code>wilma</code> to remove those changes you cherry picked.
<code>git rebase -i main wilma</code> will toss you into an editor, and remove the <code>pick</code> lines that correspond to the commits you copied to <code>fred</code>.
If all goes well, and there are no conflicts, you’re done.
If not, you’ll need to resolve the conflicts as you go.</p></div><div class=paragraph><p>The other way to do this would be to checkout <code>wilma</code> and then create the branch <code>fred</code> to point to the same point in the tree.
You can then <code>git rebase -i</code> both these branches, selecting the changes you want in <code>fred</code> or <code>wilma</code> by retaining the pick likes, and deleting the rest from the editor.
Some people would create a tag/branch called <code>pre-split</code> before starting in case something goes wrong in the split.
You can undo it with the following sequence:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git checkout pre-split	<span class=c># Go back</span>
% git branch <span class=nt>-D</span> fred		<span class=c># delete the fred branch</span>
% git checkout <span class=nt>-B</span> wilma		<span class=c># reset the wilma branch</span>
% git branch <span class=nt>-d</span> pre-split	<span class=c># Pretend it didn&#39;t happen</span></code></pre></div></div><div class=paragraph><p>The last step is optional.
If you are going to try again to split, you’d omit it.</p></div><div class=paragraph><p><strong>Q:</strong> But I did things as I read along and didn’t see your advice at the end to create a branch, and now <code>fred</code> and <code>wilma</code> are all screwed up.
How do I find what <code>wilma</code> was before I started.
I don’t know how many times I moved things around.</p></div><div class=paragraph><p><strong>A:</strong> All is not lost. You can figure out it, so long as it hasn’t been too long, or too many commits (hundreds).</p></div><div class=paragraph><p>So I created a wilma branch and committed a couple of things to it, then decided I wanted to split it into fred and wilma.
Nothing weird happened when I did that, but let’s say it did.
The way to look at what you’ve done is with the <code>git reflog</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git reflog
6ff9c25 <span class=o>(</span>HEAD -&gt; wilma<span class=o>)</span> HEAD@<span class=o>{</span>0<span class=o>}</span>: rebase <span class=nt>-i</span> <span class=o>(</span>finish<span class=o>)</span>: returning to refs/heads/wilma
6ff9c25 <span class=o>(</span>HEAD -&gt; wilma<span class=o>)</span> HEAD@<span class=o>{</span>1<span class=o>}</span>: rebase <span class=nt>-i</span> <span class=o>(</span>start<span class=o>)</span>: checkout main
869cbd3 HEAD@<span class=o>{</span>2<span class=o>}</span>: rebase <span class=nt>-i</span> <span class=o>(</span>start<span class=o>)</span>: checkout wilma
a6a5094 <span class=o>(</span>fred<span class=o>)</span> HEAD@<span class=o>{</span>3<span class=o>}</span>: rebase <span class=nt>-i</span> <span class=o>(</span>finish<span class=o>)</span>: returning to refs/heads/fred
a6a5094 <span class=o>(</span>fred<span class=o>)</span> HEAD@<span class=o>{</span>4<span class=o>}</span>: rebase <span class=nt>-i</span> <span class=o>(</span>pick<span class=o>)</span>: Encourage contributions
1ccd109 <span class=o>(</span>freebsd/main, main<span class=o>)</span> HEAD@<span class=o>{</span>5<span class=o>}</span>: rebase <span class=nt>-i</span> <span class=o>(</span>start<span class=o>)</span>: checkout main
869cbd3 HEAD@<span class=o>{</span>6<span class=o>}</span>: rebase <span class=nt>-i</span> <span class=o>(</span>start<span class=o>)</span>: checkout fred
869cbd3 HEAD@<span class=o>{</span>7<span class=o>}</span>: checkout: moving from wilma to fred
869cbd3 HEAD@<span class=o>{</span>8<span class=o>}</span>: commit: Encourage contributions
...
%</code></pre></div></div><div class=paragraph><p>Here we see the changes I’ve made.
You can use it to figure out where things went wrong.
I’ll just point out a few things here.
The first one is that HEAD@{X} is a 'commitish' thing, so you can use that as an argument to a command.
Although if that command commits anything to the repository, the X numbers change.
You can also use the hash (first column).</p></div><div class=paragraph><p>Next, 'Encourage contributions' was the last commit I made to <code>wilma</code> before I decided to split things up.
You can also see the same hash is there when I created the <code>fred</code> branch to do that.
I started by rebasing <code>fred</code> and you see the 'start', each step, and the 'finish' for that process.
While we don’t need it here, you can figure out exactly what happened.
Fortunately, to fix this, you can follow the prior answer’s steps, but with the hash <code>869cbd3</code> instead of <code>pre-split</code>.
While that seems a bit verbose, it’s easy to remember since you’re doing one thing at a time.
You can also stack:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git checkout <span class=nt>-B</span> wilma 869cbd3
% git branch <span class=nt>-D</span> fred</code></pre></div></div><div class=paragraph><p>and you are ready to try again.
The <code>checkout -B</code> with the hash combines checking out and creating a branch for it.
The <code>-B</code> instead of <code>-b</code> forces the movement of a pre-existing branch.
Either way works, which is what’s great (and awful) about Git.
One reason I tend to use <code>git checkout -B xxxx hash</code> instead of checking out the hash, and then creating / moving the branch is purely to avoid the slightly distressing message about detached heads:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git checkout 869cbd3
M	faq.md
Note: checking out <span class=s1>&#39;869cbd3&#39;</span><span class=nb>.</span>

You are <span class=k>in</span> <span class=s1>&#39;detached HEAD&#39;</span> state. You can look around, make experimental
changes and commit them, and you can discard any commits you make <span class=k>in </span>this
state without impacting any branches by performing another checkout.

If you want to create a new branch to retain commits you create, you may
<span class=k>do </span>so <span class=o>(</span>now or later<span class=o>)</span> by using <span class=nt>-b</span> with the checkout <span class=nb>command </span>again. Example:

  git checkout <span class=nt>-b</span> &lt;new-branch-name&gt;

HEAD is now at 869cbd3 Encourage contributions
% git checkout <span class=nt>-B</span> wilma</code></pre></div></div><div class=paragraph><p>this produces the same effect, but I have to read a lot more and severed heads aren’t an image I like to contemplate.</p></div></div><div class=sect4><h5 id=_ooops_i_did_a_git_pull_and_it_created_a_merge_commit_what_do_i_do>5.6.2.3. Ooops! I did a <code>git pull</code> and it created a merge commit, what do I do?<a class=anchor href=#_ooops_i_did_a_git_pull_and_it_created_a_merge_commit_what_do_i_do></a></h5><div class=paragraph><p><strong>Q:</strong> I was on autopilot and did a <code>git pull</code> for my development tree and that created a merge commit on <code>main</code>.
How do I recover?</p></div><div class=paragraph><p><strong>A:</strong> This can happen when you invoke the pull with your development branch checked out.</p></div><div class=paragraph><p>Right after the pull, you will have the new merge commit checked out.
Git supports a <code>HEAD^#</code> syntax to examine the parents of a merge commit:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>git log <span class=nt>--oneline</span> HEAD^1   <span class=c># Look at the first parent&#39;s commits</span>
git log <span class=nt>--oneline</span> HEAD^2   <span class=c># Look at the second parent&#39;s commits</span></code></pre></div></div><div class=paragraph><p>From those logs, you can easily identify which commit is your development work.
Then you simply reset your branch to the corresponding <code>HEAD^#</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>git reset <span class=nt>--hard</span> HEAD^2</code></pre></div></div><div class=paragraph><p><strong>Q:</strong> But I also need to fix my <code>main</code> branch. How do I do that?</p></div><div class=paragraph><p><strong>A:</strong> Git keeps track of the remote repository branches in a <code>freebsd/</code> namespace.
To fix your <code>main</code> branch, just make it point to the remote’s <code>main</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>git branch <span class=nt>-f</span> main freebsd/main</code></pre></div></div><div class=paragraph><p>There’s nothing magical about branches in Git: they are just labels on a graph that are automatically moved forward by making commits.
So the above works because you’re just moving a label.
There’s no metadata about the branch that needs to be preserved due to this.</p></div></div><div class=sect4><h5 id=_mixing_and_matching_branches>5.6.2.4. Mixing and matching branches<a class=anchor href=#_mixing_and_matching_branches></a></h5><div class=paragraph><p><strong>Q:</strong> So I have two branches <code>worker</code> and <code>async</code> that I’d like to combine into one branch called <code>feature</code>
while maintaining the commits in both.</p></div><div class=paragraph><p><strong>A:</strong> This is a job for cherry pick.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git checkout worker
% git checkout <span class=nt>-b</span> feature	<span class=c># create a new branch</span>
% git cherry-pick main..async	<span class=c># bring in the changes</span></code></pre></div></div><div class=paragraph><p>You now have a new branch called <code>feature</code>.
This branch combines commits from both branches.
You can further curate it with <code>git rebase</code>.</p></div><div class=paragraph><p><strong>Q:</strong> I have a branch called <code>driver</code> and I’d like to break it up into <code>kernel</code> and <code>userland</code> so I can evolve them separately and commit each branch as it becomes ready.</p></div><div class=paragraph><p><strong>A:</strong> This takes a little bit of prep work, but <code>git rebase</code> will do the heavy
lifting here.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git checkout driver		<span class=c># Checkout the driver</span>
% git checkout <span class=nt>-b</span> kernel	<span class=c># Create kernel branch</span>
% git checkout <span class=nt>-b</span> userland	<span class=c># Create userland branch</span></code></pre></div></div><div class=paragraph><p>Now you have two identical branches.
So, it’s time to separate out the commits.
We’ll assume first that all the commits in <code>driver</code> go into either the <code>kernel</code> or the <code>userland</code> branch, but not both.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git rebase <span class=nt>-i</span> main kernel</code></pre></div></div><div class=paragraph><p>and just include the changes you want (with a 'p' or 'pick' line) and just delete the commits you don’t (this sounds scary, but if worse comes to worse, you can throw this all away and start over with the <code>driver</code> branch since you’ve not yet moved it).</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git rebase <span class=nt>-i</span> main userland</code></pre></div></div><div class=paragraph><p>and do the same thing you did with the <code>kernel</code> branch.</p></div><div class=paragraph><p><strong>Q:</strong> Oh great! I followed the above and forgot a commit in the <code>kernel</code> branch.
How do I recover?</p></div><div class=paragraph><p><strong>A:</strong> You can use the <code>driver</code> branch to find the hash of the commit is missing and
cherry pick it.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git checkout kernel
% git log driver
% git cherry-pick <span class=nv>$HASH</span></code></pre></div></div><div class=paragraph><p><strong>Q:</strong> OK. I have the same situation as the above, but my commits are all mixed up.
I need parts of one commit to go to one branch and the rest to go to the other.
In fact, I have several.
Your rebase method to select sounds tricky.</p></div><div class=paragraph><p><strong>A:</strong> In this situation, you’d be better off to curate the original branch to separate
out the commits, and then use the above method to split the branch.</p></div><div class=paragraph><p>So let’s assume that there’s just one commit with a clean tree.
You can either use <code>git rebase</code> with an <code>edit</code> line, or you can use this with the commit on the tip.
The steps are the same either way.
The first thing we need to do is to back up one commit while leaving the changes uncommitted in the tree:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git reset HEAD^</code></pre></div></div><div class=paragraph><p>Note: Do not, repeat do not, add <code>--hard</code> here since that also removes the changes from your tree.</p></div><div class=paragraph><p>Now, if you are lucky, the change needing to be split up falls entirely along file lines.
In that case you can just do the usual <code>git add</code> for the files in each group than do a <code>git commit</code>.
Note: when you do this, you’ll lose the commit message when you do the reset, so if you need it for some reason, you should save a copy (though <code>git log $HASH</code> can recover it).</p></div><div class=paragraph><p>If you are not lucky, you’ll need to split apart files.
There’s another tool to do that which you can apply one file at a time.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>git add <span class=nt>-i</span> foo/bar.c</code></pre></div></div><div class=paragraph><p>will step through the diffs, prompting you, one at time, whether to include or exclude the hunk.
Once you’re done, <code>git commit</code> and you’ll have the remainder in your tree.
You can run it multiple times as well, and even over multiple files (though I find it easier to do one file at a time
and use the <code>git rebase -i</code> to fold the related commits together).</p></div></div></div><div class=sect3><h4 id=_cloning_and_mirroring>5.6.3. Cloning and Mirroring<a class=anchor href=#_cloning_and_mirroring></a></h4><div class=paragraph><p><strong>Q:</strong> I’d like to mirror the entire Git repository, how do I do that?</p></div><div class=paragraph><p><strong>A:</strong> If all you want to do is mirror, then</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git clone <span class=nt>--mirror</span> <span class=nv>$URL</span></code></pre></div></div><div class=paragraph><p>will do the trick.
However, there are two disadvantages to this if you want to use it for anything other than a mirror you’ll reclone.</p></div><div class=paragraph><p>First, this is a 'bare repository' which has the repository database, but no checked out worktree.
This is great for mirroring, but terrible for day to day work.
There’s a number of ways around this with <code>git worktree</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git clone <span class=nt>--mirror</span> https://git.freebsd.org/ports.git ports.git
% <span class=nb>cd </span>ports.git
% git worktree add ../ports main
% git worktree add ../quarterly branches/2020Q4
% <span class=nb>cd</span> ../ports</code></pre></div></div><div class=paragraph><p>But if you aren’t using your mirror for further local clones, then it’s a poor match.</p></div><div class=paragraph><p>The second disadvantage is that Git normally rewrites the refs (branch name, tags, etc) from upstream so that your local refs can evolve independently of upstream.
This means that you’ll lose changes if you are committing to this repository on anything other than private project branches.</p></div><div class=paragraph><p><strong>Q:</strong> So what can I do instead?</p></div><div class=paragraph><p><strong>A:</strong> Well, you can stuff all of the upstream repository’s refs into a private namespace in your local repository.
Git clones everything via a 'refspec' and the default refspec is:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>        fetch <span class=o>=</span> +refs/heads/<span class=k>*</span>:refs/remotes/freebsd/<span class=k>*</span></code></pre></div></div><div class=paragraph><p>which says just fetch the branch refs.</p></div><div class=paragraph><p>However, the FreeBSD repository has a number of other things in it.
To see those, you can add explicit refspecs for each ref namespace, or you can fetch everything.
To setup your repository to do that:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>git config <span class=nt>--add</span> remote.freebsd.fetch <span class=s1>&#39;+refs/*:refs/freebsd/*&#39;</span></code></pre></div></div><div class=paragraph><p>which will put everything in the upstream repository into your local repository’s <code>refs/freebsd/</code> namespace.
Please note, that this also grabs all the unconverted vendor branches and the number of refs associated with them is quite large.</p></div><div class=paragraph><p>You’ll need to refer to these 'refs' with their full name because they aren’t in and of Git’s regular namespaces.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>git log refs/freebsd/vendor/zlib/1.2.10</code></pre></div></div><div class=paragraph><p>would look at the log for the vendor branch for zlib starting at 1.2.10.</p></div></div></div><div class=sect2><h3 id=_collaborating_with_others>5.7. Collaborating with others<a class=anchor href=#_collaborating_with_others></a></h3><div class=paragraph><p>One of the keys to good software development on a project as large as FreeBSD is the ability to collaborate with others before you push your changes to the tree.
The FreeBSD project’s Git repositories do not, yet, allow user-created branches to be pushed to the repository, and therefore if you wish to share your changes with others you must use another mechanism, such as a hosted GitLab or GitHub, to share changes in a user-generated branch.</p></div><div class=paragraph><p>The following instructions show how to set up a user-generated branch, based on the FreeBSD <code>main</code> branch, and push it to GitHub.</p></div><div class=paragraph><p>Before you begin, make sure that your local Git repo is up to date and has the
correct origins set <a href=../committers-guide/#keeping_current>as shown above</a>.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=sb>````</span>
% git remote <span class=nt>-v</span>
freebsd https://git.freebsd.org/src.git <span class=o>(</span>fetch<span class=o>)</span>
freebsd ssh://git@gitrepo.freebsd.org/src.git <span class=o>(</span>push<span class=o>)</span>
<span class=sb>````</span></code></pre></div></div><div class=paragraph><p>The first step is to create a fork of <a href=https://github.com/freebsd/freebsd-src>FreeBSD</a> on GitHub following these <a href=https://docs.github.com/en/github/getting-started-with-github/fork-a-repo>guidelines</a>.
The destination of the fork should be your own, personal, GitHub account (gvnn3 in my case).</p></div><div class=paragraph><p>Now add a remote on your local system that points to your fork:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git remote add github git@github.com:gvnn3/freebsd-src.git
% git remote <span class=nt>-v</span>
github	git@github.com:gvnn3/freebsd-src.git <span class=o>(</span>fetch<span class=o>)</span>
github	git@github.com:gvnn3/freebsd-src.git <span class=o>(</span>push<span class=o>)</span>
freebsd	https://git.freebsd.org/src.git <span class=o>(</span>fetch<span class=o>)</span>
freebsd	ssh://git@gitrepo.freebsd.org/src.git <span class=o>(</span>push<span class=o>)</span></code></pre></div></div><div class=paragraph><p>With this in place you can create a branch
<a href=../committers-guide/#keeping_a_local_branch>as shown above</a>.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git checkout <span class=nt>-b</span> gnn-pr2001-fix</code></pre></div></div><div class=paragraph><p>Make whatever modifications you wish in your branch. Build, test, and once you’re ready to collaborate with others it’s time to push your changes into your hosted branch.
Before you can push you’ll have to set the appropriate upstream, as Git will tell you the first time you try to push to your github remote:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git push github
fatal: The current branch gnn-pr2001-fix has no upstream branch.
To push the current branch and <span class=nb>set </span>the remote as upstream, use

    git push <span class=nt>--set-upstream</span> github gnn-pr2001-fix</code></pre></div></div><div class=paragraph><p>Setting the push as git advises allows it to succeed:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git push <span class=nt>--set-upstream</span> github gnn-feature
Enumerating objects: 20486, <span class=k>done</span><span class=nb>.</span>
Counting objects: 100% <span class=o>(</span>20486/20486<span class=o>)</span>, <span class=k>done</span><span class=nb>.</span>
Delta compression using up to 8 threads
Compressing objects: 100% <span class=o>(</span>12202/12202<span class=o>)</span>, <span class=k>done</span><span class=nb>.</span>
Writing objects: 100% <span class=o>(</span>20180/20180<span class=o>)</span>, 56.25 MiB | 13.15 MiB/s, <span class=k>done</span><span class=nb>.</span>
Total 20180 <span class=o>(</span>delta 11316<span class=o>)</span>, reused 12972 <span class=o>(</span>delta 7770<span class=o>)</span>, pack-reused 0
remote: Resolving deltas: 100% <span class=o>(</span>11316/11316<span class=o>)</span>, completed with 247 <span class=nb>local </span>objects.
remote:
remote: Create a pull request <span class=k>for</span> <span class=s1>&#39;gnn-feature&#39;</span> on GitHub by visiting:
remote:      https://github.com/gvnn3/freebsd-src/pull/new/gnn-feature
remote:
To github.com:gvnn3/freebsd-src.git
 <span class=k>*</span> <span class=o>[</span>new branch]                gnn-feature -&gt; gnn-feature
Branch <span class=s1>&#39;gnn-feature&#39;</span> <span class=nb>set </span>up to track remote branch <span class=s1>&#39;gnn-feature&#39;</span> from <span class=s1>&#39;github&#39;</span>.</code></pre></div></div><div class=paragraph><p>Subsequent changes to the same branch will push correctly by default:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git push
Enumerating objects: 4, <span class=k>done</span><span class=nb>.</span>
Counting objects: 100% <span class=o>(</span>4/4<span class=o>)</span>, <span class=k>done</span><span class=nb>.</span>
Delta compression using up to 8 threads
Compressing objects: 100% <span class=o>(</span>2/2<span class=o>)</span>, <span class=k>done</span><span class=nb>.</span>
Writing objects: 100% <span class=o>(</span>3/3<span class=o>)</span>, 314 bytes | 1024 bytes/s, <span class=k>done</span><span class=nb>.</span>
Total 3 <span class=o>(</span>delta 1<span class=o>)</span>, reused 1 <span class=o>(</span>delta 0<span class=o>)</span>, pack-reused 0
remote: Resolving deltas: 100% <span class=o>(</span>1/1<span class=o>)</span>, completed with 1 <span class=nb>local </span>object.
To github.com:gvnn3/freebsd-src.git
   9e5243d7b659..cf6aeb8d7dda  gnn-feature -&gt; gnn-feature</code></pre></div></div><div class=paragraph><p>At this point your work is now in your branch on GitHub and you can
share the link with other collaborators.</p></div></div><div class=sect2><h3 id=github-pull-land>5.8. Landing a github pull request<a class=anchor href=#github-pull-land></a></h3><div class=paragraph><p>This section documents how to land a GitHub pull request that’s submitted against the FreeBSD Git mirrors at GitHub.
While this is not an official way to submit patches at this time, sometimes good fixes come in this way and it is easiest just to bring them into a committer’s tree and have them pushed into the FreeBSD’s tree from there.
Similar steps can be used to pull branches from other repositories and land those.
When committing pull requests from others, one should take extra care to examine all the changes to ensure they are exactly as represented.</p></div><div class=paragraph><p>Before beginning, make sure that the local Git repo is up to date and has the
correct origins set <a href=../committers-guide/#keeping_current>as shown above</a>.
In addition, make sure to have the following origins:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git remote <span class=nt>-v</span>
freebsd https://git.freebsd.org/src.git <span class=o>(</span>fetch<span class=o>)</span>
freebsd ssh://git@gitrepo.freebsd.org/src.git <span class=o>(</span>push<span class=o>)</span>
github https://github.com/freebsd/freebsd-src <span class=o>(</span>fetch<span class=o>)</span>
github https://github.com/freebsd/freebsd-src <span class=o>(</span>fetch<span class=o>)</span></code></pre></div></div><div class=paragraph><p>Often pull requests are simple: requests that contain only a single commit.
In this case, a streamlined approach may be used, though the approach in the prior section will also work.
Here, a branch is created, the change is cherry picked, the commit message adjusted, and sanity-checked before being pushed.
The branch <code>staging</code> is used in this example but it can be any name.
This technique works for any number of commits in the pull request, especially when the changes apply cleanly to the FreeBSD tree.
However, when there’s multiple commits, especially when minor adjustments are needed, <code>git rebase -i</code> works better than <code>git cherry-pick</code>.
Briefly, these commands create a branch; cherry-picks the changes from the pull request; tests it; adjusts the commit messages; and fast forward merges it back to <code>main</code>.
The PR number is <code>$PR</code> below.
When adjusting the message, add <code>Pull Request: <a href=https://github.com/freebsd-src/pull/$PR class=bare>https://github.com/freebsd-src/pull/$PR</a></code>.
All pull requests committed to the FreeBSD repository should be reviewed by at least one person.
This need not be the person committing it, but in that case the person committing it should trust the other reviewers competence to review the commit.
Committers that do a code review of pull requests before pushing them into the repo should add a <code>Reviewed by:</code> line to the commit, because in this case it is not implicit.
Add anybody that reviews and approves the commit on github to <code>Reviewed by:</code> as well.
As always, care should be taken to ensure the change does what it is supposed to, and that no malicious code is present.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>In addition, please check to make sure that the pull request author name is not anonymous.
Github’s web editing interface generates names like:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>Author:     github-user &lt;38923459+github-user@users.noreply.github.com&gt;</code></pre></div></div><div class=paragraph><p>A polite request to the author for a better name and/or email should be made.
Extra care should be taken to ensure no style issue or malicious code is introduced.</p></div></td></tr></tbody></table></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git fetch github pull/<span class=nv>$PR</span>/head:staging
% git rebase <span class=nt>-i</span> main staging	<span class=c># to move the staging branch forward, adjust commit message here</span>
&lt;<span class=k>do </span>testing here, as needed&gt;
% git checkout main
% git pull <span class=nt>--ff-only</span>		<span class=c># to get the latest if time has passed</span>
% git checkout main
% git merge <span class=nt>--ff-only</span> staging
&lt;<span class=nb>test </span>again <span class=k>if </span>needed&gt;
% git push freebsd <span class=nt>--push-option</span><span class=o>=</span>confirm-author</code></pre></div></div><div class="exampleblock procedure"><div class=content><div class=paragraph><p>For complicated pull requests that have multiple commits with conflicts, follow the following outline.</p></div><div class="olist arabic"><ol class=arabic><li><p>checkout the pull request <code>git checkout github/pull/XXX</code></p></li><li><p>create a branch to rebase <code>git checkout -b staging</code></p></li><li><p>rebase the <code>staging</code> branch to the latest <code>main</code> with <code>git rebase -i main staging</code></p></li><li><p>resolve conflicts and do whatever testing is needed</p></li><li><p>fast forward the <code>staging</code> branch into <code>main</code> as above</p></li><li><p>final sanity check of changes to make sure all is well</p></li><li><p>push to FreeBSD’s Git repository.</p></li></ol></div><div class=paragraph><p>This will also work when bringing branches developed elsewhere into the local tree for committing.</p></div></div></div><div class=paragraph><p>Once finished with the pull request, close it using GitHub’s web interface.
It is worth noting that if your <code>github</code> origin uses <code>https://</code>, the only step you’ll need a GitHub account for is closing the pull request.</p></div></div></div></div><div class=sect1><h2 id=vcs-history>6. Version Control History<a class=anchor href=#vcs-history></a></h2><div class=sectionbody><div class=paragraph><p>The project has moved to <a href=../committers-guide/#git-primer>git</a>.</p></div><div class=paragraph><p>The FreeBSD source repository switched from CVS to Subversion on May 31st, 2008.
The first real SVN commit is <em>r179447</em>.
The source repository switched from Subversion to Git on December 23rd, 2020.
The last real svn commit is <em>r368820</em>.
The first real git commit hash is <em>5ef5f51d2bef80b0ede9b10ad5b0e9440b60518c</em>.</p></div><div class=paragraph><p>The FreeBSD <code>doc/www</code> repository switched from CVS to Subversion on May 19th, 2012.
The first real SVN commit is <em>r38821</em>.
The documentation repository switched from Subversion to Git on December 8th, 2020.
The last SVN commit is <em>r54737</em>.
The first real git commit hash is <em>3be01a475855e7511ad755b2defd2e0da5d58bbe</em>.</p></div><div class=paragraph><p>The FreeBSD <code>ports</code> repository switched from CVS to Subversion on July 14th, 2012.
The first real SVN commit is <em>r300894</em>.
The ports repository switched from Subversion to Git on April 6, 2021.
The last SVN commit is <em>r569609</em>
The first real git commit hash is <em>ed8d3eda309dd863fb66e04bccaa513eee255cbf</em>.</p></div></div></div><div class=sect1><h2 id=conventions>7. Setup, Conventions, and Traditions<a class=anchor href=#conventions></a></h2><div class=sectionbody><div class=paragraph><p>There are a number of things to do as a new developer.
The first set of steps is specific to committers only.
These steps must be done by a mentor for those who are not committers.</p></div><div class=sect2><h3 id=conventions-committers>7.1. For New Committers<a class=anchor href=#conventions-committers></a></h3><div class=paragraph><p>Those who have been given commit rights to the FreeBSD repositories must follow these steps.</p></div><div class=ulist><ul><li><p>Get mentor approval before committing each of these changes!</p></li><li><p>All <span class=filename>src</span> commits go to FreeBSD-CURRENT first before being merged to FreeBSD-STABLE. The FreeBSD-STABLE branch must maintain ABI and API compatibility with earlier versions of that branch. Do not merge changes that break this compatibility.</p></li></ul></div><div id=commit-steps class="exampleblock procedure"><div class=content><div class=paragraph><p><strong>Steps for New Committers</strong></p></div><div class="olist arabic"><ol class=arabic><li><p>Add an Author Entity</p><div class=paragraph><p><span class=filename>doc/shared/authors.adoc</span> - Add an author entity. Later steps depend on this entity, and missing this step will cause the <span class=filename>doc/</span> build to fail. This is a relatively easy task, but remains a good first test of version control skills.</p></div></li><li><p>Update the List of Developers and Contributors</p><div class=paragraph><p><span class=filename>doc/shared/contrib-committers.adoc</span> - Add an entry, which will then appear in the "Developers" section of the <a href=https://docs.freebsd.org/en/articles/contributors/#staff-committers>Contributors List</a>. Entries are sorted by last name.</p></div><div class=paragraph><p><span class=filename>doc/shared/contrib-additional.adoc</span> - <em>Remove</em> the entry. Entries are sorted by first name.</p></div></li><li><p>Add a News Item</p><div class=paragraph><p><span class=filename>doc/website/data/en/news/news.toml</span> - Add an entry. Look for the other entries that announce new committers and follow the format. Use the date from the commit bit approval email.</p></div></li><li><p>Add a PGP Key</p><div class=paragraph><p><code>Dag-Erling Smørgrav &lt;<a href=mailto:des@FreeBSD.org>des@FreeBSD.org</a>></code> has written a shell script (<span class=filename>doc/documentation/tools/addkey.sh</span>) to make this easier. See the <a href=https://cgit.freebsd.org/doc/plain/documentation/static/pgpkeys/README>README</a> file for more information.</p></div><div class=paragraph><p>Use <span class=filename>doc/documentation/tools/checkkey.sh</span> to verify that keys meet minimal best-practices standards.</p></div><div class=paragraph><p>After adding and checking a key, add both updated files to source control and then commit them. Entries in this file are sorted by last name.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>It is very important to have a current PGP/GnuPG key in the repository. The key may be required for positive identification of a committer. For example, the <code>FreeBSD Administrators &lt;<a href=mailto:admins@FreeBSD.org>admins@FreeBSD.org</a>></code> might need it for account recovery. A complete keyring of <code>FreeBSD.org</code> users is available for download from <a href=https://docs.FreeBSD.org/pgpkeys/pgpkeys.txt>https://docs.FreeBSD.org/pgpkeys/pgpkeys.txt</a>.</p></div></td></tr></tbody></table></div></li><li><p>Update Mentor and Mentee Information</p><div class=paragraph><p><span class=filename>src/share/misc/committers-&lt;repository>.dot</span> - Add an entry to the current committers section, where <em>repository</em> is <code>doc</code>, <code>ports</code>, or <code>src</code>, depending on the commit privileges granted.</p></div><div class=paragraph><p>Add an entry for each additional mentor/mentee relationship in the bottom section.</p></div></li><li><p>Generate a Kerberos Password</p><div class=paragraph><p>See <a href=../committers-guide/#kerberos-ldap>Kerberos and LDAP web Password for FreeBSD Cluster</a> to generate or set a Kerberos account for use with other FreeBSD services like the <a href=https://bugs.freebsd.org/bugzilla/>bug-tracking database</a> (you get a bug-tracking account as part of that step).</p></div></li><li><p>Optional: Enable Wiki Account</p><div class=paragraph><p><a href=https://wiki.freebsd.org>FreeBSD Wiki</a> Account - A wiki account allows sharing projects and ideas.
Those who do not yet have an account can follow instructions on the <a href=https://wiki.freebsd.org/Wiki/About>Wiki/About page</a> to obtain one.
Contact <a href=mailto:wiki-admin@FreeBSD.org>wiki-admin@FreeBSD.org</a> if you need help with your Wiki account.</p></div></li><li><p>Optional: Update Wiki Information</p><div class=paragraph><p>Wiki Information - After gaining access to the wiki, some people add entries to the <a href=https://wiki.freebsd.org/HowWeGotHere>How We Got Here</a>, <a href=https://wiki.freebsd.org/IRC/Nicknames>IRC Nicks</a>, <a href=https://wiki.freebsd.org/Community/Dogs>Dogs of FreeBSD</a>, and or <a href=https://wiki.freebsd.org/Community/Cats>Cats of FreeBSD</a> pages.</p></div></li><li><p>Optional: Update Ports with Personal Information</p><div class=paragraph><p><span class=filename>ports/astro/xearth/files/freebsd.committers.markers</span> and <span class=filename>src/usr.bin/calendar/calendars/calendar.freebsd</span> - Some people add entries for themselves to these files to show where they are located or the date of their birthday.</p></div></li><li><p>Optional: Prevent Duplicate Mailings</p><div class=paragraph><p>Subscribers to <a href=https://lists.FreeBSD.org/subscription/dev-commits-doc-all>Commit messages for all branches of the doc repository</a>, <a href=https://lists.FreeBSD.org/subscription/dev-commits-ports-all>Commit messages for all branches of the ports repository</a> or <a href=https://lists.FreeBSD.org/subscription/dev-commits-src-all>Commit messages for all branches of the src repository</a> might wish to unsubscribe to avoid receiving duplicate copies of commit messages and followups.</p></div></li></ol></div></div></div></div><div class=sect2><h3 id=conventions-everyone>7.2. For Everyone<a class=anchor href=#conventions-everyone></a></h3><div id=conventions-everyone-steps class="exampleblock procedure"><div class=content><div class="olist arabic"><ol class=arabic><li><p>Introduce yourself to the other developers, otherwise no one will have any idea who you are or what you are working on. The introduction need not be a comprehensive biography, just write a paragraph or two about who you are, what you plan to be working on as a developer in FreeBSD, and who will be your mentor. Email this to the FreeBSD developers mailing list and you will be on your way!</p></li><li><p>Log into <code>freefall.FreeBSD.org</code> and create a <span class=filename>/var/forward/user</span> (where <em>user</em> is your username) file containing the e-mail address where you want mail addressed to <em>yourusername</em>@FreeBSD.org to be forwarded. This includes all of the commit messages as well as any other mail addressed to the FreeBSD committer’s mailing list and the FreeBSD developers mailing list. Really large mailboxes which have taken up permanent residence on <code>freefall</code> may get truncated without warning if space needs to be freed, so forward it or save it elsewhere.</p><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>If your e-mail system uses SPF with strict rules, you should exclude <code>mx2.FreeBSD.org</code> from SPF checks.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Due to the severe load dealing with SPAM places on the central mail servers that do the mailing list processing, the front-end server does do some basic checks and will drop some messages based on these checks. At the moment proper DNS information for the connecting host is the only check in place but that may change. Some people blame these checks for bouncing valid email. To have these checks turned off for your email, create a file named <span class=filename>~/.spam_lover</span> on <code>freefall.FreeBSD.org</code>.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Those who are developers but not committers will not be subscribed to the committers or developers mailing lists. The subscriptions are derived from the access rights.</p></div></td></tr></tbody></table></div></li></ol></div></div></div><div class=sect3><h4 id=smtp-setup>7.2.1. SMTP Access Setup<a class=anchor href=#smtp-setup></a></h4><div class=paragraph><p>For those willing to send e-mail messages through the FreeBSD.org infrastructure, follow the instructions below:</p></div><div class="exampleblock procedure"><div class=content><div class="olist arabic"><ol class=arabic><li><p>Point your mail client at <code>smtp.FreeBSD.org:587</code>.</p></li><li><p>Enable STARTTLS.</p></li><li><p>Ensure your <code>From:</code> address is set to <code><em>yourusername</em>@FreeBSD.org</code>.</p></li><li><p>For authentication, you can use your FreeBSD Kerberos username and password
(see <a href=../committers-guide/#kerberos-ldap>Kerberos and LDAP web Password for FreeBSD Cluster</a>). The <code><em>yourusername</em>/mail</code> principal is preferred, as it is only valid for authenticating to mail resources.</p><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Do not include <code>@FreeBSD.org</code> when entering in your username.</p></div></td></tr></tbody></table></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=title>Additional Notes</div><div class=ulist><ul><li><p>Will only accept mail from <code><em>yourusername</em>@FreeBSD.org</code>. If you are authenticated as one user, you are not permitted to send mail from another.</p></li><li><p>A header will be appended with the SASL username: (<code>Authenticated sender: <em>username</em></code>).</p></li><li><p>Host has various rate limits in place to cut down on brute force attempts.</p></li></ul></div></td></tr></tbody></table></div></li></ol></div></div></div><div class=sect4><h5 id=smtp-setup-local-mta>7.2.1.1. Using a Local MTA to Forward Emails to the FreeBSD.org SMTP Service<a class=anchor href=#smtp-setup-local-mta></a></h5><div class=paragraph><p>It is also possible to use a local MTA to forward locally sent emails to the FreeBSD.org SMTP servers.</p></div><div id=smtp-setup-local-postfix class=exampleblock><div class=title>Example 1. Using Postfix</div><div class=content><div class=paragraph><p>To tell a local Postfix instance that anything from <code><em>yourusername</em>@FreeBSD.org</code> should be forwarded to the FreeBSD.org servers, add this to your <span class=filename>main.cf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>sender_dependent_relayhost_maps = hash:/usr/local/etc/postfix/relayhost_maps
smtp_sasl_auth_enable = yes
smtp_sasl_security_options = noanonymous
smtp_sasl_password_maps = hash:/usr/local/etc/postfix/sasl_passwd
smtp_use_tls = yes</pre></div></div><div class=paragraph><p>Create <span class=filename>/usr/local/etc/postfix/relayhost_maps</span> with the following content:</p></div><div class="literalblock programlisting"><div class=content><pre>yourusername@FreeBSD.org  [smtp.freebsd.org]:587</pre></div></div><div class=paragraph><p>Create <span class=filename>/usr/local/etc/postfix/sasl_passwd</span> with the following content:</p></div><div class="literalblock programlisting"><div class=content><pre>[smtp.freebsd.org]:587          yourusername:yourpassword</pre></div></div><div class=paragraph><p>If the email server is used by other people, you may want to prevent them from sending e-mails from your address. To achieve this, add this to your <span class=filename>main.cf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>smtpd_sender_login_maps = hash:/usr/local/etc/postfix/sender_login_maps
smtpd_sender_restrictions = reject_known_sender_login_mismatch</pre></div></div><div class=paragraph><p>Create <span class=filename>/usr/local/etc/postfix/sender_login_maps</span> with the following content:</p></div><div class="literalblock programlisting"><div class=content><pre>yourusername@FreeBSD.org yourlocalusername</pre></div></div><div class=paragraph><p>Where <em>yourlocalusername</em> is the SASL username used to connect to the local instance of Postfix.</p></div></div></div><div id=smtp-setup-local-opensmtpd class=exampleblock><div class=title>Example 2. Using OpenSMTPD</div><div class=content><div class=paragraph><p>To tell a local OpenSMTPD instance that anything from <code><em>yourusername</em>@FreeBSD.org</code> should be forwarded to the FreeBSD.org servers, add this to your <span class=filename>smtpd.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>action &#34;freebsd&#34; relay host smtp+tls://freebsd@smtp.freebsd.org:587 auth &lt;secrets&gt;
match from any auth yourlocalusername mail-from &#34;_yourusername_@freebsd.org&#34; for any action &#34;freebsd&#34;</pre></div></div><div class=paragraph><p>Where <em>yourlocalusername</em> is the SASL username used to connect to the local instance of OpenSMTPD.</p></div><div class=paragraph><p>Create <span class=filename>/usr/local/etc/mail/secrets</span> with the following content:</p></div><div class="literalblock programlisting"><div class=content><pre>freebsd	yourusername:yourpassword</pre></div></div></div></div><div id=smtp-setup-local-exim class=exampleblock><div class=title>Example 3. Using Exim</div><div class=content><div class=paragraph><p>To direct a local Exim instance to forward all mail from <code><em>example</em>@FreeBSD.org</code>
to FreeBSD.org servers, add this to Exim <span class=filename>configuration</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>Routers section: (at the top of the list):
freebsd_send:
   driver = manualroute
   domains = !+local_domains
   transport = freebsd_smtp
   route_data = ${lookup {${lc:$sender_address}} lsearch {/usr/local/etc/exim/freebsd_send}}

Transport Section:
freebsd_smtp:
        driver = smtp
  tls_certificate=&lt;local certificate&gt;
  tls_privatekey=&lt;local certificate private key&gt;
  tls_require_ciphers = EECDH+ECDSA+AESGCM:EECDH+aRSA+AESGCM:EECDH+ECDSA+SHA384:EECDH+ECDSA+SHA256:EECDH+aRSA+SHA384:EECDH+aRSA+SHA256:EECDH+AESGCM:EECDH:EDH+AESGCM:EDH+aRSA:HIGH:!MEDIUM:!LOW:!aNULL:!eNULL:!LOW:!RC4:!MD5:!EXP:!PSK:!SRP:!DSS
  dkim_domain = &lt;local DKIM domain&gt;
  dkim_selector = &lt;local DKIM selector&gt;
  dkim_private_key= &lt;local DKIM private key&gt;
  dnssec_request_domains = *
  hosts_require_auth = smtp.freebsd.org

Authenticators:
freebsd_plain:
  driver = plaintext
  public_name = PLAIN
  client_send = ^example/mail^examplePassword
  client_condition = ${if eq{$host}{smtp.freebsd.org}}</pre></div></div><div class=paragraph><p>Create <span class=filename>/usr/local/etc/exim/freebsd_send</span> with the following content:</p></div><div class="literalblock programlisting"><div class=content><pre>example@freebsd.org:smtp.freebsd.org::587</pre></div></div></div></div></div></div></div><div class=sect2><h3 id=mentors>7.3. Mentors<a class=anchor href=#mentors></a></h3><div class=paragraph><p>All new developers have a mentor assigned to them for the first few months.
A mentor is responsible for teaching the mentee the rules and conventions of the project and guiding their first steps in the developer community.
The mentor is also personally responsible for the mentee’s actions during this initial period.</p></div><div class=paragraph><p>For committers: do not commit anything without first getting mentor approval.
Document that approval with an <code>Approved by:</code> line in the commit message.</p></div><div class=paragraph><p>When the mentor decides that a mentee has learned the ropes and is ready to commit on their own, the mentor announces it with a commit to <span class=filename>mentors</span>.
This file is in the <span class=filename>admin</span> orphan branch of each repository.
Detailed information on how to access these branches can be found in
<a href=../committers-guide/#admin-branch>admin</a>.</p></div></div></div></div><div class=sect1><h2 id=pre-commit-review>8. Pre-Commit Review<a class=anchor href=#pre-commit-review></a></h2><div class=sectionbody><div class=paragraph><p>Code review is one way to increase the quality of software.
The following guidelines apply to commits to the <code>main</code> (-CURRENT) branch of the <code>src</code> repository.
Other branches and the <code>ports</code> and <code>docs</code> trees have their own review policies, but these guidelines generally apply to commits requiring review:</p></div><div class=ulist><ul><li><p>All non-trivial changes should be reviewed before they are committed to the repository.</p></li><li><p>Reviews may be conducted by email, in Bugzilla, in Phabricator, or by another mechanism. Where possible, reviews should be public.</p></li><li><p>The developer responsible for a code change is also responsible for making all necessary review-related changes.</p></li><li><p>Code review can be an iterative process, which continues until the patch is ready to be committed. Specifically, once a patch is sent out for review, it should receive an explicit "looks good" before it is committed. So long as it is explicit, this can take whatever form makes sense for the review method.</p></li><li><p>Timeouts are not a substitute for review.</p></li></ul></div><div class=paragraph><p>Sometimes code reviews will take longer than you would hope for, especially for larger features. Accepted ways to speed up review times for your patches are:</p></div><div class=ulist><ul><li><p>Review other people’s patches. If you help out, everybody will be more willing to do the same for you; goodwill is our currency.</p></li><li><p>Ping the patch. If it is urgent, provide reasons why it is important to you to get this patch landed and ping it every couple of days. If it is not urgent, the common courtesy ping rate is one week. Remember that you are asking for valuable time from other professional developers.</p></li><li><p>Ask for help on mailing lists, IRC, etc. Others may be able to either help you directly, or suggest a reviewer.</p></li><li><p>Split your patch into multiple smaller patches that build on each other. The smaller your patch, the higher the probability that somebody will take a quick look at it.</p><div class=paragraph><p>When making large changes, it is helpful to keep this in mind from the beginning of the effort as breaking large changes into smaller ones is often difficult after the fact.</p></div></li></ul></div><div class=paragraph><p>Developers should participate in code reviews as both reviewers and reviewees.
If someone is kind enough to review your code, you should return the favor for someone else.
Note that while anyone is welcome to review and give feedback on a patch, only an appropriate subject-matter expert can approve a change.
This will usually be a committer who works with the code in question on a regular basis.</p></div><div class=paragraph><p>In some cases, no subject-matter expert may be available.
In those cases, a review by an experienced developer is sufficient when coupled with appropriate testing.</p></div></div></div><div class=sect1><h2 id=commit-log-message>9. Commit Log Messages<a class=anchor href=#commit-log-message></a></h2><div class=sectionbody><div class=paragraph><p>This section contains some suggestions and traditions for how commit logs are formatted.</p></div><div class=sect2><h3 id=_why_are_commit_messages_important>9.1. Why are commit messages important?<a class=anchor href=#_why_are_commit_messages_important></a></h3><div class=paragraph><p>When you commit a change in Git, Subversion, or another version control system (VCS), you’re prompted to write some text describing the commit — a commit message.
How important is this commit message? Should you spend some significant effort writing it? Does it really matter if you write simply <code>fixed a bug</code>?</p></div><div class=paragraph><p>Most projects have more than one developer and last for some length of time.
Commit messages are a very important method of communicating with other developers, in the present and for the future.</p></div><div class=paragraph><p>FreeBSD has hundreds of active developers and hundreds of thousands of commits spanning decades of history.
Over that time the developer community has learned how valuable good commit messages are; sometimes these are hard-learned lessons.</p></div><div class=paragraph><p>Commit messages serve at least three purposes:</p></div><div class=ulist><ul><li><p>Communicating with other developers</p><div class=paragraph><p>FreeBSD commits generate email to various mailing lists.
These include the commit message along with a copy of the patch itself.
Commit messages are also viewed through commands like git log.
These serve to make other developers aware of changes that are ongoing; that other developer may want to test the change, may have an interest in the topic and will want to review in more detail, or may have their own projects underway that would benefit from interaction.</p></div></li><li><p>Making Changes Discoverable</p><div class=paragraph><p>In a large project with a long history it may be difficult to find changes of interest when investigating an issue or change in behaviour.
Verbose, detailed commit messages allow searches for changes that might be relevant.
For example, <code>git log --since 1year --grep 'USB timeout'</code>.</p></div></li><li><p>Providing historical documentation</p><div class=paragraph><p>Commit messages serve to document changes for future developers, perhaps years or decades later.
This future developer may even be you, the original author.
A change that seems obvious today may be decidedly not so much later on.</p></div></li></ul></div><div class=paragraph><p>The <code>git blame</code> command annotates each line of a source file with the change (hash and subject line) that brought it in.</p></div><div class=paragraph><p>Having established the importance, here are elements of a good FreeBSD commit message:</p></div></div><div class=sect2><h3 id=_start_with_a_subject_line>9.2. Start with a subject line<a class=anchor href=#_start_with_a_subject_line></a></h3><div class=paragraph><p>Commit messages should start with a single-line subject that briefly summarizes the change.
The subject should, by itself, allow the reader to quickly determine if the change is of interest or not.</p></div></div><div class=sect2><h3 id=_keep_subject_lines_short>9.3. Keep subject lines short<a class=anchor href=#_keep_subject_lines_short></a></h3><div class=paragraph><p>The subject line should be as short as possible while still retaining the required information.
This is to make browsing Git log more efficient, and so that git log --oneline can display the short hash and subject on a single 80-column line.
A good rule of thumb is to stay below 63 characters, and aim for about 50 or fewer if possible.</p></div></div><div class=sect2><h3 id=_prefix_the_subject_line_with_a_component_if_applicable>9.4. Prefix the subject line with a component, if applicable<a class=anchor href=#_prefix_the_subject_line_with_a_component_if_applicable></a></h3><div class=paragraph><p>If the change relates to a specific component the subject line may be prefixed with that component name and a colon (:).</p></div><div class=paragraph><p>✓ <code>foo: Add -k option to keep temporary data</code></p></div><div class=paragraph><p>Include the prefix in the 63-character limit suggested above, so that <code>git log --oneline</code> avoids wrapping.</p></div></div><div class=sect2><h3 id=_capitalize_the_first_letter_of_the_subject>9.5. Capitalize the first letter of the subject<a class=anchor href=#_capitalize_the_first_letter_of_the_subject></a></h3><div class=paragraph><p>Capitalize the first letter of the subject itself.
The prefix, if any, is not capitalized unless necessary (e.g., <code>USB:</code> is capitalized).</p></div></div><div class=sect2><h3 id=_do_not_end_the_subject_line_with_punctuation>9.6. Do not end the subject line with punctuation<a class=anchor href=#_do_not_end_the_subject_line_with_punctuation></a></h3><div class=paragraph><p>Do not end with a period or other punctuation.
In this regard the subject line is like a newspaper headline.</p></div></div><div class=sect2><h3 id=_separate_the_subject_and_body_with_a_blank_line>9.7. Separate the subject and body with a blank line<a class=anchor href=#_separate_the_subject_and_body_with_a_blank_line></a></h3><div class=paragraph><p>Separate the body from the subject with a blank line.</p></div><div class=paragraph><p>Some trivial commits do not require a body, and will have only a subject.</p></div><div class=paragraph><p>✓ <code>ls: Fix typo in usage text</code></p></div></div><div class=sect2><h3 id=_limit_messages_to_72_columns>9.8. Limit messages to 72 columns<a class=anchor href=#_limit_messages_to_72_columns></a></h3><div class=paragraph><p><code>git log</code> and <code>git format-patch</code> indent the commit message by four spaces.
Wrapping at 72 columns provides a matching margin on the right edge.
Limiting messages to 72 characters also keeps the commit message in formatted patches below RFC 2822’s suggested email line length limit of 78 characters.
This limit works well with a variety of tools that may render commit messages; line wrapping might be inconsistent with longer line length.</p></div></div><div class=sect2><h3 id=_use_the_present_tense_imperative_mood>9.9. Use the present tense, imperative mood<a class=anchor href=#_use_the_present_tense_imperative_mood></a></h3><div class=paragraph><p>This facilitates short subject lines and provides consistency, including with automatically generated commit messages (e.g., as generated by git revert).
This is important when reading a list of commit subjects.
Think of the subject as finishing the sentence "when applied, this change will …​".</p></div><div class=paragraph><p>✓ <code>foo: Implement the -k (keep) option</code><br>✗ <code>foo: Implemented the -k option</code><br>✗ <code>This change implements the -k option in foo</code><br>✗ <code>-k option added</code></p></div></div><div class=sect2><h3 id=_focus_on_what_and_why_not_how>9.10. Focus on what and why, not how<a class=anchor href=#_focus_on_what_and_why_not_how></a></h3><div class=paragraph><p>Explain what the change accomplishes and why it is being done, rather than how.</p></div><div class=paragraph><p>Do not assume that the reader is familiar with the issue.
Explain the background and motivation for the change.
Include benchmark data if you have it.</p></div><div class=paragraph><p>If there are limitations or incomplete aspects of the change, describe them in the commit message.</p></div></div><div class=sect2><h3 id=_consider_whether_parts_of_the_commit_message_could_be_code_comments_instead>9.11. Consider whether parts of the commit message could be code comments instead<a class=anchor href=#_consider_whether_parts_of_the_commit_message_could_be_code_comments_instead></a></h3><div class=paragraph><p>Sometimes while writing a commit message you may find yourself writing a sentence or two explaining some tricky or confusing aspect of the change. When this happens consider whether it would be valuable to have that explanation as a comment in the code itself.</p></div></div><div class=sect2><h3 id=_write_commit_messages_for_your_future_self>9.12. Write commit messages for your future self<a class=anchor href=#_write_commit_messages_for_your_future_self></a></h3><div class=paragraph><p>While writing the commit message for a change you have all of the context in mind - what prompted the change, alternate approaches that were considered and rejected, limitations of the change, and so on.
Imagine yourself revisiting the change a year or two in the future, and write the commit message in a way that would provide that necessary context.</p></div></div><div class=sect2><h3 id=_commit_messages_should_stand_alone>9.13. Commit messages should stand alone<a class=anchor href=#_commit_messages_should_stand_alone></a></h3><div class=paragraph><p>You may include references to mailing list postings, benchmark result web sites, or code review links.
However, the commit message should contain all of the relevant information in case these references are no longer available in the future.</p></div><div class=paragraph><p>Similarly, a commit may refer to a previous commit, for example in the case of a bug fix or revert.
In addition to the commit identifier (revision or hash), include the subject line from the referenced commit (or another suitable brief reference).
With each VCS migration (from CVS to Subversion to Git) revision identifiers from previous systems may become difficult to follow.</p></div></div><div class=sect2><h3 id=_include_appropriate_metadata_in_a_footer>9.14. Include appropriate metadata in a footer<a class=anchor href=#_include_appropriate_metadata_in_a_footer></a></h3><div class=paragraph><p>As well as including an informative message with each commit, some additional information may be needed.</p></div><div class=paragraph><p>This information consists of one or more lines containing the key word or phrase, a colon, tabs for formatting, and then the additional information.</p></div><div class=paragraph><p>The key words or phrases are:</p></div><table class="tableblock frame-none grid-all stretch informaltable"><col style=width:20%><col style=width:80%><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>PR:</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>The problem report (if any) which is affected (typically, by being closed) by this commit. Multiple PRs may be specified on one line, separated by commas or spaces.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>Reported by:</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>The name and e-mail address of the person that reported the issue; for developers, just the username on the FreeBSD cluster.
Typically used when there is no PR, for example if the issue was reported on
a mailing list.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>Submitted by:</code><br>(deprecated)</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>This has been deprecated with git; submitted patches should have the author set by using <code>git commit --author</code> with a full name and valid email.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>Reviewed by:</code></p></td><td class="tableblock halign-left valign-top"><div class=content><div class=paragraph><p>The name and e-mail address of the person or people that reviewed the change; for developers, just the username on the FreeBSD cluster. If a patch was submitted to a mailing list for review, and the review was favorable, then just include the list name. If the reviewer is not a member of the project, provide the name, email, and if ports an external role like maintainer:</p></div><div class=paragraph><p>Reviewed by a developer:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>Reviewed by: username</code></pre></div></div><div class=paragraph><p>Reviewed by a ports maintainer that is not a developer:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>Reviewed by: Full Name &lt;valid@email&gt; <span class=o>(</span>maintainer<span class=o>)</span></code></pre></div></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>Tested by:</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>The name and e-mail address of the person or people that tested the change; for developers, just the username on the FreeBSD cluster.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>Discussed with:</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>The name and e-mail address of the person or people that contributed to the patch by providing meaningful feedback; for developers, just the username on the FreeBSD cluster.
Typically used to credit those who did not explicitly review, test, or approve the change, but nevertheless contributed to the discussion surrounding the change, which led to improvements and a better understanding of its impact on the FreeBSD project.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>Approved by:</code></p></td><td class="tableblock halign-left valign-top"><div class=content><div class=paragraph><p>The name and e-mail address of the person or people that approved the change; for developers, just the username on the FreeBSD cluster.</p></div><div class=paragraph><p>There are several cases where approval is customary:</p></div><div class=ulist><ul><li><p>while a new committer is under mentorship</p></li><li><p>commits to an area of the tree covered by the LOCKS file (src)</p></li><li><p>during a release cycle</p></li><li><p>committing to a repo where you do not hold a commit bit (e.g. src committer committing to docs)</p></li><li><p>committing to a port maintained by someone else</p></li></ul></div><div class=paragraph><p>While under mentorship, get mentor approval before the commit. Enter the mentor’s username in this field, and note that they are a mentor:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>Approved by: username-of-mentor <span class=o>(</span>mentor<span class=o>)</span></code></pre></div></div><div class=paragraph><p>If a team approved these commits then include the team name followed by the username of the approver in parentheses. For example:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>Approved by: re <span class=o>(</span>username<span class=o>)</span></code></pre></div></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>Obtained from:</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>The name of the project (if any) from which the code was obtained. Do not use this line for the name of an individual person.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>Fixes:</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>The Git short hash and the title line of a commit that is fixed by this change as returned by <code>git log -n 1 --oneline GIT-COMMIT-HASH</code>.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>MFC after:</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>To receive an e-mail reminder to MFC at a later date, specify the number of days, weeks, or months after which an MFC is planned.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>MFC to:</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>If the commit should be merged to a subset of stable branches, specify the branch names.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>MFH:</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>If the commit is to be merged into a ports quarterly branch name, specify the quarterly branch. For example <code>2021Q2</code>.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>Relnotes:</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>If the change is a candidate for inclusion in the release notes for the next release from the branch, set to <code>yes</code>.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>Security:</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>If the change is related to a security vulnerability or security exposure, include one or more references or a description of the issue. If possible, include a VuXML URL or a CVE ID.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>Event:</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>The description for the event where this commit was made. If this is a recurring event, add the year or even the month to it. For example, this could be <code>FooBSDcon 2019</code>. The idea behind this line is to put recognition to conferences, gatherings, and other types of meetups and to show that these are useful to have. Please do not use the <code>Sponsored by:</code> line for this as that is meant for organizations sponsoring certain features or developers working on them.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>Sponsored by:</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Sponsoring organizations for this change, if any. Separate multiple organizations with commas. If only a portion of the work was sponsored, or different amounts of sponsorship were provided to different authors, please give appropriate credit in parentheses after each sponsor name. For example, <code>Example.com (alice, code refactoring), Wormulon (bob), Momcorp (cindy)</code> shows that Alice was sponsored by Example.com to do code refactoring, while Wormulon sponsored Bob’s work and Momcorp sponsored Cindy’s work. Other authors were either not sponsored or chose not to list sponsorship.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>Pull Request:</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>This change was submitted as a pull request or merge request against one of FreeBSD’s public read-only Git repositories.
It should include the entire URL to the pull request, as these often act as code reviews for the code.
For example: <code><a href=https://github.com/freebsd/freebsd-src/pull/745 class=bare>https://github.com/freebsd/freebsd-src/pull/745</a></code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>Co-authored-by:</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>The name and email address of an additional author of the commit.
GitHub has a detailed description of the Co-authored-by trailer at <a href=https://docs.github.com/en/pull-requests/committing-changes-to-your-project/creating-and-editing-commits/creating-a-commit-with-multiple-authors class=bare>https://docs.github.com/en/pull-requests/committing-changes-to-your-project/creating-and-editing-commits/creating-a-commit-with-multiple-authors</a>.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>Signed-off-by:</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>ID certifies compliance with <a href=https://developercertificate.org/ class=bare>https://developercertificate.org/</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>Differential Revision:</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>The full URL of the Phabricator review. This line <em>must be the last line</em>. For example: <code><a href=https://reviews.freebsd.org/D1708 class=bare>https://reviews.freebsd.org/D1708</a></code>.</p></td></tr></tbody></table><div class=exampleblock><div class=title>Example 4. Commit Log for a Commit Based on a PR</div><div class=content><div class=paragraph><p>The commit is based on a patch from a PR submitted by John Smith.
The commit message "PR" field is filled.</p></div><div class="literalblock programlisting"><div class=content><pre>...

PR:		12345</pre></div></div><div class=paragraph><p>The committer sets the author of the patch with <code>git commit --author "John Smith &lt;<a href=mailto:John.Smith@example.com>John.Smith@example.com</a>>"</code>.</p></div></div></div><div class=exampleblock><div class=title>Example 5. Commit Log for a Commit Needing Review</div><div class=content><div class=paragraph><p>The virtual memory system is being changed.
After posting patches to the appropriate mailing list (in this case, <code>freebsd-arch</code>) and the changes have been approved.</p></div><div class="literalblock programlisting"><div class=content><pre>...

Reviewed by:	-arch</pre></div></div></div></div><div class=exampleblock><div class=title>Example 6. Commit Log for a Commit Needing Approval</div><div class=content><div class=paragraph><p>Commit a port, after working with the listed MAINTAINER, who said to go ahead and commit.</p></div><div class="literalblock programlisting"><div class=content><pre>...

Approved by:	abc (maintainer)</pre></div></div><div class=paragraph><p>Where <em>abc</em> is the account name of the person who approved.</p></div></div></div><div class=exampleblock><div class=title>Example 7. Commit Log for a Commit Bringing in Code from OpenBSD</div><div class=content><div class=paragraph><p>Committing some code based on work done in the OpenBSD project.</p></div><div class="literalblock programlisting"><div class=content><pre>...

Obtained from:	OpenBSD</pre></div></div></div></div><div class=exampleblock><div class=title>Example 8. Commit Log for a Change to FreeBSD-CURRENT with a Planned Commit to FreeBSD-STABLE to Follow at a Later Date.</div><div class=content><div class=paragraph><p>Committing some code which will be merged from FreeBSD-CURRENT into the FreeBSD-STABLE branch after two weeks.</p></div><div class="literalblock programlisting"><div class=content><pre>...

MFC after:	2 weeks</pre></div></div><div class=paragraph><p>Where <em>2</em> is the number of days, weeks, or months after which an MFC is planned. The <em>weeks</em> option may be <code>day</code>, <code>days</code>, <code>week</code>, <code>weeks</code>, <code>month</code>, <code>months</code>.</p></div></div></div><div class=paragraph><p>It is often necessary to combine these.</p></div><div class=paragraph><p>Consider the situation where a user has submitted a PR containing code from the NetBSD project.
Looking at the PR, the developer sees it is not an area of the tree they normally work in, so they have the change reviewed by the <code>arch</code> mailing list.
Since the change is complex, the developer opts to MFC after one month to allow adequate testing.</p></div><div class=paragraph><p>The extra information to include in the commit would look something like</p></div><div class=exampleblock><div class=title>Example 9. Example Combined Commit Log</div><div class=content><div class="literalblock programlisting"><div class=content><pre>PR:		54321
Reviewed by:	-arch
Obtained from:	NetBSD
MFC after:	1 month
Relnotes:	yes</pre></div></div></div></div></div></div></div><div class=sect1><h2 id=pref-license>10. Preferred License for New Files<a class=anchor href=#pref-license></a></h2><div class=sectionbody><div class=paragraph><p>The FreeBSD Project’s full license policy can be found at <a href=https://www.FreeBSD.org/internal/software-license/>https://www.FreeBSD.org/internal/software-license</a>.
The rest of this section is intended to help you get started.
As a rule, when in doubt, ask.
It is much easier to give advice than to fix the source tree.</p></div><div class=paragraph><p>The FreeBSD Project suggests and uses this text as the preferred license scheme:</p></div><div class="literalblock programlisting"><div class=content><pre>/*-
 * SPDX-License-Identifier: BSD-2-Clause
 *
 * Copyright (c) [year] [your name]
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS&#39;&#39; AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 *
 * [id for your version control system, if any]
 */</pre></div></div><div class=paragraph><p>The FreeBSD project strongly discourages the so-called "advertising clause" in new code.
Due to the large number of contributors to the FreeBSD project, complying with this clause for many commercial vendors has become difficult.
If you have code in the tree with the advertising clause, please consider removing it.
In fact, please consider using the above license for your code.</p></div><div class=paragraph><p>The FreeBSD project discourages completely new licenses and variations on the standard licenses.
New licenses require the approval of <a href=mailto:core@FreeBSD.org>core@FreeBSD.org</a> to reside in the <code>src</code> repository.
The more different licenses that are used in the tree, the more problems that this causes to those wishing to utilize this code, typically from unintended consequences from a poorly worded license.</p></div><div class=paragraph><p>Project policy dictates that code under some non-BSD licenses must be placed only in specific sections of the repository, and in some cases, compilation must be conditional or even disabled by default.
For example, the GENERIC kernel must be compiled under only licenses identical to or substantially similar to the BSD license.
GPL, APSL, CDDL, etc, licensed software must not be compiled into GENERIC.</p></div><div class=paragraph><p>Developers are reminded that in open source, getting "open" right is just as important as getting "source" right, as improper handling of intellectual property has serious consequences.
Any questions or concerns should immediately be brought to the attention of the core team.</p></div></div></div><div class=sect1><h2 id=tracking.license.grants>11. Keeping Track of Licenses Granted to the FreeBSD Project<a class=anchor href=#tracking.license.grants></a></h2><div class=sectionbody><div class=paragraph><p>Various software or data exist in the repositories where the FreeBSD project has been granted a special license to be able to use them.
A case in point are the Terminus fonts for use with <a href="https://man.freebsd.org/cgi/man.cgi?query=vt&amp;sektion=4&amp;format=html">vt(4)</a>.
Here the author Dimitar Zhekov has allowed us to use the "Terminus BSD Console" font under a 2-clause BSD license rather than the regular Open Font License he normally uses.</p></div><div class=paragraph><p>It is clearly sensible to keep a record of any such license grants.
To that end, the <a href=mailto:core@FreeBSD.org>core@FreeBSD.org</a> has decided to keep an archive of them.
Whenever the FreeBSD project is granted a special license we require the <a href=mailto:core@FreeBSD.org>core@FreeBSD.org</a> to be notified.
Any developers involved in arranging such a license grant, please send details to the <a href=mailto:core@FreeBSD.org>core@FreeBSD.org</a> including:</p></div><div class=ulist><ul><li><p>Contact details for people or organizations granting the special license.</p></li><li><p>What files, directories etc. in the repositories are covered by the license grant including the revision numbers where any specially licensed material was committed.</p></li><li><p>The date the license comes into effect from. Unless otherwise agreed, this will be the date the license was issued by the authors of the software in question.</p></li><li><p>The license text.</p></li><li><p>A note of any restrictions, limitations or exceptions that apply specifically to FreeBSD’s usage of the licensed material.</p></li><li><p>Any other relevant information.</p></li></ul></div><div class=paragraph><p>Once the <a href=mailto:core@FreeBSD.org>core@FreeBSD.org</a> is satisfied that all the necessary details have been gathered and are correct, the secretary will send a PGP-signed acknowledgment of receipt including the license details.
This receipt will be persistently archived and serve as our permanent record of the license grant.</p></div><div class=paragraph><p>The license archive should contain only details of license grants; this is not the place for any discussions around licensing or other subjects.
Access to data within the license archive will be available on request to the <a href=mailto:core@FreeBSD.org>core@FreeBSD.org</a>.</p></div></div></div><div class=sect1><h2 id=spdx.tags>12. SPDX Tags in the tree<a class=anchor href=#spdx.tags></a></h2><div class=sectionbody><div class=paragraph><p>The project uses <a href=https://spdx.dev>SPDX</a> tags in our source base.
At present, these tags are indented to help automated tools reconstruct license requirements mechanically.
All <em>SPDX-License-Identifier</em> tags in the tree should be considered to be informative.
All files in the FreeBSD source tree with these tags also have a copy of the license which governs use of that file.
In the event of a discrepancy, the verbatim license is controlling.
The project tries to follow the <a href=https://spdx.github.io/spdx-spec/>SPDX Specification, Version 2.2</a>.
How to mark source files and valid algebraic expressions are found in <a href=https://spdx.github.io/spdx-spec/appendix-IV-SPDX-license-expressions/>Appendix IV</a> and <a href=https://spdx.github.io/spdx-spec/appendix-V-using-SPDX-short-identifiers-in-source-files/>Appendix V</a>.
The project draws identifiers from SPDX’s list of valid <a href=https://spdx.org/licenses/>short license identifiers</a>.
The project uses only the <em>SPDX-License-Identifier</em> tag.</p></div><div class=paragraph><p>As of March 2021, approximately 25,000 out of 90,000 files in the tree have been marked.</p></div></div></div><div class=sect1><h2 id=developer.relations>13. Developer Relations<a class=anchor href=#developer.relations></a></h2><div class=sectionbody><div class=paragraph><p>When working directly on your own code or on code which is already well established as your responsibility, then there is probably little need to check with other committers before jumping in with a commit.
When working on a bug in an area of the system which is clearly orphaned (and there are a few such areas, to our shame), the same applies.
When modifying parts of the system which are maintained, formally or informally, consider asking for a review just as a developer would have before becoming a committer.
For ports, contact the listed <code>MAINTAINER</code> in the <span class=filename>Makefile</span>.</p></div><div class=paragraph><p>To determine if an area of the tree is maintained, check the MAINTAINERS file at the root of the tree.
If nobody is listed, scan the revision history to see who has committed changes in the past.
To list the names and email addresses of all commit authors for a given file in the last 2 years and the number of commits each has authored, ordered by descending number of commits, use:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git <span class=nt>-C</span> /path/to/repo shortlog <span class=nt>-sne</span> <span class=nt>--since</span><span class=o>=</span><span class=s2>&#34;2 years&#34;</span> <span class=nt>--</span> relative/path/to/file</code></pre></div></div><div class=paragraph><p>If queries go unanswered or the committer otherwise indicates a lack of interest in the area affected, go ahead and commit it.</p></div><div class="admonitionblock important"><table><tbody><tr><td class=icon><i class="fa icon-important" title=Important></i></td><td class=content><div class=paragraph><p>Avoid sending private emails to maintainers.
Other people might be interested in the conversation, not just the final output.</p></div></td></tr></tbody></table></div><div class=paragraph><p>If there is any doubt about a commit for any reason at all, have it reviewed before committing.
Better to have it flamed then and there rather than when it is part of the repository.
If a commit does results in controversy erupting, it may be advisable to consider backing the change out again until the matter is settled.
Remember, with a version control system we can always change it back.</p></div><div class=paragraph><p>Do not impugn the intentions of others.
If they see a different solution to a problem, or even a different problem, it is probably not because they are stupid, because they have questionable parentage, or because they are trying to destroy hard work, personal image, or FreeBSD, but basically because they have a different outlook on the world.
Different is good.</p></div><div class=paragraph><p>Disagree honestly.
Argue your position from its merits, be honest about any shortcomings it may have, and be open to seeing their solution, or even their vision of the problem, with an open mind.</p></div><div class=paragraph><p>Accept correction.
We are all fallible.
When you have made a mistake, apologize and get on with life.
Do not beat up yourself, and certainly do not beat up others for your mistake.
Do not waste time on embarrassment or recrimination, just fix the problem and move on.</p></div><div class=paragraph><p>Ask for help.
Seek out (and give) peer reviews.
One of the ways open source software is supposed to excel is in the number of eyeballs applied to it; this does not apply if nobody will review code.</p></div></div></div><div class=sect1><h2 id=if-in-doubt>14. If in Doubt…​<a class=anchor href=#if-in-doubt></a></h2><div class=sectionbody><div class=paragraph><p>When unsure about something, whether it be a technical issue or a project convention be sure to ask.
If you stay silent you will never make progress.</p></div><div class=paragraph><p>If it relates to a technical issue ask on the public mailing lists.
Avoid the temptation to email the individual person that knows the answer.
This way everyone will be able to learn from the question and the answer.</p></div><div class=paragraph><p>For project specific or administrative questions ask, in order:</p></div><div class=ulist><ul><li><p>Your mentor or former mentor.</p></li><li><p>An experienced committer on IRC, email, etc.</p></li><li><p>Any team with a "hat", as they can give you a definitive answer.</p></li><li><p>If still not sure, ask on FreeBSD developers mailing list.</p></li></ul></div><div class=paragraph><p>Once your question is answered, if no one pointed you to documentation that spelled out the answer to your question, document it, as others will have the same question.</p></div></div></div><div class=sect1><h2 id=bugzilla>15. Bugzilla<a class=anchor href=#bugzilla></a></h2><div class=sectionbody><div class=paragraph><p>The FreeBSD Project utilizes Bugzilla for tracking bugs and change requests.
If you commit a fix or suggestion found in the PR database, be sure to close the PR.
It is also considered nice if you take time to close any other PRs associated with your commits.</p></div><div class=paragraph><p>Committers with non-<code>FreeBSD.org</code> Bugzilla accounts can have the old account merged with the <code>FreeBSD.org</code> account by following these steps:</p></div><div class="exampleblock procedure"><div class=content><div class="olist arabic"><ol class=arabic><li><p>Log in using your old account.</p></li><li><p>Open new bug. Choose <code>Services</code> as the Product, and <code>Bug Tracker</code> as the Component. In bug description list accounts you wish to be merged.</p></li><li><p>Log in using <code>FreeBSD.org</code> account and post comment to newly opened bug to
confirm ownership. See <a href=../committers-guide/#kerberos-ldap>Kerberos and LDAP web Password for FreeBSD Cluster</a> for more details on how to generate or set a password for your <code>FreeBSD.org</code> account.</p></li><li><p>If there are more than two accounts to merge, post comments from each of them.</p></li></ol></div></div></div><div class=paragraph><p>You can find out more about Bugzilla at:</p></div><div class=ulist><ul><li><p><a href=https://docs.freebsd.org/en/articles/pr-guidelines/>FreeBSD Problem Report Handling Guidelines</a></p></li><li><p><a href=https://www.FreeBSD.org/support/>https://www.FreeBSD.org/support</a></p></li></ul></div></div></div><div class=sect1><h2 id=phabricator>16. Phabricator<a class=anchor href=#phabricator></a></h2><div class=sectionbody><div class=paragraph><p>The FreeBSD Project utilizes <a href=https://reviews.freebsd.org>Phabricator</a> for code review requests.
See the <a href=https://wiki.freebsd.org/Phabricator>Phabricator wiki page</a> for details.</p></div><div class=paragraph><p>Committers with non-<code>FreeBSD.org</code> Phabricator accounts can have the old account renamed to the <code>FreeBSD.org</code> account by following these steps:</p></div><div class="exampleblock procedure"><div class=content><div class="olist arabic"><ol class=arabic><li><p>Change your Phabricator account email to your <code>FreeBSD.org</code> email.</p></li><li><p>Open new bug on our bug tracker using your <code>FreeBSD.org</code> account, see
<a href=../committers-guide/#bugzilla>Bugzilla</a> for more information. Choose <code>Services</code> as the Product, and <code>Code Review</code> as the Component. In bug description request that your Phabricator account be renamed, and provide a link to your Phabricator user. For example, <code><a href=https://reviews.freebsd.org/p/bob_example.com/ class=bare>https://reviews.freebsd.org/p/bob_example.com/</a></code></p></li></ol></div></div></div><div class="admonitionblock important"><table><tbody><tr><td class=icon><i class="fa icon-important" title=Important></i></td><td class=content><div class=paragraph><p>Phabricator accounts cannot be merged, please do not open a new account.</p></div></td></tr></tbody></table></div></div></div><div class=sect1><h2 id=people>17. Who’s Who<a class=anchor href=#people></a></h2><div class=sectionbody><div class=paragraph><p>Besides the repository meisters, there are other FreeBSD project members and teams whom you will probably get to know in your role as a committer. Briefly, and by no means all-inclusively, these are:</p></div><div class=dlist><dl><dt class=hdlist1><code>Documentation Engineering Team &lt;<a href=mailto:doceng@FreeBSD.org>doceng@FreeBSD.org</a>></code></dt><dd><p>doceng is the group responsible for the documentation build infrastructure, approving new documentation committers, and ensuring that the FreeBSD website and documentation on the FTP site is up to date with respect to the Subversion tree.
It is not a conflict resolution body.
The vast majority of documentation related discussion takes place on the <a href=https://lists.FreeBSD.org/subscription/freebsd-doc>FreeBSD documentation project mailing list</a>.
More details regarding the doceng team can be found in its <a href=https://www.FreeBSD.org/internal/doceng/>charter</a>.
Committers interested in contributing to the documentation should familiarize themselves with the <a href=https://docs.freebsd.org/en/books/fdp-primer/>Documentation Project Primer</a>.</p></dd><dt class=hdlist1><code>Konstantin Belousov &lt;<a href=mailto:kib@FreeBSD.org>kib@FreeBSD.org</a>>, Dave Cottlehuber &lt;<a href=mailto:dch@FreeBSD.org>dch@FreeBSD.org</a>>, Marc Fonvieille &lt;<a href=mailto:blackend@FreeBSD.org>blackend@FreeBSD.org</a>>, John Hixson &lt;<a href=mailto:jhixson@FreeBSD.org>jhixson@FreeBSD.org</a>>, Xin Li &lt;<a href=mailto:delphij@FreeBSD.org>delphij@FreeBSD.org</a>>, Ed Maste &lt;<a href=mailto:emaste@FreeBSD.org>emaste@FreeBSD.org</a>>, Mahdi Mokhtari &lt;<a href=mailto:mmokhi@FreeBSD.org>mmokhi@FreeBSD.org</a>>, Colin Percival &lt;<a href=mailto:cperciva@FreeBSD.org>cperciva@FreeBSD.org</a>>, Doug Rabson &lt;<a href=mailto:dfr@FreeBSD.org>dfr@FreeBSD.org</a>>, Muhammad Moinur Rahman &lt;<a href=mailto:bofh@FreeBSD.org>bofh@FreeBSD.org</a>></code></dt><dd><p>These are the members of the <code>Release Engineering Team &lt;<a href=mailto:re@FreeBSD.org>re@FreeBSD.org</a>></code>.
This team is responsible for setting release deadlines and controlling the release process.
During code freezes, the release engineers have final authority on all changes to the system for whichever branch is pending release status.
If there is something you want merged from FreeBSD-CURRENT to FreeBSD-STABLE (whatever values those may have at any given time), these are the people to talk to about it.</p></dd><dt class=hdlist1><code>Gordon Tetlow &lt;<a href=mailto:gordon@FreeBSD.org>gordon@FreeBSD.org</a>></code></dt><dd><p><code>Gordon Tetlow</code> is the <a href=https://www.FreeBSD.org/security/>FreeBSD Security Officer</a> and oversees the <code>Security Officer Team &lt;<a href=mailto:security-officer@FreeBSD.org>security-officer@FreeBSD.org</a>></code>.</p></dd><dt class=hdlist1>FreeBSD committer’s mailing list</dt><dd><p>{dev-src-all}, {dev-ports-all} and {dev-doc-all} are the mailing lists that the version control system uses to send commit messages to.
<em>Never</em> send email directly to these lists.
Only send replies to this list when they are short and are directly related to a commit.</p></dd><dt class=hdlist1>FreeBSD developers mailing list</dt><dd><p>All committers are subscribed to -developers.
This list was created to be a forum for the committers "community" issues.
Examples are Core voting, announcements, etc.</p><div class=paragraph><p>The FreeBSD developers mailing list is for the exclusive use of FreeBSD committers.
To develop FreeBSD, committers must have the ability to openly discuss matters that will be resolved before they are publicly announced.
Frank discussions of work in progress are not suitable for open publication and may harm FreeBSD.</p></div><div class=paragraph><p>All FreeBSD committers are expected not to not publish or forward messages from the FreeBSD developers mailing list outside the list membership without permission of all of the authors.
Violators will be removed from the FreeBSD developers mailing list, resulting in a suspension of commit privileges.
Repeated or flagrant violations may result in permanent revocation of commit privileges.</p></div><div class=paragraph><p>This list is <em>not</em> intended as a place for code reviews or for any technical discussion.
In fact using it as such hurts the FreeBSD Project as it gives a sense of a closed list where general decisions affecting all of the FreeBSD using community are made without being "open".
Last, but not least <em>never, never ever, email the FreeBSD developers mailing list and CC:/BCC: another FreeBSD list</em>.
Never, ever email another FreeBSD email list and CC:/BCC: the FreeBSD developers mailing list.
Doing so can greatly diminish the benefits of this list.</p></div></dd></dl></div></div></div><div class=sect1><h2 id=ssh.guide>18. SSH Quick-Start Guide<a class=anchor href=#ssh.guide></a></h2><div class=sectionbody><div class="exampleblock procedure"><div class=content><div class="olist arabic"><ol class=arabic><li><p>If you do not wish to type your password in every time you use <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;format=html">ssh(1)</a>, and you use keys to authenticate, <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh-agent&amp;sektion=1&amp;format=html">ssh-agent(1)</a> is there for your convenience. If you want to use <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh-agent&amp;sektion=1&amp;format=html">ssh-agent(1)</a>, make sure that you run it before running other applications. X users, for example, usually do this from their <span class=filename>.xsession</span> or <span class=filename>.xinitrc</span>. See <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh-agent&amp;sektion=1&amp;format=html">ssh-agent(1)</a> for details.</p></li><li><p>Generate a key pair using <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh-keygen&amp;sektion=1&amp;format=html">ssh-keygen(1)</a>. The key pair will wind up in your <span class=filename>$HOME/.ssh/</span> directory.</p><div class="admonitionblock important"><table><tbody><tr><td class=icon><i class="fa icon-important" title=Important></i></td><td class=content><div class=paragraph><p>Only ECDSA, Ed25519 or RSA keys are supported.</p></div></td></tr></tbody></table></div></li><li><p>Send your public key (<span class=filename>$HOME/.ssh/id_ecdsa.pub</span>, <span class=filename>$HOME/.ssh/id_ed25519.pub</span>, or <span class=filename>$HOME/.ssh/id_rsa.pub</span>) to the person setting you up as a committer so it can be put into <span class=filename>yourlogin</span> in <span class=filename>/etc/ssh-keys/</span> on <code>freefall</code>.</p></li></ol></div></div></div><div class=paragraph><p>Now <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh-add&amp;sektion=1&amp;format=html">ssh-add(1)</a> can be used for authentication once per session.
It prompts for the private key’s pass phrase, and then stores it in the authentication agent (<a href="https://man.freebsd.org/cgi/man.cgi?query=ssh-agent&amp;sektion=1&amp;format=html">ssh-agent(1)</a>).
Use <code>ssh-add -d</code> to remove keys stored in the agent.</p></div><div class=paragraph><p>Test with a simple remote command: <code>ssh freefall.FreeBSD.org ls /usr</code>.</p></div><div class=paragraph><p>For more information, see <a class=package href=https://cgit.freebsd.org/ports/tree/security/openssh-portable/>security/openssh-portable</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;format=html">ssh(1)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh-add&amp;sektion=1&amp;format=html">ssh-add(1)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh-agent&amp;sektion=1&amp;format=html">ssh-agent(1)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh-keygen&amp;sektion=1&amp;format=html">ssh-keygen(1)</a>, and <a href="https://man.freebsd.org/cgi/man.cgi?query=scp&amp;sektion=1&amp;format=html">scp(1)</a>.</p></div><div class=paragraph><p>For information on adding, changing, or removing <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;format=html">ssh(1)</a> keys, see <a href=https://wiki.freebsd.org/clusteradm/ssh-keys>this article</a>.</p></div></div></div><div class=sect1><h2 id=coverity>19. Coverity® Availability for FreeBSD Committers<a class=anchor href=#coverity></a></h2><div class=sectionbody><div class=paragraph><p>All FreeBSD developers can obtain access to Coverity analysis results of all FreeBSD Project software.
All who are interested in obtaining access to the analysis results of the automated Coverity runs, can sign up at <a href=http://scan.coverity.com/>Coverity Scan</a>.</p></div><div class=paragraph><p>The FreeBSD wiki includes a mini-guide for developers who are interested in working with the Coverity® analysis reports: <a href=https://wiki.freebsd.org/CoverityPrevent>https://wiki.freebsd.org/CoverityPrevent</a>.
Please note that this mini-guide is only readable by FreeBSD developers, so if you cannot access this page, you will have to ask someone to add you to the appropriate Wiki access list.</p></div><div class=paragraph><p>Finally, all FreeBSD developers who are going to use Coverity® are always encouraged to ask for more details and usage information, by posting any questions to the mailing list of the FreeBSD developers.</p></div></div></div><div class=sect1><h2 id=rules>20. The FreeBSD Committers' Big List of Rules<a class=anchor href=#rules></a></h2><div class=sectionbody><div class=paragraph><p>Everyone involved with the FreeBSD project is expected to abide by the <em>Code of Conduct</em> available from <a href=https://www.FreeBSD.org/internal/code-of-conduct/>https://www.FreeBSD.org/internal/code-of-conduct</a>.
As committers, you form the public face of the project, and how you behave has a vital impact on the public perception of it.
This guide expands on the parts of the <em>Code of Conduct</em> specific to committers.</p></div><div class="olist arabic"><ol class=arabic><li><p>Respect other committers.</p></li><li><p>Respect other contributors.</p></li><li><p>Discuss any significant change <em>before</em> committing.</p></li><li><p>Respect existing maintainers (if listed in the <code>MAINTAINER</code> field in <span class=filename>Makefile</span> or in <span class=filename>MAINTAINER</span> in the top-level directory).</p></li><li><p>Any disputed change must be backed out pending resolution of the dispute if requested by a maintainer. Security related changes may override a maintainer’s wishes at the Security Officer’s discretion.</p></li><li><p>Changes go to FreeBSD-CURRENT before FreeBSD-STABLE unless specifically permitted by the release engineer or unless they are not applicable to FreeBSD-CURRENT. Any non-trivial or non-urgent change which is applicable should also be allowed to sit in FreeBSD-CURRENT for at least 3 days before merging so that it can be given sufficient testing. The release engineer has the same authority over the FreeBSD-STABLE branch as outlined for the maintainer in rule #5.</p></li><li><p>Do not fight in public with other committers; it looks bad.</p></li><li><p>Respect all code freezes and read the <code>committers</code> and <code>developers</code> mailing lists in a timely manner so you know when a code freeze is in effect.</p></li><li><p>When in doubt on any procedure, ask first!</p></li><li><p>Test your changes before committing them.</p></li><li><p>Do not commit to contributed software without <em>explicit</em> approval from the respective maintainers.</p></li></ol></div><div class=paragraph><p>As noted, breaking some of these rules can be grounds for suspension or, upon repeated offense, permanent removal of commit privileges.
Individual members of core have the power to temporarily suspend commit privileges until core as a whole has the chance to review the issue.
In case of an "emergency" (a committer doing damage to the repository), a temporary suspension may also be done by the repository meisters.
Only a 2/3 majority of core has the authority to suspend commit privileges for longer than a week or to remove them permanently.
This rule does not exist to set core up as a bunch of cruel dictators who can dispose of committers as casually as empty soda cans, but to give the project a kind of safety fuse.
If someone is out of control, it is important to be able to deal with this immediately rather than be paralyzed by debate.
In all cases, a committer whose privileges are suspended or revoked is entitled to a "hearing" by core, the total duration of the suspension being determined at that time.
A committer whose privileges are suspended may also request a review of the decision after 30 days and every 30 days thereafter (unless the total suspension period is less than 30 days).
A committer whose privileges have been revoked entirely may request a review after a period of 6 months has elapsed.
This review policy is <em>strictly informal</em> and, in all cases, core reserves the right to either act on or disregard requests for review if they feel their original decision to be the right one.</p></div><div class=paragraph><p>In all other aspects of project operation, core is a subset of committers and is bound by the <em>same rules</em>.
Just because someone is in core this does not mean that they have special dispensation to step outside any of the lines painted here; core’s "special powers" only kick in when it acts as a group, not on an individual basis.
As individuals, the core team members are all committers first and core second.</p></div><div class=sect2><h3 id=_details>20.1. Details<a class=anchor href=#_details></a></h3><div id=respect class="olist arabic"><ol class=arabic><li><p>Respect other committers.</p><div class=paragraph><p>This means that you need to treat other committers as the peer-group developers that they are.
Despite our occasional attempts to prove the contrary, one does not get to be a committer by being stupid and nothing rankles more than being treated that way by one of your peers.
Whether we always feel respect for one another or not (and everyone has off days), we still have to <em>treat</em> other committers with respect at all times, on public forums and in private email.</p></div><div class=paragraph><p>Being able to work together long term is this project’s greatest asset, one far more important than any set of changes to the code, and turning arguments about code into issues that affect our long-term ability to work harmoniously together is just not worth the trade-off by any conceivable stretch of the imagination.</p></div><div class=paragraph><p>To comply with this rule, do not send email when you are angry or otherwise behave in a manner which is likely to strike others as needlessly confrontational.
First calm down, then think about how to communicate in the most effective fashion for convincing the other persons that your side of the argument is correct, do not just blow off some steam so you can feel better in the short term at the cost of a long-term flame war.
Not only is this very bad "energy economics", but repeated displays of public aggression which impair our ability to work well together will be dealt with severely by the project leadership and may result in suspension or termination of your commit privileges.
The project leadership will take into account both public and private communications brought before it.
It will not seek the disclosure of private communications, but it will take it into account if it is volunteered by the committers involved in the complaint.</p></div><div class=paragraph><p>All of this is never an option which the project’s leadership enjoys in the slightest, but unity comes first.
No amount of code or good advice is worth trading that away.</p></div></li><li><p>Respect other contributors.</p><div class=paragraph><p>You were not always a committer.
At one time you were a contributor.
Remember that at all times.
Remember what it was like trying to get help and attention.
Do not forget that your work as a contributor was very important to you.
Remember what it was like. Do not discourage, belittle, or demean contributors.
Treat them with respect. They are our committers in waiting.
They are every bit as important to the project as committers.
Their contributions are as valid and as important as your own.
After all, you made many contributions before you became a committer.
Always remember that.</p></div><div class=paragraph><p>Consider the points raised under <a href=../committers-guide/#respect>Respect other committers</a> and apply them also to contributors.</p></div></li><li><p>Discuss any significant change <em>before</em> committing.</p><div class=paragraph><p>The repository is not where changes are initially submitted for correctness or argued over, that happens first in the mailing lists or by use of the Phabricator service.
The commit will only happen once something resembling consensus has been reached.
This does not mean that permission is required before correcting every obvious syntax error or manual page misspelling, just that it is good to develop a feel for when a proposed change is not quite such a no-brainer and requires some feedback first.
People really do not mind sweeping changes if the result is something clearly better than what they had before, they just do not like being <em>surprised</em> by those changes.
The very best way of making sure that things are on the right track is to have code reviewed by one or more other committers.</p></div><div class=paragraph><p>When in doubt, ask for review!</p></div></li><li><p>Respect existing maintainers if listed.</p><div class=paragraph><p>Many parts of FreeBSD are not "owned" in the sense that any specific individual will jump up and yell if you commit a change to "their" area, but it still pays to check first.
One convention we use is to put a maintainer line in the <span class=filename>Makefile</span> for any package or subtree which is being actively maintained by one or more people; see <a href=https://docs.freebsd.org/en/books/developers-handbook/#policies>Source Tree Guidelines and Policies</a> for documentation on this.
Where sections of code have several maintainers, commits to affected areas by one maintainer need to be reviewed by at least one other maintainer.
In cases where the "maintainer-ship" of something is not clear, look at the repository logs for the files in question and see if someone has been working recently or predominantly in that area.</p></div></li><li><p>Any disputed change must be backed out pending resolution of the dispute if requested by a maintainer. Security related changes may override a maintainer’s wishes at the Security Officer’s discretion.</p><div class=paragraph><p>This may be hard to swallow in times of conflict (when each side is convinced that they are in the right, of course) but a version control system makes it unnecessary to have an ongoing dispute raging when it is far easier to simply reverse the disputed change, get everyone calmed down again and then try to figure out what is the best way to proceed.
If the change turns out to be the best thing after all, it can be easily brought back.
If it turns out not to be, then the users did not have to live with the bogus change in the tree while everyone was busily debating its merits.
People <em>very</em> rarely call for back-outs in the repository since discussion generally exposes bad or controversial changes before the commit even happens, but on such rare occasions the back-out should be done without argument so that we can get immediately on to the topic of figuring out whether it was bogus or not.</p></div></li><li><p>Changes go to FreeBSD-CURRENT before FreeBSD-STABLE unless specifically permitted by the release engineer or unless they are not applicable to FreeBSD-CURRENT. Any non-trivial or non-urgent change which is applicable should also be allowed to sit in FreeBSD-CURRENT for at least 3 days before merging so that it can be given sufficient testing. The release engineer has the same authority over the FreeBSD-STABLE branch as outlined in rule #5.</p><div class=paragraph><p>This is another "do not argue about it" issue since it is the release engineer who is ultimately responsible (and gets beaten up) if a change turns out to be bad.
Please respect this and give the release engineer your full cooperation when it comes to the FreeBSD-STABLE branch.
The management of FreeBSD-STABLE may frequently seem to be overly conservative to the casual observer, but also bear in mind the fact that conservatism is supposed to be the hallmark of FreeBSD-STABLE and different rules apply there than in FreeBSD-CURRENT.
There is also really no point in having FreeBSD-CURRENT be a testing ground if changes are merged over to FreeBSD-STABLE immediately.
Changes need a chance to be tested by the FreeBSD-CURRENT developers, so allow some time to elapse before merging unless the FreeBSD-STABLE fix is critical, time sensitive or so obvious as to make further testing unnecessary (spelling fixes to manual pages, obvious bug/typo fixes, etc.) In other words, apply common sense.</p></div><div class=paragraph><p>Changes to the security branches (for example, <code>releng/9.3</code>) must be approved by a member of the <code>Security Officer Team &lt;<a href=mailto:security-officer@FreeBSD.org>security-officer@FreeBSD.org</a>></code>, or in some cases, by a member of the <code>Release Engineering Team &lt;<a href=mailto:re@FreeBSD.org>re@FreeBSD.org</a>></code>.</p></div></li><li><p>Do not fight in public with other committers; it looks bad.</p><div class=paragraph><p>This project has a public image to uphold and that image is very important to all of us, especially if we are to continue to attract new members.
There will be occasions when, despite everyone’s very best attempts at self-control, tempers are lost and angry words are exchanged.
The best thing that can be done in such cases is to minimize the effects of this until everyone has cooled back down.
Do not air angry words in public and do not forward private correspondence or other private communications to public mailing lists, mail aliases, instant messaging channels or social media sites.
What people say one-to-one is often much less sugar-coated than what they would say in public, and such communications therefore have no place there - they only serve to inflame an already bad situation.
If the person sending a flame-o-gram at least had the grace to send it privately, then have the grace to keep it private yourself.
If you feel you are being unfairly treated by another developer, and it is causing you anguish, bring the matter up with core rather than taking it public. Core will do its best to play peace makers and get things back to sanity.
In cases where the dispute involves a change to the codebase and the participants do not appear to be reaching an amicable agreement, core may appoint a mutually-agreeable third party to resolve the dispute.
All parties involved must then agree to be bound by the decision reached by this third party.</p></div></li><li><p>Respect all code freezes and read the <code>committers</code> and <code>developers</code> mailing list on a timely basis so you know when a code freeze is in effect.</p><div class=paragraph><p>Committing unapproved changes during a code freeze is a really big mistake and committers are expected to keep up-to-date on what is going on before jumping in after a long absence and committing 10 megabytes worth of accumulated stuff.
People who abuse this on a regular basis will have their commit privileges suspended until they get back from the FreeBSD Happy Reeducation Camp we run in Greenland.</p></div></li><li><p>When in doubt on any procedure, ask first!</p><div class=paragraph><p>Many mistakes are made because someone is in a hurry and just assumes they know the right way of doing something.
If you have not done it before, chances are good that you do not actually know the way we do things and really need to ask first or you are going to completely embarrass yourself in public.
There is no shame in asking "how in the heck do I do this?" We already know you are an intelligent person; otherwise, you would not be a committer.</p></div></li><li><p>Test your changes before committing them.</p><div class=paragraph><p>If your changes are to the kernel, make sure you can still compile both GENERIC and LINT.
If your changes are anywhere else, make sure you can still make world.
If your changes are to a branch, make sure your testing occurs with a machine which is running that code.
If you have a change which also may break another architecture, be sure and test on all supported architectures.
Please ensure your change works for
<a href=../committers-guide/#compilers>supported toolchains</a>.
Please refer to the <a href=https://www.FreeBSD.org/internal/>FreeBSD Internal Page</a> for a list of available resources.
As other architectures are added to the FreeBSD supported platforms list, the appropriate shared testing resources will be made available.</p></div></li><li><p>Do not commit to contributed software without <em>explicit</em> approval from the respective maintainers.</p><div class=paragraph><p>Contributed software is anything under the <span class=filename>src/contrib</span>, <span class=filename>src/crypto</span>, or <span class=filename>src/sys/contrib</span> trees.</p></div><div class=paragraph><p>The trees mentioned above are for contributed software usually imported onto a vendor branch.
Committing something there may cause unnecessary headaches when importing newer versions of the software.
As a general consider sending patches upstream to the vendor.
Patches may be committed to FreeBSD first with permission of the maintainer.</p></div><div class=paragraph><p>Reasons for modifying upstream software range from wanting strict control over a tightly coupled dependency to lack of portability in the canonical repository’s distribution of their code.
Regardless of the reason, effort to minimize the maintenance burden of fork is helpful to fellow maintainers.
Avoid committing trivial or cosmetic changes to files since it makes every merge thereafter more difficult: such patches need to be manually re-verified every import.</p></div><div class=paragraph><p>If a particular piece of software lacks a maintainer, you are encouraged to take up ownership.
If you are unsure of the current maintainership email <a href=https://lists.FreeBSD.org/subscription/freebsd-arch>FreeBSD architecture and design mailing list</a> and ask.</p></div></li></ol></div></div><div class=sect2><h3 id=_policy_on_multiple_architectures>20.2. Policy on Multiple Architectures<a class=anchor href=#_policy_on_multiple_architectures></a></h3><div class=paragraph><p>FreeBSD has added several new architecture ports during recent release cycles and is truly no longer an i386™ centric operating system.
In an effort to make it easier to keep FreeBSD portable across the platforms we support, core has developed this mandate:</p></div><div class="paragraph blockquote"><p>Our 32-bit reference platform is i386, and our 64-bit reference platform is amd64.
Major design work (including major API and ABI changes) must prove itself on at least one 32-bit and at least one 64-bit platform, preferably the primary reference platforms, before it may be committed to the source tree.</p></div><div class=paragraph><p>Developers should also be aware of our Tier Policy for the long term support of hardware architectures.
The rules here are intended to provide guidance during the development process, and are distinct from the requirements for features and architectures listed in that section.
The Tier rules for feature support on architectures at release-time are more strict than the rules for changes during the development process.</p></div></div><div class=sect2><h3 id=compilers>20.3. Policy on Multiple Compilers<a class=anchor href=#compilers></a></h3><div class=paragraph><p>FreeBSD builds with both Clang and GCC.
The project does this in a careful and controlled way to maximize benefits from this extra work, while keeping the extra work to a minimum.
Supporting both Clang and GCC improves the flexibility our users have.
These compilers have different strengths and weaknesses, and supporting both allows users to pick the best one for their needs.
Clang and GCC support similar dialects of C and C++, necessitating a relatively small amount of conditional code.
The project gains increased code coverage and improves the code quality by using features from both compilers.
The project is able to build in more user environments and leverage more CI environments by supporting this range, increasing convenience for users and giving them more tools to test with.
By carefully constraining the range of versions supported to modern versions of these compilers, the project avoids unduly increasing the testing matrix.
Older and obscure compilers, as well as older dialects of the languages, have extremely limited support that allow user programs to build with them, but without constraining the base system to being built with them.
The exact balance continues to evolve to ensure the benefits of extra work remain greater than the burdens it imposes.
The project used to support really old Intel compilers or old GCC versions, but we traded supporting those obsolete compilers for a carefully selected range of modern compilers.
This section documents where we use different compilers, and the expectations around that.</p></div><div class=paragraph><p>The FreeBSD project provides an in-tree Clang compiler.
Due to being in the tree, this compiler is the most supported compiler.
All changes must compile with it, prior to commit.
Complete testing, as appropriate for the change, should be done with this compiler.</p></div><div class=paragraph><p>At any moment in time, the FreeBSD project also supports one or more out-of-tree compilers.
At present, this is GCC 12.x.
Ideally, committers should test compile with this compiler, especially for large or risky changes.
This compiler is available as the <code>${TARGET_ARCH}-gcc${VERSION}</code> package, such as <a class=package href=https://cgit.freebsd.org/ports/tree/devel/freebsd-gcc12/>aarch64-gcc12</a> or <a class=package href=https://cgit.freebsd.org/ports/tree/devel/freebsd-gcc12/>riscv64-gcc12</a>.
The project runs automated CI jobs to build everything with these compilers.
Committers are expected to fix the jobs they break with their changes.
Committers may test build with, for example <code>CROSS_TOOLCHAIN=aarch64-gcc12</code> or <code>CROSS_TOOLCHAIN=llvm15</code> where necessary.</p></div><div class=paragraph><p>The FreeBSD project also has some CI pipelines on github.
For pull requests on github and some branches pushed to the github forks, a number of cross compilation jobs run.
These test FreeBSD building using a version of Clang that sometimes lags the in-tree compiler by a major version for a time.</p></div><div class=paragraph><p>The FreeBSD project is also upgrading compilers.
Both Clang and GCC are fast moving targets.
Some work to change things in the tree, for example removing the old-style K&amp;R function declarations and definitions, will land in the tree prior to the compiler landing.
Committers should try to be mindful about this and be receptive to looking into problems with their code or changes with these new compilers.
Also, just after a new compiler version hits the tree, people may need to compile things with the old version if there was an undetected regression suspected.</p></div><div class=paragraph><p>In addition to the compiler, LLVM’s LLD and GNU’s binutils are used indirectly by the compiler.
Committers should be mindful of variations in assembler syntax and features of the linkers and ensure both variants work.
These components will be tested as part of FreeBSD’s CI jobs for Clang or GCC.</p></div><div class=paragraph><p>The FreeBSD project provides headers and libraries that allow other compilers to be used to build software not in the base system.
These headers have support for making the environment as strict as the standard, supporting prior dialects of ANSI-C back to C89, and other edge cases our large ports collection has uncovered.
This support constrains retirement of older standards in places like header files, but does not constrain updating the base system to newer dialects.
Nor does it require the base system to compile with these older standards as a whole.
Breaking this support will cause packages in the ports collection to fail, so should be avoided where possible, and promptly fixed when it is easy to do so.</p></div><div class=paragraph><p>The FreeBSD build system currently accommodates these different environments.
As new warnings are added to compilers, the project tries to fix them.
However, sometimes these warnings require extensive rework, so are suppressed in some way by using make variables that evaluate to the proper thing depending on the compiler version.
Developers should be mindful of this, and ensure any compiler specific flags are properly conditionalized.</p></div><div class=sect3><h4 id=_current_compiler_versions>20.3.1. Current Compiler Versions<a class=anchor href=#_current_compiler_versions></a></h4><div class=paragraph><p>The in-tree compiler is currently Clang 15.x.
Currently, GCC 12 and Clang 12, 13, 14 and 15 are tested in the github and project’s CI jenkins jobs.
Work is underway to get the tree ready for Clang 16.
The oldest project supported branch has Clang 12, so the bootstrap portions of the build must work for Clang major versions 12 to 15.</p></div></div></div><div class=sect2><h3 id=_other_suggestions>20.4. Other Suggestions<a class=anchor href=#_other_suggestions></a></h3><div class=paragraph><p>When committing documentation changes, use a spell checker before committing.
For all XML docs, verify that the formatting directives are correct by running <code>make lint</code> and <a class=package href=https://cgit.freebsd.org/ports/tree/textproc/igor/>textproc/igor</a>.</p></div><div class=paragraph><p>For manual pages, run <a class=package href=https://cgit.freebsd.org/ports/tree/sysutils/manck/>sysutils/manck</a> and <a class=package href=https://cgit.freebsd.org/ports/tree/textproc/igor/>textproc/igor</a> over the manual page to verify all of the cross references and file references are correct and that the man page has all of the appropriate <code>MLINKS</code> installed.</p></div><div class=paragraph><p>Do not mix style fixes with new functionality.
A style fix is any change which does not modify the functionality of the code.
Mixing the changes obfuscates the functionality change when asking for differences between revisions, which can hide any new bugs.
Do not include whitespace changes with content changes in commits to <span class=filename>doc/</span>.
The extra clutter in the diffs makes the translators' job much more difficult.
Instead, make any style or whitespace changes in separate commits that are clearly labeled as such in the commit message.</p></div></div><div class=sect2><h3 id=_deprecating_features>20.5. Deprecating Features<a class=anchor href=#_deprecating_features></a></h3><div class=paragraph><p>When it is necessary to remove functionality from software in the base system, follow these guidelines whenever possible:</p></div><div class="olist arabic"><ol class=arabic><li><p>Mention is made in the manual page and possibly the release notes that the option, utility, or interface is deprecated. Use of the deprecated feature generates a warning.</p></li><li><p>The option, utility, or interface is preserved until the next major (point zero) release.</p></li><li><p>The option, utility, or interface is removed and no longer documented. It is now obsolete. It is also generally a good idea to note its removal in the release notes.</p></li></ol></div></div><div class=sect2><h3 id=_privacy_and_confidentiality>20.6. Privacy and Confidentiality<a class=anchor href=#_privacy_and_confidentiality></a></h3><div class="olist arabic"><ol class=arabic><li><p>Most FreeBSD business is done in public.</p><div class=paragraph><p>FreeBSD is an <em>open</em> project.
Which means that not only can anyone use the source code, but that most of the development process is open to public scrutiny.</p></div></li><li><p>Certain sensitive matters must remain private or held under embargo.</p><div class=paragraph><p>There unfortunately cannot be complete transparency.
As a FreeBSD developer you will have a certain degree of privileged access to information.
Consequently you are expected to respect certain requirements for confidentiality.
Sometimes the need for confidentiality comes from external collaborators or has a specific time limit.
Mostly though, it is a matter of not releasing private communications.</p></div></li><li><p>The Security Officer has sole control over the release of security advisories.</p><div class=paragraph><p>Where there are security problems that affect many different operating systems, FreeBSD frequently depends on early access to be able to prepare advisories for coordinated release.
Unless FreeBSD developers can be trusted to maintain security, such early access will not be made available.
The Security Officer is responsible for controlling pre-release access to information about vulnerabilities, and for timing the release of all advisories.
He may request help under condition of confidentiality from any developer with relevant knowledge to prepare security fixes.</p></div></li><li><p>Communications with Core are kept confidential for as long as necessary.</p><div class=paragraph><p>Communications to core will initially be treated as confidential.
Eventually however, most of Core’s business will be summarized into the monthly or quarterly core reports.
Care will be taken to avoid publicising any sensitive details.
Records of some particularly sensitive subjects may not be reported on at all and will be retained only in Core’s private archives.</p></div></li><li><p>Non-disclosure Agreements may be required for access to certain commercially sensitive data.</p><div class=paragraph><p>Access to certain commercially sensitive data may only be available under a Non-Disclosure Agreement.
The FreeBSD Foundation legal staff must be consulted before any binding agreements are entered into.</p></div></li><li><p>Private communications must not be made public without permission.</p><div class=paragraph><p>Beyond the specific requirements above there is a general expectation not to publish private communications between developers without the consent of all parties involved.
Ask permission before forwarding a message onto a public mailing list, or posting it to a forum or website that can be accessed by other than the original correspondents.</p></div></li><li><p>Communications on project-only or restricted access channels must be kept private.</p><div class=paragraph><p>Similarly to personal communications, certain internal communications channels, including FreeBSD Committer only mailing lists and restricted access IRC channels are considered private communications.
Permission is required to publish material from these sources.</p></div></li><li><p>Core may approve publication.</p><div class=paragraph><p>Where it is impractical to obtain permission due to the number of correspondents or where permission to publish is unreasonably withheld, Core may approve release of such private matters that merit more general publication.</p></div></li></ol></div></div></div></div><div class=sect1><h2 id=archs>21. Support for Multiple Architectures<a class=anchor href=#archs></a></h2><div class=sectionbody><div class=paragraph><p>FreeBSD is a highly portable operating system intended to function on many different types of hardware architectures.
Maintaining clean separation of Machine Dependent (MD) and Machine Independent (MI) code, as well as minimizing MD code, is an important part of our strategy to remain agile with regards to current hardware trends.
Each new hardware architecture supported by FreeBSD adds substantially to the cost of code maintenance, toolchain support, and release engineering.
It also dramatically increases the cost of effective testing of kernel changes.
As such, there is strong motivation to differentiate between classes of support for various architectures while remaining strong in a few key architectures that are seen as the FreeBSD "target audience".</p></div><div class=sect2><h3 id=_statement_of_general_intent>21.1. Statement of General Intent<a class=anchor href=#_statement_of_general_intent></a></h3><div class=paragraph><p>The FreeBSD Project targets "production quality commercial off-the-shelf (COTS) workstation, server, and high-end embedded systems".
By retaining a focus on a narrow set of architectures of interest in these environments, the FreeBSD Project is able to maintain high levels of quality, stability, and performance, as well as minimize the load on various support teams on the project, such as the ports team, documentation team, security officer, and release engineering teams.
Diversity in hardware support broadens the options for FreeBSD consumers by offering new features and usage opportunities, but these benefits must always be carefully considered in terms of the real-world maintenance cost associated with additional platform support.</p></div><div class=paragraph><p>The FreeBSD Project differentiates platform targets into four tiers.
Each tier includes a list of guarantees consumers may rely on as well as obligations by the Project and developers to fulfill those guarantees.
These lists define the minimum guarantees for each tier.
The Project and developers may provide additional levels of support beyond the minimum guarantees for a given tier, but such additional support is not guaranteed.
Each platform target is assigned to a specific tier for each stable branch.
As a result, a platform target might be assigned to different tiers on concurrent stable branches.</p></div></div><div class=sect2><h3 id=_platform_targets>21.2. Platform Targets<a class=anchor href=#_platform_targets></a></h3><div class=paragraph><p>Support for a hardware platform consists of two components: kernel support and userland Application Binary Interfaces (ABIs).
Kernel platform support includes things needed to run a FreeBSD kernel on a hardware platform such as machine-dependent virtual memory management and device drivers.
A userland ABI specifies an interface for user processes to interact with a FreeBSD kernel and base system libraries.
A userland ABI includes system call interfaces, the layout and semantics of public data structures, and the layout and semantics of arguments passed to subroutines.
Some components of an ABI may be defined by specifications such as the layout of C++ exception objects or calling conventions for C functions.</p></div><div class=paragraph><p>A FreeBSD kernel also uses an ABI (sometimes referred to as the Kernel Binary Interface (KBI)) which includes the semantics and layouts of public data structures and the layout and semantics of arguments to public functions within the kernel itself.</p></div><div class=paragraph><p>A FreeBSD kernel may support multiple userland ABIs.
For example, FreeBSD’s amd64 kernel supports FreeBSD amd64 and i386 userland ABIs as well as Linux x86_64 and i386 userland ABIs.
A FreeBSD kernel should support a "native" ABI as the default ABI.
The native "ABI" generally shares certain properties with the kernel ABI such as the C calling convention, sizes of basic types, etc.</p></div><div class=paragraph><p>Tiers are defined for both kernels and userland ABIs. In the common case, a platform’s kernel and FreeBSD ABIs are assigned to the same tier.</p></div><div class=sect3><h4 id=_tier_1_fully_supported_architectures>21.2.1. Tier 1: Fully-Supported Architectures<a class=anchor href=#_tier_1_fully_supported_architectures></a></h4><div class=paragraph><p>Tier 1 platforms are the most mature FreeBSD platforms.
They are supported by the security officer, release engineering, and Ports Management Team.
Tier 1 architectures are expected to be Production Quality with respect to all aspects of the FreeBSD operating system, including installation and development environments.</p></div><div class=paragraph><p>The FreeBSD Project provides the following guarantees to consumers of Tier 1 platforms:</p></div><div class=ulist><ul><li><p>Official FreeBSD release images will be provided by the release engineering team.</p></li><li><p>Binary updates and source patches for Security Advisories and Errata Notices will be provided for supported releases.</p></li><li><p>Source patches for Security Advisories will be provided for supported branches.</p></li><li><p>Binary updates and source patches for cross-platform Security Advisories will typically be provided at the time of the announcement.</p></li><li><p>Changes to userland ABIs will generally include compatibility shims to ensure correct operation of binaries compiled against any stable branch where the platform is Tier 1. These shims might not be enabled in the default install. If compatibility shims are not provided for an ABI change, the lack of shims will be clearly documented in the release notes.</p></li><li><p>Changes to certain portions of the kernel ABI will include compatibility shims to ensure correct operation of kernel modules compiled against the oldest supported release on the branch. Note that not all parts of the kernel ABI are protected.</p></li><li><p>Official binary packages for third party software will be provided by the ports team. For embedded architectures, these packages may be cross-built from a different architecture.</p></li><li><p>Most relevant ports should either build or have the appropriate filters to prevent inappropriate ones from building.</p></li><li><p>New features which are not inherently platform-specific will be fully functional on all Tier 1 architectures.</p></li><li><p>Features and compatibility shims used by binaries compiled against older stable branches may be removed in newer major versions. Such removals will be clearly documented in the release notes.</p></li><li><p>Tier 1 platforms should be fully documented. Basic operations will be documented in the FreeBSD Handbook.</p></li><li><p>Tier 1 platforms will be included in the source tree.</p></li><li><p>Tier 1 platforms should be self-hosting either via the in-tree toolchain or an external toolchain. If an external toolchain is required, official binary packages for an external toolchain will be provided.</p></li></ul></div><div class=paragraph><p>To maintain maturity of Tier 1 platforms, the FreeBSD Project will maintain the following resources to support development:</p></div><div class=ulist><ul><li><p>Build and test automation support either in the FreeBSD.org cluster or some other location easily available for all developers. Embedded platforms may substitute an emulator available in the FreeBSD.org cluster for actual hardware.</p></li><li><p>Inclusion in the <code>make universe</code> and <code>make tinderbox</code> targets.</p></li><li><p>Dedicated hardware in one of the FreeBSD clusters for package building (either natively or via qemu-user).</p></li></ul></div><div class=paragraph><p>Collectively, developers are required to provide the following to maintain the Tier 1 status of a platform:</p></div><div class=ulist><ul><li><p>Changes to the source tree should not knowingly break the build of a Tier 1 platform.</p></li><li><p>Tier 1 architectures must have a mature, healthy ecosystem of users and active developers.</p></li><li><p>Developers should be able to build packages on commonly available, non-embedded Tier 1 systems. This can mean either native builds if non-embedded systems are commonly available for the platform in question, or it can mean cross-builds hosted on some other Tier 1 architecture.</p></li><li><p>Changes cannot break the userland ABI. If an ABI change is required, ABI compatibility for existing binaries should be provided via use of symbol versioning or shared library version bumps.</p></li><li><p>Changes merged to stable branches cannot break the protected portions of the kernel ABI. If a kernel ABI change is required, the change should be modified to preserve functionality of existing kernel modules.</p></li></ul></div></div><div class=sect3><h4 id=_tier_2_developmental_and_niche_architectures>21.2.2. Tier 2: Developmental and Niche Architectures<a class=anchor href=#_tier_2_developmental_and_niche_architectures></a></h4><div class=paragraph><p>Tier 2 platforms are functional, but less mature FreeBSD platforms.
They are not supported by the security officer, release engineering, and Ports Management Team.</p></div><div class=paragraph><p>Tier 2 platforms may be Tier 1 platform candidates that are still under active development.
Architectures reaching end of life may also be moved from Tier 1 status to Tier 2 status as the availability of resources to continue to maintain the system in a Production Quality state diminishes.
Well-supported niche architectures may also be Tier 2.</p></div><div class=paragraph><p>The FreeBSD Project provides the following guarantees to consumers of Tier 2 platforms:</p></div><div class=ulist><ul><li><p>The ports infrastructure should include basic support for Tier 2 architectures sufficient to support building ports and packages. This includes support for basic packages such as ports-mgmt/pkg, but there is no guarantee that arbitrary ports will be buildable or functional.</p></li><li><p>New features which are not inherently platform-specific should be feasible on all Tier 2 architectures if not implemented.</p></li><li><p>Tier 2 platforms will be included in the source tree.</p></li><li><p>Tier 2 platforms should be self-hosting either via the in-tree toolchain or an external toolchain. If an external toolchain is required, official binary packages for an external toolchain will be provided.</p></li><li><p>Tier 2 platforms should provide functional kernels and userlands even if an official release distribution is not provided.</p></li></ul></div><div class=paragraph><p>To maintain maturity of Tier 2 platforms, the FreeBSD Project will maintain the following resources to support development:</p></div><div class=ulist><ul><li><p>Inclusion in the <code>make universe</code> and <code>make tinderbox</code> targets.</p></li></ul></div><div class=paragraph><p>Collectively, developers are required to provide the following to maintain the Tier 2 status of a platform:</p></div><div class=ulist><ul><li><p>Changes to the source tree should not knowingly break the build of a Tier 2 platform.</p></li><li><p>Tier 2 architectures must have an active ecosystem of users and developers.</p></li><li><p>While changes are permitted to break the userland ABI, the ABI should not be broken gratuitously. Significant userland ABI changes should be restricted to major versions.</p></li><li><p>New features that are not yet implemented on Tier 2 architectures should provide a means of disabling them on those architectures.</p></li></ul></div></div><div class=sect3><h4 id=_tier_3_experimental_architectures>21.2.3. Tier 3: Experimental Architectures<a class=anchor href=#_tier_3_experimental_architectures></a></h4><div class=paragraph><p>Tier 3 platforms have at least partial FreeBSD support.
They are <em>not</em> supported by the security officer, release engineering, and Ports Management Team.</p></div><div class=paragraph><p>Tier 3 platforms are architectures in the early stages of development, for non-mainstream hardware platforms, or which are considered legacy systems unlikely to see broad future use.
Initial support for Tier 3 platforms may exist in a separate repository rather than the main source repository.</p></div><div class=paragraph><p>The FreeBSD Project provides no guarantees to consumers of Tier 3 platforms and is not committed to maintaining resources to support development.
Tier 3 platforms may not always be buildable, nor are any kernel or userland ABIs considered stable.</p></div></div><div class=sect3><h4 id=_unsupported_architectures>21.2.4. Unsupported Architectures<a class=anchor href=#_unsupported_architectures></a></h4><div class=paragraph><p>Other platforms are not supported in any form by the project.
The project previously described these as Tier 4 systems.</p></div><div class=paragraph><p>After a platform transitions to unsupported, all support for the platform is removed from the source, ports and documentation trees.
Note that ports support should remain as long as the platform is supported in a branch supported by ports.</p></div></div></div><div class=sect2><h3 id=_policy_on_changing_the_tier_of_an_architecture>21.3. Policy on Changing the Tier of an Architecture<a class=anchor href=#_policy_on_changing_the_tier_of_an_architecture></a></h3><div class=paragraph><p>Systems may only be moved from one tier to another by approval of the FreeBSD Core Team, which shall make that decision in collaboration with the Security Officer, Release Engineering, and ports management teams.
For a platform to be promoted to a higher tier, any missing support guarantees must be satisfied before the promotion is completed.</p></div></div></div></div><div class=sect1><h2 id=ports>22. Ports Specific FAQ<a class=anchor href=#ports></a></h2><div class=sectionbody><div class=sect2><h3 id=ports-qa-adding>22.1. Adding a New Port<a class=anchor href=#ports-qa-adding></a></h3><div class=sect3><h4 id=ports-qa-add-new>22.1.1. How do I add a new port?<a class=anchor href=#ports-qa-add-new></a></h4><div class=paragraph><p>Adding a port to the tree is relatively simple. Once the port is ready to be
added, as explained later <a href=../committers-guide/#ports-qa-add-new-extra>here</a>, you need to add the port’s directory entry in the category’s <span class=filename>Makefile</span>.
In this <span class=filename>Makefile</span>, ports are listed in alphabetical order and added to the <code>SUBDIR</code> variable, like this:</p></div><div class="literalblock programlisting"><div class=content><pre>	SUBDIR += newport</pre></div></div><div class=paragraph><p>Once the port and its category’s Makefile are ready, the new port can be committed:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git add category/Makefile category/newport
% git commit
% git push</code></pre></div></div><div class="admonitionblock tip"><table><tbody><tr><td class=icon><i class="fa icon-tip" title=Tip></i></td><td class=content><div class=paragraph><p>Don’t forget to <a href=../committers-guide/#port-commit-message-formats>setup git hooks for the ports tree as explained here</a>; a specific hook has been developed to verify the category’s <span class=filename>Makefile</span>.</p></div></td></tr></tbody></table></div></div><div class=sect3><h4 id=ports-qa-add-new-extra>22.1.2. Any other things I need to know when I add a new port?<a class=anchor href=#ports-qa-add-new-extra></a></h4><div class=paragraph><p>Check the port, preferably to make sure it compiles and packages correctly.</p></div><div class=paragraph><p>The <a href=https://docs.freebsd.org/en/books/porters-handbook/testing>Porters Handbook’s Testing Chapter</a> contains more detailed instructions.
See the <a href=https://docs.freebsd.org/en/books/porters-handbook/testing#testing-portclippy>Portclippy / Portfmt</a> and the <a href=https://docs.freebsd.org/en/books/porters-handbook/testing#testing-poudriere>poudriere</a> sections.</p></div><div class=paragraph><p>You do not necessarily have to eliminate all warnings but make sure you have fixed the simple ones.</p></div><div class=paragraph><p>If the port came from a submitter who has not contributed to the Project before, add that person’s name to the <a href=https://docs.freebsd.org/en/articles/contributors/#contrib-additional>Additional Contributors</a> section of the FreeBSD Contributors List.</p></div><div class=paragraph><p>Close the PR if the port came in as a PR.
To close a PR, change the state to <code>Issue Resolved</code> and the resolution as <code>Fixed</code>.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>If for some reason using <a href=https://docs.freebsd.org/en/books/porters-handbook/testing#testing-poudriere>poudriere</a> to test the new port is not possible, the bare minimum of testing includes this sequence:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># make install</span>
<span class=c># make package</span>
<span class=c># make deinstall</span>
<span class=c># pkg add package you built above</span>
<span class=c># make deinstall</span>
<span class=c># make reinstall</span>
<span class=c># make package</span></code></pre></div></div><div class=paragraph><p>Note that poudriere is the reference for package building, it the port does not build in poudriere, it will be removed.</p></div></td></tr></tbody></table></div></div></div><div class=sect2><h3 id=ports-qa-removing>22.2. Removing an Existing Port<a class=anchor href=#ports-qa-removing></a></h3><div class=sect3><h4 id=ports-qa-remove-one>22.2.1. How do I remove an existing port?<a class=anchor href=#ports-qa-remove-one></a></h4><div class=paragraph><p>First, please read the section about repository copies. Before you remove the port, you have to verify there are no other ports depending on it.</p></div><div class=ulist><ul><li><p>Make sure there is no dependency on the port in the ports collection:</p><div class=ulist><ul><li><p>The port’s PKGNAME appears in exactly one line in a recent INDEX file.</p></li><li><p>No other ports contains any reference to the port’s directory or PKGNAME in their Makefiles</p><div class="admonitionblock tip"><table><tbody><tr><td class=icon><i class="fa icon-tip" title=Tip></i></td><td class=content><div class=paragraph><p>When using Git, consider using <a href="https://man.freebsd.org/cgi/man.cgi?query=git-grep&amp;sektion=1&amp;format=html">git-grep(1)</a>, it is much faster than <code>grep -r</code>.</p></div></td></tr></tbody></table></div></li></ul></div></li><li><p>Then, remove the port:</p><div class="exampleblock procedure"><div class=content><div class=ulist><ul><li><p>Remove the port’s files and directory with <code>git rm</code>.</p></li><li><p>Remove the <code>SUBDIR</code> listing of the port in the parent directory <span class=filename>Makefile</span>.</p></li><li><p>Add an entry to <span class=filename>ports/MOVED</span>.</p></li><li><p>Remove the port from <span class=filename>ports/LEGAL</span> if it is there.</p></li></ul></div></div></div></li></ul></div><div class=paragraph><p>Alternatively, you can use the rmport script, from <span class=filename>ports/Tools/scripts</span>.
This script was written by Vasil Dimov &lt;<a href=mailto:vd@FreeBSD.org>vd@FreeBSD.org</a>>.
When sending questions about this script to the <a href=https://lists.FreeBSD.org/subscription/freebsd-ports>FreeBSD ports mailing list</a>, please also CC Chris Rees &lt;<a href=mailto:crees@FreeBSD.org>crees@FreeBSD.org</a>>, the current maintainer.</p></div></div></div><div class=sect2><h3 id=ports-qa-move-port>22.3. How do I move a port to a new location?<a class=anchor href=#ports-qa-move-port></a></h3><div class="exampleblock procedure"><div class=content><div class="olist arabic"><ol class=arabic><li><p>Perform a thorough check of the ports collection for any dependencies on the old port location/name, and update them. Running <code>grep</code> on <span class=filename>INDEX</span> is not enough because some ports have dependencies enabled by compile-time options. A full <a href="https://man.freebsd.org/cgi/man.cgi?query=git-grep&amp;sektion=1&amp;format=html">git-grep(1)</a> of the ports collection is recommended.</p></li><li><p>Remove the <code>SUBDIR</code> entry from the old category Makefile and add a <code>SUBDIR</code> entry to the new category Makefile.</p></li><li><p>Add an entry to <span class=filename>ports/MOVED</span>.</p></li><li><p>Search for entries in xml files inside <span class=filename>ports/security/vuxml</span> and adjust them accordingly. In particular, check for previous packages with the new name which version could include the new port.</p></li><li><p>Move the port with <code>git mv</code>.</p></li><li><p>Commit the changes.</p></li></ol></div></div></div></div><div class=sect2><h3 id=ports-qa-copy-port>22.4. How do I copy a port to a new location?<a class=anchor href=#ports-qa-copy-port></a></h3><div class="exampleblock procedure"><div class=content><div class="olist arabic"><ol class=arabic><li><p>Copy port with <code>cp -R old-cat/old-port new-cat/new-port</code>.</p></li><li><p>Add the new port to the <span class=filename>new-cat/Makefile</span>.</p></li><li><p>Change stuff in <span class=filename>new-cat/new-port</span>.</p></li><li><p>Commit the changes.</p></li></ol></div></div></div></div><div class=sect2><h3 id=ports-qa-freeze>22.5. Ports Freeze<a class=anchor href=#ports-qa-freeze></a></h3><div class=sect3><h4 id=ports-qa-freeze-what>22.5.1. What is a “ports freeze”?<a class=anchor href=#ports-qa-freeze-what></a></h4><div class=paragraph><p>A “ports freeze” was a restricted state the ports tree was put in before a release.
It was used to ensure a higher quality for the packages shipped with a release.
It usually lasted a couple of weeks.
During that time, build problems were fixed, and the release packages were built.
This practice is no longer used, as the packages for the releases are built from the current stable, quarterly branch.</p></div><div class=paragraph><p>For more information on how to merge commits to the quarterly branch, see
<a href=../committers-guide/#ports-qa-misc-request-mfh>What is the procedure to request authorization for merging a commit to the quarterly branch?</a>.</p></div></div></div><div class=sect2><h3 id=ports-qa-quarterly>22.6. Quarterly Branches<a class=anchor href=#ports-qa-quarterly></a></h3><div class=sect3><h4 id=ports-qa-misc-request-mfh>22.6.1. What is the procedure to request authorization for merging a commit to the quarterly branch?<a class=anchor href=#ports-qa-misc-request-mfh></a></h4><div class=paragraph><p>As of November 30, 2020, there is no need to seek explicit approval to commit to the quarterly branch.</p></div></div><div class=sect3><h4 id=ports-qa-misc-commit-mfh>22.6.2. What is the procedure for merging commits to the quarterly branch?<a class=anchor href=#ports-qa-misc-commit-mfh></a></h4><div class=paragraph><p>Merging commits to the quarterly branch (a process we call MFH for a historical reason) is very similar to MFC’ing a commit in the src repository, so basically:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git checkout 2021Q2
% git cherry-pick <span class=nt>-x</span> <span class=nv>$HASH</span>
<span class=o>(</span>verify everything is OK, <span class=k>for </span>example by doing a build <span class=nb>test</span><span class=o>)</span>
% git push</code></pre></div></div><div class=paragraph><p>where <code>$HASH</code> is the hash of the commit you want to copy over to the quarterly branch.
The <code>-x</code> parameter ensures the hash <code>$HASH</code> of the <code>main</code> branch is included in the new commit message of the quarterly branch.</p></div></div></div><div class=sect2><h3 id=ports-qa-new-category>22.7. Creating a New Category<a class=anchor href=#ports-qa-new-category></a></h3><div class=sect3><h4 id=ports-qa-new-category-how>22.7.1. What is the procedure for creating a new category?<a class=anchor href=#ports-qa-new-category-how></a></h4><div class=paragraph><p>Please see <a href=https://docs.freebsd.org/en/books/porters-handbook/#proposing-categories>Proposing a New Category</a> in the Porter’s Handbook.
Once that procedure has been followed and the PR has been assigned to the Ports Management Team &lt;<a href=mailto:portmgr@FreeBSD.org>portmgr@FreeBSD.org</a>>, it is their decision whether or not to approve it.
If they do, it is their responsibility to:</p></div><div class="exampleblock procedure"><div class=content><div class="olist arabic"><ol class=arabic><li><p>Perform any needed moves. (This only applies to physical categories.)</p></li><li><p>Update the <code>VALID_CATEGORIES</code> definition in <span class=filename>ports/Mk/bsd.port.mk</span>.</p></li><li><p>Assign the PR back to you.</p></li></ol></div></div></div></div><div class=sect3><h4 id=ports-qa-new-category-physical>22.7.2. What do I need to do to implement a new physical category?<a class=anchor href=#ports-qa-new-category-physical></a></h4><div class="exampleblock procedure"><div class=content><div class="olist arabic"><ol class=arabic><li><p>Upgrade each moved port’s <span class=filename>Makefile</span>. Do not connect the new category to the build yet.</p><div class=paragraph><p>To do this, you will need to:</p></div><div class="exampleblock procedure"><div class=content><div class="olist arabic"><ol class=arabic><li><p>Change the port’s <code>CATEGORIES</code> (this was the point of the exercise, remember?) The new category is listed first. This will help to ensure that the PKGORIGIN is correct.</p></li><li><p>Run a <code>make describe</code>. Since the top-level <code>make index</code> that you will be running in a few steps is an iteration of <code>make describe</code> over the entire ports hierarchy, catching any errors here will save you having to re-run that step later on.</p></li><li><p>If you want to be really thorough, now might be a good time to run <a href="https://man.freebsd.org/cgi/man.cgi?query=portlint&amp;sektion=1&amp;format=html">portlint(1)</a>.</p></li></ol></div></div></div></li><li><p>Check that the <code>PKGORIGIN</code>s are correct. The ports system uses each port’s <code>CATEGORIES</code> entry to create its <code>PKGORIGIN</code>, which is used to connect installed packages to the port directory they were built from. If this entry is wrong, common port tools like <a href="https://man.freebsd.org/cgi/man.cgi?query=pkg-version&amp;sektion=8&amp;format=html">pkg-version(8)</a> and <a href="https://man.freebsd.org/cgi/man.cgi?query=portupgrade&amp;sektion=1&amp;format=html">portupgrade(1)</a> fail.</p><div class=paragraph><p>To do this, use the <span class=filename>chkorigin.sh</span> tool: <code>env PORTSDIR=/path/to/ports sh -e /path/to/ports/Tools/scripts/chkorigin.sh</code>. This will check every port in the ports tree, even those not connected to the build, so you can run it directly after the move operation. Hint: do not forget to look at the <code>PKGORIGIN</code>s of any slave ports of the ports you just moved!</p></div></li><li><p>On your own local system, test the proposed changes: first, comment out the SUBDIR entries in the old ports' categories' <span class=filename>Makefile</span>s; then enable building the new category in <span class=filename>ports/Makefile</span>. Run make checksubdirs in the affected category directories to check the SUBDIR entries. Next, in the <span class=filename>ports/</span> directory, run make index. This can take over 40 minutes on even modern systems; however, it is a necessary step to prevent problems for other people.</p></li><li><p>Once this is done, you can commit the updated <span class=filename>ports/Makefile</span> to connect the new category to the build and also commit the <span class=filename>Makefile</span> changes for the old category or categories.</p></li><li><p>Add appropriate entries to <span class=filename>ports/MOVED</span>.</p></li><li><p>Update the documentation by modifying:</p><div class=ulist><ul><li><p>the <a href=https://docs.freebsd.org/en/books/porters-handbook/#PORTING-CATEGORIES>list of categories</a> in the Porter’s Handbook</p></li></ul></div></li><li><p>Only once all the above have been done, and no one is any longer reporting problems with the new ports, should the old ports be deleted from their previous locations in the repository.</p></li></ol></div></div></div></div><div class=sect3><h4 id=_what_do_i_need_to_do_to_implement_a_new_virtual_category>22.7.3. What do I need to do to implement a new virtual category?<a class=anchor href=#_what_do_i_need_to_do_to_implement_a_new_virtual_category></a></h4><div class=paragraph><p>This is much simpler than a physical category. Only a few modifications are needed:</p></div><div class=ulist><ul><li><p>the <a href=https://docs.freebsd.org/en/books/porters-handbook/#PORTING-CATEGORIES>list of categories</a> in the Porter’s Handbook</p></li></ul></div></div></div><div class=sect2><h3 id=ports-qa-misc-questions>22.8. Miscellaneous Questions<a class=anchor href=#ports-qa-misc-questions></a></h3><div class=sect3><h4 id=ports-qa-misc-blanket-approval>22.8.1. Are there changes that can be committed without asking the maintainer for approval?<a class=anchor href=#ports-qa-misc-blanket-approval></a></h4><div class=paragraph><p>Blanket approval for most ports applies to these types of fixes:</p></div><div class=ulist><ul><li><p>Most infrastructure changes to a port (that is, modernizing, but not changing the functionality). For example, the blanket covers converting to new <code>USES</code> macros, enabling verbose builds, and switching to new ports system syntaxes.</p></li><li><p>Trivial and <em>tested</em> build and runtime fixes.</p></li><li><p>Documentations or metadata changes to ports, like <span class=filename>pkg-descr</span> or <code>COMMENT</code>.</p></li></ul></div><div class="admonitionblock important"><table><tbody><tr><td class=icon><i class="fa icon-important" title=Important></i></td><td class=content><div class=paragraph><p>Exceptions to this are anything maintained by the Ports Management Team &lt;<a href=mailto:portmgr@FreeBSD.org>portmgr@FreeBSD.org</a>>, or the Security Officer Team &lt;<a href=mailto:security-officer@FreeBSD.org>security-officer@FreeBSD.org</a>>.
No unauthorized commits may ever be made to ports maintained by those groups.</p></div></td></tr></tbody></table></div></div><div class=sect3><h4 id=ports-qa-misc-correctly-building>22.8.2. How do I know if my port is building correctly or not?<a class=anchor href=#ports-qa-misc-correctly-building></a></h4><div class=paragraph><p>The packages are built multiple times each week.
If a port fails, the maintainer will receive an email from <code>pkg-fallout@FreeBSD.org</code>.</p></div><div class=paragraph><p>Reports for all the package builds (official, experimental, and non-regression) are aggregated at <a href=pkg-status.FreeBSD.org>pkg-status.FreeBSD.org</a>.</p></div></div><div class=sect3><h4 id=ports-qa-misc-INDEX>22.8.3. I added a new port. Do I need to add it to the <span class=filename>INDEX</span>?<a class=anchor href=#ports-qa-misc-INDEX></a></h4><div class=paragraph><p>No. The file can either be generated by running <code>make index</code>, or a pre-generated version can be downloaded with <code>make fetchindex</code>.</p></div></div><div class=sect3><h4 id=ports-qa-misc-no-touch>22.8.4. Are there any other files I am not allowed to touch?<a class=anchor href=#ports-qa-misc-no-touch></a></h4><div class=paragraph><p>Any file directly under <span class=filename>ports/</span>, or any file under a subdirectory that starts with an uppercase letter (<span class=filename>Mk/</span>, <span class=filename>Tools/</span>, etc.).
In particular, the Ports Management Team &lt;<a href=mailto:portmgr@FreeBSD.org>portmgr@FreeBSD.org</a>> is very protective of <span class=filename>ports/Mk/bsd.port*.mk</span> so do not commit changes to those files unless you want to face their wrath.</p></div></div><div class=sect3><h4 id=ports-qa-misc-updated-distfile>22.8.5. What is the proper procedure for updating the checksum for a port distfile when the file changes without a version change?<a class=anchor href=#ports-qa-misc-updated-distfile></a></h4><div class=paragraph><p>When the checksum for a distribution file is updated due to the author updating the file without changing the port revision, the commit message includes a summary of the relevant diffs between the original and new distfile to ensure that the distfile has not been corrupted or maliciously altered.
If the current version of the port has been in the ports tree for a while, a copy of the old distfile will usually be available on the ftp servers; otherwise the author or maintainer should be contacted to find out why the distfile has changed.</p></div></div><div class=sect3><h4 id=ports-exp-run>22.8.6. How can an experimental test build of the ports tree (exp-run) be requested?<a class=anchor href=#ports-exp-run></a></h4><div class=paragraph><p>An exp-run must be completed before patches with a significant ports impact are committed.
The patch can be against the ports tree or the base system.</p></div><div class=paragraph><p>Full package builds will be done with the patches provided by the submitter, and the submitter is required to fix detected problems <em>(fallout)</em> before commit.</p></div><div class="exampleblock procedure"><div class=content><div class="olist arabic"><ol class=arabic><li><p>Go to the <a href=https://bugs.freebsd.org/submit>Bugzilla new PR page</a>.</p></li><li><p>Select the product your patch is about.</p></li><li><p>Fill in the bug report as normal. Remember to attach the patch.</p></li><li><p>If at the top it says “Show Advanced Fields” click on it. It will now say “Hide Advanced Fields”. Many new fields will be available. If it already says “Hide Advanced Fields”, no need to do anything.</p></li><li><p>In the “Flags” section, set the “exp-run” one to <code>?</code>. As for all other fields, hovering the mouse over any field shows more details.</p></li><li><p>Submit. Wait for the build to run.</p></li><li><p>Ports Management Team &lt;<a href=mailto:portmgr@FreeBSD.org>portmgr@FreeBSD.org</a>> will reply with a possible fallout.</p></li><li><p>Depending on the fallout:</p><div class=ulist><ul><li><p>If there is no fallout, the procedure stops here, and the change can be committed, pending any other approval required.</p><div class="olist lowerroman"><ol class=lowerroman type=i><li><p>If there is fallout, it <em>must</em> be fixed, either by fixing the ports directly in the ports tree, or adding to the submitted patch.</p></li><li><p>When this is done, go back to step 6 saying the fallout was fixed and wait for the exp-run to be run again. Repeat as long as there are broken ports.</p></li></ol></div></li></ul></div></li></ol></div></div></div></div></div></div></div><div class=sect1><h2 id=non-committers>23. Issues Specific to Developers Who Are Not Committers<a class=anchor href=#non-committers></a></h2><div class=sectionbody><div class=paragraph><p>A few people who have access to the FreeBSD machines do not have commit bits.
Almost all of this document will apply to these developers as well (except things specific to commits and the mailing list memberships that go with them).
In particular, we recommend that you read:</p></div><div class=ulist><ul><li><p><a href=../committers-guide/#admin>Administrative Details</a></p></li><li><p><a href=../committers-guide/#conventions-everyone>For Everyone</a></p><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Get your mentor to add you to the "Additional Contributors" (<span class=filename>doc/shared/contrib-additional.adoc</span>), if you are not already listed there.</p></div></td></tr></tbody></table></div></li><li><p><a href=../committers-guide/#developer.relations>Developer Relations</a></p></li><li><p><a href=../committers-guide/#ssh.guide>SSH Quick-Start Guide</a></p></li><li><p><a href=../committers-guide/#rules>The FreeBSD Committers' Big List of Rules</a></p></li></ul></div></div></div><div class=sect1><h2 id=google-analytics>24. Information About Google Analytics<a class=anchor href=#google-analytics></a></h2><div class=sectionbody><div class=paragraph><p>As of December 12, 2012, Google Analytics was enabled on the FreeBSD Project website to collect anonymized usage statistics regarding usage of the site.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>As of March 3, 2022, Google Analytics was removed from the FreeBSD Project.</p></div></td></tr></tbody></table></div></div></div><div class=sect1><h2 id=misc>25. Miscellaneous Questions<a class=anchor href=#misc></a></h2><div class=sectionbody><div class=sect2><h3 id=_how_do_i_access_people_freebsd_org_to_put_up_personal_or_project_information>25.1. How do I access people.FreeBSD.org to put up personal or project information?<a class=anchor href=#_how_do_i_access_people_freebsd_org_to_put_up_personal_or_project_information></a></h3><div class=paragraph><p><code>people.FreeBSD.org</code> is the same as <code>freefall.FreeBSD.org</code>.
Just create a <span class=filename>public_html</span> directory. Anything you place in that directory will automatically be visible under <a href=https://people.FreeBSD.org/>https://people.FreeBSD.org/</a>.</p></div></div><div class=sect2><h3 id=_where_are_the_mailing_list_archives_stored>25.2. Where are the mailing list archives stored?<a class=anchor href=#_where_are_the_mailing_list_archives_stored></a></h3><div class=paragraph><p>The mailing lists are archived under <span class=filename>/local/mail</span> on <code>freefall.FreeBSD.org</code>.</p></div></div><div class=sect2><h3 id=_i_would_like_to_mentor_a_new_committer_what_process_do_i_need_to_follow>25.3. I would like to mentor a new committer. What process do I need to follow?<a class=anchor href=#_i_would_like_to_mentor_a_new_committer_what_process_do_i_need_to_follow></a></h3><div class=paragraph><p>See the <a href=https://www.freebsd.org/internal/new-account/>New Account Creation Procedure</a> document on the internal pages.</p></div></div></div></div><div class=sect1><h2 id=benefits>26. Benefits and Perks for FreeBSD Committers<a class=anchor href=#benefits></a></h2><div class=sectionbody><div class=sect2><h3 id=benefits-recognition>26.1. Recognition<a class=anchor href=#benefits-recognition></a></h3><div class=paragraph><p>Recognition as a competent software engineer is the longest lasting value.
In addition, getting a chance to work with some of the best people that every engineer would dream of meeting is a great perk!</p></div></div><div class=sect2><h3 id=benefits-freebsdmall>26.2. FreeBSD Mall<a class=anchor href=#benefits-freebsdmall></a></h3><div class=paragraph><p>FreeBSD committers can get a free 4-CD or DVD set at conferences from <a href=http://www.freebsdmall.com>FreeBSD Mall, Inc.</a>.</p></div></div><div class=sect2><h3 id=benefits-gandi>26.3. <code>Gandi.net</code><a class=anchor href=#benefits-gandi></a></h3><div class=paragraph><p><a href=https://gandi.net>Gandi</a> provides website hosting, cloud computing, domain registration, and X.509 certificate services.</p></div><div class=paragraph><p>Gandi offers an E-rate discount to all FreeBSD developers.
To streamline the process of getting the discount first set up a Gandi account, fill in the billing information and select the currency.
Then send an mail to <a href=mailto:non-profit@gandi.net>non-profit@gandi.net</a> using your <code>@freebsd.org</code> mail address, and indicate your Gandi handle.</p></div></div><div class=sect2><h3 id=benefits-rsync>26.4. <code>rsync.net</code><a class=anchor href=#benefits-rsync></a></h3><div class=paragraph><p><a href=https://rsync.net>rsync.net</a> provides cloud storage for offsite backup that is optimized for UNIX users. Their service runs entirely on FreeBSD and ZFS.</p></div><div class=paragraph><p>rsync.net offers a free-forever 500 GB account to FreeBSD developers. Simply sign up at <a href=https://www.rsync.net/freebsd.html>https://www.rsync.net/freebsd.html</a> using your <code>@freebsd.org</code> address to receive this free account.</p></div></div></div></div><hr><div class=last-modified><p><strong>Last modified on</strong>: October 11, 2024 by <a href="https://cgit.freebsd.org/doc/commit/?id=65b45fee8c" target=_blank>Mateusz Piotrowski</a></p></div></div><aside class=toc><div class=toc-content><h3>Table of Contents</h3><nav id=TableOfContents><ul><li><a href=#admin>1. Administrative Details</a></li><li><a href=#pgpkeys>2. OpenPGP Keys for FreeBSD</a></li><li><a href=#kerberos-ldap>3. Kerberos and LDAP web Password for FreeBSD Cluster</a></li><li><a href=#committer.types>4. Commit Bit Types</a></li><li><a href=#git-primer>5. Git Primer</a></li><li><a href=#vcs-history>6. Version Control History</a></li><li><a href=#conventions>7. Setup, Conventions, and Traditions</a></li><li><a href=#pre-commit-review>8. Pre-Commit Review</a></li><li><a href=#commit-log-message>9. Commit Log Messages</a></li><li><a href=#pref-license>10. Preferred License for New Files</a></li><li><a href=#tracking.license.grants>11. Keeping Track of Licenses Granted to the FreeBSD Project</a></li><li><a href=#spdx.tags>12. SPDX Tags in the tree</a></li><li><a href=#developer.relations>13. Developer Relations</a></li><li><a href=#if-in-doubt>14. If in Doubt…​</a></li><li><a href=#bugzilla>15. Bugzilla</a></li><li><a href=#phabricator>16. Phabricator</a></li><li><a href=#people>17. Who’s Who</a></li><li><a href=#ssh.guide>18. SSH Quick-Start Guide</a></li><li><a href=#coverity>19. Coverity® Availability for FreeBSD Committers</a></li><li><a href=#rules>20. The FreeBSD Committers' Big List of Rules</a></li><li><a href=#archs>21. Support for Multiple Architectures</a></li><li><a href=#ports>22. Ports Specific FAQ</a></li><li><a href=#non-committers>23. Issues Specific to Developers Who Are Not Committers</a></li><li><a href=#google-analytics>24. Information About Google Analytics</a></li><li><a href=#misc>25. Miscellaneous Questions</a></li><li><a href=#benefits>26. Benefits and Perks for FreeBSD Committers</a></li></ul></nav><hr><div class=resources><h3>Resources</h3><ul class=contents><li><i class="fa fa-file-pdf-o" aria-hidden=true title="Download PDF"></i><a href=https://download.freebsd.org/doc/en/articles/committers-guide/committers-guide_en.pdf>Download PDF</a></li><li><i class="fa fa-pencil-square-o" aria-hidden=true title="Edit this page"></i><a href=https://github.com/freebsd/freebsd-doc/blob/main/documentation/content/en/_index target=_blank>Edit this page</a></li></ul></div></div></aside></main><footer><div class=footer-container><section class=logo-column><img src=http://172.16.201.134:1313/images/FreeBSD-colors.svg width=160 height=50 alt="FreeBSD logo"><div class=options-container><div class=language-container><a id=languages href=http://172.16.201.134:1313/en/languages><img src=http://172.16.201.134:1313/images/language.png class=language-image alt="Choose language">
<span>English</span></a></div><div class=theme-container><select id=theme-chooser><option value=theme-system>System</option><option value=theme-light>Light</option><option value=theme-dark>Dark</option><option value=theme-high-contrast>High contrast</option></select></div></div></section><section class=about-column><h3 class=column-title>About</h3><ul class=column-elements-container><li><a href=https://www.freebsd.org/about/ target=_blank class=column-element>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/ target=_blank class=column-element>FreeBSD Foundation</a></li><li><a href=https://www.freebsd.org/where/ target=_blank class=column-element>Get FreeBSD</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct target=_blank class=column-element>Code of Conduct</a></li><li><a href=https://www.freebsd.org/security/ target=_blank class=column-element>Security Advisories</a></li></ul></section><section class=documentation-column><h3 class=column-title>Documentation</h3><ul class=column-elements-container><li><a href=/en class=column-element>Documentation portal</a></li><li><a href=https://man.FreeBSD.org target=_blank class=column-element>Manual pages</a></li><li><a href=https://papers.FreeBSD.org target=_blank class=column-element>Presentations and papers</a></li><li><a href=https://docs-archive.freebsd.org/doc/ target=_blank class=column-element>Previous versions</a></li><li><a href=https://docs-archive.freebsd.org/44doc/ target=_blank class=column-element>4.4BSD Documents</a></li><li><a href=https://wiki.freebsd.org/ target=_blank class=column-element>Wiki</a></li></ul></section><section class=community-column><h3 class=column-title>Community</h3><ul class=column-elements-container><li><a href=http://172.16.201.134:1313/en/articles/contributing class=column-element>Get involved</a></li><li><a href=https://forums.freebsd.org/ target=_blank class=column-element>Community forum</a></li><li><a href=https://lists.freebsd.org/ target=_blank class=column-element>Mailing lists</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank class=column-element>IRC Channels</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank class=column-element>Bug Tracker</a></li></ul></section><section class=legal-column><h3 class=column-title>Legal</h3><ul class=column-elements-container><li><a href=https://freebsdfoundation.org/donate/ target=_blank class=column-element>Donations</a></li><li><a href=https://www.freebsd.org/copyright/freebsd-license/ target=_blank class=column-element>Licensing</a></li><li><a href=https://www.freebsd.org/privacy/ target=_blank class=column-element>Privacy Policy</a></li><li><a href=https://www.freebsd.org/copyright/ target=_blank class=column-element>Legal notices</a></li></ul></section><section class=copyright-column><p>&copy; 1994-2024 The FreeBSD Project. All rights reserved</p><span>Made with <span class=heart>♥</span> by the FreeBSD Community</span></section></div></footer></body></html>