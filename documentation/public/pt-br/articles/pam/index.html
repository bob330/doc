<!doctype html><html class=theme-light lang=pt-br><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content><meta name=copyright content="1995-2024 The FreeBSD Foundation"><link rel=canonical href=https://docs.freebsd.org/pt-br/articles/pam/><title>Módulos de Autenticação Plugáveis | FreeBSD Documentation Portal</title>
<meta name=theme-color content="#790000"><meta name=color-scheme content="system light dark high-contrast"><link rel="shortcut icon" href=https://docs.freebsd.org/favicon.ico><link rel=stylesheet href=https://docs.freebsd.org/styles/main.min.css><link rel=stylesheet href=https://docs.freebsd.org/css/font-awesome-min.css><script defer src=/js/theme-chooser.min.js></script><script defer src=/js/copy-clipboard.min.js></script><script defer src=/js/search.min.js></script><meta name=twitter:card content="summary"><meta name=twitter:domain content="docs.FreeBSD.org"><meta name=twitter:site content="@freebsd"><meta name=twitter:url content="https://twitter.com/freebsd"><meta property="og:title" content="Módulos de Autenticação Plugáveis"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:image" content="https://docs.freebsd.org/favicon.ico"><meta property="og:image:alt" content="FreeBSD Logo"><meta property="og:locale" content="pt-br"><meta property="og:url" content="https://docs.freebsd.org/pt-br/articles/pam/"><meta property="og:site_name" content="FreeBSD Documentation Portal"><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","url":"https:\/\/docs.freebsd.org\/pt-br\/articles\/pam\/","name":"FreeBSD Documentation Portal","headline":"FreeBSD Documentation Portal","description":"FreeBSD Documentation Portal"}</script></head><body><header><div class=header-container><div class=logo-menu-bars-container><a href=https://www.FreeBSD.org class=logo><img src=https://docs.freebsd.org/images/FreeBSD-monochromatic.svg width=160 height=50 alt="FreeBSD logo">
</a><label class=menu-bars for=menu-bars><i class="fa fa-bars" aria-hidden=true></i></label></div><input id=menu-bars type=checkbox><nav><ul class=menu><li class=menu-item><input id=about type=checkbox>
<a href=# aria-label="Navigate to About section"><label class=menu-item-description for=about>About
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/about/ target=_blank>About</a></li><li><a href=https://www.freebsd.org/about/ target=_blank>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/about-us/about-the-foundation/ target=_blank>FreeBSD Foundation</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct/ target=_blank>Code of Conduct</a></li></ul></li><li class=menu-item><input id=download type=checkbox>
<a href=# aria-label="Navigate to get FreeBSD section"><label class=menu-item-description for=download>Get FreeBSD
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/where/ target=_blank>Get FreeBSD</a></li><li><a href=https://www.freebsd.org/releases/ target=_blank>Release Information</a></li><li><a href=https://www.freebsd.org/releng/ target=_blank>Release Engineering</a></li><li><a href=https://www.freebsd.org/security/ target=_blank>Security Advisories</a></li></ul></li><li class=menu-item><input id=documentation type=checkbox>
<a href=# aria-label="Navigate to get Documentation section"><label class=menu-item-description for=documentation>Documentation
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=/pt-br>Documentation portal</a></li><li><a href=https://docs.freebsd.org/pt-br/books/handbook>FreeBSD Handbook</a></li><li><a href=https://docs.freebsd.org/pt-br/books/porters-handbook>Porter's Handbook</a></li><li><a href=https://docs.FreeBSD.org/en/books/fdp-primer>Documentation Project Handbook</a></li><li><a href=https://man.FreeBSD.org target=_blank>Manual pages</a></li><li><a href=https://papers.FreeBSD.org target=_blank>Presentations and papers</a></li><li><a href=https://wiki.FreeBSD.org target=_blank>Wiki</a></li><li><a href=https://docs.freebsd.org/pt-br/books>Books</a></li><li><a href=https://docs.freebsd.org/pt-br/articles>Articles</a></li></ul></li><li class=menu-item><input id=community type=checkbox>
<a href=# aria-label="Navigate to get Community section"><label class=menu-item-description for=community>Community
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/community/>Community</a></li><li><a href=https://docs.freebsd.org/pt-br/articles/contributing>Get involved</a></li><li><a href=https://forums.freebsd.org/ target=_blank>Forum</a></li><li><a href=https://lists.freebsd.org/ target=_blank>Mailing lists</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank>IRC Channels</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank>Bug Tracker</a></li><li><a href=https://www.freebsd.org/support/ target=_blank>Support</a></li></ul></li></ul></nav><div class=search-donate-container><form class=search method=get id=search-header-form action=https://docs.freebsd.org/search name=search-header-form><input type=hidden name=DB value=pt-br>
<input id=words name=P type=text size=20 maxlength=255>
<button>
<i class="fa fa-search" aria-hidden=true></i></button></form><div class=donate><a href=https://freebsdfoundation.org/donate/ target=_blank><span class=heart>♥</span>
Donate</a></div></div></div></header><main class=main-wrapper-article><div class=article><h1 class=title>Módulos de Autenticação Plugáveis</h1><div class="admonitionblock note"><p><i class="fa fa-exclamation-circle" aria-hidden=true></i>
Esta tradução pode estar desatualizada. Para ajudar com as traduções, acesse a <a href=https://translate-dev.freebsd.org/ target=_blank>ferramenta de traduções do FreeBSD</a>.</p></div><div class=copyright>Copyright © 2001-2003 Networks Associates Technology, Inc.</div><div class=legalnotice><a id=trademarks></a><details><summary>trademarks</summary><p>FreeBSD is a registered trademark of the FreeBSD Foundation.</p><p>This article was written for the FreeBSD Project by ThinkSec AS and Network Associates Laboratories, the Security Research Division of Network Associates, Inc. under DARPA/SPAWAR contract N66001-01-C-8035 (“CBOSS”), as part of the DARPA CHATS research program.</p><p>Linux is a registered trademark of Linus Torvalds.</p><p>Motif, OSF/1, and UNIX are registered trademarks and IT DialTone and The Open Group are trademarks of The Open Group in the United States and other countries.</p><p>Sun, Sun Microsystems, Java, Java Virtual Machine, JDK, JRE, JSP, JVM, Netra, OpenJDK, Solaris, StarOffice, SunOS and VirtualBox are trademarks or registered trademarks of Sun Microsystems, Inc. in the United States and other countries.</p><p>Many of the designations used by manufacturers and sellers to distinguish their products are claimed as trademarks. Where those designations appear in this document, and the FreeBSD Project was aware of the trademark claim, the designations have been followed by the “™” or the “®” symbol.</p></details></div><div class=toc-mobile><h3>Índice</h3><nav id=TableOfContents><ul><li><a href=#pam-intro>1. Introdução</a></li><li><a href=#pam-terms>2. Termos e convenções</a></li><li><a href=#pam-essentials>3. PAM Essencial</a></li><li><a href=#pam-config>4. Configuração do PAM</a></li><li><a href=#pam-freebsd-modules>5. Módulos PAM do FreeBSD</a></li><li><a href=#pam-appl-prog>6. Programação de Aplicação PAM</a></li><li><a href=#pam-module-prog>7. Programação de Módulos PAM</a></li><li><a href=#pam-sample-appl>Apêndice A: Exemplo de Aplicação PAM</a></li><li><a href=#pam-sample-module>Apêndice B: Exemplo do módulo PAM</a></li><li><a href=#pam-sample-conv>Apêndice C: Exemplo de função de conversação PAM</a></li><li><a href=#pam-further>Leitura Adicional</a></li></ul></nav></div><div id=preamble><div class=sectionbody><div class="paragraph abstract-title"><p>Resumo</p></div><div class=paragraph><p>Esse artigo descreve princípios subjacentes e mecanismos da biblioteca de Módulos de Autenticação Plugáveis (PAM), e explica como configurar, como integrar com outras aplicações e como escrever novos módulos.</p></div><hr></div></div><div class=sect1><h2 id=pam-intro>1. Introdução<a class=anchor href=#pam-intro></a></h2><div class=sectionbody><div class=paragraph><p>A biblioteca dos Módulos de Autenticação Plugáveis (PAM) é uma API generalizada para serviços relacionados com autenticações as quais permitem ao administrador de sistema adicionar um novo método de autenticação simplesmente pela instalação de um novo módulo PAM, e modificar a política de autenticação pela edição do arquivo de configuração.</p></div><div class=paragraph><p>O PAM foi definido e desenvolvido em 1995 por Vipin Samar e Charlie Lai da Sun Microsystems, e não teve muitas mudanças até hoje. Em 1997, o Open Group publicou a especificação preliminar do X/Open Single Sign-on (XSSO), a qual padroniza a API do PAM e adiciona extensões para autenticação única ou integrada. No momento da redação deste documento, esta especificação ainda não tinha sido adotada como padrão.</p></div><div class=paragraph><p>Apesar deste artigo focar primariamente no sistema FreeBSD 5.x, o qual usa o OpenPAM, ele poderá ser igualmente aplicado ao FreeBSD 4.x, o qual usa o Linux-PAM, e a outros systemas operacionais, tais como o Linux e o Solaris™.</p></div></div></div><div class=sect1><h2 id=pam-terms>2. Termos e convenções<a class=anchor href=#pam-terms></a></h2><div class=sectionbody><div class=sect2><h3 id=pam-definitions>2.1. Definições<a class=anchor href=#pam-definitions></a></h3><div class=paragraph><p>A terminologia em torno do PAM é bastante confusa. Nem o artigo original de Neither Samar e Lai nem a especificação original do XSSO fizeram algum esforço para definir formalmente os termos de vários atores e entidades envolvidas no PAM, e os termos que eles usam (mas não definem) são algumas vezes duvidosos ou ambíguos. A primeira tentativa de estabelecer uma terminologia consistente e não ambígua foi feita no artigo escrito por Andrew G. Morgan (autor do Linux-PAM) em 1999. A escolha da terminologia de Morgan foi um grande avanço, mas na opinião deste autor, não é perfeita. O que segue é uma tentativa, fortemente inspirada por Morgan, de definir termos precisos e não ambíguos para todos os atores e entidades envolvidas no PAM.</p></div><div class="dlist glosslist"><dl><dt class=hdlist1>conta (account)</dt><dd><p>Um conjunto de credenciais que o requerente está solicitando ao mediador.</p></dd><dt class=hdlist1>requerente (applicant)</dt><dd><p>Usuário ou entidade que solicita autenticação</p></dd><dt class=hdlist1>Mediador (arbitrator)</dt><dd><p>Usuário ou entidade a qual tem privilégios necessários para verificar as credenciais do requerente e autorizar ou não a solicitação</p></dd><dt class=hdlist1>chain</dt><dd><p>Uma sequência de módulos que irá ser chamada em resposta a uma solicitação do PAM. A chain inclui informações sobre a ordem a qual invocar os módulos, quais argumentos foram passados e como interpretar os resultados.</p></dd><dt class=hdlist1>client</dt><dd><p>A aplicação responsável por inicializar uma solicitação de autenticação em nome do requerente para obter as informações necessárias da autenticação dele.</p></dd><dt class=hdlist1>recursos</dt><dd><p>Um dos quatro grupos básicos de funcionalidades fornecidos pelo PAM: autenticação, gerenciamento de conta, gerenciamento de sessão e atualização de token de autenticação.</p></dd><dt class=hdlist1>módulo</dt><dd><p>Uma coleção de uma ou mais funções relacionadas implementando um recurso de autenticação específico, reunidas em um único arquivo binário (normalmente carregável dinamicamente) e identificadas por um único nome.</p></dd><dt class=hdlist1>política</dt><dd><p>O conjunto completo de instruções de configuração que descrevem como lidar com solicitações do PAM para um serviço específico. Uma política normalmente consiste em quatro chains, uma para cada recurso, embora alguns serviços não utilizem os quatro recursos.</p></dd><dt class=hdlist1>servidor</dt><dd><p>O aplicativo agindo em nome do mediador para conversar com o cliente, recuperar informações de autenticação, verificar as credenciais do requerente e conceder ou negar solicitações.</p></dd><dt class=hdlist1>serviço</dt><dd><p>Classe de servidores que provêm recursos similares ou relacionados e requerem autenticação similar. As políticas do PAM são definidas por serviço, portanto, todos os servidores que reivindicam o mesmo nome de serviço estarão sujeitos à mesma política.</p></dd><dt class=hdlist1>sessão</dt><dd><p>O contexto com o qual serviços são apresentados para o requerente pelo servidor. Um dos quatro recursos do PAM, gerenciamento de sessão, é concedido exclusivamente configurando e derrubando esse contexto.</p></dd><dt class=hdlist1>token</dt><dd><p>Um pedaço de informação associada à conta, como uma senha sendo uma palavra ou uma frase, que o solicitante deve fornecer para provar sua identidade.</p></dd><dt class=hdlist1>transação</dt><dd><p>Uma sequência de solicitações do mesmo requerente para a mesma instância do mesmo servidor, começando com a configuração de autenticação e sessão e terminando com a desmontagem da sessão.</p></dd></dl></div></div><div class=sect2><h3 id=pam-usage-examples>2.2. Exemplos de uso<a class=anchor href=#pam-usage-examples></a></h3><div class=paragraph><p>Esta seção tem como objetivo ilustrar os significados de alguns dos termos definidos acima por meio de alguns exemplos simples.</p></div></div><div class=sect2><h3 id=_o_cliente_e_o_servidor_são_um>2.3. O cliente e o servidor são um<a class=anchor href=#_o_cliente_e_o_servidor_são_um></a></h3><div class=paragraph><p>Este exemplo simples mostra <code>alice</code> usando <a href="https://man.freebsd.org/cgi/man.cgi?query=su&amp;sektion=1&amp;format=html">su(1)</a> para se tornar <code>root</code>.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% <span class=nb>whoami
</span>alice

% <span class=nb>ls</span> <span class=nt>-l</span> <span class=sb>`</span>which su<span class=sb>`</span>
<span class=nt>-r-sr-xr-x</span>  1 root  wheel  10744 Dec  6 19:06 /usr/bin/su

% su -
Password: xi3kiune

<span class=c># whoami</span>
root</code></pre></div></div><div class=ulist><ul><li><p>O requerente é <code>alice</code>.</p></li><li><p>A conta é <code>root</code>.</p></li><li><p>O processo <a href="https://man.freebsd.org/cgi/man.cgi?query=su&amp;sektion=1&amp;format=html">su(1)</a> é ao mesmo tempo, o cliente e o servidor.</p></li><li><p>O token de autenticação é <code>xi3kiune</code>.</p></li><li><p>O mediador é <code>root</code>, e é por isso que <a href="https://man.freebsd.org/cgi/man.cgi?query=su&amp;sektion=1&amp;format=html">su(1)</a> possui setuid para <code>root</code>.</p></li></ul></div></div><div class=sect2><h3 id=_o_cliente_e_o_servidor_são_separados>2.4. O cliente e o servidor são separados<a class=anchor href=#_o_cliente_e_o_servidor_são_separados></a></h3><div class=paragraph><p>O exemplo abaixo mostra <code>eve</code> tentar iniciar uma conexão <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;format=html">ssh(1)</a> com <code>login.example.com</code>, solicitar para efetuar login como <code>bob</code> e ter exito. Bob deveria ter escolhido uma senha melhor!</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% <span class=nb>whoami
</span>eve

% ssh bob@login.example.com
bob@login.example.com<span class=s1>&#39;s password:
% god
Last login: Thu Oct 11 09:52:57 2001 from 192.168.0.1
Copyright (c) 1980, 1983, 1986, 1988, 1990, 1991, 1993, 1994
	The Regents of the University of California.  All rights reserved.
FreeBSD 4.4-STABLE (LOGIN) 4: Tue Nov 27 18:10:34 PST 2001

Welcome to FreeBSD!
%</span></code></pre></div></div><div class=ulist><ul><li><p>O requerente é <code>eve</code>.</p></li><li><p>O cliente é o processo <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;format=html">ssh(1)</a> de Eve.</p></li><li><p>O servidor é o processo <a href="https://man.freebsd.org/cgi/man.cgi?query=sshd&amp;sektion=8&amp;format=html">sshd(8)</a> em <code>login.example.com</code></p></li><li><p>A conta é <code>bob</code>.</p></li><li><p>O token de autenticação é <code>god</code>.</p></li><li><p>Embora isso não seja mostrado neste exemplo, o mediador é <code>root</code>.</p></li></ul></div></div><div class=sect2><h3 id=_exemplo_de_política>2.5. Exemplo de política<a class=anchor href=#_exemplo_de_política></a></h3><div class=paragraph><p>A seguir, a política padrão do FreeBSD para <code>sshd</code>:</p></div><div class="literalblock programlisting"><div class=content><pre>sshd	auth		required	pam_nologin.so	no_warn
sshd	auth		required	pam_unix.so	no_warn try_first_pass
sshd	account		required	pam_login_access.so
sshd	account		required	pam_unix.so
sshd	session		required	pam_lastlog.so	no_fail
sshd	password	required	pam_permit.so</pre></div></div><div class=ulist><ul><li><p>Esta política se aplica ao serviço <code>sshd</code> (que não é necessariamente restrito ao servidor <a href="https://man.freebsd.org/cgi/man.cgi?query=sshd&amp;sektion=8&amp;format=html">sshd(8)</a>).</p></li><li><p><code>auth</code>, <code>account</code>, <code>session</code> e <code>password</code> são recursos.</p></li><li><p><span class=filename>pam_nologin.so</span>, <span class=filename>pam_unix.so</span>, <span class=filename>pam_login_access.so</span>, <span class=filename>pam_lastlog.so</span> e <span class=filename>pam_permit.so</span> são módulos. Fica claro neste exemplo que o <span class=filename>pam_unix.so</span> fornece pelo menos dois recursos (autenticação e gerenciamento de conta).</p></li></ul></div></div></div></div><div class=sect1><h2 id=pam-essentials>3. PAM Essencial<a class=anchor href=#pam-essentials></a></h2><div class=sectionbody><div class=sect2><h3 id=pam-facilities-primitives>3.1. Recursos e Primitivas<a class=anchor href=#pam-facilities-primitives></a></h3><div class=paragraph><p>A API do PAM oferece seis primitivas de autenticação diferentes agrupadas em quatro recursos, descritos abaixo.</p></div><div class=dlist><dl><dt class=hdlist1><code>auth</code></dt><dd><p><em>Autenticação.</em> Este recurso se preocupa em autenticar o requerente e estabelecer as credenciais da conta. Ele fornece duas primitivas:</p><div class=ulist><ul><li><p><a href="https://man.freebsd.org/cgi/man.cgi?query=pam_authenticate&amp;sektion=3&amp;format=html">pam_authenticate(3)</a> autentica o requerente, geralmente solicitando um token de autenticação e comparando-o com um valor armazenado em um banco de dados ou obtido de um servidor de autenticação.</p></li><li><p><a href="https://man.freebsd.org/cgi/man.cgi?query=pam_setcred&amp;sektion=3&amp;format=html">pam_setcred(3)</a> estabelece credenciais de conta, como ID de usuário, associação de grupo e limites de recursos.</p></li></ul></div></dd><dt class=hdlist1><code>account</code></dt><dd><p><em>Gerenciamento de contas.</em> Esse recurso lida com problemas de disponibilidade de conta não relacionados à autenticação, como restrições de acesso com base na hora do dia ou na carga de trabalho do servidor. Ele fornece uma única primitiva:</p><div class=ulist><ul><li><p><a href="https://man.freebsd.org/cgi/man.cgi?query=pam_acct_mgmt&amp;sektion=3&amp;format=html">pam_acct_mgmt(3)</a> verifica se a conta solicitada está disponível.</p></li></ul></div></dd><dt class=hdlist1><code>session</code></dt><dd><p><em>Gerenciamento de sessão.</em> Esse recurso lida com tarefas associadas à configuração e desmontagem da sessão, como a contabilização de login. Ele fornece duas primitivas:</p><div class=ulist><ul><li><p><a href="https://man.freebsd.org/cgi/man.cgi?query=pam_open_session&amp;sektion=3&amp;format=html">pam_open_session(3)</a> executa tarefas associadas à configuração da sessão: adiciona uma entrada nos bancos de dados <span class=filename>utmp</span> e <span class=filename>wtmp</span>, inicia um agente SSH, etc.</p></li><li><p><a href="https://man.freebsd.org/cgi/man.cgi?query=pam_close_session&amp;sektion=3&amp;format=html">pam_close_session(3)</a> executa tarefas associadas à desmontagem da sessão: adiciona uma entrada nos bancos de dados <span class=filename>utmp</span> e <span class=filename>wtmp</span>, pare o agente SSH, etc.</p></li></ul></div></dd><dt class=hdlist1><code>password</code></dt><dd><p><em>Gerenciamento de senhas.</em> Esse recurso é usado para alterar o token de autenticação associado a uma conta, porque expirou ou porque o usuário deseja alterá-lo. Ele fornece uma única primitiva:</p><div class=ulist><ul><li><p><a href="https://man.freebsd.org/cgi/man.cgi?query=pam_chauthtok&amp;sektion=3&amp;format=html">pam_chauthtok(3)</a> altera o token de autenticação, opcionalmente, verificando se é suficientemente difícil de adivinhar, se não foi usado anteriormente etc.</p></li></ul></div></dd></dl></div></div><div class=sect2><h3 id=pam-modules>3.2. Módulos<a class=anchor href=#pam-modules></a></h3><div class=paragraph><p>Módulos são um conceito muito central no PAM; afinal, eles são os "M" no "PAM". Um módulo PAM é um código de programa autocontido que implementa as primitivas em uma ou mais instalações para um mecanismo específico; possíveis mecanismos para o recurso de autenticação, por exemplo, incluem os bancos de dados de senhas UNIX®, NIS, LDAP e Radius.</p></div></div><div class=sect2><h3 id=pam-module-naming>3.3. Nomeação de Módulos<a class=anchor href=#pam-module-naming></a></h3><div class=paragraph><p>O FreeBSD implementa cada mecanismo em um único módulo, chamado <code>pam_mechanism.so</code> (por exemplo, <code>pam_unix.so</code> para o mecanismo UNIX®. Outras implementações às vezes possuem módulos separados para instalações separadas e incluem o nome do recurso, bem como o nome do mecanismo no nome do módulo. Para citar um exemplo, Solaris™ tem um módulo <code>pam_dial_auth.so.1</code> que é comumente usado para autenticar usuários de conexões discadas.</p></div></div><div class=sect2><h3 id=pam-module-versioning>3.4. Versionando Módulos<a class=anchor href=#pam-module-versioning></a></h3><div class=paragraph><p>A implementação original do PAM no FreeBSD, baseada no Linux-PAM, não utilizou números de versão para os módulos PAM. Isso normalmente causaria problemas com aplicativos legados, que poderiam estar vinculados a versões mais antigas das bibliotecas do sistema, pois não havia como carregar uma versão correspondente dos módulos necessários.</p></div><div class=paragraph><p>O OpenPAM, por outro lado, procura por módulos que possuam o mesmo número de versão que a biblioteca PAM (atualmente 2), e só retorna a um módulo não versionado se nenhum módulo versionado puder ser carregado. Assim, os módulos legados podem ser fornecidos para aplicativos legados, permitindo que novos aplicativos (ou recém-construídos) aproveitem os módulos mais recentes.</p></div><div class=paragraph><p>Embora os módulos PAM do Solaris™ normalmente tenham um número de versão, eles não são realmente versionados, porque o número é uma parte do nome do módulo e deve ser incluído na configuração.</p></div></div><div class=sect2><h3 id=pam-chains-policies>3.5. Cadeias e Políticas<a class=anchor href=#pam-chains-policies></a></h3><div class=paragraph><p>Quando um servidor inicia uma transação PAM, a biblioteca PAM tenta carregar uma política para o serviço especificado na chamada <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_start&amp;sektion=3&amp;format=html">pam_start(3)</a>. A política especifica como as solicitações de autenticação devem ser processadas e definidas em um arquivo de configuração. Este é o outro conceito central no PAM: a possibilidade de o administrador ajustar a política de segurança do sistema (no sentido mais amplo da palavra) simplesmente editando um arquivo de texto.</p></div><div class=paragraph><p>Uma política consiste em quatro cadeias, uma para cada uma dos quatro recursos do PAM. Cada chain é uma sequência de instruções de configuração, cada uma especificando um módulo para invocar, alguns parâmetros (opcionais) para passar para o módulo e um sinalizador de controle que descreve como interpretar o código de retorno do módulo.</p></div><div class=paragraph><p>Entender os sinalizadores de controle é essencial para entender os arquivos de configuração do PAM. Existem quatro diferentes flags de controle:</p></div><div class=dlist><dl><dt class=hdlist1><code>binding</code></dt><dd><p>Se o módulo tiver exito e nenhum módulo anterior na chain tiver falhado, a chain será encerrada imediatamente e a solicitação será concedida. Se o módulo falhar, o resto da chain é executado, mas a solicitação é negada no final.</p><div class=paragraph><p>Esta flag de controle foi introduzida pela Sun no Solaris™9 (SunOS™ 5.9), e também é suportado pelo OpenPAM.</p></div></dd><dt class=hdlist1><code>required</code></dt><dd><p>Se o módulo tiver exito, o restante da chain será executada e a solicitação será concedida, a menos que algum outro módulo falhe. Se o módulo falhar, o restante da chain também será executado, mas a solicitação será negada no final.</p></dd><dt class=hdlist1><code>requisite</code></dt><dd><p>Se o módulo for tiver exito, o restante da chain será executado e a solicitação será concedida, a menos que algum outro módulo falhe. Se o módulo falhar, a chain será encerrada imediatamente e a solicitação será negada.</p></dd><dt class=hdlist1><code>sufficient</code></dt><dd><p>Se o módulo tiver exito e nenhum módulo anterior na chain tiver falhado, a chain será encerrada imediatamente e a solicitação será concedida. Se o módulo falhar, o módulo será ignorado e o resto da chain será executado.</p><div class=paragraph><p>Como a semântica dessa flag pode ser um pouco confusa, especialmente quando ela é usada para o último módulo em uma chain, é recomendado que a flag de controle <code>binding</code> seja usada em seu lugar, se a implementação o suportar.</p></div></dd><dt class=hdlist1><code>optional</code></dt><dd><p>O módulo é executado, mas seu resultado é ignorado. Se todos os módulos em uma chain estiverem marcados como <code>optional</code>, todas as solicitações serão sempre concedidas.</p></dd></dl></div><div class=paragraph><p>Quando um servidor invoca uma das seis primitivas PAM, o PAM recupera a chain para o recurso ao qual a primitiva pertence, e invoca cada um dos módulos listados na chain, na ordem em que estão listados, até chegar ao fim ou determina que nenhum processamento adicional é necessário (porque um módulo <code>binding</code> ou <code>sufficient</code> teve exito, ou porque um módulo <code>requisite</code> falhou.) O pedido é concedido se e somente se pelo menos um módulo foi chamado e todos os módulos não opcionais tiveram exito.</p></div><div class=paragraph><p>Note que é possível, embora não muito comum, ter o mesmo módulo listado várias vezes na mesma chain. Por exemplo, um módulo que procura nomes de usuário e senhas em um servidor de diretório pode ser chamado várias vezes com parâmetros diferentes, especificando diferentes servidores de diretórios para contato. O PAM trata diferentes ocorrências do mesmo módulo na mesma chain de módulos diferentes e não relacionados.</p></div></div><div class=sect2><h3 id=pam-transactions>3.6. Transações<a class=anchor href=#pam-transactions></a></h3><div class=paragraph><p>O ciclo de vida de uma transação típica do PAM é descrito abaixo. Observe que, se qualquer uma dessas etapas falhar, o servidor deverá informar uma mensagem de erro adequada ao cliente e anular a transação.</p></div><div class="olist arabic"><ol class=arabic><li><p>Se necessário, o servidor obtém as credenciais do mediador por meio de um mecanismo independente do PAM - mais comumente em virtude de ter sido iniciado por <code>root</code> ou de ser setuid <code>root</code>.</p></li><li><p>O servidor chama <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_start&amp;sektion=3&amp;format=html">pam_start(3)</a> para inicializar a biblioteca PAM, especificar seu nome de serviço e a conta de destino e registrar uma função de conversação adequada.</p></li><li><p>O servidor obtém várias informações relacionadas à transação (como o nome de usuário do requerente e o nome do host no qual o cliente é executado) e o envia ao PAM usando <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_set_item&amp;sektion=3&amp;format=html">pam_set_item(3)</a>.</p></li><li><p>O servidor chama <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_authenticate&amp;sektion=3&amp;format=html">pam_authenticate(3)</a> para autenticar o requerente.</p></li><li><p>O servidor chama <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_acct_mgmt&amp;sektion=3&amp;format=html">pam_acct_mgmt(3)</a> para verificar se a conta solicitada está disponível e é válida. Se a senha estiver correta mas expirar, <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_acct_mgmt&amp;sektion=3&amp;format=html">pam_acct_mgmt(3)</a> retornará <code>PAM_NEW_AUTHTOK_REQD</code> em vez de <code>PAM_SUCCESS</code>.</p></li><li><p>Se a etapa anterior retornasse <code>PAM_NEW_AUTHTOK_REQD</code>, o servidor agora chamaria <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_chauthtok&amp;sektion=3&amp;format=html">pam_chauthtok(3)</a> para forçar o cliente a alterar o token de autenticação para a conta solicitada.</p></li><li><p>Agora que o requerente foi devidamente autenticado, o servidor chama <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_setcred&amp;sektion=3&amp;format=html">pam_setcred(3)</a> para estabelecer as credenciais da conta solicitada. É capaz de fazer isso porque age em nome do mediador e possui as credenciais do madiador.</p></li><li><p>Depois que as credenciais corretas forem estabelecidas, o servidor chamará <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_open_session&amp;sektion=3&amp;format=html">pam_open_session(3)</a> para configurar a sessão.</p></li><li><p>O servidor agora executa qualquer serviço solicitado pelo cliente - por exemplo, fornecer ao requerente um shell.</p></li><li><p>Quando o servidor terminar de atender ao cliente, ele chamará <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_close_session&amp;sektion=3&amp;format=html">pam_close_session(3)</a> para derrubar a sessão.</p></li><li><p>Finalmente, o servidor chama <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_end&amp;sektion=3&amp;format=html">pam_end(3)</a> para notificar a biblioteca PAM que ela esta pronta e que pode liberar quaisquer recursos alocados no curso da transação.</p></li></ol></div></div></div></div><div class=sect1><h2 id=pam-config>4. Configuração do PAM<a class=anchor href=#pam-config></a></h2><div class=sectionbody><div class=sect2><h3 id=pam-config-file>4.1. Arquivos de política do PAM<a class=anchor href=#pam-config-file></a></h3></div><div class=sect2><h3 id=pam-config-pam.conf>4.2. O arquivo <span class=filename>/etc/pam.conf</span><a class=anchor href=#pam-config-pam.conf></a></h3><div class=paragraph><p>O arquivo de política tradicional do PAM é <span class=filename>/etc/pam.conf</span>. Este arquivo contém todas as políticas do PAM para o seu sistema. Cada linha do arquivo descreve uma etapa em uma chain, conforme mostrado abaixo:</p></div><div class="literalblock programlisting"><div class=content><pre>login   auth    required        pam_nologin.so  no_warn</pre></div></div><div class=paragraph><p>Os campos estão, na ordem: nome do serviço, nome do recurso, flag de controle, nome do módulo e argumentos do módulo. Quaisquer campos adicionais são interpretados como argumentos adicionais do módulo.</p></div><div class=paragraph><p>Uma chain separada é construída para cada par de serviço/recurso, portanto, embora a ordem na qual as linhas para o mesmo serviço e recurso apareçam seja significativa, a ordem na qual os serviços e recursos individuais são listados não é. Os exemplos no artigo original do PAM agruparam as linhas de configuração por recurso, e o suporte do Solaris™ ao <span class=filename>pam.conf</span> ainda faz isso, mas a configuração de ações do FreeBSD configura as linhas por serviço. De qualquer maneira está bem; De qualquer forma, faz o mesmo sentido.</p></div></div><div class=sect2><h3 id=pam-config-pam.d>4.3. O diretório <span class=filename>/etc/pam.d</span><a class=anchor href=#pam-config-pam.d></a></h3><div class=paragraph><p>O OpenPAM e o Linux-PAM suportam um mecanismo de configuração alternativo, que é o mecanismo preferido no FreeBSD. Neste esquema, cada política está contida em um arquivo separado com o nome do serviço ao qual se aplica. Esses arquivos são armazenados em <span class=filename>/etc/pam.d/</span>.</p></div><div class=paragraph><p>Esses arquivos de políticas por serviço possuem apenas quatro campos, em vez de cinco no <span class=filename>pam.conf</span>: o campo nome do serviço é omitido. Assim, em vez da linha de exemplo no <span class=filename>pam.conf</span> da seção anterior, a seguinte linha deve estar em <span class=filename>/etc/pam.d/login</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>auth    required        pam_nologin.so  no_warn</pre></div></div><div class=paragraph><p>Como consequência dessa sintaxe simplificada, é possível usar a mesma política para vários serviços vinculando cada nome de serviço a um mesmo arquivo de política. Por exemplo, para usar a mesma política para os serviços <code>su</code> e <code>sudo</code>, pode-se fazer o seguinte:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /etc/pam.d</span>

<span class=c># ln -s su sudo</span></code></pre></div></div><div class=paragraph><p>Isso funciona porque o nome do serviço é determinado a partir do nome do arquivo em vez de ser especificado no arquivo de políticas, portanto, o mesmo arquivo pode ser usado para vários serviços com nomes diferentes.</p></div><div class=paragraph><p>Como a política de cada serviço é armazenada em um arquivo separado, o mecanismo <span class=filename>pam.d</span> também facilita a instalação de políticas adicionais para pacotes de software de terceiros.</p></div></div><div class=sect2><h3 id=pam-config-file-order>4.4. A ordem de pesquisa da política<a class=anchor href=#pam-config-file-order></a></h3><div class=paragraph><p>Como vimos acima, as políticas do PAM podem ser encontradas em vários lugares. O que acontece se as políticas para o mesmo serviço existirem em vários lugares?</p></div><div class=paragraph><p>É essencial entender que o sistema de configuração do PAM está centrado em chains.</p></div></div><div class=sect2><h3 id=pam-config-breakdown>4.5. Quebra de uma linha de configuração<a class=anchor href=#pam-config-breakdown></a></h3><div class=paragraph><p>Como explicado em <a href=#pam-config-file>Arquivos de política do PAM</a>, cada linha em <span class=filename>/etc/pam.conf</span> consiste em quatro ou mais campos: o nome do serviço, o nome do recurso, a flag de controle, o nome do módulo e nenhum ou mais argumentos do módulo.</p></div><div class=paragraph><p>O nome do serviço é geralmente (embora nem sempre) o nome do aplicativo ao qual a instrução se aplica. Se não tiver certeza, consulte a documentação do aplicativo individual para determinar qual nome de serviço ele usa.</p></div><div class=paragraph><p>Note que se você usar <span class=filename>/etc/pam.d/</span> em vez de <span class=filename>/etc/pam.conf</span>, o nome do serviço é especificado pelo nome do arquivo de política e omitido a partir das linhas de configuração atuais, que então começam com o nome da instalação.</p></div><div class=paragraph><p>O recurso é uma das quatro palavras-chave do recurso descritas em <a href=#pam-facilities-primitives>Recursos e Primitivas</a>.</p></div><div class=paragraph><p>Da mesma forma, a flag de controle é uma das quatro palavras-chave descritas em <a href=#pam-chains-policies>Cadeias e Políticas</a>, descrevendo como interpretar o código de retorno do módulo. O Linux-PAM suporta uma sintaxe alternativa que permite especificar a ação para associar com cada código de retorno possível, mas isso deve ser evitado, pois não é padrão e está intimamente ligado à forma como o Linux-PAM envia chamadas de serviço (que difere muito da maneira que Solaris™ e OpenPAM fazem isso). Não surpreendentemente, o OpenPAM não suporta esta sintaxe.</p></div></div><div class=sect2><h3 id=pam-policies>4.6. Políticas<a class=anchor href=#pam-policies></a></h3><div class=paragraph><p>Para configurar o PAM corretamente, é essencial entender como as políticas são interpretadas.</p></div><div class=paragraph><p>Quando um aplicativo chama <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_start&amp;sektion=3&amp;format=html">pam_start(3)</a>, a biblioteca PAM carrega a diretiva do serviço especificado e constrói quatro chains de módulos (uma para cada recurso). Se uma ou mais dessas chains estiverem vazias, as chains correspondentes da política para o <code>outro</code> serviço são substituídas.</p></div><div class=paragraph><p>Quando o aplicativo chama mais tarde uma das seis primitivas PAM, a biblioteca PAM recupera a chain para o recurso correspondente e chama a função de serviço apropriado em cada módulo listado na chain, na ordem em que foram listadas na configuração. Após cada chamada para uma função de serviço, o tipo de módulo e o código de erro retornado pela função de serviço são usados ​​para determinar o que acontece a seguir. Com algumas exceções, discutidas abaixo, a tabela a seguir se aplica:</p></div><table class="tableblock frame-all grid-all stretch"><caption class=title>Tabela 1. Resumo de execução da cadeia PAM</caption><col style=width:25%><col style=width:25%><col style=width:25%><col style=width:25%><thead><tr><th class="tableblock halign-left valign-top"></th><th class="tableblock halign-left valign-top">PAM_SUCCESS</th><th class="tableblock halign-left valign-top">PAM_IGNORE</th><th class="tableblock halign-left valign-top">other</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock>binding</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>if (!fail) break;</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>-</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>fail = true;</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>required</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>-</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>-</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>fail = true;</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>requisite</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>-</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>-</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>fail = true; break;</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>sufficient</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>if (!fail) break;</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>-</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>-</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>optional</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>-</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>-</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>-</p></td></tr></tbody></table><div class=paragraph><p>Se <code>fail</code> for true no final de uma chain, ou quando um "break" for atingido, o dispatcher retornará o código de erro retornado pelo primeiro módulo que falhou. Caso contrário, retorna <code>PAM_SUCCESS</code>.</p></div><div class=paragraph><p>A primeira exceção é que o código de erro <code>PAM_NEW_AUTHTOK_REQD</code> é tratado como um sucesso, exceto que se nenhum módulo falhar e pelo menos um módulo retornar <code>PAM_NEW_AUTHTOK_REQD</code>, o dispatcher retornará <code>PAM_NEW_AUTHTOK_REQD</code>.</p></div><div class=paragraph><p>A segunda exceção é que <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_setcred&amp;sektion=3&amp;format=html">pam_setcred(3)</a> trata os módulos <code>binding</code> e <code>sufficient</code> como se eles fossem <code>required</code>.</p></div><div class=paragraph><p>A terceira e última exceção é que <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_chauthtok&amp;sektion=3&amp;format=html">pam_chauthtok(3)</a> executa a chain inteira duas vezes (uma vez para verificações preliminares e uma vez para definir a senha), e na fase preliminar, ele trata os módulos <code>binding</code> e <code>sufficient</code> como se fossem <code>required</code>.</p></div></div></div></div><div class=sect1><h2 id=pam-freebsd-modules>5. Módulos PAM do FreeBSD<a class=anchor href=#pam-freebsd-modules></a></h2><div class=sectionbody><div class=sect2><h3 id=pam-modules-deny>5.1. <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_deny&amp;sektion=8&amp;format=html">pam_deny(8)</a><a class=anchor href=#pam-modules-deny></a></h3><div class=paragraph><p>O módulo <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_deny&amp;sektion=8&amp;format=html">pam_deny(8)</a> é um dos módulos mais simples disponíveis; responde a qualquer pedido com <code>PAM_AUTH_ERR</code>. É útil para desabilitar rapidamente um serviço (adicioná-lo ao topo de cada chain) ou para encerrar chains de módulos <code>sufficient</code>.</p></div></div><div class=sect2><h3 id=pam-modules-echo>5.2. <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_echo&amp;sektion=8&amp;format=html">pam_echo(8)</a><a class=anchor href=#pam-modules-echo></a></h3><div class=paragraph><p>O módulo <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_echo&amp;sektion=8&amp;format=html">pam_echo(8)</a> simplesmente passa seus argumentos para a função de conversação como uma mensagem <code>PAM_TEXT_INFO</code>. É principalmente útil para depuração, mas também pode servir para exibir mensagens como "O acesso não autorizado será processado" antes de iniciar o procedimento de autenticação.</p></div></div><div class=sect2><h3 id=pam-modules-exec>5.3. <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_exec&amp;sektion=8&amp;format=html">pam_exec(8)</a><a class=anchor href=#pam-modules-exec></a></h3><div class=paragraph><p>O módulo <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_exec&amp;sektion=8&amp;format=html">pam_exec(8)</a> leva seu primeiro argumento a ser o nome de um programa a ser executado, e os argumentos restantes são passados ​​para esse programa como argumentos de linha de comando. Uma aplicação possível é usá-lo para executar um programa no momento do login, que monta o diretório pessoal do usuário.</p></div></div><div class=sect2><h3 id=pam-modules-ftpusers>5.4. <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_ftpusers&amp;sektion=8&amp;format=html">pam_ftpusers(8)</a><a class=anchor href=#pam-modules-ftpusers></a></h3><div class=paragraph><p>The <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_ftpusers&amp;sektion=8&amp;format=html">pam_ftpusers(8)</a> module</p></div></div><div class=sect2><h3 id=pam-modules-group>5.5. <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_group&amp;sektion=8&amp;format=html">pam_group(8)</a><a class=anchor href=#pam-modules-group></a></h3><div class=paragraph><p>O módulo <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_group&amp;sektion=8&amp;format=html">pam_group(8)</a> aceita ou rejeita os requerentes com base em sua participação em um determinado grupo de arquivos (normalmente <code>wheel</code> para <a href="https://man.freebsd.org/cgi/man.cgi?query=su&amp;sektion=1&amp;format=html">su(1)</a>). Ele é destinado principalmente para manter o comportamento tradicional do <a href="https://man.freebsd.org/cgi/man.cgi?query=su&amp;sektion=1&amp;format=html">su(1)</a> do BSD, mas tem muitos outros usos, como excluir determinados grupos de usuários de um serviço particular.</p></div></div><div class=sect2><h3 id=pam-modules-guest>5.6. <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_guest&amp;sektion=8&amp;format=html">pam_guest(8)</a><a class=anchor href=#pam-modules-guest></a></h3><div class=paragraph><p>O módulo <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_guest&amp;sektion=8&amp;format=html">pam_guest(8)</a> permite logins convidados usando nomes de login fixos. Vários requerimentos podem ser colocados na senha, mas o comportamento padrão é permitir qualquer senha, desde que o nome de login seja o de uma conta de convidado. O módulo <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_guest&amp;sektion=8&amp;format=html">pam_guest(8)</a> pode ser facilmente utilizado para implementar logins FTP anônimos.</p></div></div><div class=sect2><h3 id=pam-modules-krb5>5.7. <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_krb5&amp;sektion=8&amp;format=html">pam_krb5(8)</a><a class=anchor href=#pam-modules-krb5></a></h3><div class=paragraph><p>O módulo <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_krb5&amp;sektion=8&amp;format=html">pam_krb5(8)</a></p></div></div><div class=sect2><h3 id=pam-modules-ksu>5.8. <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_ksu&amp;sektion=8&amp;format=html">pam_ksu(8)</a><a class=anchor href=#pam-modules-ksu></a></h3><div class=paragraph><p>O módulo <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_ksu&amp;sektion=8&amp;format=html">pam_ksu(8)</a></p></div></div><div class=sect2><h3 id=pam-modules-lastlog>5.9. <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_lastlog&amp;sektion=8&amp;format=html">pam_lastlog(8)</a><a class=anchor href=#pam-modules-lastlog></a></h3><div class=paragraph><p>O módulo <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_lastlog&amp;sektion=8&amp;format=html">pam_lastlog(8)</a></p></div></div><div class=sect2><h3 id=pam-modules-login-access>5.10. <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_login_access&amp;sektion=8&amp;format=html">pam_login_access(8)</a><a class=anchor href=#pam-modules-login-access></a></h3><div class=paragraph><p>O módulo <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_login_access&amp;sektion=8&amp;format=html">pam_login_access(8)</a> fornece uma implementação da primitiva de gerenciamento de contas que impõe as restrições de login especificadas na tabela <a href="https://man.freebsd.org/cgi/man.cgi?query=login.access&amp;sektion=5&amp;format=html">login.access(5)</a>.</p></div></div><div class=sect2><h3 id=pam-modules-nologin>5.11. <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_nologin&amp;sektion=8&amp;format=html">pam_nologin(8)</a><a class=anchor href=#pam-modules-nologin></a></h3><div class=paragraph><p>O módulo <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_nologin&amp;sektion=8&amp;format=html">pam_nologin(8)</a> recusa logins não-root quando existe um <span class=filename>/var/run/nologin</span>. Este arquivo é normalmente criado por <a href="https://man.freebsd.org/cgi/man.cgi?query=shutdown&amp;sektion=8&amp;format=html">shutdown(8)</a> quando restam menos de cinco minutos até o horário de encerramento programado.</p></div></div><div class=sect2><h3 id=pam-modules-opie>5.12. <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_opie&amp;sektion=8&amp;format=html">pam_opie(8)</a><a class=anchor href=#pam-modules-opie></a></h3><div class=paragraph><p>O módulo <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_opie&amp;sektion=8&amp;format=html">pam_opie(8)</a> implementa o método de autenticação <a href="https://man.freebsd.org/cgi/man.cgi?query=opie&amp;sektion=4&amp;format=html">opie(4)</a>. O sistema <a href="https://man.freebsd.org/cgi/man.cgi?query=opie&amp;sektion=4&amp;format=html">opie(4)</a> é um mecanismo de desafio-resposta em que a resposta a cada desafio é uma função direta do desafio e uma frase-senha, então a resposta pode ser facilmente computada "just in time" por qualquer pessoa que possua a senha, eliminando a necessidade de listas de senhas. Além disso, como <a href="https://man.freebsd.org/cgi/man.cgi?query=opie&amp;sektion=4&amp;format=html">opie(4)</a> nunca reutiliza um desafio que tenha sido respondido corretamente, ele não é vulnerável a ataques de repetição.</p></div></div><div class=sect2><h3 id=pam-modules-opieaccess>5.13. <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_opieaccess&amp;sektion=8&amp;format=html">pam_opieaccess(8)</a><a class=anchor href=#pam-modules-opieaccess></a></h3><div class=paragraph><p>O módulo <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_opieaccess&amp;sektion=8&amp;format=html">pam_opieaccess(8)</a> é um módulo complementar para <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_opie&amp;sektion=8&amp;format=html">pam_opie(8)</a>. Sua finalidade é impor as restrições codificadas em <a href="https://man.freebsd.org/cgi/man.cgi?query=opieaccess&amp;sektion=5&amp;format=html">opieaccess(5)</a>, que regulam as condições sob as quais um usuário que normalmente se autenticaria usando <a href="https://man.freebsd.org/cgi/man.cgi?query=opie&amp;sektion=4&amp;format=html">opie(4)</a> tem permissão para usar métodos alternativos. Isso geralmente é usado para proibir o uso de autenticação de senha de hosts não confiáveis.</p></div><div class=paragraph><p>Para ser eficaz, o módulo <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_opieaccess&amp;sektion=8&amp;format=html">pam_opieaccess(8)</a> deve ser listado como <code>requisite</code> imediatamente após uma entrada <code>sufficient</code> para <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_opie&amp;sektion=8&amp;format=html">pam_opie(8)</a>, e antes de qualquer outro módulo, na chain <code>auth</code>.</p></div></div><div class=sect2><h3 id=pam-modules-passwdqc>5.14. <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_passwdqc&amp;sektion=8&amp;format=html">pam_passwdqc(8)</a><a class=anchor href=#pam-modules-passwdqc></a></h3><div class=paragraph><p>O módulo <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_passwdqc&amp;sektion=8&amp;format=html">pam_passwdqc(8)</a></p></div></div><div class=sect2><h3 id=pam-modules-permit>5.15. <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_permit&amp;sektion=8&amp;format=html">pam_permit(8)</a><a class=anchor href=#pam-modules-permit></a></h3><div class=paragraph><p>O módulo <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_permit&amp;sektion=8&amp;format=html">pam_permit(8)</a> é um dos módulos mais simples disponíveis; responde a qualquer pedido com <code>PAM_SUCCESS</code>. É útil como um espaço reservado para serviços onde uma ou mais chains estariam vazias.</p></div></div><div class=sect2><h3 id=pam-modules-radius>5.16. <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_radius&amp;sektion=8&amp;format=html">pam_radius(8)</a><a class=anchor href=#pam-modules-radius></a></h3><div class=paragraph><p>O módulo <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_radius&amp;sektion=8&amp;format=html">pam_radius(8)</a></p></div></div><div class=sect2><h3 id=pam-modules-rhosts>5.17. <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_rhosts&amp;sektion=8&amp;format=html">pam_rhosts(8)</a><a class=anchor href=#pam-modules-rhosts></a></h3><div class=paragraph><p>O módulo <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_rhosts&amp;sektion=8&amp;format=html">pam_rhosts(8)</a></p></div></div><div class=sect2><h3 id=pam-modules-rootok>5.18. <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_rootok&amp;sektion=8&amp;format=html">pam_rootok(8)</a><a class=anchor href=#pam-modules-rootok></a></h3><div class=paragraph><p>O módulo <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_rootok&amp;sektion=8&amp;format=html">pam_rootok(8)</a> reporta sucesso se e somente se o ID do usuário real do processo que o chama (que é assumido como sendo executado pelo requerente) é 0. Isso é útil para serviços que não estão em rede, como <a href="https://man.freebsd.org/cgi/man.cgi?query=su&amp;sektion=1&amp;format=html">su(1)</a> ou <a href="https://man.freebsd.org/cgi/man.cgi?query=passwd&amp;sektion=1&amp;format=html">passwd(1)</a>, para o qual o <code>root</code> deve ter acesso automático.</p></div></div><div class=sect2><h3 id=pam-modules-securetty>5.19. <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_securetty&amp;sektion=8&amp;format=html">pam_securetty(8)</a><a class=anchor href=#pam-modules-securetty></a></h3><div class=paragraph><p>O módulo <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_securetty&amp;sektion=8&amp;format=html">pam_securetty(8)</a></p></div></div><div class=sect2><h3 id=pam-modules-self>5.20. <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_self&amp;sektion=8&amp;format=html">pam_self(8)</a><a class=anchor href=#pam-modules-self></a></h3><div class=paragraph><p>O módulo <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_self&amp;sektion=8&amp;format=html">pam_self(8)</a> reporta sucesso se, e somente se, os nomes do requerente coincidem com os da conta de destino. É mais útil para serviços que não estão em rede, como <a href="https://man.freebsd.org/cgi/man.cgi?query=su&amp;sektion=1&amp;format=html">su(1)</a>, onde a identidade do requerente pode ser facilmente verificada.</p></div></div><div class=sect2><h3 id=pam-modules-ssh>5.21. <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_ssh&amp;sektion=8&amp;format=html">pam_ssh(8)</a><a class=anchor href=#pam-modules-ssh></a></h3><div class=paragraph><p>O módulo <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_ssh&amp;sektion=8&amp;format=html">pam_ssh(8)</a> fornece serviços de autenticação e de sessão. O serviço de autenticação permite que os usuários que tenham chaves secretas SSH protegidas por senha em seu diretório <span class=filename>~/.ssh</span> se autentiquem digitando sua frase secreta. O serviço de sessão inicia o <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh-agent&amp;sektion=1&amp;format=html">ssh-agent(1)</a> e o pré-carrega com as chaves que foram descriptografadas na fase de autenticação. Esse recurso é particularmente útil para logins locais, seja em X (usando <a href="https://man.freebsd.org/cgi/man.cgi?query=xdm&amp;sektion=1&amp;format=html">xdm(1)</a> ou outro gerenciador de login X que reconhece o PAM) ou no console.</p></div></div><div class=sect2><h3 id=pam-modules-tacplus>5.22. <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_tacplus&amp;sektion=8&amp;format=html">pam_tacplus(8)</a><a class=anchor href=#pam-modules-tacplus></a></h3><div class=paragraph><p>O módulo <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_tacplus&amp;sektion=8&amp;format=html">pam_tacplus(8)</a></p></div><div class=sect3><h4 id=pam-modules-unix>5.22.1. <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_unix&amp;sektion=8&amp;format=html">pam_unix(8)</a><a class=anchor href=#pam-modules-unix></a></h4><div class=paragraph><p>O módulo <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_unix&amp;sektion=8&amp;format=html">pam_unix(8)</a> implementa a autenticação de senha UNIX® tradicional, usando <a href="https://man.freebsd.org/cgi/man.cgi?query=getpwnam&amp;sektion=3&amp;format=html">getpwnam(3)</a> para obter a senha da conta de destino e compará-la com a fornecida pelo requerente. Ele também fornece serviços de gerenciamento de conta (impondo tempos de expiração de conta e senha) e serviços de alteração de senha. Este é provavelmente o módulo mais útil, já que a grande maioria dos administradores desejará manter um comportamento histórico para pelo menos alguns serviços.</p></div></div></div></div></div><div class=sect1><h2 id=pam-appl-prog>6. Programação de Aplicação PAM<a class=anchor href=#pam-appl-prog></a></h2><div class=sectionbody><div class=paragraph><p>Esta seção ainda não foi escrita.</p></div></div></div><div class=sect1><h2 id=pam-module-prog>7. Programação de Módulos PAM<a class=anchor href=#pam-module-prog></a></h2><div class=sectionbody><div class=paragraph><p>Esta seção ainda não foi escrita.</p></div></div></div><div class=sect1><h2 id=pam-sample-appl>Apêndice A: Exemplo de Aplicação PAM<a class=anchor href=#pam-sample-appl></a></h2><div class=sectionbody><div class=paragraph><p>O que vem a seguir é uma implementação mínima de <a href="https://man.freebsd.org/cgi/man.cgi?query=su&amp;sektion=1&amp;format=html">su(1)</a> utilizando o PAM. Observe que ele usa a função de conversa <a href="https://man.freebsd.org/cgi/man.cgi?query=openpam_ttyconv&amp;sektion=3&amp;format=html">openpam_ttyconv(3)</a> específica do OpenPAM, que é prototipada em <span class=filename>security/openpam.h</span> . Se você deseja construir este aplicativo em um sistema com uma biblioteca PAM diferente, você terá que fornecer sua própria função de conversação. Uma função de conversa robusta é surpreendentemente difícil de implementar; o apresentado em <a href=#pam-sample-conv>Exemplo de função de conversação PAM</a> é um bom ponto de partida, mas não deve ser usado em aplicações do mundo real.</p></div><div class="literalblock programlisting"><div class=content><pre>/*-
 * Copyright (c) 2002,2003 Networks Associates Technology, Inc.
 * All rights reserved.
 *
 * This software was developed for the FreeBSD Project by ThinkSec AS and
 * Network Associates Laboratories, the Security Research Division of
 * Network Associates, Inc.  under DARPA/SPAWAR contract N66001-01-C-8035
 * (&#34;CBOSS&#34;), as part of the DARPA CHATS research program.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. The name of the author may not be used to endorse or promote
 *    products derived from this software without specific prior written
 *    permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS&#39;&#39; AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 *
 * $P4: //depot/projects/openpam/bin/su/su.c#10 $
 * $FreeBSD: head/pt_BR.ISO8859-1/articles/pam/article.xml 52677 2018-12-12 13:08:17Z ebrandi $
 */

#include &lt;sys/param.h&gt;
#include &lt;sys/wait.h&gt;

#include &lt;err.h&gt;
#include &lt;pwd.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;syslog.h&gt;
#include &lt;unistd.h&gt;

#include &lt;security/pam_appl.h&gt;
#include &lt;security/openpam.h&gt;	/* for openpam_ttyconv() */

extern char **environ;

static pam_handle_t *pamh;
static struct pam_conv pamc;

static void
usage(void)
{

	fprintf(stderr, &#34;Usage: su [login [args]]\n&#34;);
	exit(1);
}

int
main(int argc, char *argv[])
{
	char hostname[MAXHOSTNAMELEN];
	const char *user, *tty;
	char **args, **pam_envlist, **pam_env;
	struct passwd *pwd;
	int o, pam_err, status;
	pid_t pid;

	while ((o = getopt(argc, argv, &#34;h&#34;)) != -1)
		switch (o) {
		case &#39;h&#39;:
		default:
			usage();
		}

	argc -= optind;
	argv += optind;

	if (argc &gt; 0) {
		user = *argv;
		--argc;
		++argv;
	} else {
		user = &#34;root&#34;;
	}

	/* initialize PAM */
	pamc.conv = &amp;openpam_ttyconv;
	pam_start(&#34;su&#34;, user, &amp;pamc, &amp;pamh);

	/* set some items */
	gethostname(hostname, sizeof(hostname));
	if ((pam_err = pam_set_item(pamh, PAM_RHOST, hostname)) != PAM_SUCCESS)
		goto pamerr;
	user = getlogin();
	if ((pam_err = pam_set_item(pamh, PAM_RUSER, user)) != PAM_SUCCESS)
		goto pamerr;
	tty = ttyname(STDERR_FILENO);
	if ((pam_err = pam_set_item(pamh, PAM_TTY, tty)) != PAM_SUCCESS)
		goto pamerr;

	/* authenticate the applicant */
	if ((pam_err = pam_authenticate(pamh, 0)) != PAM_SUCCESS)
		goto pamerr;
	if ((pam_err = pam_acct_mgmt(pamh, 0)) == PAM_NEW_AUTHTOK_REQD)
		pam_err = pam_chauthtok(pamh, PAM_CHANGE_EXPIRED_AUTHTOK);
	if (pam_err != PAM_SUCCESS)
		goto pamerr;

	/* establish the requested credentials */
	if ((pam_err = pam_setcred(pamh, PAM_ESTABLISH_CRED)) != PAM_SUCCESS)
		goto pamerr;

	/* authentication succeeded; open a session */
	if ((pam_err = pam_open_session(pamh, 0)) != PAM_SUCCESS)
		goto pamerr;

	/* get mapped user name; PAM may have changed it */
	pam_err = pam_get_item(pamh, PAM_USER, (const void **)&amp;user);
	if (pam_err != PAM_SUCCESS || (pwd = getpwnam(user)) == NULL)
		goto pamerr;

	/* export PAM environment */
	if ((pam_envlist = pam_getenvlist(pamh)) != NULL) {
		for (pam_env = pam_envlist; *pam_env != NULL; ++pam_env) {
			putenv(*pam_env);
			free(*pam_env);
		}
		free(pam_envlist);
	}

	/* build argument list */
	if ((args = calloc(argc + 2, sizeof *args)) == NULL) {
		warn(&#34;calloc()&#34;);
		goto err;
	}
	*args = pwd-&gt;pw_shell;
	memcpy(args + 1, argv, argc * sizeof *args);

	/* fork and exec */
	switch ((pid = fork())) {
	case -1:
		warn(&#34;fork()&#34;);
		goto err;
	case 0:
		/* child: give up privs and start a shell */

		/* set uid and groups */
		if (initgroups(pwd-&gt;pw_name, pwd-&gt;pw_gid) == -1) {
			warn(&#34;initgroups()&#34;);
			_exit(1);
		}
		if (setgid(pwd-&gt;pw_gid) == -1) {
			warn(&#34;setgid()&#34;);
			_exit(1);
		}
		if (setuid(pwd-&gt;pw_uid) == -1) {
			warn(&#34;setuid()&#34;);
			_exit(1);
		}
		execve(*args, args, environ);
		warn(&#34;execve()&#34;);
		_exit(1);
	default:
		/* parent: wait for child to exit */
		waitpid(pid, &amp;status, 0);

		/* close the session and release PAM resources */
		pam_err = pam_close_session(pamh, 0);
		pam_end(pamh, pam_err);

		exit(WEXITSTATUS(status));
	}

pamerr:
	fprintf(stderr, &#34;Sorry\n&#34;);
err:
	pam_end(pamh, pam_err);
	exit(1);
}</pre></div></div></div></div><div class=sect1><h2 id=pam-sample-module>Apêndice B: Exemplo do módulo PAM<a class=anchor href=#pam-sample-module></a></h2><div class=sectionbody><div class=paragraph><p>Segue-se uma implementação mínima de <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_unix&amp;sektion=8&amp;format=html">pam_unix(8)</a>, oferecendo apenas serviços de autenticação. Ele deve ser compilado e executado com a maioria das implementações do PAM, mas aproveita as extensões do OpenPAM, se disponível: observe o uso de <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_get_authtok&amp;sektion=3&amp;format=html">pam_get_authtok(3)</a>, que simplifica enormemente solicitando ao usuário uma senha.</p></div><div class="literalblock programlisting"><div class=content><pre>/*-
 * Copyright (c) 2002 Networks Associates Technology, Inc.
 * All rights reserved.
 *
 * This software was developed for the FreeBSD Project by ThinkSec AS and
 * Network Associates Laboratories, the Security Research Division of
 * Network Associates, Inc.  under DARPA/SPAWAR contract N66001-01-C-8035
 * (&#34;CBOSS&#34;), as part of the DARPA CHATS research program.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. The name of the author may not be used to endorse or promote
 *    products derived from this software without specific prior written
 *    permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS&#39;&#39; AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 *
 * $P4: //depot/projects/openpam/modules/pam_unix/pam_unix.c#3 $
 * $FreeBSD: head/pt_BR.ISO8859-1/articles/pam/article.xml 52677 2018-12-12 13:08:17Z ebrandi $
 */

#include &lt;sys/param.h&gt;

#include &lt;pwd.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;stdio.h&gt;
#include &lt;string.h&gt;
#include &lt;unistd.h&gt;

#include &lt;security/pam_modules.h&gt;
#include &lt;security/pam_appl.h&gt;

#ifndef _OPENPAM
static char password_prompt[] = &#34;Password:&#34;;
#endif

#ifndef PAM_EXTERN
#define PAM_EXTERN
#endif

PAM_EXTERN int
pam_sm_authenticate(pam_handle_t *pamh, int flags,
	int argc, const char *argv[])
{
#ifndef _OPENPAM
	struct pam_conv *conv;
	struct pam_message msg;
	const struct pam_message *msgp;
	struct pam_response *resp;
#endif
	struct passwd *pwd;
	const char *user;
	char *crypt_password, *password;
	int pam_err, retry;

	/* identify user */
	if ((pam_err = pam_get_user(pamh, &amp;user, NULL)) != PAM_SUCCESS)
		return (pam_err);
	if ((pwd = getpwnam(user)) == NULL)
		return (PAM_USER_UNKNOWN);

	/* get password */
#ifndef _OPENPAM
	pam_err = pam_get_item(pamh, PAM_CONV, (const void **)&amp;conv);
	if (pam_err != PAM_SUCCESS)
		return (PAM_SYSTEM_ERR);
	msg.msg_style = PAM_PROMPT_ECHO_OFF;
	msg.msg = password_prompt;
	msgp = &amp;msg;
#endif
	for (retry = 0; retry &lt; 3; ++retry) {
#ifdef _OPENPAM
		pam_err = pam_get_authtok(pamh, PAM_AUTHTOK,
		    (const char **)&amp;password, NULL);
#else
		resp = NULL;
		pam_err = (*conv-&gt;conv)(1, &amp;msgp, &amp;resp, conv-&gt;appdata_ptr);
		if (resp != NULL) {
			if (pam_err == PAM_SUCCESS)
				password = resp-&gt;resp;
			else
				free(resp-&gt;resp);
			free(resp);
		}
#endif
		if (pam_err == PAM_SUCCESS)
			break;
	}
	if (pam_err == PAM_CONV_ERR)
		return (pam_err);
	if (pam_err != PAM_SUCCESS)
		return (PAM_AUTH_ERR);

	/* compare passwords */
	if ((!pwd-&gt;pw_passwd[0] &amp;&amp; (flags &amp; PAM_DISALLOW_NULL_AUTHTOK)) ||
	    (crypt_password = crypt(password, pwd-&gt;pw_passwd)) == NULL ||
	    strcmp(crypt_password, pwd-&gt;pw_passwd) != 0)
		pam_err = PAM_AUTH_ERR;
	else
		pam_err = PAM_SUCCESS;
#ifndef _OPENPAM
	free(password);
#endif
	return (pam_err);
}

PAM_EXTERN int
pam_sm_setcred(pam_handle_t *pamh, int flags,
	int argc, const char *argv[])
{

	return (PAM_SUCCESS);
}

PAM_EXTERN int
pam_sm_acct_mgmt(pam_handle_t *pamh, int flags,
	int argc, const char *argv[])
{

	return (PAM_SUCCESS);
}

PAM_EXTERN int
pam_sm_open_session(pam_handle_t *pamh, int flags,
	int argc, const char *argv[])
{

	return (PAM_SUCCESS);
}

PAM_EXTERN int
pam_sm_close_session(pam_handle_t *pamh, int flags,
	int argc, const char *argv[])
{

	return (PAM_SUCCESS);
}

PAM_EXTERN int
pam_sm_chauthtok(pam_handle_t *pamh, int flags,
	int argc, const char *argv[])
{

	return (PAM_SERVICE_ERR);
}

#ifdef PAM_MODULE_ENTRY
PAM_MODULE_ENTRY(&#34;pam_unix&#34;);
#endif</pre></div></div></div></div><div class=sect1><h2 id=pam-sample-conv>Apêndice C: Exemplo de função de conversação PAM<a class=anchor href=#pam-sample-conv></a></h2><div class=sectionbody><div class=paragraph><p>A função de conversação apresentada abaixo é uma versão bastante simplificada do <a href="https://man.freebsd.org/cgi/man.cgi?query=openpam_ttyconv&amp;sektion=&amp;format=html">openpam_ttyconv()</a> do OpenPAM. Ele é totalmente funcional e deve dar ao leitor uma boa ideia de como uma função de conversa deve se comportar, mas é simples demais para uso no mundo real. Mesmo se você não estiver usando o OpenPAM, sinta-se à vontade para baixar o código-fonte e adaptar <a href="https://man.freebsd.org/cgi/man.cgi?query=openpam_ttyconv&amp;sektion=3&amp;format=html">openpam_ttyconv(3)</a> aos seus usos; acreditamos que seja tão robusto quanto uma função de conversa orientada para tty pode razoavelmente ser.</p></div><div class="literalblock programlisting"><div class=content><pre>/*-
 * Copyright (c) 2002 Networks Associates Technology, Inc.
 * All rights reserved.
 *
 * This software was developed for the FreeBSD Project by ThinkSec AS and
 * Network Associates Laboratories, the Security Research Division of
 * Network Associates, Inc.  under DARPA/SPAWAR contract N66001-01-C-8035
 * (&#34;CBOSS&#34;), as part of the DARPA CHATS research program.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. The name of the author may not be used to endorse or promote
 *    products derived from this software without specific prior written
 *    permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS&#39;&#39; AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 *
 * $FreeBSD: head/pt_BR.ISO8859-1/articles/pam/article.xml 52677 2018-12-12 13:08:17Z ebrandi $
 */

#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;unistd.h&gt;

#include &lt;security/pam_appl.h&gt;

int
converse(int n, const struct pam_message **msg,
	struct pam_response **resp, void *data)
{
	struct pam_response *aresp;
	char buf[PAM_MAX_RESP_SIZE];
	int i;

	data = data;
	if (n &lt;= 0 || n &gt; PAM_MAX_NUM_MSG)
		return (PAM_CONV_ERR);
	if ((aresp = calloc(n, sizeof *aresp)) == NULL)
		return (PAM_BUF_ERR);
	for (i = 0; i &lt; n; ++i) {
		aresp[i].resp_retcode = 0;
		aresp[i].resp = NULL;
		switch (msg[i]-&gt;msg_style) {
		case PAM_PROMPT_ECHO_OFF:
			aresp[i].resp = strdup(getpass(msg[i]-&gt;msg));
			if (aresp[i].resp == NULL)
				goto fail;
			break;
		case PAM_PROMPT_ECHO_ON:
			fputs(msg[i]-&gt;msg, stderr);
			if (fgets(buf, sizeof buf, stdin) == NULL)
				goto fail;
			aresp[i].resp = strdup(buf);
			if (aresp[i].resp == NULL)
				goto fail;
			break;
		case PAM_ERROR_MSG:
			fputs(msg[i]-&gt;msg, stderr);
			if (strlen(msg[i]-&gt;msg) &gt; 0 &amp;&amp;
			    msg[i]-&gt;msg[strlen(msg[i]-&gt;msg) - 1] != &#39;\n&#39;)
				fputc(&#39;\n&#39;, stderr);
			break;
		case PAM_TEXT_INFO:
			fputs(msg[i]-&gt;msg, stdout);
			if (strlen(msg[i]-&gt;msg) &gt; 0 &amp;&amp;
			    msg[i]-&gt;msg[strlen(msg[i]-&gt;msg) - 1] != &#39;\n&#39;)
				fputc(&#39;\n&#39;, stdout);
			break;
		default:
			goto fail;
		}
	}
	*resp = aresp;
	return (PAM_SUCCESS);
 fail:
        for (i = 0; i &lt; n; ++i) {
                if (aresp[i].resp != NULL) {
                        memset(aresp[i].resp, 0, strlen(aresp[i].resp));
                        free(aresp[i].resp);
                }
        }
        memset(aresp, 0, n * sizeof *aresp);
	*resp = NULL;
	return (PAM_CONV_ERR);
}</pre></div></div></div></div><div class=sect1><h2 id=pam-further>Leitura Adicional<a class=anchor href=#pam-further></a></h2><div class=sectionbody><div class=sect2><h3 id=_papers>Papers<a class=anchor href=#_papers></a></h3><div class=paragraph><p><em><a href=http://www.sun.com/software/solaris/pam/pam.external.pdf>Tornando os serviços de login independentes das tecnologias de autenticação</a></em>. Vipin Samar e Charlie Lai. Sun Microsystems.</p></div><div class=paragraph><p><em><a href=http://www.opengroup.org/pubs/catalog/p702.htm>Especificação Preliminar do X/Open Single Sign-on</a></em>. O grupo aberto. 1-85912-144-6. Junho de 1997.</p></div><div class=paragraph><p><em><a href=http://www.kernel.org/pub/linux/libs/pam/pre/doc/current-draft.txt>Módulos de autenticação plugáveis​​</a></em>​​. Andrew G. Morgan. 06-10-1999.</p></div></div><div class=sect2><h3 id=_manuais_do_usuário>Manuais do usuário<a class=anchor href=#_manuais_do_usuário></a></h3><div class=paragraph><p><em><a href=http://www.sun.com/software/solaris/pam/pam.admin.pdf>Administração do PAM</a></em>. Sun Microsystems.</p></div></div><div class=sect2><h3 id=_páginas_web_relacionadas>Páginas Web Relacionadas<a class=anchor href=#_páginas_web_relacionadas></a></h3><div class=paragraph><p><em><a href=http://openpam.sourceforge.net/>Homepage do OpenPAM</a></em>. Dag-Erling Smørgrav. ThinkSec AS.</p></div><div class=paragraph><p><em><a href=http://www.kernel.org/pub/linux/libs/pam/>Página inicial do Linux-PAM</a></em>. Andrew G. Morgan.</p></div><div class=paragraph><p><em><a href=http://wwws.sun.com/software/solaris/pam/>Página inicial do Solaris PAM</a></em>. Sun Microsystems.</p></div></div></div></div><hr><div class=last-modified><p><strong>Última alteração em</strong>: 3 de novembro de 2021 por <a href="https://cgit.freebsd.org/doc/commit/?id=64acd169b8" target=_blank>Sergio Carlavilla Delgado</a></p></div></div><aside class=toc><div class=toc-content><h3>Índice</h3><nav id=TableOfContents><ul><li><a href=#pam-intro>1. Introdução</a></li><li><a href=#pam-terms>2. Termos e convenções</a></li><li><a href=#pam-essentials>3. PAM Essencial</a></li><li><a href=#pam-config>4. Configuração do PAM</a></li><li><a href=#pam-freebsd-modules>5. Módulos PAM do FreeBSD</a></li><li><a href=#pam-appl-prog>6. Programação de Aplicação PAM</a></li><li><a href=#pam-module-prog>7. Programação de Módulos PAM</a></li><li><a href=#pam-sample-appl>Apêndice A: Exemplo de Aplicação PAM</a></li><li><a href=#pam-sample-module>Apêndice B: Exemplo do módulo PAM</a></li><li><a href=#pam-sample-conv>Apêndice C: Exemplo de função de conversação PAM</a></li><li><a href=#pam-further>Leitura Adicional</a></li></ul></nav><hr><div class=resources><h3>Recursos</h3><ul class=contents><li><i class="fa fa-file-pdf-o" aria-hidden=true title="Download PDF"></i><a href=https://download.freebsd.org/doc/pt-br/articles/pam/pam_pt-br.pdf>Download PDF</a></li><li><i class="fa fa-pencil-square-o" aria-hidden=true title="Edite essa página"></i><a href=https://github.com/freebsd/freebsd-doc/blob/main/documentation/content/pt-br/_index target=_blank>Edite essa página</a></li></ul></div></div></aside></main><footer><div class=footer-container><section class=logo-column><img src=https://docs.freebsd.org/images/FreeBSD-colors.svg width=160 height=50 alt="FreeBSD logo"><div class=options-container><div class=language-container><a id=languages href=https://docs.freebsd.org/pt-br/languages><img src=https://docs.freebsd.org/images/language.png class=language-image alt="Escolha o idioma">
<span>Brazilian Portuguese</span></a></div><div class=theme-container><select id=theme-chooser><option value=theme-system>System</option><option value=theme-light>Light</option><option value=theme-dark>Dark</option><option value=theme-high-contrast>Alto contraste</option></select></div></div></section><section class=about-column><h3 class=column-title>About</h3><ul class=column-elements-container><li><a href=https://www.freebsd.org/about/ target=_blank class=column-element>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/ target=_blank class=column-element>FreeBSD Foundation</a></li><li><a href=https://www.freebsd.org/where/ target=_blank class=column-element>Get FreeBSD</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct target=_blank class=column-element>Code of Conduct</a></li><li><a href=https://www.freebsd.org/security/ target=_blank class=column-element>Security Advisories</a></li></ul></section><section class=documentation-column><h3 class=column-title>Documentation</h3><ul class=column-elements-container><li><a href=/pt-br class=column-element>Documentation portal</a></li><li><a href=https://man.FreeBSD.org target=_blank class=column-element>Manual pages</a></li><li><a href=https://papers.FreeBSD.org target=_blank class=column-element>Presentations and papers</a></li><li><a href=https://docs-archive.freebsd.org/doc/ target=_blank class=column-element>Previous versions</a></li><li><a href=https://docs-archive.freebsd.org/44doc/ target=_blank class=column-element>4.4BSD Documents</a></li><li><a href=https://wiki.freebsd.org/ target=_blank class=column-element>Wiki</a></li></ul></section><section class=community-column><h3 class=column-title>Community</h3><ul class=column-elements-container><li><a href=https://docs.freebsd.org/pt-br/articles/contributing class=column-element>Get involved</a></li><li><a href=https://forums.freebsd.org/ target=_blank class=column-element>Community forum</a></li><li><a href=https://lists.freebsd.org/ target=_blank class=column-element>Mailing lists</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank class=column-element>IRC Channels</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank class=column-element>Bug Tracker</a></li></ul></section><section class=legal-column><h3 class=column-title>Legal</h3><ul class=column-elements-container><li><a href=https://freebsdfoundation.org/donate/ target=_blank class=column-element>Donations</a></li><li><a href=https://www.freebsd.org/copyright/freebsd-license/ target=_blank class=column-element>Licensing</a></li><li><a href=https://www.freebsd.org/privacy/ target=_blank class=column-element>Privacy Policy</a></li><li><a href=https://www.freebsd.org/copyright/ target=_blank class=column-element>Legal notices</a></li></ul></section><section class=copyright-column><p>&copy; 1994-2024 The FreeBSD Project. All rights reserved</p><span>Made with <span class=heart>♥</span> by the FreeBSD Community</span></section></div></footer></body></html>