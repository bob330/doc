<!doctype html><html class=theme-light lang=pt-br><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Construir seu próprio servidor freebsd-update permite que um administrador de sistema realize atualizações rápidas para vários computadores a partir de um espelho local"><meta name=keywords content="FreeBSD,Update,Server,internal"><meta name=copyright content="1995-2024 The FreeBSD Foundation"><link rel=canonical href=http://172.16.201.134:1313/pt-br/articles/freebsd-update-server/><title>Construa seu próprio servidor de atualização do FreeBSD | FreeBSD Documentation Portal</title>
<meta name=theme-color content="#790000"><meta name=color-scheme content="system light dark high-contrast"><link rel="shortcut icon" href=http://172.16.201.134:1313/favicon.ico><link rel=stylesheet href=http://172.16.201.134:1313/styles/main.min.css><link rel=stylesheet href=http://172.16.201.134:1313/css/font-awesome-min.css><script defer src=/js/theme-chooser.min.js></script><script defer src=/js/copy-clipboard.min.js></script><script defer src=/js/search.min.js></script><meta name=twitter:card content="summary"><meta name=twitter:domain content="docs.FreeBSD.org"><meta name=twitter:site content="@freebsd"><meta name=twitter:url content="https://twitter.com/freebsd"><meta property="og:title" content="Construa seu próprio servidor de atualização do FreeBSD"><meta property="og:description" content="Construir seu próprio servidor freebsd-update permite que um administrador de sistema realize atualizações rápidas para vários computadores a partir de um espelho local"><meta property="og:type" content="website"><meta property="og:image" content="http://172.16.201.134:1313/favicon.ico"><meta property="og:image:alt" content="FreeBSD Logo"><meta property="og:locale" content="pt-br"><meta property="og:url" content="http://172.16.201.134:1313/pt-br/articles/freebsd-update-server/"><meta property="og:site_name" content="FreeBSD Documentation Portal"><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","url":"http:\/\/172.16.201.134:1313\/pt-br\/articles\/freebsd-update-server\/","name":"FreeBSD Documentation Portal","headline":"FreeBSD Documentation Portal","description":"FreeBSD Documentation Portal"}</script></head><body><header><div class=header-container><div class=logo-menu-bars-container><a href=https://www.FreeBSD.org class=logo><img src=http://172.16.201.134:1313/images/FreeBSD-monochromatic.svg width=160 height=50 alt="FreeBSD logo">
</a><label class=menu-bars for=menu-bars><i class="fa fa-bars" aria-hidden=true></i></label></div><input id=menu-bars type=checkbox><nav><ul class=menu><li class=menu-item><input id=about type=checkbox>
<a href=# aria-label="Navigate to About section"><label class=menu-item-description for=about>About
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/about/ target=_blank>About</a></li><li><a href=https://www.freebsd.org/about/ target=_blank>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/about-us/about-the-foundation/ target=_blank>FreeBSD Foundation</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct/ target=_blank>Code of Conduct</a></li></ul></li><li class=menu-item><input id=download type=checkbox>
<a href=# aria-label="Navigate to get FreeBSD section"><label class=menu-item-description for=download>Get FreeBSD
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/where/ target=_blank>Get FreeBSD</a></li><li><a href=https://www.freebsd.org/releases/ target=_blank>Release Information</a></li><li><a href=https://www.freebsd.org/releng/ target=_blank>Release Engineering</a></li><li><a href=https://www.freebsd.org/security/ target=_blank>Security Advisories</a></li></ul></li><li class=menu-item><input id=documentation type=checkbox>
<a href=# aria-label="Navigate to get Documentation section"><label class=menu-item-description for=documentation>Documentation
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=/pt-br>Documentation portal</a></li><li><a href=http://172.16.201.134:1313/pt-br/books/handbook>FreeBSD Handbook</a></li><li><a href=http://172.16.201.134:1313/pt-br/books/porters-handbook>Porter's Handbook</a></li><li><a href=https://docs.FreeBSD.org/en/books/fdp-primer>Documentation Project Handbook</a></li><li><a href=https://man.FreeBSD.org target=_blank>Manual pages</a></li><li><a href=https://papers.FreeBSD.org target=_blank>Presentations and papers</a></li><li><a href=https://wiki.FreeBSD.org target=_blank>Wiki</a></li><li><a href=http://172.16.201.134:1313/pt-br/books>Books</a></li><li><a href=http://172.16.201.134:1313/pt-br/articles>Articles</a></li></ul></li><li class=menu-item><input id=community type=checkbox>
<a href=# aria-label="Navigate to get Community section"><label class=menu-item-description for=community>Community
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/community/>Community</a></li><li><a href=http://172.16.201.134:1313/pt-br/articles/contributing>Get involved</a></li><li><a href=https://forums.freebsd.org/ target=_blank>Forum</a></li><li><a href=https://lists.freebsd.org/ target=_blank>Mailing lists</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank>IRC Channels</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank>Bug Tracker</a></li><li><a href=https://www.freebsd.org/support/ target=_blank>Support</a></li></ul></li></ul></nav><div class=search-donate-container><form class=search method=get id=search-header-form action=https://docs.freebsd.org/search name=search-header-form><input type=hidden name=DB value=pt-br>
<input id=words name=P type=text size=20 maxlength=255>
<button>
<i class="fa fa-search" aria-hidden=true></i></button></form><div class=donate><a href=https://freebsdfoundation.org/donate/ target=_blank><span class=heart>♥</span>
Donate</a></div></div></div></header><main class=main-wrapper-article><div class=article><h1 class=title>Construa seu próprio servidor de atualização do FreeBSD</h1><div class="admonitionblock note"><p><i class="fa fa-exclamation-circle" aria-hidden=true></i>
Esta tradução pode estar desatualizada. Para ajudar com as traduções, acesse a <a href=https://translate-dev.freebsd.org/ target=_blank>ferramenta de traduções do FreeBSD</a>.</p></div><div class=copyright>Copyright © 2009-2011, 2013 Jason Helfman</div><div class=legalnotice><a id=trademarks></a><details><summary>trademarks</summary><p>FreeBSD is a registered trademark of the FreeBSD Foundation.</p><p>AMD, AMD Athlon, AMD Opteron, AMD Phenom, AMD Sempron, AMD Turion, Athlon, Élan, Opteron, and PCnet are trademarks of Advanced Micro Devices, Inc.</p><p>Intel, Celeron, Centrino, Core, EtherExpress, i386, i486, Itanium, Pentium, and Xeon are trademarks or registered trademarks of Intel Corporation or its subsidiaries in the United States and other countries.</p><p>Many of the designations used by manufacturers and sellers to distinguish their products are claimed as trademarks. Where those designations appear in this document, and the FreeBSD Project was aware of the trademark claim, the designations have been followed by the “™” or the “®” symbol.</p></details></div><div class=toc-mobile><h3>Índice</h3><nav id=TableOfContents><ul><li><a href=#acknowledgments>1. Agradecimentos</a></li><li><a href=#introduction>2. Introdução</a></li><li><a href=#prerequisites>3. Pré-requisitos</a></li><li><a href=#Configuration>4. Configuração: Instalação e Setup</a></li><li><a href=#build>5. Compilando o Código de Atualização</a></li><li><a href=#patch>6. Compilando um Patch</a></li><li><a href=#tips>7. Dicas</a></li></ul></nav></div><div id=preamble><div class=sectionbody><div class="paragraph abstract-title"><p>Resumo</p></div><div class=paragraph><p>Este artigo descreve a construção de um Servidor Interno de Atualização do FreeBSD. O <a href=https://github.com/freebsd/freebsd-update-build/>freebsd-update-server</a> é escrito por <code>Colin Percival &lt;<a href=mailto:cperciva@FreeBSD.org>cperciva@FreeBSD.org</a>></code>, Oficial de Segurança Emérito do FreeBSD. Para usuários que acham conveniente atualizar seus sistemas em relação a um servidor de atualização oficial, a construção de seu próprio Servidor de Atualização do FreeBSD pode ajudar a estender sua funcionalidade ao suportar versões do FreeBSD ajustadas manualmente ou fornecer um espelho local que permitirá atualizações mais rápidas para vários computadores.</p></div><hr></div></div><div class=sect1><h2 id=acknowledgments>1. Agradecimentos<a class=anchor href=#acknowledgments></a></h2><div class=sectionbody><div class=paragraph><p>Este artigo foi posteriormente impresso na revista <a href=https://people.freebsd.org/~jgh/files/fus/BSD_03_2010_EN.pdf>BSD Magazine</a>.</p></div></div></div><div class=sect1><h2 id=introduction>2. Introdução<a class=anchor href=#introduction></a></h2><div class=sectionbody><div class=paragraph><p>Usuários ou administradores experientes frequentemente são responsáveis por várias máquinas ou ambientes. Eles entendem as exigências e desafios difíceis de manter essa infraestrutura. Executar um Servidor de Atualização do FreeBSD torna mais fácil implantar patches de segurança e atualizações de software para máquinas de teste selecionadas antes de implementá-los nos servidores de produção. Também significa que vários sistemas podem ser atualizados a partir da rede local em vez de uma conexão com a Internet potencialmente mais lenta. Este artigo descreve os passos envolvidos na criação de um Servidor Interno de Atualização do FreeBSD.</p></div></div></div><div class=sect1><h2 id=prerequisites>3. Pré-requisitos<a class=anchor href=#prerequisites></a></h2><div class=sectionbody><div class=paragraph><p>Para construir um Servidor Interno de Atualização do FreeBSD, alguns requisitos devem ser atendidos.</p></div><div class=ulist><ul><li><p>Um sistema FreeBSD em execução.</p><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>No mínimo, as atualizações requerem a criação de uma versão do FreeBSD maior ou igual a versão do release alvo para a distribuição.</p></div></td></tr></tbody></table></div></li><li><p>Uma conta de usuário com pelo menos 4 GB de espaço disponível. Isso permitirá a criação de atualizações para 7.1 e 7.2, mas os requisitos de espaço exatos podem mudar de versão para versão.</p></li><li><p>Uma conta <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;format=html">ssh(1)</a> em uma máquina remota para fazer o upload das atualizações que serão distribuídas.</p></li><li><p>Um servidor web, como o <a href=https://docs.freebsd.org/pt-br/books/handbook/book/#network-apache>Apache</a>, com mais da metade do espaço necessário para a compilação. Por exemplo, as compilações de teste para 7.1 e 7.2 consomem uma quantidade total de 4 GB, e o espaço necessário no servidor web para distribuir essas atualizações é de 2,6 GB.</p></li><li><p>Conhecimento básico de script shell com o shell Bourne, <a href="https://man.freebsd.org/cgi/man.cgi?query=sh&amp;sektion=1&amp;format=html">sh(1)</a>.</p></li></ul></div></div></div><div class=sect1><h2 id=Configuration>4. Configuração: Instalação e Setup<a class=anchor href=#Configuration></a></h2><div class=sectionbody><div class=paragraph><p>Faça o download do software <a href=https://github.com/freebsd/freebsd-update-build/>freebsd-update-server</a> instalando os pacotes <a class=package href=https://cgit.freebsd.org/ports/tree/devel/git/>devel/git</a> e <a class=package href=https://cgit.freebsd.org/ports/tree/security/ca_root_nss/>security/ca_root_nss</a>, e execute:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% git clone https://github.com/freebsd/freebsd-update-build.git freebsd-update-server</code></pre></div></div><div class=paragraph><p>Atualize o arquivo <span class=filename>scripts/build.conf</span> adequadamente. Ele será usado durante todas as operações de compilação.</p></div><div class=paragraph><p>Aqui está o <span class=filename>build.conf</span> padrão, que deve ser modificado para atender ao seu ambiente.</p></div><div class="literalblock programlisting"><div class=content><pre># Arquivo de configuração principal para compilações do FreeBSD Update.
# Os dados de configuração específicos do lançamento estão mais abaixo
# na árvore de scripts.

# Local de onde buscar os releases
export FTP=ftp://ftp2.freebsd.org/pub/FreeBSD/releases <i class=conum data-value=1></i><b>(1)</b>

# Plataforma do host
export HOSTPLATFORM=`uname -m`

# Nome do host a ser usado dentro das jails
export BUILDHOSTNAME=${HOSTPLATFORM}-builder.daemonology.net <i class=conum data-value=2></i><b>(2)</b>

# Localização da chave privada SSH
export SSHKEY=/root/.ssh/id_dsa <i class=conum data-value=3></i><b>(3)</b>

# Conta SSH para a qual os arquivos são enviados
MASTERACCT=builder@wadham.daemonology.net <i class=conum data-value=4></i><b>(4)</b>

# Diretório para o qual os arquivos são enviados
MASTERDIR=update-master.freebsd.org <i class=conum data-value=5></i><b>(5)</b></pre></div></div><div class=paragraph><p>Os parâmetros a serem considerados seriam:</p></div><div class="colist arabic"><table><tbody><tr><td><i class=conum data-value=1></i><b>1</b></td><td>Este é o local de onde as imagens ISO são baixadas (pela sub-rotina <code>fetchiso()</code> do arquivo <span class=filename>scripts/build.subr</span>). A localização configurada não se limita a URIs FTP. Qualquer esquema de URI suportado pelo utilitário padrão <a href="https://man.freebsd.org/cgi/man.cgi?query=fetch&amp;sektion=1&amp;format=html">fetch(1)</a> deve funcionar bem. Personalizações para o código <code>fetchiso()</code> podem ser instaladas copiando o arquivo padrão <span class=filename>build.subr</span> para a área específica de release e arquitetura em <span class=filename>scripts/RELEASE/ARCHITECTURE/build.subr</span> e aplicando alterações locais.</td></tr><tr><td><i class=conum data-value=2></i><b>2</b></td><td>O nome do host de compilação. Essa informação será exibida em sistemas atualizados ao emitir o comando:<div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% <span class=nb>uname</span> <span class=nt>-v</span></code></pre></div></div></td></tr><tr><td><i class=conum data-value=3></i><b>3</b></td><td>A chave SSH para enviar arquivos para o servidor de atualização. Um par de chaves pode ser criado digitando <code>ssh-keygen -t dsa</code>. Este parâmetro é opcional; a autenticação padrão por senha será usada como método de autenticação de fallback quando o <code>SSHKEY</code> não estiver definido. A página do manual <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh-keygen&amp;sektion=1&amp;format=html">ssh-keygen(1)</a> contém informações mais detalhadas sobre o SSH e os passos apropriados para criar e usar uma chave.</td></tr><tr><td><i class=conum data-value=4></i><b>4</b></td><td>Conta para enviar os arquivos para o servidor de atualização.</td></tr><tr><td><i class=conum data-value=5></i><b>5</b></td><td>Diretório no servidor de atualização onde os arquivos são enviados.</td></tr></tbody></table></div><div class=paragraph><p>O <span class=filename>build.conf</span> padrão fornecido com o código fonte do freebsd-update-server é adequado para compilar releases do FreeBSD para a arquitetura i386. Como exemplo de compilação de um servidor de atualização para outras arquiteturas, os seguintes passos resumem as alterações de configuração necessárias para a arquitetura amd64:</p></div><div class="exampleblock procedure"><div class=content><div class="olist arabic"><ol class=arabic><li><p>Crie um ambiente de compilação para o amd64:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% <span class=nb>mkdir</span> <span class=nt>-p</span> /usr/local/freebsd-update-server/scripts/7.2-RELEASE/amd64</code></pre></div></div></li><li><p>Instale um arquivo <span class=filename>build.conf</span> no diretório de compilação recém-criado. As opções de configuração de compilação para o FreeBSD 7.2-RELEASE em amd64 devem ser semelhantes a:</p><div class="literalblock programlisting"><div class=content><pre># SHA256 hash of RELEASE disc1.iso image.
export RELH=1ea1f6f652d7c5f5eab7ef9f8edbed50cb664b08ed761850f95f48e86cc71ef5 <i class=conum data-value=1></i><b>(1)</b>
# Components of the world, source, and kernels
export WORLDPARTS=&#34;base catpages dict doc games info manpages proflibs lib32&#34;
export SOURCEPARTS=&#34;base bin contrib crypto etc games gnu include krb5  \
                lib libexec release rescue sbin secure share sys tools  \
                ubin usbin cddl&#34;
export KERNELPARTS=&#34;generic&#34;

# EOL date
export EOL=1275289200 <i class=conum data-value=2></i><b>(2)</b></pre></div></div><div class="colist arabic"><table><tbody><tr><td><i class=conum data-value=1></i><b>1</b></td><td>A chave hash <a href="https://man.freebsd.org/cgi/man.cgi?query=sha256&amp;sektion=1&amp;format=html">sha256(1)</a> para o release desejado está publicada dentro do respectivo <a href=https://www.FreeBSD.org/releases/>anúncio de release</a>.</td></tr><tr><td><i class=conum data-value=2></i><b>2</b></td><td>Para gerar o número "End of Life" para o arquivo <span class=filename>build.conf</span>, consulte o "Estimated EOL" publicado no <a href=https://www.FreeBSD.org/security/security/>Site de Segurança do FreeBSD</a>. O valor de <code>EOL</code> pode ser derivado da data listada no site da web, usando o utilitário <a href="https://man.freebsd.org/cgi/man.cgi?query=date&amp;sektion=1&amp;format=html">date(1)</a>, por exemplo:<div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% <span class=nb>date</span> <span class=nt>-j</span> <span class=nt>-f</span> <span class=s1>&#39;%Y%m%d-%H%M%S&#39;</span> <span class=s1>&#39;20090401-000000&#39;</span> <span class=s1>&#39;+%s&#39;</span></code></pre></div></div></td></tr></tbody></table></div></li></ol></div></div></div></div></div><div class=sect1><h2 id=build>5. Compilando o Código de Atualização<a class=anchor href=#build></a></h2><div class=sectionbody><div class=paragraph><p>O primeiro passo é executar o <span class=filename>scripts/make.sh</span>. Isso irá compilar alguns binários, criar diretórios e gerar uma chave de assinatura RSA usada para aprovar as compilações. Nesta etapa, uma frase secreta terá que ser fornecida para a criação final da chave de assinatura.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sh scripts/make.sh</span>
cc <span class=nt>-O2</span> <span class=nt>-fno-strict-aliasing</span> <span class=nt>-pipe</span>   findstamps.c  <span class=nt>-o</span> findstamps
findstamps.c: In <span class=k>function</span> <span class=s1>&#39;usage&#39;</span>:
findstamps.c:45: warning: incompatible implicit declaration of built-in <span class=k>function</span> <span class=s1>&#39;exit&#39;</span>
cc <span class=nt>-O2</span> <span class=nt>-fno-strict-aliasing</span> <span class=nt>-pipe</span>   unstamp.c  <span class=nt>-o</span> unstamp
<span class=nb>install </span>findstamps ../bin
<span class=nb>install </span>unstamp ../bin
<span class=nb>rm</span> <span class=nt>-f</span> findstamps unstamp
Generating RSA private key, 4096 bit long modulus
................................................................................++
...................++
e is 65537 <span class=o>(</span>0x10001<span class=o>)</span>

Public key fingerprint:
27ef53e48dc869eea6c3136091cc6ab8589f967559824779e855d58a2294de9e

Encrypting signing key <span class=k>for </span>root
enter aes-256-cbc encryption password:
Verifying - enter aes-256-cbc encryption password:</code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Anote a impressão digital da chave gerada. Este valor será necessário no <span class=filename>/etc/freebsd-update.conf</span> para as atualizações binárias.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Neste ponto, estamos prontos para preparar uma compilação.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/local/freebsd-update-server</span>
<span class=c># sh scripts/init.sh amd64 7.2-RELEASE</span></code></pre></div></div><div class=paragraph><p>A seguir, segue um exemplo da execução de uma compilação <em>inicial</em>.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sh scripts/init.sh amd64 7.2-RELEASE</span>
Mon Aug 24 16:04:36 PDT 2009 Starting fetch <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
/usr/local/freebsd-update-server/work/7.2-RELE100 of  588 MB  359 kBps 00m00s
Mon Aug 24 16:32:38 PDT 2009 Verifying disc1 <span class=nb>hash </span><span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 16:32:44 PDT 2009 Extracting components <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 16:34:05 PDT 2009 Constructing world+src image <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 16:35:57 PDT 2009 Extracting world+src <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 23:36:24 UTC 2009 Building world <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Tue Aug 25 00:31:29 UTC 2009 Distributing world <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Tue Aug 25 00:32:36 UTC 2009 Building and distributing kernels <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Tue Aug 25 00:44:44 UTC 2009 Constructing world components <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Tue Aug 25 00:44:56 UTC 2009 Distributing <span class=nb>source </span><span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 17:46:18 PDT 2009 Moving components into staging area <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 17:46:33 PDT 2009 Identifying extra documentation <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 17:47:13 PDT 2009 Extracting extra docs <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 17:47:18 PDT 2009 Indexing release <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 17:50:44 PDT 2009 Indexing world0 <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE

Files built but not released:
Files released but not built:
Files which differ by more than contents:
Files which differ between release and build:
kernel|generic|/GENERIC/hptrr.ko
kernel|generic|/GENERIC/kernel
src|sys|/sys/conf/newvers.sh
world|base|/boot/loader
world|base|/boot/pxeboot
world|base|/etc/mail/freebsd.cf
world|base|/etc/mail/freebsd.submit.cf
world|base|/etc/mail/sendmail.cf
world|base|/etc/mail/submit.cf
world|base|/lib/libcrypto.so.5
world|base|/usr/bin/ntpq
world|base|/usr/lib/libalias.a
world|base|/usr/lib/libalias_cuseeme.a
world|base|/usr/lib/libalias_dummy.a
world|base|/usr/lib/libalias_ftp.a
...</code></pre></div></div><div class=paragraph><p>Em seguida, a compilação do target "world" é realizada novamente, com patches de "world". Uma explicação mais detalhada pode ser encontrada em <span class=filename>scripts/build.subr</span>.</p></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>Durante esse segundo ciclo de compilação, o daemon do protocolo de tempo de rede, <a href="https://man.freebsd.org/cgi/man.cgi?query=ntpd&amp;sektion=8&amp;format=html">ntpd(8)</a>, é desativado. Conforme o <code>Colin Percival &lt;<a href=mailto:cperciva@FreeBSD.org>cperciva@FreeBSD.org</a>></code>, Oficial de Segurança Emérito do FreeBSD, "o código de compilação do <a href=https://github.com/freebsd/freebsd-update-build/>freebsd-update-server</a> precisa identificar carimbos de data/hora que são armazenados em arquivos para que eles possam ser ignorados ao comparar compilações e determinar quais arquivos precisam ser atualizados. Esse processo de localização de carimbos de data/hora funciona fazendo duas compilações com 400 dias de intervalo e comparando os resultados."</p></div></td></tr></tbody></table></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>Mon Aug 24 17:54:07 PDT 2009 Extracting world+src <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Wed Sep 29 00:54:34 UTC 2010 Building world <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Wed Sep 29 01:49:42 UTC 2010 Distributing world <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Wed Sep 29 01:50:50 UTC 2010 Building and distributing kernels <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Wed Sep 29 02:02:56 UTC 2010 Constructing world components <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Wed Sep 29 02:03:08 UTC 2010 Distributing <span class=nb>source </span><span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Tue Sep 28 19:04:31 PDT 2010 Moving components into staging area <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 19:04:46 PDT 2009 Extracting extra docs <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 19:04:51 PDT 2009 Indexing world1 <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 19:08:04 PDT 2009 Locating build stamps <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 19:10:19 PDT 2009 Cleaning staging area <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 19:10:19 PDT 2009 Preparing to copy files into staging area <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 19:10:20 PDT 2009 Copying data files into staging area <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 12:16:57 PDT 2009 Copying metadata files into staging area <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 12:16:59 PDT 2009 Constructing metadata index and tag <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE

Files found which include build stamps:
kernel|generic|/GENERIC/hptrr.ko
kernel|generic|/GENERIC/kernel
world|base|/boot/loader
world|base|/boot/pxeboot
world|base|/etc/mail/freebsd.cf
world|base|/etc/mail/freebsd.submit.cf
world|base|/etc/mail/sendmail.cf
world|base|/etc/mail/submit.cf
world|base|/lib/libcrypto.so.5
world|base|/usr/bin/ntpq
world|base|/usr/include/osreldate.h
world|base|/usr/lib/libalias.a
world|base|/usr/lib/libalias_cuseeme.a
world|base|/usr/lib/libalias_dummy.a
world|base|/usr/lib/libalias_ftp.a
...</code></pre></div></div><div class=paragraph><p>Por fim, a compilação é concluída.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>Values of build stamps, excluding library archive headers:
v1.2 <span class=o>(</span>Aug 25 2009 00:40:36<span class=o>)</span>
v1.2 <span class=o>(</span>Aug 25 2009 00:38:22<span class=o>)</span>
@<span class=o>()</span>FreeBSD 7.2-RELEASE 0: Tue Aug 25 00:38:29 UTC 2009
FreeBSD 7.2-RELEASE 0: Tue Aug 25 00:38:29 UTC 2009
    root@server.myhost.com:/usr/obj/usr/src/sys/GENERIC
7.2-RELEASE
Mon Aug 24 23:55:25 UTC 2009
Mon Aug 24 23:55:25 UTC 2009
 built by root@server.myhost.com on Tue Aug 25 00:16:15 UTC 2009
 built by root@server.myhost.com on Tue Aug 25 00:16:15 UTC 2009
 built by root@server.myhost.com on Tue Aug 25 00:16:15 UTC 2009
 built by root@server.myhost.com on Tue Aug 25 00:16:15 UTC 2009
Mon Aug 24 23:46:47 UTC 2009
ntpq 4.2.4p5-a Mon Aug 24 23:55:53 UTC 2009 <span class=o>(</span>1<span class=o>)</span>
 <span class=k>*</span> Copyright <span class=o>(</span>c<span class=o>)</span> 1992-2009 The FreeBSD Project.
Mon Aug 24 23:46:47 UTC 2009
Mon Aug 24 23:55:40 UTC 2009
Aug 25 2009
ntpd 4.2.4p5-a Mon Aug 24 23:55:52 UTC 2009 <span class=o>(</span>1<span class=o>)</span>
ntpdate 4.2.4p5-a Mon Aug 24 23:55:53 UTC 2009 <span class=o>(</span>1<span class=o>)</span>
ntpdc 4.2.4p5-a Mon Aug 24 23:55:53 UTC 2009 <span class=o>(</span>1<span class=o>)</span>
Tue Aug 25 00:21:21 UTC 2009
Tue Aug 25 00:21:21 UTC 2009
Tue Aug 25 00:21:21 UTC 2009
Mon Aug 24 23:46:47 UTC 2009

FreeBSD/amd64 7.2-RELEASE initialization build complete.  Please
review the list of build stamps printed above to confirm that
they look sensible, <span class=k>then </span>run
 sh <span class=nt>-e</span> approve.sh amd64 7.2-RELEASE
to sign the release.</code></pre></div></div><div class=paragraph><p>Aprove a compilação se tudo estiver correto. Mais informações sobre como determinar isso podem ser encontradas no arquivo de origem da distribuição chamado <span class=filename>USAGE</span>. Execute <span class=filename>scripts/approve.sh</span>, conforme indicado. Isso irá assinar a versão e mover os componentes para uma área de preparação adequada para o upload.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/local/freebsd-update-server</span>
<span class=c># sh scripts/mountkey.sh</span></code></pre></div></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sh -e scripts/approve.sh amd64 7.2-RELEASE</span>
Wed Aug 26 12:50:06 PDT 2009 Signing build <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Wed Aug 26 12:50:06 PDT 2009 Copying files to patch <span class=nb>source </span>directories <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Wed Aug 26 12:50:06 PDT 2009 Copying files to upload staging area <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Wed Aug 26 12:50:07 PDT 2009 Updating databases <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE
Wed Aug 26 12:50:07 PDT 2009 Cleaning staging area <span class=k>for </span>FreeBSD/amd64 7.2-RELEASE</code></pre></div></div><div class=paragraph><p>Após a conclusão do processo de aprovação, o procedimento de upload pode ser iniciado.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/local/freebsd-update-server</span>
<span class=c># sh scripts/upload.sh amd64 7.2-RELEASE</span></code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Caso o código de atualização precise ser reenviado, isso pode ser feito alterando para o diretório de distribuições públicas do release de destino e atualizando os atributos do arquivo já <em>enviado</em>.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/local/freebsd-update-server/pub/7.2-RELEASE/amd64</span>
<span class=c># touch -t 200801010101.01 uploaded</span></code></pre></div></div></td></tr></tbody></table></div><div class=paragraph><p>Os arquivos enviados precisarão estar no diretório raiz de documentos do servidor web para que as atualizações possam ser distribuídas. A configuração exata variará dependendo do servidor web utilizado. Para o servidor web Apache, consulte a seção <a href=https://docs.freebsd.org/pt-br/books/handbook/book/#network-apache>Configuração de servidores Apache</a> no Handbook.</p></div><div class=paragraph><p>Atualize o <code>KeyPrint</code> e o <code>ServerName</code> do cliente em <span class=filename>/etc/freebsd-update.conf</span>, e execute as atualizações conforme instruído na seção <a href=https://docs.freebsd.org/pt-br/books/handbook/book/#updating-upgrading-freebsdupdate>Atualização do FreeBSD</a> do Handbook.</p></div><div class="admonitionblock important"><table><tbody><tr><td class=icon><i class="fa icon-important" title=Important></i></td><td class=content><div class=paragraph><p>Para que o Servidor de Atualização do FreeBSD funcione corretamente, as atualizações tanto para o release <em>atual</em> quanto para o release <em>para o qual se deseja atualizar</em> precisam ser compiladas. Isso é necessário para determinar as diferenças nos arquivos entre os releases. Por exemplo, ao atualizar um sistema FreeBSD da versão 7.1-RELEASE para a versão 7.2-RELEASE, as atualizações precisarão ser compiladas e enviadas para o seu servidor de distribuição para ambas as versões.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Para referência, toda a execução do <a href=../../source/articles/freebsd-update-server/init.txt>init.sh</a> está anexada.</p></div></div></div><div class=sect1><h2 id=patch>6. Compilando um Patch<a class=anchor href=#patch></a></h2><div class=sectionbody><div class=paragraph><p>Toda vez que uma <a href=https://www.FreeBSD.org/security/advisories/>recomendação de segurança</a> ou um <a href=https://www.FreeBSD.org/security/notices/>aviso de segurança</a> é anunciado, uma atualização de patch pode ser compilada.</p></div><div class=paragraph><p>Para este exemplo, o 7.1-RELEASE será usado.</p></div><div class=paragraph><p>Algumas suposições são feitas para compilar uma release diferente:</p></div><div class=ulist><ul><li><p>Configure a estrutura de diretórios correta para a compilação inicial.</p></li><li><p>Execute uma compilação inicial para o 7.1-RELEASE.</p></li></ul></div><div class=paragraph><p>Crie o diretório de patches do respectivo release em <span class=filename>/usr/local/freebsd-update-server/patches/</span>.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% <span class=nb>mkdir</span> <span class=nt>-p</span> /usr/local/freebsd-update-server/patches/7.1-RELEASE/
% <span class=nb>cd</span> /usr/local/freebsd-update-server/patches/7.1-RELEASE</code></pre></div></div><div class=paragraph><p>Como exemplo, considere o patch para o <a href="https://man.freebsd.org/cgi/man.cgi?query=named&amp;sektion=8&amp;format=html">named(8)</a>. Leia o aviso e pegue o arquivo necessário em <a href=https://www.FreeBSD.org/security/advisories/>Avisos de Segurança do FreeBSD</a>. Mais informações sobre a interpretação do aviso podem ser encontradas no <a href=https://docs.freebsd.org/pt-br/books/handbook/book/#security-advisories>Handbook do FreeBSD</a>.</p></div><div class=paragraph><p>No <a href=https://security.freebsd.org/advisories/FreeBSD-SA-09:12.bind.asc>informe de segurança</a>, este aviso é chamado de <code>SA-09:12.bind</code>. Após o download do arquivo, é necessário renomeá-lo para um nível de patch apropriado. É sugerido manter isso consistente com os níveis de patch oficiais do FreeBSD, mas seu nome pode ser escolhido livremente . Para esta compilação, vamos seguir a prática atualmente estabelecida do FreeBSD e chamá-la de <code>p7</code>. Renomeie o arquivo:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% <span class=nb>cd</span> /usr/local/freebsd-update-server/patches/7.1-RELEASE/<span class=p>;</span> <span class=nb>mv </span>bind.patch 7-SA-09:12.bind</code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Ao executar uma compilação de nível de patch, presume-se que os patches anteriores estão em vigor. Quando uma compilação de patch é executada, ela executará todos os patches contidos no diretório de patch.</p></div><div class=paragraph><p>Podem ser adicionados patches personalizados a qualquer compilação. Use o número zero ou qualquer outro número.</p></div></td></tr></tbody></table></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>Cabe ao administrador do Servidor de Atualização do FreeBSD tomar as medidas apropriadas para verificar a autenticidade de cada patch.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Neste ponto, um <em>diff</em> está pronto para ser compilado. O software verifica primeiro se um <span class=filename>scripts/init.sh</span> foi executado no respectivo release antes de executar a compilação do <em>diff</em>.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/local/freebsd-update-server</span>
<span class=c># sh scripts/diff.sh amd64 7.1-RELEASE 7</span></code></pre></div></div><div class=paragraph><p>A seguir, segue um exemplo de execução de compilação <em>diferencial</em>.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sh -e scripts/diff.sh amd64 7.1-RELEASE 7</span>
Wed Aug 26 10:09:59 PDT 2009 Extracting world+src <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Wed Aug 26 17:10:25 UTC 2009 Building world <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Wed Aug 26 18:05:11 UTC 2009 Distributing world <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Wed Aug 26 18:06:16 UTC 2009 Building and distributing kernels <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Wed Aug 26 18:17:50 UTC 2009 Constructing world components <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Wed Aug 26 18:18:02 UTC 2009 Distributing <span class=nb>source </span><span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Wed Aug 26 11:19:23 PDT 2009 Moving components into staging area <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Wed Aug 26 11:19:37 PDT 2009 Extracting extra docs <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Wed Aug 26 11:19:42 PDT 2009 Indexing world0 <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Wed Aug 26 11:23:02 PDT 2009 Extracting world+src <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Thu Sep 30 18:23:29 UTC 2010 Building world <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Thu Sep 30 19:18:15 UTC 2010 Distributing world <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Thu Sep 30 19:19:18 UTC 2010 Building and distributing kernels <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Thu Sep 30 19:30:52 UTC 2010 Constructing world components <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Thu Sep 30 19:31:03 UTC 2010 Distributing <span class=nb>source </span><span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Thu Sep 30 12:32:25 PDT 2010 Moving components into staging area <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Wed Aug 26 12:32:39 PDT 2009 Extracting extra docs <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Wed Aug 26 12:32:43 PDT 2009 Indexing world1 <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Wed Aug 26 12:35:54 PDT 2009 Locating build stamps <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Wed Aug 26 12:36:58 PDT 2009 Reverting changes due to build stamps <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Wed Aug 26 12:37:14 PDT 2009 Cleaning staging area <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Wed Aug 26 12:37:14 PDT 2009 Preparing to copy files into staging area <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Wed Aug 26 12:37:15 PDT 2009 Copying data files into staging area <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Wed Aug 26 12:43:23 PDT 2009 Copying metadata files into staging area <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
Wed Aug 26 12:43:25 PDT 2009 Constructing metadata index and tag <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE-p7
...
Files found which include build stamps:
kernel|generic|/GENERIC/hptrr.ko
kernel|generic|/GENERIC/kernel
world|base|/boot/loader
world|base|/boot/pxeboot
world|base|/etc/mail/freebsd.cf
world|base|/etc/mail/freebsd.submit.cf
world|base|/etc/mail/sendmail.cf
world|base|/etc/mail/submit.cf
world|base|/lib/libcrypto.so.5
world|base|/usr/bin/ntpq
world|base|/usr/include/osreldate.h
world|base|/usr/lib/libalias.a
world|base|/usr/lib/libalias_cuseeme.a
world|base|/usr/lib/libalias_dummy.a
world|base|/usr/lib/libalias_ftp.a
...
Values of build stamps, excluding library archive headers:
v1.2 <span class=o>(</span>Aug 26 2009 18:13:46<span class=o>)</span>
v1.2 <span class=o>(</span>Aug 26 2009 18:11:44<span class=o>)</span>
@<span class=o>()</span>FreeBSD 7.1-RELEASE-p7 0: Wed Aug 26 18:11:50 UTC 2009
FreeBSD 7.1-RELEASE-p7 0: Wed Aug 26 18:11:50 UTC 2009
    root@server.myhost.com:/usr/obj/usr/src/sys/GENERIC
7.1-RELEASE-p7
Wed Aug 26 17:29:15 UTC 2009
Wed Aug 26 17:29:15 UTC 2009
 built by root@server.myhost.com on Wed Aug 26 17:49:58 UTC 2009
 built by root@server.myhost.com on Wed Aug 26 17:49:58 UTC 2009
 built by root@server.myhost.com on Wed Aug 26 17:49:58 UTC 2009
 built by root@server.myhost.com on Wed Aug 26 17:49:58 UTC 2009
Wed Aug 26 17:20:39 UTC 2009
ntpq 4.2.4p5-a Wed Aug 26 17:29:42 UTC 2009 <span class=o>(</span>1<span class=o>)</span>
 <span class=k>*</span> Copyright <span class=o>(</span>c<span class=o>)</span> 1992-2009 The FreeBSD Project.
Wed Aug 26 17:20:39 UTC 2009
Wed Aug 26 17:29:30 UTC 2009
Aug 26 2009
ntpd 4.2.4p5-a Wed Aug 26 17:29:41 UTC 2009 <span class=o>(</span>1<span class=o>)</span>
ntpdate 4.2.4p5-a Wed Aug 26 17:29:42 UTC 2009 <span class=o>(</span>1<span class=o>)</span>
ntpdc 4.2.4p5-a Wed Aug 26 17:29:42 UTC 2009 <span class=o>(</span>1<span class=o>)</span>
Wed Aug 26 17:55:02 UTC 2009
Wed Aug 26 17:55:02 UTC 2009
Wed Aug 26 17:55:02 UTC 2009
Wed Aug 26 17:20:39 UTC 2009
...</code></pre></div></div><div class=paragraph><p>As atualizações são impressas e a aprovação é solicitada.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>New updates:
kernel|generic|/GENERIC/kernel.symbols|f|0|0|0555|0|7c8dc176763f96ced0a57fc04e7c1b8d793f27e006dd13e0b499e1474ac47e10|
kernel|generic|/GENERIC/kernel|f|0|0|0555|0|33197e8cf15bbbac263d17f39c153c9d489348c2c534f7ca1120a1183dec67b1|
kernel|generic|/|d|0|0|0755|0||
src|base|/|d|0|0|0755|0||
src|bin|/|d|0|0|0755|0||
src|cddl|/|d|0|0|0755|0||
src|contrib|/contrib/bind9/bin/named/update.c|f|0|10000|0644|0|4d434abf0983df9bc47435670d307fa882ef4b348ed8ca90928d250f42ea0757|
src|contrib|/contrib/bind9/lib/dns/openssldsa_link.c|f|0|10000|0644|0|c6805c39f3da2a06dd3f163f26c314a4692d4cd9a2d929c0acc88d736324f550|
src|contrib|/contrib/bind9/lib/dns/opensslrsa_link.c|f|0|10000|0644|0|fa0f7417ee9da42cc8d0fd96ad24e7a34125e05b5ae075bd6e3238f1c022a712|
...
FreeBSD/amd64 7.1-RELEASE update build complete.  Please review
the list of build stamps printed above and the list of updated
files to confirm that they look sensible, <span class=k>then </span>run
 sh <span class=nt>-e</span> approve.sh amd64 7.1-RELEASE
to sign the build.</code></pre></div></div><div class=paragraph><p>Siga o mesmo processo mencionado anteriormente para aprovar uma compilação:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sh -e scripts/approve.sh amd64 7.1-RELEASE</span>
Wed Aug 26 12:50:06 PDT 2009 Signing build <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE
Wed Aug 26 12:50:06 PDT 2009 Copying files to patch <span class=nb>source </span>directories <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE
Wed Aug 26 12:50:06 PDT 2009 Copying files to upload staging area <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE
Wed Aug 26 12:50:07 PDT 2009 Updating databases <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE
Wed Aug 26 12:50:07 PDT 2009 Cleaning staging area <span class=k>for </span>FreeBSD/amd64 7.1-RELEASE

The FreeBSD/amd64 7.1-RELEASE update build has been signed and is
ready to be uploaded.  Remember to run
 sh <span class=nt>-e</span> umountkey.sh
to unmount the decrypted key once you have finished signing all
the new builds.</code></pre></div></div><div class=paragraph><p>Depois de aprovar a compilação, faça o upload do software:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/local/freebsd-update-server</span>
<span class=c># sh scripts/upload.sh amd64 7.1-RELEASE</span></code></pre></div></div><div class=paragraph><p>Para referência, toda a execução do <a href=../../source/articles/freebsd-update-server/diff.txt>diff.sh</a> está anexada.</p></div></div></div><div class=sect1><h2 id=tips>7. Dicas<a class=anchor href=#tips></a></h2><div class=sectionbody><div class=ulist><ul><li><p>Se um release personalizado for compilado usando o <a href=https://docs.freebsd.org/pt-br/articles/releng/#release-build>procedimento</a> nativo <code>make release</code>, o código do freebsd-update-server funcionará a partir do seu release. Como exemplo, um release sem ports ou documentação pode ser criado limpando a funcionalidade referente às sub-rotinas de documentação <code>findextradocs ()</code>, <code>addextradocs ()</code> e alterando o local de download em <code>fetchiso ()</code>, respectivamente, em <span class=filename>scripts/build.subr</span>. Como último passo, altere a chave <a href="https://man.freebsd.org/cgi/man.cgi?query=sha256&amp;sektion=1&amp;format=html">sha256(1)</a> em <span class=filename>build.conf</span> no seu respectivo release e arquitetura e você estará pronto para compilar o seu release personalizado.</p><div class="literalblock programlisting"><div class=content><pre># Compare ${WORKDIR}/release and ${WORKDIR}/$1, identify which parts
# of the world|doc subcomponent are missing from the latter, and
# build a tarball out of them.
findextradocs () {
}
# Add extra docs to ${WORKDIR}/$1
addextradocs () {
}</pre></div></div></li><li><p>Adicionar flags <code>-j <em>NUMERO</em></code> para os alvos <code>buildworld</code> e <code>obj</code> no script <span class=filename>scripts/build.subr</span> pode acelerar o processamento, dependendo do hardware utilizado, no entanto, não é necessário. Usar esses flags em outros alvos não é recomendado, pois pode fazer com que a compilação se torne pouco confiável.</p><div class="literalblock programlisting"><div class=content><pre>              # Build the world
		   log &#34;Building world&#34;
		   cd /usr/src &amp;&amp;
		   make -j 2 ${COMPATFLAGS} buildworld 2&gt;&amp;1
		# Distribute the world
		   log &#34;Distributing world&#34;
		   cd /usr/src/release &amp;&amp;
		   make -j 2 obj &amp;&amp;
		   make ${COMPATFLAGS} release.1 release.2 2&gt;&amp;1</pre></div></div></li><li><p>Crie um registro <a href=https://docs.freebsd.org/pt-br/books/handbook/book/#network-dns>DNS</a> SRV apropriado para o servidor de atualização e coloque outros atrás dele com pesos variáveis. O uso dessa facilidade fornecerá espelhos de atualização, no entanto, essa dica não é necessária, a menos que você deseje fornecer um serviço redundante.</p><div class="literalblock programlisting"><div class=content><pre>_http._tcp.update.myserver.com.		IN SRV   0 2 80   host1.myserver.com.
					IN SRV   0 1 80   host2.myserver.com.
					IN SRV   0 0 80   host3.myserver.com.</pre></div></div></li></ul></div></div></div><hr><div class=last-modified><p><strong>Última alteração em</strong>: 22 de abril de 2023 por <a href="https://cgit.freebsd.org/doc/commit/?id=cb9e622b4b" target=_blank>Edson Brandi</a></p></div></div><aside class=toc><div class=toc-content><h3>Índice</h3><nav id=TableOfContents><ul><li><a href=#acknowledgments>1. Agradecimentos</a></li><li><a href=#introduction>2. Introdução</a></li><li><a href=#prerequisites>3. Pré-requisitos</a></li><li><a href=#Configuration>4. Configuração: Instalação e Setup</a></li><li><a href=#build>5. Compilando o Código de Atualização</a></li><li><a href=#patch>6. Compilando um Patch</a></li><li><a href=#tips>7. Dicas</a></li></ul></nav><hr><div class=resources><h3>Recursos</h3><ul class=contents><li><i class="fa fa-file-pdf-o" aria-hidden=true title="Download PDF"></i><a href=https://download.freebsd.org/doc/pt-br/articles/freebsd-update-server/freebsd-update-server_pt-br.pdf>Download PDF</a></li><li><i class="fa fa-pencil-square-o" aria-hidden=true title="Edite essa página"></i><a href=https://github.com/freebsd/freebsd-doc/blob/main/documentation/content/pt-br/_index target=_blank>Edite essa página</a></li></ul></div></div></aside></main><footer><div class=footer-container><section class=logo-column><img src=http://172.16.201.134:1313/images/FreeBSD-colors.svg width=160 height=50 alt="FreeBSD logo"><div class=options-container><div class=language-container><a id=languages href=http://172.16.201.134:1313/pt-br/languages><img src=http://172.16.201.134:1313/images/language.png class=language-image alt="Escolha o idioma">
<span>Brazilian Portuguese</span></a></div><div class=theme-container><select id=theme-chooser><option value=theme-system>System</option><option value=theme-light>Light</option><option value=theme-dark>Dark</option><option value=theme-high-contrast>Alto contraste</option></select></div></div></section><section class=about-column><h3 class=column-title>About</h3><ul class=column-elements-container><li><a href=https://www.freebsd.org/about/ target=_blank class=column-element>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/ target=_blank class=column-element>FreeBSD Foundation</a></li><li><a href=https://www.freebsd.org/where/ target=_blank class=column-element>Get FreeBSD</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct target=_blank class=column-element>Code of Conduct</a></li><li><a href=https://www.freebsd.org/security/ target=_blank class=column-element>Security Advisories</a></li></ul></section><section class=documentation-column><h3 class=column-title>Documentation</h3><ul class=column-elements-container><li><a href=/pt-br class=column-element>Documentation portal</a></li><li><a href=https://man.FreeBSD.org target=_blank class=column-element>Manual pages</a></li><li><a href=https://papers.FreeBSD.org target=_blank class=column-element>Presentations and papers</a></li><li><a href=https://docs-archive.freebsd.org/doc/ target=_blank class=column-element>Previous versions</a></li><li><a href=https://docs-archive.freebsd.org/44doc/ target=_blank class=column-element>4.4BSD Documents</a></li><li><a href=https://wiki.freebsd.org/ target=_blank class=column-element>Wiki</a></li></ul></section><section class=community-column><h3 class=column-title>Community</h3><ul class=column-elements-container><li><a href=http://172.16.201.134:1313/pt-br/articles/contributing class=column-element>Get involved</a></li><li><a href=https://forums.freebsd.org/ target=_blank class=column-element>Community forum</a></li><li><a href=https://lists.freebsd.org/ target=_blank class=column-element>Mailing lists</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank class=column-element>IRC Channels</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank class=column-element>Bug Tracker</a></li></ul></section><section class=legal-column><h3 class=column-title>Legal</h3><ul class=column-elements-container><li><a href=https://freebsdfoundation.org/donate/ target=_blank class=column-element>Donations</a></li><li><a href=https://www.freebsd.org/copyright/freebsd-license/ target=_blank class=column-element>Licensing</a></li><li><a href=https://www.freebsd.org/privacy/ target=_blank class=column-element>Privacy Policy</a></li><li><a href=https://www.freebsd.org/copyright/ target=_blank class=column-element>Legal notices</a></li></ul></section><section class=copyright-column><p>&copy; 1994-2024 The FreeBSD Project. All rights reserved</p><span>Made with <span class=heart>♥</span> by the FreeBSD Community</span></section></div></footer></body></html>