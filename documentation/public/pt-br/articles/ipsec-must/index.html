<!doctype html><html class=theme-light lang=pt-br><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Verificação Independente da Funcionalidade IPsec no FreeBSD"><meta name=keywords content="IPsec,verification,FreeBSD"><meta name=copyright content="1995-2024 The FreeBSD Foundation"><link rel=canonical href=http://172.16.201.134:1313/pt-br/articles/ipsec-must/><title>Verificação Independente da Funcionalidade IPsec no FreeBSD | FreeBSD Documentation Portal</title>
<meta name=theme-color content="#790000"><meta name=color-scheme content="system light dark high-contrast"><link rel="shortcut icon" href=http://172.16.201.134:1313/favicon.ico><link rel=stylesheet href=http://172.16.201.134:1313/styles/main.min.css><link rel=stylesheet href=http://172.16.201.134:1313/css/font-awesome-min.css><script defer src=/js/theme-chooser.min.js></script><script defer src=/js/copy-clipboard.min.js></script><script defer src=/js/search.min.js></script><meta name=twitter:card content="summary"><meta name=twitter:domain content="docs.FreeBSD.org"><meta name=twitter:site content="@freebsd"><meta name=twitter:url content="https://twitter.com/freebsd"><meta property="og:title" content="Verificação Independente da Funcionalidade IPsec no FreeBSD"><meta property="og:description" content="Verificação Independente da Funcionalidade IPsec no FreeBSD"><meta property="og:type" content="website"><meta property="og:image" content="http://172.16.201.134:1313/favicon.ico"><meta property="og:image:alt" content="FreeBSD Logo"><meta property="og:locale" content="pt-br"><meta property="og:url" content="http://172.16.201.134:1313/pt-br/articles/ipsec-must/"><meta property="og:site_name" content="FreeBSD Documentation Portal"><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","url":"http:\/\/172.16.201.134:1313\/pt-br\/articles\/ipsec-must\/","name":"FreeBSD Documentation Portal","headline":"FreeBSD Documentation Portal","description":"FreeBSD Documentation Portal"}</script></head><body><header><div class=header-container><div class=logo-menu-bars-container><a href=https://www.FreeBSD.org class=logo><img src=http://172.16.201.134:1313/images/FreeBSD-monochromatic.svg width=160 height=50 alt="FreeBSD logo">
</a><label class=menu-bars for=menu-bars><i class="fa fa-bars" aria-hidden=true></i></label></div><input id=menu-bars type=checkbox><nav><ul class=menu><li class=menu-item><input id=about type=checkbox>
<a href=# aria-label="Navigate to About section"><label class=menu-item-description for=about>About
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/about/ target=_blank>About</a></li><li><a href=https://www.freebsd.org/about/ target=_blank>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/about-us/about-the-foundation/ target=_blank>FreeBSD Foundation</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct/ target=_blank>Code of Conduct</a></li></ul></li><li class=menu-item><input id=download type=checkbox>
<a href=# aria-label="Navigate to get FreeBSD section"><label class=menu-item-description for=download>Get FreeBSD
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/where/ target=_blank>Get FreeBSD</a></li><li><a href=https://www.freebsd.org/releases/ target=_blank>Release Information</a></li><li><a href=https://www.freebsd.org/releng/ target=_blank>Release Engineering</a></li><li><a href=https://www.freebsd.org/security/ target=_blank>Security Advisories</a></li></ul></li><li class=menu-item><input id=documentation type=checkbox>
<a href=# aria-label="Navigate to get Documentation section"><label class=menu-item-description for=documentation>Documentation
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=/pt-br>Documentation portal</a></li><li><a href=http://172.16.201.134:1313/pt-br/books/handbook>FreeBSD Handbook</a></li><li><a href=http://172.16.201.134:1313/pt-br/books/porters-handbook>Porter's Handbook</a></li><li><a href=https://docs.FreeBSD.org/en/books/fdp-primer>Documentation Project Handbook</a></li><li><a href=https://man.FreeBSD.org target=_blank>Manual pages</a></li><li><a href=https://papers.FreeBSD.org target=_blank>Presentations and papers</a></li><li><a href=https://wiki.FreeBSD.org target=_blank>Wiki</a></li><li><a href=http://172.16.201.134:1313/pt-br/books>Books</a></li><li><a href=http://172.16.201.134:1313/pt-br/articles>Articles</a></li></ul></li><li class=menu-item><input id=community type=checkbox>
<a href=# aria-label="Navigate to get Community section"><label class=menu-item-description for=community>Community
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/community/>Community</a></li><li><a href=http://172.16.201.134:1313/pt-br/articles/contributing>Get involved</a></li><li><a href=https://forums.freebsd.org/ target=_blank>Forum</a></li><li><a href=https://lists.freebsd.org/ target=_blank>Mailing lists</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank>IRC Channels</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank>Bug Tracker</a></li><li><a href=https://www.freebsd.org/support/ target=_blank>Support</a></li></ul></li></ul></nav><div class=search-donate-container><form class=search method=get id=search-header-form action=https://docs.freebsd.org/search name=search-header-form><input type=hidden name=DB value=pt-br>
<input id=words name=P type=text size=20 maxlength=255>
<button>
<i class="fa fa-search" aria-hidden=true></i></button></form><div class=donate><a href=https://freebsdfoundation.org/donate/ target=_blank><span class=heart>♥</span>
Donate</a></div></div></div></header><main class=main-wrapper-article><div class=article><h1 class=title>Verificação Independente da Funcionalidade IPsec no FreeBSD</h1><div class="admonitionblock note"><p><i class="fa fa-exclamation-circle" aria-hidden=true></i>
Esta tradução pode estar desatualizada. Para ajudar com as traduções, acesse a <a href=https://translate-dev.freebsd.org/ target=_blank>ferramenta de traduções do FreeBSD</a>.</p></div><div class=legalnotice><a id=trademarks></a><details><summary>trademarks</summary><p>FreeBSD is a registered trademark of the FreeBSD Foundation.</p><p>Motif, OSF/1, and UNIX are registered trademarks and IT DialTone and The Open Group are trademarks of The Open Group in the United States and other countries.</p><p>Many of the designations used by manufacturers and sellers to distinguish their products are claimed as trademarks. Where those designations appear in this document, and the FreeBSD Project was aware of the trademark claim, the designations have been followed by the “™” or the “®” symbol.</p></details></div><div class=toc-mobile><h3>Índice</h3><nav id=TableOfContents><ul><li><a href=#problem>1. O problema</a></li><li><a href=#solution>2. A solução</a></li><li><a href=#experiment>3. O Experimento</a></li><li><a href=#caveat>4. Embargo</a></li><li><a href=#IPsec>5. IPsec --- Definição</a></li><li><a href=#ipsec-install>6. Instalando o IPsec</a></li><li><a href=#kernel>7. src/sys/i386/conf/KERNELNAME</a></li><li><a href=#code>8. Teste estatístico universal de Maurer (para tamanho de bloco = 8 bits)</a></li></ul></nav></div><div id=preamble><div class=sectionbody><div class="paragraph abstract-title"><p>Resumo</p></div><div class=paragraph><p>Você instalou o IPsec e ele parece estar funcionando. Como você sabe? Eu descrevo um método para verificar experimentalmente se o IPsec está funcionando.</p></div><hr></div></div><div class=sect1><h2 id=problem>1. O problema<a class=anchor href=#problem></a></h2><div class=sectionbody><div class=paragraph><p>Primeiramente, vamos supor que você tenha o instalado o IPsec (<a href=#ipsec-install>Instalando o IPsec</a>). Como você sabe se há algum problema (<a href=#caveat>Embargo</a>)? É verdade que sua conexão não funcionará se estiver mal configurada, e funcionará quando você finalmente acertar. O comando <a href="https://man.freebsd.org/cgi/man.cgi?query=netstat&amp;sektion=1&amp;format=html">netstat(1)</a> listará isso. Mas você pode confirmar isso de forma independente?</p></div></div></div><div class=sect1><h2 id=solution>2. A solução<a class=anchor href=#solution></a></h2><div class=sectionbody><div class=paragraph><p>Em primeiro lugar, vejamos alguma informação teórica relevante em relação à criptografia:</p></div><div class="olist arabic"><ol class=arabic><li><p>Dados criptografados são uniformemente distribuídos, ou seja, possuem entropia máxima por símbolo;</p></li><li><p>Os dados brutos, não comprimidos são tipicamente redundantes, isto é, possuem entropia submáxima.</p></li></ol></div><div class=paragraph><p>Suponha que você pudesse medir a entropia dos dados que entram e saem de sua interface de rede. Então, você poderia ver a diferença entre dados não criptografados e dados criptografados. Isso seria verdade mesmo que alguns dos dados no "modo criptografado" não estivessem criptografados - como o cabeçalho IP mais externo deve estar se o pacote for roteável.</p></div><div class=sect2><h3 id=MUST>2.1. MUST<a class=anchor href=#MUST></a></h3><div class=paragraph><p>O "Universal Statistical Test for Random Bit Generators" de Ueli Maurer (<a href=https://web.archive.org/web/20011115002319/http://www.geocities.com/SiliconValley/Code/4704/universal.pdf>MUST</a>) mede rapidamente a entropia de uma amostra. Ele usa um algoritmo semelhante ao de compressão. O <a href=#Código>[Código]</a> de uma variante que mede blocos sucessivos (de cerca de um quarto de megabyte) de um arquivo.</p></div></div><div class=sect2><h3 id=tcpdump>2.2. Tcpdump<a class=anchor href=#tcpdump></a></h3><div class=paragraph><p>Também precisamos de uma maneira de capturar os dados brutos da rede. Um programa chamado <a href="https://man.freebsd.org/cgi/man.cgi?query=tcpdump&amp;sektion=1&amp;format=html">tcpdump(1)</a> permite que você faça isso, se você habilitou a interface do <em>Berkeley Packet Filter</em> no seu <a href=#kernel>src/sys/i386/conf/KERNELNAME</a>.</p></div><div class=paragraph><p>O comando:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell> tcpdump <span class=nt>-c</span> 4000 <span class=nt>-s</span> 10000 <span class=nt>-w</span> dumpfile.bin</code></pre></div></div><div class=paragraph><p>serão capturados 4000 pacotes brutos e salvos em <em>dumpfile.bin</em>. Neste exemplo, serão capturados até 10.000 bytes por pacote.</p></div></div></div></div><div class=sect1><h2 id=experiment>3. O Experimento<a class=anchor href=#experiment></a></h2><div class=sectionbody><div class=paragraph><p>Aqui está o experimento:</p></div><div class="exampleblock procedure"><div class=content><div class="olist arabic"><ol class=arabic><li><p>Abra uma janela para um host IPsec e outra janela para um host inseguro.</p></li><li><p>Agora, inicie o <a href=#tcpdump>Tcpdump</a>.</p></li><li><p>Na janela "segura", execute o comando UNIX® <a href="https://man.freebsd.org/cgi/man.cgi?query=yes&amp;sektion=1&amp;format=html">yes(1)</a>, que transmitirá o caractere <code>y</code>. Após um tempo, pare este comando. Mude para a janela "insegura" e repita o processo. Após um tempo, pare também esse comando.</p></li><li><p>Agora execute o <a href=#code>Teste estatístico universal de Maurer (para tamanho de bloco = 8 bits)</a> nos pacotes capturados. Você deverá ver algo como o seguinte. O importante a ser observado é que a conexão segura tem 93% (6,7) do valor esperado (7,18), enquanto a conexão "normal" tem 29% (2,1) do valor esperado.</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% tcpdump <span class=nt>-c</span> 4000 <span class=nt>-s</span> 10000 <span class=nt>-w</span> ipsecdemo.bin
% uliscan ipsecdemo.bin
Uliscan 21 Dec 98
<span class=nv>L</span><span class=o>=</span>8 256 258560
Measuring file ipsecdemo.bin
Init <span class=k>done
</span>Expected value <span class=k>for </span><span class=nv>L</span><span class=o>=</span>8 is 7.1836656
6.9396 <span class=nt>--------------------------------------------------------</span>
6.6177 <span class=nt>-----------------------------------------------------</span>
6.4100 <span class=nt>---------------------------------------------------</span>
2.1101 <span class=nt>-----------------</span>
2.0838 <span class=nt>-----------------</span>
2.0983 <span class=nt>-----------------</span></code></pre></div></div></li></ol></div></div></div></div></div><div class=sect1><h2 id=caveat>4. Embargo<a class=anchor href=#caveat></a></h2><div class=sectionbody><div class=paragraph><p>Este experimento mostra que o IPsec parece estar distribuindo os dados do payload <em>uniformly</em>, como a criptografia deveria fazer. No entanto, o experimento descrito aqui não pode detectar muitas possíveis falhas em um sistema (das quais não tenho nenhuma evidência). Estes incluem geração ou troca de chave fraca, dados ou chaves visíveis para outros, uso de algoritmos fracos, subversão do kernel, etc. Estude o código-fonte; conheça o código.</p></div></div></div><div class=sect1><h2 id=IPsec>5. IPsec --- Definição<a class=anchor href=#IPsec></a></h2><div class=sectionbody><div class=paragraph><p>As extensões de segurança do Protocolo de Internet para o IPv4; obrigatório para o IPv6. Um protocolo para negociar criptografia e autenticação no nível IP (host-to-host). O SSL protege apenas um socket de aplicativo; O SSH protege apenas um login; O PGP protege apenas um arquivo ou mensagem especificada. O IPsec criptografa tudo entre dois hosts.</p></div></div></div><div class=sect1><h2 id=ipsec-install>6. Instalando o IPsec<a class=anchor href=#ipsec-install></a></h2><div class=sectionbody><div class=paragraph><p>A maioria das versões modernas do FreeBSD possui suporte IPsec em seu código base. Portanto, você precisará incluir a opção <code>IPSEC</code> na configuração do seu kernel e, após recompilar e reinstalar o kernel, configurar as conexões IPsec usando o comando <a href="https://man.freebsd.org/cgi/man.cgi?query=setkey&amp;sektion=8&amp;format=html">setkey(8)</a>.</p></div><div class=paragraph><p>Um guia abrangente sobre como executar o IPsec no FreeBSD está disponível no <a href=https://docs.freebsd.org/pt-br/books/handbook/book/#ipsec>Handbook do FreeBSD</a>.</p></div></div></div><div class=sect1><h2 id=kernel>7. src/sys/i386/conf/KERNELNAME<a class=anchor href=#kernel></a></h2><div class=sectionbody><div class=paragraph><p>Isso precisa estar presente no arquivo de configuração do kernel para capturar dados de rede com o comando <a href="https://man.freebsd.org/cgi/man.cgi?query=tcpdump&amp;sektion=1&amp;format=html">tcpdump(1)</a>. Certifique-se de executar <a href="https://man.freebsd.org/cgi/man.cgi?query=config&amp;sektion=8&amp;format=html">config(8)</a> após adicionar isso e reconstruir e reinstalar o kernel.</p></div><div class="literalblock programlisting"><div class=content><pre>device	bpf</pre></div></div></div></div><div class=sect1><h2 id=code>8. Teste estatístico universal de Maurer (para tamanho de bloco = 8 bits)<a class=anchor href=#code></a></h2><div class=sectionbody><div class=paragraph><p>Você pode encontrar o mesmo código <a href=https://web.archive.org/web/20031204230654/http://www.geocities.com:80/SiliconValley/Code/4704/uliscanc.txt>neste link</a>.</p></div><div class="literalblock programlisting"><div class=content><pre>/*
  ULISCAN.c   ---blocksize of 8

  1 Oct 98
  1 Dec 98
  21 Dec 98       uliscan.c derived from ueli8.c

  This version has // comments removed for Sun cc

  This implements Ueli M Maurer&#39;s &#34;Universal Statistical Test for Random
  Bit Generators&#34; using L=8

  Accepts a filename on the command line; writes its results, with other
  info, to stdout.

  Handles input file exhaustion gracefully.

  Ref: J. Cryptology v 5 no 2, 1992 pp 89-105
  also on the web somewhere, which is where I found it.

  -David Honig
  honig@sprynet.com

  Usage:
  ULISCAN filename
  outputs to stdout
*/

#define L 8
#define V (1&lt;&lt;L)
#define Q (10*V)
#define K (100   *Q)
#define MAXSAMP (Q + K)

#include &lt;stdio.h&gt;
#include &lt;math.h&gt;

int main(argc, argv)
int argc;
char **argv;
{
  FILE *fptr;
  int i,j;
  int b, c;
  int table[V];
  double sum = 0.0;
  int iproduct = 1;
  int run;

  extern double   log(/* double x */);

  printf(&#34;Uliscan 21 Dec 98 \nL=%d %d %d \n&#34;, L, V, MAXSAMP);

  if (argc &lt; 2) {
    printf(&#34;Usage: Uliscan filename\n&#34;);
    exit(-1);
  } else {
    printf(&#34;Measuring file %s\n&#34;, argv[1]);
  }

  fptr = fopen(argv[1],&#34;rb&#34;);

  if (fptr == NULL) {
    printf(&#34;Can&#39;t find %s\n&#34;, argv[1]);
    exit(-1);
  }

  for (i = 0; i &lt; V; i++) {
    table[i] = 0;
  }

  for (i = 0; i &lt; Q; i++) {
    b = fgetc(fptr);
    table[b] = i;
  }

  printf(&#34;Init done\n&#34;);

  printf(&#34;Expected value for L=8 is 7.1836656\n&#34;);

  run = 1;

  while (run) {
    sum = 0.0;
    iproduct = 1;

    if (run)
      for (i = Q; run &amp;&amp; i &lt; Q + K; i++) {
        j = i;
        b = fgetc(fptr);

        if (b &lt; 0)
          run = 0;

        if (run) {
          if (table[b] &gt; j)
            j += K;

          sum += log((double)(j-table[b]));

          table[b] = i;
        }
      }

    if (!run)
      printf(&#34;Premature end of file; read %d blocks.\n&#34;, i - Q);

    sum = (sum/((double)(i - Q))) /  log(2.0);
    printf(&#34;%4.4f &#34;, sum);

    for (i = 0; i &lt; (int)(sum*8.0 + 0.50); i++)
      printf(&#34;-&#34;);

    printf(&#34;\n&#34;);

    /* refill initial table */
    if (0) {
      for (i = 0; i &lt; Q; i++) {
        b = fgetc(fptr);
        if (b &lt; 0) {
          run = 0;
        } else {
          table[b] = i;
        }
      }
    }
  }
}</pre></div></div></div></div><hr><div class=last-modified><p><strong>Última alteração em</strong>: 29 de maio de 2023 por <a href="https://cgit.freebsd.org/doc/commit/?id=b783c7376e" target=_blank>Edson Brandi</a></p></div></div><aside class=toc><div class=toc-content><h3>Índice</h3><nav id=TableOfContents><ul><li><a href=#problem>1. O problema</a></li><li><a href=#solution>2. A solução</a></li><li><a href=#experiment>3. O Experimento</a></li><li><a href=#caveat>4. Embargo</a></li><li><a href=#IPsec>5. IPsec --- Definição</a></li><li><a href=#ipsec-install>6. Instalando o IPsec</a></li><li><a href=#kernel>7. src/sys/i386/conf/KERNELNAME</a></li><li><a href=#code>8. Teste estatístico universal de Maurer (para tamanho de bloco = 8 bits)</a></li></ul></nav><hr><div class=resources><h3>Recursos</h3><ul class=contents><li><i class="fa fa-file-pdf-o" aria-hidden=true title="Download PDF"></i><a href=https://download.freebsd.org/doc/pt-br/articles/ipsec-must/ipsec-must_pt-br.pdf>Download PDF</a></li><li><i class="fa fa-pencil-square-o" aria-hidden=true title="Edite essa página"></i><a href=https://github.com/freebsd/freebsd-doc/blob/main/documentation/content/pt-br/_index target=_blank>Edite essa página</a></li></ul></div></div></aside></main><footer><div class=footer-container><section class=logo-column><img src=http://172.16.201.134:1313/images/FreeBSD-colors.svg width=160 height=50 alt="FreeBSD logo"><div class=options-container><div class=language-container><a id=languages href=http://172.16.201.134:1313/pt-br/languages><img src=http://172.16.201.134:1313/images/language.png class=language-image alt="Escolha o idioma">
<span>Brazilian Portuguese</span></a></div><div class=theme-container><select id=theme-chooser><option value=theme-system>System</option><option value=theme-light>Light</option><option value=theme-dark>Dark</option><option value=theme-high-contrast>Alto contraste</option></select></div></div></section><section class=about-column><h3 class=column-title>About</h3><ul class=column-elements-container><li><a href=https://www.freebsd.org/about/ target=_blank class=column-element>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/ target=_blank class=column-element>FreeBSD Foundation</a></li><li><a href=https://www.freebsd.org/where/ target=_blank class=column-element>Get FreeBSD</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct target=_blank class=column-element>Code of Conduct</a></li><li><a href=https://www.freebsd.org/security/ target=_blank class=column-element>Security Advisories</a></li></ul></section><section class=documentation-column><h3 class=column-title>Documentation</h3><ul class=column-elements-container><li><a href=/pt-br class=column-element>Documentation portal</a></li><li><a href=https://man.FreeBSD.org target=_blank class=column-element>Manual pages</a></li><li><a href=https://papers.FreeBSD.org target=_blank class=column-element>Presentations and papers</a></li><li><a href=https://docs-archive.freebsd.org/doc/ target=_blank class=column-element>Previous versions</a></li><li><a href=https://docs-archive.freebsd.org/44doc/ target=_blank class=column-element>4.4BSD Documents</a></li><li><a href=https://wiki.freebsd.org/ target=_blank class=column-element>Wiki</a></li></ul></section><section class=community-column><h3 class=column-title>Community</h3><ul class=column-elements-container><li><a href=http://172.16.201.134:1313/pt-br/articles/contributing class=column-element>Get involved</a></li><li><a href=https://forums.freebsd.org/ target=_blank class=column-element>Community forum</a></li><li><a href=https://lists.freebsd.org/ target=_blank class=column-element>Mailing lists</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank class=column-element>IRC Channels</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank class=column-element>Bug Tracker</a></li></ul></section><section class=legal-column><h3 class=column-title>Legal</h3><ul class=column-elements-container><li><a href=https://freebsdfoundation.org/donate/ target=_blank class=column-element>Donations</a></li><li><a href=https://www.freebsd.org/copyright/freebsd-license/ target=_blank class=column-element>Licensing</a></li><li><a href=https://www.freebsd.org/privacy/ target=_blank class=column-element>Privacy Policy</a></li><li><a href=https://www.freebsd.org/copyright/ target=_blank class=column-element>Legal notices</a></li></ul></section><section class=copyright-column><p>&copy; 1994-2024 The FreeBSD Project. All rights reserved</p><span>Made with <span class=heart>♥</span> by the FreeBSD Community</span></section></div></footer></body></html>