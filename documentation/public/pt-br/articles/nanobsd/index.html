<!doctype html><html class=theme-light lang=pt-br><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Este documento fornece informações sobre as ferramentas NanoBSD, que podem ser usadas para criar imagens de sistema FreeBSD para aplicações embarcadas, adequadas para uso em uma chave USB, cartão de memória ou outro meio de armazenamento em massa."><meta name=keywords content="nanobsd,guide,embedded,FreeBSD"><meta name=copyright content="1995-2024 The FreeBSD Foundation"><link rel=canonical href=https://docs.freebsd.org/pt-br/articles/nanobsd/><title>Introdução ao NanoBSD | FreeBSD Documentation Portal</title>
<meta name=theme-color content="#790000"><meta name=color-scheme content="system light dark high-contrast"><link rel="shortcut icon" href=https://docs.freebsd.org/favicon.ico><link rel=stylesheet href=https://docs.freebsd.org/styles/main.min.css><link rel=stylesheet href=https://docs.freebsd.org/css/font-awesome-min.css><script defer src=/js/theme-chooser.min.js></script><script defer src=/js/copy-clipboard.min.js></script><script defer src=/js/search.min.js></script><meta name=twitter:card content="summary"><meta name=twitter:domain content="docs.FreeBSD.org"><meta name=twitter:site content="@freebsd"><meta name=twitter:url content="https://twitter.com/freebsd"><meta property="og:title" content="Introdução ao NanoBSD"><meta property="og:description" content="Este documento fornece informações sobre as ferramentas NanoBSD, que podem ser usadas para criar imagens de sistema FreeBSD para aplicações embarcadas, adequadas para uso em uma chave USB, cartão de memória ou outro meio de armazenamento em massa."><meta property="og:type" content="website"><meta property="og:image" content="https://docs.freebsd.org/favicon.ico"><meta property="og:image:alt" content="FreeBSD Logo"><meta property="og:locale" content="pt-br"><meta property="og:url" content="https://docs.freebsd.org/pt-br/articles/nanobsd/"><meta property="og:site_name" content="FreeBSD Documentation Portal"><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","url":"https:\/\/docs.freebsd.org\/pt-br\/articles\/nanobsd\/","name":"FreeBSD Documentation Portal","headline":"FreeBSD Documentation Portal","description":"FreeBSD Documentation Portal"}</script></head><body><header><div class=header-container><div class=logo-menu-bars-container><a href=https://www.FreeBSD.org class=logo><img src=https://docs.freebsd.org/images/FreeBSD-monochromatic.svg width=160 height=50 alt="FreeBSD logo">
</a><label class=menu-bars for=menu-bars><i class="fa fa-bars" aria-hidden=true></i></label></div><input id=menu-bars type=checkbox><nav><ul class=menu><li class=menu-item><input id=about type=checkbox>
<a href=# aria-label="Navigate to About section"><label class=menu-item-description for=about>About
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/about/ target=_blank>About</a></li><li><a href=https://www.freebsd.org/about/ target=_blank>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/about-us/about-the-foundation/ target=_blank>FreeBSD Foundation</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct/ target=_blank>Code of Conduct</a></li></ul></li><li class=menu-item><input id=download type=checkbox>
<a href=# aria-label="Navigate to get FreeBSD section"><label class=menu-item-description for=download>Get FreeBSD
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/where/ target=_blank>Get FreeBSD</a></li><li><a href=https://www.freebsd.org/releases/ target=_blank>Release Information</a></li><li><a href=https://www.freebsd.org/releng/ target=_blank>Release Engineering</a></li><li><a href=https://www.freebsd.org/security/ target=_blank>Security Advisories</a></li></ul></li><li class=menu-item><input id=documentation type=checkbox>
<a href=# aria-label="Navigate to get Documentation section"><label class=menu-item-description for=documentation>Documentation
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=/pt-br>Documentation portal</a></li><li><a href=https://docs.freebsd.org/pt-br/books/handbook>FreeBSD Handbook</a></li><li><a href=https://docs.freebsd.org/pt-br/books/porters-handbook>Porter's Handbook</a></li><li><a href=https://docs.FreeBSD.org/en/books/fdp-primer>Documentation Project Handbook</a></li><li><a href=https://man.FreeBSD.org target=_blank>Manual pages</a></li><li><a href=https://papers.FreeBSD.org target=_blank>Presentations and papers</a></li><li><a href=https://wiki.FreeBSD.org target=_blank>Wiki</a></li><li><a href=https://docs.freebsd.org/pt-br/books>Books</a></li><li><a href=https://docs.freebsd.org/pt-br/articles>Articles</a></li></ul></li><li class=menu-item><input id=community type=checkbox>
<a href=# aria-label="Navigate to get Community section"><label class=menu-item-description for=community>Community
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/community/>Community</a></li><li><a href=https://docs.freebsd.org/pt-br/articles/contributing>Get involved</a></li><li><a href=https://forums.freebsd.org/ target=_blank>Forum</a></li><li><a href=https://lists.freebsd.org/ target=_blank>Mailing lists</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank>IRC Channels</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank>Bug Tracker</a></li><li><a href=https://www.freebsd.org/support/ target=_blank>Support</a></li></ul></li></ul></nav><div class=search-donate-container><form class=search method=get id=search-header-form action=https://docs.freebsd.org/search name=search-header-form><input type=hidden name=DB value=pt-br>
<input id=words name=P type=text size=20 maxlength=255>
<button>
<i class="fa fa-search" aria-hidden=true></i></button></form><div class=donate><a href=https://freebsdfoundation.org/donate/ target=_blank><span class=heart>♥</span>
Donate</a></div></div></div></header><main class=main-wrapper-article><div class=article><h1 class=title>Introdução ao NanoBSD</h1><div class="admonitionblock note"><p><i class="fa fa-exclamation-circle" aria-hidden=true></i>
Esta tradução pode estar desatualizada. Para ajudar com as traduções, acesse a <a href=https://translate-dev.freebsd.org/ target=_blank>ferramenta de traduções do FreeBSD</a>.</p></div><div class=copyright>Copyright © 2006 The FreeBSD Documentation Project</div><div class=legalnotice><a id=trademarks></a><details><summary>trademarks</summary><p>FreeBSD is a registered trademark of the FreeBSD Foundation.</p><p>Many of the designations used by manufacturers and sellers to distinguish their products are claimed as trademarks. Where those designations appear in this document, and the FreeBSD Project was aware of the trademark claim, the designations have been followed by the “™” or the “®” symbol.</p></details></div><div class=toc-mobile><h3>Índice</h3><nav id=TableOfContents><ul><li><a href=#intro>1. Introdução ao NanoBSD</a></li><li><a href=#howto>2. Guia do NanoBSD</a></li></ul></nav></div><div id=preamble><div class=sectionbody><div class="paragraph abstract-title"><p>Resumo</p></div><div class=paragraph><p>Este documento fornece informações sobre as ferramentas NanoBSD, que podem ser usadas para criar imagens de sistema FreeBSD para aplicações embarcadas, adequadas para uso em uma chave USB, cartão de memória ou outro meio de armazenamento em massa.</p></div><hr></div></div><div class=sect1><h2 id=intro>1. Introdução ao NanoBSD<a class=anchor href=#intro></a></h2><div class=sectionbody><div class=paragraph><p>O NanoBSD é uma ferramenta desenvolvida por Poul-Henning Kamp &lt;<a href=mailto:phk@FreeBSD.org>phk@FreeBSD.org</a>> e agora mantida por Warner Losh &lt;<a href=mailto:imp@FreeBSD.org>imp@FreeBSD.org</a>>. Ela cria uma imagem do sistema FreeBSD para aplicações embarcadas, adequada para uso em uma chave USB, cartão de memória ou outro meio de armazenamento em massa.</p></div><div class=paragraph><p>Pode ser usado para construir imagens de instalação especializadas, projetadas para facilitar a instalação e manutenção de sistemas comumente chamados de "computer appliances". Os computer appliances têm seu hardware e software empacotados no produto, o que significa que todos os aplicativos estão pré-instalados. O aparelho é conectado a uma rede existente e pode começar a funcionar (quase) imediatamente.</p></div><div class=paragraph><p>As características do NanoBSD incluem:</p></div><div class=ulist><ul><li><p>Os Ports e pacotes funcionam como no FreeBSD - Cada aplicação pode ser instalada e usada em uma imagem NanoBSD, da mesma forma que no FreeBSD.</p></li><li><p>Nenhuma funcionalidade faltante - Se é possível fazer algo com o FreeBSD, é possível fazer a mesma coisa com o NanoBSD, a menos que a funcionalidade específica tenha sido explicitamente removida da imagem do NanoBSD quando ela foi criada.</p></li><li><p>O sistema opera em modo read-only em tempo de execução - É seguro puxar o plugue de energia. Não há necessidade de executar o <a href="https://man.freebsd.org/cgi/man.cgi?query=fsck&amp;sektion=8&amp;format=html">fsck(8)</a> após um desligamento abrupto do sistema.</p></li><li><p>É fácil de compilar e personalizar - Usando apenas um script de shell e um arquivo de configuração, é possível criar imagens reduzidas e personalizadas, satisfazendo qualquer conjunto arbitrário de requisitos.</p></li></ul></div></div></div><div class=sect1><h2 id=howto>2. Guia do NanoBSD<a class=anchor href=#howto></a></h2><div class=sectionbody><div class=sect2><h3 id=design>2.1. O Design do NanoBSD<a class=anchor href=#design></a></h3><div class=paragraph><p>Uma vez que a imagem está presente no meio de armazenamento, é possível inicializar o NanoBSD. O meio de armazenamento em massa é dividido em três partes por padrão:</p></div><div class=ulist><ul><li><p>Duas partições de imagem: <code>code#1</code> e <code>code#2</code>.</p></li><li><p>A partição do arquivo de configuração, que pode ser montada sob o diretório <span class=filename>/cfg</span> em tempo de execução.</p></li></ul></div><div class=paragraph><p>Essas partições são normalmente montadas em modo read-only (somente leitura).</p></div><div class=paragraph><p>Os diretórios <span class=filename>/etc</span> e <span class=filename>/var</span> são discos <a href="https://man.freebsd.org/cgi/man.cgi?query=md&amp;sektion=4&amp;format=html">md(4)</a> (malloc).</p></div><div class=paragraph><p>A partição do arquivo de configuração persiste no diretório <span class=filename>/cfg</span>. Ele contém arquivos para o diretório <span class=filename>/etc</span> e é montado brevemente como somente leitura logo após a inicialização do sistema. Portanto, é necessário copiar os arquivos modificados do diretório <span class=filename>/etc</span> de volta para o diretório <span class=filename>/cfg</span> se as alterações precisarem ser mantidas após a reinicialização do sistema.</p></div><div class=exampleblock><div class=title>Exemplo 1. Fazendo alterações persistentes no arquivo <span class=filename>/etc/resolv.conf</span></div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># vi /etc/resolv.conf</span>
<span class=o>[</span>...]
<span class=c># mount /cfg</span>
<span class=c># cp /etc/resolv.conf /cfg</span>
<span class=c># umount /cfg</span></code></pre></div></div></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>A partição que contém o diretório <span class=filename>/cfg</span> deve ser montada somente no momento da inicialização e enquanto sobrescreve os arquivos de configuração.</p></div><div class=paragraph><p>Manter o <span class=filename>/cfg</span> montado o tempo todo não é uma boa idéia, especialmente se o sistema NanoBSD rodar em um meio de armazenamento em massa que pode ser afetado adversamente por um grande número de gravações na partição (como quando o sincronizador do sistema de arquivos libera dados para os discos do sistema).</p></div></td></tr></tbody></table></div></div><div class=sect2><h3 id=_construindo_uma_imagem_nanobsd>2.2. Construindo uma imagem NanoBSD<a class=anchor href=#_construindo_uma_imagem_nanobsd></a></h3><div class=paragraph><p>Uma imagem NanoBSD é compilada usando um simples shell script <span class=filename>nanobsd.sh</span>, que pode ser encontrado no diretório <span class=filename>/usr/src/tools/tools/nanobsd</span>. Este script cria uma imagem, que pode ser copiada no meio de armazenamento usando o utilitário <a href="https://man.freebsd.org/cgi/man.cgi?query=dd&amp;sektion=1&amp;format=html">dd(1)</a>.</p></div><div class=paragraph><p>Os comandos necessários para construir uma imagem NanoBSD são:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/src/tools/tools/nanobsd </span><i class=conum data-value=1></i><b>(1)</b>
<span class=c># sh nanobsd.sh </span><i class=conum data-value=2></i><b>(2)</b>
<span class=c># cd /usr/obj/nanobsd.full </span><i class=conum data-value=3></i><b>(3)</b>
<span class=c># dd if=_.disk.full of=/dev/da0 bs=64k </span><i class=conum data-value=4></i><b>(4)</b></code></pre></div></div><div class="colist arabic"><table><tbody><tr><td><i class=conum data-value=1></i><b>1</b></td><td>Altere o diretório atual para o diretório base do script de compilação do NanoBSD.</td></tr><tr><td><i class=conum data-value=2></i><b>2</b></td><td>Inicie o processo de compilação.</td></tr><tr><td><i class=conum data-value=3></i><b>3</b></td><td>Altere o diretório atual para o local onde as imagens compiladas estão localizadas.</td></tr><tr><td><i class=conum data-value=4></i><b>4</b></td><td>Instale o NanoBSD no meio de armazenamento.</td></tr></tbody></table></div><div class=sect3><h4 id=_opções_ao_compilar_uma_imagem_nanobsd>2.2.1. Opções ao compilar uma imagem NanoBSD<a class=anchor href=#_opções_ao_compilar_uma_imagem_nanobsd></a></h4><div class=paragraph><p>Ao construir uma imagem NanoBSD, várias opções de compilação podem ser passadas para <span class=filename>nanobsd.sh</span> na linha de comando. Essas opções podem ter um impacto significativo no processo de compilação.</p></div><div class=paragraph><p>Algumas opções são para fins de verbosidade:</p></div><div class=ulist><ul><li><p><code>-h</code>: imprime a página resumida de ajuda.</p></li><li><p><code>-q</code>: torna a saída mais silenciosa.</p></li><li><p><code>-v</code>: torna a saída mais detalhada (verbose)</p></li></ul></div><div class=paragraph><p>Algumas outras opções podem ser usadas para restringir o processo de compilação. Às vezes, não é necessário reconstruir tudo a partir das fontes, especialmente se uma imagem já foi compilada e apenas poucas alterações foram feitas.</p></div><div class=ulist><ul><li><p><code>-k</code>: não compilar o kernel</p></li><li><p><code>-w</code>: não compilar o mundo (world)</p></li><li><p><code>-b</code>: não compilar nem o kernel e nem o mundo (world)</p></li><li><p><code>-i</code>: não compilar uma imagem de disco. Como um arquivo não será criado, não será possível usá-lo com o comando <a href="https://man.freebsd.org/cgi/man.cgi?query=dd&amp;sektion=1&amp;format=html">dd(1)</a> para gravá-lo em um dispositivo de armazenamento.</p></li><li><p><code>-f</code>: não compilar uma imagem de disco para a primeira partição (o que é útil para fins de atualização)</p></li><li><p><code>-n</code>: adiciona <code>-DNO_CLEAN</code> as etapas <code>buildworld</code> e <code>buildkernel</code>. Além disso, todos os arquivos que já foram compilados em uma execução anterior são mantidos.</p></li></ul></div><div class=paragraph><p>Um arquivo de configuração pode ser usado para ajustar quantos elementos desejar. Carregue-o com <code>-c</code></p></div><div class=paragraph><p>As últimas opções são:</p></div><div class=ulist><ul><li><p><code>-K</code>: não instalar um kernel. Uma imagem de disco sem um kernel não poderá executar uma sequência de inicialização normal.</p></li></ul></div></div><div class=sect3><h4 id=_o_processo_completo_de_compilação_de_imagens>2.2.2. O Processo Completo de Compilação de Imagens<a class=anchor href=#_o_processo_completo_de_compilação_de_imagens></a></h4><div class=paragraph><p>O processo completo de compilação de imagens passa por muitas etapas. As etapas exatas dependerão das opções selecionadas ao iniciar o script. Supondo que o script seja executado sem opções específicas, isso é o que acontecerá.</p></div><div class="olist arabic"><ol class=arabic><li><p><code>run_early_customize</code>: comandos que são definidos em um arquivo de configuração fornecido.</p></li><li><p><code>clean_build</code>: Apenas limpa o ambiente de compilação excluindo os arquivos previamente compilados.</p></li><li><p><code>make_conf_build</code>: Monta o arquivo make.conf a partir das variáveis <code>CONF_WORLD</code> e <code>CONF_BUILD</code>.</p></li><li><p><code>build_world</code>: Compila o mundo (world).</p></li><li><p><code>build_kernel</code>: Compila os arquivos do kernel.</p></li><li><p><code>clean_world</code>: Limpa o diretório de destino.</p></li><li><p><code>make_conf_install</code>: Monta o arquivo make.conf a partir das variáveis <code>CONF_WORLD</code> e <code>CONF_INSTALL</code>.</p></li><li><p><code>install_world</code>: Instala todos os arquivos construídos durante o <code>buildworld</code>.</p></li><li><p><code>install_etc</code>: Instala os arquivos necessários no diretório <span class=filename>/etc</span>, com base no comando <code>make distribution</code>.</p></li><li><p><code>setup_nanobsd_etc</code>: a primeira configuração específica do NanoBSD ocorre nesta etapa. O diretório <span class=filename>/etc/diskless</span> é criado e o sistema de arquivos raiz é definido como somente leitura.</p></li><li><p><code>install_kernel</code>: os arquivos do kernel e dos módulos são instalados.</p></li><li><p><code>run_customize</code>: todas as rotinas de personalização definidas pelo usuário serão chamadas.</p></li><li><p><code>setup_nanobsd</code>: uma estrutura especial de diretórios de configuração é configurada. O diretório <span class=filename>/usr/local/etc</span> é movido para <span class=filename>/etc/local</span> e um link simbólico é criado de volta de <span class=filename>/etc/local</span> para <span class=filename>/usr/local/etc</span>.</p></li><li><p><code>prune_usr</code>: os diretórios vazios de <span class=filename>/usr</span> são removidos.</p></li><li><p><code>run_late_customize</code>: os últimos scripts personalizados podem ser executados neste ponto.</p></li><li><p><code>fixup_before_diskimage</code>: Lista todos os arquivos instalados em um metalog</p></li><li><p><code>create_diskimage</code>: cria a imagem de disco, com base nos parâmetros de geometria de disco fornecidos.</p></li><li><p><code>last_orders</code>: não faz nada por enquanto.</p></li></ol></div></div></div><div class=sect2><h3 id=_personalizando_uma_imagem_nanobsd>2.3. Personalizando uma imagem NanoBSD<a class=anchor href=#_personalizando_uma_imagem_nanobsd></a></h3><div class=paragraph><p>Esta é provavelmente a característica mais importante e mais interessante do NanoBSD. É também onde você passará a maior parte do tempo ao desenvolver com o NanoBSD.</p></div><div class=paragraph><p>A invocação do seguinte comando forçará o <span class=filename>nanobsd.sh</span> a ler sua configuração de <span class=filename>myconf.nano</span> localizado no diretório atual:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sh nanobsd.sh -c myconf.nano</span></code></pre></div></div><div class=paragraph><p>A personalização é feita de duas maneiras:</p></div><div class=ulist><ul><li><p>Opções de configuração</p></li><li><p>Funções personalizadas</p></li></ul></div><div class=sect3><h4 id=_opções_de_configuração>2.3.1. Opções de configuração<a class=anchor href=#_opções_de_configuração></a></h4><div class=paragraph><p>Com as configurações de configuração, é possível configurar as opções passadas tanto para as etapas <code>buildworld</code> quanto <code>installworld</code> do processo de compilação do NanoBSD, bem como opções internas passadas para o processo de compilação principal do NanoBSD. Através dessas opções, é possível reduzir o sistema, para que ele caiba em tão pouco quanto 64MB. Você pode usar as opções de configuração para reduzir ainda mais o FreeBSD, até que consista apenas no kernel e em dois ou três arquivos no espaço do usuário.</p></div><div class=paragraph><p>O arquivo de configuração consiste em opções de configuração, que substituem os valores padrão. As diretivas mais importantes são:</p></div><div class=ulist><ul><li><p><code>NANO_NAME</code> - Nome da compilação (usado para construir os nomes dos diretórios de trabalho).</p></li><li><p><code>NANO_SRC</code> - Caminho para a árvore de código-fonte usada para compilar a imagem.</p></li><li><p><code>NANO_KERNEL</code> - Nome do arquivo de configuração do kernel usado para compilar o kernel.</p></li><li><p><code>CONF_BUILD</code> - Opções passadas para o estágio <code>buildworld</code> da compilação.</p></li><li><p><code>CONF_INSTALL</code> - Opções passadas para o estágio <code>installworld</code> da compilação.</p></li><li><p><code>CONF_WORLD</code> - Opções passadas tanto para o estágio <code>buildworld</code> quanto para o estágio <code>installworld</code> da compilação.</p></li><li><p><code>FlashDevice</code> - Define qual tipo de mídia usar. Verifique <span class=filename>FlashDevice.sub</span> para obter mais detalhes.</p></li></ul></div><div class=paragraph><p>Existem muitas outras opções de configuração que podem ser relevantes, dependendo do tipo de NanoBSD desejado.</p></div><div class=sect4><h5 id=_personalização_geral>2.3.1.1. Personalização Geral<a class=anchor href=#_personalização_geral></a></h5><div class=paragraph><p>Existem três estágios, por design, nos quais é possível fazer alterações que afetam o processo de compilação, apenas configurando uma variável no arquivo de configuração fornecido:</p></div><div class=ulist><ul><li><p><code>run_early_customize</code>: antes de qualquer outra coisa acontecer.</p></li><li><p><code>run_customize</code>: depois que todos os arquivos padrões tiverem sido organizados</p></li><li><p><code>run_late_customize</code>: no final do processo, antes da compilação da imagem real do NanoBSD.</p></li></ul></div><div class=paragraph><p>Para personalizar uma imagem do NanoBSD em qualquer um desses passos, é melhor adicionar um valor específico a uma das variáveis correspondentes.</p></div><div class=paragraph><p>A variável <code>NANO_EARLY_CUSTOMIZE</code> é usada no primeiro passo do processo de construção. Neste momento, não há um exemplo específico do que pode ser feito usando essa variável, mas isso pode mudar no futuro.</p></div><div class=paragraph><p>A variável <code>NANO_CUSTOMIZE</code> é usada depois que os arquivos de configuração do kernel, world e etc foram instalados, e os arquivos etc foram configurados como uma instalação do NanoBSD. Portanto, é o passo correto no processo de compilação para ajustar opções de configuração e adicionar pacotes, como no exemplo cust_nobeastie.</p></div><div class=paragraph><p>A variável <code>NANO_LATE_CUSTOMIZE</code> é usada imediatamente antes da criação da imagem do disco, portanto, é o momento final para fazer qualquer alteração. Lembre-se de que a rotina <code>setup_nanobsd</code> já foi executada e que os diretórios <span class=filename>etc</span>, <span class=filename>conf</span> e <span class=filename>cfg</span> e seus subdiretórios já foram modificados, então não é o momento de alterá-los neste ponto. Em vez disso, é possível adicionar ou remover arquivos específicos.</p></div></div><div class=sect4><h5 id=_opções_de_inicialização>2.3.1.2. Opções de Inicialização<a class=anchor href=#_opções_de_inicialização></a></h5><div class=paragraph><p>Também existem variáveis que podem alterar a forma como a imagem do NanoBSD é inicializada. Duas opções são passadas para o <a href="https://man.freebsd.org/cgi/man.cgi?query=boot0cfg&amp;sektion=8&amp;format=html">boot0cfg(8)</a> para inicializar o setor de boot da imagem do disco:</p></div><div class=ulist><ul><li><p><code>NANO_BOOT0CFG</code></p></li><li><p><code>NANO_BOOTLOADER</code></p></li></ul></div><div class=paragraph><p>Com o <code>NANO_BOOTLOADER</code>, é possível escolher um arquivo de bootloader. As opções mais comuns são entre <span class=filename>boot0sio</span> e <span class=filename>boot0</span>, dependendo se o aparelho possui uma porta serial ou não. É melhor evitar fornecer um bootloader diferente, mas é possível fazê-lo. Para isso, é recomendável ter verificado o capítulo sobre o processo de inicialização no <a href=https://docs.freebsd.org/pt-br/books/handbook/book/boot>Handbook do FreeBSD</a>.</p></div><div class=paragraph><p>Com o <code>NANO_BOOT0CFG</code>, é possível ajustar o processo de inicialização, como selecionar em qual partição a imagem do NanoBSD será inicializada. É melhor verificar a página <a href="https://man.freebsd.org/cgi/man.cgi?query=boot0cfg&amp;sektion=8&amp;format=html">boot0cfg(8)</a> antes de alterar o valor padrão dessa variável. Uma opção interessante para alterar é o tempo limite do procedimento de inicialização. Para fazer isso, a variável <code>NANO_BOOT0CFG</code> pode ser alterada para <code>"-o packet -s 1 -m 3 -t 36"</code>. Dessa forma, o processo de inicialização começaria após aproximadamente 2 segundos, porque é raro que seja desejado esperar 10 segundos antes de iniciar o boot.</p></div><div class=paragraph><p>Bom saber: a variável <code>NANO_BOOT2CFG</code> é usada apenas na rotina <code>cust_comconsole</code>, que pode ser chamada no passo <code>NANO_CUSTOMIZE</code> se o aparelho tiver uma porta serial e toda a entrada e saída do console tiver que ser feita por meio dela. Certifique-se de verificar os parâmetros relevantes da porta serial, pois definir um valor incorreto pode torná-la inútil.</p></div></div><div class=sect4><h5 id=_criação_da_imagem_do_disco>2.3.1.3. Criação da Imagem do Disco<a class=anchor href=#_criação_da_imagem_do_disco></a></h5><div class=paragraph><p>No final do processo de inicialização está a criação da imagem do disco. Com essa etapa, o script do NanoBSD fornece um arquivo que pode ser simplesmente copiado para um disco do aparelho, e isso fará com que ele seja inicializado e iniciado.</p></div><div class=paragraph><p>Existem muitas variáveis que precisam ser configuradas corretamente para que o script produza uma imagem de disco utilizável.</p></div><div class=ulist><ul><li><p>A variável <code>NANO_DRIVE</code> deve ser definida como o nome da unidade de mídia em tempo de execução. Geralmente, o valor padrão <code>ada0</code>, que representa o primeiro dispositivo <code>IDE</code>/<code>ATA</code>/<code>SATA</code> no aparelho, é esperado como o correto, mas um tipo diferente de armazenamento também pode ser usado - como uma chave USB, nesse caso seria <code>da0</code>.</p></li><li><p>A variável <code>NANO_MEDIASIZE</code> deve ser definida como o tamanho (em setores de 512 bytes) da mídia de armazenamento que será usada. Se você definir isso incorretamente, é possível que a imagem do NanoBSD não inicialize e uma mensagem durante a inicialização avisará sobre a geometria de disco incorreta.</p></li><li><p>Os diretórios <span class=filename>/etc</span>, <span class=filename>/var</span> e <span class=filename>/tmp</span> são alocados como discos <a href="https://man.freebsd.org/cgi/man.cgi?query=md&amp;sektion=4&amp;format=html">md(4)</a> (malloc) durante a inicialização; portanto, seus tamanhos podem ser ajustados para atender às necessidades do aparelho. A variável <code>NANO_RAM_ETCSIZE</code> define o tamanho do <span class=filename>/etc</span> e a variável <code>NANO_RAM_TMPVARSIZE</code> define o tamanho tanto do diretório <span class=filename>/var</span> quanto do diretório <span class=filename>/tmp</span>, já que <span class=filename>/tmp</span> está simbolicamente vinculado a <span class=filename>/var/tmp</span>. Por padrão, ambos os tamanhos dos discos malloc são definidos em 20MB cada. Eles podem ser alterados, mas geralmente o <span class=filename>/etc</span> não cresce muito em tamanho, portanto, 20MB é um bom ponto de partida, enquanto o <span class=filename>/var</span> e especialmente o <span class=filename>/tmp</span> podem aumentar muito de tamanho se não tiver cuidado. Para sistemas com restrição de memória, tamanhos menores de sistema de arquivos podem ser escolhidos.</p></li><li><p>Como o NanoBSD é projetado principalmente para criar uma imagem de sistema para um aparelho, presume-se que a mídia de armazenamento usada seja relativamente pequena. Por esse motivo, o sistema de arquivos que é organizado é configurado com um tamanho de bloco pequeno (4Kb) e um tamanho de fragmento pequeno (512b). As opções de configuração do sistema de arquivos podem ser modificadas por meio da variável <code>NANO_NEWFS</code>, mas a sintaxe deve respeitar o formato do comando <a href="https://man.freebsd.org/cgi/man.cgi?query=newfs&amp;sektion=8&amp;format=html">newfs(8)</a>. Além disso, por padrão, o sistema de arquivos tem Soft Updates ativado. O <a href=https://docs.freebsd.org/pt-br/books/handbook/book/>Handbook do FreeBSD</a> pode ser consultado para obter mais informações sobre isso.</p></li><li><p>Os diferentes tamanhos das partições podem ser definidos por meio do uso de <code>NANO_CODESIZE</code>, <code>NANO_CONFSIZE</code> e <code>NANO_DATASIZE</code> como múltiplos de setores de 512 bytes. <code>NANO_CODESIZE</code> define o tamanho das duas primeiras partições da imagem: <code>code#1</code> e <code>code#2</code>. Elas devem ser grandes o suficiente para armazenar todos os arquivos que serão produzidos como resultado dos processos <code>buildworld</code> e <code>buildkernel</code>. <code>NANO_CONFSIZE</code> define o tamanho da partição do arquivo de configuração, portanto, não precisa ser muito grande, mas não a faça tão pequena que não possa armazenar todos os arquivos de configuração. Por fim, <code>NANO_DATASIZE</code> define o tamanho de uma partição opcional que pode ser usada no aparelho. A última partição pode ser usada, por exemplo, para manter arquivos criados dinamicamente no disco.</p></li></ul></div></div></div><div class=sect3><h4 id=_funções_personalizadas>2.3.2. Funções Personalizadas<a class=anchor href=#_funções_personalizadas></a></h4><div class=paragraph><p>É possível ajustar o NanoBSD usando funções de shell no arquivo de configuração. O exemplo a seguir ilustra o modelo básico de funções personalizadas:</p></div><div class="literalblock programlisting"><div class=content><pre>cust_foo () (
	echo &#34;bar=baz&#34; &gt; \
		${NANO_WORLDDIR}/etc/foo
)
customize_cmd cust_foo</pre></div></div><div class=paragraph><p>Um exemplo mais útil de uma função de personalização é o seguinte, que altera o tamanho padrão do diretório <span class=filename>/etc</span> de 5MB para 30MB:</p></div><div class="literalblock programlisting"><div class=content><pre>cust_etc_size () (
	cd ${NANO_WORLDDIR}/conf
	echo 30000 &gt; default/etc/md_size
)
customize_cmd cust_etc_size</pre></div></div><div class=paragraph><p>Existem algumas funções de customização pré-definidas por padrão e prontas para uso:</p></div><div class=ulist><ul><li><p><code>cust_comconsole</code> - Desabilita o <a href="https://man.freebsd.org/cgi/man.cgi?query=getty&amp;sektion=8&amp;format=html">getty(8)</a> nos dispositivos VGA (os nós de dispositivo <span class=filename>/dev/ttyv*</span>) e habilita o uso da porta serial COM1 como console do sistema.</p></li><li><p><code>cust_allow_ssh_root</code> - Permite que o usuário <code>root</code> faça login via <a href="https://man.freebsd.org/cgi/man.cgi?query=sshd&amp;sektion=8&amp;format=html">sshd(8)</a>.</p></li><li><p><code>cust_install_files</code> - Instala arquivos do diretório <span class=filename>nanobsd/Files</span>, que contém alguns scripts úteis para administração do sistema.</p></li><li><p><code>cust_pkgng</code> - Instala pacotes do diretório <span class=filename>nanobsd/Pkg</span>, (necessita também do pacote pkg-* para inicialização).</p></li></ul></div></div><div class=sect3><h4 id=_adicionando_pacotes>2.3.3. Adicionando Pacotes<a class=anchor href=#_adicionando_pacotes></a></h4><div class=paragraph><p>Pacotes podem ser adicionados a uma imagem do NanoBSD para fornecer funcionalidades específicas no aparelho. Para fazer isso, você pode escolher uma das seguintes opções:</p></div><div class=ulist><ul><li><p>Adicionar <code>cust_pkgng</code> à variável <code>NANO_CUSTOMIZE</code>, ou</p></li><li><p>Adicionar o comando <code>'customize_cmd cust_pkgng'</code> em um arquivo de configuração personalizado.</p></li></ul></div><div class=paragraph><p>Ambos os métodos alcançam o mesmo resultado: executar a rotina <code>cust_pkgng</code>. Essa rotina percorrerá o diretório <code>NANO_PACKAGE_DIR</code> para encontrar todos os pacotes ou apenas a lista de pacotes na variável <code>NANO_PACKAGE_LIST</code>.</p></div><div class=paragraph><p>É comum, ao instalar aplicativos por meio do pkg em um ambiente FreeBSD padrão, que o processo de instalação coloque arquivos de configuração no diretório <span class=filename>usr/local/etc</span> e scripts de inicialização no diretório <span class=filename>/usr/local/etc/rc.d</span>. Portanto, após a instalação dos pacotes necessários, eles precisam ser configurados para iniciar imediatamente. Para fazer isso, os arquivos de configuração necessários devem ser instalados nos diretórios corretos. Isso pode ser feito escrevendo rotinas dedicadas ou utilizando a rotina genérica <code>cust_install_files</code> para organizar os arquivos corretamente a partir do diretório <span class=filename>/usr/src/tools/tools/nanobsd/Files</span>. Geralmente, também é necessário adicionar uma ou várias declarações no arquivo <span class=filename>/etc/rc.conf</span> para cada pacote.</p></div></div><div class=sect3><h4 id=_exemplo_do_arquivo_de_configuração>2.3.4. Exemplo do arquivo de configuração<a class=anchor href=#_exemplo_do_arquivo_de_configuração></a></h4><div class=paragraph><p>Um exemplo completo de um arquivo de configuração para construir uma imagem personalizada do NanoBSD pode ser:</p></div><div class="literalblock programlisting"><div class=content><pre>NANO_NAME=custom
NANO_SRC=/usr/src
NANO_KERNEL=MYKERNEL
NANO_IMAGES=2

CONF_BUILD=&#39;
WITHOUT_KLDLOAD=YES
WITHOUT_NETGRAPH=YES
WITHOUT_PAM=YES
&#39;

CONF_INSTALL=&#39;
WITHOUT_ACPI=YES
WITHOUT_BLUETOOTH=YES
WITHOUT_FORTRAN=YES
WITHOUT_HTML=YES
WITHOUT_LPR=YES
WITHOUT_MAN=YES
WITHOUT_SENDMAIL=YES
WITHOUT_SHAREDOCS=YES
WITHOUT_EXAMPLES=YES
WITHOUT_INSTALLLIB=YES
WITHOUT_CALENDAR=YES
WITHOUT_MISC=YES
WITHOUT_SHARE=YES
&#39;

CONF_WORLD=&#39;
WITHOUT_BIND=YES
WITHOUT_MODULES=YES
WITHOUT_KERBEROS=YES
WITHOUT_GAMES=YES
WITHOUT_RESCUE=YES
WITHOUT_LOCALES=YES
WITHOUT_SYSCONS=YES
WITHOUT_INFO=YES
&#39;

FlashDevice SanDisk 1G

cust_nobeastie() (
	touch ${NANO_WORLDDIR}/boot/loader.conf
	echo &#34;beastie_disable=\&#34;YES\&#34;&#34; &gt;&gt; ${NANO_WORLDDIR}/boot/loader.conf
)

customize_cmd cust_comconsole
customize_cmd cust_install_files
customize_cmd cust_allow_ssh_root
customize_cmd cust_nobeastie</pre></div></div><div class=paragraph><p>Todas as opções de compilação e instalação podem ser encontradas na página do manual <a href="https://man.freebsd.org/cgi/man.cgi?query=src.conf&amp;sektion=5&amp;format=html">src.conf(5)</a>, mas nem todas as opções podem ou devem ser usadas ao construir uma imagem do NanoBSD. As opções de compilação e instalação devem ser definidas de acordo com as necessidades da imagem sendo construída.</p></div><div class=paragraph><p>Por exemplo, o cliente e servidor FTP podem não ser necessários. Adicionar <code>WITHOUT_FTP=TRUE</code> em um arquivo de configuração na seção <code>CONF_BUILD</code> evitará que eles sejam compilados. Além disso, se o aparelho NanoBSD não será usado para compilar programas, é possível adicionar <code>WITHOUT_BINUTILS=TRUE</code> na seção <code>CONF_INSTALL</code>; mas não na seção <code>CONF_BUILD</code>, pois eles serão usados para construir a imagem do NanoBSD.</p></div><div class=paragraph><p>Não compilar um conjunto específico de programas - por meio de uma opção de compilação - reduz o tempo total de compilação e diminui o tamanho necessário para a imagem do disco, enquanto não instalar o mesmo conjunto específico de programas não reduz o tempo total de compilação.</p></div></div></div><div class=sect2><h3 id=_atualizando_o_nanobsd>2.4. Atualizando o NanoBSD<a class=anchor href=#_atualizando_o_nanobsd></a></h3><div class=paragraph><p>O processo de atualização do NanoBSD é relativamente simples:</p></div><div class="exampleblock procedure"><div class=content><div class="olist arabic"><ol class=arabic><li><p>Construa uma nova imagem do NanoBSD, como de costume.</p></li><li><p>Faça o upload da nova imagem para uma partição não utilizada de um aparelho NanoBSD em execução.</p><div class=paragraph><p>A diferença mais importante deste passo em relação à instalação inicial do NanoBSD é que, em vez de usar o arquivo <span class=filename>_.disk.full</span> (que contém uma imagem do disco inteiro), é instalada a imagem <span class=filename>_.disk.image</span> (que contém uma imagem de uma única partição do sistema).</p></div></li><li><p>Reinicie e inicie o sistema a partir da partição recém-instalada.</p></li><li><p>Se tudo correr bem, a atualização está concluída.</p></li><li><p>Se algo der errado, reinicie a partição anterior (que contém a imagem antiga que estava em funcionamento) para restaurar a funcionalidade do sistema o mais rápido possível. Corrija quaisquer problemas da nova compilação e repita o processo.</p></li></ol></div></div></div><div class=paragraph><p>Para instalar uma nova imagem em um sistema NanoBSD em execução, é possível usar o script <span class=filename>updatep1</span> ou <span class=filename>updatep2</span>, localizados no diretório <span class=filename>/root</span>, dependendo de qual partição o sistema atual está sendo executado.</p></div><div class=paragraph><p>Dependendo dos serviços disponíveis no host que está servindo a nova imagem do NanoBSD e do tipo de transferência preferido, é possível examinar uma dessas três opções:</p></div><div class=sect3><h4 id=_usando_o_comando_ftp1>2.4.1. Usando o comando <a href="https://man.freebsd.org/cgi/man.cgi?query=ftp&amp;sektion=1&amp;format=html">ftp(1)</a><a class=anchor href=#_usando_o_comando_ftp1></a></h4><div class=paragraph><p>Se a velocidade de transferência estiver em primeiro lugar, use este exemplo:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ftp myhost</span>
get _.disk.image <span class=s2>&#34;| sh updatep1&#34;</span></code></pre></div></div></div><div class=sect3><h4 id=_usando_o_comando_ssh1>2.4.2. Usando o comando <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;format=html">ssh(1)</a><a class=anchor href=#_usando_o_comando_ssh1></a></h4><div class=paragraph><p>Se uma transferência segura for preferida, considere usar este exemplo:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ssh myhost cat _.disk.image.gz | zcat | sh updatep1</span></code></pre></div></div></div><div class=sect3><h4 id=_usando_o_comando_nc1>2.4.3. Usando o comando <a href="https://man.freebsd.org/cgi/man.cgi?query=nc&amp;sektion=1&amp;format=html">nc(1)</a><a class=anchor href=#_usando_o_comando_nc1></a></h4><div class=paragraph><p>Experimente este exemplo se o host remoto não estiver executando os serviços <a href="https://man.freebsd.org/cgi/man.cgi?query=ftpd&amp;sektion=8&amp;format=html">ftpd(8)</a> ou <a href="https://man.freebsd.org/cgi/man.cgi?query=sshd&amp;sektion=8&amp;format=html">sshd(8)</a>:</p></div><div class="exampleblock procedure"><div class=content><div class="olist arabic"><ol class=arabic><li><p>Primeiramente, abra um socket TCP em modo escuta no host que serve a imagem e envie a imagem para o cliente:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>myhost# nc <span class=nt>-l</span> 2222 &lt; _.disk.image</code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Verifique se a porta utilizada não está bloqueada pelo firewall para receber conexões originadas do host NanoBSD.</p></div></td></tr></tbody></table></div></li><li><p>Conecte-se ao host que está servindo a nova imagem e execute o script <span class=filename>updatep1</span>:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># nc myhost 2222 | sh updatep1</span></code></pre></div></div></li></ol></div></div></div></div></div></div></div><hr><div class=last-modified><p><strong>Última alteração em</strong>: 12 de maio de 2023 por <a href="https://cgit.freebsd.org/doc/commit/?id=bd3a381b0b" target=_blank>Edson Brandi</a></p></div></div><aside class=toc><div class=toc-content><h3>Índice</h3><nav id=TableOfContents><ul><li><a href=#intro>1. Introdução ao NanoBSD</a></li><li><a href=#howto>2. Guia do NanoBSD</a></li></ul></nav><hr><div class=resources><h3>Recursos</h3><ul class=contents><li><i class="fa fa-file-pdf-o" aria-hidden=true title="Download PDF"></i><a href=https://download.freebsd.org/doc/pt-br/articles/nanobsd/nanobsd_pt-br.pdf>Download PDF</a></li><li><i class="fa fa-pencil-square-o" aria-hidden=true title="Edite essa página"></i><a href=https://github.com/freebsd/freebsd-doc/blob/main/documentation/content/pt-br/_index target=_blank>Edite essa página</a></li></ul></div></div></aside></main><footer><div class=footer-container><section class=logo-column><img src=https://docs.freebsd.org/images/FreeBSD-colors.svg width=160 height=50 alt="FreeBSD logo"><div class=options-container><div class=language-container><a id=languages href=https://docs.freebsd.org/pt-br/languages><img src=https://docs.freebsd.org/images/language.png class=language-image alt="Escolha o idioma">
<span>Brazilian Portuguese</span></a></div><div class=theme-container><select id=theme-chooser><option value=theme-system>System</option><option value=theme-light>Light</option><option value=theme-dark>Dark</option><option value=theme-high-contrast>Alto contraste</option></select></div></div></section><section class=about-column><h3 class=column-title>About</h3><ul class=column-elements-container><li><a href=https://www.freebsd.org/about/ target=_blank class=column-element>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/ target=_blank class=column-element>FreeBSD Foundation</a></li><li><a href=https://www.freebsd.org/where/ target=_blank class=column-element>Get FreeBSD</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct target=_blank class=column-element>Code of Conduct</a></li><li><a href=https://www.freebsd.org/security/ target=_blank class=column-element>Security Advisories</a></li></ul></section><section class=documentation-column><h3 class=column-title>Documentation</h3><ul class=column-elements-container><li><a href=/pt-br class=column-element>Documentation portal</a></li><li><a href=https://man.FreeBSD.org target=_blank class=column-element>Manual pages</a></li><li><a href=https://papers.FreeBSD.org target=_blank class=column-element>Presentations and papers</a></li><li><a href=https://docs-archive.freebsd.org/doc/ target=_blank class=column-element>Previous versions</a></li><li><a href=https://docs-archive.freebsd.org/44doc/ target=_blank class=column-element>4.4BSD Documents</a></li><li><a href=https://wiki.freebsd.org/ target=_blank class=column-element>Wiki</a></li></ul></section><section class=community-column><h3 class=column-title>Community</h3><ul class=column-elements-container><li><a href=https://docs.freebsd.org/pt-br/articles/contributing class=column-element>Get involved</a></li><li><a href=https://forums.freebsd.org/ target=_blank class=column-element>Community forum</a></li><li><a href=https://lists.freebsd.org/ target=_blank class=column-element>Mailing lists</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank class=column-element>IRC Channels</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank class=column-element>Bug Tracker</a></li></ul></section><section class=legal-column><h3 class=column-title>Legal</h3><ul class=column-elements-container><li><a href=https://freebsdfoundation.org/donate/ target=_blank class=column-element>Donations</a></li><li><a href=https://www.freebsd.org/copyright/freebsd-license/ target=_blank class=column-element>Licensing</a></li><li><a href=https://www.freebsd.org/privacy/ target=_blank class=column-element>Privacy Policy</a></li><li><a href=https://www.freebsd.org/copyright/ target=_blank class=column-element>Legal notices</a></li></ul></section><section class=copyright-column><p>&copy; 1994-2024 The FreeBSD Project. All rights reserved</p><span>Made with <span class=heart>♥</span> by the FreeBSD Community</span></section></div></footer></body></html>