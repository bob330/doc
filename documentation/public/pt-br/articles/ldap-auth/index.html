<!doctype html><html class=theme-light lang=pt-br><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Guia para a configuração de um servidor LDAP para autenticação no FreeBSD"><meta name=keywords content="LDAP,Authentication,OpenLDAP,configuration,guide,tutorial,FreeBSD"><meta name=copyright content="1995-2024 The FreeBSD Foundation"><link rel=canonical href=http://172.16.201.134:1313/pt-br/articles/ldap-auth/><title>Autenticação LDAP | FreeBSD Documentation Portal</title>
<meta name=theme-color content="#790000"><meta name=color-scheme content="system light dark high-contrast"><link rel="shortcut icon" href=http://172.16.201.134:1313/favicon.ico><link rel=stylesheet href=http://172.16.201.134:1313/styles/main.min.css><link rel=stylesheet href=http://172.16.201.134:1313/css/font-awesome-min.css><script defer src=/js/theme-chooser.min.js></script><script defer src=/js/copy-clipboard.min.js></script><script defer src=/js/search.min.js></script><meta name=twitter:card content="summary"><meta name=twitter:domain content="docs.FreeBSD.org"><meta name=twitter:site content="@freebsd"><meta name=twitter:url content="https://twitter.com/freebsd"><meta property="og:title" content="Autenticação LDAP"><meta property="og:description" content="Guia para a configuração de um servidor LDAP para autenticação no FreeBSD"><meta property="og:type" content="website"><meta property="og:image" content="http://172.16.201.134:1313/favicon.ico"><meta property="og:image:alt" content="FreeBSD Logo"><meta property="og:locale" content="pt-br"><meta property="og:url" content="http://172.16.201.134:1313/pt-br/articles/ldap-auth/"><meta property="og:site_name" content="FreeBSD Documentation Portal"><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","url":"http:\/\/172.16.201.134:1313\/pt-br\/articles\/ldap-auth\/","name":"FreeBSD Documentation Portal","headline":"FreeBSD Documentation Portal","description":"FreeBSD Documentation Portal"}</script></head><body><header><div class=header-container><div class=logo-menu-bars-container><a href=https://www.FreeBSD.org class=logo><img src=http://172.16.201.134:1313/images/FreeBSD-monochromatic.svg width=160 height=50 alt="FreeBSD logo">
</a><label class=menu-bars for=menu-bars><i class="fa fa-bars" aria-hidden=true></i></label></div><input id=menu-bars type=checkbox><nav><ul class=menu><li class=menu-item><input id=about type=checkbox>
<a href=# aria-label="Navigate to About section"><label class=menu-item-description for=about>About
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/about/ target=_blank>About</a></li><li><a href=https://www.freebsd.org/about/ target=_blank>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/about-us/about-the-foundation/ target=_blank>FreeBSD Foundation</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct/ target=_blank>Code of Conduct</a></li></ul></li><li class=menu-item><input id=download type=checkbox>
<a href=# aria-label="Navigate to get FreeBSD section"><label class=menu-item-description for=download>Get FreeBSD
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/where/ target=_blank>Get FreeBSD</a></li><li><a href=https://www.freebsd.org/releases/ target=_blank>Release Information</a></li><li><a href=https://www.freebsd.org/releng/ target=_blank>Release Engineering</a></li><li><a href=https://www.freebsd.org/security/ target=_blank>Security Advisories</a></li></ul></li><li class=menu-item><input id=documentation type=checkbox>
<a href=# aria-label="Navigate to get Documentation section"><label class=menu-item-description for=documentation>Documentation
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=/pt-br>Documentation portal</a></li><li><a href=http://172.16.201.134:1313/pt-br/books/handbook>FreeBSD Handbook</a></li><li><a href=http://172.16.201.134:1313/pt-br/books/porters-handbook>Porter's Handbook</a></li><li><a href=https://docs.FreeBSD.org/en/books/fdp-primer>Documentation Project Handbook</a></li><li><a href=https://man.FreeBSD.org target=_blank>Manual pages</a></li><li><a href=https://papers.FreeBSD.org target=_blank>Presentations and papers</a></li><li><a href=https://wiki.FreeBSD.org target=_blank>Wiki</a></li><li><a href=http://172.16.201.134:1313/pt-br/books>Books</a></li><li><a href=http://172.16.201.134:1313/pt-br/articles>Articles</a></li></ul></li><li class=menu-item><input id=community type=checkbox>
<a href=# aria-label="Navigate to get Community section"><label class=menu-item-description for=community>Community
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/community/>Community</a></li><li><a href=http://172.16.201.134:1313/pt-br/articles/contributing>Get involved</a></li><li><a href=https://forums.freebsd.org/ target=_blank>Forum</a></li><li><a href=https://lists.freebsd.org/ target=_blank>Mailing lists</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank>IRC Channels</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank>Bug Tracker</a></li><li><a href=https://www.freebsd.org/support/ target=_blank>Support</a></li></ul></li></ul></nav><div class=search-donate-container><form class=search method=get id=search-header-form action=https://docs.freebsd.org/search name=search-header-form><input type=hidden name=DB value=pt-br>
<input id=words name=P type=text size=20 maxlength=255>
<button>
<i class="fa fa-search" aria-hidden=true></i></button></form><div class=donate><a href=https://freebsdfoundation.org/donate/ target=_blank><span class=heart>♥</span>
Donate</a></div></div></div></header><main class=main-wrapper-article><div class=article><h1 class=title>Autenticação LDAP</h1><div class="admonitionblock note"><p><i class="fa fa-exclamation-circle" aria-hidden=true></i>
Esta tradução pode estar desatualizada. Para ajudar com as traduções, acesse a <a href=https://translate-dev.freebsd.org/ target=_blank>ferramenta de traduções do FreeBSD</a>.</p></div><div class=copyright>Copyright © 2007-2008 The FreeBSD Documentation Project</div><div class=legalnotice><a id=trademarks></a><details><summary>trademarks</summary><p>FreeBSD is a registered trademark of the FreeBSD Foundation.</p><p>Many of the designations used by manufacturers and sellers to distinguish their products are claimed as trademarks. Where those designations appear in this document, and the FreeBSD Project was aware of the trademark claim, the designations have been followed by the “™” or the “®” symbol.</p></details></div><div class=toc-mobile><h3>Índice</h3><nav id=TableOfContents><ul><li><a href=#preface>1. Prefácio</a></li><li><a href=#ldap>2. Configurando o LDAP</a></li><li><a href=#client>3. Configuração do Cliente</a></li><li><a href=#secure>4. Considerações de segurança</a></li><li><a href=#useful>Apêndice A: Ajudas Úteis</a></li><li><a href=#ssl-ca>Apêndice B: Certificados OpenSSL para o LDAP</a></li></ul></nav></div><div id=preamble><div class=sectionbody><div class="paragraph abstract-title"><p>Resumo</p></div><div class=paragraph><p>Este documento pretende ser um guia para a configuração de um servidor LDAP (principalmente um servidor OpenLDAP) para autenticação no FreeBSD. Isso é útil para situações em que muitos servidores precisam das mesmas contas de usuário, por exemplo, como substituto do NIS.</p></div><hr></div></div><div class=sect1><h2 id=preface>1. Prefácio<a class=anchor href=#preface></a></h2><div class=sectionbody><div class=paragraph><p>Este documento destina-se a fornecer ao leitor uma compreensão suficiente do LDAP para configurar um servidor LDAP. Este documento tentará fornecer uma explicação de <a class=package href=https://cgit.freebsd.org/ports/tree/net/nss_ldap/>net/nss_ldap</a> e <a class=package href=https://cgit.freebsd.org/ports/tree/security/pam_ldap/>security/pam_ldap</a> para uso com serviços de máquinas cliente para uso com o servidor LDAP.</p></div><div class=paragraph><p>Quando terminar, o leitor deve ser capaz de configurar e implantar um servidor FreeBSD que possa hospedar um diretório LDAP e configurar e implantar um servidor FreeBSD que possa autenticar em um diretório LDAP.</p></div><div class=paragraph><p>Este artigo não pretende ser um relato exaustivo da segurança, robustez ou considerações sobre práticas recomendadas para configurar o LDAP ou os outros serviços discutidos aqui. Embora o autor tenha o cuidado de fazer tudo corretamente, ele não aborda problemas de segurança além do escopo geral. Este artigo deve ser considerado para estabelecer as bases teóricas somente, e qualquer implementação real deve ser acompanhada por uma análise cuidadosa dos requisitos.</p></div></div></div><div class=sect1><h2 id=ldap>2. Configurando o LDAP<a class=anchor href=#ldap></a></h2><div class=sectionbody><div class=paragraph><p>LDAP significa "Lightweight Directory Access Protocol" e é um subconjunto do X.500 Directory Access Protocol. Suas especificações mais recentes estão na <a href=http://www.ietf.org/rfc/rfc4510.txt>RFC4510</a> e documentos amigáveis. Essencialmente, é um banco de dados que espera ser lido com mais frequência do que é escrito.</p></div><div class=paragraph><p>O servidor LDAP <a href=http://www.openldap.org/>OpenLDAP</a> será usado nos exemplos deste documento; embora os princípios aqui devam ser geralmente aplicáveis a muitos servidores diferentes, a maior parte da administração concreta é especificamente para OpenLDAP. Existem várias versões de servidor nos ports, por exemplo <a class=package href=https://cgit.freebsd.org/ports/tree/net/openldap24-server/>net/openldap24-server</a>. Os servidores clientes precisarão das bibliotecas <a class=package href=https://cgit.freebsd.org/ports/tree/net/openldap24-client/>net/openldap24-client</a> correspondentes.</p></div><div class=paragraph><p>Existem (basicamente) duas áreas do serviço LDAP que precisam de configuração. A primeira é a configuração de um servidor para receber as conexões corretamente, e o segundo é adicionar entradas ao diretório do servidor para que as ferramentas do FreeBSD saibam como interagir com ele.</p></div><div class=sect2><h3 id=ldap-connect>2.1. Configurando o servidor para conexões<a class=anchor href=#ldap-connect></a></h3><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Esta seção é específica do OpenLDAP. Se você estiver usando outro servidor, precisará consultar a documentação desse servidor.</p></div></td></tr></tbody></table></div><div class=sect3><h4 id=ldap-connect-install>2.1.1. Instalando o OpenLDAP<a class=anchor href=#ldap-connect-install></a></h4><div class=paragraph><p>Primeiro, instale o OpenLDAP:</p></div><div id=oldap-install class=exampleblock><div class=title>Exemplo 1. Instalando o OpenLDAP</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/ports/net/openldap24-server</span>
<span class=c># make install clean</span></code></pre></div></div></div></div><div class=paragraph><p>Isso instala os binários <code>slapd</code> e <code>slurpd</code>, juntamente com as bibliotecas OpenLDAP requeridas.</p></div></div><div class=sect3><h4 id=ldap-connect-config>2.1.2. Configurando o OpenLDAP<a class=anchor href=#ldap-connect-config></a></h4><div class=paragraph><p>Em seguida, devemos configurar o OpenLDAP.</p></div><div class=paragraph><p>Você desejará exigir criptografia em suas conexões com o servidor LDAP; caso contrário, as senhas de seus usuários serão transferidas em texto simples, o que é considerado inseguro. As ferramentas que usaremos suportam dois tipos muito semelhantes de criptografia, SSL e TLS.</p></div><div class=paragraph><p>TLS significa "Segurança da Camada de Transporte". Serviços que empregam TLS tendem a se conectar nas <em>mesmas</em> portas que os mesmos serviços sem TLS; assim, um servidor SMTP que suporte o TLS escutará as conexões na porta 25 e um servidor LDAP escutará no 389.</p></div><div class=paragraph><p>SSL significa "Secure Sockets Layer", e serviços que implementam SSL <em>não</em> escutam nas mesmas portas que seus equivalentes não-SSL. Assim, o SMTPS atende na porta 465 (não 25), HTTPS escuta na 443 e LDAPS na 636.</p></div><div class=paragraph><p>A razão pela qual o SSL usa uma porta diferente do TLS é porque uma conexão TLS começa como texto simples e alterna para o tráfego criptografado após a diretiva <code>STARTTLS</code>. As conexões SSL são criptografadas desde o início. Além disso, não há diferenças substanciais entre os dois.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Ajustaremos o OpenLDAP para usar o TLS, já que o SSL é considerado obsoleto.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Uma vez que o OpenLDAP esteja instalado via ports, os seguintes parâmetros de configuração em <span class=filename>/usr/local/etc/openldap/slapd.conf</span> irão ativar o TLS:</p></div><div class="literalblock programlisting"><div class=content><pre>security ssf=128

TLSCertificateFile /path/to/your/cert.crt
TLSCertificateKeyFile /path/to/your/cert.key
TLSCACertificateFile /path/to/your/cacert.crt</pre></div></div><div class=paragraph><p>Aqui, <code>ssf=128</code> diz ao OpenLDAP para exigir criptografia de 128 bits para todas as conexões, tanto de pesquisa quanto de atualização. Esse parâmetro pode ser configurado com base nas necessidades de segurança do seu site, mas raramente é necessário enfraquecê-la, pois a maioria das bibliotecas de clientes LDAP oferece suporte à criptografia forte.</p></div><div class=paragraph><p>Os arquivos <span class=filename>cert.crt</span>, <span class=filename>cert.key</span> e <span class=filename>cacert.crt</span> são necessários para que os clientes autentiquem <em>você</em> como o servidor LDAP válido. Se você simplesmente quiser um servidor que seja executado, poderá criar um certificado auto-assinado com o OpenSSL:</p></div><div id=genrsa class=exampleblock><div class=title>Exemplo 2. Gerando uma chave RSA</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% openssl genrsa <span class=nt>-out</span> cert.key 1024
Generating RSA private key, 1024 bit long modulus
....................++++++
...++++++
e is 65537 <span class=o>(</span>0x10001<span class=o>)</span>

% openssl req <span class=nt>-new</span> <span class=nt>-key</span> cert.key <span class=nt>-out</span> cert.csr</code></pre></div></div></div></div><div class=paragraph><p>Neste ponto, você deve ser solicitado para digitar alguns valores. Você pode inserir os valores que quiser; no entanto, é importante que o valor "Common Name" seja o nome de domínio totalmente qualificado do servidor OpenLDAP. No nosso caso, e os exemplos aqui, o servidor é <em>server.example.org</em>. Definir incorretamente esse valor fará com que os clientes falhem ao fazer conexões. Isso pode causar uma grande frustração, portanto, certifique-se de seguir atentamente estas etapas.</p></div><div class=paragraph><p>Por fim, a requisição de assinatura de certificado precisa ser assinada:</p></div><div id=self-sign class=exampleblock><div class=title>Exemplo 3. Auto-assinando o certificado</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% openssl x509 <span class=nt>-req</span> <span class=nt>-in</span> cert.csr <span class=nt>-days</span> 365 <span class=nt>-signkey</span> cert.key <span class=nt>-out</span> cert.crt
Signature ok
<span class=nv>subject</span><span class=o>=</span>/C<span class=o>=</span>AU/ST<span class=o>=</span>Some-State/O<span class=o>=</span>Internet Widgits Pty Ltd
Getting Private key</code></pre></div></div></div></div><div class=paragraph><p>Isso criará um certificado auto-assinado que pode ser usado para as diretivas em <span class=filename>slapd.conf</span>, onde <span class=filename>cert.crt</span> e <span class=filename>cacert.crt</span> são o mesmo arquivo. Se você for usar muitos servidores OpenLDAP (para replicação via <code>slurpd</code>), você vai querer ver <a href=#ssl-ca>Certificados OpenSSL para o LDAP</a> para gerar uma chave CA e usá-la para assinar certificados de servidor individuais.</p></div><div class=paragraph><p>Feito isso, coloque o seguinte em <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>slapd_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>Em seguida, execute <code>/usr/local/etc/rc.d/slapd start</code>. Isso deve iniciar o OpenLDAP. Confirme que está escutando em 389 com</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% sockstat <span class=nt>-4</span> <span class=nt>-p</span> 389
ldap     slapd      3261  7  tcp4   <span class=k>*</span>:389                 <span class=k>*</span>:<span class=k>*</span></code></pre></div></div></div><div class=sect3><h4 id=ldap-connect-client>2.1.3. Configurando o Cliente<a class=anchor href=#ldap-connect-client></a></h4><div class=paragraph><p>Instale o port <a class=package href=https://cgit.freebsd.org/ports/tree/net/openldap24-client/>net/openldap24-client</a> para as bibliotecas do OpenLDAP. As máquinas cliente sempre terão bibliotecas OpenLDAP, já que é todo o suporte a <a class=package href=https://cgit.freebsd.org/ports/tree/security/pam_ldap/>security/pam_ldap</a> e <a class=package href=https://cgit.freebsd.org/ports/tree/net/nss_ldap/>net/nss_ldap</a>, pelo menos por enquanto.</p></div><div class=paragraph><p>O arquivo de configuração para as bibliotecas OpenLDAP é <span class=filename>/usr/local/etc/openldap/ldap.conf</span>. Edite este arquivo para conter os seguintes valores:</p></div><div class="literalblock programlisting"><div class=content><pre>base dc=example,dc=org
uri ldap://server.example.org/
ssl start_tls
tls_cacert /path/to/your/cacert.crt</pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>É importante que seus clientes tenham acesso ao <span class=filename>cacert.crt</span>, caso contrário, eles não poderão se conectar.</p></div></td></tr></tbody></table></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Existem dois arquivos chamados <span class=filename>ldap.conf</span>. O primeiro é este arquivo, que é para as bibliotecas OpenLDAP e define como falar com o servidor. O segundo é <span class=filename>/usr/local/etc/ldap.conf</span> e é para pam_ldap.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Neste ponto, você deve conseguir executar <code>ldapsearch -Z</code> na máquina cliente; <code>-Z</code> significa "usar o TLS". Se você encontrar um erro, então algo está configurado errado; muito provavelmente são seus certificados. Use os comandos <code>s_client</code> e <code>s_server</code> do <a href="https://man.freebsd.org/cgi/man.cgi?query=openssl&amp;sektion=1&amp;format=html">openssl(1)</a> para assegurar que você os tenha configurado e assinado corretamente.</p></div></div></div><div class=sect2><h3 id=ldap-database>2.2. Entradas no banco de dados<a class=anchor href=#ldap-database></a></h3><div class=paragraph><p>A autenticação em um diretório LDAP geralmente é realizada pela tentativa de vincular ao diretório como o usuário de conexão. Isso é feito estabelecendo um vinculo "simples" no diretório com o nome de usuário fornecido. Se houver uma entrada com o <code>uid</code> igual ao nome do usuário e o atributo <code>userPassword</code> da entrada corresponder à senha fornecida, o vinculo será bem-sucedido.</p></div><div class=paragraph><p>A primeira coisa que temos que fazer é descobrir onde no diretório os nossos usuários irão estar.</p></div><div class=paragraph><p>A entrada de base para nosso banco de dados é <code>dc=example,dc=org</code>. O local padrão para usuários que a maioria dos clientes parece esperar é algo como <code>ou=people, <em>base</em></code>, então é isso que será usado aqui. No entanto, tenha em mente que isso é configurável.</p></div><div class=paragraph><p>Assim, a entrada ldif para a unidade organizacional <code>people</code> será semelhante a:</p></div><div class="literalblock programlisting"><div class=content><pre>dn: ou=people,dc=example,dc=org
objectClass: top
objectClass: organizationalUnit
ou: people</pre></div></div><div class=paragraph><p>Todos os usuários serão criados como subentradas dessa unidade organizacional.</p></div><div class=paragraph><p>Alguma consideração pode ser dada à classe de objeto a que seus usuários pertencerão. A maioria das ferramentas, por padrão, usará <code>people</code>, o que é bom se você quiser simplesmente fornecer entradas para autenticar. No entanto, se você for armazenar informações do usuário no banco de dados LDAP, provavelmente usará <code>inetOrgPerson</code>, que possui muitos atributos úteis. Em ambos os casos, os esquemas relevantes precisam ser carregados em <span class=filename>slapd.conf</span>.</p></div><div class=paragraph><p>Para este exemplo, usaremos a classe de objeto <code>person</code>. Se você estiver usando <code>inetOrgPerson</code>, as etapas são basicamente idênticas, exceto que o atributo <code>sn</code> é necessário.</p></div><div class=paragraph><p>Para adicionar um usuário de teste chamado <code>tuser</code>, o ldif seria:</p></div><div class="literalblock programlisting"><div class=content><pre>dn: uid=tuser,ou=people,dc=example,dc=org
objectClass: person
objectClass: posixAccount
objectClass: shadowAccount
objectClass: top
uidNumber: 10000
gidNumber: 10000
homeDirectory: /home/tuser
loginShell: /bin/csh
uid: tuser
cn: tuser</pre></div></div><div class=paragraph><p>Eu inicio os UIDs dos meus usuários LDAP em 10000 para evitar colisões com contas do sistema; você pode configurar o número que desejar aqui, desde que seja menor que 65536.</p></div><div class=paragraph><p>Também precisamos de entradas de grupo. Eles são configuráveis como entradas do usuário, mas usaremos os padrões abaixo:</p></div><div class="literalblock programlisting"><div class=content><pre>dn: ou=people,dc=example,dc=org
objectClass: top
objectClass: organizationalUnit
ou: people

dn: cn=tuser,ou=groups,dc=example,dc=org
objectClass: posixGroup
objectClass: top
gidNumber: 10000
cn: tuser</pre></div></div><div class=paragraph><p>Para inseri-los em seu banco de dados, você pode usar <code>slapadd</code> ou <code>ldapadd</code> em um arquivo contendo essas entradas. Alternativamente, você pode usar o <a class=package href=https://cgit.freebsd.org/ports/tree/sysutils/ldapvi/>sysutils/ldapvi</a>.</p></div><div class=paragraph><p>O utilitário <code>ldapsearch</code> na máquina cliente deve agora retornar essas entradas. Em caso afirmativo, o banco de dados está configurado corretamente para ser usado como um servidor de autenticação LDAP.</p></div></div></div></div><div class=sect1><h2 id=client>3. Configuração do Cliente<a class=anchor href=#client></a></h2><div class=sectionbody><div class=paragraph><p>O cliente já deve ter bibliotecas do OpenLDAP do <a href=#ldap-connect-client>Configurando o Cliente</a>, mas se você estiver instalando várias máquinas clientes, precisará instalar o <a class=package href=https://cgit.freebsd.org/ports/tree/net/openldap24-client/>net/openldap24-client</a> em cada um deles.</p></div><div class=paragraph><p>O FreeBSD requer que dois ports sejam instalados para autenticação em um servidor LDAP, <a class=package href=https://cgit.freebsd.org/ports/tree/security/pam_ldap/>security/pam_ldap</a> e <a class=package href=https://cgit.freebsd.org/ports/tree/net/nss_ldap/>net/nss_ldap</a>.</p></div><div class=sect2><h3 id=client-auth>3.1. Autenticação<a class=anchor href=#client-auth></a></h3><div class=paragraph><p>O <a class=package href=https://cgit.freebsd.org/ports/tree/security/pam_ldap/>security/pam_ldap</a> é configurado através do <span class=filename>/usr/local/etc/ldap.conf</span>.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Este é um <em>arquivo diferente</em> que o arquivo de configuração das funções da biblioteca OpenLDAP, <span class=filename>/usr/local/etc/openldap/ldap.conf</span>; no entanto, são necessárias muitas das mesmas opções; na verdade, é um superconjunto desse arquivo. Para o resto desta seção, referências a <span class=filename>ldap.conf</span> irão significar o arquivo <span class=filename>/usr/local/etc/ldap.conf</span>.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Assim, vamos querer copiar todos os nossos parâmetros de configuração originais do <span class=filename>openldap/ldap.conf</span> para o novo <span class=filename>ldap.conf</span>. Feito isso, queremos informar ao <a class=package href=https://cgit.freebsd.org/ports/tree/security/pam_ldap/>security/pam_ldap</a> o que procurar no servidor de diretório.</p></div><div class=paragraph><p>Estamos identificando nossos usuários com o atributo <code>uid</code>. Para configurar isso (embora seja o padrão), defina a diretiva <code>pam_login_attribute</code> no <span class=filename>ldap.conf</span>:</p></div><div id=set-pam-login-attr class=exampleblock><div class=title>Exemplo 4. Definindo <code>pam_login_attribute</code></div><div class=content><div class="literalblock programlisting"><div class=content><pre>pam_login_attribute uid</pre></div></div></div></div><div class=paragraph><p>Com esta definição, o <a class=package href=https://cgit.freebsd.org/ports/tree/security/pam_ldap/>security/pam_ldap</a> pesquisará todo o diretório LDAP na <code>base</code> para o valor <code>uid=<em>username</em></code>. Se encontrar uma e apenas uma entrada, ela tentará se vincular como aquele usuário com a senha que foi fornecida. Se vincular corretamente, então permitirá o acesso. Caso contrário, falhará.</p></div><div class=paragraph><p>Os usuários cujo shell não está em <span class=filename>/etc/shells</span> não poderão efetuar login. Isto é particularmente importante quando o Bash é definido como o shell do usuário no servidor LDAP. O Bash não está incluído em uma instalação padrão do FreeBSD. Quando instalado a partir de um pacote ou port, ele está localizado em <span class=filename>/usr/local/bin/bash</span>. Verifique se o caminho para o shell no servidor está definido corretamente:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% getent passwd username</code></pre></div></div><div class=paragraph><p>Existem duas opções quando a saída mostra <code>/bin/bash</code> na última coluna. A primeira é alterar a entrada do usuário no servidor LDAP para <span class=filename>/usr/local/bin/bash</span>. A segunda opção é criar um link simbólico no computador cliente LDAP para que o Bash seja encontrado no local correto:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ln -s /usr/local/bin/bash /bin/bash</span></code></pre></div></div><div class=paragraph><p>Certifique-se de que <span class=filename>/etc/shells</span> contenha entradas para ambos <code>/usr/local/bin/bash</code> e <code>/bin/bash</code>. O usuário poderá então efetuar login no sistema com Bash como seu shell.</p></div><div class=sect3><h4 id=client-auth-pam>3.1.1. PAM<a class=anchor href=#client-auth-pam></a></h4><div class=paragraph><p>PAM, que significa "Pluggable Authentication Modules", é o método pelo qual o FreeBSD autentica a maioria de suas sessões. Para dizer ao FreeBSD que desejamos usar um servidor LDAP, teremos que adicionar uma linha ao arquivo PAM apropriado.</p></div><div class=paragraph><p>Na maioria das vezes o arquivo PAM apropriado é <span class=filename>/etc/pam.d/sshd</span>, se você quiser usar SSH (lembre-se de definir as opções relevantes em <span class=filename>/etc/ssh/sshd_config</span>, caso contrário o SSH não usará o PAM).</p></div><div class=paragraph><p>Para usar o PAM para autenticação, adicione a linha</p></div><div class="literalblock programlisting"><div class=content><pre>auth  sufficient  /usr/local/lib/pam_ldap.so  no_warn</pre></div></div><div class=paragraph><p>Exatamente onde essa linha aparece no arquivo e quais opções aparecem na quarta coluna, determine o comportamento exato do mecanismo de autenticação; veja <a href="https://man.freebsd.org/cgi/man.cgi?query=pam.d&amp;sektion=5&amp;format=html">pam.d(5)</a></p></div><div class=paragraph><p>Com essa configuração, você deve conseguir autenticar um usuário em um diretório LDAP. O PAM executará uma ligação com suas credenciais e, se for bem-sucedido, informará ao SSH para permitir o acesso.</p></div><div class=paragraph><p>No entanto, não é uma boa idéia permitir que <em>todo</em> usuário no diretório dentro de <em>todo</em> computador cliente. Com a configuração atual, tudo o que um usuário precisa para efetuar login em uma máquina é uma entrada LDAP. Felizmente, existem algumas maneiras de restringir o acesso do usuário.</p></div><div class=paragraph><p>O <span class=filename>ldap.conf</span> suporta uma diretiva <code>pam_groupdn</code>; Cada conta que se conecta a essa máquina precisa ser membro do grupo especificado aqui. Por exemplo, se você tem</p></div><div class="literalblock programlisting"><div class=content><pre>pam_groupdn cn=servername,ou=accessgroups,dc=example,dc=org</pre></div></div><div class=paragraph><p>em <span class=filename>ldap.conf</span>, somente os membros desse grupo poderão efetuar login. Entretanto, há algumas coisas a serem lembradas.</p></div><div class=paragraph><p>Os membros desse grupo são especificados em um ou mais atributos <code>memberUid</code> e cada atributo deve ter o nome distinto completo do membro. Então <code>memberUid:someuser</code> não funcionará; deve ser:</p></div><div class="literalblock programlisting"><div class=content><pre>memberUid: uid=someuser,ou=people,dc=example,dc=org</pre></div></div><div class=paragraph><p>Além disso, essa diretiva não é verificada no PAM durante a autenticação, ela é verificada durante o gerenciamento de contas, portanto, você precisará de uma segunda linha em seus arquivos PAM sob <code>account</code>. Isso exigirá, por sua vez, que <em>todo</em> usuário seja listado no grupo, o que não é necessariamente o que queremos. Para evitar o bloqueio de usuários que não estão no LDAP, você deve ativar o atributo <code>ignore_unknown_user</code>. Finalmente, você deve definir a opção <code>ignore_authinfo_unavail</code> para que você não fique bloqueado em todos os computadores quando o servidor LDAP estiver indisponível.</p></div><div class=paragraph><p>Seu <span class=filename>pam.d/sshd</span> pode acabar ficando assim:</p></div><div id=pam class=exampleblock><div class=title>Exemplo 5. Exemplo <span class=filename>pam.d/sshd</span></div><div class=content><div class="literalblock programlisting"><div class=content><pre>auth            required        pam_nologin.so          no_warn
auth            sufficient      pam_opie.so             no_warn no_fake_prompts
auth            requisite       pam_opieaccess.so       no_warn allow_local
auth            sufficient      /usr/local/lib/pam_ldap.so      no_warn
auth            required        pam_unix.so             no_warn try_first_pass

account         required        pam_login_access.so
account         required        /usr/local/lib/pam_ldap.so      no_warn ignore_authinfo_unavail ignore_unknown_user</pre></div></div></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Como estamos adicionando essas linhas especificamente para <span class=filename>pam.d/sshd</span>, isso só terá um efeito nas sessões SSH. Os usuários LDAP não poderão efetuar login no console. Para mudar este comportamento, examine os outros arquivos em <span class=filename>/etc/pam.d</span> e modifique-os de acordo.</p></div></td></tr></tbody></table></div></div></div><div class=sect2><h3 id=client-nss>3.2. Switch de serviço de nome<a class=anchor href=#client-nss></a></h3><div class=paragraph><p>NSS é o serviço que mapeia atributos para nomes. Assim, por exemplo, se um arquivo é de propriedade do usuário <code>1001</code>, um aplicativo consultará o NSS para o nome de <code>1001</code>, e ele pode obter <code>bob</code> ou <code>ted</code> ou qualquer que seja o nome do usuário.</p></div><div class=paragraph><p>Agora que nossas informações sobre o usuário são mantidas no LDAP, precisamos dizer ao NSS para procurar lá quando perguntado.</p></div><div class=paragraph><p>O port <a class=package href=https://cgit.freebsd.org/ports/tree/net/nss_ldap/>net/nss_ldap</a> faz isso. Ele usa o mesmo arquivo de configuração como <a class=package href=https://cgit.freebsd.org/ports/tree/security/pam_ldap/>security/pam_ldap</a> e não deve precisar de nenhum parâmetro extra depois de instalado. Em vez disso, o que resta é simplesmente editar é <span class=filename>/etc/nsswitch.conf</span> para aproveitar o diretório. Simplesmente substitua as seguintes linhas:</p></div><div class="literalblock programlisting"><div class=content><pre>group: compat
passwd: compat</pre></div></div><div class=paragraph><p>com</p></div><div class="literalblock programlisting"><div class=content><pre>group: files ldap
passwd: files ldap</pre></div></div><div class=paragraph><p>Isso permitirá que você mapeie nomes de usuários para UIDs e UIDs para nomes de usuários.</p></div><div class=paragraph><p>Parabéns! Agora você deve ter autenticação LDAP em funcionamento.</p></div></div><div class=sect2><h3 id=caveats>3.3. Ressalvas<a class=anchor href=#caveats></a></h3><div class=paragraph><p>Infelizmente, a partir do momento em que isso foi escrito, o FreeBSD não suportava a mudança de senhas de usuário com <a href="https://man.freebsd.org/cgi/man.cgi?query=passwd&amp;sektion=1&amp;format=html">passwd(1)</a>. Por causa disso, a maioria dos administradores estão deixando para implementar uma solução por conta própria. Eu forneço alguns exemplos aqui. Observe que, se você escrever seu próprio script de alteração de senha, há alguns problemas de segurança dos quais você deve estar ciente; veja <a href=#security-passwd>Armazenamento de Senha</a></p></div><div id=chpw-shell class=exampleblock><div class=title>Exemplo 6. Script de shell para alteração de senhas</div><div class=content><div class="literalblock programlisting"><div class=content><pre>#!/bin/sh

stty -echo
read -p &#34;Old Password: &#34; oldp; echo
read -p &#34;New Password: &#34; np1; echo
read -p &#34;Retype New Password: &#34; np2; echo
stty echo

if [ &#34;$np1&#34; != &#34;$np2&#34; ]; then
  echo &#34;Passwords do not match.&#34;
  exit 1
fi

ldappasswd -D uid=&#34;$USER&#34;,ou=people,dc=example,dc=org \
  -w &#34;$oldp&#34; \
  -a &#34;$oldp&#34; \
  -s &#34;$np1&#34;</pre></div></div></div></div><div class="admonitionblock caution"><table><tbody><tr><td class=icon><i class="fa icon-caution" title=Caution></i></td><td class=content><div class=paragraph><p>Esse script dificilmente faz qualquer verificação de erros, mas, o mais importante, é muito indiferente sobre como ele armazena suas senhas. Se você fizer algo assim, ajuste pelo menos o valor de sysctl <code>security.bsd.see_other_uids</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sysctl security.bsd.see_other_uids=0</span></code></pre></div></div></td></tr></tbody></table></div><div class=paragraph><p>Uma abordagem mais flexível (e provavelmente mais segura) pode ser usada escrevendo um programa personalizado, ou até mesmo uma interface web. A seguir, parte de uma biblioteca Ruby que pode alterar senhas LDAP. Ele vê o uso na linha de comando e na web.</p></div><div id=chpw-ruby class=exampleblock><div class=title>Exemplo 7. Script Ruby para Alterar Senhas</div><div class=content><div class="literalblock programlisting"><div class=content><pre>require &#39;ldap&#39;
require &#39;base64&#39;
require &#39;digest&#39;
require &#39;password&#39; # ruby-password

ldap_server = &#34;ldap.example.org&#34;
luser = &#34;uid=#{ENV[&#39;USER&#39;]},ou=people,dc=example,dc=org&#34;

# get the new password, check it, and create a salted hash from it
def get_password
  pwd1 = Password.get(&#34;New Password: &#34;)
  pwd2 = Password.get(&#34;Retype New Password: &#34;)

  raise if pwd1 != pwd2
  pwd1.check # check password strength

  salt = rand.to_s.gsub(/0\./, &#39;&#39;)
  pass = pwd1.to_s
  hash = &#34;{SSHA}&#34;+Base64.encode64(Digest::SHA1.digest(&#34;#{pass}#{salt}&#34;)+salt).chomp!
  return hash
end

oldp = Password.get(&#34;Old Password: &#34;)
newp = get_password

# We&#39;ll just replace it.  That we can bind proves that we either know
# the old password or are an admin.

replace = LDAP::Mod.new(LDAP::LDAP_MOD_REPLACE | LDAP::LDAP_MOD_BVALUES,
                        &#34;userPassword&#34;,
                        [newp])

conn = LDAP::SSLConn.new(ldap_server, 389, true)
conn.set_option(LDAP::LDAP_OPT_PROTOCOL_VERSION, 3)
conn.bind(luser, oldp)
conn.modify(luser, [replace])</pre></div></div></div></div><div class=paragraph><p>Apesar de não ter a garantia de estar livre de falhas de segurança (a senha é mantida na memória, por exemplo), isso é mais limpo e mais flexível do que um simples script <code>sh</code>.</p></div></div></div></div><div class=sect1><h2 id=secure>4. Considerações de segurança<a class=anchor href=#secure></a></h2><div class=sectionbody><div class=paragraph><p>Agora que suas máquinas (e possivelmente outros serviços) estão autenticando em seu servidor LDAP, este servidor precisa ser protegido pelo menos tão bem quanto <span class=filename>/etc/master.passwd</span> seria em um servidor regular, e possivelmente mais ainda, uma vez que um servidor LDAP corrompido quebraria todos os serviços do cliente.</p></div><div class=paragraph><p>Lembre-se, esta seção não é exaustiva. Você deve revisar continuamente sua configuração e procedimentos para melhorias.</p></div><div class=sect2><h3 id=secure-readonly>4.1. Definindo atributos somente leitura<a class=anchor href=#secure-readonly></a></h3><div class=paragraph><p>Vários atributos no LDAP devem ser somente leitura. Se deixado gravável pelo usuário, por exemplo, um usuário poderia alterar seu atributo <code>uidNumber</code> para <code>0</code> e obter acesso ao <code>root</code>!</p></div><div class=paragraph><p>Para começar, o atributo <code>userPassword</code> não deve ser legível por todos. Por padrão, qualquer pessoa que possa se conectar ao servidor LDAP pode ler esse atributo. Para desabilitar isso, coloque o seguinte em <span class=filename>slapd.conf</span>:</p></div><div id=hide-userpass class=exampleblock><div class=title>Exemplo 8. Ocultar senhas</div><div class=content><div class="literalblock programlisting"><div class=content><pre>access to dn.subtree=&#34;ou=people,dc=example,dc=org&#34;
  attrs=userPassword
  by self write
  by anonymous auth
  by * none

access to *
  by self write
  by * read</pre></div></div></div></div><div class=paragraph><p>Isso não permitirá a leitura do atributo <code>userPassword</code>, enquanto ainda permite que os usuários alterem suas próprias senhas.</p></div><div class=paragraph><p>Além disso, você desejará impedir que os usuários alterem alguns de seus próprios atributos. Por padrão, os usuários podem alterar qualquer atributo (exceto aqueles que os próprios esquemas LDAP negam alterações), como <code>uidNumber</code>. Para fechar este buraco, modifique o acima para</p></div><div id=attrib-readonly class=exampleblock><div class=title>Exemplo 9. Atributos somente leitura</div><div class=content><div class="literalblock programlisting"><div class=content><pre>access to dn.subtree=&#34;ou=people,dc=example,dc=org&#34;
  attrs=userPassword
  by self write
  by anonymous auth
  by * none

access to attrs=homeDirectory,uidNumber,gidNumber
  by * read

access to *
  by self write
  by * read</pre></div></div></div></div><div class=paragraph><p>Isso impedirá que os usuários se disfarçam como outros usuários.</p></div></div><div class=sect2><h3 id=secure-root>4.2. Definição da conta <code>root</code><a class=anchor href=#secure-root></a></h3><div class=paragraph><p>Geralmente, a conta <code>root</code> ou a conta de administrador para o serviço LDAP será definida no arquivo de configuração. O OpenLDAP suporta isso, por exemplo, e funciona, mas pode causar problemas se o <span class=filename>slapd.conf</span> estiver comprometido. Pode ser melhor usar isto apenas para se autoinicializar no LDAP, e então definir uma conta <code>root</code>.</p></div><div class=paragraph><p>Melhor ainda é definir contas com permissões limitadas e omitir totalmente uma conta <code>root</code>. Por exemplo, os usuários que podem adicionar ou remover contas de usuário são adicionados a um grupo, mas não podem alterar a participação desse grupo. Essa política de segurança ajudaria a mitigar os efeitos de uma senha perdida.</p></div><div class=sect3><h4 id=manager-acct>4.2.1. Criando um grupo de gerenciamento<a class=anchor href=#manager-acct></a></h4><div class=paragraph><p>Digamos que você queira que seu departamento de TI possa alterar os diretórios pessoais dos usuários, mas não deseja que todos eles possam adicionar ou remover usuários. A maneira de fazer isso é adicionar um grupo para esses administradores:</p></div><div id=manager-acct-dn class=exampleblock><div class=title>Exemplo 10. Criando um grupo de gerenciamento</div><div class=content><div class="literalblock programlisting"><div class=content><pre>dn: cn=homemanagement,dc=example,dc=org
objectClass: top
objectClass: posixGroup
cn: homemanagement
gidNumber: 121 # required for posixGroup
memberUid: uid=tuser,ou=people,dc=example,dc=org
memberUid: uid=user2,ou=people,dc=example,dc=org</pre></div></div></div></div><div class=paragraph><p>E então mude os atributos de permissões em <span class=filename>slapd.conf</span>:</p></div><div id=management-acct-acl class=exampleblock><div class=title>Exemplo 11. ACLs para um grupo de gerenciamento de diretório inicial</div><div class=content><div class="literalblock programlisting"><div class=content><pre>access to dn.subtree=&#34;ou=people,dc=example,dc=org&#34;
  attr=homeDirectory
  by dn=&#34;cn=homemanagement,dc=example,dc=org&#34;
  dnattr=memberUid write</pre></div></div></div></div><div class=paragraph><p>Agora <code>tuser</code> e <code>user2</code> podem alterar os diretórios home de outros usuários.</p></div><div class=paragraph><p>Neste exemplo, demos um subconjunto de poder administrativo a certos usuários sem dar a eles poder em outros domínios. A idéia é que em breve nenhuma conta de usuário tenha o poder de uma conta <code>root</code>, mas todo poder que root tem seja tido por pelo menos um usuário. A conta <code>root</code> torna-se desnecessária e pode ser removida.</p></div></div></div><div class=sect2><h3 id=security-passwd>4.3. Armazenamento de Senha<a class=anchor href=#security-passwd></a></h3><div class=paragraph><p>Por padrão, OpenLDAP armazenará o valor do atributo <code>userPassword</code> conforme ele armazena quaisquer outros dados: puro texto. Na maioria das vezes, ele é codificado na base 64, o que fornece proteção suficiente para impedir que um administrador honesto conheça sua senha, mas pouco ainda.</p></div><div class=paragraph><p>É uma boa idéia, então, armazenar senhas em um formato mais seguro, como o SSHA (salted SHA). Isso é feito por qualquer programa que você use para alterar as senhas dos usuários.</p></div></div></div></div><div class=sect1><h2 id=useful>Apêndice A: Ajudas Úteis<a class=anchor href=#useful></a></h2><div class=sectionbody><div class=paragraph><p>Existem alguns outros programas que podem ser úteis, especialmente se você tiver muitos usuários e não quiser configurar tudo manualmente.</p></div><div class=paragraph><p>O <a class=package href=https://cgit.freebsd.org/ports/tree/security/pam_mkhomedir/>security/pam_mkhomedir</a> é um módulo PAM que sempre é bem-sucedido; Sua finalidade é criar diretórios pessoais para usuários que não os possuem. Se você tiver dezenas de servidores clientes e centenas de usuários, é muito mais fácil usar isso e configurar diretórios esqueletos do que preparar cada diretório inicial.</p></div><div class=paragraph><p>O <a class=package href=https://cgit.freebsd.org/ports/tree/sysutils/cpu/>sysutils/cpu</a> é um utilitário do tipo <a href="https://man.freebsd.org/cgi/man.cgi?query=pw&amp;sektion=8&amp;format=html">pw(8)</a> que pode ser usado para gerenciar usuários no diretório LDAP. Você pode chamá-lo diretamente ou encapsular os scripts em torno dele. Ele pode manipular tanto o TLS (com o sinalizador <code>-x</code>) quanto o SSL (diretamente).</p></div><div class=paragraph><p>O <a class=package href=https://cgit.freebsd.org/ports/tree/sysutils/ldapvi/>sysutils/ldapvi</a> é um ótimo utilitário para editar valores LDAP em uma sintaxe semelhante a LDIF. O diretório (ou subseção do diretório) é apresentado no editor escolhido pela variável de ambiente <code>EDITOR</code>. Isso facilita a ativação de alterações em grande escala no diretório sem a necessidade de escrever uma ferramenta personalizada.</p></div><div class=paragraph><p>O <a class=package href=https://cgit.freebsd.org/ports/tree/security/openssh-portable/>security/openssh-portable</a> tem a capacidade de contatar um servidor LDAP para verificar as chaves SSH. Isso é extremamente bom se você tiver muitos servidores e não quiser copiar suas chaves públicas em todos eles.</p></div></div></div><div class=sect1><h2 id=ssl-ca>Apêndice B: Certificados OpenSSL para o LDAP<a class=anchor href=#ssl-ca></a></h2><div class=sectionbody><div class=paragraph><p>Se você estiver hospedando dois ou mais servidores LDAP, provavelmente não desejará usar certificados auto-assinados, já que cada cliente precisará ser configurado para trabalhar com cada certificado. Embora isso seja possível, não é tão simples quanto criar sua própria autoridade de certificação e assinar os certificados de seus servidores com isso.</p></div><div class=paragraph><p>Os passos aqui são apresentados como eles são, com muito pouca tentativa de explicar o que está acontecendo - mais explicações podem ser encontradas em <a href="https://man.freebsd.org/cgi/man.cgi?query=openssl&amp;sektion=1&amp;format=html">openssl(1)</a> e aplicações iguais.</p></div><div class=paragraph><p>Para criar uma autoridade de certificação, simplesmente precisamos de um certificado e chave auto-assinados. As etapas para isso novamente são</p></div><div id=make-cert class=exampleblock><div class=title>Exemplo 12. Criando um Certificado</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% openssl genrsa <span class=nt>-out</span> root.key 1024
% openssl req <span class=nt>-new</span> <span class=nt>-key</span> root.key <span class=nt>-out</span> root.csr
% openssl x509 <span class=nt>-req</span> <span class=nt>-days</span> 1024 <span class=nt>-in</span> root.csr <span class=nt>-signkey</span> root.key <span class=nt>-out</span> root.crt</code></pre></div></div></div></div><div class=paragraph><p>Estas serão sua chave e certificado de CA raiz. Você provavelmente desejará criptografar a chave e armazená-la em um local seguro; qualquer pessoa com acesso a ele pode se passar por um dos seus servidores LDAP.</p></div><div class=paragraph><p>Em seguida, usando as duas primeiras etapas acima, crie uma chave <span class=filename>ldap-server-one.key</span> e a solicitação de assinatura de certificado <span class=filename>ldap-server-one.csr</span>. Depois de assinar o pedido de assinatura com <span class=filename>root.key</span>, você poderá usar o <span class=filename>ldap-server-one.*</span> nos servidores LDAP.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Não se esqueça de usar o nome de domínio totalmente qualificado para o atributo "common name" ao gerar a solicitação de assinatura de certificado; caso contrário, os clientes rejeitarão uma conexão com você e poderá ser muito complicado diagnosticar.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Para assinar a chave, use <code>-CA</code> e <code>-CAkey</code> em vez de <code>-signkey</code>:</p></div><div id=ca-sign class=exampleblock><div class=title>Exemplo 13. Assinando como uma autoridade de certificação</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% openssl x509 <span class=nt>-req</span> <span class=nt>-days</span> 1024 <span class=se>\</span>
<span class=nt>-in</span> ldap-server-one.csr <span class=nt>-CA</span> root.crt <span class=nt>-CAkey</span> root.key <span class=se>\</span>
<span class=nt>-out</span> ldap-server-one.crt</code></pre></div></div></div></div><div class=paragraph><p>O arquivo resultante será o certificado que você pode usar em seus servidores LDAP.</p></div><div class=paragraph><p>Finalmente, para os clientes confiarem em todos os seus servidores, distribua <span class=filename>root.crt</span> (o <em>certificado</em>, não a chave!) para cada cliente, e especifique-o na directiva <code>TLSCACertificateFile</code> no <span class=filename>ldap.conf</span>.</p></div></div></div><hr><div class=last-modified><p><strong>Última alteração em</strong>: 6 de fevereiro de 2022 por <a href="https://cgit.freebsd.org/doc/commit/?id=097e4bb3cd" target=_blank>Danilo G. Baio</a></p></div></div><aside class=toc><div class=toc-content><h3>Índice</h3><nav id=TableOfContents><ul><li><a href=#preface>1. Prefácio</a></li><li><a href=#ldap>2. Configurando o LDAP</a></li><li><a href=#client>3. Configuração do Cliente</a></li><li><a href=#secure>4. Considerações de segurança</a></li><li><a href=#useful>Apêndice A: Ajudas Úteis</a></li><li><a href=#ssl-ca>Apêndice B: Certificados OpenSSL para o LDAP</a></li></ul></nav><hr><div class=resources><h3>Recursos</h3><ul class=contents><li><i class="fa fa-file-pdf-o" aria-hidden=true title="Download PDF"></i><a href=https://download.freebsd.org/doc/pt-br/articles/ldap-auth/ldap-auth_pt-br.pdf>Download PDF</a></li><li><i class="fa fa-pencil-square-o" aria-hidden=true title="Edite essa página"></i><a href=https://github.com/freebsd/freebsd-doc/blob/main/documentation/content/pt-br/_index target=_blank>Edite essa página</a></li></ul></div></div></aside></main><footer><div class=footer-container><section class=logo-column><img src=http://172.16.201.134:1313/images/FreeBSD-colors.svg width=160 height=50 alt="FreeBSD logo"><div class=options-container><div class=language-container><a id=languages href=http://172.16.201.134:1313/pt-br/languages><img src=http://172.16.201.134:1313/images/language.png class=language-image alt="Escolha o idioma">
<span>Brazilian Portuguese</span></a></div><div class=theme-container><select id=theme-chooser><option value=theme-system>System</option><option value=theme-light>Light</option><option value=theme-dark>Dark</option><option value=theme-high-contrast>Alto contraste</option></select></div></div></section><section class=about-column><h3 class=column-title>About</h3><ul class=column-elements-container><li><a href=https://www.freebsd.org/about/ target=_blank class=column-element>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/ target=_blank class=column-element>FreeBSD Foundation</a></li><li><a href=https://www.freebsd.org/where/ target=_blank class=column-element>Get FreeBSD</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct target=_blank class=column-element>Code of Conduct</a></li><li><a href=https://www.freebsd.org/security/ target=_blank class=column-element>Security Advisories</a></li></ul></section><section class=documentation-column><h3 class=column-title>Documentation</h3><ul class=column-elements-container><li><a href=/pt-br class=column-element>Documentation portal</a></li><li><a href=https://man.FreeBSD.org target=_blank class=column-element>Manual pages</a></li><li><a href=https://papers.FreeBSD.org target=_blank class=column-element>Presentations and papers</a></li><li><a href=https://docs-archive.freebsd.org/doc/ target=_blank class=column-element>Previous versions</a></li><li><a href=https://docs-archive.freebsd.org/44doc/ target=_blank class=column-element>4.4BSD Documents</a></li><li><a href=https://wiki.freebsd.org/ target=_blank class=column-element>Wiki</a></li></ul></section><section class=community-column><h3 class=column-title>Community</h3><ul class=column-elements-container><li><a href=http://172.16.201.134:1313/pt-br/articles/contributing class=column-element>Get involved</a></li><li><a href=https://forums.freebsd.org/ target=_blank class=column-element>Community forum</a></li><li><a href=https://lists.freebsd.org/ target=_blank class=column-element>Mailing lists</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank class=column-element>IRC Channels</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank class=column-element>Bug Tracker</a></li></ul></section><section class=legal-column><h3 class=column-title>Legal</h3><ul class=column-elements-container><li><a href=https://freebsdfoundation.org/donate/ target=_blank class=column-element>Donations</a></li><li><a href=https://www.freebsd.org/copyright/freebsd-license/ target=_blank class=column-element>Licensing</a></li><li><a href=https://www.freebsd.org/privacy/ target=_blank class=column-element>Privacy Policy</a></li><li><a href=https://www.freebsd.org/copyright/ target=_blank class=column-element>Legal notices</a></li></ul></section><section class=copyright-column><p>&copy; 1994-2024 The FreeBSD Project. All rights reserved</p><span>Made with <span class=heart>♥</span> by the FreeBSD Community</span></section></div></footer></body></html>