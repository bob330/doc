<!doctype html><html class=theme-light lang=pt-br><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="O uso de dispositivos de disco de estado sólido no FreeBSD"><meta name=keywords content="Solid State,embedded,FreeBSD"><meta name=copyright content="1995-2024 The FreeBSD Foundation"><link rel=canonical href=http://172.16.201.134:1313/pt-br/articles/solid-state/><title>FreeBSD e Dispositivos de Estado Sólido | FreeBSD Documentation Portal</title>
<meta name=theme-color content="#790000"><meta name=color-scheme content="system light dark high-contrast"><link rel="shortcut icon" href=http://172.16.201.134:1313/favicon.ico><link rel=stylesheet href=http://172.16.201.134:1313/styles/main.min.css><link rel=stylesheet href=http://172.16.201.134:1313/css/font-awesome-min.css><script defer src=/js/theme-chooser.min.js></script><script defer src=/js/copy-clipboard.min.js></script><script defer src=/js/search.min.js></script><meta name=twitter:card content="summary"><meta name=twitter:domain content="docs.FreeBSD.org"><meta name=twitter:site content="@freebsd"><meta name=twitter:url content="https://twitter.com/freebsd"><meta property="og:title" content="FreeBSD e Dispositivos de Estado Sólido"><meta property="og:description" content="O uso de dispositivos de disco de estado sólido no FreeBSD"><meta property="og:type" content="website"><meta property="og:image" content="http://172.16.201.134:1313/favicon.ico"><meta property="og:image:alt" content="FreeBSD Logo"><meta property="og:locale" content="pt-br"><meta property="og:url" content="http://172.16.201.134:1313/pt-br/articles/solid-state/"><meta property="og:site_name" content="FreeBSD Documentation Portal"><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","url":"http:\/\/172.16.201.134:1313\/pt-br\/articles\/solid-state\/","name":"FreeBSD Documentation Portal","headline":"FreeBSD Documentation Portal","description":"FreeBSD Documentation Portal"}</script></head><body><header><div class=header-container><div class=logo-menu-bars-container><a href=https://www.FreeBSD.org class=logo><img src=http://172.16.201.134:1313/images/FreeBSD-monochromatic.svg width=160 height=50 alt="FreeBSD logo">
</a><label class=menu-bars for=menu-bars><i class="fa fa-bars" aria-hidden=true></i></label></div><input id=menu-bars type=checkbox><nav><ul class=menu><li class=menu-item><input id=about type=checkbox>
<a href=# aria-label="Navigate to About section"><label class=menu-item-description for=about>About
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/about/ target=_blank>About</a></li><li><a href=https://www.freebsd.org/about/ target=_blank>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/about-us/about-the-foundation/ target=_blank>FreeBSD Foundation</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct/ target=_blank>Code of Conduct</a></li></ul></li><li class=menu-item><input id=download type=checkbox>
<a href=# aria-label="Navigate to get FreeBSD section"><label class=menu-item-description for=download>Get FreeBSD
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/where/ target=_blank>Get FreeBSD</a></li><li><a href=https://www.freebsd.org/releases/ target=_blank>Release Information</a></li><li><a href=https://www.freebsd.org/releng/ target=_blank>Release Engineering</a></li><li><a href=https://www.freebsd.org/security/ target=_blank>Security Advisories</a></li></ul></li><li class=menu-item><input id=documentation type=checkbox>
<a href=# aria-label="Navigate to get Documentation section"><label class=menu-item-description for=documentation>Documentation
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=/pt-br>Documentation portal</a></li><li><a href=http://172.16.201.134:1313/pt-br/books/handbook>FreeBSD Handbook</a></li><li><a href=http://172.16.201.134:1313/pt-br/books/porters-handbook>Porter's Handbook</a></li><li><a href=https://docs.FreeBSD.org/en/books/fdp-primer>Documentation Project Handbook</a></li><li><a href=https://man.FreeBSD.org target=_blank>Manual pages</a></li><li><a href=https://papers.FreeBSD.org target=_blank>Presentations and papers</a></li><li><a href=https://wiki.FreeBSD.org target=_blank>Wiki</a></li><li><a href=http://172.16.201.134:1313/pt-br/books>Books</a></li><li><a href=http://172.16.201.134:1313/pt-br/articles>Articles</a></li></ul></li><li class=menu-item><input id=community type=checkbox>
<a href=# aria-label="Navigate to get Community section"><label class=menu-item-description for=community>Community
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/community/>Community</a></li><li><a href=http://172.16.201.134:1313/pt-br/articles/contributing>Get involved</a></li><li><a href=https://forums.freebsd.org/ target=_blank>Forum</a></li><li><a href=https://lists.freebsd.org/ target=_blank>Mailing lists</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank>IRC Channels</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank>Bug Tracker</a></li><li><a href=https://www.freebsd.org/support/ target=_blank>Support</a></li></ul></li></ul></nav><div class=search-donate-container><form class=search method=get id=search-header-form action=https://docs.freebsd.org/search name=search-header-form><input type=hidden name=DB value=pt-br>
<input id=words name=P type=text size=20 maxlength=255>
<button>
<i class="fa fa-search" aria-hidden=true></i></button></form><div class=donate><a href=https://freebsdfoundation.org/donate/ target=_blank><span class=heart>♥</span>
Donate</a></div></div></div></header><main class=main-wrapper-article><div class=article><h1 class=title>FreeBSD e Dispositivos de Estado Sólido</h1><div class="admonitionblock note"><p><i class="fa fa-exclamation-circle" aria-hidden=true></i>
Esta tradução pode estar desatualizada. Para ajudar com as traduções, acesse a <a href=https://translate-dev.freebsd.org/ target=_blank>ferramenta de traduções do FreeBSD</a>.</p></div><div class=copyright>Copyright © 2001 - 2021 The FreeBSD Documentation Project</div><div class=legalnotice><a id=trademarks></a><details><summary>trademarks</summary><p>FreeBSD is a registered trademark of the FreeBSD Foundation.</p><p>Many of the designations used by manufacturers and sellers to distinguish their products are claimed as trademarks. Where those designations appear in this document, and the FreeBSD Project was aware of the trademark claim, the designations have been followed by the “™” or the “®” symbol.</p></details></div><div class=toc-mobile><h3>Índice</h3><nav id=TableOfContents><ul><li><a href=#intro>1. Dispositivos de Disco de Estado Sólido</a></li><li><a href=#kernel>2. Opções do Kernel</a></li><li><a href=#ro-fs>3. O Subsistema <code>rc</code> e Sistemas de ArquivosRead-Only</a></li><li><a href=#_construindo_um_sistema_de_arquivos_a_partir_do_zero>4. Construindo um sistema de arquivos a partir do zero</a></li><li><a href=#strategies>5. Estratégias do Sistema para Ambientes Pequenos e Read-Only</a></li></ul></nav></div><div id=preamble><div class=sectionbody><div class="paragraph abstract-title"><p>Resumo</p></div><div class=paragraph><p>Este artigo aborda o uso de dispositivos de disco de estado sólido no FreeBSD para criar sistemas embarcados.</p></div><div class=paragraph><p>Os sistemas embarcados têm a vantagem de maior estabilidade devido à falta de partes móveis integradas (discos rígidos). No entanto, é preciso levar em conta o espaço disponível no sistema que geralmente é baixo e a durabilidade do meio de armazenamento.</p></div><div class=paragraph><p>Tópicos específicos a serem abordados incluem os tipos e atributos das mídia de estado sólido adequadas para uso como disco no FreeBSD, opções de kernel que são de interesse em tal ambiente, os mecanismos <span class=filename>rc.initdiskless</span> que automatizam a inicialização de tais sistemas e a necessidade de sistemas de arquivos read-only e a construção de sistemas de arquivos a partir do zero. O artigo será concluído com algumas estratégias gerais para ambientes FreeBSD pequenos e read-only .</p></div><hr></div></div><div class=sect1><h2 id=intro>1. Dispositivos de Disco de Estado Sólido<a class=anchor href=#intro></a></h2><div class=sectionbody><div class=paragraph><p>O escopo deste artigo será limitado a dispositivos de disco de estado sólido feitos de memória flash. A memória flash é uma memória de estado sólido (sem partes móveis) que é não volátil (a memória mantém os dados mesmo depois de todas as fontes de energia terem sido desconectadas). A memória flash pode suportar um enorme choque físico e é razoavelmente rápida (as soluções de memória flash abordadas neste artigo são um pouco mais lentas que um disco rígido EIDE para operações de gravação e muito mais rápidas para operações de leitura). Um aspecto muito importante da memória flash, cujas ramificações serão discutidas mais adiante neste artigo, é que cada setor tem uma capacidade limitada de reescrita. Você só pode gravar, apagar e gravar novamente em um setor de memória flash um certo número de vezes antes que o setor fique permanentemente inutilizável. Embora muitos produtos de memória flash mapeiam automaticamente os blocos defeituosos, e embora alguns até distribuam operações de gravação uniformemente por toda a unidade, a verdade é que existe um limite para a quantidade de escrita que pode ser feita no dispositivo. Unidades competitivas possuem entre 1.000.000 e 10.000.000 gravações por setor em suas especificações. Este valor varia com à temperatura do ambiente.</p></div><div class=paragraph><p>Especificamente, estaremos discutindo unidades compact-flash compatíveis com ATA, as quais são bastante populares como mídia de armazenamento para câmeras digitais. De particular interesse é o fato de que eles são fixados diretamente no barramento IDE e são compatíveis com o conjunto de comandos ATA. Portanto, com um adaptador muito simples e de baixo custo, esses dispositivos podem ser conectados diretamente a um barramento IDE em um computador. Uma vez implementado desta maneira, sistemas operacionais como o FreeBSD vêem o dispositivo como um disco rígido normal (embora pequeno).</p></div><div class=paragraph><p>Outras soluções de disco de estado sólido existem, mas seu custo, obscuridade e relativa dificuldade de uso os colocam além do escopo deste artigo.</p></div></div></div><div class=sect1><h2 id=kernel>2. Opções do Kernel<a class=anchor href=#kernel></a></h2><div class=sectionbody><div class=paragraph><p>Algumas opções do kernel são de interesse específico para aqueles que criam sistemas FreeBSD embarcados.</p></div><div class=paragraph><p>Todos os sistemas FreeBSD embarcados que utilizam memória flash como disco do sistema terão interesse em discos em memória e sistemas de arquivos em memória. Devido ao número limitado de gravações que podem ser feitas na memória flash, o disco e os sistemas de arquivos no disco provavelmente serão montados como read-only. Nesse ambiente, sistemas de arquivos como <span class=filename>/tmp</span> e <span class=filename>/var</span> são montados como sistemas de arquivos em memória para permitir que o sistema crie logs e atualize contadores e arquivos temporários. Sistemas de arquivos em memória são um componente crítico para uma implementação bem-sucedida do FreeBSD usandp discos de estado sólido.</p></div><div class=paragraph><p>Você deve ter certeza de que as seguintes linhas existem no seu arquivo de configuração do kernel:</p></div><div class="literalblock programlisting"><div class=content><pre>options         MFS             # Memory Filesystem
options         MD_ROOT         # md device usable as a potential root device
pseudo-device   md              # memory disk</pre></div></div></div></div><div class=sect1><h2 id=ro-fs>3. O Subsistema <code>rc</code> e Sistemas de ArquivosRead-Only<a class=anchor href=#ro-fs></a></h2><div class=sectionbody><div class=paragraph><p>A inicialização pós-boot de um sistema FreeBSD embarcado é controlada por <span class=filename>/etc/rc.initdiskless</span>.</p></div><div class=paragraph><p>O <span class=filename>/etc/rc.d/var</span> monta o <span class=filename>/var</span> como um sistema de arquivos em memória, cria uma lista configurável de diretórios em <span class=filename>/var</span> com o comando <a href="https://man.freebsd.org/cgi/man.cgi?query=mkdir&amp;sektion=1&amp;format=html">mkdir(1)</a> e altera modos em alguns desses diretórios. Na execução do <span class=filename>/etc/rc.d/var</span>, outra variável <span class=filename>rc.conf</span> entra em ação - <code>varsize</code>. Uma partição <span class=filename>/var</span> é criada por <span class=filename>/etc/rc.d/var</span> com base no valor dessa variável em <span class=filename>rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>varsize=8192</pre></div></div><div class=paragraph><p>Lembre-se de que esse valor é informado em setores, por padrão.</p></div><div class=paragraph><p>O fato do <span class=filename>/var</span> ser um sistema de arquivos read-write é uma distinção importante, pois a partição <span class=filename>/</span> (e quaisquer outras partições que você possa ter em sua mídia flash) deve ser montada como read-only. Lembre-se que em <a href=#intro>Dispositivos de Disco de Estado Sólido</a> detalhamos as limitações da memória flash - especificamente a capacidade de gravação limitada. A importância de não montar sistemas de arquivos em mídia flash em modo read-write, e a importância de não usar um arquivo de swap, não pode ser exagerado. Um arquivo de swap em um sistema ocupado pode inutilizar uma mídia flash em menos de um ano. Criação de log pesado ou criação e destruição de arquivos temporários podem fazer o mesmo. Portanto, além de remover a entrada <code>swap</code> do seu <span class=filename>/etc/fstab</span>, você também deve alterar o campo Options para cada sistema de arquivos para <code>ro</code> como segue:</p></div><div class="literalblock programlisting"><div class=content><pre># Device                Mountpoint      FStype  Options         Dump    Pass#
/dev/ad0s1a             /               ufs     ro              1       1</pre></div></div><div class=paragraph><p>Alguns aplicativos no sistema começarão a falhar imediatamente como resultado desta alteração. Por exemplo, o cron não será executado corretamente como resultado da falta de crontabs no <span class=filename>/var</span> criado pelo <span class=filename>/etc/rc.d/var</span>, o syslog e o dhcp também irão encontrar problemas como resultado do sistema de arquivos estar em modo read-only e dos itens ausentes no <span class=filename>/var</span> que o <span class=filename>/etc/rc.d/var</span> criou. Estes são apenas problemas temporários, embora sejam abordados, juntamente com soluções para a execução de outros pacotes de software comuns em <a href=#strategies>Estratégias do Sistema para Ambientes Pequenos e Read-Only</a>.</p></div><div class=paragraph><p>Uma coisa importante para lembrar é que um sistema de arquivos que foi montado como read-only com o <span class=filename>/etc/fstab</span> pode ser colocado em modo read-write a qualquer momento, executando o comando:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># /sbin/mount -uw partition</span></code></pre></div></div><div class=paragraph><p>e pode ser alternado de volta para read-only com o comando:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># /sbin/mount -ur partition</span></code></pre></div></div></div></div><div class=sect1><h2 id=_construindo_um_sistema_de_arquivos_a_partir_do_zero>4. Construindo um sistema de arquivos a partir do zero<a class=anchor href=#_construindo_um_sistema_de_arquivos_a_partir_do_zero></a></h2><div class=sectionbody><div class=paragraph><p>Como os cartões compact-flash compatíveis com ATA são vistos pelo FreeBSD como discos rígidos IDE normais, você poderia teoricamente instalar o FreeBSD a partir da rede usando os disquetes kern e mfsroot ou a partir de um CD.</p></div><div class=paragraph><p>No entanto, mesmo uma pequena instalação do FreeBSD usando procedimentos normais de instalação pode resultar em um sistema de tamanho superior a 200 megabytes. A maioria das pessoas estará usando dispositivos de memória flash menores (128 megabytes é considerado bastante grande - 32 ou até 16 megabytes são comuns), então uma instalação usando mecanismos normais não é possível - simplesmente não há espaço em disco suficiente nem mesmo para a menor das instalações convencionais.</p></div><div class=paragraph><p>A maneira mais fácil de superar essa limitação de espaço é instalar o FreeBSD usando meios convencionais em um disco rígido normal. Após a conclusão da instalação, reduza o sistema operacional para um tamanho que caiba na mídia flash e compacte o sistema de arquivos inteiro com o tar. Os passos seguintes irão guiá-lo através do processo de preparação de uma parte da memória flash para o seu sistema de arquivos compactado com o tar. Lembre-se de que não estamos executando uma instalação normal, logo as operações como particionamento, criação dos labels, criação do sistema de arquivos, etc. precisam ser executadas manualmente. Além dos disquetes do kern e mfsroot, você também precisará usar o disquete do fixit.</p></div><div class="exampleblock procedure"><div class=content><div class="olist arabic"><ol class=arabic><li><p>Particionando seu Dispositivo de Mídia Flash</p><div class=paragraph><p>Após inicializar com os disquetes kern e mfsroot, escolha <code>custom</code> no menu de instalação. No menu de instalação personalizada, escolha <code>partition</code>. No menu de partição, você deve excluir todas as partições existentes usando <kbd>d</kbd>. Após excluir todas as partições existentes, crie uma partição usando <kbd>c</kbd> e aceite o valor padrão para o tamanho da partição. Quando questionado sobre o tipo da partição, certifique-se de que o valor esteja definido como <code>165</code>. Agora, escreva essa tabela de partição no disco pressionando <kbd>w</kbd> (esta é uma opção oculta nesta tela). Se você estiver usando um cartão compact flash compatível com ATA, escolha o Gerenciador de Inicialização do FreeBSD. Agora pressione <kbd>q</kbd> para sair do menu de partição. O menu do gerenciador de inicialização será exibido novamente - repita a escolha que fez anteriormente.</p></div></li><li><p>Criando Sistemas de Arquivos em seu Dispositivo de Memória Flash</p><div class=paragraph><p>Saia do menu de instalação personalizada e, no menu principal de instalação, escolha a opção <code>fixit</code>. Depois de entrar no ambiente fixit, insira o seguinte comando:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># disklabel -e /dev/ad0c</span></code></pre></div></div><div class=paragraph><p>Neste ponto, você terá entrado no editor vi sob os auspícios do comando disklabel. Em seguida, você precisa adicionar uma linha <code>a:</code> no final do arquivo. Esta linha <code>a:</code> deve ser semelhante a linha abaixo:</p></div><div class="literalblock programlisting"><div class=content><pre>a:      123456  0       4.2BSD  0       0</pre></div></div><div class=paragraph><p>Onde <em>123456</em> é um número exatamente igual ao número na entrada <code>c:</code> existente para o tamanho. Basicamente, você está duplicando a linha <code>c:</code> existente como uma linha <code>a:</code>, certificando-se de que o fstype seja <code>4.2BSD</code>. Salve o arquivo e saia.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># disklabel -B -r /dev/ad0c</span>
<span class=c># newfs /dev/ad0a</span></code></pre></div></div></li><li><p>Colocando seu Sistema de Arquivos na Mídia Flash</p><div class=paragraph><p>Monte a mídia flash recém-preparada:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mount /dev/ad0a /flash</span></code></pre></div></div><div class=paragraph><p>Coloque esta máquina na rede para que possamos transferir nosso arquivo tar e extrai-lo em nosso sistema de arquivos de mídia flash. Um exemplo de como fazer isso é:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig xl0 192.168.0.10 netmask 255.255.255.0</span>
<span class=c># route add default 192.168.0.1</span></code></pre></div></div><div class=paragraph><p>Agora que a máquina está na rede, transfira seu arquivo tar. Você pode se deparar com um pequeno dilema neste ponto - se a sua memória flash tiver por exemplo 128 megabytes, e seu arquivo tar for maior que 64 megabytes, você não poderá ter o seu arquivo tar na mídia flash ao mesmo tempo em que realiza a descompressão - você ficará sem espaço. Uma solução para esse problema, se você estiver usando FTP, é descompactar o arquivo enquanto ele é transferido por FTP. Se você realizar sua transferência desta maneira, você nunca terá o arquivo tar e o conteúdo do tar em seu disco ao mesmo tempo:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>ftp&gt; get tarfile.tar <span class=s2>&#34;| tar xvf -&#34;</span></code></pre></div></div><div class=paragraph><p>Se o seu arquivo tar estiver gzipado, você pode fazer isso também:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>ftp&gt; get tarfile.tar <span class=s2>&#34;| zcat | tar xvf -&#34;</span></code></pre></div></div><div class=paragraph><p>Depois que o conteúdo do seu sistema de arquivos compactado pelo tar estiver no sistema de arquivos da sua memória flash, você poderá desmontar a memória flash e reinicializar:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /</span>
<span class=c># umount /flash</span>
<span class=c># exit</span></code></pre></div></div><div class=paragraph><p>Assumindo que você configurou seu sistema de arquivos corretamente quando ele foi construído no disco rígido normal (com seus sistemas de arquivos montado como read-only, e com as opções necessárias compiladas no kernel) você agora deve inicializar com sucesso seu sistema embarcado FreeBSD.</p></div></li></ol></div></div></div></div></div><div class=sect1><h2 id=strategies>5. Estratégias do Sistema para Ambientes Pequenos e Read-Only<a class=anchor href=#strategies></a></h2><div class=sectionbody><div class=paragraph><p>Em <a href=#ro-fs>O Subsistema <code>rc</code> e Sistemas de ArquivosRead-Only</a>, foi apontado que o sistema de arquivos <span class=filename>/var</span> construído pelo <span class=filename>/etc/rc.d/var</span> e a presença de um sistema de arquivos raiz read-only causa problemas com muitos pacotes de software comuns usados com o FreeBSD. Neste artigo, serão fornecidas sugestões para a execução bem-sucedida do cron, do syslog, instalações de ports e do servidor Web Apache.</p></div><div class=sect2><h3 id=_cron>5.1. Cron<a class=anchor href=#_cron></a></h3><div class=paragraph><p>Ao inicializar, o <span class=filename>/var</span> é preenchido por <span class=filename>/etc/rc.d/var</span> usando a lista de <span class=filename>/etc/mtree/BSD.var.dist</span>, então os diretórios <span class=filename>cron</span>, <span class=filename>cron/tabs</span>, <span class=filename>at</span> e alguns outros diretórios padrões são criados.</p></div><div class=paragraph><p>No entanto, isso não resolve o problema de manter as crontabs entre nas reinicializações. Quando o sistema for reinicializado, o sistema de arquivos <span class=filename>/var</span> que está na memória desaparecerá e todas as crontabs que você tenha nele também desaparecerão. Portanto, uma solução seria criar crontabs para os usuários que precisam delas, montar seu sistema de arquivos <span class=filename>/</span> como read-write e copiar estas crontabs para algum lugar seguro, como <span class=filename>/etc/tabs</span>, em seguida, adicione uma linha ao final do <span class=filename>/etc/rc.initdiskless</span> que copie estes crontabs para <span class=filename>/var/cron/tabs</span> depois que o diretório for criado durante inicialização do sistema. Você também pode precisar adicionar uma linha que altere modos e permissões nos diretórios criados e nos arquivos copiados com <span class=filename>/etc/rc.initdiskless</span>.</p></div></div><div class=sect2><h3 id=_syslog>5.2. Syslog<a class=anchor href=#_syslog></a></h3><div class=paragraph><p>O <span class=filename>syslog.conf</span> especifica os locais de certos arquivos de log que existem em <span class=filename>/var/log</span>. Esses arquivos não são criados pelo <span class=filename>/etc/rc.d/var</span> na inicialização do sistema. Portanto, em algum lugar do <span class=filename>/etc/rc.d/var</span>, logo após a seção que cria os diretórios em <span class=filename>/var</span>, você precisará adicionar algo como isto:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># touch /var/log/security /var/log/maillog /var/log/cron /var/log/messages</span>
<span class=c># chmod 0644 /var/log/*</span></code></pre></div></div></div><div class=sect2><h3 id=_instalação_de_ports>5.3. Instalação de Ports<a class=anchor href=#_instalação_de_ports></a></h3><div class=paragraph><p>Antes de discutir as alterações necessárias para usar com êxito a árvore de ports, é necessário um lembrete sobre a natureza read-only dos seus sistemas de arquivos na mídia flash. Como eles são read-only, você precisará montá-los temporariamente para read-write usando a sintaxe de montagem mostrada em <a href=#ro-fs>O Subsistema <code>rc</code> e Sistemas de ArquivosRead-Only</a>. Você sempre deve remontar esses sistemas de arquivos no modo read-only quando tiver terminado qualquer manutenção - gravações desnecessárias na mídia flash podem reduzir consideravelmente sua vida útil.</p></div><div class=paragraph><p>Para tornar possível entrar em um diretório do ports e executar com sucesso o comando <code>make install</code>, devemos criar um diretório de pacotes em um sistema de arquivos que não seja de memória e que acompanhe nossos pacotes entre as reinicializações. Como é necessário montar seus sistemas de arquivos como leitura-gravação para a instalação de um pacote de qualquer maneira, é sensato supor que uma área na mídia flash também possa ser usada para gravar informações do pacote.</p></div><div class=paragraph><p>Primeiro, crie o diretório do banco de dados de pacotes. Ele fica normalmente em <span class=filename>/var/db/pkg</span>, mas não podemos colocá-lo lá, pois ele irá desaparecer toda vez que o sistema for inicializado.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mkdir /etc/pkg</span></code></pre></div></div><div class=paragraph><p>Agora, adicione uma linha em <span class=filename>/etc/rc.d/var</span> que vincule o diretório <span class=filename>/etc/pkg</span> a <span class=filename>/var/db/pkg</span>. Um exemplo:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ln -s /etc/pkg /var/db/pkg</span></code></pre></div></div><div class=paragraph><p>Agora, sempre que você montar seus sistemas de arquivos como leitura-gravação e instalar um pacote, o <code>make install</code> funcionará, e as informações do pacote serão gravadas com sucesso em <span class=filename>/etc/pkg</span> (porque o sistema de arquivos estará, naquele momento, montado como leitura-gravação), que sempre estará disponível para o sistema operacional como <span class=filename>/var/db/pkg</span>.</p></div></div><div class=sect2><h3 id=_servidor_web_apache>5.4. Servidor Web Apache<a class=anchor href=#_servidor_web_apache></a></h3><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>As etapas nesta seção são necessárias apenas se o Apache estiver configurado para gravar suas informações de pid ou log fora do <span class=filename>/var</span>. Por padrão, o Apache mantém seu arquivo pid em <span class=filename>/var/run/httpd.pid</span> e seus arquivos de log em <span class=filename>/var/log</span>.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Agora, supõe-se que o Apache mantém seus arquivos de log em um diretório <span class=filename>apache_log_dir</span> fora do <span class=filename>/var</span>. Quando esse diretório está em um sistema de arquivos somente leitura, o Apache não poderá salvar nenhum arquivo de log e pode ter problemas para funcionar. Se for o caso, é necessário adicionar um novo diretório à lista de diretórios em <span class=filename>/etc/rc.d/var</span> para criar em <span class=filename>/var</span> e vincular o <span class=filename>apache_log_dir</span> ao <span class=filename>/var/log/apache</span>. Também é necessário definir as permissões e o proprietário deste novo diretório.</p></div><div class=paragraph><p>Primeiro, adicione o diretório <code>log/apache</code> à lista de diretórios a serem criados em <span class=filename>/etc/rc.d/var</span>.</p></div><div class=paragraph><p>Segundo, adicione estes comandos ao <span class=filename>/etc/rc.d/var</span> após a seção de criação do diretório:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># chmod 0774 /var/log/apache</span>
<span class=c># chown nobody:nobody /var/log/apache</span></code></pre></div></div><div class=paragraph><p>Por fim, remova o diretório existente <span class=filename>apache_log_dir</span> e substitua-o por um link:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># rm -rf apache_log_dir</span>
<span class=c># ln -s /var/log/apache apache_log_dir</span></code></pre></div></div></div></div></div><hr><div class=last-modified><p><strong>Última alteração em</strong>: 29 de abril de 2023 por <a href="https://cgit.freebsd.org/doc/commit/?id=8271c15a1c" target=_blank>Edson Brandi</a></p></div></div><aside class=toc><div class=toc-content><h3>Índice</h3><nav id=TableOfContents><ul><li><a href=#intro>1. Dispositivos de Disco de Estado Sólido</a></li><li><a href=#kernel>2. Opções do Kernel</a></li><li><a href=#ro-fs>3. O Subsistema <code>rc</code> e Sistemas de ArquivosRead-Only</a></li><li><a href=#_construindo_um_sistema_de_arquivos_a_partir_do_zero>4. Construindo um sistema de arquivos a partir do zero</a></li><li><a href=#strategies>5. Estratégias do Sistema para Ambientes Pequenos e Read-Only</a></li></ul></nav><hr><div class=resources><h3>Recursos</h3><ul class=contents><li><i class="fa fa-file-pdf-o" aria-hidden=true title="Download PDF"></i><a href=https://download.freebsd.org/doc/pt-br/articles/solid-state/solid-state_pt-br.pdf>Download PDF</a></li><li><i class="fa fa-pencil-square-o" aria-hidden=true title="Edite essa página"></i><a href=https://github.com/freebsd/freebsd-doc/blob/main/documentation/content/pt-br/_index target=_blank>Edite essa página</a></li></ul></div></div></aside></main><footer><div class=footer-container><section class=logo-column><img src=http://172.16.201.134:1313/images/FreeBSD-colors.svg width=160 height=50 alt="FreeBSD logo"><div class=options-container><div class=language-container><a id=languages href=http://172.16.201.134:1313/pt-br/languages><img src=http://172.16.201.134:1313/images/language.png class=language-image alt="Escolha o idioma">
<span>Brazilian Portuguese</span></a></div><div class=theme-container><select id=theme-chooser><option value=theme-system>System</option><option value=theme-light>Light</option><option value=theme-dark>Dark</option><option value=theme-high-contrast>Alto contraste</option></select></div></div></section><section class=about-column><h3 class=column-title>About</h3><ul class=column-elements-container><li><a href=https://www.freebsd.org/about/ target=_blank class=column-element>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/ target=_blank class=column-element>FreeBSD Foundation</a></li><li><a href=https://www.freebsd.org/where/ target=_blank class=column-element>Get FreeBSD</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct target=_blank class=column-element>Code of Conduct</a></li><li><a href=https://www.freebsd.org/security/ target=_blank class=column-element>Security Advisories</a></li></ul></section><section class=documentation-column><h3 class=column-title>Documentation</h3><ul class=column-elements-container><li><a href=/pt-br class=column-element>Documentation portal</a></li><li><a href=https://man.FreeBSD.org target=_blank class=column-element>Manual pages</a></li><li><a href=https://papers.FreeBSD.org target=_blank class=column-element>Presentations and papers</a></li><li><a href=https://docs-archive.freebsd.org/doc/ target=_blank class=column-element>Previous versions</a></li><li><a href=https://docs-archive.freebsd.org/44doc/ target=_blank class=column-element>4.4BSD Documents</a></li><li><a href=https://wiki.freebsd.org/ target=_blank class=column-element>Wiki</a></li></ul></section><section class=community-column><h3 class=column-title>Community</h3><ul class=column-elements-container><li><a href=http://172.16.201.134:1313/pt-br/articles/contributing class=column-element>Get involved</a></li><li><a href=https://forums.freebsd.org/ target=_blank class=column-element>Community forum</a></li><li><a href=https://lists.freebsd.org/ target=_blank class=column-element>Mailing lists</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank class=column-element>IRC Channels</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank class=column-element>Bug Tracker</a></li></ul></section><section class=legal-column><h3 class=column-title>Legal</h3><ul class=column-elements-container><li><a href=https://freebsdfoundation.org/donate/ target=_blank class=column-element>Donations</a></li><li><a href=https://www.freebsd.org/copyright/freebsd-license/ target=_blank class=column-element>Licensing</a></li><li><a href=https://www.freebsd.org/privacy/ target=_blank class=column-element>Privacy Policy</a></li><li><a href=https://www.freebsd.org/copyright/ target=_blank class=column-element>Legal notices</a></li></ul></section><section class=copyright-column><p>&copy; 1994-2024 The FreeBSD Project. All rights reserved</p><span>Made with <span class=heart>♥</span> by the FreeBSD Community</span></section></div></footer></body></html>