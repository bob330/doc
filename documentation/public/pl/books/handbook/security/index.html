<!doctype html><html class=theme-light lang=pl><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content><meta name=copyright content="1995-2024 The FreeBSD Foundation"><link rel=canonical href=https://docs.freebsd.org/pl/books/handbook/security/><title>Rozdział 14. Security | FreeBSD Documentation Portal</title>
<meta name=theme-color content="#790000"><meta name=color-scheme content="system light dark high-contrast"><link rel="shortcut icon" href=https://docs.freebsd.org/favicon.ico><link rel=stylesheet href=https://docs.freebsd.org/styles/main.min.css><link rel=stylesheet href=https://docs.freebsd.org/css/font-awesome-min.css><script defer src=/js/theme-chooser.min.js></script><script defer src=/js/copy-clipboard.min.js></script><script defer src=/js/search.min.js></script><meta name=twitter:card content="summary"><meta name=twitter:domain content="docs.FreeBSD.org"><meta name=twitter:site content="@freebsd"><meta name=twitter:url content="https://twitter.com/freebsd"><meta property="og:title" content="Rozdział 14. Security"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:image" content="https://docs.freebsd.org/favicon.ico"><meta property="og:image:alt" content="FreeBSD Logo"><meta property="og:locale" content="pl"><meta property="og:url" content="https://docs.freebsd.org/pl/books/handbook/security/"><meta property="og:site_name" content="FreeBSD Documentation Portal"><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","url":"https:\/\/docs.freebsd.org\/pl\/books\/handbook\/security\/","name":"FreeBSD Documentation Portal","headline":"FreeBSD Documentation Portal","description":"FreeBSD Documentation Portal"}</script></head><body><header><div class=header-container><div class=logo-menu-bars-container><a href=https://www.FreeBSD.org class=logo><img src=https://docs.freebsd.org/images/FreeBSD-monochromatic.svg width=160 height=50 alt="FreeBSD logo">
</a><label class=menu-bars for=menu-bars><i class="fa fa-bars" aria-hidden=true></i></label></div><input id=menu-bars type=checkbox><nav><ul class=menu><li class=menu-item><input id=about type=checkbox>
<a href=# aria-label="Navigate to About section"><label class=menu-item-description for=about>About
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/about/ target=_blank>About</a></li><li><a href=https://www.freebsd.org/about/ target=_blank>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/about-us/about-the-foundation/ target=_blank>FreeBSD Foundation</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct/ target=_blank>Code of Conduct</a></li></ul></li><li class=menu-item><input id=download type=checkbox>
<a href=# aria-label="Navigate to get FreeBSD section"><label class=menu-item-description for=download>Get FreeBSD
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/where/ target=_blank>Get FreeBSD</a></li><li><a href=https://www.freebsd.org/releases/ target=_blank>Release Information</a></li><li><a href=https://www.freebsd.org/releng/ target=_blank>Release Engineering</a></li><li><a href=https://www.freebsd.org/security/ target=_blank>Security Advisories</a></li></ul></li><li class=menu-item><input id=documentation type=checkbox>
<a href=# aria-label="Navigate to get Documentation section"><label class=menu-item-description for=documentation>Documentation
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=/pl>Documentation portal</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook>FreeBSD Handbook</a></li><li><a href=https://docs.freebsd.org/pl/books/porters-handbook>Porter's Handbook</a></li><li><a href=https://docs.FreeBSD.org/en/books/fdp-primer>Documentation Project Handbook</a></li><li><a href=https://man.FreeBSD.org target=_blank>Manual pages</a></li><li><a href=https://papers.FreeBSD.org target=_blank>Presentations and papers</a></li><li><a href=https://wiki.FreeBSD.org target=_blank>Wiki</a></li><li><a href=https://docs.freebsd.org/pl/books>Books</a></li><li><a href=https://docs.freebsd.org/pl/articles>Articles</a></li></ul></li><li class=menu-item><input id=community type=checkbox>
<a href=# aria-label="Navigate to get Community section"><label class=menu-item-description for=community>Community
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/community/>Community</a></li><li><a href=https://docs.freebsd.org/pl/articles/contributing>Get involved</a></li><li><a href=https://forums.freebsd.org/ target=_blank>Forum</a></li><li><a href=https://lists.freebsd.org/ target=_blank>Mailing lists</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank>IRC Channels</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank>Bug Tracker</a></li><li><a href=https://www.freebsd.org/support/ target=_blank>Support</a></li></ul></li></ul></nav><div class=search-donate-container><form class=search method=get id=search-header-form action=https://docs.freebsd.org/search name=search-header-form><input type=hidden name=DB value=pl>
<input id=words name=P type=text size=20 maxlength=255>
<button>
<i class="fa fa-search" aria-hidden=true></i></button></form><div class=donate><a href=https://freebsdfoundation.org/donate/ target=_blank><span class=heart>♥</span>
Donate</a></div></div></div></header><input type=checkbox class="hidden toggle" id=menu-control><main class=main-wrapper-book><a id=top></a><aside class=book-menu><div class=book-menu-content><input id=search-book type=text placeholder=Search aria-label=Search maxlength=128><nav id=MenuContents><ul><li><input type=checkbox id=chapter-eb2a98ce203d8afd517726e6d8776be3 class=toggle>
<label class="icon cursor" for=chapter-eb2a98ce203d8afd517726e6d8776be3><a role=button></a></label><a href=https://docs.freebsd.org/pl/books/handbook/preface/>Przedmowa</a><ul><li><a href=https://docs.freebsd.org/pl/books/handbook/preface/#preface-audience>Docelowy czytelnik</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/preface/#preface-changes-from2>Zmiany od wydania drugiego</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/preface/#preface-changes>Zmiany od wydania pierwszego</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/preface/#preface-overview>Układ książki</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/preface/#preface-conv>Konwencje użyte w tej książce</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/preface/#preface-acknowledgements>Podziękowania</a></li></ul></li><li><input type=checkbox id=chapter-14a525fce014b90b8a458a894818255a class=toggle>
<label for=chapter-14a525fce014b90b8a458a894818255a><a role=button></a></label><a href=https://docs.freebsd.org/pl/books/handbook/parti/>Część I. Pierwsze kroki</a></li><li><input type=checkbox id=chapter-f9c9f3451644df30d224350da97d5da6 class=toggle>
<label class="icon cursor" for=chapter-f9c9f3451644df30d224350da97d5da6><a role=button></a></label><a href=https://docs.freebsd.org/pl/books/handbook/introduction/>Rozdział 1. Wprowadzenie</a><ul><li><a href=https://docs.freebsd.org/pl/books/handbook/introduction/#introduction-synopsis>1.1. Streszczenie</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/introduction/#nutshell>1.2. Witamy w świecie FreeBSD!</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/introduction/#history>1.3. O Projekcie FreeBSD</a></li></ul></li><li><input type=checkbox id=chapter-6aaec170775233b7c45f6cdcfb70d466 class=toggle>
<label class="icon cursor" for=chapter-6aaec170775233b7c45f6cdcfb70d466><a role=button></a></label><a href=https://docs.freebsd.org/pl/books/handbook/install/>Rozdział 2. Instalacja FreeBSD</a><ul><li><a href=https://docs.freebsd.org/pl/books/handbook/install/#install-synopsis>2.1. Streszczenie</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/install/#install-pre>2.2. Czynności wstępne</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/install/#install-start>2.3. Rozpoczęcie instalacji</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/install/#using-sysinstall>2.4. Wprowadzenie do sysinstall</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/install/#install-steps>2.5. Przydział miejsca na dysku</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/install/#install-choosing>2.6. Wybór składników instalacji</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/install/#install-media>2.7. Wybór nośnika instalacji</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/install/#install-final-warning>2.8. Przystąpienie do instalacji</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/install/#install-post>2.9. Po instalacji</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/install/#install-supported-hardware>2.10. Obsługiwany sprzęt</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/install/#install-trouble>2.11. Rozwiązywanie problemów</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/install/#install-advanced>2.12. Instalacja zaawansowana</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/install/#install-diff-media>2.13. Przygotowanie własnego nośnika instalacji</a></li></ul></li><li><input type=checkbox id=chapter-9f6db261075f578742036fcc6000eecd class=toggle>
<label class="icon cursor" for=chapter-9f6db261075f578742036fcc6000eecd><a role=button></a></label><a href=https://docs.freebsd.org/pl/books/handbook/basics/>Rozdział 3. Podstawy Uniksa</a><ul><li><a href=https://docs.freebsd.org/pl/books/handbook/basics/#basics-synopsis>3.1. Streszczenie</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/basics/#consoles>3.2. Konsole wirtualne i terminale</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/basics/#permissions>3.3. Prawa dostępu</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/basics/#dirstructure>3.4. Struktura katalogów</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/basics/#disk-organization>3.5. Organizacja dysku</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/basics/#mount-unmount>3.6. Montowanie i odmontowywanie systemów plików</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/basics/#basics-processes>3.7. Procesy</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/basics/#basics-daemons>3.8. Demony, sygnały i unicestwianie procesów</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/basics/#shells>3.9. Powłoki</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/basics/#editors>3.10. Edytory tekstu</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/basics/#basics-devices>3.11. Urządzenia i pliki urządzeń</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/basics/#binary-formats>3.12. Formaty binarne</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/basics/#basics-more-information>3.13. Więcej informacji</a></li></ul></li><li><input type=checkbox id=chapter-01c5707e95d14c0ff84bf62600c958d1 class=toggle>
<label class="icon cursor" for=chapter-01c5707e95d14c0ff84bf62600c958d1><a role=button></a></label><a href=https://docs.freebsd.org/pl/books/handbook/ports/>Rozdział 4. Instalacja programów: pakiety i porty</a><ul><li><a href=https://docs.freebsd.org/pl/books/handbook/ports/#ports-synopsis>4.1. Streszczenie</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/ports/#ports-overview>4.2. Omówienie instalacji oprogramowania</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/ports/#ports-finding-applications>4.3. Odnalezienie programu dla siebie</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/ports/#packages-using>4.4. Korzystanie z systemu pakietów</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/ports/#ports-using>4.5. Korzystanie z kolekcji portów</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/ports/#ports-nextsteps>4.6. Czynności po-instalacyjne</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/ports/#ports-broken>4.7. Jak radzić sobie ze źle przygotowanymi portami</a></li></ul></li><li><input type=checkbox id=chapter-3405c00581365a8b5d16af70fe4d1b72 class=toggle>
<label class="icon cursor" for=chapter-3405c00581365a8b5d16af70fe4d1b72><a role=button></a></label><a href=https://docs.freebsd.org/pl/books/handbook/x11/>Rozdział 5. System okien X</a><ul><li><a href=https://docs.freebsd.org/pl/books/handbook/x11/#x11-synopsis>5.1. Streszczenie</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/x11/#x-understanding>5.2. Zrozumieć X</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/x11/#x-install>5.3. Instalacja X11</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/x11/#x-config>5.4. Konfiguracja X11</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/x11/#x-fonts>5.5. Korzystanie z czcionek w X11</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/x11/#x-xdm>5.6. Menedżer pulpitów X</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/x11/#x11-wm>5.7. Środowiska graficzne</a></li></ul></li><li><input type=checkbox id=chapter-0eab3565e8f59f5a8a896dfba7eb3680 class=toggle>
<label for=chapter-0eab3565e8f59f5a8a896dfba7eb3680><a role=button></a></label><a href=https://docs.freebsd.org/pl/books/handbook/partii/>Część II. Codzienne czynności</a></li><li><input type=checkbox id=chapter-b33cf28993f3f7bf5baf036e79da0f39 class=toggle>
<label class="icon cursor" for=chapter-b33cf28993f3f7bf5baf036e79da0f39><a role=button></a></label><a href=https://docs.freebsd.org/pl/books/handbook/desktop/>Rozdział 6. Aplikacje biurowe</a><ul><li><a href=https://docs.freebsd.org/pl/books/handbook/desktop/#desktop-synopsis>6.1. Streszczenie</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/desktop/#desktop-browsers>6.2. Przeglądarki internetowe</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/desktop/#moz-flash-plugin>6.3. Firefox, Mozilla i moduł Macromedia® Flash®</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/desktop/#_opera>6.4. Opera</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/desktop/#_konqueror>6.5. Konqueror</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/desktop/#desktop-productivity>6.6. Programy codziennego użytku</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/desktop/#desktop-viewers>6.7. Przeglądarki dokumentów</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/desktop/#desktop-finance>6.8. Finanse</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/desktop/#desktop-summary>6.9. Podsumowanie</a></li></ul></li><li><input type=checkbox id=chapter-152f694a19312ad72ec7bb4e1c3c33b2 class=toggle>
<label class="icon cursor" for=chapter-152f694a19312ad72ec7bb4e1c3c33b2><a role=button></a></label><a href=https://docs.freebsd.org/pl/books/handbook/multimedia/>Rozdział 7. Multimedia</a><ul><li><a href=https://docs.freebsd.org/pl/books/handbook/multimedia/#multimedia-synopsis>7.1. Synopsis</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/multimedia/#sound-setup>7.2. Setting Up the Sound Card</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/multimedia/#sound-mp3>7.3. MP3 Audio</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/multimedia/#video-playback>7.4. Video Playback</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/multimedia/#tvcard>7.5. TV Cards</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/multimedia/#mythtv>7.6. MythTV</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/multimedia/#scanners>7.7. Image Scanners</a></li></ul></li><li><input type=checkbox id=chapter-80888b4ee02e3e409e5f71cf97a36450 class=toggle>
<label class="icon cursor" for=chapter-80888b4ee02e3e409e5f71cf97a36450><a role=button></a></label><a href=https://docs.freebsd.org/pl/books/handbook/kernelconfig/>Rozdział 8. Konfiguracja jądra FreeBSD</a><ul><li><a href=https://docs.freebsd.org/pl/books/handbook/kernelconfig/#kernelconfig-synopsis>8.1. Streszczenie</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/kernelconfig/#kernelconfig-custom-kernel>8.2. Po co budować indywidualne jądro?</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/kernelconfig/#kernelconfig-building>8.3. Budowanie i instalowanie indywidualnego jądra</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/kernelconfig/#kernelconfig-config>8.4. Plik konfiguracyjny</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/kernelconfig/#kernelconfig-trouble>8.5. Jeśli pojawią się kłopoty</a></li></ul></li><li><input type=checkbox id=chapter-cb174c55879b17ab955f2f16989a79e0 class=toggle>
<label class="icon cursor" for=chapter-cb174c55879b17ab955f2f16989a79e0><a role=button></a></label><a href=https://docs.freebsd.org/pl/books/handbook/printing/>Rozdział 9. Printing</a><ul><li><a href=https://docs.freebsd.org/pl/books/handbook/printing/#printing-quick-start>9.1. Quick Start</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/printing/#printing-connections>9.2. Printer Connections</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/printing/#printing-pdls>9.3. Common Page Description Languages</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/printing/#printing-direct>9.4. Direct Printing</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/printing/#printing-lpd>9.5. LPD (Line Printer Daemon)</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/printing/#printing-other>9.6. Other Printing Systems</a></li></ul></li><li><input type=checkbox id=chapter-c12b8c3f2a8fcefce87087241f695c83 class=toggle>
<label class="icon cursor" for=chapter-c12b8c3f2a8fcefce87087241f695c83><a role=button></a></label><a href=https://docs.freebsd.org/pl/books/handbook/linuxemu/>Rozdział 10. Linux® Binary Compatibility</a><ul><li><a href=https://docs.freebsd.org/pl/books/handbook/linuxemu/#linuxemu-synopsis>10.1. Synopsis</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/linuxemu/#linuxemu-lbc-install>10.2. Configuring Linux® Binary Compatibility</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/linuxemu/#linuxemu-advanced>10.3. Advanced Topics</a></li></ul></li><li><input type=checkbox id=chapter-03b11ba627b9a0c85b247f5641bde272 class=toggle>
<label for=chapter-03b11ba627b9a0c85b247f5641bde272><a role=button></a></label><a href=https://docs.freebsd.org/pl/books/handbook/partiii/>Część III. Administracja systemem</a></li><li><input type=checkbox id=chapter-6c31587f8d736319f099cd4dc1961301 class=toggle>
<label class="icon cursor" for=chapter-6c31587f8d736319f099cd4dc1961301><a role=button></a></label><a href=https://docs.freebsd.org/pl/books/handbook/config/>Rozdział 11. Configuration and Tuning</a><ul><li><a href=https://docs.freebsd.org/pl/books/handbook/config/#config-synopsis>11.1. Synopsis</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/config/#configtuning-starting-services>11.2. Starting Services</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/config/#configtuning-cron>11.3. Configuring cron(8)</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/config/#configtuning-rcd>11.4. Managing Services in FreeBSD</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/config/#config-network-setup>11.5. Setting Up Network Interface Cards</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/config/#configtuning-virtual-hosts>11.6. Virtual Hosts</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/config/#configtuning-syslog>11.7. Configuring System Logging</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/config/#configtuning-configfiles>11.8. Configuration Files</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/config/#configtuning-sysctl>11.9. Tuning with sysctl(8)</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/config/#configtuning-disk>11.10. Tuning Disks</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/config/#configtuning-kernel-limits>11.11. Tuning Kernel Limits</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/config/#adding-swap-space>11.12. Adding Swap Space</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/config/#acpi-overview>11.13. Power and Resource Management</a></li></ul></li><li><input type=checkbox id=chapter-459f0012b3b4f0b6b123010f029da5e4 class=toggle>
<label class="icon cursor" for=chapter-459f0012b3b4f0b6b123010f029da5e4><a role=button></a></label><a href=https://docs.freebsd.org/pl/books/handbook/boot/>Rozdział 12. The FreeBSD Booting Process</a><ul><li><a href=https://docs.freebsd.org/pl/books/handbook/boot/#boot-synopsis>12.1. Synopsis</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/boot/#boot-introduction>12.2. FreeBSD Boot Process</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/boot/#boot-splash>12.3. Configuring Boot Time Splash Screens</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/boot/#device-hints>12.4. Device Hints</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/boot/#boot-shutdown>12.5. Shutdown Sequence</a></li></ul></li><li><input type=checkbox id=chapter-d251c21b963b5ab783e5aec225e02b5a class=toggle>
<label class="icon cursor" for=chapter-d251c21b963b5ab783e5aec225e02b5a><a role=button></a></label><a href=https://docs.freebsd.org/pl/books/handbook/users/>Rozdział 13. Użytkownicy i podstawy zarządzania kontami</a><ul><li><a href=https://docs.freebsd.org/pl/books/handbook/users/#users-synopsis>13.1. Streszczenie</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/users/#users-introduction>13.2. Wprowadzenie</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/users/#users-superuser>13.3. Konto superużytkownika</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/users/#users-system>13.4. Konta systemowe</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/users/#users-user>13.5. Konta użytkowników</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/users/#users-modifying>13.6. Modyfikacja ustawień kont</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/users/#users-limiting>13.7. Ograniczanie użytkowników</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/users/#users-groups>13.8. Grupy</a></li></ul></li><li><input type=checkbox id=chapter-917c75fcffbb14d48ed6d0a48e7028f2 class=toggle checked>
<label class="icon cursor" for=chapter-917c75fcffbb14d48ed6d0a48e7028f2><a role=button></a></label><a href=https://docs.freebsd.org/pl/books/handbook/security/>Rozdział 14. Security</a><ul><li><a href=https://docs.freebsd.org/pl/books/handbook/security/#security-synopsis>14.1. Synopsis</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/security/#security-intro>14.2. Introduction</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/security/#one-time-passwords>14.3. One-time Passwords</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/security/#tcpwrappers>14.4. TCP Wrapper</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/security/#kerberos5>14.5. Kerberos</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/security/#openssl>14.6. OpenSSL</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/security/#ipsec>14.7. VPN over IPsec</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/security/#openssh>14.8. OpenSSH</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/security/#fs-acl>14.9. Access Control Lists</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/security/#security-pkg>14.10. Monitoring Third Party Security Issues</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/security/#security-advisories>14.11. FreeBSD Security Advisories</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/security/#security-accounting>14.12. Process Accounting</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/security/#security-resourcelimits>14.13. Resource Limits</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/security/#security-sudo>14.14. Shared Administration with Sudo</a></li></ul></li><li><input type=checkbox id=chapter-1a2a8e719703649c2c66d99aa7a25fd4 class=toggle>
<label class="icon cursor" for=chapter-1a2a8e719703649c2c66d99aa7a25fd4><a role=button></a></label><a href=https://docs.freebsd.org/pl/books/handbook/jails/>Rozdział 15. Jails</a><ul><li><a href=https://docs.freebsd.org/pl/books/handbook/jails/#jails-synopsis>15.1. Synopsis</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/jails/#jails-terms>15.2. Terms Related to Jails</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/jails/#jails-build>15.3. Creating and Controlling Jails</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/jails/#jails-tuning>15.4. Fine Tuning and Administration</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/jails/#jails-application>15.5. Updating Multiple Jails</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/jails/#jails-ezjail>15.6. Managing Jails with ezjail</a></li></ul></li><li><input type=checkbox id=chapter-8f4620c77e572cbb58917911a33c73cf class=toggle>
<label class="icon cursor" for=chapter-8f4620c77e572cbb58917911a33c73cf><a role=button></a></label><a href=https://docs.freebsd.org/pl/books/handbook/mac/>Rozdział 16. Mandatory Access Control</a><ul><li><a href=https://docs.freebsd.org/pl/books/handbook/mac/#mac-synopsis>16.1. Synopsis</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/mac/#mac-inline-glossary>16.2. Key Terms</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/mac/#mac-understandlabel>16.3. Understanding MAC Labels</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/mac/#mac-planning>16.4. Planning the Security Configuration</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/mac/#mac-policies>16.5. Available MAC Policies</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/mac/#mac-userlocked>16.6. User Lock Down</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/mac/#mac-implementing>16.7. Nagios in a MAC Jail</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/mac/#mac-troubleshoot>16.8. Troubleshooting the MAC Framework</a></li></ul></li><li><input type=checkbox id=chapter-9598d66a76cb3182057b6bcd775149a0 class=toggle>
<label class="icon cursor" for=chapter-9598d66a76cb3182057b6bcd775149a0><a role=button></a></label><a href=https://docs.freebsd.org/pl/books/handbook/audit/>Rozdział 17. Security Event Auditing</a><ul><li><a href=https://docs.freebsd.org/pl/books/handbook/audit/#audit-synopsis>17.1. Synopsis</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/audit/#audit-inline-glossary>17.2. Key Terms</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/audit/#audit-config>17.3. Audit Configuration</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/audit/#audit-administration>17.4. Working with Audit Trails</a></li></ul></li><li><input type=checkbox id=chapter-e1edcad13d9db6e8e4cb645d378ecfaf class=toggle>
<label class="icon cursor" for=chapter-e1edcad13d9db6e8e4cb645d378ecfaf><a role=button></a></label><a href=https://docs.freebsd.org/pl/books/handbook/disks/>Rozdział 18. Storage</a><ul><li><a href=https://docs.freebsd.org/pl/books/handbook/disks/#disks-synopsis>18.1. Synopsis</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/disks/#disks-adding>18.2. Adding Disks</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/disks/#disks-growing>18.3. Resizing and Growing Disks</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/disks/#usb-disks>18.4. USB Storage Devices</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/disks/#creating-cds>18.5. Creating and Using CD Media</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/disks/#creating-dvds>18.6. Creating and Using DVD Media</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/disks/#floppies>18.7. Creating and Using Floppy Disks</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/disks/#backup-basics>18.8. Backup Basics</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/disks/#disks-virtual>18.9. Memory Disks</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/disks/#snapshots>18.10. File System Snapshots</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/disks/#quotas>18.11. Disk Quotas</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/disks/#disks-encrypting>18.12. Encrypting Disk Partitions</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/disks/#swap-encrypting>18.13. Encrypting Swap</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/disks/#disks-hast>18.14. Highly Available Storage (HAST)</a></li></ul></li><li><input type=checkbox id=chapter-dde37901a0e0ea32745b67607854900f class=toggle>
<label class="icon cursor" for=chapter-dde37901a0e0ea32745b67607854900f><a role=button></a></label><a href=https://docs.freebsd.org/pl/books/handbook/geom/>Rozdział 19. GEOM: Modular Disk Transformation Framework</a><ul><li><a href=https://docs.freebsd.org/pl/books/handbook/geom/#geom-synopsis>19.1. Synopsis</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/geom/#geom-striping>19.2. RAID0 - Striping</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/geom/#geom-mirror>19.3. RAID1 - Mirroring</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/geom/#geom-raid3>19.4. RAID3 - Byte-level Striping with Dedicated Parity</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/geom/#geom-graid>19.5. Software RAID Devices</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/geom/#geom-ggate>19.6. GEOM Gate Network</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/geom/#geom-glabel>19.7. Labeling Disk Devices</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/geom/#geom-gjournal>19.8. UFS Journaling Through GEOM</a></li></ul></li><li><input type=checkbox id=chapter-73e82560fcb7145b7c0e2ec47af8fc04 class=toggle>
<label class="icon cursor" for=chapter-73e82560fcb7145b7c0e2ec47af8fc04><a role=button></a></label><a href=https://docs.freebsd.org/pl/books/handbook/zfs/>Rozdział 20. The Z File System (ZFS)</a><ul><li><a href=https://docs.freebsd.org/pl/books/handbook/zfs/#zfs-differences>20.1. What Makes ZFS Different</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/zfs/#zfs-quickstart>20.2. Quick Start Guide</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/zfs/#zfs-zpool>20.3. <code>zpool</code> Administration</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/zfs/#zfs-zfs>20.4. <code>zfs</code> Administration</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/zfs/#zfs-zfs-allow>20.5. Delegated Administration</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/zfs/#zfs-advanced>20.6. Advanced Topics</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/zfs/#zfs-links>20.7. Additional Resources</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/zfs/#zfs-term>20.8. ZFS Features and Terminology</a></li></ul></li><li><input type=checkbox id=chapter-7af71270807eb7b70cd3eedc6577b254 class=toggle>
<label class="icon cursor" for=chapter-7af71270807eb7b70cd3eedc6577b254><a role=button></a></label><a href=https://docs.freebsd.org/pl/books/handbook/filesystems/>Rozdział 21. Other File Systems</a><ul><li><a href=https://docs.freebsd.org/pl/books/handbook/filesystems/#filesystems-synopsis>21.1. Synopsis</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/filesystems/#filesystems-linux>21.2. Linux® File Systems</a></li></ul></li><li><input type=checkbox id=chapter-375257268d95faaf87faf4f7a2e6aa67 class=toggle>
<label class="icon cursor" for=chapter-375257268d95faaf87faf4f7a2e6aa67><a role=button></a></label><a href=https://docs.freebsd.org/pl/books/handbook/virtualization/>Rozdział 22. Virtualization</a><ul><li><a href=https://docs.freebsd.org/pl/books/handbook/virtualization/#virtualization-synopsis>22.1. Synopsis</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/virtualization/#virtualization-guest-parallels>22.2. FreeBSD as a Guest on Parallels for Mac OS® X</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/virtualization/#virtualization-guest-virtualpc>22.3. FreeBSD as a Guest on Virtual PC for Windows®</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/virtualization/#virtualization-guest-vmware>22.4. FreeBSD as a Guest on VMware Fusion for Mac OS®</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/virtualization/#virtualization-guest-virtualbox>22.5. FreeBSD as a Guest on VirtualBox™</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/virtualization/#virtualization-host-virtualbox>22.6. FreeBSD as a Host with VirtualBox™</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/virtualization/#virtualization-host-bhyve>22.7. FreeBSD as a Host with bhyve</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/virtualization/#virtualization-host-xen>22.8. FreeBSD as a Xen™-Host</a></li></ul></li><li><input type=checkbox id=chapter-49f1e96591c090304ea532012257f4ef class=toggle>
<label class="icon cursor" for=chapter-49f1e96591c090304ea532012257f4ef><a role=button></a></label><a href=https://docs.freebsd.org/pl/books/handbook/l10n/>Rozdział 23. Localization - i18n/L10n Usage and Setup</a><ul><li><a href=https://docs.freebsd.org/pl/books/handbook/l10n/#l10n-synopsis>23.1. Synopsis</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/l10n/#using-localization>23.2. Using Localization</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/l10n/#l10n-compiling>23.3. Finding i18n Applications</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/l10n/#lang-setup>23.4. Locale Configuration for Specific Languages</a></li></ul></li><li><input type=checkbox id=chapter-dead2b4c5ea325dd390a9b0dccd8f763 class=toggle>
<label class="icon cursor" for=chapter-dead2b4c5ea325dd390a9b0dccd8f763><a role=button></a></label><a href=https://docs.freebsd.org/pl/books/handbook/cutting-edge/>Rozdział 24. Updating and Upgrading FreeBSD</a><ul><li><a href=https://docs.freebsd.org/pl/books/handbook/cutting-edge/#updating-upgrading-synopsis>24.1. Synopsis</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/cutting-edge/#updating-upgrading-freebsdupdate>24.2. FreeBSD Update</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/cutting-edge/#updating-upgrading-documentation>24.3. Updating the Documentation Set</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/cutting-edge/#current-stable>24.4. Tracking a Development Branch</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/cutting-edge/#makeworld>24.5. Updating FreeBSD from Source</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/cutting-edge/#small-lan>24.6. Tracking for Multiple Machines</a></li></ul></li><li><input type=checkbox id=chapter-29c1eeb0e9dedc487a98399e2737ee8a class=toggle>
<label class="icon cursor" for=chapter-29c1eeb0e9dedc487a98399e2737ee8a><a role=button></a></label><a href=https://docs.freebsd.org/pl/books/handbook/dtrace/>Rozdział 25. DTrace</a><ul><li><a href=https://docs.freebsd.org/pl/books/handbook/dtrace/#dtrace-synopsis>25.1. Synopsis</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/dtrace/#dtrace-implementation>25.2. Implementation Differences</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/dtrace/#dtrace-enable>25.3. Enabling DTrace Support</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/dtrace/#dtrace-using>25.4. Using DTrace</a></li></ul></li><li><input type=checkbox id=chapter-913e72bfb3d6947b2869d3e9447a6eaa class=toggle>
<label class="icon cursor" for=chapter-913e72bfb3d6947b2869d3e9447a6eaa><a role=button></a></label><a href=https://docs.freebsd.org/pl/books/handbook/usb-device-mode/>Rozdział 26. USB Device Mode / USB OTG</a><ul><li><a href=https://docs.freebsd.org/pl/books/handbook/usb-device-mode/#usb-device-mode-synopsis>26.1. Synopsis</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/usb-device-mode/#usb-device-mode-terminals>26.2. USB Virtual Serial Ports</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/usb-device-mode/#usb-device-mode-network>26.3. USB Device Mode Network Interfaces</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/usb-device-mode/#usb-device-mode-storage>26.4. USB Virtual Storage Device</a></li></ul></li><li><input type=checkbox id=chapter-bbd25f9a194f9c39ca2d658c75767db5 class=toggle>
<label for=chapter-bbd25f9a194f9c39ca2d658c75767db5><a role=button></a></label><a href=https://docs.freebsd.org/pl/books/handbook/partiv/>Część IV. Komunikacja sieciowa</a></li><li><input type=checkbox id=chapter-499dab596afd7ddac77e80295314e0dd class=toggle>
<label class="icon cursor" for=chapter-499dab596afd7ddac77e80295314e0dd><a role=button></a></label><a href=https://docs.freebsd.org/pl/books/handbook/serialcomms/>Rozdział 27. Serial Communications</a><ul><li><a href=https://docs.freebsd.org/pl/books/handbook/serialcomms/#serial-synopsis>27.1. Synopsis</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/serialcomms/#serial>27.2. Serial Terminology and Hardware</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/serialcomms/#term>27.3. Terminals</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/serialcomms/#dialup>27.4. Dial-in Service</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/serialcomms/#dialout>27.5. Dial-out Service</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/serialcomms/#serialconsole-setup>27.6. Setting Up the Serial Console</a></li></ul></li><li><input type=checkbox id=chapter-95e4571c48bee1cced5e84a538d302e3 class=toggle>
<label class="icon cursor" for=chapter-95e4571c48bee1cced5e84a538d302e3><a role=button></a></label><a href=https://docs.freebsd.org/pl/books/handbook/ppp-and-slip/>Rozdział 28. PPP</a><ul><li><a href=https://docs.freebsd.org/pl/books/handbook/ppp-and-slip/#ppp-and-slip-synopsis>28.1. Synopsis</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/ppp-and-slip/#userppp>28.2. Configuring PPP</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/ppp-and-slip/#ppp-troubleshoot>28.3. Troubleshooting PPP Connections</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/ppp-and-slip/#pppoe>28.4. Using PPP over Ethernet (PPPoE)</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/ppp-and-slip/#pppoa>28.5. Using PPP over ATM (PPPoA)</a></li></ul></li><li><input type=checkbox id=chapter-f089ac726c401c9b4bd5c34a295e11bb class=toggle>
<label class="icon cursor" for=chapter-f089ac726c401c9b4bd5c34a295e11bb><a role=button></a></label><a href=https://docs.freebsd.org/pl/books/handbook/mail/>Rozdział 29. Electronic Mail</a><ul><li><a href=https://docs.freebsd.org/pl/books/handbook/mail/#mail-synopsis>29.1. Synopsis</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/mail/#mail-using>29.2. Mail Components</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/mail/#sendmail>29.3. Sendmail Configuration Files</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/mail/#mail-changingmta>29.4. Changing the Mail Transfer Agent</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/mail/#mail-trouble>29.5. Troubleshooting</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/mail/#mail-advanced>29.6. Advanced Topics</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/mail/#outgoing-only>29.7. Setting Up to Send Only</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/mail/#SMTP-dialup>29.8. Using Mail with a Dialup Connection</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/mail/#SMTP-Auth>29.9. SMTP Authentication</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/mail/#mail-agents>29.10. Mail User Agents</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/mail/#mail-fetchmail>29.11. Using fetchmail</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/mail/#mail-procmail>29.12. Using procmail</a></li></ul></li><li><input type=checkbox id=chapter-6de4de3fe925639d4175ce4b6f8c1829 class=toggle>
<label class="icon cursor" for=chapter-6de4de3fe925639d4175ce4b6f8c1829><a role=button></a></label><a href=https://docs.freebsd.org/pl/books/handbook/network-servers/>Rozdział 30. Network Servers</a><ul><li><a href=https://docs.freebsd.org/pl/books/handbook/network-servers/#network-servers-synopsis>30.1. Synopsis</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/network-servers/#network-inetd>30.2. The inetd Super-Server</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/network-servers/#network-nfs>30.3. Network File System (NFS)</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/network-servers/#network-nis>30.4. Network Information System (NIS)</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/network-servers/#network-ldap>30.5. Lightweight Directory Access Protocol (LDAP)</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/network-servers/#network-dhcp>30.6. Dynamic Host Configuration Protocol (DHCP)</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/network-servers/#network-dns>30.7. Domain Name System (DNS)</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/network-servers/#network-apache>30.8. Apache HTTP Server</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/network-servers/#network-ftp>30.9. File Transfer Protocol (FTP)</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/network-servers/#network-samba>30.10. File and Print Services for Microsoft® Windows® Clients (Samba)</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/network-servers/#network-ntp>30.11. Clock Synchronization with NTP</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/network-servers/#network-iscsi>30.12. iSCSI Initiator and Target Configuration</a></li></ul></li><li><input type=checkbox id=chapter-776d855c7b75e048f90b5c2c9b35ffe0 class=toggle>
<label class="icon cursor" for=chapter-776d855c7b75e048f90b5c2c9b35ffe0><a role=button></a></label><a href=https://docs.freebsd.org/pl/books/handbook/firewalls/>Rozdział 31. Firewalls</a><ul><li><a href=https://docs.freebsd.org/pl/books/handbook/firewalls/#firewalls-intro>31.1. Synopsis</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/firewalls/#firewalls-concepts>31.2. Firewall Concepts</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/firewalls/#firewalls-pf>31.3. PF</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/firewalls/#firewalls-ipfw>31.4. IPFW</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/firewalls/#firewalls-ipf>31.5. IPFILTER (IPF)</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/firewalls/#firewalls-blacklistd>31.6. Blacklistd</a></li></ul></li><li><input type=checkbox id=chapter-5b07f776a0e6155c1c89aa0d15610380 class=toggle>
<label class="icon cursor" for=chapter-5b07f776a0e6155c1c89aa0d15610380><a role=button></a></label><a href=https://docs.freebsd.org/pl/books/handbook/advanced-networking/>Rozdział 32. Advanced Networking</a><ul><li><a href=https://docs.freebsd.org/pl/books/handbook/advanced-networking/#advanced-networking-synopsis>32.1. Synopsis</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/advanced-networking/#network-routing>32.2. Gateways and Routes</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/advanced-networking/#network-wireless>32.3. Wireless Networking</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/advanced-networking/#network-usb-tethering>32.4. USB Tethering</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/advanced-networking/#network-bluetooth>32.5. Bluetooth</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/advanced-networking/#network-bridging>32.6. Bridging</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/advanced-networking/#network-aggregation>32.7. Link Aggregation and Failover</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/advanced-networking/#network-diskless>32.8. Diskless Operation with PXE</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/advanced-networking/#network-ipv6>32.9. IPv6</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/advanced-networking/#carp>32.10. Common Address Redundancy Protocol (CARP)</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/advanced-networking/#network-vlan>32.11. VLANs</a></li></ul></li><li><input type=checkbox id=chapter-171a77aa9d067a1024f849470e1f33e8 class=toggle>
<label for=chapter-171a77aa9d067a1024f849470e1f33e8><a role=button></a></label><a href=https://docs.freebsd.org/pl/books/handbook/partv/>Część V. Dodatki</a></li><li><input type=checkbox id=chapter-8050f436a0a7986a4aaded93d8e49469 class=toggle>
<label class="icon cursor" for=chapter-8050f436a0a7986a4aaded93d8e49469><a role=button></a></label><a href=https://docs.freebsd.org/pl/books/handbook/mirrors/>Dodatek A. Obtaining FreeBSD</a><ul><li><a href=https://docs.freebsd.org/pl/books/handbook/mirrors/#mirrors-cdrom>A.1. CD and DVD Sets</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/mirrors/#mirrors-ftp>A.2. FTP Sites</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/mirrors/#svn>A.3. Using Subversion</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/mirrors/#mirrors-rsync>A.4. Using rsync</a></li></ul></li><li><input type=checkbox id=chapter-128b630a8f88f158e7027fe6c2184d21 class=toggle>
<label class="icon cursor" for=chapter-128b630a8f88f158e7027fe6c2184d21><a role=button></a></label><a href=https://docs.freebsd.org/pl/books/handbook/bibliography/>Dodatek B. Bibliografia</a><ul><li><a href=https://docs.freebsd.org/pl/books/handbook/bibliography/#bibliography-freebsd>B.1. Książki i czasopisma poświęcone FreeBSD</a></li></ul></li><li><input type=checkbox id=chapter-8bbb8867c46dac315e2253945d8c18a8 class=toggle>
<label class="icon cursor" for=chapter-8bbb8867c46dac315e2253945d8c18a8><a role=button></a></label><a href=https://docs.freebsd.org/pl/books/handbook/eresources/>Dodatek C. Resources on the Internet</a><ul><li><a href=https://docs.freebsd.org/pl/books/handbook/eresources/#eresources-www>C.1. Websites</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/eresources/#eresources-mail>C.2. Mailing Lists</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/eresources/#eresources-news>C.3. Usenet Newsgroups</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook/eresources/#eresources-web>C.4. Official Mirrors</a></li></ul></li><li><input type=checkbox id=chapter-a80ea4f5a4480b8725422710f954ef36 class=toggle>
<label class="icon cursor" for=chapter-a80ea4f5a4480b8725422710f954ef36><a role=button></a></label><a href=https://docs.freebsd.org/pl/books/handbook/pgpkeys/>Dodatek D. Klucze PGP</a><ul><li><a href=https://docs.freebsd.org/pl/books/handbook/pgpkeys/#pgpkeys-officers>D.1. Oficerowie</a></li></ul></li><li></li></ul></nav></div></aside><div class=book><div class=book-menu-mobile><label for=menu-control><span class=menu-control-button><i class="fa fa-list" aria-hidden=true title="Book menu"></i>
Book menu</span></label></div><h1 class=title>Rozdział 14. Security</h1><div class="admonitionblock note"><p><i class="fa fa-exclamation-circle" aria-hidden=true></i>
This translation may be out of date. To help with the translations please access the <a href=https://translate-dev.freebsd.org/ target=_blank>FreeBSD translations instance</a>.</p></div><div class=toc-mobile><h3>Table of Contents</h3><nav id=TableOfContents><ul><li><a href=#security-synopsis>14.1. Synopsis</a></li><li><a href=#security-intro>14.2. Introduction</a></li><li><a href=#one-time-passwords>14.3. One-time Passwords</a></li><li><a href=#tcpwrappers>14.4. TCP Wrapper</a></li><li><a href=#kerberos5>14.5. Kerberos</a></li><li><a href=#openssl>14.6. OpenSSL</a></li><li><a href=#ipsec>14.7. VPN over IPsec</a></li><li><a href=#openssh>14.8. OpenSSH</a></li><li><a href=#fs-acl>14.9. Access Control Lists</a></li><li><a href=#security-pkg>14.10. Monitoring Third Party Security Issues</a></li><li><a href=#security-advisories>14.11. FreeBSD Security Advisories</a></li><li><a href=#security-accounting>14.12. Process Accounting</a></li><li><a href=#security-resourcelimits>14.13. Resource Limits</a></li><li><a href=#security-sudo>14.14. Shared Administration with Sudo</a></li></ul></nav></div><div class=book-content><div id=preamble><div class=sectionbody></div></div><div class=sect1><h2 id=security-synopsis>14.1. Synopsis<a class=anchor href=#security-synopsis></a></h2><div class=sectionbody><div class=paragraph><p>Security, whether physical or virtual, is a topic so broad that an entire industry has evolved around it. Hundreds of standard practices have been authored about how to secure systems and networks, and as a user of FreeBSD, understanding how to protect against attacks and intruders is a must.</p></div><div class=paragraph><p>In this chapter, several fundamentals and techniques will be discussed. The FreeBSD system comes with multiple layers of security, and many more third party utilities may be added to enhance security.</p></div><div class=paragraph><p>After reading this chapter, you will know:</p></div><div class=ulist><ul><li><p>Basic FreeBSD system security concepts.</p></li><li><p>The various crypt mechanisms available in FreeBSD.</p></li><li><p>How to set up one-time password authentication.</p></li><li><p>How to configure TCP Wrapper for use with <a href="https://man.freebsd.org/cgi/man.cgi?query=inetd&amp;sektion=8&amp;format=html">inetd(8)</a>.</p></li><li><p>How to set up Kerberos on FreeBSD.</p></li><li><p>How to configure IPsec and create a VPN.</p></li><li><p>How to configure and use OpenSSH on FreeBSD.</p></li><li><p>How to use file system ACLs.</p></li><li><p>How to use pkg to audit third party software packages installed from the Ports Collection.</p></li><li><p>How to utilize FreeBSD security advisories.</p></li><li><p>What Process Accounting is and how to enable it on FreeBSD.</p></li><li><p>How to control user resources using login classes or the resource limits database.</p></li></ul></div><div class=paragraph><p>Before reading this chapter, you should:</p></div><div class=ulist><ul><li><p>Understand basic FreeBSD and Internet concepts.</p></li></ul></div><div class=paragraph><p>Additional security topics are covered elsewhere in this Handbook. For example, Mandatory Access Control is discussed in <a href=../mac/#mac>Mandatory Access Control</a> and Internet firewalls are discussed in <a href=../firewalls/#firewalls>Firewalls</a>.</p></div></div></div><div class=sect1><h2 id=security-intro>14.2. Introduction<a class=anchor href=#security-intro></a></h2><div class=sectionbody><div class=paragraph><p>Security is everyone’s responsibility. A weak entry point in any system could allow intruders to gain access to critical information and cause havoc on an entire network. One of the core principles of information security is the CIA triad, which stands for the Confidentiality, Integrity, and Availability of information systems.</p></div><div class=paragraph><p>The CIA triad is a bedrock concept of computer security as customers and users expect their data to be protected. For example, a customer expects that their credit card information is securely stored (confidentiality), that their orders are not changed behind the scenes (integrity), and that they have access to their order information at all times (availablility).</p></div><div class=paragraph><p>To provide CIA, security professionals apply a defense in depth strategy. The idea of defense in depth is to add several layers of security to prevent one single layer failing and the entire security system collapsing. For example, a system administrator cannot simply turn on a firewall and consider the network or system secure. One must also audit accounts, check the integrity of binaries, and ensure malicious tools are not installed. To implement an effective security strategy, one must understand threats and how to defend against them.</p></div><div class=paragraph><p>What is a threat as it pertains to computer security? Threats are not limited to remote attackers who attempt to access a system without permission from a remote location. Threats also include employees, malicious software, unauthorized network devices, natural disasters, security vulnerabilities, and even competing corporations.</p></div><div class=paragraph><p>Systems and networks can be accessed without permission, sometimes by accident, or by remote attackers, and in some cases, via corporate espionage or former employees. As a user, it is important to prepare for and admit when a mistake has led to a security breach and report possible issues to the security team. As an administrator, it is important to know of the threats and be prepared to mitigate them.</p></div><div class=paragraph><p>When applying security to systems, it is recommended to start by securing the basic accounts and system configuration, and then to secure the network layer so that it adheres to the system policy and the organization’s security procedures. Many organizations already have a security policy that covers the configuration of technology devices. The policy should include the security configuration of workstations, desktops, mobile devices, phones, production servers, and development servers. In many cases, standard operating procedures (SOPs) already exist. When in doubt, ask the security team.</p></div><div class=paragraph><p>The rest of this introduction describes how some of these basic security configurations are performed on a FreeBSD system. The rest of this chapter describes some specific tools which can be used when implementing a security policy on a FreeBSD system.</p></div><div class=sect2><h3 id=security-accounts>14.2.1. Preventing Logins<a class=anchor href=#security-accounts></a></h3><div class=paragraph><p>In securing a system, a good starting point is an audit of accounts. Ensure that <code>root</code> has a strong password and that this password is not shared. Disable any accounts that do not need login access.</p></div><div class=paragraph><p>To deny login access to accounts, two methods exist. The first is to lock the account. This example locks the <code>toor</code> account:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pw lock toor</span></code></pre></div></div><div class=paragraph><p>The second method is to prevent login access by changing the shell to <span class=filename>/usr/sbin/nologin</span>. Only the superuser can change the shell for other users:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># chsh -s /usr/sbin/nologin toor</span></code></pre></div></div><div class=paragraph><p>The <span class=filename>/usr/sbin/nologin</span> shell prevents the system from assigning a shell to the user when they attempt to login.</p></div></div><div class=sect2><h3 id=security-accountmgmt>14.2.2. Permitted Account Escalation<a class=anchor href=#security-accountmgmt></a></h3><div class=paragraph><p>In some cases, system administration needs to be shared with other users. FreeBSD has two methods to handle this. The first one, which is not recommended, is a shared root password used by members of the <code>wheel</code> group. With this method, a user types <code>su</code> and enters the password for <code>wheel</code> whenever superuser access is needed. The user should then type <code>exit</code> to leave privileged access after finishing the commands that required administrative access. To add a user to this group, edit <span class=filename>/etc/group</span> and add the user to the end of the <code>wheel</code> entry. The user must be separated by a comma character with no space.</p></div><div class=paragraph><p>The second, and recommended, method to permit privilege escalation is to install the <a class=package href=https://cgit.freebsd.org/ports/tree/security/sudo/>security/sudo</a> package or port. This software provides additional auditing, more fine-grained user control, and can be configured to lock users into running only the specified privileged commands.</p></div><div class=paragraph><p>After installation, use <code>visudo</code> to edit <span class=filename>/usr/local/etc/sudoers</span>. This example creates a new <code>webadmin</code> group, adds the <code>trhodes</code> account to that group, and configures that group access to restart <a class=package href=https://cgit.freebsd.org/ports/tree/apache24/>apache24</a>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pw groupadd webadmin -M trhodes -g 6000</span>
<span class=c># visudo</span>
%webadmin <span class=nv>ALL</span><span class=o>=(</span>ALL<span class=o>)</span> /usr/sbin/service apache24 <span class=k>*</span></code></pre></div></div></div><div class=sect2><h3 id=security-passwords>14.2.3. Password Hashes<a class=anchor href=#security-passwords></a></h3><div class=paragraph><p>Passwords are a necessary evil of technology. When they must be used, they should be complex and a powerful hash mechanism should be used to encrypt the version that is stored in the password database. FreeBSD supports the DES, MD5, SHA256, SHA512, and Blowfish hash algorithms in its <code>crypt()</code> library. The default of SHA512 should not be changed to a less secure hashing algorithm, but can be changed to the more secure Blowfish algorithm.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Blowfish is not part of AES and is not considered compliant with any Federal Information Processing Standards (FIPS). Its use may not be permitted in some environments.</p></div></td></tr></tbody></table></div><div class=paragraph><p>To determine which hash algorithm is used to encrypt a user’s password, the superuser can view the hash for the user in the FreeBSD password database. Each hash starts with a symbol which indicates the type of hash mechanism used to encrypt the password. If DES is used, there is no beginning symbol. For MD5, the symbol is <code>$</code>. For SHA256 and SHA512, the symbol is <code>$6$</code>. For Blowfish, the symbol is <code>$2a$</code>. In this example, the password for <code>dru</code> is hashed using the default SHA512 algorithm as the hash starts with <code>$6$</code>. Note that the encrypted hash, not the password itself, is stored in the password database:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># grep dru /etc/master.passwd</span>
dru:<span class=nv>$6$pzIjSvCAn</span>.PBYQBA<span class=nv>$PXpSeWPx3g5kscj3IMiM7tUEUSPmGexxta</span>.8Lt9TGSi2lNQqYGKszsBPuGME0:1001:1001::0:0:dru:/usr/home/dru:/bin/csh</code></pre></div></div><div class=paragraph><p>The hash mechanism is set in the user’s login class. For this example, the user is in the <code>default</code> login class and the hash algorithm is set with this line in <span class=filename>/etc/login.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>        :passwd_format=sha512:\</pre></div></div><div class=paragraph><p>To change the algorithm to Blowfish, modify that line to look like this:</p></div><div class="literalblock programlisting"><div class=content><pre>        :passwd_format=blf:\</pre></div></div><div class=paragraph><p>Then run <code>cap_mkdb /etc/login.conf</code> as described in <a href=#users-limiting>Configuring Login Classes</a>. Note that this change will not affect any existing password hashes. This means that all passwords should be re-hashed by asking users to run <code>passwd</code> in order to change their password.</p></div><div class=paragraph><p>For remote logins, two-factor authentication should be used. An example of two-factor authentication is "something you have", such as a key, and "something you know", such as the passphrase for that key. Since OpenSSH is part of the FreeBSD base system, all network logins should be over an encrypted connection and use key-based authentication instead of passwords. For more information, refer to <a href=#openssh>OpenSSH</a>. Kerberos users may need to make additional changes to implement OpenSSH in their network. These changes are described in <a href=#kerberos5>Kerberos</a>.</p></div></div><div class=sect2><h3 id=security-pwpolicy>14.2.4. Password Policy Enforcement<a class=anchor href=#security-pwpolicy></a></h3><div class=paragraph><p>Enforcing a strong password policy for local accounts is a fundamental aspect of system security. In FreeBSD, password length, password strength, and password complexity can be implemented using built-in Pluggable Authentication Modules (PAM).</p></div><div class=paragraph><p>This section demonstrates how to configure the minimum and maximum password length and the enforcement of mixed characters using the <span class=filename>pam_passwdqc.so</span> module. This module is enforced when a user changes their password.</p></div><div class=paragraph><p>To configure this module, become the superuser and uncomment the line containing <code>pam_passwdqc.so</code> in <span class=filename>/etc/pam.d/passwd</span>. Then, edit that line to match the password policy:</p></div><div class="literalblock programlisting"><div class=content><pre>password        requisite       pam_passwdqc.so         min=disabled,disabled,disabled,12,10 similar=deny retry=3 enforce=users</pre></div></div><div class=paragraph><p>This example sets several requirements for new passwords. The <code>min</code> setting controls the minimum password length. It has five values because this module defines five different types of passwords based on their complexity. Complexity is defined by the type of characters that must exist in a password, such as letters, numbers, symbols, and case. The types of passwords are described in <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_passwdqc&amp;sektion=8&amp;format=html">pam_passwdqc(8)</a>. In this example, the first three types of passwords are disabled, meaning that passwords that meet those complexity requirements will not be accepted, regardless of their length. The <code>12</code> sets a minimum password policy of at least twelve characters, if the password also contains characters with three types of complexity. The <code>10</code> sets the password policy to also allow passwords of at least ten characters, if the password contains characters with four types of complexity.</p></div><div class=paragraph><p>The <code>similar</code> setting denies passwords that are similar to the user’s previous password. The <code>retry</code> setting provides a user with three opportunities to enter a new password.</p></div><div class=paragraph><p>Once this file is saved, a user changing their password will see a message similar to the following:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% passwd
Changing <span class=nb>local </span>password <span class=k>for </span>trhodes
Old Password:

You can now choose the new password.
A valid password should be a mix of upper and lower <span class=k>case</span> letters,
digits and other characters.  You can use a 12 character long
password with characters from at least 3 of these 4 classes, or
a 10 character long password containing characters from all the
classes.  Characters that form a common pattern are discarded by
the check.
Alternatively, <span class=k>if </span>no one <span class=k>else </span>can see your terminal now, you can
pick this as your password: <span class=s2>&#34;trait-useful&amp;knob&#34;</span><span class=nb>.</span>
Enter new password:</code></pre></div></div><div class=paragraph><p>If a password that does not match the policy is entered, it will be rejected with a warning and the user will have an opportunity to try again, up to the configured number of retries.</p></div><div class=paragraph><p>Most password policies require passwords to expire after so many days. To set a password age time in FreeBSD, set <code>passwordtime</code> for the user’s login class in <span class=filename>/etc/login.conf</span>. The <code>default</code> login class contains an example:</p></div><div class="literalblock programlisting"><div class=content><pre>#       :passwordtime=90d:\</pre></div></div><div class=paragraph><p>So, to set an expiry of 90 days for this login class, remove the comment symbol (<code>#</code>), save the edit, and run <code>cap_mkdb /etc/login.conf</code>.</p></div><div class=paragraph><p>To set the expiration on individual users, pass an expiration date or the number of days to expiry and a username to <code>pw</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pw usermod -p 30-apr-2015 -n trhodes</span></code></pre></div></div><div class=paragraph><p>As seen here, an expiration date is set in the form of day, month, and year. For more information, see <a href="https://man.freebsd.org/cgi/man.cgi?query=pw&amp;sektion=8&amp;format=html">pw(8)</a>.</p></div></div><div class=sect2><h3 id=security-rkhunter>14.2.5. Detecting Rootkits<a class=anchor href=#security-rkhunter></a></h3><div class=paragraph><p>A <em>rootkit</em> is any unauthorized software that attempts to gain <code>root</code> access to a system. Once installed, this malicious software will normally open up another avenue of entry for an attacker. Realistically, once a system has been compromised by a rootkit and an investigation has been performed, the system should be reinstalled from scratch. There is tremendous risk that even the most prudent security or systems engineer will miss something an attacker left behind.</p></div><div class=paragraph><p>A rootkit does do one thing useful for administrators: once detected, it is a sign that a compromise happened at some point. But, these types of applications tend to be very well hidden. This section demonstrates a tool that can be used to detect rootkits, <a class=package href=https://cgit.freebsd.org/ports/tree/security/rkhunter/>security/rkhunter</a>.</p></div><div class=paragraph><p>After installation of this package or port, the system may be checked using the following command. It will produce a lot of information and will require some manual pressing of <kbd>ENTER</kbd>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># rkhunter -c</span></code></pre></div></div><div class=paragraph><p>After the process completes, a status message will be printed to the screen. This message will include the amount of files checked, suspect files, possible rootkits, and more. During the check, some generic security warnings may be produced about hidden files, the OpenSSH protocol selection, and known vulnerable versions of installed software. These can be handled now or after a more detailed analysis has been performed.</p></div><div class=paragraph><p>Every administrator should know what is running on the systems they are responsible for. Third-party tools like rkhunter and <a class=package href=https://cgit.freebsd.org/ports/tree/sysutils/lsof/>sysutils/lsof</a>, and native commands such as <code>netstat</code> and <code>ps</code>, can show a great deal of information on the system. Take notes on what is normal, ask questions when something seems out of place, and be paranoid. While preventing a compromise is ideal, detecting a compromise is a must.</p></div></div><div class=sect2><h3 id=security-ids>14.2.6. Binary Verification<a class=anchor href=#security-ids></a></h3><div class=paragraph><p>Verification of system files and binaries is important because it provides the system administration and security teams information about system changes. A software application that monitors the system for changes is called an Intrusion Detection System (IDS).</p></div><div class=paragraph><p>FreeBSD provides native support for a basic IDS system. While the nightly security emails will notify an administrator of changes, the information is stored locally and there is a chance that a malicious user could modify this information in order to hide their changes to the system. As such, it is recommended to create a separate set of binary signatures and store them on a read-only, root-owned directory or, preferably, on a removable USB disk or remote rsync server.</p></div><div class=paragraph><p>The built-in <code>mtree</code> utility can be used to generate a specification of the contents of a directory. A seed, or a numeric constant, is used to generate the specification and is required to check that the specification has not changed. This makes it possible to determine if a file or binary has been modified. Since the seed value is unknown by an attacker, faking or checking the checksum values of files will be difficult to impossible. The following example generates a set of SHA256 hashes, one for each system binary in <span class=filename>/bin</span>, and saves those values to a hidden file in <code>root</code>'s home directory, <span class=filename>/root/.bin_chksum_mtree</span>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mtree -s 3483151339707503 -c -K cksum,sha256digest -p /bin &gt; /root/.bin_chksum_mtree</span>
<span class=c># mtree: /bin checksum: 3427012225</span></code></pre></div></div><div class=paragraph><p>The <em>3483151339707503</em> represents the seed. This value should be remembered, but not shared.</p></div><div class=paragraph><p>Viewing <span class=filename>/root/.bin_cksum_mtree</span> should yield output similar to the following:</p></div><div class="literalblock programlisting"><div class=content><pre>#          user: root
#       machine: dreadnaught
#          tree: /bin
#          date: Mon Feb  3 10:19:53 2014

# .
/set type=file uid=0 gid=0 mode=0555 nlink=1 flags=none
.               type=dir mode=0755 nlink=2 size=1024 \
                time=1380277977.000000000
    \133        nlink=2 size=11704 time=1380277977.000000000 \
                cksum=484492447 \
                sha256digest=6207490fbdb5ed1904441fbfa941279055c3e24d3a4049aeb45094596400662a
    cat         size=12096 time=1380277975.000000000 cksum=3909216944 \
                sha256digest=65ea347b9418760b247ab10244f47a7ca2a569c9836d77f074e7a306900c1e69
    chflags     size=8168 time=1380277975.000000000 cksum=3949425175 \
                sha256digest=c99eb6fc1c92cac335c08be004a0a5b4c24a0c0ef3712017b12c89a978b2dac3
    chio        size=18520 time=1380277975.000000000 cksum=2208263309 \
                sha256digest=ddf7c8cb92a58750a675328345560d8cc7fe14fb3ccd3690c34954cbe69fc964
    chmod       size=8640 time=1380277975.000000000 cksum=2214429708 \
                sha256digest=a435972263bf814ad8df082c0752aa2a7bdd8b74ff01431ccbd52ed1e490bbe7</pre></div></div><div class=paragraph><p>The machine’s hostname, the date and time the specification was created, and the name of the user who created the specification are included in this report. There is a checksum, size, time, and SHA256 digest for each binary in the directory.</p></div><div class=paragraph><p>To verify that the binary signatures have not changed, compare the current contents of the directory to the previously generated specification, and save the results to a file. This command requires the seed that was used to generate the original specification:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mtree -s 3483151339707503 -p /bin &lt; /root/.bin_chksum_mtree &gt;&gt; /root/.bin_chksum_output</span>
<span class=c># mtree: /bin checksum: 3427012225</span></code></pre></div></div><div class=paragraph><p>This should produce the same checksum for <span class=filename>/bin</span> that was produced when the specification was created. If no changes have occurred to the binaries in this directory, the <span class=filename>/root/.bin_chksum_output</span> output file will be empty. To simulate a change, change the date on <span class=filename>/bin/cat</span> using <code>touch</code> and run the verification command again:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># touch /bin/cat</span>
<span class=c># mtree -s 3483151339707503 -p /bin &lt; /root/.bin_chksum_mtree &gt;&gt; /root/.bin_chksum_output</span>
<span class=c># more /root/.bin_chksum_output</span>
<span class=nb>cat </span>changed
	modification <span class=nb>time </span>expected Fri Sep 27 06:32:55 2013 found Mon Feb  3 10:28:43 2014</code></pre></div></div><div class=paragraph><p>It is recommended to create specifications for the directories which contain binaries and configuration files, as well as any directories containing sensitive data. Typically, specifications are created for <span class=filename>/bin</span>, <span class=filename>/sbin</span>, <span class=filename>/usr/bin</span>, <span class=filename>/usr/sbin</span>, <span class=filename>/usr/local/bin</span>, <span class=filename>/etc</span>, and <span class=filename>/usr/local/etc</span>.</p></div><div class=paragraph><p>More advanced IDS systems exist, such as <a class=package href=https://cgit.freebsd.org/ports/tree/security/aide/>security/aide</a>. In most cases, <code>mtree</code> provides the functionality administrators need. It is important to keep the seed value and the checksum output hidden from malicious users. More information about <code>mtree</code> can be found in <a href="https://man.freebsd.org/cgi/man.cgi?query=mtree&amp;sektion=8&amp;format=html">mtree(8)</a>.</p></div></div><div class=sect2><h3 id=security-tuning>14.2.7. System Tuning for Security<a class=anchor href=#security-tuning></a></h3><div class=paragraph><p>In FreeBSD, many system features can be tuned using <code>sysctl</code>. A few of the security features which can be tuned to prevent Denial of Service (DoS) attacks will be covered in this section. More information about using <code>sysctl</code>, including how to temporarily change values and how to make the changes permanent after testing, can be found in <a href=../config/#configtuning-sysctl>“Tuning with sysctl(8)”</a>.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Any time a setting is changed with <code>sysctl</code>, the chance to cause undesired harm is increased, affecting the availability of the system. All changes should be monitored and, if possible, tried on a testing system before being used on a production system.</p></div></td></tr></tbody></table></div><div class=paragraph><p>By default, the FreeBSD kernel boots with a security level of <code>-1</code>. This is called "insecure mode" because immutable file flags may be turned off and all devices may be read from or written to. The security level will remain at <code>-1</code> unless it is altered through <code>sysctl</code> or by a setting in the startup scripts. The security level may be increased during system startup by setting <code>kern_securelevel_enable</code> to <code>YES</code> in <span class=filename>/etc/rc.conf</span>, and the value of <code>kern_securelevel</code> to the desired security level. See <a href="https://man.freebsd.org/cgi/man.cgi?query=security&amp;sektion=7&amp;format=html">security(7)</a> and <a href="https://man.freebsd.org/cgi/man.cgi?query=init&amp;sektion=8&amp;format=html">init(8)</a> for more information on these settings and the available security levels.</p></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>Increasing the <code>securelevel</code> can break Xorg and cause other issues. Be prepared to do some debugging.</p></div></td></tr></tbody></table></div><div class=paragraph><p>The <code>net.inet.tcp.blackhole</code> and <code>net.inet.udp.blackhole</code> settings can be used to drop incoming SYN packets on closed ports without sending a return RST response. The default behavior is to return an RST to show a port is closed. Changing the default provides some level of protection against ports scans, which are used to determine which applications are running on a system. Set <code>net.inet.tcp.blackhole</code> to <code>2</code> and <code>net.inet.udp.blackhole</code> to <code>1</code>. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=blackhole&amp;sektion=4&amp;format=html">blackhole(4)</a> for more information about these settings.</p></div><div class=paragraph><p>The <code>net.inet.icmp.drop_redirect</code> and <code>net.inet.ip.redirect</code> settings help prevent against <em>redirect attacks</em>. A redirect attack is a type of DoS which sends mass numbers of ICMP type 5 packets. Since these packets are not required, set <code>net.inet.icmp.drop_redirect</code> to <code>1</code> and set <code>net.inet.ip.redirect</code> to <code>0</code>.</p></div><div class=paragraph><p>Source routing is a method for detecting and accessing non-routable addresses on the internal network. This should be disabled as non-routable addresses are normally not routable on purpose. To disable this feature, set <code>net.inet.ip.sourceroute</code> and <code>net.inet.ip.accept_sourceroute</code> to <code>0</code>.</p></div><div class=paragraph><p>When a machine on the network needs to send messages to all hosts on a subnet, an ICMP echo request message is sent to the broadcast address. However, there is no reason for an external host to perform such an action. To reject all external broadcast requests, set <code>net.inet.icmp.bmcastecho</code> to <code>0</code>.</p></div><div class=paragraph><p>Some additional settings are documented in <a href="https://man.freebsd.org/cgi/man.cgi?query=security&amp;sektion=7&amp;format=html">security(7)</a>.</p></div></div></div></div><div class=sect1><h2 id=one-time-passwords>14.3. One-time Passwords<a class=anchor href=#one-time-passwords></a></h2><div class=sectionbody><div class=paragraph><p>By default, FreeBSD includes support for One-time Passwords In Everything (OPIE). OPIE is designed to prevent replay attacks, in which an attacker discovers a user’s password and uses it to access a system. Since a password is only used once in OPIE, a discovered password is of little use to an attacker. OPIE uses a secure hash and a challenge/response system to manage passwords. The FreeBSD implementation uses the MD5 hash by default.</p></div><div class=paragraph><p>OPIE uses three different types of passwords. The first is the usual UNIX® or Kerberos password. The second is the one-time password which is generated by <code>opiekey</code>. The third type of password is the "secret password" which is used to generate one-time passwords. The secret password has nothing to do with, and should be different from, the UNIX® password.</p></div><div class=paragraph><p>There are two other pieces of data that are important to OPIE. One is the "seed" or "key", consisting of two letters and five digits. The other is the "iteration count", a number between 1 and 100. OPIE creates the one-time password by concatenating the seed and the secret password, applying the MD5 hash as many times as specified by the iteration count, and turning the result into six short English words which represent the one-time password. The authentication system keeps track of the last one-time password used, and the user is authenticated if the hash of the user-provided password is equal to the previous password. Because a one-way hash is used, it is impossible to generate future one-time passwords if a successfully used password is captured. The iteration count is decremented after each successful login to keep the user and the login program in sync. When the iteration count gets down to <code>1</code>, OPIE must be reinitialized.</p></div><div class=paragraph><p>There are a few programs involved in this process. A one-time password, or a consecutive list of one-time passwords, is generated by passing an iteration count, a seed, and a secret password to <a href="https://man.freebsd.org/cgi/man.cgi?query=opiekey&amp;sektion=1&amp;format=html">opiekey(1)</a>. In addition to initializing OPIE, <a href="https://man.freebsd.org/cgi/man.cgi?query=opiepasswd&amp;sektion=1&amp;format=html">opiepasswd(1)</a> is used to change passwords, iteration counts, or seeds. The relevant credential files in <span class=filename>/etc/opiekeys</span> are examined by <a href="https://man.freebsd.org/cgi/man.cgi?query=opieinfo&amp;sektion=1&amp;format=html">opieinfo(1)</a> which prints out the invoking user’s current iteration count and seed.</p></div><div class=paragraph><p>This section describes four different sorts of operations. The first is how to set up one-time-passwords for the first time over a secure connection. The second is how to use <code>opiepasswd</code> over an insecure connection. The third is how to log in over an insecure connection. The fourth is how to generate a number of keys which can be written down or printed out to use at insecure locations.</p></div><div class=sect2><h3 id=_initializing_opie>14.3.1. Initializing OPIE<a class=anchor href=#_initializing_opie></a></h3><div class=paragraph><p>To initialize OPIE for the first time, run this command from a secure location:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% opiepasswd <span class=nt>-c</span>
Adding unfurl:
Only use this method from the console<span class=p>;</span> NEVER from remote. If you are using
telnet, xterm, or a dial-in, <span class=nb>type</span> ^C now or <span class=nb>exit </span>with no password.
Then run opiepasswd without the <span class=nt>-c</span> parameter.
Using MD5 to compute responses.
Enter new secret pass phrase:
Again new secret pass phrase:

ID unfurl OTP key is 499 to4268
MOS MALL GOAT ARM AVID COED</code></pre></div></div><div class=paragraph><p>The <code>-c</code> sets console mode which assumes that the command is being run from a secure location, such as a computer under the user’s control or a SSH session to a computer under the user’s control.</p></div><div class=paragraph><p>When prompted, enter the secret password which will be used to generate the one-time login keys. This password should be difficult to guess and should be different than the password which is associated with the user’s login account. It must be between 10 and 127 characters long. Remember this password.</p></div><div class=paragraph><p>The <code>ID</code> line lists the login name (<code>unfurl</code>), default iteration count (<code>499</code>), and default seed (<code>to4268</code>). When logging in, the system will remember these parameters and display them, meaning that they do not have to be memorized. The last line lists the generated one-time password which corresponds to those parameters and the secret password. At the next login, use this one-time password.</p></div></div><div class=sect2><h3 id=_insecure_connection_initialization>14.3.2. Insecure Connection Initialization<a class=anchor href=#_insecure_connection_initialization></a></h3><div class=paragraph><p>To initialize or change the secret password on an insecure system, a secure connection is needed to some place where <code>opiekey</code> can be run. This might be a shell prompt on a trusted machine. An iteration count is needed, where 100 is probably a good value, and the seed can either be specified or the randomly-generated one used. On the insecure connection, the machine being initialized, use <a href="https://man.freebsd.org/cgi/man.cgi?query=opiepasswd&amp;sektion=1&amp;format=html">opiepasswd(1)</a>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% opiepasswd

Updating unfurl:
You need the response from an OTP generator.
Old secret pass phrase:
	otp-md5 498 to4268 ext
	Response: GAME GAG WELT OUT DOWN CHAT
New secret pass phrase:
	otp-md5 499 to4269
	Response: LINE PAP MILK NELL BUOY TROY

ID mark OTP key is 499 gr4269
LINE PAP MILK NELL BUOY TROY</code></pre></div></div><div class=paragraph><p>To accept the default seed, press <kbd>Return</kbd>. Before entering an access password, move over to the secure connection and give it the same parameters:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% opiekey 498 to4268
Using the MD5 algorithm to compute response.
Reminder: Do not use opiekey from telnet or dial-in sessions.
Enter secret pass phrase:
GAME GAG WELT OUT DOWN CHAT</code></pre></div></div><div class=paragraph><p>Switch back over to the insecure connection, and copy the generated one-time password over to the relevant program.</p></div></div><div class=sect2><h3 id=_generating_a_single_one_time_password>14.3.3. Generating a Single One-time Password<a class=anchor href=#_generating_a_single_one_time_password></a></h3><div class=paragraph><p>After initializing OPIE and logging in, a prompt like this will be displayed:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% telnet example.com
Trying 10.0.0.1...
Connected to example.com
Escape character is <span class=s1>&#39;^]&#39;</span><span class=nb>.</span>

FreeBSD/i386 <span class=o>(</span>example.com<span class=o>)</span> <span class=o>(</span>ttypa<span class=o>)</span>

login: &lt;username&gt;
otp-md5 498 gr4269 ext
Password:</code></pre></div></div><div class=paragraph><p>The OPIE prompts provides a useful feature. If <kbd>Return</kbd> is pressed at the password prompt, the prompt will turn echo on and display what is typed. This can be useful when attempting to type in a password by hand from a printout.</p></div><div class=paragraph><p>At this point, generate the one-time password to answer this login prompt. This must be done on a trusted system where it is safe to run <a href="https://man.freebsd.org/cgi/man.cgi?query=opiekey&amp;sektion=1&amp;format=html">opiekey(1)</a>. There are versions of this command for Windows®, Mac OS® and FreeBSD. This command needs the iteration count and the seed as command line options. Use cut-and-paste from the login prompt on the machine being logged in to.</p></div><div class=paragraph><p>On the trusted system:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% opiekey 498 to4268
Using the MD5 algorithm to compute response.
Reminder: Do not use opiekey from telnet or dial-in sessions.
Enter secret pass phrase:
GAME GAG WELT OUT DOWN CHAT</code></pre></div></div><div class=paragraph><p>Once the one-time password is generated, continue to log in.</p></div></div><div class=sect2><h3 id=_generating_multiple_one_time_passwords>14.3.4. Generating Multiple One-time Passwords<a class=anchor href=#_generating_multiple_one_time_passwords></a></h3><div class=paragraph><p>Sometimes there is no access to a trusted machine or secure connection. In this case, it is possible to use <a href="https://man.freebsd.org/cgi/man.cgi?query=opiekey&amp;sektion=1&amp;format=html">opiekey(1)</a> to generate a number of one-time passwords beforehand. For example:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% opiekey <span class=nt>-n</span> 5 30 zz99999
Using the MD5 algorithm to compute response.
Reminder: Do not use opiekey from telnet or dial-in sessions.
Enter secret pass phrase: &lt;secret password&gt;
26: JOAN BORE FOSS DES NAY QUIT
27: LATE BIAS SLAY FOLK MUCH TRIG
28: SALT TIN ANTI LOON NEAL USE
29: RIO ODIN GO BYE FURY TIC
30: GREW JIVE SAN GIRD BOIL PHI</code></pre></div></div><div class=paragraph><p>The <code>-n 5</code> requests five keys in sequence, and <code>30</code> specifies what the last iteration number should be. Note that these are printed out in <em>reverse</em> order of use. The really paranoid might want to write the results down by hand; otherwise, print the list. Each line shows both the iteration count and the one-time password. Scratch off the passwords as they are used.</p></div></div><div class=sect2><h3 id=_restricting_use_of_unix_passwords>14.3.5. Restricting Use of UNIX® Passwords<a class=anchor href=#_restricting_use_of_unix_passwords></a></h3><div class=paragraph><p>OPIE can restrict the use of UNIX® passwords based on the IP address of a login session. The relevant file is <span class=filename>/etc/opieaccess</span>, which is present by default. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=opieaccess&amp;sektion=5&amp;format=html">opieaccess(5)</a> for more information on this file and which security considerations to be aware of when using it.</p></div><div class=paragraph><p>Here is a sample <span class=filename>opieaccess</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>permit 192.168.0.0 255.255.0.0</pre></div></div><div class=paragraph><p>This line allows users whose IP source address (which is vulnerable to spoofing) matches the specified value and mask, to use UNIX® passwords at any time.</p></div><div class=paragraph><p>If no rules in <span class=filename>opieaccess</span> are matched, the default is to deny non-OPIE logins.</p></div></div></div></div><div class=sect1><h2 id=tcpwrappers>14.4. TCP Wrapper<a class=anchor href=#tcpwrappers></a></h2><div class=sectionbody><div class=paragraph><p>TCP Wrapper is a host-based access control system which extends the abilities of <a href=../network-servers/#network-inetd>“The inetd Super-Server”</a>. It can be configured to provide logging support, return messages, and connection restrictions for the server daemons under the control of inetd. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=tcpd&amp;sektion=8&amp;format=html">tcpd(8)</a> for more information about TCP Wrapper and its features.</p></div><div class=paragraph><p>TCP Wrapper should not be considered a replacement for a properly configured firewall. Instead, TCP Wrapper should be used in conjunction with a firewall and other security enhancements in order to provide another layer of protection in the implementation of a security policy.</p></div><div class=sect2><h3 id=_initial_configuration>14.4.1. Initial Configuration<a class=anchor href=#_initial_configuration></a></h3><div class=paragraph><p>To enable TCP Wrapper in FreeBSD, add the following lines to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>inetd_enable=&#34;YES&#34;
inetd_flags=&#34;-Ww&#34;</pre></div></div><div class=paragraph><p>Then, properly configure <span class=filename>/etc/hosts.allow</span>.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Unlike other implementations of TCP Wrapper, the use of <span class=filename>hosts.deny</span> is deprecated in FreeBSD. All configuration options should be placed in <span class=filename>/etc/hosts.allow</span>.</p></div></td></tr></tbody></table></div><div class=paragraph><p>In the simplest configuration, daemon connection policies are set to either permit or block, depending on the options in <span class=filename>/etc/hosts.allow</span>. The default configuration in FreeBSD is to allow all connections to the daemons started with inetd.</p></div><div class=paragraph><p>Basic configuration usually takes the form of <code>daemon : address : action</code>, where <code>daemon</code> is the daemon which inetd started, <code>address</code> is a valid hostname, IP address, or an IPv6 address enclosed in brackets ([ ]), and <code>action</code> is either <code>allow</code> or <code>deny</code>. TCP Wrapper uses a first rule match semantic, meaning that the configuration file is scanned from the beginning for a matching rule. When a match is found, the rule is applied and the search process stops.</p></div><div class=paragraph><p>For example, to allow POP3 connections via the <a class=package href=https://cgit.freebsd.org/ports/tree/mail/qpopper/>mail/qpopper</a> daemon, the following lines should be appended to <span class=filename>hosts.allow</span>:</p></div><div class="literalblock programlisting"><div class=content><pre># This line is required for POP3 connections:
qpopper : ALL : allow</pre></div></div><div class=paragraph><p>Whenever this file is edited, restart inetd:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service inetd restart</span></code></pre></div></div></div><div class=sect2><h3 id=_advanced_configuration>14.4.2. Advanced Configuration<a class=anchor href=#_advanced_configuration></a></h3><div class=paragraph><p>TCP Wrapper provides advanced options to allow more control over the way connections are handled. In some cases, it may be appropriate to return a comment to certain hosts or daemon connections. In other cases, a log entry should be recorded or an email sent to the administrator. Other situations may require the use of a service for local connections only. This is all possible through the use of configuration options known as wildcards, expansion characters, and external command execution.</p></div><div class=paragraph><p>Suppose that a situation occurs where a connection should be denied yet a reason should be sent to the host who attempted to establish that connection. That action is possible with <code>twist</code>. When a connection attempt is made, <code>twist</code> executes a shell command or script. An example exists in <span class=filename>hosts.allow</span>:</p></div><div class="literalblock programlisting"><div class=content><pre># The rest of the daemons are protected.
ALL : ALL \
	: severity auth.info \
	: twist /bin/echo &#34;You are not welcome to use %d from %h.&#34;</pre></div></div><div class=paragraph><p>In this example, the message "You are not allowed to use <em>daemon name</em> from <em>hostname</em>." will be returned for any daemon not configured in <span class=filename>hosts.allow</span>. This is useful for sending a reply back to the connection initiator right after the established connection is dropped. Any message returned <em>must</em> be wrapped in quote (<code>"</code>) characters.</p></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>It may be possible to launch a denial of service attack on the server if an attacker floods these daemons with connection requests.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Another possibility is to use <code>spawn</code>. Like <code>twist</code>, <code>spawn</code> implicitly denies the connection and may be used to run external shell commands or scripts. Unlike <code>twist</code>, <code>spawn</code> will not send a reply back to the host who established the connection. For example, consider the following configuration:</p></div><div class="literalblock programlisting"><div class=content><pre># We do not allow connections from example.com:
ALL : .example.com \
	: spawn (/bin/echo %a from %h attempted to access %d &gt;&gt; \
	  /var/log/connections.log) \
	: deny</pre></div></div><div class=paragraph><p>This will deny all connection attempts from <code>*.example.com</code> and log the hostname, IP address, and the daemon to which access was attempted to <span class=filename>/var/log/connections.log</span>. This example uses the substitution characters <code>%a</code> and <code>%h</code>. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=hosts_access&amp;sektion=5&amp;format=html">hosts_access(5)</a> for the complete list.</p></div><div class=paragraph><p>To match every instance of a daemon, domain, or IP address, use <code>ALL</code>. Another wildcard is <code>PARANOID</code> which may be used to match any host which provides an IP address that may be forged because the IP address differs from its resolved hostname. In this example, all connection requests to Sendmail which have an IP address that varies from its hostname will be denied:</p></div><div class="literalblock programlisting"><div class=content><pre># Block possibly spoofed requests to sendmail:
sendmail : PARANOID : deny</pre></div></div><div class="admonitionblock caution"><table><tbody><tr><td class=icon><i class="fa icon-caution" title=Caution></i></td><td class=content><div class=paragraph><p>Using the <code>PARANOID</code> wildcard will result in denied connections if the client or server has a broken DNS setup.</p></div></td></tr></tbody></table></div><div class=paragraph><p>To learn more about wildcards and their associated functionality, refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=hosts_access&amp;sektion=5&amp;format=html">hosts_access(5)</a>.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>When adding new configuration lines, make sure that any unneeded entries for that daemon are commented out in <span class=filename>hosts.allow</span>.</p></div></td></tr></tbody></table></div></div></div></div><div class=sect1><h2 id=kerberos5>14.5. Kerberos<a class=anchor href=#kerberos5></a></h2><div class=sectionbody><div class=paragraph><p>Kerberos is a network authentication protocol which was originally created by the Massachusetts Institute of Technology (MIT) as a way to securely provide authentication across a potentially hostile network. The Kerberos protocol uses strong cryptography so that both a client and server can prove their identity without sending any unencrypted secrets over the network. Kerberos can be described as an identity-verifying proxy system and as a trusted third-party authentication system. After a user authenticates with Kerberos, their communications can be encrypted to assure privacy and data integrity.</p></div><div class=paragraph><p>The only function of Kerberos is to provide the secure authentication of users and servers on the network. It does not provide authorization or auditing functions. It is recommended that Kerberos be used with other security methods which provide authorization and audit services.</p></div><div class=paragraph><p>The current version of the protocol is version 5, described in RFC 4120. Several free implementations of this protocol are available, covering a wide range of operating systems. MIT continues to develop their Kerberos package. It is commonly used in the US as a cryptography product, and has historically been subject to US export regulations. In FreeBSD, MITKerberos is available as the <a class=package href=https://cgit.freebsd.org/ports/tree/security/krb5/>security/krb5</a> package or port. The Heimdal Kerberos implementation was explicitly developed outside of the US to avoid export regulations. The Heimdal Kerberos distribution is included in the base FreeBSD installation, and another distribution with more configurable options is available as <a class=package href=https://cgit.freebsd.org/ports/tree/security/heimdal/>security/heimdal</a> in the Ports Collection.</p></div><div class=paragraph><p>In Kerberos users and services are identified as "principals" which are contained within an administrative grouping, called a "realm". A typical user principal would be of the form <code><em>user</em>@<em>REALM</em></code> (realms are traditionally uppercase).</p></div><div class=paragraph><p>This section provides a guide on how to set up Kerberos using the Heimdal distribution included in FreeBSD.</p></div><div class=paragraph><p>For purposes of demonstrating a Kerberos installation, the name spaces will be as follows:</p></div><div class=ulist><ul><li><p>The DNS domain (zone) will be <code>example.org</code>.</p></li><li><p>The Kerberos realm will be <code>EXAMPLE.ORG</code>.</p></li></ul></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Use real domain names when setting up Kerberos, even if it will run internally. This avoids DNS problems and assures inter-operation with other Kerberos realms.</p></div></td></tr></tbody></table></div><div class=sect2><h3 id=_setting_up_a_heimdal_kdc>14.5.1. Setting up a Heimdal KDC<a class=anchor href=#_setting_up_a_heimdal_kdc></a></h3><div class=paragraph><p>The Key Distribution Center (KDC) is the centralized authentication service that Kerberos provides, the "trusted third party" of the system. It is the computer that issues Kerberos tickets, which are used for clients to authenticate to servers. Because the KDC is considered trusted by all other computers in the Kerberos realm, it has heightened security concerns. Direct access to the KDC should be limited.</p></div><div class=paragraph><p>While running a KDC requires few computing resources, a dedicated machine acting only as a KDC is recommended for security reasons.</p></div><div class=paragraph><p>To begin, install the <a class=package href=https://cgit.freebsd.org/ports/tree/security/heimdal/>security/heimdal</a> package as follows:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pkg install heimdal</span></code></pre></div></div><div class=paragraph><p>Next, update <span class=filename>/etc/rc.conf</span> using <code>sysrc</code> as follows:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sysrc kdc_enable=yes</span>
<span class=c># sysrc kadmind_enable=yes</span></code></pre></div></div><div class=paragraph><p>Next, edit <span class=filename>/etc/krb5.conf</span> as follows:</p></div><div class="literalblock programlisting"><div class=content><pre>[libdefaults]
    default_realm = EXAMPLE.ORG
[realms]
    EXAMPLE.ORG = {
	kdc = kerberos.example.org
	admin_server = kerberos.example.org
    }
[domain_realm]
    .example.org = EXAMPLE.ORG</pre></div></div><div class=paragraph><p>In this example, the KDC will use the fully-qualified hostname <code>kerberos.example.org</code>. The hostname of the KDC must be resolvable in the DNS.</p></div><div class=paragraph><p>Kerberos can also use the DNS to locate KDCs, instead of a <code>[realms]</code> section in <span class=filename>/etc/krb5.conf</span>. For large organizations that have their own DNS servers, the above example could be trimmed to:</p></div><div class="literalblock programlisting"><div class=content><pre>[libdefaults]
      default_realm = EXAMPLE.ORG
[domain_realm]
    .example.org = EXAMPLE.ORG</pre></div></div><div class=paragraph><p>With the following lines being included in the <code>example.org</code> zone file:</p></div><div class="literalblock programlisting"><div class=content><pre>_kerberos._udp      IN  SRV     01 00 88 kerberos.example.org.
_kerberos._tcp      IN  SRV     01 00 88 kerberos.example.org.
_kpasswd._udp       IN  SRV     01 00 464 kerberos.example.org.
_kerberos-adm._tcp  IN  SRV     01 00 749 kerberos.example.org.
_kerberos           IN  TXT     EXAMPLE.ORG</pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>In order for clients to be able to find the Kerberos services, they <em>must</em> have either a fully configured <span class=filename>/etc/krb5.conf</span> or a minimally configured <span class=filename>/etc/krb5.conf</span><em>and</em> a properly configured DNS server.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Next, create the Kerberos database which contains the keys of all principals (users and hosts) encrypted with a master password. It is not required to remember this password as it will be stored in <span class=filename>/var/heimdal/m-key</span>; it would be reasonable to use a 45-character random password for this purpose. To create the master key, run <code>kstash</code> and enter a password:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># kstash</span>
Master key: xxxxxxxxxxxxxxxxxxxxxxx
Verifying password - Master key: xxxxxxxxxxxxxxxxxxxxxxx</code></pre></div></div><div class=paragraph><p>Once the master key has been created, the database should be initialized. The Kerberos administrative tool <a href="https://man.freebsd.org/cgi/man.cgi?query=kadmin&amp;sektion=8&amp;format=html">kadmin(8)</a> can be used on the KDC in a mode that operates directly on the database, without using the <a href="https://man.freebsd.org/cgi/man.cgi?query=kadmind&amp;sektion=8&amp;format=html">kadmind(8)</a> network service, as <code>kadmin -l</code>. This resolves the chicken-and-egg problem of trying to connect to the database before it is created. At the <code>kadmin</code> prompt, use <code>init</code> to create the realm’s initial database:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># kadmin -l</span>
kadmin&gt; init EXAMPLE.ORG
Realm max ticket life <span class=o>[</span>unlimited]:</code></pre></div></div><div class=paragraph><p>Lastly, while still in <code>kadmin</code>, create the first principal using <code>add</code>. Stick to the default options for the principal for now, as these can be changed later with <code>modify</code>. Type <code>?</code> at the prompt to see the available options.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>kadmin&gt; add tillman
Max ticket life <span class=o>[</span>unlimited]:
Max renewable life <span class=o>[</span>unlimited]:
Principal expiration <span class=nb>time</span> <span class=o>[</span>never]:
Password expiration <span class=nb>time</span> <span class=o>[</span>never]:
Attributes <span class=o>[]</span>:
Password: xxxxxxxx
Verifying password - Password: xxxxxxxx</code></pre></div></div><div class=paragraph><p>Next, start the KDC services by running:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service kdc start</span>
<span class=c># service kadmind start</span></code></pre></div></div><div class=paragraph><p>While there will not be any kerberized daemons running at this point, it is possible to confirm that the KDC is functioning by obtaining a ticket for the principal that was just created:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% kinit tillman
tillman@EXAMPLE.ORG<span class=s1>&#39;s Password:</span></code></pre></div></div><div class=paragraph><p>Confirm that a ticket was successfully obtained using <code>klist</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% klist
Credentials cache: FILE:/tmp/krb5cc_1001
	Principal: tillman@EXAMPLE.ORG

  Issued                Expires               Principal
Aug 27 15:37:58 2013  Aug 28 01:37:58 2013  krbtgt/EXAMPLE.ORG@EXAMPLE.ORG</code></pre></div></div><div class=paragraph><p>The temporary ticket can be destroyed when the test is finished:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% kdestroy</code></pre></div></div></div><div class=sect2><h3 id=_configuring_a_server_to_use_kerberos>14.5.2. Configuring a Server to Use Kerberos<a class=anchor href=#_configuring_a_server_to_use_kerberos></a></h3><div class=paragraph><p>The first step in configuring a server to use Kerberos authentication is to ensure that it has the correct configuration in <span class=filename>/etc/krb5.conf</span>. The version from the KDC can be used as-is, or it can be regenerated on the new system.</p></div><div class=paragraph><p>Next, create <span class=filename>/etc/krb5.keytab</span> on the server. This is the main part of "Kerberizing" a service - it corresponds to generating a secret shared between the service and the KDC. The secret is a cryptographic key, stored in a "keytab". The keytab contains the server’s host key, which allows it and the KDC to verify each others' identity. It must be transmitted to the server in a secure fashion, as the security of the server can be broken if the key is made public. Typically, the <span class=filename>keytab</span> is generated on an administrator’s trusted machine using <code>kadmin</code>, then securely transferred to the server, e.g., with <a href="https://man.freebsd.org/cgi/man.cgi?query=scp&amp;sektion=1&amp;format=html">scp(1)</a>; it can also be created directly on the server if that is consistent with the desired security policy. It is very important that the keytab is transmitted to the server in a secure fashion: if the key is known by some other party, that party can impersonate any user to the server! Using <code>kadmin</code> on the server directly is convenient, because the entry for the host principal in the KDC database is also created using <code>kadmin</code>.</p></div><div class=paragraph><p>Of course, <code>kadmin</code> is a kerberized service; a Kerberos ticket is needed to authenticate to the network service, but to ensure that the user running <code>kadmin</code> is actually present (and their session has not been hijacked), <code>kadmin</code> will prompt for the password to get a fresh ticket. The principal authenticating to the kadmin service must be permitted to use the <code>kadmin</code> interface, as specified in <span class=filename>/var/heimdal/kadmind.acl</span>. See the section titled "Remote administration" in <code>info heimdal</code> for details on designing access control lists. Instead of enabling remote <code>kadmin</code> access, the administrator could securely connect to the KDC via the local console or <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;format=html">ssh(1)</a>, and perform administration locally using <code>kadmin -l</code>.</p></div><div class=paragraph><p>After installing <span class=filename>/etc/krb5.conf</span>, use <code>add --random-key</code> in <code>kadmin</code>. This adds the server’s host principal to the database, but does not extract a copy of the host principal key to a keytab. To generate the keytab, use <code>ext</code> to extract the server’s host principal key to its own keytab:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># kadmin</span>
kadmin&gt; add <span class=nt>--random-key</span> host/myserver.example.org
Max ticket life <span class=o>[</span>unlimited]:
Max renewable life <span class=o>[</span>unlimited]:
Principal expiration <span class=nb>time</span> <span class=o>[</span>never]:
Password expiration <span class=nb>time</span> <span class=o>[</span>never]:
Attributes <span class=o>[]</span>:
kadmin&gt; ext_keytab host/myserver.example.org
kadmin&gt; <span class=nb>exit</span></code></pre></div></div><div class=paragraph><p>Note that <code>ext_keytab</code> stores the extracted key in <span class=filename>/etc/krb5.keytab</span> by default. This is good when being run on the server being kerberized, but the <code>--keytab <em>path/to/file</em></code> argument should be used when the keytab is being extracted elsewhere:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># kadmin</span>
kadmin&gt; ext_keytab <span class=nt>--keytab</span><span class=o>=</span>/tmp/example.keytab host/myserver.example.org
kadmin&gt; <span class=nb>exit</span></code></pre></div></div><div class=paragraph><p>The keytab can then be securely copied to the server using <a href="https://man.freebsd.org/cgi/man.cgi?query=scp&amp;sektion=1&amp;format=html">scp(1)</a> or a removable media. Be sure to specify a non-default keytab name to avoid inserting unneeded keys into the system’s keytab.</p></div><div class=paragraph><p>At this point, the server can read encrypted messages from the KDC using its shared key, stored in <span class=filename>krb5.keytab</span>. It is now ready for the Kerberos-using services to be enabled. One of the most common such services is <a href="https://man.freebsd.org/cgi/man.cgi?query=sshd&amp;sektion=8&amp;format=html">sshd(8)</a>, which supports Kerberos via the GSS-API. In <span class=filename>/etc/ssh/sshd_config</span>, add the line:</p></div><div class="literalblock programlisting"><div class=content><pre>GSSAPIAuthentication yes</pre></div></div><div class=paragraph><p>After making this change, <a href="https://man.freebsd.org/cgi/man.cgi?query=sshd&amp;sektion=8&amp;format=html">sshd(8)</a> must be restarted for the new configuration to take effect: <code>service sshd restart</code>.</p></div></div><div class=sect2><h3 id=_configuring_a_client_to_use_kerberos>14.5.3. Configuring a Client to Use Kerberos<a class=anchor href=#_configuring_a_client_to_use_kerberos></a></h3><div class=paragraph><p>As it was for the server, the client requires configuration in <span class=filename>/etc/krb5.conf</span>. Copy the file in place (securely) or re-enter it as needed.</p></div><div class=paragraph><p>Test the client by using <code>kinit</code>, <code>klist</code>, and <code>kdestroy</code> from the client to obtain, show, and then delete a ticket for an existing principal. Kerberos applications should also be able to connect to Kerberos enabled servers. If that does not work but obtaining a ticket does, the problem is likely with the server and not with the client or the KDC. In the case of kerberized <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;format=html">ssh(1)</a>, GSS-API is disabled by default, so test using <code>ssh -o GSSAPIAuthentication=yes <em>hostname</em></code>.</p></div><div class=paragraph><p>When testing a Kerberized application, try using a packet sniffer such as <code>tcpdump</code> to confirm that no sensitive information is sent in the clear.</p></div><div class=paragraph><p>Various Kerberos client applications are available. With the advent of a bridge so that applications using SASL for authentication can use GSS-API mechanisms as well, large classes of client applications can use Kerberos for authentication, from Jabber clients to IMAP clients.</p></div><div class=paragraph><p>Users within a realm typically have their Kerberos principal mapped to a local user account. Occasionally, one needs to grant access to a local user account to someone who does not have a matching Kerberos principal. For example, <code>tillman@EXAMPLE.ORG</code> may need access to the local user account <code>webdevelopers</code>. Other principals may also need access to that local account.</p></div><div class=paragraph><p>The <span class=filename>.k5login</span> and <span class=filename>.k5users</span> files, placed in a user’s home directory, can be used to solve this problem. For example, if the following <span class=filename>.k5login</span> is placed in the home directory of <code>webdevelopers</code>, both principals listed will have access to that account without requiring a shared password:</p></div><div class="literalblock programlisting"><div class=content><pre>tillman@example.org
jdoe@example.org</pre></div></div><div class=paragraph><p>Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=ksu&amp;sektion=1&amp;format=html">ksu(1)</a> for more information about <span class=filename>.k5users</span>.</p></div></div><div class=sect2><h3 id=_mit_differences>14.5.4. MIT Differences<a class=anchor href=#_mit_differences></a></h3><div class=paragraph><p>The major difference between the MIT and Heimdal implementations is that <code>kadmin</code> has a different, but equivalent, set of commands and uses a different protocol. If the KDC is MIT, the Heimdal version of <code>kadmin</code> cannot be used to administer the KDC remotely, and vice versa.</p></div><div class=paragraph><p>Client applications may also use slightly different command line options to accomplish the same tasks. Following the instructions at <a href=http://web.mit.edu/Kerberos/www/>http://web.mit.edu/Kerberos/www/</a> is recommended. Be careful of path issues: the MIT port installs into <span class=filename>/usr/local/</span> by default, and the FreeBSD system applications run instead of the MIT versions if <code>PATH</code> lists the system directories first.</p></div><div class=paragraph><p>When using MIT Kerberos as a KDC on FreeBSD, the following edits should also be made to <span class=filename>rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>kdc_program=&#34;/usr/local/sbin/kdc&#34;
kadmind_program=&#34;/usr/local/sbin/kadmind&#34;
kdc_flags=&#34;&#34;
kdc_enable=&#34;YES&#34;
kadmind_enable=&#34;YES&#34;</pre></div></div></div><div class=sect2><h3 id=_kerberos_tips_tricks_and_troubleshooting>14.5.5. Kerberos Tips, Tricks, and Troubleshooting<a class=anchor href=#_kerberos_tips_tricks_and_troubleshooting></a></h3><div class=paragraph><p>When configuring and troubleshooting Kerberos, keep the following points in mind:</p></div><div class=ulist><ul><li><p>When using either Heimdal or MITKerberos from ports, ensure that the <code>PATH</code> lists the port’s versions of the client applications before the system versions.</p></li><li><p>If all the computers in the realm do not have synchronized time settings, authentication may fail. <a href=../network-servers/#network-ntp>“Clock Synchronization with NTP”</a> describes how to synchronize clocks using NTP.</p></li><li><p>If the hostname is changed, the <code>host/</code> principal must be changed and the keytab updated. This also applies to special keytab entries like the <code>HTTP/</code> principal used for Apache’s <a class=package href=https://cgit.freebsd.org/ports/tree/www/mod_auth_kerb/>www/mod_auth_kerb</a>.</p></li><li><p>All hosts in the realm must be both forward and reverse resolvable in DNS or, at a minimum, exist in <span class=filename>/etc/hosts</span>. CNAMEs will work, but the A and PTR records must be correct and in place. The error message for unresolvable hosts is not intuitive: <code>Kerberos5 refuses authentication because Read req failed: Key table entry not found</code>.</p></li><li><p>Some operating systems that act as clients to the KDC do not set the permissions for <code>ksu</code> to be setuid <code>root</code>. This means that <code>ksu</code> does not work. This is a permissions problem, not a KDC error.</p></li><li><p>With MITKerberos, to allow a principal to have a ticket life longer than the default lifetime of ten hours, use <code>modify_principal</code> at the <a href="https://man.freebsd.org/cgi/man.cgi?query=kadmin&amp;sektion=8&amp;format=html">kadmin(8)</a> prompt to change the <code>maxlife</code> of both the principal in question and the <code>krbtgt</code> principal. The principal can then use <code>kinit -l</code> to request a ticket with a longer lifetime.</p></li><li><p>When running a packet sniffer on the KDC to aid in troubleshooting while running <code>kinit</code> from a workstation, the Ticket Granting Ticket (TGT) is sent immediately, even before the password is typed. This is because the Kerberos server freely transmits a TGT to any unauthorized request. However, every TGT is encrypted in a key derived from the user’s password. When a user types their password, it is not sent to the KDC, it is instead used to decrypt the TGT that <code>kinit</code> already obtained. If the decryption process results in a valid ticket with a valid time stamp, the user has valid Kerberos credentials. These credentials include a session key for establishing secure communications with the Kerberos server in the future, as well as the actual TGT, which is encrypted with the Kerberos server’s own key. This second layer of encryption allows the Kerberos server to verify the authenticity of each TGT.</p></li><li><p>Host principals can have a longer ticket lifetime. If the user principal has a lifetime of a week but the host being connected to has a lifetime of nine hours, the user cache will have an expired host principal and the ticket cache will not work as expected.</p></li><li><p>When setting up <span class=filename>krb5.dict</span> to prevent specific bad passwords from being used as described in <a href="https://man.freebsd.org/cgi/man.cgi?query=kadmind&amp;sektion=8&amp;format=html">kadmind(8)</a>, remember that it only applies to principals that have a password policy assigned to them. The format used in <span class=filename>krb5.dict</span> is one string per line. Creating a symbolic link to <span class=filename>/usr/shared/dict/words</span> might be useful.</p></li></ul></div></div><div class=sect2><h3 id=_mitigating_kerberos_limitations>14.5.6. Mitigating Kerberos Limitations<a class=anchor href=#_mitigating_kerberos_limitations></a></h3><div class=paragraph><p>Since Kerberos is an all or nothing approach, every service enabled on the network must either be modified to work with Kerberos or be otherwise secured against network attacks. This is to prevent user credentials from being stolen and re-used. An example is when Kerberos is enabled on all remote shells but the non-Kerberized POP3 mail server sends passwords in plain text.</p></div><div class=paragraph><p>The KDC is a single point of failure. By design, the KDC must be as secure as its master password database. The KDC should have absolutely no other services running on it and should be physically secure. The danger is high because Kerberos stores all passwords encrypted with the same master key which is stored as a file on the KDC.</p></div><div class=paragraph><p>A compromised master key is not quite as bad as one might fear. The master key is only used to encrypt the Kerberos database and as a seed for the random number generator. As long as access to the KDC is secure, an attacker cannot do much with the master key.</p></div><div class=paragraph><p>If the KDC is unavailable, network services are unusable as authentication cannot be performed. This can be alleviated with a single master KDC and one or more slaves, and with careful implementation of secondary or fall-back authentication using PAM.</p></div><div class=paragraph><p>Kerberos allows users, hosts and services to authenticate between themselves. It does not have a mechanism to authenticate the KDC to the users, hosts, or services. This means that a trojanned <code>kinit</code> could record all user names and passwords. File system integrity checking tools like <a class=package href=https://cgit.freebsd.org/ports/tree/security/tripwire/>security/tripwire</a> can alleviate this.</p></div></div><div class=sect2><h3 id=_resources_and_further_information>14.5.7. Resources and Further Information<a class=anchor href=#_resources_and_further_information></a></h3><div class=ulist><ul><li><p><a href=http://www.faqs.org/faqs/Kerberos-faq/general/preamble.html>The Kerberos FAQ</a></p></li><li><p><a href=http://web.mit.edu/Kerberos/www/dialogue.html>Designing an Authentication System: a Dialog in Four Scenes</a></p></li><li><p><a href=https://www.ietf.org/rfc/rfc4120.txt>RFC 4120, The Kerberos Network Authentication Service (V5)</a></p></li><li><p><a href=http://web.mit.edu/Kerberos/www/>MIT Kerberos home page</a></p></li><li><p><a href=https://github.com/heimdal/heimdal/wiki>Heimdal Kerberos project wiki page</a></p></li></ul></div></div></div></div><div class=sect1><h2 id=openssl>14.6. OpenSSL<a class=anchor href=#openssl></a></h2><div class=sectionbody><div class=paragraph><p>OpenSSL is an open source implementation of the SSL and TLS protocols. It provides an encryption transport layer on top of the normal communications layer, allowing it to be intertwined with many network applications and services.</p></div><div class=paragraph><p>The version of OpenSSL included in FreeBSD supports the Secure Sockets Layer 3.0 (SSLv3) and Transport Layer Security 1.0/1.1/1.2 (TLSv1/TLSv1.1/TLSv1.2) network security protocols and can be used as a general cryptographic library. In FreeBSD 12.0-RELEASE and above, OpenSSL also supports Transport Layer Security 1.3 (TLSv1.3).</p></div><div class=paragraph><p>OpenSSL is often used to encrypt authentication of mail clients and to secure web based transactions such as credit card payments. Some ports, such as <a class=package href=https://cgit.freebsd.org/ports/tree/www/apache24/>www/apache24</a> and <a class=package href=https://cgit.freebsd.org/ports/tree/databases/postgresql11-server/>databases/postgresql11-server</a>, include a compile option for building with OpenSSL. If selected, the port will add support using OpenSSL from the base system. To instead have the port compile against OpenSSL from the <a class=package href=https://cgit.freebsd.org/ports/tree/security/openssl/>security/openssl</a> port, add the following to <span class=filename>/etc/make.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>DEFAULT_VERSIONS+= ssl=openssl</pre></div></div><div class=paragraph><p>Another common use of OpenSSL is to provide certificates for use with software applications. Certificates can be used to verify the credentials of a company or individual. If a certificate has not been signed by an external <em>Certificate Authority</em> (CA), such as <a href=http://www.verisign.com>http://www.verisign.com</a>, the application that uses the certificate will produce a warning. There is a cost associated with obtaining a signed certificate and using a signed certificate is not mandatory as certificates can be self-signed. However, using an external authority will prevent warnings and can put users at ease.</p></div><div class=paragraph><p>This section demonstrates how to create and use certificates on a FreeBSD system. Refer to <a href=../network-servers/#ldap-config>“Configuring an LDAP Server”</a> for an example of how to create a CA for signing one’s own certificates.</p></div><div class=paragraph><p>For more information about SSL, read the free <a href=https://www.feistyduck.com/books/openssl-cookbook/>OpenSSL Cookbook</a>.</p></div><div class=sect2><h3 id=_generating_certificates>14.6.1. Generating Certificates<a class=anchor href=#_generating_certificates></a></h3><div class=paragraph><p>To generate a certificate that will be signed by an external CA, issue the following command and input the information requested at the prompts. This input information will be written to the certificate. At the <code>Common Name</code> prompt, input the fully qualified name for the system that will use the certificate. If this name does not match the server, the application verifying the certificate will issue a warning to the user, rendering the verification provided by the certificate as useless.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># openssl req -new -nodes -out req.pem -keyout cert.key -sha256 -newkey rsa:2048</span>
Generating a 2048 bit RSA private key
..................+++
.............................................................+++
writing new private key to <span class=s1>&#39;cert.key&#39;</span>
<span class=nt>-----</span>
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter <span class=s1>&#39;.&#39;</span>, the field will be left blank.
<span class=nt>-----</span>
Country Name <span class=o>(</span>2 letter code<span class=o>)</span> <span class=o>[</span>AU]:US
State or Province Name <span class=o>(</span>full name<span class=o>)</span> <span class=o>[</span>Some-State]:PA
Locality Name <span class=o>(</span>eg, city<span class=o>)</span> <span class=o>[]</span>:Pittsburgh
Organization Name <span class=o>(</span>eg, company<span class=o>)</span> <span class=o>[</span>Internet Widgits Pty Ltd]:My Company
Organizational Unit Name <span class=o>(</span>eg, section<span class=o>)</span> <span class=o>[]</span>:Systems Administrator
Common Name <span class=o>(</span>eg, YOUR name<span class=o>)</span> <span class=o>[]</span>:localhost.example.org
Email Address <span class=o>[]</span>:trhodes@FreeBSD.org

Please enter the following <span class=s1>&#39;extra&#39;</span> attributes
to be sent with your certificate request
A challenge password <span class=o>[]</span>:
An optional company name <span class=o>[]</span>:Another Name</code></pre></div></div><div class=paragraph><p>Other options, such as the expire time and alternate encryption algorithms, are available when creating a certificate. A complete list of options is described in <a href="https://man.freebsd.org/cgi/man.cgi?query=openssl&amp;sektion=1&amp;format=html">openssl(1)</a>.</p></div><div class=paragraph><p>This command will create two files in the current directory. The certificate request, <span class=filename>req.pem</span>, can be sent to a CA who will validate the entered credentials, sign the request, and return the signed certificate. The second file, <span class=filename>cert.key</span>, is the private key for the certificate and should be stored in a secure location. If this falls in the hands of others, it can be used to impersonate the user or the server.</p></div><div class=paragraph><p>Alternately, if a signature from a CA is not required, a self-signed certificate can be created. First, generate the RSA key:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># openssl genrsa -rand -genkey -out cert.key 2048</span>
0 semi-random bytes loaded
Generating RSA private key, 2048 bit long modulus
.............................................+++
.................................................................................................................+++
e is 65537 <span class=o>(</span>0x10001<span class=o>)</span></code></pre></div></div><div class=paragraph><p>Use this key to create a self-signed certificate. Follow the usual prompts for creating a certificate:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># openssl req -new -x509 -days 365 -key cert.key -out cert.crt -sha256</span>
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter <span class=s1>&#39;.&#39;</span>, the field will be left blank.
<span class=nt>-----</span>
Country Name <span class=o>(</span>2 letter code<span class=o>)</span> <span class=o>[</span>AU]:US
State or Province Name <span class=o>(</span>full name<span class=o>)</span> <span class=o>[</span>Some-State]:PA
Locality Name <span class=o>(</span>eg, city<span class=o>)</span> <span class=o>[]</span>:Pittsburgh
Organization Name <span class=o>(</span>eg, company<span class=o>)</span> <span class=o>[</span>Internet Widgits Pty Ltd]:My Company
Organizational Unit Name <span class=o>(</span>eg, section<span class=o>)</span> <span class=o>[]</span>:Systems Administrator
Common Name <span class=o>(</span>e.g. server FQDN or YOUR name<span class=o>)</span> <span class=o>[]</span>:localhost.example.org
Email Address <span class=o>[]</span>:trhodes@FreeBSD.org</code></pre></div></div><div class=paragraph><p>This will create two new files in the current directory: a private key file <span class=filename>cert.key</span>, and the certificate itself, <span class=filename>cert.crt</span>. These should be placed in a directory, preferably under <span class=filename>/etc/ssl/</span>, which is readable only by <code>root</code>. Permissions of <code>0700</code> are appropriate for these files and can be set using <code>chmod</code>.</p></div></div><div class=sect2><h3 id=_using_certificates>14.6.2. Using Certificates<a class=anchor href=#_using_certificates></a></h3><div class=paragraph><p>One use for a certificate is to encrypt connections to the Sendmail mail server in order to prevent the use of clear text authentication.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Some mail clients will display an error if the user has not installed a local copy of the certificate. Refer to the documentation included with the software for more information on certificate installation.</p></div></td></tr></tbody></table></div><div class=paragraph><p>In FreeBSD 10.0-RELEASE and above, it is possible to create a self-signed certificate for Sendmail automatically. To enable this, add the following lines to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>sendmail_enable=&#34;YES&#34;
sendmail_cert_create=&#34;YES&#34;
sendmail_cert_cn=&#34;localhost.example.org&#34;</pre></div></div><div class=paragraph><p>This will automatically create a self-signed certificate, <span class=filename>/etc/mail/certs/host.cert</span>, a signing key, <span class=filename>/etc/mail/certs/host.key</span>, and a CA certificate, <span class=filename>/etc/mail/certs/cacert.pem</span>. The certificate will use the <code>Common Name</code> specified in <code>sendmail_cert_cn</code>. After saving the edits, restart Sendmail:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service sendmail restart</span></code></pre></div></div><div class=paragraph><p>If all went well, there will be no error messages in <span class=filename>/var/log/maillog</span>. For a simple test, connect to the mail server’s listening port using <code>telnet</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># telnet example.com 25</span>
Trying 192.0.34.166...
Connected to example.com.
Escape character is <span class=s1>&#39;^]&#39;</span><span class=nb>.</span>
220 example.com ESMTP Sendmail 8.14.7/8.14.7<span class=p>;</span> Fri, 18 Apr 2014 11:50:32 <span class=nt>-0400</span> <span class=o>(</span>EDT<span class=o>)</span>
ehlo example.com
250-example.com Hello example.com <span class=o>[</span>192.0.34.166], pleased to meet you
250-ENHANCEDSTATUSCODES
250-PIPELINING
250-8BITMIME
250-SIZE
250-DSN
250-ETRN
250-AUTH LOGIN PLAIN
250-STARTTLS
250-DELIVERBY
250 HELP
quit
221 2.0.0 example.com closing connection
Connection closed by foreign host.</code></pre></div></div><div class=paragraph><p>If the <code>STARTTLS</code> line appears in the output, everything is working correctly.</p></div></div></div></div><div class=sect1><h2 id=ipsec>14.7. VPN over IPsec<a class=anchor href=#ipsec></a></h2><div class=sectionbody><div class=paragraph><p>Internet Protocol Security (IPsec) is a set of protocols which sit on top of the Internet Protocol (IP) layer. It allows two or more hosts to communicate in a secure manner by authenticating and encrypting each IP packet of a communication session. The FreeBSD IPsec network stack is based on the <a href=http://www.kame.net/>http://www.kame.net/</a> implementation and supports both IPv4 and IPv6 sessions.</p></div><div class=paragraph><p>IPsec is comprised of the following sub-protocols:</p></div><div class=ulist><ul><li><p><em>Encapsulated Security Payload (ESP)</em>: this protocol protects the IP packet data from third party interference by encrypting the contents using symmetric cryptography algorithms such as Blowfish and 3DES.</p></li><li><p><em>Authentication Header (AH)</em>: this protocol protects the IP packet header from third party interference and spoofing by computing a cryptographic checksum and hashing the IP packet header fields with a secure hashing function. This is then followed by an additional header that contains the hash, to allow the information in the packet to be authenticated.</p></li><li><p><em>IP Payload Compression Protocol (IPComp</em>): this protocol tries to increase communication performance by compressing the IP payload in order to reduce the amount of data sent.</p></li></ul></div><div class=paragraph><p>These protocols can either be used together or separately, depending on the environment.</p></div><div class=paragraph><p>IPsec supports two modes of operation. The first mode, <em>Transport Mode</em>, protects communications between two hosts. The second mode, <em>Tunnel Mode</em>, is used to build virtual tunnels, commonly known as Virtual Private Networks (VPNs). Consult <a href="https://man.freebsd.org/cgi/man.cgi?query=ipsec&amp;sektion=4&amp;format=html">ipsec(4)</a> for detailed information on the IPsec subsystem in FreeBSD.</p></div><div class=paragraph><p>IPsec support is enabled by default on FreeBSD 11 and later. For previous versions of FreeBSD, add these options to a custom kernel configuration file and rebuild the kernel using the instructions in <a href=../kernelconfig/#kernelconfig>Configuring the FreeBSD Kernel</a>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>options   IPSEC        IP security
device    crypto</code></pre></div></div><div class=paragraph><p>If IPsec debugging support is desired, the following kernel option should also be added:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>options   IPSEC_DEBUG  debug <span class=k>for </span>IP security</code></pre></div></div><div class=paragraph><p>This rest of this chapter demonstrates the process of setting up an IPsecVPN between a home network and a corporate network. In the example scenario:</p></div><div class=ulist><ul><li><p>Both sites are connected to the Internet through a gateway that is running FreeBSD.</p></li><li><p>The gateway on each network has at least one external IP address. In this example, the corporate LAN’s external IP address is <code>172.16.5.4</code> and the home LAN’s external IP address is <code>192.168.1.12</code>.</p></li><li><p>The internal addresses of the two networks can be either public or private IP addresses. However, the address space must not collide. For example, both networks cannot use <code>192.168.1.x</code>. In this example, the corporate LAN’s internal IP address is <code>10.246.38.1</code> and the home LAN’s internal IP address is <code>10.0.0.5</code>.</p></li></ul></div><div class=sect2><h3 id=_configuring_a_vpn_on_freebsd>14.7.1. Configuring a VPN on FreeBSD<a class=anchor href=#_configuring_a_vpn_on_freebsd></a></h3><div class=paragraph><p>To begin, <a class=package href=https://cgit.freebsd.org/ports/tree/security/ipsec-tools/>security/ipsec-tools</a> must be installed from the Ports Collection. This software provides a number of applications which support the configuration.</p></div><div class=paragraph><p>The next requirement is to create two <a href="https://man.freebsd.org/cgi/man.cgi?query=gif&amp;sektion=4&amp;format=html">gif(4)</a> pseudo-devices which will be used to tunnel packets and allow both networks to communicate properly. As <code>root</code>, run the following commands, replacing <em>internal</em> and <em>external</em> with the real IP addresses of the internal and external interfaces of the two gateways:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig gif0 create</span>
<span class=c># ifconfig gif0 internal1 internal2</span>
<span class=c># ifconfig gif0 tunnel external1 external2</span></code></pre></div></div><div class=paragraph><p>Verify the setup on each gateway, using <code>ifconfig</code>. Here is the output from Gateway 1:</p></div><div class="literalblock programlisting"><div class=content><pre>gif0: flags=8051 mtu 1280
tunnel inet 172.16.5.4 --&gt; 192.168.1.12
inet6 fe80::2e0:81ff:fe02:5881%gif0 prefixlen 64 scopeid 0x6
inet 10.246.38.1 --&gt; 10.0.0.5 netmask 0xffffff00</pre></div></div><div class=paragraph><p>Here is the output from Gateway 2:</p></div><div class="literalblock programlisting"><div class=content><pre>gif0: flags=8051 mtu 1280
tunnel inet 192.168.1.12 --&gt; 172.16.5.4
inet 10.0.0.5 --&gt; 10.246.38.1 netmask 0xffffff00
inet6 fe80::250:bfff:fe3a:c1f%gif0 prefixlen 64 scopeid 0x4</pre></div></div><div class=paragraph><p>Once complete, both internal IP addresses should be reachable using <a href="https://man.freebsd.org/cgi/man.cgi?query=ping&amp;sektion=8&amp;format=html">ping(8)</a>:</p></div><div class="literalblock programlisting"><div class=content><pre>priv-net# ping 10.0.0.5
PING 10.0.0.5 (10.0.0.5): 56 data bytes
64 bytes from 10.0.0.5: icmp_seq=0 ttl=64 time=42.786 ms
64 bytes from 10.0.0.5: icmp_seq=1 ttl=64 time=19.255 ms
64 bytes from 10.0.0.5: icmp_seq=2 ttl=64 time=20.440 ms
64 bytes from 10.0.0.5: icmp_seq=3 ttl=64 time=21.036 ms
--- 10.0.0.5 ping statistics ---
4 packets transmitted, 4 packets received, 0% packet loss
round-trip min/avg/max/stddev = 19.255/25.879/42.786/9.782 ms

corp-net# ping 10.246.38.1
PING 10.246.38.1 (10.246.38.1): 56 data bytes
64 bytes from 10.246.38.1: icmp_seq=0 ttl=64 time=28.106 ms
64 bytes from 10.246.38.1: icmp_seq=1 ttl=64 time=42.917 ms
64 bytes from 10.246.38.1: icmp_seq=2 ttl=64 time=127.525 ms
64 bytes from 10.246.38.1: icmp_seq=3 ttl=64 time=119.896 ms
64 bytes from 10.246.38.1: icmp_seq=4 ttl=64 time=154.524 ms
--- 10.246.38.1 ping statistics ---
5 packets transmitted, 5 packets received, 0% packet loss
round-trip min/avg/max/stddev = 28.106/94.594/154.524/49.814 ms</pre></div></div><div class=paragraph><p>As expected, both sides have the ability to send and receive ICMP packets from the privately configured addresses. Next, both gateways must be told how to route packets in order to correctly send traffic from either network. The following commands will achieve this goal:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>corp-net# route add 10.0.0.0 10.0.0.5 255.255.255.0
corp-net# route add net 10.0.0.0: gateway 10.0.0.5
priv-net# route add 10.246.38.0 10.246.38.1 255.255.255.0
priv-net# route add host 10.246.38.0: gateway 10.246.38.1</code></pre></div></div><div class=paragraph><p>At this point, internal machines should be reachable from each gateway as well as from machines behind the gateways. Again, use <a href="https://man.freebsd.org/cgi/man.cgi?query=ping&amp;sektion=8&amp;format=html">ping(8)</a> to confirm:</p></div><div class="literalblock programlisting"><div class=content><pre>corp-net# ping 10.0.0.8
PING 10.0.0.8 (10.0.0.8): 56 data bytes
64 bytes from 10.0.0.8: icmp_seq=0 ttl=63 time=92.391 ms
64 bytes from 10.0.0.8: icmp_seq=1 ttl=63 time=21.870 ms
64 bytes from 10.0.0.8: icmp_seq=2 ttl=63 time=198.022 ms
64 bytes from 10.0.0.8: icmp_seq=3 ttl=63 time=22.241 ms
64 bytes from 10.0.0.8: icmp_seq=4 ttl=63 time=174.705 ms
--- 10.0.0.8 ping statistics ---
5 packets transmitted, 5 packets received, 0% packet loss
round-trip min/avg/max/stddev = 21.870/101.846/198.022/74.001 ms

priv-net# ping 10.246.38.107
PING 10.246.38.1 (10.246.38.107): 56 data bytes
64 bytes from 10.246.38.107: icmp_seq=0 ttl=64 time=53.491 ms
64 bytes from 10.246.38.107: icmp_seq=1 ttl=64 time=23.395 ms
64 bytes from 10.246.38.107: icmp_seq=2 ttl=64 time=23.865 ms
64 bytes from 10.246.38.107: icmp_seq=3 ttl=64 time=21.145 ms
64 bytes from 10.246.38.107: icmp_seq=4 ttl=64 time=36.708 ms
--- 10.246.38.107 ping statistics ---
5 packets transmitted, 5 packets received, 0% packet loss
round-trip min/avg/max/stddev = 21.145/31.721/53.491/12.179 ms</pre></div></div><div class=paragraph><p>Setting up the tunnels is the easy part. Configuring a secure link is a more in depth process. The following configuration uses pre-shared (PSK) RSA keys. Other than the IP addresses, the <span class=filename>/usr/local/etc/racoon/racoon.conf</span> on both gateways will be identical and look similar to:</p></div><div class="literalblock programlisting"><div class=content><pre>path    pre_shared_key  &#34;/usr/local/etc/racoon/psk.txt&#34;; #location of pre-shared key file
log     debug;	#log verbosity setting: set to &#39;notify&#39; when testing and debugging is complete

padding	# options are not to be changed
{
        maximum_length  20;
        randomize       off;
        strict_check    off;
        exclusive_tail  off;
}

timer	# timing options. change as needed
{
        counter         5;
        interval        20 sec;
        persend         1;
#       natt_keepalive  15 sec;
        phase1          30 sec;
        phase2          15 sec;
}

listen	# address [port] that racoon will listen on
{
        isakmp          172.16.5.4 [500];
        isakmp_natt     172.16.5.4 [4500];
}

remote  192.168.1.12 [500]
{
        exchange_mode   main,aggressive;
        doi             ipsec_doi;
        situation       identity_only;
        my_identifier   address 172.16.5.4;
        peers_identifier        address 192.168.1.12;
        lifetime        time 8 hour;
        passive         off;
        proposal_check  obey;
#       nat_traversal   off;
        generate_policy off;

                        proposal {
                                encryption_algorithm    blowfish;
                                hash_algorithm          md5;
                                authentication_method   pre_shared_key;
                                lifetime time           30 sec;
                                dh_group                1;
                        }
}

sainfo  (address 10.246.38.0/24 any address 10.0.0.0/24 any)	# address $network/$netmask $type address $network/$netmask $type ( $type being any or esp)
{								# $network must be the two internal networks you are joining.
        pfs_group       1;
        lifetime        time    36000 sec;
        encryption_algorithm    blowfish,3des;
        authentication_algorithm        hmac_md5,hmac_sha1;
        compression_algorithm   deflate;
}</pre></div></div><div class=paragraph><p>For descriptions of each available option, refer to the manual page for <span class=filename>racoon.conf</span>.</p></div><div class=paragraph><p>The Security Policy Database (SPD) needs to be configured so that FreeBSD and racoon are able to encrypt and decrypt network traffic between the hosts.</p></div><div class=paragraph><p>This can be achieved with a shell script, similar to the following, on the corporate gateway. This file will be used during system initialization and should be saved as <span class=filename>/usr/local/etc/racoon/setkey.conf</span>.</p></div><div class="literalblock programlisting"><div class=content><pre>flush;
spdflush;
# To the home network
spdadd 10.246.38.0/24 10.0.0.0/24 any -P out ipsec esp/tunnel/172.16.5.4-192.168.1.12/use;
spdadd 10.0.0.0/24 10.246.38.0/24 any -P in ipsec esp/tunnel/192.168.1.12-172.16.5.4/use;</pre></div></div><div class=paragraph><p>Once in place, racoon may be started on both gateways using the following command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># /usr/local/sbin/racoon -F -f /usr/local/etc/racoon/racoon.conf -l /var/log/racoon.log</span></code></pre></div></div><div class=paragraph><p>The output should be similar to the following:</p></div><div class="literalblock programlisting"><div class=content><pre>corp-net# /usr/local/sbin/racoon -F -f /usr/local/etc/racoon/racoon.conf
Foreground mode.
2006-01-30 01:35:47: INFO: begin Identity Protection mode.
2006-01-30 01:35:48: INFO: received Vendor ID: KAME/racoon
2006-01-30 01:35:55: INFO: received Vendor ID: KAME/racoon
2006-01-30 01:36:04: INFO: ISAKMP-SA established 172.16.5.4[500]-192.168.1.12[500] spi:623b9b3bd2492452:7deab82d54ff704a
2006-01-30 01:36:05: INFO: initiate new phase 2 negotiation: 172.16.5.4[0]192.168.1.12[0]
2006-01-30 01:36:09: INFO: IPsec-SA established: ESP/Tunnel 192.168.1.12[0]-&gt;172.16.5.4[0] spi=28496098(0x1b2d0e2)
2006-01-30 01:36:09: INFO: IPsec-SA established: ESP/Tunnel 172.16.5.4[0]-&gt;192.168.1.12[0] spi=47784998(0x2d92426)
2006-01-30 01:36:13: INFO: respond new phase 2 negotiation: 172.16.5.4[0]192.168.1.12[0]
2006-01-30 01:36:18: INFO: IPsec-SA established: ESP/Tunnel 192.168.1.12[0]-&gt;172.16.5.4[0] spi=124397467(0x76a279b)
2006-01-30 01:36:18: INFO: IPsec-SA established: ESP/Tunnel 172.16.5.4[0]-&gt;192.168.1.12[0] spi=175852902(0xa7b4d66)</pre></div></div><div class=paragraph><p>To ensure the tunnel is working properly, switch to another console and use <a href="https://man.freebsd.org/cgi/man.cgi?query=tcpdump&amp;sektion=1&amp;format=html">tcpdump(1)</a> to view network traffic using the following command. Replace <code>em0</code> with the network interface card as required:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># tcpdump -i em0 host 172.16.5.4 and dst 192.168.1.12</span></code></pre></div></div><div class=paragraph><p>Data similar to the following should appear on the console. If not, there is an issue and debugging the returned data will be required.</p></div><div class="literalblock programlisting"><div class=content><pre>01:47:32.021683 IP corporatenetwork.com &gt; 192.168.1.12.privatenetwork.com: ESP(spi=0x02acbf9f,seq=0xa)
01:47:33.022442 IP corporatenetwork.com &gt; 192.168.1.12.privatenetwork.com: ESP(spi=0x02acbf9f,seq=0xb)
01:47:34.024218 IP corporatenetwork.com &gt; 192.168.1.12.privatenetwork.com: ESP(spi=0x02acbf9f,seq=0xc)</pre></div></div><div class=paragraph><p>At this point, both networks should be available and seem to be part of the same network. Most likely both networks are protected by a firewall. To allow traffic to flow between them, rules need to be added to pass packets. For the <a href="https://man.freebsd.org/cgi/man.cgi?query=ipfw&amp;sektion=8&amp;format=html">ipfw(8)</a> firewall, add the following lines to the firewall configuration file:</p></div><div class="literalblock programlisting"><div class=content><pre>ipfw add 00201 allow log esp from any to any
ipfw add 00202 allow log ah from any to any
ipfw add 00203 allow log ipencap from any to any
ipfw add 00204 allow log udp from any 500 to any</pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>The rule numbers may need to be altered depending on the current host configuration.</p></div></td></tr></tbody></table></div><div class=paragraph><p>For users of <a href="https://man.freebsd.org/cgi/man.cgi?query=pf&amp;sektion=4&amp;format=html">pf(4)</a> or <a href="https://man.freebsd.org/cgi/man.cgi?query=ipf&amp;sektion=8&amp;format=html">ipf(8)</a>, the following rules should do the trick:</p></div><div class="literalblock programlisting"><div class=content><pre>pass in quick proto esp from any to any
pass in quick proto ah from any to any
pass in quick proto ipencap from any to any
pass in quick proto udp from any port = 500 to any port = 500
pass in quick on gif0 from any to any
pass out quick proto esp from any to any
pass out quick proto ah from any to any
pass out quick proto ipencap from any to any
pass out quick proto udp from any port = 500 to any port = 500
pass out quick on gif0 from any to any</pre></div></div><div class=paragraph><p>Finally, to allow the machine to start support for the VPN during system initialization, add the following lines to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>ipsec_enable=&#34;YES&#34;
ipsec_program=&#34;/usr/local/sbin/setkey&#34;
ipsec_file=&#34;/usr/local/etc/racoon/setkey.conf&#34; # allows setting up spd policies on boot
racoon_enable=&#34;yes&#34;</pre></div></div></div></div></div><div class=sect1><h2 id=openssh>14.8. OpenSSH<a class=anchor href=#openssh></a></h2><div class=sectionbody><div class=paragraph><p>OpenSSH is a set of network connectivity tools used to provide secure access to remote machines. Additionally, TCP/IP connections can be tunneled or forwarded securely through SSH connections. OpenSSH encrypts all traffic to effectively eliminate eavesdropping, connection hijacking, and other network-level attacks.</p></div><div class=paragraph><p>OpenSSH is maintained by the OpenBSD project and is installed by default in FreeBSD. It is compatible with both SSH version 1 and 2 protocols.</p></div><div class=paragraph><p>When data is sent over the network in an unencrypted form, network sniffers anywhere in between the client and server can steal user/password information or data transferred during the session. OpenSSH offers a variety of authentication and encryption methods to prevent this from happening. More information about OpenSSH is available from <a href=http://www.openssh.com/>http://www.openssh.com/</a>.</p></div><div class=paragraph><p>This section provides an overview of the built-in client utilities to securely access other systems and securely transfer files from a FreeBSD system. It then describes how to configure a SSH server on a FreeBSD system. More information is available in the man pages mentioned in this chapter.</p></div><div class=sect2><h3 id=_using_the_ssh_client_utilities>14.8.1. Using the SSH Client Utilities<a class=anchor href=#_using_the_ssh_client_utilities></a></h3><div class=paragraph><p>To log into a SSH server, use <code>ssh</code> and specify a username that exists on that server and the IP address or hostname of the server. If this is the first time a connection has been made to the specified server, the user will be prompted to first verify the server’s fingerprint:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ssh user@example.com</span>
The authenticity of host <span class=s1>&#39;example.com (10.0.0.1)&#39;</span> can<span class=s1>&#39;t be established.
ECDSA key fingerprint is 25:cc:73:b5:b3:96:75:3d:56:19:49:d2:5c:1f:91:3b.
Are you sure you want to continue connecting (yes/no)? yes
Permanently added &#39;</span>example.com<span class=s1>&#39; (ECDSA) to the list of known hosts.
Password for user@example.com: user_password</span></code></pre></div></div><div class=paragraph><p>SSH utilizes a key fingerprint system to verify the authenticity of the server when the client connects. When the user accepts the key’s fingerprint by typing <code>yes</code> when connecting for the first time, a copy of the key is saved to <span class=filename>.ssh/known_hosts</span> in the user’s home directory. Future attempts to login are verified against the saved key and <code>ssh</code> will display an alert if the server’s key does not match the saved key. If this occurs, the user should first verify why the key has changed before continuing with the connection.</p></div><div class=paragraph><p>By default, recent versions of OpenSSH only accept SSHv2 connections. By default, the client will use version 2 if possible and will fall back to version 1 if the server does not support version 2. To force <code>ssh</code> to only use the specified protocol, include <code>-1</code> or <code>-2</code>. Additional options are described in <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;format=html">ssh(1)</a>.</p></div><div class=paragraph><p>Use <a href="https://man.freebsd.org/cgi/man.cgi?query=scp&amp;sektion=1&amp;format=html">scp(1)</a> to securely copy a file to or from a remote machine. This example copies <span class=filename>COPYRIGHT</span> on the remote system to a file of the same name in the current directory of the local system:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># scp user@example.com:/COPYRIGHT COPYRIGHT</span>
Password <span class=k>for </span>user@example.com: <span class=k>*******</span>
COPYRIGHT            100% |<span class=k>*****************************</span>|  4735
00:00
<span class=c>#</span></code></pre></div></div><div class=paragraph><p>Since the fingerprint was already verified for this host, the server’s key is automatically checked before prompting for the user’s password.</p></div><div class=paragraph><p>The arguments passed to <code>scp</code> are similar to <code>cp</code>. The file or files to copy is the first argument and the destination to copy to is the second. Since the file is fetched over the network, one or more of the file arguments takes the form <code>user@host:&lt;path_to_remote_file></code>. Be aware when copying directories recursively that <code>scp</code> uses <code>-r</code>, whereas <code>cp</code> uses <code>-R</code>.</p></div><div class=paragraph><p>To open an interactive session for copying files, use <code>sftp</code>. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=sftp&amp;sektion=1&amp;format=html">sftp(1)</a> for a list of available commands while in an <code>sftp</code> session.</p></div><div class=sect3><h4 id=security-ssh-keygen>14.8.1.1. Key-based Authentication<a class=anchor href=#security-ssh-keygen></a></h4><div class=paragraph><p>Instead of using passwords, a client can be configured to connect to the remote machine using keys. To generate RSA authentication keys, use <code>ssh-keygen</code>. To generate a public and private key pair, specify the type of key and follow the prompts. It is recommended to protect the keys with a memorable, but hard to guess passphrase.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% ssh-keygen <span class=nt>-t</span> rsa
Generating public/private rsa key pair.
Enter file <span class=k>in </span>which to save the key <span class=o>(</span>/home/user/.ssh/id_rsa<span class=o>)</span>:
Enter passphrase <span class=o>(</span>empty <span class=k>for </span>no passphrase<span class=o>)</span>:  <i class=conum data-value=1></i><b>(1)</b>
Enter same passphrase again:                 <i class=conum data-value=2></i><b>(2)</b>
Your identification has been saved <span class=k>in</span> /home/user/.ssh/id_rsa.
Your public key has been saved <span class=k>in</span> /home/user/.ssh/id_rsa.pub.
The key fingerprint is:
SHA256:54Xm9Uvtv6H4NOo6yjP/YCfODryvUU7yWHzMqeXwhq8 user@host.example.com
The key<span class=s1>&#39;s randomart image is:
+---[RSA 2048]----+
|                 |
|                 |
|                 |
|        . o..    |
|       .S*+*o    |
|      . O=Oo . . |
|       = Oo= oo..|
|      .oB.* +.oo.|
|       =OE**.o..=|
+----[SHA256]-----+</span></code></pre></div></div><div class="colist arabic"><table><tbody><tr><td><i class=conum data-value=1></i><b>1</b></td><td>Type a passphrase here. It can contain spaces and symbols.</td></tr><tr><td><i class=conum data-value=2></i><b>2</b></td><td>Retype the passphrase to verify it.</td></tr></tbody></table></div><div class=paragraph><p>The private key is stored in <span class=filename>~/.ssh/id_rsa</span> and the public key is stored in <span class=filename>~/.ssh/id_rsa.pub</span>. The <em>public</em> key must be copied to <span class=filename>~/.ssh/authorized_keys</span> on the remote machine for key-based authentication to work.</p></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>Many users believe that keys are secure by design and will use a key without a passphrase. This is <em>dangerous</em> behavior. An administrator can verify that a key pair is protected by a passphrase by viewing the private key manually. If the private key file contains the word <code>ENCRYPTED</code>, the key owner is using a passphrase. In addition, to better secure end users, <code>from</code> may be placed in the public key file. For example, adding <code>from="192.168.10.5"</code> in front of the <code>ssh-rsa</code> prefix will only allow that specific user to log in from that IP address.</p></div></td></tr></tbody></table></div><div class=paragraph><p>The options and files vary with different versions of OpenSSH. To avoid problems, consult <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh-keygen&amp;sektion=1&amp;format=html">ssh-keygen(1)</a>.</p></div><div class=paragraph><p>If a passphrase is used, the user is prompted for the passphrase each time a connection is made to the server. To load SSH keys into memory and remove the need to type the passphrase each time, use <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh-agent&amp;sektion=1&amp;format=html">ssh-agent(1)</a> and <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh-add&amp;sektion=1&amp;format=html">ssh-add(1)</a>.</p></div><div class=paragraph><p>Authentication is handled by <code>ssh-agent</code>, using the private keys that are loaded into it. <code>ssh-agent</code> can be used to launch another application like a shell or a window manager.</p></div><div class=paragraph><p>To use <code>ssh-agent</code> in a shell, start it with a shell as an argument. Add the identity by running <code>ssh-add</code> and entering the passphrase for the private key. The user will then be able to <code>ssh</code> to any host that has the corresponding public key installed. For example:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% ssh-agent csh
% ssh-add
Enter passphrase <span class=k>for </span>key <span class=s1>&#39;/usr/home/user/.ssh/id_rsa&#39;</span>:  <i class=conum data-value=1></i><b>(1)</b>
Identity added: /usr/home/user/.ssh/id_rsa <span class=o>(</span>/usr/home/user/.ssh/id_rsa<span class=o>)</span>
%</code></pre></div></div><div class="colist arabic"><table><tbody><tr><td><i class=conum data-value=1></i><b>1</b></td><td>Enter the passphrase for the key.</td></tr></tbody></table></div><div class=paragraph><p>To use <code>ssh-agent</code> in Xorg, add an entry for it in <span class=filename>~/.xinitrc</span>. This provides the <code>ssh-agent</code> services to all programs launched in Xorg. An example <span class=filename>~/.xinitrc</span> might look like this:</p></div><div class="literalblock programlisting"><div class=content><pre>exec ssh-agent startxfce4</pre></div></div><div class=paragraph><p>This launches <code>ssh-agent</code>, which in turn launches XFCE, every time Xorg starts. Once Xorg has been restarted so that the changes can take effect, run <code>ssh-add</code> to load all of the SSH keys.</p></div></div><div class=sect3><h4 id=security-ssh-tunneling>14.8.1.2. SSH Tunneling<a class=anchor href=#security-ssh-tunneling></a></h4><div class=paragraph><p>OpenSSH has the ability to create a tunnel to encapsulate another protocol in an encrypted session.</p></div><div class=paragraph><p>The following command tells <code>ssh</code> to create a tunnel for telnet:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% ssh <span class=nt>-2</span> <span class=nt>-N</span> <span class=nt>-f</span> <span class=nt>-L</span> 5023:localhost:23 user@foo.example.com
%</code></pre></div></div><div class=paragraph><p>This example uses the following options:</p></div><div class=dlist><dl><dt class=hdlist1><code>-2</code></dt><dd><p>Forces <code>ssh</code> to use version 2 to connect to the server.</p></dd><dt class=hdlist1><code>-N</code></dt><dd><p>Indicates no command, or tunnel only. If omitted, <code>ssh</code> initiates a normal session.</p></dd><dt class=hdlist1><code>-f</code></dt><dd><p>Forces <code>ssh</code> to run in the background.</p></dd><dt class=hdlist1><code>-L</code></dt><dd><p>Indicates a local tunnel in <em>localport:remotehost:remoteport</em> format.</p></dd><dt class=hdlist1><code>user@foo.example.com</code></dt><dd><p>The login name to use on the specified remote SSH server.</p></dd></dl></div><div class=paragraph><p>An SSH tunnel works by creating a listen socket on <code>localhost</code> on the specified <code>localport</code>. It then forwards any connections received on <code>localport</code> via the SSH connection to the specified <code>remotehost:remoteport</code>. In the example, port <code>5023</code> on the client is forwarded to port <code>23</code> on the remote machine. Since port 23 is used by telnet, this creates an encrypted telnet session through an SSH tunnel.</p></div><div class=paragraph><p>This method can be used to wrap any number of insecure TCP protocols such as SMTP, POP3, and FTP, as seen in the following examples.</p></div><div class=exampleblock><div class=title>Przykład 1. Create a Secure Tunnel for SMTP</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% ssh <span class=nt>-2</span> <span class=nt>-N</span> <span class=nt>-f</span> <span class=nt>-L</span> 5025:localhost:25 user@mailserver.example.com
user@mailserver.example.com<span class=s1>&#39;s password: *****
% telnet localhost 5025
Trying 127.0.0.1...
Connected to localhost.
Escape character is &#39;</span>^]<span class=s1>&#39;.
220 mailserver.example.com ESMTP</span></code></pre></div></div><div class=paragraph><p>This can be used in conjunction with <code>ssh-keygen</code> and additional user accounts to create a more seamless SSH tunneling environment. Keys can be used in place of typing a password, and the tunnels can be run as a separate user.</p></div></div></div><div class=exampleblock><div class=title>Przykład 2. Secure Access of a POP3 Server</div><div class=content><div class=paragraph><p>In this example, there is an SSH server that accepts connections from the outside. On the same network resides a mail server running a POP3 server. To check email in a secure manner, create an SSH connection to the SSH server and tunnel through to the mail server:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% ssh <span class=nt>-2</span> <span class=nt>-N</span> <span class=nt>-f</span> <span class=nt>-L</span> 2110:mail.example.com:110 user@ssh-server.example.com
user@ssh-server.example.com<span class=s1>&#39;s password: ******</span></code></pre></div></div><div class=paragraph><p>Once the tunnel is up and running, point the email client to send POP3 requests to <code>localhost</code> on port 2110. This connection will be forwarded securely across the tunnel to <code>mail.example.com</code>.</p></div></div></div><div class=exampleblock><div class=title>Przykład 3. Bypassing a Firewall</div><div class=content><div class=paragraph><p>Some firewalls filter both incoming and outgoing connections. For example, a firewall might limit access from remote machines to ports 22 and 80 to only allow SSH and web surfing. This prevents access to any other service which uses a port other than 22 or 80.</p></div><div class=paragraph><p>The solution is to create an SSH connection to a machine outside of the network’s firewall and use it to tunnel to the desired service:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% ssh <span class=nt>-2</span> <span class=nt>-N</span> <span class=nt>-f</span> <span class=nt>-L</span> 8888:music.example.com:8000 user@unfirewalled-system.example.org
user@unfirewalled-system.example.org<span class=s1>&#39;s password: *******</span></code></pre></div></div><div class=paragraph><p>In this example, a streaming Ogg Vorbis client can now be pointed to <code>localhost</code> port 8888, which will be forwarded over to <code>music.example.com</code> on port 8000, successfully bypassing the firewall.</p></div></div></div></div></div><div class=sect2><h3 id=_enabling_the_ssh_server>14.8.2. Enabling the SSH Server<a class=anchor href=#_enabling_the_ssh_server></a></h3><div class=paragraph><p>In addition to providing built-in SSH client utilities, a FreeBSD system can be configured as an SSH server, accepting connections from other SSH clients.</p></div><div class=paragraph><p>To see if sshd is operating, use the <a href="https://man.freebsd.org/cgi/man.cgi?query=service&amp;sektion=8&amp;format=html">service(8)</a> command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service sshd status</span></code></pre></div></div><div class=paragraph><p>If the service is not running, add the following line to <span class=filename>/etc/rc.conf</span>.</p></div><div class="literalblock programlisting"><div class=content><pre>sshd_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>This will start sshd, the daemon program for OpenSSH, the next time the system boots. To start it now:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service sshd start</span></code></pre></div></div><div class=paragraph><p>The first time sshd starts on a FreeBSD system, the system’s host keys will be automatically created and the fingerprint will be displayed on the console. Provide users with the fingerprint so that they can verify it the first time they connect to the server.</p></div><div class=paragraph><p>Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=sshd&amp;sektion=8&amp;format=html">sshd(8)</a> for the list of available options when starting sshd and a more complete discussion about authentication, the login process, and the various configuration files.</p></div><div class=paragraph><p>At this point, the sshd should be available to all users with a username and password on the system.</p></div></div><div class=sect2><h3 id=_ssh_server_security>14.8.3. SSH Server Security<a class=anchor href=#_ssh_server_security></a></h3><div class=paragraph><p>While sshd is the most widely used remote administration facility for FreeBSD, brute force and drive by attacks are common to any system exposed to public networks. Several additional parameters are available to prevent the success of these attacks and will be described in this section.</p></div><div class=paragraph><p>It is a good idea to limit which users can log into the SSH server and from where using the <code>AllowUsers</code> keyword in the OpenSSH server configuration file. For example, to only allow <code>root</code> to log in from <code>192.168.1.32</code>, add this line to <span class=filename>/etc/ssh/sshd_config</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>AllowUsers root@192.168.1.32</pre></div></div><div class=paragraph><p>To allow <code>admin</code> to log in from anywhere, list that user without specifying an IP address:</p></div><div class="literalblock programlisting"><div class=content><pre>AllowUsers admin</pre></div></div><div class=paragraph><p>Multiple users should be listed on the same line, like so:</p></div><div class="literalblock programlisting"><div class=content><pre>AllowUsers root@192.168.1.32 admin</pre></div></div><div class=paragraph><p>After making changes to <span class=filename>/etc/ssh/sshd_config</span>, tell sshd to reload its configuration file by running:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service sshd reload</span></code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>When this keyword is used, it is important to list each user that needs to log into this machine. Any user that is not specified in that line will be locked out. Also, the keywords used in the OpenSSH server configuration file are case-sensitive. If the keyword is not spelled correctly, including its case, it will be ignored. Always test changes to this file to make sure that the edits are working as expected. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=sshd_config&amp;sektion=5&amp;format=html">sshd_config(5)</a> to verify the spelling and use of the available keywords.</p></div></td></tr></tbody></table></div><div class=paragraph><p>In addition, users may be forced to use two factor authentication via the use of a public and private key. When required, the user may generate a key pair through the use of <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh-keygen&amp;sektion=1&amp;format=html">ssh-keygen(1)</a> and send the administrator the public key. This key file will be placed in the <span class=filename>authorized_keys</span> as described above in the client section. To force the users to use keys only, the following option may be configured:</p></div><div class="literalblock programlisting"><div class=content><pre>AuthenticationMethods publickey</pre></div></div><div class="admonitionblock tip"><table><tbody><tr><td class=icon><i class="fa icon-tip" title=Tip></i></td><td class=content><div class=paragraph><p>Do not confuse <span class=filename>/etc/ssh/sshd_config</span> with <span class=filename>/etc/ssh/ssh_config</span> (note the extra <code>d</code> in the first filename). The first file configures the server and the second file configures the client. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh_config&amp;sektion=5&amp;format=html">ssh_config(5)</a> for a listing of the available client settings.</p></div></td></tr></tbody></table></div></div></div></div><div class=sect1><h2 id=fs-acl>14.9. Access Control Lists<a class=anchor href=#fs-acl></a></h2><div class=sectionbody><div class=paragraph><p>Access Control Lists (ACLs) extend the standard UNIX® permission model in a POSIX®.1e compatible way. This permits an administrator to take advantage of a more fine-grained permissions model.</p></div><div class=paragraph><p>The FreeBSD <span class=filename>GENERIC</span> kernel provides ACL support for UFS file systems. Users who prefer to compile a custom kernel must include the following option in their custom kernel configuration file:</p></div><div class="literalblock programlisting"><div class=content><pre>options UFS_ACL</pre></div></div><div class=paragraph><p>If this option is not compiled in, a warning message will be displayed when attempting to mount a file system with ACL support. ACLs rely on extended attributes which are natively supported in UFS2.</p></div><div class=paragraph><p>This chapter describes how to enable ACL support and provides some usage examples.</p></div><div class=sect2><h3 id=_enabling_acl_support>14.9.1. Enabling ACL Support<a class=anchor href=#_enabling_acl_support></a></h3><div class=paragraph><p>ACLs are enabled by the mount-time administrative flag, <code>acls</code>, which may be added to <span class=filename>/etc/fstab</span>. The mount-time flag can also be automatically set in a persistent manner using <a href="https://man.freebsd.org/cgi/man.cgi?query=tunefs&amp;sektion=8&amp;format=html">tunefs(8)</a> to modify a superblock ACLs flag in the file system header. In general, it is preferred to use the superblock flag for several reasons:</p></div><div class=ulist><ul><li><p>The superblock flag cannot be changed by a remount using <code>mount -u</code> as it requires a complete <code>umount</code> and fresh <code>mount</code>. This means that ACLs cannot be enabled on the root file system after boot. It also means that ACL support on a file system cannot be changed while the system is in use.</p></li><li><p>Setting the superblock flag causes the file system to always be mounted with ACLs enabled, even if there is not an <span class=filename>fstab</span> entry or if the devices re-order. This prevents accidental mounting of the file system without ACL support.</p></li></ul></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>It is desirable to discourage accidental mounting without ACLs enabled because nasty things can happen if ACLs are enabled, then disabled, then re-enabled without flushing the extended attributes. In general, once ACLs are enabled on a file system, they should not be disabled, as the resulting file protections may not be compatible with those intended by the users of the system, and re-enabling ACLs may re-attach the previous ACLs to files that have since had their permissions changed, resulting in unpredictable behavior.</p></div></td></tr></tbody></table></div><div class=paragraph><p>File systems with ACLs enabled will show a plus (<code>+</code>) sign in their permission settings:</p></div><div class="literalblock programlisting"><div class=content><pre>drwx------  2 robert  robert  512 Dec 27 11:54 private
drwxrwx---+ 2 robert  robert  512 Dec 23 10:57 directory1
drwxrwx---+ 2 robert  robert  512 Dec 22 10:20 directory2
drwxrwx---+ 2 robert  robert  512 Dec 27 11:57 directory3
drwxr-xr-x  2 robert  robert  512 Nov 10 11:54 public_html</pre></div></div><div class=paragraph><p>In this example, <span class=filename>directory1</span>, <span class=filename>directory2</span>, and <span class=filename>directory3</span> are all taking advantage of ACLs, whereas <span class=filename>public_html</span> is not.</p></div></div><div class=sect2><h3 id=_using_acls>14.9.2. Using ACLs<a class=anchor href=#_using_acls></a></h3><div class=paragraph><p>File system ACLs can be viewed using <code>getfacl</code>. For instance, to view the ACL settings on <span class=filename>test</span>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% getfacl <span class=nb>test</span>
	<span class=c>#file:test</span>
	<span class=c>#owner:1001</span>
	<span class=c>#group:1001</span>
	user::rw-
	group::r--
	other::r--</code></pre></div></div><div class=paragraph><p>To change the ACL settings on this file, use <code>setfacl</code>. To remove all of the currently defined ACLs from a file or file system, include <code>-k</code>. However, the preferred method is to use <code>-b</code> as it leaves the basic fields required for ACLs to work.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% setfacl <span class=nt>-k</span> <span class=nb>test</span></code></pre></div></div><div class=paragraph><p>To modify the default ACL entries, use <code>-m</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% setfacl <span class=nt>-m</span> u:trhodes:rwx,group:web:r--,o::--- <span class=nb>test</span></code></pre></div></div><div class=paragraph><p>In this example, there were no pre-defined entries, as they were removed by the previous command. This command restores the default options and assigns the options listed. If a user or group is added which does not exist on the system, an <code>Invalid argument</code> error will be displayed.</p></div><div class=paragraph><p>Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=getfacl&amp;sektion=1&amp;format=html">getfacl(1)</a> and <a href="https://man.freebsd.org/cgi/man.cgi?query=setfacl&amp;sektion=1&amp;format=html">setfacl(1)</a> for more information about the options available for these commands.</p></div></div></div></div><div class=sect1><h2 id=security-pkg>14.10. Monitoring Third Party Security Issues<a class=anchor href=#security-pkg></a></h2><div class=sectionbody><div class=paragraph><p>In recent years, the security world has made many improvements to how vulnerability assessment is handled. The threat of system intrusion increases as third party utilities are installed and configured for virtually any operating system available today.</p></div><div class=paragraph><p>Vulnerability assessment is a key factor in security. While FreeBSD releases advisories for the base system, doing so for every third party utility is beyond the FreeBSD Project’s capability. There is a way to mitigate third party vulnerabilities and warn administrators of known security issues. A FreeBSD add on utility known as pkg includes options explicitly for this purpose.</p></div><div class=paragraph><p>pkg polls a database for security issues. The database is updated and maintained by the FreeBSD Security Team and ports developers.</p></div><div class=paragraph><p>Please refer to <a href=../ports/#pkgng-intro>instructions</a> for installing pkg.</p></div><div class=paragraph><p>Installation provides <a href="https://man.freebsd.org/cgi/man.cgi?query=periodic&amp;sektion=8&amp;format=html">periodic(8)</a> configuration files for maintaining the pkg audit database, and provides a programmatic method of keeping it updated. This functionality is enabled if <code>daily_status_security_pkgaudit_enable</code> is set to <code>YES</code> in <a href="https://man.freebsd.org/cgi/man.cgi?query=periodic.conf&amp;sektion=5&amp;format=html">periodic.conf(5)</a>. Ensure that daily security run emails, which are sent to <code>root</code>'s email account, are being read.</p></div><div class=paragraph><p>After installation, and to audit third party utilities as part of the Ports Collection at any time, an administrator may choose to update the database and view known vulnerabilities of installed packages by invoking:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pkg audit -F</span></code></pre></div></div><div class=paragraph><p>pkg displays messages any published vulnerabilities in installed packages:</p></div><div class="literalblock programlisting"><div class=content><pre>Affected package: cups-base-1.1.22.0_1
Type of problem: cups-base -- HPGL buffer overflow vulnerability.
Reference: &lt;https://www.FreeBSD.org/ports/portaudit/40a3bca2-6809-11d9-a9e7-0001020eed82.html&gt;

1 problem(s) in your installed packages found.

You are advised to update or deinstall the affected package(s) immediately.</pre></div></div><div class=paragraph><p>By pointing a web browser to the displayed URL, an administrator may obtain more information about the vulnerability. This will include the versions affected, by FreeBSD port version, along with other web sites which may contain security advisories.</p></div><div class=paragraph><p>pkg is a powerful utility and is extremely useful when coupled with <a class=package href=https://cgit.freebsd.org/ports/tree/ports-mgmt/portmaster/>ports-mgmt/portmaster</a>.</p></div></div></div><div class=sect1><h2 id=security-advisories>14.11. FreeBSD Security Advisories<a class=anchor href=#security-advisories></a></h2><div class=sectionbody><div class=paragraph><p>Like many producers of quality operating systems, the FreeBSD Project has a security team which is responsible for determining the End-of-Life (EoL) date for each FreeBSD release and to provide security updates for supported releases which have not yet reached their EoL. More information about the FreeBSD security team and the supported releases is available on the <a href=https://www.FreeBSD.org/security>FreeBSD security page</a>.</p></div><div class=paragraph><p>One task of the security team is to respond to reported security vulnerabilities in the FreeBSD operating system. Once a vulnerability is confirmed, the security team verifies the steps necessary to fix the vulnerability and updates the source code with the fix. It then publishes the details as a "Security Advisory". Security advisories are published on the <a href=https://www.FreeBSD.org/security/advisories/>FreeBSD website</a> and mailed to the <a href=https://lists.FreeBSD.org/subscription/freebsd-security-notifications>FreeBSD security notifications mailing list</a>, <a href=https://lists.FreeBSD.org/subscription/freebsd-security>FreeBSD security mailing list</a>, and <a href=https://lists.FreeBSD.org/subscription/freebsd-announce>FreeBSD announcements mailing list</a> mailing lists.</p></div><div class=paragraph><p>This section describes the format of a FreeBSD security advisory.</p></div><div class=sect2><h3 id=_format_of_a_security_advisory>14.11.1. Format of a Security Advisory<a class=anchor href=#_format_of_a_security_advisory></a></h3><div class=paragraph><p>Here is an example of a FreeBSD security advisory:</p></div><div class="literalblock programlisting"><div class=content><pre>=============================================================================
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

=============================================================================
FreeBSD-SA-14:04.bind                                       Security Advisory
                                                          The FreeBSD Project

Topic:          BIND remote denial of service vulnerability

Category:       contrib
Module:         bind
Announced:      2014-01-14
Credits:        ISC
Affects:        FreeBSD 8.x and FreeBSD 9.x
Corrected:      2014-01-14 19:38:37 UTC (stable/9, 9.2-STABLE)
                2014-01-14 19:42:28 UTC (releng/9.2, 9.2-RELEASE-p3)
                2014-01-14 19:42:28 UTC (releng/9.1, 9.1-RELEASE-p10)
                2014-01-14 19:38:37 UTC (stable/8, 8.4-STABLE)
                2014-01-14 19:42:28 UTC (releng/8.4, 8.4-RELEASE-p7)
                2014-01-14 19:42:28 UTC (releng/8.3, 8.3-RELEASE-p14)
CVE Name:       CVE-2014-0591

For general information regarding FreeBSD Security Advisories,
including descriptions of the fields above, security branches, and the
following sections, please visit &lt;URL:http://security.FreeBSD.org/&gt;.

I.   Background

BIND 9 is an implementation of the Domain Name System (DNS) protocols.
The named(8) daemon is an Internet Domain Name Server.

II.  Problem Description

Because of a defect in handling queries for NSEC3-signed zones, BIND can
crash with an &#34;INSIST&#34; failure in name.c when processing queries possessing
certain properties.  This issue only affects authoritative nameservers with
at least one NSEC3-signed zone.  Recursive-only servers are not at risk.

III. Impact

An attacker who can send a specially crafted query could cause named(8)
to crash, resulting in a denial of service.

IV.  Workaround

No workaround is available, but systems not running authoritative DNS service
with at least one NSEC3-signed zone using named(8) are not vulnerable.

V.   Solution

Perform one of the following:

1) Upgrade your vulnerable system to a supported FreeBSD stable or
release / security branch (releng) dated after the correction date.

2) To update your vulnerable system via a source code patch:

The following patches have been verified to apply to the applicable
FreeBSD release branches.

a) Download the relevant patch from the location below, and verify the
detached PGP signature using your PGP utility.

[FreeBSD 8.3, 8.4, 9.1, 9.2-RELEASE and 8.4-STABLE]
# fetch http://security.FreeBSD.org/patches/SA-14:04/bind-release.patch
# fetch http://security.FreeBSD.org/patches/SA-14:04/bind-release.patch.asc
# gpg --verify bind-release.patch.asc

[FreeBSD 9.2-STABLE]
# fetch http://security.FreeBSD.org/patches/SA-14:04/bind-stable-9.patch
# fetch http://security.FreeBSD.org/patches/SA-14:04/bind-stable-9.patch.asc
# gpg --verify bind-stable-9.patch.asc

b) Execute the following commands as root:

# cd /usr/src
# patch &lt; /path/to/patch

Recompile the operating system using buildworld and installworld as
described in &lt;URL:https://www.FreeBSD.org/handbook/makeworld.html&gt;.

Restart the applicable daemons, or reboot the system.

3) To update your vulnerable system via a binary patch:

Systems running a RELEASE version of FreeBSD on the i386 or amd64
platforms can be updated via the freebsd-update(8) utility:

# freebsd-update fetch
# freebsd-update install

VI.  Correction details

The following list contains the correction revision numbers for each
affected branch.

Branch/path                                                      Revision
- -------------------------------------------------------------------------
stable/8/                                                         r260646
releng/8.3/                                                       r260647
releng/8.4/                                                       r260647
stable/9/                                                         r260646
releng/9.1/                                                       r260647
releng/9.2/                                                       r260647
- -------------------------------------------------------------------------

To see which files were modified by a particular revision, run the
following command, replacing NNNNNN with the revision number, on a
machine with Subversion installed:

# svn diff -cNNNNNN --summarize svn://svn.freebsd.org/base

Or visit the following URL, replacing NNNNNN with the revision number:

&lt;URL:https://svnweb.freebsd.org/base?view=revision&amp;revision=NNNNNN&gt;

VII. References

&lt;URL:https://kb.isc.org/article/AA-01078&gt;

&lt;URL:http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-0591&gt;

The latest revision of this advisory is available at
&lt;URL:http://security.FreeBSD.org/advisories/FreeBSD-SA-14:04.bind.asc&gt;
-----BEGIN PGP SIGNATURE-----

iQIcBAEBCgAGBQJS1ZTYAAoJEO1n7NZdz2rnOvQP/2/68/s9Cu35PmqNtSZVVxVG
ZSQP5EGWx/lramNf9566iKxOrLRMq/h3XWcC4goVd+gZFrvITJSVOWSa7ntDQ7TO
XcinfRZ/iyiJbs/Rg2wLHc/t5oVSyeouyccqODYFbOwOlk35JjOTMUG1YcX+Zasg
ax8RV+7Zt1QSBkMlOz/myBLXUjlTZ3Xg2FXVsfFQW5/g2CjuHpRSFx1bVNX6ysoG
9DT58EQcYxIS8WfkHRbbXKh9I1nSfZ7/Hky/kTafRdRMrjAgbqFgHkYTYsBZeav5
fYWKGQRJulYfeZQ90yMTvlpF42DjCC3uJYamJnwDIu8OhS1WRBI8fQfr9DRzmRua
OK3BK9hUiScDZOJB6OqeVzUTfe7MAA4/UwrDtTYQ+PqAenv1PK8DZqwXyxA9ThHb
zKO3OwuKOVHJnKvpOcr+eNwo7jbnHlis0oBksj/mrq2P9m2ueF9gzCiq5Ri5Syag
Wssb1HUoMGwqU0roS8+pRpNC8YgsWpsttvUWSZ8u6Vj/FLeHpiV3mYXPVMaKRhVm
067BA2uj4Th1JKtGleox+Em0R7OFbCc/9aWC67wiqI6KRyit9pYiF3npph+7D5Eq
7zPsUdDd+qc+UTiLp3liCRp5w6484wWdhZO6wRtmUgxGjNkxFoNnX8CitzF8AaqO
UWWemqWuz3lAZuORQ9KX
=OQzQ
-----END PGP SIGNATURE-----</pre></div></div><div class=paragraph><p>Every security advisory uses the following format:</p></div><div class=ulist><ul><li><p>Each security advisory is signed by the PGP key of the Security Officer. The public key for the Security Officer can be verified at <a href=../pgpkeys/#pgpkeys>OpenPGP Keys</a>.</p></li><li><p>The name of the security advisory always begins with <code>FreeBSD-SA-</code> (for FreeBSD Security Advisory), followed by the year in two digit format (<code>14:</code>), followed by the advisory number for that year (<code>04.</code>), followed by the name of the affected application or subsystem (<code>bind</code>). The advisory shown here is the fourth advisory for 2014 and it affects BIND.</p></li><li><p>The <code>Topic</code> field summarizes the vulnerability.</p></li><li><p>The <code>Category</code> refers to the affected part of the system which may be one of <code>core</code>, <code>contrib</code>, or <code>ports</code>. The <code>core</code> category means that the vulnerability affects a core component of the FreeBSD operating system. The <code>contrib</code> category means that the vulnerability affects software included with FreeBSD, such as BIND. The <code>ports</code> category indicates that the vulnerability affects software available through the Ports Collection.</p></li><li><p>The <code>Module</code> field refers to the component location. In this example, the <code>bind</code> module is affected; therefore, this vulnerability affects an application installed with the operating system.</p></li><li><p>The <code>Announced</code> field reflects the date the security advisory was published. This means that the security team has verified that the problem exists and that a patch has been committed to the FreeBSD source code repository.</p></li><li><p>The <code>Credits</code> field gives credit to the individual or organization who noticed the vulnerability and reported it.</p></li><li><p>The <code>Affects</code> field explains which releases of FreeBSD are affected by this vulnerability.</p></li><li><p>The <code>Corrected</code> field indicates the date, time, time offset, and releases that were corrected. The section in parentheses shows each branch for which the fix has been merged, and the version number of the corresponding release from that branch. The release identifier itself includes the version number and, if appropriate, the patch level. The patch level is the letter <code>p</code> followed by a number, indicating the sequence number of the patch, allowing users to track which patches have already been applied to the system.</p></li><li><p>The <code>CVE Name</code> field lists the advisory number, if one exists, in the public <a href=http://cve.mitre.org>cve.mitre.org</a> security vulnerabilities database.</p></li><li><p>The <code>Background</code> field provides a description of the affected module.</p></li><li><p>The <code>Problem Description</code> field explains the vulnerability. This can include information about the flawed code and how the utility could be maliciously used.</p></li><li><p>The <code>Impact</code> field describes what type of impact the problem could have on a system.</p></li><li><p>The <code>Workaround</code> field indicates if a workaround is available to system administrators who cannot immediately patch the system .</p></li><li><p>The <code>Solution</code> field provides the instructions for patching the affected system. This is a step by step tested and verified method for getting a system patched and working securely.</p></li><li><p>The <code>Correction Details</code> field displays each affected Subversion branch with the revision number that contains the corrected code.</p></li><li><p>The <code>References</code> field offers sources of additional information regarding the vulnerability.</p></li></ul></div></div></div></div><div class=sect1><h2 id=security-accounting>14.12. Process Accounting<a class=anchor href=#security-accounting></a></h2><div class=sectionbody><div class=paragraph><p>Process accounting is a security method in which an administrator may keep track of system resources used and their allocation among users, provide for system monitoring, and minimally track a user’s commands.</p></div><div class=paragraph><p>Process accounting has both positive and negative points. One of the positives is that an intrusion may be narrowed down to the point of entry. A negative is the amount of logs generated by process accounting, and the disk space they may require. This section walks an administrator through the basics of process accounting.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>If more fine-grained accounting is needed, refer to <a href=../audit/#audit>Security Event Auditing</a>.</p></div></td></tr></tbody></table></div><div class=sect2><h3 id=_enabling_and_utilizing_process_accounting>14.12.1. Enabling and Utilizing Process Accounting<a class=anchor href=#_enabling_and_utilizing_process_accounting></a></h3><div class=paragraph><p>Before using process accounting, it must be enabled using the following commands:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sysrc accounting_enable=yes</span>
<span class=c># service accounting start</span></code></pre></div></div><div class=paragraph><p>The accounting information is stored in files located in <span class=filename>/var/account</span>, which is automatically created, if necessary, the first time the accounting service starts. These files contain sensitive information, including all the commands issued by all users. Write access to the files is limited to <code>root</code>, and read access is limited to <code>root</code> and members of the <code>wheel</code> group. To also prevent members of <code>wheel</code> from reading the files, change the mode of the <span class=filename>/var/account</span> directory to allow access only by <code>root</code>.</p></div><div class=paragraph><p>Once enabled, accounting will begin to track information such as CPU statistics and executed commands. All accounting logs are in a non-human readable format which can be viewed using <code>sa</code>. If issued without any options, <code>sa</code> prints information relating to the number of per-user calls, the total elapsed time in minutes, total CPU and user time in minutes, and the average number of I/O operations. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=sa&amp;sektion=8&amp;format=html">sa(8)</a> for the list of available options which control the output.</p></div><div class=paragraph><p>To display the commands issued by users, use <code>lastcomm</code>. For example, this command prints out all usage of <code>ls</code> by <code>trhodes</code> on the <code>ttyp1</code> terminal:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># lastcomm ls trhodes ttyp1</span></code></pre></div></div><div class=paragraph><p>Many other useful options exist and are explained in <a href="https://man.freebsd.org/cgi/man.cgi?query=lastcomm&amp;sektion=1&amp;format=html">lastcomm(1)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=acct&amp;sektion=5&amp;format=html">acct(5)</a>, and <a href="https://man.freebsd.org/cgi/man.cgi?query=sa&amp;sektion=8&amp;format=html">sa(8)</a>.</p></div></div></div></div><div class=sect1><h2 id=security-resourcelimits>14.13. Resource Limits<a class=anchor href=#security-resourcelimits></a></h2><div class=sectionbody><div class=paragraph><p>FreeBSD provides several methods for an administrator to limit the amount of system resources an individual may use. Disk quotas limit the amount of disk space available to users. Quotas are discussed in <a href=../disks/#quotas>Disk Quotas</a>.</p></div><div class=paragraph><p>Limits to other resources, such as CPU and memory, can be set using either a flat file or a command to configure a resource limits database. The traditional method defines login classes by editing <span class=filename>/etc/login.conf</span>. While this method is still supported, any changes require a multi-step process of editing this file, rebuilding the resource database, making necessary changes to <span class=filename>/etc/master.passwd</span>, and rebuilding the password database. This can become time consuming, depending upon the number of users to configure.</p></div><div class=paragraph><p><code>rctl</code> can be used to provide a more fine-grained method for controlling resource limits. This command supports more than user limits as it can also be used to set resource constraints on processes and jails.</p></div><div class=paragraph><p>This section demonstrates both methods for controlling resources, beginning with the traditional method.</p></div><div class=sect2><h3 id=users-limiting>14.13.1. Configuring Login Classes<a class=anchor href=#users-limiting></a></h3><div class=paragraph><p>In the traditional method, login classes and the resource limits to apply to a login class are defined in <span class=filename>/etc/login.conf</span>. Each user account can be assigned to a login class, where <code>default</code> is the default login class. Each login class has a set of login capabilities associated with it. A login capability is a <code><em>name</em>=<em>value</em></code> pair, where <em>name</em> is a well-known identifier and <em>value</em> is an arbitrary string which is processed accordingly depending on the <em>name</em>.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Whenever <span class=filename>/etc/login.conf</span> is edited, the <span class=filename>/etc/login.conf.db</span> must be updated by executing the following command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cap_mkdb /etc/login.conf</span></code></pre></div></div></td></tr></tbody></table></div><div class=paragraph><p>Resource limits differ from the default login capabilities in two ways. First, for every limit, there is a <em>soft</em> and <em>hard</em> limit. A soft limit may be adjusted by the user or application, but may not be set higher than the hard limit. The hard limit may be lowered by the user, but can only be raised by the superuser. Second, most resource limits apply per process to a specific user.</p></div><div class=paragraph><p><a href=#resource-limits>Login Class Resource Limits</a> lists the most commonly used resource limits. All of the available resource limits and capabilities are described in detail in <a href="https://man.freebsd.org/cgi/man.cgi?query=login.conf&amp;sektion=5&amp;format=html">login.conf(5)</a>.</p></div><table id=resource-limits class="tableblock frame-none grid-all stretch"><caption class=title>Tabela 1. Login Class Resource Limits</caption><col style=width:20%><col style=width:80%><thead><tr><th class="tableblock halign-left valign-top">Resource Limit</th><th class="tableblock halign-left valign-top">Description</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock>coredumpsize</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>The limit on the size of a core file generated by a program is subordinate to other limits on disk usage, such as <code>filesize</code> or disk quotas. This limit is often used as a less severe method of controlling disk space consumption. Since users do not generate core files and often do not delete them, this setting may save them from running out of disk space should a large program crash.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>cputime</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>The maximum amount of CPU time a user’s process may consume. Offending processes will be killed by the kernel. This is a limit on CPU <em>time</em> consumed, not the percentage of the CPU as displayed in some of the fields generated by <code>top</code> and <code>ps</code>.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>filesize</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>The maximum size of a file the user may own. Unlike disk quotas (<a href=../disks/#quotas>Disk Quotas</a>), this limit is enforced on individual files, not the set of all files a user owns.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>maxproc</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>The maximum number of foreground and background processes a user can run. This limit may not be larger than the system limit specified by <code>kern.maxproc</code>. Setting this limit too small may hinder a user’s productivity as some tasks, such as compiling a large program, start lots of processes.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>memorylocked</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>The maximum amount of memory a process may request to be locked into main memory using <a href="https://man.freebsd.org/cgi/man.cgi?query=mlock&amp;sektion=2&amp;format=html">mlock(2)</a>. Some system-critical programs, such as <a href="https://man.freebsd.org/cgi/man.cgi?query=amd&amp;sektion=8&amp;format=html">amd(8)</a>, lock into main memory so that if the system begins to swap, they do not contribute to disk thrashing.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>memoryuse</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>The maximum amount of memory a process may consume at any given time. It includes both core memory and swap usage. This is not a catch-all limit for restricting memory consumption, but is a good start.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>openfiles</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>The maximum number of files a process may have open. In FreeBSD, files are used to represent sockets and IPC channels, so be careful not to set this too low. The system-wide limit for this is defined by <code>kern.maxfiles</code>.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>sbsize</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>The limit on the amount of network memory a user may consume. This can be generally used to limit network communications.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>stacksize</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>The maximum size of a process stack. This alone is not sufficient to limit the amount of memory a program may use, so it should be used in conjunction with other limits.</p></td></tr></tbody></table><div class=paragraph><p>There are a few other things to remember when setting resource limits:</p></div><div class=ulist><ul><li><p>Processes started at system startup by <span class=filename>/etc/rc</span> are assigned to the <code>daemon</code> login class.</p></li><li><p>Although the default <span class=filename>/etc/login.conf</span> is a good source of reasonable values for most limits, they may not be appropriate for every system. Setting a limit too high may open the system up to abuse, while setting it too low may put a strain on productivity.</p></li><li><p>Xorg takes a lot of resources and encourages users to run more programs simultaneously.</p></li><li><p>Many limits apply to individual processes, not the user as a whole. For example, setting <code>openfiles</code> to <code>50</code> means that each process the user runs may open up to <code>50</code> files. The total amount of files a user may open is the value of <code>openfiles</code> multiplied by the value of <code>maxproc</code>. This also applies to memory consumption.</p></li></ul></div><div class=paragraph><p>For further information on resource limits and login classes and capabilities in general, refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=cap.mkdb&amp;sektion=1&amp;format=html">cap.mkdb(1)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=getrlimit&amp;sektion=2&amp;format=html">getrlimit(2)</a>, and <a href="https://man.freebsd.org/cgi/man.cgi?query=login.conf&amp;sektion=5&amp;format=html">login.conf(5)</a>.</p></div></div><div class=sect2><h3 id=_enabling_and_configuring_resource_limits>14.13.2. Enabling and Configuring Resource Limits<a class=anchor href=#_enabling_and_configuring_resource_limits></a></h3><div class=paragraph><p>The <code>kern.racct.enable</code> tunable must be set to a non-zero value. Custom kernels require specific configuration:</p></div><div class="literalblock programlisting"><div class=content><pre>options         RACCT
options         RCTL</pre></div></div><div class=paragraph><p>Once the system has rebooted into the new kernel, <code>rctl</code> may be used to set rules for the system.</p></div><div class=paragraph><p>Rule syntax is controlled through the use of a subject, subject-id, resource, and action, as seen in this example rule:</p></div><div class="literalblock programlisting"><div class=content><pre>user:trhodes:maxproc:deny=10/user</pre></div></div><div class=paragraph><p>In this rule, the subject is <code>user</code>, the subject-id is <code>trhodes</code>, the resource, <code>maxproc</code>, is the maximum number of processes, and the action is <code>deny</code>, which blocks any new processes from being created. This means that the user, <code>trhodes</code>, will be constrained to no greater than <code>10</code> processes. Other possible actions include logging to the console, passing a notification to <a href="https://man.freebsd.org/cgi/man.cgi?query=devd&amp;sektion=8&amp;format=html">devd(8)</a>, or sending a sigterm to the process.</p></div><div class=paragraph><p>Some care must be taken when adding rules. Since this user is constrained to <code>10</code> processes, this example will prevent the user from performing other tasks after logging in and executing a <code>screen</code> session. Once a resource limit has been hit, an error will be printed, as in this example:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% man <span class=nb>test</span>
    /usr/bin/man: Cannot fork: Resource temporarily unavailable
<span class=nb>eval</span>: Cannot fork: Resource temporarily unavailable</code></pre></div></div><div class=paragraph><p>As another example, a jail can be prevented from exceeding a memory limit. This rule could be written as:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># rctl -a jail:httpd:memoryuse:deny=2G/jail</span></code></pre></div></div><div class=paragraph><p>Rules will persist across reboots if they have been added to <span class=filename>/etc/rctl.conf</span>. The format is a rule, without the preceding command. For example, the previous rule could be added as:</p></div><div class="literalblock programlisting"><div class=content><pre># Block jail from using more than 2G memory:
jail:httpd:memoryuse:deny=2G/jail</pre></div></div><div class=paragraph><p>To remove a rule, use <code>rctl</code> to remove it from the list:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># rctl -r user:trhodes:maxproc:deny=10/user</span></code></pre></div></div><div class=paragraph><p>A method for removing all rules is documented in <a href="https://man.freebsd.org/cgi/man.cgi?query=rctl&amp;sektion=8&amp;format=html">rctl(8)</a>. However, if removing all rules for a single user is required, this command may be issued:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># rctl -r user:trhodes</span></code></pre></div></div><div class=paragraph><p>Many other resources exist which can be used to exert additional control over various <code>subjects</code>. See <a href="https://man.freebsd.org/cgi/man.cgi?query=rctl&amp;sektion=8&amp;format=html">rctl(8)</a> to learn about them.</p></div></div></div></div><div class=sect1><h2 id=security-sudo>14.14. Shared Administration with Sudo<a class=anchor href=#security-sudo></a></h2><div class=sectionbody><div class=paragraph><p>System administrators often need the ability to grant enhanced permissions to users so they may perform privileged tasks. The idea that team members are provided access to a FreeBSD system to perform their specific tasks opens up unique challenges to every administrator. These team members only need a subset of access beyond normal end user levels; however, they almost always tell management they are unable to perform their tasks without superuser access. Thankfully, there is no reason to provide such access to end users because tools exist to manage this exact requirement.</p></div><div class=paragraph><p>Up to this point, the security chapter has covered permitting access to authorized users and attempting to prevent unauthorized access. Another problem arises once authorized users have access to the system resources. In many cases, some users may need access to application startup scripts, or a team of administrators need to maintain the system. Traditionally, the standard users and groups, file permissions, and even the <a href="https://man.freebsd.org/cgi/man.cgi?query=su&amp;sektion=1&amp;format=html">su(1)</a> command would manage this access. And as applications required more access, as more users needed to use system resources, a better solution was required. The most used application is currently Sudo.</p></div><div class=paragraph><p>Sudo allows administrators to configure more rigid access to system commands and provide for some advanced logging features. As a tool, it is available from the Ports Collection as <a class=package href=https://cgit.freebsd.org/ports/tree/security/sudo/>security/sudo</a> or by use of the <a href="https://man.freebsd.org/cgi/man.cgi?query=pkg&amp;sektion=8&amp;format=html">pkg(8)</a> utility. To use the <a href="https://man.freebsd.org/cgi/man.cgi?query=pkg&amp;sektion=8&amp;format=html">pkg(8)</a> tool:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pkg install sudo</span></code></pre></div></div><div class=paragraph><p>After the installation is complete, the installed <code>visudo</code> will open the configuration file with a text editor. Using <code>visudo</code> is highly recommended as it comes with a built in syntax checker to verify there are no errors before the file is saved.</p></div><div class=paragraph><p>The configuration file is made up of several small sections which allow for extensive configuration. In the following example, web application maintainer, user1, needs to start, stop, and restart the web application known as <em>webservice</em>. To grant this user permission to perform these tasks, add this line to the end of <span class=filename>/usr/local/etc/sudoers</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>user1   ALL=(ALL)       /usr/sbin/service webservice *</pre></div></div><div class=paragraph><p>The user may now start <em>webservice</em> using this command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% <span class=nb>sudo</span> /usr/sbin/service webservice start</code></pre></div></div><div class=paragraph><p>While this configuration allows a single user access to the webservice service; however, in most organizations, there is an entire web team in charge of managing the service. A single line can also give access to an entire group. These steps will create a web group, add a user to this group, and allow all members of the group to manage the service:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pw groupadd -g 6001 -n webteam</span></code></pre></div></div><div class=paragraph><p>Using the same <a href="https://man.freebsd.org/cgi/man.cgi?query=pw&amp;sektion=8&amp;format=html">pw(8)</a> command, the user is added to the webteam group:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pw groupmod -m user1 -n webteam</span></code></pre></div></div><div class=paragraph><p>Finally, this line in <span class=filename>/usr/local/etc/sudoers</span> allows any member of the webteam group to manage <em>webservice</em>:</p></div><div class="literalblock programlisting"><div class=content><pre>%webteam   ALL=(ALL)       /usr/sbin/service webservice *</pre></div></div><div class=paragraph><p>Unlike <a href="https://man.freebsd.org/cgi/man.cgi?query=su&amp;sektion=1&amp;format=html">su(1)</a>, Sudo only requires the end user password. This adds an advantage where users will not need shared passwords, a finding in most security audits and just bad all the way around.</p></div><div class=paragraph><p>Users permitted to run applications with Sudo only enter their own passwords. This is more secure and gives better control than <a href="https://man.freebsd.org/cgi/man.cgi?query=su&amp;sektion=1&amp;format=html">su(1)</a>, where the <code>root</code> password is entered and the user acquires all <code>root</code> permissions.</p></div><div class="admonitionblock tip"><table><tbody><tr><td class=icon><i class="fa icon-tip" title=Tip></i></td><td class=content><div class=paragraph><p>Most organizations are moving or have moved toward a two factor authentication model. In these cases, the user may not have a password to enter. Sudo provides for these cases with the <code>NOPASSWD</code> variable. Adding it to the configuration above will allow all members of the <em>webteam</em> group to manage the service without the password requirement:</p></div><div class="literalblock programlisting"><div class=content><pre>%webteam   ALL=(ALL)       NOPASSWD: /usr/sbin/service webservice *</pre></div></div></td></tr></tbody></table></div><div class=sect2><h3 id=security-sudo-loggin>14.14.1. Logging Output<a class=anchor href=#security-sudo-loggin></a></h3><div class=paragraph><p>An advantage to implementing Sudo is the ability to enable session logging. Using the built in log mechanisms and the included sudoreplay command, all commands initiated through Sudo are logged for later verification. To enable this feature, add a default log directory entry, this example uses a user variable. Several other log filename conventions exist, consult the manual page for sudoreplay for additional information.</p></div><div class="literalblock programlisting"><div class=content><pre>Defaults iolog_dir=/var/log/sudo-io/%{user}</pre></div></div><div class="admonitionblock tip"><table><tbody><tr><td class=icon><i class="fa icon-tip" title=Tip></i></td><td class=content><div class=paragraph><p>This directory will be created automatically after the logging is configured. It is best to let the system create directory with default permissions just to be safe. In addition, this entry will also log administrators who use the sudoreplay command. To change this behavior, read and uncomment the logging options inside <span class=filename>sudoers</span>.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Once this directive has been added to the <span class=filename>sudoers</span> file, any user configuration can be updated with the request to log access. In the example shown, the updated <em>webteam</em> entry would have the following additional changes:</p></div><div class="literalblock programlisting"><div class=content><pre>%webteam ALL=(ALL) NOPASSWD: LOG_INPUT: LOG_OUTPUT: /usr/sbin/service webservice *</pre></div></div><div class=paragraph><p>From this point on, all <em>webteam</em> members altering the status of the <em>webservice</em> application will be logged. The list of previous and current sessions can be displayed with:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sudoreplay -l</span></code></pre></div></div><div class=paragraph><p>In the output, to replay a specific session, search for the <code>TSID=</code> entry, and pass that to sudoreplay with no other options to replay the session at normal speed. For example:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sudoreplay user1/00/00/02</span></code></pre></div></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>While sessions are logged, any administrator is able to remove sessions and leave only a question of why they had done so. It is worthwhile to add a daily check through an intrusion detection system (IDS) or similar software so that other administrators are alerted to manual alterations.</p></div></td></tr></tbody></table></div><div class=paragraph><p>The <code>sudoreplay</code> is extremely extendable. Consult the documentation for more information.</p></div></div></div></div></div><hr><div class=last-modified><p><strong>Last modified on</strong>: 9 marca 2024 by <a href="https://cgit.freebsd.org/doc/commit/?id=6199af92e7" target=_blank>Danilo G. Baio</a></p></div><div class=buttons><div class=prev><i class="fa fa-angle-left" aria-hidden=true title=Prev></i><div class=container><a href=https://docs.freebsd.org/pl/books/handbook/users class=direction>Prev</a></div></div><div class=home><i class="fa fa-home" aria-hidden=true title=Home></i><div class=container><a href=../ class=direction>Home</a></div></div><div class=next><div class=container><a href=https://docs.freebsd.org/pl/books/handbook/jails class=direction>Next</a></div><i class="fa fa-angle-right" aria-hidden=true title=Next></i></div></div><label class="hidden book-menu-overlay" for=menu-control></label></div><aside class=toc><div class=toc-content><h3>Table of Contents</h3><nav id=TableOfContents><ul><li><a href=#security-synopsis>14.1. Synopsis</a></li><li><a href=#security-intro>14.2. Introduction</a></li><li><a href=#one-time-passwords>14.3. One-time Passwords</a></li><li><a href=#tcpwrappers>14.4. TCP Wrapper</a></li><li><a href=#kerberos5>14.5. Kerberos</a></li><li><a href=#openssl>14.6. OpenSSL</a></li><li><a href=#ipsec>14.7. VPN over IPsec</a></li><li><a href=#openssh>14.8. OpenSSH</a></li><li><a href=#fs-acl>14.9. Access Control Lists</a></li><li><a href=#security-pkg>14.10. Monitoring Third Party Security Issues</a></li><li><a href=#security-advisories>14.11. FreeBSD Security Advisories</a></li><li><a href=#security-accounting>14.12. Process Accounting</a></li><li><a href=#security-resourcelimits>14.13. Resource Limits</a></li><li><a href=#security-sudo>14.14. Shared Administration with Sudo</a></li></ul></nav><hr><div class=resources><h3>Resources</h3><ul class=contents><li><i class="fa fa-file-pdf-o" aria-hidden=true title="Download PDF"></i><a href=https://download.freebsd.org/doc/pl/books/handbook/handbook_pl.pdf>Download PDF</a></li><li><i class="fa fa-pencil-square-o" aria-hidden=true title="Edit this page"></i><a href=https://github.com/freebsd/freebsd-doc/blob/main/documentation/content/pl/_index target=_blank>Edit this page</a></li></ul></div></div></aside><a class=to-top href=#top><i class="fa fa-arrow-circle-up" aria-hidden=true></i></a></main><footer><div class=footer-container><section class=logo-column><img src=https://docs.freebsd.org/images/FreeBSD-colors.svg width=160 height=50 alt="FreeBSD logo"><div class=options-container><div class=language-container><a id=languages href=https://docs.freebsd.org/pl/languages><img src=https://docs.freebsd.org/images/language.png class=language-image alt="Choose language">
<span>Polish</span></a></div><div class=theme-container><select id=theme-chooser><option value=theme-system>System</option><option value=theme-light>Light</option><option value=theme-dark>Dark</option><option value=theme-high-contrast>High contrast</option></select></div></div></section><section class=about-column><h3 class=column-title>About</h3><ul class=column-elements-container><li><a href=https://www.freebsd.org/about/ target=_blank class=column-element>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/ target=_blank class=column-element>FreeBSD Foundation</a></li><li><a href=https://www.freebsd.org/where/ target=_blank class=column-element>Get FreeBSD</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct target=_blank class=column-element>Code of Conduct</a></li><li><a href=https://www.freebsd.org/security/ target=_blank class=column-element>Security Advisories</a></li></ul></section><section class=documentation-column><h3 class=column-title>Documentation</h3><ul class=column-elements-container><li><a href=/pl class=column-element>Documentation portal</a></li><li><a href=https://man.FreeBSD.org target=_blank class=column-element>Manual pages</a></li><li><a href=https://papers.FreeBSD.org target=_blank class=column-element>Presentations and papers</a></li><li><a href=https://docs-archive.freebsd.org/doc/ target=_blank class=column-element>Previous versions</a></li><li><a href=https://docs-archive.freebsd.org/44doc/ target=_blank class=column-element>4.4BSD Documents</a></li><li><a href=https://wiki.freebsd.org/ target=_blank class=column-element>Wiki</a></li></ul></section><section class=community-column><h3 class=column-title>Community</h3><ul class=column-elements-container><li><a href=https://docs.freebsd.org/pl/articles/contributing class=column-element>Get involved</a></li><li><a href=https://forums.freebsd.org/ target=_blank class=column-element>Community forum</a></li><li><a href=https://lists.freebsd.org/ target=_blank class=column-element>Mailing lists</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank class=column-element>IRC Channels</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank class=column-element>Bug Tracker</a></li></ul></section><section class=legal-column><h3 class=column-title>Legal</h3><ul class=column-elements-container><li><a href=https://freebsdfoundation.org/donate/ target=_blank class=column-element>Donations</a></li><li><a href=https://www.freebsd.org/copyright/freebsd-license/ target=_blank class=column-element>Licensing</a></li><li><a href=https://www.freebsd.org/privacy/ target=_blank class=column-element>Privacy Policy</a></li><li><a href=https://www.freebsd.org/copyright/ target=_blank class=column-element>Legal notices</a></li></ul></section><section class=copyright-column><p>&copy; 1994-2024 The FreeBSD Project. All rights reserved</p><span>Made with <span class=heart>♥</span> by the FreeBSD Community</span></section></div></footer></body></html>