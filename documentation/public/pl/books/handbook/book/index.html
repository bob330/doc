<!doctype html><html class=theme-light lang=pl><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content><meta name=copyright content="1995-2024 The FreeBSD Foundation"><link rel=canonical href=https://docs.freebsd.org/pl/books/handbook/book/><title>Podręcznik FreeBSD | FreeBSD Documentation Portal</title>
<meta name=theme-color content="#790000"><meta name=color-scheme content="system light dark high-contrast"><link rel="shortcut icon" href=https://docs.freebsd.org/favicon.ico><link rel=stylesheet href=https://docs.freebsd.org/styles/main.min.css><link rel=stylesheet href=https://docs.freebsd.org/css/font-awesome-min.css><script defer src=/js/theme-chooser.min.js></script><script defer src=/js/copy-clipboard.min.js></script><script defer src=/js/search.min.js></script><meta name=twitter:card content="summary"><meta name=twitter:domain content="docs.FreeBSD.org"><meta name=twitter:site content="@freebsd"><meta name=twitter:url content="https://twitter.com/freebsd"><meta property="og:title" content="Podręcznik FreeBSD"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:image" content="https://docs.freebsd.org/favicon.ico"><meta property="og:image:alt" content="FreeBSD Logo"><meta property="og:locale" content="pl"><meta property="og:url" content="https://docs.freebsd.org/pl/books/handbook/book/"><meta property="og:site_name" content="FreeBSD Documentation Portal"><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","url":"https:\/\/docs.freebsd.org\/pl\/books\/handbook\/book\/","name":"FreeBSD Documentation Portal","headline":"FreeBSD Documentation Portal","description":"FreeBSD Documentation Portal"}</script></head><body><header><div class=header-container><div class=logo-menu-bars-container><a href=https://www.FreeBSD.org class=logo><img src=https://docs.freebsd.org/images/FreeBSD-monochromatic.svg width=160 height=50 alt="FreeBSD logo">
</a><label class=menu-bars for=menu-bars><i class="fa fa-bars" aria-hidden=true></i></label></div><input id=menu-bars type=checkbox><nav><ul class=menu><li class=menu-item><input id=about type=checkbox>
<a href=# aria-label="Navigate to About section"><label class=menu-item-description for=about>About
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/about/ target=_blank>About</a></li><li><a href=https://www.freebsd.org/about/ target=_blank>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/about-us/about-the-foundation/ target=_blank>FreeBSD Foundation</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct/ target=_blank>Code of Conduct</a></li></ul></li><li class=menu-item><input id=download type=checkbox>
<a href=# aria-label="Navigate to get FreeBSD section"><label class=menu-item-description for=download>Get FreeBSD
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/where/ target=_blank>Get FreeBSD</a></li><li><a href=https://www.freebsd.org/releases/ target=_blank>Release Information</a></li><li><a href=https://www.freebsd.org/releng/ target=_blank>Release Engineering</a></li><li><a href=https://www.freebsd.org/security/ target=_blank>Security Advisories</a></li></ul></li><li class=menu-item><input id=documentation type=checkbox>
<a href=# aria-label="Navigate to get Documentation section"><label class=menu-item-description for=documentation>Documentation
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=/pl>Documentation portal</a></li><li><a href=https://docs.freebsd.org/pl/books/handbook>FreeBSD Handbook</a></li><li><a href=https://docs.freebsd.org/pl/books/porters-handbook>Porter's Handbook</a></li><li><a href=https://docs.FreeBSD.org/en/books/fdp-primer>Documentation Project Handbook</a></li><li><a href=https://man.FreeBSD.org target=_blank>Manual pages</a></li><li><a href=https://papers.FreeBSD.org target=_blank>Presentations and papers</a></li><li><a href=https://wiki.FreeBSD.org target=_blank>Wiki</a></li><li><a href=https://docs.freebsd.org/pl/books>Books</a></li><li><a href=https://docs.freebsd.org/pl/articles>Articles</a></li></ul></li><li class=menu-item><input id=community type=checkbox>
<a href=# aria-label="Navigate to get Community section"><label class=menu-item-description for=community>Community
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/community/>Community</a></li><li><a href=https://docs.freebsd.org/pl/articles/contributing>Get involved</a></li><li><a href=https://forums.freebsd.org/ target=_blank>Forum</a></li><li><a href=https://lists.freebsd.org/ target=_blank>Mailing lists</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank>IRC Channels</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank>Bug Tracker</a></li><li><a href=https://www.freebsd.org/support/ target=_blank>Support</a></li></ul></li></ul></nav><div class=search-donate-container><form class=search method=get id=search-header-form action=https://docs.freebsd.org/search name=search-header-form><input type=hidden name=DB value=pl>
<input id=words name=P type=text size=20 maxlength=255>
<button>
<i class="fa fa-search" aria-hidden=true></i></button></form><div class=donate><a href=https://freebsdfoundation.org/donate/ target=_blank><span class=heart>♥</span>
Donate</a></div></div></div></header><input type=checkbox class="hidden toggle" id=menu-control><main class=main-wrapper-book><a id=top></a><div class=book><h1 class=title>Podręcznik FreeBSD</h1><div class="admonitionblock note"><p><i class="fa fa-exclamation-circle" aria-hidden=true></i>
This translation may be out of date. To help with the translations please access the <a href=https://translate-dev.freebsd.org/ target=_blank>FreeBSD translations instance</a>.</p></div><div class=copyright>Copyright © 1995-2020 Projekt Dokumentacji FreeBSD</div><div class=legalnotice><a id=trademarks></a><details><summary>trademarks</summary><p>FreeBSD is a registered trademark of the FreeBSD Foundation.</p><p>IBM, AIX, OS/2, PowerPC, PS/2, S/390, and ThinkPad are trademarks of International Business Machines Corporation in the United States, other countries, or both.</p><p>IEEE, POSIX, and 802 are registered trademarks of Institute of Electrical and Electronics Engineers, Inc. in the United States.</p><p>Red Hat, RPM, are trademarks or registered trademarks of Red Hat, Inc. in the United States and other countries.</p><p>3Com and HomeConnect are registered trademarks of 3Com Corporation.</p><p>Adobe, Acrobat, Acrobat Reader, Flash and PostScript are either registered trademarks or trademarks of Adobe Systems Incorporated in the United States and/or other countries.</p><p>Apple, AirPort, FireWire, iMac, iPhone, iPad, Mac, Macintosh, Mac OS, Quicktime, and TrueType are trademarks of Apple Inc., registered in the U.S. and other countries.</p><p>Intel, Celeron, Centrino, Core, EtherExpress, i386, i486, Itanium, Pentium, and Xeon are trademarks or registered trademarks of Intel Corporation or its subsidiaries in the United States and other countries.</p><p>Linux is a registered trademark of Linus Torvalds.</p><p>Microsoft, IntelliMouse, MS-DOS, Outlook, Windows, Windows Media and Windows NT are either registered trademarks or trademarks of Microsoft Corporation in the United States and/or other countries.</p><p>Motif, OSF/1, and UNIX are registered trademarks and IT DialTone and The Open Group are trademarks of The Open Group in the United States and other countries.</p><p>Sun, Sun Microsystems, Java, Java Virtual Machine, JDK, JRE, JSP, JVM, Netra, OpenJDK, Solaris, StarOffice, SunOS and VirtualBox are trademarks or registered trademarks of Sun Microsystems, Inc. in the United States and other countries.</p><p>RealNetworks, RealPlayer, and RealAudio are the registered trademarks of RealNetworks, Inc.</p><p>Oracle is a registered trademark of Oracle Corporation.</p><p>3ware is a registered trademark of 3ware Inc.</p><p>ARM is a registered trademark of ARM Limited.</p><p>Adaptec is a registered trademark of Adaptec, Inc.</p><p>Android is a trademark of Google Inc.</p><p>Heidelberg, Helvetica, Palatino, and Times Roman are either registered trademarks or trademarks of Heidelberger Druckmaschinen AG in the U.S. and other countries.</p><p>Intuit and Quicken are registered trademarks and/or registered service marks of Intuit Inc., or one of its subsidiaries, in the United States and other countries.</p><p>LSI Logic, AcceleRAID, eXtremeRAID, MegaRAID and Mylex are trademarks or registered trademarks of LSI Logic Corp.</p><p>MATLAB is a registered trademark of The MathWorks, Inc.</p><p>SpeedTouch is a trademark of Thomson.</p><p>VMware is a trademark of VMware, Inc.</p><p>Mathematica is a registered trademark of Wolfram Research, Inc.</p><p>Ogg Vorbis and Xiph.Org are trademarks of Xiph.Org.</p><p>XFree86 is a trademark of The XFree86 Project, Inc.</p><p>Many of the designations used by manufacturers and sellers to distinguish their products are claimed as trademarks. Where those designations appear in this document, and the FreeBSD Project was aware of the trademark claim, the designations have been followed by the “™” or the “®” symbol.</p></details></div><div class=toc-mobile><h3>Table of Contents</h3><nav id=TableOfContents><ul><li><a href=#book-preface>Przedmowa</a><ul><li><a href=#preface-audience>Docelowy czytelnik</a></li><li><a href=#preface-changes-from2>Zmiany od wydania drugiego</a></li><li><a href=#preface-changes>Zmiany od wydania pierwszego</a></li><li><a href=#preface-overview>Układ książki</a></li><li><a href=#preface-conv>Konwencje użyte w tej książce</a></li><li><a href=#preface-acknowledgements>Podziękowania</a></li></ul></li><li><a href=#getting-started>Część I: Pierwsze kroki</a><ul><li><a href=#introduction>Rozdział 1. Wprowadzenie</a></li><li><a href=#install>Rozdział 2. Instalacja FreeBSD</a></li><li><a href=#basics>Rozdział 3. Podstawy Uniksa</a></li><li><a href=#ports>Rozdział 4. Instalacja programów: pakiety i porty</a></li><li><a href=#x11>Rozdział 5. System okien X</a></li></ul></li><li><a href=#common-tasks>Część II: Codzienne czynności</a><ul><li><a href=#desktop>Rozdział 6. Aplikacje biurowe</a></li><li><a href=#multimedia>Rozdział 7. Multimedia</a></li><li><a href=#kernelconfig>Rozdział 8. Konfiguracja jądra FreeBSD</a></li><li><a href=#printing>Rozdział 9. Printing</a></li><li><a href=#linuxemu>Rozdział 10. Linux® Binary Compatibility</a></li></ul></li><li><a href=#system-administration>Część III: Administracja systemem</a><ul><li><a href=#config-tuning>Rozdział 11. Configuration and Tuning</a></li><li><a href=#boot>Rozdział 12. The FreeBSD Booting Process</a></li><li><a href=#security>Rozdział 13. Security</a></li><li><a href=#jails>Rozdział 14. Jails</a></li><li><a href=#mac>Rozdział 15. Mandatory Access Control</a></li><li><a href=#audit>Rozdział 16. Security Event Auditing</a></li><li><a href=#disks>Rozdział 17. Storage</a></li><li><a href=#geom>Rozdział 18. GEOM: Modular Disk Transformation Framework</a></li><li><a href=#zfs>Rozdział 19. The Z File System (ZFS)</a></li><li><a href=#filesystems>Rozdział 20. Other File Systems</a></li><li><a href=#virtualization>Rozdział 21. Virtualization</a></li><li><a href=#l10n>Rozdział 22. Localization - i18n/L10n Usage and Setup</a></li><li><a href=#updating-upgrading>Rozdział 23. Updating and Upgrading FreeBSD</a></li><li><a href=#dtrace>Rozdział 24. DTrace</a></li><li><a href=#usb-device-mode>Rozdział 25. USB Device Mode / USB OTG</a></li></ul></li><li><a href=#network-communication>Część IV: Komunikacja sieciowa</a><ul><li><a href=#serialcomms>Rozdział 26. Serial Communications</a></li><li><a href=#ppp-and-slip>Rozdział 27. PPP</a></li><li><a href=#mail>Rozdział 28. Electronic Mail</a></li><li><a href=#network-servers>Rozdział 29. Network Servers</a></li><li><a href=#firewalls>Rozdział 30. Firewalls</a></li><li><a href=#advanced-networking>Rozdział 31. Advanced Networking</a></li></ul></li><li><a href=#appendices>Część V: Dodatki</a><ul><li><a href=#mirrors>Dodatek A: Obtaining FreeBSD</a></li><li><a href=#bibliography>Dodatek B: Bibliografia</a></li><li><a href=#eresources>Dodatek C: Resources on the Internet</a></li><li><a href=#pgpkeys>Dodatek D: Klucze PGP</a></li></ul></li></ul></nav></div><div class=book-content><div id=preamble><div class=sectionbody><div class="quoteblock abstract abstract-title"><blockquote>Abstrakt</blockquote></div><div class=paragraph><p>Witamy w świecie FreeBSD! Zadaniem niniejszego podręcznika jest opisanie procesu instalacji i czynności związanych z codziennym użytkowaniem systemu FreeBSD w wersji 11.2-RELEASE oraz 12.0-RELEASE. Prace nad tym podręcznikiem trwają cały czas. Stanowi on dzieło wielu osób z całego świata. Tym nie mniej mamy świadomość, iż wiele rozdziałów wciąż nie zostało napisanych, a niektóre spośród istniejących wymagają aktualizacji. Jeśli jesteś zainteresowany pomocą w rozwoju projektu wyślij email na adres <a href=https://lists.FreeBSD.org/subscription/freebsd-doc>FreeBSD documentation project mailing list</a>. Najnowsza wersja anglojęzyczna niniejszego dokumentu jest zawsze dostępna na stronie domowej FreeBSD (wersje wcześniejsze dostępne są pod adresem <a href=http://docs.FreeBSD.org/doc/ class=bare>http://docs.FreeBSD.org/doc/</a>). Podręcznik dostępny jest również w innych formatach dokumentów oraz w postaci skompresowanej z <a href=ftp://ftp.freebsd.org/pub/FreeBSD/doc/>serwera FTP Projektu FreeBSD</a> bądź jednego z wielu <a href=./#mirrors-ftp>serwerów lustrzanych</a>. Dla osób zainteresowanych, drukowaną wersję podręcznika (język ang.) można nabyć wprost z witryny <a href=https://www.freebsdmall.com/>FreeBSD Mall</a>. Dostępne jest również <a href=https://www.FreeBSD.org/search/>przeszukiwanie podręcznika</a>.</p></div><hr></div></div><div class=sect1><h2 id=book-preface>Przedmowa<a class=anchor href=#book-preface></a></h2><div class=sectionbody><div class=sect2><h3 id=preface-audience>Docelowy czytelnik<a class=anchor href=#preface-audience></a></h3><div class=paragraph><p>Osoba poznająca dopiero system FreeBSD odnajdzie w pierwszej części niniejszej książki szereg porad prowadzących użytkownika przez proces instalacji i delikatnie prezentujących pewne koncepcje i konwencje stojące u podstaw systemów UNIX®. Przebrnięcie przez tę część wymaga niewiele więcej niż chęć poznania i umiejętność przyswajania sobie nowych koncepcji w miarę jak będą one prezentowane.</p></div><div class=paragraph><p>Po dotrwaniu do drugiej, zdecydowanie obszerniejszej części Podręcznika, czytelnik będzie miał do dyspozycji pełną wiedzę z zakresu wszystkich zagadnień znajdujacych się w polu zainteresowań administratorów systemów FreeBSD. Niektóre z zawartych tutaj rozdziałów mogą wymagać wcześniejszego zapoznania się z odpowiednią literaturą. W takich przypadkach, będzie to wyszczególnione w streszczeniu na początku każdego rozdziału.</p></div><div class=paragraph><p><a href=./#bibliography>Bibliography</a> zawiera listę dodatkowych źródeł informacji.</p></div></div><div class=sect2><h3 id=preface-changes-from2>Zmiany od wydania drugiego<a class=anchor href=#preface-changes-from2></a></h3><div class=paragraph><p>Niniejsze trzecie wydanie stanowi punkt kulminacyjny przeszło dwuletniej pracy oddanych członków Projektu Dokumentacji FreeBSD. Główne zmiany jakie w tym okresie zostały dokonane to:</p></div><div class=ulist><ul><li><p><a href=./#config-tuning>Configuration and Tuning</a>, Konfiguracja i dostrajanie został poszerzony o nowe informacje o zarządzaniu mocą i zasobami APCI, opis narzędzia cron i kolejną porcję opcji dostrajania jądra.</p></li><li><p><a href=./#security>Security</a>, Bezpieczeństwo, został poszerzony o nowe informacje odnośnie wirtualnych sieci prywatnych (VPN), list kontroli dostępu do systemu plików, i biuletynach bezpieczeństwa.</p></li><li><p><a href=./#mac>Mandatory Access Control</a>, Mandatory Access Control (MAC), is a new chapter with this edition. It explains what MAC is and how this mechanism can be used to secure a FreeBSD system.</p></li><li><p><a href=./#disks>Storage</a>, Storage, has been expanded with new information about USB storage devices, file system snapshots, file system quotas, file and network backed filesystems, and encrypted disk partitions.</p></li><li><p>The Vinum Volume Manager, Vinum, is a new chapter with this edition. It describes how to use Vinum, a logical volume manager which provides device-independent logical disks, and software RAID-0, RAID-1 and RAID-5.</p></li><li><p>A troubleshooting section has been added to <a href=./#ppp-and-slip>PPP</a>, PPP and SLIP.</p></li><li><p><a href=./#mail>Electronic Mail</a>, Electronic Mail, has been expanded with new information about using alternative transport agents, SMTP authentication, UUCP, fetchmail, procmail, and other advanced topics.</p></li><li><p><a href=./#network-servers>Network Servers</a>, Network Servers, is all new with this edition. This chapter includes information about setting up the Apache HTTP Server, FTPd, and setting up a server for Microsoft Windows clients with Samba. Some sections from <a href=./#advanced-networking>Advanced Networking</a>, Advanced Networking, were moved here to improve the presentation.</p></li><li><p><a href=./#advanced-networking>Advanced Networking</a>, Advanced Networking, has been expanded with new information about using Bluetooth devices with FreeBSD, setting up wireless networks, and Asynchronous Transfer Mode (ATM) networking.</p></li><li><p>Definicje i wykorzystywane w książce terminy techniczne zostały zebrane razem w formie leksykonu.</p></li><li><p>Dokonano wielu estetycznych poprawek tabel i rysunków.</p></li></ul></div></div><div class=sect2><h3 id=preface-changes>Zmiany od wydania pierwszego<a class=anchor href=#preface-changes></a></h3><div class=paragraph><p>Wydanie drugie stanowiło punkt kulminacyjny przeszło dwuletniej pracy oddanych członków Projektu Dokumentacji FreeBSD. Główne zmiany jakie w tym okresie zostały dokonane to:</p></div><div class=ulist><ul><li><p>Dodano indeks.</p></li><li><p>Wszystkie diagramy ASCII zostały zastąpione rysunkami graficznymi.</p></li><li><p>Dodano standardowe streszczenie do wszystkich rozdziałów, informujące jakie informacje rozdział zawiera i co powinien wiedzieć czytelnik nim przystąpi do czytania.</p></li><li><p>Zawartość podręcznika została zreorganizowana w trzy logiczne części: "Pierwsze kroki", "Administracja systemem" oraz "Dodatki".</p></li><li><p><a href=./#install>Instalacja FreeBSD</a> ("Instalacja FreeBSD") został całkowicie przepisany na nowo.Dołączono wiele zrzutów ekranu, by ułatwić nowym użytkownikom przyswojenie tekstu.</p></li><li><p><a href=./#basics>Podstawy Uniksa</a> ("Podstawy Uniksa") został poszerzony o dodatkow informacje o procesach, demonach i sygnałach.</p></li><li><p><a href=./#ports>Instalacja programów. pakiety i porty</a> ("Instalacja programów") został poszerzony o dodatkowe informacje o zarządzaniu pakietami binarnymi.</p></li><li><p><a href=./#x11>System okien X</a> ("System okien X") został w całkości napisany od nowa kładąc nacisk na współczesne środowiska graficzne we XFree86TM 4.X, takie jak KDE i GNOME.</p></li><li><p><a href=./#boot>The FreeBSD Booting Process</a> ("Proces uruchamiania FreeBSD") został poszerzony.</p></li><li><p><a href=./#disks>Storage</a> ("Pamięć") został napisany na podstawie rozdziałów "Dyski" oraz "Kopie zapasowe". Uważamy, że zagadnienia te łatwiej jest zrozumieć, gdy są przedstawiane jako jeden rozdział. Dodano również podrozdział traktujący o RAID (zarówno sprzętowym jak i programowym).</p></li><li><p><a href=./#serialcomms>Serial Communications</a> ("Komunikacja szeregowa") został całkowicie zreorganizowany i zaktualizowany dla FreeBSD 4.X/5.X.</p></li><li><p><a href=./#ppp-and-slip>PPP and SLIP</a> ("PPP i SLIP") zostały zasadniczo zaktualizowane.</p></li><li><p><a href=./#advanced-networking>Advanced Networking</a> ("Advanced Networking") został zaktualizowany.</p></li><li><p><a href=./#mail>Electronic Mail</a> ("Poczta elektroniczna") został rozszerzony materiały traktujące o konfiguracji programu sendmail.</p></li><li><p><a href=./#linuxemu>Linux® Binary Compatibility</a> ("Kompatybilność z Linuksem") został poszerzony o informacje o instalacji bazy Oracle® oraz SAP® R/3®.</p></li></ul></div><div class=paragraph><p>W drugim wydaniu dodano nowe rozdziały:</p></div><div class=ulist><ul><li><p>Konfiguracja i dostrajanie (<a href=./#config-tuning>Configuration and Tuning</a>).</p></li><li><p>Multimedia (<a href=./#multimedia>Multimedia</a>)</p></li></ul></div></div><div class=sect2><h3 id=preface-overview>Układ książki<a class=anchor href=#preface-overview></a></h3><div class=paragraph><p>Niniejsza książka została podzielona na pięć logicznych części. Część pierwsza, <em>Pierwsze kroki</em>, opisuje proces instalacji oraz podstawy użytkowania systemu FreeBSD. Zaleca się aby czytelnik zapoznał się z tymi rozdziałami kolejno, pomijając jedynie znane tematy. Część druga, Codzienne czynności, prezentuje niektóre z najczęściej wykorzystywanych funkcji FreeBSD. Ta część, wraz kolejnymi, może być czytania bez określonej kolejności. Każdy z wchodzących w jej skład rozdziałów zaczyna się od zwięzłego strzeszczenia zawartości i przedstawienia co czytelnik powinien już wiedzieć. Celem takiego układu jest pozwolenie zwykłemu czytelnikowi pominąć pewne rozdziały, by prejść od razu do najbardziej interesujących. Część trzecia, <em>Administracja Systemem</em>, opisuje zagadnienia administracyjne. Część czwarta, <em>Komunikacja sieciowa</em>, zawiera tematy związane z pracą w sieci oraz obsługą serwerów. Część piąta zawiera dodatki.</p></div><div class=dlist><dl><dt class=hdlist1><em><a href=./#introduction>Wprowadzenie</a></em></dt><dd><p>Wprowadza nowego użytkownika w świat FreeBSD. Streszcza historię Projektu FreeBSD, stawiane przed nim cele oraz model rozwoju.</p></dd><dt class=hdlist1><em><a href=./#bsdinstall>Instalacja FreeBSD</a></em></dt><dd><p>Przeprowadza użytkownika przez cały proces instalacji. Opisuje również kilka zaawansowanych zagadnień, jak np. instalację przez konsolę szeregową.</p></dd><dt class=hdlist1><em><a href=./#basics>Podstawy Uniksa</a></em></dt><dd><p>Przedstawia podstawowe polecenie i funkcje systemu operacyjnego FreeBSD. Jeśli pracowaliśmy w Linuksie bądź w innym systemie typu UNIX® najprawdopodobniej możemy pominąć ten rozdział.</p></dd><dt class=hdlist1><em><a href=./#ports>Instalacja programów. pakiety i porty</a></em></dt><dd><p>Opisuje metody instalacji dodatkowego oprogramowania we FreeBSD za pomocą systemu "Kolekcji portów" oraz typowych pakietów binarnych.</p></dd><dt class=hdlist1><em><a href=./#x11>System okien X</a></em></dt><dd><p>Opisuje ogólnie System okien X oraz wykorzystanie X11 we FreeBSD. Ponadto, przedstawia typowe środowiska graficzne jak np. KDE czy GNOME.</p></dd><dt class=hdlist1><em><a href=./#desktop>Aplikacje biurowe</a></em></dt><dd><p>Lists some common desktop applications, such as web browsers and productivity suites, and describes how to install them on FreeBSD.</p></dd><dt class=hdlist1><em><a href=./#multimedia>Multimedia</a></em></dt><dd><p>Shows how to set up sound and video playback support for your system. Also describes some sample audio and video applications.</p></dd><dt class=hdlist1><em><a href=./#kernelconfig>Konfiguracja jądra FreeBSD</a></em></dt><dd><p>Explains why you might need to configure a new kernel and provides detailed instructions for configuring, building, and installing a custom kernel.</p></dd><dt class=hdlist1><em><a href=./#printing>Printing</a></em></dt><dd><p>Describes managing printers on FreeBSD, including information about banner pages, printer accounting, and initial setup.</p></dd><dt class=hdlist1><em><a href=./#linuxemu>Linux® Binary Compatibility</a></em></dt><dd><p>Describes the Linux® compatibility features of FreeBSD. Also provides detailed installation instructions for many popular Linux® applications such as Oracle® and Mathematica®.</p></dd><dt class=hdlist1><em><a href=./#config-tuning>Configuration and Tuning</a></em></dt><dd><p>Describes the parameters available for system administrators to tune a FreeBSD system for optimum performance. Also describes the various configuration files used in FreeBSD and where to find them.</p></dd><dt class=hdlist1><em><a href=./#boot>The FreeBSD Booting Process</a></em></dt><dd><p>Describes the FreeBSD boot process and explains how to control this process with configuration options.</p></dd><dt class=hdlist1><em><a href=./#users>Użytkownicy i podstawy zarządzania kontami</a></em></dt><dd><p>Describes the creation and manipulation of user accounts. Also discusses resource limitations that can be set on users and other account management tasks.</p></dd><dt class=hdlist1><em><a href=./#security>Security</a></em></dt><dd><p>Describes many different tools available to help keep your FreeBSD system secure, including Kerberos, IPsec and OpenSSH.</p></dd><dt class=hdlist1><em><a href=./#jails>Jails</a></em></dt><dd><p>Describes the jails framework, and the improvements of jails over the traditional chroot support of FreeBSD.</p></dd><dt class=hdlist1><em><a href=./#mac>Mandatory Access Control</a></em></dt><dd><p>Explains what Mandatory Access Control (MAC) is and how this mechanism can be used to secure a FreeBSD system.</p></dd><dt class=hdlist1><em><a href=./#audit>Security Event Auditing</a></em></dt><dd><p>Describes what FreeBSD Event Auditing is, how it can be installed, configured, and how audit trails can be inspected or monitored.</p></dd><dt class=hdlist1><em><a href=./#disks>Storage</a></em></dt><dd><p>Describes how to manage storage media and filesystems with FreeBSD. This includes physical disks, RAID arrays, optical and tape media, memory-backed disks, and network filesystems.</p></dd><dt class=hdlist1><em><a href=./#geom>GEOM: Modular Disk Transformation Framework</a></em></dt><dd><p>Describes what the GEOM framework in FreeBSD is and how to configure various supported RAID levels.</p></dd><dt class=hdlist1><em><a href=./#filesystems>Other File Systems</a></em></dt><dd><p>Examines support of non-native file systems in FreeBSD, like the Z File System from Sun™.</p></dd><dt class=hdlist1><em><a href=./#virtualization>Virtualization</a></em></dt><dd><p>Describes what virtualization systems offer, and how they can be used with FreeBSD.</p></dd><dt class=hdlist1><em><a href=./#l10n>Localization - i18n/L10n Usage and Setup</a></em></dt><dd><p>Describes how to use FreeBSD in languages other than English. Covers both system and application level localization.</p></dd><dt class=hdlist1><em><a href=./#updating-upgrading>Updating and Upgrading FreeBSD</a></em></dt><dd><p>Explains the differences between FreeBSD-STABLE, FreeBSD-CURRENT, and FreeBSD releases. Describes which users would benefit from tracking a development system and outlines that process. Covers the methods users may take to update their system to the latest security release.</p></dd><dt class=hdlist1><em><a href=./#dtrace>DTrace</a></em></dt><dd><p>Describes how to configure and use the DTrace tool from Sun™ in FreeBSD. Dynamic tracing can help locate performance issues, by performing real time system analysis.</p></dd><dt class=hdlist1><em><a href=./#serialcomms>Serial Communications</a></em></dt><dd><p>Explains how to connect terminals and modems to your FreeBSD system for both dial in and dial out connections.</p></dd><dt class=hdlist1><em><a href=./#ppp-and-slip>PPP</a></em></dt><dd><p>Describes how to use PPP to connect to remote systems with FreeBSD.</p></dd><dt class=hdlist1><em><a href=./#mail>Electronic Mail</a></em></dt><dd><p>Explains the different components of an email server and dives into simple configuration topics for the most popular mail server software: sendmail.</p></dd><dt class=hdlist1><em><a href=./#network-servers>Network Servers</a></em></dt><dd><p>Provides detailed instructions and example configuration files to set up your FreeBSD machine as a network filesystem server, domain name server, network information system server, or time synchronization server.</p></dd><dt class=hdlist1><em><a href=./#firewalls>Firewalls</a></em></dt><dd><p>Explains the philosophy behind software-based firewalls and provides detailed information about the configuration of the different firewalls available for FreeBSD.</p></dd><dt class=hdlist1><em><a href=./#advanced-networking>Advanced Networking</a></em></dt><dd><p>Describes many networking topics, including sharing an Internet connection with other computers on your LAN, advanced routing topics, wireless networking, Bluetooth®, ATM, IPv6, and much more.</p></dd><dt class=hdlist1><em><a href=./#mirrors>Obtaining FreeBSD</a></em></dt><dd><p>Lists different sources for obtaining FreeBSD media on CDROM or DVD as well as different sites on the Internet that allow you to download and install FreeBSD.</p></dd><dt class=hdlist1><em><a href=./#bibliography>Bibliografia</a></em></dt><dd><p>This book touches on many different subjects that may leave you hungry for a more detailed explanation. The bibliography lists many excellent books that are referenced in the text.</p></dd><dt class=hdlist1><em><a href=./#eresources>Resources on the Internet</a></em></dt><dd><p>Describes the many forums available for FreeBSD users to post questions and engage in technical conversations about FreeBSD.</p></dd><dt class=hdlist1><em><a href=./#pgpkeys>Klucze PGP</a></em></dt><dd><p>Lists the PGP fingerprints of several FreeBSD Developers.</p></dd></dl></div></div><div class=sect2><h3 id=preface-conv>Konwencje użyte w tej książce<a class=anchor href=#preface-conv></a></h3><div class=paragraph><p>W celu utrzymania jednolitości i łatwości czytania niniejszego tekstu w książce zastosowane zostały następujące konwencje.</p></div><div class=sect3><h4 id=preface-conv-typographic>Konwencje typograficzne<a class=anchor href=#preface-conv-typographic></a></h4><div class=dlist><dl><dt class=hdlist1><em>Kursywa</em></dt><dd><p>Czcionka <em>pochyła</em> stosowana jest do wskazania plików, adresów URL, szczególnie akcentowanych fragmentów i pierwszego zastosowania zwrotów technicznych.</p></dd><dt class=hdlist1><code>Stała szerokość</code></dt><dd><p>Czcionka o <code>stałej szerokości</code> stosowana jest do przedstawienia komunikatów o błędach, poleceń, zmiennych środowiskowych, nazw portów, nazw komputerów, nazw użytkowników i grup, nazw urządzeń, zmiennych i fragmentów kodu.</p></dd><dt class=hdlist1>Pogrubienie</dt><dd><p>Czcionka pogrubiona stosowana jest do nazw programów, poleceń i klawiszy.</p></dd></dl></div></div><div class=sect3><h4 id=preface-conv-commands>Zadania użytkownika<a class=anchor href=#preface-conv-commands></a></h4><div class=paragraph><p>Zgodnie z konwencją typograficzną, klawisze, które ma nacisnąć użytkownik w trakcie pracy z opisywanym programem, zostały oznaczone <strong>pogrubieniem</strong> by wyróżniały się z reszty tekstu. Kombinacje klawiszy, które należy nacisnąć jednocześnie zawierają znak <code>+</code> pomiędzy, np.:</p></div><div class=paragraph><p><span class=keyseq><kbd>Ctrl</kbd>+<kbd>Alt</kbd>+<kbd>Del</kbd></span></p></div><div class=paragraph><p>Oznacza, że użytkownik powinien nacisnąć <kbd>Ctrl</kbd>, <kbd>Alt</kbd> i <kbd>Del</kbd> jednocześnie.</p></div><div class=paragraph><p>Klawisze, które należy nacisnąć kolejno będą oddzielone przecinkiem, np.:</p></div><div class=paragraph><p><span class=keyseq><kbd>Ctrl</kbd>+<kbd>X</kbd></span>, <span class=keyseq><kbd>Ctrl</kbd>+<kbd>S</kbd></span></p></div><div class=paragraph><p>Co oznacza, że użytkownik powinien nacisnąć klawisze <kbd>Ctrl</kbd> i <kbd>X</kbd> jednocześnie, a następnie <kbd>Ctrl</kbd> i <kbd>S</kbd>.</p></div></div><div class=sect3><h4 id=preface-conv-examples>Przykłady<a class=anchor href=#preface-conv-examples></a></h4><div class=paragraph><p>Przykłady zaczynające się od <span class=filename>E:\></span> wskazują polecenie systemu MS-DOS®. Jeśli nie jest wyraźnie zaznaczone, że jest inaczej, polecenia te mogą być wprowadzane bezpośrednio w oknie "Linii poleceń" w środowisku Microsoft® Windows®.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>E:<span class=se>\&gt;</span> tools<span class=se>\f</span>dimage floppies<span class=se>\k</span>ern.flp A:</code></pre></div></div><div class=paragraph><p>Przykłady zaczynające się od <code>#</code> wskazują polecenie, które musi być wprowadzone przez użytkownika z uprawnieniami administratora systemu FreeBSD. Możesz zalogować się jako <code>root</code> i wprowadzić polecenie, bądź zalogować jako zwykły użytkownik i wykorzystać <a href="https://man.freebsd.org/cgi/man.cgi?query=su&amp;sektion=1&amp;format=html">su(1)</a> by uzyskać prawa administratora.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># dd if=kern.flp of=/dev/fd0</span></code></pre></div></div><div class=paragraph><p>Przykłady zaczynające się od % wskazują, iż polecenie powinno być wprowadzone przez zwykłego użytkownika. Jeśli nie jest inaczej zaznaczone, stosowana jest składnia powłoki C (csh) do ustawiania zmiennych środowiskowych i uruchamiania innych poleceń powłoki.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% top</code></pre></div></div></div></div><div class=sect2><h3 id=preface-acknowledgements>Podziękowania<a class=anchor href=#preface-acknowledgements></a></h3><div class=paragraph><p>Niniejsza książka jest efektem pracy setek ludzi z całego świata. Niezależnie czy przysłali poprawkę literówki czy cały rozdział, każdy wkład jest doceniany.</p></div><div class=paragraph><p>Kilka firm wsparło rozwój tego dokumentu opłacając autorów, by mogli pracować nad nią w pełnym wymiarze czasowym, finansując publikację w formie papierowej, itd. Pragniemy wymienić przede wszystkim BSDi (przejęte później przez <a href=http://www.windriver.com>Wind River Systems</a>), które opłaciło pracę członków Projektu Dokumentacji FreeBSD nad korektami książki, przygotowując ją do pierwszej publikacji drukowanej w Marcu 2000 r. (ISBN 1-57176-241-8). Następnie, Wind River Systems sfinansowało pracę kolejnych osób przygotowujących nowe rozdziały, a także format wydruku. Kulminacją ich pracy jest drugie wydanie, które ujrzało światło dzienne w Listopadzie 2001 r. (ISBN 1-57176-303-1). W latach 2003-2004, <a href=http://www.freebsdmall.com>FreeBSD Mall, Inc</a> sfinansowało prace nad korektą Podręcznika, przygotowywanego do trzeciego wydania w postaci drukowanej.</p></div></div></div></div><h1 id=getting-started class=sect0>Część I: Pierwsze kroki<a class=anchor href=#getting-started></a></h1><div class="openblock partintro"><div class=content><div class=paragraph><p>Ta część Podręcznika FreeBSD adresowana jest do użytkowników i administratorów, który nie mieli dotychczas kontaktu z systemem FreeBSD. Niniejsze rozdziały mają za zadanie:</p></div><div class=ulist><ul><li><p>Zaprezentować system FreeBSD.</p></li><li><p>Przeprowadzić przez proces instalacji.</p></li><li><p>Nauczyć podstaw systemu UNIX®.</p></li><li><p>Pokazać jak zainstalować programy innych autorów, dostępne w ogromnej ilości dla systemu FreeBSD.</p></li><li><p>Przedstawić system X - system okien UNIX®, oraz szczegółowo wyjaśnić jak prawidłowo skonfigurować środowisko graficzne, tak by zwiększyć efektywność swej pracy.</p></li></ul></div><div class=paragraph><p>Staraliśmy się sprowadzić liczbę odnośników wewnątrz tekstu do możliwie najmniejszej, tak by zminimalizować ilość "przeskoków" i ułatwić czytanie Podręcznika od deski do deski.</p></div></div></div><div class=sect1><h2 id=introduction>Rozdział 1. Wprowadzenie<a class=anchor href=#introduction></a></h2><div class=sectionbody><div class=sect2><h3 id=introduction-synopsis>1.1. Streszczenie<a class=anchor href=#introduction-synopsis></a></h3><div class=paragraph><p>Dziękujemy za zainteresowanie FreeBSD! W niniejszym rozdziale opisane zostaną różne aspekty Projektu FreeBSD, takie jak jego historia, obrany cel, czy model rozwoju.</p></div><div class=paragraph><p>Czytając ten rozdział poznamy:</p></div><div class=ulist><ul><li><p>Zależności istniejące między FreeBSD i innymi systemami operacyjnymi.</p></li><li><p>Historię Projektu FreeBSD.</p></li><li><p>Cele stawiane przed Projektem FreeBSD.</p></li><li><p>Podstawowe zagadnienia związane z modelem rozwoju otwartego oprogramowania (ang. open source) FreeBSD.</p></li><li><p>I oczywiście, dowiemy się skąd pochodzi nazwa "FreeBSD".</p></li></ul></div></div><div class=sect2><h3 id=nutshell>1.2. Witamy w świecie FreeBSD!<a class=anchor href=#nutshell></a></h3><div class=paragraph><p>FreeBSD jest systemem operacyjnym bazującym na 4.4BSD-Lite, a przeznaczonym dla komputerów pracujących na platformach Intela (x86 i Itanium®), AMD64, Alpha™ oraz Sun UltraSPARC®. Przygotowywane są również wersje dla innych platform. Więcej informacji dostępnych jest w <a href=#history>historii FreeBSD</a> bądź w nocie o <a href=#relnotes>aktualnym wydaniu</a>. Jeśli chciałbyś wspomóc rozwój Projektu (np. kod źródłowy, sprzęt, nieoznakowane banknoty) przeczytaj artykuł o <a href=https://docs.freebsd.org/en/articles/contributing/>współpracy z Projektem FreeBSD</a> (ang.).</p></div><div class=sect3><h4 id=os-overview>1.2.1. Co potrafi FreeBSD?<a class=anchor href=#os-overview></a></h4><div class=paragraph><p>FreeBSD posiada mnóstwo zalet. Oto niektóre z nich:</p></div><div class=ulist><ul><li><p><em>Wielozadaniowość z wywłaszczaniem</em>, wraz z dynamiczną regulacją priorytetów, by zapewnić sprawne i bezkonfliktowe współdzielenie zasobów komputera przez aplikacje oraz użytkowników, nawet w sytuacjach największego obciążenia systemu.</p></li><li><p><em>Wieloużytkownikowość</em> pozwalająca na jednoczesne wykorzystanie komputera z systemem FreeBSD przez wielu użytkowników. Oznacza to, np. prawidłowe dzielenie dostępu do urządzeń zewnętrznych jak np. do drukarki, pomiędzy wszystkich użytkowników lokalnych jak i sieciowych. Ograniczenia dostępu do zasobów mogą być definiowane dla konkretnych użytkowników bądź grup użytkowników, co z kolei pozwala na zabezpieczenie krytycznych zasobów systemowych przed nadużyciami.</p></li><li><p>Pełna obsługa <em>sieci TCP/IP</em>, oraz innych sieciowych standardów jak SLIP, PPP, NFS, DHCP czy NIS. Oznacza to, że twój system FreeBSD może bez problemów współpracować z dowolnymi innymi systemami operacyjnymi, jak również pracować w roli serwera w przedsiębiorstwie, dostarczając niezbędnych funkcji jak np. NFS (zdalny dostęp do plików) wraz z obsługą emaila, bądź pozwoli na umieszczenie internetowej wizytówki twojej organizacji na stronie WWW czy dokumentów na serwerze FTP. Może również realizować przekierowywanie (ruting) pakietów, a także pełnić rolę zapory ogniowej (firewall).</p></li><li><p><em>Ochrona pamięci</em> gwarantuje, że programy (bądź użytkownicy) nie mogą ingerować w pracę innych aplikacji. Innymi słowy, awaria danego programu w żaden sposób nie wpływa na działanie pozostałych.</p></li><li><p>FreeBSD jest <em>32-bitowym</em> systemem operacyjnym (64-bitowym na platformach Alpha, Itanium®, AMD64 i UltraSPARC®) i właśnie jako taki projektowany był od początku.</p></li><li><p>Obecnie standardowy <em>System okien X</em> (X11R6; X Window System) dostarcza interfejsu graficznego (GUI) w cenie zwykłej karty VGA i monitora. Ponadto dostępny jest z pełnym kodem źródłowym.</p></li><li><p><em>Zgodność binarną</em> z wieloma systemami typu UNIX®. FreeBSD posiada możliwość uruchamiania programów skompilowanych dla Linuksa, SCO, SVR4, BSDI i NetBSD.</p></li><li><p>Tysiące aplikacji <em>gotowych do pracy</em>, dostępnych z kolekcji <em>portów</em> i <em>pakietów</em> FreeBSD. Czemu szukać w sieci, skoro wszystko można znaleźć właśnie tutaj?</p></li><li><p>Tysiące dodatkowych i <em>łatwych do przeniesienia</em> programów dostępnych w Internecie. FreeBSD jest zgodny z wieloma popularnymi, nawet komercyjnymi systemami typu UNIX® i tym samym większość programów wymaga zaledwie kilku, jeśli w ogóle, zmian w kodzie aby poprawnie skompilować i uruchomić.</p></li><li><p>Stronicowana <em>pamięć wirtualna</em> oraz współdzielona pamięć podręczna "VM/buffer cache" zaprojektowane by efektywnie zaspokajać potrzeby aplikacji z dużym apetytem na pamięć, przy jednoczesnym zapewnieniu ciągłej interakcji systemu z użytkownikami.</p></li><li><p>Wsparcie dla technologii <em>SMP</em>, dla maszyn z wieloma procesorami.</p></li><li><p>Kompletne środowiska programistyczne dla języków <em>C</em>, <em>C++</em> i <em>Fortran</em>. FreeBSD posiada również wiele dodatkowych środowisk dla innych języków programowania dostępnych w kolekcji portów i pakietów.</p></li><li><p>Dostępność <em>kodu źródłowego</em> dla całego systemu oznacza, iż to właśnie ty posiadasz największą kontrolę nad swoim środowiskiem pracy. Czemu zamykać się w kręgu rozwiązań własnościowych i być skazanym na łaskę dostarczyciela systemu, kiedy można mieć prawdziwie otwarty system?</p></li><li><p>Obszerną <em>dokumentację</em> dostępną w Internecie..</p></li><li><p><em>I wiele więcej!</em></p></li></ul></div><div class=paragraph><p>FreeBSD jest oparty na systemie 4.4BSD-Lite pochodzącym z Computer Systems Research Group (CSRG) z Uniwersytetu Kalifornijskiego w Berkeley. Podtrzymuje dostojną tradycję trendu rozwojowego systemów BSD. Oprócz doskonałej pracy wykonanej przez CSRG również programiści z Projektu FreeBSD spędzili dodatkowe tysiące godzin, aby udoskonalić go i przygotować na trudne, życiowe sytuacje. W czasie gdy wielu z komercyjnych gigantów branży komputerów PC stara się wyposażyć swoje systemy operacyjne w podobne cechy, by osiągnąć takie same wyniki i poziom niezawodności, FreeBSD oferuje to już <em>teraz</em>!</p></div><div class=paragraph><p>Liczba aplikacji z którymi może współpracować FreeBSD jest ograniczona jedynie przez naszą wyobraźnię. Od projektów programistycznych, poprzez automatyzację produkcji w fabrykach, kontrolę stanu magazynów, po regulację azymutu anteny satelitarnej; jeśli jest to możliwe w komercyjnych systemach UNIX jest to więcej niż prawdopodobne, że możesz to zrobić również we FreeBSD! On sam korzysta z dosłownie tysięcy doskonale dopracowanych aplikacji, nierzadko pochodzących z komercyjnych centrów projektowych bądź laboratoriów uniwersyteckich, dostępnych niemalże bądź całkowicie za darmo. Dostępne jest również oprogramowanie komercyjne, którego liczba rośnie równie szybko, jak oprogramowania bezpłatnego.</p></div><div class=paragraph><p>Jako, że kod źródłowy FreeBSD jest publicznie dostępny, system może zostać dostosowany do wielu specjalistycznych projektów oraz zastosowań, co jest niemożliwe w przypadku wielu systemów komercyjnych. Oto krótka lista aplikacji, z którymi najczęściej używany jest FreeBSD:</p></div><div class=ulist><ul><li><p><em>Usługi internetowe:</em> doskonała obsługa TCP/IP wbudowana we FreeBSD, czyni go idealną platformą dla szeregu usług internetowych, na przykład:</p><div class=ulist><ul><li><p>Serwery FTP</p></li><li><p>Serwery witryn WWW (standardowe bądź zabezpieczone [SSL])</p></li><li><p>Zapory ogniowe i bramy NAT ("maskarada IP")</p></li><li><p>Serwery poczty elektronicznej</p></li><li><p>Serwery USENET bądź systemy Forum</p></li><li><p>I więcej…​</p><div class=paragraph><p>Wraz z FreeBSD możesz zacząć świadczyć usługi internetowe już na niedrogim komputerze PC klasy 386 i rozwijać bazę sprzętową swojego przedsiębiorstwa aż do cztero-procesorowego Xeona z macierzą RAID.</p></div></li></ul></div></li><li><p><em>Edukacja:</em> jesteś studentem informatyki bądź pokrewnej dziedziny techniki? Nie ma lepszego sposobu na poznanie systemu operacyjnego, architektury komputerów oraz zagadnień sieciowych niż poprzez doświadczenie, które daje praca z FreeBSD. Duża liczba darmowych programów typu CAD, matematycznych czy graficznych będzie wysoce użyteczna dla tych, których głównym zainteresowaniem w komputerach jest aby zmusić je do pracy <em>za nas</em>!</p></li><li><p><em>Badania:</em> oferując dostęp do kodu źródłowego całego systemu, FreeBSD stanowi doskonałą platformę dla prowadzenia badań nad systemami operacyjnymi oraz innymi dziedzinami nauk komputerowych. Idea otwartego źródła wspomaga także całe grupy współpracujące zdalnie nad różnymi zadaniami, pomagając zapomnieć im o problemach związanych ze specjalnymi warunkami licencyjnymi oraz ograniczeniami.</p></li><li><p><em>Sieć:</em> potrzebujesz nowego rutera? Serwera nazw (DNS)? Zapory ogniowej (firewalla), by wystrzec się niepowołanych użytkowników w swojej sieci wewnętrznej? FreeBSD może w łatwy sposób zamienić bezużytecznego 486 lub nawet 386, stojącego w kącie, w zaawansowany router z wyszukanymi opcjami filtrowania pakietów.</p></li><li><p><em>Środowisko graficzne:</em> FreeBSD stanowi dobre rozwiązanie dla niedrogiego terminala graficznego. W tym celu można wykorzystać dostępny serwer X11, bądź jeden z doskonałych komercyjnych serwerów <a href=http://www.xig.com>Xi Graphics</a>. W przeciwieństwie do typowych terminali graficznych, FreeBSD pozwala na uruchamianie wielu aplikacji lokalnie jeśli zajdzie taka potrzeba, odciążając tym samym główny serwer. FreeBSD może być również uruchamiany w systemach "bezdyskowych" zmniejszając tym samym cenę komputerów służących za terminale.</p></li><li><p><em>Programowanie:</em> system FreeBSD zaopatrzony jest w pełen zestaw narzędzi programistycznych, włączając w to sławny kompilator oraz debugger GNU C/C++.</p></li></ul></div><div class=paragraph><p>FreeBSD jest dostępny zarówno w postaci kodu źródłowego jak i skompilowanych binariów dostępnych na płytach CDROM, DVD i poprzez anonimowy serwer FTP. <a href=./#mirrors>Obtaining FreeBSD</a> zawiera więcej informacji nt. sposobów uzyskania FreeBSD.</p></div></div><div class=sect3><h4 id=_kto_używa_freebsd>1.2.2. Kto używa FreeBSD?<a class=anchor href=#_kto_używa_freebsd></a></h4><div class=paragraph><p>FreeBSD zasila niektóre z największych witryn w Internecie, m.in:</p></div><div class=ulist><ul><li><p><a href=http://www.yahoo.com/>Yahoo!</a></p></li><li><p><a href=http://www.apache.org/>Apache</a></p></li><li><p><a href=http://www.bluemountain.com/>Blue Mountain Arts</a></p></li><li><p><a href=http://www.pair.com/>Pair Networks</a></p></li><li><p><a href=http://www.sony.co.jp/>Sony Japan</a></p></li><li><p><a href=http://www.netcraft.com/>Netcraft</a></p></li><li><p><a href=http://www.wni.com/>Weathernews</a></p></li><li><p><a href=http://www.supervalu.com/>Supervalu</a></p></li><li><p><a href=http://www.telehouse.com/>TELEHOUSE America</a></p></li><li><p><a href=http://www.sophos.com/>Sophos Anti-Virus</a></p></li><li><p><a href=http://www.jmawired.com/>JMA Wired</a></p></li></ul></div><div class=paragraph><p>i wiele więcej.</p></div></div></div><div class=sect2><h3 id=history>1.3. O Projekcie FreeBSD<a class=anchor href=#history></a></h3><div class=paragraph><p>Niniejszy podrozdział zawiera podstawowe informacje o projekcie, m.in. krótką historię, cele stawiane przed projektem i stosowany model rozwoju.</p></div><div class=sect3><h4 id=intro-history>1.3.1. Krótka historia FreeBSD<a class=anchor href=#intro-history></a></h4><div class=paragraph><p>Genezy projektu FreeBSD należy doszukiwać się w pierwszej połowie roku 1993. Wyrósł on częściowo z "Nieoficjalnego zestawu łat dla 386BSD" (patchkit). Stworzony został przez trzech ostatnich koordynatorów zestawu: Nate’a Williamsa, Roda Grimesa i mnie.</p></div><div class=paragraph><p>Naszym pierwotnym celem było przygotowanie migawki z rozwoju 386BSD, wprowadzającej szereg poprawek, których mechanizm zestawu łat nie był w stanie zrealizować. Niektórzy z czytających mogą pamiętać wczesną nazwę projektu "386BSD 0.5" bądź "386BSD Interim".</p></div><div class=paragraph><p>386BSD był systemem operacyjnym Billa Jolitza, cierpiącym w tym okresie z powodu przeszło rocznego zastoju. W wyniku puchnięcia zestawu łat z dnia na dzień coraz bardziej, jednomyślnie postanowiliśmy spróbować naprawić sytuację. Zdecydowaliśmy się wspomóc Billa dostarczając owej "porządkującej" migawki. Niestety plan spalił na panewce gdy Bill Jolitz nagle zdecydował cofnąć swoje poparcie dla projektu, nie informując co zamierza wprowadzić w jego miejsce.</p></div><div class=paragraph><p>Szybko stwierdziliśmy, że rozpoczęte zadanie jest warte świeczki nawet bez wsparcia Billa. Tym samym przyjęliśmy nazwę "FreeBSD" ukutą przez Davida Greenmana. Cele projektu zostały wstępnie określone po rozmowach z ówczesnymi użytkownikami systemu. Gdy stało się jasne, że projekt zmierza w kierunku stania się rzeczywistością, skontaktowałem się z firmą Walnut Creek CDROM w celu usprawnienia metod dystrybucji FreeBSD, szczególnie z myślą o tych nieszczęśnikach, którzy mieli utrudniony dostęp do Internetu. Walnut Creek CDROM nie tylko wsparł pomysł dystrybucji FreeBSD na płytach CD, ale również wyszedł nam na przeciw oferując projektowi maszynę do pracy i szybkie łącze z Internetem. Jest mało prawdopodobne, że projekt zaszedł by aż tak daleko bez niespotykanej wręcz wiary Walnut Creek CDROM w kompletnie mało znany projekt, którym w owym czasie był FreeBSD.</p></div><div class=paragraph><p>Pierwszą wersją rozprowadzaną na płytach CD (a także w Internecie) był FreeBSD 1.0, wydany w grudniu 1993 r. Oparty był on bezpośrednio na 4.3BSD-Lite ("Net/2") z Uniwersytetu Kalifornijskiego w Berkeley. Zawierał również wiele dodatkowych aplikacji pochodzących z 386BSD oraz Free Software Foundation. Można przyjąć, iż osiągnał on całkiem rozsądny sukces jak na pierwszą wersję. Następujące po nim wydanie FreeBSD 1.1 w maju 1994 r. było pełnym sukcesem.</p></div><div class=paragraph><p>Mniej więcej w tym właśnie czasie czarne chmury niespodzianie pojawiły się nad horyzontem. Powodem tego była ugoda w przeciągającym się procesie pomiędzy Novellem i Uniwersytetem w Berkeley odnośnie legalności kalifornijskiego Net/2. Jednym z warunków ugody było ustępstwo Berkeley stwierdzające, iż znaczne części kodu Net/2 zostały "powielone" z kodu systemu UNIX®, będącego własnością Novella, który z kolei nabył go wcześniej od AT&amp;T. W zamian Berkley uzyskało "błogosławieństwo" Novella w pracach nad 4.4BSD-Lite i zapewnienie, że gdy się w końcu pojawi nie będzie określane jako kopia kodu Novella. Ponadto wszyscy użytkownicy Net/2 mieli być gorąco zachęciani do aktualizacji systemu. Ugoda ta dotyczyła również FreeBSD, bowiem projekt miał wstrzymać dystrybucję swoich produktów bazujących na Net/2 do końca lipca 1994 r. Zgodnie z warunkami porozumienia, pozwolono projektowi na jedno ostatnie wydanie przed tym terminem. Było to FreeBSD 1.1.5.1.</p></div><div class=paragraph><p>Rozpoczęła się żmudna praca nad ponownym stworzeniem FreeBSD z części całkowicie nowego i raczej niekompletnego 4.4BSD-Lite. Wydanie "Lite" było w rzeczy samej "lekkie"; częściowo w wyniku usunięcia przez CSRG Uniwersytetu w Berkeley wielkich partii kodu (z uwagi na pewne wymogi prawne), które odpowiadały za przygotowanie samodzielnie uruchamiającego się systemu, oraz z faktu, że wersja 4.4 nie była jeszcze gotowa na platformę Intela. Prace potrwały do listopada 1994 r., kiedy to wydany został FreeBSD 2.0, rozprowadzany zarówno przez sieć jak i na płytach CD (w późnym grudniu). Pomimo kilku niedociągnięć wydanie osiągnęło znaczący sukces. Przy czym już w styczniu 1995 r. zostało zastąpione stabilniejszym i łatwiejszym w instalacji FreeBSD 2.0.5.</p></div><div class=paragraph><p>FreeBSD 2.1.5 wydaliśmy w sierpniu 1996. Wersja ta zyskała popularność szczególnie pośród dostawców usług internetowych (ISP) oraz szerokopojętej społeczności komercyjnej. Docenione zostało również kolejne wydanie w gałęzi 2.1-STABLE. Mowa tu o FreeBSD 2.1.7.1, wydanym w lutym 1997 r., a zamykającym główne prace nad 2.1-STABLE. Od tej pory trwały jedynie prace nad utrzymaniem gałęzi (RELENG_2_1_0); dodawane były łaty bezpieczeństwa i naprawiane krytyczne luki.</p></div><div class=paragraph><p>Z głównego nurtu rozwoju ("-CURRENT") w listopadzie 1996 r. odgałęził się FreeBSD 2.2 jako gałąź RELENG_2_2. Pierwsze pełne wydanie (2.2.1) pojawiło się w kwietniu 1997 r. Kolejne wydania z gałęzi 2.2 ujrzały światło dzienne w lecie i na jesieni 1997 r., przy czym ostatnie (2.2.8) pojawiło się w listopadzie 1998 r. Pierwsze oficjalne wydanie 3.0 pochodzi z października 1998 r. i stanowiło początek końca gałęzi 2.2.</p></div><div class=paragraph><p>Drzewo ewolucji FreeBSD ponownie rozdzieliło się 20 stycznia 1999 r., prowadząc do 4.0-CURRENT i 3.X-STABLE. Wersja 3.1 z 3.X-STABLE wydana została 15 lutego 1999, wersja 3.2 dnia 15 maja 1999, 3.3 w dniu 16 września 1999, 3.4 - 20 grudnia 1999 oraz 3.5 dnia 24 stycznia 2000. Wkrótce pojawiło się również pomniejsze wydanie 3.5.1, które zawierało kilka poprawek z ostatniej chwili do systemu Kerberos. Było to ostatnie wydanie gałęzi 3.X.</p></div><div class=paragraph><p>Kolejne rozgałęzienie miało miejsce 13 marca 2000 r. w wyniku czego pojawiła się gałąź 4.X-STABLE: 4.0-RELEASE w marcu 2000 i ostatnie wydanie 4.11-RELEASE w styczniu 2005.</p></div><div class=paragraph><p>Pojawienie się długo oczekiwanej gałęzi 5.0-RELEASE zostało ogłoszone 19 stycznia 2003 r. Stanowiła ona punkt kulminacyjny prawie trzyletniego wysiłku. Wydanie te wprowadziło FreeBSD na ścieżkę ku współpracy z komputerami multiprocesorowymi oraz zaawansowanej obsługi wątków aplikacji. Oferowała również wsparcie dla platform UltraSPARC® i <code>ia64</code>. Wydanie 5.1 pojawiło się w czerwcu 2003 r. Ostatnie wydanie 5.X z gałęzi -CURRENT stanowiło 5.2.1-RELEASE, wprowadzone w lutym 2004.</p></div><div class=paragraph><p>Gałąź RELENG_5 powstała w sierpniu 2004 r., a także wydanie 5.3-RELEASE, stanowi początek wydań gałęzi 5-STABLE. Najnowsze wydanie 11.2-RELEASE pojawiło się w maju 2006. Wydawane będą wciąż kolejne wersje z gałęzi RELENG_5.</p></div><div class=paragraph><p>Kolejne rozgałęzienie nastąpiło w czerwcu 2005: powstała gałąź RELENG_6. Wydanie 6.0-RELEASE, pierwsze z gałęzi 6.X, pojawiło się w listopadzie 2005. Najnowsze wydanie 12.0-RELEASE ujrzało światło dzienne w maju 2006 r. Będą pojawiać się również kolejne wydania z gałęzi RELENG_6.</p></div><div class=paragraph><p>Na chwilę obecną projekty długoterminowe prowadzone są w gałęzi 7.X-CURRENT. Migawki wydań 7.X, obrazujące postęp prac, są cały czas dostępne z <a href=ftp://current.FreeBSD.org/pub/FreeBSD/snapshots/>serwera migawkowego</a> jak również na płytach CD.</p></div></div><div class=sect3><h4 id=goals>1.3.2. Cele Projektu FreeBSD<a class=anchor href=#goals></a></h4><div class=paragraph><p>Głównym celem Projektu FreeBSD jest dostarczanie oprogramowania, które może być wykorzystane w dowolny sposób i bez dodatkowych zobowiązań. Wielu z nas ma duży wkład w tworzenie kodu (i rozwój projektu w ogóle) i z pewnością nie miałoby nic przeciw drobnemu wsparciu finansowemu. Tym nie mniej nie wywieramy żadnego nacisku. Wierzymy, że naszą pierwszą i najważniejszą "misją" jest dostarczanie kodu wszystkim tym, którzy go potrzebują bez względu na to do czego go wykorzystają, by zyskał on możliwie najszerszą bazę użytkowników dostarczając możliwie największych korzyści. W moim przekonaniu jest to jeden z najbardziej fundamentalnych celów stawianych przed całym Wolnym Oprogramowaniem, a przez nas entuzjastycznie wspierany.</p></div><div class=paragraph><p>Te części kodu w naszym drzewie źródłowym, które udostępniane są na licencji GNU General Public License (GPL) bądź Library General Public License (LGPL) posiadają kilka dodatkowych zobowiązań, choć związanych raczej z wymogiem udostępnienia kodu źródłowego. Z uwagi na dodatkowe komplikacje, które mogą pojawić się w przypadku komercyjnego zastosowania aplikacji na licencji GPL, osobiście skłaniamy się - kiedy jest to możliwe - ku oprogramowaniu dystrybuowanemu przy wykorzystaniu mniej restrykcyjnej licencji BSD.</p></div></div><div class=sect3><h4 id=development>1.3.3. Model rozwoju FreeBSD<a class=anchor href=#development></a></h4><div class=paragraph><p>Rozwój FreeBSD jest otwartym i elastycznym procesem realizowanym przez setki ludzi na całym świecie (patrz <a href=https://docs.freebsd.org/en/articles/contributors/>Lista współpracowników</a>). Infrastruktura systemu rozwoju FreeBSD pozwala tymże setkom projektantów współpracować przez Internet. Tym nie mniej nieustannie poszukujemy nowych projektantów, a także nowych pomysłów. Osoby zainteresowane nawiązaniem bliższej współpracy z projektem mogą kontaktować się z nami bezpośrednio poprzez <a href=https://lists.FreeBSD.org/subscription/freebsd-hackers>FreeBSD technical discussions mailing list</a>. Natomiast <a href=https://lists.FreeBSD.org/subscription/freebsd-announce>FreeBSD announcements mailing list</a> jest również dostępna dla osób chcących poinformować innych użytkowników FreeBSD o głównych obszarach prowadzonych prac.</p></div><div class=paragraph><p>Oto garść informacji o projekcie FreeBSD i jego procesie rozwoju, przydatnych zarówno niezależnym projektantom jak i bliskim współpracownikom:</p></div><div class=dlist><dl><dt class=hdlist1>Repozytorium CVS<a id=development-cvs-repository></a></dt><dd><p>Główne drzewo źródłowe FreeBSD utrzymywane jest w systemie <a href=http://ximbiot.com/cvs/wiki/>CVS</a> (Concurrent Versions System) - wolnodostępnym narzędziu kontroli wersji kodu źródłowego, dostępnym we FreeBSD. Podstawowe <a href=http://www.FreeBSD.org/cgi/cvsweb.cgi>repozytorium CVS</a> znajduje się na maszynie zlokalizowanej w Santa Clara w Kalifornii, USA, skąd replikowane jest na serwery lustrzane, rozrzucone po całym świecie. Główne drzewo CVS, zawierające zarówno drzewo <a href=./#current>-CURRENT</a> jak i <a href=./#stable>-STABLE</a>, można łatwo skopiować również na swój własny komputer. Proces ten został dokładniej opisany w podrozdziale <a href=./#synching>Synchronizacja własnego drzewa kodu źródłowego</a>.</p></dd><dt class=hdlist1>Lista twórców<a id=development-committers></a></dt><dd><p><em>Twórcy</em> są ludźmi, którzy posiadają prawa zapisu do drzewa CVS i posiadają upoważnienie do wprowadzania modyfikacji do kodu źródłowego FreeBSD. Angielski odpowiednik terminu "twórca" (ang. committer) pochodzi od polecenia <code>commit</code> systemu <a href="https://man.freebsd.org/cgi/man.cgi?query=cvs&amp;sektion=1&amp;format=html">cvs(1)</a>, stosowanego do wprowadzania zmian do repozytorium CVS. Najlepszym sposobem przedstawienia własnych propozycji na liście dyskusyjnej twórców jest wykorzystanie polecenia <a href="https://man.freebsd.org/cgi/man.cgi?query=send-pr&amp;sektion=1&amp;format=html">send-pr(1)</a>. Jeśli system sprawia wrażenie zablokowanego można również wysłać e-mail bezpośrednio na Listę dyskusyjną twórców FreeBSD.</p></dd><dt class=hdlist1>Główni projektanci FreeBSD<a id=development-core></a></dt><dd><p>Porównując Projekt FreeBSD z przedsiębiorstwem, <em>zespół główny</em> należałoby porównać z zarządem firmy. Podstawowym zadaniem tejże grupy jest czuwanie nad prawidłowym rozwojem projektu jako całości. Jedną z funkcji grupy jest zapraszanie oddanych i odpowiedzialnych projektantów w szeregi twórców systemu, podobnie jak przyjmowanie w szeregi samej grupy. Obecna grupa została wybrana spośród wszystkich twórców w czerwcu 2004 r. Wybory mają miejsce co dwa lata.</p><div class=paragraph><p>Niektórzy z członków grupy posiadają również dodatkowy zakres obowiązków, tj. czuwają nad zapewnieniem poprawnego funkcjonowania wybranych części systemu. Pełna lista projektantów FreeBSD i ich obowiązków dostępna jest w artykule <a href=https://docs.freebsd.org/en/articles/contributors/>Lista współpracowników</a>.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Większość członków grupy jest ochotnikami, jeśli chodzi o rozwój FreeBSD, i nie otrzymują żadnego wynagrodzenia finansowego z projektu. Nie należy zatem błędnie interpretować "współpracy" z projektem jako "gwarancji wsparcia". W tym świetle, powyższe porównanie z "zarządem" nie jest do końca celne. Bardziej odpowiednim byłoby powiedzieć, że są to ludzie, którzy z własnego wyboru oddali swój wolny czas dla FreeBSD!</p></div></td></tr></tbody></table></div></dd><dt class=hdlist1>Zewnętrzni współpracownicy</dt><dd><p>Co prawda jako ostatnia, ale zdecydowanie nie jako najmniej istotna, omówiona zostanie grupa współpracowników zewnętrznych, czyli samych użytkowników, którzy dostarczają na bieżąco informacji o funkcjonowaniu systemu oraz poprawek wykrytych błędów. Najlepszym sposobem na udział w rozwoju FreeBSD jest subskrypcja <a href=https://lists.FreeBSD.org/subscription/freebsd-hackers>FreeBSD technical discussions mailing list</a>. <a href=./#eresources>Resources on the Internet</a> zawiera więcej informacji o różnorodnych listach dyskusyjnych FreeBSD.</p><div class=paragraph><p><a href=https://docs.freebsd.org/en/articles/contributors/>Lista współpracowników FreeBSD</a> cały czas rośnie. Czemu by nie dołączyć do listy pomagając w pracy nad FreeBSD już dzisiaj?</p></div><div class=paragraph><p>Pisanie kodu nie jest jedyną formą współpracy z projektem: kompletna lista rzeczy, które trzeba zrobić dostępna jest na <a href=https://www.FreeBSD.org/>stronie Projektu FreeBSD</a>.</p></div></dd></dl></div><div class=paragraph><p>Reasumując, nasz model rozwoju zorganizowany jest jako niezależne, współcentryczne okręgi. Scentralizowany model ma za zadanie ułatwić <em>użytkownikom</em> FreeBSD śledzenie zmian w kodzie. Odstraszanie potencjalnych współpracowników nie jest naszym celem! Pragniemy dostarczać stabilny system operacyjny z dużą bazą łatwych do instalacji i wykorzystania <a href=./#ports>programów</a> - ten model doskonale się w tym spisuje.</p></div><div class=paragraph><p>Jedyne o co prosimy tych, którzy mieliby wstąpić w szeregi projektantów FreeBSD, jest oddanie takie same jakie cechuje ich obecnych twórców.</p></div></div><div class=sect3><h4 id=relnotes>1.3.4. Aktualne wydanie FreeBSD<a class=anchor href=#relnotes></a></h4><div class=paragraph><p>FreeBSD jest łatwo dostępnym systemem operacyjnym, bazującym na kodzie 4.4BSD-Lite, dla następujących platform sprzętowych: Intel i386™, i486™, Pentium®, Pentium® Pro, Celeron®, Pentium® II, Pentium® III, Pentium® 4 (bądź inny zgodny), Xeon™, DEC Alpha™ oraz Sun UltraSPARC®. Opiera się on przede wszystkim na oprogramowaniu grupy CSRG z Uniwersytetu Kalifornijskiego w Berkeley, rozszerzonym o dodatkowe elementy z NetBSD, OpenBSD, 386BSD i Free Software Foundation.</p></div><div class=paragraph><p>Począwszy od wydania FreeBSD 2.0 w końcu 1994 r., nastąpiła dramatyczna poprawa wydajności, możliwości i stabilności systemu. Największą zmianą była całkowita reformacja systemu wirtualnej pamięci wraz ze współdzieloną pamięcią podręczną "VM/buffer cache", która nie tylko wpłynęła na wzrost wydajności ale również zmniejszenie minimalnego miejsca zajmowanego w pamięci przez FreeBSD - 5 MB jest już akceptowalnym minimum. Inne rozszerzenia to m.in. kompletna obsługa klienta i serwera NIS, wsparcie dla transakcji TCP, wdzwanianie na żądanie PPP, zintegrowana obsługa DHCP, usprawniony podsystem SCSI, obsługa ISDN, ATM, FDDI, Fast i Gigabit Ethernet (100 i 1000 Mbit). Usprawniona obsługa najnowszych kontrolerów Adaptec i tysiące poprawionych błędów.</p></div><div class=paragraph><p>Oprócz podstawowej grupy aplikacji dystrybuowanych wraz z systemem, FreeBSD oferuje kolekcję tysięcy dodatkowych programów. W momencie pisania niniejszego tekstu ich lista obejmuje ponad 36000 pozycji! Od serwerów http (WWW) poprzez gry po edytory i prawie wszystko pomiędzy. Cała Kolekcja Portów zajmuje około 3 GB na dysku, przy czym każdy port to zaledwie ułamek oryginalnej objętości źródeł. Takie rozwiązanie ułatwia man aktualizację portów i zdecydowanie zmniejsza zajmowaną przestrzeń na dysku. Kompilacja portu sprowadza się do zmiany katalogu na zawierający port wybranego programu i wpisanie <code>make install</code>. Resztą zajmuje się system. Oryginalne pakiety źródeł dla każdego kompilowanego portu pobierane są dynamicznie z płyty CDROM bądź lokalnego serwera FTP. Wystarczy zadbać o dostateczną ilość wolnego miejsca na dysku. Dla osób nie mających ochoty kompilować programów własnoręcznie, większość portów jest również dostępna w skompilowanej postaci jako "pakiety", które mogą być instalowane przy pomocy prostego polecenia <code>pkg_add</code>. Więcej informacji o systemie pakietów i portów zawiera <a href=./#ports>Instalacja programów. pakiety i porty</a>.</p></div><div class=paragraph><p>Dodatkowe dokumenty pomocne przy instalacji i użytkowaniu FreeBSD znajdują się również w katalogu <span class=filename>/usr/shared/doc</span> na maszynach z najnowszymi wersjami FreeBSD. Mogą być przeglądane lokalnie za pomocą przeglądarki internetowej przy wykorzystaniu poniższych odnośników:</p></div><div class=dlist><dl><dt class=hdlist1>Podręcznik FreeBSD (ang.)</dt><dd><p><a href=file://localhost/usr/shared/doc/handbook/index.html>/usr/shared/doc/handbook/index.html</a></p></dd><dt class=hdlist1>FAQ FreeBSD (ang.)</dt><dd><p><a href=file://localhost/usr/shared/doc/faq/index.html>/usr/shared/doc/faq/index.html</a></p></dd></dl></div><div class=paragraph><p>Główne i najczęściej aktualizowane wersje dokumentów dostępne są na stronie <a href=http://www.FreeBSD.org/>http://www.FreeBSD.org/</a>.</p></div></div></div></div></div><div class=sect1><h2 id=install>Rozdział 2. Instalacja FreeBSD<a class=anchor href=#install></a></h2><div class=sectionbody><div class=sect2><h3 id=install-synopsis>2.1. Streszczenie<a class=anchor href=#install-synopsis></a></h3><div class=paragraph><p>Wraz z FreeBSD rozpowszechniany jest prosty w użyciu program instalacyjny, działający w trybie tekstowym, o nazwie sysinstall. Jest on domyślnym programem instalacyjnym FreeBSD, jednakże dystrybutorzy systemu mogą zastąpić go własnym odpowiednikiem. W niniejszym rozdziale zawarto opis instalacji FreeBSD przy pomocy sysinstall.</p></div><div class=paragraph><p>Po przeczytaniu rozdziału będziemy wiedzieć:</p></div><div class=ulist><ul><li><p>W jaki sposób tworzy się dyskietki instalacyjne FreeBSD.</p></li><li><p>Jak FreeBSD odwołuje się do dysku i jak go dzieli.</p></li><li><p>Jak uruchamia się sysinstall.</p></li><li><p>Jakie pytania zadaje sysinstall, o co w nich chodzi i jak na nie odpowiedzieć.</p></li></ul></div><div class=paragraph><p>Przed przeczytaniem rozdziału powinniśmy:</p></div><div class=ulist><ul><li><p>Zapoznać się z listą obsługiwanego sprzętu dołączoną do instalowanej wersji FreeBSD, by upewnić się, że posiadany sprzęt będzie działać.</p></li></ul></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Opis instalacji dotyczy generalnie komputerów opartych na architekturze i386™ ("zgodny z PC"). W stosownych przypadkach podawane będą informacje odnoszące się do innych platform (na przykład Alpha). Pomimo starań o utrzymanie niniejszego opisu aktualnym, możliwe jest zaistnienie drobnych różnic pomiędzy instalatorem a zawartością tego rozdziału. Zaleca się, aby traktować niniejszy teksty jako ogólny przewodnik, niż raczej dosłowny podręcznik instalacji.</p></div></td></tr></tbody></table></div></div><div class=sect2><h3 id=install-pre>2.2. Czynności wstępne<a class=anchor href=#install-pre></a></h3><div class=sect3><h4 id=install-inventory>2.2.1. Rozpoznanie komponentów komputera<a class=anchor href=#install-inventory></a></h4><div class=paragraph><p>Przed instalacją FreeBSD powinniśmy zapoznać się z komponentami naszego komputera. W czasie instalacji FreeBSD pokaże listę urządzeń (dyski, karty sieciowe, napędy CD-ROM, itd.) wraz z informacjami o producentach i numerach modeli. FreeBSD postara się także ustalić prawidłową konfigurację każdego z nich, m.in. ustawienia przerwań IRQ i portów we/wy. Ze względu na "kaprysy" pecetowego sprzętu może się okazać, że konfiguracja wykryta przez FreeBSD nie jest w pełni prawidłowa i trzeba będzie samodzielnie ją poprawić.</p></div><div class=paragraph><p>Jeżeli na komputerze jest już zainstalowany inny system operacyjny, na przykład Windows® lub Linux, warto jest skorzystać z dostępnych w nim narzędzi do sprawdzenia bieżącej konfiguracji sprzętowej. Kiedy zupełnie nie wiadomo jak skonfigurowana powinna być dana karta, wymagane informacje mogą znajdować się bezpośrednio na niej samej. Często spotykane numery przerwań IRQ to 3, 5 i 7, a adresy portów we/wy są zwykle zapisywane w postaci liczb szesnastkowych, na przykład 0x330.</p></div><div class=paragraph><p>Zalecamy by zebrane informacje wydrukować lub zapisać na kartce przed rozpoczęciem instalacji FreeBSD. Można je zestawić w postaci tabeli, np.:</p></div><table class="tableblock frame-none grid-all stretch"><caption class=title>Tabela 1. Przykładowa lista urządzeń</caption><col style=width:25%><col style=width:25%><col style=width:25%><col style=width:25%><thead><tr><th class="tableblock halign-left valign-top">Nazwa urządzenia</th><th class="tableblock halign-left valign-top">IRQ</th><th class="tableblock halign-left valign-top">Port(y) we/wy</th><th class="tableblock halign-left valign-top">Uwagi</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Pierwszy dysk twardy</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>brak</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>brak</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>40 GB, firmy Seagate, IDE 1 master</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>CDROM</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>brak</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>brak</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>IDE 1 slave</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Drugi dysk twardy</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>brak</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>brak</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>20 GB, firmy IBM, IDE 2 master</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Kontroler IDE</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>14</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>0x1f0</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Karta sieciowa</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>brak</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>brak</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Intel® 10/100</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Modem</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>brak</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>brak</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>3Com® 56K faxmodem na COM1</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>…​</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>…​</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>…​</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>…​</p></td></tr></tbody></table></div><div class=sect3><h4 id=_przygotowanie_kopii_danych>2.2.2. Przygotowanie kopii danych<a class=anchor href=#_przygotowanie_kopii_danych></a></h4><div class=paragraph><p>Jeśli komputer, na którym będzie przeprowadzana instalacja zawiera cenne dane, powinniśmy koniecznie przygotować ich kopię zapasową, oraz sprawdzić stan tychże kopii przed instalacją FreeBSD. Podczas instalacji kilkakrotnie pojawi się prośba o potwierdzenie przed zapisaniem czegokolwiek na dysku, jednak gdy już się to rozpocznie, nie będzie możliwości odwrotu.</p></div></div><div class=sect3><h4 id=install-where>2.2.3. Wybór miejsca dla FreeBSD<a class=anchor href=#install-where></a></h4><div class=paragraph><p>Jeżeli masz zamiar przeznaczyć cały dysk na FreeBSD, to omawiane poniżej zagadnienia nie będą cię dotyczyć - możesz pominąć tę część.</p></div><div class=paragraph><p>W przypadku, gdy zamierzamy zainstalować FreeBSD obok innych systemów operacyjnych, warto zapoznać się z podstawowymi informacjami o sposobie przechowywania danych na dysku.</p></div><div class=sect4><h5 id=install-where-i386>2.2.3.1. Układ dysku w systemach i386™<a class=anchor href=#install-where-i386></a></h5><div class=paragraph><p>Dysk komputera typu PC można podzielić na oddzielne porcje, zwane <em>partycjami</em>. Komputery PC potrafią obsłużyć maksymalnie cztery partycje na jednym dysku. Partycje te nazywane są <em>partycjami podstawowymi</em>. W celu ominięcia tego ograniczenia i umożliwienia stworzenia większej liczby partycji, wymyślono nowy typ partycji - <em>partycje rozszerzone</em>. Na dysku może znajdować się tylko jedna taka partycja. Natomiast wewnątrz niej można utworzyć specjalne partycje, zwane <em>partycjami logicznymi</em>.</p></div><div class=paragraph><p>Wszystkie partycje posiadają własny <em>identyfikator partycji</em>, tj. numer określający typ przechowywanych na niej danych. Partycje FreeBSD oznaczone są identyfikatorem <code>165</code>.</p></div><div class=paragraph><p>Każdy ze stosowanych systemów operacyjnych identyfikuje partycje w określony sposób. Dla przykładu, DOS i jego następcy, w tym Windows®, przypisują każdej partycji podstawowej i logicznej <em>literę dysku</em>, zaczynając od <span class=filename>C:</span>.</p></div><div class=paragraph><p>FreeBSD musi być zainstalowane na partycji podstawowej. Wszystkie własne dane, w tym pliki tworzone przez użytkowników, może przechowywać na jednej partycji. Jednakże, jeśli masz do dyspozycji kilka dysków, możesz utworzyć partycję FreeBSD na każdym z nich bądź jedynie na wybranych. Tym nie mniej na potrzeb instalacji wymagane jest posiadanie jednej partycji. Może to być świeżo utworzona, pusta partycja, lub też partycja zawierająca dane, które nie są już potrzebne.</p></div><div class=paragraph><p>W przypadku, gdy wszystkie dostępne partycje na dysku są już wykorzystywane, będziesz musiał zwolnić jedną z nich, korzystając z narzędzi dostępnych w wykorzystywanym systemie operacyjnym (np. <code>fdisk</code> w DOS lub Windows®).</p></div><div class=paragraph><p>Jeśli dysponujesz wolną partycją, możesz ją wykorzystać. Może się jednak okazać, że zajdzie potrzeba zmniejszenia rozmiarów niektórych z pozostałych partycji.</p></div><div class=paragraph><p>Minimalna instalacja FreeBSD zajmuje jedynie 100 MB miejsca na dysku. Jest to jednakże <em>bardzo</em> minimalna instalacja, praktycznie nie pozostawiająca miejsca na pliki użytkowników. Zdecydowanie bardziej realnym minimum jest 250 MB, o ile nie planujemy wykorzystania środowiska graficznego, bądź co najmniej 350 MB z graficznym interfejsem. Instalowanie wielu dodatkowych programów wymaga więcej wolnego miejsca na dysku.</p></div><div class=paragraph><p>W celu przygotowania miejsca dla FreeBSD można wykorzystać narzędzia komercyjne pokroju PartitionMagic® bądź darmowe jak GParted. Dwa darmowe programy służące do tego samego celu, tj. FIPS i PResizer, dostępne są na płycie CD w katalogu <span class=filename>tools</span>. W tym samym katalogu znajduje się również ich dokumentacja. Zarówno FIPS, PResizer jak i PartitionMagic® potrafią rozszerzać partycje typu FAT16 i FAT32 - wykorzystywane w MS-DOS® aż po Windows® ME. System plików NTFS potrafią obsługiwać PartitionMagic® i GParted.</p></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>Niewłaściwe korzystanie z tych narzędzi może doprowadzić do utraty danych. Przed ich zastosowaniem należy się upewnić, że przygotowaliśmy aktualne kopie zapasowe.</p></div></td></tr></tbody></table></div><div class=exampleblock><div class=title>Przykład 1. Wykorzystanie niezmienionej istniejącej partycji</div><div class=content><div class=paragraph><p>Przyjmijmy, że mamy do dyspozycji komputer wyposażony w dysk o pojemności 4 GB, z zainstalowanym systemem Windows®. Dysk jest podzielony na dwie części oznaczone literami <span class=filename>C:</span> i <span class=filename>D:</span>, o rozmiarze 2 GB każda. Na <span class=filename>C:</span> mamy 1 GB danych, a na <span class=filename>D:</span> 0,5 GB danych.</p></div><div class=paragraph><p>Mamy więc dysk o dwóch partycjach, z których każda oznaczona jest literą dysku. Możemy skopiować dane z <span class=filename>D:</span> na <span class=filename>C:</span>, dzięki czemu druga partycja stanie się wolna i będzie można zainstalować na niej FreeBSD.</p></div></div></div><div class=exampleblock><div class=title>Przykład 2. Zmniejszenie istniejącej partycji</div><div class=content><div class=paragraph><p>Przyjmijmy tym razem, że na dysku o pojemności 4 GB zainstalowany jest system Windows® na jednej dużej partycji. Partycja dostępna jest jako dysk <span class=filename>C:</span> o rozmiarze 4 GB. Mamy na nim 1,5 GB danych i chcielibyśmy udostępnić dla FreeBSD 2 GB.</p></div><div class=paragraph><p>Możemy wybrać jedno z poniższych rozwiązań:</p></div><div class="olist arabic"><ol class=arabic><li><p>Przygotować kopię danych, następnie na nowo zainstalować Windows®, tworząc podczas instalacji partycję o rozmiarze 2 GB.</p></li><li><p>Skorzystać z jednego ze wspomnianych wcześniej narzędzi, np. PartitionMagic®, w celu zmniejszenia rozmiaru partycji Windows®.</p></li></ol></div></div></div></div><div class=sect4><h5 id=_układ_dysku_alpha>2.2.3.2. Układ dysku Alpha<a class=anchor href=#_układ_dysku_alpha></a></h5><div class=paragraph><p>W przypadku architektury Alpha na FreeBSD trzeba będzie przeznaczyć cały dysk. Nie ma obecnie możliwości wspólnego korzystania z dysku przez kilka systemów operacyjnych. W zależności od konkretnego modelu komputera Alpha, możemy wykorzystać dysk SCSI lub IDE, o ile komputer umożliwia załadowanie z niego systemu operacyjnego.</p></div><div class=paragraph><p>Zgodnie z konwencją stosowaną w podręcznikach Digital / Compaq wszystkie polecenia SRM pisane są wielkimi literami. SRM nie rozróżnia małych i dużych liter.</p></div><div class=paragraph><p>By wyświetlić nazwy i rodzaje zainstalowanych w komputerze dysków, posługujemy się poleceniem <code>SHOW DEVICE</code> w konsoli SRM:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=o>&gt;&gt;&gt;</span>SHOW DEVICE
dka0.0.0.4.0               DKA0           TOSHIBA CD-ROM XM-57  3476
dkc0.0.0.1009.0            DKC0                       RZ1BB-BS  0658
dkc100.1.0.1009.0          DKC100             SEAGATE ST34501W  0015
dva0.0.0.0.1               DVA0
ewa0.0.0.3.0               EWA0              00-00-F8-75-6D-01
pkc0.7.0.1009.0            PKC0                  SCSI Bus ID 7  5.27
pqa0.0.0.4.0               PQA0                       PCI EIDE
pqb0.0.1.4.0               PQB0                       PCI EIDE</code></pre></div></div><div class=paragraph><p>Powyższy przykład pochodzi z komputera Digital Personal Workstation 433au i pokazuje trzy dyski. Pierwszym z nich jest CDROM opisany nazwą <span class=filename>DKA0</span>, natomiast dwa pozostałe to twarde dyski o nazwach <span class=filename>DKC0</span> i <span class=filename>DKC100</span>.</p></div><div class=paragraph><p>Dyski o nazwach typu <span class=filename>DKx</span> są dyskami SCSI. Dla przykładu <span class=filename>DKA100</span> oznacza dysk SCSI o identyfikatorze 1 na pierwszej szynie SCSI (A), natomiast <span class=filename>DKC300</span> oznacza dysk o identyfikatorze 3 na trzeciej szynie SCSI ©. Nazwa <span class=filename>PKx</span> oznacza kontroler SCSI. Jak pokazuje przykład z <code>SHOW DEVICE</code>, napędy CDROM SCSI traktowane są tak samo jak dyski twarde SCSI.</p></div><div class=paragraph><p>Nazwy dysków IDE mają postać <span class=filename>DQx</span>, a nazwa <span class=filename>PQx</span> oznacza kontroler IDE.</p></div></div></div><div class=sect3><h4 id=_zbieranie_informacji_o_konfiguracji_sieci>2.2.4. Zbieranie informacji o konfiguracji sieci<a class=anchor href=#_zbieranie_informacji_o_konfiguracji_sieci></a></h4><div class=paragraph><p>Jeśli podczas instalacji będziemy korzystać z połączenia z siecią (np. FreeBSD instalowane będzie z serwera FTP lub serwera NFS), będziemy musieli znać konfigurację sieci. W trakcie instalacji pojawi się prośba o wpisanie tej konfiguracji, by umożliwić FreeBSD połączenie się z siecią i kontynuowanie instalacji.</p></div><div class=sect4><h5 id=_połączenie_z_siecią_ethernet_lub_przez_modem_kablowydsl>2.2.4.1. Połączenie z siecią Ethernet lub przez modem kablowy/DSL<a class=anchor href=#_połączenie_z_siecią_ethernet_lub_przez_modem_kablowydsl></a></h5><div class=paragraph><p>W przypadku komputera podłączonego do sieci Ethernet lub połączonego z Internetem przez modem kablowy lub DSL, potrzebne będą następujące informacje:</p></div><div class="olist arabic"><ol class=arabic><li><p>Adres IP</p></li><li><p>Adres IP domyśnej bramy</p></li><li><p>Nazwa stacji</p></li><li><p>Adresy IP serwerów DNS</p></li><li><p>Maska podsieci</p></li></ol></div><div class=paragraph><p>Informacje te możemy uzyskać od administratora systemu lub dostawcy usług sieciowych. Może się okazać, że konfiguracja odbywa się automatycznie, przy użyciu <em>DHCP</em>. Jeśli tak jest, należy o tym fakcie pamiętać.</p></div></div><div class=sect4><h5 id=_połączenie_przez_modem>2.2.4.2. Połączenie przez modem<a class=anchor href=#_połączenie_przez_modem></a></h5><div class=paragraph><p>Instalacja FreeBSD przez Internet możliwa jest także w przypadku połączenia modemowego, jednakże będzie to trwało bardzo długo.</p></div><div class=paragraph><p>Niezbędne informacje:</p></div><div class="olist arabic"><ol class=arabic><li><p>Numer telefonu do dostawcy usług internetowych</p></li><li><p>Numer portu COM, do którego podłączony jest modem</p></li><li><p>Nazwa użytkownika i hasło konta u dostawcy usług</p></li></ol></div></div></div><div class=sect3><h4 id=_sprawdzenie_erraty_freebsd>2.2.5. Sprawdzenie erraty FreeBSD<a class=anchor href=#_sprawdzenie_erraty_freebsd></a></h4><div class=paragraph><p>W pracy nad FreeBSD podejmowane są wszelkie starania, aby każde wydanie FreeBSD było jak najbardziej niezawodne, jednakże od czasu do czasu zdarzają się błędy. W pewnych bardzo rzadkich przypadkach mogą mieć one wpływ na proces instalacji systemu. Błędy te po wykryciu i naprawieniu są opisywane w erracie zamieszczonej na stronie <a href=http://www.FreeBSD.org/releases/12.0r/errata/>FreeBSD Errata</a> (ang.). Przed instalacją warto jest sprawdzić, czy w erracie nie wspomniano o problemach, które mogą zakłócić instalację.</p></div><div class=paragraph><p>Informacje o wszystkich wydaniach systemu, jak również erraty do każdego z nich, znaleźć można na <a href=https://www.FreeBSD.org/>stronie WWW FreeBSD</a> w części poświęconej <a href=https://www.FreeBSD.org/releases/>wydaniom</a>.</p></div></div><div class=sect3><h4 id=_pozyskanie_plików_instalacyjnych_freebsd>2.2.6. Pozyskanie plików instalacyjnych FreeBSD<a class=anchor href=#_pozyskanie_plików_instalacyjnych_freebsd></a></h4><div class=paragraph><p>Pliki potrzebne do rozpoczęcia instalacji systemu mogą pochodzić z jednego z wymienionych poniżej źródeł:</p></div><div class=ulist><div class=title>Nośniki lokalne</div><ul><li><p>Płyta CDROM lub DVD</p></li><li><p>Partycja DOS-owa na tym samym komputerze</p></li><li><p>Pamięć taśmowa QIC lub SCSI</p></li><li><p>Dyskietki</p></li></ul></div><div class=ulist><div class=title>Sieć</div><ul><li><p>Serwer FTP, także przez firewall lub proxy HTTP, zależnie od potrzeb</p></li><li><p>Serwer NFS</p></li><li><p>Dedykowane połączenie równoległe lub szeregowe</p></li></ul></div><div class=paragraph><p>Posiadając FreeBSD na CD lub DVD, mamy już wszystko, co potrzeba, możemy zatem przejść do następnej części (<a href=#install-floppies>Przygotowanie dyskietek do instalacji</a>).</p></div><div class=paragraph><p>Jeśli nie mamy plików instalacyjnych FreeBSD, <a href=#install-diff-media>Przygotowanie własnego nośnika instalacji</a> zawiera opis instalacji FreeBSD z dowolnego z wymienionych wcześniej źródeł. Następnie powróćmy do <a href=#install-floppies>Przygotowanie dyskietek do instalacji</a>.</p></div></div><div class=sect3><h4 id=install-floppies>2.2.7. Przygotowanie dyskietek do instalacji<a class=anchor href=#install-floppies></a></h4><div class=paragraph><p>Instalacja FreeBSD rozpoczyna się uruchomieniem programu instalacyjnego podczas startu komputera - nie jest to program, który można uruchomić w innym systemie operacyjnym. Zwykle przy uruchamianiu komputera ładowany jest system zainstalowany na dysku twardym, jednak można także uruchomić system z dyskietki "startowej". Do tego celu może także posłużyć CDROM, jeśli komputer daje taką możliwość.</p></div><div class="admonitionblock tip"><table><tbody><tr><td class=icon><i class="fa icon-tip" title=Tip></i></td><td class=content><div class=paragraph><p>Jeśli posiadamy FreeBSD na płytach CDROM lub DVD (kupionych lub przygotowanych samodzielnie), a nasz komputer pozwala na uruchomienie z płyty (zwykle dzięki ustawieniu opcji BIOS-u zwanej "Boot Order" lub podobnej), możemy nie czytać niniejszej części. Płyty CDROM i DVD zawierające FreeBSD mogą być użyte jako dyski startowe bez dodatkowego przygotowania.</p></div></td></tr></tbody></table></div><div class=paragraph><p>By utworzyć zestaw dyskietek startowych, należy:</p></div><div class="exampleblock procedure"><div class=content><div class="olist arabic"><ol class=arabic><li><p>Zdobyć obrazy dyskietek startowych</p><div class=paragraph><p>Dyskietki startowe znaleźć można wśród plików instalacyjnych w katalogu <span class=filename>floppies/</span> bądź pobrać z serwera <code><a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/releases/<arch>/<version>-RELEASE/floppies/" class=bare>ftp://ftp.FreeBSD.org/pub/FreeBSD/releases/&lt;arch>/&lt;version>-RELEASE/floppies/</a></code> zamieniając odpowiednio <em>&lt;arch></em> i <em>&lt;wersja></em> właściwą architekturą naszego sprzętu i wybraną wersją FreeBSD. Przykładowo, obrazy dyskietek dla FreeBSD 12.0-RELEASE na architekturę i386™ dostępne są pod adresem <a href=ftp://ftp.FreeBSD.org/pub/FreeBSD/releases/i386/12.0-RELEASE/floppies/>ftp://ftp.FreeBSD.org/pub/FreeBSD/releases/i386/12.0-RELEASE/floppies/</a>.</p></div><div class=paragraph><p>Obrazy dyskietek mają rozszerzenie <span class=filename>.flp</span>. Katalog <span class=filename>floppies/</span> zawiera kilka różnych obrazów, a to, które z nich będą potrzebne, zależy od wersji FreeBSD, która będzie instalowana, a czasem również od sprzętu na którym system ma być zainstalowany. Z reguły potrzebne będą trzy dyskietki <span class=filename>boot.flp</span>, <span class=filename>kern1.flp</span> i <span class=filename>kern2.flp</span>. Warto jednak dla pewności przeczytać znajdujący się w tym samym katalogu plik <span class=filename>README.TXT</span>.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Systemy gałęzi 5.X starsze od FreeBSD 5.3 mogą wymagać dodatkowych sterowników urządzeń. Znaleźć je można w obrazie dyskietki <span class=filename>drivers.flp</span>.</p></div></td></tr></tbody></table></div><div class="admonitionblock important"><table><tbody><tr><td class=icon><i class="fa icon-important" title=Important></i></td><td class=content><div class=paragraph><p>Pobierając pliki przez FTP należy koniecznie używać <em>trybu binarnego</em>. Wiadomo jest, że w niektórych przeglądarkach stosowany jest tryb <em>tekstowy</em> (zwany też <em>ASCII</em>), przez co dyskietki startowe mogą się okazać niezdatne do użycia.</p></div></td></tr></tbody></table></div></li><li><p>Przygotować dyskietki startowe</p><div class=paragraph><p>Dla każdego pliku z obrazem przygotowujemy jedną dyskietkę. Dyskietki nie mogą być w jakikolwiek sposób uszkodzone. Najprostszym sposobem samodzielnego sprawdzenia, czy dyskietka nie jest wadliwa, jest jej sformatowanie. Nie powinniśmy ufać dyskietkom formatowanym fabrycznie. Narzędzie formatujące dostępne w systemie Windows® nie poinformuje o istnieniu uszkodzonych bloków, po prostu oznaczy je jako "uszkodzone" i zignoruje. Zaleca się używanie fabrycznie nowych dyskietek.</p></div><div class="admonitionblock important"><table><tbody><tr><td class=icon><i class="fa icon-important" title=Important></i></td><td class=content><div class=paragraph><p>Gdy podczas instalacji FreeBSD program instalacyjny wskaże błąd, zastygnie lub zachowa się w dziwny sposób, jednymi z pierwszych podejrzanych powinny być dyskietki. Trzeba wówczas nagrać pliki obrazów na inne dyskietki i spróbować ponownie.</p></div></td></tr></tbody></table></div></li><li><p>Nagrać pliki obrazów na dyskietki</p><div class=paragraph><p>Pliki <span class=filename>.flp</span> nie są zwyczajnymi plikami, które można nagrać na dyskietkę. Są natomiast obrazami całkowitej zawartości dyskietek. Oznacza to, że <em>nie można</em> zapisać tych plików po prostu kopiując z jednego dysku na drugi. Skorzystamy ze specjalnego oprogramowania, by bezpośrednio zapisać obrazy na dyskietkach.</p></div><div class=paragraph><p>Jeśli dyskietki nagrywamy na komputerze z MS-DOS®/Windows®, to możemy skorzystać z dołączonego do FreeBSD narzędzia <code>fdimage</code>.</p></div><div class=paragraph><p>W przypadku, gdy wykorzystujemy obrazy dyskietek z płyty CDROM dostępnego jako dysk <span class=filename>E:</span>, posłużymy się poleceniem:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>E:<span class=se>\&gt;</span> tools<span class=se>\f</span>dimage floppies<span class=se>\k</span>ern.flp A:</code></pre></div></div><div class=paragraph><p>Powtarzamy je dla każdego z plików <span class=filename>.flp</span>, za każdym razem zmieniając dyskietkę. Najlepiej jest też napisać na dyskietce nazwę skopiowanego na nią pliku. Powyższe polecenie może potrzebować pewnych modyfikacji, w zależności od miejsca, w którym znajdują się pliki <span class=filename>.flp</span>. Jeżeli nie dysponujemy płytą CD, możemy pobrać <code>fdimage</code> z <a href=ftp://ftp.FreeBSD.org/pub/FreeBSD/tools/>katalogu tools</a> na serwerze FTP FreeBSD.</p></div><div class=paragraph><p>Jeżeli natomiast dyskietki nagrywamy w systemie uniksowym (na przykład w innym FreeBSD), do zapisania plików obrazów na dyskietkach możemy wykorzystać polecenie <a href="https://man.freebsd.org/cgi/man.cgi?query=dd&amp;sektion=1&amp;format=html">dd(1)</a>. We FreeBSD wpisalibyśmy:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># dd if=kern.flp of=/dev/fd0</span></code></pre></div></div><div class=paragraph><p>W systemie FreeBSD <span class=filename>/dev/fd0</span> odpowiada pierwszej stacji dyskietek (napędowi <span class=filename>A:</span>). <span class=filename>/dev/fd1</span> odpowiadałoby <span class=filename>B:</span> i tak dalej. W innych odmianach systemów UNIX® mogą być stosowane inne nazwy stacji dyskietek, konieczne może więc być zapoznanie się z dokumentacją danego systemu.</p></div></li></ol></div></div></div><div class=paragraph><p>W tej chwili jesteśmy już przygotowani do instalacji FreeBSD.</p></div></div></div><div class=sect2><h3 id=install-start>2.3. Rozpoczęcie instalacji<a class=anchor href=#install-start></a></h3><div class="admonitionblock important"><table><tbody><tr><td class=icon><i class="fa icon-important" title=Important></i></td><td class=content><div class=paragraph><p>Z założenia, podczas instalacji dane na dysku (lub dyskach) nie ulegną żadnym zmianom przed pojawieniem się następującego komunikatu:</p></div><div class=literalblock><div class=content><pre>Last Chance: Are you SURE you want continue the installation?

If you&#39;re running this on a disk with data you wish to save then WE
STRONGLY ENCOURAGE YOU TO MAKE PROPER BACKUPS before proceeding!

We can take no responsibility for lost disk contents!</pre></div></div><div class=paragraph><p>Instalację można przerwać w dowolnej chwili przed powyższym ostrzeżeniem, mając pewność, że dane na dysku pozostają nietknięte. Jeśli będziemy się obawiać, że coś niewłaściwie skonfigurowaliśmy, możemy po prostu wyłączyć komputer i nic złego się nie stanie.</p></div></td></tr></tbody></table></div><div class=sect3><h4 id=install-starting>2.3.1. Uruchomienie komputera<a class=anchor href=#install-starting></a></h4><div class=sect4><h5 id=install-starting-i386>2.3.1.1. Uruchomienie i386™<a class=anchor href=#install-starting-i386></a></h5><div class="exampleblock procedure"><div class=content><div class="olist arabic"><ol class=arabic><li><p>Na początku komputer powinien być wyłączony.</p></li><li><p>Włączamy komputer. Po chwili powinna pojawić się możliwość przejścia do menu systemowego, lub BIOS-u, najczęściej poprzez naciśnięcie klawisza <kbd>F2</kbd>, <kbd>F10</kbd>, <kbd>Del</kbd> bądź <span class=keyseq><kbd>Alt</kbd>+<kbd>S</kbd></span>. Wciskamy odpowiedni klawisz zgodnie z informacją na ekranie. Niekiedy komputer podczas uruchamiania pokazuje jakiś obrazek. Zwykle wciskając <kbd>Esc</kbd> możemy pozbyć się obrazka, aby mieć możliwość przeczytania komunikatów.</p></li><li><p>Wśród opcji odnajdujemy tę, która decyduje o kolejności ładowania systemu z poszczególnych urządzeń. Zwykle ma ona postać listy urządzeń, takich jak <code>Floppy</code>, <code>CDROM</code>, <code>First Hard Disk</code>, itd.</p><div class=paragraph><p>Jeżeli wcześniej przygotowaliśmy dyskietki startowe, wybieramy stację dyskietek. Jeśli natomiast korzystamy z płyty CD, wybieramy właśnie CDROM. Wątpliwości możemy rozstrzygnąć zaglądając do instrukcji dołączonej do komputera i jego płyty głównej.</p></div><div class=paragraph><p>Wprowadzone zmiany muszą być zapisane przed opuszczeniem menu systemowego. Komputer powinien ponownie się uruchomić.</p></div></li><li><p>Jeżeli korzystamy z dyskietek startowych, o których traktuje <a href=#install-floppies>Przygotowanie dyskietek do instalacji</a>, to jedna z nich będzie pierwszą dyskietką startową, najprawdopodobniej będzie to dyskietka zawierająca <span class=filename>kern.flp</span>. Ją właśnie wkładamy do stacji.</p><div class=paragraph><p>W przypadku korzystania z płyty CD wystarczy po prostu włączyć komputer i włożyć płytę do napędu.</p></div><div class=paragraph><p>Jeżeli komputer uruchomi się jak zwykle i załaduje już zainstalowany system operacyjny, może to oznaczać, że:
.. Dyskietka lub płyta zostały włożone za późno. Powinniśmy spróbować uruchomić komputer bez wyjmowania dyskietki bądź płyty.
.. Zmiany w ustawieniach BIOS-u nie zadziałały prawidłowo. Spróbujmy wprowadzić je ponownie, aż do osiągnięcia zamierzonego efektu.
.. Nasza wersja BIOS-u nie pozwala na uruchomienie systemu z wybranego nośnika.</p></div></li><li><p>Rozpocznie się ładowanie FreeBSD. Podczas ładowania z płyty CD pojawi się tekst podobny do poniższego (pominięto informacje o wersji)::</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>Verifying DMI Pool Data ........
Boot from ATAPI CD-ROM :
 1. FD 2.88MB  System Type-<span class=o>(</span>00<span class=o>)</span>
Uncompressing ... <span class=k>done

</span>BTX loader 1.00 BTX version is 1.01
Console: internal video/keyboard
BIOS drive A: is disk0
BIOS drive B: is disk1
BIOS drive C: is disk2
BIOS drive D: is disk3
BIOS 639kB/261120kB available memory

FreeBSD/i386 bootstrap loader, Revision 0.8

/kernel <span class=nv>text</span><span class=o>=</span>0x277391 <span class=nv>data</span><span class=o>=</span>0x3268c+0x332a8 |

|
Hit <span class=o>[</span>Enter] to boot immediately, or any other key <span class=k>for </span><span class=nb>command </span>prompt.
Booting <span class=o>[</span>kernel] <span class=k>in </span>9 seconds... _</code></pre></div></div><div class=paragraph><p>Natomiast ładując z dyskietki, zobaczymy tekst w rodzaju (pominięto informacje o wersji):</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>Verifying DMI Pool Data ........

BTX loader 1.00  BTX version is 1.01
Console: internal video/keyboard
BIOS drive A: is disk0
BIOS drive C: is disk1
BIOS 639kB/261120kB available memory

FreeBSD/i386 bootstrap loader, Revision 0.8

/kernel <span class=nv>text</span><span class=o>=</span>0x277391 <span class=nv>data</span><span class=o>=</span>0x3268c+0x332a8 |

Please insert MFS root floppy and press enter:</code></pre></div></div><div class=paragraph><p>Postępując zgodnie z instrukcją na ekranie, wyjmujemy dyskietkę <span class=filename>kern.flp</span>, wkładamy <span class=filename>mfsroot.flp</span> i naciskamy <kbd>Enter</kbd>. We FreeBSD 5.3 i późniejszych dostępne są również inne dyskietki opisane w <a href=#install-floppies>poprzednim podrozdziale</a>. Należy uruchomić system z pierwszej dyskietki, następnie wkładać kolejne zgodnie z pojawiającymi się komunikatami.</p></div></li><li><p>Niezależnie, czy uruchamiamy komputer z dyskietki czy z płyty, podczas ładowania ujrzymy komunikat:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>Hit <span class=o>[</span>Enter] to boot immediately, or any other key <span class=k>for </span><span class=nb>command </span>prompt.
Booting <span class=o>[</span>kernel] <span class=k>in </span>9 seconds... _</code></pre></div></div><div class=paragraph><p>Albo czekamy dziesięć sekund, albo wciskamy <kbd>Enter</kbd>.</p></div></li></ol></div></div></div></div><div class=sect4><h5 id=_uruchomienie_alpha>2.3.1.2. Uruchomienie Alpha<a class=anchor href=#_uruchomienie_alpha></a></h5><div class="exampleblock procedure"><div class=content><div class="olist arabic"><ol class=arabic><li><p>Na początku komputer powinien być wyłączony.</p></li><li><p>Włączamy komputer i czekamy na znak zachęty boot monitora.</p></li><li><p>Jeżeli korzystamy z dyskietek startowych opisanych w <a href=#install-floppies>Przygotowanie dyskietek do instalacji</a>, to jedna z nich będzie pierwszą dyskietką startową, najprawdopodobniej będzie to dyskietka zawierająca <span class=filename>kern.flp</span>. Ją właśnie wkładamy do stacji i wpisujemy następujące polecenie, aby uruchomić komputer z dyskietki (zmieniając nazwę napędu dyskietek, jeżeli będzie to konieczne):</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=o>&gt;&gt;&gt;</span>BOOT DVA0 <span class=nt>-FLAGS</span> <span class=s1>&#39;&#39;</span> <span class=nt>-FILE</span> <span class=s1>&#39;&#39;</span></code></pre></div></div><div class=paragraph><p>W przypadku korzystania z płyty CD, wkładamy ją do napędu i rozpoczynamy instalację wpisując następujące polecenie (wstawiając inną nazwę napędu CDROM, jeżeli będzie to konieczne):</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=o>&gt;&gt;&gt;</span>BOOT DKA0 <span class=nt>-FLAGS</span> <span class=s1>&#39;&#39;</span> <span class=nt>-FILE</span> <span class=s1>&#39;&#39;</span></code></pre></div></div></li><li><p>Rozpocznie się ładowanie FreeBSD. Podczas ładowania z dyskietki, zobaczymy tekst w rodzaju:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>Please insert MFS root floppy and press enter:</code></pre></div></div><div class=paragraph><p>Postępując zgodnie z instrukcją na ekranie, wyjmujemy dyskietkę <span class=filename>kern.flp</span>, wkładamy <span class=filename>mfsroot.flp</span> i naciskamy <kbd>Enter</kbd>.</p></div></li><li><p>Niezależnie, czy uruchamiamy komputer z dyskietki czy z płyty, podczas ładowania ujrzymy komunikat:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>Hit <span class=o>[</span>Enter] to boot immediately, or any other key <span class=k>for </span><span class=nb>command </span>prompt.
Booting <span class=o>[</span>kernel] <span class=k>in </span>9 seconds... _</code></pre></div></div><div class=paragraph><p>Czekamy dziesięć sekund, albo wciskamy <kbd>Enter</kbd>. Przejdziemy do menu konfiguracyjnego jądra.</p></div></li></ol></div></div></div></div></div><div class=sect3><h4 id=view-probe>2.3.2. Przeglądanie wyników rozpoznania urządzeń<a class=anchor href=#view-probe></a></h4><div class=paragraph><p>Kilkaset ostatnio wyświetlonych na ekranie linii jest zapisywanych i można je przeglądać.</p></div><div class=paragraph><p>By przejrzeć bufor, naciskamy <kbd>Scroll Lock</kbd>. Włączamy w ten sposób tryb przewijania ekranu. Można teraz przeglądać wyniki rozpoznania urządzeń przy użyciu klawiszy kursora, lub <kbd>PageUp</kbd> i <kbd>PageDown</kbd>. Tryb przewijania wyłącza się wciskając ponownie <kbd>Scroll Lock</kbd>.</p></div><div class=paragraph><p>Zróbmy to, aby przejrzeć tekst, który został przewinięty poza ekran, gdy jądro dokonywało rozpoznawania urządzeń. Tekst będzie mieć treść podobną do przedstawionej na <a href=#install-dev-probe>Przykład wyników rozpoznania urządzeń</a>, jednakże dokładna treść zależy od zainstalowanych w komputerze urządzeń.</p></div><div id=install-dev-probe class=listingblock><div class=title>Przykład wyników rozpoznania urządzeń</div><div class=content><pre class="rouge highlight"><code data-lang=shell>avail memory <span class=o>=</span> 253050880 <span class=o>(</span>247120K bytes<span class=o>)</span>
Preloaded elf kernel <span class=s2>&#34;kernel&#34;</span> at 0xc0817000.
Preloaded mfs_root <span class=s2>&#34;/mfsroot&#34;</span> at 0xc0817084.
md0: Preloaded image &lt;/mfsroot&gt; 4423680 bytes at 0xc03ddcd4

md1: Malloc disk
Using <span class=nv>$PIR</span> table, 4 entries at 0xc00fde60
npx0: &lt;math processor&gt; on motherboard
npx0: INT 16 interface
pcib0: &lt;Host to PCI bridge&gt; on motherboard
pci0: &lt;PCI bus&gt; on pcib0
pcib1:&lt;VIA 82C598MVP <span class=o>(</span>Apollo MVP3<span class=o>)</span> PCI-PCI <span class=o>(</span>AGP<span class=o>)</span> bridge&gt; at device 1.0 on pci0
pci1: &lt;PCI bus&gt; on pcib1
pci1: &lt;Matrox MGA G200 AGP graphics accelerator&gt; at 0.0 irq 11
isab0: &lt;VIA 82C586 PCI-ISA bridge&gt; at device 7.0 on pci0
isa0: &lt;iSA bus&gt; on isab0
atapci0: &lt;VIA 82C586 ATA33 controller&gt; port 0xe000-0xe00f at device 7.1 on pci0
ata0: at 0x1f0 irq 14 on atapci0
ata1: at 0x170 irq 15 on atapci0
uhci0 &lt;VIA 83C572 USB controller&gt; port 0xe400-0xe41f irq 10 at device 7.2 on pci
0
usb0: &lt;VIA 83572 USB controller&gt; on uhci0
usb0: USB revision 1.0
uhub0: VIA UHCI root hub, class 9/0, rev 1.00/1.00, addr1
uhub0: 2 ports with 2 removable, self powered
pci0: &lt;unknown card&gt; <span class=o>(</span><span class=nv>vendor</span><span class=o>=</span>0x1106, <span class=nv>dev</span><span class=o>=</span>0x3040<span class=o>)</span> at 7.3
dc0: &lt;ADMtek AN985 10/100BaseTX&gt; port 0xe800-0xe8ff mem 0xdb000000-0xeb0003ff ir
q 11 at device 8.0 on pci0
dc0: Ethernet address: 00:04:5a:74:6b:b5
miibus0: &lt;MII bus&gt; on dc0
ukphy0: &lt;Generic IEEE 802.3u media interface&gt; on miibus0
ukphy0: 10baseT, 10baseT-FDX, 100baseTX, 100baseTX-FDX, auto
ed0: &lt;NE2000 PCI Ethernet <span class=o>(</span>RealTek 8029<span class=o>)&gt;</span> port 0xec00-0xec1f irq 9 at device 10.
0 on pci0
ed0 address 52:54:05:de:73:1b, <span class=nb>type </span>NE2000 <span class=o>(</span>16 bit<span class=o>)</span>
isa0: too many dependant configs <span class=o>(</span>8<span class=o>)</span>
isa0: unexpected small tag 14
orm0: &lt;Option ROM&gt; at iomem 0xc0000-0xc7fff on isa0
fdc0: &lt;NEC 72065B or clone&gt; at port 0x3f0-0x3f5,0x3f7 irq 6 drq2 on isa0
fdc0: FIFO enabled, 8 bytes threshold
fd0: &lt;1440-KB 3.5<span class=s2>&#34; drive&gt; on fdc0 drive 0
atkbdc0: &lt;Keyboard controller (i8042)&gt; at port 0x60,0x64 on isa0
atkbd0: &lt;AT Keyboard&gt; flags 0x1 irq1 on atkbdc0
kbd0 at atkbd0
psm0: &lt;PS/2 Mouse&gt; irq 12 on atkbdc0
psm0: model Generic PS/@ mouse, device ID 0
vga0: &lt;Generic ISA VGA&gt; at port 0x3c0-0x3df iomem 0xa0000-0xbffff on isa0
sc0: &lt;System console&gt; at flags 0x100 on isa0
sc0: VGA &lt;16 virtual consoles, flags=0x300&gt;
sio0 at port 0x3f8-0x3ff irq 4 flags 0x10 on isa0
sio0: type 16550A
sio1 at port 0x2f8-0x2ff irq 3 on isa0
sio1: type 16550A
ppc0: &lt;Parallel port&gt; at port 0x378-0x37f irq 7 on isa0
pppc0: SMC-like chipset (ECP/EPP/PS2/NIBBLE) in COMPATIBLE mode
ppc0: FIFO with 16/16/15 bytes threshold
plip0: &lt;PLIP network interface&gt; on ppbus0
ad0: 8063MB &lt;IBM-DHEA-38451&gt; [16383/16/63] at ata0-master UDMA33
acd0: CD-RW &lt;LITE-ON LTR-1210B&gt; at ata1-slave PIO4
Mounting root from ufs:/dev/md0c
/stand/sysinstall running as init on vty0</span></code></pre></div></div><div class=paragraph><p>Warto jest uważnie przejrzeć wyniki, by mieć pewność, że wszystkie spodziewane urządzenia zostały wykryte. Brak urządzenia na liście oznacza, że nie zostało ono wykryte. Jeśli sterownik wymagał skonfigurowania IRQ i adresu portu, to powinniśmy sprawdzić, czy prawidłowo je wpisaliśmy.</p></div><div class=paragraph><p>Jeśli trzeba będzie zmienić ustawienia rozpoznawania urządzeń, możemy łatwo opuścić program sysinstall i zacząć od nowa. Dzięki temu można również lepiej poznać cały proces.</p></div><div id=sysinstall-exit class=imageblock><div class=content><img src=../../../../images/books/handbook/install/sysinstall-exit.png alt="sysinstall exit"></div><div class=title>Rysunek 1. Wyjście z sysinstall</div></div><div class=paragraph><p>Korzystając z klawiszy kursora, wybieramy z głównego menu <span class=guimenuitem>Exit Install</span>. Ukaże się następujący komunikat:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>                      User Confirmation Requested
         Are you sure you wish to <span class=nb>exit</span>? The system will reboot
           <span class=o>(</span>be sure to remove any floppies from the drives<span class=o>)</span><span class=nb>.</span>

                            <span class=o>[</span> Yes <span class=o>]</span>    No</code></pre></div></div><div class=paragraph><p>Instalacja ponownie zacznie się od początku, jeśli wybierzemy <b class=button>yes</b>, pozostawiając płytę CD w napędzie.</p></div><div class=paragraph><p>Jeśli instalujemy z dyskietek, przed ponownym uruchomieniem komputera powinniśmy wyjąć dyskietkę <span class=filename>mfsroot.flp</span> i włożyć <span class=filename>kern.flp</span>.</p></div></div></div><div class=sect2><h3 id=using-sysinstall>2.4. Wprowadzenie do sysinstall<a class=anchor href=#using-sysinstall></a></h3><div class=paragraph><p>Sysinstall jest aplikacją instalacyjną przygotowaną w ramach Projektu FreeBSD. Jest to program konsolowy podzielony na szereg pomniejszych menu i ekranów, służących do konfiguracji i zarządzania procesem instalacji.</p></div><div class=paragraph><p>Menu sysinstall obsługiwane jest klawiszami kursora, klawiszem <kbd>Enter</kbd>, <kbd>Spacją</kbd> i innymi. Dokładny opis działania poszczególnych klawiszy znaleźć można w części poświęconej posługiwaniu się sysinstall.</p></div><div class=paragraph><p>Dostęp do tych informacji możliwy jest poprzez podświetlenie pozycji <span class=guimenuitem>Usage</span> i wybranie przycisku <b class=button>Select</b>, a następnie wciśnięcie klawisza <kbd>Enter</kbd>, zgodnie z <a href=#sysinstall-main3>Wyświetlenie z głównego menu instrukcji obsługi sysinstall</a>.</p></div><div class=paragraph><p>Wyświetlone zostaną zostaną wskazówki odnośnie posługiwania się systemem menu. Po ich przeczytaniu powrót do głównego menu możliwy jest poprzez naciśnięcie klawisza <kbd>Enter</kbd>.</p></div><div id=sysinstall-main3 class=imageblock><div class=content><img src=../../../../images/books/handbook/install/main1.png alt=main1></div><div class=title>Rysunek 2. Wyświetlenie z głównego menu instrukcji obsługi sysinstall</div></div><div class=sect3><h4 id=select-doc>2.4.1. Menu dokumentacji<a class=anchor href=#select-doc></a></h4><div class=paragraph><p>Korzystając z klawiszy kursora, w głównym menu wybieramy <span class=guimenuitem>Doc</span> i wciskamy <kbd>Enter</kbd>.</p></div><div id=main-doc class=imageblock><div class=content><img src=../../../../images/books/handbook/install/main-doc.png alt="main doc"></div><div class=title>Rysunek 3. Wybór menu dokumentacji</div></div><div class=paragraph><p>Spowoduje to wyświetlenie menu dokumentacji.</p></div><div id=docmenu1 class=imageblock><div class=content><img src=../../../../images/books/handbook/install/docmenu1.png alt=docmenu1></div><div class=title>Rysunek 4. Menu dokumentacji sysinstall</div></div><div class=paragraph><p>Warto przeczytać dostępne tu dokumenty.</p></div><div class=paragraph><p>By wyświetlić konkretny dokument, wybieramy go klawiszami kursora, a następnie wciskamy <kbd>Enter</kbd>. Po przeczytaniu klawiszem <kbd>Enter</kbd> możemy powrócić do menu dokumentacji.</p></div><div class=paragraph><p>Do głównego menu instalacji powracamy wybierając klawiszami kursora <span class=guimenuitem>Exit</span>, a następnie wciskając <kbd>Enter</kbd>.</p></div></div><div class=sect3><h4 id=keymap>2.4.2. Menu mapowania klawiatury<a class=anchor href=#keymap></a></h4><div class=paragraph><p>Aby zmienić mapowanie klawiatury klawiszami kursora wybieramy z menu pozycję <span class=guimenuitem>Keymap</span> i wciskamy <kbd>Enter</kbd>. Zmiana mapowania klawiatury wymagana jest jedynie gdy używamy klawiatury innej niż standardowej amerykańskiej.</p></div><div id=sysinstall-keymap class=imageblock><div class=content><img src=../../../../images/books/handbook/install/main-keymap.png alt="main keymap"></div><div class=title>Rysunek 5. Główne menu sysinstall</div></div><div class=paragraph><p>Wyboru mapowania klawiatury dokonujemy poprzez wskazanie odpowiedniej pozycji z listy przy pomocy klawiszy kursora, oraz wciśnięcie <kbd>Spacji</kbd>. Ponowne naciśnięcie <kbd>Spacji</kbd> cofa wybór. Po wybraniu odpowiedniego mapowania wskazujemy klawiszami kursora <b class=button>OK</b> i wciskamy <kbd>Enter</kbd>.</p></div><div class=paragraph><p>Na poniższym rysunku przedstawiona jest tylko część listy. Wybranie <b class=button>Cancel</b> spowoduje przyjęcie domyślnego mapowania klawiatury i powrót do głównego menu.</p></div><div id=sysinstall-keymap-menu class=imageblock><div class=content><img src=../../../../images/books/handbook/install/keymap.png alt=keymap></div><div class=title>Rysunek 6. Menu mapowania klawiatury</div></div></div><div class=sect3><h4 id=viewsetoptions>2.4.3. Ekran opcji instalacji<a class=anchor href=#viewsetoptions></a></h4><div class=paragraph><p>Wybieramy <span class=guimenuitem>Options</span> i naciskamy <kbd>Enter</kbd>.</p></div><div id=sysinstall-options class=imageblock><div class=content><img src=../../../../images/books/handbook/install/main-options.png alt="main options"></div><div class=title>Rysunek 7. Główne menu sysinstall</div></div><div id=options class=imageblock><div class=content><img src=../../../../images/books/handbook/install/options.png alt=options></div><div class=title>Rysunek 8. Opcje sysinstall</div></div><div class=paragraph><p>Wartości domyślne są zwykle odpowiednie dla większości użytkowników i nie ma potrzeby ich zmiany. Nazwa wydania może być inna w zależności od instalowanej wersji systemu.</p></div><div class=paragraph><p>Po wybraniu jednej z opcji, na dole ekranu ukaże się jej opis podświetlony na niebiesko. Opcja <span class=guimenuitem>Use Defaults</span> (użyj domyślnych) przywraca wszystkim opcjom wartości domyślne.</p></div><div class=paragraph><p>Naciskając <kbd>F1</kbd> przechodzimy do ekranu pomocy, gdzie możemy przeczytać o poszczególnych opcjach.</p></div><div class=paragraph><p>Naciskając <kbd>Q</kbd> powracamy do głównego menu.</p></div></div><div class=sect3><h4 id=start-install>2.4.4. Rozpoczęcie instalacji standardowej<a class=anchor href=#start-install></a></h4><div class=paragraph><p>Instalacja standardowa zalecana jest dla wszystkich zaczynających swą przygodę z FreeBSD, bądź w ogóle z systemem UNIX®. Klawiszami kursora wybieramy <span class=guimenuitem>Standard</span> i wciskamy <kbd>Enter</kbd>.</p></div><div id=sysinstall-standard class=imageblock><div class=content><img src=../../../../images/books/handbook/install/main-std.png alt="main std"></div><div class=title>Rysunek 9. Rozpoczęcie instalacji standardowej</div></div></div></div><div class=sect2><h3 id=install-steps>2.5. Przydział miejsca na dysku<a class=anchor href=#install-steps></a></h3><div class=paragraph><p>Zaczynamy od przydzielenia FreeBSD przestrzeni dyskowej, oraz oznaczenia tej przestrzeni w taki sposób, by sysinstall mógł ją przygotować. Do tego potrzebna nam będzie wiedza na temat sposobu, w jaki FreeBSD znajduje informacje zapisane na dysku.</p></div><div class=sect3><h4 id=install-drive-bios-numbering>2.5.1. Kolejność dysków w BIOS-ie<a class=anchor href=#install-drive-bios-numbering></a></h4><div class=paragraph><p>Przed instalacją i konfiguracją FreeBSD powinniśmy zapoznać się z pewnym ważnym zagadnieniem, szczególnie istotnym dla posiadaczy dwóch lub więcej twardych dysków.</p></div><div class=paragraph><p>W komputerze typu PC wyposażonym w zależny od BIOS-u system operacyjny, jak na przykład MS-DOS® lub Microsoft® Windows®, BIOS może zmienić rzeczywistą kolejność dysków, a system operacyjny tę zmianę zaakceptuje. Dzięki temu system może zostać uruchomiony z dysku innego niż tzw. "primary master". Jest to szczególnie wygodne dla tych użytkowników, którzy za najprostszą i najtańszą metodę tworzenia kopii zapasowej uważają kupno identycznego drugiego twardego dysku i kopiowanie zawartości pierwszego dysku przy użyciu Ghost lub XCOPY. W przypadku uszkodzenia pierwszego dysku, ataku wirusa lub awarii systemu operacyjnego, dane mogą być z łatwością odzyskane poprzez zamianę logicznej kolejności dysków w BIOS-ie. To tak, jakby zamienić przewody dysków, ale bez konieczności otwierania obudowy.</p></div><div class=paragraph><p>Droższe maszyny wyposażone w kontrolery SCSI mają często rozszerzenia BIOS-u pozwalające zamieniać kolejność dysków SCSI na podobnej zasadzie, obsługując do siedmiu dysków.</p></div><div class=paragraph><p>Użytkowników przyzwyczajonych do korzystania z tego typu rozwiązań może spotkać niespodzianka, gdy we FreeBSD rezultaty odbiegają od oczekiwań. FreeBSD nie korzysta z BIOS-u, jak również nie zna "logicznej kolejności dysków BIOS-u". W efekcie może to prowadzić do kłopotliwych sytuacji, szczególnie wtedy, gdy dyski są identyczne pod względem geometrii, oraz zawierają takie same dane.</p></div><div class=paragraph><p>Planując używanie FreeBSD, powinniśmy ustawić w BIOS-ie rzeczywistą kolejność dysków przed instalacją systemu, i tę kolejność pozostawić. Jeśli chcemy koniecznie zamienić dyski, to możemy to zrobić sprzętowo, otwierając obudowę i zamieniając odpowiednie zworki i przewody.</p></div><div class=sidebarblock><div class=content><div class=paragraph><p>Bolek ma przygotować dla Lolka komputer z FreeBSD. Bolek montuje jeden dysk SCSI jako urządzenie SCSI zero, i instaluje na nim FreeBSD.</p></div><div class=paragraph><p>Lolek zaczyna korzystać z systemu, ale po kilku dniach zauważa, że dysk SCSI zgłasza liczne błędy, więc zawiadamia o tym Bolka.</p></div><div class=paragraph><p>Po kolejnych kilku dniach Bolek postanawia rozwiązać problem, więc bierze ze "składzika" taki sam dysk SCSI. Kontrola powierzchni dysku wykazuje, że dysk działa prawidłowo, więc Bolek podłącza go jako czwarte urządzenie SCSI i wykonuje kopię dysku zerowego na dysk czwarty. Ponieważ dysk jest podłączony i działa jak należy, Bolek stwierdza, że można zacząć go używać, więc wykorzystując możliwości BIOS-u SCSI zmienia kolejność dysków w taki sposób, by system uruchamiany był z czwartego urządzenia SCSI. FreeBSD uruchamia się i działa jak należy.</p></div><div class=paragraph><p>Lolek korzysta z systemu przez jakiś czas, następnie wspólnie z Bolkiem postanawiają spróbować czegoś nowego - zainstalować nowszą wersję FreeBSD. Bolek wymontowuje dysk SCSI zero, ponieważ działał kiepsko, i zastępuje go kolejnym identycznym dyskiem ze "składzika". Bolek instaluje nową wersję FreeBSD na nowym dysku SCSI korzystając z czarodziejskich dyskietek instalacyjnych Lolka. Instalacja przebiega prawidłowo.</p></div><div class=paragraph><p>Lolek używa nowej wersji FreeBSD przez parę dni i stwierdza, że można zacząć korzystać z niej w pracy. Wcześniej jednak trzeba będzie skopiować wszystkie dane ze starej wersji. Lolek podłącza więc czwarty dysk SCSI (najświeższą kopię starej wersji FreeBSD). Lolek stwierdza jednak z niepokojem, że na dysku nie ma śladu po jego cennych danych.</p></div><div class=paragraph><p>Gdzie się one podziały?</p></div><div class=paragraph><p>Gdy Bolek sporządził kopię dysku zerowego na dysku czwartym, dysk czwarty stał się "klonem". Zmieniając kolejność dysków w BIOS-ie SCSI aby móc uruchamiać system z dysku czwartego, Bolek sam siebie wprowadzał w błąd. FreeBSD wciąż działało na dysku zerowym. Zmiana w BIOS-ie powoduje, że część kodu uruchamiającego FreeBSD jest rzeczywiście ładowana z dysku wskazanego w BIOS-ie, lecz kiedy pałeczkę przejmują sterowniki jądra FreeBSD, kolejność dysków BIOS-u przestaje obowiązywać, a FreeBSD przechodzi z powrotem na rzeczywistą kolejność. W opowiadanej historyjce system nadal działał na dysku zerowym, i tam właśnie znajdowały się cenne dane Lolka, a nie na dysku czwartym. Choć wydawało się, że system działa na dysku czwartym, było to tylko złudzenie.</p></div><div class=paragraph><p>Z przyjemnością oznajmiamy, iż ani jeden bajt cennych danych nie zginął ani nie został w inny sposób skrzywdzony podczas naszych badań nad opisanym zjawiskiem. Stary dysk SCSI zero został odnaleziony i cenne dane wróciły do Lolka (Bolek z kolei przekonał się, że niczego nie można być pewnym).</p></div><div class=paragraph><p>W opowieści udział wzięły dyski SCSI, jednakże w przypadku dysków IDE sytuacja wyglądałaby tak samo.</p></div></div></div></div><div class=sect3><h4 id=main-fdisk>2.5.2. Tworzenie segmentów za pomocą programu FDisk<a class=anchor href=#main-fdisk></a></h4><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Dokonywane tutaj zmiany nie zostaną zapisane na dysku. Jeżeli będziemy podejrzewać, że coś zrobiliśmy źle, możemy wybrać w menu wyjście z programu sysinstall i spróbować jeszcze raz od początku, bądź wcisnąć <kbd>U</kbd> by skorzystać z opcji <span class=guimenuitem>Undo</span> (cofnij). W ostateczności, jeżeli całkiem stracimy orientację, możemy po prostu wyłączyć komputer.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Po wybraniu standardowej instalacji w sysinstall zostanie wyświetlony następujący komunikat:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>                                 Message
 In the next menu, you will need to <span class=nb>set </span>up a DOS-style <span class=o>(</span><span class=s2>&#34;fdisk&#34;</span><span class=o>)</span>
 partitioning scheme <span class=k>for </span>your hard disk. If you simply wish to devote
 all disk space to FreeBSD <span class=o>(</span>overwriting anything <span class=k>else </span>that might be on
 the disk<span class=o>(</span>s<span class=o>)</span> selected<span class=o>)</span> <span class=k>then </span>use the <span class=o>(</span>A<span class=o>)</span>ll <span class=nb>command </span>to <span class=k>select </span>the default
 partitioning scheme followed by a <span class=o>(</span>Q<span class=o>)</span>uit. If you wish to allocate only
 free space to FreeBSD, move to a partition marked <span class=s2>&#34;unused&#34;</span> and use the
 <span class=o>(</span>C<span class=o>)</span>reate command.
                                <span class=o>[</span>  OK  <span class=o>]</span>

                      <span class=o>[</span> Press enter or space <span class=o>]</span></code></pre></div></div><div class=paragraph><p>Zgodnie z poleceniem naciskamy <kbd>Enter</kbd>. Zobaczymy teraz listę twardych dysków znalezionych przez jądro podczas rozpoznawania urządzeń. <a href=#sysinstall-fdisk-drive1>Wybór dysku FDisk-a</a> przedstawia przykład komputera z dwoma dyskami IDE, o nazwach <span class=filename>ad0</span> i <span class=filename>ad2</span>.</p></div><div id=sysinstall-fdisk-drive1 class=imageblock><div class=content><img src=../../../../images/books/handbook/install/fdisk-drive1.png alt="fdisk drive1"></div><div class=title>Rysunek 10. Wybór dysku FDisk-a</div></div><div class=paragraph><p>Można się zastanawiać, dlaczego na liście brakuje <span class=filename>ad1</span>. Co spowodowało, że został pominięty?</p></div><div class=paragraph><p>Przyjmijmy przykładowo, że mamy dwa dyski IDE, jeden jako master na pierwszym kontrolerze IDE, drugi jako master na drugim kontrolerze IDE. Gdyby we FreeBSD zostały one ponumerowane w takiej kolejności, w jakiej zostały wykryte, czyli <span class=filename>ad0</span> i <span class=filename>ad1</span>, wszystko działałoby jak należy.</p></div><div class=paragraph><p>Gdybyśmy jednak zainstalowali potem jeszcze jeden dysk, jako slave na pierwszym kontrolerze IDE, to ten właśnie dysk zostałby nowym <span class=filename>ad1</span>, a wcześniejszy <span class=filename>ad1</span> zmieniłby się w <span class=filename>ad2</span>. Ponieważ systemy plików odnajdywane są według nazw urządzeń (np. <span class=filename>ad1s1a</span>), mogłoby się nagle okazać, że niektóre systemy plików nie działają poprawnie. Aby to poprawić, musielibyśmy zmienić konfigurację systemu.</p></div><div class=paragraph><p>Aby zapobiec takim sytuacjom, jądro FreeBSD może być skonfigurowane tak, by przydzielać dyskom IDE numery zgodne z ich rzeczywistym umiejscowieniem, niezależnie od kolejności wykrywania. Tym sposobem dysk podłączony jako master na drugim kontrolerze IDE <em>zawsze</em> będzie mieć nazwę <span class=filename>ad2</span>, nawet w sytuacji, gdy <span class=filename>ad0</span> i <span class=filename>ad1</span> nie są w ogóle obecne.</p></div><div class=paragraph><p>Jądro FreeBSD domyślnie skonfigurowane jest właśnie w ten sposób, dlatego też na ekranie mamy <span class=filename>ad0</span> i <span class=filename>ad2</span>. Komputer, z którego ten rysunek pochodzi, miał dwa dyski IDE podłączone jako master do obu kontrolerów IDE, nie miał natomiast dysków podłączonych jako slave.</p></div><div class=paragraph><p>Wybieramy dysk, na którym chcemy zainstalować FreeBSD i wybieramy <b class=button>OK</b>. Zostanie uruchomiony FDisk, pokazując na ekranie obraz podobny do <a href=#sysinstall-fdisk1>Układ partycji w FDisk-u przed zmianami</a>.</p></div><div class=paragraph><p>Ekran FDisk-a podzielony jest na trzy części.</p></div><div class=paragraph><p>Część pierwsza, obejmująca pierwsze dwie linie ekranu, zawiera informacje o wybranym dysku, w tym jego oznaczenie we FreeBSD, geometrię oraz całkowity rozmiar dysku.k.</p></div><div class=paragraph><p>Druga część pokazuje informacje o istniejących na dysku segmentach: gdzie się one zaczynają oraz kończą, jaki jest ich rozmiar, jaka nazwa została im nadana przez FreeBSD ich opis oraz typ. Na rysunku przykładowym widać dwa niewielkie nieużywane segmenty, obecne ze względu na stosowany w architekturze PC podział dysku. Prócz tego widać duży segment FAT, który prawie na pewno jest dyskiem <span class=filename>C:</span> w MS-DOS® / Windows®, oraz segment rozszerzony, zawierający być może dyski MS-DOS® / Windows® oznaczone kolejnymi literami.</p></div><div class=paragraph><p>W trzeciej części znajduje się lista dostępnych w FDisk-u poleceń.</p></div><div id=sysinstall-fdisk1 class=imageblock><div class=content><img src=../../../../images/books/handbook/install/fdisk-edit1.png alt="fdisk edit1"></div><div class=title>Rysunek 11. Układ partycji w FDisk-u przed zmianami</div></div><div class=paragraph><p>Dalej postępować będziemy w zależności od tego, jak chcemy podzielić nasz dysk na segmenty.</p></div><div class=paragraph><p>Jeżeli chcemy, by FreeBSD zajęło cały dysk (co wiąże się z usunięciem z niego wszelkich innych danych, gdy potwierdzimy to w sysinstall na późniejszym etapie instalacji), naciskamy <kbd>A</kbd>, co odpowiada opcji <span class=guimenuitem>Use Entire Disk</span> (wykorzystaj cały dysk). Istniejące segmenty zostaną usunięte, a w ich miejsce pojawi się mały obszar opisany jako <code>unused</code> (nieużywany; znów jest to następstwem pecetowego układu dysku), oraz duży segment przeznaczony dla FreeBSD. Jeżeli decydujemy się na tę opcję, powinniśmy w następnej kolejności wskazać nowoutworzony segment FreeBSD przy użyciu klawiszy kursora i wcisnąć <kbd>S</kbd>, by umożliwić ładowanie systemu z tego segmentu. Ekran będzie wyglądać podobnie do przedstawionego na <a href=#sysinstall-fdisk2>Partycja w FDisk-u obejmująca cały dysk</a>. Zwróćmy uwagę na literę <code>A</code> w kolumnie Flags, oznacza ona, że segment jest <em>aktywny</em> i będzie z niego ładowany system.</p></div><div class=paragraph><p>Jeśli chcemy usunąć istniejący segment by zwolnić miejsce dla FreeBSD, wskazujemy segment korzystając z klawiszy kursora i naciskamy <kbd>D</kbd>. Następnie możemy nacisnąć <kbd>C</kbd> i w odpowiedzi na pytanie o rozmiar segmentu, który chcemy utworzyć, wpisać odpowiednią wartość i wcisnąć <kbd>Enter</kbd>. Wartość domyślna stanowi największy możliwy rozmiar segmentu, czyli np. wolną przestrzeń na dysku bądź całą pojemność dysku twardego.</p></div><div class=paragraph><p>Wolne miejsce dla FreeBSD mogliśmy także przygotować wcześniej (na przykład przy użyciu programu PartitionMagic®), w takim wypadku po prostu wciskamy <kbd>C</kbd> by utworzyć nowy segment. W tym przypadku również zostaniemy zapytani o rozmiar segmentu, który zamierzamy stworzyć.</p></div><div id=sysinstall-fdisk2 class=imageblock><div class=content><img src=../../../../images/books/handbook/install/fdisk-edit2.png alt="fdisk edit2"></div><div class=title>Rysunek 12. Partycja w FDisk-u obejmująca cały dysk</div></div><div class=paragraph><p>Na koniec naciskamy <kbd>Q</kbd>. Dokonane zmiany zostaną zapamiętane przez sysinstall, ale nie będą jeszcze zapisane na dysku.</p></div></div><div class=sect3><h4 id=bootmgr>2.5.3. Instalacja programu ładującego<a class=anchor href=#bootmgr></a></h4><div class=paragraph><p>W kolejnym kroku instalacji będziemy mieć możliwość zainstalowania programu ładującego (ang. boot manager). Mówiąc ogólnie, powinniśmy instalować program ładujący FreeBSD jeżeli:</p></div><div class=ulist><ul><li><p>Mamy dwa lub więcej dysków, a FreeBSD instalujemy na dysku innym niż pierwszy.</p></li><li><p>Instalujemy FreeBSD obok innego systemu operacyjnego na tym samym dysku, i chcemy mieć możliwość wybrania systemu operacyjnego podczas uruchamiania komputera.</p></li></ul></div><div class=paragraph><p>Jeśli FreeBSD będzie jedynym systemem operacyjnym na danym komputerze i zostanie zainstalowany na pierwszym dysku twardym, wówczas wystarczy wykorzystać <span class=guimenuitem>Standardowy</span> program ładujący. Natomiast jeśli wykorzystujemy już inny program potrafiący uruchomić FreeBSD powinnyśmy wybrać opcję <span class=guimenuitem>None</span> (żaden).</p></div><div class=paragraph><p>Dokonany wybór potwierdzamy naciskając <kbd>Enter</kbd>.</p></div><div id=sysinstall-bootmgr class=imageblock><div class=content><img src=../../../../images/books/handbook/install/boot-mgr.png alt="boot mgr"></div><div class=title>Rysunek 13. Wybór programu ładującego w sysinstall</div></div><div class=paragraph><p>Ekran pomocy, wyświetlany po naciśnięciu <kbd>F1</kbd>, opisuje problemy z jakimi można się spotkać, gdy planuje się mieć kilka systemów operacyjnych na jednym dysku.</p></div></div><div class=sect3><h4 id=_tworzenie_segmentów_na_innym_dysku>2.5.4. Tworzenie segmentów na innym dysku<a class=anchor href=#_tworzenie_segmentów_na_innym_dysku></a></h4><div class=paragraph><p>Jeżeli mamy więcej dysków, po wyborze programu ładującego ponownie ukaże się ekran wyboru dysku. Chcąc zainstalować FreeBSD na kilku dyskach, wybieramy tutaj kolejny dysk i ponownie korzystając z programu FDisk tworzymy na nim segmenty.</p></div><div class="admonitionblock important"><table><tbody><tr><td class=icon><i class="fa icon-important" title=Important></i></td><td class=content><div class=paragraph><p>Jeśli instalujemy FreeBSD na innym dysku niż pierwszy, wówczas program ładujący FreeBSD musi zostać zainstalowany na obydwu dyskach.</p></div></td></tr></tbody></table></div><div id=sysinstall-fdisk-drive2 class=imageblock><div class=content><img src=../../../../images/books/handbook/install/fdisk-drive2.png alt="fdisk drive2"></div><div class=title>Rysunek 14. Zakończenie wyboru dysku</div></div><div class=paragraph><p>Klawisz <kbd>Tab</kbd> przełącza pomiędzy ostatnio wybranym dyskiem oraz przyciskami <b class=button>OK</b>, i <b class=button>Cancel</b>.</p></div><div class=paragraph><p>Wciskamy <kbd>Tab</kbd> jeden raz, by wybrać <b class=button>OK</b>, następnie naciskamy <kbd>Enter</kbd> aby przejść do kolejnego etapu instalacji.</p></div></div><div class=sect3><h4 id=bsdlabeleditor>2.5.5. Tworzenie partycji z wykorzystaniem Disklabel<a class=anchor href=#bsdlabeleditor></a></h4><div class=paragraph><p>W nowoutworzonych segmentach musimy stworzyć kilka partycji. Pamiętajmy, że każda partycja oznaczona jest literą od <code>a</code> do <code>h</code>, a partycje <code>b</code>, <code>c</code> i <code>d</code> rządzą się specjalnymi zasadami, których należy przestrzegać.</p></div><div class=paragraph><p>Niektóre aplikacje mogą skorzystać na stosowaniu określonych schematów podziału na partycje, szczególnie, gdy partycje rozłożone są na kilku dyskach. Na razie jednak, ponieważ jest to nasza pierwsza instalacja FreeBSD, nie powinniśmy zbytnio przejmować się podziałem dysku na partycje. Ważniejszym jest, byśmy zainstalowali FreeBSD i zaczęli się uczyć, jak go używać. Kiedy już nabierzemy pewnej wprawy, możemy zainstalować system ponownie i zmienić sposób podziału na partycje.</p></div><div class=paragraph><p>Poniższy schemat przedstawia cztery partycje - jedną dla przestrzeni wymiany, oraz trzy dla systemów plików.</p></div><table class="tableblock frame-none grid-all stretch"><caption class=title>Tabela 2. Układ partycji pierwszego dysku</caption><col style=width:25%><col style=width:25%><col style=width:25%><col style=width:25%><thead><tr><th class="tableblock halign-left valign-top">Partycja</th><th class="tableblock halign-left valign-top">System plików</th><th class="tableblock halign-left valign-top">Rozmiar</th><th class="tableblock halign-left valign-top">Opis</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>a</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>100 MB</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Będzie to główny system plików. Wszystkie inne systemy plików będą zamontowane gdzieś wewnątrz niego. 100 MB jest dość rozsądnym rozmiarem dla tego celu. Nie będzie tu przechowywane zbyt wiele danych, zwykle po instalacji FreeBSD umieszcza tu około 40 MB danych. Pozostałe miejsce jest dla danych tymczasowych, oraz służy jako zapas, gdyby kolejne wersje FreeBSD potrzebowały więcej miejsca w <span class=filename>/</span>.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>b</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>brak</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>2-3 x RAM</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Partycja ta służy jako przestrzeń wymiany. Wybór jej odpowiedniego rozmiaru nie jest sprawą banalną. Możemy przyjąć, że przestrzeń wymiany powinna być dwu- lub trzykrotnie większa niż ilość pamięci fizycznej (RAM). Prócz tego powinniśmy mieć co najmniej 64 MB przestrzeni wymiany, więc jeżeli nasz komputer ma mniej niż 32 MB pamięci, ustawmy rozmiar przestrzeni wymiany na 64 MB.</p><p class=tableblock>Jeśli dysponujemy kilkoma dyskami, możemy na każdym z nich umieścić przestrzeń wymiany. FreeBSD będzie w procesie wymiany wykorzystywać każdy z dysków, dzięki czemu wymiana będzie się odbywać szybciej. W takim przypadku przyjmujemy całkowity rozmiar potrzebnej przestrzeni wymiany (np. 128 MB) i dzielimy go przez liczbę posiadanych dysków (np. dwa dyski), otrzymując w wyniku rozmiar przestrzeni wymiany dla jednego dysku. W naszym przykładzie będzie to 64 MB na każdy dysk.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>e</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/var</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>50 MB</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>W katalogu <span class=filename>/var</span> przechowywane są pliki o zmiennych rozmiarach; pliki dzienników systemowych i inne pliki administracyjne. Podczas codziennej pracy FreeBSD na wielu z tych plików dokonywane są częste operacje odczytu lub zapisu. Dzięki umieszczeniu ich w oddzielnym systemie plików FreeBSD może dokonać optymalizacji dostępu do nich, nie wywierając jednocześnie wpływu na inne pliki, do których dostęp przebiega inaczej.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>f</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/usr</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Reszta dysku</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Inne pliki będą zwykle przechowywane w katalogu <span class=filename>/usr</span> i jego podkatalogach.</p></td></tr></tbody></table><div class=paragraph><p>Jeżeli instalujemy FreeBSD na dwóch lub więcej dyskach, musimy utworzyć partycje także w innych przygotowanych segmentach. Najłatwiej jest po prostu przygotować na każdym z kolejnych dysków dwie partycje, jedną na przestrzeń wymiany, drugą na system plików.</p></div><table class="tableblock frame-none grid-all stretch"><caption class=title>Tabela 3. Układ partycji dla kolejnych dysków</caption><col style=width:25%><col style=width:25%><col style=width:25%><col style=width:25%><thead><tr><th class="tableblock halign-left valign-top">Partycja</th><th class="tableblock halign-left valign-top">System plików</th><th class="tableblock halign-left valign-top">Rozmiar</th><th class="tableblock halign-left valign-top">Opis</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>b</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>brak</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Patrz: opis</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Jak już powiedzieliśmy, przestrzeń wymiany możemy dzielić między kilka dysków. Mimo, iż mamy do dyspozycji partycję <code>a</code>, zgodnie z obowiązującą konwencją przestrzeń wymiany powinna znajdować się na partycji <code>b</code>.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>e</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>/dysk<em>n</em></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Reszta dysku</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Pozostała część dysku zajmowana jest przez jedną dużą partycję. Mogłaby to z powodzeniem być partycja <code>a</code>, zamiast <code>e</code>. Przyjęto jednak, że partycja <code>a</code> zarezerwowana jest dla głównego systemu plików (<span class=filename>/</span>). Nie ma przymusu stosowania tej zasady, jednak sysinstall jej przestrzega, dobrze więc jest ją stosować dla zachowania porządku podczas instalacji. System plików możemy zamontować w dowolnym miejscu, w przykładzie zaproponowano <span class=filename>/dyskn</span>, gdzie <em>n</em> jest kolejnym numerem każdego dysku. Można jednak wybrać inne nazewnictwo według uznania..</p></td></tr></tbody></table><div class=paragraph><p>Po podjęciu decyzji jak ma wyglądać układ partycji, pora wprowadzić go w życie używając sysinstall. Na ekranie ukaże się następujący komunikat:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>                                 Message
 Now, you need to create BSD partitions inside of the fdisk
 partition<span class=o>(</span>s<span class=o>)</span> just created. If you have a reasonable amount of disk
 space <span class=o>(</span>200MB or more<span class=o>)</span> and don<span class=s1>&#39;t have any special requirements, simply
 use the (A)uto command to allocate space automatically. If you have
 more specific needs or just don&#39;</span>t care <span class=k>for </span>the layout chosen by
 <span class=o>(</span>A<span class=o>)</span>uto, press F1 <span class=k>for </span>more information on manual layout.

                                <span class=o>[</span>  OK  <span class=o>]</span>
                          <span class=o>[</span> Press enter or space <span class=o>]</span></code></pre></div></div><div class=paragraph><p>Naciskamy <kbd>Enter</kbd> by przejść do edytora partycji FreeBSD, zwanego Disklabel.</p></div><div class=paragraph><p><a href=#sysinstall-label>Edytor Disklabel</a> przedstawia ekran zaraz po uruchomieniu Disklabel. Jest on podzielony na trzy części.</p></div><div class=paragraph><p>W kilku pierwszych wierszach widoczna jest nazwa wybranego aktualnie dysku, oraz nazwa segmentu, w którym tworzymy partycje (Disklabel używa tutaj nazwy <code>Partition name</code>, czyli nazwa partycji, a nie nazwa segmentu). Jest tu również zawarta informacja o rozmiarze wolnej przestrzeni wewnątrz segmentu, czyli przestrzeni nie przydzielonej jeszcze partycjom.</p></div><div class=paragraph><p>Środek ekranu zajmuje lista utworzonych partycji, wraz z nazwami przechowywanych na nich systemów plików, ich rozmiarami oraz pewnymi opcjami związanymi z tworzeniem systemu plików.</p></div><div class=paragraph><p>W dolnej części przedstawiona jest lista dostępnych w Disklabel poleceń.</p></div><div id=sysinstall-label class=imageblock><div class=content><img src=../../../../images/books/handbook/install/disklabel-ed1.png alt="disklabel ed1"></div><div class=title>Rysunek 15. Edytor Disklabel</div></div><div class=paragraph><p>Disklabel potrafi automatycznie utworzyć partycje i nadać im domyślne rozmiary. Wypróbujmy tę możliwość naciskając <kbd>A</kbd>. Na ekranie ukaże się obraz podobny do <a href=#sysinstall-label2>Edytor disklabel z automatycznymi ustawieniami</a>. Ustawienia automatyczne mogą być właściwe lub nie, w zależności od rozmiaru dysku. Nie ma to jednak większego znaczenia, ponieważ nie trzeba ich koniecznie akceptować.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Katalog <span class=filename>/tmp</span> jest domyślnie umieszczany na własnej partycji, zamiast być częścią partycji <span class=filename>/</span>. Dzięki temu można uniknąć zapełnienia partycji <span class=filename>/</span> plikami tymczasowymi.</p></div></td></tr></tbody></table></div><div id=sysinstall-label2 class=imageblock><div class=content><img src=../../../../images/books/handbook/install/disklabel-auto.png alt="disklabel auto"></div><div class=title>Rysunek 16. Edytor disklabel z automatycznymi ustawieniami</div></div><div class=paragraph><p>By usunąć zaproponowane partycje i zastąpić je utworzonymi własnoręcznie, wybieramy klawiszami kursora pierwszą partycję i naciskamy <kbd>D</kbd>. Tak samo postępujemy z pozostałymi partycjami.</p></div><div class=paragraph><p>Teraz, aby stworzyć pierwszą partycję (<code>a</code>, zamontowaną jako <span class=filename>/</span>), wybieramy informacje o dysku w górnej części ekranu i wciskamy <kbd>C</kbd>. Pojawi się okienko z pytaniem o rozmiar nowej partycji (<a href=#sysinstall-label-add>Wolne miejsce dla głównej partycji</a>). Wybrany rozmiar podać możemy w blokach, albo w wygodniejszej formie w postaci liczby megabajtów, gigabajtów lub cylindrów, odpowiednio z przyrostkiem <code>M</code>, <code>G</code> lub <code>C</code>.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Począwszy od FreeBSD 5.X użytkownicy mogą: wybrać system plików UFS2 (domyślny system we FreeBSD 5.1 i późniejszych) wykorzystując opcję <code>Custom Newfs</code> (<kbd>Z</kbd>), tworzyć partycje za pomocą <code>Auto Defaults</code> i modyfikować przy pomocy <code>Custom Newfs</code> bądź dodać opcję <code>-O 2</code> podczas normalnego procesu tworzenia partycji. Wykorzystując opcję <code>Custom Newfs</code> musimy pamiętać by dodać flagę <code>-U</code> (SoftUpdates)!</p></div></td></tr></tbody></table></div><div id=sysinstall-label-add class=imageblock><div class=content><img src=../../../../images/books/handbook/install/disklabel-root1.png alt="disklabel root1"></div><div class=title>Rysunek 17. Wolne miejsce dla głównej partycji</div></div><div class=paragraph><p>Wybierając domyślnie zaproponowany rozmiar utworzymy partycję obejmującą pozostałe miejsce w segmencie. Jeżeli zamierzamy stworzyć partycje o takich rozmiarach, jak wcześniej opisywaliśmy, wówczas kasujemy zaproponowaną wartość klawiszem <kbd>Backspace</kbd>, i wpisujemy 64M, <a href=#sysinstall-label-add2>Zmiana rozmiaru głównej partycji</a>. Następnie wybieramy <b class=button>OK</b>.</p></div><div id=sysinstall-label-add2 class=imageblock><div class=content><img src=../../../../images/books/handbook/install/disklabel-root2.png alt="disklabel root2"></div><div class=title>Rysunek 18. Zmiana rozmiaru głównej partycji</div></div><div class=paragraph><p>Po wybraniu rozmiaru partycji pojawi się pytanie, czy partycja zawierać będzie system plików, czy przestrzeń wymiany. Okienko z tym pytaniem pokazane jest na <a href=#sysinstall-label-type>Wybór typu głównej partycji</a>. Pierwsza partycja zawierać będzie system plików, wybieramy więc <span class=guimenuitem>FS</span> i naciskamy <kbd>Enter</kbd>.</p></div><div id=sysinstall-label-type class=imageblock><div class=content><img src=../../../../images/books/handbook/install/disklabel-fs.png alt="disklabel fs"></div><div class=title>Rysunek 19. Wybór typu głównej partycji</div></div><div class=paragraph><p>Ponieważ na partycji znajdować się będzie system plików, Disklabel musi wiedzieć, gdzie będzie on zamontowany. <a href=#sysinstall-label-mount>Wybór miejsca montowania głównego systemu plików</a> przedstawia okienko z prośbą o podanie tej informacji. Główny system plików montowany jest jako <span class=filename>/</span>, wpisujemy więc <span class=filename>/</span> i wciskamy <kbd>Enter</kbd>.</p></div><div id=sysinstall-label-mount class=imageblock><div class=content><img src=../../../../images/books/handbook/install/disklabel-root3.png alt="disklabel root3"></div><div class=title>Rysunek 20. Wybór miejsca montowania głównego systemu plików</div></div><div class=paragraph><p>Na ekranie pojawi się informacja o nowo utworzonej partycji. Powinniśmy teraz powtórzyć całą procedurę dla kolejnych partycji. Tworząc partycję wymiany nie będziemy pytani o miejsce jej zamontowania, ponieważ partycje wymiany nie są montowane. Gdy będziemy tworzyć ostatnią partycję, <span class=filename>/usr</span>, możemy przyjąć proponowany rozmiar domyślny, aby przeznaczyć na tę partycję resztę segmentu.</p></div><div class=paragraph><p>Ostatecznie ekran edytora Disklabel będzie wyglądać podobnie do <a href=#sysinstall-label4>Edytor Disklabel</a>, choć wybrane przez nas wartości mogą być inne. By zakończyć pracę z Disklabel, wciskamy <kbd>Q</kbd>.</p></div><div id=sysinstall-label4 class=imageblock><div class=content><img src=../../../../images/books/handbook/install/disklabel-ed2.png alt="disklabel ed2"></div><div class=title>Rysunek 21. Edytor Disklabel</div></div></div></div><div class=sect2><h3 id=install-choosing>2.6. Wybór składników instalacji<a class=anchor href=#install-choosing></a></h3><div class=sect3><h4 id=distset>2.6.1. Wybór zestawu komponentów<a class=anchor href=#distset></a></h4><div class=paragraph><p>Decyzja o tym, jaki zestaw komponentów zainstalujemy, zależy w dużej mierze od planowanych zastosowań systemu i ilości wolnego miejsca na dysku. Dostępne warianty pozwalają zarówno na instalację najmniejszej konfiguracji, jak i na instalację wszystkiego. Początkujący użytkownicy systemów UNIX® i FreeBSD powinni wybrać jeden z przygotowanych wariantów. Dla bardziej doświadczonych użytkowników istnieje możliwość ułożenia własnego zestawu komponentów.</p></div><div class=paragraph><p>Więcej informacji o zestawach komponentów i ich zawartości możemy uzyskać naciskając <kbd>F1</kbd>. Po przejrzeniu tych informacji naciskamy <kbd>Enter</kbd>, aby powrócić do menu wyboru komponentów.</p></div><div class=paragraph><p>Jeśli planujemy korzystać z graficznego interfejsu użytkownika powinniśmy wybrać jeden z zestawów o nazwie rozpoczynającej się literą <code>X</code>. Po instalacji zajmiemy się konfigurowaniem serwera graficznego i wyborem menedżera okien. Szczegółowe informacje na ten temat zawiera rozdział <a href=./#x11>System okien X</a>.</p></div><div class=paragraph><p>To, która wersja systemu X11 jest domyślnie instalowana, zależy od instalowanej wersji FreeBSD. Wydania wcześniejsze od 5.3 domyślnie instalują XFree86™ 4.X. Natomiast FreeBSD 5.3 i późniejsze instalują Xorg.</p></div><div class=paragraph><p>Jeżeli planujemy samodzielne kompilowanie jądra, powinniśmy wybrać wariant zawierający kod źródłowy. <a href=./#kernelconfig>Konfiguracja jądra FreeBSD</a> zawiera informacje, dlaczego powinno się budować niestandardowe jądro i jak to zrobić.</p></div><div class=paragraph><p>Oczywiście najbardziej wszechstronny jest system zawierający wszystkie komponenty. Jeśli mamy wystarczająco dużo miejsca na dysku, wybieramy klawiszami kursora <span class=guimenuitem>All</span>, <a href=#distribution-set1>Wybór komponentów</a>, i naciskamy <kbd>Enter</kbd>. Jeżeli jednak miejsca na dysku mogłoby nie wystarczyć, wybierzmy wariant najlepiej odpowiadający obecnym potrzebom. Kolejne komponenty mogą być dodawane po zainstalowaniu systemu.</p></div><div id=distribution-set1 class=imageblock><div class=content><img src=../../../../images/books/handbook/install/dist-set.png alt="dist set"></div><div class=title>Rysunek 22. Wybór komponentów</div></div></div><div class=sect3><h4 id=portscol>2.6.2. Instalacja kolekcji portów<a class=anchor href=#portscol></a></h4><div class=paragraph><p>Po wyborze komponentów będziemy mieć możliwość zainstalowania kolekcji portów FreeBSD. Kolekcja portów umożliwia łatwe i wygodne instalowanie oprogramowania. Nie zawiera ona kodów źródłowych programów. W skład kolekcji portów wchodzą pliki umożliwiające automatyczne pobieranie programów, oraz ich kompilowanie i instalowanie. <a href=./#ports>Instalacja programów. pakiety i porty</a> opisuje sposób korzystanie z kolekcji portów.</p></div><div class=paragraph><p>Program instalacyjny nie sprawdza, czy mamy odpowiednio dużo wolnego miejsca na dysku. Kolekcję portów powinniśmy instalować tylko pod warunkiem, że miejsca faktycznie wystarczy. We FreeBSD 12.0 kolekcja zajmuje około 3 GB.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>                         User Confirmation Requested
 Would you like to <span class=nb>install </span>the FreeBSD ports collection?

 This will give you ready access to over 24,000 ported software packages,
 at a cost of around 500 MB of disk space when <span class=s2>&#34;clean&#34;</span> and possibly much
 more than that <span class=k>if </span>a lot of the distribution tarballs are loaded
 <span class=o>(</span>unless you have the extra CDs from a FreeBSD CD/DVD distribution
 available and can mount it on /cdrom, <span class=k>in </span>which <span class=k>case</span> this is far less
 of a problem<span class=p>)</span><span class=nb>.</span>

 The Ports Collection is a very valuable resource and well worth having
 on your /usr partition, so it is advisable to say Yes to this option.

 For more information on the Ports Collection &amp; the latest ports,
 visit:
     http://www.FreeBSD.org/ports

                              <span class=o>[</span> Yes <span class=o>]</span>     No</code></pre></div></div><div class=paragraph><p>Klawiszami kursora wybieramy <b class=button>yes</b>, aby zainstalować kolekcję portów, lub <b class=button>no</b>, by z niej zrezygnować. Wybór zatwierdzamy klawiszem <kbd>Enter</kbd>. Ponownie pojawi się menu wyboru komponentów.</p></div><div id=distribution-set2 class=imageblock><div class=content><img src=../../../../images/books/handbook/install/dist-set2.png alt="dist set2"></div><div class=title>Rysunek 23. Zatwierdzenie wybranych komponentów</div></div><div class=paragraph><p>Jeżeli odpowiadają nam wybrane komponenty, przy pomocy klawiszy kursora wybieramy <span class=guimenuitem>Exit</span>, zaznaczamy <b class=button>OK</b> i naciskamy <kbd>Enter</kbd>, przechodząc do kolejnego etapu instalacji.</p></div></div></div><div class=sect2><h3 id=install-media>2.7. Wybór nośnika instalacji<a class=anchor href=#install-media></a></h3><div class=paragraph><p>W przypadku, gdy instalujemy z płyty CD bądź DVD, klawiszami kursora wybieramy pozycję <span class=guimenuitem>Install from a FreeBSD CD/DVD</span> (instalacja z CD/DVD). Upewniwszy się, że zaznaczone jest <b class=button>OK</b>, naciskamy <kbd>Enter</kbd> przechodząc do następnego etapu instalacji.</p></div><div class=paragraph><p>Jeżeli stosujemy inną metodę instalacji, wybieramy odpowiednią pozycję i postępujemy zgodnie ze wskazówkami.</p></div><div class=paragraph><p>Klawiszem <kbd>F1</kbd> możemy włączyć pomoc. Do menu wyboru nośnika powracamy naciskając <kbd>Enter</kbd>.</p></div><div id=choose-media class=imageblock><div class=content><img src=../../../../images/books/handbook/install/media.png alt=media></div><div class=title>Rysunek 24. Wybór nośnika instalacji</div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=title>Tryby instalacji przez FTP</div><div class=paragraph><p>Można wybrać jeden z trzech trybów instalacji przez FTP: aktywne FTP, pasywne FTP lub pośrednio przez HTTP proxy.</p></div><div class=dlist><dl><dt class=hdlist1>Aktywne FTP: <span class=guimenuitem>Install from an FTP server</span></dt><dd><p>Wybór tego wariantu spowoduje, że przesyłanie danych przez FTP odbywać się będzie w trybie "aktywnym". Nie zadziała to w przypadku transmisji przez zaporę ogniową, ale będzie współpracować ze starszymi serwerami FTP nie obsługującymi trybu pasywnego. Jeśli połączenie pasywne (wybierane domyślnie) nie zadziała, spróbujmy aktywnego!</p></dd><dt class=hdlist1>Pasywne FTP: <span class=guimenuitem>Install from an FTP server through a firewall</span></dt><dd><p>Opcja ta informuje sysinstall, że przesyłanie danych przez FTP odbywać się będzie w trybie "pasywnym". Pozwoli to na połączenie poprzez zaporę ogniową, która nie zezwala na połączenia z zewnątrz z portami o przypadkowych numerach.</p></dd><dt class=hdlist1>FTP przez proxy HTTP: <span class=guimenuitem>Install from an FTP server through a http proxy</span></dt><dd><p>Ten wariant instruuje sysinstall do wykorzystania protokołu HTTP (podobnie jak przeglądarka stron WWW) do połączenia się z serwerem proxy pośredniczącym w transmisji przez FTP. Serwer pośredniczący przetwarza żądania i przesyła je do serwera FTP. Dzięki temu możliwe jest połączenie poprzez zaporę ogniową nie zezwalającą na żadne połączenia FTP, oferującą jednak HTTP proxy. W takiej sytuacji, poza adresem serwera FTP, będziemy musieli podać także adres serwera proxy.</p></dd></dl></div><div class=paragraph><p>Korzystając z pośredniczącego serwera FTP proxy, zwykle podajemy nazwę serwera docelowego jako część nazwy użytkownika, po znaku "@". Serwer proxy "udaje" wówczas serwer docelowy. Załóżmy, dla przykładu, że chcemy zainstalować system z <code>ftp.FreeBSD.org</code>, za pośrednictwem serwera proxy FTP <code>foo.example.com</code>, nasłuchującego na porcie 1024.</p></div><div class=paragraph><p>W takiej sytuacji przechodzimy do menu opcji, jako nazwę użytkownika FTP wpisujemy <code>ftp@ftp.FreeBSD.org</code>, a jako hasło podajemy nasz adres email. Jako nośnik instalacji wybieramy FTP (lub pasywne FTP, jeżeli umożliwia to serwer proxy), a jako URL wpisujemy <code><a href=ftp://foo.example.com:1234/pub/FreeBSD class=bare>ftp://foo.example.com:1234/pub/FreeBSD</a></code>.</p></div><div class=paragraph><p>Ze względu na to, że <span class=filename>/pub/FreeBSD</span> z <code>ftp.FreeBSD.org</code> jest udostępnione na serwerze proxy <code>foo.example.com</code>, możemy właśnie z <em>tego</em> serwera dokonać instalacji (ponieważ zajmie się on pobraniem odpowiednich plików z <code>ftp.FreeBSD.org</code>).</p></div></td></tr></tbody></table></div></div><div class=sect2><h3 id=install-final-warning>2.8. Przystąpienie do instalacji<a class=anchor href=#install-final-warning></a></h3><div class=paragraph><p>Możemy teraz rozpocząć właściwą instalację, a zarazem mamy ostatnią szansę na rezygnację z instalacji bez zmiany zawartości dysku twardego.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>                       User Confirmation Requested
 Last Chance! Are you SURE you want to <span class=k>continue </span>the installation?

 If you<span class=s1>&#39;re running this on a disk with data you wish to save then WE
 STRONGLY ENCOURAGE YOU TO MAKE PROPER BACKUPS before proceeding!

 We can take no responsibility for lost disk contents!

                             [ Yes ]    No</span></code></pre></div></div><div class=paragraph><p>Wybieramy <b class=button>yes</b> i wciskamy <kbd>Enter</kbd>, by rozpocząć instalację.</p></div><div class=paragraph><p>Czas trwania instalacji zależy od wybranych komponentów, używanego nośnika instalacji oraz prędkości komputera. Szereg komunikatów informować będzie o przebiegu procesu instalacji.</p></div><div class=paragraph><p>Po zakończeniu instalacji wyświetlony zostanie następujący komunikat:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>                               Message

Congratulations! You now have FreeBSD installed on your system.

We will now move on to the final configuration questions.
For any option you <span class=k>do </span>not wish to configure, simply <span class=k>select </span>No.

If you wish to re-enter this utility after the system is up, you may
<span class=k>do </span>so by typing: /stand/sysinstall <span class=nb>.</span>

                                 <span class=o>[</span> OK <span class=o>]</span>

                      <span class=o>[</span>  Press enter to <span class=k>continue</span>  <span class=o>]</span></code></pre></div></div><div class=paragraph><p>Po naciśnięciu klawisza <kbd>Enter</kbd> zajmiemy się przygotowaniem wstępnej konfiguracji systemu.</p></div><div class=paragraph><p>Jeśli wybierzemy <b class=button>no</b> i naciśniemy <kbd>Enter</kbd> instalacja zostanie przerwana, bez dokonywania jakichkolwiek zmian. Pojawi się komunikat o treści:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>                                Message
Installation <span class=nb>complete </span>with some errors.  You may wish to scroll
through the debugging messages on VTY1 with the scroll-lock feature.
You can also choose <span class=s2>&#34;No&#34;</span> at the next prompt and go back into the
installation menus to retry whichever operations have failed.

                                 <span class=o>[</span> OK <span class=o>]</span></code></pre></div></div><div class=paragraph><p>Powyższy komunikat pojawia się, ponieważ nic nie zostało zainstalowane. Naciskając <kbd>Enter</kbd> możemy powrócić do głównego menu i opuścić program instalacyjny.</p></div></div><div class=sect2><h3 id=install-post>2.9. Po instalacji<a class=anchor href=#install-post></a></h3><div class=paragraph><p>Po pomyślnie zakończonej instalacji zajmiemy się wstępną konfiguracją systemu. Wszelkich zmian w ustawieniach możemy dokonać przed uruchomieniem nowo zainstalowanego systemu FreeBSD lub też po zakończeniu instalacji, korzystając z <code>sysinstall</code> (we FreeBSD starszych niż 5.2 <code>/stand/sysinstall</code>) i jego opcji <span class=guimenuitem>Configure</span>.</p></div><div class=sect3><h4 id=inst-network-dev>2.9.1. Konfiguracja urządzeń sieciowych<a class=anchor href=#inst-network-dev></a></h4><div class=paragraph><p>Jeśli wcześniej skonfigurowaliśmy PPP na potrzeby instalacji przez FTP, konfiguracja urządzeń sieciowych zostanie pominięta. Będziemy mogli zająć się nią później.</p></div><div class=paragraph><p>Szczegółowe informacje na temat sieci lokalnych (LAN) oraz konfiguracji FreeBSD w roli bramy lub rutera znaleźć można w rozdziale <a href=./#advanced-networking>Zaawansowana konfiguracja sieciowa</a>.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>                      User Confirmation Requested
   Would you like to configure any Ethernet or SLIP/PPP network devices?

                             <span class=o>[</span> Yes <span class=o>]</span>   No</code></pre></div></div><div class=paragraph><p>Jeśli chcemy skonfigurować urządzenie sieciowe, wybieramy <b class=button>yes</b> i wciskamy <kbd>Enter</kbd>. W przeciwnym wypadku wybieramy <b class=button>no</b>.</p></div><div id=ed-config1 class=imageblock><div class=content><img src=../../../../images/books/handbook/install/ed0-conf.png alt="ed0 conf"></div><div class=title>Rysunek 25. Wybór karty Ethernet</div></div><div class=paragraph><p>Klawiszami kursora wybieramy interfejs, który będziemy konfigurować i wciskamy <kbd>Enter</kbd>.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>                      User Confirmation Requested
       Do you want to try IPv6 configuration of the interface?

                              Yes   <span class=o>[</span> No <span class=o>]</span></code></pre></div></div><div class=paragraph><p>Dla przykładu, w sieci lokalnej w zupełności wystarcza obecny protokół Internetu (IPv4), wybieramy więc klawiszami kursora <b class=button>no</b> i naciskamy <kbd>Enter</kbd>.</p></div><div class=paragraph><p>Jeśli chcemy wypróbować nowy protokół Internetu (IPv6), wybieramy <b class=button>yes</b> i naciskamy <kbd>Enter</kbd>. Przez chwilę będzie się odbywać poszukiwanie serwerów RA.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>                             User Confirmation Requested
        Do you want to try DHCP configuration of the interface?

                              Yes   <span class=o>[</span> No <span class=o>]</span></code></pre></div></div><div class=paragraph><p>Jeżeli nie wykorzystujemy DHCP (Dynamic Host Configuration Protocol), wybieramy klawiszami kursora <b class=button>no</b> i wciskamy <kbd>Enter</kbd>.</p></div><div class=paragraph><p>Wybranie <b class=button>yes</b> spowoduje uruchomienie dhclient i jeśli wszystko przebiegnie prawidłowo, konfiguracja sieci zostanie rozpoznana automatycznie. <a href=./#network-dhcp>Automatic Network Configuration (DHCP)</a> zawiera szczegółowe informacje na ten temat.</p></div><div class=paragraph><p>Przedstawiony poniżej ekran konfiguracji sieci (Network Configuration) przedstawia konfigurację karty sieciowej komputera, który będzie służył jako brama w sieci lokalnej.</p></div><div id=ed-config2 class=imageblock><div class=content><img src=../../../../images/books/handbook/install/ed0-conf2.png alt="ed0 conf2"></div><div class=title>Rysunek 26. Konfiguracja interfejsu ed0</div></div><div class=paragraph><p>Klawiszem <kbd>Tab</kbd> wybieramy poszczególne pola, w których wpisujemy odpowiednie informacje:</p></div><div class=dlist><dl><dt class=hdlist1>Host (stacja)</dt><dd><p>Pełna nazwa stacji, w powyższym przykładzie <code>k6-2.example.com</code>.</p></dd><dt class=hdlist1>Domain (domena)</dt><dd><p>Nazwa domeny, do której należy stacja, w przykładzie jest to <code>example.com</code>.</p></dd><dt class=hdlist1>IPv4 Gateway (brama IPv4)</dt><dd><p>Adres IP stacji przekazującej pakiety do odbiorców spoza sieci lokalnej. Musi być podany, jeśli komputer jest węzłem w sieci. Jeżeli komputer pełni rolę bramy do Internetu w sieci lokalnej, pole to należy <em>pozostawić puste</em>.</p></dd><dt class=hdlist1>Name server (serwer nazw)</dt><dd><p>Adres IP lokalnego serwera DNS. W przykładowej sieci lokalnej nie ma serwera DNS, wpisany więc został adres serwera DNS dostawcy Internetu (<code>208.163.10.2</code>).</p></dd><dt class=hdlist1>IPv4 address (adres IPv4)</dt><dd><p>W przykładzie temu interfejsowi przypisano adres <code>192.168.0.1</code>.</p></dd><dt class=hdlist1>Netmask (maska podsieci)</dt><dd><p>W sieci lokalnej użyty został dla przykładu blok adresów klasy C (<code>192.168.0.0</code> - <code>192.168.0.255</code>). Maska podsieci jest maską sieci klasy C (<code>255.255.255.0</code>).</p></dd><dt class=hdlist1>Extra options to ifconfig (dodatkowe opcje dla ifconfig)</dt><dd><p>Tu wpisywane są dodatkowe opcje dla <code>ifconfig</code> charakterystyczne dla interfejsu. W pokazanym przykładzie nie było takowych opcji.</p></dd></dl></div><div class=paragraph><p>Gdy konfiguracja będzie gotowa, klawiszem <kbd>Tab</kbd> wybieramy <b class=button>OK</b> i naciskamy <kbd>Enter</kbd>.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>                      User Confirmation Requested
        Would you like to Bring Up the ed0 interface right now?

                             <span class=o>[</span> Yes <span class=o>]</span>   No</code></pre></div></div><div class=paragraph><p>Jeśli wybierzemy <b class=button>yes</b> i wciśniemy <kbd>Enter</kbd>, komputer zostanie aktywowany do pracy w sieci.</p></div></div><div class=sect3><h4 id=gateway>2.9.2. Konfiguracja bramy<a class=anchor href=#gateway></a></h4><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>                       User Confirmation Requested
       Do you want this machine to <span class=k>function </span>as a network gateway?

                              <span class=o>[</span> Yes <span class=o>]</span>    No</code></pre></div></div><div class=paragraph><p>Jeśli komputer będzie w sieci lokalnej pełnić rolę bramy, czyli będzie przekazywać pakiety pomiędzy innymi komputerami, wybieramy opcję <b class=button>yes</b> i naciskamy <kbd>Enter</kbd>. Jeżeli natomiast komputer będzie węzłem w sieci, wybieramy <b class=button>no</b> i również wciskamy <kbd>Enter</kbd>.</p></div></div><div class=sect3><h4 id=inetd-services>2.9.3. Konfiguracja usług internetowych<a class=anchor href=#inetd-services></a></h4><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>                      User Confirmation Requested
Do you want to configure inetd and the network services that it provides?

                               Yes   <span class=o>[</span> No <span class=o>]</span></code></pre></div></div><div class=paragraph><p>Wybranie <b class=button>no</b> spowoduje, że wiele usług (jak np. telnetd) będą wyłączone. Oznacza to, że zdalni użytkownicy nie będą mogli połączyć się z naszym komputerem za pomocą telnetu. Użytkownicy lokalni będą natomiast mogli łączyć się z odległymi komputerami korzystając z telnetu.</p></div><div class=paragraph><p>Usługi możemy włączyć po zainstalowaniu systemu, aby to zrobić, modyfikujemy plik <span class=filename>/etc/inetd.conf</span> za pomocą edytora tekstu. Więcej informacji znaleźć można w Sekcji 25.2.1. <a href=./#network-inetd-overview>Overview</a>.</p></div><div class=paragraph><p>Jeśli wolelibyśmy skonfigurować usługi internetowe podczas instalacji, wybieramy <b class=button>yes</b>. Zostaniemy poproszeni o dodatkowe potwierdzenie:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>                      User Confirmation Requested
The Internet Super Server <span class=o>(</span>inetd<span class=o>)</span> allows a number of simple Internet
services to be enabled, including finger, ftp and telnetd.  Enabling
these services may increase risk of security problems by increasing
the exposure of your system.

With this <span class=k>in </span>mind, <span class=k>do </span>you wish to <span class=nb>enable </span>inetd?

                             <span class=o>[</span> Yes <span class=o>]</span>   No</code></pre></div></div><div class=paragraph><p>Wybieramy <b class=button>yes</b>, by przejść dalej.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>                      User Confirmation Requested
inetd<span class=o>(</span>8<span class=o>)</span> relies on its configuration file, /etc/inetd.conf, to determine
which of its Internet services will be available.  The default FreeBSD
inetd.conf<span class=o>(</span>5<span class=o>)</span> leaves all services disabled by default, so they must be
specifically enabled <span class=k>in </span>the configuration file before they will
<span class=k>function</span>, even once inetd<span class=o>(</span>8<span class=o>)</span> is enabled.  Note that services <span class=k>for
</span>IPv6 must be separately enabled from IPv4 services.

Select <span class=o>[</span>Yes] now to invoke an editor on /etc/inetd.conf, or <span class=o>[</span>No] to
use the current settings.

                             <span class=o>[</span> Yes <span class=o>]</span>   No</code></pre></div></div><div class=paragraph><p>Wybranie <b class=button>yes</b> pozwoli na włączanie poszczególnych usług poprzez usunięcie znaku <code>#</code> na początku właściwego wiersza.</p></div><div id=inetd-edit class=imageblock><div class=content><img src=../../../../images/books/handbook/install/edit-inetd-conf.png alt="edit inetd conf"></div><div class=title>Rysunek 27. Modyfikacja <span class=filename>inetd.conf</span></div></div><div class=paragraph><p>Gdy włączymy wybrane usługi, naciskamy <kbd>Esc</kbd> by przejść do menu, w którym będziemy mogli zakończyć modyfikowanie pliku i zapisać zmiany.</p></div></div><div class=sect3><h4 id=ftpanon>2.9.4. Anonimowe FTP<a class=anchor href=#ftpanon></a></h4><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>                      User Confirmation Requested
 Do you want to have anonymous FTP access to this machine?

                              Yes    <span class=o>[</span> No <span class=o>]</span></code></pre></div></div><div class=sect4><h5 id=deny-anon>2.9.4.1. Wyłączenie anonimowego FTP<a class=anchor href=#deny-anon></a></h5><div class=paragraph><p>Wybranie zaznaczonego domyślnie <b class=button>no</b> pozwoli na dostęp do komputera poprzez FTP tylko tym użytkownikom, którzy mają własne konta chronione hasłem.</p></div></div><div class=sect4><h5 id=ftpallow>2.9.4.2. Włączenie anonimowego FTP<a class=anchor href=#ftpallow></a></h5><div class=paragraph><p>Włączenie anonimowego FTP oznacza, że każdy będzie mógł uzyskać dostęp do komputera. Zanim się na to zdecydujemy, powinniśmy być świadomi niebezpieczeństwa, które się z tym wiąże. <a href=./#security>Security</a> zawiera więcej informacji na temat bezpieczeństwa.</p></div><div class=paragraph><p>Aby włączyć anonimowe FTP, klawiszami kursora wybieramy <b class=button>yes</b> i naciskamy <kbd>Enter</kbd>. Ekran będzie wyglądać jak na poniższym rysunku (lub podobnie):</p></div><div id=anon-ftp2 class=imageblock><div class=content><img src=../../../../images/books/handbook/install/ftp-anon1.png alt="ftp anon1"></div><div class=title>Rysunek 28. Domyślne ustawienia anonimowego FTP</div></div><div class=paragraph><p>Możemy nacisnąć <kbd>F1</kbd>, by uzyskać pomoc:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>This screen allows you to configure the anonymous FTP user.

The following configuration values are editable:

UID:     The user ID you wish to assign to the anonymous FTP user.
         All files uploaded will be owned by this ID.

Group:   Which group you wish the anonymous FTP user to be <span class=k>in</span><span class=nb>.</span>

Comment: String describing this user <span class=k>in</span> /etc/passwd

FTP Root Directory:

        Where files available <span class=k>for </span>anonymous FTP will be kept.

Upload subdirectory:

        Where files uploaded by anonymous FTP <span class=nb>users </span>will go.</code></pre></div></div><div class=paragraph><p>Główny katalog ftp jest domyślnie umieszczany w <span class=filename>/var</span>. Jeżeli nie mamy tam wystarczająco dużo miejsca dla przewidywanych potrzeb FTP, możemy wybrać w zamian katalog <span class=filename>/usr</span>, jako główny katalog FTP (FTP Root Directory) wpisując <span class=filename>/usr/ftp</span>.</p></div><div class=paragraph><p>Po wybraniu odpowiadających nam ustawień naciskamy <kbd>Enter</kbd>.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>                          User Confirmation Requested
         Create a welcome message file <span class=k>for </span>anonymous FTP <span class=nb>users</span>?

                              <span class=o>[</span> Yes <span class=o>]</span>    No</code></pre></div></div><div class=paragraph><p>Jeżeli wybierzemy <b class=button>yes</b> i wciśniemy <kbd>Enter</kbd>, automatycznie zostanie uruchomiony edytor, w którym będziemy mogli napisać komunikat powitalny dla użytkowników anonimowego FTP.</p></div><div id=anon-ftp4 class=imageblock><div class=content><img src=../../../../images/books/handbook/install/ftp-anon2.png alt="ftp anon2"></div><div class=title>Rysunek 29. Edycja komunikatu powitalnego FTP</div></div><div class=paragraph><p>Używanym tutaj edytorem tekstu jest <code>ee</code>. Postępując zgodnie z przedstawionymi na ekranie wskazówkami możemy wprowadzić treść komunikatu, lub też możemy zrobić to później, korzystając z dowolnego edytora. W tym celu warto jest zapisać nazwę i lokalizację pliku pokazywaną na dole ekranu.</p></div><div class=paragraph><p>Gdy naciśniemy <kbd>Esc</kbd> pokazane zostanie menu z domyślnie zaznaczoną opcją <span class=guimenuitem>a) leave editor</span>. (opuszczenie edytora). Wybieramy ją naciskając <kbd>Enter</kbd>. Ponowne naciśnięcie <kbd>Enter</kbd> spowoduje zapisanie zmian jeśli jakichś dokonaliśmy.</p></div></div></div><div class=sect3><h4 id=nfsconf>2.9.5. Konfiguracja sieciowych usług plikowych<a class=anchor href=#nfsconf></a></h4><div class=paragraph><p>Sieciowe usługi plikowe (Network File Services - NFS) pozwalają na współdzielony dostęp do plików przez sieć. Komputer możemy skonfigurować jako serwer, klient, lub oba naraz. Więcej informacji na ten temat można znaleźć w <a href=./#network-nfs>Network File System (NFS)</a>.</p></div><div class=sect4><h5 id=nsf-server-options>2.9.5.1. Serwer NFS<a class=anchor href=#nsf-server-options></a></h5><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>                       User Confirmation Requested
 Do you want to configure this machine as an NFS server?

                              Yes    <span class=o>[</span> No <span class=o>]</span></code></pre></div></div><div class=paragraph><p>Jeśli nie zamierzamy korzystać z serwera NFS, wybieramy <b class=button>no</b> i wciskamy <kbd>Enter</kbd>.</p></div><div class=paragraph><p>W przeciwnym wypadku, gdy wybierzemy <b class=button>yes</b>, zostanie pokazany komunikat o konieczności stworzenia pliku <span class=filename>exports</span>.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>                               Message
Operating as an NFS server means that you must first configure an
/etc/exports file to indicate which hosts are allowed certain kinds of
access to your <span class=nb>local </span>filesystems.
Press <span class=o>[</span>Enter] now to invoke an editor on /etc/exports
                               <span class=o>[</span> OK <span class=o>]</span></code></pre></div></div><div class=paragraph><p>Naciskamy <kbd>Enter</kbd>. Zostanie uruchomiony edytor tekstu, w którym będziemy mogli przygotować plik <span class=filename>exports</span>.</p></div><div id=nfs-server-edit class=imageblock><div class=content><img src=../../../../images/books/handbook/install/nfs-server-edit.png alt="nfs server edit"></div><div class=title>Rysunek 30. Edycja pliku <span class=filename>exports</span></div></div><div class=paragraph><p>Zgodnie ze wskazówkami dopisujemy udostępniane systemy plików. Możemy także zrobić to później, korzystając z preferowanego przez nas edytora tekstu. W tym celu warto zapisać sobie pokazywaną na dole ekranu nazwę i lokalizację pliku.</p></div><div class=paragraph><p>Gdy naciśniemy <kbd>Esc</kbd>, pokazane zostanie menu z domyślnie zaznaczoną opcją <span class=guimenuitem>a) leave editor</span> (opuszczenie edytora). Wybieramy ją naciskając <kbd>Enter</kbd>.</p></div></div><div class=sect4><h5 id=nfs-client-options>2.9.5.2. Klient NFS<a class=anchor href=#nfs-client-options></a></h5><div class=paragraph><p>Instalacja klienta NFS pozwoli naszemu komputerowi łączyć się z serwerami NFS.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>                       User Confirmation Requested
 Do you want to configure this machine as an NFS client?

                              Yes   <span class=o>[</span> No <span class=o>]</span></code></pre></div></div><div class=paragraph><p>Wybieramy klawiszami kursora <b class=button>yes</b> lub <b class=button>no</b> zależenie od podjętej decyzji, po czym naciskamy <kbd>Enter</kbd>.</p></div></div></div><div class=sect3><h4 id=securityprofile>2.9.6. Profil zabezpieczeń<a class=anchor href=#securityprofile></a></h4><div class=paragraph><p>"Profil zabezpieczeń" to zestaw opcji konfiguracyjnych, mający zapewnić określony poziom bezpieczeństwa poprzez włączenie i wyłączenie pewnych programów i ustawień. Im surowszy profil zabezpieczeń, tym mniej programów będzie domyślnie uruchamianych. Odpowiada to jednej z podstawowych zasad bezpieczeństwa: należy wyłączać wszystko, co nie musi być włączone.</p></div><div class=paragraph><p>Pamiętajmy, że profil zabezpieczeń to tylko domyślne ustawienia. Poszczególne programy można włączać i wyłączać już po zainstalowaniu FreeBSD, poprzez modyfikację lub dodanie odpowiednich wpisów w pliku <span class=filename>/etc/rc.conf</span>. Dalsze informacje na ten temat znaleźć można w dokumentacji systemowej <a href="https://man.freebsd.org/cgi/man.cgi?query=rc.conf&amp;sektion=5&amp;format=html">rc.conf(5)</a>.</p></div><div class=paragraph><p>Poniższa tabela pokazuje, jaki jest efekt stosowania każdego z profili zabezpieczeń. Kolumny odpowiadają profilom, które można wybrać, natomiast w kolejnych wierszach wymienione są poszczególne programy lub funkcje włączone lub wyłączone w danym profilu.</p></div><table class="tableblock frame-all grid-all stretch"><caption class=title>Tabela 4. Dostępne profile zabezpieczeń</caption><col style=width:33.3333%><col style=width:33.3333%><col style=width:33.3334%><thead><tr><th class="tableblock halign-left valign-top"></th><th class="tableblock halign-left valign-top">Extreme</th><th class="tableblock halign-left valign-top">Medium</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href="https://man.freebsd.org/cgi/man.cgi?query=sendmail&amp;sektion=8&amp;format=html">sendmail(8)</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>NIE</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>TAK</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href="https://man.freebsd.org/cgi/man.cgi?query=sshd&amp;sektion=8&amp;format=html">sshd(8)</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>NIE</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>TAK</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href="https://man.freebsd.org/cgi/man.cgi?query=portmap&amp;sektion=8&amp;format=html">portmap(8)</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>NIE</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>MOŻE (Portmapper jest włączony, jeśli na wcześniejszym etapie instalacji komputer został skonfigurowany jako klient lub serwer NFS.)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>serwer NFS</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>NIE</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>TAK</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href="https://man.freebsd.org/cgi/man.cgi?query=securelevel&amp;sektion=8&amp;format=html">securelevel(8)</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>TAK (Wybierając profil zabezpieczeń, który powoduje ustawienie securelevel na "Extreme" lub "High", powinniśmy pamiętać o konsekwencjach. Warto przeczytać dokumentację systemową <a href="https://man.freebsd.org/cgi/man.cgi?query=init&amp;sektion=8&amp;format=html">init(8)</a> i zwrócić szczególną uwagę na znaczenie poziomów bezpieczeństwa, by uniknąć późniejszych kłopotów!)</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>NIE</p></td></tr></tbody></table><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>                       User Confirmation Requested
 Do you want to <span class=k>select </span>a default security profile <span class=k>for </span>this host <span class=o>(</span><span class=k>select
 </span>No <span class=k>for</span> <span class=s2>&#34;medium&#34;</span> security<span class=o>)</span>?

                            <span class=o>[</span> Yes <span class=o>]</span>    No</code></pre></div></div><div class=paragraph><p>Jeżeli wybierzemy <b class=button>no</b> i naciśniemy <kbd>Enter</kbd>, zostanie ustawiony średni profil zabezpieczeń.</p></div><div class=paragraph><p>Chcąc wybrać inny profil zabezpieczeń, wybieramy <b class=button>yes</b> i wciskamy <kbd>Enter</kbd>.</p></div><div id=security-profile class=imageblock><div class=content><img src=../../../../images/books/handbook/install/security.png alt=security></div><div class=title>Rysunek 31. Opcje profilu zabezpieczeń</div></div><div class=paragraph><p>Aby uzyskać pomoc, wciskamy <kbd>F1</kbd>. Naciskając <kbd>Enter</kbd> wracamy do menu.</p></div><div class=paragraph><p>Klawiszami kursora wybieramy <span class=guimenuitem>Medium</span>, chyba, że jesteśmy pewni, że będziemy potrzebować innego poziomu bezpieczeństwa. Wskazujemy następnie <b class=button>OK</b> i wciskamy <kbd>Enter</kbd>.</p></div><div class=paragraph><p>Zostanie wyświetlony komunikat potwierdzający wybór profilu zabezpieczeń.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>                                 Message

Moderate security settings have been selected.

Sendmail and SSHd have been enabled, securelevels are
disabled, and NFS server setting have been left intact.
PLEASE NIETE that this still does not save you from having
to properly secure your system <span class=k>in </span>other ways or exercise
due diligence <span class=k>in </span>your administration, this simply picks
a standard <span class=nb>set </span>of out-of-box defaults to start with.

To change any of these settings later, edit /etc/rc.conf

                                  <span class=o>[</span>OK]</code></pre></div></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>                                 Message

Extreme security settings have been selected.

Sendmail, SSHd, and NFS services have been disabled, and
securelevels have been enabled.
PLEASE NIETE that this still does not save you from having
to properly secure your system <span class=k>in </span>other ways or exercise
due diligence <span class=k>in </span>your administration, this simply picks
a more secure <span class=nb>set </span>of out-of-box defaults to start with.

To change any of these settings later, edit /etc/rc.conf

                                  <span class=o>[</span>OK]</code></pre></div></div><div class=paragraph><p>Naciskamy <kbd>Enter</kbd>, aby przejść do kolejnego etapu konfiguracji.</p></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>Profil zabezpieczeń nie jest cudownym lekarstwem! Nawet, jeśli wybraliśmy najbardziej bezpieczny profil, musimy na bieżąco interesować się sprawami bezpieczeństwa systemu, czytając poświęcone im listy dyskusyjne (<a href=./#eresources-mail>Mailing Lists</a>),, stosując dobre hasła i przestrzegając ogólnych zasad bezpieczeństwa. Profil jest tylko wygodnym sposobem na przygotowanie podstawowych zabezpieczeń.</p></div></td></tr></tbody></table></div></div><div class=sect3><h4 id=console>2.9.7. Ustawienia konsoli systemowej<a class=anchor href=#console></a></h4><div class=paragraph><p>Kilka opcji służy do konfiguracji konsoli systemowej.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>                      User Confirmation Requested
       Would you like to customize your system console settings?

                              <span class=o>[</span> Yes <span class=o>]</span>  No</code></pre></div></div><div class=paragraph><p>Aby zobaczyć i zmienić ustawienia, wybieramy <b class=button>yes</b> i wciskamy <kbd>Enter</kbd>.</p></div><div id=saver-options class=imageblock><div class=content><img src=../../../../images/books/handbook/install/console-saver1.png alt="console saver1"></div><div class=title>Rysunek 32. Opcje konfiguracji konsoli systemowej</div></div><div class=paragraph><p>Często stosowaną opcją jest wygaszacz ekranu (screen saver). Klawiszami kursora wybieramy <span class=guimenuitem>Saver</span> i naciskamy <kbd>Enter</kbd>.</p></div><div id=saver-select class=imageblock><div class=content><img src=../../../../images/books/handbook/install/console-saver2.png alt="console saver2"></div><div class=title>Rysunek 33. Opcje wygaszacza ekranu</div></div><div class=paragraph><p>Za pomocą klawiszy kursora wybieramy odpowiadający nam wygaszacz i wciskamy <kbd>Enter</kbd>. Ponownie pojawi się menu konfiguracji konsoli systemowej.</p></div><div class=paragraph><p>Przyjmowany domyślnie przedział czasu wynosi 300 sekund. Aby go zmienić, ponownie wybieramy <span class=guimenuitem>Saver</span>. W menu opcji wygaszacza ekranu klawiszami kursora wybieramy <span class=guimenuitem>Timeout</span> i naciskamy <kbd>Enter</kbd>. Pojawi się okienko:</p></div><div id=saver-timeout class=imageblock><div class=content><img src=../../../../images/books/handbook/install/console-saver3.png alt="console saver3"></div><div class=title>Rysunek 34. Limit czasu wygaszacza ekranu</div></div><div class=paragraph><p>Wartość możemy zmienić, po czym wybieramy <b class=button>OK</b> i wciskamy <kbd>Enter</kbd>, by wrócić do menu konfiguracji konsoli.</p></div><div id=saver-exit class=imageblock><div class=content><img src=../../../../images/books/handbook/install/console-saver4.png alt="console saver4"></div><div class=title>Rysunek 35. Zakończenie konfiguracji konsoli</div></div><div class=paragraph><p>Wybieramy <span class=guimenuitem>Exit</span> i naciskamy <kbd>Enter</kbd>, przechodząc do kolejnego etapu konfiguracji.</p></div></div><div class=sect3><h4 id=timezone>2.9.8. Ustawienia strefy czasowej<a class=anchor href=#timezone></a></h4><div class=paragraph><p>Dzięki ustawieniu strefy czasowej komputer będzie mógł automatycznie ustawiać zegar w przypadku zmiany czasu, jak również będzie prawidłowo wykonywać inne czynności związane ze strefą czasową.</p></div><div class=paragraph><p>W przykładzie mamy do czynienia z komputerem znajdującym się we wschodniej strefie czasowej Stanów Zjednoczonych. Rzeczywiste ustawienia będą zależeć od naszego położenia geograficznego.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>                      User Confirmation Requested
          Would you like to <span class=nb>set </span>this machine<span class=s1>&#39;s time zone now?

                            [ Yes ]   No</span></code></pre></div></div><div class=paragraph><p>By ustawić strefę czasową, wybieramy <b class=button>yes</b> i naciskamy <kbd>Enter</kbd>.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>                       User Confirmation Requested
 Is this machine<span class=s1>&#39;s CMOS clock set to UTC? If it is set to local time
 or you don&#39;</span>t know, please choose NIE here!

                              Yes   <span class=o>[</span> No <span class=o>]</span></code></pre></div></div><div class=paragraph><p>Wybieramy <b class=button>yes</b> lub <b class=button>no</b>, w zależności od ustawienia zegara komputera, następnie wciskamy <kbd>Enter</kbd>.</p></div><div id=set-timezone-region class=imageblock><div class=content><img src=../../../../images/books/handbook/install/timezone1.png alt=timezone1></div><div class=title>Rysunek 36. Wybór regionu geograficznego</div></div><div class=paragraph><p>Klawiszami kursora wybieramy odpowiedni region, po czym naciskamy <kbd>Enter</kbd>.</p></div><div id=set-timezone-country class=imageblock><div class=content><img src=../../../../images/books/handbook/install/timezone2.png alt=timezone2></div><div class=title>Rysunek 37. Wybór kraju</div></div><div class=paragraph><p>Przy użyciu klawiszy kursora wybieramy odpowiedni kraj i naciskamy <kbd>Enter</kbd>.</p></div><div id=set-timezone-locality class=imageblock><div class=content><img src=../../../../images/books/handbook/install/timezone3.png alt=timezone3></div><div class=title>Rysunek 38. Wybór strefy czasowej</div></div><div class=paragraph><p>Klawiszami kursora wybieramy właściwą strefę czasową i wciskamy <kbd>Enter</kbd>.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>                            Confirmation
            Does the abbreviation <span class=s1>&#39;EDT&#39;</span> look reasonable?

                            <span class=o>[</span> Yes <span class=o>]</span>   No</code></pre></div></div><div class=paragraph><p>Zostaniemy zapytani, czy skrót nazwy strefy czasowej jest prawidłowy. Jeśli tak, naciskamy <kbd>Enter</kbd> i przechodzimy do kolejnego etapu konfiguracji.</p></div></div><div class=sect3><h4 id=linuxcomp>2.9.9. Kompatybilność z Linuksem<a class=anchor href=#linuxcomp></a></h4><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>                      User Confirmation Requested
          Would you like to <span class=nb>enable </span>Linux binary compatibility?

                            <span class=o>[</span> Yes <span class=o>]</span>   No</code></pre></div></div><div class=paragraph><p>Wybranie <b class=button>yes</b> i naciśnięcie <kbd>Enter</kbd> pozwoli uruchamiać programy linuksowe we FreeBSD. Program instalacyjny dołączy pakiety obsługujące kompatybilność z Linuksem.</p></div><div class=paragraph><p>Jeśli instalujemy system przez FTP, komputer będzie potrzebować łączności z Internetem. Może się zdarzyć, że na serwerze ftp będzie brakowało pewnych składników, na przykład obsługujących kompatybilność z Linuksem. Można je jednak zainstalować później.</p></div></div><div class=sect3><h4 id=mouse>2.9.10. Ustawienia myszki<a class=anchor href=#mouse></a></h4><div class=dlist><dl><dt class=hdlist1>Posługując się 3-przyciskową myszką będziemy mogli wycinać i wklejać tekst na konsoli i w uruchamianych programach. Jeśli nasza myszka ma dwa przyciski, po instalacji zajrzyjmy do dokumentacji systemowej <a href="https://man.freebsd.org/cgi/man.cgi?query=moused&amp;sektion=8&amp;format=html">moused(8)</a>, gdzie opisana została emulacja trzech przycisków. W naszym przykładzie konfigurujemy myszkę nie podłączoną przez USB (np. przez złącze PS/2 lub port COM)</dt></dl></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>                      User Confirmation Requested
         Does this system have a non-USB mouse attached to it?

                            <span class=o>[</span> Yes <span class=o>]</span>    No</code></pre></div></div><div class=paragraph><p>Wybieramy <b class=button>no</b>, jeśli myszka podłączona jest przez USB, lub <b class=button>yes</b> w przeciwnym wypadku i naciskamy <kbd>Enter</kbd>.</p></div><div id=mouse-protocol class=imageblock><div class=content><img src=../../../../images/books/handbook/install/mouse1.png alt=mouse1></div><div class=title>Rysunek 39. Opcja wyboru protokołu myszki</div></div><div class=paragraph><p>Klawiszami kursora wskazujemy <span class=guimenuitem>Type</span> i naciskamy <kbd>Enter</kbd>.</p></div><div id=set-mouse-protocol class=imageblock><div class=content><img src=../../../../images/books/handbook/install/mouse2.png alt=mouse2></div><div class=title>Rysunek 40. Wybór protokołu myszki</div></div><div class=paragraph><p>Myszka używana w przykładzie jest typu PS/2, wybrano więc domyślną opcję <span class=guimenuitem>Auto</span>. Inny protokół wybieramy wskazując odpowiednią opcję klawiszami kursora. Upewniwszy się, że <b class=button>OK</b> jest zaznaczone, naciskamy <kbd>Enter</kbd> i wracamy do poprzedniego menu.</p></div><div id=config-mouse-port class=imageblock><div class=content><img src=../../../../images/books/handbook/install/mouse3.png alt=mouse3></div><div class=title>Rysunek 41. Konfiguracja portu myszki</div></div><div class=paragraph><p>Za pomocą klawiszy kursora wybieramy <span class=guimenuitem>Port</span> i wciskamy <kbd>Enter</kbd>.</p></div><div id=set-mouse-port class=imageblock><div class=content><img src=../../../../images/books/handbook/install/mouse4.png alt=mouse4></div><div class=title>Rysunek 42. Wybór portu myszki</div></div><div class=paragraph><p>Ponieważ przykładowa myszka jest typu PS/2, zaznaczona została domyślna opcja <span class=guimenuitem>PS/2</span>. Klawiszami kursora możemy wybrać port, następnie naciskamy <kbd>Enter</kbd>.</p></div><div id=test-daemon class=imageblock><div class=content><img src=../../../../images/books/handbook/install/mouse5.png alt=mouse5></div><div class=title>Rysunek 43. Włączenie demona myszki</div></div><div class=paragraph><p>Na koniec wybieramy <span class=guimenuitem>Enable</span> i naciskamy <kbd>Enter</kbd> by włączyć demona myszki i go przetestować.</p></div><div id=test-mouse-daemon class=imageblock><div class=content><img src=../../../../images/books/handbook/install/mouse6.png alt=mouse6></div><div class=title>Rysunek 44. Testowanie demona myszki</div></div><div class=paragraph><p>Następnie musimy poruszyć myszką i sprawdzić czy kursor porusza się we właściwy sposób po ekranie. Jeśli tak to wybieramy <b class=button>yes</b> i wciskamy <kbd>Enter</kbd>. Jeśli nie myszka nie została właściwie skonfigurowana - wybieramy <b class=button>no</b> i próbujemy innych ustawień myszy.</p></div><div class=paragraph><p>Wybieramy <span class=guimenuitem>Exit</span> i wciskamy <kbd>Enter</kbd>, by zakończyć ten etap konfiguracji.</p></div></div><div class=sect3><h4 id=network-services>2.9.11. Konfiguracja dodatkowych usług sieciowych<a class=anchor href=#network-services></a></h4><div class=paragraph><p>Konfiguracja usług sieciowych może być nużącym zadaniem dla początkujących użytkowników, szczególnie jeśli brak im wiedzy w tym zakresie. Możliwość pracy w sieci - także w Internecie - jest kluczowym elementem wszystkich współczesnych systemów operacyjnych, w tym również FreeBSD. Stąd też jest bardzo pomocnym mieć pojęcie o możliwościach pracy w sieci jakie oferuje FreeBSD. Poznanie tych jego możliwości już w trakcie instalacji pozwoli użytkownikom zrozumieć różne aspekty funkcjonowania usług sieciowych.</p></div><div class=paragraph><p>Usługi sieciowe są programami potrafiącymi przyjmować dane z dowolnej lokalizacji w sieci. Dlatego właśnie dokładanych jest wiele starań, by zagwarantować, że programy te nie uczynią nic "szkodliwego". Niestety, programiści nie są doskonali. W przeszłości zdarzały się sytuacje, w których atakujący wykorzystywali błędy w oprogramowaniu by wyrządzić szkodę systemowi. Stąd też jest bardzo istotnym by włączać tylko te usługi sieciowe, które są nam potrzebne. Jeśli nie jesteśmy pewni, najlepiej jest nie włączać danej usługi nim nie dowiemy się czy rzeczywiście jej potrzebujemy. Zawsze możemy ją aktywować później uruchamiając ponownie sysinstall bądź edytując plik <span class=filename>/etc/rc.conf</span>.</p></div><div class=paragraph><p>Wybranie opcji <b class=menuref>Networking</b> spowoduje wyświetlenie menu zbliżonego do poniższego:</p></div><div id=network-configuration class=imageblock><div class=content><img src=../../../../images/books/handbook/install/net-config-menu1.png alt="net config menu1"></div><div class=title>Rysunek 45. Najwyższy poziom konfiguracji sieci</div></div><div class=paragraph><p>Pierwszą z dostępnych opcji - <span class=guimenuitem>Interfaces</span> - opisuje bliżej <a href=#inst-network-dev>Konfiguracja urządzeń sieciowych</a>, dlatego też możemy ją teraz pominąć.</p></div><div class=paragraph><p>Wybór opcji <span class=guimenuitem>AMD</span> włączy wsparcie dla narzędzia automatycznego montowania BSD (ang. Automatic Mount Utility). Opcja ta najczęściej jest wykorzystywana z protokołem NFS (patrz poniżej) do automatycznego montowania zdalnych systemów plików. Nie wymaga dodatkowej konfiguracji.</p></div><div class=paragraph><p>Kolejną opcją jest <span class=guimenuitem>AMD Flags</span>. Po jej wybraniu pojawi się menu, gdzie należy wprowadzić specyficzne flagi AMD. Menu zawiera już domyślne wartości:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=nt>-a</span> /.amd_mnt <span class=nt>-l</span> syslog /host /etc/amd.map /net /etc/amd.map</code></pre></div></div><div class=paragraph><p>Flaga <code>-a</code> określa domyślny punkt montowania, w tym wypadku <span class=filename>/.amd_mnt</span>. Flaga <code>-l</code> definiuje domyślny plik <span class=filename>log</span> dziennika systemowego; jeśli w systemie wykorzystywany jest demon <code>syslogd</code>, wówczas wszystkie komunikaty będą wysyłane właśnie do niego. Katalog <span class=filename>/host</span> jest wykorzystywany do montowania systemów plików wyeksportowanych ze zdalnej maszyny, podczas gdy katalog <span class=filename>/net</span> do montowania systemów plików z adresu IP. Plik <span class=filename>/etc/amd.map</span> zawiera domyślne wartości flag dla zasobów eksportowanych przez AMD.</p></div><div class=paragraph><p>Wybór opcji <span class=guimenuitem>Anon FTP</span> zezwala na anonimowe połączenia FTP, tym samym tworząc z naszego komputera anonimowy serwer FTP. Należy mieć jednak świadomość niebezpieczeństw jakie pociąga za sobą taka konfiguracja. Po wybraniu tej opcji pojawi się kolejne okienko wyjaśniające związane z nią niebezpieczeństwa oraz umożliwiające szczegółową konfigurację.</p></div><div class=paragraph><p>Menu <span class=guimenuitem>Gateway</span> pozwala skonfigurować naszą maszynę jako bramę, co zostało opisane wcześniej. Może być również wykorzystane do wyłączenia tej opcji jeśli przypadkowo została ona aktywowana w trakcie instalacji.</p></div><div class=paragraph><p>Opcja <span class=guimenuitem>Inetd</span> pozwala skonfigurować bądź całkowicie wyłączyć demonona <a href="https://man.freebsd.org/cgi/man.cgi?query=inetd&amp;sektion=8&amp;format=html">inetd(8)</a>, który również został opisany wcześniej.</p></div><div class=paragraph><p>Opcja <span class=guimenuitem>Mail</span> wykorzystywana jest do konfiguracji domyślnego systemowego serwera poczty MTA (ang. Mail Transfer Agent). Wybór tej opcji spowoduje wyświetlenie następującego menu:</p></div><div id=mta-selection class=imageblock><div class=content><img src=../../../../images/books/handbook/install/mta-main.png alt="mta main"></div><div class=title>Rysunek 46. Wybór domyślnego MTA</div></div><div class=paragraph><p>W menu tym mamy możliwość wyboru, który MTA zostanie zainstalowany jako domyślny. W praktyce MTA nie jest niczym więcej jak serwerem, który dostarcza pocztę elektroniczną do użytkowników lokalnego systemu bądź wysyła ją do Internetu.</p></div><div class=paragraph><p>Wybór opcji <span class=guimenuitem>Sendmail</span> spowoduje instalację popularnego serwera sendmail. Serwer ten jest domyślnym serwerem we FreeBSD. Opcja <span class=guimenuitem>Sendmail local</span> również spowoduje wybór sendmail jako domyślnego MTA, jednakże bez możliwości odbierania poczty przychodzącej z Internetu. Pozostałe opcje <span class=guimenuitem>Postfix</span> i <span class=guimenuitem>Exim</span> dają efekt analogiczny do <span class=guimenuitem>Sendmail</span> - obydwa rozwiązania dostarczają pocztę. Tym nie mniej, niektórzy użytkownicy preferują te serwery jako alternatywę dla MTAsendmail.</p></div><div class=paragraph><p>Po wybraniu MTA, bądź pominięciu tego kroku, pojawi się ponownie okno konfiguracji sieci z kolejną opcją: <span class=guimenuitem>NFS client</span>.</p></div><div class=paragraph><p>Opcja <span class=guimenuitem>NFS client</span> pozwala skonfigurować system do komunikacji z serwerem za pomocą NFS. Serwer NFS udostępnia systemy plików innym maszynom w sieci za pomocą protokołu NFS. Jeśli nasza maszyna nie będzie pracowała w sieci można tą opcję pominąć. System może później wymagać dalszej konfiguracji. <a href=./#network-nfs>Network File System (NFS)</a> zawiera szczegółowe informacje o konfiguracji klienta i serwera NFS.</p></div><div class=paragraph><p>Poniżej znajduje się opcja <span class=guimenuitem>NFS server</span> umożliwiająca skonfigurowanie systemu jako serwer NFS. Dodatkowo konfiguruje ona wymagane parametry dla usług RPC. RPC koordynuje połączenia pomiędzy maszynami i programami.</p></div><div class=paragraph><p>Kolejna opcja to <span class=guimenuitem>Ntpdate</span>, odpowiadająca za synchronizację czasu systemowego. Po wybraniu jej pojawi się następujące menu:</p></div><div id=Ntpdate-config class=imageblock><div class=content><img src=../../../../images/books/handbook/install/ntp-config.png alt="ntp config"></div><div class=title>Rysunek 47. Konfiguracja ntpdate</div></div><div class=paragraph><p>Z menu wybieramy najbliższy nam serwer. Wybór pobliskiego serwera gwarantuje dokładniejszą synchronizację czasu, z uwagi na fakt, że w komunikacji z bardziej oddalony serwerem mogą występować większe opóźnienia.</p></div><div class=paragraph><p>Kolejnym elementem jest wybór PCNFSD. Opcja ta zainstaluje <a class=package href=https://cgit.freebsd.org/ports/tree/net/pcnfsd/>net/pcnfsd</a> z Kolekcji portów. Jest to przydatne narzędzie umożliwiające uwierzytelnianie NFS systemom operacyjnym, które same nie potrafią się uwierzytelnić, jak np. MS-DOS®.</p></div><div class=paragraph><p>Przewijając w dół pojawią się kolejne opcje:</p></div><div id=Network-configuration-cont class=imageblock><div class=content><img src=../../../../images/books/handbook/install/net-config-menu2.png alt="net config menu2"></div><div class=title>Rysunek 48. Najniższy poziom konfiguracji sieci</div></div><div class=paragraph><p>Programy <a href="https://man.freebsd.org/cgi/man.cgi?query=rpcbind&amp;sektion=8&amp;format=html">rpcbind(8)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=rpc.statd&amp;sektion=8&amp;format=html">rpc.statd(8)</a> i <a href="https://man.freebsd.org/cgi/man.cgi?query=rpc.lockd&amp;sektion=8&amp;format=html">rpc.lockd(8)</a> wykorzystywane są przy połączeniach RPC (Remote Procedure Call). <code>rpcbind</code> zarządza komunikacją pomiędzy serwerem NFS i klientami, tym samym jest wymagany do poprawnego funkcjonowania serwera NFS. Demon rpc.statd wykorzystywany jest do komunikacji z innymi demonami rpc.statd w sieci, w celu monitorowania stanu maszyn, na których one pracują. Uzyskane w ten sposób informacje przechowywane są z reguły w pliku <span class=filename>/var/db/statd.status</span>. Kolejnym elementem jest <span class=guimenuitem>rpc.lockd</span>, który udostępnia usługi blokowania plików. Z reguły, wykorzystywany jest w parze z rpc.statd do śledzenia, które maszyny wymagają blokowania i jak często. O ile dwie ostatnie usługi są idealne do debugowania, nie są one wymagane do poprawnego działania serwera NFS.</p></div><div class=paragraph><p>Kolejnym elementem na liście jest demon rutowania - <span class=guimenuitem>Routed</span>. <a href="https://man.freebsd.org/cgi/man.cgi?query=routed&amp;sektion=8&amp;format=html">routed(8)</a> zarządza tablicami rutingu sieci, wyszukuje rutery multicast i udostępnia na żądanie kopię tablic rutingu każdej maszynie w sieci. Wykorzystywany jest on z reguły na komputerach pracujących jako bramy dla sieci lokalnej. Po jego wybraniu pojawi się dodatkowe menu, w którym należy określić jego domyślną lokalizację. Wartość domyślna jest zdefiniowana i zostanie wybrana po naciśnięciu klawisza <kbd>Enter</kbd>. Następnie pojawi się kolejne menu, tym razem w celu ustawienia flag. Domyślną jest <code>-q</code> i powinna pojawić się na ekranie.</p></div><div class=paragraph><p>Kolejną opcją jest <span class=guimenuitem>Rwhod</span>, której wybór włączy demona <a href="https://man.freebsd.org/cgi/man.cgi?query=rwhod&amp;sektion=8&amp;format=html">rwhod(8)</a> w trakcie uruchamiania systemu. <code>rwhod</code> jest narzędziem, które regularnie rozsyła w sieci komunikaty systemowe bądź - w trybie "konsumenta" - zbiera je. Więcej informacji dostępnych jest w podręcznikach systemowych <a href="https://man.freebsd.org/cgi/man.cgi?query=ruptime&amp;sektion=1&amp;format=html">ruptime(1)</a> i <a href="https://man.freebsd.org/cgi/man.cgi?query=rwho&amp;sektion=1&amp;format=html">rwho(1)</a>.</p></div><div class=paragraph><p>Przedostatnim elementem na liście jest demon <a href="https://man.freebsd.org/cgi/man.cgi?query=sshd&amp;sektion=8&amp;format=html">sshd(8)</a>. Jest to serwer OpenSSH, którego wykorzystanie jest zalecane w zamiast telnetu czy serwerów FTP. Serwer sshd jest wykorzystywany do zestawiania bezpiecznego połączenia pomiędzy dwoma maszynami wykorzystując połączenia szyfrowane.</p></div><div class=paragraph><p>Ostatnią na liście jest opcja Rozszerzeń TCP (<span class=guimenuitem>TCP Extensions</span>). Włączenie jej umożliwia korzystanie z rozszerzeń TCP zdefiniowanych w RFC 1323 i RFC 1644. O ile na wielu komputerach pozwoli to na przyspieszenie komunikacji, o tyle może również spowodować odrzucanie niektórych połączeń. Stosowanie tej opcji nie jest zalecane dla serwerów, chodź może się okazać korzystne dla stacji roboczych.</p></div><div class=paragraph><p>Skończywszy konfigurację usług sieciowych możemy przewinąć do samej góry ekranu, do opcji <span class=guimenuitem>Exit</span> i przejść do kolejnej części konfiguracji.</p></div></div><div class=sect3><h4 id=x-server>2.9.12. Konfiguracja serwera X<a class=anchor href=#x-server></a></h4><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Począwszy od wersji FreeBSD 5.3-RELEASE, opcje konfiguracji serwera X zostały usunięte z sysinstall. Serwer X musimy zainstalować i skonfigurować po skończonej instalacji systemu. <a href=./#x11>System okien X</a> zawiera szczegółowe informacje odnośnie instalacji i konfiguracji serwera X. Jeśli nie instalujemy wersji wcześniejszej niż FreeBSD 5.3-RELEASE, możemy pomiąć tą sekcję.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Chcąc korzystać z graficznego interfejsu użytkownika w rodzaju KDE, GNIEME lub innego, trzeba skonfigurować serwer X.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>By uruchomić XFree86™ z poziomu użytkownika innego niż <code>root</code>, należy zainstalować <a class=package href=https://cgit.freebsd.org/ports/tree/x11/wrapper/>x11/wrapper</a>. Jest on instalowany domyślnie we FreeBSD 4.7 i późniejszych. W przypadku wcześniejszych wersji można go zainstalować z menu wyboru pakietów.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Aby sprawdzić, czy nasza karta graficzna jest obsługiwana, możemy zajrzeć na stronę WWW <a href=http://www.xfree86.org/>XFree86™</a>.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>                      User Confirmation Requested
        Would you like to configure your X server at this <span class=nb>time</span>?

                            <span class=o>[</span> Yes <span class=o>]</span>   No</code></pre></div></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>Należy koniecznie znać dane techniczne monitora i karty graficznej. Nieprawidłowe ustawienia mogą spowodować uszkodzenie sprzętu. Jeśli nie dysponujemy tymi danymi, wybierzmy <b class=button>no</b> i przystąpmy do konfiguracji serwera X po zainstalowaniu systemu, gdy już zaopatrzymy się w niezbędne dane. Do tego celu możemy wykorzystać <code>sysinstall</code> (<code>/stand/sysinstall</code> we FreeBSD starszych niż 5.2), wybierając <span class=guimenuitem>Configure</span>, a następnie <span class=guimenuitem>XFree86</span>.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Jeśli mamy dane techniczne karty graficznej i monitora, wybieramy <b class=button>yes</b> i wciskamy <kbd>Enter</kbd>, rozpoczynając konfigurację serwera X.</p></div><div id=xserver2 class=imageblock><div class=content><img src=../../../../images/books/handbook/install/xf86setup.png alt=xf86setup></div><div class=title>Rysunek 49. Wybór metody konfiguracji</div></div><div class=paragraph><p>Serwer X można konfigurować na kilka sposobów. Wybieramy jedną z metod przy pomocy klawiszy kursora i naciskamy <kbd>Enter</kbd>. Pamiętajmy o uważnym czytaniu wszelkich poleceń pojawiających się na ekranie.</p></div><div class=paragraph><p>Wybór xf86cfg i xf86cfg -textmode może spowodować, że ekran stanie się ciemny, a uruchomienie może zająć kilka sekund. Bądźmy cierpliwi.</p></div><div class=paragraph><p>W poniższym przykładzie przedstawione będzie korzystanie z programu konfiguracyjnego xf86config. Wybierane przez nas opcje zależeć będą od wyposażenia naszego komputera, będą się więc zapewne różnić od opcji pokazanych w przykładzie:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>                                Message
 You have configured and been running the mouse daemon.
 Choose <span class=s2>&#34;/dev/sysmouse&#34;</span> as the mouse port and <span class=s2>&#34;SysMouse&#34;</span> or
 <span class=s2>&#34;MouseSystems&#34;</span> as the mouse protocol <span class=k>in </span>the X configuration utility.

                                 <span class=o>[</span> OK <span class=o>]</span>

                      <span class=o>[</span> Press enter to <span class=k>continue</span> <span class=o>]</span></code></pre></div></div><div class=paragraph><p>Komunikat ten informuje o wykryciu skonfigurowanego wcześniej demona myszki. Naciskamy <kbd>Enter</kbd>, by przejść dalej.</p></div><div class=paragraph><p>Po uruchomieniu, xf86config wyświetli krótkie wprowadzenie:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>This program will create a basic XF86Config file, based on menu selections you
make.

The XF86Config file usually resides <span class=k>in</span> /usr/X11R6/etc/X11 or /etc/X11. A sample
XF86Config file is supplied with XFree86<span class=p>;</span> it is configured <span class=k>for </span>a standard
VGA card and monitor with 640x480 resolution. This program will ask <span class=k>for </span>a
pathname when it is ready to write the file.

You can either take the sample XF86Config as a base and edit it <span class=k>for </span>your
configuration, or <span class=nb>let </span>this program produce a base XF86Config file <span class=k>for </span>your
configuration and fine-tune it.

Before continuing with this program, make sure you know what video card
you have, and preferably also the chipset it uses and the amount of video
memory on your video card. SuperProbe may be able to <span class=nb>help </span>with this.

Press enter to <span class=k>continue</span>, or ctrl-c to abort.</code></pre></div></div><div class=paragraph><p>Po naciśnięciu <kbd>Enter</kbd> przejdziemy do konfiguracji myszki. Pamiętajmy, by uważnie czytać polecenia i wybrać właściwy protokół myszki "Mouse Systems" i port myszki <span class=filename>/dev/sysmouse</span>, nawet jeśli w przykładzie wybierana jest myszka PS/2.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>First specify a mouse protocol type. Choose one from the following list:

 1.  Microsoft compatible <span class=o>(</span>2-button protocol<span class=o>)</span>
 2.  Mouse Systems <span class=o>(</span>3-button protocol<span class=o>)</span> &amp; FreeBSD moused protocol
 3.  Bus Mouse
 4.  PS/2 Mouse
 5.  Logitech Mouse <span class=o>(</span>serial, old <span class=nb>type</span>, Logitech protocol<span class=o>)</span>
 6.  Logitech MouseMan <span class=o>(</span>Microsoft compatible<span class=o>)</span>
 7.  MM Series
 8.  MM HitTablet
 9.  Microsoft IntelliMouse

If you have a two-button mouse, it is most likely of <span class=nb>type </span>1, and <span class=k>if </span>you have
a three-button mouse, it can probably support both protocol 1 and 2. There are
two main varieties of the latter <span class=nb>type</span>: mice with a switch to <span class=k>select </span>the
protocol, and mice that default to 1 and require a button to be held at
boot-time to <span class=k>select </span>protocol 2. Some mice can be convinced to <span class=k>do </span>2 by sending
a special sequence to the serial port <span class=o>(</span>see the ClearDTR/ClearRTS options<span class=o>)</span><span class=nb>.</span>

Enter a protocol number: 2

You have selected a Mouse Systems protocol mouse. If your mouse is normally
<span class=k>in </span>Microsoft-compatible mode, enabling the ClearDTR and ClearRTS options
may cause it to switch to Mouse Systems mode when the server starts.

Please answer the following question with either <span class=s1>&#39;y&#39;</span> or <span class=s1>&#39;n&#39;</span><span class=nb>.</span>
Do you want to <span class=nb>enable </span>ClearDTR and ClearRTS? n

You have selected a three-button mouse protocol. It is recommended that you
<span class=k>do </span>not <span class=nb>enable </span>Emulate3Buttons, unless the third button doesn<span class=s1>&#39;t work.

Please answer the following question with either &#39;</span>y<span class=s1>&#39; or &#39;</span>n<span class=s1>&#39;.
Do you want to enable Emulate3Buttons? y

Now give the full device name that the mouse is connected to, for example
/dev/tty00. Just pressing enter will use the default, /dev/mouse.
On FreeBSD, the default is /dev/sysmouse.

Mouse device: /dev/sysmouse</span></code></pre></div></div><div class=paragraph><p>Kolejnym krokiem jest konfiguracja klawiatury. W przykładzie wybrana została typowa klawiatura o 101 klawiszach. Jako wariant nazwy możemy wybrać dowolną nazwę, lub po prostu nacisnąć <kbd>Enter</kbd>, akceptując proponowaną nazwę domyślną.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>Please <span class=k>select </span>one of the following keyboard types that is the better
description of your keyboard. If nothing really matches,
choose 1 <span class=o>(</span>Generic 101-key PC<span class=o>)</span>

  1  Generic 101-key PC
  2  Generic 102-key <span class=o>(</span>Intl<span class=o>)</span> PC
  3  Generic 104-key PC
  4  Generic 105-key <span class=o>(</span>Intl<span class=o>)</span> PC
  5  Dell 101-key PC
  6  Everex STEPnote
  7  Keytronic FlexPro
  8  Microsoft Natural
  9  Northgate OmniKey 101
 10  Winbook Model XP5
 11  Japanese 106-key
 12  PC-98xx Series
 13  Brazilian ABNT2
 14  HP Internet
 15  Logitech iTouch
 16  Logitech Cordless Desktop Pro
 17  Logitech Internet Keyboard
 18  Logitech Internet Navigator Keyboard
 19  Compaq Internet
 20  Microsoft Natural Pro
 21  Genius Comfy KB-16M
 22  IBM Rapid Access
 23  IBM Rapid Access II
 24  Chicony Internet Keyboard
 25  Dell Internet Keyboard

Enter a number to choose the keyboard.

1

Please <span class=k>select </span>the layout corresponding to your keyboard

  1  U.S. English
  2  U.S. English w/ ISO9995-3
  3  U.S. English w/ deadkeys
  4  Albanian
  5  Arabic
  6  Armenian
  7  Azerbaidjani
  8  Belarusian
  9  Belgian
 10  Bengali
 11  Brazilian
 12  Bulgarian
 13  Burmese
 14  Canadian
 15  Croatian
 16  Czech
 17  Czech <span class=o>(</span>qwerty<span class=o>)</span>
 18  Danish

Enter a number to choose the country.
Press enter <span class=k>for </span>the next page

1

Please enter a variant name <span class=k>for</span> <span class=s1>&#39;us&#39;</span> layout. Or just press enter
<span class=k>for </span>default variant

us

Please answer the following question with either <span class=s1>&#39;y&#39;</span> or <span class=s1>&#39;n&#39;</span><span class=nb>.</span>
Do you want to <span class=k>select </span>additional XKB options <span class=o>(</span>group switcher,
group indicator, etc.<span class=o>)</span>? n</code></pre></div></div><div class=paragraph><p>Następnie przystępujemy do konfiguracji monitora. Pamiętajmy, by nie przekroczyć dopuszczalnych wartości częstotliwości, ponieważ może to spowodować uszkodzenie monitora. W razie jakichkolwiek wątpliwości, odłóżmy konfigurację monitora do czasu, gdy będziemy już mieć niezbędne informacje.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>Now we want to <span class=nb>set </span>the specifications of the monitor. The two critical
parameters are the vertical refresh rate, which is the rate at which the
whole screen is refreshed, and most importantly the horizontal <span class=nb>sync </span>rate,
which is the rate at which scanlines are displayed.

The valid range <span class=k>for </span>horizontal <span class=nb>sync </span>and vertical <span class=nb>sync </span>should be documented
<span class=k>in </span>the manual of your monitor. If <span class=k>in </span>doubt, check the monitor database
/usr/X11R6/lib/X11/doc/Monitors to see <span class=k>if </span>your monitor is there.

Press enter to <span class=k>continue</span>, or ctrl-c to abort.

You must indicate the horizontal <span class=nb>sync </span>range of your monitor. You can either
<span class=k>select </span>one of the predefined ranges below that correspond to industry-
standard monitor types, or give a specific range.

It is VERY IMPORTANT that you <span class=k>do </span>not specify a monitor <span class=nb>type </span>with a horizontal
<span class=nb>sync </span>range that is beyond the capabilities of your monitor. If <span class=k>in </span>doubt,
choose a conservative setting.

    hsync <span class=k>in </span>kHz<span class=p>;</span> monitor <span class=nb>type </span>with characteristic modes
 1  31.5<span class=p>;</span> Standard VGA, 640x480 @ 60 Hz
 2  31.5 - 35.1<span class=p>;</span> Super VGA, 800x600 @ 56 Hz
 3  31.5, 35.5<span class=p>;</span> 8514 Compatible, 1024x768 @ 87 Hz interlaced <span class=o>(</span>no 800x600<span class=o>)</span>
 4  31.5, 35.15, 35.5<span class=p>;</span> Super VGA, 1024x768 @ 87 Hz interlaced, 800x600 @ 56 Hz
 5  31.5 - 37.9<span class=p>;</span> Extended Super VGA, 800x600 @ 60 Hz, 640x480 @ 72 Hz
 6  31.5 - 48.5<span class=p>;</span> Non-Interlaced SVGA, 1024x768 @ 60 Hz, 800x600 @ 72 Hz
 7  31.5 - 57.0<span class=p>;</span> High Frequency SVGA, 1024x768 @ 70 Hz
 8  31.5 - 64.3<span class=p>;</span> Monitor that can <span class=k>do </span>1280x1024 @ 60 Hz
 9  31.5 - 79.0<span class=p>;</span> Monitor that can <span class=k>do </span>1280x1024 @ 74 Hz
10  31.5 - 82.0<span class=p>;</span> Monitor that can <span class=k>do </span>1280x1024 @ 76 Hz
11  Enter your own horizontal <span class=nb>sync </span>range

Enter your choice <span class=o>(</span>1-11<span class=o>)</span>: 6

You must indicate the vertical <span class=nb>sync </span>range of your monitor. You can either
<span class=k>select </span>one of the predefined ranges below that correspond to industry-
standard monitor types, or give a specific range. For interlaced modes,
the number that counts is the high one <span class=o>(</span>e.g. 87 Hz rather than 43 Hz<span class=o>)</span><span class=nb>.</span>

 1  50-70
 2  50-90
 3  50-100
 4  40-150
 5  Enter your own vertical <span class=nb>sync </span>range

Enter your choice: 2

You must now enter a few identification/description strings, namely an
identifier, a vendor name, and a model name. Just pressing enter will fill
<span class=k>in </span>default names.

The strings are free-form, spaces are allowed.
Enter an identifier <span class=k>for </span>your monitor definition: Hitachi</code></pre></div></div><div class=paragraph><p>W kolejnym etapie wybieramy z listy sterownik karty graficznej. Jeśli przewijając listę niechcący ominiemy naszą kartę, naciskajmy dalej <kbd>Enter</kbd>, a lista zostanie powtórzona. W przykładzie pokazujemy tylko fragment listy:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>Now we must configure video card specific settings. At this point you can
choose to make a selection out of a database of video card definitions.
Because there can be variation <span class=k>in </span>Ramdacs and clock generators even
between cards of the same model, it is not sensible to blindly copy
the settings <span class=o>(</span>e.g. a Device section<span class=o>)</span><span class=nb>.</span> For this reason, after you make a
selection, you will still be asked about the components of the card, with
the settings from the chosen database entry presented as a strong hint.

The database entries include information about the chipset, what driver to
run, the Ramdac and ClockChip, and comments that will be included <span class=k>in </span>the
Device section. However, a lot of definitions only hint about what driver
to run <span class=o>(</span>based on the chipset the card uses<span class=o>)</span> and are untested.

If you can<span class=s1>&#39;t find your card in the database, there&#39;</span>s nothing to worry about.
You should only choose a database entry that is exactly the same model as
your card<span class=p>;</span> choosing one that looks similar is just a bad idea <span class=o>(</span>e.g. a
GemStone Snail 64 may be as different from a GemStone Snail 64+ <span class=k>in </span>terms of
hardware as can be<span class=o>)</span><span class=nb>.</span>

Do you want to look at the card database? y

288  Matrox Millennium G200 8MB                        mgag200
289  Matrox Millennium G200 SD 16MB                    mgag200
290  Matrox Millennium G200 SD 4MB                     mgag200
291  Matrox Millennium G200 SD 8MB                     mgag200
292  Matrox Millennium G400                            mgag400
293  Matrox Millennium II 16MB                         mga2164w
294  Matrox Millennium II 4MB                          mga2164w
295  Matrox Millennium II 8MB                          mga2164w
296  Matrox Mystique                                   mga1064sg
297  Matrox Mystique G200 16MB                         mgag200
298  Matrox Mystique G200 4MB                          mgag200
299  Matrox Mystique G200 8MB                          mgag200
300  Matrox Productiva G100 4MB                        mgag100
301  Matrox Productiva G100 8MB                        mgag100
302  MediaGX                                           mediagx
303  MediaVision Proaxcel 128                          ET6000
304  Mirage Z-128                                      ET6000
305  Miro CRYSTAL VRX                                  Verite 1000

Enter a number to choose the corresponding card definition.
Press enter <span class=k>for </span>the next page, q to <span class=k>continue </span>configuration.

288

Your selected card definition:

Identifier: Matrox Millennium G200 8MB
Chipset:    mgag200
Driver:     mga
Do NIET probe clocks or use any Clocks line.

Press enter to <span class=k>continue</span>, or ctrl-c to abort.

Now you must give information about your video card. This will be used <span class=k>for
</span>the <span class=s2>&#34;Device&#34;</span> section of your video card <span class=k>in </span>XF86Config.

You must indicate how much video memory you have. It is probably a good
idea to use the same approximate amount as that detected by the server you
intend to use. If you encounter problems that are due to the used server
not supporting the amount memory you have <span class=o>(</span>e.g. ATI Mach64 is limited to
1024K with the SVGA server<span class=o>)</span>, specify the maximum amount supported by the
server.

How much video memory <span class=k>do </span>you have on your video card:

 1  256K
 2  512K
 3  1024K
 4  2048K
 5  4096K
 6  Other

Enter your choice: 6

Amount of video memory <span class=k>in </span>Kbytes: 8192

You must now enter a few identification/description strings, namely an
identifier, a vendor name, and a model name. Just pressing enter will fill
<span class=k>in </span>default names <span class=o>(</span>possibly from a card definition<span class=o>)</span><span class=nb>.</span>

Your card definition is Matrox Millennium G200 8MB.

The strings are free-form, spaces are allowed.
Enter an identifier <span class=k>for </span>your video card definition:</code></pre></div></div><div class=paragraph><p>Następnie wybieramy tryby graficzne dla preferowanych rozdzielczości. Najczęściej używane są tryby 640x480, 800x600 i 1024x768, wybór zależy jednak od możliwości karty graficznej, rozmiarów monitora i oczekiwanej wygody pracy. Gdy będziemy wybierać głębię koloru, wybierzmy najwyższą wartość, którą obsługuje karta.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>For each depth, a list of modes <span class=o>(</span>resolutions<span class=o>)</span> is defined. The default
resolution that the server will start-up with will be the first listed
mode that can be supported by the monitor and card.
Currently it is <span class=nb>set </span>to:

<span class=s2>&#34;640x480&#34;</span> <span class=s2>&#34;800x600&#34;</span> <span class=s2>&#34;1024x768&#34;</span> <span class=s2>&#34;1280x1024&#34;</span> <span class=k>for </span>8-bit
<span class=s2>&#34;640x480&#34;</span> <span class=s2>&#34;800x600&#34;</span> <span class=s2>&#34;1024x768&#34;</span> <span class=s2>&#34;1280x1024&#34;</span> <span class=k>for </span>16-bit
<span class=s2>&#34;640x480&#34;</span> <span class=s2>&#34;800x600&#34;</span> <span class=s2>&#34;1024x768&#34;</span> <span class=s2>&#34;1280x1024&#34;</span> <span class=k>for </span>24-bit

Modes that cannot be supported due to monitor or clock constraints will
be automatically skipped by the server.

 1  Change the modes <span class=k>for </span>8-bit <span class=o>(</span>256 colors<span class=o>)</span>
 2  Change the modes <span class=k>for </span>16-bit <span class=o>(</span>32K/64K colors<span class=o>)</span>
 3  Change the modes <span class=k>for </span>24-bit <span class=o>(</span>24-bit color<span class=o>)</span>
 4  The modes are OK, <span class=k>continue</span><span class=nb>.</span>

Enter your choice: 2

Select modes from the following list:

 1  <span class=s2>&#34;640x400&#34;</span>
 2  <span class=s2>&#34;640x480&#34;</span>
 3  <span class=s2>&#34;800x600&#34;</span>
 4  <span class=s2>&#34;1024x768&#34;</span>
 5  <span class=s2>&#34;1280x1024&#34;</span>
 6  <span class=s2>&#34;320x200&#34;</span>
 7  <span class=s2>&#34;320x240&#34;</span>
 8  <span class=s2>&#34;400x300&#34;</span>
 9  <span class=s2>&#34;1152x864&#34;</span>
 a  <span class=s2>&#34;1600x1200&#34;</span>
 b  <span class=s2>&#34;1800x1400&#34;</span>
 c  <span class=s2>&#34;512x384&#34;</span>

Please <span class=nb>type </span>the digits corresponding to the modes that you want to <span class=k>select</span><span class=nb>.</span>
For example, 432 selects <span class=s2>&#34;1024x768&#34;</span> <span class=s2>&#34;800x600&#34;</span> <span class=s2>&#34;640x480&#34;</span>, with a
default mode of 1024x768.

Which modes? 432

You can have a virtual screen <span class=o>(</span>desktop<span class=o>)</span>, which is screen area that is larger
than the physical screen and which is panned by moving the mouse to the edge
of the screen. If you don<span class=s1>&#39;t want virtual desktop at a certain resolution,
you cannot have modes listed that are larger. Each color depth can have a
differently-sized virtual screen

Please answer the following question with either &#39;</span>y<span class=s1>&#39; or &#39;</span>n<span class=s1>&#39;.
Do you want a virtual screen that is larger than the physical screen? n

For each depth, a list of modes (resolutions) is defined. The default
resolution that the server will start-up with will be the first listed
mode that can be supported by the monitor and card.
Currently it is set to:

&#34;640x480&#34; &#34;800x600&#34; &#34;1024x768&#34; &#34;1280x1024&#34; for 8-bit
&#34;1024x768&#34; &#34;800x600&#34; &#34;640x480&#34; for 16-bit
&#34;640x480&#34; &#34;800x600&#34; &#34;1024x768&#34; &#34;1280x1024&#34; for 24-bit

Modes that cannot be supported due to monitor or clock constraints will
be automatically skipped by the server.

 1  Change the modes for 8-bit (256 colors)
 2  Change the modes for 16-bit (32K/64K colors)
 3  Change the modes for 24-bit (24-bit color)
 4  The modes are OK, continue.

Enter your choice: 4

Please specify which color depth you want to use by default:

  1  1 bit (monochrome)
  2  4 bits (16 colors)
  3  8 bits (256 colors)
  4  16 bits (65536 colors)
  5  24 bits (16 million colors)

Enter a number to choose the default depth.

4</span></code></pre></div></div><div class=paragraph><p>Przygotowaną konfigurację należy zachować. Upewnijmy się, że konfiguracja zostanie zapisana w pliku o nazwie <span class=filename>/etc/X11/XF86Config</span>.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>I am going to write the XF86Config file now. Make sure you don<span class=s1>&#39;t accidently
overwrite a previously configured one.

Shall I write it to /etc/X11/XF86Config? y</span></code></pre></div></div><div class=paragraph><p>Jeśli z jakichś przyczyn konfiguracja nie powiedzie się, możemy zacząć ją od początku, wybierając <b class=button>yes</b>, gdy pojawi się następujący komunikat:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>          User Confirmation Requested
The XFree86 configuration process seems to have
failed.  Would you like to try again?

             <span class=o>[</span> Yes <span class=o>]</span>         No</code></pre></div></div><div class=paragraph><p>Jeżeli konfiguracja XFree86™ sprawia problemy, wybierzmy <b class=button>no</b> i naciśnijmy <kbd>Enter</kbd>, by kontynuować instalację. Po jej zakończeniu będziemy mogli uruchomić program konfiguracyjny poleceniem <code>xf86cfg -textmode</code> lub <code>xf86config</code>, wydanym jako <code>root</code>. <a href=./#x11>System okien X</a> prezentuje inną metodę konfiguracji XFree86™ . Jeśli zdecydujemy się pominąć na razie konfigurację XFree86™, kolejnym krokiem będzie wybór pakietów.</p></div><div class=paragraph><p>Domyślnie serwer X może zostać unicestwiony kombinacją klawiszy <span class=keyseq><kbd>Ctrl</kbd>+<kbd>Alt</kbd>+<kbd>Backspace</kbd></span>. Możemy z niej skorzystać, jeśli coś jest nie w porządku z ustawieniami serwera i chcemy uniknąć uszkodzenia sprzętu.</p></div><div class=paragraph><p>Podczas pracy serwera X można zmieniać tryb graficzny, używając kombinacji klawiszy <span class=keyseq><kbd>Ctrl</kbd>+<kbd>Alt</kbd>+<kbd>+</kbd></span> lub <span class=keyseq><kbd>Ctrl</kbd>+<kbd>Alt</kbd>+<kbd>-</kbd></span>.</p></div><div class=paragraph><p>Po zakończeniu instalacji można wyregulować wysokość, szerokość i położenie obrazu przy użyciu xvidtune, po uruchomieniu XFree86™.</p></div><div class=paragraph><p>Zwracajmy uwagę na ostrzeżenia o możliwości uszkodzenia sprzętu poprzez niewłaściwe ustawienia. Nie róbmy niczego, czego nie jesteśmy pewni. Zamiast używać xvidtune, możemy dostroić ekran X Window korzystając z regulatorów monitora. Mogą się pojawić pewne różnice w wyświetlaniu obrazu przy powraceniu do trybu tekstowego, lepsze to jednak niż uszkodzenie sprzętu.</p></div><div class=paragraph><p>Przed dokonaniem jakichkolwiek zmian zapoznajmy się z dokumentacją <a href="https://man.freebsd.org/cgi/man.cgi?query=xvidtune&amp;sektion=1&amp;format=html">xvidtune(1)</a>.</p></div><div class=paragraph><p>Jeżeli konfiguracja XFree86™ przebiegła pomyślnie, przejdziemy do kolejnego etapu, w którym wybierzemy menedżera okien.</p></div></div><div class=sect3><h4 id=default-desktop>2.9.13. Wybór menedżera okien<a class=anchor href=#default-desktop></a></h4><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Począwszy od wersji FreeBSD 5.3-RELEASE, opcje wyboru środowiska graficznego zostały usunięte z sysinstall. Musimy je skonfigurować po skończonej instalacji systemu. <a href=./#x11>System okien X</a> zawiera szczegółowe informacje odnośnie instalacji i konfiguracji środowiska graficznego. Jeśli nie instalujemy wersji wcześniejszej niż FreeBSD 5.3-RELEASE, możemy pomiąć tą sekcję.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Dostepnych jest wiele różnych menedżerów okien, poczynając od najprostszych, zapewniających jedynie podstawowe funkcje, do rozbudowanych środowisk wyposażonych w pokaźny zestaw oprogramowania. Niektórym wystarczy nieznaczna przestrzeń na dysku i niewiele pamięci, inne natomiast mogą mieć znacznie większe wymagania. Dobrze jest wypróbować kilka różnych menedżerów i wybrać spośród nich ten, który najbardziej nam odpowiada. Są one dostępne w Kolekcji portów lub w postaci pakietów, można je więc instalować po zainstalowaniu systemu.</p></div><div class=paragraph><p>Możemy wybrać jeden z popularnych menedżerów okien i zainstalować go jako domyślny. Dzięki temu będziemy mieć możliwość uruchomienia go zaraz po zakończeniu instalacji.</p></div><div id=x-desktop class=imageblock><div class=content><img src=../../../../images/books/handbook/install/desktop.png alt=desktop></div><div class=title>Rysunek 50. Wybór domyślnego menedżera okien</div></div><div class=paragraph><p>Klawiszami kursora wybieramy jedną z opcji i wciskamy <kbd>Enter</kbd>. Wybrany menedżer okien zostanie zainstalowany.</p></div></div><div class=sect3><h4 id=packages>2.9.14. Instalacja pakietów<a class=anchor href=#packages></a></h4><div class=paragraph><p>Pakiety to skompilowane programy, które można w łatwy sposób instalować.</p></div><div class=paragraph><p>W poniższym przykładzie pokazana jest instalacja jednego pakietu. Możemy oczywiście zainstalować więcej pakietów. Gdy system będzie już zainstalowany, kolejne pakiety będzie można dodawać przy użyciu <code>sysinstall</code> (<code>/stand/sysinstall</code> w wersjach FreeBSD wcześniejszych niż 5.2).</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>                     User Confirmation Requested
 The FreeBSD package collection is a collection of hundreds of
 ready-to-run applications, from text editors to games to WEB servers
 and more. Would you like to browse the collection now?

                            <span class=o>[</span> Yes <span class=o>]</span>   No</code></pre></div></div><div class=paragraph><p>Jeśli wybierzemy <b class=button>yes</b> i naciśniemy <kbd>Enter</kbd>, przejdziemy do ekranu wyboru pakietów:</p></div><div id=package-category class=imageblock><div class=content><img src=../../../../images/books/handbook/install/pkg-cat.png alt="pkg cat"></div><div class=title>Rysunek 51. Wybór kategorii pakietów</div></div><div class=paragraph><p>W danej chwili dostępne do instalacji są jedynie pakiety z bieżącego nośnika.</p></div><div class=paragraph><p>Możemy wybrać jedną z kategorii pakietów albo <span class=guimenuitem>All</span>, by wyświetlone zostały wszystkie dostępne pakiety. Wybraną opcję wskazujemy przy użyciu klawiszy kursora i wciskamy <kbd>Enter</kbd>.</p></div><div class=paragraph><p>Pokazana zostanie lista pakietów dostępnych w wybranej kategorii:</p></div><div id=package-select class=imageblock><div class=content><img src=../../../../images/books/handbook/install/pkg-sel.png alt="pkg sel"></div><div class=title>Rysunek 52. Wybór pakietów</div></div><div class=paragraph><p>Dla przykładu zaznaczona została powłoka bash. Możemy wybrać tyle pakietów, ile nam się podoba, zaznaczając każdy z nich <kbd>Space</kbd>. Krótki opis pakietu wyświetlany jest w lewym dolnym rogu ekranu.</p></div><div class=paragraph><p>Klawiszem <kbd>Tab</kbd> możemy przełączać się między ostatnio wybranym pakietem, przyciskami <b class=button>OK</b> i <b class=button>Cancel</b>.</p></div><div class=paragraph><p>Po zaznaczeniu wszystkich wybranych pakietów naciskamy <kbd>Tab</kbd>, by zaznaczyć <b class=button>OK</b> i naciskamy <kbd>Enter</kbd>, powracając w ten sposób do menu wyboru pakietów.</p></div><div class=paragraph><p>Do przełączania się między <b class=button>OK</b> i <b class=button>Cancel</b> mogą również służyć klawisze kursora. Za ich pomocą możemy wybrać <b class=button>OK</b>, a następnie nacisnąć <kbd>Enter</kbd>, by wrócić do menu wyboru pakietów.</p></div><div id=package-install class=imageblock><div class=content><img src=../../../../images/books/handbook/install/pkg-install.png alt="pkg install"></div><div class=title>Rysunek 53. Rozpoczęcie instalacji pakietów</div></div><div class=paragraph><p>Klawiszami kursora i <kbd>Tab</kbd> wybieramy <b class=button>Install</b> i wciskamy <kbd>Enter</kbd>. Pojawi się prośba o potwierdzenie chęci zainstalowania pakietów:</p></div><div id=package-install-confirm class=imageblock><div class=content><img src=../../../../images/books/handbook/install/pkg-confirm.png alt="pkg confirm"></div><div class=title>Rysunek 54. Potwierdzenie instalacji pakietów</div></div><div class=paragraph><p>Gdy wybierzemy <b class=button>OK</b> i naciśniemy <kbd>Enter</kbd>, rozpocznie się instalacja pakietów. Aż do jej zakończenia będą pokazywane komunikaty o przebiegu instalacji. Jeżeli pojawią się informacje o jakichkolwiek problemach, zanotujmy je.</p></div><div class=paragraph><p>Po zainstalowaniu pakietów wracamy do konfiguracji systemu. Nawet jeśli nie wybraliśmy żadnych pakietów i chcemy wrócić do końcowej konfiguracji wybieramy opcję <b class=button>Install</b>.</p></div></div><div class=sect3><h4 id=addusers>2.9.15. Dodawanie użytkowników i grup<a class=anchor href=#addusers></a></h4><div class=paragraph><p>Powinniśmy założyć przynajmniej jedno konto użytkownika, by móc korzystać z systemu nie będąc zalogowanym jako <code>root</code>. Główna partycja jest zwykle niewielka, więc korzystanie z aplikacji jako <code>root</code> może ją szybko zapełnić. Inny powód wymieniony został w poniższym komunikacie:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>                     User Confirmation Requested
 Would you like to add any initial user accounts to the system? Adding
 at least one account <span class=k>for </span>yourself at this stage is suggested since
 working as the <span class=s2>&#34;root&#34;</span> user is dangerous <span class=o>(</span>it is easy to <span class=k>do </span>things which
 adversely affect the entire system<span class=o>)</span><span class=nb>.</span>

                            <span class=o>[</span> Yes <span class=o>]</span>   No</code></pre></div></div><div class=paragraph><p>Wybieramy <b class=button>yes</b> i naciskamy <kbd>Enter</kbd>, by dodać użytkownika.</p></div><div id=add-user2 class=imageblock><div class=content><img src=../../../../images/books/handbook/install/adduser1.png alt=adduser1></div><div class=title>Rysunek 55. Dodawanie użytkownika</div></div><div class=paragraph><p>Klawiszamy kursora wybieramy <span class=guimenuitem>User</span> (użytkownik) i wciskamy <kbd>Enter</kbd>.</p></div><div id=add-user3 class=imageblock><div class=content><img src=../../../../images/books/handbook/install/adduser2.png alt=adduser2></div><div class=title>Rysunek 56. Dane nowego użytkownika</div></div><div class=paragraph><p>Kolejne pola wybieramy klawiszem <kbd>Tab</kbd>. W dolnej części ekranu pojawiać się będą następujące opisy, pomocne przy wprowadzaniu poszczególnych danych:</p></div><div class=dlist><dl><dt class=hdlist1>Login ID</dt><dd><p>Nazwa nowego użytkownika (obowiązkowa).</p></dd><dt class=hdlist1>UID</dt><dd><p>Numer będący identyfikatorem użytkownika (wypełniany automatycznie, jeśli pole pozostanie puste).</p></dd><dt class=hdlist1>Group</dt><dd><p>Nazwa podstawowej grupy użytkownika (wybierana automatycznie, jeśli pole pozostanie puste).</p></dd><dt class=hdlist1>Password</dt><dd><p>Hasło użytkownika (wpisujmy je uważnie!).</p></dd><dt class=hdlist1>Full name</dt><dd><p>Nazwisko użytkownika (komentarz).</p></dd><dt class=hdlist1>Member groups</dt><dd><p>Grupy, których członkiem będzie użytkownik (czyli dostanie ich uprawnienia).</p></dd><dt class=hdlist1>Home directory</dt><dd><p>Domowy katalog użytkownika (wpisywany automatycznie, jeśli pole pozostanie puste).</p></dd><dt class=hdlist1>Login shell</dt><dd><p>Powłoka uruchamiana po zalogowaniu się (wybierana automatycznie, jeśli pole pozostanie puste, np. <span class=filename>/bin/sh</span>).</p></dd></dl></div><div class=paragraph><p>W przykładzie powłoka została zmieniona z <span class=filename>/bin/sh</span> na <span class=filename>/usr/local/bin/bash</span>, aby korzystać z powłoki bash zainstalowanej wcześniej jako pakiet. Nie wpisujmy tu powłoki, która nie istnieje, gdyż uniemożliwi to zalogowanie się. Najpopularniejszą powłoką w świecie BSD jest powłoka C, czyli <span class=filename>/bin/tcsh</span>.</p></div><div class=paragraph><p>Użytkownik został dopisany do grupy <code>wheel</code>, dzięki czemu będzie mógł uzyskiwać uprawnienia użytkownika <code>root</code>.</p></div><div class=paragraph><p>Gdy skończymy, wybieramy <b class=button>OK</b>. Ponownie pojawi się menu zarządzania użytkownikami i grupami:</p></div><div id=add-user4 class=imageblock><div class=content><img src=../../../../images/books/handbook/install/adduser3.png alt=adduser3></div><div class=title>Rysunek 57. Wyjście z menu zarządzania użytkownikami i grupami</div></div><div class=paragraph><p>W podobny sposób możemy od razu utworzyć dodatkowe grupy, jeśli zajdzie taka potrzeba. Gdy system będzie już zainstalowany, będziemy mogli dodawać grupy przy użyciu <code>sysinstall</code> (<code>/stand/sysinstall</code> w wersjach FreeBSD starszych niż 5.2).</p></div><div class=paragraph><p>Gdy skończymy dodawanie użytkowników wybieramy klawiszami kursora <span class=guimenuitem>Exit</span> i wciskamy <kbd>Enter</kbd>, by kontynuować instalację.</p></div></div><div class=sect3><h4 id=rootpass>2.9.16. Hasło użytkownika <code>root</code><a class=anchor href=#rootpass></a></h4><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>                        Message
 Now you must <span class=nb>set </span>the system manager<span class=s1>&#39;s password.
 This is the password you&#39;</span>ll use to log <span class=k>in </span>as <span class=s2>&#34;root&#34;</span><span class=nb>.</span>

                         <span class=o>[</span> OK <span class=o>]</span>

               <span class=o>[</span> Press enter to <span class=k>continue</span> <span class=o>]</span></code></pre></div></div><div class=paragraph><p>Wciskamy <kbd>Enter</kbd>, aby ustawić hasło <code>root</code>a.</p></div><div class=paragraph><p>Hasło musi być prawidłowo podane dwukrotnie. Rzecz jasna, powinniśmy zadbać o to, by łatwo odnaleźć hasło, gdy zdarzy się nam je zapomnieć. Zwróćmy uwagę, że w trakcie wpisywania hasła nie pojawią się żadne znaki, nawet gwiazdki.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>Changing <span class=nb>local </span>password <span class=k>for </span>root.
New password :
Retype new password :</code></pre></div></div><div class=paragraph><p>Po pomyślnym wprowadzeniu hasła przejdziemy do kolejnego etapu instalacji.</p></div></div><div class=sect3><h4 id=exit-inst>2.9.17. Zakończenie instalacji<a class=anchor href=#exit-inst></a></h4><div class=paragraph><p>Jeżeli będziemy chcieli skonfigurować dodatkowe urządzenia sieciowe, lub wprowadzić inne zmiany w konfiguracji systemu, możemy to zrobić w tym właśnie momencie, lub też po zakończeniu instalacji za pośrednictwem <code>sysinstall</code> (<code>/stand/sysinstall</code> w wersjach FreeBSD wcześniejszych niż 5.2).</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>                     User Confirmation Requested
 Visit the general configuration menu <span class=k>for </span>a chance to <span class=nb>set </span>any last
 options?

                              Yes   <span class=o>[</span> No <span class=o>]</span></code></pre></div></div><div class=paragraph><p>Wybieramy klawiszami kursora <b class=button>no</b> i wciskamy <kbd>Enter</kbd>, by powrócić do głównego menu instalacji.</p></div><div id=final-main class=imageblock><div class=content><img src=../../../../images/books/handbook/install/mainexit.png alt=mainexit></div><div class=title>Rysunek 58. Zakończenie instalacji</div></div><div class=paragraph><p>Przy pomocy klawiszy kursora wybieramy <b class=button>X Exit Install</b> i naciskamy <kbd>Enter</kbd>. Pojawi się prośba o potwierdzenie chęci zakończenia instalacji:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>                     User Confirmation Requested
 Are you sure you wish to <span class=nb>exit</span>? The system will reboot <span class=o>(</span>be sure to
 remove any floppies from the drives<span class=o>)</span><span class=nb>.</span>

                            <span class=o>[</span> Yes <span class=o>]</span>   No</code></pre></div></div><div class=paragraph><p>Wybieramy <b class=button>yes</b>. Jeżeli uruchamialiśmy komputer z dyskietki, wyjmujemy ją. Napęd CDROM będzie zablokowany aż do chwili, gdy komputer zacznie się ponownie uruchamiać. Wtedy napęd zostanie odblokowany i będzie można wyjąć z niego płytę (szybko).</p></div><div class=paragraph><p>Komputer zostanie ponownie uruchomiony. Zwróćmy uwagę na ewentualne komunikaty o błędach.</p></div></div><div class=sect3><h4 id=freebsdboot>2.9.18. Uruchamianie FreeBSD<a class=anchor href=#freebsdboot></a></h4><div class=sect4><h5 id=freebsdboot-i386>2.9.18.1. Uruchamianie FreeBSD na komputerach i386™<a class=anchor href=#freebsdboot-i386></a></h5><div class=paragraph><p>Jeżeli wszystko przebiegło prawidłowo, na ekranie zobaczymy serię kolejno pojawiających się komunikatów, a na koniec będziemy mogli się zalogować. Komunikaty możemy przeczytać naciskając <kbd>Scroll-Lock</kbd>, następnie przewijając ekran klawiszami <kbd>PgUp</kbd> i <kbd>PgDn</kbd>. Ponownie naciskając <kbd>Scroll-Lock</kbd> powracamy do komunikatu logowania.</p></div><div class=paragraph><p>Być może nie będziemy mogli zobaczyć wszystkich komunikatów (ograniczony rozmiar bufora), jednak można je przejrzeć po zalogowaniu się, wpisując <code>dmesg</code> w linii poleceń.</p></div><div class=paragraph><p>Zalogujmy się, wpisując nazwę użytkownika i hasło wybrane podczas instalacji (w naszym przykładzie <code>rpratt</code>). Jako <code>root</code> powinniśmy logować się tylko wtedy, gdy jest to konieczne.</p></div><div class=paragraph><p>Typowe komunikaty pokazywane podczas uruchamiania systemu (pominięto informacje o wersji):</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>Copyright <span class=o>(</span>c<span class=o>)</span> 1992-2002 The FreeBSD Project.
Copyright <span class=o>(</span>c<span class=o>)</span> 1979, 1980, 1983, 1986, 1988, 1989, 1991, 1992, 1993, 1994
        The Regents of the University of California. All rights reserved.

Timecounter <span class=s2>&#34;i8254&#34;</span>  frequency 1193182 Hz
CPU: AMD-K6<span class=o>(</span>tm<span class=o>)</span> 3D processor <span class=o>(</span>300.68-MHz 586-class CPU<span class=o>)</span>
  Origin <span class=o>=</span> <span class=s2>&#34;AuthenticAMD&#34;</span>  Id <span class=o>=</span> 0x580  Stepping <span class=o>=</span> 0
  <span class=nv>Features</span><span class=o>=</span>0x8001bf&lt;FPU,VME,DE,PSE,TSC,MSR,MCE,CX8,MMX&gt;
  AMD <span class=nv>Features</span><span class=o>=</span>0x80000800&lt;SYSCALL,3DNow!&gt;
real memory  <span class=o>=</span> 268435456 <span class=o>(</span>262144K bytes<span class=o>)</span>
config&gt; di sn0
config&gt; di lnc0
config&gt; di le0
config&gt; di ie0
config&gt; di fe0
config&gt; di cs0
config&gt; di bt0
config&gt; di aic0
config&gt; di aha0
config&gt; di adv0
config&gt; q
avail memory <span class=o>=</span> 256311296 <span class=o>(</span>250304K bytes<span class=o>)</span>
Preloaded elf kernel <span class=s2>&#34;kernel&#34;</span> at 0xc0491000.
Preloaded userconfig_script <span class=s2>&#34;/boot/kernel.conf&#34;</span> at 0xc049109c.
md0: Malloc disk
Using <span class=nv>$PIR</span> table, 4 entries at 0xc00fde60
npx0: &lt;math processor&gt; on motherboard
npx0: INT 16 interface
pcib0: &lt;Host to PCI bridge&gt; on motherboard
pci0: &lt;PCI bus&gt; on pcib0
pcib1: &lt;VIA 82C598MVP <span class=o>(</span>Apollo MVP3<span class=o>)</span> PCI-PCI <span class=o>(</span>AGP<span class=o>)</span> bridge&gt; at device 1.0 on pci0
pci1: &lt;PCI bus&gt; on pcib1
pci1: &lt;Matrox MGA G200 AGP graphics accelerator&gt; at 0.0 irq 11
isab0: &lt;VIA 82C586 PCI-ISA bridge&gt; at device 7.0 on pci0
isa0: &lt;ISA bus&gt; on isab0
atapci0: &lt;VIA 82C586 ATA33 controller&gt; port 0xe000-0xe00f at device 7.1 on pci0
ata0: at 0x1f0 irq 14 on atapci0
ata1: at 0x170 irq 15 on atapci0
uhci0: &lt;VIA 83C572 USB controller&gt; port 0xe400-0xe41f irq 10 at device 7.2 on pci0
usb0: &lt;VIA 83C572 USB controller&gt; on uhci0
usb0: USB revision 1.0
uhub0: VIA UHCI root hub, class 9/0, rev 1.00/1.00, addr 1
uhub0: 2 ports with 2 removable, self powered
chip1: &lt;VIA 82C586B ACPI interface&gt; at device 7.3 on pci0
ed0: &lt;NE2000 PCI Ethernet <span class=o>(</span>RealTek 8029<span class=o>)&gt;</span> port 0xe800-0xe81f irq 9 at
device 10.0 on pci0
ed0: address 52:54:05:de:73:1b, <span class=nb>type </span>NE2000 <span class=o>(</span>16 bit<span class=o>)</span>
isa0: too many dependant configs <span class=o>(</span>8<span class=o>)</span>
isa0: unexpected small tag 14
fdc0: &lt;NEC 72065B or clone&gt; at port 0x3f0-0x3f5,0x3f7 irq 6 drq 2 on isa0
fdc0: FIFO enabled, 8 bytes threshold
fd0: &lt;1440-KB 3.5<span class=s2>&#34; drive&gt; on fdc0 drive 0
atkbdc0: &lt;keyboard controller (i8042)&gt; at port 0x60-0x64 on isa0
atkbd0: &lt;AT Keyboard&gt; flags 0x1 irq 1 on atkbdc0
kbd0 at atkbd0
psm0: &lt;PS/2 Mouse&gt; irq 12 on atkbdc0
psm0: model Generic PS/2 mouse, device ID 0
vga0: &lt;Generic ISA VGA&gt; at port 0x3c0-0x3df iomem 0xa0000-0xbffff on isa0
sc0: &lt;System console&gt; at flags 0x1 on isa0
sc0: VGA &lt;16 virtual consoles, flags=0x300&gt;
sio0 at port 0x3f8-0x3ff irq 4 flags 0x10 on isa0
sio0: type 16550A
sio1 at port 0x2f8-0x2ff irq 3 on isa0
sio1: type 16550A
ppc0: &lt;Parallel port&gt; at port 0x378-0x37f irq 7 on isa0
ppc0: SMC-like chipset (ECP/EPP/PS2/NIBBLE) in COMPATIBLE mode
ppc0: FIFO with 16/16/15 bytes threshold
ppbus0: IEEE1284 device found /NIBBLE
Probing for PnP devices on ppbus0:
plip0: &lt;PLIP network interface&gt; on ppbus0
lpt0: &lt;Printer&gt; on ppbus0
lpt0: Interrupt-driven port
ppi0: &lt;Parallel I/O&gt; on ppbus0
ad0: 8063MB &lt;IBM-DHEA-38451&gt; [16383/16/63] at ata0-master using UDMA33
ad2: 8063MB &lt;IBM-DHEA-38451&gt; [16383/16/63] at ata1-master using UDMA33
acd0: CDROM &lt;DELTA OTC-H101/ST3 F/W by OIPD&gt; at ata0-slave using PIO4
Mounting root from ufs:/dev/ad0s1a
swapon: adding /dev/ad0s1b as swap device
Automatic boot in progress...
/dev/ad0s1a: FILESYSTEM CLEAN; SKIPPING CHECKS
/dev/ad0s1a: clean, 48752 free (552 frags, 6025 blocks, 0.9% fragmentation)
/dev/ad0s1f: FILESYSTEM CLEAN; SKIPPING CHECKS
/dev/ad0s1f: clean, 128997 free (21 frags, 16122 blocks, 0.0% fragmentation)
/dev/ad0s1g: FILESYSTEM CLEAN; SKIPPING CHECKS
/dev/ad0s1g: clean, 3036299 free (43175 frags, 374073 blocks, 1.3% fragmentation)
/dev/ad0s1e: filesystem CLEAN; SKIPPING CHECKS
/dev/ad0s1e: clean, 128193 free (17 frags, 16022 blocks, 0.0% fragmentation)
Doing initial network setup: hostname.
ed0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500
        inet 192.168.0.1 netmask 0xffffff00 broadcast 192.168.0.255
        inet6 fe80::5054::5ff::fede:731b%ed0 prefixlen 64 tentative scopeid 0x1
        ether 52:54:05:de:73:1b
lo0: flags=8049&lt;UP,LOOPBACK,RUNNING,MULTICAST&gt; mtu 16384
        inet6 fe80::1%lo0 prefixlen 64 scopeid 0x8
        inet6 ::1 prefixlen 128
        inet 127.0.0.1 netmask 0xff000000
Additional routing options: IP gateway=TAK TCP keepalive=TAK
routing daemons:.
additional daemons: syslogd.
Doing additional network setup:.
Starting final network daemons: creating ssh RSA host key
Generating public/private rsa1 key pair.
Your identification has been saved in /etc/ssh/ssh_host_key.
Your public key has been saved in /etc/ssh/ssh_host_key.pub.
The key fingerprint is:
cd:76:89:16:69:0e:d0:6e:f8:66:d0:07:26:3c:7e:2d root@k6-2.example.com
 creating ssh DSA host key
Generating public/private dsa key pair.
Your identification has been saved in /etc/ssh/ssh_host_dsa_key.
Your public key has been saved in /etc/ssh/ssh_host_dsa_key.pub.
The key fingerprint is:
f9:a1:a9:47:c4:ad:f9:8d:52:b8:b8:ff:8c:ad:2d:e6 root@k6-2.example.com.
setting ELF ldconfig path: /usr/lib /usr/lib/compat /usr/X11R6/lib
/usr/local/lib
a.out ldconfig path: /usr/lib/aout /usr/lib/compat/aout /usr/X11R6/lib/aout
starting standard daemons: inetd cron sshd usbd sendmail.
Initial rc.i386 initialization:.
rc.i386 configuring syscons: blank_time screensaver moused.
Additional ABI support: linux.
Local package initialization:.
Additional TCP options:.

FreeBSD/i386 (k6-2.example.com) (ttyv0)

login: rpratt
Password:</span></code></pre></div></div><div class=paragraph><p>Generowanie kluczy RSA i DSA na niezbyt szybkich komputerach może zająć nieco czasu. Dzieje się to tylko podczas pierwszego uruchomienia nowo zainstalowanego systemu. Następne ładowanie systemu będzie już odbywać się szybciej.</p></div><div class=paragraph><p>Jeśli skonfigurowaliśmy serwer X i wybraliśmy menedżera okien, możemy uruchomić go wpisując <code>startx</code> w linii poleceń.</p></div></div><div class=sect4><h5 id=_uruchamianie_freebsd_na_komputerach_alpha>2.9.18.2. Uruchamianie FreeBSD na komputerach Alpha<a class=anchor href=#_uruchamianie_freebsd_na_komputerach_alpha></a></h5><div class=paragraph><p>Po zakończeniu instalacji będziemy mogli uruchomić FreeBSD, wpisując następujące polecenie w konsoli SRM:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=o>&gt;&gt;&gt;</span>BOOT DKC0</code></pre></div></div><div class=paragraph><p>Nakazuje ono oprogramowaniu sprzętowemu uruchomić system z określonego dysku. By FreeBSD było automatycznie uruchamiane przy włączeniu komputera, wpisujemy poniższe polecenia:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=o>&gt;&gt;&gt;</span> SET BOOT_OSFLAGS A
<span class=o>&gt;&gt;&gt;</span> SET BOOT_FILE <span class=s1>&#39;&#39;</span>
<span class=o>&gt;&gt;&gt;</span> SET BOOTDEF_DEV DKC0
<span class=o>&gt;&gt;&gt;</span> SET AUTO_ACTION BOOT</code></pre></div></div><div class=paragraph><p>Komunikaty pokazywane podczas ładowania systemu będą podobne (choć nie identyczne) do komunikatów pokazywanych na i386™.</p></div></div></div><div class=sect3><h4 id=shutdown>2.9.19. Wyłączanie FreeBSD<a class=anchor href=#shutdown></a></h4><div class=paragraph><p>Właściwe wyłączenie systemu operacyjnego jest istotną sprawą. Nie należy po prostu wyłączać komputera. Powinniśmy najpierw uzyskać prawa administratora, wpisując w linii poleceń <code>su</code> i podając hasło <code>root</code>a; może to zrobić tylko użytkownik należący do grupy <code>wheel</code>. Możemy także po prostu zalogować się jako <code>root</code>. Następnie wydajemy polecenie <code>shutdown -h now</code>.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>The operating system has halted.
Please press any key to reboot.</code></pre></div></div><div class=paragraph><p>Po takim wyłączeniu systemu i pojawieniu się komunikatu "Please press any key to reboot" (Naciśnij dowolny klawisz by ponownie uruchomić system), można już wyłączyć komputer. Naciśnięcie dowolnego klawisza spowoduje ponownie uruchomienie systemu.</p></div><div class=paragraph><p>Inny sposobem ponownego uruchomienia systemu jest kombinacja klawiszy <span class=keyseq><kbd>Ctrl</kbd>+<kbd>Alt</kbd>+<kbd>Del</kbd></span>, jednak w normalnych warunkach korzystanie z niej nie jest zalecane.</p></div></div></div><div class=sect2><h3 id=install-supported-hardware>2.10. Obsługiwany sprzęt<a class=anchor href=#install-supported-hardware></a></h3><div class=paragraph><p>W obecnej chwili FreeBSD działa na komputerach z magistralami ISA, VLB, EISA i PCI wyposażonych w procesory Intel, AMD, Cyrix lub NexGen "x86", jak również na komputerach z procesorem Compaq Alpha. Obsługiwane są także dyski IDE i ESDI, rozmaite kontrolery SCSI, karty PCMCIA, urządzenia USB oraz karty sieciowe i szeregowe. FreeBSD pracuje także z szyną microchannel (MCA) firmy IBM.</p></div><div class=paragraph><p>Lista obsługiwanych urządzeń dołączona jest do każdego wydania FreeBSD w dokumencie FreeBSD Hardware Notes. Można go zwykle znaleźć w pliku <span class=filename>HARDWARE.TXT</span>, umieszczonym bezpośrednio w głównym katalogu płyty CDROM lub na serwerze FTP, bądź w menu dokumentacji sysinstall. Na liście zebrano urządzenia, które poprawnie współpracują z FreeBSD. Kopie tej listy dla różnych wydań systemu i różnych architektur można także znaleźć na podstronie <a href=http://www.FreeBSD.org/releases/>Release Information</a> na stronie WWW FreeBSD.</p></div></div><div class=sect2><h3 id=install-trouble>2.11. Rozwiązywanie problemów<a class=anchor href=#install-trouble></a></h3><div class=paragraph><p>W tej części opisujemy, jak radzić sobie z podstawowymi problemami spotykanymi podczas instalacji. W kilku pytaniach i odpowiedziach omawiamy także możliwość uruchamiania FreeBSD i MS-DOS® na tym samym komputerze.</p></div><div class=sect3><h4 id=_co_robić_gdy_coś_pójdzie_nie_tak>2.11.1. Co robić, gdy coś pójdzie nie tak<a class=anchor href=#_co_robić_gdy_coś_pójdzie_nie_tak></a></h4><div class=paragraph><p>Ze względu na rozmaite ograniczenia architektury PC, rozpoznawanie urządzeń może niekiedy sprawiać problemy. Można jednak spróbować sobie z nimi poradzić</p></div><div class=paragraph><p>Zapoznajmy się z dokumentem Hardware Notes, by mieć pewność, że nasze urządzenia są obsługiwane przez FreeBSD.</p></div><div class=paragraph><p>Jeśli wciąż występują problemy, mimo, że nasz sprzęt jest obsługiwany, powinniśmy ponownie uruchomić komputer i wybrać opcję wizualnej konfiguracji jądra (visual kernel configuration). Będziemy mieć możliwość przejrzenia naszych urządzeń i podania systemowi informacji o nich. Jądro uruchamiane z dyskietki startowej zakłada, że większość urządzeń skonfigurowanych jest z fabrycznymi ustawieniami IRQ, portów we/wy i kanałów DMA. Jeśli konfiguracja naszego sprzętu jest odmienna, zapewne będziemy musieli poinformować o tym FreeBSD, odpowiednio modyfikując konfigurację.</p></div><div class=paragraph><p>Może się zdarzyć, że próba rozpoznania urządzenia nieistniejącego spowoduje kłopoty z późniejszym rozpoznawaniem urządzeń rzeczywiście zainstalowanych w komputerze. W takim wypadku powinniśmy wyłączyć sterowniki powodujące konflikty.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Pewnych problemów z instalacją można uniknąć dzięki instalacji nowszego oprogramowania sprzętowego (ang. firmware) urządzenia, zwykle płyty głównej. Oprogramowanie sprzętowe płyty głównej znane jest pod nazwą BIOS. Większość producentów płyt głównych lub komputerów umieszcza informacje o nowych wersjach oprogramowania na swoich stronach WWW.</p></div><div class=paragraph><p>Producenci zwykle stanowczo odradzają instalowanie nowego BIOS-u, oprócz sytuacji, w których jest to uzasadnione, na przykład w przypadku wykrycia poważnego błędu. Instalacja nowszej wersji <em>może</em> się nie udać, powodując trwałe uszkodzenie układu BIOS.</p></div></td></tr></tbody></table></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>Nie należy wyłączać sterowników potrzebnych podczas instalacji, na przykład sterownika ekranu (<span class=filename>sc0</span>). Jeżeli po zakończeniu konfiguracji jądra instalacja w tajemniczy sposób zastyga lub przerywa pracę, zapewne usunęliśmy lub zmodyfikowaliśmy coś, co nie powinno być ruszane. Musimy ponownie uruchomić komputer i spróbować jeszcze raz.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Podczas konfiguracji możemy:</p></div><div class=ulist><ul><li><p>Przejrzeć listę sterowników zainstalowanych w jądrze.</p></li><li><p>Wyłączyć sterowniki urządzeń, których nie ma w komputerze.</p></li><li><p>Zmienić ustawienia IRQ, DRQ i portów we/wy używanych przez sterowniki.</p></li></ul></div><div class=paragraph><p>Po dostosowaniu konfiguracji jądra do naszego sprzętu, wpisujemy <code>Q</code>, by ponownie uruchomić komputer z nowymi ustawieniami. Zmiany konfiguracji są trwałe i będą obowiązywać również po zakończeniu instalacji, nie będzie więc trzeba konfigurować jądra na nowo przy każdym uruchamianiu systemu. Jest jednak bardzo prawdopodobne, że będziemy chcieli zbudować <a href=./#kernelconfig>niestandardowe jądro</a>.</p></div></div><div class=sect3><h4 id=_jak_poradzić_sobie_z_istniejącymi_partycjami_ms_dos>2.11.2. Jak poradzić sobie z istniejącymi partycjami MS-DOS®<a class=anchor href=#_jak_poradzić_sobie_z_istniejącymi_partycjami_ms_dos></a></h4><div class=paragraph><p>Wielu użytkowników instaluje FreeBSD na komputerach PC z systemem operacyjnym z rodziny Microsoft®. Specjalnie dla tych użytkowników przygotowany został program FIPS. Narzędzie to znajduje się na płycie instalacyjnej w katalogu\ <span class=filename>tools</span>. Można je również pobrać z wielu <a href=./#mirrors>serwerów lustrzanych FreeBSD</a>.</p></div><div class=paragraph><p>FIPS umożliwia podzielenie istniejącej partycji MS-DOS® na dwie części, zachowując pierwotną partycję i pozwalając na instalację FreeBSD na wolnej drugiej częsci. Wpierw należy wykonać defragmentację partycji MS-DOS® za pomocą dostępnego w Windows® narzędzia (w Eksploratorze nacisnąć prawym przyciskiem myszki na dysku twardym, następnie wybrać opcję defragmentacji dysku), albo Norton Disk Tools. Następnie należy uruchomić FIPS. Program zapyta o potrzebne mu informacje. Potem można ponownie uruchomić komputer i zainstalować FreeBSD na nowym wolnym segmencie. W menu <span class=guimenuitem>Distributions</span> można dowiedzieć się, ile miejsca na dysku będzie w przybliżeniu potrzebne.</p></div><div class=paragraph><p>Jest także bardzo użyteczny program firmy PowerQuest (<a href=http://www.powerquest.com/>http://www.powerquest.com</a>), o nazwie PartitionMagic®. Ma on znacznie większe możliwości niż FIPS i stosowanie go jest zalecane, jeśli planuje się częste instalowanie i usuwanie systemów operacyjnych. Nie jest on jednak za darmo; jeśli FreeBSD ma być zainstalowane raz na dobre, FIPS zapewne w zupełności wystarczy.</p></div></div><div class=sect3><h4 id=_wykorzystanie_systemów_plików_ms_dos_i_windows>2.11.3. Wykorzystanie systemów plików MS-DOS® i Windows®<a class=anchor href=#_wykorzystanie_systemów_plików_ms_dos_i_windows></a></h4><div class=paragraph><p>W chwili obecnej FreeBSD nie obsługuje systemów plików skompresowanych za pomocą programu Double Space™. Tym samym musimy wpierw rozkompresować system plików nim FreeBSD będzie mógł odczytać zapisane w nim dane. Można do tego wykorzystać Agenta kompresji z menu <span class=guimenuitem>Start</span>> <span class=guimenuitem>Programy</span> > <span class=guimenuitem>Narzędzia systemowe</span>.</p></div><div class=paragraph><p>FreeBSD obsługuje systemy plików MS-DOS®. By je zamontować należy wykorzystać polecenie <a href="https://man.freebsd.org/cgi/man.cgi?query=mount_msdosfs&amp;sektion=8&amp;format=html">mount_msdosfs(8)</a> z odpowiednimi parametrami. Typowa forma polecenia wygląda następująco:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mount_msdosfs /dev/ad0s1 /mnt</span></code></pre></div></div><div class=paragraph><p>W tym przykładzie system plików MS-DOS® zlokalizowany jest na pierwszej partycji pierwszego dysku twardego. By sprawdzić jak jest w naszym przypadku należy sprawdzić wynik poleceń <code>dmesg</code> oraz <code>mount</code>. Powinno to pozwolić nam zorientować się w układzie partycji na dysku.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Rozszerzone partycje MS-DOS® odwzorowywane są na końcu pozostałych "segmentów" we FreeBSD. Przykładowo, pierwsza partycja MS-DOS® może znajdować sie na <span class=filename>/dev/ad0s1</span>, partycja FreeBSD na <span class=filename>/dev/ad0s2</span>, natomiast rozszerzona partycja MS-DOS® na <span class=filename>/dev/ad0s3</span>. Może to być mylące na początku.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Analogicznie można montować partycje NTFS wykorzystując polecenie <a href="https://man.freebsd.org/cgi/man.cgi?query=mount_ntfs&amp;sektion=8&amp;format=html">mount_ntfs(8)</a>.</p></div></div><div class=sect3><h4 id=_pytania_użytkowników_komputerów_alpha>2.11.4. Pytania użytkowników komputerów Alpha<a class=anchor href=#_pytania_użytkowników_komputerów_alpha></a></h4><div class=paragraph><p>Oto niektóre z najczęściej zadawanych pytań dotyczących instalowania FreeBSD na komputerach Alpha.</p></div><div class=sect4><h5 id=_czy_mogę_ładować_system_z_konsoli_arc_arc_lub_alpha_bios_alpha_bios>2.11.4.1. Czy mogę ładować system z konsoli ARC ARC lub Alpha BIOS Alpha BIOS?<a class=anchor href=#_czy_mogę_ładować_system_z_konsoli_arc_arc_lub_alpha_bios_alpha_bios></a></h5><div class=paragraph><p>Nie. FreeBSD, podobnie jak Compaq Tru64 i VMS, może być ładowany tylko z konsoli SRM.</p></div></div><div class=sect4><h5 id=_pomocy_brakuje_mi_miejsca_na_dysku_czy_muszę_wszystko_skasować>2.11.4.2. Pomocy, brakuje mi miejsca na dysku! Czy muszę wszystko skasować?<a class=anchor href=#_pomocy_brakuje_mi_miejsca_na_dysku_czy_muszę_wszystko_skasować></a></h5><div class=paragraph><p>Niestety tak.</p></div></div><div class=sect4><h5 id=_czy_można_montować_systemy_plików_compaq_tru64_lub_vms>2.11.4.3. Czy można montować systemy plików Compaq Tru64 lub VMS?<a class=anchor href=#_czy_można_montować_systemy_plików_compaq_tru64_lub_vms></a></h5><div class=paragraph><p>Nie, przynajmniej na razie.</p></div></div></div></div><div class=sect2><h3 id=install-advanced>2.12. Instalacja zaawansowana<a class=anchor href=#install-advanced></a></h3><div class=paragraph><p>W tej części omówiona została instalacja FreeBSD w sytuacjach wyjątkowych.</p></div><div class=sect3><h4 id=headless-install>2.12.1. Instalacja FreeBSD na komputerze bez monitora lub klawiatury<a class=anchor href=#headless-install></a></h4><div class=paragraph><p>Ten rodzaj instalacji zwany jest "instalacją bez głowy", ponieważ komputer, na którym FreeBSD będzie instalowane nie ma podłączonego monitora, lub nawet nie ma wyjścia VGA. Jak to możliwe? Dzięki konsoli szeregowej. W roli konsoli szeregowej używa się zwykle innego komputera, który pełni rolę ekranu i klawiatury dla pozbawionego tych urządzeń komputera. By zainstalować system tą metodą, musimy przygotować dyskietki instalacyjne zgodnie z opisem w <a href=#install-floppies>Przygotowanie dyskietek do instalacji</a>.</p></div><div class=paragraph><p>By zmodyfikować dyskietki do pracy z konsolą szeregową należy wykonać następujące kroki:</p></div><div class="exampleblock procedure"><div class=content><div class="olist arabic"><ol class=arabic><li><p>Włączenie konsoli szeregowej na dyskietce startowej</p><div class=paragraph><p>Jeśli spróbowalibyśmy uruchomić komputer korzystając z utworzonych właśnie dyskietek startowych, zostałaby uruchomiona zwykła instalacja FreeBSD. My jednak chcemy, by podczas instalacji używana była konsola szeregowa. By to skonfigurować, montujemy dyskietkę <span class=filename>kern.flp</span> we FreeBSD przy użyciu polecenia <a href="https://man.freebsd.org/cgi/man.cgi?query=mount&amp;sektion=8&amp;format=html">mount(8)</a>.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mount /dev/fd0 /mnt</span></code></pre></div></div><div class=paragraph><p>Po zamontowaniu dyskietki, wchodzimy do katalogu <span class=filename>/mnt</span>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /mnt</span></code></pre></div></div><div class=paragraph><p>Teraz włączymy na dyskietce konsolę szeregową. Musimy stworzyć plik <span class=filename>boot.config</span> zawierający wiersz <code>/boot/loader -h</code>. Jego zadaniem jest po prostu nakazanie programowi ładującemu system, by używał konsoli szeregowej.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># echo &#34;/boot/loader -h&#34; &gt; boot.config</span></code></pre></div></div><div class=paragraph><p>Po prawidłowym skonfigurowaniu dyskietki odmontowujemy ją poleceniem <a href="https://man.freebsd.org/cgi/man.cgi?query=umount&amp;sektion=8&amp;format=html">umount(8)</a>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /</span>
<span class=c># umount /mnt</span></code></pre></div></div><div class=paragraph><p>Możemy wyjąć dyskietkę ze stacji dyskietek.</p></div></li><li><p>Podłączenie kabla null-modem</p><div class=paragraph><p>Dwa komputery łączymy <a href=./#term-cables-null>kablem null-modem</a>. Po prostu podłączamy kabel do portów szeregowych w jednym i drugim komputerze. <em>Zwykły kabel szeregowy nie nadaje się do tego celu</em>, potrzebny jest kabel null-modem, ponieważ jego przewody są odpowiednio skrzyżowane.</p></div></li><li><p>Uruchomienie instalacji</p><div class=paragraph><p>Możemy już uruchomić instalację. Do stacji dyskietek "bezgłowego" komputera, na którym ma być zainstalowane FreeBSD, wkładamy dyskietkę <span class=filename>kern.flp</span> i włączamy komputer.</p></div></li><li><p>Połączenie z "bezgłowym" komputerem</p><div class=paragraph><p>Z komputerem łączymy się korzystając z <a href="https://man.freebsd.org/cgi/man.cgi?query=cu&amp;sektion=1&amp;format=html">cu(1)</a>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cu -l /dev/cuaa0</span></code></pre></div></div></li></ol></div></div></div><div class=paragraph><p>Gotowe! Powinniśmy być w stanie kontrolować "bezgłowy" komputer poprzez sesję <code>cu</code>. Zostaniemy poproszeni o włożenie dyskietki <span class=filename>mfsroot.flp</span>, nastepnie o wybranie typu terminala. Wybieramy kolorową konsolę FreeBSD (FreeBSD color console) i kontynuujemy instalację.</p></div></div></div><div class=sect2><h3 id=install-diff-media>2.13. Przygotowanie własnego nośnika instalacji<a class=anchor href=#install-diff-media></a></h3><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Dla uproszczenia, w niniejszej części "dysk FreeBSD" oznaczać będzie płytę CDROM lub DVD z FreeBSD, który zakupiliśmy lub przygotowaliśmy samodzielnie.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Może się zdarzyć sytuacja, w której będziemy musieli przygotować własny nośnik lub źródło dla instalacji FreeBSD. Może to być nośnik fizyczny, na przykład taśma, albo inne źródło z którego sysinstall będzie mógł pobrać pliki, na przykład lokalny serwer FTP lub partycja MS-DOS®.</p></div><div class=paragraph><p>Oto przykład:</p></div><div class=ulist><ul><li><p>Mamy wiele komputerów w sieci lokalnej i jeden dysk FreeBSD. Chcemy przygotować lokalny serwer FTP z zawartością dysku FreeBSD, aby komputery mogły z niego korzystać zamiast łączyć się z Internetem.</p></li><li><p>Mamy dysk FreeBSD, jednak FreeBSD nie obsługuje naszego napędu CD/DVD. Napęd jest natomiast prawidłowo obsługiwany w MS-DOS®/Windows®. Chcemy skopiować pliki instalacyjne FreeBSD na partycję DOS i wykorzystać ją do zainstalowania FreeBSD.</p></li><li><p>Komputer, na którym chcemy zainstalować system nie ma napędu CD/DVD ani karty sieciowej. Jest inny komputer, który ma napęd CD/DVD lub kartę sieciową i możemy połączyć się z nim kablem szeregowym lub równoległym.</p></li><li><p>Chcemy przygotować taśmę, przy pomocy której będzie można zainstalować FreeBSD.</p></li></ul></div><div class=sect3><h4 id=install-cdrom>2.13.1. Przygotowanie płyty instalacyjnej<a class=anchor href=#install-cdrom></a></h4><div class=paragraph><p>W ramach każdego wydania systemu Projekt FreeBSD udostępnia pięć obrazów płyt CD ("obrazów ISO"). Jeśli dysponujemy nagrywarką CD, możemy je nagrać ("wypalić") na płytach, otrzymując zestaw płyt, które mogą posłużyć do zainstalowania systemu. Jest to najprostszy sposób instalacji FreeBSD w przypadku, gdy mamy nagrywarkę i tanie połączenie z Internetem.</p></div><div class="exampleblock procedure"><div class=content><div class="olist arabic"><ol class=arabic><li><p>Pobranie obrazów ISO</p><div class=paragraph><p>Obrazy ISO każdego z wydań systemu można pobrać z <span class=filename><a href=ftp://ftp.FreeBSD.org/pub/FreeBSD/ISO-IMAGES-arch/version class=bare>ftp://ftp.FreeBSD.org/pub/FreeBSD/ISO-IMAGES-arch/version</a></span> lub z najbliższego serwera lustrzanego. W miejscu <em>arch</em> i <em>version</em> wstawiamy odpowiednią nazwę architektury i wersję.</p></div><div class=paragraph><p>Wspomniany katalog zawiera zwykle następujące obrazy:</p></div><table class="tableblock frame-none grid-all stretch"><caption class=title>Tabela 5. Nazwy obrazów ISO dla FreeBSD 4.<em>X</em> i ich znaczenie</caption><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">Nazwa pliku</th><th class="tableblock halign-left valign-top">Zawartość</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>version-RELEASE-arch-miniinst.iso</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Wszystko, co jest potrzebne do zainstalowania FreeBSD.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>version-RELEASE-arch-disc1.iso</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Wszystko, co jest potrzebne do zainstalowania FreeBSD, i tyle dodatkowych pakietów, ile zmieściło się na płycie.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>version-RELEASE-arch-disc2.iso</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>"Żywy system plików", używany wraz z dostępną w sysinstall funkcją "Repair" (naprawa). Kopia drzewa CVS FreeBSD. Dodatkowe pakiety o charakterze niezależnym.</p></td></tr></tbody></table><table class="tableblock frame-none grid-all stretch"><caption class=title>Tabela 6. Nazwy obrazów ISO dla FreeBSD 5.<em>X</em> i ich znaczenie</caption><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">Nazwa pliku</th><th class="tableblock halign-left valign-top">Zawartość</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>version-RELEASE-arch-bootonly.iso</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Wszystko co jest niezbędne by uruchomić jądro FreeBSD i rozpocząć instalację. Pliki instalacyjne zostaną probrane z serwera FTP bądź innego źródła.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>version-RELEASE-arch-miniinst.iso</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Wszystko, co jest potrzebne do zainstalowania FreeBSD.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>version-RELEASE-arch-disc1.iso</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Wszystko co jest potrzebne by zainstalować FreeBSD jako "żywy system plików" używany wraz z dostępną w sysinstall funkcją "Repair" (naprawa).</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>version-RELEASE-arch-disc2.iso</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Dokumentacja FreeBSD i tyle dodatkowych pakietów, ile zmieściło się na płycie.</p></td></tr></tbody></table><div class=paragraph><p><em>Musimy</em> pobrać albo obraz ISO mini, albo obraz pierwszej płyty. Nie ma sensu pobierać obydwu, ponieważ obraz pierwszej płyty zawiera wszystko to, co obraz mini.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Obraz ISO mini dostępny jest tylko dla wydań starszych niż FreeBSD 5.4-RELEASE.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Z obrazu ISO miniinst warto jest skorzystać, gdy mamy niedrogi dostęp do Internetu. Za jego pomocą możemy zainstalować FreeBSD, natomiast niezależne oprogramowanie instalujemy przez Internet, przy pomocy systemu portów i pakietów (patrz: <a href=./#ports>Instalacja programów. pakiety i porty</a>).</p></div><div class=paragraph><p>Płytę pierwszą wybieramy wtedy, gdy oprócz zainstalowania systemu chcemy skorzystać z zestawu wybranych pakietów oprogramowania.</p></div><div class=paragraph><p>Pozostałe płyty są przydatne, lecz nie niezbędne, szczególnie, gdy dysponujemy szybkim dostępem do Internetu.</p></div></li><li><p>Nagranie płyt CD</p><div class=paragraph><p>Pliki obrazów należy nagrać na płyty. Jeśli zamierzamy robić to w systemie FreeBSD, informacje na ten temat znajdziemy w <a href=./#creating-cds>Creating and Using Optical Media (CDs)</a> (w szczególności <a href=./#burncd>burncd</a> oraz <a href=./#cdrecord>cdrecord</a>).</p></div><div class=paragraph><p>Jeżeli płyty nagrywać będziemy w innym systemie, do tego celu możemy posłużyć się dowolnymi dostępnymi programami obsługującymi nagrywarkę płyt CD. ISO jest standardowym formatem obrazu płyt obsługiwanym w wielu aplikacjach nagrywających.</p></div></li></ol></div></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Zainteresowanych przygotowaniem własnych wydań FreeBSD odsyłamy do artykułu <a href=https://docs.freebsd.org/en/articles/releng/>Release Engineering</a>(ang.).</p></div></td></tr></tbody></table></div></div><div class=sect3><h4 id=install-ftp>2.13.2. Przygotowanie lokalnego serwera FTP z dyskiem FreeBSD<a class=anchor href=#install-ftp></a></h4><div class=paragraph><p>Układ plików na dysku FreeBSD jest taki sam, jak układ plików na serwerze FTP. Dzięki temu łatwo możemy przygotować lokalny serwer FTP, który może być wykorzystany przez inne komputery w sieci do instalacji FreeBSD.</p></div><div class="exampleblock procedure"><div class=content><div class="olist arabic"><ol class=arabic><li><p>Na komputerze, który będzie służyć jako serwer FTP, umieszczamy CDROM w napędzie i montujemy go w katalogu <span class=filename>/cdrom</span>.</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mount /cdrom</span></code></pre></div></div></li><li><p>Zakładamy konto dla anonimowego użytkownika FTP w <span class=filename>/etc/passwd</span>. Plik <span class=filename>/etc/passwd</span> modyfikujemy przy użyciu <a href="https://man.freebsd.org/cgi/man.cgi?query=vipw&amp;sektion=8&amp;format=html">vipw(8)</a>. Dodajemy następujący wiersz:</p><div class="literalblock programlisting"><div class=content><pre>ftp:*:99:99::0:0:FTP:/cdrom:/nonexistent</pre></div></div></li><li><p>Na koniec upewniamy się, że usługa FTP jest włączona w <span class=filename>/etc/inetd.conf</span>.</p></li></ol></div></div></div><div class=paragraph><p>Od tej chwili każdy, kto jest w stanie nawiązać połączenie z naszym komputerem, może podczas instalacji FreeBSD wybrać jako źródło serwer FTP, w menu wyboru serwera FTP wybrać opcję "Other" (inny) i wpisać <code><a href=ftp://nasz.komputer class=bare>ftp://nasz.komputer</a></code>.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Jeśli nośnik, z którego uruchamiamy instalator (najczęściej dyskietka), nie pochodzi z dokładnie tej samej wersji co pliki na naszym serwerze FTP, to sysinstall nie pozwoli nam kontynuować instalacji. By pominąć tą blokadę należy w menu <b class=menuref>Options</b> zmienić nazwę dystrybucji na <span class=guimenuitem>any</span>.</p></div></td></tr></tbody></table></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>Ta metoda może być z powodzeniem stosowana na komputerze w sieci lokalnej, chronionym przez zaporę ogniową. Udostępnianie serwera FTP innym użytkownikom Internetu (a nie tylko sieci lokalnej) naraża nasz komputer na ataki włamywaczy i inne problemy. Decydując się na to należy koniecznie przestrzegać zasad bezpieczeństwa.</p></div></td></tr></tbody></table></div></div><div class=sect3><h4 id=_przygotowywanie_dyskietek_instalacyjnych>2.13.3. Przygotowywanie dyskietek instalacyjnych<a class=anchor href=#_przygotowywanie_dyskietek_instalacyjnych></a></h4><div class=paragraph><p>Jeżeli koniecznie chcemy instalować system z dyskietek (co <em>nie jest</em> zalecane), na przykład z powodu nieobsługiwanego urządzenia lub po prostu z zamiłowania do utrudnień, musimy najpierw przygotować dyskietki instalacyjne.</p></div><div class=paragraph><p>Będziemy potrzebować co najmniej tylu dyskietek 1.44 MB lub 1.2 MB, by zmieściły się na nich wszystkie pliki z katalogu <span class=filename>bin</span> (binarne pliki dystrybucyjne). Jeśli dyskietki przygotowujemy w DOS-ie, to <em>muszą</em> one być sformatowane przy pomocy DOS-owego polecenia <code>FORMAT</code>. W Windows® do sformatowania dyskietek możemy użyć Explorera (klikamy prawym przyciskiem myszy na stacji <span class=filename>A:</span> i wybieramy "Format").</p></div><div class=paragraph><p><em>Nie ufajmy</em> dyskietkom sformatowanym fabrycznie. Dla pewności sformatujmy je jeszcze raz samodzielnie. W przeszłości wiele problemów zgłaszanych przez użytkowników spowodowanych było korzystaniem z nieprawidłowo sformatowanych dyskietek, dlatego też zwracamy na to uwagę.</p></div><div class=paragraph><p>Jeżeli do przygotowania dyskietek służy nam komputer z FreeBSD, również powinniśmy je sformatować. Dyskietki nie muszą być formatowane w DOS-owym systemie plików. Możemy utworzyć na nich system plików UFS, za pomocą poleceń <code>bsdlabel</code> i <code>newfs</code>, wywołanych w następujący sposób (na przykładzie dyskietek 3.5" 1.44 MB):</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># fdformat -f 1440 fd0.1440</span>
<span class=c># bsdlabel -w -r fd0.1440 floppy3</span>
<span class=c># newfs -t 2 -u 18 -l 1 -i 65536 /dev/fd0</span></code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>W przypadku dyskietek 5.25" 1.2 MB, wpisalibyśmy odpowiednio <code>fd0.1200</code> i <code>floppy5</code>.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Po takiej operacji dyskietki będzie można zamontować i zapisywać na nich dane tak samo, jak na innych systemach plików.</p></div><div class=paragraph><p>Po sformatowaniu dyskietek należy skopiować na nie pliki. Pliki dystrybucyjne podzielone są na kawałki o wygodnych rozmiarach, tak aby pięć z nich mieściło się na typowej dyskietce 1.44 MB. Umieśćmy na każdej z dyskietek tyle plików, ile się zmieści, aż wszystkie pliki dystrybucyjne znajdą się na dyskietkach. Pliki powinny być umieszczone w odpowiednim katalogu na dyskietce, np.: <span class=filename>a:\bin\bin.aa</span>, <span class=filename>a:\bin\bin.ab</span>, itd.</p></div><div class=paragraph><p>Podczas instalacji, gdy pojawi się ekran wyboru nośnika (Media), wybieramy <span class=guimenuitem>Floppy</span> (dyskietki). Dalej poprowadzi nas program instalacyjny.</p></div></div><div class=sect3><h4 id=install-msdos>2.13.4. Instalacja z partycji MS-DOS®<a class=anchor href=#install-msdos></a></h4><div class=paragraph><p>By można było zainstalować FreeBSD z partycji MS-DOS®, kopiujemy pliki dystrybucyjne do katalogu <span class=filename>freebsd</span> w głównym katalogu partycji - na przykład <span class=filename>c:\freebsd</span>. Wewnątrz tego katalogu musi być częściowo zachowana struktura katalogów płyty CDROM lub serwera FTP, jeśli więc kopiujemy pliki z płyty CD, dobrze jest skorzystać z DOS-owego polecenia <code>xcopy</code>. Dla przykładu, poniższe polecenia przygotują minimalną instalację FreeBSD:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>C:<span class=se>\&gt;</span> md c:<span class=se>\f</span>reebsd
C:<span class=se>\&gt;</span> xcopy e:<span class=se>\b</span><span class=k>in </span>c:<span class=se>\f</span>reebsd<span class=se>\b</span><span class=k>in</span><span class=se>\ </span>/s
C:<span class=se>\&gt;</span> xcopy e:<span class=se>\m</span>anpages c:<span class=se>\f</span>reebsd<span class=se>\m</span>anpages<span class=se>\ </span>/s</code></pre></div></div><div class=paragraph><p>W przykładzie założyliśmy, że miejsce dla FreeBSD mamy na dysku <span class=filename>C:</span>, a napęd CDROM dostępny jest jako dysk <span class=filename>E:</span>.</p></div><div class=paragraph><p>Jeśli nie dysponujemy napędem CDROM, pliki dystrybucyjne możemy pobrać z <a href=ftp://ftp.FreeBSD.org/pub/FreeBSD/releases/i386/12.0-RELEASE/>ftp.FreeBSD.org</a>. Każdy zestaw plików umieszczony jest w oddzielnym katalogu; na przykład zestaw <em>base</em> znajduje się w katalogu <a href=ftp://ftp.FreeBSD.org/pub/FreeBSD/releases/i386/12.0-RELEASE/base/>12.0/base/</a>.</p></div><div class=paragraph><p>Zestawy plików, które chcemy instalować z partycji MS-DOS® (i dla których jest na niej odpowiednio dużo wolnego miejsca), umieszczamy w katalogu <span class=filename>c:\freebsd</span>. Na potrzeby instalacji minimalnej wystarczy zestaw <code>BIN</code>.</p></div></div><div class=sect3><h4 id=_przygotowanie_taśmy_instalacyjnej>2.13.5. Przygotowanie taśmy instalacyjnej<a class=anchor href=#_przygotowanie_taśmy_instalacyjnej></a></h4><div class=paragraph><p>Instalacja z taśmy jest jedną z najprostszych metod, obok instalacji przez FTP i instalacji z płyty CD. Program instalacyjny zakłada, że taśma po prostu zawiera pliki w postaci archiwum tar. Interesujące nas pliki dystrybucyjne archiwizujemy na taśmie:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /freebsd/distdir</span>
<span class=c># tar cvf /dev/rwt0 dist1 ... dist2</span></code></pre></div></div><div class=paragraph><p>Przeprowadzając instalację powinniśmy upewnić się, że dysponujemy odpowiednią ilością wolnego miejsca w jakimś katalogu tymczasowym (będziemy mieć możliwość wyboru tego katalogu), by pomieścić <em>pełną</em> zawartość przygotowanej wcześniej taśmy. Ze względu na to, że dostęp do danych na taśmie nie jest swobodny, taki rodzaj instalacji będzie wymagać dość sporej przestrzeni tymczasowej. Można założyć, że potrzeba będzie tyle przestrzeni, ile zajmują dane zapisane na taśmie.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Rozpoczynając instalację pamiętajmy, by taśma była umieszczona w napędzie <em>przed</em> uruchomieniem komputera z dyskietki startowej. W przeciwnym razie napęd taśmowy może nie zostać wykryty podczas rozpoznawania urządzeń.</p></div></td></tr></tbody></table></div></div><div class=sect3><h4 id=_przed_instalacją_przez_sieć>2.13.6. Przed instalacją przez sieć<a class=anchor href=#_przed_instalacją_przez_sieć></a></h4><div class=paragraph><p>Są trzy możliwości instalacji przez sieć: port szeregowy (SLIP lub PPP), port równoległy (PLIP (kabel laplink)) lub Ethernet (typowa karta sieciowa Ethernet (także PCMCIA)).</p></div><div class=paragraph><p>Obsługa protokołu SLIP jest dosyć prymitywna i ogranicza się do bezpośrednich połączeń, jak choćby kabel łączący komputer przenośny z innym komputerem. Połączenie musi być bezpośrednie, ponieważ instalacja za pośrednictwem SLIP nie umożliwia dzwonienia; jest to możliwe w przypadku PPP, dlatego też powinno się używać PPP zamiast SLIP, o ile to możliwe.</p></div><div class=paragraph><p>Jeżeli korzystamy z modemu, to PPP jest najprawdopodobniej jedyną możliwością. Zawczasu przygotujmy sobie informacje od dostawcy usług sieciowych, ponieważ będą nam one potrzebne na wczesnym etapie instalacji.</p></div><div class=paragraph><p>Jeśli łącząc się z dostawcą usług sieciowych używamy PAP lub CHAP (innymi słowy, jeśli w Windows® możemy uzyskać połączenie bez korzystania ze skryptu), wówczas wystarczy, że w linii poleceń ppp wpiszemy <code>dial</code>. W przeciwnym razie będziemy musieli połączyć się z dostawcą usług sieciowych za pomocą "poleceń AT", zależnych od typu modemu, gdyż do dyspozycji będziemy mieć jedynie uproszczony emulator terminala. Więcej informacji znajdziemy w poświęconych user-ppp częściach <a href=./#userppp>Podręcznika</a> i <a href=https://docs.freebsd.org/en/books/faq/#ppp>FAQ</a>. Jeśli wystąpią problemy, możemy posłużyć się poleceniem <code>set log local …​</code>, by komunikaty były pokazywane na ekranie.</p></div><div class=paragraph><p>Jeżeli dysponujemy bezpośrednim połączeniem z innym komputerem z FreeBSD (w wersji 2.0-R lub późniejszej), wówczas mamy również możliwość instalacji przez port równoległy. Prędkość transmisji danych portem równoległym jest zwykle znacznie wyższa niż prędkość przesyłania portem szeregowym (do 50 kilobajtów/sekundę), dzięki czemu instalacja przebiega szybciej.</p></div><div class=paragraph><p>Najszybszym wariantem instalacji poprzez sieć jest wykorzystanie karty sieciowej Ethernet. FreeBSD obsługuje większość popularnych kart sieciowych; lista obsługiwanych kart (wraz z ich ustawieniami) znajduje się w dokumencie Hardware Notes, dołączonym do każdego wydania FreeBSD. Jeżeli korzystamy z karty sieciowej PCMCIA, pamiętajmy o tym, by była ona włożona <em>przed</em> włączeniem komputera. Niestety, jak dotąd FreeBSD nie obsługuje wkładania kart PCMCIA w trakcie instalacji.</p></div><div class=paragraph><p>Będziemy musieli znać nasz adres IP, maskę podsieci, oraz nazwę naszego komputera. Jeśli instalujemy za pośrednictwem PPP i nie mamy statycznego adresu IP, nie musimy się przejmować, gdyż adres IP może być przydzielony dynamicznie przez dostawcę usług. Administrator sieci może nam podpowiedzieć, jakie parametry podać podczas konfiguracji sieci. Jeśli do połączeń z innymi stacjami będziemy używać ich nazw, a nie adresów IP, to dodatkowo będziemy musieli znać adres serwera nazw i prawdopodobnie adres bramy (w przypadku PPP jest to adres IP dostawcy). Jeżeli mamy zamiar instalować za pośrednictwem FTP i proxy HTTP, będzie nam ponadto potrzebny adres proxy. Skontaktujmy się z administratorem sieci lub dostawcą usług sieciowych <em>przed</em> rozpoczęciem instalacji, jeśli nie znamy któregoś z wymienionych powyżej adresów.</p></div><div class=sect4><h5 id=_przed_instalacją_przez_nfs>2.13.6.1. Przed instalacją przez NFS<a class=anchor href=#_przed_instalacją_przez_nfs></a></h5><div class=paragraph><p>Instalacja przez NFS jest raczej mało skomplikowana. Wystarczy po prostu skopiować wybrane pliki dystrybucyjne na serwer, następnie podczas instalacji wybrać NFS jako nośnik i wskazać serwer.</p></div><div class=paragraph><p>Jeżeli serwer wymaga stosowania "uprzywilejowanego portu" (zwykle jest tak w przypadku stacji roboczych Sun), musimy to zaznaczyć w menu <b class=menuref>Options</b> (opcja <code>NFS Secure</code>), zanim rozpoczniemy instalację.</p></div><div class=paragraph><p>Jeśli nasza karta sieciowa jest niezbyt dobrej jakości i nie grzeszy prędkością, możemy włączyć opcję <code>NFS Slow</code>.</p></div><div class=paragraph><p>Instalacja przez NFS wymaga, by serwer obsługiwał montowanie podkatalogów, na przykład jeśli katalog dystrybucyjny FreeBSD 12.0 znajduje się w: <span class=filename>ziggy:/usr/archive/stuff/FreeBSD</span>, to serwer <code>ziggy</code> musi umożliwiać bezpośrednie montowanie katalogu <span class=filename>/usr/archive/stuff/FreeBSD</span>, a nie tylko <span class=filename>/usr</span>, lub <span class=filename>/usr/archive/stuff</span>.</p></div><div class=paragraph><p>We FreeBSD w pliku <span class=filename>/etc/exports</span> możliwość montowania podkatalogów włącza się opcją <code>-alldirs</code>. W innych serwerach NFS może być inaczej. Jeśli otrzymujemy od serwera komunikaty o treści "permission denied" (odmowa dostępu), prawdopodobnie jest to spowodowane właśnie nieprawidłowym ustawieniem wspomnianej opcji.</p></div></div></div></div></div></div><div class=sect1><h2 id=basics>Rozdział 3. Podstawy Uniksa<a class=anchor href=#basics></a></h2><div class=sectionbody><div class=sect2><h3 id=basics-synopsis>3.1. Streszczenie<a class=anchor href=#basics-synopsis></a></h3><div class=paragraph><p>W niniejszym rozdziale omówione zostaną podstawowe polecenia i możliwości systemu operacyjnego FreeBSD. Wiele informacji dotyczyć będzie ogółem systemów typu UNIX®. Czytelnikom zaznajomionym z tą tematyką w zupełności wystarczy pobieżne przejrzenie rozdziału. Natomiast ci, którzy dopiero rozpoczynają swoją przygodę z FreeBSD, powinni przeczytać go bardzo uważnie.</p></div><div class=paragraph><p>Po przeczytaniu tego rozdziału będziemy wiedzieć:</p></div><div class=ulist><ul><li><p>Jak korzystać z "konsol wirtualnych" FreeBSD.</p></li><li><p>Jak działają prawa dostępu do plików i flagi plików we FreeBSD.</p></li><li><p>Jaki jest domyślny układ systemu plików FreeBSD.</p></li><li><p>Jaka jest organizacja dysku we FreeBSD.</p></li><li><p>Jak montować i odmontowywać systemy plików.</p></li><li><p>Czym są procesy, demony i sygnały.</p></li><li><p>Co to jest powłoka, oraz jak można zmienić własne środowisko pracy.</p></li><li><p>Jak posługiwać się prostymi edytorami tekstu.</p></li><li><p>Jaki jest związek pomiędzy urządzeniami i plikami węzłowymi urządzeń.</p></li><li><p>Jaki format binarny jest wykorzystywany we FreeBSD.</p></li><li><p>W jaki sposób korzystać z dokumentacji systemowej w poszukiwaniu dodatkowych informacji.</p></li></ul></div></div><div class=sect2><h3 id=consoles>3.2. Konsole wirtualne i terminale<a class=anchor href=#consoles></a></h3><div class=paragraph><p>Z systemu FreeBSD korzystać można na różne sposoby; jednym z nich jest wpisywanie poleceń w terminalu tekstowym. Większość systemów operacyjnych typu UNIX® dostępna jest właśnie poprzez polecenia. W niniejszej części dowiemy się, czym są "terminale" i "konsole", oraz jak się nimi posługiwać we FreeBSD.</p></div><div class=sect3><h4 id=consoles-intro>3.2.1. Konsola<a class=anchor href=#consoles-intro></a></h4><div class=paragraph><p>Jeśli konfigurując FreeBSD nie wybraliśmy, by przy uruchamianiu systemu było automatycznie ładowane środowisko graficzne, to po uruchomieniu i wykonaniu skryptów startowych system przywita nas komunikatem logowania się do systemu. Zobaczymy mniej więcej coś takiego:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>Additional ABI support:.
Local package initialization:.
Additional TCP options:.

Fri Sep 20 13:01:06 EEST 2002

FreeBSD/i386 <span class=o>(</span>pc3.example.org<span class=o>)</span> <span class=o>(</span>ttyv0<span class=o>)</span>

login:</code></pre></div></div><div class=paragraph><p>Na różnych komputerach komunikat ten może wyglądać nieco inaczej, jednak z pewnością będzie podobny. W tej chwili interesują nas jego dwa ostatnie wiersze. Wiersz drugi od końca ma postać:</p></div><div class="literalblock programlisting"><div class=content><pre>FreeBSD/i386 (pc3.example.org) (ttyv0)</pre></div></div><div class=paragraph><p>Widać tu kilka informacji o systemie, który właśnie został uruchomiony. Mamy przed oczami konsolę "FreeBSD", działającą na komputerze z procesorem firmy Intel (lub kompatybilnym) z rodziny x86. Komputer ten został nazwany (każdy komputer uniksowy ma nazwę) <code>pc3.example.org</code> i w tej chwili widoczna jest jego konsola systemowa - terminal <span class=filename>ttyv0</span>.</p></div><div class=paragraph><p>Ostatni wiersz ma zawsze taką postać:</p></div><div class="literalblock programlisting"><div class=content><pre>login:</pre></div></div><div class=paragraph><p>Tu wpisujemy "nazwę użytkownika", by zalogować się do systemu. Opis tej czynności przedstawiony jest w kolejnej części.</p></div></div><div class=sect3><h4 id=consoles-login>3.2.2. Logowanie się do FreeBSD<a class=anchor href=#consoles-login></a></h4><div class=paragraph><p>FreeBSD jest systemem wieloużytkownikowym i wielozadaniowym. Tak oficjalnie określa się system, z którego na jednym komputerze może korzystać wiele różnych osób, uruchamiając jednocześnie wiele programów.</p></div><div class=paragraph><p>Każdy system wieloużytkownikowy musi mieć możliwość odróżnienia jednego "użytkownika" od pozostałych. FreeBSD (i wszystkie systemy uniksopodobne) wymaga, aby użytkownik "zalogował się" do systemu, zanim będzie mógł uruchamiać programy. Każdy użytkownik ma niepowtarzalną nazwę ("nazwę użytkownika") oraz sobie tylko znany klucz ("hasło"). FreeBSD wymaga wpisania jednego i drugiego, zanim zezwoli użytkownikowi na uruchamianie jakichkolwiek programów.</p></div><div class=paragraph><p>Zaraz po załadowaniu systemu i zakończeniu uruchamiania skryptów startowych, FreeBSD wyświetli komunikat z prośbą o podanie nazwy użytkownika:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>login:</code></pre></div></div><div class=paragraph><p>Dla przykładu załóżmy, że nasz użytkownik nazywa się <code>janek</code>. Wpisujemy tutaj <code>janek</code> i naciskamy <kbd>Enter</kbd>. Powinniśmy zostać poproszeni o podanie "hasła":</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>login: janek
Password:</code></pre></div></div><div class=paragraph><p>Następnie wpisujemy hasło <code>janka</code>, i naciskamy <kbd>Enter</kbd>. Hasło <em>nie pojawia się!</em> Na razie nie będziemy się tym zajmować. Wystarczy wiedzieć, że dzieje się tak ze względów bezpieczeństwa.</p></div><div class=paragraph><p>Jeśli podaliśmy prawidłowe hasło, powinniśmy być już zalogowani do FreeBSD, i gotowi do eksperymentowania z dostępnymi poleceniami.</p></div><div class=paragraph><p>Powinniśmy zobaczyć wiadomość dnia (ang. message of the day MOTD) oraz znak zachęty (<code>#</code>, <code>$</code> bądź <code>%</code>). Oznacza to, że udało nam się zalogować do FreeBSD.</p></div></div><div class=sect3><h4 id=consoles-virtual>3.2.3. Konsole wirtualne<a class=anchor href=#consoles-virtual></a></h4><div class=paragraph><p>Polecenia uniksowe można z powodzeniem wpisywać na jednej konsoli, jednak FreeBSD potrafi wykonywać wiele programów jednocześnie. Korzystanie z jednej konsoli do wydawania poleceń zakrawa na marnotrawstwo, ponieważ system zdolny jest obsłużyć w jednej chwili całe mnóstwo programów. W wykorzystaniu tej możliwości bardzo pomocne są "konsole wirtualne".</p></div><div class=paragraph><p>Konfigurując FreeBSD możemy uaktywnić wiele konsol wirtualnych. Z dowolnej z nich możemy się przełączyć na inną naciskając odpowiednią kombinację klawiszy. Każda konsola ma własny kanał wyjściowy, FreeBSD zajmuje się odpowiednim przekazywaniem informacji wprowadzanych z klawiatury i wypisywanych na ekranie, gdy dochodzi do przełączenia konsoli na inną.</p></div><div class=paragraph><p>Pewne kombinacje klawiszy używane są do przechodzenia między konsolami. Kombinacje <span class=keyseq><kbd>Alt</kbd>+<kbd>F1</kbd></span>, <span class=keyseq><kbd>Alt</kbd>+<kbd>F2</kbd></span>, aż do <span class=keyseq><kbd>Alt</kbd>+<kbd>F8</kbd></span> służą do przełączania na kolejną konsolę wirtualną.</p></div><div class=paragraph><p>Przechodząc z jednej konsoli na inną, FreeBSD zajmuje się zachowaniem i odtworzeniem wyglądu ekranu. W efekcie otrzymujemy "złudzenie" posiadania wielu "wirtualnych" ekranów i klawiatur, które mogą służyć do wydawania poleceń systemowi FreeBSD. Programy uruchomione na jednej z konsol nie przerywają swej pracy, gdy ta konsola przestaje być widoczna - po przejściu na inną konsolę wirtualną programy kontynuują swoje działanie.</p></div></div><div class=sect3><h4 id=consoles-ttys>3.2.4. Plik <span class=filename>/etc/ttys</span><a class=anchor href=#consoles-ttys></a></h4><div class=paragraph><p>Zgodnie z domyślną konfiguracją FreeBSD uruchamia osiem konsol wirtualnych. Nie jest to jednak permanentne ustawienie, i może być w łatwy sposób zmienione, aby konsol wirtualnych było więcej lub mniej. Plik <span class=filename>/etc/ttys</span> odpowiedzialny jest za liczbę konsol wirtualnych i ich konfigurację.</p></div><div class=paragraph><p>Modyfikując plik <span class=filename>/etc/ttys</span> możemy zmieniać konfigurację konsol wirtualnych FreeBSD. Każdy nie będący komentarzem wiersz tego pliku (czyli wiersz nie rozpoczynający się znakiem <code>#</code>) zawiera ustawienia jednego z terminali lub konsoli wirtualnej. W domyślnej wersji tego pliku występującej we FreeBSD skonfigurowanych jest 9 konsol wirtualnych, przy czym 8 z nich jest włączonych. Za ich konfigurację odpowiadają wiersze rozpoczynające się symbolem <code>ttyv</code>:</p></div><div class="literalblock programlisting"><div class=content><pre># name  getty                           type    status          comments
#
ttyv0   &#34;/usr/libexec/getty Pc&#34;         cons25  on  secure
# Virtual terminals
ttyv1   &#34;/usr/libexec/getty Pc&#34;         cons25  on  secure
ttyv2   &#34;/usr/libexec/getty Pc&#34;         cons25  on  secure
ttyv3   &#34;/usr/libexec/getty Pc&#34;         cons25  on  secure
ttyv4   &#34;/usr/libexec/getty Pc&#34;         cons25  on  secure
ttyv5   &#34;/usr/libexec/getty Pc&#34;         cons25  on  secure
ttyv6   &#34;/usr/libexec/getty Pc&#34;         cons25  on  secure
ttyv7   &#34;/usr/libexec/getty Pc&#34;         cons25  on  secure
ttyv8   &#34;/usr/X11R6/bin/xdm -nodaemon&#34;  xterm   off secure</pre></div></div><div class=paragraph><p>Dokładny opis poszczególnych kolumn tego pliku i opcji, za pomocą których konfiguruje się konsole wirtualne, znaleźć można w dokumentacji systemowej <a href="https://man.freebsd.org/cgi/man.cgi?query=ttys&amp;sektion=5&amp;format=html">ttys(5)</a>.</p></div></div><div class=sect3><h4 id=consoles-singleuser>3.2.5. Konsola trybu jednego użytkownika<a class=anchor href=#consoles-singleuser></a></h4><div class=paragraph><p>"Tryb jednego użytkownika" szczegółowo opisuje <a href=./#boot-singleuser>Single-User Mode</a>. Istotne jest, że w trybie jednego użytkownika dostępna jest tylko jedna konsola. Nie jest możliwe korzystanie z konsol wirtualnych. Konfiguracja konsoli trybu jednego użytkownika również znajduje się w pliku <span class=filename>/etc/ttys</span>. Odpowiada jej wiersz rozpoczynający się słowem <code>console</code>:</p></div><div class="literalblock programlisting"><div class=content><pre># name  getty                           type    status          comments
#
# If console is marked &#34;insecure&#34;, then init will ask for the root password
# when going to single-user mode.
console none                            unknown off secure</pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Zgodnie z informacją zawartą w komentarzu nad wierszem <code>console</code>, wiersz ten można zmodyfikować, zmieniając parametr <code>secure</code> na <code>insecure</code>. Jeśli tak zrobimy, FreeBSD po uruchomieniu w trybie jednego użytkownika będzie pytać o hasło użytkownika <code>root</code>.</p></div><div class=paragraph><p>Zachowajmy jednak ostrożność, jeśli wpisujemy tu <code>insecure</code>. Jeżeli zdarzy się nam zapomnieć hasła użytkownika <code>root</code>, może okazać się potrzebne uruchomienie trybu jednego użytkownika. Będzie to nadal możliwe, może jednak być nieco trudne dla osób nie orientujących się w procesie uruchamiania FreeBSD i uczestniczących w nim programach.</p></div></td></tr></tbody></table></div></div></div><div class=sect2><h3 id=permissions>3.3. Prawa dostępu<a class=anchor href=#permissions></a></h3><div class=paragraph><p>FreeBSD, będąc bezpośrednim potomkiem systemu UNIX® BSD, oparte jest na kilku kluczowych założeniach Uniksa. Najbardziej widocznym z nich jest fakt, że FreeBSD jest systemem wieloużytkownikowym - potrafi jednocześnie obsługiwać wielu użytkowników pracujących niezależnie od siebie. System jest odpowiedzialny za właściwe zarządzanie odwołaniami do sprzętu, pamięci i czasu procesora, po równo dla każdego z użytkowników.</p></div><div class=paragraph><p>Ze względu na obsługę wielu użytkowników, zasoby, którymi zarządza system, mają przypisane prawa dostępu określające, kto może czytać, zapisywać i uruchamiać dany zasób. Prawa dostępu przechowywane są w postaci dwóch oktetów podzielonych na trzy części, z których pierwsza odnosi sie do właściciela pliku, druga do grupy posiadającej plik, a trzecia do innych użytkowników. W postaci numerycznej zapisuje się to następująco:</p></div><table class="tableblock frame-none grid-all stretch informaltable"><col style=width:33.3333%><col style=width:33.3333%><col style=width:33.3334%><thead><tr><th class="tableblock halign-left valign-top">Wartość</th><th class="tableblock halign-left valign-top">Uprawnienia</th><th class="tableblock halign-left valign-top">Symbol</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock>0</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Odczyt: nie, zapis: nie, wykonywanie: nie</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>---</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>1</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Odczyt: nie, zapis: nie, wykonywanie: tak</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>--x</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>2</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Odczyt: nie, zapis: tak, wykonywanie: nie</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>-w-</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>3</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Odczyt: nie, zapis: tak, wykonywanie: tak</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>-wx</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>4</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Odczyt: tak, zapis: nie, wykonywanie: nie</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>r--</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>5</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Odczyt: tak, zapis: nie, wykonywanie: tak</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>r-x</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>6</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Odczyt: tak, zapis: tak, wykonywanie: nie</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>rw-</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>7</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Odczyt: tak, zapis: tak, wykonywanie: tak</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>rwx</code></p></td></tr></tbody></table><div class=paragraph><p>Korzystając z polecenia <a href="https://man.freebsd.org/cgi/man.cgi?query=ls&amp;sektion=1&amp;format=html">ls(1)</a> możemy posłużyć się opcją <code>-l</code>, by zawartość katalogu została pokazana w formie szczegółowej, z uwzględnieniem kolumny zawierającej informację o prawach dostępu do pliku dla jego właściciela, grupy, oraz wszystkich innych. Przykładowy wynik polecenia <code>ls -l</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% <span class=nb>ls</span> <span class=nt>-l</span>
total 530
<span class=nt>-rw-r--r--</span>  1 root  wheel     512 Sep  5 12:31 myfile
<span class=nt>-rw-r--r--</span>  1 root  wheel     512 Sep  5 12:31 otherfile
<span class=nt>-rw-r--r--</span>  1 root  wheel    7680 Sep  5 12:31 email.txt
...</code></pre></div></div><div class=paragraph><p>Pierwsza kolumna listy plików po wykonaniu polecenia <code>ls -l</code> ma następującą postać:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=nt>-rw-r--r--</span></code></pre></div></div><div class=paragraph><p>Pierwszy znak (od lewej) określa, czy plik jest zwyczajnym plikiem, katalogiem, urządzeniem znakowym, gniazdem, czy jakimkolwiek innym urządzeniem pseudo-plikowym. Widoczny w przykładzie znak <code>-</code> oznacza zwykły plik. Kolejne trzy znaki, w przykładzie są to <code>rw-</code>, reprezentują prawa dostępu, którymi dysponuje właściciel pliku. Następne trzy znaki <code>r--</code>, określają prawa dostępu grupy, do której należy plik. Ostatnia trójka <code>r--</code>, oznacza prawa dostępu dla innych. Minus oznacza brak jednego z praw dostępu. Plik przedstawiony w przykładzie może być więc odczytywany i zapisywany przez swojego właściciela, oraz jedynie odczytywany przez grupę i innych. Zgodnie z powyższą tabelą, prawa dostępu do tego pliku mają wartość <code>644</code>, przy czym każda cyfra reprezentuje trzy części uprawnień.</p></div><div class=paragraph><p>W porządku, ale w jaki sposób system kontroluje dostęp do urządzeń? Zasadniczo większość urządzeń jest traktowana przez FreeBSD jak pliki, które mogą być otwierane, odczytywane i zapisywane podobnie jak wszystkie inne pliki. Specjalne pliki urządzeń przechowywane są w katalogu <span class=filename>/dev</span>.</p></div><div class=paragraph><p>Również katalogi traktowane są jak pliki - też są im przypisywane prawa odczytu, zapisu i wykonania. Bit wykonania katalogu ma nieco inne znaczenie niż w przypadku pliku. Posiadanie prawa wykonania katalogu oznacza, że można do niego wejść, czyli posłużyć się poleceniem "cd". Ponadto umożliwia to dostęp do zawartych w katalogu plików o znanych nazwach (oczywiście obowiązują także indywidualne prawa dostępu do każdego z plików).</p></div><div class=paragraph><p>W szczególności, wyświetlenie listy plików katalogu wymaga posiadania prawa do jego odczytu, natomiast do usunięcia pliku o znanej nazwie potrzebne będą prawa do zapisu <em>i</em> wykonania dla katalogu, w którym ów plik się znajduje.</p></div><div class=paragraph><p>Jest jeszcze kilka innych bitów uprawnień, jednak są one stosowane w specjalnych przypadkach, np. do włączenia atrybutu SUID, lub "lepkiego" bitu dla katlogu. Więcej informacji o prawach dostępu i o ich przydzielaniu można znaleźć w dokumentacji systemowej polecenia <a href="https://man.freebsd.org/cgi/man.cgi?query=chmod&amp;sektion=1&amp;format=html">chmod(1)</a>.</p></div><div class=sect3><h4 id=_uprawnienia_symboliczne>3.3.1. Uprawnienia symboliczne<a class=anchor href=#_uprawnienia_symboliczne></a></h4><div class=paragraph><p>Uprawnienia symboliczne, określane również jako wyrażenia symboliczne, przy określaniu praw dostępu do plików lub katalogów wykorzystują litery w miejsce wartości liczbowych. Wyrażenia symboliczne wykorzystują składnię: (kto) (akcja) (uprawnienia), przy czym dostępne są następujące wartości:</p></div><table class="tableblock frame-none grid-all stretch informaltable"><col style=width:33.3333%><col style=width:33.3333%><col style=width:33.3334%><thead><tr><th class="tableblock halign-left valign-top">Opcja</th><th class="tableblock halign-left valign-top">Litera</th><th class="tableblock halign-left valign-top">Znaczenie</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock>(kto)</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>u</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Użytkownik (właściciel)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>(kto)</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>g</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Grupa</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>(kto)</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>o</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Inni</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>(kto)</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>a</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Wszyscy ("świat")</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>(akcja)</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>+</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Dodanie uprawnień</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>(akcja)</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>-</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Usunięcie uprawnień</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>(akcja)</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>=</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Ustawienie uprawnień</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>(uprawnienia)</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>r</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Odczyt</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>(uprawnienia)</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>w</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Zapis</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>(uprawnienia)</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>x</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Wykonywanie</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>(uprawnienia)</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>t</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Bit "lepki"</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>(uprawnienia)</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>s</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Ustawienie UID lub GID</p></td></tr></tbody></table><div class=paragraph><p>Do ustawienia tych wartości, podobnie jak w przypadku wartości liczbowych, wykorzystywane jest polecenie <a href="https://man.freebsd.org/cgi/man.cgi?query=chmod&amp;sektion=1&amp;format=html">chmod(1)</a>. Przykładowo, by zablokować dostęp innych użytkowników do <em>PLIKU</em> należy wpisać:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% <span class=nb>chmod </span><span class=nv>go</span><span class=o>=</span> PLIK</code></pre></div></div><div class=paragraph><p>Gdy musimy wykonać więcej niż jedną zmianę uprawnień parametry należy oddzielić przecinkami. Na przykład, poniższe polecenie usunie prawa zapisu do <em>PLIKU</em> grupie i innym. Następnie doda wszystkim prawo wykonywania:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% <span class=nb>chmod </span>go-w,a+x PLIK</code></pre></div></div></div><div class=sect3><h4 id=_flagi_plików_we_freebsd>3.3.2. Flagi plików we FreeBSD<a class=anchor href=#_flagi_plików_we_freebsd></a></h4><div class=paragraph><p>Dodatkowo, oprócz opisanych wyżej praw dostępu, FreeBSD wykorzystuje również "flagi plików". Flagi te umożliwiają wprowadzenie dodatkowego poziomu ochrony i kontroli plików. Nie dotyczą natomiast katalogów.</p></div><div class=paragraph><p>Dzięki zwiększonemu poziomowi kontroli plików system może zagwarantować, że w niektórych sytuacjach nawet użytkownik <code>root</code> nie będzie mógł usunąć bądź zmodyfikować plików.</p></div><div class=paragraph><p>Zmiany flag plików dokonuje się poleceniem <a href="https://man.freebsd.org/cgi/man.cgi?query=chflags&amp;sektion=1&amp;format=html">chflags(1)</a>. Przykładowo, by plikowi <span class=filename>plik1</span> nadać flagę nieusuwalności należy wydać poniższe polecenie:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># chflags sunlink plik1</span></code></pre></div></div><div class=paragraph><p>Natomiast, by usunąć flagę nieusuwalności wystarczy wprowadzić takie samo polecenie dodając "no" przed <code>sunlink</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># chflags nosunlink plik1</span></code></pre></div></div><div class=paragraph><p>By wyświetlić flagi danego pliku wystarczy wpisać polecenie <a href="https://man.freebsd.org/cgi/man.cgi?query=ls&amp;sektion=1&amp;format=html">ls(1)</a> z parametrem <code>-lo</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ls -lo plik1</span></code></pre></div></div><div class=paragraph><p>Wynik powinien być zbliżony do poniższego:</p></div><div class="literalblock programlisting"><div class=content><pre>-rw-r--r--  1 trhodes  trhodes  sunlnk 0 Mar  1 05:54 plik1</pre></div></div><div class=paragraph><p>Niektóre z flag mogą być dodawane i usuwane jedynie przez użytkownika <code>root</code>, podczas gdy inne mogą być ustawiane również przez właściciela pliku. Zaleca się aby administratorzy przeczytali strony podręcznika systemowego <a href="https://man.freebsd.org/cgi/man.cgi?query=chflags&amp;sektion=1&amp;format=html">chflags(1)</a> oraz <a href="https://man.freebsd.org/cgi/man.cgi?query=chflags&amp;sektion=2&amp;format=html">chflags(2)</a>.</p></div></div></div><div class=sect2><h3 id=dirstructure>3.4. Struktura katalogów<a class=anchor href=#dirstructure></a></h3><div class=paragraph><p>Poznanie hierarchii katalogów FreeBSD jest podstawą ogólnego zrozumienia działania systemu. Najważniejszym zagadnieniem jest koncepcja katalogu głównego, "/". Jest on montowany jako pierwszy podczas uruchamiania systemu i zawiera podstawowe pliki niezbędne do przygotowania systemu do pracy w trybie wieloużytkownikowym. Ponadto w katalogu głównym znajdują się punkty montowania innych systemów plików, które możemy montować.</p></div><div class=paragraph><p>Punktem montowania nazywany jest katalog, poprzez który inny system plików może być dołączony do głównego systemu plików. <a href=#disk-organization>Organizacja dysku</a> zawiera więcej informacji. Przykładem typowego punktu montowania może być <span class=filename>/usr</span>, <span class=filename>/var</span>, <span class=filename>/tmp</span>, <span class=filename>/mnt</span> oraz <span class=filename>/cdrom</span>. Najczęściej każdemu z takich katalogów odpowiada wpis w pliku <span class=filename>/etc/fstab</span>. Plik ten zawiera tabelę systemów plików i ich punktów montowania, z której korzysta system. Większość systemów plików wymienionych w <span class=filename>/etc/fstab</span> jest montowana automatycznie przez skrypt <a href="https://man.freebsd.org/cgi/man.cgi?query=rc&amp;sektion=8&amp;format=html">rc(8)</a> podczas uruchamiania systemu, wyjątkiem są te wpisy, które mają opcję <code>noauto</code>. <a href=#disks-fstab>Plik <span class=filename>fstab</span></a> zawiera więcej informacji.</p></div><div class=paragraph><p>Pełny opis struktury systemu plików znajduje się w dokumentacji systemowej <a href="https://man.freebsd.org/cgi/man.cgi?query=hier&amp;sektion=7&amp;format=html">hier(7)</a>. Tu ograniczymy się do pobieżnego zapoznania się z najważniejszymi katalogami.</p></div><table class="tableblock frame-none grid-all stretch informaltable"><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">Katalog</th><th class="tableblock halign-left valign-top">Opis</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Główny katalog systemu plików.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/bin/</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Programy użytkowe wykorzystywane zarówno w trybie jednego użytkownika, jak i w trybie wielu użytkowników.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/boot/</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Programy i pliki konfiguracyjne używane podczas uruchamiania systemu.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/boot/defaults/</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Pliki z domyślną konfiguracją uruchamiania systemu; patrz <a href="https://man.freebsd.org/cgi/man.cgi?query=loader.conf&amp;sektion=5&amp;format=html">loader.conf(5)</a>.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/dev/</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Pliki urządzeń; patrz <a href="https://man.freebsd.org/cgi/man.cgi?query=intro&amp;sektion=4&amp;format=html">intro(4)</a>.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/etc/</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Pliki i skrypty konfiguracyjne.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/etc/defaults/</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Pliki z domyślną konfiguracją systemu; patrz <a href="https://man.freebsd.org/cgi/man.cgi?query=rc&amp;sektion=8&amp;format=html">rc(8)</a>.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/etc/mail/</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Pliki konfiguracyjne dla serwerów poczty, na przykład <a href="https://man.freebsd.org/cgi/man.cgi?query=sendmail&amp;sektion=8&amp;format=html">sendmail(8)</a>.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/etc/namedb/</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Pliki konfiguracyjne programu <code>named</code>; patrz <a href="https://man.freebsd.org/cgi/man.cgi?query=named&amp;sektion=8&amp;format=html">named(8)</a>.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/etc/periodic/</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Skrypty uruchamiane raz dziennie, raz na tydzień i raz na miesiąc za pośrednictwem <a href="https://man.freebsd.org/cgi/man.cgi?query=cron&amp;sektion=8&amp;format=html">cron(8)</a>; patrz <a href="https://man.freebsd.org/cgi/man.cgi?query=periodic&amp;sektion=8&amp;format=html">periodic(8)</a>.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/etc/ppp/</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Pliki konfiguracyjne <code>ppp</code>; patrz <a href="https://man.freebsd.org/cgi/man.cgi?query=ppp&amp;sektion=8&amp;format=html">ppp(8)</a>.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/mnt/</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Pusty katalog, najczęściej wykorzystywany przez administratorów jako tymczasowy punkt montowania..</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/proc/</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>System plików procesów, patrz <a href="https://man.freebsd.org/cgi/man.cgi?query=procfs&amp;sektion=5&amp;format=html">procfs(5)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=mount_procfs&amp;sektion=8&amp;format=html">mount_procfs(8)</a>.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/rescue/</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Katalog zawierający programy przydatne w przypadku awarii; patrz <a href="https://man.freebsd.org/cgi/man.cgi?query=rescue&amp;sektion=8&amp;format=html">rescue(8)</a>.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/root/</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Katalog domowy użytkownika <code>root</code>.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/sbin/</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Programy i narzędzia administracyjne wykorzystywane zarówno w trybie jednego użytkownika, jak i w trybie wielu użytkowników.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/stand/</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Programy używane w samodzielnym środowisku.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/tmp/</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Pliki tymczasowe. Zawartość katalogu <span class=filename>/tmp</span> NIE JEST zachowywana przy ponownym uruchamianiu systemu. Również pamięciowy system plików jest często montowany w katalogu <span class=filename>/tmp</span>. Proces ten może zostać zautomatyzowany wykorzystując zmienne <a href="https://man.freebsd.org/cgi/man.cgi?query=rc.conf&amp;sektion=5&amp;format=html">rc.conf(5)</a> związane z tmpmfs (bądź za pomocą wpisu w <span class=filename>/etc/fstab</span>; patrz <a href="https://man.freebsd.org/cgi/man.cgi?query=mdmfs&amp;sektion=8&amp;format=html">mdmfs(8)</a>).</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/usr/</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Większość programów i aplikacji wykorzystywanych przez użytkowników.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/usr/bin/</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Najczęściej używane programy, narzędzia programistyczne, aplikacje.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/usr/include/</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Pliki nagłówkowe C.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/usr/lib/</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Biblioteki.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/usr/libdata/</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Pliki danych różnych programów użytkowych.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/usr/libexec/</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Demony i programy systemowe (uruchamiane przez inne programy).</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/usr/local/</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Lokalne programy, biblioteki, itp. Ponadto jest to domyślny katalog dla instalowanych portów. Ogólna struktura katalogów wewnątrz <span class=filename>/usr/local</span> powinna odpowiadać strukturze <span class=filename>/usr</span> opisanej w dokumentacji <a href="https://man.freebsd.org/cgi/man.cgi?query=hier&amp;sektion=7&amp;format=html">hier(7)</a>. Wyjątkiem jest katalog man, umieszczony bezpośrednio w <span class=filename>/usr/local</span>, a nie w <span class=filename>/usr/local/share</span>, oraz dokumentacja portów, znajdująca się w <span class=filename>share/doc/port</span>.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/usr/obj/</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Pliki zależne od architektury komputera, tworzone w procesie budowania drzewa <span class=filename>/usr/src</span>.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/usr/ports</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Kolekcja portów FreeBSD (opcjonalna).</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/usr/sbin/</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Demony i programy systemowe (dostępne dla użytkowników).</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/usr/shared/</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Pliki niezależne od architektury systemu.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/usr/src/</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Pliki źródłowe BSD, lokalne pliki źródłowe.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/usr/X11R6/</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Pliki wykonywalne, biblioteki, i inne pliki dystrybucji X11R6 (opcjonalnie).</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/var/</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Rozmaite pliki dzienników systemowych, pliki tymczasowe, pliki kolejek. Również pamięciowy system plików jest często montowany w tym katalogu. Proces ten może zostać zautomatyzowany wykorzystując zmienne <a href="https://man.freebsd.org/cgi/man.cgi?query=rc.conf&amp;sektion=5&amp;format=html">rc.conf(5)</a> związane z varmfs (bądź za pomocą wpisu w <span class=filename>/etc/fstab</span>; patrz <a href="https://man.freebsd.org/cgi/man.cgi?query=mdmfs&amp;sektion=8&amp;format=html">mdmfs(8)</a>).</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/var/log/</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Pliki dzienników systemowych.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/var/mail/</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Skrzynki pocztowe użytkowników.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/var/spool/</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Katalogi kolejek systemu drukowania i poczty.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/var/tmp/</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Pliki tymczasowe nie usuwane przy ponownym uruchamianiu systemu.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/var/yp</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Mapy usługi NIS.</p></td></tr></tbody></table></div><div class=sect2><h3 id=disk-organization>3.5. Organizacja dysku<a class=anchor href=#disk-organization></a></h3><div class=paragraph><p>Najmniejszą jednostką organizacji dysku używaną przez FreeBSD do odnajdywania plików jest nazwa pliku. W nazwach plików rozróżniane są duże i małe litery, tak więc <span class=filename>readme.txt</span> i <span class=filename>README.TXT</span> to dwa różne pliki. FreeBSD nie wykorzystuje rozszerzeń nazw plików (<span class=filename>.txt</span>) do określenia, czy plik jest programem, dokumentem, czy innym zbiorem danych.</p></div><div class=paragraph><p>Pliki przechowywane są w katalogach. Katalog może być pusty, lub może zawierać setki plików. Może również zawierać inne katalogi, dzięki czemu mamy możliwość zbudowania hierarchicznej struktury katalogów. Pozwala to na łatwą organizację danych.</p></div><div class=paragraph><p>Dostęp do plików i katalogów uzyskuje się podając nazwę pliku lub katalogu, poprzedzoną ukośnikiem <code>/</code> i innymi wymaganymi nazwami katalogów. Jeśli mamy katalog <span class=filename>foo</span>, a w nim katalog <span class=filename>bar</span>, w którym znajduje się plik <span class=filename>readme.txt</span>, wówczas pełną nazwą, bądź ścieżką dostępu do pliku jest <span class=filename>foo/bar/readme.txt</span>.</p></div><div class=paragraph><p>Katalogi i pliki przechowywane są w systemie plików. Każdy system plików ma jeden katalog najwyższego poziomu, zwany <em>katalogiem głównym</em> systemu plików. W katalogu głównym mogą być umieszczone następne katalogi.</p></div><div class=paragraph><p>To, o czym mówimy, jest zapewne podobne do innych systemów operacyjnych, z którymi być może zetknęliśmy się wcześniej. Są jednak różnice; na przykład w systemie MS-DOS® nazwy plików i katalogów oddzielane są znakiem <code>\</code>, w Mac OS® natomiast znakiem <code>:</code>.</p></div><div class=paragraph><p>We FreeBSD nie są używane litery dysków, lub inne nazwy dysków w ścieżce. Nie spotkamy się w FreeBSD z czymś takim jak <span class=filename>c:/foo/bar/readme.txt</span>.</p></div><div class=paragraph><p>Jest natomiast jeden system plików pełniący rolę <em>głównego systemu plików</em>. Zawiera on katalog główny dostępny jako <code>/</code>. Każdy inny system plików jest <em>montowany</em> w głównym systemie plików. Niezależnie od tego, ile dysków mamy w komputerze, we FreeBSD każdy katalog wydaje się być częścią tego samego dysku.</p></div><div class=paragraph><p>Załóżmy, że mamy trzy systemy plików, nazwane <code>A</code>, <code>B</code> i <code>C</code>. Każdy z nich ma katalog główny, zawierający dwa katalogi o nazwach <code>A1</code>, <code>A2</code> (oraz odpowiednio <code>B1</code>, <code>B2</code> i <code>C1</code>, <code>C2</code>).</p></div><div class=paragraph><p>Niech <code>A</code> będzie głównym systemem plików. Gdybyśmy sprawdzili jego zawartość poleceniem <code>ls</code>, zobaczylibyśmy dwa podkatalogi <code>A1</code> i <code>A2</code>. Drzewo katalogów wygląda następująco:</p></div><div class=imageblock><div class=content><img src=../../../../images/books/handbook/basics/example-dir1.png alt="example dir1"></div></div><div class=paragraph><p>System plików musi być montowany w katalogu innego systemu plików. Przyjmijmy teraz, że montujemy system plików <code>B</code> w katalogu <code>A1</code>. Główny katalog <code>B</code> zastąpi <code>A1</code>, a podkatalogi <code>B</code> pojawią się w odpowiednim miejscu:</p></div><div class=imageblock><div class=content><img src=../../../../images/books/handbook/basics/example-dir2.png alt="example dir2"></div></div><div class=paragraph><p>Do plików znajdujących się w katalogach <code>B1</code> i <code>B2</code> można się dostać posługując się ścieżką <span class=filename>/A1/B1</span> lub <span class=filename>/A1/B2</span>. Pliki poprzednio obecne w katalogu <span class=filename>/A1</span> są tymczasowo ukryte. Pojawią się ponownie po <em>odmontowaniu</em><span class=filename>B</span> z <span class=filename>A</span>.</p></div><div class=paragraph><p>Gdyby zamontować <code>B</code> w <code>A2</code>, drzewo katalogów wyglądałoby tak:</p></div><div class=imageblock><div class=content><img src=../../../../images/books/handbook/basics/example-dir3.png alt="example dir3"></div></div><div class=paragraph><p>ścieżki natomiast miałyby postać <span class=filename>/A2/B1</span> i <span class=filename>/A2/B2</span>.</p></div><div class=paragraph><p>Systemy plików mogą być montowane jeden na drugim. Rozwijając poprzedni przykład, możemy zamontować system plików <code>C</code> w katalogu <code>B1</code> systemu plików <code>B</code>, otrzymując następującą postać drzewa katalogów:</p></div><div class=imageblock><div class=content><img src=../../../../images/books/handbook/basics/example-dir4.png alt="example dir4"></div></div><div class=paragraph><p>Można równie dobrze zamontować <code>C</code> bezpośrednio w systemie plików <code>A</code>, w katalogu <code>A1</code>:</p></div><div class=imageblock><div class=content><img src=../../../../images/books/handbook/basics/example-dir5.png alt="example dir5"></div></div><div class=paragraph><p>Znającym system MS-DOS® może to przypominać polecenie <code>join</code>, choć nie jest to to samo.</p></div><div class=paragraph><p>Zwykle nie trzeba zajmować się opisanymi powyżej rzeczami. Najczęściej tworzymy systemy plików podczas instalacji FreeBSD, wybieramy miejsce ich zamontowania i nie wprowadzamy później żadnych zmian, chyba, że zainstalujemy nowy dysk.</p></div><div class=paragraph><p>Można utworzyć jeden obszerny główny system plików i nie tworzyć żadnych innych. Takie podejście ma kilka wad i jedną zaletę.</p></div><div class=ulist><div class=title>Korzyści z kilku systemów plików</div><ul><li><p>Odrębne systemy plików mogą mieć różne <em>opcje montowania</em> (mount options). Na przykład, przy odpowiednim przygotowaniu, główny system plików może być zamontowany tylko do odczytu, przez co niemożliwe będzie przypadkowe usunięcie lub zmiana ważnego pliku. Oddzielenie systemów plików dostępnych do zapisu dla użytkowników, jak np. <span class=filename>/home</span>, od innych pozwala również na montowanie ich z opcją <em>nosuid</em>; co z kolei pozwala zwiększyć bezpieczeństwo systemu uniemożliwiając wykorzystanie bitów <em>suid</em>/<em>guid</em>.</p></li><li><p>FreeBSD automatycznie optymalizuje układ plików w systemie plików, w zależności od tego, jak ów system jest wykorzystywany. System plików zawierający wiele często zapisywanych małych plików będzie optymalizowany inaczej niż taki, w którym przechowywane jest mniej plików o dużych rozmiarach. W przypadku jednego dużego systemu plików taka optymalizacja nie zadziała.</p></li><li><p>Systemy plików FreeBSD są odporne na awarie zasilania. W niesprzyjających okolicznościach może się jednak zdarzyć, że przerwa w dostawie prądu w krytycznym momencie spowoduje uszkodzenie struktury systemu plików. Przechowywanie danych w kilku systemach plików zwiększa szansę, że system uruchomi się ponownie, dzięki czemu łatwiej będzie odzyskać dane z kopii zapasowej.</p></li></ul></div><div class=ulist><div class=title>Korzyść z pojedynczego systemu plików</div><ul><li><p>Systemy plików mają stały rozmiar. Podczas instalacji FreeBSD tworzymy system plików o zadanym rozmiarze; później może się okazać, że trzeba powiększyć partycję. Niełatwo jest to zrobić inaczej, niż przez przygotowanie zapasowej kopii danych, utworzenie na nowo systemu plików o większych rozmiarach, oraz skopiowanie danych z powrotem.</p><div class="admonitionblock important"><table><tbody><tr><td class=icon><i class="fa icon-important" title=Important></i></td><td class=content><div class=paragraph><p>We FreeBSD dostępne jest polecenie <a href="https://man.freebsd.org/cgi/man.cgi?query=growfs&amp;sektion=8&amp;format=html">growfs(8)</a>, które pozwala na zwiększenie rozmiaru systemu plików w locie, pomijając wspomniane ograniczenie.</p></div></td></tr></tbody></table></div></li></ul></div><div class=paragraph><p>Systemy plików przechowywane są na partycjach. Pojęcie partycji ma tu inne znaczenie niż popularnie stosowane (np. partycja systemu MS-DOS®), ze względu na uniksowy rodowód FreeBSD. Każda z partycji oznaczana jest literą, od <code>a</code> do <code>h</code>. Pojedyncza partycja może zawierać jeden system plików, dlatego też do systemów plików często odwołuje się albo poprzez miejsce ich zamontowania w głównym systemie plików, albo przez literowe oznaczenie partycji, na której dany system plików się znajduje.</p></div><div class=paragraph><p>Przestrzeń dyskowa jest również używana we FreeBSD jako <em>przestrzeń wymiany</em>, pełniąc w ten sposób rolę <em>pamięci wirtualnej</em>. Komputer może dzięki temu dysponować większą ilością pamięci, niż ma w rzeczywistości. Kiedy pamięci zaczyna brakować, FreeBSD odsyła niektóre nieużywane dane do przestrzeni wymiany, a gdy znów okażą się potrzebne, przenosi je z powrotem (odsyłając jednocześnie inne dane).</p></div><div class=paragraph><p>Z niektórymi partycjami związane są pewne konwencje dotyczące ich zastosowania.</p></div><table class="tableblock frame-none grid-all stretch informaltable"><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">Patrycja</th><th class="tableblock halign-left valign-top">Konwencja</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>a</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Zwykle zawiera główny system plików</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>b</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Zwykle zawiera przestrzeń wymiany</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>c</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Zwykle jest tego samego rozmiaru, co obejmujący ją segment. Dzięki temu programy działające na całym segmencie (na przykład wykrywające uszkodzone obszary dysku) mogą działać na partycji <code>c</code>. Zwykle nie tworzy się na tej partycji systemu plików.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>d</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Swego czasu partycja <code>d</code> miała specjalne znaczenie, obecnie już go nie ma. Do dziś jednak niektóre programy mogą dziwnie się zachowywać, jeśli każe im się pracować na partycji <code>d</code>, dlatego też sysinstall zwykle w ogóle jej nie tworzy.</p></td></tr></tbody></table><div class=paragraph><p>Każda partycja zawierająca system plików przechowywana jest na czymś, co we FreeBSD nosi nazwę <em>segmentu</em>. Jest to określenie tego, co wcześniej zwane było partycją, i ponownie jest to konsekwencją uniksowych korzeni FreeBSD. Segmenty są oznaczane liczbami od 1 do 4.</p></div><div class=paragraph><p>Numery segmentów, wraz z przedrostkiem <code>s</code>, poprzedzone są nazwą urządzenia. Tak więc "da0_s1_" jest pierwszym segmentem na pierwszym dysku SCSI. Na dysku mogą być najwyżej cztery fizyczne segmenty, można jednak tworzyć segmenty logiczne wewnątrz segmentów fizycznych specjalnego typu. Powstałe w ten sposób segmenty rozszerzone mają numery od 5 wzwyż, zatem "ad0_s5_" odpowiada pierwszemu rozszerzonemu segmentowi na dysku IDE. Urządzenia te są wykorzystywane przez systemy plików, które zajmują cały segment.</p></div><div class=paragraph><p>Segmenty, dyski "niebezpiecznie dedykowane" i inne dyski zawierają <em>partycje</em>, oznaczane literami od <code>a</code> do <code>h</code>. Litera dopisywana jest do nazwy urządzenia, więc "da0_a_" odpowiadać będzie partycji a na pierwszym dysku da, "niebezpiecznie dedykowanym". Z kolei "ad1s3_e_" oznacza piątą partycję w trzecim segmencie drugiego dysku IDE.</p></div><div class=paragraph><p>Własne oznaczenie ma także każdy dysk. Nazwa dysku składa się z symbolu określającego typ dysku, oraz numeru, określającego który to dysk. Dyski, inaczej niż segmenty, numerowane są od zera. <a href=#basics-dev-codes>Oznaczenia dysków</a> zawiera najczęściej spotykane zwykle oznaczenia.</p></div><div class=paragraph><p>Gdy odwołujemy się do partycji, FreeBSD wymaga, byśmy podali również nazwę obejmującego ją segmentu i dysku. Z kolei gdy odwołujemy się do segmentu, podajemy również nazwę dysku. Kolejno podajemy więc nazwę dysku, <code>s</code>, numer segmentu, a na koniec literę partycji; patrz <a href=#basics-disk-slice-part>Przykładowe nazwy dysków, segmentów i partycji</a>.</p></div><div class=paragraph><p><a href=#basics-concept-disk-model>Schematyczny model dysku</a> pokazuje schematyczny model dysku, z pomocą którego łatwiej będzie zrozumieć pewne rzeczy.</p></div><div class=paragraph><p>Gdy instalujemy FreeBSD, w pierwszej kolejności musimy przygotować segmenty na dysku, następnie w segmencie przeznaczonym dla FreeBSD utworzyć partycje, następnie wewnątrz partycji stworzyć system plików (lub przestrzeń wymiany) i określić miejsce jego montowania.</p></div><table id=basics-dev-codes class="tableblock frame-none grid-all stretch"><caption class=title>Tabela 7. Oznaczenia dysków</caption><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">Oznaczenie</th><th class="tableblock halign-left valign-top">Znaczenie</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>ad</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Dysk ATAPI (IDE)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>da</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Dysk SCSI o dostępie bezpośrednim</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>acd</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>CDROM ATAPI (IDE)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>cd</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>CDROM SCSI</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>fd</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Stacja dyskietek</p></td></tr></tbody></table><div id=basics-disk-slice-part class=exampleblock><div class=title>Przykład 3. Przykładowe nazwy dysków, segmentów i partycji</div><div class=content><table class="tableblock frame-none grid-all stretch informaltable"><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">Nazwa</th><th class="tableblock halign-left valign-top">Znaczenie</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>ad0s1a</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Pierwsza partycja (<code>a</code>) w pierwszym segmencie (<code>s1</code>) na pierwszym dysku IDE (<code>ad0</code>).</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>da1s2e</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Piąta partycja <code>e</code> w drugim segmencie (<code>s2</code>) na drugim dysku SCSI (<code>da1</code>).</p></td></tr></tbody></table></div></div><div id=basics-concept-disk-model class=exampleblock><div class=title>Przykład 4. Schematyczny model dysku</div><div class=content><div class=paragraph><p>Rysunek przedstawia pierwszy dysk IDE z punktu widzenia FreeBSD. Zakładamy, że dysk ma rozmiar 4 GB i jest podzielony na dwa segmenty (partycje w MS-DOS®) o rozmiarze po 2 GB. Pierwszy segment zawiera DOS-owy dysk <span class=filename>C:</span>, natomiast w drugim segmencie znajduje się przykładowa instalacja FreeBSD, z trzema partycjami oraz partycją wymiany.</p></div><div class=paragraph><p>Każda z trzech partycji przechowuje system plików. Na partycji <code>a</code> umieszczony jest główny system plików, na <code>e</code> znajduje się katalog <span class=filename>/var</span>, a na <code>f</code> katalog <span class=filename>/usr</span>.</p></div><div class=imageblock><div class=content><img src=../../../../images/books/handbook/basics/disk-layout.png alt="disk layout"></div></div></div></div></div><div class=sect2><h3 id=mount-unmount>3.6. Montowanie i odmontowywanie systemów plików<a class=anchor href=#mount-unmount></a></h3><div class=paragraph><p>System plików można sobie wyobrazić jako drzewo, którego korzeniem jest <span class=filename>/</span>. <span class=filename>/dev</span>, <span class=filename>/usr</span> i inne podkatalogi katalogu głównego są gałęziami, z których mogą wyrastać kolejne gałęzie, na przykład <span class=filename>/usr/local</span>, itd.</p></div><div class=paragraph><p>Jest kilka powodów, dla których warto jest trzymać niektóre katalogi w oddzielnych systemach plików. W katalogu <span class=filename>/var</span> znajdują się podkatalogi <span class=filename>log/</span> i <span class=filename>spool/</span> oraz rozmaite pliki tymczasowe, z tego powodu może się on zapełnić. Zapełnienie głównego systemu plików jest raczej niepożądane, więc często zaleca się oddzielenie <span class=filename>/var</span> od <span class=filename>/</span>.</p></div><div class=paragraph><p>Często niektóre katalogi umieszczane są na odrębnych systemach plików ze względu na to, że znajdują się na osobnych dyskach fizycznych lub dyskach wirtualnych, jak na przykład pliki udostępniane poprzez <a href=./#network-nfs>Network File System</a> lub napędy CDROM.</p></div><div class=sect3><h4 id=disks-fstab>3.6.1. Plik <span class=filename>fstab</span><a class=anchor href=#disks-fstab></a></h4><div class=paragraph><p>Systemy plików wymienione w pliku <span class=filename>/etc/fstab</span> są automatycznie montowane podczas <a href=./#boot>ładowania systemu</a> (prócz oznaczonych opcją <code>noauto</code>).</p></div><div class=paragraph><p>Wpisy w pliku <span class=filename>/etc/fstab</span> są następującej postaci:</p></div><div class="literalblock programlisting"><div class=content><pre>urządzenie       /punkt-montowania typ     opcje      archiwizacja     nr-przebiegu</pre></div></div><div class=dlist><dl><dt class=hdlist1><code>urządzenie</code></dt><dd><p>Nazwa pliku urządzenia (istniejącego), zgodnie z opisem w <a href=./#disks-naming>Device Names</a>.</p></dd><dt class=hdlist1><code>punkt-montowania</code></dt><dd><p>Katalog (istniejący), w którym system plików ma być zamontowany.</p></dd><dt class=hdlist1><code>typ</code></dt><dd><p>Typ systemu plików przekazywany poleceniu <a href="https://man.freebsd.org/cgi/man.cgi?query=mount&amp;sektion=8&amp;format=html">mount(8)</a>. We FreeBSD domyślnie jest to <code>ufs</code>.</p></dd><dt class=hdlist1><code>opcje</code></dt><dd><p>Pierwszą opcją jest <code>rw</code>, jeśli w systemie plików ma być możliwy odczyt i zapis, albo <code>ro</code>, jeżeli dozwolony ma być tylko odczyt. W następnej kolejności podawane są inne opcje. Często stosowana jest opcja <code>noauto</code>, która zapobiega automatycznemu montowaniu systemu plików podczas uruchamiania systemu. Pozostałe opcje opisane są w dokumentacji systemowej <a href="https://man.freebsd.org/cgi/man.cgi?query=mount&amp;sektion=8&amp;format=html">mount(8)</a>.</p></dd><dt class=hdlist1><code>archiwizacja</code></dt><dd><p>Na podstawie tej informacji program <a href="https://man.freebsd.org/cgi/man.cgi?query=dump&amp;sektion=8&amp;format=html">dump(8)</a> stwierdza, które systemy plików mają być archiwizowane. Jeśli pole to zostanie pominięte, domyślnie przyjmowana jest wartość zero.</p></dd><dt class=hdlist1><code>nr-przebiegu</code></dt><dd><p>Na podstawie tego pola wyznaczana jest kolejność, w jakiej systemy plików poddawane są sprawdzaniu. Systemy plików, które nie mają być sprawdzane, powinny mieć <code>nr-przebiegu</code> ustawiony na zero. Główny system plików (powinien być sprawdzony jako pierwszy) powinien mieć <code>nr-przebiegu</code> o wartości jeden, a inne systemy plików powinny mieć wpisaną wartość większą od jednego. Jeśli dwa lub więcej systemów plików będzie miało taki sam <code>nr-przebiegu</code>, wówczas <a href="https://man.freebsd.org/cgi/man.cgi?query=fsck&amp;sektion=8&amp;format=html">fsck(8)</a>, o ile będzie to możliwe, podejmie próbę równoległego sprawdzenia tych systemów plików.</p></dd></dl></div><div class=paragraph><p>Więcej informacji o formacie pliku <span class=filename>/etc/fstab</span> oraz definiowanych w nim opcji dostępnych w podręczniku systemowym <a href="https://man.freebsd.org/cgi/man.cgi?query=fstab&amp;sektion=5&amp;format=html">fstab(5)</a></p></div></div><div class=sect3><h4 id=disks-mount>3.6.2. Polecenie <code>mount</code><a class=anchor href=#disks-mount></a></h4><div class=paragraph><p>Polecenie <a href="https://man.freebsd.org/cgi/man.cgi?query=mount&amp;sektion=8&amp;format=html">mount(8)</a> jest głównym poleceniem używanym do montowania systemów plików.</p></div><div class=paragraph><p>W najprostszej postaci, używa się go następująco:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mount urządzenie punkt-montowania</span></code></pre></div></div><div class=paragraph><p>Polecenie to ma mnóstwo opcji wymienionych w dokumentacji systemowej <a href="https://man.freebsd.org/cgi/man.cgi?query=mount&amp;sektion=8&amp;format=html">mount(8)</a>. Do najczęściej stosowanych należą:</p></div><div class=dlist><div class=title>Opcje montowania</div><dl><dt class=hdlist1><code>-a</code></dt><dd><p>Montowanie wszystkich systemów plików wymienionych w <span class=filename>/etc/fstab</span>. Nie są montowane systemy plików z opcją "noauto" oraz wykluczone przez opcję <code>-t</code>, jak również systemy plików już zamontowane.</p></dd><dt class=hdlist1><code>-d</code></dt><dd><p>Wykonanie wszystkiego, oprócz faktycznego wywołania funkcji systemowej montowania. W połączeniu z opcją <code>-v</code> można w ten sposób sprawdzić, co tak naprawdę <a href="https://man.freebsd.org/cgi/man.cgi?query=mount&amp;sektion=8&amp;format=html">mount(8)</a> stara się zrobić.</p></dd><dt class=hdlist1><code>-f</code></dt><dd><p>Wymuszenie montowania nieuporządkowanego systemu plików (niebezpieczne), lub wymuszenie odebrania prawa do zapisu przy zmianie trybu montowania systemu plików z trybu "odczyt i zapis" na "tylko do odczytu".</p></dd><dt class=hdlist1><code>-r</code></dt><dd><p>Montowanie systemu plików w trybie tylko do odczytu. Taki sam efekt ma zastosowanie opcji <code>-o</code> z argumentem <code>ro</code> (bądź <code>rdonly</code> w wersjach FreeBSD wcześniejszych niż 5.2).</p></dd><dt class=hdlist1><code>-t</code> <em>typ</em></dt><dd><p>Montowanie systemu plików o określonym typie. Przy zastosowaniu opcji <code>-a</code> montowane są tylko systemy plików podanego typu.</p><div class=paragraph><p>Domyślnym typem systemu plików jest "ufs".</p></div></dd><dt class=hdlist1><code>-u</code></dt><dd><p>Uaktualnienie opcji montowania systemu plików.</p></dd><dt class=hdlist1><code>-v</code></dt><dd><p>Pokazywanie dodatkowych komunikatów.</p></dd><dt class=hdlist1><code>-w</code></dt><dd><p>Montowanie w trybie odczytu i zapisu.</p></dd></dl></div><div class=paragraph><p>Opcji <code>-o</code> towarzyszy lista oddzielonych przecinkami parametrów, oto niektóre z nich:</p></div><div class=dlist><dl><dt class=hdlist1>nodev</dt><dd><p>Ignorowanie obecnych w systemie plików urządzeń specjalnych. Przydatna opcja, jeśli chodzi o bezpieczeństwo.</p></dd><dt class=hdlist1>noexec</dt><dd><p>Wyłączenie uruchamiania programów wykonywalnych na systemie plików. Również służy bezpieczeństwu.</p></dd><dt class=hdlist1>nosuid</dt><dd><p>Ignorowanie bitów setuid i setgid w systemie plików. Kolejna opcja służąca bezpieczeństwu.</p></dd></dl></div></div><div class=sect3><h4 id=disks-umount>3.6.3. Polecenie <code>umount</code> Command<a class=anchor href=#disks-umount></a></h4><div class=paragraph><p>Poleceniu <a href="https://man.freebsd.org/cgi/man.cgi?query=umount&amp;sektion=8&amp;format=html">umount(8)</a> należy podać jako parametr punkt montowania, nazwę urządzenia bądź opcję <code>-a</code> lub <code>-A</code>.</p></div><div class=paragraph><p>Każdej z form wywołania polecenia można podać opcję <code>-f</code>, która nakazuje dokonać bezwarunkowego odmontowania, oraz opcję <code>-v</code>, powodującą wypisywanie dodatkowych komunikatów. Należy mieć na uwadze, że raczej nie zaleca się korzystania z <code>-f</code>. Bezwarunkowe odmontowywanie systemu plików może doprowadzić do awarii systemu lub uszkodzenia danych znajdujących się w danym systemie plików.</p></div><div class=paragraph><p>Opcje <code>-a</code> oraz <code>-A</code> służą do odmontowania wszystkich zamontowanych systemów plików, lub systemów plików wybranych typów, określonych w opcji <code>-t</code>. Opcja <code>-A</code> nie dokonuje próby odmontowania głównego systemu plików.</p></div></div></div><div class=sect2><h3 id=basics-processes>3.7. Procesy<a class=anchor href=#basics-processes></a></h3><div class=paragraph><p>FreeBSD jest wielozadaniowym systemem operacyjnym. Oznacza to, że korzystając z systemu mamy wrażenie, że wiele programów działa jednocześnie. Działający w danej chwili program nazywany jest <em>procesem</em>. Po wydaniu dowolnego polecenia uruchamiany jest przynajmniej jeden proces. Są również procesy systemowe, które działają nieprzerwanie, zapewniając prawidłowe funkcjonowanie systemu.</p></div><div class=paragraph><p>Każdemu procesowi przypisany jest jednoznaczny numer zwany <em>identyfikatorem procesu</em>, lub po prostu <em>PID</em>. Podobnie jak plik, również każdy proces ma swojego właściciela i grupę. Na podstawie informacji o właścicielu i grupie system operacyjny przydziela procesowi prawa do otwierania plików i urządzeń, przy zastosowaniu opisanych wcześniej praw dostępu. Większość procesów ma swój proces macierzysty; jest to proces, który uruchomił dany proces. Przykładowo, kiedy wydajemy polecenia w powłoce, to zarówno powłoka jest procesem, jak i każde z wykonanych poleceń. Procesem macierzystym każdego uruchomionego w ten sposób procesu będzie powłoka. Wyjątkiem jest specjalny proces zwany <a href="https://man.freebsd.org/cgi/man.cgi?query=init&amp;sektion=8&amp;format=html">init(8)</a>. <code>init</code> jest pierwszym procesem, więc jego PID jest zawsze równy 1. Proces <code>init</code> uruchamiany jest przez jądro systemu podczas ładowania FreeBSD.</p></div><div class=paragraph><p>Są dwa bardzo przydatne polecenia, które pozwalają zobaczyć, jakie procesy są uruchomione: <a href="https://man.freebsd.org/cgi/man.cgi?query=ps&amp;sektion=1&amp;format=html">ps(1)</a> i <a href="https://man.freebsd.org/cgi/man.cgi?query=top&amp;sektion=1&amp;format=html">top(1)</a>. Polecenie <code>ps</code> pokazuje statyczną listę działających w danej chwili procesów, uwzględniając informacje takie jak PID-y procesów, zużywaną pamięć, wydane do uruchomienia procesów polecenia, itd. Polecenie <code>top</code> wyświetla listę uruchomionych procesów, która jest co kilka sekund uaktualniana, dzięki czemu możemy na bieżąco śledzić, czym zajmuje się komputer.</p></div><div class=paragraph><p>Domyślnie <code>ps</code> pokazuje tylko działające procesy należące do użytkownika wydającego polecenie. Na przykład:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% ps
  PID  TT  STAT      TIME COMMAND
  298  p0  Ss     0:01.10 tcsh
 7078  p0  S      2:40.88 xemacs mdoc.xsl <span class=o>(</span>xemacs-21.1.14<span class=o>)</span>
37393  p0  I      0:03.11 xemacs freebsd.dsl <span class=o>(</span>xemacs-21.1.14<span class=o>)</span>
48630  p0  S      2:50.89 /usr/local/lib/netscape-linux/navigator-linux-4.77.bi
48730  p0  IW     0:00.00 <span class=o>(</span>dns helper<span class=o>)</span> <span class=o>(</span>navigator-linux-<span class=o>)</span>
72210  p0  R+     0:00.00 ps
  390  p1  Is     0:01.14 tcsh
 7059  p2  Is+    1:36.18 /usr/local/bin/mutt <span class=nt>-y</span>
 6688  p3  IWs    0:00.00 tcsh
10735  p4  IWs    0:00.00 tcsh
20256  p5  IWs    0:00.00 tcsh
  262  v0  IWs    0:00.00 <span class=nt>-tcsh</span> <span class=o>(</span>tcsh<span class=o>)</span>
  270  v0  IW+    0:00.00 /bin/sh /usr/X11R6/bin/startx <span class=nt>--</span> <span class=nt>-bpp</span> 16
  280  v0  IW+    0:00.00 xinit /home/nik/.xinitrc <span class=nt>--</span> <span class=nt>-bpp</span> 16
  284  v0  IW     0:00.00 /bin/sh /home/nik/.xinitrc
  285  v0  S      0:38.45 /usr/X11R6/bin/sawfish</code></pre></div></div><div class=paragraph><p>Jak widzimy, <a href="https://man.freebsd.org/cgi/man.cgi?query=ps&amp;sektion=1&amp;format=html">ps(1)</a> wyświetla informacje w kilku kolumnach. W kolumnie <code>PID</code> pokazywany jest omówiony wcześniej identyfikator procesu. PID-y są przydzielane po kolei od 1 do 99999 i znów od początku, gdy się skończą. Kolumna <code>TT</code> pokazuje terminal, na którym działa program - na razie nie będziemy się tym zajmować. W kolumnie <code>STAT</code> przedstawiony jest stan procesu, jego także na razie nie będziemy omawiać. <code>TIME</code> pokazuje czas wykorzystywania procesora przez dany proces, niekoniecznie odpowiada on czasowi, jaki upłynął od uruchomienia programu, ponieważ wiele programów przez długi czas oczekuje na jakieś zdarzenie, a dopiero potem wykorzystuje procesor. Ostatnia kolumna, <code>COMMAND</code>, pokazuje polecenie, którym uruchomiony został program.</p></div><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=ps&amp;sektion=1&amp;format=html">ps(1)</a> ma wiele rozmaitych opcji, które mają wpływ na wyświetlane informacje. Jedną z najbardziej przydatnych kombinacji opcji jest <code>auxww</code>. Opcja a pokazuje informacje o wszystkich działających procesach, również nie należących do nas. <code>u</code> pokazuje nazwę użytkownika, do którego należy proces, jak również wykorzystanie pamięci. <code>x</code> pokazuje informacje o procesach - demonach. Opcja <code>ww</code> nakazuje, by polecenie <a href="https://man.freebsd.org/cgi/man.cgi?query=ps&amp;sektion=1&amp;format=html">ps(1)</a> wyświetlało pełną linię polecenia, nie obcinając jej, by zmieściła się na ekranie.</p></div><div class=paragraph><p>Informacje pokazywane przez <a href="https://man.freebsd.org/cgi/man.cgi?query=top&amp;sektion=1&amp;format=html">top(1)</a> wyglądają podobnie. Oto przykład:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% top
last pid: 72257<span class=p>;</span>  load averages:  0.13,  0.09,  0.03    up 0+13:38:33  22:39:10
47 processes:  1 running, 46 sleeping
CPU states: 12.6% user,  0.0% <span class=nb>nice</span>,  7.8% system,  0.0% interrupt, 79.7% idle
Mem: 36M Active, 5256K Inact, 13M Wired, 6312K Cache, 15M Buf, 408K Free
Swap: 256M Total, 38M Used, 217M Free, 15% Inuse

  PID USERNAME PRI NICE  SIZE    RES STATE    TIME   WCPU    CPU COMMAND
72257 nik       28   0  1960K  1044K RUN      0:00 14.86%  1.42% top
 7078 nik        2   0 15280K 10960K <span class=k>select   </span>2:54  0.88%  0.88% xemacs-21.1.14
  281 nik        2   0 18636K  7112K <span class=k>select   </span>5:36  0.73%  0.73% XF86_SVGA
  296 nik        2   0  3240K  1644K <span class=k>select   </span>0:12  0.05%  0.05% xterm
48630 nik        2   0 29816K  9148K <span class=k>select   </span>3:18  0.00%  0.00% navigator-linu
  175 root       2   0   924K   252K <span class=k>select   </span>1:41  0.00%  0.00% syslogd
 7059 nik        2   0  7260K  4644K poll     1:38  0.00%  0.00% mutt
...</code></pre></div></div><div class=paragraph><p>Informacje podzielone są na dwie części. Nagłówek (pierwsze pięć wierszy) zawiera PID ostatnio uruchomionego procesu, średnie obciążenie systemu (miara zapracowania systemu), czas działania systemu (od ostatniego uruchomienia) oraz aktualny czas. Inne liczby w nagłówku informują o liczbie działających procesów (w przykładzie 47), jak dużo pamięci i przestrzeni wymiany jest zajęte, oraz ile czasu system przebywa w różnych stanach procesora.</p></div><div class=paragraph><p>Pod nagłówkiem w kilku kolumnach pokazane są informacje zbliżone do przedstawianych przez <a href="https://man.freebsd.org/cgi/man.cgi?query=ps&amp;sektion=1&amp;format=html">ps(1)</a>. Podobnie można tu znaleźć PID procesu, nazwę użytkownika, czas zajmowania procesora, oraz polecenie, którym uruchomiono proces. <a href="https://man.freebsd.org/cgi/man.cgi?query=top&amp;sektion=1&amp;format=html">top(1)</a> pokazuje domyślnie także rozmiar pamięci zajmowanej przez proces. Ta ostatnia informacja podzielona jest na dwie kolumny; jedna odpowiada całkowitemu rozmiarowi, druga rozmiarowi rezydentnemu. Całkowity rozmiar oznacza, ile pamięci było potrzebne programowi, z kolei rozmiar rezydentny informuje, ile pamięci wykorzystuje program w danej chwili. W przykładzie widać, że <a href="https://man.freebsd.org/cgi/man.cgi?query=getenv&amp;sektion=3&amp;format=html">getenv(3)</a> potrzebował prawie 30 MB pamięci RAM, jednak obecnie wykorzystuje tylko 9 MB.</p></div><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=top&amp;sektion=1&amp;format=html">top(1)</a> automatycznie aktualizuje wyświetlane informacje co dwie sekundy; można to zmienić opcją <code>s</code>.</p></div></div><div class=sect2><h3 id=basics-daemons>3.8. Demony, sygnały i unicestwianie procesów<a class=anchor href=#basics-daemons></a></h3><div class=paragraph><p>Kiedy korzystamy z edytora tekstu, możemy go w prosty sposób obsługiwać, wczytywać pliki, itp. Jest to możliwe dzięki cechom samego edytora oraz dzięki temu, że edytor jest podłączony do <em>terminala</em>. Jednakże, niektóre programy pracują bez ciągłej komunikacji z użytkownikiem, są więc odłączone od terminala. Przykładem takiego programu może być serwer WWW, nieustannie odpowiadający na żądania pochodzące z sieci, bez potrzeby komunikacji z użytkownikiem. Inny przykład to programy przesyłające emaile pomiędzy komputerami.</p></div><div class=paragraph><p>Takie programy nazywane są <em>demonami</em> (ang. daemons). Demony to postaci z mitologii greckiej - niewielkie usłużne istoty, ani dobre, ani złe, które w rozmaity sposób pomagały ludziom. Podobnie pomagają dzisiejsze serwery pocztowe i serwery WWW. Dlatego właśnie od długiego czasu maskotką BSD jest wesoły demon z widłami i w</p></div><div class=paragraph><p>Przyjęto, iż programy uruchamiane jako demony mają nazwy zakończone literą "d". BIND (Berkeley Internet Name Daemon) jest serwerem nazw uruchamianym przez program <code>named</code>, serwer WWW Apache nosi nazwę <code>httpd</code>, demon kolejkowania drukarki (line printer spooling daemon) to <code>lpd</code>, itd. Nie jest to sztywna reguła, lecz przyjęta konwencja; na przykład główny demon pocztowy programu Sendmail nazywa się <code>sendmail</code>, a nie jak można by przypuszczać <code>maild</code>.</p></div><div class=paragraph><p>Niekiedy istnieje potrzeba komunikacji z procesem - demonem. Odbywa się ona poprzez <em>sygnały</em>, to znaczy możemy porozumieć się z demonem (lub jakimkolwiek działającym procesem) wysyłając mu sygnał. Są różne rodzaje sygnałów, które możemy wysłać - niektóre z nich mają określone znaczenie, inne są odpowiednio interpretowane przez aplikację, co powinno być opisane w dokumentacji aplikacji. Sygnał możemy wysłać tylko do procesu, którego jesteśmy właścicielem. Wysłanie sygnału do procesu należącego do kogoś innego za pośrednictwem <a href="https://man.freebsd.org/cgi/man.cgi?query=kill&amp;sektion=1&amp;format=html">kill(1)</a> lub <a href="https://man.freebsd.org/cgi/man.cgi?query=kill&amp;sektion=2&amp;format=html">kill(2)</a> spowoduje odmowę dostępu. Wyjątkiem jest użytkownik <code>root</code>, który może wysyłać sygnały do dowolnego procesu, niezależnie od jego właściciela.</p></div><div class=paragraph><p>Zdarza się, że samo FreeBSD również wysyła aplikacjom sygnały. Jeżeli niewłaściwie napisany program próbuje dostać się do niedostępnego dla niego obszaru pamięci, FreeBSD wysyła procesowi sygnał <em>Segmentation Violation</em> (<code>SIGSEGV</code>). Aplikacja może skorzystać z funkcji systemowej <a href="https://man.freebsd.org/cgi/man.cgi?query=alarm&amp;sektion=3&amp;format=html">alarm(3)</a>, wówczas po upłynięciu pewnego czasu zostanie do niej wysłany sygnał Alarm (<code>SIGALRM</code>). I tak dalej.</p></div><div class=paragraph><p>Do zatrzymania procesu można wykorzystać dwa sygnały: <code>SIGTERM</code> i <code>SIGKILL</code>. Pierwszy z nich jest łagodnym sposobem unicestwienia procesu; proces może <em>przechwycić</em> ten sygnał, następnie zakończyć swoją pracę, np. zamykając pliki, które otworzył. Czasami proces może zignorować sygnał <code>SIGTERM</code>, jeśli akurat zajmuje się czymś, co nie powinno być przerywane.</p></div><div class=paragraph><p>Sygnał <code>SIGKILL</code> nie może zostać zignorowany. Działa według zasady "Nie obchodzi mnie, co robisz, w tej chwili przestań". Wysłanie procesowi sygnału <code>SIGKILL</code> powoduje, iż FreeBSD natychmiast go wstrzymuje.</p></div><div class=paragraph><p>Inne użyteczne sygnały to <code>SIGHUP</code>, <code>SIGUSR1</code> i <code>SIGUSR2</code>. Są to sygnały ogólnego przeznaczenia, różne aplikacje reagują na nie w różny sposób.</p></div><div class=paragraph><p>Powiedzmy, że dokonaliśmy zmiany w pliku konfiguracji serwera WWW, i chcemy nakazać serwerowi, aby konfiguracja została ponownie wczytana. Moglibyśmy zatrzymać i ponownie uruchomić <code>httpd</code>, ale ubocznym efektem takiego postępowania byłaby chwilowa przerwa w pracy serwera, co jest raczej niepożądane. Większość demonów działa w taki sposób, iż po otrzymaniu sygnału <code>SIGHUP</code> dokonują ponownego przeczytania swojego pliku konfiguracyjnego. Dzięki temu zamiast unicestwiania i ponownego uruchamiania <code>httpd</code> możemy wysłać mu sygnał <code>SIGHUP</code>. Nie jest jednoznacznie określone, jak procesy reagują na sygnał <code>SIGHUP</code>, dlatego różne demony mogą zachowywać się w różny sposób - w razie niepewności warto zapoznać się z dokumentacją konkretnego demona.</p></div><div class=paragraph><p>Sygnały wysyłane są przy użyciu polecenia <a href="https://man.freebsd.org/cgi/man.cgi?query=kill&amp;sektion=1&amp;format=html">kill(1)</a>, jak w poniższym przykładzie.</p></div><div class="exampleblock procedure"><div class=content><div class=paragraph><p><strong>Procedure: Wysyłanie sygnału do procesu</strong></p></div><div class=paragraph><p>W tym przykładzie zaprezentowano wysyłanie sygnału do <a href="https://man.freebsd.org/cgi/man.cgi?query=inetd&amp;sektion=8&amp;format=html">inetd(8)</a>. Plik konfiguracyjny dla <code>inetd</code> to <span class=filename>/etc/inetd.conf</span>. Wysłanie sygnału <code>SIGHUP</code> spowoduje ponowne przeczytanie tego pliku.</p></div><div class="olist arabic"><ol class=arabic><li><p>Trzeba ustalić PID procesu, do którego wysyłać będziemy sygnał - do tego celu posłużą polecenia <a href="https://man.freebsd.org/cgi/man.cgi?query=ps&amp;sektion=1&amp;format=html">ps(1)</a> i <a href="https://man.freebsd.org/cgi/man.cgi?query=grep&amp;sektion=1&amp;format=html">grep(1)</a>. Polecenia <a href="https://man.freebsd.org/cgi/man.cgi?query=grep&amp;sektion=1&amp;format=html">grep(1)</a> używamy do odnalezienia podanego ciągu znaków. Ponieważ polecenia wydajemy jako zwykły użytkownik, a <a href="https://man.freebsd.org/cgi/man.cgi?query=inetd&amp;sektion=8&amp;format=html">inetd(8)</a> działa jako <code>root</code>, polecenie <a href="https://man.freebsd.org/cgi/man.cgi?query=ps&amp;sektion=1&amp;format=html">ps(1)</a> musimy wywołać z opcją <code>ax</code>.</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% ps <span class=nt>-ax</span> | <span class=nb>grep </span>inetd
198  ??  IWs    0:00.00 inetd <span class=nt>-wW</span></code></pre></div></div><div class=paragraph><p>Jak widać, <a href="https://man.freebsd.org/cgi/man.cgi?query=inetd&amp;sektion=8&amp;format=html">inetd(8)</a> ma PID o wartości 198. Niekiedy w przedstawionym powyżej przykładzie może się także pojawić proces <code>grep inetd</code>, wynika to ze sposobu, w jaki <a href="https://man.freebsd.org/cgi/man.cgi?query=ps&amp;sektion=1&amp;format=html">ps(1)</a> odnajduje działające procesy.</p></div></li><li><p>Sygnał wysyłamy przy pomocy polecenia <a href="https://man.freebsd.org/cgi/man.cgi?query=kill&amp;sektion=1&amp;format=html">kill(1)</a>. Najpierw skorzystamy jednak z polecenia <a href="https://man.freebsd.org/cgi/man.cgi?query=su&amp;sektion=1&amp;format=html">su(1)</a> by stać się rootem, gdyż <a href="https://man.freebsd.org/cgi/man.cgi?query=inetd&amp;sektion=8&amp;format=html">inetd(8)</a> działa jako <code>root</code>.</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% su

<span class=c># /bin/kill -s HUP 198</span></code></pre></div></div><div class=paragraph><p>Podobnie jak wiele poleceń w systemach UNIX®, <a href="https://man.freebsd.org/cgi/man.cgi?query=kill&amp;sektion=1&amp;format=html">kill(1)</a> nie wyświetla żadnego komunikatu w przypadku powodzenia. Jeżeli natomiast sygnał został wysłany do procesu, którego nie jest się właścicielem, pojawi się informacja: <code>kill: <em>PID</em>: Operation not permitted</code> (niedozwolona operacja). Błędne wpisanie PID-u spowoduje albo wysłanie sygnału do niewłaściwego procesu, co może skończyć się źle, albo też wysłanie sygnału do PID-u, który nie jest w danej chwili wykorzystywany - pojawi się wówczas komunikat <code>kill: <em>PID</em>: No such process</code> (nie ma takiego procesu).</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=title>Dlaczego warto korzystać z <code>/bin/kill</code>?</div><div class=paragraph><p>W wielu powłokach polecenie <code>kill</code> jest wbudowane; oznacza to, że sama powłoka zajmuje się wysyłaniem sygnału, nie wywołując <span class=filename>/bin/kill</span>. Może to być użyteczne, jednakże w różnych powłokach stosowana jest różna składnia do określenia nazwy sygnału, który ma być wysłany. Zamiast więc zapamiętywania wszystkich możliwych składni, łatwiej jest po prostu korzystać z polecenia <code>/bin/kill …​</code></p></div></td></tr></tbody></table></div><div class=paragraph><p>Inne sygnały wysyła się tą samą metodą, wystarczy zastąpić <code>TERM</code> lub <code>KILL</code> w odpowiedni sposób.</p></div></li></ol></div></div></div><div class="admonitionblock important"><table><tbody><tr><td class=icon><i class="fa icon-important" title=Important></i></td><td class=content><div class=paragraph><p>Unicestwianie losowo wybranego procesu jest raczej złym pomysłem. Szczególne znaczenie ma <a href="https://man.freebsd.org/cgi/man.cgi?query=init&amp;sektion=8&amp;format=html">init(8)</a>, proces o PID równym 1. Wydanie polecenia <code>/bin/kill -s KILL 1</code> jest szybką metodą wyłączenia systemu. Należy zawsze sprawdzać poprawność argumentów polecenia <a href="https://man.freebsd.org/cgi/man.cgi?query=kill&amp;sektion=1&amp;format=html">kill(1)</a> przed naciśnięciem klawisza <kbd>Return</kbd>.</p></div></td></tr></tbody></table></div></div><div class=sect2><h3 id=shells>3.9. Powłoki<a class=anchor href=#shells></a></h3><div class=paragraph><p>W codziennej pracy z FreeBSD bardzo często wykorzystywany jest interfejs linii poleceń, zwany powłoką (ang. shell). Podstawowym zadaniem powłoki jest przyjmowanie poleceń i wykonywanie ich. Wiele powłok wyposażonych jest także w dodatkowe funkcje ułatwiające pracę, np. usprawnienia zarządzania plikami, dopasowywanie nazw plików, ułatwienia korzystania z linii poleceń, makropolecenia i zmienne środowiskowe. We FreeBSD dostępnych jest kilka powłok, np. Bourne Shell <code>sh</code> i ulepszony C-shell <code>tcsh</code>. Wiele innych powłok, jak choćby <code>zsh</code> czy <code>bash</code>, można znaleźć w kolekcji portów FreeBSD.</p></div><div class=paragraph><p>Której z powłok najlepiej jest używać? To właściwie kwestia gustu. Dla programistów C najwygodniejsze mogą być powłoki o składni wzorowanej na języku C, np. <code>tcsh</code>. Użytkownikom Linuksa i tym, dla których interfejs linii poleceń systemów 8unix; jest nowością, można polecić <code>bash</code>. Do wyboru jest wiele powłok, każda z nich ma pewne charakterystyczne tylko dla niej właściwości, które niekoniecznie będą działać w każdych warunkach.</p></div><div class=paragraph><p>Często spotykanym udogodnieniem powłoki jest uzupełnianie nazw plików. Po wpisaniu kilku pierwszych liter polecenia lub nazwy pliku powłoka potrafi zwykle uzupełnić dalszy ciąg polecenia lub nazwy, dzieje się to po wciśnięciu klawisza <kbd>Tab</kbd>. Przyjmijmy przykładowo, że istnieją dwa pliki o nazwach <span class=filename>foobar</span> i <span class=filename>foo.bar</span>. Chcemy usunąć plik <span class=filename>foo.bar</span>. Możemy więc wydać polecenie: <code>rm fo[Tab].[Tab]</code>.</p></div><div class=paragraph><p>Powłoka wyświetli: <code>rm foo[BIIP].bar</code>.</p></div><div class=paragraph><p>Napis [BIIP] oznacza sygnał dźwiękowy, będący informacją od powłoki, że uzupełnienie nazwy pliku nie było możliwe, ponieważ można dopasować więcej niż jedną nazwę. Zarówno <span class=filename>foobar</span> jak i <span class=filename>foo.bar</span> zaczynają się od <code>fo</code>. Powłoka mogła jednakże uzupełnić początek, czyli <code>foo</code>. Teraz można wpisać kropkę <code>.</code> i ponownie wcisnąć <kbd>Tab</kbd>, tym razem powłoka uzupełni nazwę do końca.</p></div><div class=paragraph><p>Inną cechą powłoki są zmienne środowiskowe. Przechowywane są one w przestrzeni środowiska powłoki w postaci par "nazwa = wartość". Przestrzeń środowiska jest widoczna dla każdego programu uruchamianego przez powłokę, dlatego też przechowuje się tam wiele parametrów konfiguracyjnych dla programów. Oto najczęściej spotykane zmienne środowiskowe wraz z krótkim opisem:</p></div><table class="tableblock frame-none grid-all stretch informaltable"><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">Zmienna</th><th class="tableblock halign-left valign-top">Opis</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>USER</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Nazwa aktualnie zalogowanego użytkownika.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>PATH</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Lista katalogów zawierających pliki wykonywalne oddzielona przecinkami.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>DISPLAY</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Nazwa ekranu X11, jeśli takowy jest dostępny.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>SHELL</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Wykorzystywana powłoka.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>TERM</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Nazwa terminala użytkownika, wykorzystywana do określenia właściwości terminala.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>TERMCAP</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Zapis z bazy termcap zawierający sekwencje kodów odpowiadających różnym funkcjom terminala.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>OSTYPE</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Typ systemu operacyjnego, np. FreeBSD.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>MACHTYPE</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Architektura sprzętowa, na jakiej działa system.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>EDITOR</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Preferowany przez użytkownika edytor tekstu.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>PAGER</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Preferowany przez użytkownika program wyświetlający pliki tekstowe.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>MANPATH</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Lista katalogów zawierających dokumentację systemową oddzielona przecinkami.</p></td></tr></tbody></table><div class=paragraph><p>Sposób odczytywania i ustawiania zmiennych środowiskowych zależy od rodzaju używanej powłoki. Na przykład w powłokach wzorowanych na C, jak <code>tcsh</code> i <code>csh</code>, do ustawiania i przeglądania zmiennych środowiskowych służy polecenie <code>setenv</code>, natomiast w powłokach Bourne’a, czyli <code>sh</code> i <code>bash</code>, do tych celów wykorzystywane jest polecenie <code>export</code>. Przykładowo, aby zmienić zmienną środowiskową <code>EDITOR</code> na <span class=filename>/usr/local/bin/emacs</span> w powłoce <code>csh</code> lub <code>tcsh</code>, należy wydać polecenie:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% setenv EDITOR /usr/local/bin/emacs</code></pre></div></div><div class=paragraph><p>A w powłokach Bourne’a:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% <span class=nb>export </span><span class=nv>EDITOR</span><span class=o>=</span><span class=s2>&#34;/usr/local/bin/emacs&#34;</span></code></pre></div></div><div class=paragraph><p>W większości powłok można wyświetlić wartość zmiennej środowiskowej przez poprzedzenie jej nazwy znakiem <code>$</code>. Dla przykładu, polecenie <code>echo $TERM</code> pokaże wartość zmiennej <code>$TERM</code>, ponieważ powłoka zastępuje wyrażenie <code>$TERM</code> wartością zmiennej i przekazuje ją do <code>echo</code>.</p></div><div class=paragraph><p>Wiele znaków, zwanych meta-znakami, traktowanych jest przez powłoki w specjalny sposób. Najczęściej wykorzystywanym jest <code>*</code>, oznaczający dowolny ciąg znaków w nazwie pliku, umożliwiający wykonywanie operacji na wielu plikach. Przykładowo, wywołanie <code>echo *</code> jest prawie identyczne z wywołaniem <code>ls</code>, ponieważ powłoka przekazuje do <code>echo</code> nazwy wszystkich plików pasujących <code>*</code>.</p></div><div class=paragraph><p>Jeśli potrzeba, by powłoka nie interpretowała znaku jako znak specjalny, należy go poprzedzić znakiem ukośnika (<code>\</code>). Wywołanie <code>echo $TERM</code> powoduje wypisanie ustawionego typu terminala, podczas gdy efektem polecenia <code>echo \$TERM</code> jest po prostu napis <code>$TERM</code>.</p></div><div class=sect3><h4 id=changing-shells>3.9.1. Zmiana powłoki<a class=anchor href=#changing-shells></a></h4><div class=paragraph><p>Najłatwiej jest zmienić powłokę przy użyciu polecenia <code>chsh</code>. Wywołanie tego polecenia uruchomi edytor wskazany przez zmienną <code>EDITOR</code>, lub edytor <code>vi</code>, jeśli nie jest ona zdefiniowana. Następnie należy zmienić nazwę powłoki w wierszu "Shell:".</p></div><div class=paragraph><p>Można też skorzystać z <code>chsh</code> z opcją <code>-s</code>, która automatycznie zmieni powłokę, bez uruchamiania edytora. Poniżej przedstawiono wywołanie zmieniające powłokę na <code>bash</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% chsh <span class=nt>-s</span> /usr/local/bin/bash</code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Wybrana powłoka <em>musi</em> być wymieniona w pliku <span class=filename>/etc/shells</span>. Jeśli powłokę zainstalowano z <a href=./#ports>kolekcji portów</a> powinna zostać dopisana automatycznie. Jeśli natomiast przeprowadzono ręczną instalację powłoki, trzeba to zrobić samemu.</p></div><div class=paragraph><p>Dla przykładu, jeśli powłoka <code>bash</code> została zainstalowana i umieszczona w <span class=filename>/usr/local/bin</span>, trzeba będzie wydać polecenie:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># echo &#34;/usr/local/bin/bash&#34; &gt;&gt; /etc/shells</span></code></pre></div></div><div class=paragraph><p>Oraz uruchomić <code>chsh</code>.</p></div></td></tr></tbody></table></div></div></div><div class=sect2><h3 id=editors>3.10. Edytory tekstu<a class=anchor href=#editors></a></h3><div class=paragraph><p>Konfiguracja FreeBSD polega głównie na edytowaniu plików tekstowych. Z tego właśnie powodu, dobrze byłoby zapoznać się z edytorami tekstu. FreeBSD posiada ich kilka, a kolejne można doinstalować z drzewa portów.</p></div><div class=paragraph><p>Najłatwiejszym do nauki i w użyciu jest edytor ee, co jest skrótem od Easy Editor (ang. Łatwy Edytor). Aby uruchomić ee, należy użyć polecenia <code>ee plik</code>, gdzie <em>plik</em> jest to, co chcemy edytować. Na przykład, aby wyedytować plik <span class=filename>/etc/rc.conf</span>, napiszemy <code>ee /etc/rc.conf</code>. Gdy już jesteśmy w <code>ee</code>, możemy zauważyć, że wszystkie niezbędne komendy są wypisane u góry ekranu. Znak <code>^</code> oznacza wciśnięty klawisz <kbd>Ctrl</kbd>. Innymi słowy <code>^e</code> oznacza, że należy trzymać <kbd>Ctrl</kbd> i wcisnąć klawisz <kbd>e</kbd>. Aby wyjść z ee, wciśnij <kbd>Esc</kbd>, następnie wybierz leave editor (opuść edytor). Edytor zapyta, czy zachować zmiany, jeśli plik został zmodyfikowany.</p></div><div class=paragraph><p>FreeBSD w swoich zasobach ma także potężny edytor tekstu, jakim jest vi. W kolekcji portów dostępny jest także Emacs, czy vim (<a class=package href=https://cgit.freebsd.org/ports/tree/editors/emacs/>editors/emacs</a> i <a class=package href=https://cgit.freebsd.org/ports/tree/editors/vim/>editors/vim</a>). Edytory te oferują dużo większą funkcjonalność, ale oczekują w zamian większego obeznania użytkownika z zasadami ich działania, ponadto ich obsługa jest trudniejsza do nauki. Jednakże, jeśli planujesz edytować wiele tekstu, nauka Emacs lub vim zwróci się w długim okresie w postaci zaoszczędzonego czasu.</p></div></div><div class=sect2><h3 id=basics-devices>3.11. Urządzenia i pliki urządzeń<a class=anchor href=#basics-devices></a></h3><div class=paragraph><p>Mianem urządzeń określa się komponenty komputera, takie jak dysk, drukarka, karta graficzna czy klawiatura. Podczas ładowania systemu FreeBSD większość wyświetlanych komunikatów dotyczy wykrywanych urządzeń. Komunikaty startowe dostępne są do późniejszego przeglądania w pliku <span class=filename>/var/run/dmesg.boot</span>.</p></div><div class=paragraph><p>Przykładowo, <span class=filename>acd0</span> odpowiada pierwszemu napędowi CDROM IDE, natomiast <span class=filename>kbd0</span> oznacza klawiaturę.</p></div><div class=paragraph><p>Dostęp do większości urządzeń w systemie operacyjnym UNIX® odbywa się poprzez specjalne pliki, zwane plikami urządzeń, znajdujące się w katalogu <span class=filename>/dev</span>.</p></div><div class=sect3><h4 id=_tworzenie_plików_urządzeń>3.11.1. Tworzenie plików urządzeń<a class=anchor href=#_tworzenie_plików_urządzeń></a></h4><div class=paragraph><p>Kiedy wyposażamy komputer w nowe urządzenie, lub kompilujemy jądro z obsługą dodatkowych urządzeń, konieczne może okazać się utworzenie nowych plików urządzeń.</p></div><div class=sect4><h5 id=_devfs_device_file_system>3.11.1.1. <code>DEVFS</code> (DEVice File System)<a class=anchor href=#_devfs_device_file_system></a></h5><div class=paragraph><p>System plików urządzeń, zwany <code>DEVFS</code>, udostępnia przestrzeń nazw urządzeń jądra jako część przestrzeni nazw głównego systemu plików. <code>DEVFS</code> zajmuje się obsługą systemu plików urządzeń, dzięki czemu nie trzeba samodzielnie tworzyć bądź modyfikować plików urządzeń.</p></div><div class=paragraph><p>Więcej informacji znaleźć można w dokumentacji systemowej <a href="https://man.freebsd.org/cgi/man.cgi?query=devfs&amp;sektion=5&amp;format=html">devfs(5)</a>.</p></div></div></div></div><div class=sect2><h3 id=binary-formats>3.12. Formaty binarne<a class=anchor href=#binary-formats></a></h3><div class=paragraph><p>By zrozumieć czemu FreeBSD używa formatu <a href="https://man.freebsd.org/cgi/man.cgi?query=elf&amp;sektion=5&amp;format=html">elf(5)</a>, musimy wpierw poznać trzy obecnie "dominujace" formaty plików wykonywalnych w systemach UNIX®:</p></div><div class=ulist><ul><li><p><a href="https://man.freebsd.org/cgi/man.cgi?query=a.out&amp;sektion=5&amp;format=html">a.out(5)</a></p><div class=paragraph><p>Najstarszy i najbardziej "klasyczny" format w Uniksie. Wykorzystuje krótki nagłówek z magicznym numerem na samym początku, często wykorzystywanym do określenia rodzaju pliku (szczegółowy opis dostępny jest w <a href="https://man.freebsd.org/cgi/man.cgi?query=a.out&amp;sektion=5&amp;format=html">a.out(5)</a>). Na plik składają się trzy segmenty: .text, .data i .bss oraz tablice symboli i ciągów tekstowych.</p></div></li><li><p>COFF</p><div class=paragraph><p>Format obiektowy pochodzący z SVR3. W tym formacie sekcja tablic w wchodzi już w skład nagłówka, tak więc możliwe jest zawarcie w pliku więcej sekcji niż tylko .text, .data i .bss.</p></div></li><li><p><a href="https://man.freebsd.org/cgi/man.cgi?query=elf&amp;sektion=5&amp;format=html">elf(5)</a></p><div class=paragraph><p>Następca COFF zawierający wiele dodatkowych sekcji o 32- bądź nawet 64-bitowych wartościach. Jednym, acz wielkim minusem jest fakt, iż przy projektowaniu formatu ELF również założono, że na każdą architekturę sprzętową będzie istniał tylko jeden interfejs ABI. Okazało się natomiast, iż takie założenie jest błędne nawet w świecie komercyjnych SYSV (z którego pochodzą przynajmniej trzy ABI: SVR4, Solaris i SCO).</p></div><div class=paragraph><p>Sposobem na rozwiązanie tego problemu we FreeBSD są narzędzia do <em>metkowania</em> plików wykonywalnych ELF informacjami, z którymi ABI jest on zgodny. Więcej informacji dostępnych jest w podręczniku systemowym <a href="https://man.freebsd.org/cgi/man.cgi?query=brandelf&amp;sektion=1&amp;format=html">brandelf(1)</a>.</p></div></li></ul></div><div class=paragraph><p>System FreeBSD pochodzi z "klasycznego" obozu. Wykorzystywał on zatem format <a href="https://man.freebsd.org/cgi/man.cgi?query=a.out&amp;sektion=5&amp;format=html">a.out(5)</a> - technologię wypróbowaną w wielu pokoleniach systemów BSD i z powodzeniem stosowaną aż do gałęzi 3.X. Mimo, że skompilowanie i uruchomienie w sposób natywny plików binarnych ELF (a także jądra) było możliwe we FreeBSD już od pewnego czasu, Projekt oficjalnie opierał się przed migracją do formatu ELF jako podstawowego. Dlaczego? Otóż, gdy obóz linuksowy wykonał ten bolesny krok ku ELF nie udało się tak łatwo uciec od formatu <span class=filename>a.out</span>. Wynikało to przede wszystkim z faktu, iż niezbyt elastyczny plan migracji bazował na mechanizmie współdzielonych bibliotek, których modyfikacja nastręczała wielu trudności zarówno producentom sprzętu jak i projektantom. Dopiero od momentu gdy narzędzia dostępne dla ELF zaoferowały sposób rozwiązania problemu ze współdzielonymi bibliotekami, zaczęły być postrzegane ogólnie jako "droga do przodu", a tym samym koszty migracji mogły zostać uznane za niezbędne do poniesienia. Mechanizm współdzielonych bibliotek FreeBSD w dużej mierze przypomina mechanizm z SunOS™ Sun’a i jako taki jest bardzo łatwy w użyciu.</p></div><div class=paragraph><p>Skąd więc tyle różnych formatów?</p></div><div class=paragraph><p>W zamierzchłych czasach do dyspozycji był prosty sprzęt komputerowy. Ów prosty sprzęt obsługiwał mały, prosty system. Stąd też format <span class=filename>a.out</span> był całkowicie odpowiednim do prezentacji plików binarnych w tym prostym systemie (PDP-11). Gdy UNIX® został przeniesiony z tego prostego systemu na platformy typu Motorola 68k czy VAXen, zachowany został format <span class=filename>a.out</span>, zdecydowanie wystarcząjacy dla wczesnych wersji Uniksa.</p></div><div class=paragraph><p>Pewien czas później, jakiś bystry inżynier sprzętowy stwierdził że gdyby potrafił zmusić oprogramowanie do robienia kilku obskurnych sztuczek, wówczas mógłby pozbyć się kilku bramek z układu scalonego i zmusić CPU do szybszej pracy. Pomimo, że format <span class=filename>a.out</span> potrafił współpracować z tym nowym rodzajem sprzętu (zwanego wówczas RISC) to mimo wszystko nie był najlepszym do tego formatem. Dlatego też rozpoczęto prace nad innymi formatami binarnymi, które miały osiągnąć lepsze wyniki niż ograniczony, prosty <span class=filename>a.out</span> mógł zaoferować. Stworzone zostały COFF, ECOFF oraz kilka mniej znanych formatów, nim powstał ELF.</p></div><div class=paragraph><p>Kolejnym problemem okazał się wzrost rozmiarów programów przy względnie małej pojemności dysków oraz pamięci fizycznych, a także zwiększeniu stopnia skomplikowania pamięci wirtualnej VM. Tak też narodziła się koncepcja współdzielonych bibliotek. Mimo, że ów postęp osiągnięty był przy pomocy formatu <span class=filename>a.out</span> zakres jego przydatności był stale rozciągany, wraz z każdą nową funkcją. Pojawiła się konieczność dynamicznego wczytywanie pewnych rzeczy już w trakcie uruchamiania programu czy zapisywania części programu zaraz po wykonaniu kodu init w pamięci lub przestrzeni wymiany. Również języki programowania stawały się coraz bardziej wyrafinowane. Wiele poprawek wprowadzonych do formatu <span class=filename>a.out</span> umożliwiały realizację kolejnych funkcji, przy czym z reguły działały one tylko przez pewien czas. Niestety, format a.out stał się z czasem niezdolny do rozwiązywania wszystkich problemów bez wciąż rozrastającego się narzutu w kodzie i poziomu skomplikowania. Mimo, że ELF potrafił rozwiązać wiele z ówczesnych problemów, zmiana formatu binarnego, który generalnie działał, wciąż była wielką uciążliwością. Dlatego też ELF musiał poczekać aż bardziej bolesnym okazało się pozostanie przy <span class=filename>a.out</span> niż przejście do ELF.</p></div><div class=paragraph><p>Wraz z upływem czasu, narzędzia kompilacyjne, z których FreeBSD wywodzi własne narzędzia (przede wszystkim assembler i loader), wyewoluowały w dwa równoległe projekty. Odmiana FreeBSD dała współdzielone biblioteki oraz poprawki kilku błędów. Ludzie z GNU, którzy oryginalnie napisali te programy, przepisali je na nowo i dodali proste kompilatory wskrośne, pozwalające na pracę w różnych formatach. Nowy pakiet narzędzi GNU (binutils) wspiera kompilowanie wskrośne, format ELF, współdzielone biblioteki, rozszerzenia C++, itp. Dodatkowo, wielu producentów sprzętu przygotowuje binaria ELF. Jest to zatem dobra rzecz dla FreeBSD, że je obsługuje.</p></div><div class=paragraph><p>Format ELF oferuje większą rozszerzalność niz <span class=filename>a.out</span>. Narzędzia ELF są lepiej przygotowywane i oferują kompilację wskrośną, co jest istotne dla wielu programistów. Co prawda ELF może być trochę wolniejszy niż <span class=filename>a.out</span>, jednakże próba pomiaru może być trudna. Istnieje również wiele innych szczegółów różnych dla obydwu formatów, m.in. sposób mapowania stron, obsługi kodu init itp. Co prawda, żadne z nich nie jest istotne, jednakże różnice istnieją. Z czasem, wsparcie dla <span class=filename>a.out</span> zostanie wstrzymane z jadra <span class=filename>GENERIC</span> i ostatecznie usunięte z jądra gdy tylko zniknie potrzeba obsługi programów <span class=filename>a.out</span>.</p></div></div><div class=sect2><h3 id=basics-more-information>3.13. Więcej informacji<a class=anchor href=#basics-more-information></a></h3><div class=sect3><h4 id=basics-man>3.13.1. Dokumentacja systemowa<a class=anchor href=#basics-man></a></h4><div class=paragraph><p>Najdokładniejszą dokumentacją we FreeBSD jest dokumentacja systemowa. Dla prawie każdego dostępnego w systemie programu przygotowana jest krótka instrukcja obsługi, omawiająca podstawy jego działania i rozmaite opcje. Dokumentację możemy przeglądać przy pomocy polecenia <code>man</code>. Korzystanie z tego polecenia jest bardzo proste:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% man polecenie</code></pre></div></div><div class=paragraph><p><code>polecenie</code> jest nazwą polecenia, o którym chcemy uzyskać informacje. Na przykład, aby dowiedzieć się czegoś na temat polecenia <code>ls</code> wpisujemy:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% man <span class=nb>ls</span></code></pre></div></div><div class=paragraph><p>Dokumentacja systemowa podzielona jest na ponumerowane części:</p></div><div class="olist arabic"><ol class=arabic><li><p>Polecenia dostępne dla użytkowników.</p></li><li><p>Funkcje systemowe i kody błędów.</p></li><li><p>Funkcje z bibliotek języka C.</p></li><li><p>Sterowniki urządzeń.</p></li><li><p>Formaty plików.</p></li><li><p>Gry i inne rozrywki.</p></li><li><p>Różne informacje.</p></li><li><p>Polecenia służące do zarządzania systemem.</p></li><li><p>Informacje dla programistów jądra.</p></li></ol></div><div class=paragraph><p>Niekiedy takie samo zagadnienie może pojawić się w kilku częściach dokumentacji. Na przykład istnieje polecenie <code>chmod</code>, oraz funkcja systemowa <code>chmod()</code>. W taki wypadku możemy wybrać interesującą nas część dokumentacji, podając jej numer jako parametr polecenia <code>man</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% man 1 <span class=nb>chmod</span></code></pre></div></div><div class=paragraph><p>W efekcie pokazana zostanie dokumentacja polecenia <code>chmod</code>. Zgodnie z przyjętą konwencją, numer odpowiedniej części dokumentacji podawany jest w nawiasach, tak więc <a href="https://man.freebsd.org/cgi/man.cgi?query=chmod&amp;sektion=1&amp;format=html">chmod(1)</a> odpowiada poleceniu <code>chmod</code>, natomiast <a href="https://man.freebsd.org/cgi/man.cgi?query=chmod&amp;sektion=2&amp;format=html">chmod(2)</a> odpowiada funkcji systemowej.</p></div><div class=paragraph><p>W opisany powyżej sposób możemy dowiedzieć się, jak korzystać z danego polecenia, jeśli znamy jego nazwę. Co zrobić, jeśli nie możemy sobie przypomnieć nazwy polecenia? Otóż, <code>man</code> potrafi również wyszukiwać wybranych słów kluczowych w opisach poleceń, służy do tego opcja <code>-k</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% man <span class=nt>-k</span> mail</code></pre></div></div><div class=paragraph><p>Wpisanie takiego polecenia spowoduje wyświetlenie listy poleceń, których opisy zawierają słowo kluczowe "mail". Takie działanie jest równoważne skorzystaniu z polecenia <code>apropos</code>.</p></div><div class=paragraph><p>Jeśli więc, przeglądając zawartość katalogu <span class=filename>/usr/bin</span>, zastanawiamy się, do czego właściwie służą znajdujące się tam polecenia, możemy wpisać:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% <span class=nb>cd</span> /usr/bin
% man <span class=nt>-f</span> <span class=k>*</span></code></pre></div></div><div class=paragraph><p>lub</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% <span class=nb>cd</span> /usr/bin
% whatis <span class=k>*</span></code></pre></div></div><div class=paragraph><p>W obu przypadkach efekt będzie taki sam.</p></div></div><div class=sect3><h4 id=basics-info>3.13.2. Pliki GNU Info<a class=anchor href=#basics-info></a></h4><div class=paragraph><p>Do FreeBSD dołączonych jest wiele programów i narzędzi stworzonych przez Free Software Foundation (FSF). Prócz dokumentacji systemowej, do tych programów dołączone są bardziej rozbudowane dokumenty hipertekstowe, zwane plikami <code>info</code>. Można je przeglądać poleceniem <code>info</code>, lub trybem info emacsa, o ile emacs został zainstalowany.</p></div><div class=paragraph><p>By skorzystać z polecenia <a href="https://man.freebsd.org/cgi/man.cgi?query=info&amp;sektion=1&amp;format=html">info(1)</a>, wpisujemy:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% info</code></pre></div></div><div class=paragraph><p>Krótkie wprowadzenie pojawia się po wpisaniu <code>h</code>. Spis poleceń jest dostępny po wpisaniu <code>?</code>.</p></div></div></div></div></div><div class=sect1><h2 id=ports>Rozdział 4. Instalacja programów: pakiety i porty<a class=anchor href=#ports></a></h2><div class=sectionbody><div class=sect2><h3 id=ports-synopsis>4.1. Streszczenie<a class=anchor href=#ports-synopsis></a></h3><div class=paragraph><p>System FreeBSD rozprowadzany jest wraz z bogatą kolekcją narzędzi systemowych. Tym nie mniej, stanowi to absolutne minimum. Szybko pojawia się bowiem potrzeba zainstalowania dodatkowego oprogramowania, by móc rozpocząć prawdziwą pracę z systemem. FreeBSD dostarcza dwóch dopełniających się metod instalacji oprogramowania: kolekcję portów FreeBSD (kompilacja programów ze źródeł) i system pakietów (instalacja z gotowych binariów). Każda z tych metod może zostać wykorzystana do instalacji najnowszych wersji ulubionego oprogramowania z lokalnych nośników bądź bezpośrednio z sieci.</p></div><div class=paragraph><p>Przeczytawszy ten rozdział dowiemy się:</p></div><div class=ulist><ul><li><p>Jak instalować oprogramowanie innych producentów dostarczane w postaci binarnej.</p></li><li><p>Jak kompilować oprogramowanie innych producentów z wykorzystaniem kolekcji portów.</p></li><li><p>Jak usunąć poprzednio zainstalowane pakiety bądź porty.</p></li><li><p>Jak zmienić domyślne wartości wykorzystywane przy kompilacji portów.</p></li><li><p>Jak odnaleźć właściwe oprogramowanie.</p></li><li><p>Jak zaktualizować wykorzystywane aplikacje.</p></li></ul></div></div><div class=sect2><h3 id=ports-overview>4.2. Omówienie instalacji oprogramowania<a class=anchor href=#ports-overview></a></h3><div class=paragraph><p>Osoby, które już wcześniej pracowały z systemami UNIX® wiedzą, że typowy proces instalacji oprogramowania sprowadza się mniej więcej do następujących punktów:</p></div><div class="exampleblock procedure"><div class=content><div class="olist arabic"><ol class=arabic><li><p>Pobranie programu, który może być rozprowadzany w postaci kodu źródłowego bądź binarnej.</p></li><li><p>Rozpakowania programu z formatu w jakim jest rozprowadzany (najczęściej jest to plik tar skompresowany za pomocą <a href="https://man.freebsd.org/cgi/man.cgi?query=compress&amp;sektion=1&amp;format=html">compress(1)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=gzip&amp;sektion=1&amp;format=html">gzip(1)</a> lub <a href="https://man.freebsd.org/cgi/man.cgi?query=bzip2&amp;sektion=1&amp;format=html">bzip2(1)</a>).</p></li><li><p>Odnalezienie dokumentacji (najczęściej plik <span class=filename>INSTALL</span> lub <span class=filename>README</span> bądź pliki w podkatalogu <span class=filename>doc/</span>) i zapoznanie się z instrukcjami instalacji programu.</p></li><li><p>Kompilacja programu, jeśli rozprowadzany jest w postaci źródłowej. Może to wymagać również wykonania dodatkowych czynności, jak np. edycji pliku <span class=filename>Makefile</span> bądź uruchomienia skryptu <code>configure</code>.</p></li><li><p>Weryfikacja i instalacja aplikacji.</p></li></ol></div></div></div><div class=paragraph><p>Wszystko to przy założeniu, że w między czasie nie pojawiły się żadne trudności. Instalacja oprogramowania, które nie było przygotowywane z myślą o FreeBSD może wymagać nawet modyfikacji kodu źródłowego nim zacznie poprawnie funkcjonować.</p></div><div class=paragraph><p>Oczywiście, we FreeBSD można instalować oprogramowanie "tradycyjnym" sposobem. Jednakże system ten posiada dwa rozwiązania, które potrafią zaoszczędzić mnóstwo czasu i trudu: pakiety i porty. W chwili pisania tego tekstu, dostępnych za pomocą tych systemów jest przeszło 36000 aplikacji.</p></div><div class=paragraph><p>Dla każdego programu dostępny jest do pobrania pojedynczy pakiet, który zawiera skompilowane kopie plików aplikacji, zarówno plików uruchomieniowych jak i konfiguracyjnych czy dokumentacji. Pobranym plikiem można manipulować za pomocą poleceń <a href="https://man.freebsd.org/cgi/man.cgi?query=pkg_add&amp;sektion=1&amp;format=html">pkg_add(1)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=pkg_delete&amp;sektion=1&amp;format=html">pkg_delete(1)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=pkg_info&amp;sektion=1&amp;format=html">pkg_info(1)</a>, itp. Nowe programy można instalować za pomocą zaledwie jednego polecenia.</p></div><div class=paragraph><p>Port natomiast, jest zbiorem plików mających za zadanie zautomatyzować proces kompilacji danego programu z kodu źródłowego.</p></div><div class=paragraph><p>O ile typowa kompilacja programu składa się z wielu czynności wykonywanych przez użytkownika, o tyle pliki składające się na port zawierają dostateczną ilość informacji aby pozwolić systemowi zrobić to za nas. Wystarczy wprowadzić kilka prostych poleceń a system automatycznie pobierze kod źródłowy programu, rozpakuje, nałoży łatki, skompiluje i zainstaluje za nas.</p></div><div class=paragraph><p>Ponadto system portów może również posłużyć do przygotowania pakietów, którymi następnie można manipulować za pomocą <code>pkg_add</code> i innymi poleceniami zarządzających pakietami.</p></div><div class=paragraph><p>Obydwa systemy potrafią analizować <em>zależności</em> występujące pomiędzy aplikacjami. Załóżmy, że chcemy zainstalować program, który zależy od pewnej biblioteki. Zarówno program jak i biblioteka dostępne są w systemach portów i pakietów FreeBSD. Niezależnie od tego czy wykorzystamy polecenie <code>pkg_add</code> czy porty, by zainstalować program, to obydwa systemy spostrzegą, że biblioteka nie została zainstalowana i automatycznie zainstalują najpierw bibliotekę.</p></div><div class=paragraph><p>Można by się zastanawiać dlaczego FreeBSD wykorzystuje obydwa systemy, skoro ich działanie jest tak bardzo podobne. Tak pakiety jak i porty posiadają pewne zalety. Który system wykorzystamy zależy od naszych własnych upodobań.</p></div><div class=ulist><div class=title>Zalety pakietów</div><ul><li><p>Skompresowany plik pakietu zajmuje z reguły mniej miejsca niż skompresowany plik zawierający kod źródłowy.</p></li><li><p>Instalacja pakietów nie wymaga dodatkowej kompilacji. W przypadku dużych aplikacji, jak np. Mozilla, KDE czy GNOME może to być istotne. Szczególnie gdy pracuje się na dość wolnej maszynie.</p></li><li><p>Stosowanie pakietów nie wymaga żadnej wiedzy o procesie kompilowania oprogramowania w systemie FreeBSD.</p></li></ul></div><div class=ulist><div class=title>Zalety portów</div><ul><li><p>Pakiety są z reguły kompilowane z dość typowymi opcjami, ponieważ powinny być przydatne do wykorzystania na maksymalnej liczbie komputerów. Instalując programy z portów mamy możliwość "podkręcenia" opcji kompilacji, by (przykładowo) skompilować program zoptymalizowany dla procesorów Pentium IV lub Athlon.</p></li><li><p>Niektóre aplikacje posiadają pewne opcje kompilacji związane z zadaniami, które maja realizować. Przykładowo Apache może zostać skompilowany z wieloma różnorodnymi opcjami. Kompilując go z portów nie musimy zgadzać się na domyślne opcje mogąc samemu dokonać wyboru.</p><div class=paragraph><p>W niektórych przypadkach dostępnych jest kilka pakietów tej samej aplikacji skompilowanych z różnymi parametrami. Na przykład program Ghostscript dostępny jest jako pakiet <span class=filename>ghostscript</span> oraz <span class=filename>ghostscript-nox11</span>, zależnie od tego czy mamy zainstalowany serwer X11. O ile tego typu rozwiązania są teoretycznie możliwe do zrealizowania w systemie pakietów, o tyle staje się to praktycznie niemożliwe gdy aplikacja posiada więcej niż kilka różnych opcji kompilacji.</p></div></li><li><p>Warunki licencji niektórych aplikacji zabraniają rozprowadzania w postaci binarnej. Muszą być zatem rozprowadzane jako kod źródłowy.</p></li><li><p>Niektórzy nie ufają pakietom binarnym. W przypadku kodu źródłowego można (przynajmniej w teorii) przejrzeć go i samemu poszukać potencjalnych luk.</p></li><li><p>Jeśli posiadamy własne łaty będziemy potrzebowali kodu źródłowego aby je nanieść do programu.</p></li><li><p>Jeszcze inni po prostu lubią mieć pod ręką kod źródłowy, by móc go poczytać gdy się nudzą, zmodyfikować czy zapożyczyć pewne rozwiązania (o ile pozwala na to licencja), itd.</p></li></ul></div><div class=paragraph><p>Najlepszym sposobem śledzenia zmian dokonywanych w systemie portów jest zapisanie się na <a href=https://lists.FreeBSD.org/subscription/freebsd-ports>FreeBSD ports mailing list</a> oraz <a href=https://lists.FreeBSD.org/subscription/freebsd-ports-bugs>FreeBSD ports bugs mailing list</a>.</p></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>Przed instalacją jakiejkolwiek aplikacji należy sprawdzić na stronie <a href=http://vuxml.freebsd.org/>http://vuxml.freebsd.org/</a> czy w danym programie istnieją luki związane bezpieczeństwem.</p></div><div class=paragraph><p>Alternatywnie możemy zainstalować <a class=package href=https://cgit.freebsd.org/ports/tree/security/portaudit/>security/portaudit</a>, który automatycznie sprawdza wszystkie instalowane programy pod względem znanych luk bezpieczeństwa; weryfikowane są również porty przed kompilacją. W między czasie można wykorzystać polecenie <code>portaudit -F -a</code>, by sprawdzić zainstalowane już pakiety.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Pozostała część niniejszego rozdziału ma za zadanie wyjaśnić jak z wykorzystaniem systemu pakietów i portów instalować w systemie FreeBSD oprogramowanie innych producentów.</p></div></div><div class=sect2><h3 id=ports-finding-applications>4.3. Odnalezienie programu dla siebie<a class=anchor href=#ports-finding-applications></a></h3><div class=paragraph><p>Nim przystąpimy do instalacji programów musimy wiedzieć co chcemy zainstalować i jak się nazywa.</p></div><div class=paragraph><p>Lista dostępnych we FreeBSD programów rośnie cały czas. Na szczęście jest wiele sposobów na odnalezienie tego czego szukamy:</p></div><div class=ulist><ul><li><p>Na stronie internetowej FreeBSD pod adresem <a href=https://www.FreeBSD.org/ports/>http://www.FreeBSD.org/ports/</a> znajduje jest aktualna lista dostępnych programów. Listę można dowolnie przeszukiwać według kilku kryteriów, np. nazwy (jeśli ją znamy). Możliwe jest również przejrzenie spisu wszystkich aplikacji znajdujących się w danej kategorii.</p></li><li><p>Dzięki stronie FreshPorts (<a href=http://www.FreshPorts.org/>http://www.FreshPorts.org/</a>) prowadzonej przez Dana Langille’a możliwe jest bieżące śledzenie zmian aplikacji w drzewie portów. Witryna umożliwia otrzymywanie informacji drogą emailową o zmianach w wybranych portach.</p></li><li><p>Jeśli nie znamy nazwy programu, który chcemy zainstalować, warto poszukać go na stronach pokroju FreshMeat (<a href=http://www.freshmeat.net/>http://www.freshmeat.net/</a>) a następnie sprawdzić na stronie FreeBSD czy został przygotowany odpowiedni port.</p></li><li><p>Jeśli znamy dokładną nazwę portu a chcemy sprawdzić z jakiej pochodzi kategorii, można skorzystać z polecenia <a href="https://man.freebsd.org/cgi/man.cgi?query=whereis&amp;sektion=1&amp;format=html">whereis(1)</a>. Wystarczy wpisać <code>whereis plik</code>, gdzie <em>plik</em> jest nazwą programu, którego poszukujemy. Otrzymany wynik będzie postaci:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># whereis lsof</span>
lsof: /usr/ports/sysutils/lsof</code></pre></div></div><div class=paragraph><p>Przykład ten informuje nas, że program <code>lsof</code> (narzędzie systemowe) znajduje się w katalogu <span class=filename>/usr/ports/sysutils/lsof</span>.</p></div></li><li><p>Jeszcze innym sposobem na odnalezienie danego portu jest wykorzystanie mechanizmu przeszukiwania kolekcji portów. By skorzystać z tej funkcji należy przejść do katalogu <span class=filename>/usr/ports</span>. Następnie wpisać <code>make search name=nazwa-programu</code>, gdzie <em>program-name</em> jest nazwą poszukiwanej aplikacji. Przykładowo, szukając <code>lsof</code>:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/ports</span>
<span class=c># make search name=lsof</span>
Port:   lsof-4.56.4
Path:   /usr/ports/sysutils/lsof
Info:   Lists information about open files <span class=o>(</span>similar to fstat<span class=o>(</span>1<span class=o>))</span>
Maint:  obrien@FreeBSD.org
Index:  sysutils
B-deps:
R-deps:</code></pre></div></div><div class=paragraph><p>Część wyniku, która nas interesuje to wiersz zaczynający się od "Path:", a określający lokalizację portu. Pozostałe z uzyskanych w ten sposób informacji nie zostaną tutaj opisane, gdyż nie są potrzebne do instalacji programu.</p></div><div class=paragraph><p>Szersze przeszukanie kolekcji portów możliwe jest wykorzystując <code>make search key=zwrot</code>, gdzie <em>zwrot</em> jest dowolnym wyrazem. Opcja ta przeszukuje nazwy portów, komentarze, opisy i listy zależności. Może być wykorzystana do odnalezienia portów związanych z danym zagadnieniem gdy nie znamy nazwy poszukiwanego programu.</p></div><div class=paragraph><p>W obydwu przypadkach nie są rozróżniane małe i duże litery w poszukiwanym ciągu. Szukając zatem "LSOF" oraz "lsof" otrzymamy takie same wyniki.</p></div></li></ul></div></div><div class=sect2><h3 id=packages-using>4.4. Korzystanie z systemu pakietów<a class=anchor href=#packages-using></a></h3><div class=sect3><h4 id=_instalacja_pakietów>4.4.1. Instalacja pakietów<a class=anchor href=#_instalacja_pakietów></a></h4><div class=paragraph><p>Programu <a href="https://man.freebsd.org/cgi/man.cgi?query=pkg_add&amp;sektion=1&amp;format=html">pkg_add(1)</a> można użyć do instalacji programów zarówno z dysku lokalnego, jak i z sieci.</p></div><div class=exampleblock><div class=title>Przykład 5. Ręczne pobranie pakietu i instalacja lokalna</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ftp -a ftp2.FreeBSD.org</span>
Connected to ftp2.FreeBSD.org.
220 ftp2.FreeBSD.org FTP server <span class=o>(</span>Version 6.00LS<span class=o>)</span> ready.
331 Guest login ok, send your email address as password.
230-
230-     This machine is <span class=k>in </span>Vienna, VA, USA, hosted by Verio.
230-         Questions? E-mail freebsd@vienna.verio.net.
230-
230-
230 Guest login ok, access restrictions apply.
Remote system <span class=nb>type </span>is UNIX.
Using binary mode to transfer files.
ftp&gt; <span class=nb>cd</span> /pub/FreeBSD/ports/packages/sysutils/
250 CWD <span class=nb>command </span>successful.
ftp&gt; get lsof-4.56.4.tgz
<span class=nb>local</span>: lsof-4.56.4.tgz remote: lsof-4.56.4.tgz
200 PORT <span class=nb>command </span>successful.
150 Opening BINARY mode data connection <span class=k>for</span> <span class=s1>&#39;lsof-4.56.4.tgz&#39;</span> <span class=o>(</span>92375 bytes<span class=o>)</span><span class=nb>.</span>
100% |<span class=k>**************************************************</span>| 92375       00:00 ETA
226 Transfer complete.
92375 bytes received <span class=k>in </span>5.60 seconds <span class=o>(</span>16.11 KB/s<span class=o>)</span>
ftp&gt; <span class=nb>exit</span>
<span class=c># pkg_add lsof-4.56.4.tgz</span></code></pre></div></div></div></div><div class=paragraph><p>Jeśli nie posiadamy lokalnego źródła programów (np na płytach CD FreeBSD), będzie Ci prawdopodobnie łatwiej użyć komendy <a href="https://man.freebsd.org/cgi/man.cgi?query=pkg_add&amp;sektion=1&amp;format=html">pkg_add(1)</a> z opcją <code>-r</code>. Spowoduje to, że program samodzielnie określi odpowiednią wersję oprogramowania dla naszej wersji systemu. Następnie pobierze odpowiedni plik z sieci oraz go zainstaluje.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pkg_add -r lsof</span></code></pre></div></div><div class=paragraph><p>W powyższym przykładzie program pobierze właściwy pakiet i zainstaluje go bez jakiejkolwiek dalszej ingerencji użytkownika. Jeśli chcemy wskazać programowi alternatywny serwer lustrzany, należy odpowiednio zdefiniować zmienną środowiskową <code>PACKAGESITE</code>. Program <a href="https://man.freebsd.org/cgi/man.cgi?query=pkg_add&amp;sektion=1&amp;format=html">pkg_add(1)</a> do pobierania plików z serwerów wykorzystuje <a href="https://man.freebsd.org/cgi/man.cgi?query=fetch&amp;sektion=3&amp;format=html">fetch(3)</a>, który z kolei wykorzystuje różnorodne zmienne środowiskowe, m.in. <code>FTP_PASSIVE_MODE</code>, <code>FTP_PROXY</code> oraz <code>FTP_PASSWORD</code>. Może się okazać, że będziemy musieli zdefiniować niektóre z nich jeśli nasz komputer znajduje się za zaporą ogniową, bądź musi korzystać z serwera pośredniczącego FTP/HTTP proxy. Więcej informacji znaleźć można w podręczniku systemowym programu <a href="https://man.freebsd.org/cgi/man.cgi?query=fetch&amp;sektion=3&amp;format=html">fetch(3)</a>. Warto zauważyć, iż w powyższym przykładzie jako nazwę pakietu podano jedynie <code>lsof</code> zamiast <code>lsof-4.56.4</code>. Przy zdalnym pobieraniu pakietów nie należy podawać numeru wersji pakietu. Program <a href="https://man.freebsd.org/cgi/man.cgi?query=pkg_add&amp;sektion=1&amp;format=html">pkg_add(1)</a> automatycznie pobierze najnowszą wersję aplikacji.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Program <a href="https://man.freebsd.org/cgi/man.cgi?query=pkg_add&amp;sektion=1&amp;format=html">pkg_add(1)</a> pobierze najnowszą wersję aplikacji jedynie, gdy wykorzystujemy FreeBSD-CURRENT albo FreeBSD-STABLE. W przypadku -RELEASE pobrana zostanie wersja pakietu zbudowana dla danego wydania. Ograniczenie to można obejść modyfikując zmienną środowiskową <code>PACKAGESITE</code>. Na przykład, jeśli korzystamy z FreeBSD 5.4-RELEASE domyślnie <a href="https://man.freebsd.org/cgi/man.cgi?query=pkg_add&amp;sektion=1&amp;format=html">pkg_add(1)</a> będzie pobierał pakiety z <code><a href=ftp://ftp.freebsd.org/pub/FreeBSD/ports/i386/packages-5.4-release/Latest/ class=bare>ftp://ftp.freebsd.org/pub/FreeBSD/ports/i386/packages-5.4-release/Latest/</a></code>. By zmusić go do pobierania pakietów zbudowanych dla FreeBSD 5-STABLE należy zmodyfikować zmienną <code>PACKAGESITE</code> by wskazywała na <code><a href=ftp://ftp.freebsd.org/pub/FreeBSD/ports/i386/packages-5-stable/Latest/ class=bare>ftp://ftp.freebsd.org/pub/FreeBSD/ports/i386/packages-5-stable/Latest/</a></code>.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Pakiety rozpowszechniane są w formacie <span class=filename>.tgz</span> oraz <span class=filename>.tbz</span>. Możemy je pobrać z <a href=ftp://ftp.FreeBSD.org/pub/FreeBSD/ports/packages/>ftp://ftp.FreeBSD.org/pub/FreeBSD/ports/packages/</a>, w Polsce z <a href=ftp://ftp.pl.FreeBSD.org/pub/FreeBSD/ports/packages/>ftp://ftp.pl.FreeBSD.org/pub/FreeBSD/ports/packages/</a>, bądź odnaleźć na płytach CDROM FreeBSD. Każda płyta z cztero płytowej dystrybucji (także PowerPak’a itp) zawiera pakiety w katalogu <span class=filename>/packages</span>. Struktura katalogu podobna jest do drzewa portów <span class=filename>/usr/ports</span>. Każda kategoria ma swój własny katalog, ponadto każdy pakiet może zostać odnaleziony w katalogu <span class=filename>All</span> (Wszystkie).</p></div><div class=paragraph><p>Struktura katalogów pakietów jest identyczna względem struktury katalogów portów. Porty i pakiety kooperują za sobą, tworząc wspólnie cały system pakietów/portów.</p></div></div><div class=sect3><h4 id=_zarządzanie_pakietami>4.4.2. Zarządzanie pakietami<a class=anchor href=#_zarządzanie_pakietami></a></h4><div class=paragraph><p>Narzędziem służącym do przedstawienia informacji o zainstalowanych pakietach oraz wyświetlającym ich krótki opis jest <a href="https://man.freebsd.org/cgi/man.cgi?query=pkg_info&amp;sektion=1&amp;format=html">pkg_info(1)</a>.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pkg_info</span>
cvsup-16.1          A general network file distribution system optimized <span class=k>for </span>CV
docbook-1.2         Meta-port <span class=k>for </span>the different versions of the DocBook DTD
...</code></pre></div></div><div class=paragraph><p>Program <a href="https://man.freebsd.org/cgi/man.cgi?query=pkg_version&amp;sektion=1&amp;format=html">pkg_version(1)</a> jest natomiast narzędziem, które podsumowuje wersje wszystkich zainstalowanych pakietów. Porównuje je następnie z tymi które znajdują się w drzewie portów.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pkg_version</span>
cvsup                       <span class=o>=</span>
docbook                     <span class=o>=</span>
...</code></pre></div></div><div class=paragraph><p>Symbol w drugiej kolumnie określa wiek zainstalowanej wersji oprogramowania względem wersji odnalezionej w portach.</p></div><table class="tableblock frame-none grid-all stretch informaltable"><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">Symbol</th><th class="tableblock halign-left valign-top">Znaczenie</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock>=</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Wersja odnaleziona w portach jest identyczna.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>&lt;</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Wersja jest starsza, niż ta odnaleziona w portach.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Zainstalowana wersja jest nowsza, niż znaleziona w portach. (Prawdopodobnie lokalne drzewo portów nie zostało zaktualizowane.)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>?</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Zainstalowany pakiet nie może zostać odnaleziony w drzewie portów. (Może to mieć miejsce np. w sytuacji gdy zainstalowany port został usunięty z kolekcji portów, bądź zmienił nazwę.)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>*</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Istnieje wiele wersji tego programu.</p></td></tr></tbody></table></div><div class=sect3><h4 id=_usuwanie_pakietów>4.4.3. Usuwanie pakietów<a class=anchor href=#_usuwanie_pakietów></a></h4><div class=paragraph><p>Aby usunąć uprzednio zainstalowane oprogramowanie użyj <a href="https://man.freebsd.org/cgi/man.cgi?query=pkg_delete&amp;sektion=1&amp;format=html">pkg_delete(1)</a>.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pkg_delete xchat-1.7.1</span></code></pre></div></div></div><div class=sect3><h4 id=_dodatkowe_informacje>4.4.4. Dodatkowe informacje<a class=anchor href=#_dodatkowe_informacje></a></h4><div class=paragraph><p>Wszystkie informacje o pakietach znajdują się w katalogu <span class=filename>/var/db/pkg</span>. Lista zainstalowanych plików, a także opis każdej paczki można odnaleźć właśnie w tym katalogu.</p></div></div></div><div class=sect2><h3 id=ports-using>4.5. Korzystanie z kolekcji portów<a class=anchor href=#ports-using></a></h3><div class=paragraph><p>Poniższy podrozdział dostarcza podstawowych informacji z zakresu używania kolekcji portów, w stopniu umożliwiającym instalowanie lub odinstalowywanie programów z własnego systemu. Szczegółowy opis parametrów polecenia <code>make</code> i zmiennych środowiskowych dostępny jest w podręczniku systemowym <a href="https://man.freebsd.org/cgi/man.cgi?query=ports&amp;sektion=7&amp;format=html">ports(7)</a>.</p></div><div class=sect3><h4 id=ports-tree>4.5.1. Pozyskanie kolekcji portów<a class=anchor href=#ports-tree></a></h4><div class=paragraph><p>Zanim zainstalujemy jakikolwiek port, musimy pobrać kolekcję portów, która w zasadzie jest zestawem plików <span class=filename>Makefiles</span>, łat i opisowych. Kolekcja znajduje się w katalogu <span class=filename>/usr/ports</span>.</p></div><div class=paragraph><p>W trakcie instalacji FreeBSD, sysinstall zapytał czy chcemy zainstalować kolekcję portów. Jeśli wybraliśmy nie, poniższe instrukcje pomogą nam własnoręcznie zainstalować kolekcję portów:</p></div><div class="exampleblock procedure"><div class=content><div class=paragraph><p><strong>Procedure: Metoda CVSup</strong></p></div><div class=paragraph><p>Jest to prosta i szybka metoda pobrania kolekcji portów wykorzystująca system CVSup. Więcej informacji o CVSup dostępnych jest w podrozdziale <a href=./#cvsup>Korzystanie z CVSup</a>.</p></div><div class=paragraph><p>Bardzo ważnym jest, aby upewnić się, że katalog <span class=filename>/usr/ports</span> jest pusty nim po raz pierwszy uruchomimy CVSup! Jeśli posiadamy już kolekcję portów pozyskaną z innego źródła CVSup nie usunie nieużywanych plików łat.</p></div><div class="olist arabic"><ol class=arabic><li><p>Zainstaluj pakiet <a class=package href=https://cgit.freebsd.org/ports/tree/net/cvsup-without-gui/>net/cvsup-without-gui</a>:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pkg_add -r cvsup-without-gui</span></code></pre></div></div><div class=paragraph><p>Więcej informacji w podrozdziale <a href=./#cvsup-install>Instalacja CVSup</a> (<a href=./#cvsup-install>Installation</a>).</p></div></li><li><p>Uruchom <code>cvsup</code>:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cvsup -L 2 -h cvsup.FreeBSD.org /usr/shared/examples/cvsup/ports-supfile</span></code></pre></div></div><div class=paragraph><p>Warto zastąpić <em>cvsup.FreeBSD.org</em> adresem serwera CVSup zlokalizowanego bliżej nas. Kompletna lista serwerów lustrzanych dostępna jest w podrozdziale <a href=./#cvsup-mirrors>Serwery lustrzane CVSup</a> (<a href=./#cvsup-mirrors>CVSup Sites</a>).</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Można wykorzystać własny plik <span class=filename>ports-supfile</span>, by np. uniknąć konieczności podawania adresu serwera CVSup z linii poleceń.</p></div><div class="olist loweralpha procedure"><ol class=loweralpha type=a><li><p>W takim wypadku, jako użytkownik <code>root</code>, skopiuj plik <span class=filename>/usr/shared/examples/cvsup/ports-supfile</span> do innego katalogu, np. <span class=filename>/root</span> bądź własnego katalogu domowego.</p></li><li><p>Zmodyfikuj plik <span class=filename>ports-supfile</span>.</p></li><li><p>Zmień wpis _CHANGE_THIS.FreeBSD.org_na adres wybranego serwera lustrzanego CVSup. Kompletna lista serwerów lustrzanych dostępna jest w podrozdziale <a href=./#cvsup-mirrors>Serwery lustrzane CVSup</a> (<a href=./#cvsup-mirrors>CVSup Sites</a>).</p></li><li><p>Teraz uruchom <code>cvsup</code> używając polecenia::</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cvsup -L 2 /root/ports-supfile</span></code></pre></div></div></li></ol></div></td></tr></tbody></table></div></li><li><p>Późniejsze wpisanie polecenia <a href="https://man.freebsd.org/cgi/man.cgi?query=cvsup&amp;sektion=1&amp;format=html">cvsup(1)</a> spowoduje sprawdzenie zmian dokonanych w kolekcji portów i aktualizację lokalnej wersji. Nie spowoduje to natomiast automatycznie ponownego skompilowania wykorzystywanych przez nas portów.</p></li></ol></div></div></div><div class="exampleblock procedure"><div class=content><div class=paragraph><p><strong>Procedure: Metoda Portsnap</strong></p></div><div class=paragraph><p>Portsnap jest alternatywnym systemem dystrybucji kolekcji portów. Po raz pierwszy został dołączony do FreeBSD 6.0. W starszych wersjach może zostać zainstalowany z pakietu <a class=package href=https://cgit.freebsd.org/ports/tree/sysutils/portsnap/>sysutils/portsnap</a>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pkg_add -r portsnap</span></code></pre></div></div><div class=paragraph><p>Szczegółowe informacje o możliwościach programu dostępne są w podrozdziale <a href=./#portsnap>Korzystanie z Portsnap</a>.</p></div><div class="olist arabic"><ol class=arabic><li><p>Ten punkt możemy pominąć jeśli posiadamy FreeBSD 6.1-RELEASE bądź najnowszą wersję programu Portsnap. Przy pierwszym uruchomieniu programu <a href="https://man.freebsd.org/cgi/man.cgi?query=portsnap&amp;sektion=8&amp;format=html">portsnap(8)</a> zostanie automatycznie utworzony katalog <span class=filename>/usr/ports</span>. W starszych wersjach programu wymagane jest własnoręczne utworzenie katalogu:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mkdir /usr/ports</span></code></pre></div></div></li><li><p>Pobierz skompresowaną migawkę kolekcji portów do katalogu <span class=filename>/var/db/portsnap</span>. Można następnie zakończyć połączenie z Internetem, jeśli jest taka potrzeba.</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># portsnap fetch</span></code></pre></div></div></li><li><p>Jeśli uruchamiany Portsnap po raz pierwszy należy rozpakować migawkę do katalogu <span class=filename>/usr/ports</span>:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># portsnap extract</span></code></pre></div></div><div class=paragraph><p>Jeśli posiadamy już kolekcję portów w <span class=filename>/usr/ports</span> i jedynie ją aktualizujemy, wpisujemy polecenie:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># portsnap update</span></code></pre></div></div></li></ol></div></div></div><div class="exampleblock procedure"><div class=content><div class=paragraph><p><strong>Procedure: Metoda sysinstall</strong></p></div><div class=paragraph><p>Metoda ta instaluje kolekcję portów z lokalnego nośnika posługując się programem sysinstall. Zainstalowana zostanie kopia kolekcji z dnia, w którym przygotowana została dana wersja FreeBSD. Jeśli dysponujemy połączeniem z Internetem powinniśmy zawsze stosować jedną z metod opisanych powyżej.</p></div><div class="olist arabic"><ol class=arabic><li><p>Uruchom <code>sysinstall</code> jako użytkownik <code>root</code> (<code>/stand/sysinstall</code> w wersjach FreeBSD starszych niż 5.2):</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sysinstall</span></code></pre></div></div></li><li><p>Przejdź w dół, wybierz <span class=guimenuitem>Configure</span>, i naciśnij <kbd>Enter</kbd>.</p></li><li><p>Przejdź w dół, wybierz <span class=guimenuitem>Distributions</span> i naciśnij <kbd>Enter</kbd>.</p></li><li><p>Przejdź w dół do opcji <span class=guimenuitem>ports</span> i naciśnij <kbd>Spację</kbd>.</p></li><li><p>Przejdź do góry do opcji <span class=guimenuitem>Exit</span> i naciśnij <kbd>Enter</kbd>.</p></li><li><p>Ustaw wybrany przez siebie typ medium instalacji, jak np. płytę CDROM, serwer FTP, itd.</p></li><li><p>Przejdź do góry do opcji <span class=guimenuitem>Exit</span> i naciśnij <kbd>Enter</kbd>.</p></li><li><p>Naciśni <kbd>X</kbd> by wyjść z programu sysinstall.</p></li></ol></div></div></div></div><div class=sect3><h4 id=ports-skeleton>4.5.2. Instalacja Portów<a class=anchor href=#ports-skeleton></a></h4><div class=paragraph><p>Pierwsza rzecz o jakiej należy wspomnieć omawiając kolekcję portów, jest "szkielet". Mówiąc w skrócie, szkielet portu jest minimalnym zestawem plików, które informują FreeBSD, jak poprawnie skompilować i zainstalować program. Każdy szkielet portu zawiera:</p></div><div class=ulist><ul><li><p>Plik <span class=filename>Makefile</span>. Plik ten zawiera różne dane określające jak skompilować aplikację oraz gdzie ją zainstalować w systemie.</p></li><li><p>Plik <span class=filename>distinfo</span> Plik ten zawiera informacje dotyczące plików, które muszą zostać pobrane, by skompilować port. Ponadto zawiera sumy kontrolne, na podstawie których <a href="https://man.freebsd.org/cgi/man.cgi?query=md5&amp;sektion=1&amp;format=html">md5(1)</a> potrafi sprawdzić, czy pliki nie uległy uszkodzeniu w trakcie pobierania z sieci.</p></li><li><p>Katalog <span class=filename>files</span>, który zawiera łaty pozwalające skompilować i zainstalować program w naszym systemie FreeBSD. Łaty są małymi plikami, w których określone są zmiany dotyczące konkretnych plików. Są to pliki tekstowe i po prostu mówią "Usuń linię 10" lub "Zmień linię 26 na to: …​". Łatki są także znane jako "diffs" (ang. skrót od różnice) ponieważ są generowane przez program <a href="https://man.freebsd.org/cgi/man.cgi?query=diff&amp;sektion=1&amp;format=html">diff(1)</a>.</p><div class=paragraph><p>Ten katalog może zawierać także inne pliki używane do kompilacji portu.</p></div></li><li><p>Plik opisu <span class=filename>pkg-descr</span>. Jest to bardziej szczegółowy, nierzadko wieloliniowy opis programu.</p></li><li><p>Plik listy <span class=filename>pkg-plist</span>. Jest to lista wszystkich plików, które zostaną zainstalowane przez port. Jest to także lista plików, które należy usunąć w przypadku odinstalowywania.</p></li></ul></div><div class=paragraph><p>Niekiedy porty zawierają również inne pliki, jak na przykład <span class=filename>pkg-message</span> (message-wiadomość). System portów używa tych plików w specjalnych sytuacjach. Jeśli potrzebujesz więcej informacji na temat tych plików i portów w ogóle, zajrzyj do podręcznika <a href=https://docs.freebsd.org/en/books/porters-handbook/>FreeBSD Porter’s Handbook</a>.</p></div><div class=paragraph><p>Jak już raz powiedziano, porty zawierają instrukcje odnośnie kompilacji programów z kodu źródłowego. Jednakże nie zawierają one samego kodu. Kod pobrać można z płyty CD bądź z Internetu. Rozprowadzany może być w dowolnej postaci jaką wybierze sobie jego producent, przy czym najczęściej jest to spakowany plik tar skompresowany dodatkowo gzipem. Kod źródłowy programu nazywany jest "distfile". Poniżej przedstawione zostały dwie metody instalacji portów we FreeBSD.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>By móc zainstalować port musimy być zalogowania jako użytkownik <code>root</code>.</p></div></td></tr></tbody></table></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>Przed instalacją jakiegokolwiek portu należy upewnić się, że dysponujemy aktualną kolekcją portów oraz sprawdzić potencjalne luki bezpieczeństwa związane z danym portem na stronie <a href=http://vuxml.freebsd.org/>http://vuxml.freebsd.org/</a>.</p></div><div class=paragraph><p>Istnieje możliwość zautomatyzowania procesu weryfikacji potencjalnych luk bezpieczeństwa przed instalacją portu. Do tego celu można wykorzystać program portaudit, dostępny również w kolekcji portów (<a class=package href=https://cgit.freebsd.org/ports/tree/security/portaudit/>security/portaudit</a>). Wydanie polecenia <code>portaudit -F</code> przed instalacją nowego portu spowoduje pobranie aktualnej bazy luk bezpieczeństwa. Możliwe jest również wykonywanie regularnych aktualizacji bazy i rewizji zainstalowanego oprogramowania w trakcie codziennego przeglądu bezpieczeństwa systemu. Więcej informacji dostępnych jest na stronach podręcznika systemowego <a href="https://man.freebsd.org/cgi/man.cgi?query=portaudit&amp;sektion=1&amp;format=html">portaudit(1)</a> i <a href="https://man.freebsd.org/cgi/man.cgi?query=periodic&amp;sektion=8&amp;format=html">periodic(8)</a>.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Sposób funkcjonowania kolekcji portów wiąże się z założeniem, że posiadamy połączenie z Internetem. Jeśli nie, będziemy musieli ręcznie pobierać kod źródłowy "distfile" i umieszczać w katalogu <span class=filename>/usr/ports/distfiles</span> dla każdego instalowanego portu.</p></div><div class=paragraph><p>By rozpocząć instalację należy przejść do katalogu wybranego portu:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/ports/sysutils/lsof</span></code></pre></div></div><div class=paragraph><p>Wewnątrz katalogu <span class=filename>lsof</span> znajduje się szkielet portu. Następnym krokiem jest kompilacja programu, co sprowadza się do wpisania polecenia <code>make</code>. Efekt działania polecenia powinien być zbliżony do:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># make</span>
<span class=o>&gt;&gt;</span> lsof_4.57D.freebsd.tar.gz doesn<span class=s1>&#39;t seem to exist in /usr/ports/distfiles/.
&gt;&gt; Attempting to fetch from ftp://lsof.itap.purdue.edu/pub/tools/unix/lsof/.
===&gt;  Extracting for lsof-4.57
...
[extraction output snipped]
...
&gt;&gt; Checksum OK for lsof_4.57D.freebsd.tar.gz.
===&gt;  Patching for lsof-4.57
===&gt;  Applying FreeBSD patches for lsof-4.57
===&gt;  Configuring for lsof-4.57
...
[configure output snipped]
...
===&gt;  Building for lsof-4.57
...
[compilation output snipped]
...
#</span></code></pre></div></div><div class=paragraph><p>Po skończeniu kompilacji powracamy do linii poleceń. Kolejnym krokiem jest instalacja portu poprzez wpisanie polecenia <code>make</code> wraz ze słowem <code>install</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># make install</span>
<span class=o>===&gt;</span>  Installing <span class=k>for </span>lsof-4.57
...
<span class=o>[</span>installation output snipped]
...
<span class=o>===&gt;</span>   Generating temporary packing list
<span class=o>===&gt;</span>   Compressing manual pages <span class=k>for </span>lsof-4.57
<span class=o>===&gt;</span>   Registering installation <span class=k>for </span>lsof-4.57
<span class=o>===&gt;</span>  SECURITY NOTE:
      This port has installed the following binaries which execute with
      increased privileges.
<span class=c>#</span></code></pre></div></div><div class=paragraph><p>Gdy ponownie powrócimy do linii poleceń, powinniśmy być już w stanie uruchomić właśnie zainstalowaną aplikację. Ostrzeżenie jakie pojawi się na ekranie związane jest z faktem, że lsof jest programem pracującym ze zwiększonymi przywilejami. W trakcie kompilacji i instalacji portów powinniśmy zwracać uwagę na wszystkie pojawiające się ostrzeżenia.</p></div><div class=paragraph><p>Dobrym pomysłem, jest również usunięcie podkatalogu zawierającego wszystkie tymczasowe pliki wykorzystywane w trakcie kompilacji. Nie tylko dlatego, że niepotrzebnie zajmuje miejsce na dysku, ale również dlatego, że może być przyczyną problemów podczas aktualizacji programu do nowszej wersji.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># make clean</span>
<span class=o>===&gt;</span>  Cleaning <span class=k>for </span>lsof-4.57
<span class=c>#</span></code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Można sobie oszczędzić dwóch naddatkowych kroków wpisując od razu <code>make install clean</code> zamiast trzech osobnych poleceń <code>make</code>, <code>make install</code> oraz <code>make clean</code>.</p></div></td></tr></tbody></table></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Niektóre powłoki utrzymują bufor listy poleceń z katalogów znajdujących się w zmiennej środowiskowej <code>PATH</code>. Ma to za zadanie przyśpieszyć wyszukiwanie plików binarnych tychże poleceń. Jeśli korzystamy z jednej z takich właśnie powłok może okazać się niezbędnym wydać polecenie <code>rehash</code> po instalacji portu, nim będziemy mogli wykorzystać nowo zainstalowany program. Polecenie to dostępne jest przy wykorzystaniu powłoki typu <code>tcsh</code>. Natomiast dla powłoki typu <code>sh</code> odpowiednikiem jest <code>hash -r</code>. Więcej informacji dostępnych jest w dokumentacji powłoki.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Niektóre wydawnictwa na płytach DVD-ROM, jak np. FreeBSD Toolkit z <a href=http://www.freebsdmall.com/>FreeBSD Mall</a>, zawierają źródła distfile. Mogą być one wykorzystane z kolekcją portów. Wystarczy zamontować płytę DVD w <span class=filename>/cdrom</span>. Jeśli natomiast używamy innego punktu montowania dla płyt musimy zmodyfikować zmienną <code>CD_MOUNTPTS</code> by wskazywała na właściwe miejsce. Niezbędne źródła distfile zostaną automatycznie wykorzystane jeśli znajdują się na płycie.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Mimo wszystko należy mieć w pamięci, że licencje nielicznych portów nie zezwalają na załączenie ich na płycie CD-ROM. Może to być np. z powodu konieczności wcześniejszej rejestracji przed pobraniem źródeł bądź ich redystrybucja nie jest dozwolona. Jeśli chcemy zainstalować port, który nie znajduje się na płycie CD musimy mieć połączenie z Internetem.</p></div></td></tr></tbody></table></div><div class=paragraph><p>System portów do pobierania plików wykorzystuje program <a href="https://man.freebsd.org/cgi/man.cgi?query=fetch&amp;sektion=1&amp;format=html">fetch(1)</a>, który z kolei potrafi korzystać z wielu zmiennych środowiskowych, m.in. <code>FTP_PASSIVE_MODE</code>, <code>FTP_PROXY</code> czy <code>FTP_PASSWORD</code>. Jeśli znajdujemy się za zaporą ogniową, bądź musimy korzystać z serwera pośredniczącego FTP/HTTP proxy, może się okazać, że będziemy musieli ustawić niektóre z tych zmiennych. Kompletna lista wykorzystywanych zmiennych dostępna jest w podręczniku systemowym <a href="https://man.freebsd.org/cgi/man.cgi?query=fetch&amp;sektion=3&amp;format=html">fetch(3)</a>.</p></div><div class=paragraph><p>Dla użytkowników nie mogących być cały czas połączonych z Internetem dostępne jest polecenie <code>make fetch</code>. Wystarczy wpisać to polecenie znajdując się w głównym katalogu drzewa portów (<span class=filename>/usr/ports</span>) a wymagane pliki zostaną automatycznie pobrane. Polecenie to będzie również funkcjonować w podkatalogach, np. <span class=filename>/usr/ports/net</span>. Jednakże, w takiej sytuacji <em>nie</em> zostaną automatycznie pobrane źródła bibliotek, od których zależy dany port. Zamieniając parametr <code>fetch</code> na <code>fetch-recursive</code> spowodujemy pobranie również źródeł wszystkich portów, od których zależy instalowany program.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Możliwe jest kompilowanie każdego portu z osobna w danej kategorii, bądź wszystkich na raz poprzez polecenie <code>make</code> wykonane, analogicznie do <code>make fetch</code>, w głównym katalogu kategorii. Jednakże jest to niebezpieczna metoda, gdyż niektóre porty nie mogą jednocześnie funkcjonować w systemie, bądź mogą zainstalować różne pliki o tej samej nazwie.</p></div></td></tr></tbody></table></div><div class=paragraph><p>W naprawdę żadkich przypadkach, użytkownicy mogą pozyskać pliki distfile z innego źródła niż <code>MASTER_SITES</code> (miejsce skąd je pobiera system portów). Opcję <code>MASTER_SITES</code> można zastąpić za pomocą następującego polecenia:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/ports/directory</span>
<span class=c># make MASTER_SITE_OVERRIDE= \</span>
ftp://ftp.FreeBSD.org/pub/FreeBSD/ports/distfiles/ fetch</code></pre></div></div><div class=paragraph><p>W tym przykładzie zastąpiliśmy opcję <code>MASTER_SITES</code> adresem <code>ftp.FreeBSD.org/pub/FreeBSD/ports/distfiles/</code>.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Niektóre porty umożliwiają (a nawet wymagają) podanie pewnych opcji kompilacji, które mogą włączyć bądź wyłączyć nie potrzebne części aplikacji, pewne opcje bezpieczeństwa i inne parametry. Z przychodzących na myśl tego typu programów to <a class=package href=https://cgit.freebsd.org/ports/tree/www/mozilla/>www/mozilla</a>, <a class=package href=https://cgit.freebsd.org/ports/tree/security/gpgme/>security/gpgme</a> oraz <a class=package href=https://cgit.freebsd.org/ports/tree/mail/sylpheed-claws/>mail/sylpheed-claws</a>. Za każdym razem gdy dostępne będą tego typu opcje wyświetlony zostanie komunikat.</p></div></td></tr></tbody></table></div><div class=sect4><h5 id=_ignorowanie_domyślnych_katalogów_portów>4.5.2.1. Ignorowanie domyślnych katalogów portów<a class=anchor href=#_ignorowanie_domyślnych_katalogów_portów></a></h5><div class=paragraph><p>Czasami okazuje się być przydatne (a nawet wymagane) by skorzystać z innych katalogów tymczasowych i docelowych. Domyślne katalogi można zastąpić wykorzystując zmienne <code>WRKDIRPREFIX</code> i <code>PREFIX</code>. Na przykład:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># make WRKDIRPREFIX=/usr/home/example/ports install</span></code></pre></div></div><div class=paragraph><p>spowoduje skompilowanie portu w katalogu <span class=filename>/usr/home/example/ports</span> i instalację w podkatalogach <span class=filename>/usr/local</span>.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># make PREFIX=/usr/home/example/local install</span></code></pre></div></div><div class=paragraph><p>spowoduje natomiast kompilację w katalogu <span class=filename>/usr/ports</span> oraz instalację w podkatalogach <span class=filename>/usr/home/example/local</span>.</p></div><div class=paragraph><p>I oczywiście,</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># make WRKDIRPREFIX=../ports PREFIX=../local install</span></code></pre></div></div><div class=paragraph><p>spowoduje połącznie obydwu powyższych ustawień (jest to za długie by całkowicie zmieściło się na stronie, ale powinno dać ogólne wyobrażenie).</p></div><div class=paragraph><p>Alternatywnie, obydwie zmienne mogą być również określone jako zmienne środowiskowe. Informacje o definiowaniu zmiennych środowiskowych dostępne są w podręczniku systemowym naszej powłoki.</p></div></div><div class=sect4><h5 id=_jak_poradzić_sobie_z_imake>4.5.2.2. Jak poradzić sobie z <code>imake</code><a class=anchor href=#_jak_poradzić_sobie_z_imake></a></h5><div class=paragraph><p>Niektóre porty wykorzystujące <code>imake</code> (część Systemu okien X) nie współpracują ze zmienną <code>PREFIX</code> i mimo wszystko będą instalowały programy w <span class=filename>/usr/X11R6</span>. Podobnie niektóre z portów napisanych w języku Perl ignorują zmienną <code>PREFIX</code> i instalują programy w głównym drzewie Perla. Zmuszenie tych portów do współpracy ze zmienną <code>PREFIX</code> jest niezmiernie trudne, albo wręcz niemożliwe.</p></div></div></div><div class=sect3><h4 id=ports-removing>4.5.3. Usuwanie zainstalowanych portów<a class=anchor href=#ports-removing></a></h4><div class=paragraph><p>Teraz, gdy wiesz już jak instalować porty, zastanawiasz się prawdopodobnie jak je usuwać, na przykład w wypadku, gdy zainstalowaliśmy port, ale okazało się jednak, że to nie był ten którego szukaliśmy. W ramach przykładu usuniemy port, który instalowaliśmy poprzednio (dla tych którzy nie uważają, był to <code>lsof</code>). Podobnie jak w przypadku pakietów (szerzej opisane w podrozdziale traktującym o <a href=#packages-using>pakietach</a>), również porty usuwane są za pomocą polecenia <a href="https://man.freebsd.org/cgi/man.cgi?query=pkg_delete&amp;sektion=1&amp;format=html">pkg_delete(1)</a>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pkg_delete lsof-4.57</span></code></pre></div></div></div><div class=sect3><h4 id=ports-upgrading>4.5.4. Aktualizacja portów<a class=anchor href=#ports-upgrading></a></h4><div class=paragraph><p>Na wstępie musimy wyświetlić zdezaktualizowane porty w kolekcji. Wykorzystamy do tego polecenie <a href="https://man.freebsd.org/cgi/man.cgi?query=pkg_version&amp;sektion=1&amp;format=html">pkg_version(1)</a>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pkg_version -v</span></code></pre></div></div><div class=sect4><h5 id=ports-file-updating>4.5.4.1. <span class=filename>/usr/ports/UPDATING</span><a class=anchor href=#ports-file-updating></a></h5><div class=paragraph><p>Po zaktualizowaniu kolekcji, a przed próbą aktualizacji jakichkolwiek portów, należy zapoznać się z zawartością pliku <span class=filename>/usr/ports/UPDATING</span>. Plik ten opisuje różne zagadnienia i dodatkowe kroki, na które można natknąć się i będzie trzeba wykonać podczas aktualizacji, np. zmiany formatu plików czy zmiany w lokalizacji plików konfiguracyjnych.</p></div><div class=paragraph><p>Jeśli opis w pliku <span class=filename>UPDATING</span> mówi coś innego niż ten tekst, należy zastosować się do opisu.</p></div></div><div class=sect4><h5 id=portupgrade>4.5.4.2. Aktualizacja portów z wykorzystaniem programu Portupgrade<a class=anchor href=#portupgrade></a></h5><div class=paragraph><p>Program portupgrade został zaprojektowany by ułatwić aktualizację zainstalowanych w systemie portów. Dostępny jest z portu <a class=package href=https://cgit.freebsd.org/ports/tree/sysutils/portupgrade/>sysutils/portupgrade</a>. Jego instalacja przebiega dokładnie tak samo, jak każdego innego portu, wykorzystując polecenie <code>make install clean</code> command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/ports/sysutils/portupgrade</span>
<span class=c># make install clean</span></code></pre></div></div><div class=paragraph><p>Przeskanujmy następnie listę zainstalowanych portów za pomocą polecenia <code>pkgdb -F</code> i usuńmy wszystkie niezgodności jakie nam zwróci skanowanie. Regularne skanowanie przed każdą aktualizacją jest zdecydowanie dobrym pomysłem.</p></div><div class=paragraph><p>Wydanie polecenia <code>portupgrade -a</code> spowoduje, że program portupgrade rozpocznie aktualizację wszystkich przedawnionych portów zainstalowanych w naszym systemie. Parametr <code>-i</code> pozwoli przejść w tryb interaktywny, gdzie będziemy musieli potwierdzić aktualizację każdego portu.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># portupgrade -ai</span></code></pre></div></div><div class=paragraph><p>By zaktualizować jedynie wybraną aplikację zamiast wszystkich portów należy wykorzystać polecenie <code>portupgrade nazwa_programu</code>. Opcja <code>-R</code> oznacza, że portupgrade powinien najpierw zaktualizować wszystkie porty, od których zależy dany program.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># portupgrade -R firefox</span></code></pre></div></div><div class=paragraph><p>By do instalacji wykorzystać pakiety zamiast portów należy dodać parametr <code>-P</code>. Wówczas portupgrade przeszuka katalogi zawarte w zmiennej <code>PKG_PATH</code>. Jeśli pakiet nie zostanie odnaleziony lokalnie zostanie pobrany z Internetu. Jeśli nie będzie możliwe żadne z powyższych, wówczas portupgrade wykorzysta do aktualizacji porty. By temu zapobiec należy zastosować parametr <code>-PP</code>.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># portupgrade -PR gnome2</span></code></pre></div></div><div class=paragraph><p>Aby pobrać jedynie pliki źródłowe distfiles (bądź pakiety, gdy wykorzystamy opcję <code>-P</code>) bez kompilacji czy instalacji czegokolwiek należy użyć parametru <code>-F</code>. Więcej informacji dostępnych jest w <a href="https://man.freebsd.org/cgi/man.cgi?query=portupgrade&amp;sektion=1&amp;format=html">portupgrade(1)</a>.</p></div></div><div class=sect4><h5 id=portmanager>4.5.4.3. Aktualizacja portów z wykorzystaniem programu Portmanager<a class=anchor href=#portmanager></a></h5><div class=paragraph><p>Kolejnym narzędziem ułatwiającym aktualizację zainstalowanych portów jest Portmanager, dostępny z portu <a class=package href=https://cgit.freebsd.org/ports/tree/sysutils/portmanager/>sysutils/portmanager</a>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/ports/sysutils/portmanager</span>
<span class=c># make install clean</span></code></pre></div></div><div class=paragraph><p>Wszystkie zainstalowane porty mogą zostać zaktualizowane za pomocą polecenia:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># portmanager -u</span></code></pre></div></div><div class=paragraph><p>Wykorzystując parametr <code>-ui</code> przechodzimy w tryb interaktywny, gdzie będziemy pytani o potwierdzenie każdej operacji wykonywanej przez Portmanager. Program ten może być z równym powodzeniem wykorzystywany do instalacji nowych portów w systemie. W przeciwieństwie do polecenia <code>make install clean</code> program Portmanager zaktualizuje wszystkie zależności nim skompiluje i zainstaluje wybrany port.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># portmanager x11/gnome2</span></code></pre></div></div><div class=paragraph><p>Gdy wystąpią problemy z zależnościami wybranego portu można wykorzystać Portmanagera, by ponownie skompilował je we właściwej kolejności. Na koniec zostanie również ponownie skompilowany port stwarzający problemy.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># portmanager graphics/gimp -f</span></code></pre></div></div><div class=paragraph><p>Więcej informacji dostępnych jest na stronach podręcznika systemowego Portmanagera.</p></div></div></div><div class=sect3><h4 id=ports-disk-space>4.5.5. Porty i przestrzeń na dysku<a class=anchor href=#ports-disk-space></a></h4><div class=paragraph><p>Korzystanie z kolekcji portów z czasem odbije się na wolnym miejscu na dysku. Dlatego też zawsze po skompilowaniu i zainstalowaniu programu z portu powinniśmy pamiętać o usunięciu tymczasowych katalogów roboczych (ang. <span class=filename>work</span> directories) wykorzystując do tego polecenie <code>make clean</code>. Całą kolekcję natomiast można oczyścić wpisujące polecenie:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># portsclean -C</span></code></pre></div></div><div class=paragraph><p>Z czasem uzbiera nam się wiele katalogów <span class=filename>distfiles</span>, które będą jedynie zajmować przestrzeń na dysku. Możemy je ręcznie usuwać bądź posłużyć się następującym poleceniem, by usunąć wszystkie katalogi distfiles nie powiązane aktualnie z żadnym portem:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># portsclean -D</span></code></pre></div></div><div class=paragraph><p>Badź, by usunąć wszystkie katalogi disftiles, do których nie odnosi się żaden z aktualnie zainstalowanych portów w naszym systemie:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># portsclean -DD</span></code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Program <code>portsclean</code> jest częścią pakietu portupgrade.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Pamiętajmy również o usuwaniu instalowanych portów gdy już ich nie potrzebujemy. Przydatne narzędzie pozwalające zautomatyzować te czynności znajduje się w <a class=package href=https://cgit.freebsd.org/ports/tree/sysutils/pkg_cutleaves/>sysutils/pkg_cutleaves</a>.</p></div></div></div><div class=sect2><h3 id=ports-nextsteps>4.6. Czynności po-instalacyjne<a class=anchor href=#ports-nextsteps></a></h3><div class=paragraph><p>Po zainstalowaniu nowego programu z reguły chcemy zapoznać się z dostarczoną z nim dokumentacją, zmodyfikować wymagane pliki konfiguracyjne, upewnić się, że program (jeśli jest to demon) będzie uruchamiany w trakcie ładowania systemu, itp.</p></div><div class=paragraph><p>Oczywiście, szczegółowe kroki jakie należy podjąć konfigurując każdą aplikację będą różne. Tym nie mniej, jeśli właśnie zainstalowaliśmy nowy program i zastanawiamy się "Co dalej?" poniższe uwagi mogą okazać się pomocne:</p></div><div class=ulist><ul><li><p>Za pomocą <a href="https://man.freebsd.org/cgi/man.cgi?query=pkg_info&amp;sektion=1&amp;format=html">pkg_info(1)</a> możemy sprawdzić gdzie i jakie pliki zostały zainstalowane. Na przykład, jeśli zainstalowaliśmy wersję 1.0.0 pakietu FooPackage, polecenie</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pkg_info -L foopackage-1.0.0 | less</span></code></pre></div></div><div class=paragraph><p>wyświetli nam wszystkie pliki zainstalowane z pakietu. Szczególną uwagę warto zwrócić na pliki zainstalowane w katalogach: <span class=filename>man/</span> zawierającym strony podręcznika systemowego, <span class=filename>etc/</span> zawierającym pliki konfiguracyjne, oraz <span class=filename>doc/</span>, gdzie znajdować się będzie dużo obszerniejsza dokumentacja.</p></div><div class=paragraph><p>Jeśli nie jesteśmy pewni, którą wersją programu zainstalowaliśmy, polecenie</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pkg_info | grep -i foopackage</span></code></pre></div></div><div class=paragraph><p>wyświetli wszystkie zainstalowane pakiety zawierające <em>foopackage</em> w nazwie. Oczywiście <em>foopackage</em> należy zastąpić nazwą poszukiwanego pakietu.</p></div></li><li><p>Gdy już udało się ustalić jakie strony podręcznika systemowego zostały zainstalowane przez dany pakiet, można je przeczytać za pomocą polecenia <a href="https://man.freebsd.org/cgi/man.cgi?query=man&amp;sektion=1&amp;format=html">man(1)</a>. Warto również obejrzeć przykładowe pliki konfiguracyjne i wszelką dodatkową dokumentację.</p></li><li><p>Jeśli dana aplikacja posiada własną witrynę internetową warto jest również tam poszukać dodatkowej dokumentacji czy odpowiedzi na często zadawane pytania (FAQ). Jeśli nie znamy właściwego adresu internetowego może być on podany w wyniku polecenia</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pkg_info foopackage-1.0.0</span></code></pre></div></div><div class=paragraph><p>Wiersz <code>WWW:</code>, jeśli w ogóle jest podany, powinien zawierać informacje o adresie witryny.</p></div></li><li><p>Programy, które powinny być uruchamiane podczas ładowania systemu (np. serwery internetowe) z reguły instalują przykładowy skrypt w <span class=filename>/usr/local/etc/rc.d</span>. Powinniśmy sprawdzić zawartość tego skryptu oraz w razie potrzeby zmodyfikować go bądź zmienić nazwę. Szczegółowe informacje dostępne są w podrozdziale <a href=./#configtuning-starting-services>Uruchamianie usług</a>.</p></li></ul></div></div><div class=sect2><h3 id=ports-broken>4.7. Jak radzić sobie ze źle przygotowanymi portami<a class=anchor href=#ports-broken></a></h3><div class=paragraph><p>Jeśli natknęliśmy się na port, który z jakichś powodów nie działa na naszym komputerze, możemy zrobić kilka następujących rzeczy:</p></div><div class="olist arabic"><ol class=arabic><li><p>Sprawdzić w <a href=https://www.FreeBSD.org/support/#gnats>bazie danych zgłoszonych problemów</a> czy jest przygotowywana poprawka dla danego portu. Jeśli tak, może uda się nam zastosować tę poprawkę.</p></li><li><p>Poprosić o pomoc opiekuna danego portu. Adres email opiekuna można znaleźć przeglądająć plik <span class=filename>Makefile</span> w katalogu portu bądź wpisująć polecenie <code>make maintainer</code>. Wysyłając wiadomość pamiętajmy o zawarciu informacji o nazwie i wersji portu (najlepiej jest zawrzeć cały wiersz z pliku <span class=filename>Makefile</span> zaczynający się od <code>$FreeBSD:</code>), oraz opis błędu i wynik działania programu w momencie zaistnienia błędu.</p><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Niektóre porty nie są przygotowywane przez pojedyncze osoby, ale raczej przez <a href=https://docs.freebsd.org/en/articles/mailing-list-faq/>grupy dyskusyjne</a>. Wiele adresów takich grup, choć nie wszystkie, ma postać <a href=mailto:freebsd-listname@FreeBSD.org>freebsd-listname@FreeBSD.org</a>. Należy mieć również to na uwadze formułując swoje pytania.</p></div><div class=paragraph><p>Porty przygotowywane przez <a href=mailto:freebsd-ports@FreeBSD.org>freebsd-ports@FreeBSD.org</a> w rzeczywistości nie posiadają żadnego konkretnego opiekuna, ani grupy opiekunów. Poprawki i pomoc dla takich portów przygotowują osoby zapisane na tę listę dyskusyjną. Nowi ochotnicy są zawsze mile widziani!</p></div></td></tr></tbody></table></div><div class=paragraph><p>W przypadku braku odpowiedzi można również przesłać zgłoszenie błędu poprzez <a href="https://man.freebsd.org/cgi/man.cgi?query=send-pr&amp;sektion=1&amp;format=html">send-pr(1)</a> (szczegóły w artykule <a href=https://docs.freebsd.org/en/articles/problem-reports/>Writing FreeBSD Problem Reports</a>).</p></div></li><li><p>Naprawić błąd samemu! Podręcznik <a href=https://docs.freebsd.org/en/books/porters-handbook/>Porter’s Handbook</a> (ang.) zawiera szczegółowe informacje o strukturze "Portów", dzięki czemu można samemu naprawić błąd lub przygotować własny port!</p></li><li><p>Pobrać pakiet z najbliższego serwera FTP. "Główne" repozytorium pakietów znajduje się na serwerze <code>ftp.FreeBSD.org</code> w katalogu <a href=ftp://ftp.FreeBSD.org/pub/FreeBSD/ports/packages/>packages</a>. Tym nie mniej warto jest najpierw odszukać <a href=http://mirrorlist.FreeBSD.org/>lokalny serwer lustrzany</a>. Szanse na to, że gotowe pakiety będą działać poprawnie są większe niż w przypadku kompilowania programów. Pakiety można zainstalować za pomocą programu <a href="https://man.freebsd.org/cgi/man.cgi?query=pkg_add&amp;sektion=1&amp;format=html">pkg_add(1)</a>.</p></li></ol></div></div></div></div><div class=sect1><h2 id=x11>Rozdział 5. System okien X<a class=anchor href=#x11></a></h2><div class=sectionbody><div class=sect2><h3 id=x11-synopsis>5.1. Streszczenie<a class=anchor href=#x11-synopsis></a></h3><div class=paragraph><p>Środowisko graficzne dostępne we FreeBSD korzysta z zaawansowanego serwera graficznego X11 - implementacji open-source Systemu okien X obejmującej zarówno Xorg jak i XFree86™. FreeBSD 5.2.1-RELEASE oraz wcześniejsze wydania wykorzystują XFree86™, serwer X11 opracowany przez The XFree86™ Project, Inc. Od wersji FreeBSD 5.3-RELEASE podstawową i oficjalną odmianą X11 jest Xorg, serwer przygotowywany przez X.Org Foundation, rozprowadzany na licencji bardzo zbliżonej do wykorzystywanej przez FreeBSD. Dostępne są również komercyjne serwery X dla FreeBSD.</p></div><div class=paragraph><p>Niniejszy rozdział omawia zagadnienia związane z instalacją i konfiguracją X11 kładąc szczególny nacisk na serwer Xorg. Informacje o konfiguracji XFree86™ (np. w starszych wersjach FreeBSD gdzie XFree86™ był domyślnym serwerem X11) zawsze znaleźć można w archiwalnych wersjach Podręcznika FreeBSD (ang.) na stronie <a href=http://docs.FreeBSD.org/doc/>http://docs.FreeBSD.org/doc/</a>.</p></div><div class=paragraph><p>Informacje odnośnie obsługiwanego przez X11 sprzętu dostępne są na stronie internetowej projektu <a href=http://www.x.org/>Xorg</a>.</p></div><div class=paragraph><p>Po przeczytaniu tego rozdziału będziemy wiedzieć:</p></div><div class=ulist><ul><li><p>Jakie elementy wchodzą w skład Systemu okien X i jakie są ich wzajemne relacje.</p></li><li><p>Jak zainstalować i skonfigurować X11.</p></li><li><p>Jak instalować i korzystać z róźnych menadżerów okien.</p></li><li><p>Jak korzystać z czcionek TrueType® w X11.</p></li><li><p>Jak skonfigurować system do logowania graficznego (XDM).</p></li></ul></div><div class=paragraph><p>Przed przeczytaniem tego rozdziału powinniśmy wiedzieć:</p></div><div class=ulist><ul><li><p>Jak instalować dodatkowe oprogramowanie (<a href=./#ports>Instalacja programów: pakiety i porty</a>).</p></li></ul></div></div><div class=sect2><h3 id=x-understanding>5.2. Zrozumieć X<a class=anchor href=#x-understanding></a></h3><div class=paragraph><p>Korzystanie z X pierwszy raz może być niejakim szokiem dla osób, które dotychczas korzystały z innych środowisk graficznych, jak np. Microsoft® Windows® czy Mac OS®.</p></div><div class=paragraph><p>O ile nie jest wymagane znać wszystkie detale wielu elementów X i jak one ze sobą współpracują, o tyle podstawowa wiedza w tym zakresie pozwoli nam w pełni wykorzystać możliwości X-ów.</p></div><div class=sect3><h4 id=_czemu_x>5.2.1. Czemu X?<a class=anchor href=#_czemu_x></a></h4><div class=paragraph><p>X nie jest pierwszym systemem okienkowym napisanym dla systemów typu UNIX®, lecz jest on najbardziej popularnym. Grupa projektantów, która przygotowała X, pracowała wcześniej nad innym systemem. System ten nazywał się "W" (od "Window"). X była po prostu kolejną literą w rzymskim alfabecie.</p></div><div class=paragraph><p>System X może być nazywany po prostu "X", "System okien X", "X11" oraz jeszcze na wiele innych sposobów. Może się również okazać, że stosowanie terminu "X Windows" w odniesieniu do X11 jest traktowane jako obraźliwe przez niektóre osoby. Więcej informacji dostępnych jest w <a href="https://man.freebsd.org/cgi/man.cgi?query=X&amp;sektion=7&amp;format=html">X(7)</a>.</p></div></div><div class=sect3><h4 id=_model_klientserwer>5.2.2. Model klient/serwer<a class=anchor href=#_model_klientserwer></a></h4><div class=paragraph><p>Od samego początku System X zorientowany był na pracę w sieci, stąd też wykorzystanie modelu "klient-serwer".</p></div><div class=paragraph><p>W modelu systemu X, "serwer X" pracuje na komputerze wyposażonym w klawiaturę, monitor i myszkę. Do zadań serwera należy m.in. zarządzanie wyświetlaniem, czy obsługa sygnałów z klawiatury. Każda aplikacja graficzna (jak np. XTerm czy <a href="https://man.freebsd.org/cgi/man.cgi?query=getenv&amp;sektion=3&amp;format=html">getenv(3)</a>) jest "klientem". Klient wysyła komunikaty do serwera typu "Proszę w tym miejscu narysować okienko". Serwer natomiast: "Użytkownik właśnie kliknął przycisk OK".</p></div><div class=paragraph><p>W warunkach domowych czy w małym biurze serwer i klienci pracują z reguły na tym samym komputerze. Tym nie mniej istnieje możliwość uruchomienia serwera X na słabszej maszynie a aplikacje (klienci) na np. potężnej i drogiej maszynie obsługującej całe biuro. W takim wypadku komunikacja pomiędzy klientami a serwerem odbywa się za pomocą sieci.</p></div><div class=paragraph><p>Bywa to mylące, gdyż terminologia stosowana w systemie X jest dokładnie odwrotna do tego czego należałoby się spodziewać w typowym modelu "klient-serwer", czyli "serwera X" pracującego na mocniejszej maszynie oraz "klienta X" na komputerze biurkowym.</p></div><div class=paragraph><p>Stąd też należy pamiętać, że serwer X jest komputerem z monitorem i klawiaturą, podczas gdy klienci X są programami wyświetlającymi okienka.</p></div><div class=paragraph><p>Protokół X11 w żaden sposób nie zmusza ani klientów ani serwera, by obydwa działały na tym samym systemie operacyjnym, czy nawet typie komputera. Możliwe jest zatem uruchomienie serwera X w systemie Microsoft® Windows® czy Mac OS® firmy Apple za pomocą dostępnych darmowych i komercyjnych narzędzi.</p></div></div><div class=sect3><h4 id=_menedżer_okien>5.2.3. Menedżer okien<a class=anchor href=#_menedżer_okien></a></h4><div class=paragraph><p>Filozofia systemu X jest bardzo zbliżona do filozofii Uniksa: "narzędzia, nie reguły". Oznacza to, że X nie stara się narzucać jak ma zostać wykonane zadanie, dostarcza jedynie narzędzi pozostawiając użytkownikowi decyzję o sposobie ich wykorzystania.</p></div><div class=paragraph><p>Stąd też X nie wymusza jak powinny wyglądać okienka, jak je przesuwać po ekranie za pomocą myszki, jakie skróty klawiaturowe wykorzystać by przełączać pomiędzy okienkami (np. <span class=keyseq><kbd>Alt</kbd>+<kbd>Tab</kbd></span> w w przypadku Microsoft® Windows®), jak powinny wyglądać nagłówki okienek, itd.</p></div><div class=paragraph><p>Serwer X oddelegowuje tą odpowiedzialność do aplikacji nazywanej "Menedżerem okien". Istnieje całe mnóstwo menedżerów okien dla systemu X: AfterStep, Blackbox, ctwm, Enlightenment, fvwm, Sawfish, twm, Window Maker i wiele więcej. Każdy z nich oferuje inny wygląd i sposób obsługi; niektóre obsługują "wirtualne pulpity"; inne umożliwiają definiować własne skróty klawiszowych do zarządzania pulpitem; jeszcze inne posiadają przycisk "Start" bądź podobne rozwiązanie; w niektórych można zmieniać dowolnie motywy graficzne, pozwalając na całkowitą zmianę wyglądu i zachowania przy uruchamianiu nowego motywu. Te menedżery i wiele innych dostępne są w kategorii <span class=filename>x11-wm</span> w Kolekcji portów.</p></div><div class=paragraph><p>Ponadto, również środowiska graficzne KDE oraz GNOME posiadają w pełni zintegrowane, własne menedżery okien.</p></div><div class=paragraph><p>Każdy menedżer okien posiada również odrębny mechanizm konfiguracyjny; niektóre wykorzystują ręcznie modyfikowane pliki konfiguracyjne, inne dysponują narzędziami graficznymi, a przynajmniej jeden (Sawfish) wykorzystuje plik konfiguracyjny napisany w języku Lisp.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=title>Sposób uaktywniania</div><div class=paragraph><p>Kolejną funkcją realizowaną przez menedżera okien jest "sposób uaktywniania" okien za pomocą myszy. Każdy system okienkowy potrzebuje pewnego sposobu wyboru okna, które będzie aktywnie przyjmować sygnały z klawiatury i powinno wskazywać, które okno jest aktywne.</p></div><div class=paragraph><p>Znanym wszystkim sposobem uaktywniania jest zapewne "kliknij-by-uaktywnić". Jest to metoda wykorzystywana w systemie Microsoft® Windows®, w której okno zostaje uaktywnione po otrzymaniu kliknięcia myszką.</p></div><div class=paragraph><p>X nie obsługuje żadnego sposobu uaktywniania sam z siebie. To właśnie menedżer okien kontroluje, które okno jest aktywne w danych czasie. Różne menedżery wspierają różne metody uaktywniania. Wszystkie z nich obsługują kliknij-by-uaktywnić a większość z nich obsługuje również kilka innych.</p></div><div class=paragraph><p>Najczęściej spotykane sposoby uaktywniania:</p></div><div class=dlist><dl><dt class=hdlist1>aktywuj-za-myszą</dt><dd><p>Aktywne jest okno znajdujące się bezpośrednio pod wskaźnikiem myszki. Przy czym, nie koniecznie jest to te samo okno, które znajduje się nad wszystkimi innymi oknami. Zmiana aktywnego okna dokonywana jest przez wskazanie na inne okno. Nie jest wymagane kliknięcie na nim.</p></dd><dt class=hdlist1>leniwe uaktywnianie</dt><dd><p>Ta metoda jest drobną wariacją metody aktywuj-za-myszą, w której w sytuacji gdy wskaźnik myszy jest przesunięty nad wolne pole wówczas żadne okno nie jest aktywne, a wszystkie wprowadzane znaki są tracone. W tej metodzie natomiast aktywne okno jest zmieniane tylko gdy wskaźnik zostanie przesunięty nad nowe okno, natomiast nie w momencie gdy opuści bieżące okno.</p></dd><dt class=hdlist1>kliknij-by-uaktywnić</dt><dd><p>Aktywne okno jest wybierane poprzez kliknięcie na nie myszką. Okno może później być "podniesione" i pojawić się nad wszystkimi innymi oknami. Wszystkie wprowadzane znaki są kierowane do tego okna, nawet jeśli wskaźnik myszki zostanie przesunięty nad inne okno.</p></dd></dl></div><div class=paragraph><p>Wiele menedżerów okien wspiera również inne metody, podobnie jak wariacje powyższych. Najlepiej jest sprawdzić dokumentację danego menedżera.</p></div></td></tr></tbody></table></div></div><div class=sect3><h4 id=_elementy_interfejsu_graficznego>5.2.4. Elementy interfejsu graficznego<a class=anchor href=#_elementy_interfejsu_graficznego></a></h4><div class=paragraph><p>Podejście Systemu X do dostarczania narzędzi a nie reguł dotyczy również elementów interfejsu graficznego widocznych na ekranie w każdej uruchomionej aplikacji.</p></div><div class=paragraph><p>Pod pojęciem "elementu interfejsu graficznego" (ang. widget) kryją się wszystkie elementy, które można kliknąć bądź w inny sposób nimi manipulować; przyciski, pola wyboru, przyciski opcji, ikony, listy, itd. W systemach Microsoft® Windows® nazywają się one "formantkami" (ang. controls).</p></div><div class=paragraph><p>Zarówno Microsoft® Windows® jak i Apple Mac OS® stosują bardzo rygorystyczne podejście do elementów interfejsu graficznego. Od twórców programów wymaga się by ich aplikacje wyglądały jednakowo. Natomiast przy tworzeniu X, nie uznano za rozsądne narzucanie jednego stylu graficznego czy zestawu elementów interfejsu, do którego miałyby być dostosowane wszystkie programy.</p></div><div class=paragraph><p>W rezultacie nie należy się spodziewać, że aplikacje graficzne będą posiadały jednakowy wygląd czy sposób obsługiwania. Istnieje kilka popularnych zestawów elementów interfejsu graficznego i ich wariacji, włączając w to oryginalny zestaw Athena z MIT, Motif® (na podstawie którego został przygotowany zestaw elementów interfejsu graficznego Microsoft® Windows®; wszystkie krawędzie fazowane, trzy odcienie szarości), OpenLook i inne.</p></div><div class=paragraph><p>Większość nowszych programów graficznych będzie zapewne wykorzystywać jeden ze współczesnych zestawów elementów interfejsu, jak np. Qt, wykorzystywany w KDE, bądź GTK+, stosowany w projekcie GNOME. Pod tym względem, istnieje pewne podobieństwo w wyglądzie i zachowaniu środowisk graficznych w systemach typu UNIX®, co z pewnością ułatwi pracę z systemem początkującym użytkownikom.</p></div></div></div><div class=sect2><h3 id=x-install>5.3. Instalacja X11<a class=anchor href=#x-install></a></h3><div class=paragraph><p>Domyślną implementacją serwera X11 dla FreeBSD jest Xorg. Jest on serwerem graficznym o otwartym kodzie (open source) Systemu okien X przygotowanym przez X.Org Foundation. Bazuje on na kodzie XFree86™ 4.4RC2 i X11R6.6. Wersją Xorg dostępną aktualnie z kolekcji portów FreeBSD jest 7.7.</p></div><div class=paragraph><p>By skompilować i zainstalować Xorg z kolekcji portów wpisujemy:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/ports/x11/xorg</span>
<span class=c># make install clean</span></code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Nim zaczniemy upewnijmy się, że dysponujemy 4 GB wolnej przestrzeni na dysku na potrzeby kompilacji.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Alternatywnie, X11 może zostać zainstalowany z pakietów binarnych za pomocą <a href="https://man.freebsd.org/cgi/man.cgi?query=pkg_add&amp;sektion=1&amp;format=html">pkg_add(1)</a>. W przypadku wykorzystania opcji zdalnego pobierania pakietów z sieci przez <a href="https://man.freebsd.org/cgi/man.cgi?query=pkg_add&amp;sektion=1&amp;format=html">pkg_add(1)</a> należy pominąć numer wersji pakietu. Program <a href="https://man.freebsd.org/cgi/man.cgi?query=pkg_add&amp;sektion=1&amp;format=html">pkg_add(1)</a> automatycznie pobierze najnowszą wersję aplikacji.</p></div><div class=paragraph><p>Zatem, by pobrać i zainstalować pakiet Xorg wystarczy wpisać:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pkg_add -r xorg</span></code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Powyższe polecenia zainstalują kompletne środowisko X11 zawierające serwery, klienty, czcionki itd. Dostępne są również osobne pakiety i porty elementów X11.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Pozostała część niniejszego rozdziału wyjaśnia jak skonfigurować serwer X11 oraz jak skonfigurować wspomagające efektywność naszej pracy środowisko pulpitowe.</p></div></div><div class=sect2><h3 id=x-config>5.4. Konfiguracja X11<a class=anchor href=#x-config></a></h3><div class=sect3><h4 id=_nim_zaczniemy>5.4.1. Nim zaczniemy<a class=anchor href=#_nim_zaczniemy></a></h4><div class=paragraph><p>Przed rozpoczęciem konfiguracji X11 potrzebne nam będą następujące informacje o docelowym systemie:</p></div><div class=ulist><ul><li><p>Parametry monitora</p></li><li><p>Rodzaj chipsetu karty graficznej</p></li><li><p>Rozmiar pamięci karty graficznej</p></li></ul></div><div class=paragraph><p>Parametry monitora są wykorzystywane przez X11 do określenia rozdzielczości i częstotliwości odświeżania ekranu, na jakich ma pracować. Parametry te można z reguły odczytać z dokumentacji dostarczonej wraz z monitorem bądź ze strony producenta. Potrzebne są dwa przedziały liczbowe: częstotliwość odchylania poziomego oraz częstotliwość synchronizacji pionowej.</p></div><div class=paragraph><p>Od rodzaju chipsetu karty graficznej zależy który moduł X11 wykorzysta do komunikacji z kartą graficzną. W większości przypadków możliwe jest automatyczne wykrycie rodzaju chipsetu. Tym nie mniej warto jest go znać, na wypadek gdyby autodetekcja nie powiodła się.</p></div><div class=paragraph><p>Rozmiar pamięci karty graficznej wpływa bezpośrednio na rozdzielczość i głębię kolorów, przy których system będzie pracował. Informacja ta jest istotna, by użytkownik znał ograniczenia systemu w tym zakresie.</p></div></div><div class=sect3><h4 id=_konfiguracja_x11>5.4.2. Konfiguracja X11<a class=anchor href=#_konfiguracja_x11></a></h4><div class=paragraph><p>Konfiguracja X11 jest procesem składającym się z kilku kroków. Pierwszym z nich jest przygotowanie wstępnego pliku konfiguracyjnego. Wystarczy jako użytkownik <code>root</code> wpisać:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># Xorg -configure</span></code></pre></div></div><div class=paragraph><p>Wygeneruje to szkielet konfiguracji X11 w katalogu <span class=filename>/root</span>, w pliku o nazwie <span class=filename>xorg.conf.new</span> (niezależnie czy skorzystaliśmy z <a href="https://man.freebsd.org/cgi/man.cgi?query=su&amp;sektion=1&amp;format=html">su(1)</a> czy zalogowaliśmy się bezpośrednio na konto, plik zostanie utworzony w katalogu zdefiniowanym w zmiennej <code>$HOME</code> dla użytkownika <code>root</code>). X11 spróbuje wykryć parametry sprzętu graficznego zainstalowanego w komputerze i zapisać plik konfiguracyjny, by przy starcie serwera X były ładowane właściwe sterowniki dla wykrytego sprzętu.</p></div><div class=paragraph><p>Kolejnym krokiem jest przetestowanie konfiguracji i sprawdzenie czy Xorg jest w stanie współpracować ze sprzętem graficznym w systemie. W tym celu należy wpisać:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># Xorg -config xorg.conf.new</span></code></pre></div></div><div class=paragraph><p>Jeśli na ekranie pojawi się siatka złożona z czarnych i szarych elementów, a także kursor myszy w kształcie litery X, oznaczać to będzie, że X11 został skonfigurowany poprawnie. By wyłączyć ekran testowy wystarczy wcisnąć kombinację klawiszy <span class=keyseq><kbd>Ctrl</kbd>+<kbd>Alt</kbd>+<kbd>Backspace</kbd></span>.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Jeśli okaże się, że kursor nie reaguje na ruchy myszy będziemy musieli wpierw ją skonfigurować. <a href=./#mouse>Ustawienia myszki</a> rozdziału "Instalacja FreeBSD" zawiera szczegółowe informacje na ten temat.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Następnym krokiem jest dostrojenie konfiguracji pliku <span class=filename>xorg.conf.new</span> do naszych upodobań. Otwórzmy plik w edytorze tekstu, np. w <a href="https://man.freebsd.org/cgi/man.cgi?query=emacs&amp;sektion=1&amp;format=html">emacs(1)</a> bądź <a href="https://man.freebsd.org/cgi/man.cgi?query=ee&amp;sektion=1&amp;format=html">ee(1)</a>. Wpierw powinniśmy dodać częstotliwości z jakimi może pracować nasz monitor. Z reguły określane są jako częstotliwości synchronizacji pionowej i poziomej. Wartości te są dodawane do pliku <span class=filename>xorg.conf.new</span> w sekcji <code>"Monitor"</code>:</p></div><div class="literalblock programlisting"><div class=content><pre>Section &#34;Monitor&#34;
        Identifier   &#34;Monitor0&#34;
        VendorName   &#34;Monitor Vendor&#34;
        ModelName    &#34;Monitor Model&#34;
        HorizSync    30-107
        VertRefresh  48-120
EndSection</pre></div></div><div class=paragraph><p>Słów kluczowych <code>HorizSync</code> i <code>VertRefresh</code> może brakować w pliku konfiguracyjnym. Jeśli tak jest, można je śmiało dodać wpisując właściwą wartość częstotliwości odchylania poziomego zaraz po <code>HorizSync</code> oraz wartość częstotliwości synchronizacji pionowej po <code>VertRefresh</code>. W powyższym przykładzie wartości te zostały wpisane.</p></div><div class=paragraph><p>X umożliwia również korzystanie z funkcji DPMS (Energy Star), jeśli dysponujemy monitorem zgodnym z tym standardem. Program <a href="https://man.freebsd.org/cgi/man.cgi?query=xset&amp;sektion=1&amp;format=html">xset(1)</a> kontroluje limity czasowe i może wymusić tryb oczekiwania, zawieszenia czy tryby wyłączania. Jeśli chcemy włączyć funkcje DPMS dla naszego monitora, musimy dodać poniższy wiersz w sekcji monitora:</p></div><div class="literalblock programlisting"><div class=content><pre>        Option       &#34;DPMS&#34;</pre></div></div><div class=paragraph><p>Mając wciąż otwarty w edytorze plik <span class=filename>xorg.conf.new</span> wybierzmy domyślną rozdzielczość i głębię kolorów. Parametry te definiowane są w sekcji <code>"Screen"</code>:</p></div><div class="literalblock programlisting"><div class=content><pre>Section &#34;Screen&#34;
        Identifier &#34;Screen0&#34;
        Device     &#34;Card0&#34;
        Monitor    &#34;Monitor0&#34;
        DefaultDepth 24
        SubSection &#34;Display&#34;
                Viewport  0 0
                Depth     24
                Modes     &#34;1024x768&#34;
        EndSubSection
EndSection</pre></div></div><div class=paragraph><p>Słowo kluczowe <code>DefaultDepth</code> odnosi się do domyślnej głębi kolorów. Opcja ta może być zmieniona za pomocą parametru <code>-depth</code> polecenia <a href="https://man.freebsd.org/cgi/man.cgi?query=Xorg&amp;sektion=1&amp;format=html">Xorg(1)</a>. Słowo kluczowe <code>Modes</code> odnosi się do rozdzielczości, w której ma pracować serwer X dla danej głębi kolorów. Należy zwrócić uwagę, iż dostępne są jedynie standardowe tryby VESA, zgodne ze sprzętem graficznym instalowanym w danym systemie. W powyższym przykładzie, domyślna głębia kolorów to dwadzieścia cztery bity na piksel. Przy tej głębi dostępna jest rozdzielczość 1024 na 768 pikseli.</p></div><div class=paragraph><p>Możemy w końcu zapisać plik konfiguracyjny i sprawdzić go wykorzystując podany powyżej tryb testowy.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Jednym z pomocnych narzędzi w radzeniu sobie z problemami są pliki dzienników X11, zawierające informacje odnośnie każdego urządzenia, do którego jest podłączony serwer X11. Nazwy plików dzienników Xorg wykorzystują format <span class=filename>/var/log/Xorg.0.log</span>. Dokładna nazwa pliku dziennika może być różna w zakresie od <span class=filename>Xorg.0.log</span> do <span class=filename>Xorg.8.log</span>.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Jeśli test wypadł dobrze, należy zainstalować plik konfiguracyjny w miejscu gdzie <a href="https://man.freebsd.org/cgi/man.cgi?query=Xorg&amp;sektion=1&amp;format=html">Xorg(1)</a> będzie w stanie go znaleźć. Z reguły jest to <span class=filename>/etc/X11/xorg.conf</span> lub <span class=filename>/usr/X11R6/etc/X11/xorg.conf</span>.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cp xorg.conf.new /etc/X11/xorg.conf</span></code></pre></div></div><div class=paragraph><p>Proces konfiguracji X11 dobiegł końca. Xorg można uruchomić za pomocą pomocą polecenia <a href="https://man.freebsd.org/cgi/man.cgi?query=startx&amp;sektion=1&amp;format=html">startx(1)</a>. Serwer X11 może być również uruchamiany wykorzystując <a href="https://man.freebsd.org/cgi/man.cgi?query=xdm&amp;sektion=1&amp;format=html">xdm(1)</a>.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Dostępny jest również graficzny konfigurator - <a href="https://man.freebsd.org/cgi/man.cgi?query=xorgcfg&amp;sektion=1&amp;format=html">xorgcfg(1)</a> - dostarczany razem z dystrybucją X11. Pozwala on nam interaktywnie zdefiniować naszą konfigurację wybierając odpowiednie sterowniki i ustawienia. Program ten można uruchomić z konsoli wpisując polecenie <code>xorgcfg -textmode</code>. Więcej szczegółów zawiera strona podręcznika systemowego <a href="https://man.freebsd.org/cgi/man.cgi?query=xorgcfg&amp;sektion=1&amp;format=html">xorgcfg(1)</a>.</p></div><div class=paragraph><p>Istnieje również, jako alternatywa, program <a href="https://man.freebsd.org/cgi/man.cgi?query=xorgconfig&amp;sektion=1&amp;format=html">xorgconfig(1)</a>, będący aplikacją konsolową, mniej przyjazną dla początkujących użytkowników, jednakże przydatną w sytuacjach gdy inne narzędzia nie działają poprawnie.</p></div></td></tr></tbody></table></div></div><div class=sect3><h4 id=_konfiguracja_zaawansowana>5.4.3. Konfiguracja zaawansowana<a class=anchor href=#_konfiguracja_zaawansowana></a></h4><div class=sect4><h5 id=_konfiguracja_z_chipsetem_graficznym_intel_i810>5.4.3.1. Konfiguracja z chipsetem graficznym Intel® i810<a class=anchor href=#_konfiguracja_z_chipsetem_graficznym_intel_i810></a></h5><div class=paragraph><p>Konfiguracja ze zintegrowanym chipsetem Intel® i810 wymaga wykorzystania interfejsu programowego AGP <span class=filename>agpgart</span> do obsługi karty w X11. Więcej informacji można znaleźć w podręczniku systemowym sterownika <a href="https://man.freebsd.org/cgi/man.cgi?query=agp&amp;sektion=4&amp;format=html">agp(4)</a>.</p></div><div class=paragraph><p>Pozwoli to nam skonfigurować naszą kartę graficzną jak każdą inną. W tym momencie należy zwrócić uwagę na fakt, iż w systemach bez <a href="https://man.freebsd.org/cgi/man.cgi?query=agp&amp;sektion=4&amp;format=html">agp(4)</a> wkompilowanego w jądro, próba załadowania modułu za pomocą <a href="https://man.freebsd.org/cgi/man.cgi?query=kldload&amp;sektion=8&amp;format=html">kldload(8)</a> nie powiedzie się. Sterownik ten musi być obecny w jądrze w trakcie uruchamiania systemu poprzez wkompilowanie go bądź załadowanie za pomocą <span class=filename>/boot/loader.conf</span>.</p></div></div><div class=sect4><h5 id=_dodanie_płaskiego_monitora_szerokokątnego>5.4.3.2. Dodanie płaskiego monitora szerokokątnego<a class=anchor href=#_dodanie_płaskiego_monitora_szerokokątnego></a></h5><div class=paragraph><p>Sekcja ta zakłada, że posiadamy odrobinę wiedzy o zaawansowanej konfiguracji X11. Jeśli próby wykorzystania opisanych wyżej standardowych narzędzi konfiguracyjnych nie powiodły się, w plikach dzienników znajdziemy dostateczną ilość informacji pomocnych w uruchomieniu X z monitorem szerokokątnym. Będziemy musieli wykorzystać dowolny edytor teksu.</p></div><div class=paragraph><p>Obecne formaty szerokokątne (WSXGA, WSXGA+, WUXGA, WXGA, WXGA+, itd.) obsługują formaty 16:10 oraz 10:9 bądź o innych proporcjach obrazu, które mogą stworzyć problemy w trakcie konfiguracji X. Niektórymi z powszechnie wykorzystywanych rozdzielczości ekranu dla proporcji 16:10 są:</p></div><div class=ulist><ul><li><p>2560x1600</p></li><li><p>1920x1200</p></li><li><p>1680x1050</p></li><li><p>1440x900</p></li><li><p>1280x800</p></li></ul></div><div class=paragraph><p>W pewnym momencie będzie to tak proste jak dodanie którejś z tych rozdzielczości jako możliwych trybów <code>Mode</code> w <code>Section "Screen"</code>, jak np.:</p></div><div class="literalblock programlisting"><div class=content><pre>Section &#34;Screen&#34;
Identifier &#34;Screen0&#34;
Device     &#34;Card0&#34;
Monitor    &#34;Monitor0&#34;
DefaultDepth 24
SubSection &#34;Display&#34;
        Viewport  0 0
        Depth     24
        Modes     &#34;1680x1050&#34;
EndSubSection
EndSection</pre></div></div><div class=paragraph><p>Tym nie mniej Xorg jest na tyle sprytny, że potrafić pozyskać informacje o rozdzielczości ekranu monitora szerokokątnego za pomocą I2C/DDC w taki sposób, że wie jakie rozdzielczości potrafi obsłużyć monitor w kwestii częstotliwości i rozdzielczość.</p></div><div class=paragraph><p>Jeśli odpowiednie wpisy <code>ModeLine</code> nie istnieją w sterownikach, będziemy musieli podpowiedzieć co nieco serwerowi Xorg. Z pliku <span class=filename>/var/log/Xorg.0.log</span> możemy wydobyć dostateczną ilość informacji, by móc ręcznie stworzyć poprawnie obsługiwany <code>ModeLine</code>. Wystarczy odnaleźć zapis podobny do:</p></div><div class="literalblock programlisting"><div class=content><pre>(II) MGA(0): Supported additional Video Mode:
(II) MGA(0): clock: 146.2 MHz   Image Size:  433 x 271 mm
(II) MGA(0): h_active: 1680  h_sync: 1784  h_sync_end 1960 h_blank_end 2240 h_border: 0
(II) MGA(0): v_active: 1050  v_sync: 1053  v_sync_end 1059 v_blanking: 1089 v_border: 0
(II) MGA(0): Ranges: V min: 48  V max: 85 Hz, H min: 30  H max: 94 kHz, PixClock max 170 MHz</pre></div></div><div class=paragraph><p>Jest to tzw. informacja EDID. Stworzenie na jej podstawie <code>ModeLine</code> jest zaledwie kwestią wpisania we właściwej kolejności kilku liczb:</p></div><div class="literalblock programlisting"><div class=content><pre>ModeLine &lt;name&gt; &lt;clock&gt; &lt;4 horiz. timings&gt; &lt;4 vert. timings&gt;</pre></div></div><div class=paragraph><p>Tak więc wpis <code>ModeLine</code> w <code>Section "Monitor"</code> dla tego przykładu wyglądałby następująco:</p></div><div class="literalblock programlisting"><div class=content><pre>Section &#34;Monitor&#34;
Identifier      &#34;Monitor1&#34;
VendorName      &#34;Bigname&#34;
ModelName       &#34;BestModel&#34;
ModeLine        &#34;1680x1050&#34; 146.2 1680 1784 1960 2240 1050 1053 1059 1089
Option          &#34;DPMS&#34;
EndSection</pre></div></div><div class=paragraph><p>Po tych kilku prostych zmianach X powinien zacząć działać poprawnie z naszym szerokokątnym monitorem.</p></div></div></div></div><div class=sect2><h3 id=x-fonts>5.5. Korzystanie z czcionek w X11<a class=anchor href=#x-fonts></a></h3><div class=sect3><h4 id=type1>5.5.1. Czcionki Type1<a class=anchor href=#type1></a></h4><div class=paragraph><p>Czcionki dostarczane razem z X11 są dalekie od idealnych dla typowych aplikacji biurowych. Duże czcionki sprawiają wrażenie postrzępionych i mało profesjonalnych. Natomiast, małe czcionki w <a href="https://man.freebsd.org/cgi/man.cgi?query=getenv&amp;sektion=3&amp;format=html">getenv(3)</a> są całkowicie nieczytelne. Tym nie mniej, dostępnych jest kilka darmowych, wysokiej jakości czcionek Type1 (PostScript®), gotowych do użycia z X11. Na przykład, kolekcja czcionek URW (<a class=package href=https://cgit.freebsd.org/ports/tree/x11-fonts/urwfonts/>x11-fonts/urwfonts</a>) zawiera wysokiej jakości wersje standardowych czcionek type1 (Times Roman™, Helvetica™, Palatino™ i innych). Kolekcja Freefonts (<a class=package href=https://cgit.freebsd.org/ports/tree/x11-fonts/freefonts/>x11-fonts/freefonts</a>) to wiele dodatkowych czcionek, przy czym większość z nich przewidzianych jest do użycia z oprogramowaniem graficznym, jak np. Gimp, tym samym nie są przygotowane do wykorzystania jako czcionki do aplikacji. Dodatkowo, przy minimum wysiłku, można skonfigurować X11, by korzystał z czcionek TrueType®. Więcej szczegółów znaleźć można w podręczniku systemowym <a href="https://man.freebsd.org/cgi/man.cgi?query=X&amp;sektion=7&amp;format=html">X(7)</a> lub w części <a href=#truetype>poświęconej czcionkom TrueType®</a>.</p></div><div class=paragraph><p>By zainstalować kolekcje czcionek Type1 z portów, należy wpisać następujące polecenia:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/ports/x11-fonts/urwfonts</span>
<span class=c># make install clean</span></code></pre></div></div><div class=paragraph><p>Analogicznie postępujemy z czcionkami freefont bądź innymi kolekcjami. Aby serwer X wykrył zainstalowane czcionki, należy dodać odpowiedni wpis do pliku konfiguracji serwera (<span class=filename>/etc/X11/xorg.conf</span>) postaci:</p></div><div class="literalblock programlisting"><div class=content><pre>FontPath &#34;/usr/X11R6/lib/X11/fonts/URW/&#34;</pre></div></div><div class=paragraph><p>Alternatywną metodą jest wpisanie w trakcie sesji X:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% xset fp+ /usr/X11R6/lib/X11/fonts/URW
% xset fp rehash</code></pre></div></div><div class=paragraph><p>O ile rozwiązanie to również przyniesie pożądany efekt, o tyle dokonane w ten sposób zmiany zostaną stracone po zakończeniu sesji X. Oczywiście powyższe polecenia można dodać do pliku startowego (<span class=filename>~/.xinitrc</span> dla typowej sesji <code>startx</code> bądź pliku <span class=filename>~/.xsession</span> przy logowaniu się za pomocą graficznego menedżera logowania, jak np. XDM). Trzecią metodą jest skorzystanie z nowego pliku <span class=filename>/usr/X11R6/etc/fonts/local.conf</span>: szczegóły w części poświęconej <a href=#antialias>wygładzaniu</a>.</p></div></div><div class=sect3><h4 id=truetype>5.5.2. Czcionki TrueType®<a class=anchor href=#truetype></a></h4><div class=paragraph><p>Xorg posiada wbudowaną obsługę czcionek TrueType®. Istnieją dwa moduły, które mogą aktywować tę funkcję. W przykładzie wykorzystany został moduł freetype, z uwagi na większą spójność z innymi wewnętrznymi elementami wyświetlającymi czcionki. By włączyć moduł freetype, wystarczy dodać poniższy wiersz do sekcji <code>"Module"</code> pliku <span class=filename>/etc/X11/xorg.conf</span>.</p></div><div class="literalblock programlisting"><div class=content><pre>Load  &#34;freetype&#34;</pre></div></div><div class=paragraph><p>Teraz musimy utworzyć katalog dla czcionek TrueType® (na przykład <span class=filename>/usr/X11R6/lib/X11/fonts/TrueType</span>) i skopiować wszystkie czcionki do tego katalogu. Należy pamiętać, że czcionki TrueType® nie mogą być bezpośrednio skopiowane z systemu Macintosh®, by możliwe było wykorzystanie ich z X11; muszą być w formacie UNIX®/MS-DOS®/Windows®. Po skopiowaniu plików należy wykorzystać ttmkfdir do stworzenia pliku <span class=filename>fonts.dir</span>, by poinformować X, że zostały zainstalowane nowe czcionki. Program <code>ttmkfdir</code> dostępny jest z kolekcji portów FreeBSD jako <a class=package href=https://cgit.freebsd.org/ports/tree/x11-fonts/ttmkfdir/>x11-fonts/ttmkfdir</a>.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/X11R6/lib/X11/fonts/TrueType</span>
<span class=c># ttmkfdir -o fonts.dir</span></code></pre></div></div><div class=paragraph><p>Na koniec musimy dodać katalog TrueType® do ścieżki czcionek. Robimy to analogicznie jak w przypadku czcionek <a href=#type1>Type1</a>, za pomocą polecenia</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% xset fp+ /usr/X11R6/lib/X11/fonts/TrueType
% xset fp rehash</code></pre></div></div><div class=paragraph><p>bądź dodając wiersz <code>FontPath</code> do pliku <span class=filename>xorg.conf</span>.</p></div><div class=paragraph><p>Gotowe. Teraz <a href="https://man.freebsd.org/cgi/man.cgi?query=getenv&amp;sektion=3&amp;format=html">getenv(3)</a>, Gimp, StarOffice™ i wszystkie inne aplikacje X powinny rozpoznawać zainstalowane czcionki TrueType®. Bardzo małe czcionki (jak np. tekst na stronie WWW przy ustawionej wysokiej rozdzielczości ekranu) oraz bardzo duże (w StarOffice™) będą wyglądały zdecydowanie lepiej.</p></div></div><div class=sect3><h4 id=antialias>5.5.3. Wygładzane czcionki<a class=anchor href=#antialias></a></h4><div class=paragraph><p>Wygładzanie (anti-aliasing) dostępne było w X11 od XFree86™ 4.0.2. Jednakże konfiguracja czcionek była niezmiernie nieporęczna do ukazania się XFree86™ 4.3.0. Począwszy od tej właśnie wersji, wszystkie czcionki w X11 dostępne w katalogach <span class=filename>/usr/X11R6/lib/X11/fonts/</span> oraz <span class=filename>~/.fonts/</span> są automatycznie dostępne dla aplikacji korzystających z wygładzania Xft. Nie wszystkie aplikacje potrafią korzystać z Xft, lecz wiele z czasem otrzymało wsparcie Xft. Przykładami aplikacji korzystających z Xft są Qt 2.3 i późniejsze (pakiet narzędzi graficznych dla środowiska KDE), GTK+ 2.0 i późniejsze (pakiet narzędzi graficznych dla środowiska GNOME desktop) oraz Mozilla 1.2 i późniejsze.</p></div><div class=paragraph><p>By móc kontrolować, które czcionki będą wygładzane bądź skonfigurować właściwości wygładzania, należy stworzyć (bądź zmodyfikować, jeśli istnieje) plik <span class=filename>/usr/X11R6/etc/fonts/local.conf</span>. Wykorzystując ten plik możemy dostroić kilka zaawansowanych opcji systemu czcionek Xft, jednakże rozdział ten skupia się jedynie na kilku podstawowych funkcjach. Więcej szczegółów znaleźć można w podręczniku systemowym <a href="https://man.freebsd.org/cgi/man.cgi?query=fonts-conf&amp;sektion=5&amp;format=html">fonts-conf(5)</a>.</p></div><div class=paragraph><p>W pliku tym stosowany jest format kodu XML. Przy jego edycji należy pamiętać o właściwym zamykaniu wszystkich znaczników. Zaczyna się on od typowego nagłówka XML oraz definicji DOCTYPE. Następnym w kolejności jest znacznik <code>&lt;fontconfig></code>:</p></div><div class="literalblock programlisting"><div class=content><pre>      &lt;?xml version=&#34;1.0&#34;?&gt;
      &lt;!DOCTYPE fontconfig SYSTEM &#34;fonts.dtd&#34;&gt;
      &lt;fontconfig&gt;</pre></div></div><div class=paragraph><p>Jak już to zostało wcześniej powiedziane, wszystkie czcionki w katalogach <span class=filename>/usr/X11R6/lib/X11/fonts/</span> oraz <span class=filename>~/.fonts/</span> są automatycznie dostępne dla aplikacji korzystających z Xft. Jeśli natomiast chcemy dodać inny katalog nie będący podkatalogiem żadnego z powyższych, musimy dodać do pliku <span class=filename>/usr/X11R6/etc/fonts/local.conf</span> wiersz podobny do poniższego:</p></div><div class="literalblock programlisting"><div class=content><pre>&lt;dir&gt;/ścieżka/do/moich/czcionek&lt;/dir&gt;</pre></div></div><div class=paragraph><p>Po dodaniu nowych czcionek, a szczególnie nowych katalogów, powinniśmy uruchomić poniższe polecenie, by przebudować bufor informacji o czcionkach:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># fc-cache -f</span></code></pre></div></div><div class=paragraph><p>Wygładzanie sprawia, że brzegi czcionek stają się lekko zamazane, dzięki czemu małe litery są bardziej czytelne, a duże pozbawione efektu "schodków". Może jednak prowadzić do zmęczenia oczu gdy zostanie użyte w stosunku do liter o normalnej wiekości. By wyłączyć wygładzanie czcionek o rozmiarze mniejszym niż 14 punktów, należy dodać poniższe wiersze do pliku konfiguracyjnego:</p></div><div class="literalblock programlisting"><div class=content><pre>        &lt;match target=&#34;font&#34;&gt;
            &lt;test name=&#34;size&#34; compare=&#34;less&#34;&gt;
                &lt;double&gt;14&lt;/double&gt;
            &lt;/test&gt;
            &lt;edit name=&#34;antialias&#34; mode=&#34;assign&#34;&gt;
                &lt;bool&gt;false&lt;/bool&gt;
            &lt;/edit&gt;
        &lt;/match&gt;
        &lt;match target=&#34;font&#34;&gt;
            &lt;test name=&#34;pixelsize&#34; compare=&#34;less&#34; qual=&#34;any&#34;&gt;
                &lt;double&gt;14&lt;/double&gt;
            &lt;/test&gt;
            &lt;edit mode=&#34;assign&#34; name=&#34;antialias&#34;&gt;
                &lt;bool&gt;false&lt;/bool&gt;
            &lt;/edit&gt;
        &lt;/match&gt;</pre></div></div><div class=paragraph><p>Korzystając z wygładzania może się okazać, iż również odstępy pomiędzy literami niektórych czcionek o stałej szerokości są niewłaściwe. Ma to miejsce szczególnie w przypadku KDE. Jedynym rozwiązaniem tego problemu jest wymuszenie stałego odstępu o wartości 100 dla danych czcionek. W tym celu musimy wpisać:</p></div><div class="literalblock programlisting"><div class=content><pre>       &lt;match target=&#34;pattern&#34; name=&#34;family&#34;&gt;
           &lt;test qual=&#34;any&#34; name=&#34;family&#34;&gt;
               &lt;string&gt;fixed&lt;/string&gt;
           &lt;/test&gt;
           &lt;edit name=&#34;family&#34; mode=&#34;assign&#34;&gt;
               &lt;string&gt;mono&lt;/string&gt;
           &lt;/edit&gt;
        &lt;/match&gt;
        &lt;match target=&#34;pattern&#34; name=&#34;family&#34;&gt;
            &lt;test qual=&#34;any&#34; name=&#34;family&#34;&gt;
                &lt;string&gt;console&lt;/string&gt;
            &lt;/test&gt;
            &lt;edit name=&#34;family&#34; mode=&#34;assign&#34;&gt;
                &lt;string&gt;mono&lt;/string&gt;
            &lt;/edit&gt;
        &lt;/match&gt;</pre></div></div><div class=paragraph><p>(powyższe deklaruje inne typowe nazwy czcionek o stałej szerokości jako <code>"mono"</code>), a następnie:</p></div><div class="literalblock programlisting"><div class=content><pre>         &lt;match target=&#34;pattern&#34; name=&#34;family&#34;&gt;
             &lt;test qual=&#34;any&#34; name=&#34;family&#34;&gt;
                 &lt;string&gt;mono&lt;/string&gt;
             &lt;/test&gt;
             &lt;edit name=&#34;spacing&#34; mode=&#34;assign&#34;&gt;
                 &lt;int&gt;100&lt;/int&gt;
             &lt;/edit&gt;
         &lt;/match&gt;</pre></div></div><div class=paragraph><p>Niektóre czcionki, jak np. Helvetica, mogą stwarzać problemy jeśli zostaną poddane wygładzaniu. Z reguły daje to efekt czcionki przeciętej pionowo na pół. W najgorszym wypadku, może prowadzić to do załamania aplikacji typu Mozilla. By tego uniknąć, warto dodać poniższe do pliku <span class=filename>local.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>         &lt;match target=&#34;pattern&#34; name=&#34;family&#34;&gt;
             &lt;test qual=&#34;any&#34; name=&#34;family&#34;&gt;
                 &lt;string&gt;Helvetica&lt;/string&gt;
             &lt;/test&gt;
             &lt;edit name=&#34;family&#34; mode=&#34;assign&#34;&gt;
                 &lt;string&gt;sans-serif&lt;/string&gt;
             &lt;/edit&gt;
         &lt;/match&gt;</pre></div></div><div class=paragraph><p>Skończywszy edycję <span class=filename>local.conf</span> upewnijmy się, że plik kończy się znacznikiem <code>&lt;/fontconfig></code>. Bez tego może się okazać, że nasze zmiany zostaną zignorowane.</p></div><div class=paragraph><p>Korzystanie z domyślnego zestawu czcionek, dostępnego wraz z X11, nie jest wskazane jeśli chodzi o wygładzanie. Zdecydowanie lepszy zestaw domyślnych czcionek zawiera port <a class=package href=https://cgit.freebsd.org/ports/tree/x11-fonts/bitstream-vera/>x11-fonts/bitstream-vera</a>. Port ten zainstaluje również plik <span class=filename>/usr/X11R6/etc/fonts/local.conf</span> jeśli jeszcze go nie mamy. Jeśli natomiast istnieje już taki plik w systemie, stworzony zostanie plik <span class=filename>/usr/X11R6/etc/fonts/local.conf-vera</span>. Wystarczy dołączyć zawartość tego pliku do <span class=filename>/usr/X11R6/etc/fonts/local.conf</span>, by czcionki Bitstream automatycznie zastąpiły domyślne czcionki X11 Serif, Sans Serif i Monospaced.</p></div><div class=paragraph><p>Na koniec, użytkownicy mogą dodać swoją konfigurację poprzez własny plik <span class=filename>.fonts.conf</span>. W tym celu każdy użytkownik może stworzyć i zmodyfikować plik <span class=filename>~/.fonts.conf</span>. Również ten plik wykorzystuje format XML.</p></div><div class=paragraph><p>Ostatnia rzecz: osoby korzystające z monitorów LCD mogą pragnąć zastosować wygładzanie podpikselowe. W skrócie, w metodzie tej czerwone, zielone i niebieskie komponenty (oddzielone w płaszczyźnie poziomej) traktowane są oddzielnie, co poprawia rozdzielczość poziomą i przynosi radykalne efekty. By włączyć wygładzanie podpikselowe należy dodać poniższy wiersz do pliku <span class=filename>local.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>         &lt;match target=&#34;font&#34;&gt;
             &lt;test qual=&#34;all&#34; name=&#34;rgba&#34;&gt;
                 &lt;const&gt;unknown&lt;/const&gt;
             &lt;/test&gt;
             &lt;edit name=&#34;rgba&#34; mode=&#34;assign&#34;&gt;
                 &lt;const&gt;rgb&lt;/const&gt;
             &lt;/edit&gt;
         &lt;/match&gt;</pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Zależnie od typu monitora, może się okazać, że będziemy musieli zastąpić <code>rgb</code> wartościami <code>bgr</code>, <code>vrgb</code> lub <code>vbgr</code>: poeksperymentujmy i sprawdźmy co da najlepszy efekt.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Wygładzanie powinno być aktywne przy następnym uruchomieniu serwera X. Tym nie mniej, programy muszą zostać poinformowane, by z niego korzystać. W chwili obecnej pakiet narzędzi Qt korzysta z wygładzania czcionek, tym samym również i całe środowisko KDE. GTK+ oraz GNOME również można skonfigurować do pracy z wygładzanymi czcionkami poprzez aplet "Font" (<a href=#x11-wm-gnome-antialias>Wygładzane czcionki w GNOME</a> zawiera szczegółowy opis). Domyślnie, Mozilla 1.2 i późniejsze będą automatycznie korzystać z wygładzania. By wyłączyć tę opcję, należy ponownie skompilować program z parametrem <code>-DWITHOUT_XFT</code>.</p></div></div></div><div class=sect2><h3 id=x-xdm>5.6. Menedżer pulpitów X<a class=anchor href=#x-xdm></a></h3><div class=sect3><h4 id=_omówienie>5.6.1. Omówienie<a class=anchor href=#_omówienie></a></h4><div class=paragraph><p>Menedżer pulpitów X (ang. X Display Manager XDM) jest opcjonalną częścią Systemu okien X, wykorzystywaną do zarządzania sesjami logowania. Znajduje on zastosowanie w kilku typach sytuacji, włączając w to zarówno minimalistyczne "Terminale X", komputery prywatne, jak również ogromne sieciowe serwery graficzne. Z uwagi na fakt, iż System okien X jest niezależny od wykorzystywanej sieci jak i protokołu, istnieje wiele możliwych konfiguracji klientów i serwerów na różnych maszynach połączonych ze sobą za pomocą sieci. XDM dostarcza graficznego interfejsu pozwalającego wybrać, z którym serwerem się połączymy, jak i przeprowadzić autoryzację, np. za pomocą kombinacji loginu i hasła.</p></div><div class=paragraph><p>XDM można postrzegać jako narzędzie dostarczające użytkownikowi takich samych funkcjonalności jak <a href="https://man.freebsd.org/cgi/man.cgi?query=getty&amp;sektion=8&amp;format=html">getty(8)</a> (szczegółowy opis zawiera <a href=./#term-config>Configuration</a>). Oznacza to, że to właśnie menedżer pulpitów w imieniu użytkownika dokonuje logowania do systemu i uruchamia menedżera sesji (z reguły menedżera okien). Następnie, XDM oczekuje aż program zakończy działanie, sygnalizując tym samym, że użytkownik skończył pracę i menedżer pulpitów powinien go wylogować z systemu. W tym momencie XDM może ponownie wyświetlić ekran logowania i wyboru środowiska graficznego oczekująć na kolejnego użytkownika.</p></div></div><div class=sect3><h4 id=_korzystanie_z_xdm>5.6.2. Korzystanie z XDM<a class=anchor href=#_korzystanie_z_xdm></a></h4><div class=paragraph><p>Demon XDM znajduje się w <span class=filename>/usr/X11R6/bin/xdm</span>. Program ten może zostać uruchomiony w dowolnej chwili przez użytkownika <code>root</code> i od razu rozpocznie zarządzanie ekranami X w lokalnym systemie. Jeśli jednak XDM ma być uruchamiany przy każdym starcie systemu, najlepszym rozwiązaniem jest dodanie odpowiedniego wpisu do pliku <span class=filename>/etc/ttys</span>. <a href=./#term-etcttys>Adding an Entry to /etc/ttys</a> zawiera więcej informacji odnośnie formatu i wykorzystania tego pliku. W domyślnej wersji plik <span class=filename>/etc/ttys</span> zawiera wiersz uruchamiający demona XDM w wirtualnym terminalu:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>ttyv8   <span class=s2>&#34;/usr/X11R6/bin/xdm -nodaemon&#34;</span>  xterm   off secure</code></pre></div></div><div class=paragraph><p>Domyślnie, wiersz ten jest nieaktywny. By go uaktywnić należy zmienić zawartość 5 kolumny z <code>off</code> na <code>on</code> i ponownie uruchomić <a href="https://man.freebsd.org/cgi/man.cgi?query=init&amp;sektion=8&amp;format=html">init(8)</a> wykorzystująć wskazówki z <a href=./#term-hup>Force init to Reread /etc/ttys</a>. Pierwsza kolumna - nazwa terminala, którym będzie zarządzał dany program - to <code>ttyv8</code>. Oznacza to, że XDM będzie pracował na dziewiątny wirtualnym terminalu.</p></div></div><div class=sect3><h4 id=_konfiguracja_xdm>5.6.3. Konfiguracja XDM<a class=anchor href=#_konfiguracja_xdm></a></h4><div class=paragraph><p>W katalogu <span class=filename>/usr/X11R6/lib/X11/xdm</span> znajdują się pliki konfiguracyjne XDM. Pliki te można wykorzystać do zmiany zachowania i wyglądu menedżera ekranów. Z reguły są to następujące pliki:</p></div><table class="tableblock frame-none grid-all stretch informaltable"><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">Plik</th><th class="tableblock halign-left valign-top">Opis</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>Xaccess</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Zestaw reguł autoryzacji klientów.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>Xresources</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Domyślne wartości zasobów X.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>Xservers</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Lista zdalnych i lokalnych ekranów do zarządzania.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>Xsession</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Domyślny skrypt sesji logowania.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>Xsetup_</span>*</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Skrypt uruchamiający aplikacje przed interfejsem logowania.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>xdm-config</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Konfiguracja globalna dla wszystkich ekranów danej maszynie.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>xdm-errors</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Błędy generowane przez program serwera.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>xdm-pid</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Identyfikator procesu aktualnie działającego XDM.</p></td></tr></tbody></table><div class=paragraph><p>W tym katalogu znajduje się również kilka skryptów i programów wykorzystywanych do konfiguracji pulpitów w trakcie działania XDM. Zadanie każdego z tych plików zostanie pokrótce omówione. Dokładna składnia i wykorzystanie wszystkich tych plików znajduje się w <a href="https://man.freebsd.org/cgi/man.cgi?query=xdm&amp;sektion=1&amp;format=html">xdm(1)</a>.</p></div><div class=paragraph><p>W domyślnej konfiguracji pojawi się prostokątne okno logowania z nazwą maszyny wypisaną dużą czcionką na samej górze, wraz z polami "Login:" i "Password:". Jest to dobry punkt wyjściowy do modyfikacji wyglądu i zachowania ekranów XDM.</p></div><div class=sect4><h5 id=_xaccess>5.6.3.1. Xaccess<a class=anchor href=#_xaccess></a></h5><div class=paragraph><p>Protokół wykorzystywany do łączenia z puplitami obsługiwanymi przez XDM nosi nazwę X Display Manager Connection Protocol (XDMCP). Plik ten jest zestawem reguł do kontroli połączeń XDMCP ze zdalnych maszyn. Z reguły jest on ignorowany, chyba że w pliku <span class=filename>xdm-config</span> zostanie włączona opcja nasłuchiwania zdalnych połączeń. Domyślnie nie zezwala się na połączenia z innych klientów.</p></div></div><div class=sect4><h5 id=_xresources>5.6.3.2. Xresources<a class=anchor href=#_xresources></a></h5><div class=paragraph><p>Jest to plik domyślnej konfiguracji programu wyboru puplitu i ekranu logowania. W tym właśnie pliku można modyfikować ich wygląd. Format pliku jest identyczny z formatem app-defaults opisanym w dokumentacji X11.</p></div></div><div class=sect4><h5 id=_xservers>5.6.3.3. Xservers<a class=anchor href=#_xservers></a></h5><div class=paragraph><p>Lista zdalnych pulpitów, do wyboru których mamy mieć dostęp za pomocą menedżera.</p></div></div><div class=sect4><h5 id=_xsession>5.6.3.4. Xsession<a class=anchor href=#_xsession></a></h5><div class=paragraph><p>Domyślny skrypt sesji XDM uruchamiany po zalogowaniu się użytkownika. Z reguły każdy użytkownik posiada zmodyfikowany według własnego upodobania skrypt sesji w pliku <span class=filename>~/.xsession</span>, uruchamiany zamiast tego skryptu.</p></div></div><div class=sect4><h5 id=_xsetup>5.6.3.5. Xsetup_*<a class=anchor href=#_xsetup></a></h5><div class=paragraph><p>Skrypty te zostaną automatycznie uruchomione przed wyświetleniem interfejsu logowania i wyboru pulpitu. Dla każdego wykorzystywanego ekranu znajduje się tu plik o nazwie <span class=filename>Xsetup_</span> wraz z numerem lokalnego ekranu (na przykład <span class=filename>Xsetup_0</span>). Z reguły skrypty te uruchamiają jeden bądź dwa programy w tle, jak np. <code>xconsole</code>.</p></div></div><div class=sect4><h5 id=_xdm_config>5.6.3.6. xdm-config<a class=anchor href=#_xdm_config></a></h5><div class=paragraph><p>Plik ustawień w formacie app-defaults, mający zastosowanie do wszystkich puplitów zarządzanych przez menedżera.</p></div></div><div class=sect4><h5 id=_xdm_errors>5.6.3.7. xdm-errors<a class=anchor href=#_xdm_errors></a></h5><div class=paragraph><p>Plik ten zawiera wydruki wyjściowe serwerów X, które XDM stara się uruchomić. Jeśli w trakcie uruchamiania pulpitu z jakiegoś powodu proces ten zawiesi się, najlepszym miejscem poszukiwania komunikatów błędów jest właśnie ten plik. Komunikaty te są również umieszczane w pliku <span class=filename>~/.xsession-errors</span> użytkownika dla danej sesji.</p></div></div></div><div class=sect3><h4 id=_konfiguracja_sieciowego_serwera_graficznego>5.6.4. Konfiguracja sieciowego serwera graficznego<a class=anchor href=#_konfiguracja_sieciowego_serwera_graficznego></a></h4><div class=paragraph><p>By umożliwić innym klientom łączenie się z serwerem graficznym, należy zmodyfikować reguły kontroli dostępu i włączyć opcję nasłuchiwania połączeń. Domyślnie opcja ta jest nie aktywna. Jej aktywacja polega na odkomentowaniu poniższej linii w pliku <span class=filename>xdm-config</span>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=o>!</span> SECURITY: <span class=k>do </span>not listen <span class=k>for </span>XDMCP or Chooser requests
<span class=o>!</span> Comment out this line <span class=k>if </span>you want to manage X terminals with xdm
DisplayManager.requestPort:     0</code></pre></div></div><div class=paragraph><p>Następnie należy ponownie uruchomić XDM. Pamiętajmy, że komentarze w plikach app-defaults rozpoczynają się od znaku "!" zamiast typowego "#". Lektura przykładowego pliku <span class=filename>Xaccess</span> oraz podręcznika systemowego <a href="https://man.freebsd.org/cgi/man.cgi?query=xdm&amp;sektion=1&amp;format=html">xdm(1)</a> może nam pomóc gdy będziemy potrzebować bardziej surowej kontroli dostępu.</p></div></div><div class=sect3><h4 id=_alternatywy_dla_xdm>5.6.5. Alternatywy dla XDM<a class=anchor href=#_alternatywy_dla_xdm></a></h4><div class=paragraph><p>Dostępnych jest kilka alternatyw dla domyślnego menedżera XDM. Jeden z nich - kdm (dostarczany razem z KDE) - został bliżej opisany w tym w dalszej części rozdziału. Menedżer kdm oferuje wiele wizualnych usprawnień i kosmetycznych dodaktów, jak również możliwość wyboru menedżera okien przed zalogowaniem do systemu.</p></div></div></div><div class=sect2><h3 id=x11-wm>5.7. Środowiska graficzne<a class=anchor href=#x11-wm></a></h3><div class=paragraph><p>Niniejsza sekcja opisuje różne typy środowisk graficznych dostępnych dla X we FreeBSD. Termin "środowisko graficzne" może oznaczać wszystko, od prostego menedżera okien po kompletny zestaw aplikacji puplitu, jak KDE czy GNOME.</p></div><div class=sect3><h4 id=x11-wm-gnome>5.7.1. GNOME<a class=anchor href=#x11-wm-gnome></a></h4><div class=sect4><h5 id=x11-wm-gnome-about>5.7.1.1. O GNOME<a class=anchor href=#x11-wm-gnome-about></a></h5><div class=paragraph><p>GNOME jest przyjaznym użytkownikowi środowiskiem graficznym, umożliwiającym łatwą konfigurację i proste korzystanie z komputera. GNOME posiada panel (do uruchamiania aplikacji i wyświetlania ich statusu), puplit (gdzie można umieszczać dane i aplikacje), zestaw standardowych narzędzi biurowych i aplikacji oraz zestaw pewnych konwencji ułatwiających współpracę miedzy aplikacjami i zachowanie wzajemnej spójności. Użytkownicy innych systemów operacyjnych powinni czuć się jak w domu korzystając z potężnego środowiska graficznego dostarczanego przez GNOME. Więcej informacji odnośnie środowiska GNOME we FreeBSD dostępnych jest na stronie WWW projektu <a href=http://www.FreeBSD.org/gnome>FreeBSD GNOME Project</a>. Strona ta zawiera również w miarę zrozumiałe FAQ traktujące o instalacji, konfiguracji i zarządzaniu GNOME.</p></div></div><div class=sect4><h5 id=x11-wm-gnome-install>5.7.1.2. Instalacja GNOME<a class=anchor href=#x11-wm-gnome-install></a></h5><div class=paragraph><p>Najprostszym sposobem instalacji GNOME jest poprzez menu "Desktop Configuration" w trakcie instalacji FreeBSD, co omawia <a href=./#default-desktop>Wybór menedżera okien</a> rozdziału 2. Możliwa jest również instalacja z pakietu bądź kolekcji portów:</p></div><div class=paragraph><p>By zainstalować pakiet GNOME z sieci, wystarczy wpisać:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pkg_add -r gnome2</span></code></pre></div></div><div class=paragraph><p>By skompilować GNOME ze źródeł najlepiej jest skorzystać z portu:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/ports/x11/gnome2</span>
<span class=c># make install clean</span></code></pre></div></div><div class=paragraph><p>Mając już zainstalowanego GNOME musimy poinformować serwer X, by uruchamiał właśnie jego w miejsce domyślnego menedżera okien.</p></div><div class=paragraph><p>Najprostszą metodą uruchomienia GNOME jest wykorzystanie GDM - menedżera pulpitów GNOME (ang. GNOME Display Manager). GDM jest instalowany jako część środowiska GNOME, jednakże jest on domyślnie wyłączony. By go włączyć, należy dodać wiersz <code>gdm_enable="YES"</code> do pliku <span class=filename>/etc/rc.conf</span>. Po ponownym uruchomieniu systemu, GNOME zostanie automatycznie włączony zaraz po zalogowaniu się - nie wymagana jest dodatkowa konfiguracja.</p></div><div class=paragraph><p>Oczywiście, GNOME można uruchomić również bezpośrednio z linii poleceń poprawnie konfigurując plik <span class=filename>.xinitrc</span> w katalogu domowym. Jeśli plik ten już istnieje wystarczy zastąpić wiersz odpowiadający za uruchomienie aktualnego menedżera okien na wiersz uruchamiający /usr/X11R6/bin/gnome-session. Jeśli w pliku nie dokonywaliśmy żadnych istotnych zmian, najprościej będzie po prostu wpisać:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% <span class=nb>echo</span> <span class=s2>&#34;/usr/X11R6/bin/gnome-session&#34;</span> <span class=o>&gt;</span> ~/.xinitrc</code></pre></div></div><div class=paragraph><p>Następnie wpisujemy <code>startx</code>, co spowoduje uruchomienie środowiska GNOME.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Jeśli wykorzystujemy starszego menedżera okien, jak np. XDM, powyższe rozwiązanie nie zadziała. W takiej sytuacji musimy stworzyć plik wykonywalny <span class=filename>.xsession</span> zawierający powyższe polecenie. W tym celu należy zmodyfikować ten plik i zastąpić polecenie uruchamiające aktualnego menedżera poleceniem /usr/X11R6/bin/gnome-session:</p></div></td></tr></tbody></table></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% <span class=nb>echo</span> <span class=s2>&#34;#!/bin/sh&#34;</span> <span class=o>&gt;</span> ~/.xsession
% <span class=nb>echo</span> <span class=s2>&#34;/usr/X11R6/bin/gnome-session&#34;</span> <span class=o>&gt;&gt;</span> ~/.xsession
% <span class=nb>chmod</span> +x ~/.xsession</code></pre></div></div><div class=paragraph><p>Jeszcze jedną metodą jest skonfigurowanie menedżera pulpitów tak, by umożliwiał wybór menedżera okien w trakcie logowania. Sekcja <a href=#x11-wm-kde-details>Więcej informacji o KDE</a> wyjaśnia jak to zrobić w kdm - menedżerze puplitów KDE.</p></div></div><div class=sect4><h5 id=x11-wm-gnome-antialias>5.7.1.3. Wygładzane czcionki w GNOME<a class=anchor href=#x11-wm-gnome-antialias></a></h5><div class=paragraph><p>X11 obsługuje wygładzanie czcionek (anti-aliasing) za pomocą rozszerzenia "RENDER". GTK+ w wersji 2.0 i późniejszych (pakiet narzędzi graficznych wykorzystywany przez GNOME) potrafi korzystać z tej funkcji. Konfigurację wygładzania czcionek opisuje <a href=#antialias>Wygładzane czcionki</a>. Zatem, wykorzystując najnowsze oprogramowanie, możliwe jest wygładzanie czcionek w środowisku GNOME. Wystarczy przejść do menu <span class=menuseq><b class=menu>Applications</b> <i class="fa fa-angle-right caret"></i> <b class=submenu>Desktop Preferences</b> <i class="fa fa-angle-right caret"></i> <b class=menuitem>Font</b></span> i wybrać jedną z opcji: <b class=button>Best shapes</b> (najlepsze kształty), <b class=button>Best contrast</b> (najlepszy kontrast) lub <b class=button>Subpixel smoothing (LCDs)</b> (wygładzanie podpikselowe). Natomiast dla aplikacji GTK+ nie będących częścią środowiska GNOME, należy ustawić zmienną środowiskową <code>GDK_USE_XFT</code> na <code>1</code> przed uruchomieniem programu.</p></div></div></div><div class=sect3><h4 id=x11-wm-kde>5.7.2. KDE<a class=anchor href=#x11-wm-kde></a></h4><div class=sect4><h5 id=x11-wm-kde-about>5.7.2.1. O KDE<a class=anchor href=#x11-wm-kde-about></a></h5><div class=paragraph><p>KDE jest prostym w użyciu współczesnym środowiskiem graficznym, zawierającym między innymi:</p></div><div class=ulist><ul><li><p>Ładnie wyglądający puplit</p></li><li><p>Pulpit odznaczający się całkowitą przezroczystością sieci</p></li><li><p>Zintegrowany system pomocy, udostępniający w prosty sposób informacje o korzystaniu ze środowiska KDE i jego aplikacji</p></li><li><p>Jednakowy wygląd i zachowanie wszystkich aplikacji KDE</p></li><li><p>Standardowe menu i paski narzędzi, skróty klawiaturowe, schematy kolorów, itp.</p></li><li><p>Internacjonalizacja: KDE jest dostępny w ponad 40 językach</p></li><li><p>Scentralizowaną i spójną konfigurację środowiska</p></li><li><p>Całą masę przydanych aplikacji</p></li></ul></div><div class=paragraph><p>KDE posiada własną przeglądarkę internetową - Konqueror, która stanowi poważną konkurencję dla innych przeglądarek z systemów UNIX®. Więcej informacji o KDE znaleźć można na <a href=http://www.kde.org/>stronie KDE</a>. Natomiast informacje o jego współpracy z FreeBSD dostępne są na stronie <a href=http://freebsd.kde.org/>FreeBSD-KDE team</a>.</p></div></div><div class=sect4><h5 id=x11-wm-kde-install>5.7.2.2. Instalacja KDE<a class=anchor href=#x11-wm-kde-install></a></h5><div class=paragraph><p>Podobnie jak w przypadku GNOME czy dowolnego innego środowiska graficznego, najprostszym sposobem instalacji KDE jest skorzystanie z menu "Desktop Configuration" w procesie instalacji FreeBSD, co omawia <a href=./#default-desktop>Wybór menedżera okien</a> rozdziału 2. Ponownie, również KDE można zainstalować z pakietu bądź z kolekcji portów:</p></div><div class=paragraph><p>By zainstalować pakiet KDE z sieci, wystarczy wpisać:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pkg_add -r kde</span></code></pre></div></div><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=pkg_add&amp;sektion=1&amp;format=html">pkg_add(1)</a> automatycznie pobierze najnowszą wersję aplikacji.</p></div><div class=paragraph><p>By skompilować KDE ze źródeł najlepiej jest skorzystać z portu:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/ports/x11/kde3</span>
<span class=c># make install clean</span></code></pre></div></div><div class=paragraph><p>Po instalacji KDE należy poinformować serwer X, by uruchamiał go w miejsce domyślnego menedżera okien. W tym celu należy zmodyfikować plik <span class=filename>.xinitrc</span>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% <span class=nb>echo</span> <span class=s2>&#34;exec startkde&#34;</span> <span class=o>&gt;</span> ~/.xinitrc</code></pre></div></div><div class=paragraph><p>Od tej pory, za każdym razem gdy uruchomimy System okien X za pomocą polecenia <code>startx</code>, uruchomione zostanie środowisko KDE.</p></div><div class=paragraph><p>Jeśli wykorzystujemy starszego menedżera okien, jak np. XDM, wymagana jest odmienna konfiguracja. Opis konfiguracji kdm znajduje się w dalszej części tego rozdziału.</p></div></div></div><div class=sect3><h4 id=x11-wm-kde-details>5.7.3. Więcej informacji o KDE<a class=anchor href=#x11-wm-kde-details></a></h4><div class=paragraph><p>Skoro zainstalowaliśmy już KDE, większość informacji można odnaleźć w systemie pomocy, bądź po prostu klikając w dowolne menu. Użytkownicy systemów Windows® czy Mac® powinni czuć się jak w domu.</p></div><div class=paragraph><p>Najlepszym źródłem informacji o KDE jest dostępna w sieci dokumentacja. KDE zawiera własną przeglądarkę internetową - Konqueror, masę przydatnych aplikacji i obszerną dokumentację. Pozostała część tego rozdziału skupi się na technicznych zagadnieniach, trudnych do nauczenia się poprzez dość losowe poznawanie środowiska.</p></div><div class=sect4><h5 id=x11-wm-kde-kdm>5.7.3.1. Menedżer puplitów KDE<a class=anchor href=#x11-wm-kde-kdm></a></h5><div class=paragraph><p>Administratorzy systemów wieloużytkownikowych mogą chcieć skorzystać z graficznego ekranu logowania. W tym celu można zastosować <a href=#x-xdm>XDM</a>, jak to zostało opisane wcześniej. Można również wykorzystać alternatywne rozwiązanie dostępne razem z KDE - kdm - wyglądające zdecydowanie bardziej atrakcyjnie oraz posiadające wiele dodatkowych opcji logowania. W szczególności, użytkownicy mogą w prosty sposób wybrać (poprzez menu), które środowisko graficzne uruchomić po zalogowaniu (KDE, GNOME, bądź inne).</p></div><div class=paragraph><p>By aktywować kdm, należy zmodyfikować wpis dla <code>ttyv8</code> w pliku <span class=filename>/etc/ttys</span>. Wiersz ten powinien wyglądać następująco:</p></div><div class="literalblock programlisting"><div class=content><pre>ttyv8 &#34;/usr/local/bin/kdm -nodaemon&#34; xterm on secure</pre></div></div></div></div><div class=sect3><h4 id=x11-wm-xfce>5.7.4. XFce<a class=anchor href=#x11-wm-xfce></a></h4><div class=sect4><h5 id=x11-wm-xfce-about>5.7.4.1. O XFce<a class=anchor href=#x11-wm-xfce-about></a></h5><div class=paragraph><p>XFce jest środowiskiem graficznym wykorzystującym pakiet narzędzi GTK+, podobnie jak GNOME, lecz jest zdecydowanie lżejsze i przeznaczone dla osób poszukujących prostego i efektywnego środowiska, lecz również łatwego w obsłudze i konfiguracji. Wyglądem bardzo przypomina CDE, często dostępne w komercyjnych systemach UNIX®. Niektóre z cech XFce:</p></div><div class=ulist><ul><li><p>Prosty i łatwy w obsłudze pulpit</p></li><li><p>Możliwość konfiguracji wszystkich elementów za pomocą myszki, metody przeciągnij i upuść, itp.</p></li><li><p>Główny panel podobny do CDE z wieloma opcjami menu, apletami i programami wywołującymi</p></li><li><p>Zintegrowane menedżery okien, plików, dźwięku, moduł zgodności GNOME i inne dodatki</p></li><li><p>Możliwość stosowania motywów (skoro wykorzystuje GTK+)</p></li><li><p>Szybkie, lekkie i wydajne: idealny dla starszych/wolniejszych maszyn lub z ograniczonym zasobem pamięci</p></li></ul></div><div class=paragraph><p>Więcej informacji dostępnych jest na <a href=http://www.xfce.org/>stronie XFce</a>.</p></div></div><div class=sect4><h5 id=x11-wm-xfce-install>5.7.4.2. Instalacja XFce<a class=anchor href=#x11-wm-xfce-install></a></h5><div class=paragraph><p>W chwili pisania niniejszego tekstu dostępny jest pakiet binarny. By z niego zainstalować XFce, wystarczy wpisać:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pkg_add -r xfce4</span></code></pre></div></div><div class=paragraph><p>Oczywiście, można również skompilować go ze źródeł przy pomocy kolekcji portów:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/ports/x11-wm/xfce4</span>
<span class=c># make install clean</span></code></pre></div></div><div class=paragraph><p>Pozostaje jeszcze poinformować serwer X by uruchamiał XFce przy kolejnych uruchomieniach X. Wystarczy wpisać:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% <span class=nb>echo</span> <span class=s2>&#34;/usr/X11R6/bin/startxfce4&#34;</span> <span class=o>&gt;</span> ~/.xinitrc</code></pre></div></div><div class=paragraph><p>Przy kolejnym uruchomieniu X jako środowisko graficzne zostanie wykorzystane XFce. Podobnie jak wcześniej, tak i teraz należy stworzyć plik <span class=filename>.xsession</span> gdy korzystamy z XDM, co zostało umówione w części poświęconej <a href=#x11-wm-gnome>GNOME</a>, wpisując polecenie <span class=filename>/usr/X11R6/bin/startxfce4</span>. Alternatywnie, należy skonfigurować menedżera pulpitów, by pozwalał na wybór środowiska graficznego w trakcie logowania, zgodnie z opisem z sekcji poświęconej <a href=#x11-wm-kde-kdm>kdm</a>.</p></div></div></div></div></div></div><h1 id=common-tasks class=sect0>Część II: Codzienne czynności<a class=anchor href=#common-tasks></a></h1><div class="openblock partintro"><div class=content><div class=paragraph><p>Skoro podstawy zostały już omówione, ta część Podręcznika zajmie się kilkoma z najczęściej wykorzystywanych funkcji FreeBSD. Niniejsze rozdziały:</p></div><div class=ulist><ul><li><p>Przedstawią popularne i przydatne aplikacje biurowe: przeglądarki, edytory dokumentów, itp.</p></li><li><p>Przedstawią narzędzia multimedialne dostępne dla FreeBSD.</p></li><li><p>Wyjaśnią proces kompilacji własnego jądra FreeBSD w celu włączenia dodatkowych funkcji w systemie.</p></li><li><p>Opiszą szczegółowo system wydruku, zarówno dla drukarek podłączonych lokalnie jak i drukarek sieciowych.</p></li><li><p>Pokarzą jak uruchomić aplikacje Linuksowe w systemie FreeBSD.</p></li></ul></div><div class=paragraph><p>Niektóre z poniższych rozdziałów zalecają lekturę dodatkowych materiałów, co zostanie wskazane w streszczeniu na początku każdego rozdziału.</p></div></div></div><div class=sect1><h2 id=desktop>Rozdział 6. Aplikacje biurowe<a class=anchor href=#desktop></a></h2><div class=sectionbody><div class=sect2><h3 id=desktop-synopsis>6.1. Streszczenie<a class=anchor href=#desktop-synopsis></a></h3><div class=paragraph><p>Podobnie jak we wszystkich współczesnych systemach operacyjnych, również i we FreeBSD możemy uruchamiać szereg aplikacji biurowych, jak np. przeglądarki czy procesory tekstu. Większość z nich dostępnych jest zarówno w postaci pakietów jak i portów. Rozdział ten zaprezentuje jak bez większego wysiłku można je zainstalować zarówno z odpowiednich pakietów jak też wprost z kolekcji portów.</p></div><div class=paragraph><p>Pamiętajmy, że instalacja programów z portów obejmuje również ich kompilację ze źródeł. Stąd też proces ten może zająć dużo czasu, zależnie od tego co kompilujemy, oraz od mocy obliczeniowej naszej maszyny. Jeśli kompilacja ze źródeł jest dla nas zbyt czasochłonnym zadaniem, większość programów dostępnych w kolekcji portów możemy zainstalować również z prekompilowanych pakietów.</p></div><div class=paragraph><p>Jako, że FreeBSD umożliwia tzw. tryb zgodności binarnej z Linuksem, wiele aplikacji pisanych pod Linuksa dostępnych jest również we FreeBSD. Jednakże, przed instalacją jakiegokolwiek programu linuksowego zalecamy przeczytać Rozdział 10, <a href=./#linuxemu>Linux Binary Compatibility</a> niniejszego Podręcznika. Nazwy wielu portów wykorzystujących zgodność binarną z Linuksem rozpoczynają się od "linux-", o czym warto pamiętać poszukując właściwego portu, np. za pomocą polecenia <a href="https://man.freebsd.org/cgi/man.cgi?query=whereis&amp;sektion=1&amp;format=html">whereis(1)</a>. W dalszej części rozdziału założono, że przed instalacją jakiejkolwiek linuksowej aplikacji w naszym komputerze został włączony tryb zgodności z Linuksem.</p></div><div class=paragraph><p>Programy omówione w tym rozdziale zostały podzielone na następujące kategorie:</p></div><div class=ulist><ul><li><p>Przeglądarki internetowe (takie jak Mozilla, Opera, Firefox czy Konqueror)</p></li><li><p>Programy codziennego użytku (jak np. KOffice, AbiWord, The GIMP oraz OpenOffice.org)</p></li><li><p>Przeglądarki dokumentów (takie jak Acrobat Reader®, gv, Xpdf i GQview)</p></li><li><p>Finanse (jak np. GnuCash, Gnumeric, Abacus)</p></li></ul></div><div class=paragraph><p>Przed przeczytaniem tego rozdziału, powinniśmy:</p></div><div class=ulist><ul><li><p>Wiedzieć jak instalować dodatkowe programy (<a href=./#ports>Instalacja programów. pakiety i porty</a>).</p></li><li><p>Wiedzieć, jak instalować programy linuksowe (<a href=./#linuxemu>Linux Binary Compatibility</a>).</p></li></ul></div><div class=paragraph><p><a href=./#multimedia>Multimedia</a> zawiera informacje odnośnie instalacji środowiska multimedialnego. Natomiast Rozdział 24, Electronic Mail zawiera wskazówki jak skonfigurować i korzystać z poczty elektronicznej.</p></div></div><div class=sect2><h3 id=desktop-browsers>6.2. Przeglądarki internetowe<a class=anchor href=#desktop-browsers></a></h3><div class=paragraph><p>FreeBSD z definicji nie posiada zainstalowanej żadnej przeglądarki internetowej. W zamian katalog <a href=https://www.FreeBSD.org/ports/>www</a> kolekcji portów zawiera całą masę przeglądarek gotowych do instalacji. Jeśli nie mamy czasu na kompilację (co w niektórych przypadkach może zająć naprawdę dużo czasu), wiele z nich udostępnionych zostało również w postaci pakietów.</p></div><div class=paragraph><p>KDE i GNOME dysponują własnymi przeglądarkami internetowymi. <a href=./#x11-wm>“Środowiska graficzne”</a> zawiera szczegółowe informacje odnośnie instalacji tych środowisk graficznych.</p></div><div class=paragraph><p>Jeśli szukamy lekkich przeglądarek internetowych, powinniśmy zainteresować sie <a class=package href=https://cgit.freebsd.org/ports/tree/www/dillo2/>www/dillo2</a>, <a class=package href=https://cgit.freebsd.org/ports/tree/www/links/>www/links</a>, lub <a class=package href=https://cgit.freebsd.org/ports/tree/www/w3m/>www/w3m</a>.</p></div><div class=paragraph><p>Niniejsza sekcja omawia następujące programy:</p></div><table class="tableblock frame-none grid-all stretch informaltable"><col style=width:25%><col style=width:25%><col style=width:25%><col style=width:25%><thead><tr><th class="tableblock halign-left valign-top">Nazwa aplikacji</th><th class="tableblock halign-left valign-top">Wykorzystanie zasobów</th><th class="tableblock halign-left valign-top">Instalacja z portów</th><th class="tableblock halign-left valign-top">Główne zależności</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Mozilla</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>duże</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>długa</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Gtk+</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Opera</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>małe</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>krótka</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Dostępne są wersje dla FreeBSD i Linuksa. Wersja dla Linuksa wymaga trybu zgodności binarnej z Linuksem oraz linux-openmotif.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Firefox</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>średnie</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>długa</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Gtk+</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Konqueror</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>średnie</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>długa</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Biblioteki KDE</p></td></tr></tbody></table><div class=sect3><h4 id=_mozilla>6.2.1. Mozilla<a class=anchor href=#_mozilla></a></h4><div class=paragraph><p>Mozilla jest nowoczesną, stabilną przeglądarką w całości przeniesioną na FreeBSD. Zawiera w pełni zgodny ze standardami mechanizm wyświetlania kodu HTML, jak również klienta poczty elektronicznej i grup dyskusyjnych. Dysponuje nawet edytorem HTML, jeśli sami chcemy pisać strony internetowe. Użytkownicy Netscape® z pewnością dostrzegą podobieństwo do pakietu Communicator, gdyż obydwie przeglądarki mają te same pochodzenie.</p></div><div class=paragraph><p>Na wolnych maszynach, z procesorem wolniejszym niż 233MHz bądź z pojemnością pamięci RAM mniejszą niż 64MB, Mozilla może okazać się zbyt "zasobo-żerna". W tej sytuacji możemy zainteresować się np. przeglądarką Opera, opisaną w dalszej części tego rozdziału.</p></div><div class=paragraph><p>Jeśli nie możemy bądź z dowolnego powodu nie chcemy kompilować przeglądarki Mozilla, grupa FreeBSD GNOME zrobiła to za nas. Wystarczy zainstalować pakiet bezpośrednio z sieci za pomocą:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pkg_add -r mozilla</span></code></pre></div></div><div class=paragraph><p>Jeśli z jakichś powodów pakiet nie jest dostępny, a my dysponujemy czasem i miejscem na dysku, możemy pobrać źródła, skompilować je i zainstalować w naszym systemie. W tym celu wystarczy wpisać:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/ports/www/mozilla</span>
<span class=c># make install clean</span></code></pre></div></div><div class=paragraph><p>Port ten przygotowany został w sposób zapewniający właściwą inicjalizację poprzez uruchamianie rejestru konfiguracji z uprawnieniami użytkownika <code>root</code>, w momencie gdy pracujemy na koncie zwykłego użytkownika. Tym nie mniej, jeśli chcemy poprawnie zainstalować dodatkowe składniki, musimy uruchomić program Mozilla jako <code>root</code>.</p></div><div class=paragraph><p>By uruchomić przeglądarkę należy wpisać poniższe polecenie. Poza procesem instalacji, przeglądarka nie wymaga korzystania z konta <code>root</code>.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% mozilla</code></pre></div></div><div class=paragraph><p>Uruchomienie jej bezpośrednio w trybie klienta poczty i grup dyskusyjnych możliwe jest za pomocą polecenia:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% mozilla <span class=nt>-mail</span></code></pre></div></div></div><div class=sect3><h4 id=_firefox>6.2.2. Firefox<a class=anchor href=#_firefox></a></h4><div class=paragraph><p>Firefox jest nowoczesną przeglądarką, opartą o kod przeglądarki Mozilla. O ile Mozilla stanowi kompletny pakiet aplikacji - zawiera m.in. przeglądarkę, klienta poczty, czy grup dyskusyjnych, o tyle Firefox jest jedynie przeglądarką, dzięki czemu jest zdecydowanie mniejszy i szybszy.</p></div><div class=paragraph><p>By zainstalować go z pakietu wystarczy wpisać:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pkg_add -r firefox</span></code></pre></div></div><div class=paragraph><p>Jeśli preferujemy kompilację programów wprost z kodu źródłowego, możemy skorzystać z kolekcji portów:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/ports/www/firefox</span>
<span class=c># make install clean</span></code></pre></div></div></div><div class=sect3><h4 id=moz-java-plugin>6.2.3. Firefox, Mozilla i moduł Java™<a class=anchor href=#moz-java-plugin></a></h4><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>W tej i następnej sekcji założono, że mamy już zainstalowaną przeglądarkę Firefox lub Mozilla.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Fundacja FreeBSD posiada licencję Sun Microsystems na dystrybucję plików binarnych FreeBSD dla środowisk Java Runtime Environment (JRETM) oraz Java Development Kit (JDKTM). Pakiety binarne dla FreeBSD dostępne są na stronie WWW <a href=http://www.freebsdfoundation.org/downloads/java.shtml>Fundacji FreeBSD</a>.</p></div><div class=paragraph><p>By do przeglądarki Firefox lub Mozilla dodać obsługę JavaTM, musimy wpierw zainstalować port <a class=package href=https://cgit.freebsd.org/ports/tree/java/javavmwrapper/>java/javavmwrapper</a>, a następnie pobrać pakiet Diablo JRETM ze strony <a href=http://www.freebsdfoundation.org/downloads/java.shtml class=bare>http://www.freebsdfoundation.org/downloads/java.shtml</a>, i zainstalować go za pomocą pkg_add(1).</p></div><div class=paragraph><p>Po ponownym uruchomieniu przeglądarki, wpisaniu w pasku adresu <code>about:plugins</code> i wciśnięciu <kbd>Enter</kbd>, wyświetlona zostanie strona informująca o zainstalowanych modułach. Wymieniony powinien zostać również moduł JavaTM.</p></div></div></div><div class=sect2><h3 id=moz-flash-plugin>6.3. Firefox, Mozilla i moduł Macromedia® Flash®<a class=anchor href=#moz-flash-plugin></a></h3><div class=paragraph><p>Moduł Macromedia® Flash® niestety nie jest dostępny dla FreeBSD. Tym nie mniej, istnieje interfejs programowy (ang. wrapper) do uruchamiania linuksowej wersji modułu. Interfejs ten obsługuje również moduły Adobe® Acrobat®, RealPlayer i wiele innych.</p></div><div class=paragraph><p>By zainstalować port <a class=package href=https://cgit.freebsd.org/ports/tree/www/linuxpluginwrapper/>www/linuxpluginwrapper</a>, musimy wpierw zainstalować <a class=package href=https://cgit.freebsd.org/ports/tree/emulators/linux_base/>emulators/linux_base</a>, który jest obszernym portem. W trakcie instalacji należy zwrócić szczególną uwagę na informacje o właściwej konfiguracji pliku <span class=filename>/etc/libmap.conf</span>! Przykładowe pliki konfiguracyjne znaleźć można w katalogu <span class=filename>/usr/local/shared/examples/linuxpluginwrapper/</span>.</p></div><div class=paragraph><p>Kolejnym krokiem jest instalacja portu www/linux-flashplugin7. Po zainstalowaniu modułu możemy sprawdzić listę aktualnie dostępnych modułów uruchamiając przeglądarkę, wpisując w pasku adresu <code>about:plugins</code> i wciskając <kbd>Enter</kbd>..</p></div><div class=paragraph><p>Jeśli na powyższej liście brak jest modułu Flash®, najczęstszą przyczyną jest brak odpowiedniego dowiązania symbolicznego. W takiej sytuacji należy jako użytkownik root uruchomić następujące polecenia:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ln -s /usr/local/lib/npapi/linux-flashplugin/libflashplayer.so \</span>
  /usr/X11R6/lib/browser_plugins/
<span class=c># ln -s /usr/local/lib/npapi/linux-flashplugin/flashplayer.xpt \</span>
  /usr/X11R6/lib/browser_plugins/</code></pre></div></div><div class=paragraph><p>Po ponownym uruchomieniu przeglądarki, moduł powinien zostać wyświetlony na wspomnianej liście. Może się również zdażyć, że nasza przeglądarka ulegenie awarii w trakcie odtwarzania animacji Flash®. W takim przypadku będziemy musieli nałożyć odpowiednią łatę (ang. patch):</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/src</span>
<span class=c># fetch http://people.FreeBSD.org/~nork/rtld_dlsym_hack.diff</span>
<span class=c># patch &lt; rtld_dlsym_hack.diff</span>
<span class=c># cd libexec/rtld-elf/</span>
<span class=c># make clean</span>
<span class=c># make obj</span>
<span class=c># make depend</span>
<span class=c># make &amp;&amp; make install</span></code></pre></div></div><div class=paragraph><p>Po czym musimy ponownie uruchomić komputer.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Port linuxpluginwrapper działa poprawnie jedynie na maszynach o architekturze i386™.</p></div></td></tr></tbody></table></div></div><div class=sect2><h3 id=_opera>6.4. Opera<a class=anchor href=#_opera></a></h3><div class=paragraph><p>Opera jest nowoczesną, zgodną ze standardami przeglądarką internetową. Posiada również klienta poczty elektronicznej i grup dyskusyjnych, klienta sieci IRC, czytnik wiadomości RSS/Atom i wiele innych. Mimo to Opera jest stosunkowo lekką i bardzo szybką przeglądarką. Dostępne są dwie wersje: wersja przeznaczona dla FreeBSD oraz wersja uruchamiana w trybie emulacji Linuksa.</p></div><div class=paragraph><p>By móc przeglądać zasoby sieci WWW za pomocą wersji dla FreeBSD, musimy zainstalować odpowiedni pakiet:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/ports/www/firefox</span>
<span class=c># make install clean</span></code></pre></div></div><div class=paragraph><p>Niektóre serwery FTP nie zawierają wszystkich pakietów, lecz ten sam efekt możemy otrzymać wykorzystując kolekcję portów:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/ports/www/firefox</span>
<span class=c># make install clean</span></code></pre></div></div><div class=paragraph><p>By zainstalować wersję linuksową należy w powyższych przykładach zmienić nazwę <code>opera</code> na <code>linux-opera</code>. Wersja linuksowa przydatna jest w sytuacjach wymagających modułów dostępnych tylko dla Linuksa, jak np. Adobe Acrobat Reader®. Pod każdym innym względem wersje dla FreeBSD i Linuksa zdają się być funkcjonalnie identyczne.</p></div></div><div class=sect2><h3 id=_konqueror>6.5. Konqueror<a class=anchor href=#_konqueror></a></h3><div class=paragraph><p>Konqueror jest częścią środowiska graficznego KDE, lecz może być również wykorzystywane poza nim poprzez zainstalowanie <a class=package href=https://cgit.freebsd.org/ports/tree/x11/kdebase3/>x11/kdebase3</a>. Konqueror jest więcej niż przeglądarką internetową, jest również menedżerem plików i przeglądarką plików multimedialnych.</p></div><div class=paragraph><p>Konqueror dostępny jest również z pakietem modułów, z portu <a class=package href=https://cgit.freebsd.org/ports/tree/misc/konq-plugins/>misc/konq-plugins</a>.</p></div><div class=paragraph><p>Również Konqueror obsługuje technologię Flash®. Dokument opisujący instalację modułu dostępny jest pod adresem <a href=http://freebsd.kde.org/howto.php class=bare>http://freebsd.kde.org/howto.php</a>.</p></div></div><div class=sect2><h3 id=desktop-productivity>6.6. Programy codziennego użytku<a class=anchor href=#desktop-productivity></a></h3><div class=paragraph><p>Jeśli chodzi o programy codziennego użytku, pierwszą rzeczą, której często poszukuje wielu nowych użytkowników, jest dobry pakiet biurowy bądź po prostu procesor tekstu. Pomimo, że niektóre <a href=./#x11-wm>środowiska graficzne</a>, jak np. KDE, dysponują własnym pakietem biurowym, nie istnieje żadna domyślna aplikacja. Niezależnie od wykorzystywanego środowiska graficznego, FreeBSD dysponuje wszystkim czego możemy potrzebować.</p></div><div class=paragraph><p>Sekcja ta omawia następujące aplikacje:</p></div><table class="tableblock frame-none grid-all stretch informaltable"><col style=width:25%><col style=width:25%><col style=width:25%><col style=width:25%><thead><tr><th class="tableblock halign-left valign-top">Nazwa aplikacji</th><th class="tableblock halign-left valign-top">Wykorzystanie zasobów</th><th class="tableblock halign-left valign-top">Instalacja z portów</th><th class="tableblock halign-left valign-top">Główne zależności</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock>KOffice</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>małe</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>długa</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>KDE</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>AbiWord</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>małe</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>krótka</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Gtk+ bądź GNOME</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>The Gimp</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>małe</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>długa</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Gtk+</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>OpenOffice.org</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>duże</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>długa</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>JDK™ 1.4, Mozilla</p></td></tr></tbody></table><div class=sect3><h4 id=_koffice>6.6.1. KOffice<a class=anchor href=#_koffice></a></h4><div class=paragraph><p>Społeczność KDE udostępnia swoje środowisko graficzne wraz z pakietem biurowym, z którego można korzystać zarówno w KDE jak i poza nim. Zawiera cztery standardowe komponenty, które można odnaleźć również w innych pakietach biurowych: procesor tekstu KWord, arkusz kalkulacyjny KSpread, menedżer prezentacji multimedialnych KPresenter oraz program do tworzenia graficznych dokumentów - Kontour.</p></div><div class=paragraph><p>Przed instalacją najnowszej wersji pakietu KOffice, powinniśmy się upewnić, że dysponujemy również najnowszą wersją KDE.</p></div><div class=paragraph><p>By zainstalować KOffice z pakietu, należy wpisać następujące polecenie:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pkg_add -r koffice</span></code></pre></div></div><div class=paragraph><p>Jeśli pakiet nie jest dostępny, możemy wykorzystać kolekcję portów. Na przykład, by zainstalować KOffice dla KDE3, należy wpisać:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/ports/editors/koffice-kde3</span>
<span class=c># make install clean</span></code></pre></div></div></div><div class=sect3><h4 id=_abiword>6.6.2. AbiWord<a class=anchor href=#_abiword></a></h4><div class=paragraph><p>AbiWord jest darmowym procesorem tekstu pod względem wyglądu i obsługi podobnym do Microsoft® Word. Za jego pomocą możemy pisać artykuły, listy, raporty, notatki itp. Jest on bardzo szybki, bogaty w różnorodne funkcje i przyjazny użytkownikowi.</p></div><div class=paragraph><p>AbiWord potrafi importować z i eksportować do wielu formatów plików, w tym również niektórych własnościowych formatów, jak np. Microsoft <span class=filename>.doc</span>.</p></div><div class=paragraph><p>AbiWord dostępny jest w postaci pakietu. By go zainstalować wystarczy wpisać:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pkg_add -r abiword</span></code></pre></div></div><div class=paragraph><p>Jeśli pakiet nie jest dostępny, możemy skompilować program wprost z kolekcji portów:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/ports/editors/abiword</span>
<span class=c># make install clean</span></code></pre></div></div></div><div class=sect3><h4 id=_the_gimp>6.6.3. The GIMP<a class=anchor href=#_the_gimp></a></h4><div class=paragraph><p>The GIMP jest wyrafinowanym programem przetwarzającym obraz. Wykorzystywany może być zarówno jako prosty program malujący jak i zaawansowny pakiet do retuszu fotografii. Obsługuje on dużą liczbę dodatkowych modułów, jak również udostępnia odpowiedni interfejs dla skryptów. The GIMP potrafi odczytywać i zapisywać wiele formatów plików. Obsługuje również interfejsy skanerów i tabletów.</p></div><div class=paragraph><p>Możemy zainstalować go z pakietu, za pomocą polecenia:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pkg_add -r gimp</span></code></pre></div></div><div class=paragraph><p>Jeśli wykorzystywany serwer FTP nie dysponuje odpowiednim pakietem, możemy wykorzystać kolekcję portów. Katalog graphics zawiera oprócz samego programu, również podręcznik The Gimp Manual. Oto przykładowa metoda instalacji:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/ports/graphics/gimp</span>
<span class=c># make install clean</span>
<span class=c># cd /usr/ports/graphics/gimp-manual-pdf</span>
<span class=c># make install clean</span></code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Wspomniany katalog <a href=http://www.freebsd.org/ports/>graphics</a> kolekcji portów zawiera również wersję rozwojową aplikacji The GIMP pod nazwą <a class=package href=https://cgit.freebsd.org/ports/tree/graphics/gimp-devel/>graphics/gimp-devel</a>. Wersja HTML podręcznika The Gimp Manual dostępna jest z portu <a class=package href=https://cgit.freebsd.org/ports/tree/graphics/gimp-manual-html/>graphics/gimp-manual-html</a>.</p></div></td></tr></tbody></table></div></div><div class=sect3><h4 id=_openoffice_org>6.6.4. OpenOffice.org<a class=anchor href=#_openoffice_org></a></h4><div class=paragraph><p>OpenOffice.org zawiera wszystkie aplikacje, które powinny znaleźć się w kompletnym pakiecie biurowym: procesor tekstu, arkusz kalkulacyjny, menedżer prezentacji i program do rysowania. Jego interfejs jest zbliżony do interfejsów innych pakietów biurowych. Może on importować i eksportować wiele popularnych formatów plików. Dostępny jest w wielu wersjach językowych interfejsu, narzędzi sprawdzania pisowni i słowników.</p></div><div class=paragraph><p>Procesor tekstu pakietu OpenOffice.org wykorzystuje format pliku XML, by tym sposobem zwiększyć przenośność i elastyczność dokumentów. Arkusz kalkulacyjny oferuje język makr, jak również obsługę interfejsów do zewnętrznych baz danych. OpenOffice.org jest stabilną aplikacją, dostępną dla platform Windows®, SolarisTM, Linux, FreeBSD, i Mac OS® X. Więcej informacji o pakiecie OpenOffice.org znaleźć można na stronie <a href=http://openoffice.org/>openoffice.org</a>. Informacje odnośnie wersji dla FreeBSD oraz możliwości bezpośredniego pobrania pakietów dostępne są na stronie WWW <a href=http://porting.openoffice.org/freebsd/>FreeBSD OpenOffice.org Porting Team</a>.</p></div><div class=paragraph><p>By zainstalować OpenOffice.org, wystarczy:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pkg_add -r openoffice.org</span></code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Metoda ta przewidzana jest dla wydań FreeBSD gałęzi -RELEASE. W innym przypadku możemy być zmuszeni odwiedzić wspomnianą wyżej stronę WWW FreeBSD OpenOffice.org Porting Team, by pobrać a następnie zainstalować właściwy pakiet za pomocą <a href="https://man.freebsd.org/cgi/man.cgi?query=pkg_add&amp;sektion=1&amp;format=html">pkg_add(1)</a>. Dostępna jest zarówno wersja bieżąca jak i rozwojow</p></div></td></tr></tbody></table></div><div class=paragraph><p>Mając zainstalowany pakiety, wystarczy wpisać następujące polecenie by uruchomić OpenOffice.org:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% openoffice.org</code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Przy pierwszym uruchomieniu będziemy poproszeni o udzielenie kilku odpowiedzi. po czym w naszym katalogu macierzystym zostanie utworzony katalog <span class=filename>.openoffice.org2</span>.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Jeśli pakiety OpenOffice.org nie są dostępne, wciąż mamy możliwość skompilowania portu. Miejmy jednakże w pamięci, że wymaga do dużej ilości wolnej przestrzeni na dysku oraz zajmuje dość dużo czasu.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/ports/editors/openoffice.org-2</span>
<span class=c># make install clean</span></code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Jeśli chcemy skompilować pakiet w naszej wersji językowej, należy powyższe polecenie zastąpić następującym:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># make LOCALIZED_LANG=nasz_język install clean</span></code></pre></div></div><div class=paragraph><p>Opcję <code>nasz_język</code> należy zastąpić właściwym kodem ISO. Lista kodów obsługiwanych języków dostępna jest w pliku <span class=filename>files/Makefile.localized</span>, znajdującym się w katalogu portu.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Skończywszy instalację, możemy uruchomić OpenOffice.org za pomocą polecenia:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% openoffice.org</code></pre></div></div></div></div><div class=sect2><h3 id=desktop-viewers>6.7. Przeglądarki dokumentów<a class=anchor href=#desktop-viewers></a></h3><div class=paragraph><p>Ostatnio na popularności zyskały niektóre z pośród nowych formatów dokumentów, przy czym niezbędne przeglądarki mogą nie być dostępne w podstawowej konfiguracji systemu. W tej sekcji opiszemy jak je zainstalować.</p></div><div class=paragraph><p>Niniejsza sekcja omawia następujące programy:</p></div><table class="tableblock frame-none grid-all stretch informaltable"><col style=width:25%><col style=width:25%><col style=width:25%><col style=width:25%><thead><tr><th class="tableblock halign-left valign-top">Nazwa aplikacji</th><th class="tableblock halign-left valign-top">Wykorzystanie zasobów</th><th class="tableblock halign-left valign-top">Instalacja z portów</th><th class="tableblock halign-left valign-top">Główne zależności</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Acrobat Reader®</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>małe</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>krótka</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Tryb zgodności binarnej z Linuksem</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>gv</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>małe</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>krótka</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Xaw3d</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Xpdf</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>małe</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>krótka</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>FreeType</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>GQview</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>małe</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>krótka</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Gtk+ lub GNOME</p></td></tr></tbody></table><div class=sect3><h4 id=_acrobat_reader>6.7.1. Acrobat Reader®<a class=anchor href=#_acrobat_reader></a></h4><div class=paragraph><p>Obecnie wiele dokumentów publikowanych jest w postaci plików PDF (ang. Portable Document Format). Jedną z zalecanych przeglądarek do tego typu dokumentów jest Acrobat Reader®, wydany przez firmę Adobe na platformę linuksową. We FreeBSD możemy uruchomić ją dzięki trybowi zgodności binarnej z Linuksem.</p></div><div class=paragraph><p>By zainstalować Acrobat Reader® 7 wprost z kolekcji portów, należy wpisać:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/ports/print/acroread7</span>
<span class=c># make install clean</span></code></pre></div></div><div class=paragraph><p>Z uwagi na ograniczenia licencyjne, Acrobat Reader® nie jest dostępny w postaci pakietu.</p></div></div><div class=sect3><h4 id=_gv>6.7.2. gv<a class=anchor href=#_gv></a></h4><div class=paragraph><p>gv jest przeglądarką dokumentów PostScript® i PDF. Bazuje ona bezpośrednio na ghostview, lecz dzięki bibliotece Xaw3d wygląda zdecydowanie lepiej. gv jest szybką przeglądarką o przejrzystym interfejsie. Posiada wiele funkcji, jak np. możliwość ustawienia orientacji tekstu, rozmiaru papieru, skali czy wygładzania czcionek. Prawie każdą czynność można wykonać za pomocą klawiatury bądź myszki.</p></div><div class=paragraph><p>By zainstalować gv z pakietu, wystarczy wpisać:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pkg_add -r gv</span></code></pre></div></div><div class=paragraph><p>Jeśli nie możemy pobrać pakietu, możemy zawsze wykorzystać kolekcję portów:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/ports/print/gv</span>
<span class=c># make install clean</span></code></pre></div></div></div><div class=sect3><h4 id=_xpdf>6.7.3. Xpdf<a class=anchor href=#_xpdf></a></h4><div class=paragraph><p>Jeśli potrzebujemy małej przeglądarki dokumentów PDF, Xpdf stanowi lekkie i wydajne rozwiązanie. Wymaga ona małej ilości zasobów i jest bardzo stabilna. Do pracy wykorzystuje standardowe czcionki X i nie wymaga Motif®, ani żadnego innego pakietu narzędzi X.</p></div><div class=paragraph><p>By zainstalować pakiet Xpdf, należy wykorzystać następujące polecenie:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pkg_add -r xpdf</span></code></pre></div></div><div class=paragraph><p>Jeśli pakiet nie jest dostępny bądź wolimy wykorzystać kolekcję portów, wystarczy wpisać:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/ports/graphics/xpdf</span>
<span class=c># make install clean</span></code></pre></div></div><div class=paragraph><p>Zakończywszy instalację, możemy uruchomić Xpdf. Menu dostępne jest za pomocą prawego przycisku myszki.</p></div></div><div class=sect3><h4 id=_gqview>6.7.4. GQview<a class=anchor href=#_gqview></a></h4><div class=paragraph><p>GQview jest menedżerem i przeglądarką obrazów. Za pomocą jednego kliknięcia możemy przeglądać pliki graficzne, uruchomić zewnętrzny edytor, uzyskać podgląd miniatur i wiele więcej. Mamy również dostęp do trybu pokazu slajdów oraz kilku podstawowych operacji na plikach. Możemy łatwo zarządzać kolekcjami obrazów i odnajdywać powtarzające się pliki. GQview udostępnia również tryb pełnoekranowy oraz obsługę wielu języków.</p></div><div class=paragraph><p>By zainstalować pakiet GQview, wystarczy wpisać:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pkg_add -r gqview</span></code></pre></div></div><div class=paragraph><p>Jeśli pakiet nie jest dostępny bądź wolimy skorzystać z kolekcji portów, możemy wpisać:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/ports/graphics/gqview</span>
<span class=c># make install clean</span></code></pre></div></div></div></div><div class=sect2><h3 id=desktop-finance>6.8. Finanse<a class=anchor href=#desktop-finance></a></h3><div class=paragraph><p>Jeśli z jakiegoś powodu chcielibyśmy zarządzać naszym domowym budżetem we FreeBSD, dostępnych mamy kilka rozbudowanych i łatwych w obsłudze aplikacji. Niektóre z nich są zgodne z szeroko rozpowszechnionymi formatami plików jak np. dokumenty Quicken czy Excel.</p></div><div class=paragraph><p>Sekcja ta omawia następujące aplikacje:</p></div><table class="tableblock frame-none grid-all stretch informaltable"><col style=width:25%><col style=width:25%><col style=width:25%><col style=width:25%><thead><tr><th class="tableblock halign-left valign-top">Nazwa aplikacji</th><th class="tableblock halign-left valign-top">Wykorzystanie zasobów</th><th class="tableblock halign-left valign-top">Instalacja z portów</th><th class="tableblock halign-left valign-top">Główne zależności</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock>GnuCash</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>małe</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>długa</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>GNOME</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Gnumeric</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>małe</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>długa</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>GNOME</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Abacus</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>małe</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>krótka</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Tcl/Tk</p></td></tr></tbody></table><div class=sect3><h4 id=_gnucash>6.8.1. GnuCash<a class=anchor href=#_gnucash></a></h4><div class=paragraph><p>GnuCash jest efektem usilnych starań środowiska GNOME by dostarczać końcowym użytkownikom przyjazne i rozbudowane aplikacje. Za pomocą GnuCash możemy śledzić nasze przychody i wydatki, stan konta bankowego czy papierów wartościowych. Posiada on intuicyjny interfejs pozostając wciąż zaawansowanym narzędziem.</p></div><div class=paragraph><p>GnuCash zawiera inteligentny rejestr, hierarchiczny system kont, wiele skrótów klawiaturowych i metody autouzupełniania wprowadzanych danych. Umożliwia rozbicie pojedynczych transakcji na kilka bardziej szczegółowych części. GnuCash potrafi także importować i dołączać dane z plików QIF programu Quicken. Obsługuje również większość międzynarodowych formatów dat i waluty.</p></div><div class=paragraph><p>By zainstalować GnuCash należy wpisać:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pkg_add -r gnucash</span></code></pre></div></div><div class=paragraph><p>Jeśli pakiet nie jest dostępny, możemy wykorzystać kolekcję portów:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/ports/finance/gnucash</span>
<span class=c># make install clean</span></code></pre></div></div></div><div class=sect3><h4 id=_gnumeric>6.8.2. Gnumeric<a class=anchor href=#_gnumeric></a></h4><div class=paragraph><p>Gnumeric jest arkuszem kalkulacyjnym, dostępnym jako część środowiska GNOME. Dysponuje wygodnym systemem automatycznego "zgadywania" wprowadzanych danych zależnie od formatu komórki oraz automatycznego uzupełniania różnych sekwencji. Potrafi importować pliki z wielu popularnych formatów, jak np. Excel, Lotus 1-2-3 lub Quattro Pro. Gnumeric pozwala również na kreślenie grafów za pomocą program <a class=package href=https://cgit.freebsd.org/ports/tree/math/guppi/>math/guppi</a>. Ponadto, posiada on wiele wbudowanych funkcji oraz wszystkie typowe formaty komórek jak liczby, waluty, daty, czas i wiele innych.</p></div><div class=paragraph><p>By zainstalować Gnumeric z pakietu, należy wpisać:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pkg_add -r gnumeric</span></code></pre></div></div><div class=paragraph><p>Jeśli pakiet nie jest dostępny, możemy skorzystać z kolekcji portów:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/ports/math/gnumeric</span>
<span class=c># make install clean</span></code></pre></div></div></div><div class=sect3><h4 id=_abacus>6.8.3. Abacus<a class=anchor href=#_abacus></a></h4><div class=paragraph><p>Abacus jest małym i prostym w użyciu arkuszem kalkulacyjnym. Zawiera on wiele wbudowanych funkcji przydatnych w takich dziedzinach jak statystyka, finanse czy matematyka. Potrafi importować z- i eksportować do formatu plików Excel, jak również przygotować pliki PostScript®.</p></div><div class=paragraph><p>By zainstalować Abacus z pakietu, należy:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pkg_add -r abacus</span></code></pre></div></div><div class=paragraph><p>Jeśli pakiet nie jest dostępny, możemy wykorzystać kolekcję portów:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/ports/deskutils/abacus</span>
<span class=c># make install clean</span></code></pre></div></div></div></div><div class=sect2><h3 id=desktop-summary>6.9. Podsumowanie<a class=anchor href=#desktop-summary></a></h3><div class=paragraph><p>O ile FreeBSD jest popularnym systemem operacyjnym przede wszystkim wśród dostawców usług internetowych, ze względu na swą wydajność i stabilność, o tyle jest on już gotowy do codziennego użytku jako system biurkowy. Dzięki dostępności kilku tysięcy aplikacji w postaci pakietów bądź portów, możemy przygotować doskonałe środowisko pracy, w pełni odpowiadające naszym potrzebom.</p></div><div class=paragraph><p>Mając już zainstalowany system możemy zrobić o jeden krok dalej i wykorzystać misc/instant-workstation. Ten "meta-port" pozwala nam skompilować typowy zestaw portów wykorzystywanych w stacjach roboczych. Możemy dopasować go do własnych potrzeb modyfikując plik <span class=filename>/usr/ports/misc/instant-workstation/Makefile</span>. Przy dodawaniu i usuwaniu portów należy zachować składnię pliku przedstawioną w domyślnej konfiguracji. Ostatecznie kompilacja przebiega według standardowej procedury. W ten sposób będziemy w stanie przygotować duży pakiet odpowiadający naszemu własnemu środowisku pracy i instalować go na innych stacjach roboczych!</p></div><div class=paragraph><p>Poniżej znajduje się krótka charakterystyka wszystkich aplikacji biurowych omówionych w tym rozdziale:</p></div><table class="tableblock frame-none grid-all stretch informaltable"><col style=width:33.3333%><col style=width:33.3333%><col style=width:33.3334%><thead><tr><th class="tableblock halign-left valign-top">Nazwa aplikacji</th><th class="tableblock halign-left valign-top">Nazwa pakietu</th><th class="tableblock halign-left valign-top">Nazwa portu</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Mozilla</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>mozilla</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><a class=package href=https://cgit.freebsd.org/ports/tree/www/mozilla/>www/mozilla</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Opera</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>opera</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><a class=package href=https://cgit.freebsd.org/ports/tree/www/opera/>www/opera</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Firefox</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>firefox</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><a class=package href=https://cgit.freebsd.org/ports/tree/www/firefox/>www/firefox</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>KOffice</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>koffice-kde3</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><a class=package href=https://cgit.freebsd.org/ports/tree/editors/koffice-kde3/>editors/koffice-kde3</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>AbiWord</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>abiword</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><a class=package href=https://cgit.freebsd.org/ports/tree/editors/abiword/>editors/abiword</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>The GIMP</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>gimp</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><a class=package href=https://cgit.freebsd.org/ports/tree/graphics/gimp/>graphics/gimp</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>OpenOffice.org</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>openoffice</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><a class=package href=https://cgit.freebsd.org/ports/tree/editors/openoffice-1.1/>editors/openoffice-1.1</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Acrobat Reader®</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>acroread</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><a class=package href=https://cgit.freebsd.org/ports/tree/print/acroread7/>print/acroread7</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>gv</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>gv</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><a class=package href=https://cgit.freebsd.org/ports/tree/print/gv/>print/gv</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Xpdf</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>xpdf</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><a class=package href=https://cgit.freebsd.org/ports/tree/graphics/xpdf/>graphics/xpdf</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>GQview</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>gqview</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><a class=package href=https://cgit.freebsd.org/ports/tree/graphics/gqview/>graphics/gqview</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>GnuCash</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>gnucash</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><a class=package href=https://cgit.freebsd.org/ports/tree/finance/gnucash/>finance/gnucash</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Gnumeric</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>gnumeric</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><a class=package href=https://cgit.freebsd.org/ports/tree/math/gnumeric/>math/gnumeric</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Abacus</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>abacus</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><a class=package href=https://cgit.freebsd.org/ports/tree/deskutils/abacus/>deskutils/abacus</a></p></td></tr></tbody></table></div></div></div><div class=sect1><h2 id=multimedia>Rozdział 7. Multimedia<a class=anchor href=#multimedia></a></h2><div class=sectionbody><div class=sect2><h3 id=multimedia-synopsis>7.1. Synopsis<a class=anchor href=#multimedia-synopsis></a></h3><div class=paragraph><p>FreeBSD supports a wide variety of sound cards, allowing users to enjoy high fidelity output from a FreeBSD system. This includes the ability to record and play back audio in the MPEG Audio Layer 3 (<code>MP3</code>), Waveform Audio File (<code>WAV</code>), Ogg Vorbis, and other formats. The FreeBSD Ports Collection contains many applications for editing recorded audio, adding sound effects, and controlling attached MIDI devices.</p></div><div class=paragraph><p>FreeBSD also supports the playback of video files and <code>DVD</code>s. The FreeBSD Ports Collection contains applications to encode, convert, and playback various video media.</p></div><div class=paragraph><p>This chapter describes how to configure sound cards, video playback, TV tuner cards, and scanners on FreeBSD. It also describes some of the applications which are available for using these devices.</p></div><div class=paragraph><p>After reading this chapter, you will know how to:</p></div><div class=ulist><ul><li><p>Configure a sound card on FreeBSD.</p></li><li><p>Troubleshoot the sound setup.</p></li><li><p>Playback and encode MP3s and other audio.</p></li><li><p>Prepare a FreeBSD system for video playback.</p></li><li><p>Play <code>DVD</code>s, <span class=filename>.mpg</span>, and <span class=filename>.avi</span> files.</p></li><li><p>Rip <code>CD</code> and <code>DVD</code> content into files.</p></li><li><p>Configure a TV card.</p></li><li><p>Install and setup MythTV on FreeBSD</p></li><li><p>Configure an image scanner.</p></li><li><p>Configure a Bluetooth headset.</p></li></ul></div><div class=paragraph><p>Before reading this chapter, you should:</p></div><div class=ulist><ul><li><p>Know how to install applications as described in <a href=./#ports>Installing Applications: Packages and Ports</a>.</p></li></ul></div></div><div class=sect2><h3 id=sound-setup>7.2. Setting Up the Sound Card<a class=anchor href=#sound-setup></a></h3><div class=paragraph><p>Before beginning the configuration, determine the model of the sound card and the chip it uses. FreeBSD supports a wide variety of sound cards. Check the supported audio devices list of the <a href=https://www.FreeBSD.org/releases/12.0R/hardware/>Hardware Notes</a> to see if the card is supported and which FreeBSD driver it uses.</p></div><div class=paragraph><p>In order to use the sound device, its device driver must be loaded. The easiest way is to load a kernel module for the sound card with <a href="https://man.freebsd.org/cgi/man.cgi?query=kldload&amp;sektion=8&amp;format=html">kldload(8)</a>. This example loads the driver for a built-in audio chipset based on the Intel specification:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># kldload snd_hda</span></code></pre></div></div><div class=paragraph><p>To automate the loading of this driver at boot time, add the driver to <span class=filename>/boot/loader.conf</span>. The line for this driver is:</p></div><div class="literalblock programlisting"><div class=content><pre>snd_hda_load=&#34;YES&#34;</pre></div></div><div class=paragraph><p>Other available sound modules are listed in <span class=filename>/boot/defaults/loader.conf</span>. When unsure which driver to use, load the <span class=filename>snd_driver</span> module:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># kldload snd_driver</span></code></pre></div></div><div class=paragraph><p>This is a metadriver which loads all of the most common sound drivers and can be used to speed up the search for the correct driver. It is also possible to load all sound drivers by adding the metadriver to <span class=filename>/boot/loader.conf</span>.</p></div><div class=paragraph><p>To determine which driver was selected for the sound card after loading the <span class=filename>snd_driver</span> metadriver, type <code>cat /dev/sndstat</code>.</p></div><div class=sect3><h4 id=_configuring_a_custom_kernel_with_sound_support>7.2.1. Configuring a Custom Kernel with Sound Support<a class=anchor href=#_configuring_a_custom_kernel_with_sound_support></a></h4><div class=paragraph><p>This section is for users who prefer to statically compile in support for the sound card in a custom kernel. For more information about recompiling a kernel, refer to <a href=./#kernelconfig>Configuring the FreeBSD Kernel</a>.</p></div><div class=paragraph><p>When using a custom kernel to provide sound support, make sure that the audio framework driver exists in the custom kernel configuration file:</p></div><div class="literalblock programlisting"><div class=content><pre>device sound</pre></div></div><div class=paragraph><p>Next, add support for the sound card. To continue the example of the built-in audio chipset based on the Intel specification from the previous section, use the following line in the custom kernel configuration file:</p></div><div class="literalblock programlisting"><div class=content><pre>device snd_hda</pre></div></div><div class=paragraph><p>Be sure to read the manual page of the driver for the device name to use for the driver.</p></div><div class=paragraph><p>Non-PnP ISA sound cards may require the IRQ and I/O port settings of the card to be added to <span class=filename>/boot/device.hints</span>. During the boot process, <a href="https://man.freebsd.org/cgi/man.cgi?query=loader&amp;sektion=8&amp;format=html">loader(8)</a> reads this file and passes the settings to the kernel. For example, an old Creative SoundBlaster® 16 ISA non-PnP card will use the <a href="https://man.freebsd.org/cgi/man.cgi?query=snd_sbc&amp;sektion=4&amp;format=html">snd_sbc(4)</a> driver in conjunction with <code>snd_sb16</code>. For this card, the following lines must be added to the kernel configuration file:</p></div><div class="literalblock programlisting"><div class=content><pre>device snd_sbc
device snd_sb16</pre></div></div><div class=paragraph><p>If the card uses the <code>0x220</code> I/O port and IRQ <code>5</code>, these lines must also be added to <span class=filename>/boot/device.hints</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>hint.sbc.0.at=&#34;isa&#34;
hint.sbc.0.port=&#34;0x220&#34;
hint.sbc.0.irq=&#34;5&#34;
hint.sbc.0.drq=&#34;1&#34;
hint.sbc.0.flags=&#34;0x15&#34;</pre></div></div><div class=paragraph><p>The syntax used in <span class=filename>/boot/device.hints</span> is described in <a href="https://man.freebsd.org/cgi/man.cgi?query=sound&amp;sektion=4&amp;format=html">sound(4)</a> and the manual page for the driver of the sound card.</p></div><div class=paragraph><p>The settings shown above are the defaults. In some cases, the IRQ or other settings may need to be changed to match the card. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=snd_sbc&amp;sektion=4&amp;format=html">snd_sbc(4)</a> for more information about this card.</p></div></div><div class=sect3><h4 id=sound-testing>7.2.2. Testing Sound<a class=anchor href=#sound-testing></a></h4><div class=paragraph><p>After loading the required module or rebooting into the custom kernel, the sound card should be detected. To confirm, run <code>dmesg | grep pcm</code>. This example is from a system with a built-in Conexant CX20590 chipset:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>pcm0: &lt;NVIDIA <span class=o>(</span>0x001c<span class=o>)</span> <span class=o>(</span>HDMI/DP 8ch<span class=o>)&gt;</span> at nid 5 on hdaa0
pcm1: &lt;NVIDIA <span class=o>(</span>0x001c<span class=o>)</span> <span class=o>(</span>HDMI/DP 8ch<span class=o>)&gt;</span> at nid 6 on hdaa0
pcm2: &lt;Conexant CX20590 <span class=o>(</span>Analog 2.0+HP/2.0<span class=o>)&gt;</span> at nid 31,25 and 35,27 on hdaa1</code></pre></div></div><div class=paragraph><p>The status of the sound card may also be checked using this command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cat /dev/sndstat</span>
FreeBSD Audio Driver <span class=o>(</span>newpcm: 64bit 2009061500/amd64<span class=o>)</span>
Installed devices:
pcm0: &lt;NVIDIA <span class=o>(</span>0x001c<span class=o>)</span> <span class=o>(</span>HDMI/DP 8ch<span class=o>)&gt;</span> <span class=o>(</span>play<span class=o>)</span>
pcm1: &lt;NVIDIA <span class=o>(</span>0x001c<span class=o>)</span> <span class=o>(</span>HDMI/DP 8ch<span class=o>)&gt;</span> <span class=o>(</span>play<span class=o>)</span>
pcm2: &lt;Conexant CX20590 <span class=o>(</span>Analog 2.0+HP/2.0<span class=o>)&gt;</span> <span class=o>(</span>play/rec<span class=o>)</span> default</code></pre></div></div><div class=paragraph><p>The output will vary depending upon the sound card. If no <span class=filename>pcm</span> devices are listed, double-check that the correct device driver was loaded or compiled into the kernel. The next section lists some common problems and their solutions.</p></div><div class=paragraph><p>If all goes well, the sound card should now work in FreeBSD. If the <code>CD</code> or <code>DVD</code> drive is properly connected to the sound card, one can insert an audio <code>CD</code> in the drive and play it with <a href="https://man.freebsd.org/cgi/man.cgi?query=cdcontrol&amp;sektion=1&amp;format=html">cdcontrol(1)</a>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% cdcontrol <span class=nt>-f</span> /dev/acd0 play 1</code></pre></div></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>Audio <code>CD</code>s have specialized encodings which means that they should not be mounted using <a href="https://man.freebsd.org/cgi/man.cgi?query=mount&amp;sektion=8&amp;format=html">mount(8)</a>.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Various applications, such as <a class=package href=https://cgit.freebsd.org/ports/tree/audio/workman/>audio/workman</a>, provide a friendlier interface. The <a class=package href=https://cgit.freebsd.org/ports/tree/audio/mpg123/>audio/mpg123</a> port can be installed to listen to MP3 audio files.</p></div><div class=paragraph><p>Another quick way to test the card is to send data to <span class=filename>/dev/dsp</span>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% <span class=nb>cat </span>filename <span class=o>&gt;</span> /dev/dsp</code></pre></div></div><div class=paragraph><p>where <span class=filename>filename</span> can be any type of file. This command should produce some noise, confirming that the sound card is working.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>The <span class=filename>/dev/dsp*</span> device nodes will be created automatically as needed. When not in use, they do not exist and will not appear in the output of <a href="https://man.freebsd.org/cgi/man.cgi?query=ls&amp;sektion=1&amp;format=html">ls(1)</a>.</p></div></td></tr></tbody></table></div></div><div class=sect3><h4 id=bluetooth-headset>7.2.3. Setting up Bluetooth Sound Devices<a class=anchor href=#bluetooth-headset></a></h4><div class=paragraph><p>Connecting to a Bluetooth device is out of scope for this chapter. Refer to <a href=./#network-bluetooth>“Bluetooth”</a> for more information.</p></div><div class=paragraph><p>To get Bluetooth sound sink working with FreeBSD’s sound system, users have to install <a class=package href=https://cgit.freebsd.org/ports/tree/audio/virtual_oss/>audio/virtual_oss</a> first:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pkg install virtual_oss</span></code></pre></div></div><div class=paragraph><p><a class=package href=https://cgit.freebsd.org/ports/tree/audio/virtual_oss/>audio/virtual_oss</a> requires <code>cuse</code> to be loaded into the kernel:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># kldload cuse</span></code></pre></div></div><div class=paragraph><p>To load <code>cuse</code> during system startup, run this command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sysrc -f /boot/loader.conf cuse_load=yes</span></code></pre></div></div><div class=paragraph><p>To use headphones as a sound sink with <a class=package href=https://cgit.freebsd.org/ports/tree/audio/virtual_oss/>audio/virtual_oss</a>, users need to create a virtual device after connecting to a Bluetooth audio device:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># virtual_oss -C 2 -c 2 -r 48000 -b 16 -s 768 -R /dev/null -P /dev/bluetooth/headphones -d dsp</span></code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p><em>headphones</em> in this example is a hostname from <span class=filename>/etc/bluetooth/hosts</span>. <code>BT_ADDR</code> could be used instead.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=virtual_oss&amp;sektion=8&amp;format=html">virtual_oss(8)</a> for more information.</p></div></div><div class=sect3><h4 id=troubleshooting>7.2.4. Troubleshooting Sound<a class=anchor href=#troubleshooting></a></h4><div class=paragraph><p><a href=#multimedia-sound-common-error-messages>Common Error Messages</a> lists some common error messages and their solutions:</p></div><table id=multimedia-sound-common-error-messages class="tableblock frame-none grid-all stretch"><caption class=title>Tabela 8. Common Error Messages</caption><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">Error</th><th class="tableblock halign-left valign-top">Solution</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>sb_dspwr(XX) timed out</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>The I/O port is not set correctly.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>bad irq XX</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>The IRQ is set incorrectly. Make sure that the set IRQ and the sound IRQ are the same.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>xxx: gus pcm not attached, out of memory</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>There is not enough available memory to use the device.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>xxx: can’t open /dev/dsp!</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Type <code>fstat | grep</code> dsp to check if another application is holding the device open. Noteworthy troublemakers are esound and KDE’s sound support.</p></td></tr></tbody></table><div class=paragraph><p>Modern graphics cards often come with their own sound driver for use with <code>HDMI</code>. This sound device is sometimes enumerated before the sound card meaning that the sound card will not be used as the default playback device. To check if this is the case, run dmesg and look for <code>pcm</code>. The output looks something like this:</p></div><div class="literalblock programlisting"><div class=content><pre>...
hdac0: HDA Driver Revision: 20100226_0142
hdac1: HDA Driver Revision: 20100226_0142
hdac0: HDA Codec #0: NVidia (Unknown)
hdac0: HDA Codec #1: NVidia (Unknown)
hdac0: HDA Codec #2: NVidia (Unknown)
hdac0: HDA Codec #3: NVidia (Unknown)
pcm0: &lt;HDA NVidia (Unknown) PCM #0 DisplayPort&gt; at cad 0 nid 1 on hdac0
pcm1: &lt;HDA NVidia (Unknown) PCM #0 DisplayPort&gt; at cad 1 nid 1 on hdac0
pcm2: &lt;HDA NVidia (Unknown) PCM #0 DisplayPort&gt; at cad 2 nid 1 on hdac0
pcm3: &lt;HDA NVidia (Unknown) PCM #0 DisplayPort&gt; at cad 3 nid 1 on hdac0
hdac1: HDA Codec #2: Realtek ALC889
pcm4: &lt;HDA Realtek ALC889 PCM #0 Analog&gt; at cad 2 nid 1 on hdac1
pcm5: &lt;HDA Realtek ALC889 PCM #1 Analog&gt; at cad 2 nid 1 on hdac1
pcm6: &lt;HDA Realtek ALC889 PCM #2 Digital&gt; at cad 2 nid 1 on hdac1
pcm7: &lt;HDA Realtek ALC889 PCM #3 Digital&gt; at cad 2 nid 1 on hdac1
...</pre></div></div><div class=paragraph><p>In this example, the graphics card (<code>NVidia</code>) has been enumerated before the sound card (<code>Realtek ALC889</code>). To use the sound card as the default playback device, change <code>hw.snd.default_unit</code> to the unit that should be used for playback:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sysctl hw.snd.default_unit=n</span></code></pre></div></div><div class=paragraph><p>where <code>n</code> is the number of the sound device to use. In this example, it should be <code>4</code>. Make this change permanent by adding the following line to <span class=filename>/etc/sysctl.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>hw.snd.default_unit=4</pre></div></div></div><div class=sect3><h4 id=sound-multiple-sources>7.2.5. Utilizing Multiple Sound Sources<a class=anchor href=#sound-multiple-sources></a></h4><div class=paragraph><p>It is often desirable to have multiple sources of sound that are able to play simultaneously. FreeBSD uses "Virtual Sound Channels" to multiplex the sound card’s playback by mixing sound in the kernel.</p></div><div class=paragraph><p>Three <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a> knobs are available for configuring virtual channels:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sysctl dev.pcm.0.play.vchans=4</span>
<span class=c># sysctl dev.pcm.0.rec.vchans=4</span>
<span class=c># sysctl hw.snd.maxautovchans=4</span></code></pre></div></div><div class=paragraph><p>This example allocates four virtual channels, which is a practical number for everyday use. Both <code>dev.pcm.0.play.vchans=4</code> and <code>dev.pcm.0.rec.vchans=4</code> are configurable after a device has been attached and represent the number of virtual channels <span class=filename>pcm0</span> has for playback and recording. Since the <span class=filename>pcm</span> module can be loaded independently of the hardware drivers, <code>hw.snd.maxautovchans</code> indicates how many virtual channels will be given to an audio device when it is attached. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=pcm&amp;sektion=4&amp;format=html">pcm(4)</a> for more information.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>The number of virtual channels for a device cannot be changed while it is in use. First, close any programs using the device, such as music players or sound daemons.</p></div></td></tr></tbody></table></div><div class=paragraph><p>The correct <span class=filename>pcm</span> device will automatically be allocated transparently to a program that requests <span class=filename>/dev/dsp0</span>.</p></div></div><div class=sect3><h4 id=_setting_default_values_for_mixer_channels>7.2.6. Setting Default Values for Mixer Channels<a class=anchor href=#_setting_default_values_for_mixer_channels></a></h4><div class=paragraph><p>The default values for the different mixer channels are hardcoded in the source code of the <a href="https://man.freebsd.org/cgi/man.cgi?query=pcm&amp;sektion=4&amp;format=html">pcm(4)</a> driver. While sound card mixer levels can be changed using <a href="https://man.freebsd.org/cgi/man.cgi?query=mixer&amp;sektion=8&amp;format=html">mixer(8)</a> or third-party applications and daemons, this is not a permanent solution. To instead set default mixer values at the driver level, define the appropriate values in <span class=filename>/boot/device.hints</span>, as seen in this example:</p></div><div class="literalblock programlisting"><div class=content><pre>hint.pcm.0.vol=&#34;50&#34;</pre></div></div><div class=paragraph><p>This will set the volume channel to a default value of <code>50</code> when the <a href="https://man.freebsd.org/cgi/man.cgi?query=pcm&amp;sektion=4&amp;format=html">pcm(4)</a> module is loaded.</p></div></div></div><div class=sect2><h3 id=sound-mp3>7.3. MP3 Audio<a class=anchor href=#sound-mp3></a></h3><div class=paragraph><p>This section describes some <code>MP3</code> players available for FreeBSD, how to rip audio <code>CD</code> tracks, and how to encode and decode <code>MP3</code>s.</p></div><div class=sect3><h4 id=mp3-players>7.3.1. MP3 Players<a class=anchor href=#mp3-players></a></h4><div class=paragraph><p>A popular graphical <code>MP3</code> player is Audacious. It supports Winamp skins and additional plugins. The interface is intuitive, with a playlist, graphic equalizer, and more. Those familiar with Winamp will find Audacious simple to use. On FreeBSD, Audacious can be installed from the <a class=package href=https://cgit.freebsd.org/ports/tree/multimedia/audacious/>multimedia/audacious</a> port or package. Audacious is a descendant of XMMS.</p></div><div class=paragraph><p>The <a class=package href=https://cgit.freebsd.org/ports/tree/audio/mpg123/>audio/mpg123</a> package or port provides an alternative, command-line <code>MP3</code> player. Once installed, specify the <code>MP3</code> file to play on the command line. If the system has multiple audio devices, the sound device can also be specified:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mpg123 -a /dev/dsp1.0 Foobar-GreatestHits.mp3</span>
High Performance MPEG 1.0/2.0/2.5 Audio Player <span class=k>for </span>Layers 1, 2 and 3
        version 1.18.1<span class=p>;</span> written and copyright by Michael Hipp and others
        free software <span class=o>(</span>LGPL<span class=o>)</span> without any warranty but with best wishes

Playing MPEG stream from Foobar-GreatestHits.mp3 ...
MPEG 1.0 layer III, 128 kbit/s, 44100 Hz joint-stereo</code></pre></div></div><div class=paragraph><p>Additional <code>MP3</code> players are available in the FreeBSD Ports Collection.</p></div></div><div class=sect3><h4 id=rip-cd>7.3.2. Ripping <code>CD</code> Audio Tracks<a class=anchor href=#rip-cd></a></h4><div class=paragraph><p>Before encoding a <code>CD</code> or <code>CD</code> track to <code>MP3</code>, the audio data on the <code>CD</code> must be ripped to the hard drive. This is done by copying the raw <code>CD</code> Digital Audio (<code>CDDA</code>) data to <code>WAV</code> files.</p></div><div class=paragraph><p>The <code>cdda2wav</code> tool, which is installed with the <a class=package href=https://cgit.freebsd.org/ports/tree/sysutils/cdrtools/>sysutils/cdrtools</a> suite, can be used to rip audio information from <code>CD</code>s.</p></div><div class=paragraph><p>With the audio <code>CD</code> in the drive, the following command can be issued as <code>root</code> to rip an entire <code>CD</code> into individual, per track, <code>WAV</code> files:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cdda2wav -D 0,1,0 -B</span></code></pre></div></div><div class=paragraph><p>In this example, the <code>-D <em>0,1,0</em></code> indicates the <code>SCSI</code> device <span class=filename>0,1,0</span> containing the <code>CD</code> to rip. Use <code>cdrecord -scanbus</code> to determine the correct device parameters for the system.</p></div><div class=paragraph><p>To rip individual tracks, use <code>-t</code> to specify the track:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cdda2wav -D 0,1,0 -t 7</span></code></pre></div></div><div class=paragraph><p>To rip a range of tracks, such as track one to seven, specify a range:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cdda2wav -D 0,1,0 -t 1+7</span></code></pre></div></div><div class=paragraph><p>To rip from an <code>ATAPI</code> (<code>IDE</code>) <code>CDROM</code> drive, specify the device name in place of the <code>SCSI</code> unit numbers. For example, to rip track 7 from an IDE drive:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cdda2wav -D /dev/acd0 -t 7</span></code></pre></div></div><div class=paragraph><p>Alternately, <code>dd</code> can be used to extract audio tracks on <code>ATAPI</code> drives, as described in <a href=./#duplicating-audiocds>“Duplicating Audio CDs”</a>.</p></div></div><div class=sect3><h4 id=mp3-encoding>7.3.3. Encoding and Decoding MP3s<a class=anchor href=#mp3-encoding></a></h4><div class=paragraph><p>Lame is a popular <code>MP3</code> encoder which can be installed from the <a class=package href=https://cgit.freebsd.org/ports/tree/audio/lame/>audio/lame</a> port. Due to patent issues, a package is not available.</p></div><div class=paragraph><p>The following command will convert the ripped <code>WAV</code> file <span class=filename>audio01.wav</span> to <span class=filename>audio01.mp3</span>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># lame -h -b 128 --tt &#34;Foo Song Title&#34; --ta &#34;FooBar Artist&#34; --tl &#34;FooBar Album&#34; \</span>
<span class=nt>--ty</span> <span class=s2>&#34;2014&#34;</span> <span class=nt>--tc</span> <span class=s2>&#34;Ripped and encoded by Foo&#34;</span> <span class=nt>--tg</span> <span class=s2>&#34;Genre&#34;</span> audio01.wav audio01.mp3</code></pre></div></div><div class=paragraph><p>The specified 128 kbits is a standard <code>MP3</code> bitrate while the 160 and 192 bitrates provide higher quality. The higher the bitrate, the larger the size of the resulting <code>MP3</code>. The <code>-h</code> turns on the "higher quality but a little slower" mode. The options beginning with <code>--t</code> indicate <code>ID3</code> tags, which usually contain song information, to be embedded within the <code>MP3</code> file. Additional encoding options can be found in the lame manual page.</p></div><div class=paragraph><p>In order to burn an audio <code>CD</code> from <code>MP3</code>s, they must first be converted to a non-compressed file format. XMMS can be used to convert to the <code>WAV</code> format, while mpg123 can be used to convert to the raw Pulse-Code Modulation (<code>PCM</code>) audio data format.</p></div><div class=paragraph><p>To convert <span class=filename>audio01.mp3</span> using mpg123, specify the name of the <code>PCM</code> file:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mpg123 -s audio01.mp3 &gt; audio01.pcm</span></code></pre></div></div><div class=paragraph><p>To use XMMS to convert a <code>MP3</code> to <code>WAV</code> format, use these steps:</p></div><div class="olist arabic procedure"><div class=title>Procedure: Converting to <code>WAV</code> Format in XMMS</div><ol class=arabic><li><p>Launch XMMS.</p></li><li><p>Right-click the window to bring up the XMMS menu.</p></li><li><p>Select <code>Preferences</code> under <code>Options</code>.</p></li><li><p>Change the Output Plugin to "Disk Writer Plugin".</p></li><li><p>Press <code>Configure</code>.</p></li><li><p>Enter or browse to a directory to write the uncompressed files to.</p></li><li><p>Load the <code>MP3</code> file into XMMS as usual, with volume at 100% and EQ settings turned off.</p></li><li><p>Press <code>Play</code>. The XMMS will appear as if it is playing the <code>MP3</code>, but no music will be heard. It is actually playing the <code>MP3</code> to a file.</p></li><li><p>When finished, be sure to set the default Output Plugin back to what it was before in order to listen to <code>MP3</code>s again.</p></li></ol></div><div class=paragraph><p>Both the <code>WAV</code> and <code>PCM</code> formats can be used with cdrecord. When using <code>WAV</code> files, there will be a small tick sound at the beginning of each track. This sound is the header of the <code>WAV</code> file. The <a class=package href=https://cgit.freebsd.org/ports/tree/audio/sox/>audio/sox</a> port or package can be used to remove the header:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% sox <span class=nt>-t</span> wav <span class=nt>-r</span> 44100 <span class=nt>-s</span> <span class=nt>-w</span> <span class=nt>-c</span> 2 track.wav track.raw</code></pre></div></div><div class=paragraph><p>Refer to <a href=./#creating-cds>“Creating and Using CD Media”</a> for more information on using a <code>CD</code> burner in FreeBSD.</p></div></div></div><div class=sect2><h3 id=video-playback>7.4. Video Playback<a class=anchor href=#video-playback></a></h3><div class=paragraph><p>Before configuring video playback, determine the model and chipset of the video card. While Xorg supports a wide variety of video cards, not all provide good playback performance. To obtain a list of extensions supported by the Xorg server using the card, run <code>xdpyinfo</code> while Xorg is running.</p></div><div class=paragraph><p>It is a good idea to have a short MPEG test file for evaluating various players and options. Since some <code>DVD</code> applications look for <code>DVD</code> media in <span class=filename>/dev/dvd</span> by default, or have this device name hardcoded in them, it might be useful to make a symbolic link to the proper device:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ln -sf /dev/cd0 /dev/dvd</span></code></pre></div></div><div class=paragraph><p>Due to the nature of <a href="https://man.freebsd.org/cgi/man.cgi?query=devfs&amp;sektion=5&amp;format=html">devfs(5)</a>, manually created links will not persist after a system reboot. In order to recreate the symbolic link automatically when the system boots, add the following line to <span class=filename>/etc/devfs.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>link cd0 dvd</pre></div></div><div class=paragraph><p><code>DVD</code> decryption invokes certain functions that require write permission to the <code>DVD</code> device.</p></div><div class=paragraph><p>To enhance the shared memory Xorg interface, it is recommended to increase the values of these <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a> variables:</p></div><div class="literalblock programlisting"><div class=content><pre>kern.ipc.shmmax=67108864
kern.ipc.shmall=32768</pre></div></div><div class=sect3><h4 id=video-interface>7.4.1. Determining Video Capabilities<a class=anchor href=#video-interface></a></h4><div class=paragraph><p>There are several possible ways to display video under Xorg and what works is largely hardware dependent. Each method described below will have varying quality across different hardware.</p></div><div class=paragraph><p>Common video interfaces include:</p></div><div class="olist arabic"><ol class=arabic><li><p>Xorg: normal output using shared memory.</p></li><li><p>XVideo: an extension to the Xorg interface which allows video to be directly displayed in drawable objects through a special acceleration. This extension provides good quality playback even on low-end machines. The next section describes how to determine if this extension is running.</p></li><li><p><code>SDL</code>: the Simple Directmedia Layer is a porting layer for many operating systems, allowing cross-platform applications to be developed which make efficient use of sound and graphics. <code>SDL</code> provides a low-level abstraction to the hardware which can sometimes be more efficient than the Xorg interface. On FreeBSD, <code>SDL</code> can be installed using the <a class=package href=https://cgit.freebsd.org/ports/tree/devel/sdl20/>devel/sdl20</a> package or port.</p></li><li><p><code>DGA</code>: the Direct Graphics Access is an Xorg extension which allows a program to bypass the Xorg server and directly alter the framebuffer. Because it relies on a low level memory mapping, programs using it must be run as <code>root</code>. The <code>DGA</code> extension can be tested and benchmarked using <a href="https://man.freebsd.org/cgi/man.cgi?query=dga&amp;sektion=1&amp;format=html">dga(1)</a>. When <code>dga</code> is running, it changes the colors of the display whenever a key is pressed. To quit, press <kbd>q</kbd>.</p></li><li><p>SVGAlib: a low level console graphics layer.</p></li></ol></div><div class=sect4><h5 id=video-interface-xvideo>7.4.1.1. XVideo<a class=anchor href=#video-interface-xvideo></a></h5><div class=paragraph><p>To check whether this extension is running, use <code>xvinfo</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% xvinfo</code></pre></div></div><div class=paragraph><p>XVideo is supported for the card if the result is similar to:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>X-Video Extension version 2.2
  screen <span class=c>#0</span>
  Adaptor <span class=c>#0: &#34;Savage Streams Engine&#34;</span>
    number of ports: 1
    port base: 43
    operations supported: PutImage
    supported visuals:
      depth 16, visualID 0x22
      depth 16, visualID 0x23
    number of attributes: 5
      <span class=s2>&#34;XV_COLORKEY&#34;</span> <span class=o>(</span>range 0 to 16777215<span class=o>)</span>
              client settable attribute
              client gettable attribute <span class=o>(</span>current value is 2110<span class=o>)</span>
      <span class=s2>&#34;XV_BRIGHTNESS&#34;</span> <span class=o>(</span>range <span class=nt>-128</span> to 127<span class=o>)</span>
              client settable attribute
              client gettable attribute <span class=o>(</span>current value is 0<span class=o>)</span>
      <span class=s2>&#34;XV_CONTRAST&#34;</span> <span class=o>(</span>range 0 to 255<span class=o>)</span>
              client settable attribute
              client gettable attribute <span class=o>(</span>current value is 128<span class=o>)</span>
      <span class=s2>&#34;XV_SATURATION&#34;</span> <span class=o>(</span>range 0 to 255<span class=o>)</span>
              client settable attribute
              client gettable attribute <span class=o>(</span>current value is 128<span class=o>)</span>
      <span class=s2>&#34;XV_HUE&#34;</span> <span class=o>(</span>range <span class=nt>-180</span> to 180<span class=o>)</span>
              client settable attribute
              client gettable attribute <span class=o>(</span>current value is 0<span class=o>)</span>
    maximum XvImage size: 1024 x 1024
    Number of image formats: 7
      <span class=nb>id</span>: 0x32595559 <span class=o>(</span>YUY2<span class=o>)</span>
        guid: 59555932-0000-0010-8000-00aa00389b71
        bits per pixel: 16
        number of planes: 1
        <span class=nb>type</span>: YUV <span class=o>(</span>packed<span class=o>)</span>
      <span class=nb>id</span>: 0x32315659 <span class=o>(</span>YV12<span class=o>)</span>
        guid: 59563132-0000-0010-8000-00aa00389b71
        bits per pixel: 12
        number of planes: 3
        <span class=nb>type</span>: YUV <span class=o>(</span>planar<span class=o>)</span>
      <span class=nb>id</span>: 0x30323449 <span class=o>(</span>I420<span class=o>)</span>
        guid: 49343230-0000-0010-8000-00aa00389b71
        bits per pixel: 12
        number of planes: 3
        <span class=nb>type</span>: YUV <span class=o>(</span>planar<span class=o>)</span>
      <span class=nb>id</span>: 0x36315652 <span class=o>(</span>RV16<span class=o>)</span>
        guid: 52563135-0000-0000-0000-000000000000
        bits per pixel: 16
        number of planes: 1
        <span class=nb>type</span>: RGB <span class=o>(</span>packed<span class=o>)</span>
        depth: 0
        red, green, blue masks: 0x1f, 0x3e0, 0x7c00
      <span class=nb>id</span>: 0x35315652 <span class=o>(</span>RV15<span class=o>)</span>
        guid: 52563136-0000-0000-0000-000000000000
        bits per pixel: 16
        number of planes: 1
        <span class=nb>type</span>: RGB <span class=o>(</span>packed<span class=o>)</span>
        depth: 0
        red, green, blue masks: 0x1f, 0x7e0, 0xf800
      <span class=nb>id</span>: 0x31313259 <span class=o>(</span>Y211<span class=o>)</span>
        guid: 59323131-0000-0010-8000-00aa00389b71
        bits per pixel: 6
        number of planes: 3
        <span class=nb>type</span>: YUV <span class=o>(</span>packed<span class=o>)</span>
      <span class=nb>id</span>: 0x0
        guid: 00000000-0000-0000-0000-000000000000
        bits per pixel: 0
        number of planes: 0
        <span class=nb>type</span>: RGB <span class=o>(</span>packed<span class=o>)</span>
        depth: 1
        red, green, blue masks: 0x0, 0x0, 0x0</code></pre></div></div><div class=paragraph><p>The formats listed, such as YUV2 and YUV12, are not present with every implementation of XVideo and their absence may hinder some players.</p></div><div class=paragraph><p>If the result instead looks like:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>X-Video Extension version 2.2
screen <span class=c>#0</span>
no adaptors present</code></pre></div></div><div class=paragraph><p>XVideo is probably not supported for the card. This means that it will be more difficult for the display to meet the computational demands of rendering video, depending on the video card and processor.</p></div></div></div><div class=sect3><h4 id=video-ports>7.4.2. Ports and Packages Dealing with Video<a class=anchor href=#video-ports></a></h4><div class=paragraph><p>This section introduces some of the software available from the FreeBSD Ports Collection which can be used for video playback.</p></div><div class=sect4><h5 id=video-mplayer>7.4.2.1. MPlayer and MEncoder<a class=anchor href=#video-mplayer></a></h5><div class=paragraph><p>MPlayer is a command-line video player with an optional graphical interface which aims to provide speed and flexibility. Other graphical front-ends to MPlayer are available from the FreeBSD Ports Collection.</p></div><div class=paragraph><p>MPlayer can be installed using the <a class=package href=https://cgit.freebsd.org/ports/tree/multimedia/mplayer/>multimedia/mplayer</a> package or port. Several compile options are available and a variety of hardware checks occur during the build process. For these reasons, some users prefer to build the port rather than install the package.</p></div><div class=paragraph><p>When compiling the port, the menu options should be reviewed to determine the type of support to compile into the port. If an option is not selected, MPlayer will not be able to display that type of video format. Use the arrow keys and spacebar to select the required formats. When finished, press <kbd>Enter</kbd> to continue the port compile and installation.</p></div><div class=paragraph><p>By default, the package or port will build the <code>mplayer</code> command line utility and the <code>gmplayer</code> graphical utility. To encode videos, compile the <a class=package href=https://cgit.freebsd.org/ports/tree/multimedia/mencoder/>multimedia/mencoder</a> port. Due to licensing restrictions, a package is not available for MEncoder.</p></div><div class=paragraph><p>The first time MPlayer is run, it will create <span class=filename>~/.mplayer</span> in the user’s home directory. This subdirectory contains default versions of the user-specific configuration files.</p></div><div class=paragraph><p>This section describes only a few common uses. Refer to mplayer(1) for a complete description of its numerous options.</p></div><div class=paragraph><p>To play the file <span class=filename>testfile.avi</span>, specify the video interfaces with <code>-vo</code>, as seen in the following examples:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% mplayer <span class=nt>-vo</span> xv testfile.avi</code></pre></div></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% mplayer <span class=nt>-vo</span> sdl testfile.avi</code></pre></div></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% mplayer <span class=nt>-vo</span> x11 testfile.avi</code></pre></div></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mplayer -vo dga testfile.avi</span></code></pre></div></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mplayer -vo &#39;sdl:dga&#39; testfile.avi</span></code></pre></div></div><div class=paragraph><p>It is worth trying all of these options, as their relative performance depends on many factors and will vary significantly with hardware.</p></div><div class=paragraph><p>To play a <code>DVD</code>, replace <span class=filename>testfile.avi</span> with <code>dvd://<em>N</em> -dvd-device <em>DEVICE</em></code>, where <em>N</em> is the title number to play and <em>DEVICE</em> is the device node for the <code>DVD</code>. For example, to play title 3 from <span class=filename>/dev/dvd</span>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mplayer -vo xv dvd://3 -dvd-device /dev/dvd</span></code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>The default <code>DVD</code> device can be defined during the build of the MPlayer port by including the <code>WITH_DVD_DEVICE=/path/to/desired/device</code> option. By default, the device is <span class=filename>/dev/cd0</span>. More details can be found in the port’s <span class=filename>Makefile.options</span>.</p></div></td></tr></tbody></table></div><div class=paragraph><p>To stop, pause, advance, and so on, use a keybinding. To see the list of keybindings, run <code>mplayer -h</code> or read mplayer(1).</p></div><div class=paragraph><p>Additional playback options include <code>-fs -zoom</code>, which engages fullscreen mode, and <code>-framedrop</code>, which helps performance.</p></div><div class=paragraph><p>Each user can add commonly used options to their <span class=filename>~/.mplayer/config</span> like so:</p></div><div class="literalblock programlisting"><div class=content><pre>vo=xv
fs=yes
zoom=yes</pre></div></div><div class=paragraph><p><code>mplayer</code> can be used to rip a <code>DVD</code> title to a <span class=filename>.vob</span>. To dump the second title from a <code>DVD</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mplayer -dumpstream -dumpfile out.vob dvd://2 -dvd-device /dev/dvd</span></code></pre></div></div><div class=paragraph><p>The output file, <span class=filename>out.vob</span>, will be in <code>MPEG</code> format.</p></div><div class=paragraph><p>Anyone wishing to obtain a high level of expertise with UNIX® video should consult <a href=http://www.mplayerhq.hu/DOCS/>mplayerhq.hu/DOCS</a> as it is technically informative. This documentation should be considered as required reading before submitting any bug reports.</p></div><div class=paragraph><p>Before using <code>mencoder</code>, it is a good idea to become familiar with the options described at <a href=http://www.mplayerhq.hu/DOCS/HTML/en/mencoder.html>mplayerhq.hu/DOCS/HTML/en/mencoder.html</a>. There are innumerable ways to improve quality, lower bitrate, and change formats, and some of these options may make the difference between good or bad performance. Improper combinations of command line options can yield output files that are unplayable even by <code>mplayer</code>.</p></div><div class=paragraph><p>Here is an example of a simple copy:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% mencoder input.avi <span class=nt>-oac</span> copy <span class=nt>-ovc</span> copy <span class=nt>-o</span> output.avi</code></pre></div></div><div class=paragraph><p>To rip to a file, use <code>-dumpfile</code> with <code>mplayer</code>.</p></div><div class=paragraph><p>To convert <span class=filename>input.avi</span> to the MPEG4 codec with MPEG3 audio encoding, first install the <a class=package href=https://cgit.freebsd.org/ports/tree/audio/lame/>audio/lame</a> port. Due to licensing restrictions, a package is not available. Once installed, type:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% mencoder input.avi <span class=nt>-oac</span> mp3lame <span class=nt>-lameopts</span> <span class=nv>br</span><span class=o>=</span>192 <span class=se>\</span>
	 <span class=nt>-ovc</span> lavc <span class=nt>-lavcopts</span> <span class=nv>vcodec</span><span class=o>=</span>mpeg4:vhq <span class=nt>-o</span> output.avi</code></pre></div></div><div class=paragraph><p>This will produce output playable by applications such as <code>mplayer</code> and <code>xine</code>.</p></div><div class=paragraph><p><span class=filename>input.avi</span> can be replaced with <code>dvd://1 -dvd-device /dev/dvd</code> and run as <code>root</code> to re-encode a <code>DVD</code> title directly. Since it may take a few tries to get the desired result, it is recommended to instead dump the title to a file and to work on the file.</p></div></div><div class=sect4><h5 id=video-xine>7.4.2.2. The xine Video Player<a class=anchor href=#video-xine></a></h5><div class=paragraph><p>xine is a video player with a reusable base library and a modular executable which can be extended with plugins. It can be installed using the <a class=package href=https://cgit.freebsd.org/ports/tree/multimedia/xine/>multimedia/xine</a> package or port.</p></div><div class=paragraph><p>In practice, xine requires either a fast CPU with a fast video card, or support for the XVideo extension. The xine video player performs best on XVideo interfaces.</p></div><div class=paragraph><p>By default, the xine player starts a graphical user interface. The menus can then be used to open a specific file.</p></div><div class=paragraph><p>Alternatively, xine may be invoked from the command line by specifying the name of the file to play:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% xine <span class=nt>-g</span> <span class=nt>-p</span> mymovie.avi</code></pre></div></div><div class=paragraph><p>Refer to <a href=http://www.xine-project.org/faq>xine-project.org/faq</a> for more information and troubleshooting tips.</p></div></div><div class=sect4><h5 id=video-ports-transcode>7.4.2.3. The Transcode Utilities<a class=anchor href=#video-ports-transcode></a></h5><div class=paragraph><p>Transcode provides a suite of tools for re-encoding video and audio files. Transcode can be used to merge video files or repair broken files using command line tools with stdin/stdout stream interfaces.</p></div><div class=paragraph><p>In FreeBSD, Transcode can be installed using the <a class=package href=https://cgit.freebsd.org/ports/tree/multimedia/transcode/>multimedia/transcode</a> package or port. Many users prefer to compile the port as it provides a menu of compile options for specifying the support and codecs to compile in. If an option is not selected, Transcode will not be able to encode that format. Use the arrow keys and spacebar to select the required formats. When finished, press <kbd>Enter</kbd> to continue the port compile and installation.</p></div><div class=paragraph><p>This example demonstrates how to convert a DivX file into a PAL MPEG-1 file (PAL VCD):</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% transcode <span class=nt>-i</span> input.avi <span class=nt>-V</span> <span class=nt>--export_prof</span> vcd-pal <span class=nt>-o</span> output_vcd
% mplex <span class=nt>-f</span> 1 <span class=nt>-o</span> output_vcd.mpg output_vcd.m1v output_vcd.mpa</code></pre></div></div><div class=paragraph><p>The resulting <code>MPEG</code> file, <span class=filename>output_vcd.mpg</span>, is ready to be played with MPlayer. The file can be burned on a <code>CD</code> media to create a video <code>CD</code> using a utility such as <a class=package href=https://cgit.freebsd.org/ports/tree/multimedia/vcdimager/>multimedia/vcdimager</a> or <a class=package href=https://cgit.freebsd.org/ports/tree/sysutils/cdrdao/>sysutils/cdrdao</a>.</p></div><div class=paragraph><p>In addition to the manual page for <code>transcode</code>, refer to <a href=http://www.transcoding.org/cgi-bin/transcode>transcoding.org/cgi-bin/transcode</a> for further information and examples.</p></div></div></div></div><div class=sect2><h3 id=tvcard>7.5. TV Cards<a class=anchor href=#tvcard></a></h3><div class=paragraph><p>TV cards can be used to watch broadcast or cable TV on a computer. Most cards accept composite video via an <code>RCA</code> or S-video input and some cards include a <code>FM</code> radio tuner.</p></div><div class=paragraph><p>FreeBSD provides support for PCI-based TV cards using a Brooktree Bt848/849/878/879 video capture chip with the <a href="https://man.freebsd.org/cgi/man.cgi?query=bktr&amp;sektion=4&amp;format=html">bktr(4)</a> driver. This driver supports most Pinnacle PCTV video cards. Before purchasing a TV card, consult <a href="https://man.freebsd.org/cgi/man.cgi?query=bktr&amp;sektion=4&amp;format=html">bktr(4)</a> for a list of supported tuners.</p></div><div class=sect3><h4 id=_loading_the_driver>7.5.1. Loading the Driver<a class=anchor href=#_loading_the_driver></a></h4><div class=paragraph><p>In order to use the card, the <a href="https://man.freebsd.org/cgi/man.cgi?query=bktr&amp;sektion=4&amp;format=html">bktr(4)</a> driver must be loaded. To automate this at boot time, add the following line to <span class=filename>/boot/loader.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>bktr_load=&#34;YES&#34;</pre></div></div><div class=paragraph><p>Alternatively, one can statically compile support for the TV card into a custom kernel. In that case, add the following lines to the custom kernel configuration file:</p></div><div class="literalblock programlisting"><div class=content><pre>device	 bktr
device	iicbus
device	iicbb
device	smbus</pre></div></div><div class=paragraph><p>These additional devices are necessary as the card components are interconnected via an I2C bus. Then, build and install a new kernel.</p></div><div class=paragraph><p>To test that the tuner is correctly detected, reboot the system. The TV card should appear in the boot messages, as seen in this example:</p></div><div class="literalblock programlisting"><div class=content><pre>bktr0: &lt;BrookTree 848A&gt; mem 0xd7000000-0xd7000fff irq 10 at device 10.0 on pci0
iicbb0: &lt;I2C bit-banging driver&gt; on bti2c0
iicbus0: &lt;Philips I2C bus&gt; on iicbb0 master-only
iicbus1: &lt;Philips I2C bus&gt; on iicbb0 master-only
smbus0: &lt;System Management Bus&gt; on bti2c0
bktr0: Pinnacle/Miro TV, Philips SECAM tuner.</pre></div></div><div class=paragraph><p>The messages will differ according to the hardware. If necessary, it is possible to override some of the detected parameters using <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a> or custom kernel configuration options. For example, to force the tuner to a Philips SECAM tuner, add the following line to a custom kernel configuration file:</p></div><div class="literalblock programlisting"><div class=content><pre>options OVERRIDE_TUNER=6</pre></div></div><div class=paragraph><p>or, use <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sysctl hw.bt848.tuner=6</span></code></pre></div></div><div class=paragraph><p>Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=bktr&amp;sektion=4&amp;format=html">bktr(4)</a> for a description of the available <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a> parameters and kernel options.</p></div></div><div class=sect3><h4 id=_useful_applications>7.5.2. Useful Applications<a class=anchor href=#_useful_applications></a></h4><div class=paragraph><p>To use the TV card, install one of the following applications:</p></div><div class=ulist><ul><li><p><a class=package href=https://cgit.freebsd.org/ports/tree/multimedia/fxtv/>multimedia/fxtv</a> provides TV-in-a-window and image/audio/video capture capabilities.</p></li><li><p><a class=package href=https://cgit.freebsd.org/ports/tree/multimedia/xawtv/>multimedia/xawtv</a> is another TV application with similar features.</p></li><li><p><a class=package href=https://cgit.freebsd.org/ports/tree/audio/xmradio/>audio/xmradio</a> provides an application for using the FM radio tuner of a TV card.</p></li></ul></div><div class=paragraph><p>More applications are available in the FreeBSD Ports Collection.</p></div></div><div class=sect3><h4 id=_troubleshooting>7.5.3. Troubleshooting<a class=anchor href=#_troubleshooting></a></h4><div class=paragraph><p>If any problems are encountered with the TV card, check that the video capture chip and the tuner are supported by <a href="https://man.freebsd.org/cgi/man.cgi?query=bktr&amp;sektion=4&amp;format=html">bktr(4)</a> and that the right configuration options were used. For more support or to ask questions about supported TV cards, refer to the <a href=https://lists.FreeBSD.org/subscription/freebsd-multimedia>FreeBSD multimedia mailing list</a> mailing list.</p></div></div></div><div class=sect2><h3 id=mythtv>7.6. MythTV<a class=anchor href=#mythtv></a></h3><div class=paragraph><p>MythTV is a popular, open source Personal Video Recorder (<code>PVR</code>) application. This section demonstrates how to install and setup MythTV on FreeBSD. Refer to <a href=http://www.mythtv.org/wiki/>mythtv.org/wiki</a> for more information on how to use MythTV.</p></div><div class=paragraph><p>MythTV requires a frontend and a backend. These components can either be installed on the same system or on different machines.</p></div><div class=paragraph><p>The frontend can be installed on FreeBSD using the <a class=package href=https://cgit.freebsd.org/ports/tree/multimedia/mythtv-frontend/>multimedia/mythtv-frontend</a> package or port. Xorg must also be installed and configured as described in <a href=./#x11>The X Window System</a>. Ideally, this system has a video card that supports X-Video Motion Compensation (<code>XvMC</code>) and, optionally, a Linux Infrared Remote Control (<code>LIRC</code>)-compatible remote.</p></div><div class=paragraph><p>To install both the backend and the frontend on FreeBSD, use the <a class=package href=https://cgit.freebsd.org/ports/tree/multimedia/mythtv/>multimedia/mythtv</a> package or port. A MySQL™ database server is also required and should automatically be installed as a dependency. Optionally, this system should have a tuner card and sufficient storage to hold recorded data.</p></div><div class=sect3><h4 id=_hardware>7.6.1. Hardware<a class=anchor href=#_hardware></a></h4><div class=paragraph><p>MythTV uses Video for Linux (<code>V4L</code>) to access video input devices such as encoders and tuners. In FreeBSD, MythTV works best with <code>USB</code> DVB-S/C/T cards as they are well supported by the <a class=package href=https://cgit.freebsd.org/ports/tree/multimedia/webcamd/>multimedia/webcamd</a> package or port which provides a <code>V4L</code> userland application. Any Digital Video Broadcasting (<code>DVB</code>) card supported by webcamd should work with MythTV. A list of known working cards can be found at <a href=https://wiki.freebsd.org/WebcamCompat>wiki.freebsd.org/WebcamCompat</a>. Drivers are also available for Hauppauge cards in the <a class=package href=https://cgit.freebsd.org/ports/tree/multimedia/pvr250/>multimedia/pvr250</a> and <a class=package href=https://cgit.freebsd.org/ports/tree/multimedia/pvrxxx/>multimedia/pvrxxx</a> ports, but they provide a non-standard driver interface that does not work with versions of MythTV greater than 0.23. Due to licensing restrictions, no packages are available and these two ports must be compiled.</p></div><div class=paragraph><p>The <a href=https://wiki.freebsd.org/HTPC>wiki.freebsd.org/HTPC</a> page contains a list of all available <code>DVB</code> drivers.</p></div></div><div class=sect3><h4 id=_setting_up_the_mythtv_backend>7.6.2. Setting up the MythTV Backend<a class=anchor href=#_setting_up_the_mythtv_backend></a></h4><div class=paragraph><p>To install MythTV using binary packages:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pkg install mythtv</span></code></pre></div></div><div class=paragraph><p>Alternatively, to install from the Ports Collection:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/ports/multimedia/mythtv</span>
<span class=c># make install</span></code></pre></div></div><div class=paragraph><p>Once installed, set up the MythTV database:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mysql -uroot -p &lt; /usr/local/shared/mythtv/database/mc.sql</span></code></pre></div></div><div class=paragraph><p>Then, configure the backend:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mythtv-setup</span></code></pre></div></div><div class=paragraph><p>Finally, start the backend:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sysrc mythbackend_enable=yes</span>
<span class=c># service mythbackend start</span></code></pre></div></div></div></div><div class=sect2><h3 id=scanners>7.7. Image Scanners<a class=anchor href=#scanners></a></h3><div class=paragraph><p>In FreeBSD, access to image scanners is provided by SANE (Scanner Access Now Easy), which is available in the FreeBSD Ports Collection. SANE will also use some FreeBSD device drivers to provide access to the scanner hardware.</p></div><div class=paragraph><p>FreeBSD supports both <code>SCSI</code> and <code>USB</code> scanners. Depending upon the scanner interface, different device drivers are required. Be sure the scanner is supported by SANE prior to performing any configuration. Refer to <a href=http://www.sane-project.org/sane-supported-devices.html>http://www.sane-project.org/sane-supported-devices.html</a> for more information about supported scanners.</p></div><div class=paragraph><p>This chapter describes how to determine if the scanner has been detected by FreeBSD. It then provides an overview of how to configure and use SANE on a FreeBSD system.</p></div><div class=sect3><h4 id=scanners-kernel-usb>7.7.1. Checking the Scanner<a class=anchor href=#scanners-kernel-usb></a></h4><div class=paragraph><p>The <span class=filename>GENERIC</span> kernel includes the device drivers needed to support <code>USB</code> scanners. Users with a custom kernel should ensure that the following lines are present in the custom kernel configuration file:</p></div><div class="literalblock programlisting"><div class=content><pre>device usb
device uhci
device ohci
device ehci
device xhci</pre></div></div><div class=paragraph><p>To determine if the <code>USB</code> scanner is detected, plug it in and use <code>dmesg</code> to determine whether the scanner appears in the system message buffer. If it does, it should display a message similar to this:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>ugen0.2: &lt;EPSON&gt; at usbus0</code></pre></div></div><div class=paragraph><p>In this example, an EPSON Perfection® 1650 <code>USB</code> scanner was detected on <span class=filename>/dev/ugen0.2</span>.</p></div><div class=paragraph><p>If the scanner uses a <code>SCSI</code> interface, it is important to know which <code>SCSI</code> controller board it will use. Depending upon the <code>SCSI</code> chipset, a custom kernel configuration file may be needed. The <span class=filename>GENERIC</span> kernel supports the most common <code>SCSI</code> controllers. Refer to <span class=filename>/usr/src/sys/conf/NOTES</span> to determine the correct line to add to a custom kernel configuration file. In addition to the <code>SCSI</code> adapter driver, the following lines are needed in a custom kernel configuration file:</p></div><div class="literalblock programlisting"><div class=content><pre>device scbus
device pass</pre></div></div><div class=paragraph><p>Verify that the device is displayed in the system message buffer:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>pass2 at aic0 bus 0 target 2 lun 0
pass2: &lt;AGFA SNAPSCAN 600 1.10&gt; Fixed Scanner SCSI-2 device
pass2: 3.300MB/s transfers</code></pre></div></div><div class=paragraph><p>If the scanner was not powered-on at system boot, it is still possible to manually force detection by performing a <code>SCSI</code> bus scan with <code>camcontrol</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># camcontrol rescan all</span>
Re-scan of bus 0 was successful
Re-scan of bus 1 was successful
Re-scan of bus 2 was successful
Re-scan of bus 3 was successful</code></pre></div></div><div class=paragraph><p>The scanner should now appear in the <code>SCSI</code> devices list:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># camcontrol devlist</span>
&lt;IBM DDRS-34560 S97B&gt;              at scbus0 target 5 lun 0 <span class=o>(</span>pass0,da0<span class=o>)</span>
&lt;IBM DDRS-34560 S97B&gt;              at scbus0 target 6 lun 0 <span class=o>(</span>pass1,da1<span class=o>)</span>
&lt;AGFA SNAPSCAN 600 1.10&gt;           at scbus1 target 2 lun 0 <span class=o>(</span>pass3<span class=o>)</span>
&lt;PHILIPS CDD3610 CD-R/RW 1.00&gt;     at scbus2 target 0 lun 0 <span class=o>(</span>pass2,cd0<span class=o>)</span></code></pre></div></div><div class=paragraph><p>Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=scsi&amp;sektion=4&amp;format=html">scsi(4)</a> and <a href="https://man.freebsd.org/cgi/man.cgi?query=camcontrol&amp;sektion=8&amp;format=html">camcontrol(8)</a> for more details about <code>SCSI</code> devices on FreeBSD.</p></div></div><div class=sect3><h4 id=_sane_configuration>7.7.2. SANE Configuration<a class=anchor href=#_sane_configuration></a></h4><div class=paragraph><p>The SANE system provides the access to the scanner via backends (<a class=package href=https://cgit.freebsd.org/ports/tree/graphics/sane-backends/>graphics/sane-backends</a>). Refer to <a href=http://www.sane-project.org/sane-supported-devices.html>http://www.sane-project.org/sane-supported-devices.html</a> to determine which backend supports the scanner. A graphical scanning interface is provided by third party applications like Kooka (<a class=package href=https://cgit.freebsd.org/ports/tree/graphics/kooka/>graphics/kooka</a>) or XSane (<a class=package href=https://cgit.freebsd.org/ports/tree/graphics/xsane/>graphics/xsane</a>). SANE’s backends are enough to test the scanner.</p></div><div class=paragraph><p>To install the backends from binary package:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pkg install sane-backends</span></code></pre></div></div><div class=paragraph><p>Alternatively, to install from the Ports Collection</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/ports/graphics/sane-backends</span>
<span class=c># make install clean</span></code></pre></div></div><div class=paragraph><p>After installing the <a class=package href=https://cgit.freebsd.org/ports/tree/graphics/sane-backends/>graphics/sane-backends</a> port or package, use <code>sane-find-scanner</code> to check the scanner detection by the SANE system:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sane-find-scanner -q</span>
found SCSI scanner <span class=s2>&#34;AGFA SNAPSCAN 600 1.10&#34;</span> at /dev/pass3</code></pre></div></div><div class=paragraph><p>The output should show the interface type of the scanner and the device node used to attach the scanner to the system. The vendor and the product model may or may not appear.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Some <code>USB</code> scanners require firmware to be loaded. Refer to sane-find-scanner(1) and sane(7) for details.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Next, check if the scanner will be identified by a scanning frontend. The SANE backends include <code>scanimage</code> which can be used to list the devices and perform an image acquisition. Use <code>-L</code> to list the scanner devices. The first example is for a <code>SCSI</code> scanner and the second is for a <code>USB</code> scanner:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># scanimage -L</span>
device <span class=sb>`</span>snapscan:/dev/pass3<span class=s1>&#39; is a AGFA SNAPSCAN 600 flatbed scanner

# scanimage -L
device &#39;</span>epson2:libusb:000:002<span class=s1>&#39; is a Epson GT-8200 flatbed scanner</span></code></pre></div></div><div class=paragraph><p>In this second example, <code>epson2</code> is the backend name and <code>libusb:000:002</code> means <span class=filename>/dev/ugen0.2</span> is the device node used by the scanner.</p></div><div class=paragraph><p>If <code>scanimage</code> is unable to identify the scanner, this message will appear:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># scanimage -L</span>
No scanners were identified. If you were expecting something different,
check that the scanner is plugged <span class=k>in</span>, turned on and detected by the
sane-find-scanner tool <span class=o>(</span><span class=k>if </span>appropriate<span class=o>)</span><span class=nb>.</span> Please <span class=nb>read </span>the documentation
which came with this software <span class=o>(</span>README, FAQ, manpages<span class=o>)</span>.</code></pre></div></div><div class=paragraph><p>If this happens, edit the backend configuration file in <span class=filename>/usr/local/etc/sane.d/</span> and define the scanner device used. For example, if the undetected scanner model is an EPSON Perfection® 1650 and it uses the <code>epson2</code> backend, edit <span class=filename>/usr/local/etc/sane.d/epson2.conf</span>. When editing, add a line specifying the interface and the device node used. In this case, add the following line:</p></div><div class="literalblock programlisting"><div class=content><pre>usb /dev/ugen0.2</pre></div></div><div class=paragraph><p>Save the edits and verify that the scanner is identified with the right backend name and the device node:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># scanimage -L</span>
device <span class=s1>&#39;epson2:libusb:000:002&#39;</span> is a Epson GT-8200 flatbed scanner</code></pre></div></div><div class=paragraph><p>Once <code>scanimage -L</code> sees the scanner, the configuration is complete and the scanner is now ready to use.</p></div><div class=paragraph><p>While <code>scanimage</code> can be used to perform an image acquisition from the command line, it is often preferable to use a graphical interface to perform image scanning. Applications like Kooka or XSane are popular scanning frontends. They offer advanced features such as various scanning modes, color correction, and batch scans. XSane is also usable as a GIMP plugin.</p></div></div><div class=sect3><h4 id=_scanner_permissions>7.7.3. Scanner Permissions<a class=anchor href=#_scanner_permissions></a></h4><div class=paragraph><p>In order to have access to the scanner, a user needs read and write permissions to the device node used by the scanner. In the previous example, the <code>USB</code> scanner uses the device node <span class=filename>/dev/ugen0.2</span> which is really a symlink to the real device node <span class=filename>/dev/usb/0.2.0</span>. The symlink and the device node are owned, respectively, by the <code>wheel</code> and <code>operator</code> groups. While adding the user to these groups will allow access to the scanner, it is considered insecure to add a user to <code>wheel</code>. A better solution is to create a group and make the scanner device accessible to members of this group.</p></div><div class=paragraph><p>This example creates a group called <code><em>usb</em></code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pw groupadd usb</span></code></pre></div></div><div class=paragraph><p>Then, make the <span class=filename>/dev/ugen0.2</span> symlink and the <span class=filename>/dev/usb/0.2.0</span> device node accessible to the <code>usb</code> group with write permissions of <code>0660</code> or <code>0664</code> by adding the following lines to <span class=filename>/etc/devfs.rules</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>[system=5]
add path ugen0.2 mode 0660 group usb
add path usb/0.2.0 mode 0666 group usb</pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>It happens the device node changes with the addition or removal of devices, so one may want to give access to all USB devices using this ruleset instead:</p></div><div class="literalblock programlisting"><div class=content><pre>[system=5]
add path &#39;ugen*&#39; mode 0660 group usb
add path &#39;usb/*&#39; mode 0666 group usb</pre></div></div></td></tr></tbody></table></div><div class=paragraph><p>Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=devfs.rules&amp;sektion=5&amp;format=html">devfs.rules(5)</a> for more information about this file.</p></div><div class=paragraph><p>Next, enable the ruleset in /etc/rc.conf:</p></div><div class="literalblock programlisting"><div class=content><pre>devfs_system_ruleset=&#34;system&#34;</pre></div></div><div class=paragraph><p>And, restart the <a href="https://man.freebsd.org/cgi/man.cgi?query=devfs&amp;sektion=8&amp;format=html">devfs(8)</a> system:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service devfs restart</span></code></pre></div></div><div class=paragraph><p>Finally, add the users to <code><em>usb</em></code> in order to allow access to the scanner:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pw groupmod usb -m joe</span></code></pre></div></div><div class=paragraph><p>For more details refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=pw&amp;sektion=8&amp;format=html">pw(8)</a>.</p></div></div></div></div></div><div class=sect1><h2 id=kernelconfig>Rozdział 8. Konfiguracja jądra FreeBSD<a class=anchor href=#kernelconfig></a></h2><div class=sectionbody><div class=sect2><h3 id=kernelconfig-synopsis>8.1. Streszczenie<a class=anchor href=#kernelconfig-synopsis></a></h3><div class=paragraph><p>Rdzeniem systemu operacyjnego FreeBSD jest jądro. Odpowiedzialne jest za zarządzanie pamięcią, wymuszanie kontroli bezpieczeństwa, sieć, dostęp do dysków i wiele innych. Podczas, gdy coraz więcej elementów FreeBSD jest konfigurowanych dynamicznie, czasem jeszcze może zajść potrzeba przekonfigurowania i rekompilowania jądra.</p></div><div class=paragraph><p>Po przeczytaniu tego rozdziału będziemy wiedzieć:</p></div><div class=ulist><ul><li><p>Dlaczego możemy potrzebować indywidualnego jądra.</p></li><li><p>Jak napisać plik konfiguracyjny lub dostroić istniejący.</p></li><li><p>Jak wykorzystać plik konfiguracyjny jądra do przygotowania i kompilacji nowego jądra.</p></li><li><p>Jak zainstalować nowe jądro.</p></li><li><p>Jak się ratować, jeśli coś pójdzie nie tak.</p></li></ul></div><div class=paragraph><p>Wszystkie przykładowe polecenia przedstawione w niniejszym rozdziale powinny być uruchamiane jako użytkownik <code>root</code>.</p></div></div><div class=sect2><h3 id=kernelconfig-custom-kernel>8.2. Po co budować indywidualne jądro?<a class=anchor href=#kernelconfig-custom-kernel></a></h3><div class=paragraph><p>Tradycyjnie, system FreeBSD miał coś, co zwie się "monolitycznym" jądrem. Był to jeden duży program, wspierający ustaloną liczbą urządzeń. Jeśli zaszła potrzeba zmiany zachowania jądra, należało skompilować nowe jądro i uruchomić z nim ponownie komputer.</p></div><div class=paragraph><p>W dzisiejszych czasach, FreeBSD bardzo szybko przechodzi do modelu, w którym funkcjonalność jądra zawiera się w modułach, które można dynamicznie aplikować, lub usuwać, w miarę potrzeb. Umożliwia to jądru szybkie przystosowywanie się zaraz po rozpoznaniu nowego sprzętu (jak karty PCMCIA w laptopach). Pozwala też zwiększyć funkcjonalność, której nie miało oryginalne jądro (któremu nie były dane funkcje potrzebne). Potocznie mówi się o jądrze modularnym.</p></div><div class=paragraph><p>Pomimo tego, czasem trzeba wprowadzić do jądra statyczne zmiany. Na przykład w sytuacjach, gdy kluczowe funkcje jądra zostają zmieniane, nie jest możliwym załadowanie dynamicznie ładowalnego modułu. Możliwe też, że jeszcze odpowiedni, dynamicznie ładowalny moduł, nie został napisany.</p></div><div class=paragraph><p>Budowanie indywidualnego jądra jest jednym z najważniejszych rytuałów, których podczas użytkowania systemu BSD trzeba doświadczyć. Ten czasochłonny proces przyniesie naszemu systemowi wiele korzyści. Inaczej niż w przypadku jądra <span class=filename>GENERIC</span> [podstawowego, domyślnego], które musi wspierać wiele rodzajów sprzętu, nasze jądro będzie wspierało tylko <em>nasz</em> sprzęt PC. Ma to wiele zalet:</p></div><div class=ulist><ul><li><p>Szybszy czas uruchamiania systemu. Od kiedy jądro będzie sprawdzało tylko sprzęt który mamy, czas uruchamiania znacząco się zmniejszy.</p></li><li><p>Mniejsze zużycie pamięci. Indywidualne jądro często zużywa mniej pamięci niż jądro <span class=filename>GENERIC</span>, co jest istotnym faktem, gdyż jądro przez cały czas musi być w pamięci obecne. Z tych powodów, budowanie indywidualnego jądra jest szczególnie przydatne przy pracy z maszynami o małej ilości pamięci RAM’u.</p></li><li><p>Więcej wspieranego sprzętu. Indywidualne jądro może zawierać obsługę np. kart muzycznych, które nie są wspierane przez domyślne jądro <span class=filename>GENERIC</span>.</p></li></ul></div></div><div class=sect2><h3 id=kernelconfig-building>8.3. Budowanie i instalowanie indywidualnego jądra<a class=anchor href=#kernelconfig-building></a></h3><div class=paragraph><p>Omówmy pokrótce katalog kompilacji jądra. Wszystkie wspomniane za chwilę katalogi będą relatywnymi względem <span class=filename>/usr/src/sys</span>, do którego można także dojść przez <span class=filename>/sys</span>. Można tam znaleźć wiele różnych podkatalogów, jednak dla nas najważniejszym będzie <span class=filename>arch/conf</span>. W nim właśnie dokonamy edycji pliku konfiguracyjnego jądra oraz je skompilujemy, będą to kolejne etapy w całym procesie budowy. <em>arch</em> oznacza architekturę, do wyboru: <span class=filename>i386</span>, <span class=filename>alpha</span>, <span class=filename>amd64</span>, <span class=filename>ia64</span>, <span class=filename>powerpc</span>, <span class=filename>sparc64</span>, lub <span class=filename>pc98</span> (alternatywna gałąź sprzętu PC, popularna w Japonii). Wszystko, co znajduje się w katalogu danej architektury dotyczy ściśle tylko jej. Reszta źródeł jest dla wszystkich architektur taka sama. Zwróćmy uwagę na logiczną strukturę katalogów z każdym wspieranym urządzeniem, systemem plików, opcjami dodatkowymi - wszystko posiada swój własny podkatalog.</p></div><div class=paragraph><p>Przykłady w niniejszym rozdziale zakładają, że wykorzystujemy architekturę i386. Jeśli tak nie jest, będziemy musieli dokonać odpowiednich zmian w nazwach ścieżek dostępu dla architektury naszego systemu.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Jeśli <em>nie</em> mamy katalogu <span class=filename>/usr/src/sys</span>, oznacza to, że nie dysponujemy zainstalowanymi źródłami jądra. Najprostszym sposobem na zainstalowanie jest uruchomienie jako `root sysinstall’a, wybranie <span class=guimenuitem>Configure</span>, następnie <span class=guimenuitem>Distributions</span>, później <span class=guimenuitem>src</span>, a na końcu <span class=guimenuitem>sys</span>. Jeśli jednak jesteśmy osobami mającymi awersję do konfiguratorów możemy zainstalować źródła jądra ręcznie. W poniższym przykładzie instalacja z "oficjalnej" płyty CD FreeBSD:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mount /cdrom</span>
<span class=c># mkdir -p /usr/src/sys</span>
<span class=c># ln -s /usr/src/sys /sys</span>
<span class=c># cat /cdrom/src/ssys.[a-d]* | tar -xzvf -</span></code></pre></div></div></td></tr></tbody></table></div><div class=paragraph><p>Następnie wchodzimy do katalogu <span class=filename>arch/conf</span> i kopiujemy domyślny plik konfiguracyjny o nazwie <span class=filename>GENERIC</span> tworząc plik z nazwą jaką chcemy nadać swojemu jądru. Na przykład:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/src/sys/i386/conf</span>
<span class=c># cp GENERIC MYKERNEL</span></code></pre></div></div><div class=paragraph><p>Tradycyjnie nazwa jądra pisana jest wielkimi literami. Dodatkowo dobrym pomysłem jest, by nazywać jądra tak jak komputery, co pomaga rozróżnić jądra, gdy mamy wiele komputerów z różnym sprzętem. Dla potrzeb tego przykładu nazwiemy jądro <span class=filename>MYKERNEL</span>.</p></div><div class="admonitionblock tip"><table><tbody><tr><td class=icon><i class="fa icon-tip" title=Tip></i></td><td class=content><div class=paragraph><p>Nie jest najlepszym pomysłem trzymanie pliku konfiguracyjnego jądra bezpośrednio w katalogu <span class=filename>/usr/src</span>. Jeśli podczas kompilacji mamy kłopot, czasem może się okazać kuszącym pomysłem po prostu wykasować cały katalog <span class=filename>/usr/src</span> i rozpocząć od początku. Wtedy zwykle, kilka sekund po usunięciu katalogu, przypomina nam się, że usunęliśmy także plik konfiguracyjny jądra. Podobnie, nie powinniśmy edytować bezpośrednio <span class=filename>GENERIC</span>, gdyż może zostać nadpisany przy kolejnej <a href=./#cutting-edge>aktualizacji naszego drzewa źródeł</a> i zmiany, które wprowadziliśmy zostaną utracone.</p></div><div class=paragraph><p>Możemy chcieć trzymać plik konfiguracyjny jądra gdziekolwiek, a następnie utworzyć symboliczne dowiązanie do pliku w katalogu <span class=filename>i386</span>.</p></div><div class=paragraph><p>Przykładowo:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/src/sys/i386/conf</span>
<span class=c># mkdir /root/kernels</span>
<span class=c># cp GENERIC /root/kernels/MYKERNEL</span>
<span class=c># ln -s /root/kernels/MYKERNEL</span></code></pre></div></div></td></tr></tbody></table></div><div class=paragraph><p>Przyszedł czas na edycję pliku konfiguracyjnego jądra. W przykładzie nazywa się on <span class=filename>MYKERNEL</span>. Jeśli dopiero zainstalowaliśmy system, jedynym z dostępnych edytorów może być vi. Mimo, że jest dobrze udokumentowany, opisany w wielu <a href=./#bibliography>książkach</a>, dla początkujących wydaje się on nieco zbyt skomplikowany. FreeBSD zaopatrzony jest również w drugi edytor, znacznie prostszy w obsłudze, o nazwie ee. Jeśli dopiero zaczynamy, ee powinien być naszym wyborem. Nie krępujmy się i zmieńmy wartości na górze pliku, szczególnie te, odróżniające nasz własny plik od <span class=filename>GENERIC</span>.</p></div><div class=paragraph><p>Jeśli już kompilowaliśmy jądro w SunOS™ lub innych systemach BSD, duża część pliku konfiguracyjnego powinna być nam znajoma. Jeśli natomiast jesteśmy lepiej zaznajomieni z systemami typu DOS, plik konfiguracyjny może wydać się nam nieco obcy. W tym przypadku przeczytajmy uważnie każdą opcję oraz komentarz w <a href=./#kernelconfig-config>pliku konfiguracyjnym</a>.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Jeśli <a href=./#updating-upgrading>synchronizujemy nasze drzewo źródłowe</a> z najnowszymi źródłami projektu FreeBSD, należy zawsze, nim rozpoczniemy jakiekolwiek działania aktualizujące, zapoznać się z zawartością pliku <span class=filename>/usr/src/UPDATING</span>. W pliku tym zapisane są wszelkie niezbędne zagadnienia związane z aktualizacją FreeBSD. Plik <span class=filename>/usr/src/UPDATING</span> zawsze pasuje do źródła naszej wersji FreeBSD, jest przez to bardziej odpowiednim źródłem informacji niż Podręcznik.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Musimy teraz skompilować kod źródłowy jądra. Istnieją dwie procedury, za pomocą których można tego dokonać. Wybór zależeć będzie od tego w jakim celu kompilujemy jądro oraz od wykorzystywanej wersji FreeBSD.</p></div><div class=ulist><ul><li><p>Jeśli zainstalowaliśmy <em>tylko</em> źródła jądra, wykorzystamy procedurę 1.</p></li><li><p>Jeśli budujemy nowe jądro, bez aktualizowania źródeł (na przykład, by dodać dodatkowe opcje, np. <code>IPFIREWALL</code>), możemy użyć dowolnej z procedur.</p></li><li><p>Jeśli przebudowujemy jądro jako część procesu <code>make buildworld</code>, powinniśmy użyć procedury 2.</p></li></ul></div><div class=paragraph><p>Jeśli <em>nie</em> aktualizowaliśmy naszych źródeł w żaden sposób od ostatniego, zakończonego powodzeniem cyklu <code>buildworld</code>-<code>installworld</code> (nie uruchamialiśmy CVSup, CTM, ani nie korzystaliśmy z anoncvs), wówczas bezpiecznym jest skorzystać z sekwencji <code>config</code>, <code>make depend</code>, <code>make</code> i <code>make install</code>.</p></div><div class="exampleblock procedure"><div class=content><div class=paragraph><p><strong>Procedura. Budowanie jądra w "tradycyjny" sposób.</strong></p></div><div class="olist arabic"><ol class=arabic><li><p>By wygenerować kod źródłowy jądra, należy uruchomić <a href="https://man.freebsd.org/cgi/man.cgi?query=config&amp;sektion=8&amp;format=html">config(8)</a>.</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># /usr/sbin/config MYKERNEL</span></code></pre></div></div></li><li><p>Następnie, przenieśmy się do katalogu w którym dokonuje się budowy. Po ponownym uruchomieniu <a href="https://man.freebsd.org/cgi/man.cgi?query=config&amp;sektion=8&amp;format=html">config(8)</a> wyświetlona zostanie nazwa katalogu.</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd ../compile/MYKERNEL</span></code></pre></div></div></li><li><p>Skompilujmy jądro.</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># make depend</span>
<span class=c># make</span></code></pre></div></div></li><li><p>Zainstalujmy nowe jądro.</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># make install</span></code></pre></div></div></li></ol></div></div></div><div class="exampleblock procedure"><div class=content><div class=paragraph><p><strong>Procedura. Budowanie jądra w "nowy" sposób.</strong></p></div><div class="olist arabic"><ol class=arabic><li><p>Wejdźmy do katalogu <span class=filename>/usr/src</span>.</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/src</span></code></pre></div></div></li><li><p>Skompilujmy jądro.</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># make buildkernel KERNCONF=MYKERNEL</span></code></pre></div></div></li><li><p>Zainstalujmy nowe jądro.</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># make installkernel KERNCONF=MYKERNEL</span></code></pre></div></div></li></ol></div></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Ta metoda kompilacji jądra wymaga wszystkich plików źródłowych. Jeśli zainstalowaliśmy jedynie źródła jądra, powinniśmy skorzystać z opisanej powyżej metody tradycyjnej.</p></div></td></tr></tbody></table></div><div class="admonitionblock tip"><table><tbody><tr><td class=icon><i class="fa icon-tip" title=Tip></i></td><td class=content><div class=paragraph><p>Domyślnie, podczas kompilacji indywidualnego jądra, <em>wszystkie</em> moduły jądra zostaną również zrekompilowane. Jeśli chcemy zaktualizować jądro szybciej bądź zbudować tylko własne moduły, powinniśmy przed rozpoczęciem kompilacji jądra zmodyfikować plik <span class=filename>/etc/make.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>MODULES_OVERRIDE = linux acpi sound/sound sound/driver/ds1 ntfs</pre></div></div><div class=paragraph><p>Zmienna ta definiuje listę modułów do kompilacji zamiast wszystkich. Inne zmienne przydatne w procesie kompilacji jądra opisane zostały w podręczniku systemowym <a href="https://man.freebsd.org/cgi/man.cgi?query=make.conf&amp;sektion=5&amp;format=html">make.conf(5)</a>.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Nowe jądro zostanie skopiowane do katalogu <span class=filename>/boot/kernel</span> jako <span class=filename>/boot/kernel/kernel</span> , a dotychczasowe zostanie przeniesione do <span class=filename>/boot/kernel.old/kernel</span>. Teraz należy ponownie uruchomić komputer. W razie jakby coś poszło źle, na końcu tego rozdziału przedstawionych zostało kilka <a href=#kernelconfig-trouble>awaryjnych</a> rozwiązań. Przeczytajmy również rozdziały opisujące co zrobić w razie, gdy system <a href=#kernelconfig-noboot>nie chce się ponownie uruchomić</a>.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Inne pliki związane z procesem uruchamiania, np. takie jak <a href="https://man.freebsd.org/cgi/man.cgi?query=loader&amp;sektion=8&amp;format=html">loader(8)</a> czy pliki konfiguracyjne są przechowywane w katalogu <span class=filename>/boot</span>. Własne moduły jak i moduły innych producentów, można umieszczać w katalogu <span class=filename>/boot/kernel</span>, jednakże użytkownicy powinni być świadomi, iż synchronizacja modułów ze skompilowanym jądrem jest bardzo ważna. Moduły nie przygotowane do pracy z danym jądrem mogą doprowadzić do niestabilności czy błędów.</p></div></td></tr></tbody></table></div></div><div class=sect2><h3 id=kernelconfig-config>8.4. Plik konfiguracyjny<a class=anchor href=#kernelconfig-config></a></h3><div class=paragraph><p>Ogólny format pliku konfiguracyjnego jest całkiem prosty. Każda linia zawiera słowo kluczowe i jeden lub więcej argumentów. Dla ułatwienia większość linii zawiera tylko jeden argument. Cokolwiek poprzedzone znakiem <code>#</code> jest uważane za komentarz i jest ignorowane. Ten rozdział opisuje każde słowo kluczowe w ogólnym porządku jaki zawiera plik <span class=filename>GENERIC</span>. <a id=kernelconfig-options></a>Wyczerpująca lista opcji i więcej szczegółowych objaśnień zależnych od architektury znaleźć można w pliku <span class=filename>NOTES</span>, znajdującym się w tym samym katalogu co <span class=filename>GENERIC</span>. Opis opcji niezależnych od architektury znajduje się w pliku <span class=filename>/usr/src/sys/conf/NOTES</span>.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>By skompilować plik zawierający wszystkie dostępne opcje, jak się z reguły robi do celów testowych, należy wpisać jako <code>root</code> następujące polecenie:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/src/sys/i386/conf &amp;&amp; make LINT</span></code></pre></div></div></td></tr></tbody></table></div><div class=paragraph><p>Poniżej opisany został przykład pliku konfiguracyjnego <span class=filename>GENERIC</span> z licznymi dodatkowymi komentarzami, tam gdzie są potrzebne objaśnienia. Przykład ten powinien odpowiadać naszej kopii pliku <span class=filename>/usr/src/sys/i386/conf/GENERIC</span>.</p></div><div class="literalblock programlisting"><div class=content><pre>machine		i386</pre></div></div><div class=paragraph><p>Jest to architektura komputera. Musi być którymś z: <code>alpha</code>, <code>amd64</code>, <code>i386</code>, <code>ia64</code>, <code>pc98</code>, <code>powerpc</code>, lub <code>sparc64</code>.</p></div><div class="literalblock programlisting"><div class=content><pre>cpu          I486_CPU
cpu          I586_CPU
cpu          I686_CPU</pre></div></div><div class=paragraph><p>Powyższe wpisy określają typ CPU jaki posiadamy w swoim systemie. Możemy mieć kilka różnych wpisów (np. jeśli nie jesteśmy pewni czy mamy <code>I586_CPU</code> czy <code>I686_CPU</code>), jednak kiedy konfigurujemy jądro najlepiej pozostawić CPU jakie mamy. Jeśli nie jesteśmy pewni swojego procesora, możemy sprawdzić zawartość pliku <span class=filename>/var/run/dmesg.boot</span>, aby przejrzeć komunikaty startowe.</p></div><div class="literalblock programlisting"><div class=content><pre>ident          GENERIC</pre></div></div><div class=paragraph><p>Jest to identyfikator jądra. Możemy go zmienić na taki jak nazwaliśmy swoje jądro, w naszym poprzednim przykładzie <code>MYKERNEL</code>. Wartość jaką pozostawimy we wpisie <code>ident</code> będzie wyświetlana podczas startu, więc korzystnie jest dać nowemu jądru inną nazwę, jeśli chcemy go odróżnić od jądra, którego używamy na co dzień (np. chcemy zbudować eksperymentalne jądro).</p></div><div class="literalblock programlisting"><div class=content><pre>#To statically compile in device wiring instead of /boot/device.hints
#hints          &#34;GENERIC.hints&#34;         # Default places to look for devices.</pre></div></div><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=device.hints&amp;sektion=5&amp;format=html">device.hints(5)</a> jest wykorzystywany do konfiguracji opcji sterowników urządzeń. Domyślną lokacją sprawdzaną przez <a href="https://man.freebsd.org/cgi/man.cgi?query=loader&amp;sektion=8&amp;format=html">loader(8)</a> w trakcie uruchamiania systemu jest <span class=filename>/boot/device.hints</span>. Wykorzystując opcję <code>hints</code> możemy wkompilować je statycznie w jądro. Tym samym nie będzie potrzeby tworzyć pliku <span class=filename>device.hints</span> w katalogu <span class=filename>/boot</span>.</p></div><div class="literalblock programlisting"><div class=content><pre>makeoptions     DEBUG=-g          # Build kernel with gdb(1) debug symbols</pre></div></div><div class=paragraph><p>Typowy proces kompilacji FreeBSD wyświetla również informacje diagnostyczne w trakcie budowy jądra z użyciem opcji <code>-g</code>, która włącza wyświetlanie informacji diagnostycznych w <a href="https://man.freebsd.org/cgi/man.cgi?query=gcc&amp;sektion=1&amp;format=html">gcc(1)</a>. Ten sam efekt można również osiągnąć poprzez opcję <code>-g</code> w <a href="https://man.freebsd.org/cgi/man.cgi?query=config&amp;sektion=8&amp;format=html">config(8)</a> przy korzystaniu z "tradycyjnej" metody kompilacji jądra (<a href=#kernelconfig-building>Budowanie i instalowanie indywidualnego jądra</a> zawiera więcej informacji na temat budowy jądra).</p></div><div class="literalblock programlisting"><div class=content><pre>options          SCHED_4BSD         # 4BSD scheduler</pre></div></div><div class=paragraph><p>Tradycyjny i domyślny systemowy zarządca procesów FreeBSD. Nie zmieniajmy tego.</p></div><div class="literalblock programlisting"><div class=content><pre>options          PREEMPTION         # Enable kernel thread preemption</pre></div></div><div class=paragraph><p>Pozwala na wywłaszczanie wątków w jądrze przez wątki o wyższym priorytecie. Pozwala to na interaktywność i przerywanie wątków, by ukończyć pewne czynności wcześniej i uniknąć oczekiwania.</p></div><div class="literalblock programlisting"><div class=content><pre>options          INET              # InterNETworking</pre></div></div><div class=paragraph><p>Obsługa sieci. Należ pozostawić ten wpis, nawet jeśli nie planujemy podłączyć się do sieci. Większość programów wymaga przynajmniej urządzenia pętli zwrotnej loopback (np. tworzenie połączeń sieciowych wewnątrz naszego PC), więc jest to wpis bardzo istotny.</p></div><div class="literalblock programlisting"><div class=content><pre>options          INET6             # IPv6 communications protocols</pre></div></div><div class=paragraph><p>Umożliwia to obsługę protokołu komunikacyjnego IPv6.</p></div><div class="literalblock programlisting"><div class=content><pre>options          FFS               # Berkeley Fast Filesystem</pre></div></div><div class=paragraph><p>Jest to podstawowy dyskowy system plików. Należy go pozostawić, jeśli startujemy system z dysku twardego.</p></div><div class="literalblock programlisting"><div class=content><pre>options          SOFTUPDATES       # Enable FFS Soft Updates support</pre></div></div><div class=paragraph><p>Opcja ta umożliwia tzw. Soft Updates w jądrze, co potrafi przyspieszyć czas dostępu do dysku przy zapisie. Jednakże, nawet jeśli funkcja ta jest włączona w jądrze, musi zostać aktywowana dla wybranych dysków. Czy opcja ta jest włączona możemy sprawdzić w wyniku polecenia <a href="https://man.freebsd.org/cgi/man.cgi?query=mount&amp;sektion=8&amp;format=html">mount(8)</a>. Jeśli przy naszym dysku nie ma oznaczenia <code>soft-updates</code> oznacza to, że musimy ją włączyć wykorzystując polecenie <a href="https://man.freebsd.org/cgi/man.cgi?query=tunefs&amp;sektion=8&amp;format=html">tunefs(8)</a> (dla istniejących systemów plików) bądź <a href="https://man.freebsd.org/cgi/man.cgi?query=newfs&amp;sektion=8&amp;format=html">newfs(8)</a> (dla nowych systemów plików).</p></div><div class="literalblock programlisting"><div class=content><pre>options          UFS_ACL           # Support for access control lists</pre></div></div><div class=paragraph><p>Opcja ta włącza w jądrze obsługę list kontroli dostępu do systemu plików. Polega to na wykorzystaniu rozszerzonych atrybutów oraz systemu plików UFS2. <a href=./#fs-acl>File System Access Control Lists</a> opisuje dokładniej tę funkcjonalność. Domyślnie listy ACL są włączone i nie powinny być wyłączane w jądrze jeśli były wcześniej wykorzystywane w systemie plików, gdyż usunie to listy kontroli dostępu zmieniając metodę ochrony plików w nieprzewidywalny sposób.</p></div><div class="literalblock programlisting"><div class=content><pre>options          UFS_DIRHASH       # Improve performance on big directories</pre></div></div><div class=paragraph><p>Opcja ta zawiera kod szybszej obsługi dużych katalogów kosztem zużycia dodatkowej pamięci. Możemy pozostawić tę opcję dla dużych serwerów lub dla interaktywnej stacji roboczej, a zablokować ją kiedy system jest mało obciążony i posiada mało pamięci, a dostęp do dysków nie jest taki ważny, np. serwer z zaporą ogniową.</p></div><div class="literalblock programlisting"><div class=content><pre>options          MD_ROOT           # MD is a potential root device</pre></div></div><div class=paragraph><p>Opcja ta włącza obsługę wirtualnego dysku w pamięci RAM, wykorzystywanego jako główne urządzenie.</p></div><div class="literalblock programlisting"><div class=content><pre>options          NFSCLIENT         # Network Filesystem Client
options          NFSSERVER         # Network Filesystem Server
options          NFS_ROOT          # NFS usable as /, requires NFSCLIENT</pre></div></div><div class=paragraph><p>Sieciowy system plików. Jeżeli nie planujemy montowania partycji z serwera UNIX® poprzez TCP/IP, możemy zablokować te linie.</p></div><div class="literalblock programlisting"><div class=content><pre>options          MSDOSFS           # MSDOS Filesystem</pre></div></div><div class=paragraph><p>System plików MS-DOS®. Jeśli nie planujemy montowania dysków lub partycji sformatowanych pod DOS-em podczas startowania systemu, dla bezpieczeństwa zablokujmy tę linię. Automatycznie MSDOSFS będzie ładowane kiedy pierwszy raz zamontujemy DOSową partycje jak opisano powyżej. Również wyśmienity program <a class=package href=https://cgit.freebsd.org/ports/tree/emulators/mtools/>emulators/mtools</a> umożliwia dostęp do dyskietek DOSowych bez potrzeby ich montowania i odmontowywania (i bynajmniej nie jest potrzebny <code>MSDOSFS</code>).</p></div><div class="literalblock programlisting"><div class=content><pre>options          CD9660            # ISO 9660 Filesystem</pre></div></div><div class=paragraph><p>System plików ISO 9660 dla płyt CDROM. Jeśli nie posiadamy napędu CDROM możemy zablokować tę linię, lub gdy montujesz dane z CD okazjonalnie (od kiedy zamontujemy dane z CD po raz pierwszy, CD9660 będzie ładowany automatycznie). Płyty audio CD nie potrzebuje tego systemu plików.</p></div><div class="literalblock programlisting"><div class=content><pre>options          PROCFS            # Process filesystem (requires PSEUDOFS)</pre></div></div><div class=paragraph><p>System plików procesów. Jest to system plików "na niby" montowany w <span class=filename>/proc</span>, który dla takich programów jak <a href="https://man.freebsd.org/cgi/man.cgi?query=ps&amp;sektion=1&amp;format=html">ps(1)</a> posiada więcej informacji o tym jakie procesy są właśnie uruchomione. W większości przypadków wykorzystanie <code>PROCFS</code> nie jest wymagane, gdyż większość narzędzi diagnostycznych i monitorujących zostało zaadaptowanych do pracy bez <code>PROCFS</code>: Domyślne instalacje nie montują tego systemu plików.</p></div><div class="literalblock programlisting"><div class=content><pre>options          PSEUDOFS          # Pseudo-filesystem framework</pre></div></div><div class=paragraph><p>Jądra 6.X wykorzystujące <code>PROCFS</code> muszą również zawierać obsługę <code>PSEUDOFS</code>.</p></div><div class="literalblock programlisting"><div class=content><pre>options          GEOM_GPT          # GUID Partition Tables.</pre></div></div><div class=paragraph><p>Opcja ta umożliwia tworzenie dużej ilości partycji na pojedynczym dysku.</p></div><div class="literalblock programlisting"><div class=content><pre>options          COMPAT_43         # Compatible with BSD 4.3 [KEEP THIS!]</pre></div></div><div class=paragraph><p>Kompatybilność z systemem 4.3BSD. Należy pozostawić ten wpis; niektóre programy będą zachowywać się dziwnie jeśli zablokujemy tę opcję.</p></div><div class="literalblock programlisting"><div class=content><pre>options          COMPAT_FREEBSD4   # Compatible with FreeBSD4</pre></div></div><div class=paragraph><p>Opcja ta potrzebna jest w systemach FreeBSD 5.X i386™ i Alpha do obsługi aplikacji skompilowanych w starszych wersjach FreeBSD, wykorzystujących stary interfejs wywołań systemowych. Zaleca się by wykorzystywać tę opcję we wszystkich systemach i386™ i Alpha, w których mogą wykorzystywane starsze aplikacje; platformy wspierane dopiero od wersji 5.X, jak np. ia64 i sparc64, nie wymagają ten opcji.</p></div><div class="literalblock programlisting"><div class=content><pre>options          SCSI_DELAY=5000  # Delay (in ms) before probing SCSI</pre></div></div><div class=paragraph><p>Sprawi to, że jądro zatrzyma się na 5 sekund przed rozpoczęciem rozpoznawania w naszym systemie każdego urządzenia SCSI. Jeśli jednak posiadamy tylko urządzenia IDE, możemy ten wpis zignorować. W innym przypadku możemy zmniejszyć tę wartość i w ten sposób przyspieszyć start systemu. Gdy to zrobimy a FreeBSD będzie miał kłopoty z rozpoznawaniem urządzeń SCSI będziemy musieli zmienić tę wartość na większą.</p></div><div class="literalblock programlisting"><div class=content><pre>options          KTRACE            # ktrace(1) support</pre></div></div><div class=paragraph><p>Śledzenie procesów przez jądro, które jest użyteczne w diagnozowaniu.</p></div><div class="literalblock programlisting"><div class=content><pre>options          SYSVSHM           # SYSV-style shared memory</pre></div></div><div class=paragraph><p>Daje to systemom z rodziny V mechanizm współdzielenia pamięci. W działaniu ma to wiele wspólnego z mechanizmem XSHM w X-ach. Znaczna ilość programów obciążająca system graficzny zyska automatycznie na prędkości. Jeśli jesteśmy użytkownikiem X-ów koniecznie pozostawmy tę opcję.</p></div><div class="literalblock programlisting"><div class=content><pre>options          SYSVMSG           # SYSV-style message queues</pre></div></div><div class=paragraph><p>Wsparcie dla mechanizmu komunkatów w Systemach V. Opcja ta dodaje zaledwie kilkaset bajtów do jądra.</p></div><div class="literalblock programlisting"><div class=content><pre>options          SYSVSEM           # SYSV-style semaphores</pre></div></div><div class=paragraph><p>Wsparcie dla mechanizmu semaforów w Systemach V. Mniej przydatne w użyciu ale również dodaje tylko kilkaset bajtów do jądra.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Parametr <code>-p</code> polecenia <a href="https://man.freebsd.org/cgi/man.cgi?query=ipcs&amp;sektion=1&amp;format=html">ipcs(1)</a> wyświetli każdy proces, który używa tych dogodności Sytemów V.</p></div></td></tr></tbody></table></div><div class="literalblock programlisting"><div class=content><pre>options 	     _KPOSIX_PRIORITY_SCHEDULING # POSIX P1003_1B real-time extensions</pre></div></div><div class=paragraph><p>Rozszerzenia czasu rzeczywistego dodane w 1993 do POSIX®. Pewne aplikacje z kolekcji portów używają tego mechanizmu (jak np. StarOffice™).</p></div><div class="literalblock programlisting"><div class=content><pre>options          KBD_INSTALL_CDEV  # install a CDEV entry in /dev</pre></div></div><div class=paragraph><p>Opcja ta związana jest z obsługą klawiatury. Dodaje ona wpis CDEV w <span class=filename>/dev</span>.</p></div><div class="literalblock programlisting"><div class=content><pre>options          AHC_REG_PRETTY_PRINT     # Print register bitfields in debug
                                          # output.  Adds ~128k to driver.
options          AHD_REG_PRETTY_PRINT     # Print register bitfields in debug
                                          # output.  Adds ~215k to driver.</pre></div></div><div class=paragraph><p>Pomaga to w diagnozowaniu, wypisując łatwiejsze do odczytania definicje rejestrów.</p></div><div class="literalblock programlisting"><div class=content><pre>options          ADAPTIVE_GIANT    # Giant mutex is adaptive.</pre></div></div><div class=paragraph><p>Giant jest nazwą mechanizmu wzajemnego wykluczania (uśpiony mutex) chroniącego znaczną grupę zasobów jądra. Obecnie mechanizm ten stanowi niedopuszczalnie wąskie gardło w wydajności systemu, które jest zastępowane przez blokady zabezpieczające indywidualne zasoby. Opcja <code>ADAPTIVE_GIANT</code> powoduje, że Giant jest dołączany do zestawu adaptacyjnie zapętlanych muteksów. Co oznacza, że w momencie gdy wątek chce zablokować mutex Giant, który jest już zablokowany przez inny wątek bądź procesor, pierwszy wątek będzie pracował i oczekiwał na zwolnienie blokady. Normalnie, wątek przeszedłby do stanu uśpienia i oczekiwał na kolejną okazję uruchomienia. Jeśli nie jesteśmy przekonani, pozostawmy tę opcję włączoną.</p></div><div class="literalblock programlisting"><div class=content><pre>device          apic               # I/O APIC</pre></div></div><div class=paragraph><p>Urządzenie apic pozwala na wykorzystanie we/wy APIC do dostarczania przerwań. Urządzenie apic może być wykorzystywane zarówno w jądrach UP jak i SMP, przy czym wymagane jest jedynie w przypadku tych drugich. By włączyć obsługę wielu procesorów należy dodać wiersz <code>options SMP</code>.</p></div><div class="literalblock programlisting"><div class=content><pre>device          eisa</pre></div></div><div class=paragraph><p>Należy włączyć to jeśli posiadamy płytę główną typu EISA. Umożliwia to autodetekcję i konfigurację dla wszystkich urządzeń pracujących na magistrali EISA.</p></div><div class="literalblock programlisting"><div class=content><pre>device          pci</pre></div></div><div class=paragraph><p>Włączmy to jeśli posiadamy płyte główną typu PCI. Umożliwia to autodetekcję kart PCI i przesyłanie z magistrali PCI do ISA.</p></div><div class="literalblock programlisting"><div class=content><pre># Floppy drives
device          fdc</pre></div></div><div class=paragraph><p>Kontroler stacji dyskietek.</p></div><div class="literalblock programlisting"><div class=content><pre># ATA and ATAPI devices
device          ata</pre></div></div><div class=paragraph><p>Sterownik ten obsługuje wszystkie urządzenia ATA i ATAPI. Potrzebujemy tylko tej jednej linijki, aby jądro wykrywało wszystkie urządzenia na współczesnych maszynach.</p></div><div class="literalblock programlisting"><div class=content><pre>device          atadisk                 # ATA disk drives</pre></div></div><div class=paragraph><p>Potrzebne jest to razem z <code>device ata</code> dla dysków ATA.</p></div><div class="literalblock programlisting"><div class=content><pre>device          ataraid                 # ATA RAID drives</pre></div></div><div class=paragraph><p>Potrzebne jest to razem z <code>device ata</code> dla dysków ATA RAID.</p></div><div class="literalblock programlisting"><div class=content><pre>device          atapicd                 # ATAPI CDROM drives</pre></div></div><div class=paragraph><p>Potrzebne jest to razem z <code>device ata</code> dla napędów CDROM ATAPI.</p></div><div class="literalblock programlisting"><div class=content><pre>device          atapifd                 # ATAPI floppy drives</pre></div></div><div class=paragraph><p>Potrzebne jest to razem z <code>device ata</code> dla stacji dyskietek ATAPI.</p></div><div class="literalblock programlisting"><div class=content><pre>device          atapist                 # ATAPI tape drives</pre></div></div><div class=paragraph><p>Potrzebne jest to razem z <code>device ata</code> dla urządzeń taśmowych ATAPI.</p></div><div class="literalblock programlisting"><div class=content><pre>options         ATA_STATIC_ID           # Static device numbering</pre></div></div><div class=paragraph><p>Powoduje to przydzielanie przez kontroler statycznego numeru, inaczej liczba dyskowa będzie przydzielana dynamicznie.</p></div><div class="literalblock programlisting"><div class=content><pre># SCSI Controllers
device          ahb        # EISA AHA1742 family
device          ahc        # AHA2940 and onboard AIC7xxx devices
device          ahd        # AHA39320/29320 and onboard AIC79xx devices
device          amd        # AMD 53C974 (Teckram DC-390(T))
device          isp        # Qlogic family
#device         ispfw      # Firmware for QLogic HBAs- normally a module
device          mpt        # LSI-Logic MPT-Fusion
#device         ncr        # NCR/Symbios Logic
device          sym        # NCR/Symbios Logic (newer chipsets)
device          trm        # Tekram DC395U/UW/F DC315U adapters

device          adv        # Advansys SCSI adapters
device          adw        # Advansys wide SCSI adapters
device          aha        # Adaptec 154x SCSI adapters
device          aic        # Adaptec 15[012]x SCSI adapters, AIC-6[23]60.
device          bt         # Buslogic/Mylex MultiMaster SCSI adapters

device          ncv        # NCR 53C500
device          nsp        # Workbit Ninja SCSI-3
device          stg        # TMC 18C30/18C50</pre></div></div><div class=paragraph><p>Kontrolery SCSI. Należy zablokować te kontrolery, których nie posiadamy w naszym systemie. Jeśli mamy system oparty tylko na IDE możemy pozbyć się całej listy.</p></div><div class="literalblock programlisting"><div class=content><pre># SCSI peripherals
device          scbus      # SCSI bus (required for SCSI)
device          ch         # SCSI media changers
device          da         # Direct Access (disks)
device          sa         # Sequential Access (tape etc)
device          cd         # CD
device          pass       # Passthrough device (direct SCSI access)
device          ses        # SCSI Environmental Services (and SAF-TE)</pre></div></div><div class=paragraph><p>Peryferia SCSI. Ponownie, jeśli nie posiadamy takowych możemy je wyłączyć lub jeśli posiadamy tylko sprzęt IDE możemy wszystkie powyższe wpisy usunąć.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Sterownik USB <a href="https://man.freebsd.org/cgi/man.cgi?query=umass&amp;sektion=4&amp;format=html">umass(4)</a> i kilka innych sterowników wykorzystuje podsystem SCSI chociaż nie są one prawdziwymi urządzeniami SCSI. Tym samym musimy pamiętać by nie usunąć całkowicie obsługi SCSI jeśli którykolwiek z tego typu sterowników został uwzględniony w konfiguracji jądra.</p></div></td></tr></tbody></table></div><div class="literalblock programlisting"><div class=content><pre># RAID controllers interfaced to the SCSI subsystem
device          amr        # AMI MegaRAID
device          arcmsr     # Areca SATA II RAID
device          asr        # DPT SmartRAID V, VI and Adaptec SCSI RAID
device          ciss       # Compaq Smart RAID 5*
device          dpt        # DPT Smartcache III, IV - See NOTES for options
device          hptmv      # Highpoint RocketRAID 182x
device          rr232x     # Highpoint RocketRAID 232x
device          iir        # Intel Integrated RAID
device          ips        # IBM (Adaptec) ServeRAID
device          mly        # Mylex AcceleRAID/eXtremeRAID
device          twa        # 3ware 9000 series PATA/SATA RAID

# RAID controllers
device          aac        # Adaptec FSA RAID
device          aacp       # SCSI passthrough for aac (requires CAM)
device          ida        # Compaq Smart RAID
device          mfi        # LSI MegaRAID SAS
device          mlx        # Mylex DAC960 family
device          pst        # Promise Supertrak SX6000
device          twe        # 3ware ATA RAID</pre></div></div><div class=paragraph><p>Obsługa kontrolerów RAID. Jeśli nie posiadamy żadnych kontrolerów RAID, możemy te wpisy zablokować lub usunąć.</p></div><div class="literalblock programlisting"><div class=content><pre># atkbdc0 controls both the keyboard and the PS/2 mouse
device          atkbdc     # AT keyboard controller</pre></div></div><div class=paragraph><p>Sterownik klawiatury (<code>atkbdc</code>) obsługujący porty we/wy dla klawiatur AT i dla urządzeń wskazujących PS/2. Wymagany jest przez sterownik klawiatur (<code>atkbd</code>) i PS/2 (<code>psm</code>).</p></div><div class="literalblock programlisting"><div class=content><pre>device          atkbd      # AT keyboard</pre></div></div><div class=paragraph><p>Sterownik <code>atkbd</code> razem z kontrolerem <code>atkbdc</code> umożliwiają dostęp do klawiatury AT84 lub do rozszerzonej klawiatury, które podłączone są do kontrolera AT.</p></div><div class="literalblock programlisting"><div class=content><pre>device          psm        # PS/2 mouse</pre></div></div><div class=paragraph><p>Urządzenie to należy wykorzystać jeśli nasza myszka jest podłączona do portu PS/2.</p></div><div class="literalblock programlisting"><div class=content><pre>device          kbdmux        # keyboard multiplexer</pre></div></div><div class=paragraph><p>Podstawowa obsługa multipleksacji klawiatury.</p></div><div class="literalblock programlisting"><div class=content><pre>device          vga        # VGA video card driver</pre></div></div><div class=paragraph><p>Sterownik kart video.</p></div><div class="literalblock programlisting"><div class=content><pre>device          splash     # Splash screen and screen saver support</pre></div></div><div class=paragraph><p>Obraz tytułowy w trakcie startu! Wymagany również przez wygaszacze ekranu.</p></div><div class="literalblock programlisting"><div class=content><pre># syscons is the default console driver, resembling an SCO console
device          sc</pre></div></div><div class=paragraph><p><code>sc</code> jest domyślnym sterownikiem konsoli, przypominający konsolę SCO. Wiele programów pracujących w trybie pełnoekranowym uzyskują dostęp do konsoli poprzez biblioteki bazy danych terminala takie jak <span class=filename>termcap</span>, nie powinno więc być istotne czy używamy właśnie jego czy <code>vt</code>, sterownika zgodnego z <code>VT220</code>. Kiedy logujemy się, a nasz program ma kłopoty podczas uruchamiania spod konsoli, należy ustawić zmienną <code>TERM</code> na <code>scoansi</code>.</p></div><div class="literalblock programlisting"><div class=content><pre># Enable this for the pcvt (VT220 compatible) console driver
#device          vt
#options         XSERVER          # support for X server on a vt console
#options         FAT_CURSOR       # start with block cursor</pre></div></div><div class=paragraph><p>Sterowniki konsoli kompatybilnej z VT220 i z wcześniejszymi VT100/102. Dobrze pracują na niektórych laptopach nie posiadających sprzętu kompatybilnego z <code>sc</code>. Również w takim przypadku należy zmodyfikować zmienną <code>TERM</code> na <code>vt100</code> lub <code>vt220</code>, kiedy się logujemy. Sterownik ten może być również użyteczny kiedy łączymy się z dużą liczbą różnorodnych maszyn w sieci, gdzie <span class=filename>termcap</span> lub <span class=filename>terminfo</span> często nie posiadają wpisów dla urządzeń <code>sc</code> - wówczas <code>vt100</code> powinien być dostępny praktycznie na wszystkich platformach.</p></div><div class="literalblock programlisting"><div class=content><pre>device          agp</pre></div></div><div class=paragraph><p>Należy włączyć tę opcję jeśli posiadamy kartę AGP w systemie. Włączy to obsługę AGP i AGP GART dla płyt głównych obsługujących te funkcje.</p></div><div class="literalblock programlisting"><div class=content><pre># Power management support (see NOTES for more options)
#device          apm</pre></div></div><div class=paragraph><p>Zaawansowane zarządzanie energią. Użyteczne dla laptopów, chociaż we FreeBSD 5.X i późniejszych opcja ta jest domyślnie wyłączona w jądrze <span class=filename>GENERIC</span>.</p></div><div class="literalblock programlisting"><div class=content><pre># Add suspend/resume support for the i8254.
device           pmtimer</pre></div></div><div class=paragraph><p>Sterownik urządzenia regulatora czasowego dla zarządzania energią, jak np. APM i ACPI.</p></div><div class="literalblock programlisting"><div class=content><pre># PCCARD (PCMCIA) support
# PCMCIA and cardbus bridge support
device          cbb               # cardbus (yenta) bridge
device          pccard            # PC Card (16-bit) bus
device          cardbus           # CardBus (32-bit) bus</pre></div></div><div class=paragraph><p>Obsługa kart PCMCIA. Potrzebna dla laptopów.</p></div><div class="literalblock programlisting"><div class=content><pre># Serial (COM) ports
device          sio               # 8250, 16[45]50 based serial ports</pre></div></div><div class=paragraph><p>Są to porty szeregowe nazywane w terminologii MS-DOS®/Windows® <span class=filename>COM</span>.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Jeśli posiadamy wewnętrzny modem na <span class=filename>COM4</span> oraz port szeregowy <span class=filename>COM2</span>, należy zmienić IRQ modemu na 2 (z technicznych pobudek IRQ2 = IRQ9) bo takiej kolejności wymaga FreeBSD. Jeśli posiadamy wieloportową kartę szeregową musimy odwołać się do podręcznika systemowego <a href="https://man.freebsd.org/cgi/man.cgi?query=sio&amp;sektion=4&amp;format=html">sio(4)</a> po więcej informacji o właściwych ustawieniach w pliku <span class=filename>/boot/device.hints</span>. Niektóre karty wideo (zwłaszcza te bazujące na chipie S3) używają adresów we/wy w postaci <code>0x*2e8</code>, a ponieważ wiele tanich kart szeregowych nie dekoduje w pełni 16-bitowej przestrzeni adresowej we/wy, powodują one konflikt sprzętowy czyniąc port <span class=filename>COM4</span> praktycznie niedostępnym.</p></div><div class=paragraph><p>Każdy port szeregowy wymaga unikalnego IRQ (z wyjątkiem multiportów gdzie współdzielenie przerwania jest obsługiwane) zatem domyślne IRQ dla <span class=filename>COM3</span> i <span class=filename>COM4</span> nie mają zastosowania.</p></div></td></tr></tbody></table></div><div class="literalblock programlisting"><div class=content><pre># Parallel port
device          ppc</pre></div></div><div class=paragraph><p>Interfejs portu równoległego na magistrali ISA.</p></div><div class="literalblock programlisting"><div class=content><pre>device          ppbus      # Parallel port bus (required)</pre></div></div><div class=paragraph><p>Umożliwia obsługę portów równoległych.</p></div><div class="literalblock programlisting"><div class=content><pre>device          lpt        # Printer</pre></div></div><div class=paragraph><p>Obsługa drukarek na porcie równoległym.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Powyższe trzy wpisy są wymagane, by było możliwe korzystanie z drukarek na porcie równoległym.</p></div></td></tr></tbody></table></div><div class="literalblock programlisting"><div class=content><pre>device          plip       # TCP/IP over parallel</pre></div></div><div class=paragraph><p>Sterownik dla równoległego interfejsu sieciowego.</p></div><div class="literalblock programlisting"><div class=content><pre>device          ppi        # Parallel port interface device</pre></div></div><div class=paragraph><p>Uniwersalny port we/wy + IEEE1284.</p></div><div class="literalblock programlisting"><div class=content><pre>#device         vpo        # Requires scbus and da</pre></div></div><div class=paragraph><p>Napęd ZIP firmy Iomega. Wymagane sterowniki <code>scbus</code> i <code>da</code>. Najlepszą wydajność można osiągnąć wykorzystując porty w trybie EPP 1.9.</p></div><div class="literalblock programlisting"><div class=content><pre>#device         puc</pre></div></div><div class=paragraph><p>Opcję tę należy odblokować jeśli posiadamy "niemą" szeregową lub równoległa kartę PCI, obsługiwaną przez sterownik <a href="https://man.freebsd.org/cgi/man.cgi?query=puc&amp;sektion=4&amp;format=html">puc(4)</a>.</p></div><div class="literalblock programlisting"><div class=content><pre># PCI Ethernet NICs.
device          de         # DEC/Intel DC21x4x (Tulip)
device          em         # Intel PRO/1000 adapter Gigabit Ethernet Card
device          ixgb       # Intel PRO/10GbE Ethernet Card
device          txp        # 3Com 3cR990 (Typhoon)
device          vx         # 3Com 3c590, 3c595 (Vortex)</pre></div></div><div class=paragraph><p>Różne karty sieciowe na złączu PCI. Należy zablokować lub usunąć te z nich, które nie są obecne w naszym systemie.</p></div><div class="literalblock programlisting"><div class=content><pre># PCI Ethernet NICs that use the common MII bus controller code.
# NOTE: Be sure to keep the &#39;device miibus&#39; line in order to use these NICs!
device          miibus     # MII bus support</pre></div></div><div class=paragraph><p>Obsługa szyny MII wymagana dla wielu kart sieciowych 10/100 na złączu PCI, wykorzystujących nadajniki-odbiorniki zgodne z MII lub mają wbudowany nadbiornik pracujący jak MII. Dodanie <code>device miibus</code> do jądra pozwoli na obsługę miibus API i wszystkich sterowników PHY, włączając te, które nie wymagają indywidualnych ustawień i sterowników.</p></div><div class="literalblock programlisting"><div class=content><pre>device          bce        # Broadcom BCM5706/BCM5708 Gigabit Ethernet
device          bfe        # Broadcom BCM440x 10/100 Ethernet
device          bge        # Broadcom BCM570xx Gigabit Ethernet
device          dc         # DEC/Intel 21143 and various workalikes
device          fxp        # Intel EtherExpress PRO/100B (82557, 82558)
device          lge        # Level 1 LXT1001 gigabit ethernet
device          nge        # NatSemi DP83820 gigabit ethernet
device          nve        # nVidia nForce MCP on-board Ethernet Networking
device          pcn        # AMD Am79C97x PCI 10/100 (precedence over &#39;lnc&#39;)
device          re         # RealTek 8139C+/8169/8169S/8110S
device          rl         # RealTek 8129/8139
device          sf         # Adaptec AIC-6915 (Starfire)
device          sis        # Silicon Integrated Systems SiS 900/SiS 7016
device          sk         # SysKonnect SK-984x &amp; SK-982x gigabit Ethernet
device          ste        # Sundance ST201 (D-Link DFE-550TX)
device          ti         # Alteon Networks Tigon I/II gigabit Ethernet
device          tl         # Texas Instruments ThunderLAN
device          tx         # SMC EtherPower II (83c170 EPIC)
device          vge        # VIA VT612x gigabit ethernet
device          vr         # VIA Rhine, Rhine II
device          wb         # Winbond W89C840F
device          xl         # 3Com 3c90x (Boomerang, Cyclone)</pre></div></div><div class=paragraph><p>Sterowniki wykorzystujące szynę MII.</p></div><div class="literalblock programlisting"><div class=content><pre># ISA Ethernet NICs.  pccard NICs included.
device          cs         # Crystal Semiconductor CS89x0 NIC
# &#39;device ed&#39; requires &#39;device miibus&#39;
device          ed         # NE[12]000, SMC Ultra, 3c503, DS8390 cards
device          ex         # Intel EtherExpress Pro/10 and Pro/10+
device          ep         # Etherlink III based cards
device          fe         # Fujitsu MB8696x based cards
device          ie         # EtherExpress 8/16, 3C507, StarLAN 10 etc.
device          lnc        # NE2100, NE32-VL Lance Ethernet cards
device          sn         # SMC&#39;s 9000 series of Ethernet chips
device          xe         # Xircom pccard Ethernet

# ISA devices that use the old ISA shims
#device         le</pre></div></div><div class=paragraph><p>Sterowniki ISA Ethernet. Plik <span class=filename>/usr/src/sys/i386/conf/NOTES</span> zawiera szczegółowy opis, która karta jest obsługiwana przez dany sterownik.</p></div><div class="literalblock programlisting"><div class=content><pre># Wireless NIC cards
device          wlan       # 802.11 support
device          an         # Aironet 4500/4800 802.11 wireless NICs.
device          awi        # BayStack 660 and others
device          ral        # Ralink Technology RT2500 wireless NICs.
device          wi         # WaveLAN/Intersil/Symbol 802.11 wireless NICs.
#device         wl         # Older non 802.11 Wavelan wireless NIC.</pre></div></div><div class=paragraph><p>Obsługa różnych kart bezprzewodowych.</p></div><div class="literalblock programlisting"><div class=content><pre># Pseudo devices
device   loop          # Network loopback</pre></div></div><div class=paragraph><p>Standardowe urządzenie pętli zwrotnej dla TCP/IP. Jeśli łączymy się z <code>localhost</code> (a.k.a. <code>127.0.0.1</code>) za pomocą telnetu bądź FTP, połączenie powróci do nas za pomocą tego urządzenia. Obecność tego wpisu w konfiguracji jądra jest <em>niezbędna</em>.</p></div><div class="literalblock programlisting"><div class=content><pre>device   random        # Entropy device</pre></div></div><div class=paragraph><p>Bezpieczny z kryptograficznego punktu widzenia generator liczb losowych.</p></div><div class="literalblock programlisting"><div class=content><pre>device   ether         # Ethernet support</pre></div></div><div class=paragraph><p><code>ether</code> jest wymagany tylko wówczas, gdy posiadamy kartę Ethernet. Zawiera podstawowy kod protokołu Ethernet.</p></div><div class="literalblock programlisting"><div class=content><pre>device   sl            # Kernel SLIP</pre></div></div><div class=paragraph><p><code>sl</code> służy do obsługi SLIP. Zostało prawie całkowicie wyparte przez PPP, które jest łatwiejsze w obsłudze, lepiej przystosowane do połączeń modem - modem i posiada więcej możliwości.</p></div><div class="literalblock programlisting"><div class=content><pre>device   ppp           # Kernel PPP</pre></div></div><div class=paragraph><p>Wsparcie jądra dla PPP przy połączeniach wdzwanianych. Jest również w niej zaimplementowana wersja PPP, dla wielu aplikacji używających <code>tun</code>, oferująca większą elastyczność i funkcjonalności takie jak np. połączenie na żądanie (demand dialing).</p></div><div class="literalblock programlisting"><div class=content><pre>device   tun           # Packet tunnel.</pre></div></div><div class=paragraph><p>Używane przez rodzinę aplikacji korzystających z PPP. Więcej informacji na ten temat zawiera rozdział niniejszego Podręcznika poświęcony właśnie <a href=./#userppp>PPP</a>.</p></div><div class="literalblock programlisting"><div class=content><pre>device   pty           # Pseudo-ttys (telnet etc)</pre></div></div><div class=paragraph><p>Jest to "pseudo-terminal" wykorzystywany przez przychodzące sesje <code>telnet</code> i <code>rlogin</code>, xterm oraz kilka innych aplikacji, jak np. Emacs.</p></div><div class="literalblock programlisting"><div class=content><pre>device   md            # Memory disks</pre></div></div><div class=paragraph><p>Pseudo urządzenie memory-disk.</p></div><div class="literalblock programlisting"><div class=content><pre>device   gif           # IPv6 and IPv4 tunneling</pre></div></div><div class=paragraph><p>Implementacja tunelowania IPv6 przez IPv4, IPv4 przez IPv6, IPv4 przez IPv4 oraz IPv6 przez IPv6. Urządzenie <code>gif</code> posiada cechę "auto-klonowania", co umożliwia tworzenie wymaganych plików urządzeń.</p></div><div class="literalblock programlisting"><div class=content><pre>device   faith         # IPv6-to-IPv4 relaying (translation)</pre></div></div><div class=paragraph><p>To pseudo-urządzenie wyłapuje przesłane do niego pakiety i przekazuje je do demona translacji IPv4/IPv6.</p></div><div class="literalblock programlisting"><div class=content><pre># The `bpf&#39; device enables the Berkeley Packet Filter.
# Be aware of the administrative consequences of enabling this!
# Note that &#39;bpf&#39; is required for DHCP.
device   bpf           # Berkeley packet filter</pre></div></div><div class=paragraph><p>Filtr pakietów rodem z Berkeley. To pseudo-urządzenie pozwala interfejsom sieciowym pracować w trybie nasłuchiwania, wyłapując każdy pakiet wysłany w sieci (np w sieci Ethernet). Pakiety te mogą zostać zapisane na dysku i/lub sprawdzane programem <a href="https://man.freebsd.org/cgi/man.cgi?query=tcpdump&amp;sektion=1&amp;format=html">tcpdump(1)</a>.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Urządzenie <a href="https://man.freebsd.org/cgi/man.cgi?query=bpf&amp;sektion=4&amp;format=html">bpf(4)</a> jest również wykorzystywane przez <a href="https://man.freebsd.org/cgi/man.cgi?query=dhclient&amp;sektion=8&amp;format=html">dhclient(8)</a>, by uzyskać adres IP domyślnego rutera (bramki) itp. Jeśli używamy DHCP pozostawmy ten wpis.</p></div></td></tr></tbody></table></div><div class="literalblock programlisting"><div class=content><pre># USB support
device          uhci          # UHCI PCI-&gt;USB interface
device          ohci          # OHCI PCI-&gt;USB interface
#device         ehci          # EHCI PCI-&gt;USB interface (USB 2.0)
device          usb           # USB Bus (required)
#device         udbp          # USB Double Bulk Pipe devices
device          ugen          # Generic
device          uhid          # Human Interface Devices
device          ukbd          # Keyboard
device          ulpt          # Printer
device          umass         # Disks/Mass storage - Requires scbus and da
device          ums           # Mouse
device          urio          # Diamond Rio 500 MP3 player
device          uscanner      # Scanners
# USB Ethernet, requires mii
device          aue           # ADMtek USB Ethernet
device          axe           # ASIX Electronics USB Ethernet
device          cdce          # Generic USB over Ethernet
device          cue           # CATC USB Ethernet
device          kue           # Kawasaki LSI USB Ethernet
device          rue           # RealTek RTL8150 USB Ethernet</pre></div></div><div class=paragraph><p>Obsługa wielu urządzeń USB.</p></div><div class="literalblock programlisting"><div class=content><pre># FireWire support
device          firewire      # FireWire bus code
device          sbp           # SCSI over FireWire (Requires scbus and da)
device          fwe           # Ethernet over FireWire (non-standard!)</pre></div></div><div class=paragraph><p>Obsługa różnorodnych urządzeń Firewire.</p></div><div class=paragraph><p>Więcej informacji o wymienionych oraz dodatkowych urządzeniach obsługiwanych przez FreeBSD znaleźć można w pliku <span class=filename>/usr/src/sys/i386/conf/NOTES</span>.</p></div><div class=sect3><h4 id=_konfiguracja_dużego_rozmiaru_pamięci_pae>8.4.1. Konfiguracja dużego rozmiaru pamięci (PAE)<a class=anchor href=#_konfiguracja_dużego_rozmiaru_pamięci_pae></a></h4><div class=paragraph><p>Maszyny dużego rozmiaru pamięci wymagają dostępu do większej ilości pamięci niż 4 gigabajty, do których ograniczona jest przestrzeń wirtualnych adresów użytkowników+jądra (ang. User+Kernel Virtual Address, KVA). Z tego właśnie powodu Intel dodał w procesorach serii Pentium® Pro i późniejszych obsługę 36-bitowej przestrzeni adresów pamięci fizycznej.</p></div><div class=paragraph><p>Rozszerzenie PAE (ang. Physical Address Extension) procesorów Intel® Pentium® Pro i późniejszych pozwala na instalację do 64 gigabajtów pamięci. FreeBSD potrafi obsługiwać te rozszerzenie poprzez opcję konfiguracji jądra <code>PAE</code>, dostępną we wszystkich bieżących wersjach. Z uwagi na ograniczenia występujące w architekturze pamięci Intela, nie istnieje rozróżnienie pomiędzy rozmiarem pamięci poniżej i powyżej 4 gigabajtów. Pamięć znajdująca się powyżej jest po prostu dodawana do puli dostępnej pamięci.</p></div><div class=paragraph><p>By aktywować obsługę PAE w jądrze, wystarczy dodać poniższy wiersz do pliku konfiguracyjnego naszego jądra:</p></div><div class="literalblock programlisting"><div class=content><pre>options		    PAE</pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Obsługa PAE jest dostępna we FreeBSD jedynie dla procesorów Intel® IA-32. Należy również zwrócić uwagę, iż obsługa PAE we FreeBSD nie została szeroko przetestowana i powinna być traktowana jako drugiej jakości w porównaniu z innymi stabilnymi funkcjami FreeBSD.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Obsługa PAE we FreeBSD posiada również pewne ograniczenia:</p></div><div class=ulist><ul><li><p>Dany proces nie ma dostępu do więcej jak 4 gigabajtów przestrzeni pamięci wirtualnej VM.</p></li><li><p>Moduły KLD nie mogą być ładowane do jądra z włączoną opcją PAE, z uwagi na różnice w strukturze skompilowanego modułu i jądra.</p></li><li><p>Sterowniki urządzeń nie wykorzystujące interfejsu <a href="https://man.freebsd.org/cgi/man.cgi?query=bus_dma&amp;sektion=9&amp;format=html">bus_dma(9)</a> spowodują utratę danych w jądrze z włączoną opcją PAE. Tym samym odradza się ich stosowanie. Z tego właśnie powodu plik konfiguracyjny jądra z opcją <span class=filename>PAE</span> jest dostarczany w wersji FreeBSD nie zawierającej żadnych ze sterowników, o których nie wiadomo, że współpracują poprawnie z jądrem z włączoną opcją PAE.</p></li><li><p>Niektóre narzędzia dostrajania systemu określają wykorzystanie zasobów pamięci na podstawie ilości dostępnej pamięci fizycznej. Takie programy mogą niepotrzebnie przydzielać więcej pamięci niż powinny, z uwag na naturę dużego rozmiaru pamięci systemu PAE. Przykładem może być opcja sysctl <code>kern.maxvnodes</code>, która kontroluje maksymalną liczbę dopuszczalnych węzłów w jądrze. Zaleca się modyfikację tych i innych parametrów do rozsądnych wartości.</p></li><li><p>Może być potrzebnym zwiększenie rozmiaru przestrzeni adresów KVA bądź redukcja ilości specyficznych zasobów jądra często wykorzystywanych (patrz wyżej) w celu uniknięcia wyczerpania KVA. Do zwiększenia przestrzeni KVA może być wykorzystania opcja jądra <code>KVA_PAGES</code>.</p></li></ul></div><div class=paragraph><p>W przypadku uwag odnośnie wydajności i stabilności pracy zaleca się lekturę podręcznika systemowego <a href="https://man.freebsd.org/cgi/man.cgi?query=tuning&amp;sektion=7&amp;format=html">tuning(7)</a>. Podręcznik systemowy <a href="https://man.freebsd.org/cgi/man.cgi?query=pae&amp;sektion=4&amp;format=html">pae(4)</a> zawiera natomiast aktualne informacje odnośnie obsługi PAE we FreeBSD.</p></div></div></div><div class=sect2><h3 id=kernelconfig-trouble>8.5. Jeśli pojawią się kłopoty<a class=anchor href=#kernelconfig-trouble></a></h3><div class=paragraph><p>Istnieje pięć kategorii problemów, które możemy napotkać budując jądro. Oto one:</p></div><div class=dlist><dl><dt class=hdlist1>Błąd <code>config</code></dt><dd><p>Jeśli program <a href="https://man.freebsd.org/cgi/man.cgi?query=config&amp;sektion=8&amp;format=html">config(8)</a> zgłosił błąd podczas przetwarzania naszego pliku konfiguracyjnego, najprawdopodobniej popełniliśmy mały błąd w postaci literówki. Na szczęście <a href="https://man.freebsd.org/cgi/man.cgi?query=config&amp;sektion=8&amp;format=html">config(8)</a> wyświetli linię, z którą miał problem, dzięki czemu będziemy mogli szybko do niej dotrzeć. Na przykład, jeśli widzimy:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>config: line 17: syntax error</code></pre></div></div><div class=paragraph><p>Upewnijmy się, że słowo kluczowe zostało poprawnie wprowadzone, porównując z oryginalnym plikiem <span class=filename>GENERIC</span> lub z innym wiarygodnym źródłem.</p></div></dd><dt class=hdlist1>Błąd <code>make</code></dt><dd><p>Jeśli pojawił się błąd podczas wykonywania polecenia <code>make</code>, zwykle wskazuje to na błąd w naszym opisie jądra. Nie jest to jednak błąd na tyle wyraźny, aby wykazał go <a href="https://man.freebsd.org/cgi/man.cgi?query=config&amp;sektion=8&amp;format=html">config(8)</a>. Jak poprzednio, musimy przejrzeć plik konfiguracyjny jądra. Jeśli w dalszym ciągu nie możemy rozwiązać problemu, możemy wysłać nasz plik konfiguracyjny na <a href=https://lists.FreeBSD.org/subscription/freebsd-questions>FreeBSD general questions mailing list</a> gdzie nasz problem zostanie rozwiązany bardzo szybko.</p><div class=dlist><dl><dt class=hdlist1>Jądro nie uruchamia się ponownie:<a id=kernelconfig-noboot></a></dt><dd><p>Jeśli nasze nowe jądro nie uruchamia się ponownie, bądź nie potrafi rozpoznać urządzeń, nie panikujmy! Na szczęście, FreeBSD jest wyposażone we wspaniały mechanizm przywracania po instalacji niekompatybilnego jądra. Po prostu musimy wybrać w loaderze jądro, które chcemy uruchomić. Możemy to zrobić, gdy system odlicza od 10 w dół. Wybieramy opcję numer sześć: "Escape to a loader prompt". Wpisujemy <code>unload kernel</code> a następnie <code>boot /boot/kernel.old/kernel</code>, lub jakąkolwiek inną nazwę jądra, które uruchomi się poprawnie. Jeśli rekonfigurujemy jądro, jedno sprawne powinniśmy mieć zawsze pod ręką.</p><div class=paragraph><p>Po uruchomieniu z dobrym jądrem, możemy sprawdzić nasz plik konfiguracyjny, a następnie spróbować zbudować je ponownie. Pomocny jest plik <span class=filename>/var/log/messages</span>, w którym, pośród innych rzeczy, znajdują się również zapisy z uruchomień jądra. Ponadto również <a href="https://man.freebsd.org/cgi/man.cgi?query=dmesg&amp;sektion=8&amp;format=html">dmesg(8)</a> wyświetla informacje z jądra, pochodzące z bieżącego uruchomienia.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Jeśli mamy problemy ze zbudowaniem jądra, upewnijmy się, że posiadamy jądro <span class=filename>GENERIC</span> lub inne działające jądro nazwane tak, by nie zostało nadpisane po kolejnym procesie budowy. Nie możemy polegać na <span class=filename>kernel.old</span>, ponieważ gdy instalujemy nowe jądro, <span class=filename>kernel.old</span> jest nadpisywane przez ostatnio zainstalowane jądro, które może być niedziałające. Ponadto, powinniśmy tak szybko, jak to tylko możliwe, przenieść działające jądro do właściwej lokalizacji <span class=filename>/boot/kernel</span>, albo komendy takie jak <a href="https://man.freebsd.org/cgi/man.cgi?query=ps&amp;sektion=1&amp;format=html">ps(1)</a> nie będą działały poprawnie. By to zrobić wystarczy zmienić nazwę katalogu zawierającego właściwe jądro:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mv /boot/kernel /boot/kernel.bad</span>
<span class=c># mv /boot/kernel.good /boot/kernel</span></code></pre></div></div></td></tr></tbody></table></div></dd></dl></div></dd><dt class=hdlist1>Jądro działa, ale przestało <a href="https://man.freebsd.org/cgi/man.cgi?query=ps&amp;sektion=1&amp;format=html">ps(1)</a></dt><dd><p>Jeśli zainstalowaliśmy inną wersję jądra, niż tą, z którą były budowane narzędzia systemowe, na przykład jądro -CURRENT na systemie -RELEASE, wiele poleceń pokazujących stan systemu, jak <a href="https://man.freebsd.org/cgi/man.cgi?query=ps&amp;sektion=1&amp;format=html">ps(1)</a>, czy <a href="https://man.freebsd.org/cgi/man.cgi?query=vmstat&amp;sektion=8&amp;format=html">vmstat(8)</a> nie będzie działało. Musimy dokonać <a href=./#makeworld>rekompilacji i instalacji world</a> zbudowanych na podstawie tej samej wersji źródeł co nasze jądro. Jest to jeden z powodów, przez które nie jest najlepszym pomysłem instalowanie różnych wersji jądra i systemu operacyjnego.</p></dd></dl></div></div></div></div><div class=sect1><h2 id=printing>Rozdział 9. Printing<a class=anchor href=#printing></a></h2><div class=sectionbody><div class=paragraph><p>Putting information on paper is a vital function, despite many attempts to eliminate it. Printing has two basic components. The data must be delivered to the printer, and must be in a form that the printer can understand.</p></div><div class=sect2><h3 id=printing-quick-start>9.1. Quick Start<a class=anchor href=#printing-quick-start></a></h3><div class=paragraph><p>Basic printing can be set up quickly. The printer must be capable of printing plain <code>ASCII</code> text. For printing to other types of files, see <a href=#printing-lpd-filters>Filters</a>.</p></div><div class="sidebarblock procedure"><div class=content><div class="olist arabic"><ol class=arabic><li><p>Create a directory to store files while they are being printed:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mkdir -p /var/spool/lpd/lp</span>
<span class=c># chown daemon:daemon /var/spool/lpd/lp</span>
<span class=c># chmod 770 /var/spool/lpd/lp</span></code></pre></div></div></li><li><p>As <code>root</code>, create <span class=filename>/etc/printcap</span> with these contents:</p><div class="literalblock programlisting"><div class=content><pre>lp:\
	:lp=/dev/unlpt0:\  <i class=conum data-value=1></i><b>(1)</b>
	:sh:\
	:mx#0:\
	:sd=/var/spool/lpd/lp:\
	:lf=/var/log/lpd-errs:</pre></div></div><div class="colist arabic"><table><tbody><tr><td><i class=conum data-value=1></i><b>1</b></td><td>This line is for a printer connected to a <code>USB</code> port.<div class=paragraph><p>For a printer connected to a parallel or "printer" port, use:</p></div><div class="literalblock programlisting"><div class=content><pre>:lp=/dev/lpt0:\</pre></div></div><div class=paragraph><p>For a printer connected directly to a network, use:</p></div><div class="literalblock programlisting"><div class=content><pre>:lp=:rm=network-printer-name:rp=raw:\</pre></div></div><div class=paragraph><p>Replace <em>network-printer-name</em> with the <code>DNS</code> host name of the network printer.</p></div></td></tr></tbody></table></div></li><li><p>Enable LPD by editing <span class=filename>/etc/rc.conf</span>, adding this line:</p><div class="literalblock programlisting"><div class=content><pre>lpd_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>Start the service:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service lpd start</span>
Starting lpd.</code></pre></div></div></li><li><p>Print a test:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># printf &#34;1. This printer can print.\n2. This is the second line.\n&#34; | lpr</span></code></pre></div></div><div class="admonitionblock tip"><table><tbody><tr><td class=icon><i class="fa icon-tip" title=Tip></i></td><td class=content><div class=paragraph><p>If both lines do not start at the left border, but "stairstep" instead, see <a href=#printing-lpd-filters-stairstep>Preventing Stairstepping on Plain Text Printers</a>.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Text files can now be printed with <code>lpr</code>. Give the filename on the command line, or pipe output directly into <code>lpr</code>.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% lpr textfile.txt
% <span class=nb>ls</span> <span class=nt>-lh</span> | lpr</code></pre></div></div></li></ol></div></div></div></div><div class=sect2><h3 id=printing-connections>9.2. Printer Connections<a class=anchor href=#printing-connections></a></h3><div class=paragraph><p>Printers are connected to computer systems in a variety of ways. Small desktop printers are usually connected directly to a computer’s <code>USB</code> port. Older printers are connected to a parallel or "printer" port. Some printers are directly connected to a network, making it easy for multiple computers to share them. A few printers use a rare serial port connection.</p></div><div class=paragraph><p>FreeBSD can communicate with all of these types of printers.</p></div><div id=printing-connections-usb class=dlist><dl><dt class=hdlist1><code>USB</code></dt><dd><p><code>USB</code> printers can be connected to any available <code>USB</code> port on the computer.</p><div class=paragraph><p>When FreeBSD detects a <code>USB</code> printer, two device entries are created: <span class=filename>/dev/ulpt0</span> and <span class=filename>/dev/unlpt0</span>. Data sent to either device will be relayed to the printer. After each print job, <span class=filename>ulpt0</span> resets the <code>USB</code> port. Resetting the port can cause problems with some printers, so the <span class=filename>unlpt0</span> device is usually used instead. <span class=filename>unlpt0</span> does not reset the USB port at all.</p></div></dd></dl></div><div id=printing-connections-parallel class=dlist><dl><dt class=hdlist1>Parallel (<code>IEEE</code>-1284)</dt><dd><p>The parallel port device is <span class=filename>/dev/lpt0</span>. This device appears whether a printer is attached or not, it is not autodetected.</p><div class=paragraph><p>Vendors have largely moved away from these "legacy" ports, and many computers no longer have them. Adapters can be used to connect a parallel printer to a <code>USB</code> port. With such an adapter, the printer can be treated as if it were actually a <code>USB</code> printer. Devices called <em>print servers</em> can also be used to connect parallel printers directly to a network.</p></div></dd></dl></div><div id=printing-connections-serial class=dlist><dl><dt class=hdlist1>Serial (RS-232)</dt><dd><p>Serial ports are another legacy port, rarely used for printers except in certain niche applications. Cables, connectors, and required wiring vary widely.</p><div class=paragraph><p>For serial ports built into a motherboard, the serial device name is <span class=filename>/dev/cuau0</span> or <span class=filename>/dev/cuau1</span>. Serial <code>USB</code> adapters can also be used, and these will appear as <span class=filename>/dev/cuaU0</span>.</p></div><div class=paragraph><p>Several communication parameters must be known to communicate with a serial printer. The most important are <em>baud rate</em> or <code>BPS</code> (Bits Per Second) and <em>parity</em>. Values vary, but typical serial printers use a baud rate of 9600 and no parity.</p></div></dd></dl></div><div id=printing-connections-network class=dlist><dl><dt class=hdlist1>Network</dt><dd><p>Network printers are connected directly to the local computer network.</p><div class=paragraph><p>The <code>DNS</code> hostname of the printer must be known. If the printer is assigned a dynamic address by <code>DHCP</code>, <code>DNS</code> should be dynamically updated so that the host name always has the correct <code>IP</code> address. Network printers are often given static <code>IP</code> addresses to avoid this problem.</p></div><div class=paragraph><p>Most network printers understand print jobs sent with the LPD protocol. A print queue name can also be specified. Some printers process data differently depending on which queue is used. For example, a <code>raw</code> queue prints the data unchanged, while the <code>text</code> queue adds carriage returns to plain text.</p></div><div class=paragraph><p>Many network printers can also print data sent directly to port 9100.</p></div></dd></dl></div><div class=sect3><h4 id=printing-connections-summary>9.2.1. Summary<a class=anchor href=#printing-connections-summary></a></h4><div class=paragraph><p>Wired network connections are usually the easiest to set up and give the fastest printing. For direct connection to the computer, <code>USB</code> is preferred for speed and simplicity. Parallel connections work but have limitations on cable length and speed. Serial connections are more difficult to configure. Cable wiring differs between models, and communication parameters like baud rate and parity bits must add to the complexity. Fortunately, serial printers are rare.</p></div></div></div><div class=sect2><h3 id=printing-pdls>9.3. Common Page Description Languages<a class=anchor href=#printing-pdls></a></h3><div class=paragraph><p>Data sent to a printer must be in a language that the printer can understand. These languages are called Page Description Languages, or PDLs.</p></div><div id=print-pdls-ascii class=dlist><dl><dt class=hdlist1><code>ASCII</code></dt><dd><p>Plain <code>ASCII</code> text is the simplest way to send data to a printer. Characters correspond one to one with what will be printed: an <code>A</code> in the data prints an <code>A</code> on the page. Very little formatting is available. There is no way to select a font or proportional spacing. The forced simplicity of plain <code>ASCII</code> means that text can be printed straight from the computer with little or no encoding or translation. The printed output corresponds directly with what was sent.</p><div class=paragraph><p>Some inexpensive printers cannot print plain <code>ASCII</code> text. This makes them more difficult to set up, but it is usually still possible.</p></div></dd></dl></div><div id=print-pdls-postscript class=dlist><dl><dt class=hdlist1>PostScript®</dt><dd><p>PostScript® is almost the opposite of <code>ASCII</code>. Rather than simple text, a PostScript® program is a set of instructions that draw the final document. Different fonts and graphics can be used. However, this power comes at a price. The program that draws the page must be written. Usually this program is generated by application software, so the process is invisible to the user.</p><div class=paragraph><p>Inexpensive printers sometimes leave out PostScript® compatibility as a cost-saving measure.</p></div></dd></dl></div><div id=print-pdls-pcl class=dlist><dl><dt class=hdlist1><code>PCL</code> (Printer Command Language)</dt><dd><p><code>PCL</code> is an extension of <code>ASCII</code>, adding escape sequences for formatting, font selection, and printing graphics. Many printers provide <code>PCL5</code> support. Some support the newer <code>PCL6</code> or <code>PCLXL</code>. These later versions are supersets of <code>PCL5</code> and can provide faster printing.</p></dd></dl></div><div id=print-pdls-host-based class=dlist><dl><dt class=hdlist1>Host-Based</dt><dd><p>Manufacturers can reduce the cost of a printer by giving it a simple processor and very little memory. These printers are not capable of printing plain text. Instead, bitmaps of text and graphics are drawn by a driver on the host computer and then sent to the printer. These are called <em>host-based</em> printers.</p><div class=paragraph><p>Communication between the driver and a host-based printer is often through proprietary or undocumented protocols, making them functional only on the most common operating systems.</p></div></dd></dl></div><div class=sect3><h4 id=print-pdls-table>9.3.1. Converting PostScript® to Other PDLs<a class=anchor href=#print-pdls-table></a></h4><div class=paragraph><p>Many applications from the Ports Collection and FreeBSD utilities produce PostScript® output. This table shows the utilities available to convert that into other common PDLs:</p></div><table id=print-pdls-ps-to-other-tbl class="tableblock frame-none grid-all stretch"><caption class=title>Tabela 9. Output PDLs</caption><col style=width:33.3333%><col style=width:33.3333%><col style=width:33.3334%><thead><tr><th class="tableblock halign-left valign-top">Output PDL</th><th class="tableblock halign-left valign-top">Generated By</th><th class="tableblock halign-left valign-top">Notes</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>PCL</code> or <code>PCL5</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><a class=package href=https://cgit.freebsd.org/ports/tree/print/ghostscript9-base/>print/ghostscript9-base</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>-sDEVICE=ljet4</code> for monochrome, <code>-sDEVICE=cljet5</code> for color</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>PCLXL</code> or <code>PCL6</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><a class=package href=https://cgit.freebsd.org/ports/tree/print/ghostscript9-base/>print/ghostscript9-base</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>-sDEVICE=pxlmono</code> for monochrome, <code>-sDEVICE=pxlcolor</code> for color</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>ESC/P2</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><a class=package href=https://cgit.freebsd.org/ports/tree/print/ghostscript9-base/>print/ghostscript9-base</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>-sDEVICE=uniprint</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>XQX</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><a class=package href=https://cgit.freebsd.org/ports/tree/print/foo2zjs/>print/foo2zjs</a></p></td><td class="tableblock halign-left valign-top"></td></tr></tbody></table></div><div class=sect3><h4 id=print-pdls-summary>9.3.2. Summary<a class=anchor href=#print-pdls-summary></a></h4><div class=paragraph><p>For the easiest printing, choose a printer that supports PostScript®. Printers that support <code>PCL</code> are the next preferred. With <a class=package href=https://cgit.freebsd.org/ports/tree/print/ghostscript9-base/>print/ghostscript9-base</a>, these printers can be used as if they understood PostScript® natively. Printers that support PostScript® or <code>PCL</code> directly almost always support direct printing of plain <code>ASCII</code> text files also.</p></div><div class=paragraph><p>Line-based printers like typical inkjets usually do not support PostScript® or <code>PCL</code>. They often can print plain <code>ASCII</code> text files. <a class=package href=https://cgit.freebsd.org/ports/tree/print/ghostscript9-base/>print/ghostscript9-base</a> supports the PDLs used by some of these printers. However, printing an entire graphic-based page on these printers is often very slow due to the large amount of data to be transferred and printed.</p></div><div class=paragraph><p>Host-based printers are often more difficult to set up. Some cannot be used at all because of proprietary PDLs. Avoid these printers when possible.</p></div><div class=paragraph><p>Descriptions of many PDLs can be found at <a href=http://www.undocprint.org/formats/page_description_languages class=bare>http://www.undocprint.org/formats/page_description_languages</a>. The particular <code>PDL</code> used by various models of printers can be found at <a href=http://www.openprinting.org/printers class=bare>http://www.openprinting.org/printers</a>.</p></div></div></div><div class=sect2><h3 id=printing-direct>9.4. Direct Printing<a class=anchor href=#printing-direct></a></h3><div class=paragraph><p>For occasional printing, files can be sent directly to a printer device without any setup. For example, a file called <span class=filename>sample.txt</span> can be sent to a <code>USB</code> printer:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cp sample.txt /dev/unlpt0</span></code></pre></div></div><div class=paragraph><p>Direct printing to network printers depends on the abilities of the printer, but most accept print jobs on port 9100, and <a href="https://man.freebsd.org/cgi/man.cgi?query=nc&amp;sektion=1&amp;format=html">nc(1)</a> can be used with them. To print the same file to a printer with the <code>DNS</code> hostname of <em>netlaser</em>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># nc netlaser 9100 &lt; sample.txt</span></code></pre></div></div></div><div class=sect2><h3 id=printing-lpd>9.5. LPD (Line Printer Daemon)<a class=anchor href=#printing-lpd></a></h3><div class=paragraph><p>Printing a file in the background is called <em>spooling</em>. A spooler allows the user to continue with other programs on the computer without waiting for the printer to slowly complete the print job.</p></div><div class=paragraph><p>FreeBSD includes a spooler called <a href="https://man.freebsd.org/cgi/man.cgi?query=lpd&amp;sektion=8&amp;format=html">lpd(8)</a>. Print jobs are submitted with <a href="https://man.freebsd.org/cgi/man.cgi?query=lpr&amp;sektion=1&amp;format=html">lpr(1)</a>.</p></div><div class=sect3><h4 id=printing-lpd-setup>9.5.1. Initial Setup<a class=anchor href=#printing-lpd-setup></a></h4><div class=paragraph><p>A directory for storing print jobs is created, ownership is set, and the permissions are set to prevent other users from viewing the contents of those files:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mkdir -p /var/spool/lpd/lp</span>
<span class=c># chown daemon:daemon /var/spool/lpd/lp</span>
<span class=c># chmod 770 /var/spool/lpd/lp</span></code></pre></div></div><div class=paragraph><p>Printers are defined in <span class=filename>/etc/printcap</span>. An entry for each printer includes details like a name, the port where it is attached, and various other settings. Create <span class=filename>/etc/printcap</span> with these contents:</p></div><div class="literalblock programlisting"><div class=content><pre>lp:\				<i class=conum data-value=1></i><b>(1)</b>
	:lp=/dev/unlpt0:\	<i class=conum data-value=2></i><b>(2)</b>
	:sh:\			<i class=conum data-value=3></i><b>(3)</b>
	:mx#0:\			<i class=conum data-value=4></i><b>(4)</b>
	:sd=/var/spool/lpd/lp:\	<i class=conum data-value=5></i><b>(5)</b>
	:lf=/var/log/lpd-errs:	<i class=conum data-value=6></i><b>(6)</b></pre></div></div><div class="colist arabic"><table><tbody><tr><td><i class=conum data-value=1></i><b>1</b></td><td>The name of this printer. <a href="https://man.freebsd.org/cgi/man.cgi?query=lpr&amp;sektion=1&amp;format=html">lpr(1)</a> sends print jobs to the <code>lp</code> printer unless another printer is specified with <code>-P</code>, so the default printer should be named <code>lp</code>.</td></tr><tr><td><i class=conum data-value=2></i><b>2</b></td><td>The device where the printer is connected. Replace this line with the appropriate one for the connection type shown here.</td></tr><tr><td><i class=conum data-value=3></i><b>3</b></td><td>Suppress the printing of a header page at the start of a print job.</td></tr><tr><td><i class=conum data-value=4></i><b>4</b></td><td>Do not limit the maximum size of a print job.</td></tr><tr><td><i class=conum data-value=5></i><b>5</b></td><td>The path to the spooling directory for this printer. Each printer uses its own spooling directory.</td></tr><tr><td><i class=conum data-value=6></i><b>6</b></td><td>The log file where errors on this printer will be reported.</td></tr></tbody></table></div><div class=paragraph><p>After creating <span class=filename>/etc/printcap</span>, use <a href="https://man.freebsd.org/cgi/man.cgi?query=chkprintcap&amp;sektion=8&amp;format=html">chkprintcap(8)</a> to test it for errors:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># chkprintcap</span></code></pre></div></div><div class=paragraph><p>Fix any reported problems before continuing.</p></div><div class=paragraph><p>Enable <a href="https://man.freebsd.org/cgi/man.cgi?query=lpd&amp;sektion=8&amp;format=html">lpd(8)</a> in <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>lpd_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>Start the service:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service lpd start</span></code></pre></div></div></div><div class=sect3><h4 id=printing-lpd-lpr>9.5.2. Printing with <a href="https://man.freebsd.org/cgi/man.cgi?query=lpr&amp;sektion=1&amp;format=html">lpr(1)</a><a class=anchor href=#printing-lpd-lpr></a></h4><div class=paragraph><p>Documents are sent to the printer with <code>lpr</code>. A file to be printed can be named on the command line or piped into <code>lpr</code>. These two commands are equivalent, sending the contents of <span class=filename>doc.txt</span> to the default printer:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% lpr doc.txt
% <span class=nb>cat </span>doc.txt | lpr</code></pre></div></div><div class=paragraph><p>Printers can be selected with <code>-P</code>. To print to a printer called <em>laser</em>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% lpr <span class=nt>-Plaser</span> doc.txt</code></pre></div></div></div><div class=sect3><h4 id=printing-lpd-filters>9.5.3. Filters<a class=anchor href=#printing-lpd-filters></a></h4><div class=paragraph><p>The examples shown so far have sent the contents of a text file directly to the printer. As long as the printer understands the content of those files, output will be printed correctly.</p></div><div class=paragraph><p>Some printers are not capable of printing plain text, and the input file might not even be plain text.</p></div><div class=paragraph><p><em>Filters</em> allow files to be translated or processed. The typical use is to translate one type of input, like plain text, into a form that the printer can understand, like PostScript® or <code>PCL</code>. Filters can also be used to provide additional features, like adding page numbers or highlighting source code to make it easier to read.</p></div><div class=paragraph><p>The filters discussed here are <em>input filters</em> or <em>text filters</em>. These filters convert the incoming file into different forms. Use <a href="https://man.freebsd.org/cgi/man.cgi?query=su&amp;sektion=1&amp;format=html">su(1)</a> to become <code>root</code> before creating the files.</p></div><div class=paragraph><p>Filters are specified in <span class=filename>/etc/printcap</span> with the <code>if=</code> identifier. To use <span class=filename>/usr/local/libexec/lf2crlf</span> as a filter, modify <span class=filename>/etc/printcap</span> like this:</p></div><div class="literalblock programlisting"><div class=content><pre>lp:\
	:lp=/dev/unlpt0:\
	:sh:\
	:mx#0:\
	:sd=/var/spool/lpd/lp:\
	:if=/usr/local/libexec/lf2crlf:\   <i class=conum data-value=1></i><b>(1)</b>
	:lf=/var/log/lpd-errs:</pre></div></div><div class="colist arabic"><table><tbody><tr><td><i class=conum data-value=1></i><b>1</b></td><td><code>if=</code> identifies the <em>input filter</em> that will be used on incoming text.</td></tr></tbody></table></div><div class="admonitionblock tip"><table><tbody><tr><td class=icon><i class="fa icon-tip" title=Tip></i></td><td class=content><div class=paragraph><p>The backslash <em>line continuation</em> characters at the end of the lines in <span class=filename>printcap</span> entries reveal that an entry for a printer is really just one long line with entries delimited by colon characters. An earlier example can be rewritten as a single less-readable line:</p></div><div class="literalblock programlisting"><div class=content><pre>lp:lp=/dev/unlpt0:sh:mx#0:sd=/var/spool/lpd/lp:if=/usr/local/libexec/lf2crlf:lf=/var/log/lpd-errs:</pre></div></div></td></tr></tbody></table></div><div class=sect4><h5 id=printing-lpd-filters-stairstep>9.5.3.1. Preventing Stairstepping on Plain Text Printers<a class=anchor href=#printing-lpd-filters-stairstep></a></h5><div class=paragraph><p>Typical FreeBSD text files contain only a single line feed character at the end of each line. These lines will "stairstep" on a standard printer:</p></div><div class="literalblock programlisting"><div class=content><pre>A printed file looks
                    like the steps of a staircase
                                                 scattered by the wind</pre></div></div><div class=paragraph><p>A filter can convert the newline characters into carriage returns and newlines. The carriage returns make the printer return to the left after each line. Create <span class=filename>/usr/local/libexec/lf2crlf</span> with these contents:</p></div><div class="literalblock programlisting"><div class=content><pre>#!/bin/sh
CR=$&#39;\r&#39;
/usr/bin/sed -e &#34;s/$/${CR}/g&#34;</pre></div></div><div class=paragraph><p>Set the permissions and make it executable:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># chmod 555 /usr/local/libexec/lf2crlf</span></code></pre></div></div><div class=paragraph><p>Modify <span class=filename>/etc/printcap</span> to use the new filter:</p></div><div class="literalblock programlisting"><div class=content><pre>:if=/usr/local/libexec/lf2crlf:\</pre></div></div><div class=paragraph><p>Test the filter by printing the same plain text file. The carriage returns will cause each line to start at the left side of the page.</p></div></div><div class=sect4><h5 id=printing-lpd-filters-enscript>9.5.3.2. Fancy Plain Text on PostScript® Printers with <a class=package href=https://cgit.freebsd.org/ports/tree/print/enscript/>print/enscript</a><a class=anchor href=#printing-lpd-filters-enscript></a></h5><div class=paragraph><p>GNUEnscript converts plain text files into nicely-formatted PostScript® for printing on PostScript® printers. It adds page numbers, wraps long lines, and provides numerous other features to make printed text files easier to read. Depending on the local paper size, install either <a class=package href=https://cgit.freebsd.org/ports/tree/print/enscript-letter/>print/enscript-letter</a> or <a class=package href=https://cgit.freebsd.org/ports/tree/print/enscript-a4/>print/enscript-a4</a> from the Ports Collection.</p></div><div class=paragraph><p>Create <span class=filename>/usr/local/libexec/enscript</span> with these contents:</p></div><div class="literalblock programlisting"><div class=content><pre>#!/bin/sh
/usr/local/bin/enscript -o -</pre></div></div><div class=paragraph><p>Set the permissions and make it executable:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># chmod 555 /usr/local/libexec/enscript</span></code></pre></div></div><div class=paragraph><p>Modify <span class=filename>/etc/printcap</span> to use the new filter:</p></div><div class="literalblock programlisting"><div class=content><pre>:if=/usr/local/libexec/enscript:\</pre></div></div><div class=paragraph><p>Test the filter by printing a plain text file.</p></div></div><div class=sect4><h5 id=printing-lpd-filters-ps2pcl>9.5.3.3. Printing PostScript® to <code>PCL</code> Printers<a class=anchor href=#printing-lpd-filters-ps2pcl></a></h5><div class=paragraph><p>Many programs produce PostScript® documents. However, inexpensive printers often only understand plain text or <code>PCL</code>. This filter converts PostScript® files to <code>PCL</code> before sending them to the printer.</p></div><div class=paragraph><p>Install the Ghostscript PostScript® interpreter, <a class=package href=https://cgit.freebsd.org/ports/tree/print/ghostscript9-base/>print/ghostscript9-base</a>, from the Ports Collection.</p></div><div class=paragraph><p>Create <span class=filename>/usr/local/libexec/ps2pcl</span> with these contents:</p></div><div class="literalblock programlisting"><div class=content><pre>#!/bin/sh
/usr/local/bin/gs -dSAFER -dNOPAUSE -dBATCH -q -sDEVICE=ljet4 -sOutputFile=- -</pre></div></div><div class=paragraph><p>Set the permissions and make it executable:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># chmod 555 /usr/local/libexec/ps2pcl</span></code></pre></div></div><div class=paragraph><p>PostScript® input sent to this script will be rendered and converted to <code>PCL</code> before being sent on to the printer.</p></div><div class=paragraph><p>Modify <span class=filename>/etc/printcap</span> to use this new input filter:</p></div><div class="literalblock programlisting"><div class=content><pre>:if=/usr/local/libexec/ps2pcl:\</pre></div></div><div class=paragraph><p>Test the filter by sending a small PostScript® program to it:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% <span class=nb>printf</span> <span class=s2>&#34;%%</span><span class=se>\!</span><span class=s2>PS </span><span class=se>\n</span><span class=s2> /Helvetica findfont 18 scalefont setfont </span><span class=se>\</span><span class=s2>
72 432 moveto (PostScript printing successful.) show showpage </span><span class=se>\0</span><span class=s2>04&#34;</span> | lpr</code></pre></div></div></div><div class=sect4><h5 id=printing-lpd-filters-smart>9.5.3.4. Smart Filters<a class=anchor href=#printing-lpd-filters-smart></a></h5><div class=paragraph><p>A filter that detects the type of input and automatically converts it to the correct format for the printer can be very convenient. The first two characters of a PostScript® file are usually <code>%!</code>. A filter can detect those two characters. PostScript® files can be sent on to a PostScript® printer unchanged. Text files can be converted to PostScript® with Enscript as shown earlier. Create <span class=filename>/usr/local/libexec/psif</span> with these contents:</p></div><div class="literalblock programlisting"><div class=content><pre>#!/bin/sh
#
#  psif - Print PostScript or plain text on a PostScript printer
#
IFS=&#34;&#34; read -r first_line
first_two_chars=`expr &#34;$first_line&#34; : &#39;\(..\)&#39;`

case &#34;$first_two_chars&#34; in
%!)
    # %! : PostScript job, print it.
    echo &#34;$first_line&#34; &amp;&amp; cat &amp;&amp; exit 0
    exit 2
    ;;
*)
    # otherwise, format with enscript
    ( echo &#34;$first_line&#34;; cat ) | /usr/local/bin/enscript -o - &amp;&amp; exit 0
    exit 2
    ;;
esac</pre></div></div><div class=paragraph><p>Set the permissions and make it executable:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># chmod 555 /usr/local/libexec/psif</span></code></pre></div></div><div class=paragraph><p>Modify <span class=filename>/etc/printcap</span> to use this new input filter:</p></div><div class="literalblock programlisting"><div class=content><pre>:if=/usr/local/libexec/psif:\</pre></div></div><div class=paragraph><p>Test the filter by printing PostScript® and plain text files.</p></div></div></div><div class=sect3><h4 id=printing-lpd-queues>9.5.4. Multiple Queues<a class=anchor href=#printing-lpd-queues></a></h4><div class=paragraph><p>The entries in <span class=filename>/etc/printcap</span> are really definitions of <em>queues</em>. There can be more than one queue for a single printer. When combined with filters, multiple queues provide users more control over how their jobs are printed.</p></div><div class=paragraph><p>As an example, consider a networked PostScript® laser printer in an office. Most users want to print plain text, but a few advanced users want to be able to print PostScript® files directly. Two entries can be created for the same printer in <span class=filename>/etc/printcap</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>textprinter:\
	:lp=9100@officelaser:\
	:sh:\
	:mx#0:\
	:sd=/var/spool/lpd/textprinter:\
	:if=/usr/local/libexec/enscript:\
	:lf=/var/log/lpd-errs:

psprinter:\
	:lp=9100@officelaser:\
	:sh:\
	:mx#0:\
	:sd=/var/spool/lpd/psprinter:\
	:lf=/var/log/lpd-errs:</pre></div></div><div class=paragraph><p>Documents sent to <code>textprinter</code> will be formatted by the <span class=filename>/usr/local/libexec/enscript</span> filter shown in an earlier example. Advanced users can print PostScript® files on <code>psprinter</code>, where no filtering is done.</p></div><div class=paragraph><p>This multiple queue technique can be used to provide direct access to all kinds of printer features. A printer with a duplexer could use two queues, one for ordinary single-sided printing, and one with a filter that sends the command sequence to enable double-sided printing and then sends the incoming file.</p></div></div><div class=sect3><h4 id=printing-lpd-monitor>9.5.5. Monitoring and Controlling Printing<a class=anchor href=#printing-lpd-monitor></a></h4><div class=paragraph><p>Several utilities are available to monitor print jobs and check and control printer operation.</p></div><div class=sect4><h5 id=printing-lpd-monitor-lpq>9.5.5.1. <a href="https://man.freebsd.org/cgi/man.cgi?query=lpq&amp;sektion=1&amp;format=html">lpq(1)</a><a class=anchor href=#printing-lpd-monitor-lpq></a></h5><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=lpq&amp;sektion=1&amp;format=html">lpq(1)</a> shows the status of a user’s print jobs. Print jobs from other users are not shown.</p></div><div class=paragraph><p>Show the current user’s pending jobs on a single printer:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% lpq <span class=nt>-Plp</span>
Rank   Owner      Job  Files                                 Total Size
1st    jsmith     0    <span class=o>(</span>standard input<span class=o>)</span>                      12792 bytes</code></pre></div></div><div class=paragraph><p>Show the current user’s pending jobs on all printers:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% lpq <span class=nt>-a</span>
lp:
Rank   Owner      Job  Files                                 Total Size
1st    jsmith     1    <span class=o>(</span>standard input<span class=o>)</span>                      27320 bytes

laser:
Rank   Owner      Job  Files                                 Total Size
1st    jsmith     287  <span class=o>(</span>standard input<span class=o>)</span>                      22443 bytes</code></pre></div></div></div><div class=sect4><h5 id=printing-lpd-monitor-lprm>9.5.5.2. <a href="https://man.freebsd.org/cgi/man.cgi?query=lprm&amp;sektion=1&amp;format=html">lprm(1)</a><a class=anchor href=#printing-lpd-monitor-lprm></a></h5><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=lprm&amp;sektion=1&amp;format=html">lprm(1)</a> is used to remove print jobs. Normal users are only allowed to remove their own jobs. <code>root</code> can remove any or all jobs.</p></div><div class=paragraph><p>Remove all pending jobs from a printer:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># lprm -Plp -</span>
dfA002smithy dequeued
cfA002smithy dequeued
dfA003smithy dequeued
cfA003smithy dequeued
dfA004smithy dequeued
cfA004smithy dequeued</code></pre></div></div><div class=paragraph><p>Remove a single job from a printer. <a href="https://man.freebsd.org/cgi/man.cgi?query=lpq&amp;sektion=1&amp;format=html">lpq(1)</a> is used to find the job number.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% lpq
Rank   Owner      Job  Files                                 Total Size
1st    jsmith     5    <span class=o>(</span>standard input<span class=o>)</span>                      12188 bytes

% lprm <span class=nt>-Plp</span> 5
dfA005smithy dequeued
cfA005smithy dequeued</code></pre></div></div></div><div class=sect4><h5 id=printing-lpd-monitor-lpc>9.5.5.3. <a href="https://man.freebsd.org/cgi/man.cgi?query=lpc&amp;sektion=8&amp;format=html">lpc(8)</a><a class=anchor href=#printing-lpd-monitor-lpc></a></h5><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=lpc&amp;sektion=8&amp;format=html">lpc(8)</a> is used to check and modify printer status. <code>lpc</code> is followed by a command and an optional printer name. <code>all</code> can be used instead of a specific printer name, and the command will be applied to all printers. Normal users can view status with <a href="https://man.freebsd.org/cgi/man.cgi?query=lpc&amp;sektion=8&amp;format=html">lpc(8)</a>. Only <code>root</code> can use commands which modify printer status.</p></div><div class=paragraph><p>Show the status of all printers:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% lpc status all
lp:
	queuing is enabled
	printing is enabled
	1 entry <span class=k>in </span>spool area
	printer idle
laser:
	queuing is enabled
	printing is enabled
	1 entry <span class=k>in </span>spool area
	waiting <span class=k>for </span>laser to come up</code></pre></div></div><div class=paragraph><p>Prevent a printer from accepting new jobs, then begin accepting new jobs again:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># lpc disable lp</span>
lp:
	queuing disabled
<span class=c># lpc enable lp</span>
lp:
	queuing enabled</code></pre></div></div><div class=paragraph><p>Stop printing, but continue to accept new jobs. Then begin printing again:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># lpc stop lp</span>
lp:
	printing disabled
<span class=c># lpc start lp</span>
lp:
	printing enabled
	daemon started</code></pre></div></div><div class=paragraph><p>Restart a printer after some error condition:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># lpc restart lp</span>
lp:
	no daemon to abort
	printing enabled
	daemon restarted</code></pre></div></div><div class=paragraph><p>Turn the print queue off and disable printing, with a message to explain the problem to users:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># lpc down lp Repair parts will arrive on Monday</span>
lp:
	printer and queuing disabled
	status message is now: Repair parts will arrive on Monday</code></pre></div></div><div class=paragraph><p>Re-enable a printer that is down:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># lpc up lp</span>
lp:
	printing enabled
	daemon started</code></pre></div></div><div class=paragraph><p>See <a href="https://man.freebsd.org/cgi/man.cgi?query=lpc&amp;sektion=8&amp;format=html">lpc(8)</a> for more commands and options.</p></div></div></div><div class=sect3><h4 id=printing-lpd-shared>9.5.6. Shared Printers<a class=anchor href=#printing-lpd-shared></a></h4><div class=paragraph><p>Printers are often shared by multiple users in businesses and schools. Additional features are provided to make sharing printers more convenient.</p></div><div class=sect4><h5 id=printing-shared-aliases>9.5.6.1. Aliases<a class=anchor href=#printing-shared-aliases></a></h5><div class=paragraph><p>The printer name is set in the first line of the entry in <span class=filename>/etc/printcap</span>. Additional names, or <em>aliases</em>, can be added after that name. Aliases are separated from the name and each other by vertical bars:</p></div><div class="literalblock programlisting"><div class=content><pre>lp|repairsprinter|salesprinter:\</pre></div></div><div class=paragraph><p>Aliases can be used in place of the printer name. For example, users in the Sales department print to their printer with</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% lpr <span class=nt>-Psalesprinter</span> sales-report.txt</code></pre></div></div><div class=paragraph><p>Users in the Repairs department print to <em>their</em> printer with</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% lpr <span class=nt>-Prepairsprinter</span> repairs-report.txt</code></pre></div></div><div class=paragraph><p>All of the documents print on that single printer. When the Sales department grows enough to need their own printer, the alias can be removed from the shared printer entry and used as the name of a new printer. Users in both departments continue to use the same commands, but the Sales documents are sent to the new printer.</p></div></div><div class=sect4><h5 id=printing-shared-headers>9.5.6.2. Header Pages<a class=anchor href=#printing-shared-headers></a></h5><div class=paragraph><p>It can be difficult for users to locate their documents in the stack of pages produced by a busy shared printer. <em>Header pages</em> were created to solve this problem. A header page with the user name and document name is printed before each print job. These pages are also sometimes called <em>banner</em> or <em>separator</em> pages.</p></div><div class=paragraph><p>Enabling header pages differs depending on whether the printer is connected directly to the computer with a <code>USB</code>, parallel, or serial cable, or is connected remotely over a network.</p></div><div class=paragraph><p>Header pages on directly-connected printers are enabled by removing the <code>:sh:\</code> (Suppress Header) line from the entry in <span class=filename>/etc/printcap</span>. These header pages only use line feed characters for new lines. Some printers will need the <span class=filename>/usr/shared/examples/printing/hpif</span> filter to prevent stairstepped text. The filter configures <code>PCL</code> printers to print both carriage returns and line feeds when a line feed is received.</p></div><div class=paragraph><p>Header pages for network printers must be configured on the printer itself. Header page entries in <span class=filename>/etc/printcap</span> are ignored. Settings are usually available from the printer front panel or a configuration web page accessible with a web browser.</p></div></div></div><div class=sect3><h4 id=printing-lpd-references>9.5.7. References<a class=anchor href=#printing-lpd-references></a></h4><div class=paragraph><p>Example files: <span class=filename>/usr/shared/examples/printing/</span>.</p></div><div class=paragraph><p>The <em>4.3BSD Line Printer Spooler Manual</em>, <span class=filename>/usr/shared/doc/smm/07.lpd/paper.ascii.gz</span>.</p></div><div class=paragraph><p>Manual pages: <a href="https://man.freebsd.org/cgi/man.cgi?query=printcap&amp;sektion=5&amp;format=html">printcap(5)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=lpd&amp;sektion=8&amp;format=html">lpd(8)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=lpr&amp;sektion=1&amp;format=html">lpr(1)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=lpc&amp;sektion=8&amp;format=html">lpc(8)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=lprm&amp;sektion=1&amp;format=html">lprm(1)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=lpq&amp;sektion=1&amp;format=html">lpq(1)</a>.</p></div></div></div><div class=sect2><h3 id=printing-other>9.6. Other Printing Systems<a class=anchor href=#printing-other></a></h3><div class=paragraph><p>Several other printing systems are available in addition to the built-in <a href="https://man.freebsd.org/cgi/man.cgi?query=lpd&amp;sektion=8&amp;format=html">lpd(8)</a>. These systems offer support for other protocols or additional features.</p></div><div class=sect3><h4 id=printing-other-cups>9.6.1. CUPS (Common UNIX® Printing System)<a class=anchor href=#printing-other-cups></a></h4><div class=paragraph><p>CUPS is a popular printing system available on many operating systems. Using CUPS on FreeBSD is documented in a separate article: <a href=https://docs.freebsd.org/en/articles/cups/>CUPS</a></p></div></div><div class=sect3><h4 id=printing-other-hplip>9.6.2. HPLIP<a class=anchor href=#printing-other-hplip></a></h4><div class=paragraph><p>Hewlett Packard provides a printing system that supports many of their inkjet and laser printers. The port is <a class=package href=https://cgit.freebsd.org/ports/tree/print/hplip/>print/hplip</a>. The main web page is at <a href=http://hplipopensource.com/hplip-web/index.html class=bare>http://hplipopensource.com/hplip-web/index.html</a>. The port handles all the installation details on FreeBSD. Configuration information is shown at <a href=http://hplipopensource.com/hplip-web/install/manual/hp_setup.html class=bare>http://hplipopensource.com/hplip-web/install/manual/hp_setup.html</a>.</p></div></div><div class=sect3><h4 id=printing-other-lprng>9.6.3. LPRng<a class=anchor href=#printing-other-lprng></a></h4><div class=paragraph><p>LPRng was developed as an enhanced alternative to <a href="https://man.freebsd.org/cgi/man.cgi?query=lpd&amp;sektion=8&amp;format=html">lpd(8)</a>. The port is <a class=package href=https://cgit.freebsd.org/ports/tree/sysutils/LPRng/>sysutils/LPRng</a>. For details and documentation, see <a href=https://lprng.sourceforge.net/ class=bare>https://lprng.sourceforge.net/</a>.</p></div></div></div></div></div><div class=sect1><h2 id=linuxemu>Rozdział 10. Linux® Binary Compatibility<a class=anchor href=#linuxemu></a></h2><div class=sectionbody><div class=sect2><h3 id=linuxemu-synopsis>10.1. Synopsis<a class=anchor href=#linuxemu-synopsis></a></h3><div class=paragraph><p>FreeBSD provides binary compatibility with Linux®, allowing users to install and run most Linux® binaries on a FreeBSD system without having to first modify the binary. It has even been reported that, in some situations, Linux® binaries perform better on FreeBSD than they do on Linux®.</p></div><div class=paragraph><p>However, some Linux®-specific operating system features are not supported under FreeBSD. For example, Linux® binaries will not work on FreeBSD if they overly use i386™ specific calls, such as enabling virtual 8086 mode.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Support for 64-bit binary compatibility with Linux® was added in FreeBSD 10.3.</p></div></td></tr></tbody></table></div><div class=paragraph><p>After reading this chapter, you will know:</p></div><div class=ulist><ul><li><p>How to enable Linux® binary compatibility on a FreeBSD system.</p></li><li><p>How to install additional Linux® shared libraries.</p></li><li><p>How to install Linux® applications on a FreeBSD system.</p></li><li><p>The implementation details of Linux® compatibility in FreeBSD.</p></li></ul></div><div class=paragraph><p>Before reading this chapter, you should:</p></div><div class=ulist><ul><li><p>Know how to install <a href=./#ports>additional third-party software</a>.</p></li></ul></div></div><div class=sect2><h3 id=linuxemu-lbc-install>10.2. Configuring Linux® Binary Compatibility<a class=anchor href=#linuxemu-lbc-install></a></h3><div class=paragraph><p>By default, Linux® libraries are not installed and Linux® binary compatibility is not enabled. Linux® libraries can either be installed manually or from the FreeBSD Ports Collection.</p></div><div class=paragraph><p>Before attempting to build the port, load the Linux® kernel module, otherwise the build will fail:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># kldload linux</span></code></pre></div></div><div class=paragraph><p>For 64-bit compatibility:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># kldload linux64</span></code></pre></div></div><div class=paragraph><p>To verify that the module is loaded:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% kldstat
      Id Refs Address    Size     Name
      1    2 0xc0100000 16bdb8   kernel
      7    1 0xc24db000 d000     linux.ko</code></pre></div></div><div class=paragraph><p>The <a class=package href=https://cgit.freebsd.org/ports/tree/emulators/linux_base-c7/>emulators/linux_base-c7</a> package or port is the easiest way to install a base set of Linux® libraries and binaries on a FreeBSD system. To install the port:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pkg install emulators/linux_base-c7</span></code></pre></div></div><div class=paragraph><p>For Linux® compatibility to be enabled at boot time, add this line to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>linux_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>On 64-bit machines, <span class=filename>/etc/rc.d/abi</span> will automatically load the module for 64-bit emulation.</p></div><div class=paragraph><p>Since the Linux® binary compatibility layer has gained support for running both 32- and 64-bit Linux® binaries (on 64-bit x86 hosts), it is no longer possible to link the emulation functionality statically into a custom kernel.</p></div><div class=sect3><h4 id=linuxemu-libs-manually>10.2.1. Installing Additional Libraries Manually<a class=anchor href=#linuxemu-libs-manually></a></h4><div class=paragraph><p>If a Linux® application complains about missing shared libraries after configuring Linux® binary compatibility, determine which shared libraries the Linux® binary needs and install them manually.</p></div><div class=paragraph><p>From a Linux® system, <code>ldd</code> can be used to determine which shared libraries the application needs. For example, to check which shared libraries <code>linuxdoom</code> needs, run this command from a Linux® system that has Doom installed:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% ldd linuxdoom
libXt.so.3 <span class=o>(</span>DLL Jump 3.1<span class=o>)</span> <span class=o>=&gt;</span> /usr/X11/lib/libXt.so.3.1.0
libX11.so.3 <span class=o>(</span>DLL Jump 3.1<span class=o>)</span> <span class=o>=&gt;</span> /usr/X11/lib/libX11.so.3.1.0
libc.so.4 <span class=o>(</span>DLL Jump 4.5pl26<span class=o>)</span> <span class=o>=&gt;</span> /lib/libc.so.4.6.29</code></pre></div></div><div class=paragraph><p>Then, copy all the files in the last column of the output from the Linux® system into <span class=filename>/compat/linux</span> on the FreeBSD system. Once copied, create symbolic links to the names in the first column. This example will result in the following files on the FreeBSD system:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>/compat/linux/usr/X11/lib/libXt.so.3.1.0
/compat/linux/usr/X11/lib/libXt.so.3 -&gt; libXt.so.3.1.0
/compat/linux/usr/X11/lib/libX11.so.3.1.0
/compat/linux/usr/X11/lib/libX11.so.3 -&gt; libX11.so.3.1.0
/compat/linux/lib/libc.so.4.6.29
/compat/linux/lib/libc.so.4 -&gt; libc.so.4.6.29</code></pre></div></div><div class=paragraph><p>If a Linux® shared library already exists with a matching major revision number to the first column of the <code>ldd</code> output, it does not need to be copied to the file named in the last column, as the existing library should work. It is advisable to copy the shared library if it is a newer version, though. The old one can be removed, as long as the symbolic link points to the new one.</p></div><div class=paragraph><p>For example, these libraries already exist on the FreeBSD system:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>/compat/linux/lib/libc.so.4.6.27
/compat/linux/lib/libc.so.4 -&gt; libc.so.4.6.27</code></pre></div></div><div class=paragraph><p>and <code>ldd</code> indicates that a binary requires a later version:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>libc.so.4 <span class=o>(</span>DLL Jump 4.5pl26<span class=o>)</span> -&gt; libc.so.4.6.29</code></pre></div></div><div class=paragraph><p>Since the existing library is only one or two versions out of date in the last digit, the program should still work with the slightly older version. However, it is safe to replace the existing <span class=filename>libc.so</span> with the newer version:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>/compat/linux/lib/libc.so.4.6.29
/compat/linux/lib/libc.so.4 -&gt; libc.so.4.6.29</code></pre></div></div><div class=paragraph><p>Generally, one will need to look for the shared libraries that Linux® binaries depend on only the first few times that a Linux® program is installed on FreeBSD. After a while, there will be a sufficient set of Linux® shared libraries on the system to be able to run newly installed Linux® binaries without any extra work.</p></div></div><div class=sect3><h4 id=_installing_linux_elf_binaries>10.2.2. Installing Linux® ELF Binaries<a class=anchor href=#_installing_linux_elf_binaries></a></h4><div class=paragraph><p>ELF binaries sometimes require an extra step. When an unbranded ELF binary is executed, it will generate an error message:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% ./my-linux-elf-binary
ELF binary <span class=nb>type </span>not known
Abort</code></pre></div></div><div class=paragraph><p>To help the FreeBSD kernel distinguish between a FreeBSD ELF binary and a Linux® binary, use <a href="https://man.freebsd.org/cgi/man.cgi?query=brandelf&amp;sektion=1&amp;format=html">brandelf(1)</a>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% brandelf <span class=nt>-t</span> Linux my-linux-elf-binary</code></pre></div></div><div class=paragraph><p>Since the GNU toolchain places the appropriate branding information into ELF binaries automatically, this step is usually not necessary.</p></div></div><div class=sect3><h4 id=_installing_a_linux_rpm_based_application>10.2.3. Installing a Linux® RPM Based Application<a class=anchor href=#_installing_a_linux_rpm_based_application></a></h4><div class=paragraph><p>To install a Linux® RPM-based application, first install the <a class=package href=https://cgit.freebsd.org/ports/tree/archivers/rpm4/>archivers/rpm4</a> package or port. Once installed, <code>root</code> can use this command to install a <span class=filename>.rpm</span>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /compat/linux</span>
<span class=c># rpm2cpio &lt; /path/to/linux.archive.rpm | cpio -id</span></code></pre></div></div><div class=paragraph><p>If necessary, <code>brandelf</code> the installed ELF binaries. Note that this will prevent a clean uninstall.</p></div></div><div class=sect3><h4 id=_configuring_the_hostname_resolver>10.2.4. Configuring the Hostname Resolver<a class=anchor href=#_configuring_the_hostname_resolver></a></h4><div class=paragraph><p>If DNS does not work or this error appears:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>resolv+: <span class=s2>&#34;bind&#34;</span> is an invalid keyword resolv+:
<span class=s2>&#34;hosts&#34;</span> is an invalid keyword</code></pre></div></div><div class=paragraph><p>configure <span class=filename>/compat/linux/etc/host.conf</span> as follows:</p></div><div class="literalblock programlisting"><div class=content><pre>order hosts, bind
multi on</pre></div></div><div class=paragraph><p>This specifies that <span class=filename>/etc/hosts</span> is searched first and DNS is searched second. When <span class=filename>/compat/linux/etc/host.conf</span> does not exist, Linux® applications use <span class=filename>/etc/host.conf</span> and complain about the incompatible FreeBSD syntax. Remove <code>bind</code> if a name server is not configured using <span class=filename>/etc/resolv.conf</span>.</p></div></div></div><div class=sect2><h3 id=linuxemu-advanced>10.3. Advanced Topics<a class=anchor href=#linuxemu-advanced></a></h3><div class=paragraph><p>This section describes how Linux® binary compatibility works and is based on an email written to <a href=https://lists.FreeBSD.org/subscription/freebsd-chat>FreeBSD chat mailing list</a> by Terry Lambert <a href=mailto:tlambert@primenet.com>tlambert@primenet.com</a> (Message ID: <code>&lt;<a href=mailto:199906020108.SAA07001@usr09.primenet.com>199906020108.SAA07001@usr09.primenet.com</a>></code>).</p></div><div class=paragraph><p>FreeBSD has an abstraction called an "execution class loader". This is a wedge into the <a href="https://man.freebsd.org/cgi/man.cgi?query=execve&amp;sektion=2&amp;format=html">execve(2)</a> system call.</p></div><div class=paragraph><p>Historically, the UNIX® loader examined the magic number (generally the first 4 or 8 bytes of the file) to see if it was a binary known to the system, and if so, invoked the binary loader.</p></div><div class=paragraph><p>If it was not the binary type for the system, the <a href="https://man.freebsd.org/cgi/man.cgi?query=execve&amp;sektion=2&amp;format=html">execve(2)</a> call returned a failure, and the shell attempted to start executing it as shell commands. The assumption was a default of "whatever the current shell is".</p></div><div class=paragraph><p>Later, a hack was made for <a href="https://man.freebsd.org/cgi/man.cgi?query=sh&amp;sektion=1&amp;format=html">sh(1)</a> to examine the first two characters, and if they were <code>:\n</code>, it invoked the <a href="https://man.freebsd.org/cgi/man.cgi?query=csh&amp;sektion=1&amp;format=html">csh(1)</a> shell instead.</p></div><div class=paragraph><p>FreeBSD has a list of loaders, instead of a single loader, with a fallback to the <code>#!</code> loader for running shell interpreters or shell scripts.</p></div><div class=paragraph><p>For the Linux® ABI support, FreeBSD sees the magic number as an ELF binary. The ELF loader looks for a specialized <em>brand</em>, which is a comment section in the ELF image, and which is not present on SVR4/Solaris™ ELF binaries.</p></div><div class=paragraph><p>For Linux® binaries to function, they must be <em>branded</em> as type <code>Linux</code> using <a href="https://man.freebsd.org/cgi/man.cgi?query=brandelf&amp;sektion=1&amp;format=html">brandelf(1)</a>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># brandelf -t Linux file</span></code></pre></div></div><div class=paragraph><p>When the ELF loader sees the <code>Linux</code> brand, the loader replaces a pointer in the <code>proc</code> structure. All system calls are indexed through this pointer. In addition, the process is flagged for special handling of the trap vector for the signal trampoline code, and several other (minor) fix-ups that are handled by the Linux® kernel module.</p></div><div class=paragraph><p>The Linux® system call vector contains, among other things, a list of <code>sysent[]</code> entries whose addresses reside in the kernel module.</p></div><div class=paragraph><p>When a system call is called by the Linux® binary, the trap code dereferences the system call function pointer off the <code>proc</code> structure, and gets the Linux®, not the FreeBSD, system call entry points.</p></div><div class=paragraph><p>Linux® mode dynamically <em>reroots</em> lookups. This is, in effect, equivalent to <code>union</code> to file system mounts. First, an attempt is made to lookup the file in <span class=filename>/compat/linux/original-path</span>. If that fails, the lookup is done in <span class=filename>/original-path</span>. This makes sure that binaries that require other binaries can run. For example, the Linux® toolchain can all run under Linux® ABI support. It also means that the Linux® binaries can load and execute FreeBSD binaries, if there are no corresponding Linux® binaries present, and that a <a href="https://man.freebsd.org/cgi/man.cgi?query=uname&amp;sektion=1&amp;format=html">uname(1)</a> command can be placed in the <span class=filename>/compat/linux</span> directory tree to ensure that the Linux® binaries cannot tell they are not running on Linux®.</p></div><div class=paragraph><p>In effect, there is a Linux® kernel in the FreeBSD kernel. The various underlying functions that implement all of the services provided by the kernel are identical to both the FreeBSD system call table entries, and the Linux® system call table entries: file system operations, virtual memory operations, signal delivery, and System V IPC. The only difference is that FreeBSD binaries get the FreeBSD <em>glue</em> functions, and Linux® binaries get the Linux® <em>glue</em> functions. The FreeBSD <em>glue</em> functions are statically linked into the kernel, and the Linux® <em>glue</em> functions can be statically linked, or they can be accessed via a kernel module.</p></div><div class=paragraph><p>Technically, this is not really emulation, it is an ABI implementation. It is sometimes called "Linux® emulation" because the implementation was done at a time when there was no other word to describe what was going on. Saying that FreeBSD ran Linux® binaries was not true, since the code was not compiled in.</p></div></div></div></div><h1 id=system-administration class=sect0>Część III: Administracja systemem<a class=anchor href=#system-administration></a></h1><div class="openblock partintro"><div class=content><div class=paragraph><p>Pozostałe rozdziały Podręcznika omawiają wszystkie aspekty administracji systemem FreeBSD. Każdy z nich rozpoczyna się on wyjaśnienia czego nauczymy się przeczytawszy dany rozdział, a także co powinniśmy wiedzieć przed przystąpieniem do jego lektury.</p></div><div class=paragraph><p>Rozdziały zostały tak napisane, by móc sięgnąć po nie gdy potrzebujemy danych informacji. Nie ma przymusu czytania ich w żadnej określonej kolejności, ani też przeczytania wszystkich przed rozpoczęciem pracy z FreeBSD.</p></div></div></div><div class=sect1><h2 id=config-tuning>Rozdział 11. Configuration and Tuning<a class=anchor href=#config-tuning></a></h2><div class=sectionbody><div class=sect2><h3 id=config-synopsis>11.1. Synopsis<a class=anchor href=#config-synopsis></a></h3><div class=paragraph><p>One of the important aspects of FreeBSD is proper system configuration. This chapter explains much of the FreeBSD configuration process, including some of the parameters which can be set to tune a FreeBSD system.</p></div><div class=paragraph><p>After reading this chapter, you will know:</p></div><div class=ulist><ul><li><p>The basics of <span class=filename>rc.conf</span> configuration and <span class=filename>/usr/local/etc/rc.d</span> startup scripts.</p></li><li><p>How to configure and test a network card.</p></li><li><p>How to configure virtual hosts on network devices.</p></li><li><p>How to use the various configuration files in <span class=filename>/etc</span>.</p></li><li><p>How to tune FreeBSD using <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a> variables.</p></li><li><p>How to tune disk performance and modify kernel limitations.</p></li></ul></div><div class=paragraph><p>Before reading this chapter, you should:</p></div><div class=ulist><ul><li><p>Understand UNIX® and FreeBSD basics (<a href=./#basics>FreeBSD Basics</a>).</p></li><li><p>Be familiar with the basics of kernel configuration and compilation (<a href=./#kernelconfig>Configuring the FreeBSD Kernel</a>).</p></li></ul></div></div><div class=sect2><h3 id=configtuning-starting-services>11.2. Starting Services<a class=anchor href=#configtuning-starting-services></a></h3><div class=paragraph><p>Many users install third party software on FreeBSD from the Ports Collection and require the installed services to be started upon system initialization. Services, such as <a class=package href=https://cgit.freebsd.org/ports/tree/mail/postfix/>mail/postfix</a> or <a class=package href=https://cgit.freebsd.org/ports/tree/www/apache22/>www/apache22</a> are just two of the many software packages which may be started during system initialization. This section explains the procedures available for starting third party software.</p></div><div class=paragraph><p>In FreeBSD, most included services, such as <a href="https://man.freebsd.org/cgi/man.cgi?query=cron&amp;sektion=8&amp;format=html">cron(8)</a>, are started through the system startup scripts.</p></div><div class=sect3><h4 id=_extended_application_configuration>11.2.1. Extended Application Configuration<a class=anchor href=#_extended_application_configuration></a></h4><div class=paragraph><p>Now that FreeBSD includes <span class=filename>rc.d</span>, configuration of application startup is easier and provides more features. Using the key words discussed in <a href=#configtuning-rcd>Managing Services in FreeBSD</a>, applications can be set to start after certain other services and extra flags can be passed through <span class=filename>/etc/rc.conf</span> in place of hard coded flags in the startup script. A basic script may look similar to the following:</p></div><div class="literalblock programlisting"><div class=content><pre>#!/bin/sh
#
# PROVIDE: utility
# REQUIRE: DAEMON
# KEYWORD: shutdown

. /etc/rc.subr

name=utility
rcvar=utility_enable

command=&#34;/usr/local/sbin/utility&#34;

load_rc_config $name

#
# DO NOT CHANGE THESE DEFAULT VALUES HERE
# SET THEM IN THE /etc/rc.conf FILE
#
utility_enable=${utility_enable-&#34;NO&#34;}
pidfile=${utility_pidfile-&#34;/var/run/utility.pid&#34;}

run_rc_command &#34;$1&#34;</pre></div></div><div class=paragraph><p>This script will ensure that the provided <code>utility</code> will be started after the <code>DAEMON</code> pseudo-service. It also provides a method for setting and tracking the process ID (PID).</p></div><div class=paragraph><p>This application could then have the following line placed in <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>utility_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>This method allows for easier manipulation of command line arguments, inclusion of the default functions provided in <span class=filename>/etc/rc.subr</span>, compatibility with <a href="https://man.freebsd.org/cgi/man.cgi?query=rcorder&amp;sektion=8&amp;format=html">rcorder(8)</a>, and provides for easier configuration via <span class=filename>rc.conf</span>.</p></div></div><div class=sect3><h4 id=_using_services_to_start_services>11.2.2. Using Services to Start Services<a class=anchor href=#_using_services_to_start_services></a></h4><div class=paragraph><p>Other services can be started using <a href="https://man.freebsd.org/cgi/man.cgi?query=inetd&amp;sektion=8&amp;format=html">inetd(8)</a>. Working with <a href="https://man.freebsd.org/cgi/man.cgi?query=inetd&amp;sektion=8&amp;format=html">inetd(8)</a> and its configuration is described in depth in <a href=./#network-inetd>“The inetd Super-Server”</a>.</p></div><div class=paragraph><p>In some cases, it may make more sense to use <a href="https://man.freebsd.org/cgi/man.cgi?query=cron&amp;sektion=8&amp;format=html">cron(8)</a> to start system services. This approach has a number of advantages as <a href="https://man.freebsd.org/cgi/man.cgi?query=cron&amp;sektion=8&amp;format=html">cron(8)</a> runs these processes as the owner of the <a href="https://man.freebsd.org/cgi/man.cgi?query=crontab&amp;sektion=5&amp;format=html">crontab(5)</a>. This allows regular users to start and maintain their own applications.</p></div><div class=paragraph><p>The <code>@reboot</code> feature of <a href="https://man.freebsd.org/cgi/man.cgi?query=cron&amp;sektion=8&amp;format=html">cron(8)</a>, may be used in place of the time specification. This causes the job to run when <a href="https://man.freebsd.org/cgi/man.cgi?query=cron&amp;sektion=8&amp;format=html">cron(8)</a> is started, normally during system initialization.</p></div></div></div><div class=sect2><h3 id=configtuning-cron>11.3. Configuring <a href="https://man.freebsd.org/cgi/man.cgi?query=cron&amp;sektion=8&amp;format=html">cron(8)</a><a class=anchor href=#configtuning-cron></a></h3><div class=paragraph><p>One of the most useful utilities in FreeBSD is cron. This utility runs in the background and regularly checks <span class=filename>/etc/crontab</span> for tasks to execute and searches <span class=filename>/var/cron/tabs</span> for custom crontab files. These files are used to schedule tasks which cron runs at the specified times. Each entry in a crontab defines a task to run and is known as a <em>cron job</em>.</p></div><div class=paragraph><p>Two different types of configuration files are used: the system crontab, which should not be modified, and user crontabs, which can be created and edited as needed. The format used by these files is documented in <a href="https://man.freebsd.org/cgi/man.cgi?query=crontab&amp;sektion=5&amp;format=html">crontab(5)</a>. The format of the system crontab, <span class=filename>/etc/crontab</span> includes a <code>who</code> column which does not exist in user crontabs. In the system crontab, cron runs the command as the user specified in this column. In a user crontab, all commands run as the user who created the crontab.</p></div><div class=paragraph><p>User crontabs allow individual users to schedule their own tasks. The <code>root</code> user can also have a user <span class=filename>crontab</span> which can be used to schedule tasks that do not exist in the system <span class=filename>crontab</span>.</p></div><div class=paragraph><p>Here is a sample entry from the system crontab, <span class=filename>/etc/crontab</span>:</p></div><div class="literalblock programlisting"><div class=content><pre># /etc/crontab - root&#39;s crontab for FreeBSD
#
# $FreeBSD$
<i class=conum data-value=1></i><b>(1)</b>
SHELL=/bin/sh
PATH=/etc:/bin:/sbin:/usr/bin:/usr/sbin <i class=conum data-value=2></i><b>(2)</b>
#
#minute	hour	mday	month	wday	who	command <i class=conum data-value=3></i><b>(3)</b>
#
*/5	*	*	*	*	root	/usr/libexec/atrun <i class=conum data-value=4></i><b>(4)</b></pre></div></div><div class="colist arabic"><table><tbody><tr><td><i class=conum data-value=1></i><b>1</b></td><td>Lines that begin with the <code>#</code> character are comments. A comment can be placed in the file as a reminder of what and why a desired action is performed. Comments cannot be on the same line as a command or else they will be interpreted as part of the command; they must be on a new line. Blank lines are ignored.</td></tr><tr><td><i class=conum data-value=2></i><b>2</b></td><td>The equals (<code>=</code>) character is used to define any environment settings. In this example, it is used to define the <code>SHELL</code> and <code>PATH</code>. If the <code>SHELL</code> is omitted, cron will use the default Bourne shell. If the <code>PATH</code> is omitted, the full path must be given to the command or script to run.</td></tr><tr><td><i class=conum data-value=3></i><b>3</b></td><td>This line defines the seven fields used in a system crontab: <code>minute</code>, <code>hour</code>, <code>mday</code>, <code>month</code>, <code>wday</code>, <code>who</code>, and <code>command</code>. The <code>minute</code> field is the time in minutes when the specified command will be run, the <code>hour</code> is the hour when the specified command will be run, the <code>mday</code> is the day of the month, <code>month</code> is the month, and <code>wday</code> is the day of the week. These fields must be numeric values, representing the twenty-four hour clock, or a <code>*</code>, representing all values for that field. The <code>who</code> field only exists in the system crontab and specifies which user the command should be run as. The last field is the command to be executed.</td></tr><tr><td><i class=conum data-value=4></i><b>4</b></td><td>This entry defines the values for this cron job. The <code>*/5</code>, followed by several more <code>*</code> characters, specifies that <code>/usr/libexec/atrun</code> is invoked by <code>root</code> every five minutes of every hour, of every day and day of the week, of every month.Commands can include any number of switches. However, commands which extend to multiple lines need to be broken with the backslash "\" continuation character.</td></tr></tbody></table></div><div class=sect3><h4 id=configtuning-installcrontab>11.3.1. Creating a User Crontab<a class=anchor href=#configtuning-installcrontab></a></h4><div class=paragraph><p>To create a user crontab, invoke <code>crontab</code> in editor mode:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% crontab <span class=nt>-e</span></code></pre></div></div><div class=paragraph><p>This will open the user’s crontab using the default text editor. The first time a user runs this command, it will open an empty file. Once a user creates a crontab, this command will open that file for editing.</p></div><div class=paragraph><p>It is useful to add these lines to the top of the crontab file in order to set the environment variables and to remember the meanings of the fields in the crontab:</p></div><div class="literalblock programlisting"><div class=content><pre>SHELL=/bin/sh
PATH=/etc:/bin:/sbin:/usr/bin:/usr/sbin
# Order of crontab fields
# minute	hour	mday	month	wday	command</pre></div></div><div class=paragraph><p>Then add a line for each command or script to run, specifying the time to run the command. This example runs the specified custom Bourne shell script every day at two in the afternoon. Since the path to the script is not specified in <code>PATH</code>, the full path to the script is given:</p></div><div class="literalblock programlisting"><div class=content><pre>0	14	*	*	*	/usr/home/dru/bin/mycustomscript.sh</pre></div></div><div class="admonitionblock tip"><table><tbody><tr><td class=icon><i class="fa icon-tip" title=Tip></i></td><td class=content><div class=paragraph><p>Before using a custom script, make sure it is executable and test it with the limited set of environment variables set by cron. To replicate the environment that would be used to run the above cron entry, use:</p></div><div class="literalblock programlisting"><div class=content><pre>env -i SHELL=/bin/sh PATH=/etc:/bin:/sbin:/usr/bin:/usr/sbin HOME=/home/dru LOGNAME=dru /usr/home/dru/bin/mycustomscript.sh</pre></div></div><div class=paragraph><p>The environment set by cron is discussed in <a href="https://man.freebsd.org/cgi/man.cgi?query=crontab&amp;sektion=5&amp;format=html">crontab(5)</a>. Checking that scripts operate correctly in a cron environment is especially important if they include any commands that delete files using wildcards.</p></div></td></tr></tbody></table></div><div class=paragraph><p>When finished editing the crontab, save the file. It will automatically be installed and cron will read the crontab and run its cron jobs at their specified times. To list the cron jobs in a crontab, use this command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% crontab <span class=nt>-l</span>
0	14	<span class=k>*</span>	<span class=k>*</span>	<span class=k>*</span>	/usr/home/dru/bin/mycustomscript.sh</code></pre></div></div><div class=paragraph><p>To remove all of the cron jobs in a user crontab:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% crontab <span class=nt>-r</span>
remove crontab <span class=k>for </span>dru? y</code></pre></div></div></div></div><div class=sect2><h3 id=configtuning-rcd>11.4. Managing Services in FreeBSD<a class=anchor href=#configtuning-rcd></a></h3><div class=paragraph><p>FreeBSD uses the <a href="https://man.freebsd.org/cgi/man.cgi?query=rc&amp;sektion=8&amp;format=html">rc(8)</a> system of startup scripts during system initialization and for managing services. The scripts listed in <span class=filename>/etc/rc.d</span> provide basic services which can be controlled with the <code>start</code>, <code>stop</code>, and <code>restart</code> options to <a href="https://man.freebsd.org/cgi/man.cgi?query=service&amp;sektion=8&amp;format=html">service(8)</a>. For instance, <a href="https://man.freebsd.org/cgi/man.cgi?query=sshd&amp;sektion=8&amp;format=html">sshd(8)</a> can be restarted with the following command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service sshd restart</span></code></pre></div></div><div class=paragraph><p>This procedure can be used to start services on a running system. Services will be started automatically at boot time as specified in <a href="https://man.freebsd.org/cgi/man.cgi?query=rc.conf&amp;sektion=5&amp;format=html">rc.conf(5)</a>. For example, to enable <a href="https://man.freebsd.org/cgi/man.cgi?query=natd&amp;sektion=8&amp;format=html">natd(8)</a> at system startup, add the following line to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>natd_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>If a <code>natd_enable="NO"</code> line is already present, change the <code>NO</code> to <code>YES</code>. The <a href="https://man.freebsd.org/cgi/man.cgi?query=rc&amp;sektion=8&amp;format=html">rc(8)</a> scripts will automatically load any dependent services during the next boot, as described below.</p></div><div class=paragraph><p>Since the <a href="https://man.freebsd.org/cgi/man.cgi?query=rc&amp;sektion=8&amp;format=html">rc(8)</a> system is primarily intended to start and stop services at system startup and shutdown time, the <code>start</code>, <code>stop</code> and <code>restart</code> options will only perform their action if the appropriate <span class=filename>/etc/rc.conf</span> variable is set. For instance, <code>sshd restart</code> will only work if <code>sshd_enable</code> is set to <code>YES</code> in <span class=filename>/etc/rc.conf</span>. To <code>start</code>, <code>stop</code> or <code>restart</code> a service regardless of the settings in <span class=filename>/etc/rc.conf</span>, these commands should be prefixed with "one". For instance, to restart <a href="https://man.freebsd.org/cgi/man.cgi?query=sshd&amp;sektion=8&amp;format=html">sshd(8)</a> regardless of the current <span class=filename>/etc/rc.conf</span> setting, execute the following command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service sshd onerestart</span></code></pre></div></div><div class=paragraph><p>To check if a service is enabled in <span class=filename>/etc/rc.conf</span>, run the appropriate <a href="https://man.freebsd.org/cgi/man.cgi?query=rc&amp;sektion=8&amp;format=html">rc(8)</a> script with <code>rcvar</code>. This example checks to see if <a href="https://man.freebsd.org/cgi/man.cgi?query=sshd&amp;sektion=8&amp;format=html">sshd(8)</a> is enabled in <span class=filename>/etc/rc.conf</span>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service sshd rcvar</span>
<span class=c># sshd</span>
<span class=c>#</span>
<span class=nv>sshd_enable</span><span class=o>=</span><span class=s2>&#34;YES&#34;</span>
<span class=c>#   (default: &#34;&#34;)</span></code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>The <code># sshd</code> line is output from the above command, not a <code>root</code> console.</p></div></td></tr></tbody></table></div><div class=paragraph><p>To determine whether or not a service is running, use <code>status</code>. For instance, to verify that <a href="https://man.freebsd.org/cgi/man.cgi?query=sshd&amp;sektion=8&amp;format=html">sshd(8)</a> is running:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service sshd status</span>
sshd is running as pid 433.</code></pre></div></div><div class=paragraph><p>In some cases, it is also possible to <code>reload</code> a service. This attempts to send a signal to an individual service, forcing the service to reload its configuration files. In most cases, this means sending the service a <code>SIGHUP</code> signal. Support for this feature is not included for every service.</p></div><div class=paragraph><p>The <a href="https://man.freebsd.org/cgi/man.cgi?query=rc&amp;sektion=8&amp;format=html">rc(8)</a> system is used for network services and it also contributes to most of the system initialization. For instance, when the <span class=filename>/etc/rc.d/bgfsck</span> script is executed, it prints out the following message:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>Starting background file system checks <span class=k>in </span>60 seconds.</code></pre></div></div><div class=paragraph><p>This script is used for background file system checks, which occur only during system initialization.</p></div><div class=paragraph><p>Many system services depend on other services to function properly. For example, <a href="https://man.freebsd.org/cgi/man.cgi?query=yp&amp;sektion=8&amp;format=html">yp(8)</a> and other RPC-based services may fail to start until after the <a href="https://man.freebsd.org/cgi/man.cgi?query=rpcbind&amp;sektion=8&amp;format=html">rpcbind(8)</a> service has started. To resolve this issue, information about dependencies and other meta-data is included in the comments at the top of each startup script. The <a href="https://man.freebsd.org/cgi/man.cgi?query=rcorder&amp;sektion=8&amp;format=html">rcorder(8)</a> program is used to parse these comments during system initialization to determine the order in which system services should be invoked to satisfy the dependencies.</p></div><div class=paragraph><p>The following key word must be included in all startup scripts as it is required by <a href="https://man.freebsd.org/cgi/man.cgi?query=rc.subr&amp;sektion=8&amp;format=html">rc.subr(8)</a> to "enable" the startup script:</p></div><div class=ulist><ul><li><p><code>PROVIDE</code>: Specifies the services this file provides.</p></li></ul></div><div class=paragraph><p>The following key words may be included at the top of each startup script. They are not strictly necessary, but are useful as hints to <a href="https://man.freebsd.org/cgi/man.cgi?query=rcorder&amp;sektion=8&amp;format=html">rcorder(8)</a>:</p></div><div class=ulist><ul><li><p><code>REQUIRE</code>: Lists services which are required for this service. The script containing this key word will run <em>after</em> the specified services.</p></li><li><p><code>BEFORE</code>: Lists services which depend on this service. The script containing this key word will run <em>before</em> the specified services.</p></li></ul></div><div class=paragraph><p>By carefully setting these keywords for each startup script, an administrator has a fine-grained level of control of the startup order of the scripts, without the need for "runlevels" used by some UNIX® operating systems.</p></div><div class=paragraph><p>Additional information can be found in <a href="https://man.freebsd.org/cgi/man.cgi?query=rc&amp;sektion=8&amp;format=html">rc(8)</a> and <a href="https://man.freebsd.org/cgi/man.cgi?query=rc.subr&amp;sektion=8&amp;format=html">rc.subr(8)</a>. Refer to <a href=https://docs.freebsd.org/en/articles/rc-scripting/>this article</a> for instructions on how to create custom <a href="https://man.freebsd.org/cgi/man.cgi?query=rc&amp;sektion=8&amp;format=html">rc(8)</a> scripts.</p></div><div class=sect3><h4 id=configtuning-core-configuration>11.4.1. Managing System-Specific Configuration<a class=anchor href=#configtuning-core-configuration></a></h4><div class=paragraph><p>The principal location for system configuration information is <span class=filename>/etc/rc.conf</span>. This file contains a wide range of configuration information and it is read at system startup to configure the system. It provides the configuration information for the <span class=filename>rc*</span> files.</p></div><div class=paragraph><p>The entries in <span class=filename>/etc/rc.conf</span> override the default settings in <span class=filename>/etc/defaults/rc.conf</span>. The file containing the default settings should not be edited. Instead, all system-specific changes should be made to <span class=filename>/etc/rc.conf</span>.</p></div><div class=paragraph><p>A number of strategies may be applied in clustered applications to separate site-wide configuration from system-specific configuration in order to reduce administration overhead. The recommended approach is to place system-specific configuration into <span class=filename>/etc/rc.conf.local</span>. For example, these entries in <span class=filename>/etc/rc.conf</span> apply to all systems:</p></div><div class="literalblock programlisting"><div class=content><pre>sshd_enable=&#34;YES&#34;
keyrate=&#34;fast&#34;
defaultrouter=&#34;10.1.1.254&#34;</pre></div></div><div class=paragraph><p>Whereas these entries in <span class=filename>/etc/rc.conf.local</span> apply to this system only:</p></div><div class="literalblock programlisting"><div class=content><pre>hostname=&#34;node1.example.org&#34;
ifconfig_fxp0=&#34;inet 10.1.1.1/8&#34;</pre></div></div><div class=paragraph><p>Distribute <span class=filename>/etc/rc.conf</span> to every system using an application such as rsync or puppet, while <span class=filename>/etc/rc.conf.local</span> remains unique.</p></div><div class=paragraph><p>Upgrading the system will not overwrite <span class=filename>/etc/rc.conf</span>, so system configuration information will not be lost.</p></div><div class="admonitionblock tip"><table><tbody><tr><td class=icon><i class="fa icon-tip" title=Tip></i></td><td class=content><div class=paragraph><p>Both <span class=filename>/etc/rc.conf</span> and <span class=filename>/etc/rc.conf.local</span> are parsed by <a href="https://man.freebsd.org/cgi/man.cgi?query=sh&amp;sektion=1&amp;format=html">sh(1)</a>. This allows system operators to create complex configuration scenarios. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=rc.conf&amp;sektion=5&amp;format=html">rc.conf(5)</a> for further information on this topic.</p></div></td></tr></tbody></table></div></div></div><div class=sect2><h3 id=config-network-setup>11.5. Setting Up Network Interface Cards<a class=anchor href=#config-network-setup></a></h3><div class=paragraph><p>Adding and configuring a network interface card (NIC) is a common task for any FreeBSD administrator.</p></div><div class=sect3><h4 id=_locating_the_correct_driver>11.5.1. Locating the Correct Driver<a class=anchor href=#_locating_the_correct_driver></a></h4><div class=paragraph><p>First, determine the model of the NIC and the chip it uses. FreeBSD supports a wide variety of NICs. Check the Hardware Compatibility List for the FreeBSD release to see if the NIC is supported.</p></div><div class=paragraph><p>If the NIC is supported, determine the name of the FreeBSD driver for the NIC. Refer to <span class=filename>/usr/src/sys/conf/NOTES</span> and <span class=filename>/usr/src/sys/arch/conf/NOTES</span> for the list of NIC drivers with some information about the supported chipsets. When in doubt, read the manual page of the driver as it will provide more information about the supported hardware and any known limitations of the driver.</p></div><div class=paragraph><p>The drivers for common NICs are already present in the <span class=filename>GENERIC</span> kernel, meaning the NIC should be probed during boot. The system’s boot messages can be viewed by typing <code>more /var/run/dmesg.boot</code> and using the spacebar to scroll through the text. In this example, two Ethernet NICs using the <a href="https://man.freebsd.org/cgi/man.cgi?query=dc&amp;sektion=4&amp;format=html">dc(4)</a> driver are present on the system:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>dc0: &lt;82c169 PNIC 10/100BaseTX&gt; port 0xa000-0xa0ff mem 0xd3800000-0xd38
000ff irq 15 at device 11.0 on pci0
miibus0: &lt;MII bus&gt; on dc0
bmtphy0: &lt;BCM5201 10/100baseTX PHY&gt; PHY 1 on miibus0
bmtphy0:  10baseT, 10baseT-FDX, 100baseTX, 100baseTX-FDX, auto
dc0: Ethernet address: 00:a0:cc:da:da:da
dc0: <span class=o>[</span>ITHREAD]
dc1: &lt;82c169 PNIC 10/100BaseTX&gt; port 0x9800-0x98ff mem 0xd3000000-0xd30
000ff irq 11 at device 12.0 on pci0
miibus1: &lt;MII bus&gt; on dc1
bmtphy1: &lt;BCM5201 10/100baseTX PHY&gt; PHY 1 on miibus1
bmtphy1:  10baseT, 10baseT-FDX, 100baseTX, 100baseTX-FDX, auto
dc1: Ethernet address: 00:a0:cc:da:da:db
dc1: <span class=o>[</span>ITHREAD]</code></pre></div></div><div class=paragraph><p>If the driver for the NIC is not present in <span class=filename>GENERIC</span>, but a driver is available, the driver will need to be loaded before the NIC can be configured and used. This may be accomplished in one of two ways:</p></div><div class=ulist><ul><li><p>The easiest way is to load a kernel module for the NIC using <a href="https://man.freebsd.org/cgi/man.cgi?query=kldload&amp;sektion=8&amp;format=html">kldload(8)</a>. To also automatically load the driver at boot time, add the appropriate line to <span class=filename>/boot/loader.conf</span>. Not all NIC drivers are available as modules.</p></li><li><p>Alternatively, statically compile support for the NIC into a custom kernel. Refer to <span class=filename>/usr/src/sys/conf/NOTES</span>, <span class=filename>/usr/src/sys/arch/conf/NOTES</span> and the manual page of the driver to determine which line to add to the custom kernel configuration file. For more information about recompiling the kernel, refer to <a href=./#kernelconfig>Configuring the FreeBSD Kernel</a>. If the NIC was detected at boot, the kernel does not need to be recompiled.</p></li></ul></div><div class=sect4><h5 id=config-network-ndis>11.5.1.1. Using Windows® NDIS Drivers<a class=anchor href=#config-network-ndis></a></h5><div class=paragraph><p>Unfortunately, there are still many vendors that do not provide schematics for their drivers to the open source community because they regard such information as trade secrets. Consequently, the developers of FreeBSD and other operating systems are left with two choices: develop the drivers by a long and pain-staking process of reverse engineering or using the existing driver binaries available for Microsoft® Windows® platforms.</p></div><div class=paragraph><p>FreeBSD provides "native" support for the Network Driver Interface Specification (NDIS). It includes <a href="https://man.freebsd.org/cgi/man.cgi?query=ndisgen&amp;sektion=8&amp;format=html">ndisgen(8)</a> which can be used to convert a Windows® XP driver into a format that can be used on FreeBSD. Because the <a href="https://man.freebsd.org/cgi/man.cgi?query=ndis&amp;sektion=4&amp;format=html">ndis(4)</a> driver uses a Windows® XP binary, it only runs on i386™ and amd64 systems. PCI, CardBus, PCMCIA, and USB devices are supported.</p></div><div class=paragraph><p>To use <a href="https://man.freebsd.org/cgi/man.cgi?query=ndisgen&amp;sektion=8&amp;format=html">ndisgen(8)</a>, three things are needed:</p></div><div class="olist arabic"><ol class=arabic><li><p>FreeBSD kernel sources.</p></li><li><p>A Windows® XP driver binary with a <span class=filename>.SYS</span> extension.</p></li><li><p>A Windows® XP driver configuration file with a <span class=filename>.INF</span> extension.</p></li></ol></div><div class=paragraph><p>Download the <span class=filename>.SYS</span> and <span class=filename>.INF</span> files for the specific NIC. Generally, these can be found on the driver CD or at the vendor’s website. The following examples use <span class=filename>W32DRIVER.SYS</span> and <span class=filename>W32DRIVER.INF</span>.</p></div><div class=paragraph><p>The driver bit width must match the version of FreeBSD. For FreeBSD/i386, use a Windows® 32-bit driver. For FreeBSD/amd64, a Windows® 64-bit driver is needed.</p></div><div class=paragraph><p>The next step is to compile the driver binary into a loadable kernel module. As <code>root</code>, use <a href="https://man.freebsd.org/cgi/man.cgi?query=ndisgen&amp;sektion=8&amp;format=html">ndisgen(8)</a>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ndisgen /path/to/W32DRIVER.INF /path/to/W32DRIVER.SYS</span></code></pre></div></div><div class=paragraph><p>This command is interactive and prompts for any extra information it requires. A new kernel module will be generated in the current directory. Use <a href="https://man.freebsd.org/cgi/man.cgi?query=kldload&amp;sektion=8&amp;format=html">kldload(8)</a> to load the new module:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># kldload ./W32DRIVER_SYS.ko</span></code></pre></div></div><div class=paragraph><p>In addition to the generated kernel module, the <span class=filename>ndis.ko</span> and <span class=filename>if_ndis.ko</span> modules must be loaded. This should happen automatically when any module that depends on <a href="https://man.freebsd.org/cgi/man.cgi?query=ndis&amp;sektion=4&amp;format=html">ndis(4)</a> is loaded. If not, load them manually, using the following commands:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># kldload ndis</span>
<span class=c># kldload if_ndis</span></code></pre></div></div><div class=paragraph><p>The first command loads the <a href="https://man.freebsd.org/cgi/man.cgi?query=ndis&amp;sektion=4&amp;format=html">ndis(4)</a> miniport driver wrapper and the second loads the generated NIC driver.</p></div><div class=paragraph><p>Check <a href="https://man.freebsd.org/cgi/man.cgi?query=dmesg&amp;sektion=8&amp;format=html">dmesg(8)</a> to see if there were any load errors. If all went well, the output should be similar to the following:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>ndis0: &lt;Wireless-G PCI Adapter&gt; mem 0xf4100000-0xf4101fff irq 3 at device 8.0 on pci1
ndis0: NDIS API version: 5.0
ndis0: Ethernet address: 0a:b1:2c:d3:4e:f5
ndis0: 11b rates: 1Mbps 2Mbps 5.5Mbps 11Mbps
ndis0: 11g rates: 6Mbps 9Mbps 12Mbps 18Mbps 36Mbps 48Mbps 54Mbps</code></pre></div></div><div class=paragraph><p>From here, <span class=filename>ndis0</span> can be configured like any other NIC.</p></div><div class=paragraph><p>To configure the system to load the <a href="https://man.freebsd.org/cgi/man.cgi?query=ndis&amp;sektion=4&amp;format=html">ndis(4)</a> modules at boot time, copy the generated module, <span class=filename>W32DRIVER_SYS.ko</span>, to <span class=filename>/boot/modules</span>. Then, add the following line to <span class=filename>/boot/loader.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>W32DRIVER_SYS_load=&#34;YES&#34;</pre></div></div></div></div><div class=sect3><h4 id=_configuring_the_network_card>11.5.2. Configuring the Network Card<a class=anchor href=#_configuring_the_network_card></a></h4><div class=paragraph><p>Once the right driver is loaded for the NIC, the card needs to be configured. It may have been configured at installation time by <a href="https://man.freebsd.org/cgi/man.cgi?query=bsdinstall&amp;sektion=8&amp;format=html">bsdinstall(8)</a>.</p></div><div class=paragraph><p>To display the NIC configuration, enter the following command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% ifconfig
dc0: <span class=nv>flags</span><span class=o>=</span>8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
        <span class=nv>options</span><span class=o>=</span>80008&lt;VLAN_MTU,LINKSTATE&gt;
        ether 00:a0:cc:da:da:da
        inet 192.168.1.3 netmask 0xffffff00 broadcast 192.168.1.255
        media: Ethernet autoselect <span class=o>(</span>100baseTX &lt;full-duplex&gt;<span class=o>)</span>
        status: active
dc1: <span class=nv>flags</span><span class=o>=</span>8802&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
        <span class=nv>options</span><span class=o>=</span>80008&lt;VLAN_MTU,LINKSTATE&gt;
        ether 00:a0:cc:da:da:db
        inet 10.0.0.1 netmask 0xffffff00 broadcast 10.0.0.255
        media: Ethernet 10baseT/UTP
        status: no carrier
lo0: <span class=nv>flags</span><span class=o>=</span>8049&lt;UP,LOOPBACK,RUNNING,MULTICAST&gt; metric 0 mtu 16384
        <span class=nv>options</span><span class=o>=</span>3&lt;RXCSUM,TXCSUM&gt;
        inet6 fe80::1%lo0 prefixlen 64 scopeid 0x4
        inet6 ::1 prefixlen 128
        inet 127.0.0.1 netmask 0xff000000
        nd6 <span class=nv>options</span><span class=o>=</span>3&lt;PERFORMNUD,ACCEPT_RTADV&gt;</code></pre></div></div><div class=paragraph><p>In this example, the following devices were displayed:</p></div><div class=ulist><ul><li><p><span class=filename>dc0</span>: The first Ethernet interface.</p></li><li><p><span class=filename>dc1</span>: The second Ethernet interface.</p></li><li><p><span class=filename>lo0</span>: The loopback device.</p></li></ul></div><div class=paragraph><p>FreeBSD uses the driver name followed by the order in which the card is detected at boot to name the NIC. For example, <span class=filename>sis2</span> is the third NIC on the system using the <a href="https://man.freebsd.org/cgi/man.cgi?query=sis&amp;sektion=4&amp;format=html">sis(4)</a> driver.</p></div><div class=paragraph><p>In this example, <span class=filename>dc0</span> is up and running. The key indicators are:</p></div><div class="olist arabic"><ol class=arabic><li><p><code>UP</code> means that the card is configured and ready.</p></li><li><p>The card has an Internet (<code>inet</code>) address, <code>192.168.1.3</code>.</p></li><li><p>It has a valid subnet mask (<code>netmask</code>), where <code>0xffffff00</code> is the same as <code>255.255.255.0</code>.</p></li><li><p>It has a valid broadcast address, <code>192.168.1.255</code>.</p></li><li><p>The MAC address of the card (<code>ether</code>) is <code>00:a0:cc:da:da:da</code>.</p></li><li><p>The physical media selection is on autoselection mode (<code>media: Ethernet autoselect (100baseTX &lt;full-duplex>)</code>). In this example, <span class=filename>dc1</span> is configured to run with <code>10baseT/UTP</code> media. For more information on available media types for a driver, refer to its manual page.</p></li><li><p>The status of the link (<code>status</code>) is <code>active</code>, indicating that the carrier signal is detected. For <span class=filename>dc1</span>, the <code>status: no carrier</code> status is normal when an Ethernet cable is not plugged into the card.</p></li></ol></div><div class=paragraph><p>If the <a href="https://man.freebsd.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;format=html">ifconfig(8)</a> output had shown something similar to:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>dc0: <span class=nv>flags</span><span class=o>=</span>8843&lt;BROADCAST,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
	<span class=nv>options</span><span class=o>=</span>80008&lt;VLAN_MTU,LINKSTATE&gt;
	ether 00:a0:cc:da:da:da
	media: Ethernet autoselect <span class=o>(</span>100baseTX &lt;full-duplex&gt;<span class=o>)</span>
	status: active</code></pre></div></div><div class=paragraph><p>it would indicate the card has not been configured.</p></div><div class=paragraph><p>The card must be configured as <code>root</code>. The NIC configuration can be performed from the command line with <a href="https://man.freebsd.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;format=html">ifconfig(8)</a> but will not persist after a reboot unless the configuration is also added to <span class=filename>/etc/rc.conf</span>. If a DHCP server is present on the LAN, just add this line:</p></div><div class="literalblock programlisting"><div class=content><pre>ifconfig_dc0=&#34;DHCP&#34;</pre></div></div><div class=paragraph><p>Replace <em>dc0</em> with the correct value for the system.</p></div><div class=paragraph><p>The line added, then, follow the instructions given in <a href=#config-network-testing>Testing and Troubleshooting</a>.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>If the network was configured during installation, some entries for the NIC(s) may be already present. Double check <span class=filename>/etc/rc.conf</span> before adding any lines.</p></div></td></tr></tbody></table></div><div class=paragraph><p>If there is no DHCP server, the NIC(s) must be configured manually. Add a line for each NIC present on the system, as seen in this example:</p></div><div class="literalblock programlisting"><div class=content><pre>ifconfig_dc0=&#34;inet 192.168.1.3 netmask 255.255.255.0&#34;
ifconfig_dc1=&#34;inet 10.0.0.1 netmask 255.255.255.0 media 10baseT/UTP&#34;</pre></div></div><div class=paragraph><p>Replace <span class=filename>dc0</span> and <span class=filename>dc1</span> and the IP address information with the correct values for the system. Refer to the man page for the driver, <a href="https://man.freebsd.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;format=html">ifconfig(8)</a>, and <a href="https://man.freebsd.org/cgi/man.cgi?query=rc.conf&amp;sektion=5&amp;format=html">rc.conf(5)</a> for more details about the allowed options and the syntax of <span class=filename>/etc/rc.conf</span>.</p></div><div class=paragraph><p>If the network is not using DNS, edit <span class=filename>/etc/hosts</span> to add the names and IP addresses of the hosts on the LAN, if they are not already there. For more information, refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=hosts&amp;sektion=5&amp;format=html">hosts(5)</a> and to <span class=filename>/usr/shared/examples/etc/hosts</span>.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>If there is no DHCP server and access to the Internet is needed, manually configure the default gateway and the nameserver:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># echo &#39;defaultrouter=&#34;your_default_router&#34;&#39; &gt;&gt; /etc/rc.conf</span>
<span class=c># echo &#39;nameserver your_DNS_server&#39; &gt;&gt; /etc/resolv.conf</span></code></pre></div></div></td></tr></tbody></table></div></div><div class=sect3><h4 id=config-network-testing>11.5.3. Testing and Troubleshooting<a class=anchor href=#config-network-testing></a></h4><div class=paragraph><p>Once the necessary changes to <span class=filename>/etc/rc.conf</span> are saved, a reboot can be used to test the network configuration and to verify that the system restarts without any configuration errors. Alternatively, apply the settings to the networking system with this command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service netif restart</span></code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>If a default gateway has been set in <span class=filename>/etc/rc.conf</span>, also issue this command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service routing restart</span></code></pre></div></div></td></tr></tbody></table></div><div class=paragraph><p>Once the networking system has been relaunched, test the NICs.</p></div><div class=sect4><h5 id=_testing_the_ethernet_card>11.5.3.1. Testing the Ethernet Card<a class=anchor href=#_testing_the_ethernet_card></a></h5><div class=paragraph><p>To verify that an Ethernet card is configured correctly, <a href="https://man.freebsd.org/cgi/man.cgi?query=ping&amp;sektion=8&amp;format=html">ping(8)</a> the interface itself, and then <a href="https://man.freebsd.org/cgi/man.cgi?query=ping&amp;sektion=8&amp;format=html">ping(8)</a> another machine on the LAN:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% ping <span class=nt>-c5</span> 192.168.1.3
PING 192.168.1.3 <span class=o>(</span>192.168.1.3<span class=o>)</span>: 56 data bytes
64 bytes from 192.168.1.3: <span class=nv>icmp_seq</span><span class=o>=</span>0 <span class=nv>ttl</span><span class=o>=</span>64 <span class=nb>time</span><span class=o>=</span>0.082 ms
64 bytes from 192.168.1.3: <span class=nv>icmp_seq</span><span class=o>=</span>1 <span class=nv>ttl</span><span class=o>=</span>64 <span class=nb>time</span><span class=o>=</span>0.074 ms
64 bytes from 192.168.1.3: <span class=nv>icmp_seq</span><span class=o>=</span>2 <span class=nv>ttl</span><span class=o>=</span>64 <span class=nb>time</span><span class=o>=</span>0.076 ms
64 bytes from 192.168.1.3: <span class=nv>icmp_seq</span><span class=o>=</span>3 <span class=nv>ttl</span><span class=o>=</span>64 <span class=nb>time</span><span class=o>=</span>0.108 ms
64 bytes from 192.168.1.3: <span class=nv>icmp_seq</span><span class=o>=</span>4 <span class=nv>ttl</span><span class=o>=</span>64 <span class=nb>time</span><span class=o>=</span>0.076 ms

<span class=nt>---</span> 192.168.1.3 ping statistics <span class=nt>---</span>
5 packets transmitted, 5 packets received, 0% packet loss
round-trip min/avg/max/stddev <span class=o>=</span> 0.074/0.083/0.108/0.013 ms</code></pre></div></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% ping <span class=nt>-c5</span> 192.168.1.2
PING 192.168.1.2 <span class=o>(</span>192.168.1.2<span class=o>)</span>: 56 data bytes
64 bytes from 192.168.1.2: <span class=nv>icmp_seq</span><span class=o>=</span>0 <span class=nv>ttl</span><span class=o>=</span>64 <span class=nb>time</span><span class=o>=</span>0.726 ms
64 bytes from 192.168.1.2: <span class=nv>icmp_seq</span><span class=o>=</span>1 <span class=nv>ttl</span><span class=o>=</span>64 <span class=nb>time</span><span class=o>=</span>0.766 ms
64 bytes from 192.168.1.2: <span class=nv>icmp_seq</span><span class=o>=</span>2 <span class=nv>ttl</span><span class=o>=</span>64 <span class=nb>time</span><span class=o>=</span>0.700 ms
64 bytes from 192.168.1.2: <span class=nv>icmp_seq</span><span class=o>=</span>3 <span class=nv>ttl</span><span class=o>=</span>64 <span class=nb>time</span><span class=o>=</span>0.747 ms
64 bytes from 192.168.1.2: <span class=nv>icmp_seq</span><span class=o>=</span>4 <span class=nv>ttl</span><span class=o>=</span>64 <span class=nb>time</span><span class=o>=</span>0.704 ms

<span class=nt>---</span> 192.168.1.2 ping statistics <span class=nt>---</span>
5 packets transmitted, 5 packets received, 0% packet loss
round-trip min/avg/max/stddev <span class=o>=</span> 0.700/0.729/0.766/0.025 ms</code></pre></div></div><div class=paragraph><p>To test network resolution, use the host name instead of the IP address. If there is no DNS server on the network, <span class=filename>/etc/hosts</span> must first be configured. To this purpose, edit <span class=filename>/etc/hosts</span> to add the names and IP addresses of the hosts on the LAN, if they are not already there. For more information, refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=hosts&amp;sektion=5&amp;format=html">hosts(5)</a> and to <span class=filename>/usr/shared/examples/etc/hosts</span>.</p></div></div><div class=sect4><h5 id=_troubleshooting_2>11.5.3.2. Troubleshooting<a class=anchor href=#_troubleshooting_2></a></h5><div class=paragraph><p>When troubleshooting hardware and software configurations, check the simple things first. Is the network cable plugged in? Are the network services properly configured? Is the firewall configured correctly? Is the NIC supported by FreeBSD? Before sending a bug report, always check the Hardware Notes, update the version of FreeBSD to the latest STABLE version, check the mailing list archives, and search the Internet.</p></div><div class=paragraph><p>If the card works, yet performance is poor, read through <a href="https://man.freebsd.org/cgi/man.cgi?query=tuning&amp;sektion=7&amp;format=html">tuning(7)</a>. Also, check the network configuration as incorrect network settings can cause slow connections.</p></div><div class=paragraph><p>Some users experience one or two <code>device timeout</code> messages, which is normal for some cards. If they continue, or are bothersome, determine if the device is conflicting with another device. Double check the cable connections. Consider trying another card.</p></div><div class=paragraph><p>To resolve <code>watchdog timeout</code> errors, first check the network cable. Many cards require a PCI slot which supports bus mastering. On some old motherboards, only one PCI slot allows it, usually slot 0. Check the NIC and the motherboard documentation to determine if that may be the problem.</p></div><div class=paragraph><p><code>No route to host</code> messages occur if the system is unable to route a packet to the destination host. This can happen if no default route is specified or if a cable is unplugged. Check the output of <code>netstat -rn</code> and make sure there is a valid route to the host. If there is not, read <a href=./#network-routing>“Gateways and Routes”</a>.</p></div><div class=paragraph><p><code>ping: sendto: Permission denied</code> error messages are often caused by a misconfigured firewall. If a firewall is enabled on FreeBSD but no rules have been defined, the default policy is to deny all traffic, even <a href="https://man.freebsd.org/cgi/man.cgi?query=ping&amp;sektion=8&amp;format=html">ping(8)</a>. Refer to <a href=./#firewalls>Firewalls</a> for more information.</p></div><div class=paragraph><p>Sometimes performance of the card is poor or below average. In these cases, try setting the media selection mode from <code>autoselect</code> to the correct media selection. While this works for most hardware, it may or may not resolve the issue. Again, check all the network settings, and refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=tuning&amp;sektion=7&amp;format=html">tuning(7)</a>.</p></div></div></div></div><div class=sect2><h3 id=configtuning-virtual-hosts>11.6. Virtual Hosts<a class=anchor href=#configtuning-virtual-hosts></a></h3><div class=paragraph><p>A common use of FreeBSD is virtual site hosting, where one server appears to the network as many servers. This is achieved by assigning multiple network addresses to a single interface.</p></div><div class=paragraph><p>A given network interface has one "real" address, and may have any number of "alias" addresses. These aliases are normally added by placing alias entries in <span class=filename>/etc/rc.conf</span>, as seen in this example:</p></div><div class="literalblock programlisting"><div class=content><pre>ifconfig_fxp0_alias0=&#34;inet xxx.xxx.xxx.xxx netmask xxx.xxx.xxx.xxx&#34;</pre></div></div><div class=paragraph><p>Alias entries must start with <code>alias<em>0</em></code> using a sequential number such as <code>alias0</code>, <code>alias1</code>, and so on. The configuration process will stop at the first missing number.</p></div><div class=paragraph><p>The calculation of alias netmasks is important. For a given interface, there must be one address which correctly represents the network’s netmask. Any other addresses which fall within this network must have a netmask of all <code>1</code>s, expressed as either <code>255.255.255.255</code> or <code>0xffffffff</code>.</p></div><div class=paragraph><p>For example, consider the case where the <span class=filename>fxp0</span> interface is connected to two networks: <code>10.1.1.0</code> with a netmask of <code>255.255.255.0</code> and <code>202.0.75.16</code> with a netmask of <code>255.255.255.240</code>. The system is to be configured to appear in the ranges <code>10.1.1.1</code> through <code>10.1.1.5</code> and <code>202.0.75.17</code> through <code>202.0.75.20</code>. Only the first address in a given network range should have a real netmask. All the rest (<code>10.1.1.2</code> through <code>10.1.1.5</code> and <code>202.0.75.18</code> through <code>202.0.75.20</code>) must be configured with a netmask of <code>255.255.255.255</code>.</p></div><div class=paragraph><p>The following <span class=filename>/etc/rc.conf</span> entries configure the adapter correctly for this scenario:</p></div><div class="literalblock programlisting"><div class=content><pre>ifconfig_fxp0=&#34;inet 10.1.1.1 netmask 255.255.255.0&#34;
ifconfig_fxp0_alias0=&#34;inet 10.1.1.2 netmask 255.255.255.255&#34;
ifconfig_fxp0_alias1=&#34;inet 10.1.1.3 netmask 255.255.255.255&#34;
ifconfig_fxp0_alias2=&#34;inet 10.1.1.4 netmask 255.255.255.255&#34;
ifconfig_fxp0_alias3=&#34;inet 10.1.1.5 netmask 255.255.255.255&#34;
ifconfig_fxp0_alias4=&#34;inet 202.0.75.17 netmask 255.255.255.240&#34;
ifconfig_fxp0_alias5=&#34;inet 202.0.75.18 netmask 255.255.255.255&#34;
ifconfig_fxp0_alias6=&#34;inet 202.0.75.19 netmask 255.255.255.255&#34;
ifconfig_fxp0_alias7=&#34;inet 202.0.75.20 netmask 255.255.255.255&#34;</pre></div></div><div class=paragraph><p>A simpler way to express this is with a space-separated list of IP address ranges. The first address will be given the indicated subnet mask and the additional addresses will have a subnet mask of <code>255.255.255.255</code>.</p></div><div class="literalblock programlisting"><div class=content><pre>ifconfig_fxp0_aliases=&#34;inet 10.1.1.1-5/24 inet 202.0.75.17-20/28&#34;</pre></div></div></div><div class=sect2><h3 id=configtuning-syslog>11.7. Configuring System Logging<a class=anchor href=#configtuning-syslog></a></h3><div class=paragraph><p>Generating and reading system logs is an important aspect of system administration. The information in system logs can be used to detect hardware and software issues as well as application and system configuration errors. This information also plays an important role in security auditing and incident response. Most system daemons and applications will generate log entries.</p></div><div class=paragraph><p>FreeBSD provides a system logger, syslogd, to manage logging. By default, syslogd is started when the system boots. This is controlled by the variable <code>syslogd_enable</code> in <span class=filename>/etc/rc.conf</span>. There are numerous application arguments that can be set using <code>syslogd_flags</code> in <span class=filename>/etc/rc.conf</span>. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=syslogd&amp;sektion=8&amp;format=html">syslogd(8)</a> for more information on the available arguments.</p></div><div class=paragraph><p>This section describes how to configure the FreeBSD system logger for both local and remote logging and how to perform log rotation and log management.</p></div><div class=sect3><h4 id=_configuring_local_logging>11.7.1. Configuring Local Logging<a class=anchor href=#_configuring_local_logging></a></h4><div class=paragraph><p>The configuration file, <span class=filename>/etc/syslog.conf</span>, controls what syslogd does with log entries as they are received. There are several parameters to control the handling of incoming events. The <em>facility</em> describes which subsystem generated the message, such as the kernel or a daemon, and the <em>level</em> describes the severity of the event that occurred. This makes it possible to configure if and where a log message is logged, depending on the facility and level. It is also possible to take action depending on the application that sent the message, and in the case of remote logging, the hostname of the machine generating the logging event.</p></div><div class=paragraph><p>This configuration file contains one line per action, where the syntax for each line is a selector field followed by an action field. The syntax of the selector field is <em>facility.level</em> which will match log messages from <em>facility</em> at level <em>level</em> or higher. It is also possible to add an optional comparison flag before the level to specify more precisely what is logged. Multiple selector fields can be used for the same action, and are separated with a semicolon (<code>;</code>). Using <code>*</code> will match everything. The action field denotes where to send the log message, such as to a file or remote log host. As an example, here is the default <span class=filename>syslog.conf</span> from FreeBSD:</p></div><div class="literalblock programlisting"><div class=content><pre># $FreeBSD$
#
#       Spaces ARE valid field separators in this file. However,
#       other *nix-like systems still insist on using tabs as field
#       separators. If you are sharing this file between systems, you
#       may want to use only tabs as field separators here.
#       Consult the syslog.conf(5) manpage.
*.err;kern.warning;auth.notice;mail.crit                /dev/console
*.notice;authpriv.none;kern.debug;lpr.info;mail.crit;news.err   /var/log/messages
security.*                                      /var/log/security
auth.info;authpriv.info                         /var/log/auth.log
mail.info                                       /var/log/maillog
lpr.info                                        /var/log/lpd-errs
ftp.info                                        /var/log/xferlog
cron.*                                          /var/log/cron
!-devd
*.=debug                                        /var/log/debug.log
*.emerg                                         *
# uncomment this to log all writes to /dev/console to /var/log/console.log
#console.info                                   /var/log/console.log
# uncomment this to enable logging of all log messages to /var/log/all.log
# touch /var/log/all.log and chmod it to mode 600 before it will work
#*.*                                            /var/log/all.log
# uncomment this to enable logging to a remote loghost named loghost
#*.*                                            @loghost
# uncomment these if you&#39;re running inn
# news.crit                                     /var/log/news/news.crit
# news.err                                      /var/log/news/news.err
# news.notice                                   /var/log/news/news.notice
# Uncomment this if you wish to see messages produced by devd
# !devd
# *.&gt;=info
!ppp
*.*                                             /var/log/ppp.log
!*</pre></div></div><div class=paragraph><p>In this example:</p></div><div class=ulist><ul><li><p>Line 8 matches all messages with a level of <code>err</code> or higher, as well as <code>kern.warning</code>, <code>auth.notice</code> and <code>mail.crit</code>, and sends these log messages to the console (<span class=filename>/dev/console</span>).</p></li><li><p>Line 12 matches all messages from the <code>mail</code> facility at level <code>info</code> or above and logs the messages to <span class=filename>/var/log/maillog</span>.</p></li><li><p>Line 17 uses a comparison flag (<code>=</code>) to only match messages at level <code>debug</code> and logs them to <span class=filename>/var/log/debug.log</span>.</p></li><li><p>Line 33 is an example usage of a program specification. This makes the rules following it only valid for the specified program. In this case, only the messages generated by ppp are logged to <span class=filename>/var/log/ppp.log</span>.</p></li></ul></div><div class=paragraph><p>The available levels, in order from most to least critical are <code>emerg</code>, <code>alert</code>, <code>crit</code>, <code>err</code>, <code>warning</code>, <code>notice</code>, <code>info</code>, and <code>debug</code>.</p></div><div class=paragraph><p>The facilities, in no particular order, are <code>auth</code>, <code>authpriv</code>, <code>console</code>, <code>cron</code>, <code>daemon</code>, <code>ftp</code>, <code>kern</code>, <code>lpr</code>, <code>mail</code>, <code>mark</code>, <code>news</code>, <code>security</code>, <code>syslog</code>, <code>user</code>, <code>uucp</code>, and <code>local0</code> through <code>local7</code>. Be aware that other operating systems might have different facilities.</p></div><div class=paragraph><p>To log everything of level <code>notice</code> and higher to <span class=filename>/var/log/daemon.log</span>, add the following entry:</p></div><div class="literalblock programlisting"><div class=content><pre>daemon.notice                                        /var/log/daemon.log</pre></div></div><div class=paragraph><p>For more information about the different levels and facilities, refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=syslog&amp;sektion=3&amp;format=html">syslog(3)</a> and <a href="https://man.freebsd.org/cgi/man.cgi?query=syslogd&amp;sektion=8&amp;format=html">syslogd(8)</a>. For more information about <span class=filename>/etc/syslog.conf</span>, its syntax, and more advanced usage examples, see <a href="https://man.freebsd.org/cgi/man.cgi?query=syslog.conf&amp;sektion=5&amp;format=html">syslog.conf(5)</a>.</p></div></div><div class=sect3><h4 id=_log_management_and_rotation>11.7.2. Log Management and Rotation<a class=anchor href=#_log_management_and_rotation></a></h4><div class=paragraph><p>Log files can grow quickly, taking up disk space and making it more difficult to locate useful information. Log management attempts to mitigate this. In FreeBSD, newsyslog is used to manage log files. This built-in program periodically rotates and compresses log files, and optionally creates missing log files and signals programs when log files are moved. The log files may be generated by syslogd or by any other program which generates log files. While newsyslog is normally run from <a href="https://man.freebsd.org/cgi/man.cgi?query=cron&amp;sektion=8&amp;format=html">cron(8)</a>, it is not a system daemon. In the default configuration, it runs every hour.</p></div><div class=paragraph><p>To know which actions to take, newsyslog reads its configuration file, <span class=filename>/etc/newsyslog.conf</span>. This file contains one line for each log file that newsyslog manages. Each line states the file owner, permissions, when to rotate that file, optional flags that affect log rotation, such as compression, and programs to signal when the log is rotated. Here is the default configuration in FreeBSD:</p></div><div class="literalblock programlisting"><div class=content><pre># configuration file for newsyslog
# $FreeBSD$
#
# Entries which do not specify the &#39;/pid_file&#39; field will cause the
# syslogd process to be signalled when that log file is rotated.  This
# action is only appropriate for log files which are written to by the
# syslogd process (ie, files listed in /etc/syslog.conf).  If there
# is no process which needs to be signalled when a given log file is
# rotated, then the entry for that file should include the &#39;N&#39; flag.
#
# The &#39;flags&#39; field is one or more of the letters: BCDGJNUXZ or a &#39;-&#39;.
#
# Note: some sites will want to select more restrictive protections than the
# defaults.  In particular, it may be desirable to switch many of the 644
# entries to 640 or 600.  For example, some sites will consider the
# contents of maillog, messages, and lpd-errs to be confidential.  In the
# future, these defaults may change to more conservative ones.
#
# logfilename          [owner:group]    mode count size when  flags [/pid_file] [sig_num]
/var/log/all.log                        600  7     *    @T00  J
/var/log/amd.log                        644  7     100  *     J
/var/log/auth.log                       600  7     100  @0101T JC
/var/log/console.log                    600  5     100  *     J
/var/log/cron                           600  3     100  *     JC
/var/log/daily.log                      640  7     *    @T00  JN
/var/log/debug.log                      600  7     100  *     JC
/var/log/kerberos.log                   600  7     100  *     J
/var/log/lpd-errs                       644  7     100  *     JC
/var/log/maillog                        640  7     *    @T00  JC
/var/log/messages                       644  5     100  @0101T JC
/var/log/monthly.log                    640  12    *    $M1D0 JN
/var/log/pflog                          600  3     100  *     JB    /var/run/pflogd.pid
/var/log/ppp.log        root:network    640  3     100  *     JC
/var/log/devd.log                       644  3     100  *     JC
/var/log/security                       600  10    100  *     JC
/var/log/sendmail.st                    640  10    *    168   B
/var/log/utx.log                        644  3     *    @01T05 B
/var/log/weekly.log                     640  5     1    $W6D0 JN
/var/log/xferlog                        600  7     100  *     JC</pre></div></div><div class=paragraph><p>Each line starts with the name of the log to be rotated, optionally followed by an owner and group for both rotated and newly created files. The <code>mode</code> field sets the permissions on the log file and <code>count</code> denotes how many rotated log files should be kept. The <code>size</code> and <code>when</code> fields tell newsyslog when to rotate the file. A log file is rotated when either its size is larger than the <code>size</code> field or when the time in the <code>when</code> field has passed. An asterisk (<code>*</code>) means that this field is ignored. The <em>flags</em> field gives further instructions, such as how to compress the rotated file or to create the log file if it is missing. The last two fields are optional and specify the name of the Process ID (PID) file of a process and a signal number to send to that process when the file is rotated.</p></div><div class=paragraph><p>For more information on all fields, valid flags, and how to specify the rotation time, refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=newsyslog.conf&amp;sektion=5&amp;format=html">newsyslog.conf(5)</a>. Since newsyslog is run from <a href="https://man.freebsd.org/cgi/man.cgi?query=cron&amp;sektion=8&amp;format=html">cron(8)</a>, it cannot rotate files more often than it is scheduled to run from <a href="https://man.freebsd.org/cgi/man.cgi?query=cron&amp;sektion=8&amp;format=html">cron(8)</a>.</p></div></div><div class=sect3><h4 id=network-syslogd>11.7.3. Configuring Remote Logging<a class=anchor href=#network-syslogd></a></h4><div class=paragraph><p>Monitoring the log files of multiple hosts can become unwieldy as the number of systems increases. Configuring centralized logging can reduce some of the administrative burden of log file administration.</p></div><div class=paragraph><p>In FreeBSD, centralized log file aggregation, merging, and rotation can be configured using syslogd and newsyslog. This section demonstrates an example configuration, where host <code>A</code>, named <code>logserv.example.com</code>, will collect logging information for the local network. Host <code>B</code>, named <code>logclient.example.com</code>, will be configured to pass logging information to the logging server.</p></div><div class=sect4><h5 id=_log_server_configuration>11.7.3.1. Log Server Configuration<a class=anchor href=#_log_server_configuration></a></h5><div class=paragraph><p>A log server is a system that has been configured to accept logging information from other hosts. Before configuring a log server, check the following:</p></div><div class=ulist><ul><li><p>If there is a firewall between the logging server and any logging clients, ensure that the firewall ruleset allows UDP port 514 for both the clients and the server.</p></li><li><p>The logging server and all client machines must have forward and reverse entries in the local DNS. If the network does not have a DNS server, create entries in each system’s <span class=filename>/etc/hosts</span>. Proper name resolution is required so that log entries are not rejected by the logging server.</p></li></ul></div><div class=paragraph><p>On the log server, edit <span class=filename>/etc/syslog.conf</span> to specify the name of the client to receive log entries from, the logging facility to be used, and the name of the log to store the host’s log entries. This example adds the hostname of <code>B</code>, logs all facilities, and stores the log entries in <span class=filename>/var/log/logclient.log</span>.</p></div><div class=exampleblock><div class=title>Przykład 6. Sample Log Server Configuration</div><div class=content><div class="literalblock programlisting"><div class=content><pre>+logclient.example.com
*.*     /var/log/logclient.log</pre></div></div></div></div><div class=paragraph><p>When adding multiple log clients, add a similar two-line entry for each client. More information about the available facilities may be found in <a href="https://man.freebsd.org/cgi/man.cgi?query=syslog.conf&amp;sektion=5&amp;format=html">syslog.conf(5)</a>.</p></div><div class=paragraph><p>Next, configure <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>syslogd_enable=&#34;YES&#34;
syslogd_flags=&#34;-a logclient.example.com -v -v&#34;</pre></div></div><div class=paragraph><p>The first entry starts syslogd at system boot. The second entry allows log entries from the specified client. The <code>-v -v</code> increases the verbosity of logged messages. This is useful for tweaking facilities as administrators are able to see what type of messages are being logged under each facility.</p></div><div class=paragraph><p>Multiple <code>-a</code> options may be specified to allow logging from multiple clients. IP addresses and whole netblocks may also be specified. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=syslogd&amp;sektion=8&amp;format=html">syslogd(8)</a> for a full list of possible options.</p></div><div class=paragraph><p>Finally, create the log file:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># touch /var/log/logclient.log</span></code></pre></div></div><div class=paragraph><p>At this point, syslogd should be restarted and verified:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service syslogd restart</span>
<span class=c># pgrep syslog</span></code></pre></div></div><div class=paragraph><p>If a PID is returned, the server restarted successfully, and client configuration can begin. If the server did not restart, consult <span class=filename>/var/log/messages</span> for the error.</p></div></div><div class=sect4><h5 id=_log_client_configuration>11.7.3.2. Log Client Configuration<a class=anchor href=#_log_client_configuration></a></h5><div class=paragraph><p>A logging client sends log entries to a logging server on the network. The client also keeps a local copy of its own logs.</p></div><div class=paragraph><p>Once a logging server has been configured, edit <span class=filename>/etc/rc.conf</span> on the logging client:</p></div><div class="literalblock programlisting"><div class=content><pre>syslogd_enable=&#34;YES&#34;
syslogd_flags=&#34;-s -v -v&#34;</pre></div></div><div class=paragraph><p>The first entry enables syslogd on boot up. The second entry prevents logs from being accepted by this client from other hosts (<code>-s</code>) and increases the verbosity of logged messages.</p></div><div class=paragraph><p>Next, define the logging server in the client’s <span class=filename>/etc/syslog.conf</span>. In this example, all logged facilities are sent to a remote system, denoted by the <code>@</code> symbol, with the specified hostname:</p></div><div class="literalblock programlisting"><div class=content><pre>*.*		@logserv.example.com</pre></div></div><div class=paragraph><p>After saving the edit, restart syslogd for the changes to take effect:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service syslogd restart</span></code></pre></div></div><div class=paragraph><p>To test that log messages are being sent across the network, use <a href="https://man.freebsd.org/cgi/man.cgi?query=logger&amp;sektion=1&amp;format=html">logger(1)</a> on the client to send a message to syslogd:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># logger &#34;Test message from logclient&#34;</span></code></pre></div></div><div class=paragraph><p>This message should now exist both in <span class=filename>/var/log/messages</span> on the client and <span class=filename>/var/log/logclient.log</span> on the log server.</p></div></div><div class=sect4><h5 id=_debugging_log_servers>11.7.3.3. Debugging Log Servers<a class=anchor href=#_debugging_log_servers></a></h5><div class=paragraph><p>If no messages are being received on the log server, the cause is most likely a network connectivity issue, a hostname resolution issue, or a typo in a configuration file. To isolate the cause, ensure that both the logging server and the logging client are able to <code>ping</code> each other using the hostname specified in their <span class=filename>/etc/rc.conf</span>. If this fails, check the network cabling, the firewall ruleset, and the hostname entries in the DNS server or <span class=filename>/etc/hosts</span> on both the logging server and clients. Repeat until the <code>ping</code> is successful from both hosts.</p></div><div class=paragraph><p>If the <code>ping</code> succeeds on both hosts but log messages are still not being received, temporarily increase logging verbosity to narrow down the configuration issue. In the following example, <span class=filename>/var/log/logclient.log</span> on the logging server is empty and <span class=filename>/var/log/messages</span> on the logging client does not indicate a reason for the failure. To increase debugging output, edit the <code>syslogd_flags</code> entry on the logging server and issue a restart:</p></div><div class="literalblock programlisting"><div class=content><pre>syslogd_flags=&#34;-d -a logclient.example.com -v -v&#34;</pre></div></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service syslogd restart</span></code></pre></div></div><div class=paragraph><p>Debugging data similar to the following will flash on the console immediately after the restart:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>logmsg: pri 56, flags 4, from logserv.example.com, msg syslogd: restart
syslogd: restarted
logmsg: pri 6, flags 4, from logserv.example.com, msg syslogd: kernel boot file is /boot/kernel/kernel
Logging to FILE /var/log/messages
syslogd: kernel boot file is /boot/kernel/kernel
cvthname<span class=o>(</span>192.168.1.10<span class=o>)</span>
validate: dgram from IP 192.168.1.10, port 514, name logclient.example.com<span class=p>;</span>
rejected <span class=k>in </span>rule 0 due to name mismatch.</code></pre></div></div><div class=paragraph><p>In this example, the log messages are being rejected due to a typo which results in a hostname mismatch. The client’s hostname should be <code>logclient</code>, not <code>logclien</code>. Fix the typo, issue a restart, and verify the results:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service syslogd restart</span>
logmsg: pri 56, flags 4, from logserv.example.com, msg syslogd: restart
syslogd: restarted
logmsg: pri 6, flags 4, from logserv.example.com, msg syslogd: kernel boot file is /boot/kernel/kernel
syslogd: kernel boot file is /boot/kernel/kernel
logmsg: pri 166, flags 17, from logserv.example.com,
msg Dec 10 20:55:02 &lt;syslog.err&gt; logserv.example.com syslogd: exiting on signal 2
cvthname<span class=o>(</span>192.168.1.10<span class=o>)</span>
validate: dgram from IP 192.168.1.10, port 514, name logclient.example.com<span class=p>;</span>
accepted <span class=k>in </span>rule 0.
logmsg: pri 15, flags 0, from logclient.example.com, msg Dec 11 02:01:28 trhodes: Test message 2
Logging to FILE /var/log/logclient.log
Logging to FILE /var/log/messages</code></pre></div></div><div class=paragraph><p>At this point, the messages are being properly received and placed in the correct file.</p></div></div><div class=sect4><h5 id=_security_considerations>11.7.3.4. Security Considerations<a class=anchor href=#_security_considerations></a></h5><div class=paragraph><p>As with any network service, security requirements should be considered before implementing a logging server. Log files may contain sensitive data about services enabled on the local host, user accounts, and configuration data. Network data sent from the client to the server will not be encrypted or password protected. If a need for encryption exists, consider using <a class=package href=https://cgit.freebsd.org/ports/tree/security/stunnel/>security/stunnel</a>, which will transmit the logging data over an encrypted tunnel.</p></div><div class=paragraph><p>Local security is also an issue. Log files are not encrypted during use or after log rotation. Local users may access log files to gain additional insight into system configuration. Setting proper permissions on log files is critical. The built-in log rotator, newsyslog, supports setting permissions on newly created and rotated log files. Setting log files to mode <code>600</code> should prevent unwanted access by local users. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=newsyslog.conf&amp;sektion=5&amp;format=html">newsyslog.conf(5)</a> for additional information.</p></div></div></div></div><div class=sect2><h3 id=configtuning-configfiles>11.8. Configuration Files<a class=anchor href=#configtuning-configfiles></a></h3><div class=sect3><h4 id=_etc_layout>11.8.1. <span class=filename>/etc</span> Layout<a class=anchor href=#_etc_layout></a></h4><div class=paragraph><p>There are a number of directories in which configuration information is kept. These include:</p></div><table class="tableblock frame-none grid-all stretch informaltable"><col style=width:50%><col style=width:50%><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/etc</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Generic system-specific configuration information.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/etc/defaults</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Default versions of system configuration files.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/etc/mail</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Extra <a href="https://man.freebsd.org/cgi/man.cgi?query=sendmail&amp;sektion=8&amp;format=html">sendmail(8)</a> configuration and other MTA configuration files.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/etc/ppp</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Configuration for both user- and kernel-ppp programs.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/usr/local/etc</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Configuration files for installed applications. May contain per-application subdirectories.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/usr/local/etc/rc.d</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><a href="https://man.freebsd.org/cgi/man.cgi?query=rc&amp;sektion=8&amp;format=html">rc(8)</a> scripts for installed applications.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/var/db</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Automatically generated system-specific database files, such as the package database and the <a href="https://man.freebsd.org/cgi/man.cgi?query=locate&amp;sektion=1&amp;format=html">locate(1)</a> database.</p></td></tr></tbody></table></div><div class=sect3><h4 id=_hostnames>11.8.2. Hostnames<a class=anchor href=#_hostnames></a></h4><div class=sect4><h5 id=_etcresolv_conf>11.8.2.1. <span class=filename>/etc/resolv.conf</span><a class=anchor href=#_etcresolv_conf></a></h5><div class=paragraph><p>How a FreeBSD system accesses the Internet Domain Name System (DNS) is controlled by <a href="https://man.freebsd.org/cgi/man.cgi?query=resolv.conf&amp;sektion=5&amp;format=html">resolv.conf(5)</a>.</p></div><div class=paragraph><p>The most common entries to <span class=filename>/etc/resolv.conf</span> are:</p></div><table class="tableblock frame-none grid-all stretch informaltable"><col style=width:50%><col style=width:50%><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>nameserver</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>The IP address of a name server the resolver should query. The servers are queried in the order listed with a maximum of three.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>search</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Search list for hostname lookup. This is normally determined by the domain of the local hostname.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>domain</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>The local domain name.</p></td></tr></tbody></table><div class=paragraph><p>A typical <span class=filename>/etc/resolv.conf</span> looks like this:</p></div><div class="literalblock programlisting"><div class=content><pre>search example.com
nameserver 147.11.1.11
nameserver 147.11.100.30</pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Only one of the <code>search</code> and <code>domain</code> options should be used.</p></div></td></tr></tbody></table></div><div class=paragraph><p>When using DHCP, <a href="https://man.freebsd.org/cgi/man.cgi?query=dhclient&amp;sektion=8&amp;format=html">dhclient(8)</a> usually rewrites <span class=filename>/etc/resolv.conf</span> with information received from the DHCP server.</p></div></div><div class=sect4><h5 id=_etchosts>11.8.2.2. <span class=filename>/etc/hosts</span><a class=anchor href=#_etchosts></a></h5><div class=paragraph><p><span class=filename>/etc/hosts</span> is a simple text database which works in conjunction with DNS and NIS to provide host name to IP address mappings. Entries for local computers connected via a LAN can be added to this file for simplistic naming purposes instead of setting up a <a href="https://man.freebsd.org/cgi/man.cgi?query=named&amp;sektion=8&amp;format=html">named(8)</a> server. Additionally, <span class=filename>/etc/hosts</span> can be used to provide a local record of Internet names, reducing the need to query external DNS servers for commonly accessed names.</p></div><div class="literalblock programlisting"><div class=content><pre># $FreeBSD$
#
#
# Host Database
#
# This file should contain the addresses and aliases for local hosts that
# share this file.  Replace &#39;my.domain&#39; below with the domainname of your
# machine.
#
# In the presence of the domain name service or NIS, this file may
# not be consulted at all; see /etc/nsswitch.conf for the resolution order.
#
#
::1			localhost localhost.my.domain
127.0.0.1		localhost localhost.my.domain
#
# Imaginary network.
#10.0.0.2		myname.my.domain myname
#10.0.0.3		myfriend.my.domain myfriend
#
# According to RFC 1918, you can use the following IP networks for
# private nets which will never be connected to the Internet:
#
#	10.0.0.0	-   10.255.255.255
#	172.16.0.0	-   172.31.255.255
#	192.168.0.0	-   192.168.255.255
#
# In case you want to be able to connect to the Internet, you need
# real official assigned numbers.  Do not try to invent your own network
# numbers but instead get one from your network provider (if any) or
# from your regional registry (ARIN, APNIC, LACNIC, RIPE NCC, or AfriNIC.)
#</pre></div></div><div class=paragraph><p>The format of <span class=filename>/etc/hosts</span> is as follows:</p></div><div class="literalblock programlisting"><div class=content><pre>[Internet address] [official hostname] [alias1] [alias2] ...</pre></div></div><div class=paragraph><p>For example:</p></div><div class="literalblock programlisting"><div class=content><pre>10.0.0.1 myRealHostname.example.com myRealHostname foobar1 foobar2</pre></div></div><div class=paragraph><p>Consult <a href="https://man.freebsd.org/cgi/man.cgi?query=hosts&amp;sektion=5&amp;format=html">hosts(5)</a> for more information.</p></div></div></div></div><div class=sect2><h3 id=configtuning-sysctl>11.9. Tuning with <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a><a class=anchor href=#configtuning-sysctl></a></h3><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a> is used to make changes to a running FreeBSD system. This includes many advanced options of the TCP/IP stack and virtual memory system that can dramatically improve performance for an experienced system administrator. Over five hundred system variables can be read and set using <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a>.</p></div><div class=paragraph><p>At its core, <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a> serves two functions: to read and to modify system settings.</p></div><div class=paragraph><p>To view all readable variables:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% sysctl <span class=nt>-a</span></code></pre></div></div><div class=paragraph><p>To read a particular variable, specify its name:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% sysctl kern.maxproc
kern.maxproc: 1044</code></pre></div></div><div class=paragraph><p>To set a particular variable, use the <em>variable</em>=<em>value</em> syntax:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sysctl kern.maxfiles=5000</span>
kern.maxfiles: 2088 -&gt; 5000</code></pre></div></div><div class=paragraph><p>Settings of sysctl variables are usually either strings, numbers, or booleans, where a boolean is <code>1</code> for yes or <code>0</code> for no.</p></div><div class=paragraph><p>To automatically set some variables each time the machine boots, add them to <span class=filename>/etc/sysctl.conf</span>. For more information, refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl.conf&amp;sektion=5&amp;format=html">sysctl.conf(5)</a> and <a href=#configtuning-sysctlconf><span class=filename>sysctl.conf</span></a>.</p></div><div class=sect3><h4 id=configtuning-sysctlconf>11.9.1. <span class=filename>sysctl.conf</span><a class=anchor href=#configtuning-sysctlconf></a></h4><div class=paragraph><p>The configuration file for <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a>, <span class=filename>/etc/sysctl.conf</span>, looks much like <span class=filename>/etc/rc.conf</span>. Values are set in a <code>variable=value</code> form. The specified values are set after the system goes into multi-user mode. Not all variables are settable in this mode.</p></div><div class=paragraph><p>For example, to turn off logging of fatal signal exits and prevent users from seeing processes started by other users, the following tunables can be set in <span class=filename>/etc/sysctl.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre># Do not log fatal signal exits (e.g., sig 11)
kern.logsigexit=0

# Prevent users from seeing information about processes that
# are being run under another UID.
security.bsd.see_other_uids=0</pre></div></div></div><div class=sect3><h4 id=sysctl-readonly>11.9.2. <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a> Read-only<a class=anchor href=#sysctl-readonly></a></h4><div class=paragraph><p>In some cases it may be desirable to modify read-only <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a> values, which will require a reboot of the system.</p></div><div class=paragraph><p>For instance, on some laptop models the <a href="https://man.freebsd.org/cgi/man.cgi?query=cardbus&amp;sektion=4&amp;format=html">cardbus(4)</a> device will not probe memory ranges and will fail with errors similar to:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>cbb0: Could not map register memory
device_probe_and_attach: cbb0 attach returned 12</code></pre></div></div><div class=paragraph><p>The fix requires the modification of a read-only <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a> setting. Add <code>hw.pci.allow_unsupported_io_range=1</code> to <span class=filename>/boot/loader.conf</span> and reboot. Now <a href="https://man.freebsd.org/cgi/man.cgi?query=cardbus&amp;sektion=4&amp;format=html">cardbus(4)</a> should work properly.</p></div></div></div><div class=sect2><h3 id=configtuning-disk>11.10. Tuning Disks<a class=anchor href=#configtuning-disk></a></h3><div class=paragraph><p>The following section will discuss various tuning mechanisms and options which may be applied to disk devices. In many cases, disks with mechanical parts, such as SCSI drives, will be the bottleneck driving down the overall system performance. While a solution is to install a drive without mechanical parts, such as a solid state drive, mechanical drives are not going away anytime in the near future. When tuning disks, it is advisable to utilize the features of the <a href="https://man.freebsd.org/cgi/man.cgi?query=iostat&amp;sektion=8&amp;format=html">iostat(8)</a> command to test various changes to the system. This command will allow the user to obtain valuable information on system IO.</p></div><div class=sect3><h4 id=_sysctl_variables>11.10.1. Sysctl Variables<a class=anchor href=#_sysctl_variables></a></h4><div class=sect4><h5 id=_vfs_vmiodirenable>11.10.1.1. <code>vfs.vmiodirenable</code><a class=anchor href=#_vfs_vmiodirenable></a></h5><div class=paragraph><p>The <code>vfs.vmiodirenable</code> <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a> variable may be set to either <code>0</code> (off) or <code>1</code> (on). It is set to <code>1</code> by default. This variable controls how directories are cached by the system. Most directories are small, using just a single fragment (typically 1 K) in the file system and typically 512 bytes in the buffer cache. With this variable turned off, the buffer cache will only cache a fixed number of directories, even if the system has a huge amount of memory. When turned on, this <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a> allows the buffer cache to use the VM page cache to cache the directories, making all the memory available for caching directories. However, the minimum in-core memory used to cache a directory is the physical page size (typically 4 K) rather than 512 bytes. Keeping this option enabled is recommended if the system is running any services which manipulate large numbers of files. Such services can include web caches, large mail systems, and news systems. Keeping this option on will generally not reduce performance, even with the wasted memory, but one should experiment to find out.</p></div></div><div class=sect4><h5 id=_vfs_write_behind>11.10.1.2. <code>vfs.write_behind</code><a class=anchor href=#_vfs_write_behind></a></h5><div class=paragraph><p>The <code>vfs.write_behind</code> <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a> variable defaults to <code>1</code> (on). This tells the file system to issue media writes as full clusters are collected, which typically occurs when writing large sequential files. This avoids saturating the buffer cache with dirty buffers when it would not benefit I/O performance. However, this may stall processes and under certain circumstances should be turned off.</p></div></div><div class=sect4><h5 id=_vfs_hirunningspace>11.10.1.3. <code>vfs.hirunningspace</code><a class=anchor href=#_vfs_hirunningspace></a></h5><div class=paragraph><p>The <code>vfs.hirunningspace</code> <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a> variable determines how much outstanding write I/O may be queued to disk controllers system-wide at any given instance. The default is usually sufficient, but on machines with many disks, try bumping it up to four or five <em>megabytes</em>. Setting too high a value which exceeds the buffer cache’s write threshold can lead to bad clustering performance. Do not set this value arbitrarily high as higher write values may add latency to reads occurring at the same time.</p></div><div class=paragraph><p>There are various other buffer cache and VM page cache related <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a> values. Modifying these values is not recommended as the VM system does a good job of automatically tuning itself.</p></div></div><div class=sect4><h5 id=_vm_swap_idle_enabled>11.10.1.4. <code>vm.swap_idle_enabled</code><a class=anchor href=#_vm_swap_idle_enabled></a></h5><div class=paragraph><p>The <code>vm.swap_idle_enabled</code> <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a> variable is useful in large multi-user systems with many active login users and lots of idle processes. Such systems tend to generate continuous pressure on free memory reserves. Turning this feature on and tweaking the swapout hysteresis (in idle seconds) via <code>vm.swap_idle_threshold1</code> and <code>vm.swap_idle_threshold2</code> depresses the priority of memory pages associated with idle processes more quickly then the normal pageout algorithm. This gives a helping hand to the pageout daemon. Only turn this option on if needed, because the tradeoff is essentially pre-page memory sooner rather than later which eats more swap and disk bandwidth. In a small system this option will have a determinable effect, but in a large system that is already doing moderate paging, this option allows the VM system to stage whole processes into and out of memory easily.</p></div></div><div class=sect4><h5 id=_hw_ata_wc>11.10.1.5. <code>hw.ata.wc</code><a class=anchor href=#_hw_ata_wc></a></h5><div class=paragraph><p>Turning off IDE write caching reduces write bandwidth to IDE disks, but may sometimes be necessary due to data consistency issues introduced by hard drive vendors. The problem is that some IDE drives lie about when a write completes. With IDE write caching turned on, IDE hard drives write data to disk out of order and will sometimes delay writing some blocks indefinitely when under heavy disk load. A crash or power failure may cause serious file system corruption. Check the default on the system by observing the <code>hw.ata.wc</code> <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a> variable. If IDE write caching is turned off, one can set this read-only variable to <code>1</code> in <span class=filename>/boot/loader.conf</span> in order to enable it at boot time.</p></div><div class=paragraph><p>For more information, refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=ata&amp;sektion=4&amp;format=html">ata(4)</a>.</p></div></div><div class=sect4><h5 id=_scsi_delay_kern_cam_scsi_delay>11.10.1.6. <code>SCSI_DELAY</code> (<code>kern.cam.scsi_delay</code>)<a class=anchor href=#_scsi_delay_kern_cam_scsi_delay></a></h5><div class=paragraph><p>The <code>SCSI_DELAY</code> kernel configuration option may be used to reduce system boot times. The defaults are fairly high and can be responsible for <code>15</code> seconds of delay in the boot process. Reducing it to <code>5</code> seconds usually works with modern drives. The <code>kern.cam.scsi_delay</code> boot time tunable should be used. The tunable and kernel configuration option accept values in terms of <em>milliseconds</em> and <em>not seconds</em>.</p></div></div></div><div class=sect3><h4 id=soft-updates>11.10.2. Soft Updates<a class=anchor href=#soft-updates></a></h4><div class=paragraph><p>To fine-tune a file system, use <a href="https://man.freebsd.org/cgi/man.cgi?query=tunefs&amp;sektion=8&amp;format=html">tunefs(8)</a>. This program has many different options. To toggle Soft Updates on and off, use:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># tunefs -n enable /filesystem</span>
<span class=c># tunefs -n disable /filesystem</span></code></pre></div></div><div class=paragraph><p>A file system cannot be modified with <a href="https://man.freebsd.org/cgi/man.cgi?query=tunefs&amp;sektion=8&amp;format=html">tunefs(8)</a> while it is mounted. A good time to enable Soft Updates is before any partitions have been mounted, in single-user mode.</p></div><div class=paragraph><p>Soft Updates is recommended for UFS file systems as it drastically improves meta-data performance, mainly file creation and deletion, through the use of a memory cache. There are two downsides to Soft Updates to be aware of. First, Soft Updates guarantee file system consistency in the case of a crash, but could easily be several seconds or even a minute behind updating the physical disk. If the system crashes, unwritten data may be lost. Secondly, Soft Updates delay the freeing of file system blocks. If the root file system is almost full, performing a major update, such as <code>make installworld</code>, can cause the file system to run out of space and the update to fail.</p></div><div class=sect4><h5 id=_more_details_about_soft_updates>11.10.2.1. More Details About Soft Updates<a class=anchor href=#_more_details_about_soft_updates></a></h5><div class=paragraph><p>Meta-data updates are updates to non-content data like inodes or directories. There are two traditional approaches to writing a file system’s meta-data back to disk.</p></div><div class=paragraph><p>Historically, the default behavior was to write out meta-data updates synchronously. If a directory changed, the system waited until the change was actually written to disk. The file data buffers (file contents) were passed through the buffer cache and backed up to disk later on asynchronously. The advantage of this implementation is that it operates safely. If there is a failure during an update, meta-data is always in a consistent state. A file is either created completely or not at all. If the data blocks of a file did not find their way out of the buffer cache onto the disk by the time of the crash, <a href="https://man.freebsd.org/cgi/man.cgi?query=fsck&amp;sektion=8&amp;format=html">fsck(8)</a> recognizes this and repairs the file system by setting the file length to <code>0</code>. Additionally, the implementation is clear and simple. The disadvantage is that meta-data changes are slow. For example, <code>rm -r</code> touches all the files in a directory sequentially, but each directory change will be written synchronously to the disk. This includes updates to the directory itself, to the inode table, and possibly to indirect blocks allocated by the file. Similar considerations apply for unrolling large hierarchies using <code>tar -x</code>.</p></div><div class=paragraph><p>The second approach is to use asynchronous meta-data updates. This is the default for a UFS file system mounted with <code>mount -o async</code>. Since all meta-data updates are also passed through the buffer cache, they will be intermixed with the updates of the file content data. The advantage of this implementation is there is no need to wait until each meta-data update has been written to disk, so all operations which cause huge amounts of meta-data updates work much faster than in the synchronous case. This implementation is still clear and simple, so there is a low risk for bugs creeping into the code. The disadvantage is that there is no guarantee for a consistent state of the file system. If there is a failure during an operation that updated large amounts of meta-data, like a power failure or someone pressing the reset button, the file system will be left in an unpredictable state. There is no opportunity to examine the state of the file system when the system comes up again as the data blocks of a file could already have been written to the disk while the updates of the inode table or the associated directory were not. It is impossible to implement a <a href="https://man.freebsd.org/cgi/man.cgi?query=fsck&amp;sektion=8&amp;format=html">fsck(8)</a> which is able to clean up the resulting chaos because the necessary information is not available on the disk. If the file system has been damaged beyond repair, the only choice is to reformat it and restore from backup.</p></div><div class=paragraph><p>The usual solution for this problem is to implement <em>dirty region logging</em>, which is also referred to as <em>journaling</em>. Meta-data updates are still written synchronously, but only into a small region of the disk. Later on, they are moved to their proper location. Because the logging area is a small, contiguous region on the disk, there are no long distances for the disk heads to move, even during heavy operations, so these operations are quicker than synchronous updates. Additionally, the complexity of the implementation is limited, so the risk of bugs being present is low. A disadvantage is that all meta-data is written twice, once into the logging region and once to the proper location, so performance "pessimization" might result. On the other hand, in case of a crash, all pending meta-data operations can be either quickly rolled back or completed from the logging area after the system comes up again, resulting in a fast file system startup.</p></div><div class=paragraph><p>Kirk McKusick, the developer of Berkeley FFS, solved this problem with Soft Updates. All pending meta-data updates are kept in memory and written out to disk in a sorted sequence ("ordered meta-data updates"). This has the effect that, in case of heavy meta-data operations, later updates to an item "catch" the earlier ones which are still in memory and have not already been written to disk. All operations are generally performed in memory before the update is written to disk and the data blocks are sorted according to their position so that they will not be on the disk ahead of their meta-data. If the system crashes, an implicit "log rewind" causes all operations which were not written to the disk appear as if they never happened. A consistent file system state is maintained that appears to be the one of 30 to 60 seconds earlier. The algorithm used guarantees that all resources in use are marked as such in their blocks and inodes. After a crash, the only resource allocation error that occurs is that resources are marked as "used" which are actually "free". <a href="https://man.freebsd.org/cgi/man.cgi?query=fsck&amp;sektion=8&amp;format=html">fsck(8)</a> recognizes this situation, and frees the resources that are no longer used. It is safe to ignore the dirty state of the file system after a crash by forcibly mounting it with <code>mount -f</code>. In order to free resources that may be unused, <a href="https://man.freebsd.org/cgi/man.cgi?query=fsck&amp;sektion=8&amp;format=html">fsck(8)</a> needs to be run at a later time. This is the idea behind the <em>background <a href="https://man.freebsd.org/cgi/man.cgi?query=fsck&amp;sektion=8&amp;format=html">fsck(8)</a></em>: at system startup time, only a <em>snapshot</em> of the file system is recorded and <a href="https://man.freebsd.org/cgi/man.cgi?query=fsck&amp;sektion=8&amp;format=html">fsck(8)</a> is run afterwards. All file systems can then be mounted "dirty", so the system startup proceeds in multi-user mode. Then, background <a href="https://man.freebsd.org/cgi/man.cgi?query=fsck&amp;sektion=8&amp;format=html">fsck(8)</a> is scheduled for all file systems where this is required, to free resources that may be unused. File systems that do not use Soft Updates still need the usual foreground <a href="https://man.freebsd.org/cgi/man.cgi?query=fsck&amp;sektion=8&amp;format=html">fsck(8)</a>.</p></div><div class=paragraph><p>The advantage is that meta-data operations are nearly as fast as asynchronous updates and are faster than <em>logging</em>, which has to write the meta-data twice. The disadvantages are the complexity of the code, a higher memory consumption, and some idiosyncrasies. After a crash, the state of the file system appears to be somewhat "older". In situations where the standard synchronous approach would have caused some zero-length files to remain after the <a href="https://man.freebsd.org/cgi/man.cgi?query=fsck&amp;sektion=8&amp;format=html">fsck(8)</a>, these files do not exist at all with Soft Updates because neither the meta-data nor the file contents have been written to disk. Disk space is not released until the updates have been written to disk, which may take place some time after running <a href="https://man.freebsd.org/cgi/man.cgi?query=rm&amp;sektion=1&amp;format=html">rm(1)</a>. This may cause problems when installing large amounts of data on a file system that does not have enough free space to hold all the files twice.</p></div></div></div></div><div class=sect2><h3 id=configtuning-kernel-limits>11.11. Tuning Kernel Limits<a class=anchor href=#configtuning-kernel-limits></a></h3><div class=sect3><h4 id=file-process-limits>11.11.1. File/Process Limits<a class=anchor href=#file-process-limits></a></h4><div class=sect4><h5 id=kern-maxfiles>11.11.1.1. <code>kern.maxfiles</code><a class=anchor href=#kern-maxfiles></a></h5><div class=paragraph><p>The <code>kern.maxfiles</code> <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a> variable can be raised or lowered based upon system requirements. This variable indicates the maximum number of file descriptors on the system. When the file descriptor table is full, <code>file: table is full</code> will show up repeatedly in the system message buffer, which can be viewed using <a href="https://man.freebsd.org/cgi/man.cgi?query=dmesg&amp;sektion=8&amp;format=html">dmesg(8)</a>.</p></div><div class=paragraph><p>Each open file, socket, or fifo uses one file descriptor. A large-scale production server may easily require many thousands of file descriptors, depending on the kind and number of services running concurrently.</p></div><div class=paragraph><p>In older FreeBSD releases, the default value of <code>kern.maxfiles</code> is derived from <code>maxusers</code> in the kernel configuration file. <code>kern.maxfiles</code> grows proportionally to the value of <code>maxusers</code>. When compiling a custom kernel, consider setting this kernel configuration option according to the use of the system. From this number, the kernel is given most of its pre-defined limits. Even though a production machine may not have 256 concurrent users, the resources needed may be similar to a high-scale web server.</p></div><div class=paragraph><p>The read-only <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a> variable <code>kern.maxusers</code> is automatically sized at boot based on the amount of memory available in the system, and may be determined at run-time by inspecting the value of <code>kern.maxusers</code>. Some systems require larger or smaller values of <code>kern.maxusers</code> and values of <code>64</code>, <code>128</code>, and <code>256</code> are not uncommon. Going above <code>256</code> is not recommended unless a huge number of file descriptors is needed. Many of the tunable values set to their defaults by <code>kern.maxusers</code> may be individually overridden at boot-time or run-time in <span class=filename>/boot/loader.conf</span>. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=loader.conf&amp;sektion=5&amp;format=html">loader.conf(5)</a> and <span class=filename>/boot/defaults/loader.conf</span> for more details and some hints.</p></div><div class=paragraph><p>In older releases, the system will auto-tune <code>maxusers</code> if it is set to <code>0</code>. <sup class=footnote>[<a id=_footnoteref_1 class=footnote href=#_footnotedef_1 title="View footnote.">1</a>]</sup>. When setting this option, set <code>maxusers</code> to at least <code>4</code>, especially if the system runs Xorg or is used to compile software. The most important table set by <code>maxusers</code> is the maximum number of processes, which is set to <code>20 + 16 * maxusers</code>. If <code>maxusers</code> is set to <code>1</code>, there can only be <code>36</code> simultaneous processes, including the <code>18</code> or so that the system starts up at boot time and the <code>15</code> or so used by Xorg. Even a simple task like reading a manual page will start up nine processes to filter, decompress, and view it. Setting <code>maxusers</code> to <code>64</code> allows up to <code>1044</code> simultaneous processes, which should be enough for nearly all uses. If, however, the error is displayed when trying to start another program, or a server is running with a large number of simultaneous users, increase the number and rebuild.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p><code>maxusers</code> does <em>not</em> limit the number of users which can log into the machine. It instead sets various table sizes to reasonable values considering the maximum number of users on the system and how many processes each user will be running.</p></div></td></tr></tbody></table></div></div><div class=sect4><h5 id=_kern_ipc_soacceptqueue>11.11.1.2. <code>kern.ipc.soacceptqueue</code><a class=anchor href=#_kern_ipc_soacceptqueue></a></h5><div class=paragraph><p>The <code>kern.ipc.soacceptqueue</code> <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a> variable limits the size of the listen queue for accepting new <code>TCP</code> connections. The default value of <code>128</code> is typically too low for robust handling of new connections on a heavily loaded web server. For such environments, it is recommended to increase this value to <code>1024</code> or higher. A service such as <a href="https://man.freebsd.org/cgi/man.cgi?query=sendmail&amp;sektion=8&amp;format=html">sendmail(8)</a>, or Apache may itself limit the listen queue size, but will often have a directive in its configuration file to adjust the queue size. Large listen queues do a better job of avoiding Denial of Service (DoS) attacks.</p></div></div></div><div class=sect3><h4 id=nmbclusters>11.11.2. Network Limits<a class=anchor href=#nmbclusters></a></h4><div class=paragraph><p>The <code>NMBCLUSTERS</code> kernel configuration option dictates the amount of network Mbufs available to the system. A heavily-trafficked server with a low number of Mbufs will hinder performance. Each cluster represents approximately 2 K of memory, so a value of <code>1024</code> represents <code>2</code> megabytes of kernel memory reserved for network buffers. A simple calculation can be done to figure out how many are needed. A web server which maxes out at <code>1000</code> simultaneous connections where each connection uses a 6 K receive and 16 K send buffer, requires approximately 32 MB worth of network buffers to cover the web server. A good rule of thumb is to multiply by <code>2</code>, so 2x32 MB / 2 KB = 64 MB / 2 kB = <code>32768</code>. Values between <code>4096</code> and <code>32768</code> are recommended for machines with greater amounts of memory. Never specify an arbitrarily high value for this parameter as it could lead to a boot time crash. To observe network cluster usage, use <code>-m</code> with <a href="https://man.freebsd.org/cgi/man.cgi?query=netstat&amp;sektion=1&amp;format=html">netstat(1)</a>.</p></div><div class=paragraph><p>The <code>kern.ipc.nmbclusters</code> loader tunable should be used to tune this at boot time. Only older versions of FreeBSD will require the use of the <code>NMBCLUSTERS</code> kernel <a href="https://man.freebsd.org/cgi/man.cgi?query=config&amp;sektion=8&amp;format=html">config(8)</a> option.</p></div><div class=paragraph><p>For busy servers that make extensive use of the <a href="https://man.freebsd.org/cgi/man.cgi?query=sendfile&amp;sektion=2&amp;format=html">sendfile(2)</a> system call, it may be necessary to increase the number of <a href="https://man.freebsd.org/cgi/man.cgi?query=sendfile&amp;sektion=2&amp;format=html">sendfile(2)</a> buffers via the <code>NSFBUFS</code> kernel configuration option or by setting its value in <span class=filename>/boot/loader.conf</span> (see <a href="https://man.freebsd.org/cgi/man.cgi?query=loader&amp;sektion=8&amp;format=html">loader(8)</a> for details). A common indicator that this parameter needs to be adjusted is when processes are seen in the <code>sfbufa</code> state. The <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a> variable <code>kern.ipc.nsfbufs</code> is read-only. This parameter nominally scales with <code>kern.maxusers</code>, however it may be necessary to tune accordingly.</p></div><div class="admonitionblock important"><table><tbody><tr><td class=icon><i class="fa icon-important" title=Important></i></td><td class=content><div class=paragraph><p>Even though a socket has been marked as non-blocking, calling <a href="https://man.freebsd.org/cgi/man.cgi?query=sendfile&amp;sektion=2&amp;format=html">sendfile(2)</a> on the non-blocking socket may result in the <a href="https://man.freebsd.org/cgi/man.cgi?query=sendfile&amp;sektion=2&amp;format=html">sendfile(2)</a> call blocking until enough <code>struct sf_buf</code>'s are made available.</p></div></td></tr></tbody></table></div><div class=sect4><h5 id=_net_inet_ip_portrange>11.11.2.1. <code>net.inet.ip.portrange.*</code><a class=anchor href=#_net_inet_ip_portrange></a></h5><div class=paragraph><p>The <code>net.inet.ip.portrange.*</code> <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a> variables control the port number ranges automatically bound to <code>TCP</code> and <code>UDP</code> sockets. There are three ranges: a low range, a default range, and a high range. Most network programs use the default range which is controlled by <code>net.inet.ip.portrange.first</code> and <code>net.inet.ip.portrange.last</code>, which default to <code>1024</code> and <code>5000</code>, respectively. Bound port ranges are used for outgoing connections and it is possible to run the system out of ports under certain circumstances. This most commonly occurs when running a heavily loaded web proxy. The port range is not an issue when running a server which handles mainly incoming connections, such as a web server, or has a limited number of outgoing connections, such as a mail relay. For situations where there is a shortage of ports, it is recommended to increase <code>net.inet.ip.portrange.last</code> modestly. A value of <code>10000</code>, <code>20000</code> or <code>30000</code> may be reasonable. Consider firewall effects when changing the port range. Some firewalls may block large ranges of ports, usually low-numbered ports, and expect systems to use higher ranges of ports for outgoing connections. For this reason, it is not recommended that the value of <code>net.inet.ip.portrange.first</code> be lowered.</p></div></div><div class=sect4><h5 id=_tcp_bandwidth_delay_product>11.11.2.2. <code>TCP</code> Bandwidth Delay Product<a class=anchor href=#_tcp_bandwidth_delay_product></a></h5><div class=paragraph><p><code>TCP</code> bandwidth delay product limiting can be enabled by setting the <code>net.inet.tcp.inflight.enable</code> <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a> variable to <code>1</code>. This instructs the system to attempt to calculate the bandwidth delay product for each connection and limit the amount of data queued to the network to just the amount required to maintain optimum throughput.</p></div><div class=paragraph><p>This feature is useful when serving data over modems, Gigabit Ethernet, high speed <code>WAN</code> links, or any other link with a high bandwidth delay product, especially when also using window scaling or when a large send window has been configured. When enabling this option, also set <code>net.inet.tcp.inflight.debug</code> to <code>0</code> to disable debugging. For production use, setting <code>net.inet.tcp.inflight.min</code> to at least <code>6144</code> may be beneficial. Setting high minimums may effectively disable bandwidth limiting, depending on the link. The limiting feature reduces the amount of data built up in intermediate route and switch packet queues and reduces the amount of data built up in the local host’s interface queue. With fewer queued packets, interactive connections, especially over slow modems, will operate with lower <em>Round Trip Times</em>. This feature only effects server side data transmission such as uploading. It has no effect on data reception or downloading.</p></div><div class=paragraph><p>Adjusting <code>net.inet.tcp.inflight.stab</code> is <em>not</em> recommended. This parameter defaults to <code>20</code>, representing 2 maximal packets added to the bandwidth delay product window calculation. The additional window is required to stabilize the algorithm and improve responsiveness to changing conditions, but it can also result in higher <a href="https://man.freebsd.org/cgi/man.cgi?query=ping&amp;sektion=8&amp;format=html">ping(8)</a> times over slow links, though still much lower than without the inflight algorithm. In such cases, try reducing this parameter to <code>15</code>, <code>10</code>, or <code>5</code> and reducing <code>net.inet.tcp.inflight.min</code> to a value such as <code>3500</code> to get the desired effect. Reducing these parameters should be done as a last resort only.</p></div></div></div><div class=sect3><h4 id=_virtual_memory>11.11.3. Virtual Memory<a class=anchor href=#_virtual_memory></a></h4><div class=sect4><h5 id=_kern_maxvnodes>11.11.3.1. <code>kern.maxvnodes</code><a class=anchor href=#_kern_maxvnodes></a></h5><div class=paragraph><p>A vnode is the internal representation of a file or directory. Increasing the number of vnodes available to the operating system reduces disk I/O. Normally, this is handled by the operating system and does not need to be changed. In some cases where disk I/O is a bottleneck and the system is running out of vnodes, this setting needs to be increased. The amount of inactive and free RAM will need to be taken into account.</p></div><div class=paragraph><p>To see the current number of vnodes in use:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sysctl vfs.numvnodes</span>
vfs.numvnodes: 91349</code></pre></div></div><div class=paragraph><p>To see the maximum vnodes:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sysctl kern.maxvnodes</span>
kern.maxvnodes: 100000</code></pre></div></div><div class=paragraph><p>If the current vnode usage is near the maximum, try increasing <code>kern.maxvnodes</code> by a value of <code>1000</code>. Keep an eye on the number of <code>vfs.numvnodes</code>. If it climbs up to the maximum again, <code>kern.maxvnodes</code> will need to be increased further. Otherwise, a shift in memory usage as reported by <a href="https://man.freebsd.org/cgi/man.cgi?query=top&amp;sektion=1&amp;format=html">top(1)</a> should be visible and more memory should be active.</p></div></div></div></div><div class=sect2><h3 id=adding-swap-space>11.12. Adding Swap Space<a class=anchor href=#adding-swap-space></a></h3><div class=paragraph><p>Sometimes a system requires more swap space. This section describes two methods to increase swap space: adding swap to an existing partition or new hard drive, and creating a swap file on an existing partition.</p></div><div class=paragraph><p>For information on how to encrypt swap space, which options exist, and why it should be done, refer to <a href=./#swap-encrypting>“Encrypting Swap”</a>.</p></div><div class=sect3><h4 id=new-drive-swap>11.12.1. Swap on a New Hard Drive or Existing Partition<a class=anchor href=#new-drive-swap></a></h4><div class=paragraph><p>Adding a new hard drive for swap gives better performance than using a partition on an existing drive. Setting up partitions and hard drives is explained in <a href=./#disks-adding>“Adding Disks”</a> while <a href=./#configtuning-initial>“Designing the Partition Layout”</a> discusses partition layouts and swap partition size considerations.</p></div><div class=paragraph><p>Use <code>swapon</code> to add a swap partition to the system. For example:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># swapon /dev/ada1s1b</span></code></pre></div></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>It is possible to use any partition not currently mounted, even if it already contains data. Using <code>swapon</code> on a partition that contains data will overwrite and destroy that data. Make sure that the partition to be added as swap is really the intended partition before running <code>swapon</code>.</p></div></td></tr></tbody></table></div><div class=paragraph><p>To automatically add this swap partition on boot, add an entry to <span class=filename>/etc/fstab</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>/dev/ada1s1b	none	swap	sw	0	0</pre></div></div><div class=paragraph><p>See <a href="https://man.freebsd.org/cgi/man.cgi?query=fstab&amp;sektion=5&amp;format=html">fstab(5)</a> for an explanation of the entries in <span class=filename>/etc/fstab</span>. More information about <code>swapon</code> can be found in <a href="https://man.freebsd.org/cgi/man.cgi?query=swapon&amp;sektion=8&amp;format=html">swapon(8)</a>.</p></div></div><div class=sect3><h4 id=create-swapfile>11.12.2. Creating a Swap File<a class=anchor href=#create-swapfile></a></h4><div class=paragraph><p>These examples create a 512M swap file called <span class=filename>/usr/swap0</span> instead of using a partition.</p></div><div class=paragraph><p>Using swap files requires that the module needed by <a href="https://man.freebsd.org/cgi/man.cgi?query=md&amp;sektion=4&amp;format=html">md(4)</a> has either been built into the kernel or has been loaded before swap is enabled. See <a href=./#kernelconfig>Configuring the FreeBSD Kernel</a> for information about building a custom kernel.</p></div><div id=swapfile-10-and-later class=exampleblock><div class=title>Przykład 7. Creating a Swap File</div><div class=content><div class="olist arabic procedure"><ol class=arabic><li><p>Create the swap file:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># dd if=/dev/zero of=/usr/swap0 bs=1m count=512</span></code></pre></div></div></li><li><p>Set the proper permissions on the new file:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># chmod 0600 /usr/swap0</span></code></pre></div></div></li><li><p>Inform the system about the swap file by adding a line to <span class=filename>/etc/fstab</span>:</p><div class="literalblock programlisting"><div class=content><pre>md99	none	swap	sw,file=/usr/swap0,late	0	0</pre></div></div><div class=paragraph><p>The <a href="https://man.freebsd.org/cgi/man.cgi?query=md&amp;sektion=4&amp;format=html">md(4)</a> device <span class=filename>md99</span> is used, leaving lower device numbers available for interactive use.</p></div></li><li><p>Swap space will be added on system startup. To add swap space immediately, use <a href="https://man.freebsd.org/cgi/man.cgi?query=swapon&amp;sektion=8&amp;format=html">swapon(8)</a>:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># swapon -aL</span></code></pre></div></div></li></ol></div></div></div></div></div><div class=sect2><h3 id=acpi-overview>11.13. Power and Resource Management<a class=anchor href=#acpi-overview></a></h3><div class=paragraph><p>It is important to utilize hardware resources in an efficient manner. Power and resource management allows the operating system to monitor system limits and to possibly provide an alert if the system temperature increases unexpectedly. An early specification for providing power management was the Advanced Power Management (APM) facility. APM controls the power usage of a system based on its activity. However, it was difficult and inflexible for operating systems to manage the power usage and thermal properties of a system. The hardware was managed by the BIOS and the user had limited configurability and visibility into the power management settings. The APMBIOS is supplied by the vendor and is specific to the hardware platform. An APM driver in the operating system mediates access to the APM Software Interface, which allows management of power levels.</p></div><div class=paragraph><p>There are four major problems in APM. First, power management is done by the vendor-specific BIOS, separate from the operating system. For example, the user can set idle-time values for a hard drive in the APMBIOS so that, when exceeded, the BIOS spins down the hard drive without the consent of the operating system. Second, the APM logic is embedded in the BIOS, and it operates outside the scope of the operating system. This means that users can only fix problems in the APMBIOS by flashing a new one into the ROM, which is a dangerous procedure with the potential to leave the system in an unrecoverable state if it fails. Third, APM is a vendor-specific technology, meaning that there is a lot of duplication of efforts and bugs found in one vendor’s BIOS may not be solved in others. Lastly, the APMBIOS did not have enough room to implement a sophisticated power policy or one that can adapt well to the purpose of the machine.</p></div><div class=paragraph><p>The Plug and Play BIOS (PNPBIOS) was unreliable in many situations. PNPBIOS is 16-bit technology, so the operating system has to use 16-bit emulation in order to interface with PNPBIOS methods. FreeBSD provides an APM driver as APM should still be used for systems manufactured at or before the year 2000. The driver is documented in <a href="https://man.freebsd.org/cgi/man.cgi?query=apm&amp;sektion=4&amp;format=html">apm(4)</a>.</p></div><div class=paragraph><p>The successor to APM is the Advanced Configuration and Power Interface (ACPI). ACPI is a standard written by an alliance of vendors to provide an interface for hardware resources and power management. It is a key element in <em>Operating System-directed configuration and Power Management</em> as it provides more control and flexibility to the operating system.</p></div><div class=paragraph><p>This chapter demonstrates how to configure ACPI on FreeBSD. It then offers some tips on how to debug ACPI and how to submit a problem report containing debugging information so that developers can diagnosis and fix ACPI issues.</p></div><div class=sect3><h4 id=acpi-config>11.13.1. Configuring ACPI<a class=anchor href=#acpi-config></a></h4><div class=paragraph><p>In FreeBSD the <a href="https://man.freebsd.org/cgi/man.cgi?query=acpi&amp;sektion=4&amp;format=html">acpi(4)</a> driver is loaded by default at system boot and should <em>not</em> be compiled into the kernel. This driver cannot be unloaded after boot because the system bus uses it for various hardware interactions. However, if the system is experiencing problems, ACPI can be disabled altogether by rebooting after setting <code>hint.acpi.0.disabled="1"</code> in <span class=filename>/boot/loader.conf</span> or by setting this variable at the loader prompt, as described in <a href=./#boot-loader>“Stage Three”</a>.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>ACPI and APM cannot coexist and should be used separately. The last one to load will terminate if the driver notices the other is running.</p></div></td></tr></tbody></table></div><div class=paragraph><p>ACPI can be used to put the system into a sleep mode with <code>acpiconf</code>, the <code>-s</code> flag, and a number from <code>1</code> to <code>5</code>. Most users only need <code>1</code> (quick suspend to RAM) or <code>3</code> (suspend to RAM). Option <code>5</code> performs a soft-off which is the same as running <code>halt -p</code>.</p></div><div class=paragraph><p>Other options are available using <code>sysctl</code>. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=acpi&amp;sektion=4&amp;format=html">acpi(4)</a> and <a href="https://man.freebsd.org/cgi/man.cgi?query=acpiconf&amp;sektion=8&amp;format=html">acpiconf(8)</a> for more information.</p></div></div><div class=sect3><h4 id=ACPI-comprob>11.13.2. Common Problems<a class=anchor href=#ACPI-comprob></a></h4><div class=paragraph><p>ACPI is present in all modern computers that conform to the ia32 (x86) and amd64 (AMD) architectures. The full standard has many features including CPU performance management, power planes control, thermal zones, various battery systems, embedded controllers, and bus enumeration. Most systems implement less than the full standard. For instance, a desktop system usually only implements bus enumeration while a laptop might have cooling and battery management support as well. Laptops also have suspend and resume, with their own associated complexity.</p></div><div class=paragraph><p>An ACPI-compliant system has various components. The BIOS and chipset vendors provide various fixed tables, such as FADT, in memory that specify things like the APIC map (used for SMP), config registers, and simple configuration values. Additionally, a bytecode table, the Differentiated System Description Table DSDT, specifies a tree-like name space of devices and methods.</p></div><div class=paragraph><p>The ACPI driver must parse the fixed tables, implement an interpreter for the bytecode, and modify device drivers and the kernel to accept information from the ACPI subsystem. For FreeBSD, Intel® has provided an interpreter (ACPI-CA) that is shared with Linux® and NetBSD. The path to the ACPI-CA source code is <span class=filename>src/sys/contrib/dev/acpica</span>. The glue code that allows ACPI-CA to work on FreeBSD is in <span class=filename>src/sys/dev/acpica/Osd</span>. Finally, drivers that implement various ACPI devices are found in <span class=filename>src/sys/dev/acpica</span>.</p></div><div class=paragraph><p>For ACPI to work correctly, all the parts have to work correctly. Here are some common problems, in order of frequency of appearance, and some possible workarounds or fixes. If a fix does not resolve the issue, refer to <a href=#ACPI-submitdebug>Getting and Submitting Debugging Info</a> for instructions on how to submit a bug report.</p></div><div class=sect4><h5 id=_mouse_issues>11.13.2.1. Mouse Issues<a class=anchor href=#_mouse_issues></a></h5><div class=paragraph><p>In some cases, resuming from a suspend operation will cause the mouse to fail. A known work around is to add <code>hint.psm.0.flags="0x3000"</code> to <span class=filename>/boot/loader.conf</span>.</p></div></div><div class=sect4><h5 id=_suspendresume>11.13.2.2. Suspend/Resume<a class=anchor href=#_suspendresume></a></h5><div class=paragraph><p>ACPI has three suspend to RAM (STR) states, <code>S1</code>-<code>S3</code>, and one suspend to disk state (STD), called <code>S4</code>. STD can be implemented in two separate ways. The <code>S4</code>BIOS is a BIOS-assisted suspend to disk and <code>S4</code>OS is implemented entirely by the operating system. The normal state the system is in when plugged in but not powered up is "soft off" (<code>S5</code>).</p></div><div class=paragraph><p>Use <code>sysctl hw.acpi</code> to check for the suspend-related items. These example results are from a Thinkpad:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>hw.acpi.supported_sleep_state: S3 S4 S5
hw.acpi.s4bios: 0</code></pre></div></div><div class=paragraph><p>Use <code>acpiconf -s</code> to test <code>S3</code>, <code>S4</code>, and <code>S5</code>. An <code>s4bios</code> of one (<code>1</code>) indicates <code>S4</code>BIOS support instead of <code>S4</code> operating system support.</p></div><div class=paragraph><p>When testing suspend/resume, start with <code>S1</code>, if supported. This state is most likely to work since it does not require much driver support. No one has implemented <code>S2</code>, which is similar to <code>S1</code>. Next, try <code>S3</code>. This is the deepest STR state and requires a lot of driver support to properly reinitialize the hardware.</p></div><div class=paragraph><p>A common problem with suspend/resume is that many device drivers do not save, restore, or reinitialize their firmware, registers, or device memory properly. As a first attempt at debugging the problem, try:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sysctl debug.bootverbose=1</span>
<span class=c># sysctl debug.acpi.suspend_bounce=1</span>
<span class=c># acpiconf -s 3</span></code></pre></div></div><div class=paragraph><p>This test emulates the suspend/resume cycle of all device drivers without actually going into <code>S3</code> state. In some cases, problems such as losing firmware state, device watchdog time out, and retrying forever, can be captured with this method. Note that the system will not really enter <code>S3</code> state, which means devices may not lose power, and many will work fine even if suspend/resume methods are totally missing, unlike real <code>S3</code> state.</p></div><div class=paragraph><p>Harder cases require additional hardware, such as a serial port and cable for debugging through a serial console, a Firewire port and cable for using <a href="https://man.freebsd.org/cgi/man.cgi?query=dcons&amp;sektion=4&amp;format=html">dcons(4)</a>, and kernel debugging skills.</p></div><div class=paragraph><p>To help isolate the problem, unload as many drivers as possible. If it works, narrow down which driver is the problem by loading drivers until it fails again. Typically, binary drivers like <span class=filename>nvidia.ko</span>, display drivers, and USB will have the most problems while Ethernet interfaces usually work fine. If drivers can be properly loaded and unloaded, automate this by putting the appropriate commands in <span class=filename>/etc/rc.suspend</span> and <span class=filename>/etc/rc.resume</span>. Try setting <code>hw.acpi.reset_video</code> to <code>1</code> if the display is messed up after resume. Try setting longer or shorter values for <code>hw.acpi.sleep_delay</code> to see if that helps.</p></div><div class=paragraph><p>Try loading a recent Linux® distribution to see if suspend/resume works on the same hardware. If it works on Linux®, it is likely a FreeBSD driver problem. Narrowing down which driver causes the problem will assist developers in fixing the problem. Since the ACPI maintainers rarely maintain other drivers, such as sound or ATA, any driver problems should also be posted to the <a href=https://lists.FreeBSD.org/subscription/freebsd-current>FreeBSD-CURRENT mailing list</a> and mailed to the driver maintainer. Advanced users can include debugging <a href="https://man.freebsd.org/cgi/man.cgi?query=printf&amp;sektion=3&amp;format=html">printf(3)</a>s in a problematic driver to track down where in its resume function it hangs.</p></div><div class=paragraph><p>Finally, try disabling ACPI and enabling APM instead. If suspend/resume works with APM, stick with APM, especially on older hardware (pre-2000). It took vendors a while to get ACPI support correct and older hardware is more likely to have BIOS problems with ACPI.</p></div></div><div class=sect4><h5 id=_system_hangs>11.13.2.3. System Hangs<a class=anchor href=#_system_hangs></a></h5><div class=paragraph><p>Most system hangs are a result of lost interrupts or an interrupt storm. Chipsets may have problems based on boot, how the BIOS configures interrupts before correctness of the APIC (MADT) table, and routing of the System Control Interrupt (SCI).</p></div><div class=paragraph><p>Interrupt storms can be distinguished from lost interrupts by checking the output of <code>vmstat -i</code> and looking at the line that has <code>acpi0</code>. If the counter is increasing at more than a couple per second, there is an interrupt storm. If the system appears hung, try breaking to DDB (<span class=keyseq><kbd>CTRL</kbd>+<kbd>ALT</kbd>+<kbd>ESC</kbd></span> on console) and type <code>show interrupts</code>.</p></div><div class=paragraph><p>When dealing with interrupt problems, try disabling APIC support with <code>hint.apic.0.disabled="1"</code> in <span class=filename>/boot/loader.conf</span>.</p></div></div><div class=sect4><h5 id=_panics>11.13.2.4. Panics<a class=anchor href=#_panics></a></h5><div class=paragraph><p>Panics are relatively rare for ACPI and are the top priority to be fixed. The first step is to isolate the steps to reproduce the panic, if possible, and get a backtrace. Follow the advice for enabling <code>options DDB</code> and setting up a serial console in <a href=./#serialconsole-ddb>“Entering the DDB Debugger from the Serial Line”</a> or setting up a dump partition. To get a backtrace in DDB, use <code>tr</code>. When handwriting the backtrace, get at least the last five and the top five lines in the trace.</p></div><div class=paragraph><p>Then, try to isolate the problem by booting with ACPI disabled. If that works, isolate the ACPI subsystem by using various values of <code>debug.acpi.disable</code>. See <a href="https://man.freebsd.org/cgi/man.cgi?query=acpi&amp;sektion=4&amp;format=html">acpi(4)</a> for some examples.</p></div></div><div class=sect4><h5 id=_system_powers_up_after_suspend_or_shutdown>11.13.2.5. System Powers Up After Suspend or Shutdown<a class=anchor href=#_system_powers_up_after_suspend_or_shutdown></a></h5><div class=paragraph><p>First, try setting <code>hw.acpi.disable_on_poweroff="0"</code> in <span class=filename>/boot/loader.conf</span>. This keeps ACPI from disabling various events during the shutdown process. Some systems need this value set to <code>1</code> (the default) for the same reason. This usually fixes the problem of a system powering up spontaneously after a suspend or poweroff.</p></div></div><div class=sect4><h5 id=ACPI-aslanddump>11.13.2.6. BIOS Contains Buggy Bytecode<a class=anchor href=#ACPI-aslanddump></a></h5><div class=paragraph><p>Some BIOS vendors provide incorrect or buggy bytecode. This is usually manifested by kernel console messages like this:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>ACPI-1287: <span class=k>***</span> Error: Method execution failed <span class=o>[</span><span class=se>\\</span>_SB_.PCI0.LPC0.FIGD._STA] <span class=se>\\</span>
<span class=o>(</span>Node 0xc3f6d160<span class=o>)</span>, AE_NOT_FOUND</code></pre></div></div><div class=paragraph><p>Often, these problems may be resolved by updating the BIOS to the latest revision. Most console messages are harmless, but if there are other problems, like the battery status is not working, these messages are a good place to start looking for problems.</p></div></div></div><div class=sect3><h4 id=_overriding_the_default_aml>11.13.3. Overriding the Default AML<a class=anchor href=#_overriding_the_default_aml></a></h4><div class=paragraph><p>The BIOS bytecode, known as ACPI Machine Language (AML), is compiled from a source language called ACPI Source Language (ASL). The AML is found in the table known as the Differentiated System Description Table (DSDT).</p></div><div class=paragraph><p>The goal of FreeBSD is for everyone to have working ACPI without any user intervention. Workarounds are still being developed for common mistakes made by BIOS vendors. The Microsoft® interpreter (<span class=filename>acpi.sys</span> and <span class=filename>acpiec.sys</span>) does not strictly check for adherence to the standard, and thus many BIOS vendors who only test ACPI under Windows® never fix their ASL. FreeBSD developers continue to identify and document which non-standard behavior is allowed by Microsoft®'s interpreter and replicate it so that FreeBSD can work without forcing users to fix the ASL.</p></div><div class=paragraph><p>To help identify buggy behavior and possibly fix it manually, a copy can be made of the system’s ASL. To copy the system’s ASL to a specified file name, use <code>acpidump</code> with <code>-t</code>, to show the contents of the fixed tables, and <code>-d</code>, to disassemble the AML:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># acpidump -td &gt; my.asl</span></code></pre></div></div><div class=paragraph><p>Some AML versions assume the user is running Windows®. To override this, set <code>hw.acpi.osname=<em>"Windows 2009"</em></code> in <span class=filename>/boot/loader.conf</span>, using the most recent Windows® version listed in the ASL.</p></div><div class=paragraph><p>Other workarounds may require <span class=filename>my.asl</span> to be customized. If this file is edited, compile the new ASL using the following command. Warnings can usually be ignored, but errors are bugs that will usually prevent ACPI from working correctly.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># iasl -f my.asl</span></code></pre></div></div><div class=paragraph><p>Including <code>-f</code> forces creation of the AML, even if there are errors during compilation. Some errors, such as missing return statements, are automatically worked around by the FreeBSD interpreter.</p></div><div class=paragraph><p>The default output filename for <code>iasl</code> is <span class=filename>DSDT.aml</span>. Load this file instead of the BIOS’s buggy copy, which is still present in flash memory, by editing <span class=filename>/boot/loader.conf</span> as follows:</p></div><div class="literalblock programlisting"><div class=content><pre>acpi_dsdt_load=&#34;YES&#34;
acpi_dsdt_name=&#34;/boot/DSDT.aml&#34;</pre></div></div><div class=paragraph><p>Be sure to copy <span class=filename>DSDT.aml</span> to <span class=filename>/boot</span>, then reboot the system. If this fixes the problem, send a <a href="https://man.freebsd.org/cgi/man.cgi?query=diff&amp;sektion=1&amp;format=html">diff(1)</a> of the old and new ASL to <a href=https://lists.FreeBSD.org/subscription/freebsd-acpi>FreeBSD ACPI mailing list</a> so that developers can work around the buggy behavior in <span class=filename>acpica</span>.</p></div></div><div class=sect3><h4 id=ACPI-submitdebug>11.13.4. Getting and Submitting Debugging Info<a class=anchor href=#ACPI-submitdebug></a></h4><div class=paragraph><p>The ACPI driver has a flexible debugging facility. A set of subsystems and the level of verbosity can be specified. The subsystems to debug are specified as layers and are broken down into components (<code>ACPI_ALL_COMPONENTS</code>) and ACPI hardware support (<code>ACPI_ALL_DRIVERS</code>). The verbosity of debugging output is specified as the level and ranges from just report errors (<code>ACPI_LV_ERROR</code>) to everything (<code>ACPI_LV_VERBOSE</code>). The level is a bitmask so multiple options can be set at once, separated by spaces. In practice, a serial console should be used to log the output so it is not lost as the console message buffer flushes. A full list of the individual layers and levels is found in <a href="https://man.freebsd.org/cgi/man.cgi?query=acpi&amp;sektion=4&amp;format=html">acpi(4)</a>.</p></div><div class=paragraph><p>Debugging output is not enabled by default. To enable it, add <code>options ACPI_DEBUG</code> to the custom kernel configuration file if ACPI is compiled into the kernel. Add <code>ACPI_DEBUG=1</code> to <span class=filename>/etc/make.conf</span> to enable it globally. If a module is used instead of a custom kernel, recompile just the <span class=filename>acpi.ko</span> module as follows:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /sys/modules/acpi/acpi &amp;&amp; make clean &amp;&amp; make ACPI_DEBUG=1</span></code></pre></div></div><div class=paragraph><p>Copy the compiled <span class=filename>acpi.ko</span> to <span class=filename>/boot/kernel</span> and add the desired level and layer to <span class=filename>/boot/loader.conf</span>. The entries in this example enable debug messages for all ACPI components and hardware drivers and output error messages at the least verbose level:</p></div><div class="literalblock programlisting"><div class=content><pre>debug.acpi.layer=&#34;ACPI_ALL_COMPONENTS ACPI_ALL_DRIVERS&#34;
debug.acpi.level=&#34;ACPI_LV_ERROR&#34;</pre></div></div><div class=paragraph><p>If the required information is triggered by a specific event, such as a suspend and then resume, do not modify <span class=filename>/boot/loader.conf</span>. Instead, use <code>sysctl</code> to specify the layer and level after booting and preparing the system for the specific event. The variables which can be set using <code>sysctl</code> are named the same as the tunables in <span class=filename>/boot/loader.conf</span>.</p></div><div class=paragraph><p>Once the debugging information is gathered, it can be sent to <a href=https://lists.FreeBSD.org/subscription/freebsd-acpi>FreeBSD ACPI mailing list</a> so that it can be used by the FreeBSD ACPI maintainers to identify the root cause of the problem and to develop a solution.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Before submitting debugging information to this mailing list, ensure the latest BIOS version is installed and, if available, the embedded controller firmware version.</p></div></td></tr></tbody></table></div><div class=paragraph><p>When submitting a problem report, include the following information:</p></div><div class=ulist><ul><li><p>Description of the buggy behavior, including system type, model, and anything that causes the bug to appear. Note as accurately as possible when the bug began occurring if it is new.</p></li><li><p>The output of <code>dmesg</code> after running <code>boot -v</code>, including any error messages generated by the bug.</p></li><li><p>The <code>dmesg</code> output from <code>boot -v</code> with ACPI disabled, if disabling ACPI helps to fix the problem.</p></li><li><p>Output from <code>sysctl hw.acpi</code>. This lists which features the system offers.</p></li><li><p>The URL to a pasted version of the system’s ASL. Do <em>not</em> send the ASL directly to the list as it can be very large. Generate a copy of the ASL by running this command:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># acpidump -dt &gt; name-system.asl</span></code></pre></div></div><div class=paragraph><p>Substitute the login name for <em>name</em> and manufacturer/model for <em>system</em>. For example, use <span class=filename>njl-FooCo6000.asl</span>.</p></div></li></ul></div><div class=paragraph><p>Most FreeBSD developers watch the <a href=https://lists.FreeBSD.org/subscription/freebsd-current>FreeBSD-CURRENT mailing list</a>, but one should submit problems to <a href=https://lists.FreeBSD.org/subscription/freebsd-acpi>FreeBSD ACPI mailing list</a> to be sure it is seen. Be patient when waiting for a response. If the bug is not immediately apparent, submit a bug report. When entering a PR, include the same information as requested above. This helps developers to track the problem and resolve it. Do not send a PR without emailing <a href=https://lists.FreeBSD.org/subscription/freebsd-acpi>FreeBSD ACPI mailing list</a> first as it is likely that the problem has been reported before.</p></div></div><div class=sect3><h4 id=ACPI-References>11.13.5. References<a class=anchor href=#ACPI-References></a></h4><div class=paragraph><p>More information about ACPI may be found in the following locations:</p></div><div class=ulist><ul><li><p>The FreeBSD ACPI Mailing List Archives (<a href=https://lists.freebsd.org/pipermail/freebsd-acpi/>https://lists.freebsd.org/pipermail/freebsd-acpi/</a>)</p></li><li><p>The <a href=https://uefi.org/specifications#ACPI>ACPI Specification</a></p></li><li><p><a href="https://man.freebsd.org/cgi/man.cgi?query=acpi&amp;sektion=4&amp;format=html">acpi(4)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=acpi_thermal&amp;sektion=4&amp;format=html">acpi_thermal(4)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=acpidump&amp;sektion=8&amp;format=html">acpidump(8)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=iasl&amp;sektion=8&amp;format=html">iasl(8)</a>, and <a href="https://man.freebsd.org/cgi/man.cgi?query=acpidb&amp;sektion=8&amp;format=html">acpidb(8)</a></p></li></ul></div></div></div></div></div><div class=sect1><h2 id=boot>Rozdział 12. The FreeBSD Booting Process<a class=anchor href=#boot></a></h2><div class=sectionbody><div class=sect2><h3 id=boot-synopsis>12.1. Synopsis<a class=anchor href=#boot-synopsis></a></h3><div class=paragraph><p>The process of starting a computer and loading the operating system is referred to as "the bootstrap process", or "booting". FreeBSD’s boot process provides a great deal of flexibility in customizing what happens when the system starts, including the ability to select from different operating systems installed on the same computer, different versions of the same operating system, or a different installed kernel.</p></div><div class=paragraph><p>This chapter details the configuration options that can be set. It demonstrates how to customize the FreeBSD boot process, including everything that happens until the FreeBSD kernel has started, probed for devices, and started <a href="https://man.freebsd.org/cgi/man.cgi?query=init&amp;sektion=8&amp;format=html">init(8)</a>. This occurs when the text color of the boot messages changes from bright white to grey.</p></div><div class=paragraph><p>After reading this chapter, you will recognize:</p></div><div class=ulist><ul><li><p>The components of the FreeBSD bootstrap system and how they interact.</p></li><li><p>The options that can be passed to the components in the FreeBSD bootstrap in order to control the boot process.</p></li><li><p>How to configure a customized boot splash screen.</p></li><li><p>The basics of setting device hints.</p></li><li><p>How to boot into single- and multi-user mode and how to properly shut down a FreeBSD system.</p></li></ul></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>This chapter only describes the boot process for FreeBSD running on x86 and amd64 systems.</p></div></td></tr></tbody></table></div></div><div class=sect2><h3 id=boot-introduction>12.2. FreeBSD Boot Process<a class=anchor href=#boot-introduction></a></h3><div class=paragraph><p>Turning on a computer and starting the operating system poses an interesting dilemma. By definition, the computer does not know how to do anything until the operating system is started. This includes running programs from the disk. If the computer can not run a program from the disk without the operating system, and the operating system programs are on the disk, how is the operating system started?</p></div><div class=paragraph><p>This problem parallels one in the book The Adventures of Baron Munchausen. A character had fallen part way down a manhole, and pulled himself out by grabbing his bootstraps and lifting. In the early days of computing, the term <em>bootstrap</em> was applied to the mechanism used to load the operating system. It has since become shortened to "booting".</p></div><div class=paragraph><p>On x86 hardware, the Basic Input/Output System (BIOS) is responsible for loading the operating system. The BIOS looks on the hard disk for the Master Boot Record (MBR), which must be located in a specific place on the disk. The BIOS has enough knowledge to load and run the MBR, and assumes that the MBR can then carry out the rest of the tasks involved in loading the operating system, possibly with the help of the BIOS.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>FreeBSD provides for booting from both the older MBR standard, and the newer GUID Partition Table (GPT). GPT partitioning is often found on computers with the Unified Extensible Firmware Interface (UEFI). However, FreeBSD can boot from GPT partitions even on machines with only a legacy BIOS with <a href="https://man.freebsd.org/cgi/man.cgi?query=gptboot&amp;sektion=8&amp;format=html">gptboot(8)</a>. Work is under way to provide direct UEFI booting.</p></div></td></tr></tbody></table></div><div class=paragraph><p>The code within the MBR is typically referred to as a <em>boot manager</em>, especially when it interacts with the user. The boot manager usually has more code in the first track of the disk or within the file system. Examples of boot managers include the standard FreeBSD boot manager boot0, also called Boot Easy, and Grub, which is used by many Linux® distributions.</p></div><div class=paragraph><p>If only one operating system is installed, the MBR searches for the first bootable (active) slice on the disk, and then runs the code on that slice to load the remainder of the operating system. When multiple operating systems are present, a different boot manager can be installed to display a list of operating systems so the user can select one to boot.</p></div><div class=paragraph><p>The remainder of the FreeBSD bootstrap system is divided into three stages. The first stage knows just enough to get the computer into a specific state and run the second stage. The second stage can do a little bit more, before running the third stage. The third stage finishes the task of loading the operating system. The work is split into three stages because the MBR puts limits on the size of the programs that can be run at stages one and two. Chaining the tasks together allows FreeBSD to provide a more flexible loader.</p></div><div class=paragraph><p>The kernel is then started and begins to probe for devices and initialize them for use. Once the kernel boot process is finished, the kernel passes control to the user process <a href="https://man.freebsd.org/cgi/man.cgi?query=init&amp;sektion=8&amp;format=html">init(8)</a>, which makes sure the disks are in a usable state, starts the user-level resource configuration which mounts file systems, sets up network cards to communicate on the network, and starts the processes which have been configured to run at startup.</p></div><div class=paragraph><p>This section describes these stages in more detail and demonstrates how to interact with the FreeBSD boot process.</p></div><div class=sect3><h4 id=boot-boot0>12.2.1. The Boot Manager<a class=anchor href=#boot-boot0></a></h4><div class=paragraph><p>The boot manager code in the MBR is sometimes referred to as <em>stage zero</em> of the boot process. By default, FreeBSD uses the boot0 boot manager.</p></div><div class=paragraph><p>The MBR installed by the FreeBSD installer is based on <span class=filename>/boot/boot0</span>. The size and capability of boot0 is restricted to 446 bytes due to the slice table and <code>0x55AA</code> identifier at the end of the MBR. If boot0 and multiple operating systems are installed, a message similar to this example will be displayed at boot time:</p></div><div id=boot-boot0-example class=exampleblock><div class=title>Przykład 8. <span class=filename>boot0</span> Screenshot</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>F1 Win
F2 FreeBSD

Default: F2</code></pre></div></div></div></div><div class=paragraph><p>Other operating systems will overwrite an existing MBR if they are installed after FreeBSD. If this happens, or to replace the existing MBR with the FreeBSD MBR, use the following command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># fdisk -B -b /boot/boot0 device</span></code></pre></div></div><div class=paragraph><p>where <em>device</em> is the boot disk, such as <span class=filename>ad0</span> for the first IDE disk, <span class=filename>ad2</span> for the first IDE disk on a second IDE controller, or <span class=filename>da0</span> for the first SCSI disk. To create a custom configuration of the MBR, refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=boot0cfg&amp;sektion=8&amp;format=html">boot0cfg(8)</a>.</p></div></div><div class=sect3><h4 id=boot-boot1>12.2.2. Stage One and Stage Two<a class=anchor href=#boot-boot1></a></h4><div class=paragraph><p>Conceptually, the first and second stages are part of the same program on the same area of the disk. Because of space constraints, they have been split into two, but are always installed together. They are copied from the combined <span class=filename>/boot/boot</span> by the FreeBSD installer or <code>bsdlabel</code>.</p></div><div class=paragraph><p>These two stages are located outside file systems, in the first track of the boot slice, starting with the first sector. This is where boot0, or any other boot manager, expects to find a program to run which will continue the boot process.</p></div><div class=paragraph><p>The first stage, <span class=filename>boot1</span>, is very simple, since it can only be 512 bytes in size. It knows just enough about the FreeBSD <em>bsdlabel</em>, which stores information about the slice, to find and execute <span class=filename>boot2</span>.</p></div><div class=paragraph><p>Stage two, <span class=filename>boot2</span>, is slightly more sophisticated, and understands the FreeBSD file system enough to find files. It can provide a simple interface to choose the kernel or loader to run. It runs loader, which is much more sophisticated and provides a boot configuration file. If the boot process is interrupted at stage two, the following interactive screen is displayed:</p></div><div id=boot-boot2-example class=exampleblock><div class=title>Przykład 9. <span class=filename>boot2</span> Screenshot</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=o>&gt;&gt;</span> FreeBSD/i386 BOOT
Default: 0:ad<span class=o>(</span>0,a<span class=o>)</span>/boot/loader
boot:</code></pre></div></div></div></div><div class=paragraph><p>To replace the installed <span class=filename>boot1</span> and <span class=filename>boot2</span>, use <code>bsdlabel</code>, where <em>diskslice</em> is the disk and slice to boot from, such as <span class=filename>ad0s1</span> for the first slice on the first IDE disk:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># bsdlabel -B diskslice</span></code></pre></div></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>If just the disk name is used, such as <span class=filename>ad0</span>, <code>bsdlabel</code> will create the disk in "dangerously dedicated mode", without slices. This is probably not the desired action, so double check the <em>diskslice</em> before pressing <kbd>Return</kbd>.</p></div></td></tr></tbody></table></div></div><div class=sect3><h4 id=boot-loader>12.2.3. Stage Three<a class=anchor href=#boot-loader></a></h4><div class=paragraph><p>The loader is the final stage of the three-stage bootstrap process. It is located on the file system, usually as <span class=filename>/boot/loader</span>.</p></div><div class=paragraph><p>The loader is intended as an interactive method for configuration, using a built-in command set, backed up by a more powerful interpreter which has a more complex command set.</p></div><div class=paragraph><p>During initialization, loader will probe for a console and for disks, and figure out which disk it is booting from. It will set variables accordingly, and an interpreter is started where user commands can be passed from a script or interactively.</p></div><div class=paragraph><p>The loader will then read <span class=filename>/boot/loader.rc</span>, which by default reads in <span class=filename>/boot/defaults/loader.conf</span> which sets reasonable defaults for variables and reads <span class=filename>/boot/loader.conf</span> for local changes to those variables. <span class=filename>loader.rc</span> then acts on these variables, loading whichever modules and kernel are selected.</p></div><div class=paragraph><p>Finally, by default, loader issues a 10 second wait for key presses, and boots the kernel if it is not interrupted. If interrupted, the user is presented with a prompt which understands the command set, where the user may adjust variables, unload all modules, load modules, and then finally boot or reboot. <a href=#boot-loader-commands>Loader Built-In Commands</a> lists the most commonly used loader commands. For a complete discussion of all available commands, refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=loader&amp;sektion=8&amp;format=html">loader(8)</a>.</p></div><table id=boot-loader-commands class="tableblock frame-none grid-all stretch"><caption class=title>Tabela 10. Loader Built-In Commands</caption><col style=width:20%><col style=width:80%><thead><tr><th class="tableblock halign-left valign-top">Variable</th><th class="tableblock halign-left valign-top">Description</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock>autoboot <em>seconds</em></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Proceeds to boot the kernel if not interrupted within the time span given, in seconds. It displays a countdown, and the default time span is 10 seconds.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>boot [<code>-options</code>] [<code>kernelname</code>]</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Immediately proceeds to boot the kernel, with any specified options or kernel name. Providing a kernel name on the command-line is only applicable after an <code>unload</code> has been issued. Otherwise, the previously-loaded kernel will be used. If <em>kernelname</em> is not qualified, it will be searched under <em>/boot/kernel</em> and <em>/boot/modules</em>.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>boot-conf</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Goes through the same automatic configuration of modules based on specified variables, most commonly <code>kernel</code>. This only makes sense if <code>unload</code> is used first, before changing some variables.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>help [<code><em>topic</em></code>]</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Shows help messages read from <span class=filename>/boot/loader.help</span>. If the topic given is <code>index</code>, the list of available topics is displayed.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>include <code><em>filename</em></code> …​</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Reads the specified file and interprets it line by line. An error immediately stops the <code>include</code>.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>load [-t <code><em>type</em></code>] <code><em>filename</em></code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Loads the kernel, kernel module, or file of the type given, with the specified filename. Any arguments after <em>filename</em> are passed to the file. If <em>filename</em> is not qualified, it will be searched under <em>/boot/kernel</em> and <em>/boot/modules</em>.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>ls [-l] [<code><em>path</em></code>]</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Displays a listing of files in the given path, or the root directory, if the path is not specified. If <code>-l</code> is specified, file sizes will also be shown.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>lsdev [<code>-v</code>]</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Lists all of the devices from which it may be possible to load modules. If <code>-v</code> is specified, more details are printed.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>lsmod [<code>-v</code>]</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Displays loaded modules. If <code>-v</code> is specified, more details are shown.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>more <code><em>filename</em></code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Displays the files specified, with a pause at each <code>LINES</code> displayed.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>reboot</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Immediately reboots the system.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>set <code><em>variable</em></code>, set <code><em>variable=value</em></code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Sets the specified environment variables.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>unload</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Removes all loaded modules.</p></td></tr></tbody></table><div class=paragraph><p>Here are some practical examples of loader usage. To boot the usual kernel in single-user mode :</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell> boot <span class=nt>-s</span></code></pre></div></div><div class=paragraph><p>To unload the usual kernel and modules and then load the previous or another, specified kernel:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell> unload
 load kernel.old</code></pre></div></div><div class=paragraph><p>Use <span class=filename>kernel.GENERIC</span> to refer to the default kernel that comes with an installation, or <span class=filename>kernel.old</span>, to refer to the previously installed kernel before a system upgrade or before configuring a custom kernel.</p></div><div class=paragraph><p>Use the following to load the usual modules with another kernel:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell> unload
 <span class=nb>set </span><span class=nv>kernel</span><span class=o>=</span><span class=s2>&#34;kernel.old&#34;</span>
 boot-conf</code></pre></div></div><div class=paragraph><p>To load an automated kernel configuration script:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell> load <span class=nt>-t</span> userconfig_script /boot/kernel.conf</code></pre></div></div></div><div class=sect3><h4 id=boot-init>12.2.4. Last Stage<a class=anchor href=#boot-init></a></h4><div class=paragraph><p>Once the kernel is loaded by either loader or by boot2, which bypasses loader, it examines any boot flags and adjusts its behavior as necessary. <a href=#boot-kernel>Kernel Interaction During Boot</a> lists the commonly used boot flags. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=boot&amp;sektion=8&amp;format=html">boot(8)</a> for more information on the other boot flags.</p></div><table id=boot-kernel class="tableblock frame-none grid-all stretch"><caption class=title>Tabela 11. Kernel Interaction During Boot</caption><col style=width:20%><col style=width:80%><thead><tr><th class="tableblock halign-left valign-top">Option</th><th class="tableblock halign-left valign-top">Description</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>-a</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>During kernel initialization, ask for the device to mount as the root file system.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>-C</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Boot the root file system from a CDROM.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>-s</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Boot into single-user mode.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>-v</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Be more verbose during kernel startup.</p></td></tr></tbody></table><div class=paragraph><p>Once the kernel has finished booting, it passes control to the user process <a href="https://man.freebsd.org/cgi/man.cgi?query=init&amp;sektion=8&amp;format=html">init(8)</a>, which is located at <span class=filename>/sbin/init</span>, or the program path specified in the <code>init_path</code> variable in <code>loader</code>. This is the last stage of the boot process.</p></div><div class=paragraph><p>The boot sequence makes sure that the file systems available on the system are consistent. If a UFS file system is not, and <code>fsck</code> cannot fix the inconsistencies, init drops the system into single-user mode so that the system administrator can resolve the problem directly. Otherwise, the system boots into multi-user mode.</p></div><div class=sect4><h5 id=boot-singleuser>12.2.4.1. Single-User Mode<a class=anchor href=#boot-singleuser></a></h5><div class=paragraph><p>A user can specify this mode by booting with <code>-s</code> or by setting the <code>boot_single</code> variable in loader. It can also be reached by running <code>shutdown now</code> from multi-user mode. Single-user mode begins with this message:</p></div><div class="literalblock programlisting"><div class=content><pre>Enter full pathname of shell or RETURN for /bin/sh:</pre></div></div><div class=paragraph><p>If the user presses <kbd>Enter</kbd>, the system will enter the default Bourne shell. To specify a different shell, input the full path to the shell.</p></div><div class=paragraph><p>Single-user mode is usually used to repair a system that will not boot due to an inconsistent file system or an error in a boot configuration file. It can also be used to reset the <code>root</code> password when it is unknown. These actions are possible as the single-user mode prompt gives full, local access to the system and its configuration files. There is no networking in this mode.</p></div><div class=paragraph><p>While single-user mode is useful for repairing a system, it poses a security risk unless the system is in a physically secure location. By default, any user who can gain physical access to a system will have full control of that system after booting into single-user mode.</p></div><div class=paragraph><p>If the system <code>console</code> is changed to <code>insecure</code> in <span class=filename>/etc/ttys</span>, the system will first prompt for the <code>root</code> password before initiating single-user mode. This adds a measure of security while removing the ability to reset the <code>root</code> password when it is unknown.</p></div><div id=boot-insecure-console class=exampleblock><div class=title>Przykład 10. Configuring an Insecure Console in <span class=filename>/etc/ttys</span></div><div class=content><div class="literalblock programlisting"><div class=content><pre># name  getty                           type    status          comments
#
# If console is marked &#34;insecure&#34;, then init will ask for the root password
# when going to single-user mode.
console none                            unknown off insecure</pre></div></div></div></div><div class=paragraph><p>An <code>insecure</code> console means that physical security to the console is considered to be insecure, so only someone who knows the <code>root</code> password may use single-user mode.</p></div></div><div class=sect4><h5 id=boot-multiuser>12.2.4.2. Multi-User Mode<a class=anchor href=#boot-multiuser></a></h5><div class=paragraph><p>If init finds the file systems to be in order, or once the user has finished their commands in single-user mode and has typed <code>exit</code> to leave single-user mode, the system enters multi-user mode, in which it starts the resource configuration of the system.</p></div><div class=paragraph><p>The resource configuration system reads in configuration defaults from <span class=filename>/etc/defaults/rc.conf</span> and system-specific details from <span class=filename>/etc/rc.conf</span>. It then proceeds to mount the system file systems listed in <span class=filename>/etc/fstab</span>. It starts up networking services, miscellaneous system daemons, then the startup scripts of locally installed packages.</p></div><div class=paragraph><p>To learn more about the resource configuration system, refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=rc&amp;sektion=8&amp;format=html">rc(8)</a> and examine the scripts located in <span class=filename>/etc/rc.d</span>.</p></div></div></div></div><div class=sect2><h3 id=boot-splash>12.3. Configuring Boot Time Splash Screens<a class=anchor href=#boot-splash></a></h3><div class=paragraph><p>Typically when a FreeBSD system boots, it displays its progress as a series of messages at the console. A boot splash screen creates an alternate boot screen that hides all of the boot probe and service startup messages. A few boot loader messages, including the boot options menu and a timed wait countdown prompt, are displayed at boot time, even when the splash screen is enabled. The display of the splash screen can be turned off by hitting any key on the keyboard during the boot process.</p></div><div class=paragraph><p>There are two basic environments available in FreeBSD. The first is the default legacy virtual console command line environment. After the system finishes booting, a console login prompt is presented. The second environment is a configured graphical environment. Refer to <a href=./#x11>The X Window System</a> for more information on how to install and configure a graphical display manager and a graphical login manager.</p></div><div class=paragraph><p>Once the system has booted, the splash screen defaults to being a screen saver. After a time period of non-use, the splash screen will display and will cycle through steps of changing intensity of the image, from bright to very dark and over again. The configuration of the splash screen saver can be overridden by adding a <code>saver=</code> line to <span class=filename>/etc/rc.conf</span>. Several built-in screen savers are available and described in <a href="https://man.freebsd.org/cgi/man.cgi?query=splash&amp;sektion=4&amp;format=html">splash(4)</a>. The <code>saver=</code> option only applies to virtual consoles and has no effect on graphical display managers.</p></div><div class=paragraph><p>By installing the <a class=package href=https://cgit.freebsd.org/ports/tree/sysutils/bsd-splash-changer/>sysutils/bsd-splash-changer</a> package or port, a random splash image from a collection will display at boot. The splash screen function supports 256-colors in the bitmap (<span class=filename>.bmp</span>), ZSoft PCX (<span class=filename>.pcx</span>), or TheDraw (<span class=filename>.bin</span>) formats. The <span class=filename>.bmp</span>, <span class=filename>.pcx</span>, or <span class=filename>.bin</span> image has to be placed on the root partition, for example in <span class=filename>/boot</span>. The splash image files must have a resolution of 320 by 200 pixels or less in order to work on standard VGA adapters. For the default boot display resolution of 256-colors and 320 by 200 pixels or less, add the following lines to <span class=filename>/boot/loader.conf</span>. Replace <em>splash.bmp</em> with the name of the bitmap file to use:</p></div><div class="literalblock programlisting"><div class=content><pre>splash_bmp_load=&#34;YES&#34;
bitmap_load=&#34;YES&#34;
bitmap_name=&#34;/boot/splash.bmp&#34;</pre></div></div><div class=paragraph><p>To use a PCX file instead of a bitmap file:</p></div><div class="literalblock programlisting"><div class=content><pre>splash_pcx_load=&#34;YES&#34;
bitmap_load=&#34;YES&#34;
bitmap_name=&#34;/boot/splash.pcx&#34;</pre></div></div><div class=paragraph><p>To instead use ASCII art in the <a href=https://en.wikipedia.org/wiki/TheDraw>https://en.wikipedia.org/wiki/TheDraw</a> format:</p></div><div class="literalblock programlisting"><div class=content><pre>splash_txt=&#34;YES&#34;
bitmap_load=&#34;YES&#34;
bitmap_name=&#34;/boot/splash.bin&#34;</pre></div></div><div class=paragraph><p>Other interesting <span class=filename>loader.conf</span> options include:</p></div><div class=dlist><dl><dt class=hdlist1><code>beastie_disable="YES"</code></dt><dd><p>This will stop the boot options menu from being displayed, but the timed wait count down prompt will still be present. Even with the display of the boot options menu disabled, entering an option selection at the timed wait count down prompt will enact the corresponding boot option.</p></dd><dt class=hdlist1><code>loader_logo="beastie"</code></dt><dd><p>This will replace the default words "FreeBSD", which are displayed to the right of the boot options menu, with the colored beastie logo.</p></dd></dl></div><div class=paragraph><p>For more information, refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=splash&amp;sektion=4&amp;format=html">splash(4)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=loader.conf&amp;sektion=5&amp;format=html">loader.conf(5)</a>, and <a href="https://man.freebsd.org/cgi/man.cgi?query=vga&amp;sektion=4&amp;format=html">vga(4)</a>.</p></div></div><div class=sect2><h3 id=device-hints>12.4. Device Hints<a class=anchor href=#device-hints></a></h3><div class=paragraph><p>During initial system startup, the boot <a href="https://man.freebsd.org/cgi/man.cgi?query=loader&amp;sektion=8&amp;format=html">loader(8)</a> reads <a href="https://man.freebsd.org/cgi/man.cgi?query=device.hints&amp;sektion=5&amp;format=html">device.hints(5)</a>. This file stores kernel boot information known as variables, sometimes referred to as "device hints". These "device hints" are used by device drivers for device configuration.</p></div><div class=paragraph><p>Device hints may also be specified at the Stage 3 boot loader prompt, as demonstrated in <a href=#boot-loader>Stage Three</a>. Variables can be added using <code>set</code>, removed with <code>unset</code>, and viewed <code>show</code>. Variables set in <span class=filename>/boot/device.hints</span> can also be overridden. Device hints entered at the boot loader are not permanent and will not be applied on the next reboot.</p></div><div class=paragraph><p>Once the system is booted, <a href="https://man.freebsd.org/cgi/man.cgi?query=kenv&amp;sektion=1&amp;format=html">kenv(1)</a> can be used to dump all of the variables.</p></div><div class=paragraph><p>The syntax for <span class=filename>/boot/device.hints</span> is one variable per line, using the hash "#" as comment markers. Lines are constructed as follows:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell> hint.driver.unit.keyword<span class=o>=</span><span class=s2>&#34;value&#34;</span></code></pre></div></div><div class=paragraph><p>The syntax for the Stage 3 boot loader is:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell> <span class=nb>set </span>hint.driver.unit.keyword<span class=o>=</span>value</code></pre></div></div><div class=paragraph><p>where <code>driver</code> is the device driver name, <code>unit</code> is the device driver unit number, and <code>keyword</code> is the hint keyword. The keyword may consist of the following options:</p></div><div class=ulist><ul><li><p><code>at</code>: specifies the bus which the device is attached to.</p></li><li><p><code>port</code>: specifies the start address of the I/O to be used.</p></li><li><p><code>irq</code>: specifies the interrupt request number to be used.</p></li><li><p><code>drq</code>: specifies the DMA channel number.</p></li><li><p><code>maddr</code>: specifies the physical memory address occupied by the device.</p></li><li><p><code>flags</code>: sets various flag bits for the device.</p></li><li><p><code>disabled</code>: if set to <code>1</code> the device is disabled.</p></li></ul></div><div class=paragraph><p>Since device drivers may accept or require more hints not listed here, viewing a driver’s manual page is recommended. For more information, refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=device.hints&amp;sektion=5&amp;format=html">device.hints(5)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=kenv&amp;sektion=1&amp;format=html">kenv(1)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=loader.conf&amp;sektion=5&amp;format=html">loader.conf(5)</a>, and <a href="https://man.freebsd.org/cgi/man.cgi?query=loader&amp;sektion=8&amp;format=html">loader(8)</a>.</p></div></div><div class=sect2><h3 id=boot-shutdown>12.5. Shutdown Sequence<a class=anchor href=#boot-shutdown></a></h3><div class=paragraph><p>Upon controlled shutdown using <a href="https://man.freebsd.org/cgi/man.cgi?query=shutdown&amp;sektion=8&amp;format=html">shutdown(8)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=init&amp;sektion=8&amp;format=html">init(8)</a> will attempt to run the script <span class=filename>/etc/rc.shutdown</span>, and then proceed to send all processes the <code>TERM</code> signal, and subsequently the <code>KILL</code> signal to any that do not terminate in a timely manner.</p></div><div class=paragraph><p>To power down a FreeBSD machine on architectures and systems that support power management, use <code>shutdown -p now</code> to turn the power off immediately. To reboot a FreeBSD system, use <code>shutdown -r now</code>. One must be <code>root</code> or a member of <code>operator</code> in order to run <a href="https://man.freebsd.org/cgi/man.cgi?query=shutdown&amp;sektion=8&amp;format=html">shutdown(8)</a>. One can also use <a href="https://man.freebsd.org/cgi/man.cgi?query=halt&amp;sektion=8&amp;format=html">halt(8)</a> and <a href="https://man.freebsd.org/cgi/man.cgi?query=reboot&amp;sektion=8&amp;format=html">reboot(8)</a>. Refer to their manual pages and to <a href="https://man.freebsd.org/cgi/man.cgi?query=shutdown&amp;sektion=8&amp;format=html">shutdown(8)</a> for more information.</p></div><div class=paragraph><p>Modify group membership by referring to <a href=./#users-synopsis>“Users and Basic Account Management”</a>.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Power management requires <a href="https://man.freebsd.org/cgi/man.cgi?query=acpi&amp;sektion=4&amp;format=html">acpi(4)</a> to be loaded as a module or statically compiled into a custom kernel.</p></div></td></tr></tbody></table></div></div></div></div><div class=sect1><h2 id=security>Rozdział 13. Security<a class=anchor href=#security></a></h2><div class=sectionbody><div class=sect2><h3 id=security-synopsis>13.1. Synopsis<a class=anchor href=#security-synopsis></a></h3><div class=paragraph><p>Security, whether physical or virtual, is a topic so broad that an entire industry has evolved around it. Hundreds of standard practices have been authored about how to secure systems and networks, and as a user of FreeBSD, understanding how to protect against attacks and intruders is a must.</p></div><div class=paragraph><p>In this chapter, several fundamentals and techniques will be discussed. The FreeBSD system comes with multiple layers of security, and many more third party utilities may be added to enhance security.</p></div><div class=paragraph><p>After reading this chapter, you will know:</p></div><div class=ulist><ul><li><p>Basic FreeBSD system security concepts.</p></li><li><p>The various crypt mechanisms available in FreeBSD.</p></li><li><p>How to set up one-time password authentication.</p></li><li><p>How to configure TCP Wrapper for use with <a href="https://man.freebsd.org/cgi/man.cgi?query=inetd&amp;sektion=8&amp;format=html">inetd(8)</a>.</p></li><li><p>How to set up Kerberos on FreeBSD.</p></li><li><p>How to configure IPsec and create a VPN.</p></li><li><p>How to configure and use OpenSSH on FreeBSD.</p></li><li><p>How to use file system ACLs.</p></li><li><p>How to use pkg to audit third party software packages installed from the Ports Collection.</p></li><li><p>How to utilize FreeBSD security advisories.</p></li><li><p>What Process Accounting is and how to enable it on FreeBSD.</p></li><li><p>How to control user resources using login classes or the resource limits database.</p></li></ul></div><div class=paragraph><p>Before reading this chapter, you should:</p></div><div class=ulist><ul><li><p>Understand basic FreeBSD and Internet concepts.</p></li></ul></div><div class=paragraph><p>Additional security topics are covered elsewhere in this Handbook. For example, Mandatory Access Control is discussed in <a href=./#mac>Mandatory Access Control</a> and Internet firewalls are discussed in <a href=./#firewalls>Firewalls</a>.</p></div></div><div class=sect2><h3 id=security-intro>13.2. Introduction<a class=anchor href=#security-intro></a></h3><div class=paragraph><p>Security is everyone’s responsibility. A weak entry point in any system could allow intruders to gain access to critical information and cause havoc on an entire network. One of the core principles of information security is the CIA triad, which stands for the Confidentiality, Integrity, and Availability of information systems.</p></div><div class=paragraph><p>The CIA triad is a bedrock concept of computer security as customers and users expect their data to be protected. For example, a customer expects that their credit card information is securely stored (confidentiality), that their orders are not changed behind the scenes (integrity), and that they have access to their order information at all times (availablility).</p></div><div class=paragraph><p>To provide CIA, security professionals apply a defense in depth strategy. The idea of defense in depth is to add several layers of security to prevent one single layer failing and the entire security system collapsing. For example, a system administrator cannot simply turn on a firewall and consider the network or system secure. One must also audit accounts, check the integrity of binaries, and ensure malicious tools are not installed. To implement an effective security strategy, one must understand threats and how to defend against them.</p></div><div class=paragraph><p>What is a threat as it pertains to computer security? Threats are not limited to remote attackers who attempt to access a system without permission from a remote location. Threats also include employees, malicious software, unauthorized network devices, natural disasters, security vulnerabilities, and even competing corporations.</p></div><div class=paragraph><p>Systems and networks can be accessed without permission, sometimes by accident, or by remote attackers, and in some cases, via corporate espionage or former employees. As a user, it is important to prepare for and admit when a mistake has led to a security breach and report possible issues to the security team. As an administrator, it is important to know of the threats and be prepared to mitigate them.</p></div><div class=paragraph><p>When applying security to systems, it is recommended to start by securing the basic accounts and system configuration, and then to secure the network layer so that it adheres to the system policy and the organization’s security procedures. Many organizations already have a security policy that covers the configuration of technology devices. The policy should include the security configuration of workstations, desktops, mobile devices, phones, production servers, and development servers. In many cases, standard operating procedures (SOPs) already exist. When in doubt, ask the security team.</p></div><div class=paragraph><p>The rest of this introduction describes how some of these basic security configurations are performed on a FreeBSD system. The rest of this chapter describes some specific tools which can be used when implementing a security policy on a FreeBSD system.</p></div><div class=sect3><h4 id=security-accounts>13.2.1. Preventing Logins<a class=anchor href=#security-accounts></a></h4><div class=paragraph><p>In securing a system, a good starting point is an audit of accounts. Ensure that <code>root</code> has a strong password and that this password is not shared. Disable any accounts that do not need login access.</p></div><div class=paragraph><p>To deny login access to accounts, two methods exist. The first is to lock the account. This example locks the <code>toor</code> account:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pw lock toor</span></code></pre></div></div><div class=paragraph><p>The second method is to prevent login access by changing the shell to <span class=filename>/usr/sbin/nologin</span>. Only the superuser can change the shell for other users:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># chsh -s /usr/sbin/nologin toor</span></code></pre></div></div><div class=paragraph><p>The <span class=filename>/usr/sbin/nologin</span> shell prevents the system from assigning a shell to the user when they attempt to login.</p></div></div><div class=sect3><h4 id=security-accountmgmt>13.2.2. Permitted Account Escalation<a class=anchor href=#security-accountmgmt></a></h4><div class=paragraph><p>In some cases, system administration needs to be shared with other users. FreeBSD has two methods to handle this. The first one, which is not recommended, is a shared root password used by members of the <code>wheel</code> group. With this method, a user types <code>su</code> and enters the password for <code>wheel</code> whenever superuser access is needed. The user should then type <code>exit</code> to leave privileged access after finishing the commands that required administrative access. To add a user to this group, edit <span class=filename>/etc/group</span> and add the user to the end of the <code>wheel</code> entry. The user must be separated by a comma character with no space.</p></div><div class=paragraph><p>The second, and recommended, method to permit privilege escalation is to install the <a class=package href=https://cgit.freebsd.org/ports/tree/security/sudo/>security/sudo</a> package or port. This software provides additional auditing, more fine-grained user control, and can be configured to lock users into running only the specified privileged commands.</p></div><div class=paragraph><p>After installation, use <code>visudo</code> to edit <span class=filename>/usr/local/etc/sudoers</span>. This example creates a new <code>webadmin</code> group, adds the <code>trhodes</code> account to that group, and configures that group access to restart <a class=package href=https://cgit.freebsd.org/ports/tree/apache24/>apache24</a>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pw groupadd webadmin -M trhodes -g 6000</span>
<span class=c># visudo</span>
%webadmin <span class=nv>ALL</span><span class=o>=(</span>ALL<span class=o>)</span> /usr/sbin/service apache24 <span class=k>*</span></code></pre></div></div></div><div class=sect3><h4 id=security-passwords>13.2.3. Password Hashes<a class=anchor href=#security-passwords></a></h4><div class=paragraph><p>Passwords are a necessary evil of technology. When they must be used, they should be complex and a powerful hash mechanism should be used to encrypt the version that is stored in the password database. FreeBSD supports the DES, MD5, SHA256, SHA512, and Blowfish hash algorithms in its <code>crypt()</code> library. The default of SHA512 should not be changed to a less secure hashing algorithm, but can be changed to the more secure Blowfish algorithm.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Blowfish is not part of AES and is not considered compliant with any Federal Information Processing Standards (FIPS). Its use may not be permitted in some environments.</p></div></td></tr></tbody></table></div><div class=paragraph><p>To determine which hash algorithm is used to encrypt a user’s password, the superuser can view the hash for the user in the FreeBSD password database. Each hash starts with a symbol which indicates the type of hash mechanism used to encrypt the password. If DES is used, there is no beginning symbol. For MD5, the symbol is <code>$</code>. For SHA256 and SHA512, the symbol is <code>$6$</code>. For Blowfish, the symbol is <code>$2a$</code>. In this example, the password for <code>dru</code> is hashed using the default SHA512 algorithm as the hash starts with <code>$6$</code>. Note that the encrypted hash, not the password itself, is stored in the password database:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># grep dru /etc/master.passwd</span>
dru:<span class=nv>$6$pzIjSvCAn</span>.PBYQBA<span class=nv>$PXpSeWPx3g5kscj3IMiM7tUEUSPmGexxta</span>.8Lt9TGSi2lNQqYGKszsBPuGME0:1001:1001::0:0:dru:/usr/home/dru:/bin/csh</code></pre></div></div><div class=paragraph><p>The hash mechanism is set in the user’s login class. For this example, the user is in the <code>default</code> login class and the hash algorithm is set with this line in <span class=filename>/etc/login.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>        :passwd_format=sha512:\</pre></div></div><div class=paragraph><p>To change the algorithm to Blowfish, modify that line to look like this:</p></div><div class="literalblock programlisting"><div class=content><pre>        :passwd_format=blf:\</pre></div></div><div class=paragraph><p>Then run <code>cap_mkdb /etc/login.conf</code> as described in <a href=#users-limiting>Configuring Login Classes</a>. Note that this change will not affect any existing password hashes. This means that all passwords should be re-hashed by asking users to run <code>passwd</code> in order to change their password.</p></div><div class=paragraph><p>For remote logins, two-factor authentication should be used. An example of two-factor authentication is "something you have", such as a key, and "something you know", such as the passphrase for that key. Since OpenSSH is part of the FreeBSD base system, all network logins should be over an encrypted connection and use key-based authentication instead of passwords. For more information, refer to <a href=#openssh>OpenSSH</a>. Kerberos users may need to make additional changes to implement OpenSSH in their network. These changes are described in <a href=#kerberos5>Kerberos</a>.</p></div></div><div class=sect3><h4 id=security-pwpolicy>13.2.4. Password Policy Enforcement<a class=anchor href=#security-pwpolicy></a></h4><div class=paragraph><p>Enforcing a strong password policy for local accounts is a fundamental aspect of system security. In FreeBSD, password length, password strength, and password complexity can be implemented using built-in Pluggable Authentication Modules (PAM).</p></div><div class=paragraph><p>This section demonstrates how to configure the minimum and maximum password length and the enforcement of mixed characters using the <span class=filename>pam_passwdqc.so</span> module. This module is enforced when a user changes their password.</p></div><div class=paragraph><p>To configure this module, become the superuser and uncomment the line containing <code>pam_passwdqc.so</code> in <span class=filename>/etc/pam.d/passwd</span>. Then, edit that line to match the password policy:</p></div><div class="literalblock programlisting"><div class=content><pre>password        requisite       pam_passwdqc.so         min=disabled,disabled,disabled,12,10 similar=deny retry=3 enforce=users</pre></div></div><div class=paragraph><p>This example sets several requirements for new passwords. The <code>min</code> setting controls the minimum password length. It has five values because this module defines five different types of passwords based on their complexity. Complexity is defined by the type of characters that must exist in a password, such as letters, numbers, symbols, and case. The types of passwords are described in <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_passwdqc&amp;sektion=8&amp;format=html">pam_passwdqc(8)</a>. In this example, the first three types of passwords are disabled, meaning that passwords that meet those complexity requirements will not be accepted, regardless of their length. The <code>12</code> sets a minimum password policy of at least twelve characters, if the password also contains characters with three types of complexity. The <code>10</code> sets the password policy to also allow passwords of at least ten characters, if the password contains characters with four types of complexity.</p></div><div class=paragraph><p>The <code>similar</code> setting denies passwords that are similar to the user’s previous password. The <code>retry</code> setting provides a user with three opportunities to enter a new password.</p></div><div class=paragraph><p>Once this file is saved, a user changing their password will see a message similar to the following:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% passwd
Changing <span class=nb>local </span>password <span class=k>for </span>trhodes
Old Password:

You can now choose the new password.
A valid password should be a mix of upper and lower <span class=k>case</span> letters,
digits and other characters.  You can use a 12 character long
password with characters from at least 3 of these 4 classes, or
a 10 character long password containing characters from all the
classes.  Characters that form a common pattern are discarded by
the check.
Alternatively, <span class=k>if </span>no one <span class=k>else </span>can see your terminal now, you can
pick this as your password: <span class=s2>&#34;trait-useful&amp;knob&#34;</span><span class=nb>.</span>
Enter new password:</code></pre></div></div><div class=paragraph><p>If a password that does not match the policy is entered, it will be rejected with a warning and the user will have an opportunity to try again, up to the configured number of retries.</p></div><div class=paragraph><p>Most password policies require passwords to expire after so many days. To set a password age time in FreeBSD, set <code>passwordtime</code> for the user’s login class in <span class=filename>/etc/login.conf</span>. The <code>default</code> login class contains an example:</p></div><div class="literalblock programlisting"><div class=content><pre>#       :passwordtime=90d:\</pre></div></div><div class=paragraph><p>So, to set an expiry of 90 days for this login class, remove the comment symbol (<code>#</code>), save the edit, and run <code>cap_mkdb /etc/login.conf</code>.</p></div><div class=paragraph><p>To set the expiration on individual users, pass an expiration date or the number of days to expiry and a username to <code>pw</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pw usermod -p 30-apr-2015 -n trhodes</span></code></pre></div></div><div class=paragraph><p>As seen here, an expiration date is set in the form of day, month, and year. For more information, see <a href="https://man.freebsd.org/cgi/man.cgi?query=pw&amp;sektion=8&amp;format=html">pw(8)</a>.</p></div></div><div class=sect3><h4 id=security-rkhunter>13.2.5. Detecting Rootkits<a class=anchor href=#security-rkhunter></a></h4><div class=paragraph><p>A <em>rootkit</em> is any unauthorized software that attempts to gain <code>root</code> access to a system. Once installed, this malicious software will normally open up another avenue of entry for an attacker. Realistically, once a system has been compromised by a rootkit and an investigation has been performed, the system should be reinstalled from scratch. There is tremendous risk that even the most prudent security or systems engineer will miss something an attacker left behind.</p></div><div class=paragraph><p>A rootkit does do one thing useful for administrators: once detected, it is a sign that a compromise happened at some point. But, these types of applications tend to be very well hidden. This section demonstrates a tool that can be used to detect rootkits, <a class=package href=https://cgit.freebsd.org/ports/tree/security/rkhunter/>security/rkhunter</a>.</p></div><div class=paragraph><p>After installation of this package or port, the system may be checked using the following command. It will produce a lot of information and will require some manual pressing of <kbd>ENTER</kbd>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># rkhunter -c</span></code></pre></div></div><div class=paragraph><p>After the process completes, a status message will be printed to the screen. This message will include the amount of files checked, suspect files, possible rootkits, and more. During the check, some generic security warnings may be produced about hidden files, the OpenSSH protocol selection, and known vulnerable versions of installed software. These can be handled now or after a more detailed analysis has been performed.</p></div><div class=paragraph><p>Every administrator should know what is running on the systems they are responsible for. Third-party tools like rkhunter and <a class=package href=https://cgit.freebsd.org/ports/tree/sysutils/lsof/>sysutils/lsof</a>, and native commands such as <code>netstat</code> and <code>ps</code>, can show a great deal of information on the system. Take notes on what is normal, ask questions when something seems out of place, and be paranoid. While preventing a compromise is ideal, detecting a compromise is a must.</p></div></div><div class=sect3><h4 id=security-ids>13.2.6. Binary Verification<a class=anchor href=#security-ids></a></h4><div class=paragraph><p>Verification of system files and binaries is important because it provides the system administration and security teams information about system changes. A software application that monitors the system for changes is called an Intrusion Detection System (IDS).</p></div><div class=paragraph><p>FreeBSD provides native support for a basic IDS system. While the nightly security emails will notify an administrator of changes, the information is stored locally and there is a chance that a malicious user could modify this information in order to hide their changes to the system. As such, it is recommended to create a separate set of binary signatures and store them on a read-only, root-owned directory or, preferably, on a removable USB disk or remote rsync server.</p></div><div class=paragraph><p>The built-in <code>mtree</code> utility can be used to generate a specification of the contents of a directory. A seed, or a numeric constant, is used to generate the specification and is required to check that the specification has not changed. This makes it possible to determine if a file or binary has been modified. Since the seed value is unknown by an attacker, faking or checking the checksum values of files will be difficult to impossible. The following example generates a set of SHA256 hashes, one for each system binary in <span class=filename>/bin</span>, and saves those values to a hidden file in <code>root</code>'s home directory, <span class=filename>/root/.bin_chksum_mtree</span>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mtree -s 3483151339707503 -c -K cksum,sha256digest -p /bin &gt; /root/.bin_chksum_mtree</span>
<span class=c># mtree: /bin checksum: 3427012225</span></code></pre></div></div><div class=paragraph><p>The <em>3483151339707503</em> represents the seed. This value should be remembered, but not shared.</p></div><div class=paragraph><p>Viewing <span class=filename>/root/.bin_cksum_mtree</span> should yield output similar to the following:</p></div><div class="literalblock programlisting"><div class=content><pre>#          user: root
#       machine: dreadnaught
#          tree: /bin
#          date: Mon Feb  3 10:19:53 2014

# .
/set type=file uid=0 gid=0 mode=0555 nlink=1 flags=none
.               type=dir mode=0755 nlink=2 size=1024 \
                time=1380277977.000000000
    \133        nlink=2 size=11704 time=1380277977.000000000 \
                cksum=484492447 \
                sha256digest=6207490fbdb5ed1904441fbfa941279055c3e24d3a4049aeb45094596400662a
    cat         size=12096 time=1380277975.000000000 cksum=3909216944 \
                sha256digest=65ea347b9418760b247ab10244f47a7ca2a569c9836d77f074e7a306900c1e69
    chflags     size=8168 time=1380277975.000000000 cksum=3949425175 \
                sha256digest=c99eb6fc1c92cac335c08be004a0a5b4c24a0c0ef3712017b12c89a978b2dac3
    chio        size=18520 time=1380277975.000000000 cksum=2208263309 \
                sha256digest=ddf7c8cb92a58750a675328345560d8cc7fe14fb3ccd3690c34954cbe69fc964
    chmod       size=8640 time=1380277975.000000000 cksum=2214429708 \
                sha256digest=a435972263bf814ad8df082c0752aa2a7bdd8b74ff01431ccbd52ed1e490bbe7</pre></div></div><div class=paragraph><p>The machine’s hostname, the date and time the specification was created, and the name of the user who created the specification are included in this report. There is a checksum, size, time, and SHA256 digest for each binary in the directory.</p></div><div class=paragraph><p>To verify that the binary signatures have not changed, compare the current contents of the directory to the previously generated specification, and save the results to a file. This command requires the seed that was used to generate the original specification:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mtree -s 3483151339707503 -p /bin &lt; /root/.bin_chksum_mtree &gt;&gt; /root/.bin_chksum_output</span>
<span class=c># mtree: /bin checksum: 3427012225</span></code></pre></div></div><div class=paragraph><p>This should produce the same checksum for <span class=filename>/bin</span> that was produced when the specification was created. If no changes have occurred to the binaries in this directory, the <span class=filename>/root/.bin_chksum_output</span> output file will be empty. To simulate a change, change the date on <span class=filename>/bin/cat</span> using <code>touch</code> and run the verification command again:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># touch /bin/cat</span>
<span class=c># mtree -s 3483151339707503 -p /bin &lt; /root/.bin_chksum_mtree &gt;&gt; /root/.bin_chksum_output</span>
<span class=c># more /root/.bin_chksum_output</span>
<span class=nb>cat </span>changed
	modification <span class=nb>time </span>expected Fri Sep 27 06:32:55 2013 found Mon Feb  3 10:28:43 2014</code></pre></div></div><div class=paragraph><p>It is recommended to create specifications for the directories which contain binaries and configuration files, as well as any directories containing sensitive data. Typically, specifications are created for <span class=filename>/bin</span>, <span class=filename>/sbin</span>, <span class=filename>/usr/bin</span>, <span class=filename>/usr/sbin</span>, <span class=filename>/usr/local/bin</span>, <span class=filename>/etc</span>, and <span class=filename>/usr/local/etc</span>.</p></div><div class=paragraph><p>More advanced IDS systems exist, such as <a class=package href=https://cgit.freebsd.org/ports/tree/security/aide/>security/aide</a>. In most cases, <code>mtree</code> provides the functionality administrators need. It is important to keep the seed value and the checksum output hidden from malicious users. More information about <code>mtree</code> can be found in <a href="https://man.freebsd.org/cgi/man.cgi?query=mtree&amp;sektion=8&amp;format=html">mtree(8)</a>.</p></div></div><div class=sect3><h4 id=security-tuning>13.2.7. System Tuning for Security<a class=anchor href=#security-tuning></a></h4><div class=paragraph><p>In FreeBSD, many system features can be tuned using <code>sysctl</code>. A few of the security features which can be tuned to prevent Denial of Service (DoS) attacks will be covered in this section. More information about using <code>sysctl</code>, including how to temporarily change values and how to make the changes permanent after testing, can be found in <a href=./#configtuning-sysctl>“Tuning with sysctl(8)”</a>.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Any time a setting is changed with <code>sysctl</code>, the chance to cause undesired harm is increased, affecting the availability of the system. All changes should be monitored and, if possible, tried on a testing system before being used on a production system.</p></div></td></tr></tbody></table></div><div class=paragraph><p>By default, the FreeBSD kernel boots with a security level of <code>-1</code>. This is called "insecure mode" because immutable file flags may be turned off and all devices may be read from or written to. The security level will remain at <code>-1</code> unless it is altered through <code>sysctl</code> or by a setting in the startup scripts. The security level may be increased during system startup by setting <code>kern_securelevel_enable</code> to <code>YES</code> in <span class=filename>/etc/rc.conf</span>, and the value of <code>kern_securelevel</code> to the desired security level. See <a href="https://man.freebsd.org/cgi/man.cgi?query=security&amp;sektion=7&amp;format=html">security(7)</a> and <a href="https://man.freebsd.org/cgi/man.cgi?query=init&amp;sektion=8&amp;format=html">init(8)</a> for more information on these settings and the available security levels.</p></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>Increasing the <code>securelevel</code> can break Xorg and cause other issues. Be prepared to do some debugging.</p></div></td></tr></tbody></table></div><div class=paragraph><p>The <code>net.inet.tcp.blackhole</code> and <code>net.inet.udp.blackhole</code> settings can be used to drop incoming SYN packets on closed ports without sending a return RST response. The default behavior is to return an RST to show a port is closed. Changing the default provides some level of protection against ports scans, which are used to determine which applications are running on a system. Set <code>net.inet.tcp.blackhole</code> to <code>2</code> and <code>net.inet.udp.blackhole</code> to <code>1</code>. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=blackhole&amp;sektion=4&amp;format=html">blackhole(4)</a> for more information about these settings.</p></div><div class=paragraph><p>The <code>net.inet.icmp.drop_redirect</code> and <code>net.inet.ip.redirect</code> settings help prevent against <em>redirect attacks</em>. A redirect attack is a type of DoS which sends mass numbers of ICMP type 5 packets. Since these packets are not required, set <code>net.inet.icmp.drop_redirect</code> to <code>1</code> and set <code>net.inet.ip.redirect</code> to <code>0</code>.</p></div><div class=paragraph><p>Source routing is a method for detecting and accessing non-routable addresses on the internal network. This should be disabled as non-routable addresses are normally not routable on purpose. To disable this feature, set <code>net.inet.ip.sourceroute</code> and <code>net.inet.ip.accept_sourceroute</code> to <code>0</code>.</p></div><div class=paragraph><p>When a machine on the network needs to send messages to all hosts on a subnet, an ICMP echo request message is sent to the broadcast address. However, there is no reason for an external host to perform such an action. To reject all external broadcast requests, set <code>net.inet.icmp.bmcastecho</code> to <code>0</code>.</p></div><div class=paragraph><p>Some additional settings are documented in <a href="https://man.freebsd.org/cgi/man.cgi?query=security&amp;sektion=7&amp;format=html">security(7)</a>.</p></div></div></div><div class=sect2><h3 id=one-time-passwords>13.3. One-time Passwords<a class=anchor href=#one-time-passwords></a></h3><div class=paragraph><p>By default, FreeBSD includes support for One-time Passwords In Everything (OPIE). OPIE is designed to prevent replay attacks, in which an attacker discovers a user’s password and uses it to access a system. Since a password is only used once in OPIE, a discovered password is of little use to an attacker. OPIE uses a secure hash and a challenge/response system to manage passwords. The FreeBSD implementation uses the MD5 hash by default.</p></div><div class=paragraph><p>OPIE uses three different types of passwords. The first is the usual UNIX® or Kerberos password. The second is the one-time password which is generated by <code>opiekey</code>. The third type of password is the "secret password" which is used to generate one-time passwords. The secret password has nothing to do with, and should be different from, the UNIX® password.</p></div><div class=paragraph><p>There are two other pieces of data that are important to OPIE. One is the "seed" or "key", consisting of two letters and five digits. The other is the "iteration count", a number between 1 and 100. OPIE creates the one-time password by concatenating the seed and the secret password, applying the MD5 hash as many times as specified by the iteration count, and turning the result into six short English words which represent the one-time password. The authentication system keeps track of the last one-time password used, and the user is authenticated if the hash of the user-provided password is equal to the previous password. Because a one-way hash is used, it is impossible to generate future one-time passwords if a successfully used password is captured. The iteration count is decremented after each successful login to keep the user and the login program in sync. When the iteration count gets down to <code>1</code>, OPIE must be reinitialized.</p></div><div class=paragraph><p>There are a few programs involved in this process. A one-time password, or a consecutive list of one-time passwords, is generated by passing an iteration count, a seed, and a secret password to <a href="https://man.freebsd.org/cgi/man.cgi?query=opiekey&amp;sektion=1&amp;format=html">opiekey(1)</a>. In addition to initializing OPIE, <a href="https://man.freebsd.org/cgi/man.cgi?query=opiepasswd&amp;sektion=1&amp;format=html">opiepasswd(1)</a> is used to change passwords, iteration counts, or seeds. The relevant credential files in <span class=filename>/etc/opiekeys</span> are examined by <a href="https://man.freebsd.org/cgi/man.cgi?query=opieinfo&amp;sektion=1&amp;format=html">opieinfo(1)</a> which prints out the invoking user’s current iteration count and seed.</p></div><div class=paragraph><p>This section describes four different sorts of operations. The first is how to set up one-time-passwords for the first time over a secure connection. The second is how to use <code>opiepasswd</code> over an insecure connection. The third is how to log in over an insecure connection. The fourth is how to generate a number of keys which can be written down or printed out to use at insecure locations.</p></div><div class=sect3><h4 id=_initializing_opie>13.3.1. Initializing OPIE<a class=anchor href=#_initializing_opie></a></h4><div class=paragraph><p>To initialize OPIE for the first time, run this command from a secure location:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% opiepasswd <span class=nt>-c</span>
Adding unfurl:
Only use this method from the console<span class=p>;</span> NEVER from remote. If you are using
telnet, xterm, or a dial-in, <span class=nb>type</span> ^C now or <span class=nb>exit </span>with no password.
Then run opiepasswd without the <span class=nt>-c</span> parameter.
Using MD5 to compute responses.
Enter new secret pass phrase:
Again new secret pass phrase:

ID unfurl OTP key is 499 to4268
MOS MALL GOAT ARM AVID COED</code></pre></div></div><div class=paragraph><p>The <code>-c</code> sets console mode which assumes that the command is being run from a secure location, such as a computer under the user’s control or a SSH session to a computer under the user’s control.</p></div><div class=paragraph><p>When prompted, enter the secret password which will be used to generate the one-time login keys. This password should be difficult to guess and should be different than the password which is associated with the user’s login account. It must be between 10 and 127 characters long. Remember this password.</p></div><div class=paragraph><p>The <code>ID</code> line lists the login name (<code>unfurl</code>), default iteration count (<code>499</code>), and default seed (<code>to4268</code>). When logging in, the system will remember these parameters and display them, meaning that they do not have to be memorized. The last line lists the generated one-time password which corresponds to those parameters and the secret password. At the next login, use this one-time password.</p></div></div><div class=sect3><h4 id=_insecure_connection_initialization>13.3.2. Insecure Connection Initialization<a class=anchor href=#_insecure_connection_initialization></a></h4><div class=paragraph><p>To initialize or change the secret password on an insecure system, a secure connection is needed to some place where <code>opiekey</code> can be run. This might be a shell prompt on a trusted machine. An iteration count is needed, where 100 is probably a good value, and the seed can either be specified or the randomly-generated one used. On the insecure connection, the machine being initialized, use <a href="https://man.freebsd.org/cgi/man.cgi?query=opiepasswd&amp;sektion=1&amp;format=html">opiepasswd(1)</a>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% opiepasswd

Updating unfurl:
You need the response from an OTP generator.
Old secret pass phrase:
	otp-md5 498 to4268 ext
	Response: GAME GAG WELT OUT DOWN CHAT
New secret pass phrase:
	otp-md5 499 to4269
	Response: LINE PAP MILK NELL BUOY TROY

ID mark OTP key is 499 gr4269
LINE PAP MILK NELL BUOY TROY</code></pre></div></div><div class=paragraph><p>To accept the default seed, press <kbd>Return</kbd>. Before entering an access password, move over to the secure connection and give it the same parameters:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% opiekey 498 to4268
Using the MD5 algorithm to compute response.
Reminder: Do not use opiekey from telnet or dial-in sessions.
Enter secret pass phrase:
GAME GAG WELT OUT DOWN CHAT</code></pre></div></div><div class=paragraph><p>Switch back over to the insecure connection, and copy the generated one-time password over to the relevant program.</p></div></div><div class=sect3><h4 id=_generating_a_single_one_time_password>13.3.3. Generating a Single One-time Password<a class=anchor href=#_generating_a_single_one_time_password></a></h4><div class=paragraph><p>After initializing OPIE and logging in, a prompt like this will be displayed:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% telnet example.com
Trying 10.0.0.1...
Connected to example.com
Escape character is <span class=s1>&#39;^]&#39;</span><span class=nb>.</span>

FreeBSD/i386 <span class=o>(</span>example.com<span class=o>)</span> <span class=o>(</span>ttypa<span class=o>)</span>

login: &lt;username&gt;
otp-md5 498 gr4269 ext
Password:</code></pre></div></div><div class=paragraph><p>The OPIE prompts provides a useful feature. If <kbd>Return</kbd> is pressed at the password prompt, the prompt will turn echo on and display what is typed. This can be useful when attempting to type in a password by hand from a printout.</p></div><div class=paragraph><p>At this point, generate the one-time password to answer this login prompt. This must be done on a trusted system where it is safe to run <a href="https://man.freebsd.org/cgi/man.cgi?query=opiekey&amp;sektion=1&amp;format=html">opiekey(1)</a>. There are versions of this command for Windows®, Mac OS® and FreeBSD. This command needs the iteration count and the seed as command line options. Use cut-and-paste from the login prompt on the machine being logged in to.</p></div><div class=paragraph><p>On the trusted system:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% opiekey 498 to4268
Using the MD5 algorithm to compute response.
Reminder: Do not use opiekey from telnet or dial-in sessions.
Enter secret pass phrase:
GAME GAG WELT OUT DOWN CHAT</code></pre></div></div><div class=paragraph><p>Once the one-time password is generated, continue to log in.</p></div></div><div class=sect3><h4 id=_generating_multiple_one_time_passwords>13.3.4. Generating Multiple One-time Passwords<a class=anchor href=#_generating_multiple_one_time_passwords></a></h4><div class=paragraph><p>Sometimes there is no access to a trusted machine or secure connection. In this case, it is possible to use <a href="https://man.freebsd.org/cgi/man.cgi?query=opiekey&amp;sektion=1&amp;format=html">opiekey(1)</a> to generate a number of one-time passwords beforehand. For example:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% opiekey <span class=nt>-n</span> 5 30 zz99999
Using the MD5 algorithm to compute response.
Reminder: Do not use opiekey from telnet or dial-in sessions.
Enter secret pass phrase: &lt;secret password&gt;
26: JOAN BORE FOSS DES NAY QUIT
27: LATE BIAS SLAY FOLK MUCH TRIG
28: SALT TIN ANTI LOON NEAL USE
29: RIO ODIN GO BYE FURY TIC
30: GREW JIVE SAN GIRD BOIL PHI</code></pre></div></div><div class=paragraph><p>The <code>-n 5</code> requests five keys in sequence, and <code>30</code> specifies what the last iteration number should be. Note that these are printed out in <em>reverse</em> order of use. The really paranoid might want to write the results down by hand; otherwise, print the list. Each line shows both the iteration count and the one-time password. Scratch off the passwords as they are used.</p></div></div><div class=sect3><h4 id=_restricting_use_of_unix_passwords>13.3.5. Restricting Use of UNIX® Passwords<a class=anchor href=#_restricting_use_of_unix_passwords></a></h4><div class=paragraph><p>OPIE can restrict the use of UNIX® passwords based on the IP address of a login session. The relevant file is <span class=filename>/etc/opieaccess</span>, which is present by default. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=opieaccess&amp;sektion=5&amp;format=html">opieaccess(5)</a> for more information on this file and which security considerations to be aware of when using it.</p></div><div class=paragraph><p>Here is a sample <span class=filename>opieaccess</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>permit 192.168.0.0 255.255.0.0</pre></div></div><div class=paragraph><p>This line allows users whose IP source address (which is vulnerable to spoofing) matches the specified value and mask, to use UNIX® passwords at any time.</p></div><div class=paragraph><p>If no rules in <span class=filename>opieaccess</span> are matched, the default is to deny non-OPIE logins.</p></div></div></div><div class=sect2><h3 id=tcpwrappers>13.4. TCP Wrapper<a class=anchor href=#tcpwrappers></a></h3><div class=paragraph><p>TCP Wrapper is a host-based access control system which extends the abilities of <a href=./#network-inetd>“The inetd Super-Server”</a>. It can be configured to provide logging support, return messages, and connection restrictions for the server daemons under the control of inetd. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=tcpd&amp;sektion=8&amp;format=html">tcpd(8)</a> for more information about TCP Wrapper and its features.</p></div><div class=paragraph><p>TCP Wrapper should not be considered a replacement for a properly configured firewall. Instead, TCP Wrapper should be used in conjunction with a firewall and other security enhancements in order to provide another layer of protection in the implementation of a security policy.</p></div><div class=sect3><h4 id=_initial_configuration>13.4.1. Initial Configuration<a class=anchor href=#_initial_configuration></a></h4><div class=paragraph><p>To enable TCP Wrapper in FreeBSD, add the following lines to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>inetd_enable=&#34;YES&#34;
inetd_flags=&#34;-Ww&#34;</pre></div></div><div class=paragraph><p>Then, properly configure <span class=filename>/etc/hosts.allow</span>.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Unlike other implementations of TCP Wrapper, the use of <span class=filename>hosts.deny</span> is deprecated in FreeBSD. All configuration options should be placed in <span class=filename>/etc/hosts.allow</span>.</p></div></td></tr></tbody></table></div><div class=paragraph><p>In the simplest configuration, daemon connection policies are set to either permit or block, depending on the options in <span class=filename>/etc/hosts.allow</span>. The default configuration in FreeBSD is to allow all connections to the daemons started with inetd.</p></div><div class=paragraph><p>Basic configuration usually takes the form of <code>daemon : address : action</code>, where <code>daemon</code> is the daemon which inetd started, <code>address</code> is a valid hostname, IP address, or an IPv6 address enclosed in brackets ([ ]), and <code>action</code> is either <code>allow</code> or <code>deny</code>. TCP Wrapper uses a first rule match semantic, meaning that the configuration file is scanned from the beginning for a matching rule. When a match is found, the rule is applied and the search process stops.</p></div><div class=paragraph><p>For example, to allow POP3 connections via the <a class=package href=https://cgit.freebsd.org/ports/tree/mail/qpopper/>mail/qpopper</a> daemon, the following lines should be appended to <span class=filename>hosts.allow</span>:</p></div><div class="literalblock programlisting"><div class=content><pre># This line is required for POP3 connections:
qpopper : ALL : allow</pre></div></div><div class=paragraph><p>Whenever this file is edited, restart inetd:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service inetd restart</span></code></pre></div></div></div><div class=sect3><h4 id=_advanced_configuration>13.4.2. Advanced Configuration<a class=anchor href=#_advanced_configuration></a></h4><div class=paragraph><p>TCP Wrapper provides advanced options to allow more control over the way connections are handled. In some cases, it may be appropriate to return a comment to certain hosts or daemon connections. In other cases, a log entry should be recorded or an email sent to the administrator. Other situations may require the use of a service for local connections only. This is all possible through the use of configuration options known as wildcards, expansion characters, and external command execution.</p></div><div class=paragraph><p>Suppose that a situation occurs where a connection should be denied yet a reason should be sent to the host who attempted to establish that connection. That action is possible with <code>twist</code>. When a connection attempt is made, <code>twist</code> executes a shell command or script. An example exists in <span class=filename>hosts.allow</span>:</p></div><div class="literalblock programlisting"><div class=content><pre># The rest of the daemons are protected.
ALL : ALL \
	: severity auth.info \
	: twist /bin/echo &#34;You are not welcome to use %d from %h.&#34;</pre></div></div><div class=paragraph><p>In this example, the message "You are not allowed to use <em>daemon name</em> from <em>hostname</em>." will be returned for any daemon not configured in <span class=filename>hosts.allow</span>. This is useful for sending a reply back to the connection initiator right after the established connection is dropped. Any message returned <em>must</em> be wrapped in quote (<code>"</code>) characters.</p></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>It may be possible to launch a denial of service attack on the server if an attacker floods these daemons with connection requests.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Another possibility is to use <code>spawn</code>. Like <code>twist</code>, <code>spawn</code> implicitly denies the connection and may be used to run external shell commands or scripts. Unlike <code>twist</code>, <code>spawn</code> will not send a reply back to the host who established the connection. For example, consider the following configuration:</p></div><div class="literalblock programlisting"><div class=content><pre># We do not allow connections from example.com:
ALL : .example.com \
	: spawn (/bin/echo %a from %h attempted to access %d &gt;&gt; \
	  /var/log/connections.log) \
	: deny</pre></div></div><div class=paragraph><p>This will deny all connection attempts from <code>*.example.com</code> and log the hostname, IP address, and the daemon to which access was attempted to <span class=filename>/var/log/connections.log</span>. This example uses the substitution characters <code>%a</code> and <code>%h</code>. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=hosts_access&amp;sektion=5&amp;format=html">hosts_access(5)</a> for the complete list.</p></div><div class=paragraph><p>To match every instance of a daemon, domain, or IP address, use <code>ALL</code>. Another wildcard is <code>PARANOID</code> which may be used to match any host which provides an IP address that may be forged because the IP address differs from its resolved hostname. In this example, all connection requests to Sendmail which have an IP address that varies from its hostname will be denied:</p></div><div class="literalblock programlisting"><div class=content><pre># Block possibly spoofed requests to sendmail:
sendmail : PARANOID : deny</pre></div></div><div class="admonitionblock caution"><table><tbody><tr><td class=icon><i class="fa icon-caution" title=Caution></i></td><td class=content><div class=paragraph><p>Using the <code>PARANOID</code> wildcard will result in denied connections if the client or server has a broken DNS setup.</p></div></td></tr></tbody></table></div><div class=paragraph><p>To learn more about wildcards and their associated functionality, refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=hosts_access&amp;sektion=5&amp;format=html">hosts_access(5)</a>.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>When adding new configuration lines, make sure that any unneeded entries for that daemon are commented out in <span class=filename>hosts.allow</span>.</p></div></td></tr></tbody></table></div></div></div><div class=sect2><h3 id=kerberos5>13.5. Kerberos<a class=anchor href=#kerberos5></a></h3><div class=paragraph><p>Kerberos is a network authentication protocol which was originally created by the Massachusetts Institute of Technology (MIT) as a way to securely provide authentication across a potentially hostile network. The Kerberos protocol uses strong cryptography so that both a client and server can prove their identity without sending any unencrypted secrets over the network. Kerberos can be described as an identity-verifying proxy system and as a trusted third-party authentication system. After a user authenticates with Kerberos, their communications can be encrypted to assure privacy and data integrity.</p></div><div class=paragraph><p>The only function of Kerberos is to provide the secure authentication of users and servers on the network. It does not provide authorization or auditing functions. It is recommended that Kerberos be used with other security methods which provide authorization and audit services.</p></div><div class=paragraph><p>The current version of the protocol is version 5, described in RFC 4120. Several free implementations of this protocol are available, covering a wide range of operating systems. MIT continues to develop their Kerberos package. It is commonly used in the US as a cryptography product, and has historically been subject to US export regulations. In FreeBSD, MITKerberos is available as the <a class=package href=https://cgit.freebsd.org/ports/tree/security/krb5/>security/krb5</a> package or port. The Heimdal Kerberos implementation was explicitly developed outside of the US to avoid export regulations. The Heimdal Kerberos distribution is included in the base FreeBSD installation, and another distribution with more configurable options is available as <a class=package href=https://cgit.freebsd.org/ports/tree/security/heimdal/>security/heimdal</a> in the Ports Collection.</p></div><div class=paragraph><p>In Kerberos users and services are identified as "principals" which are contained within an administrative grouping, called a "realm". A typical user principal would be of the form <code><em>user</em>@<em>REALM</em></code> (realms are traditionally uppercase).</p></div><div class=paragraph><p>This section provides a guide on how to set up Kerberos using the Heimdal distribution included in FreeBSD.</p></div><div class=paragraph><p>For purposes of demonstrating a Kerberos installation, the name spaces will be as follows:</p></div><div class=ulist><ul><li><p>The DNS domain (zone) will be <code>example.org</code>.</p></li><li><p>The Kerberos realm will be <code>EXAMPLE.ORG</code>.</p></li></ul></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Use real domain names when setting up Kerberos, even if it will run internally. This avoids DNS problems and assures inter-operation with other Kerberos realms.</p></div></td></tr></tbody></table></div><div class=sect3><h4 id=_setting_up_a_heimdal_kdc>13.5.1. Setting up a Heimdal KDC<a class=anchor href=#_setting_up_a_heimdal_kdc></a></h4><div class=paragraph><p>The Key Distribution Center (KDC) is the centralized authentication service that Kerberos provides, the "trusted third party" of the system. It is the computer that issues Kerberos tickets, which are used for clients to authenticate to servers. Because the KDC is considered trusted by all other computers in the Kerberos realm, it has heightened security concerns. Direct access to the KDC should be limited.</p></div><div class=paragraph><p>While running a KDC requires few computing resources, a dedicated machine acting only as a KDC is recommended for security reasons.</p></div><div class=paragraph><p>To begin, install the <a class=package href=https://cgit.freebsd.org/ports/tree/security/heimdal/>security/heimdal</a> package as follows:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pkg install heimdal</span></code></pre></div></div><div class=paragraph><p>Next, update <span class=filename>/etc/rc.conf</span> using <code>sysrc</code> as follows:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sysrc kdc_enable=yes</span>
<span class=c># sysrc kadmind_enable=yes</span></code></pre></div></div><div class=paragraph><p>Next, edit <span class=filename>/etc/krb5.conf</span> as follows:</p></div><div class="literalblock programlisting"><div class=content><pre>[libdefaults]
    default_realm = EXAMPLE.ORG
[realms]
    EXAMPLE.ORG = {
	kdc = kerberos.example.org
	admin_server = kerberos.example.org
    }
[domain_realm]
    .example.org = EXAMPLE.ORG</pre></div></div><div class=paragraph><p>In this example, the KDC will use the fully-qualified hostname <code>kerberos.example.org</code>. The hostname of the KDC must be resolvable in the DNS.</p></div><div class=paragraph><p>Kerberos can also use the DNS to locate KDCs, instead of a <code>[realms]</code> section in <span class=filename>/etc/krb5.conf</span>. For large organizations that have their own DNS servers, the above example could be trimmed to:</p></div><div class="literalblock programlisting"><div class=content><pre>[libdefaults]
      default_realm = EXAMPLE.ORG
[domain_realm]
    .example.org = EXAMPLE.ORG</pre></div></div><div class=paragraph><p>With the following lines being included in the <code>example.org</code> zone file:</p></div><div class="literalblock programlisting"><div class=content><pre>_kerberos._udp      IN  SRV     01 00 88 kerberos.example.org.
_kerberos._tcp      IN  SRV     01 00 88 kerberos.example.org.
_kpasswd._udp       IN  SRV     01 00 464 kerberos.example.org.
_kerberos-adm._tcp  IN  SRV     01 00 749 kerberos.example.org.
_kerberos           IN  TXT     EXAMPLE.ORG</pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>In order for clients to be able to find the Kerberos services, they <em>must</em> have either a fully configured <span class=filename>/etc/krb5.conf</span> or a minimally configured <span class=filename>/etc/krb5.conf</span><em>and</em> a properly configured DNS server.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Next, create the Kerberos database which contains the keys of all principals (users and hosts) encrypted with a master password. It is not required to remember this password as it will be stored in <span class=filename>/var/heimdal/m-key</span>; it would be reasonable to use a 45-character random password for this purpose. To create the master key, run <code>kstash</code> and enter a password:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># kstash</span>
Master key: xxxxxxxxxxxxxxxxxxxxxxx
Verifying password - Master key: xxxxxxxxxxxxxxxxxxxxxxx</code></pre></div></div><div class=paragraph><p>Once the master key has been created, the database should be initialized. The Kerberos administrative tool <a href="https://man.freebsd.org/cgi/man.cgi?query=kadmin&amp;sektion=8&amp;format=html">kadmin(8)</a> can be used on the KDC in a mode that operates directly on the database, without using the <a href="https://man.freebsd.org/cgi/man.cgi?query=kadmind&amp;sektion=8&amp;format=html">kadmind(8)</a> network service, as <code>kadmin -l</code>. This resolves the chicken-and-egg problem of trying to connect to the database before it is created. At the <code>kadmin</code> prompt, use <code>init</code> to create the realm’s initial database:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># kadmin -l</span>
kadmin&gt; init EXAMPLE.ORG
Realm max ticket life <span class=o>[</span>unlimited]:</code></pre></div></div><div class=paragraph><p>Lastly, while still in <code>kadmin</code>, create the first principal using <code>add</code>. Stick to the default options for the principal for now, as these can be changed later with <code>modify</code>. Type <code>?</code> at the prompt to see the available options.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>kadmin&gt; add tillman
Max ticket life <span class=o>[</span>unlimited]:
Max renewable life <span class=o>[</span>unlimited]:
Principal expiration <span class=nb>time</span> <span class=o>[</span>never]:
Password expiration <span class=nb>time</span> <span class=o>[</span>never]:
Attributes <span class=o>[]</span>:
Password: xxxxxxxx
Verifying password - Password: xxxxxxxx</code></pre></div></div><div class=paragraph><p>Next, start the KDC services by running:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service kdc start</span>
<span class=c># service kadmind start</span></code></pre></div></div><div class=paragraph><p>While there will not be any kerberized daemons running at this point, it is possible to confirm that the KDC is functioning by obtaining a ticket for the principal that was just created:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% kinit tillman
tillman@EXAMPLE.ORG<span class=s1>&#39;s Password:</span></code></pre></div></div><div class=paragraph><p>Confirm that a ticket was successfully obtained using <code>klist</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% klist
Credentials cache: FILE:/tmp/krb5cc_1001
	Principal: tillman@EXAMPLE.ORG

  Issued                Expires               Principal
Aug 27 15:37:58 2013  Aug 28 01:37:58 2013  krbtgt/EXAMPLE.ORG@EXAMPLE.ORG</code></pre></div></div><div class=paragraph><p>The temporary ticket can be destroyed when the test is finished:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% kdestroy</code></pre></div></div></div><div class=sect3><h4 id=_configuring_a_server_to_use_kerberos>13.5.2. Configuring a Server to Use Kerberos<a class=anchor href=#_configuring_a_server_to_use_kerberos></a></h4><div class=paragraph><p>The first step in configuring a server to use Kerberos authentication is to ensure that it has the correct configuration in <span class=filename>/etc/krb5.conf</span>. The version from the KDC can be used as-is, or it can be regenerated on the new system.</p></div><div class=paragraph><p>Next, create <span class=filename>/etc/krb5.keytab</span> on the server. This is the main part of "Kerberizing" a service - it corresponds to generating a secret shared between the service and the KDC. The secret is a cryptographic key, stored in a "keytab". The keytab contains the server’s host key, which allows it and the KDC to verify each others' identity. It must be transmitted to the server in a secure fashion, as the security of the server can be broken if the key is made public. Typically, the <span class=filename>keytab</span> is generated on an administrator’s trusted machine using <code>kadmin</code>, then securely transferred to the server, e.g., with <a href="https://man.freebsd.org/cgi/man.cgi?query=scp&amp;sektion=1&amp;format=html">scp(1)</a>; it can also be created directly on the server if that is consistent with the desired security policy. It is very important that the keytab is transmitted to the server in a secure fashion: if the key is known by some other party, that party can impersonate any user to the server! Using <code>kadmin</code> on the server directly is convenient, because the entry for the host principal in the KDC database is also created using <code>kadmin</code>.</p></div><div class=paragraph><p>Of course, <code>kadmin</code> is a kerberized service; a Kerberos ticket is needed to authenticate to the network service, but to ensure that the user running <code>kadmin</code> is actually present (and their session has not been hijacked), <code>kadmin</code> will prompt for the password to get a fresh ticket. The principal authenticating to the kadmin service must be permitted to use the <code>kadmin</code> interface, as specified in <span class=filename>/var/heimdal/kadmind.acl</span>. See the section titled "Remote administration" in <code>info heimdal</code> for details on designing access control lists. Instead of enabling remote <code>kadmin</code> access, the administrator could securely connect to the KDC via the local console or <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;format=html">ssh(1)</a>, and perform administration locally using <code>kadmin -l</code>.</p></div><div class=paragraph><p>After installing <span class=filename>/etc/krb5.conf</span>, use <code>add --random-key</code> in <code>kadmin</code>. This adds the server’s host principal to the database, but does not extract a copy of the host principal key to a keytab. To generate the keytab, use <code>ext</code> to extract the server’s host principal key to its own keytab:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># kadmin</span>
kadmin&gt; add <span class=nt>--random-key</span> host/myserver.example.org
Max ticket life <span class=o>[</span>unlimited]:
Max renewable life <span class=o>[</span>unlimited]:
Principal expiration <span class=nb>time</span> <span class=o>[</span>never]:
Password expiration <span class=nb>time</span> <span class=o>[</span>never]:
Attributes <span class=o>[]</span>:
kadmin&gt; ext_keytab host/myserver.example.org
kadmin&gt; <span class=nb>exit</span></code></pre></div></div><div class=paragraph><p>Note that <code>ext_keytab</code> stores the extracted key in <span class=filename>/etc/krb5.keytab</span> by default. This is good when being run on the server being kerberized, but the <code>--keytab <em>path/to/file</em></code> argument should be used when the keytab is being extracted elsewhere:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># kadmin</span>
kadmin&gt; ext_keytab <span class=nt>--keytab</span><span class=o>=</span>/tmp/example.keytab host/myserver.example.org
kadmin&gt; <span class=nb>exit</span></code></pre></div></div><div class=paragraph><p>The keytab can then be securely copied to the server using <a href="https://man.freebsd.org/cgi/man.cgi?query=scp&amp;sektion=1&amp;format=html">scp(1)</a> or a removable media. Be sure to specify a non-default keytab name to avoid inserting unneeded keys into the system’s keytab.</p></div><div class=paragraph><p>At this point, the server can read encrypted messages from the KDC using its shared key, stored in <span class=filename>krb5.keytab</span>. It is now ready for the Kerberos-using services to be enabled. One of the most common such services is <a href="https://man.freebsd.org/cgi/man.cgi?query=sshd&amp;sektion=8&amp;format=html">sshd(8)</a>, which supports Kerberos via the GSS-API. In <span class=filename>/etc/ssh/sshd_config</span>, add the line:</p></div><div class="literalblock programlisting"><div class=content><pre>GSSAPIAuthentication yes</pre></div></div><div class=paragraph><p>After making this change, <a href="https://man.freebsd.org/cgi/man.cgi?query=sshd&amp;sektion=8&amp;format=html">sshd(8)</a> must be restarted for the new configuration to take effect: <code>service sshd restart</code>.</p></div></div><div class=sect3><h4 id=_configuring_a_client_to_use_kerberos>13.5.3. Configuring a Client to Use Kerberos<a class=anchor href=#_configuring_a_client_to_use_kerberos></a></h4><div class=paragraph><p>As it was for the server, the client requires configuration in <span class=filename>/etc/krb5.conf</span>. Copy the file in place (securely) or re-enter it as needed.</p></div><div class=paragraph><p>Test the client by using <code>kinit</code>, <code>klist</code>, and <code>kdestroy</code> from the client to obtain, show, and then delete a ticket for an existing principal. Kerberos applications should also be able to connect to Kerberos enabled servers. If that does not work but obtaining a ticket does, the problem is likely with the server and not with the client or the KDC. In the case of kerberized <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;format=html">ssh(1)</a>, GSS-API is disabled by default, so test using <code>ssh -o GSSAPIAuthentication=yes <em>hostname</em></code>.</p></div><div class=paragraph><p>When testing a Kerberized application, try using a packet sniffer such as <code>tcpdump</code> to confirm that no sensitive information is sent in the clear.</p></div><div class=paragraph><p>Various Kerberos client applications are available. With the advent of a bridge so that applications using SASL for authentication can use GSS-API mechanisms as well, large classes of client applications can use Kerberos for authentication, from Jabber clients to IMAP clients.</p></div><div class=paragraph><p>Users within a realm typically have their Kerberos principal mapped to a local user account. Occasionally, one needs to grant access to a local user account to someone who does not have a matching Kerberos principal. For example, <code>tillman@EXAMPLE.ORG</code> may need access to the local user account <code>webdevelopers</code>. Other principals may also need access to that local account.</p></div><div class=paragraph><p>The <span class=filename>.k5login</span> and <span class=filename>.k5users</span> files, placed in a user’s home directory, can be used to solve this problem. For example, if the following <span class=filename>.k5login</span> is placed in the home directory of <code>webdevelopers</code>, both principals listed will have access to that account without requiring a shared password:</p></div><div class="literalblock programlisting"><div class=content><pre>tillman@example.org
jdoe@example.org</pre></div></div><div class=paragraph><p>Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=ksu&amp;sektion=1&amp;format=html">ksu(1)</a> for more information about <span class=filename>.k5users</span>.</p></div></div><div class=sect3><h4 id=_mit_differences>13.5.4. MIT Differences<a class=anchor href=#_mit_differences></a></h4><div class=paragraph><p>The major difference between the MIT and Heimdal implementations is that <code>kadmin</code> has a different, but equivalent, set of commands and uses a different protocol. If the KDC is MIT, the Heimdal version of <code>kadmin</code> cannot be used to administer the KDC remotely, and vice versa.</p></div><div class=paragraph><p>Client applications may also use slightly different command line options to accomplish the same tasks. Following the instructions at <a href=http://web.mit.edu/Kerberos/www/>http://web.mit.edu/Kerberos/www/</a> is recommended. Be careful of path issues: the MIT port installs into <span class=filename>/usr/local/</span> by default, and the FreeBSD system applications run instead of the MIT versions if <code>PATH</code> lists the system directories first.</p></div><div class=paragraph><p>When using MIT Kerberos as a KDC on FreeBSD, the following edits should also be made to <span class=filename>rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>kdc_program=&#34;/usr/local/sbin/kdc&#34;
kadmind_program=&#34;/usr/local/sbin/kadmind&#34;
kdc_flags=&#34;&#34;
kdc_enable=&#34;YES&#34;
kadmind_enable=&#34;YES&#34;</pre></div></div></div><div class=sect3><h4 id=_kerberos_tips_tricks_and_troubleshooting>13.5.5. Kerberos Tips, Tricks, and Troubleshooting<a class=anchor href=#_kerberos_tips_tricks_and_troubleshooting></a></h4><div class=paragraph><p>When configuring and troubleshooting Kerberos, keep the following points in mind:</p></div><div class=ulist><ul><li><p>When using either Heimdal or MITKerberos from ports, ensure that the <code>PATH</code> lists the port’s versions of the client applications before the system versions.</p></li><li><p>If all the computers in the realm do not have synchronized time settings, authentication may fail. <a href=./#network-ntp>“Clock Synchronization with NTP”</a> describes how to synchronize clocks using NTP.</p></li><li><p>If the hostname is changed, the <code>host/</code> principal must be changed and the keytab updated. This also applies to special keytab entries like the <code>HTTP/</code> principal used for Apache’s <a class=package href=https://cgit.freebsd.org/ports/tree/www/mod_auth_kerb/>www/mod_auth_kerb</a>.</p></li><li><p>All hosts in the realm must be both forward and reverse resolvable in DNS or, at a minimum, exist in <span class=filename>/etc/hosts</span>. CNAMEs will work, but the A and PTR records must be correct and in place. The error message for unresolvable hosts is not intuitive: <code>Kerberos5 refuses authentication because Read req failed: Key table entry not found</code>.</p></li><li><p>Some operating systems that act as clients to the KDC do not set the permissions for <code>ksu</code> to be setuid <code>root</code>. This means that <code>ksu</code> does not work. This is a permissions problem, not a KDC error.</p></li><li><p>With MITKerberos, to allow a principal to have a ticket life longer than the default lifetime of ten hours, use <code>modify_principal</code> at the <a href="https://man.freebsd.org/cgi/man.cgi?query=kadmin&amp;sektion=8&amp;format=html">kadmin(8)</a> prompt to change the <code>maxlife</code> of both the principal in question and the <code>krbtgt</code> principal. The principal can then use <code>kinit -l</code> to request a ticket with a longer lifetime.</p></li><li><p>When running a packet sniffer on the KDC to aid in troubleshooting while running <code>kinit</code> from a workstation, the Ticket Granting Ticket (TGT) is sent immediately, even before the password is typed. This is because the Kerberos server freely transmits a TGT to any unauthorized request. However, every TGT is encrypted in a key derived from the user’s password. When a user types their password, it is not sent to the KDC, it is instead used to decrypt the TGT that <code>kinit</code> already obtained. If the decryption process results in a valid ticket with a valid time stamp, the user has valid Kerberos credentials. These credentials include a session key for establishing secure communications with the Kerberos server in the future, as well as the actual TGT, which is encrypted with the Kerberos server’s own key. This second layer of encryption allows the Kerberos server to verify the authenticity of each TGT.</p></li><li><p>Host principals can have a longer ticket lifetime. If the user principal has a lifetime of a week but the host being connected to has a lifetime of nine hours, the user cache will have an expired host principal and the ticket cache will not work as expected.</p></li><li><p>When setting up <span class=filename>krb5.dict</span> to prevent specific bad passwords from being used as described in <a href="https://man.freebsd.org/cgi/man.cgi?query=kadmind&amp;sektion=8&amp;format=html">kadmind(8)</a>, remember that it only applies to principals that have a password policy assigned to them. The format used in <span class=filename>krb5.dict</span> is one string per line. Creating a symbolic link to <span class=filename>/usr/shared/dict/words</span> might be useful.</p></li></ul></div></div><div class=sect3><h4 id=_mitigating_kerberos_limitations>13.5.6. Mitigating Kerberos Limitations<a class=anchor href=#_mitigating_kerberos_limitations></a></h4><div class=paragraph><p>Since Kerberos is an all or nothing approach, every service enabled on the network must either be modified to work with Kerberos or be otherwise secured against network attacks. This is to prevent user credentials from being stolen and re-used. An example is when Kerberos is enabled on all remote shells but the non-Kerberized POP3 mail server sends passwords in plain text.</p></div><div class=paragraph><p>The KDC is a single point of failure. By design, the KDC must be as secure as its master password database. The KDC should have absolutely no other services running on it and should be physically secure. The danger is high because Kerberos stores all passwords encrypted with the same master key which is stored as a file on the KDC.</p></div><div class=paragraph><p>A compromised master key is not quite as bad as one might fear. The master key is only used to encrypt the Kerberos database and as a seed for the random number generator. As long as access to the KDC is secure, an attacker cannot do much with the master key.</p></div><div class=paragraph><p>If the KDC is unavailable, network services are unusable as authentication cannot be performed. This can be alleviated with a single master KDC and one or more slaves, and with careful implementation of secondary or fall-back authentication using PAM.</p></div><div class=paragraph><p>Kerberos allows users, hosts and services to authenticate between themselves. It does not have a mechanism to authenticate the KDC to the users, hosts, or services. This means that a trojanned <code>kinit</code> could record all user names and passwords. File system integrity checking tools like <a class=package href=https://cgit.freebsd.org/ports/tree/security/tripwire/>security/tripwire</a> can alleviate this.</p></div></div><div class=sect3><h4 id=_resources_and_further_information>13.5.7. Resources and Further Information<a class=anchor href=#_resources_and_further_information></a></h4><div class=ulist><ul><li><p><a href=http://www.faqs.org/faqs/Kerberos-faq/general/preamble.html>The Kerberos FAQ</a></p></li><li><p><a href=http://web.mit.edu/Kerberos/www/dialogue.html>Designing an Authentication System: a Dialog in Four Scenes</a></p></li><li><p><a href=https://www.ietf.org/rfc/rfc4120.txt>RFC 4120, The Kerberos Network Authentication Service (V5)</a></p></li><li><p><a href=http://web.mit.edu/Kerberos/www/>MIT Kerberos home page</a></p></li><li><p><a href=https://github.com/heimdal/heimdal/wiki>Heimdal Kerberos project wiki page</a></p></li></ul></div></div></div><div class=sect2><h3 id=openssl>13.6. OpenSSL<a class=anchor href=#openssl></a></h3><div class=paragraph><p>OpenSSL is an open source implementation of the SSL and TLS protocols. It provides an encryption transport layer on top of the normal communications layer, allowing it to be intertwined with many network applications and services.</p></div><div class=paragraph><p>The version of OpenSSL included in FreeBSD supports the Secure Sockets Layer 3.0 (SSLv3) and Transport Layer Security 1.0/1.1/1.2 (TLSv1/TLSv1.1/TLSv1.2) network security protocols and can be used as a general cryptographic library. In FreeBSD 12.0-RELEASE and above, OpenSSL also supports Transport Layer Security 1.3 (TLSv1.3).</p></div><div class=paragraph><p>OpenSSL is often used to encrypt authentication of mail clients and to secure web based transactions such as credit card payments. Some ports, such as <a class=package href=https://cgit.freebsd.org/ports/tree/www/apache24/>www/apache24</a> and <a class=package href=https://cgit.freebsd.org/ports/tree/databases/postgresql11-server/>databases/postgresql11-server</a>, include a compile option for building with OpenSSL. If selected, the port will add support using OpenSSL from the base system. To instead have the port compile against OpenSSL from the <a class=package href=https://cgit.freebsd.org/ports/tree/security/openssl/>security/openssl</a> port, add the following to <span class=filename>/etc/make.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>DEFAULT_VERSIONS+= ssl=openssl</pre></div></div><div class=paragraph><p>Another common use of OpenSSL is to provide certificates for use with software applications. Certificates can be used to verify the credentials of a company or individual. If a certificate has not been signed by an external <em>Certificate Authority</em> (CA), such as <a href=http://www.verisign.com>http://www.verisign.com</a>, the application that uses the certificate will produce a warning. There is a cost associated with obtaining a signed certificate and using a signed certificate is not mandatory as certificates can be self-signed. However, using an external authority will prevent warnings and can put users at ease.</p></div><div class=paragraph><p>This section demonstrates how to create and use certificates on a FreeBSD system. Refer to <a href=./#ldap-config>“Configuring an LDAP Server”</a> for an example of how to create a CA for signing one’s own certificates.</p></div><div class=paragraph><p>For more information about SSL, read the free <a href=https://www.feistyduck.com/books/openssl-cookbook/>OpenSSL Cookbook</a>.</p></div><div class=sect3><h4 id=_generating_certificates>13.6.1. Generating Certificates<a class=anchor href=#_generating_certificates></a></h4><div class=paragraph><p>To generate a certificate that will be signed by an external CA, issue the following command and input the information requested at the prompts. This input information will be written to the certificate. At the <code>Common Name</code> prompt, input the fully qualified name for the system that will use the certificate. If this name does not match the server, the application verifying the certificate will issue a warning to the user, rendering the verification provided by the certificate as useless.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># openssl req -new -nodes -out req.pem -keyout cert.key -sha256 -newkey rsa:2048</span>
Generating a 2048 bit RSA private key
..................+++
.............................................................+++
writing new private key to <span class=s1>&#39;cert.key&#39;</span>
<span class=nt>-----</span>
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter <span class=s1>&#39;.&#39;</span>, the field will be left blank.
<span class=nt>-----</span>
Country Name <span class=o>(</span>2 letter code<span class=o>)</span> <span class=o>[</span>AU]:US
State or Province Name <span class=o>(</span>full name<span class=o>)</span> <span class=o>[</span>Some-State]:PA
Locality Name <span class=o>(</span>eg, city<span class=o>)</span> <span class=o>[]</span>:Pittsburgh
Organization Name <span class=o>(</span>eg, company<span class=o>)</span> <span class=o>[</span>Internet Widgits Pty Ltd]:My Company
Organizational Unit Name <span class=o>(</span>eg, section<span class=o>)</span> <span class=o>[]</span>:Systems Administrator
Common Name <span class=o>(</span>eg, YOUR name<span class=o>)</span> <span class=o>[]</span>:localhost.example.org
Email Address <span class=o>[]</span>:trhodes@FreeBSD.org

Please enter the following <span class=s1>&#39;extra&#39;</span> attributes
to be sent with your certificate request
A challenge password <span class=o>[]</span>:
An optional company name <span class=o>[]</span>:Another Name</code></pre></div></div><div class=paragraph><p>Other options, such as the expire time and alternate encryption algorithms, are available when creating a certificate. A complete list of options is described in <a href="https://man.freebsd.org/cgi/man.cgi?query=openssl&amp;sektion=1&amp;format=html">openssl(1)</a>.</p></div><div class=paragraph><p>This command will create two files in the current directory. The certificate request, <span class=filename>req.pem</span>, can be sent to a CA who will validate the entered credentials, sign the request, and return the signed certificate. The second file, <span class=filename>cert.key</span>, is the private key for the certificate and should be stored in a secure location. If this falls in the hands of others, it can be used to impersonate the user or the server.</p></div><div class=paragraph><p>Alternately, if a signature from a CA is not required, a self-signed certificate can be created. First, generate the RSA key:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># openssl genrsa -rand -genkey -out cert.key 2048</span>
0 semi-random bytes loaded
Generating RSA private key, 2048 bit long modulus
.............................................+++
.................................................................................................................+++
e is 65537 <span class=o>(</span>0x10001<span class=o>)</span></code></pre></div></div><div class=paragraph><p>Use this key to create a self-signed certificate. Follow the usual prompts for creating a certificate:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># openssl req -new -x509 -days 365 -key cert.key -out cert.crt -sha256</span>
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter <span class=s1>&#39;.&#39;</span>, the field will be left blank.
<span class=nt>-----</span>
Country Name <span class=o>(</span>2 letter code<span class=o>)</span> <span class=o>[</span>AU]:US
State or Province Name <span class=o>(</span>full name<span class=o>)</span> <span class=o>[</span>Some-State]:PA
Locality Name <span class=o>(</span>eg, city<span class=o>)</span> <span class=o>[]</span>:Pittsburgh
Organization Name <span class=o>(</span>eg, company<span class=o>)</span> <span class=o>[</span>Internet Widgits Pty Ltd]:My Company
Organizational Unit Name <span class=o>(</span>eg, section<span class=o>)</span> <span class=o>[]</span>:Systems Administrator
Common Name <span class=o>(</span>e.g. server FQDN or YOUR name<span class=o>)</span> <span class=o>[]</span>:localhost.example.org
Email Address <span class=o>[]</span>:trhodes@FreeBSD.org</code></pre></div></div><div class=paragraph><p>This will create two new files in the current directory: a private key file <span class=filename>cert.key</span>, and the certificate itself, <span class=filename>cert.crt</span>. These should be placed in a directory, preferably under <span class=filename>/etc/ssl/</span>, which is readable only by <code>root</code>. Permissions of <code>0700</code> are appropriate for these files and can be set using <code>chmod</code>.</p></div></div><div class=sect3><h4 id=_using_certificates>13.6.2. Using Certificates<a class=anchor href=#_using_certificates></a></h4><div class=paragraph><p>One use for a certificate is to encrypt connections to the Sendmail mail server in order to prevent the use of clear text authentication.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Some mail clients will display an error if the user has not installed a local copy of the certificate. Refer to the documentation included with the software for more information on certificate installation.</p></div></td></tr></tbody></table></div><div class=paragraph><p>In FreeBSD 10.0-RELEASE and above, it is possible to create a self-signed certificate for Sendmail automatically. To enable this, add the following lines to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>sendmail_enable=&#34;YES&#34;
sendmail_cert_create=&#34;YES&#34;
sendmail_cert_cn=&#34;localhost.example.org&#34;</pre></div></div><div class=paragraph><p>This will automatically create a self-signed certificate, <span class=filename>/etc/mail/certs/host.cert</span>, a signing key, <span class=filename>/etc/mail/certs/host.key</span>, and a CA certificate, <span class=filename>/etc/mail/certs/cacert.pem</span>. The certificate will use the <code>Common Name</code> specified in <code>sendmail_cert_cn</code>. After saving the edits, restart Sendmail:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service sendmail restart</span></code></pre></div></div><div class=paragraph><p>If all went well, there will be no error messages in <span class=filename>/var/log/maillog</span>. For a simple test, connect to the mail server’s listening port using <code>telnet</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># telnet example.com 25</span>
Trying 192.0.34.166...
Connected to example.com.
Escape character is <span class=s1>&#39;^]&#39;</span><span class=nb>.</span>
220 example.com ESMTP Sendmail 8.14.7/8.14.7<span class=p>;</span> Fri, 18 Apr 2014 11:50:32 <span class=nt>-0400</span> <span class=o>(</span>EDT<span class=o>)</span>
ehlo example.com
250-example.com Hello example.com <span class=o>[</span>192.0.34.166], pleased to meet you
250-ENHANCEDSTATUSCODES
250-PIPELINING
250-8BITMIME
250-SIZE
250-DSN
250-ETRN
250-AUTH LOGIN PLAIN
250-STARTTLS
250-DELIVERBY
250 HELP
quit
221 2.0.0 example.com closing connection
Connection closed by foreign host.</code></pre></div></div><div class=paragraph><p>If the <code>STARTTLS</code> line appears in the output, everything is working correctly.</p></div></div></div><div class=sect2><h3 id=ipsec>13.7. VPN over IPsec<a class=anchor href=#ipsec></a></h3><div class=paragraph><p>Internet Protocol Security (IPsec) is a set of protocols which sit on top of the Internet Protocol (IP) layer. It allows two or more hosts to communicate in a secure manner by authenticating and encrypting each IP packet of a communication session. The FreeBSD IPsec network stack is based on the <a href=http://www.kame.net/>http://www.kame.net/</a> implementation and supports both IPv4 and IPv6 sessions.</p></div><div class=paragraph><p>IPsec is comprised of the following sub-protocols:</p></div><div class=ulist><ul><li><p><em>Encapsulated Security Payload (ESP)</em>: this protocol protects the IP packet data from third party interference by encrypting the contents using symmetric cryptography algorithms such as Blowfish and 3DES.</p></li><li><p><em>Authentication Header (AH)</em>: this protocol protects the IP packet header from third party interference and spoofing by computing a cryptographic checksum and hashing the IP packet header fields with a secure hashing function. This is then followed by an additional header that contains the hash, to allow the information in the packet to be authenticated.</p></li><li><p><em>IP Payload Compression Protocol (IPComp</em>): this protocol tries to increase communication performance by compressing the IP payload in order to reduce the amount of data sent.</p></li></ul></div><div class=paragraph><p>These protocols can either be used together or separately, depending on the environment.</p></div><div class=paragraph><p>IPsec supports two modes of operation. The first mode, <em>Transport Mode</em>, protects communications between two hosts. The second mode, <em>Tunnel Mode</em>, is used to build virtual tunnels, commonly known as Virtual Private Networks (VPNs). Consult <a href="https://man.freebsd.org/cgi/man.cgi?query=ipsec&amp;sektion=4&amp;format=html">ipsec(4)</a> for detailed information on the IPsec subsystem in FreeBSD.</p></div><div class=paragraph><p>IPsec support is enabled by default on FreeBSD 11 and later. For previous versions of FreeBSD, add these options to a custom kernel configuration file and rebuild the kernel using the instructions in <a href=./#kernelconfig>Configuring the FreeBSD Kernel</a>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>options   IPSEC        IP security
device    crypto</code></pre></div></div><div class=paragraph><p>If IPsec debugging support is desired, the following kernel option should also be added:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>options   IPSEC_DEBUG  debug <span class=k>for </span>IP security</code></pre></div></div><div class=paragraph><p>This rest of this chapter demonstrates the process of setting up an IPsecVPN between a home network and a corporate network. In the example scenario:</p></div><div class=ulist><ul><li><p>Both sites are connected to the Internet through a gateway that is running FreeBSD.</p></li><li><p>The gateway on each network has at least one external IP address. In this example, the corporate LAN’s external IP address is <code>172.16.5.4</code> and the home LAN’s external IP address is <code>192.168.1.12</code>.</p></li><li><p>The internal addresses of the two networks can be either public or private IP addresses. However, the address space must not collide. For example, both networks cannot use <code>192.168.1.x</code>. In this example, the corporate LAN’s internal IP address is <code>10.246.38.1</code> and the home LAN’s internal IP address is <code>10.0.0.5</code>.</p></li></ul></div><div class=sect3><h4 id=_configuring_a_vpn_on_freebsd>13.7.1. Configuring a VPN on FreeBSD<a class=anchor href=#_configuring_a_vpn_on_freebsd></a></h4><div class=paragraph><p>To begin, <a class=package href=https://cgit.freebsd.org/ports/tree/security/ipsec-tools/>security/ipsec-tools</a> must be installed from the Ports Collection. This software provides a number of applications which support the configuration.</p></div><div class=paragraph><p>The next requirement is to create two <a href="https://man.freebsd.org/cgi/man.cgi?query=gif&amp;sektion=4&amp;format=html">gif(4)</a> pseudo-devices which will be used to tunnel packets and allow both networks to communicate properly. As <code>root</code>, run the following commands, replacing <em>internal</em> and <em>external</em> with the real IP addresses of the internal and external interfaces of the two gateways:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig gif0 create</span>
<span class=c># ifconfig gif0 internal1 internal2</span>
<span class=c># ifconfig gif0 tunnel external1 external2</span></code></pre></div></div><div class=paragraph><p>Verify the setup on each gateway, using <code>ifconfig</code>. Here is the output from Gateway 1:</p></div><div class="literalblock programlisting"><div class=content><pre>gif0: flags=8051 mtu 1280
tunnel inet 172.16.5.4 --&gt; 192.168.1.12
inet6 fe80::2e0:81ff:fe02:5881%gif0 prefixlen 64 scopeid 0x6
inet 10.246.38.1 --&gt; 10.0.0.5 netmask 0xffffff00</pre></div></div><div class=paragraph><p>Here is the output from Gateway 2:</p></div><div class="literalblock programlisting"><div class=content><pre>gif0: flags=8051 mtu 1280
tunnel inet 192.168.1.12 --&gt; 172.16.5.4
inet 10.0.0.5 --&gt; 10.246.38.1 netmask 0xffffff00
inet6 fe80::250:bfff:fe3a:c1f%gif0 prefixlen 64 scopeid 0x4</pre></div></div><div class=paragraph><p>Once complete, both internal IP addresses should be reachable using <a href="https://man.freebsd.org/cgi/man.cgi?query=ping&amp;sektion=8&amp;format=html">ping(8)</a>:</p></div><div class="literalblock programlisting"><div class=content><pre>priv-net# ping 10.0.0.5
PING 10.0.0.5 (10.0.0.5): 56 data bytes
64 bytes from 10.0.0.5: icmp_seq=0 ttl=64 time=42.786 ms
64 bytes from 10.0.0.5: icmp_seq=1 ttl=64 time=19.255 ms
64 bytes from 10.0.0.5: icmp_seq=2 ttl=64 time=20.440 ms
64 bytes from 10.0.0.5: icmp_seq=3 ttl=64 time=21.036 ms
--- 10.0.0.5 ping statistics ---
4 packets transmitted, 4 packets received, 0% packet loss
round-trip min/avg/max/stddev = 19.255/25.879/42.786/9.782 ms

corp-net# ping 10.246.38.1
PING 10.246.38.1 (10.246.38.1): 56 data bytes
64 bytes from 10.246.38.1: icmp_seq=0 ttl=64 time=28.106 ms
64 bytes from 10.246.38.1: icmp_seq=1 ttl=64 time=42.917 ms
64 bytes from 10.246.38.1: icmp_seq=2 ttl=64 time=127.525 ms
64 bytes from 10.246.38.1: icmp_seq=3 ttl=64 time=119.896 ms
64 bytes from 10.246.38.1: icmp_seq=4 ttl=64 time=154.524 ms
--- 10.246.38.1 ping statistics ---
5 packets transmitted, 5 packets received, 0% packet loss
round-trip min/avg/max/stddev = 28.106/94.594/154.524/49.814 ms</pre></div></div><div class=paragraph><p>As expected, both sides have the ability to send and receive ICMP packets from the privately configured addresses. Next, both gateways must be told how to route packets in order to correctly send traffic from either network. The following commands will achieve this goal:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>corp-net# route add 10.0.0.0 10.0.0.5 255.255.255.0
corp-net# route add net 10.0.0.0: gateway 10.0.0.5
priv-net# route add 10.246.38.0 10.246.38.1 255.255.255.0
priv-net# route add host 10.246.38.0: gateway 10.246.38.1</code></pre></div></div><div class=paragraph><p>At this point, internal machines should be reachable from each gateway as well as from machines behind the gateways. Again, use <a href="https://man.freebsd.org/cgi/man.cgi?query=ping&amp;sektion=8&amp;format=html">ping(8)</a> to confirm:</p></div><div class="literalblock programlisting"><div class=content><pre>corp-net# ping 10.0.0.8
PING 10.0.0.8 (10.0.0.8): 56 data bytes
64 bytes from 10.0.0.8: icmp_seq=0 ttl=63 time=92.391 ms
64 bytes from 10.0.0.8: icmp_seq=1 ttl=63 time=21.870 ms
64 bytes from 10.0.0.8: icmp_seq=2 ttl=63 time=198.022 ms
64 bytes from 10.0.0.8: icmp_seq=3 ttl=63 time=22.241 ms
64 bytes from 10.0.0.8: icmp_seq=4 ttl=63 time=174.705 ms
--- 10.0.0.8 ping statistics ---
5 packets transmitted, 5 packets received, 0% packet loss
round-trip min/avg/max/stddev = 21.870/101.846/198.022/74.001 ms

priv-net# ping 10.246.38.107
PING 10.246.38.1 (10.246.38.107): 56 data bytes
64 bytes from 10.246.38.107: icmp_seq=0 ttl=64 time=53.491 ms
64 bytes from 10.246.38.107: icmp_seq=1 ttl=64 time=23.395 ms
64 bytes from 10.246.38.107: icmp_seq=2 ttl=64 time=23.865 ms
64 bytes from 10.246.38.107: icmp_seq=3 ttl=64 time=21.145 ms
64 bytes from 10.246.38.107: icmp_seq=4 ttl=64 time=36.708 ms
--- 10.246.38.107 ping statistics ---
5 packets transmitted, 5 packets received, 0% packet loss
round-trip min/avg/max/stddev = 21.145/31.721/53.491/12.179 ms</pre></div></div><div class=paragraph><p>Setting up the tunnels is the easy part. Configuring a secure link is a more in depth process. The following configuration uses pre-shared (PSK) RSA keys. Other than the IP addresses, the <span class=filename>/usr/local/etc/racoon/racoon.conf</span> on both gateways will be identical and look similar to:</p></div><div class="literalblock programlisting"><div class=content><pre>path    pre_shared_key  &#34;/usr/local/etc/racoon/psk.txt&#34;; #location of pre-shared key file
log     debug;	#log verbosity setting: set to &#39;notify&#39; when testing and debugging is complete

padding	# options are not to be changed
{
        maximum_length  20;
        randomize       off;
        strict_check    off;
        exclusive_tail  off;
}

timer	# timing options. change as needed
{
        counter         5;
        interval        20 sec;
        persend         1;
#       natt_keepalive  15 sec;
        phase1          30 sec;
        phase2          15 sec;
}

listen	# address [port] that racoon will listen on
{
        isakmp          172.16.5.4 [500];
        isakmp_natt     172.16.5.4 [4500];
}

remote  192.168.1.12 [500]
{
        exchange_mode   main,aggressive;
        doi             ipsec_doi;
        situation       identity_only;
        my_identifier   address 172.16.5.4;
        peers_identifier        address 192.168.1.12;
        lifetime        time 8 hour;
        passive         off;
        proposal_check  obey;
#       nat_traversal   off;
        generate_policy off;

                        proposal {
                                encryption_algorithm    blowfish;
                                hash_algorithm          md5;
                                authentication_method   pre_shared_key;
                                lifetime time           30 sec;
                                dh_group                1;
                        }
}

sainfo  (address 10.246.38.0/24 any address 10.0.0.0/24 any)	# address $network/$netmask $type address $network/$netmask $type ( $type being any or esp)
{								# $network must be the two internal networks you are joining.
        pfs_group       1;
        lifetime        time    36000 sec;
        encryption_algorithm    blowfish,3des;
        authentication_algorithm        hmac_md5,hmac_sha1;
        compression_algorithm   deflate;
}</pre></div></div><div class=paragraph><p>For descriptions of each available option, refer to the manual page for <span class=filename>racoon.conf</span>.</p></div><div class=paragraph><p>The Security Policy Database (SPD) needs to be configured so that FreeBSD and racoon are able to encrypt and decrypt network traffic between the hosts.</p></div><div class=paragraph><p>This can be achieved with a shell script, similar to the following, on the corporate gateway. This file will be used during system initialization and should be saved as <span class=filename>/usr/local/etc/racoon/setkey.conf</span>.</p></div><div class="literalblock programlisting"><div class=content><pre>flush;
spdflush;
# To the home network
spdadd 10.246.38.0/24 10.0.0.0/24 any -P out ipsec esp/tunnel/172.16.5.4-192.168.1.12/use;
spdadd 10.0.0.0/24 10.246.38.0/24 any -P in ipsec esp/tunnel/192.168.1.12-172.16.5.4/use;</pre></div></div><div class=paragraph><p>Once in place, racoon may be started on both gateways using the following command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># /usr/local/sbin/racoon -F -f /usr/local/etc/racoon/racoon.conf -l /var/log/racoon.log</span></code></pre></div></div><div class=paragraph><p>The output should be similar to the following:</p></div><div class="literalblock programlisting"><div class=content><pre>corp-net# /usr/local/sbin/racoon -F -f /usr/local/etc/racoon/racoon.conf
Foreground mode.
2006-01-30 01:35:47: INFO: begin Identity Protection mode.
2006-01-30 01:35:48: INFO: received Vendor ID: KAME/racoon
2006-01-30 01:35:55: INFO: received Vendor ID: KAME/racoon
2006-01-30 01:36:04: INFO: ISAKMP-SA established 172.16.5.4[500]-192.168.1.12[500] spi:623b9b3bd2492452:7deab82d54ff704a
2006-01-30 01:36:05: INFO: initiate new phase 2 negotiation: 172.16.5.4[0]192.168.1.12[0]
2006-01-30 01:36:09: INFO: IPsec-SA established: ESP/Tunnel 192.168.1.12[0]-&gt;172.16.5.4[0] spi=28496098(0x1b2d0e2)
2006-01-30 01:36:09: INFO: IPsec-SA established: ESP/Tunnel 172.16.5.4[0]-&gt;192.168.1.12[0] spi=47784998(0x2d92426)
2006-01-30 01:36:13: INFO: respond new phase 2 negotiation: 172.16.5.4[0]192.168.1.12[0]
2006-01-30 01:36:18: INFO: IPsec-SA established: ESP/Tunnel 192.168.1.12[0]-&gt;172.16.5.4[0] spi=124397467(0x76a279b)
2006-01-30 01:36:18: INFO: IPsec-SA established: ESP/Tunnel 172.16.5.4[0]-&gt;192.168.1.12[0] spi=175852902(0xa7b4d66)</pre></div></div><div class=paragraph><p>To ensure the tunnel is working properly, switch to another console and use <a href="https://man.freebsd.org/cgi/man.cgi?query=tcpdump&amp;sektion=1&amp;format=html">tcpdump(1)</a> to view network traffic using the following command. Replace <code>em0</code> with the network interface card as required:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># tcpdump -i em0 host 172.16.5.4 and dst 192.168.1.12</span></code></pre></div></div><div class=paragraph><p>Data similar to the following should appear on the console. If not, there is an issue and debugging the returned data will be required.</p></div><div class="literalblock programlisting"><div class=content><pre>01:47:32.021683 IP corporatenetwork.com &gt; 192.168.1.12.privatenetwork.com: ESP(spi=0x02acbf9f,seq=0xa)
01:47:33.022442 IP corporatenetwork.com &gt; 192.168.1.12.privatenetwork.com: ESP(spi=0x02acbf9f,seq=0xb)
01:47:34.024218 IP corporatenetwork.com &gt; 192.168.1.12.privatenetwork.com: ESP(spi=0x02acbf9f,seq=0xc)</pre></div></div><div class=paragraph><p>At this point, both networks should be available and seem to be part of the same network. Most likely both networks are protected by a firewall. To allow traffic to flow between them, rules need to be added to pass packets. For the <a href="https://man.freebsd.org/cgi/man.cgi?query=ipfw&amp;sektion=8&amp;format=html">ipfw(8)</a> firewall, add the following lines to the firewall configuration file:</p></div><div class="literalblock programlisting"><div class=content><pre>ipfw add 00201 allow log esp from any to any
ipfw add 00202 allow log ah from any to any
ipfw add 00203 allow log ipencap from any to any
ipfw add 00204 allow log udp from any 500 to any</pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>The rule numbers may need to be altered depending on the current host configuration.</p></div></td></tr></tbody></table></div><div class=paragraph><p>For users of <a href="https://man.freebsd.org/cgi/man.cgi?query=pf&amp;sektion=4&amp;format=html">pf(4)</a> or <a href="https://man.freebsd.org/cgi/man.cgi?query=ipf&amp;sektion=8&amp;format=html">ipf(8)</a>, the following rules should do the trick:</p></div><div class="literalblock programlisting"><div class=content><pre>pass in quick proto esp from any to any
pass in quick proto ah from any to any
pass in quick proto ipencap from any to any
pass in quick proto udp from any port = 500 to any port = 500
pass in quick on gif0 from any to any
pass out quick proto esp from any to any
pass out quick proto ah from any to any
pass out quick proto ipencap from any to any
pass out quick proto udp from any port = 500 to any port = 500
pass out quick on gif0 from any to any</pre></div></div><div class=paragraph><p>Finally, to allow the machine to start support for the VPN during system initialization, add the following lines to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>ipsec_enable=&#34;YES&#34;
ipsec_program=&#34;/usr/local/sbin/setkey&#34;
ipsec_file=&#34;/usr/local/etc/racoon/setkey.conf&#34; # allows setting up spd policies on boot
racoon_enable=&#34;yes&#34;</pre></div></div></div></div><div class=sect2><h3 id=openssh>13.8. OpenSSH<a class=anchor href=#openssh></a></h3><div class=paragraph><p>OpenSSH is a set of network connectivity tools used to provide secure access to remote machines. Additionally, TCP/IP connections can be tunneled or forwarded securely through SSH connections. OpenSSH encrypts all traffic to effectively eliminate eavesdropping, connection hijacking, and other network-level attacks.</p></div><div class=paragraph><p>OpenSSH is maintained by the OpenBSD project and is installed by default in FreeBSD. It is compatible with both SSH version 1 and 2 protocols.</p></div><div class=paragraph><p>When data is sent over the network in an unencrypted form, network sniffers anywhere in between the client and server can steal user/password information or data transferred during the session. OpenSSH offers a variety of authentication and encryption methods to prevent this from happening. More information about OpenSSH is available from <a href=http://www.openssh.com/>http://www.openssh.com/</a>.</p></div><div class=paragraph><p>This section provides an overview of the built-in client utilities to securely access other systems and securely transfer files from a FreeBSD system. It then describes how to configure a SSH server on a FreeBSD system. More information is available in the man pages mentioned in this chapter.</p></div><div class=sect3><h4 id=_using_the_ssh_client_utilities>13.8.1. Using the SSH Client Utilities<a class=anchor href=#_using_the_ssh_client_utilities></a></h4><div class=paragraph><p>To log into a SSH server, use <code>ssh</code> and specify a username that exists on that server and the IP address or hostname of the server. If this is the first time a connection has been made to the specified server, the user will be prompted to first verify the server’s fingerprint:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ssh user@example.com</span>
The authenticity of host <span class=s1>&#39;example.com (10.0.0.1)&#39;</span> can<span class=s1>&#39;t be established.
ECDSA key fingerprint is 25:cc:73:b5:b3:96:75:3d:56:19:49:d2:5c:1f:91:3b.
Are you sure you want to continue connecting (yes/no)? yes
Permanently added &#39;</span>example.com<span class=s1>&#39; (ECDSA) to the list of known hosts.
Password for user@example.com: user_password</span></code></pre></div></div><div class=paragraph><p>SSH utilizes a key fingerprint system to verify the authenticity of the server when the client connects. When the user accepts the key’s fingerprint by typing <code>yes</code> when connecting for the first time, a copy of the key is saved to <span class=filename>.ssh/known_hosts</span> in the user’s home directory. Future attempts to login are verified against the saved key and <code>ssh</code> will display an alert if the server’s key does not match the saved key. If this occurs, the user should first verify why the key has changed before continuing with the connection.</p></div><div class=paragraph><p>By default, recent versions of OpenSSH only accept SSHv2 connections. By default, the client will use version 2 if possible and will fall back to version 1 if the server does not support version 2. To force <code>ssh</code> to only use the specified protocol, include <code>-1</code> or <code>-2</code>. Additional options are described in <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;format=html">ssh(1)</a>.</p></div><div class=paragraph><p>Use <a href="https://man.freebsd.org/cgi/man.cgi?query=scp&amp;sektion=1&amp;format=html">scp(1)</a> to securely copy a file to or from a remote machine. This example copies <span class=filename>COPYRIGHT</span> on the remote system to a file of the same name in the current directory of the local system:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># scp user@example.com:/COPYRIGHT COPYRIGHT</span>
Password <span class=k>for </span>user@example.com: <span class=k>*******</span>
COPYRIGHT            100% |<span class=k>*****************************</span>|  4735
00:00
<span class=c>#</span></code></pre></div></div><div class=paragraph><p>Since the fingerprint was already verified for this host, the server’s key is automatically checked before prompting for the user’s password.</p></div><div class=paragraph><p>The arguments passed to <code>scp</code> are similar to <code>cp</code>. The file or files to copy is the first argument and the destination to copy to is the second. Since the file is fetched over the network, one or more of the file arguments takes the form <code>user@host:&lt;path_to_remote_file></code>. Be aware when copying directories recursively that <code>scp</code> uses <code>-r</code>, whereas <code>cp</code> uses <code>-R</code>.</p></div><div class=paragraph><p>To open an interactive session for copying files, use <code>sftp</code>. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=sftp&amp;sektion=1&amp;format=html">sftp(1)</a> for a list of available commands while in an <code>sftp</code> session.</p></div><div class=sect4><h5 id=security-ssh-keygen>13.8.1.1. Key-based Authentication<a class=anchor href=#security-ssh-keygen></a></h5><div class=paragraph><p>Instead of using passwords, a client can be configured to connect to the remote machine using keys. To generate RSA authentication keys, use <code>ssh-keygen</code>. To generate a public and private key pair, specify the type of key and follow the prompts. It is recommended to protect the keys with a memorable, but hard to guess passphrase.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% ssh-keygen <span class=nt>-t</span> rsa
Generating public/private rsa key pair.
Enter file <span class=k>in </span>which to save the key <span class=o>(</span>/home/user/.ssh/id_rsa<span class=o>)</span>:
Enter passphrase <span class=o>(</span>empty <span class=k>for </span>no passphrase<span class=o>)</span>:  <i class=conum data-value=1></i><b>(1)</b>
Enter same passphrase again:                 <i class=conum data-value=2></i><b>(2)</b>
Your identification has been saved <span class=k>in</span> /home/user/.ssh/id_rsa.
Your public key has been saved <span class=k>in</span> /home/user/.ssh/id_rsa.pub.
The key fingerprint is:
SHA256:54Xm9Uvtv6H4NOo6yjP/YCfODryvUU7yWHzMqeXwhq8 user@host.example.com
The key<span class=s1>&#39;s randomart image is:
+---[RSA 2048]----+
|                 |
|                 |
|                 |
|        . o..    |
|       .S*+*o    |
|      . O=Oo . . |
|       = Oo= oo..|
|      .oB.* +.oo.|
|       =OE**.o..=|
+----[SHA256]-----+</span></code></pre></div></div><div class="colist arabic"><table><tbody><tr><td><i class=conum data-value=1></i><b>1</b></td><td>Type a passphrase here. It can contain spaces and symbols.</td></tr><tr><td><i class=conum data-value=2></i><b>2</b></td><td>Retype the passphrase to verify it.</td></tr></tbody></table></div><div class=paragraph><p>The private key is stored in <span class=filename>~/.ssh/id_rsa</span> and the public key is stored in <span class=filename>~/.ssh/id_rsa.pub</span>. The <em>public</em> key must be copied to <span class=filename>~/.ssh/authorized_keys</span> on the remote machine for key-based authentication to work.</p></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>Many users believe that keys are secure by design and will use a key without a passphrase. This is <em>dangerous</em> behavior. An administrator can verify that a key pair is protected by a passphrase by viewing the private key manually. If the private key file contains the word <code>ENCRYPTED</code>, the key owner is using a passphrase. In addition, to better secure end users, <code>from</code> may be placed in the public key file. For example, adding <code>from="192.168.10.5"</code> in front of the <code>ssh-rsa</code> prefix will only allow that specific user to log in from that IP address.</p></div></td></tr></tbody></table></div><div class=paragraph><p>The options and files vary with different versions of OpenSSH. To avoid problems, consult <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh-keygen&amp;sektion=1&amp;format=html">ssh-keygen(1)</a>.</p></div><div class=paragraph><p>If a passphrase is used, the user is prompted for the passphrase each time a connection is made to the server. To load SSH keys into memory and remove the need to type the passphrase each time, use <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh-agent&amp;sektion=1&amp;format=html">ssh-agent(1)</a> and <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh-add&amp;sektion=1&amp;format=html">ssh-add(1)</a>.</p></div><div class=paragraph><p>Authentication is handled by <code>ssh-agent</code>, using the private keys that are loaded into it. <code>ssh-agent</code> can be used to launch another application like a shell or a window manager.</p></div><div class=paragraph><p>To use <code>ssh-agent</code> in a shell, start it with a shell as an argument. Add the identity by running <code>ssh-add</code> and entering the passphrase for the private key. The user will then be able to <code>ssh</code> to any host that has the corresponding public key installed. For example:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% ssh-agent csh
% ssh-add
Enter passphrase <span class=k>for </span>key <span class=s1>&#39;/usr/home/user/.ssh/id_rsa&#39;</span>:  <i class=conum data-value=1></i><b>(1)</b>
Identity added: /usr/home/user/.ssh/id_rsa <span class=o>(</span>/usr/home/user/.ssh/id_rsa<span class=o>)</span>
%</code></pre></div></div><div class="colist arabic"><table><tbody><tr><td><i class=conum data-value=1></i><b>1</b></td><td>Enter the passphrase for the key.</td></tr></tbody></table></div><div class=paragraph><p>To use <code>ssh-agent</code> in Xorg, add an entry for it in <span class=filename>~/.xinitrc</span>. This provides the <code>ssh-agent</code> services to all programs launched in Xorg. An example <span class=filename>~/.xinitrc</span> might look like this:</p></div><div class="literalblock programlisting"><div class=content><pre>exec ssh-agent startxfce4</pre></div></div><div class=paragraph><p>This launches <code>ssh-agent</code>, which in turn launches XFCE, every time Xorg starts. Once Xorg has been restarted so that the changes can take effect, run <code>ssh-add</code> to load all of the SSH keys.</p></div></div><div class=sect4><h5 id=security-ssh-tunneling>13.8.1.2. SSH Tunneling<a class=anchor href=#security-ssh-tunneling></a></h5><div class=paragraph><p>OpenSSH has the ability to create a tunnel to encapsulate another protocol in an encrypted session.</p></div><div class=paragraph><p>The following command tells <code>ssh</code> to create a tunnel for telnet:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% ssh <span class=nt>-2</span> <span class=nt>-N</span> <span class=nt>-f</span> <span class=nt>-L</span> 5023:localhost:23 user@foo.example.com
%</code></pre></div></div><div class=paragraph><p>This example uses the following options:</p></div><div class=dlist><dl><dt class=hdlist1><code>-2</code></dt><dd><p>Forces <code>ssh</code> to use version 2 to connect to the server.</p></dd><dt class=hdlist1><code>-N</code></dt><dd><p>Indicates no command, or tunnel only. If omitted, <code>ssh</code> initiates a normal session.</p></dd><dt class=hdlist1><code>-f</code></dt><dd><p>Forces <code>ssh</code> to run in the background.</p></dd><dt class=hdlist1><code>-L</code></dt><dd><p>Indicates a local tunnel in <em>localport:remotehost:remoteport</em> format.</p></dd><dt class=hdlist1><code>user@foo.example.com</code></dt><dd><p>The login name to use on the specified remote SSH server.</p></dd></dl></div><div class=paragraph><p>An SSH tunnel works by creating a listen socket on <code>localhost</code> on the specified <code>localport</code>. It then forwards any connections received on <code>localport</code> via the SSH connection to the specified <code>remotehost:remoteport</code>. In the example, port <code>5023</code> on the client is forwarded to port <code>23</code> on the remote machine. Since port 23 is used by telnet, this creates an encrypted telnet session through an SSH tunnel.</p></div><div class=paragraph><p>This method can be used to wrap any number of insecure TCP protocols such as SMTP, POP3, and FTP, as seen in the following examples.</p></div><div class=exampleblock><div class=title>Przykład 11. Create a Secure Tunnel for SMTP</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% ssh <span class=nt>-2</span> <span class=nt>-N</span> <span class=nt>-f</span> <span class=nt>-L</span> 5025:localhost:25 user@mailserver.example.com
user@mailserver.example.com<span class=s1>&#39;s password: *****
% telnet localhost 5025
Trying 127.0.0.1...
Connected to localhost.
Escape character is &#39;</span>^]<span class=s1>&#39;.
220 mailserver.example.com ESMTP</span></code></pre></div></div><div class=paragraph><p>This can be used in conjunction with <code>ssh-keygen</code> and additional user accounts to create a more seamless SSH tunneling environment. Keys can be used in place of typing a password, and the tunnels can be run as a separate user.</p></div></div></div><div class=exampleblock><div class=title>Przykład 12. Secure Access of a POP3 Server</div><div class=content><div class=paragraph><p>In this example, there is an SSH server that accepts connections from the outside. On the same network resides a mail server running a POP3 server. To check email in a secure manner, create an SSH connection to the SSH server and tunnel through to the mail server:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% ssh <span class=nt>-2</span> <span class=nt>-N</span> <span class=nt>-f</span> <span class=nt>-L</span> 2110:mail.example.com:110 user@ssh-server.example.com
user@ssh-server.example.com<span class=s1>&#39;s password: ******</span></code></pre></div></div><div class=paragraph><p>Once the tunnel is up and running, point the email client to send POP3 requests to <code>localhost</code> on port 2110. This connection will be forwarded securely across the tunnel to <code>mail.example.com</code>.</p></div></div></div><div class=exampleblock><div class=title>Przykład 13. Bypassing a Firewall</div><div class=content><div class=paragraph><p>Some firewalls filter both incoming and outgoing connections. For example, a firewall might limit access from remote machines to ports 22 and 80 to only allow SSH and web surfing. This prevents access to any other service which uses a port other than 22 or 80.</p></div><div class=paragraph><p>The solution is to create an SSH connection to a machine outside of the network’s firewall and use it to tunnel to the desired service:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% ssh <span class=nt>-2</span> <span class=nt>-N</span> <span class=nt>-f</span> <span class=nt>-L</span> 8888:music.example.com:8000 user@unfirewalled-system.example.org
user@unfirewalled-system.example.org<span class=s1>&#39;s password: *******</span></code></pre></div></div><div class=paragraph><p>In this example, a streaming Ogg Vorbis client can now be pointed to <code>localhost</code> port 8888, which will be forwarded over to <code>music.example.com</code> on port 8000, successfully bypassing the firewall.</p></div></div></div></div></div><div class=sect3><h4 id=_enabling_the_ssh_server>13.8.2. Enabling the SSH Server<a class=anchor href=#_enabling_the_ssh_server></a></h4><div class=paragraph><p>In addition to providing built-in SSH client utilities, a FreeBSD system can be configured as an SSH server, accepting connections from other SSH clients.</p></div><div class=paragraph><p>To see if sshd is operating, use the <a href="https://man.freebsd.org/cgi/man.cgi?query=service&amp;sektion=8&amp;format=html">service(8)</a> command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service sshd status</span></code></pre></div></div><div class=paragraph><p>If the service is not running, add the following line to <span class=filename>/etc/rc.conf</span>.</p></div><div class="literalblock programlisting"><div class=content><pre>sshd_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>This will start sshd, the daemon program for OpenSSH, the next time the system boots. To start it now:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service sshd start</span></code></pre></div></div><div class=paragraph><p>The first time sshd starts on a FreeBSD system, the system’s host keys will be automatically created and the fingerprint will be displayed on the console. Provide users with the fingerprint so that they can verify it the first time they connect to the server.</p></div><div class=paragraph><p>Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=sshd&amp;sektion=8&amp;format=html">sshd(8)</a> for the list of available options when starting sshd and a more complete discussion about authentication, the login process, and the various configuration files.</p></div><div class=paragraph><p>At this point, the sshd should be available to all users with a username and password on the system.</p></div></div><div class=sect3><h4 id=_ssh_server_security>13.8.3. SSH Server Security<a class=anchor href=#_ssh_server_security></a></h4><div class=paragraph><p>While sshd is the most widely used remote administration facility for FreeBSD, brute force and drive by attacks are common to any system exposed to public networks. Several additional parameters are available to prevent the success of these attacks and will be described in this section.</p></div><div class=paragraph><p>It is a good idea to limit which users can log into the SSH server and from where using the <code>AllowUsers</code> keyword in the OpenSSH server configuration file. For example, to only allow <code>root</code> to log in from <code>192.168.1.32</code>, add this line to <span class=filename>/etc/ssh/sshd_config</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>AllowUsers root@192.168.1.32</pre></div></div><div class=paragraph><p>To allow <code>admin</code> to log in from anywhere, list that user without specifying an IP address:</p></div><div class="literalblock programlisting"><div class=content><pre>AllowUsers admin</pre></div></div><div class=paragraph><p>Multiple users should be listed on the same line, like so:</p></div><div class="literalblock programlisting"><div class=content><pre>AllowUsers root@192.168.1.32 admin</pre></div></div><div class=paragraph><p>After making changes to <span class=filename>/etc/ssh/sshd_config</span>, tell sshd to reload its configuration file by running:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service sshd reload</span></code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>When this keyword is used, it is important to list each user that needs to log into this machine. Any user that is not specified in that line will be locked out. Also, the keywords used in the OpenSSH server configuration file are case-sensitive. If the keyword is not spelled correctly, including its case, it will be ignored. Always test changes to this file to make sure that the edits are working as expected. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=sshd_config&amp;sektion=5&amp;format=html">sshd_config(5)</a> to verify the spelling and use of the available keywords.</p></div></td></tr></tbody></table></div><div class=paragraph><p>In addition, users may be forced to use two factor authentication via the use of a public and private key. When required, the user may generate a key pair through the use of <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh-keygen&amp;sektion=1&amp;format=html">ssh-keygen(1)</a> and send the administrator the public key. This key file will be placed in the <span class=filename>authorized_keys</span> as described above in the client section. To force the users to use keys only, the following option may be configured:</p></div><div class="literalblock programlisting"><div class=content><pre>AuthenticationMethods publickey</pre></div></div><div class="admonitionblock tip"><table><tbody><tr><td class=icon><i class="fa icon-tip" title=Tip></i></td><td class=content><div class=paragraph><p>Do not confuse <span class=filename>/etc/ssh/sshd_config</span> with <span class=filename>/etc/ssh/ssh_config</span> (note the extra <code>d</code> in the first filename). The first file configures the server and the second file configures the client. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh_config&amp;sektion=5&amp;format=html">ssh_config(5)</a> for a listing of the available client settings.</p></div></td></tr></tbody></table></div></div></div><div class=sect2><h3 id=fs-acl>13.9. Access Control Lists<a class=anchor href=#fs-acl></a></h3><div class=paragraph><p>Access Control Lists (ACLs) extend the standard UNIX® permission model in a POSIX®.1e compatible way. This permits an administrator to take advantage of a more fine-grained permissions model.</p></div><div class=paragraph><p>The FreeBSD <span class=filename>GENERIC</span> kernel provides ACL support for UFS file systems. Users who prefer to compile a custom kernel must include the following option in their custom kernel configuration file:</p></div><div class="literalblock programlisting"><div class=content><pre>options UFS_ACL</pre></div></div><div class=paragraph><p>If this option is not compiled in, a warning message will be displayed when attempting to mount a file system with ACL support. ACLs rely on extended attributes which are natively supported in UFS2.</p></div><div class=paragraph><p>This chapter describes how to enable ACL support and provides some usage examples.</p></div><div class=sect3><h4 id=_enabling_acl_support>13.9.1. Enabling ACL Support<a class=anchor href=#_enabling_acl_support></a></h4><div class=paragraph><p>ACLs are enabled by the mount-time administrative flag, <code>acls</code>, which may be added to <span class=filename>/etc/fstab</span>. The mount-time flag can also be automatically set in a persistent manner using <a href="https://man.freebsd.org/cgi/man.cgi?query=tunefs&amp;sektion=8&amp;format=html">tunefs(8)</a> to modify a superblock ACLs flag in the file system header. In general, it is preferred to use the superblock flag for several reasons:</p></div><div class=ulist><ul><li><p>The superblock flag cannot be changed by a remount using <code>mount -u</code> as it requires a complete <code>umount</code> and fresh <code>mount</code>. This means that ACLs cannot be enabled on the root file system after boot. It also means that ACL support on a file system cannot be changed while the system is in use.</p></li><li><p>Setting the superblock flag causes the file system to always be mounted with ACLs enabled, even if there is not an <span class=filename>fstab</span> entry or if the devices re-order. This prevents accidental mounting of the file system without ACL support.</p></li></ul></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>It is desirable to discourage accidental mounting without ACLs enabled because nasty things can happen if ACLs are enabled, then disabled, then re-enabled without flushing the extended attributes. In general, once ACLs are enabled on a file system, they should not be disabled, as the resulting file protections may not be compatible with those intended by the users of the system, and re-enabling ACLs may re-attach the previous ACLs to files that have since had their permissions changed, resulting in unpredictable behavior.</p></div></td></tr></tbody></table></div><div class=paragraph><p>File systems with ACLs enabled will show a plus (<code>+</code>) sign in their permission settings:</p></div><div class="literalblock programlisting"><div class=content><pre>drwx------  2 robert  robert  512 Dec 27 11:54 private
drwxrwx---+ 2 robert  robert  512 Dec 23 10:57 directory1
drwxrwx---+ 2 robert  robert  512 Dec 22 10:20 directory2
drwxrwx---+ 2 robert  robert  512 Dec 27 11:57 directory3
drwxr-xr-x  2 robert  robert  512 Nov 10 11:54 public_html</pre></div></div><div class=paragraph><p>In this example, <span class=filename>directory1</span>, <span class=filename>directory2</span>, and <span class=filename>directory3</span> are all taking advantage of ACLs, whereas <span class=filename>public_html</span> is not.</p></div></div><div class=sect3><h4 id=_using_acls>13.9.2. Using ACLs<a class=anchor href=#_using_acls></a></h4><div class=paragraph><p>File system ACLs can be viewed using <code>getfacl</code>. For instance, to view the ACL settings on <span class=filename>test</span>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% getfacl <span class=nb>test</span>
	<span class=c>#file:test</span>
	<span class=c>#owner:1001</span>
	<span class=c>#group:1001</span>
	user::rw-
	group::r--
	other::r--</code></pre></div></div><div class=paragraph><p>To change the ACL settings on this file, use <code>setfacl</code>. To remove all of the currently defined ACLs from a file or file system, include <code>-k</code>. However, the preferred method is to use <code>-b</code> as it leaves the basic fields required for ACLs to work.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% setfacl <span class=nt>-k</span> <span class=nb>test</span></code></pre></div></div><div class=paragraph><p>To modify the default ACL entries, use <code>-m</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% setfacl <span class=nt>-m</span> u:trhodes:rwx,group:web:r--,o::--- <span class=nb>test</span></code></pre></div></div><div class=paragraph><p>In this example, there were no pre-defined entries, as they were removed by the previous command. This command restores the default options and assigns the options listed. If a user or group is added which does not exist on the system, an <code>Invalid argument</code> error will be displayed.</p></div><div class=paragraph><p>Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=getfacl&amp;sektion=1&amp;format=html">getfacl(1)</a> and <a href="https://man.freebsd.org/cgi/man.cgi?query=setfacl&amp;sektion=1&amp;format=html">setfacl(1)</a> for more information about the options available for these commands.</p></div></div></div><div class=sect2><h3 id=security-pkg>13.10. Monitoring Third Party Security Issues<a class=anchor href=#security-pkg></a></h3><div class=paragraph><p>In recent years, the security world has made many improvements to how vulnerability assessment is handled. The threat of system intrusion increases as third party utilities are installed and configured for virtually any operating system available today.</p></div><div class=paragraph><p>Vulnerability assessment is a key factor in security. While FreeBSD releases advisories for the base system, doing so for every third party utility is beyond the FreeBSD Project’s capability. There is a way to mitigate third party vulnerabilities and warn administrators of known security issues. A FreeBSD add on utility known as pkg includes options explicitly for this purpose.</p></div><div class=paragraph><p>pkg polls a database for security issues. The database is updated and maintained by the FreeBSD Security Team and ports developers.</p></div><div class=paragraph><p>Please refer to <a href=./#pkgng-intro>instructions</a> for installing pkg.</p></div><div class=paragraph><p>Installation provides <a href="https://man.freebsd.org/cgi/man.cgi?query=periodic&amp;sektion=8&amp;format=html">periodic(8)</a> configuration files for maintaining the pkg audit database, and provides a programmatic method of keeping it updated. This functionality is enabled if <code>daily_status_security_pkgaudit_enable</code> is set to <code>YES</code> in <a href="https://man.freebsd.org/cgi/man.cgi?query=periodic.conf&amp;sektion=5&amp;format=html">periodic.conf(5)</a>. Ensure that daily security run emails, which are sent to <code>root</code>'s email account, are being read.</p></div><div class=paragraph><p>After installation, and to audit third party utilities as part of the Ports Collection at any time, an administrator may choose to update the database and view known vulnerabilities of installed packages by invoking:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pkg audit -F</span></code></pre></div></div><div class=paragraph><p>pkg displays messages any published vulnerabilities in installed packages:</p></div><div class="literalblock programlisting"><div class=content><pre>Affected package: cups-base-1.1.22.0_1
Type of problem: cups-base -- HPGL buffer overflow vulnerability.
Reference: &lt;https://www.FreeBSD.org/ports/portaudit/40a3bca2-6809-11d9-a9e7-0001020eed82.html&gt;

1 problem(s) in your installed packages found.

You are advised to update or deinstall the affected package(s) immediately.</pre></div></div><div class=paragraph><p>By pointing a web browser to the displayed URL, an administrator may obtain more information about the vulnerability. This will include the versions affected, by FreeBSD port version, along with other web sites which may contain security advisories.</p></div><div class=paragraph><p>pkg is a powerful utility and is extremely useful when coupled with <a class=package href=https://cgit.freebsd.org/ports/tree/ports-mgmt/portmaster/>ports-mgmt/portmaster</a>.</p></div></div><div class=sect2><h3 id=security-advisories>13.11. FreeBSD Security Advisories<a class=anchor href=#security-advisories></a></h3><div class=paragraph><p>Like many producers of quality operating systems, the FreeBSD Project has a security team which is responsible for determining the End-of-Life (EoL) date for each FreeBSD release and to provide security updates for supported releases which have not yet reached their EoL. More information about the FreeBSD security team and the supported releases is available on the <a href=https://www.FreeBSD.org/security>FreeBSD security page</a>.</p></div><div class=paragraph><p>One task of the security team is to respond to reported security vulnerabilities in the FreeBSD operating system. Once a vulnerability is confirmed, the security team verifies the steps necessary to fix the vulnerability and updates the source code with the fix. It then publishes the details as a "Security Advisory". Security advisories are published on the <a href=https://www.FreeBSD.org/security/advisories/>FreeBSD website</a> and mailed to the <a href=https://lists.FreeBSD.org/subscription/freebsd-security-notifications>FreeBSD security notifications mailing list</a>, <a href=https://lists.FreeBSD.org/subscription/freebsd-security>FreeBSD security mailing list</a>, and <a href=https://lists.FreeBSD.org/subscription/freebsd-announce>FreeBSD announcements mailing list</a> mailing lists.</p></div><div class=paragraph><p>This section describes the format of a FreeBSD security advisory.</p></div><div class=sect3><h4 id=_format_of_a_security_advisory>13.11.1. Format of a Security Advisory<a class=anchor href=#_format_of_a_security_advisory></a></h4><div class=paragraph><p>Here is an example of a FreeBSD security advisory:</p></div><div class="literalblock programlisting"><div class=content><pre>=============================================================================
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

=============================================================================
FreeBSD-SA-14:04.bind                                       Security Advisory
                                                          The FreeBSD Project

Topic:          BIND remote denial of service vulnerability

Category:       contrib
Module:         bind
Announced:      2014-01-14
Credits:        ISC
Affects:        FreeBSD 8.x and FreeBSD 9.x
Corrected:      2014-01-14 19:38:37 UTC (stable/9, 9.2-STABLE)
                2014-01-14 19:42:28 UTC (releng/9.2, 9.2-RELEASE-p3)
                2014-01-14 19:42:28 UTC (releng/9.1, 9.1-RELEASE-p10)
                2014-01-14 19:38:37 UTC (stable/8, 8.4-STABLE)
                2014-01-14 19:42:28 UTC (releng/8.4, 8.4-RELEASE-p7)
                2014-01-14 19:42:28 UTC (releng/8.3, 8.3-RELEASE-p14)
CVE Name:       CVE-2014-0591

For general information regarding FreeBSD Security Advisories,
including descriptions of the fields above, security branches, and the
following sections, please visit &lt;URL:http://security.FreeBSD.org/&gt;.

I.   Background

BIND 9 is an implementation of the Domain Name System (DNS) protocols.
The named(8) daemon is an Internet Domain Name Server.

II.  Problem Description

Because of a defect in handling queries for NSEC3-signed zones, BIND can
crash with an &#34;INSIST&#34; failure in name.c when processing queries possessing
certain properties.  This issue only affects authoritative nameservers with
at least one NSEC3-signed zone.  Recursive-only servers are not at risk.

III. Impact

An attacker who can send a specially crafted query could cause named(8)
to crash, resulting in a denial of service.

IV.  Workaround

No workaround is available, but systems not running authoritative DNS service
with at least one NSEC3-signed zone using named(8) are not vulnerable.

V.   Solution

Perform one of the following:

1) Upgrade your vulnerable system to a supported FreeBSD stable or
release / security branch (releng) dated after the correction date.

2) To update your vulnerable system via a source code patch:

The following patches have been verified to apply to the applicable
FreeBSD release branches.

a) Download the relevant patch from the location below, and verify the
detached PGP signature using your PGP utility.

[FreeBSD 8.3, 8.4, 9.1, 9.2-RELEASE and 8.4-STABLE]
# fetch http://security.FreeBSD.org/patches/SA-14:04/bind-release.patch
# fetch http://security.FreeBSD.org/patches/SA-14:04/bind-release.patch.asc
# gpg --verify bind-release.patch.asc

[FreeBSD 9.2-STABLE]
# fetch http://security.FreeBSD.org/patches/SA-14:04/bind-stable-9.patch
# fetch http://security.FreeBSD.org/patches/SA-14:04/bind-stable-9.patch.asc
# gpg --verify bind-stable-9.patch.asc

b) Execute the following commands as root:

# cd /usr/src
# patch &lt; /path/to/patch

Recompile the operating system using buildworld and installworld as
described in &lt;URL:https://www.FreeBSD.org/handbook/makeworld.html&gt;.

Restart the applicable daemons, or reboot the system.

3) To update your vulnerable system via a binary patch:

Systems running a RELEASE version of FreeBSD on the i386 or amd64
platforms can be updated via the freebsd-update(8) utility:

# freebsd-update fetch
# freebsd-update install

VI.  Correction details

The following list contains the correction revision numbers for each
affected branch.

Branch/path                                                      Revision
- -------------------------------------------------------------------------
stable/8/                                                         r260646
releng/8.3/                                                       r260647
releng/8.4/                                                       r260647
stable/9/                                                         r260646
releng/9.1/                                                       r260647
releng/9.2/                                                       r260647
- -------------------------------------------------------------------------

To see which files were modified by a particular revision, run the
following command, replacing NNNNNN with the revision number, on a
machine with Subversion installed:

# svn diff -cNNNNNN --summarize svn://svn.freebsd.org/base

Or visit the following URL, replacing NNNNNN with the revision number:

&lt;URL:https://svnweb.freebsd.org/base?view=revision&amp;revision=NNNNNN&gt;

VII. References

&lt;URL:https://kb.isc.org/article/AA-01078&gt;

&lt;URL:http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-0591&gt;

The latest revision of this advisory is available at
&lt;URL:http://security.FreeBSD.org/advisories/FreeBSD-SA-14:04.bind.asc&gt;
-----BEGIN PGP SIGNATURE-----

iQIcBAEBCgAGBQJS1ZTYAAoJEO1n7NZdz2rnOvQP/2/68/s9Cu35PmqNtSZVVxVG
ZSQP5EGWx/lramNf9566iKxOrLRMq/h3XWcC4goVd+gZFrvITJSVOWSa7ntDQ7TO
XcinfRZ/iyiJbs/Rg2wLHc/t5oVSyeouyccqODYFbOwOlk35JjOTMUG1YcX+Zasg
ax8RV+7Zt1QSBkMlOz/myBLXUjlTZ3Xg2FXVsfFQW5/g2CjuHpRSFx1bVNX6ysoG
9DT58EQcYxIS8WfkHRbbXKh9I1nSfZ7/Hky/kTafRdRMrjAgbqFgHkYTYsBZeav5
fYWKGQRJulYfeZQ90yMTvlpF42DjCC3uJYamJnwDIu8OhS1WRBI8fQfr9DRzmRua
OK3BK9hUiScDZOJB6OqeVzUTfe7MAA4/UwrDtTYQ+PqAenv1PK8DZqwXyxA9ThHb
zKO3OwuKOVHJnKvpOcr+eNwo7jbnHlis0oBksj/mrq2P9m2ueF9gzCiq5Ri5Syag
Wssb1HUoMGwqU0roS8+pRpNC8YgsWpsttvUWSZ8u6Vj/FLeHpiV3mYXPVMaKRhVm
067BA2uj4Th1JKtGleox+Em0R7OFbCc/9aWC67wiqI6KRyit9pYiF3npph+7D5Eq
7zPsUdDd+qc+UTiLp3liCRp5w6484wWdhZO6wRtmUgxGjNkxFoNnX8CitzF8AaqO
UWWemqWuz3lAZuORQ9KX
=OQzQ
-----END PGP SIGNATURE-----</pre></div></div><div class=paragraph><p>Every security advisory uses the following format:</p></div><div class=ulist><ul><li><p>Each security advisory is signed by the PGP key of the Security Officer. The public key for the Security Officer can be verified at <a href=./#pgpkeys>OpenPGP Keys</a>.</p></li><li><p>The name of the security advisory always begins with <code>FreeBSD-SA-</code> (for FreeBSD Security Advisory), followed by the year in two digit format (<code>14:</code>), followed by the advisory number for that year (<code>04.</code>), followed by the name of the affected application or subsystem (<code>bind</code>). The advisory shown here is the fourth advisory for 2014 and it affects BIND.</p></li><li><p>The <code>Topic</code> field summarizes the vulnerability.</p></li><li><p>The <code>Category</code> refers to the affected part of the system which may be one of <code>core</code>, <code>contrib</code>, or <code>ports</code>. The <code>core</code> category means that the vulnerability affects a core component of the FreeBSD operating system. The <code>contrib</code> category means that the vulnerability affects software included with FreeBSD, such as BIND. The <code>ports</code> category indicates that the vulnerability affects software available through the Ports Collection.</p></li><li><p>The <code>Module</code> field refers to the component location. In this example, the <code>bind</code> module is affected; therefore, this vulnerability affects an application installed with the operating system.</p></li><li><p>The <code>Announced</code> field reflects the date the security advisory was published. This means that the security team has verified that the problem exists and that a patch has been committed to the FreeBSD source code repository.</p></li><li><p>The <code>Credits</code> field gives credit to the individual or organization who noticed the vulnerability and reported it.</p></li><li><p>The <code>Affects</code> field explains which releases of FreeBSD are affected by this vulnerability.</p></li><li><p>The <code>Corrected</code> field indicates the date, time, time offset, and releases that were corrected. The section in parentheses shows each branch for which the fix has been merged, and the version number of the corresponding release from that branch. The release identifier itself includes the version number and, if appropriate, the patch level. The patch level is the letter <code>p</code> followed by a number, indicating the sequence number of the patch, allowing users to track which patches have already been applied to the system.</p></li><li><p>The <code>CVE Name</code> field lists the advisory number, if one exists, in the public <a href=http://cve.mitre.org>cve.mitre.org</a> security vulnerabilities database.</p></li><li><p>The <code>Background</code> field provides a description of the affected module.</p></li><li><p>The <code>Problem Description</code> field explains the vulnerability. This can include information about the flawed code and how the utility could be maliciously used.</p></li><li><p>The <code>Impact</code> field describes what type of impact the problem could have on a system.</p></li><li><p>The <code>Workaround</code> field indicates if a workaround is available to system administrators who cannot immediately patch the system .</p></li><li><p>The <code>Solution</code> field provides the instructions for patching the affected system. This is a step by step tested and verified method for getting a system patched and working securely.</p></li><li><p>The <code>Correction Details</code> field displays each affected Subversion branch with the revision number that contains the corrected code.</p></li><li><p>The <code>References</code> field offers sources of additional information regarding the vulnerability.</p></li></ul></div></div></div><div class=sect2><h3 id=security-accounting>13.12. Process Accounting<a class=anchor href=#security-accounting></a></h3><div class=paragraph><p>Process accounting is a security method in which an administrator may keep track of system resources used and their allocation among users, provide for system monitoring, and minimally track a user’s commands.</p></div><div class=paragraph><p>Process accounting has both positive and negative points. One of the positives is that an intrusion may be narrowed down to the point of entry. A negative is the amount of logs generated by process accounting, and the disk space they may require. This section walks an administrator through the basics of process accounting.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>If more fine-grained accounting is needed, refer to <a href=./#audit>Security Event Auditing</a>.</p></div></td></tr></tbody></table></div><div class=sect3><h4 id=_enabling_and_utilizing_process_accounting>13.12.1. Enabling and Utilizing Process Accounting<a class=anchor href=#_enabling_and_utilizing_process_accounting></a></h4><div class=paragraph><p>Before using process accounting, it must be enabled using the following commands:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sysrc accounting_enable=yes</span>
<span class=c># service accounting start</span></code></pre></div></div><div class=paragraph><p>The accounting information is stored in files located in <span class=filename>/var/account</span>, which is automatically created, if necessary, the first time the accounting service starts. These files contain sensitive information, including all the commands issued by all users. Write access to the files is limited to <code>root</code>, and read access is limited to <code>root</code> and members of the <code>wheel</code> group. To also prevent members of <code>wheel</code> from reading the files, change the mode of the <span class=filename>/var/account</span> directory to allow access only by <code>root</code>.</p></div><div class=paragraph><p>Once enabled, accounting will begin to track information such as CPU statistics and executed commands. All accounting logs are in a non-human readable format which can be viewed using <code>sa</code>. If issued without any options, <code>sa</code> prints information relating to the number of per-user calls, the total elapsed time in minutes, total CPU and user time in minutes, and the average number of I/O operations. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=sa&amp;sektion=8&amp;format=html">sa(8)</a> for the list of available options which control the output.</p></div><div class=paragraph><p>To display the commands issued by users, use <code>lastcomm</code>. For example, this command prints out all usage of <code>ls</code> by <code>trhodes</code> on the <code>ttyp1</code> terminal:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># lastcomm ls trhodes ttyp1</span></code></pre></div></div><div class=paragraph><p>Many other useful options exist and are explained in <a href="https://man.freebsd.org/cgi/man.cgi?query=lastcomm&amp;sektion=1&amp;format=html">lastcomm(1)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=acct&amp;sektion=5&amp;format=html">acct(5)</a>, and <a href="https://man.freebsd.org/cgi/man.cgi?query=sa&amp;sektion=8&amp;format=html">sa(8)</a>.</p></div></div></div><div class=sect2><h3 id=security-resourcelimits>13.13. Resource Limits<a class=anchor href=#security-resourcelimits></a></h3><div class=paragraph><p>FreeBSD provides several methods for an administrator to limit the amount of system resources an individual may use. Disk quotas limit the amount of disk space available to users. Quotas are discussed in <a href=./#quotas>Disk Quotas</a>.</p></div><div class=paragraph><p>Limits to other resources, such as CPU and memory, can be set using either a flat file or a command to configure a resource limits database. The traditional method defines login classes by editing <span class=filename>/etc/login.conf</span>. While this method is still supported, any changes require a multi-step process of editing this file, rebuilding the resource database, making necessary changes to <span class=filename>/etc/master.passwd</span>, and rebuilding the password database. This can become time consuming, depending upon the number of users to configure.</p></div><div class=paragraph><p><code>rctl</code> can be used to provide a more fine-grained method for controlling resource limits. This command supports more than user limits as it can also be used to set resource constraints on processes and jails.</p></div><div class=paragraph><p>This section demonstrates both methods for controlling resources, beginning with the traditional method.</p></div><div class=sect3><h4 id=users-limiting>13.13.1. Configuring Login Classes<a class=anchor href=#users-limiting></a></h4><div class=paragraph><p>In the traditional method, login classes and the resource limits to apply to a login class are defined in <span class=filename>/etc/login.conf</span>. Each user account can be assigned to a login class, where <code>default</code> is the default login class. Each login class has a set of login capabilities associated with it. A login capability is a <code><em>name</em>=<em>value</em></code> pair, where <em>name</em> is a well-known identifier and <em>value</em> is an arbitrary string which is processed accordingly depending on the <em>name</em>.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Whenever <span class=filename>/etc/login.conf</span> is edited, the <span class=filename>/etc/login.conf.db</span> must be updated by executing the following command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cap_mkdb /etc/login.conf</span></code></pre></div></div></td></tr></tbody></table></div><div class=paragraph><p>Resource limits differ from the default login capabilities in two ways. First, for every limit, there is a <em>soft</em> and <em>hard</em> limit. A soft limit may be adjusted by the user or application, but may not be set higher than the hard limit. The hard limit may be lowered by the user, but can only be raised by the superuser. Second, most resource limits apply per process to a specific user.</p></div><div class=paragraph><p><a href=#resource-limits>Login Class Resource Limits</a> lists the most commonly used resource limits. All of the available resource limits and capabilities are described in detail in <a href="https://man.freebsd.org/cgi/man.cgi?query=login.conf&amp;sektion=5&amp;format=html">login.conf(5)</a>.</p></div><table id=resource-limits class="tableblock frame-none grid-all stretch"><caption class=title>Tabela 12. Login Class Resource Limits</caption><col style=width:20%><col style=width:80%><thead><tr><th class="tableblock halign-left valign-top">Resource Limit</th><th class="tableblock halign-left valign-top">Description</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock>coredumpsize</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>The limit on the size of a core file generated by a program is subordinate to other limits on disk usage, such as <code>filesize</code> or disk quotas. This limit is often used as a less severe method of controlling disk space consumption. Since users do not generate core files and often do not delete them, this setting may save them from running out of disk space should a large program crash.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>cputime</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>The maximum amount of CPU time a user’s process may consume. Offending processes will be killed by the kernel. This is a limit on CPU <em>time</em> consumed, not the percentage of the CPU as displayed in some of the fields generated by <code>top</code> and <code>ps</code>.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>filesize</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>The maximum size of a file the user may own. Unlike disk quotas (<a href=./#quotas>Disk Quotas</a>), this limit is enforced on individual files, not the set of all files a user owns.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>maxproc</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>The maximum number of foreground and background processes a user can run. This limit may not be larger than the system limit specified by <code>kern.maxproc</code>. Setting this limit too small may hinder a user’s productivity as some tasks, such as compiling a large program, start lots of processes.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>memorylocked</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>The maximum amount of memory a process may request to be locked into main memory using <a href="https://man.freebsd.org/cgi/man.cgi?query=mlock&amp;sektion=2&amp;format=html">mlock(2)</a>. Some system-critical programs, such as <a href="https://man.freebsd.org/cgi/man.cgi?query=amd&amp;sektion=8&amp;format=html">amd(8)</a>, lock into main memory so that if the system begins to swap, they do not contribute to disk thrashing.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>memoryuse</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>The maximum amount of memory a process may consume at any given time. It includes both core memory and swap usage. This is not a catch-all limit for restricting memory consumption, but is a good start.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>openfiles</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>The maximum number of files a process may have open. In FreeBSD, files are used to represent sockets and IPC channels, so be careful not to set this too low. The system-wide limit for this is defined by <code>kern.maxfiles</code>.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>sbsize</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>The limit on the amount of network memory a user may consume. This can be generally used to limit network communications.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>stacksize</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>The maximum size of a process stack. This alone is not sufficient to limit the amount of memory a program may use, so it should be used in conjunction with other limits.</p></td></tr></tbody></table><div class=paragraph><p>There are a few other things to remember when setting resource limits:</p></div><div class=ulist><ul><li><p>Processes started at system startup by <span class=filename>/etc/rc</span> are assigned to the <code>daemon</code> login class.</p></li><li><p>Although the default <span class=filename>/etc/login.conf</span> is a good source of reasonable values for most limits, they may not be appropriate for every system. Setting a limit too high may open the system up to abuse, while setting it too low may put a strain on productivity.</p></li><li><p>Xorg takes a lot of resources and encourages users to run more programs simultaneously.</p></li><li><p>Many limits apply to individual processes, not the user as a whole. For example, setting <code>openfiles</code> to <code>50</code> means that each process the user runs may open up to <code>50</code> files. The total amount of files a user may open is the value of <code>openfiles</code> multiplied by the value of <code>maxproc</code>. This also applies to memory consumption.</p></li></ul></div><div class=paragraph><p>For further information on resource limits and login classes and capabilities in general, refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=cap.mkdb&amp;sektion=1&amp;format=html">cap.mkdb(1)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=getrlimit&amp;sektion=2&amp;format=html">getrlimit(2)</a>, and <a href="https://man.freebsd.org/cgi/man.cgi?query=login.conf&amp;sektion=5&amp;format=html">login.conf(5)</a>.</p></div></div><div class=sect3><h4 id=_enabling_and_configuring_resource_limits>13.13.2. Enabling and Configuring Resource Limits<a class=anchor href=#_enabling_and_configuring_resource_limits></a></h4><div class=paragraph><p>The <code>kern.racct.enable</code> tunable must be set to a non-zero value. Custom kernels require specific configuration:</p></div><div class="literalblock programlisting"><div class=content><pre>options         RACCT
options         RCTL</pre></div></div><div class=paragraph><p>Once the system has rebooted into the new kernel, <code>rctl</code> may be used to set rules for the system.</p></div><div class=paragraph><p>Rule syntax is controlled through the use of a subject, subject-id, resource, and action, as seen in this example rule:</p></div><div class="literalblock programlisting"><div class=content><pre>user:trhodes:maxproc:deny=10/user</pre></div></div><div class=paragraph><p>In this rule, the subject is <code>user</code>, the subject-id is <code>trhodes</code>, the resource, <code>maxproc</code>, is the maximum number of processes, and the action is <code>deny</code>, which blocks any new processes from being created. This means that the user, <code>trhodes</code>, will be constrained to no greater than <code>10</code> processes. Other possible actions include logging to the console, passing a notification to <a href="https://man.freebsd.org/cgi/man.cgi?query=devd&amp;sektion=8&amp;format=html">devd(8)</a>, or sending a sigterm to the process.</p></div><div class=paragraph><p>Some care must be taken when adding rules. Since this user is constrained to <code>10</code> processes, this example will prevent the user from performing other tasks after logging in and executing a <code>screen</code> session. Once a resource limit has been hit, an error will be printed, as in this example:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% man <span class=nb>test</span>
    /usr/bin/man: Cannot fork: Resource temporarily unavailable
<span class=nb>eval</span>: Cannot fork: Resource temporarily unavailable</code></pre></div></div><div class=paragraph><p>As another example, a jail can be prevented from exceeding a memory limit. This rule could be written as:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># rctl -a jail:httpd:memoryuse:deny=2G/jail</span></code></pre></div></div><div class=paragraph><p>Rules will persist across reboots if they have been added to <span class=filename>/etc/rctl.conf</span>. The format is a rule, without the preceding command. For example, the previous rule could be added as:</p></div><div class="literalblock programlisting"><div class=content><pre># Block jail from using more than 2G memory:
jail:httpd:memoryuse:deny=2G/jail</pre></div></div><div class=paragraph><p>To remove a rule, use <code>rctl</code> to remove it from the list:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># rctl -r user:trhodes:maxproc:deny=10/user</span></code></pre></div></div><div class=paragraph><p>A method for removing all rules is documented in <a href="https://man.freebsd.org/cgi/man.cgi?query=rctl&amp;sektion=8&amp;format=html">rctl(8)</a>. However, if removing all rules for a single user is required, this command may be issued:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># rctl -r user:trhodes</span></code></pre></div></div><div class=paragraph><p>Many other resources exist which can be used to exert additional control over various <code>subjects</code>. See <a href="https://man.freebsd.org/cgi/man.cgi?query=rctl&amp;sektion=8&amp;format=html">rctl(8)</a> to learn about them.</p></div></div></div><div class=sect2><h3 id=security-sudo>13.14. Shared Administration with Sudo<a class=anchor href=#security-sudo></a></h3><div class=paragraph><p>System administrators often need the ability to grant enhanced permissions to users so they may perform privileged tasks. The idea that team members are provided access to a FreeBSD system to perform their specific tasks opens up unique challenges to every administrator. These team members only need a subset of access beyond normal end user levels; however, they almost always tell management they are unable to perform their tasks without superuser access. Thankfully, there is no reason to provide such access to end users because tools exist to manage this exact requirement.</p></div><div class=paragraph><p>Up to this point, the security chapter has covered permitting access to authorized users and attempting to prevent unauthorized access. Another problem arises once authorized users have access to the system resources. In many cases, some users may need access to application startup scripts, or a team of administrators need to maintain the system. Traditionally, the standard users and groups, file permissions, and even the <a href="https://man.freebsd.org/cgi/man.cgi?query=su&amp;sektion=1&amp;format=html">su(1)</a> command would manage this access. And as applications required more access, as more users needed to use system resources, a better solution was required. The most used application is currently Sudo.</p></div><div class=paragraph><p>Sudo allows administrators to configure more rigid access to system commands and provide for some advanced logging features. As a tool, it is available from the Ports Collection as <a class=package href=https://cgit.freebsd.org/ports/tree/security/sudo/>security/sudo</a> or by use of the <a href="https://man.freebsd.org/cgi/man.cgi?query=pkg&amp;sektion=8&amp;format=html">pkg(8)</a> utility. To use the <a href="https://man.freebsd.org/cgi/man.cgi?query=pkg&amp;sektion=8&amp;format=html">pkg(8)</a> tool:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pkg install sudo</span></code></pre></div></div><div class=paragraph><p>After the installation is complete, the installed <code>visudo</code> will open the configuration file with a text editor. Using <code>visudo</code> is highly recommended as it comes with a built in syntax checker to verify there are no errors before the file is saved.</p></div><div class=paragraph><p>The configuration file is made up of several small sections which allow for extensive configuration. In the following example, web application maintainer, user1, needs to start, stop, and restart the web application known as <em>webservice</em>. To grant this user permission to perform these tasks, add this line to the end of <span class=filename>/usr/local/etc/sudoers</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>user1   ALL=(ALL)       /usr/sbin/service webservice *</pre></div></div><div class=paragraph><p>The user may now start <em>webservice</em> using this command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% <span class=nb>sudo</span> /usr/sbin/service webservice start</code></pre></div></div><div class=paragraph><p>While this configuration allows a single user access to the webservice service; however, in most organizations, there is an entire web team in charge of managing the service. A single line can also give access to an entire group. These steps will create a web group, add a user to this group, and allow all members of the group to manage the service:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pw groupadd -g 6001 -n webteam</span></code></pre></div></div><div class=paragraph><p>Using the same <a href="https://man.freebsd.org/cgi/man.cgi?query=pw&amp;sektion=8&amp;format=html">pw(8)</a> command, the user is added to the webteam group:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pw groupmod -m user1 -n webteam</span></code></pre></div></div><div class=paragraph><p>Finally, this line in <span class=filename>/usr/local/etc/sudoers</span> allows any member of the webteam group to manage <em>webservice</em>:</p></div><div class="literalblock programlisting"><div class=content><pre>%webteam   ALL=(ALL)       /usr/sbin/service webservice *</pre></div></div><div class=paragraph><p>Unlike <a href="https://man.freebsd.org/cgi/man.cgi?query=su&amp;sektion=1&amp;format=html">su(1)</a>, Sudo only requires the end user password. This adds an advantage where users will not need shared passwords, a finding in most security audits and just bad all the way around.</p></div><div class=paragraph><p>Users permitted to run applications with Sudo only enter their own passwords. This is more secure and gives better control than <a href="https://man.freebsd.org/cgi/man.cgi?query=su&amp;sektion=1&amp;format=html">su(1)</a>, where the <code>root</code> password is entered and the user acquires all <code>root</code> permissions.</p></div><div class="admonitionblock tip"><table><tbody><tr><td class=icon><i class="fa icon-tip" title=Tip></i></td><td class=content><div class=paragraph><p>Most organizations are moving or have moved toward a two factor authentication model. In these cases, the user may not have a password to enter. Sudo provides for these cases with the <code>NOPASSWD</code> variable. Adding it to the configuration above will allow all members of the <em>webteam</em> group to manage the service without the password requirement:</p></div><div class="literalblock programlisting"><div class=content><pre>%webteam   ALL=(ALL)       NOPASSWD: /usr/sbin/service webservice *</pre></div></div></td></tr></tbody></table></div><div class=sect3><h4 id=security-sudo-loggin>13.14.1. Logging Output<a class=anchor href=#security-sudo-loggin></a></h4><div class=paragraph><p>An advantage to implementing Sudo is the ability to enable session logging. Using the built in log mechanisms and the included sudoreplay command, all commands initiated through Sudo are logged for later verification. To enable this feature, add a default log directory entry, this example uses a user variable. Several other log filename conventions exist, consult the manual page for sudoreplay for additional information.</p></div><div class="literalblock programlisting"><div class=content><pre>Defaults iolog_dir=/var/log/sudo-io/%{user}</pre></div></div><div class="admonitionblock tip"><table><tbody><tr><td class=icon><i class="fa icon-tip" title=Tip></i></td><td class=content><div class=paragraph><p>This directory will be created automatically after the logging is configured. It is best to let the system create directory with default permissions just to be safe. In addition, this entry will also log administrators who use the sudoreplay command. To change this behavior, read and uncomment the logging options inside <span class=filename>sudoers</span>.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Once this directive has been added to the <span class=filename>sudoers</span> file, any user configuration can be updated with the request to log access. In the example shown, the updated <em>webteam</em> entry would have the following additional changes:</p></div><div class="literalblock programlisting"><div class=content><pre>%webteam ALL=(ALL) NOPASSWD: LOG_INPUT: LOG_OUTPUT: /usr/sbin/service webservice *</pre></div></div><div class=paragraph><p>From this point on, all <em>webteam</em> members altering the status of the <em>webservice</em> application will be logged. The list of previous and current sessions can be displayed with:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sudoreplay -l</span></code></pre></div></div><div class=paragraph><p>In the output, to replay a specific session, search for the <code>TSID=</code> entry, and pass that to sudoreplay with no other options to replay the session at normal speed. For example:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sudoreplay user1/00/00/02</span></code></pre></div></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>While sessions are logged, any administrator is able to remove sessions and leave only a question of why they had done so. It is worthwhile to add a daily check through an intrusion detection system (IDS) or similar software so that other administrators are alerted to manual alterations.</p></div></td></tr></tbody></table></div><div class=paragraph><p>The <code>sudoreplay</code> is extremely extendable. Consult the documentation for more information.</p></div></div></div></div></div><div class=sect1><h2 id=jails>Rozdział 14. Jails<a class=anchor href=#jails></a></h2><div class=sectionbody><div class=sect2><h3 id=jails-synopsis>14.1. Synopsis<a class=anchor href=#jails-synopsis></a></h3><div class=paragraph><p>Since system administration is a difficult task, many tools have been developed to make life easier for the administrator. These tools often enhance the way systems are installed, configured, and maintained. One of the tools which can be used to enhance the security of a FreeBSD system is <em>jails</em>. Jails have been available since FreeBSD 4.X and continue to be enhanced in their usefulness, performance, reliability, and security.</p></div><div class=paragraph><p>Jails build upon the <a href="https://man.freebsd.org/cgi/man.cgi?query=chroot&amp;sektion=2&amp;format=html">chroot(2)</a> concept, which is used to change the root directory of a set of processes. This creates a safe environment, separate from the rest of the system. Processes created in the chrooted environment can not access files or resources outside of it. For that reason, compromising a service running in a chrooted environment should not allow the attacker to compromise the entire system. However, a chroot has several limitations. It is suited to easy tasks which do not require much flexibility or complex, advanced features. Over time, many ways have been found to escape from a chrooted environment, making it a less than ideal solution for securing services.</p></div><div class=paragraph><p>Jails improve on the concept of the traditional chroot environment in several ways. In a traditional chroot environment, processes are only limited in the part of the file system they can access. The rest of the system resources, system users, running processes, and the networking subsystem are shared by the chrooted processes and the processes of the host system. Jails expand this model by virtualizing access to the file system, the set of users, and the networking subsystem. More fine-grained controls are available for tuning the access of a jailed environment. Jails can be considered as a type of operating system-level virtualization.</p></div><div class=paragraph><p>A jail is characterized by four elements:</p></div><div class=ulist><ul><li><p>A directory subtree: the starting point from which a jail is entered. Once inside the jail, a process is not permitted to escape outside of this subtree.</p></li><li><p>A hostname: which will be used by the jail.</p></li><li><p>An IP address: which is assigned to the jail. The IP address of a jail is often an alias address for an existing network interface.</p></li><li><p>A command: the path name of an executable to run inside the jail. The path is relative to the root directory of the jail environment.</p></li></ul></div><div class=paragraph><p>Jails have their own set of users and their own <code>root</code> account which are limited to the jail environment. The <code>root</code> account of a jail is not allowed to perform operations to the system outside of the associated jail environment.</p></div><div class=paragraph><p>This chapter provides an overview of the terminology and commands for managing FreeBSD jails. Jails are a powerful tool for both system administrators, and advanced users.</p></div><div class=paragraph><p>After reading this chapter, you will know:</p></div><div class=ulist><ul><li><p>What a jail is and what purpose it may serve in FreeBSD installations.</p></li><li><p>How to build, start, and stop a jail.</p></li><li><p>The basics of jail administration, both from inside and outside the jail.</p></li></ul></div><div class="admonitionblock important"><table><tbody><tr><td class=icon><i class="fa icon-important" title=Important></i></td><td class=content><div class=paragraph><p>Jails are a powerful tool, but they are not a security panacea. While it is not possible for a jailed process to break out on its own, there are several ways in which an unprivileged user outside the jail can cooperate with a privileged user inside the jail to obtain elevated privileges in the host environment.</p></div><div class=paragraph><p>Most of these attacks can be mitigated by ensuring that the jail root is not accessible to unprivileged users in the host environment. As a general rule, untrusted users with privileged access to a jail should not be given access to the host environment.</p></div></td></tr></tbody></table></div></div><div class=sect2><h3 id=jails-terms>14.2. Terms Related to Jails<a class=anchor href=#jails-terms></a></h3><div class=paragraph><p>To facilitate better understanding of parts of the FreeBSD system related to jails, their internals and the way they interact with the rest of FreeBSD, the following terms are used further in this chapter:</p></div><div class=dlist><dl><dt class=hdlist1><a href="https://man.freebsd.org/cgi/man.cgi?query=chroot&amp;sektion=8&amp;format=html">chroot(8)</a> (command)</dt><dd><p>Utility, which uses <a href="https://man.freebsd.org/cgi/man.cgi?query=chroot&amp;sektion=2&amp;format=html">chroot(2)</a> FreeBSD system call to change the root directory of a process and all its descendants.</p></dd><dt class=hdlist1><a href="https://man.freebsd.org/cgi/man.cgi?query=chroot&amp;sektion=2&amp;format=html">chroot(2)</a> (environment)</dt><dd><p>The environment of processes running in a "chroot". This includes resources such as the part of the file system which is visible, user and group IDs which are available, network interfaces and other IPC mechanisms, etc.</p></dd><dt class=hdlist1><a href="https://man.freebsd.org/cgi/man.cgi?query=jail&amp;sektion=8&amp;format=html">jail(8)</a> (command)</dt><dd><p>The system administration utility which allows launching of processes within a jail environment.</p></dd><dt class=hdlist1>host (system, process, user, etc.)</dt><dd><p>The controlling system of a jail environment. The host system has access to all the hardware resources available, and can control processes both outside of and inside a jail environment. One of the important differences of the host system from a jail is that the limitations which apply to superuser processes inside a jail are not enforced for processes of the host system.</p></dd><dt class=hdlist1>hosted (system, process, user, etc.)</dt><dd><p>A process, user or other entity, whose access to resources is restricted by a FreeBSD jail.</p></dd></dl></div></div><div class=sect2><h3 id=jails-build>14.3. Creating and Controlling Jails<a class=anchor href=#jails-build></a></h3><div class=paragraph><p>Some administrators divide jails into the following two types: "complete" jails, which resemble a real FreeBSD system, and "service" jails, dedicated to one application or service, possibly running with privileges. This is only a conceptual division and the process of building a jail is not affected by it. When creating a "complete" jail there are two options for the source of the userland: use prebuilt binaries (such as those supplied on an install media) or build from source.</p></div><div class=sect3><h4 id=_installing_a_jail>14.3.1. Installing a Jail<a class=anchor href=#_installing_a_jail></a></h4><div class=sect4><h5 id=jails-install-internet>14.3.1.1. To install a Jail from the Internet<a class=anchor href=#jails-install-internet></a></h5><div class=paragraph><p>The <a href="https://man.freebsd.org/cgi/man.cgi?query=bsdinstall&amp;sektion=8&amp;format=html">bsdinstall(8)</a> tool can be used to fetch and install the binaries needed for a jail. This will walk through the picking of a mirror, which distributions will be installed into the destination directory, and some basic configuration of the jail:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># bsdinstall jail /here/is/the/jail</span></code></pre></div></div><div class=paragraph><p>Once the command is complete, the next step is configuring the host to run the jail.</p></div></div><div class=sect4><h5 id=jails-install-iso>14.3.1.2. To install a Jail from an ISO<a class=anchor href=#jails-install-iso></a></h5><div class=paragraph><p>To install the userland from installation media, first create the root directory for the jail. This can be done by setting the <code>DESTDIR</code> variable to the proper location.</p></div><div class=paragraph><p>Start a shell and define <code>DESTDIR</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sh</span>
<span class=c># export DESTDIR=/here/is/the/jail</span></code></pre></div></div><div class=paragraph><p>Mount the install media as covered in <a href="https://man.freebsd.org/cgi/man.cgi?query=mdconfig&amp;sektion=8&amp;format=html">mdconfig(8)</a> when using the install ISO:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mount -t cd9660 /dev/`mdconfig -f cdimage.iso` /mnt</span>
<span class=c># cd /mnt/usr/freebsd-dist/</span></code></pre></div></div><div class=paragraph><p>Extract the binaries from the tarballs on the install media into the declared destination. Minimally, only the base set needs to be extracted, but a complete install can be performed when preferred.</p></div><div class=paragraph><p>To install just the base system:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># tar -xf base.txz -C $DESTDIR</span></code></pre></div></div><div class=paragraph><p>To install everything except the kernel:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># for set in base ports; do tar -xf $set.txz -C $DESTDIR ; done</span></code></pre></div></div></div><div class=sect4><h5 id=jails-install-source>14.3.1.3. To build and install a Jail from source<a class=anchor href=#jails-install-source></a></h5><div class=paragraph><p>The <a href="https://man.freebsd.org/cgi/man.cgi?query=jail&amp;sektion=8&amp;format=html">jail(8)</a> manual page explains the procedure for building a jail:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># setenv D /here/is/the/jail</span>
<span class=c># mkdir -p $D      </span><i class=conum data-value=1></i><b>(1)</b>
<span class=c># cd /usr/src</span>
<span class=c># make buildworld  </span><i class=conum data-value=2></i><b>(2)</b>
<span class=c># make installworld DESTDIR=$D  </span><i class=conum data-value=3></i><b>(3)</b>
<span class=c># make distribution DESTDIR=$D  </span><i class=conum data-value=4></i><b>(4)</b>
<span class=c># mount -t devfs devfs $D/dev   </span><i class=conum data-value=5></i><b>(5)</b></code></pre></div></div><div class="colist arabic"><table><tbody><tr><td><i class=conum data-value=1></i><b>1</b></td><td>Selecting a location for a jail is the best starting point. This is where the jail will physically reside within the file system of the jail’s host. A good choice can be <span class=filename>/usr/jail/jailname</span>, where <em>jailname</em> is the hostname identifying the jail. Usually, <span class=filename>/usr/</span> has enough space for the jail file system, which for "complete" jails is, essentially, a replication of every file present in a default installation of the FreeBSD base system.</td></tr><tr><td><i class=conum data-value=2></i><b>2</b></td><td>If you have already rebuilt your userland using <code>make world</code> or <code>make buildworld</code>, you can skip this step and install your existing userland into the new jail.</td></tr><tr><td><i class=conum data-value=3></i><b>3</b></td><td>This command will populate the directory subtree chosen as jail’s physical location on the file system with the necessary binaries, libraries, manual pages and so on.</td></tr><tr><td><i class=conum data-value=4></i><b>4</b></td><td>The <code>distribution</code> target for make installs every needed configuration file. In simple words, it installs every installable file of <span class=filename>/usr/src/etc/</span> to the <span class=filename>/etc</span> directory of the jail environment: <span class=filename>$D/etc/</span>.</td></tr><tr><td><i class=conum data-value=5></i><b>5</b></td><td>Mounting the <a href="https://man.freebsd.org/cgi/man.cgi?query=devfs&amp;sektion=8&amp;format=html">devfs(8)</a> file system inside a jail is not required. On the other hand, any, or almost any application requires access to at least one device, depending on the purpose of the given application. It is very important to control access to devices from inside a jail, as improper settings could permit an attacker to do nasty things in the jail. Control over <a href="https://man.freebsd.org/cgi/man.cgi?query=devfs&amp;sektion=8&amp;format=html">devfs(8)</a> is managed through rulesets which are described in the <a href="https://man.freebsd.org/cgi/man.cgi?query=devfs&amp;sektion=8&amp;format=html">devfs(8)</a> and <a href="https://man.freebsd.org/cgi/man.cgi?query=devfs.conf&amp;sektion=5&amp;format=html">devfs.conf(5)</a> manual pages.</td></tr></tbody></table></div></div></div><div class=sect3><h4 id=_configuring_the_host>14.3.2. Configuring the Host<a class=anchor href=#_configuring_the_host></a></h4><div class=paragraph><p>Once a jail is installed, it can be started by using the <a href="https://man.freebsd.org/cgi/man.cgi?query=jail&amp;sektion=8&amp;format=html">jail(8)</a> utility. The <a href="https://man.freebsd.org/cgi/man.cgi?query=jail&amp;sektion=8&amp;format=html">jail(8)</a> utility takes four mandatory arguments which are described in the <a href=#jails-synopsis>Synopsis</a>. Other arguments may be specified too, e.g., to run the jailed process with the credentials of a specific user. The <code><em>command</em></code> argument depends on the type of the jail; for a <em>virtual system</em>, <span class=filename>/etc/rc</span> is a good choice, since it will replicate the startup sequence of a real FreeBSD system. For a <em>service</em> jail, it depends on the service or application that will run within the jail.</p></div><div class=paragraph><p>Jails are often started at boot time and the FreeBSD <span class=filename>rc</span> mechanism provides an easy way to do this.</p></div><div class="ulist procedure"><ul><li><p>Configure jail parameters in <span class=filename>jail.conf</span>:</p><div class="literalblock programlisting"><div class=content><pre>www {
    host.hostname = www.example.org;           # Hostname
    ip4.addr = 192.168.0.10;                   # IP address of the jail
    path = &#34;/usr/jail/www&#34;;                    # Path to the jail
    devfs_ruleset = &#34;www_ruleset&#34;;             # devfs ruleset
    mount.devfs;                               # Mount devfs inside the jail
    exec.start = &#34;/bin/sh /etc/rc&#34;;            # Start command
    exec.stop = &#34;/bin/sh /etc/rc.shutdown&#34;;    # Stop command
}</pre></div></div><div class=paragraph><p>Configure jails to start at boot time in <span class=filename>rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>jail_enable=&#34;YES&#34;   # Set to NO to disable starting of any jails</pre></div></div><div class=paragraph><p>The default startup of jails configured in <a href="https://man.freebsd.org/cgi/man.cgi?query=jail.conf&amp;sektion=5&amp;format=html">jail.conf(5)</a>, will run the <span class=filename>/etc/rc</span> script of the jail, which assumes the jail is a complete virtual system. For service jails, the default startup command of the jail should be changed, by setting the <code>exec.start</code> option appropriately.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>For a full list of available options, please see the <a href="https://man.freebsd.org/cgi/man.cgi?query=jail.conf&amp;sektion=5&amp;format=html">jail.conf(5)</a> manual page.</p></div></td></tr></tbody></table></div></li></ul></div><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=service&amp;sektion=8&amp;format=html">service(8)</a> can be used to start or stop a jail by hand, if an entry for it exists in <span class=filename>jail.conf</span>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service jail start www</span>
<span class=c># service jail stop www</span></code></pre></div></div><div class=paragraph><p>Jails can be shut down with <a href="https://man.freebsd.org/cgi/man.cgi?query=jexec&amp;sektion=8&amp;format=html">jexec(8)</a>. Use <a href="https://man.freebsd.org/cgi/man.cgi?query=jls&amp;sektion=8&amp;format=html">jls(8)</a> to identify the jail’s <code>JID</code>, then use <a href="https://man.freebsd.org/cgi/man.cgi?query=jexec&amp;sektion=8&amp;format=html">jexec(8)</a> to run the shutdown script in that jail.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># jls</span>
   JID  IP Address      Hostname                      Path
     3  192.168.0.10    www                           /usr/jail/www
<span class=c># jexec 3 /etc/rc.shutdown</span></code></pre></div></div><div class=paragraph><p>More information about this can be found in the <a href="https://man.freebsd.org/cgi/man.cgi?query=jail&amp;sektion=8&amp;format=html">jail(8)</a> manual page.</p></div></div></div><div class=sect2><h3 id=jails-tuning>14.4. Fine Tuning and Administration<a class=anchor href=#jails-tuning></a></h3><div class=paragraph><p>There are several options which can be set for any jail, and various ways of combining a host FreeBSD system with jails, to produce higher level applications. This section presents:</p></div><div class=ulist><ul><li><p>Some of the options available for tuning the behavior and security restrictions implemented by a jail installation.</p></li><li><p>Some of the high-level applications for jail management, which are available through the FreeBSD Ports Collection, and can be used to implement overall jail-based solutions.</p></li></ul></div><div class=sect3><h4 id=jails-tuning-utilities>14.4.1. System Tools for Jail Tuning in FreeBSD<a class=anchor href=#jails-tuning-utilities></a></h4><div class=paragraph><p>Fine tuning of a jail’s configuration is mostly done by setting <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a> variables. A special subtree of sysctl exists as a basis for organizing all the relevant options: the <code>security.jail.*</code> hierarchy of FreeBSD kernel options. Here is a list of the main jail-related sysctls, complete with their default value. Names should be self-explanatory, but for more information about them, please refer to the <a href="https://man.freebsd.org/cgi/man.cgi?query=jail&amp;sektion=8&amp;format=html">jail(8)</a> and <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a> manual pages.</p></div><div class=ulist><ul><li><p><code>security.jail.set_hostname_allowed: 1</code></p></li><li><p><code>security.jail.socket_unixiproute_only: 1</code></p></li><li><p><code>security.jail.sysvipc_allowed: 0</code></p></li><li><p><code>security.jail.enforce_statfs: 2</code></p></li><li><p><code>security.jail.allow_raw_sockets: 0</code></p></li><li><p><code>security.jail.chflags_allowed: 0</code></p></li><li><p><code>security.jail.jailed: 0</code></p></li></ul></div><div class=paragraph><p>These variables can be used by the system administrator of the <em>host system</em> to add or remove some of the limitations imposed by default on the <code>root</code> user. Note that there are some limitations which cannot be removed. The <code>root</code> user is not allowed to mount or unmount file systems from within a <a href="https://man.freebsd.org/cgi/man.cgi?query=jail&amp;sektion=8&amp;format=html">jail(8)</a>. The <code>root</code> inside a jail may not load or unload <a href="https://man.freebsd.org/cgi/man.cgi?query=devfs&amp;sektion=8&amp;format=html">devfs(8)</a> rulesets, set firewall rules, or do many other administrative tasks which require modifications of in-kernel data, such as setting the <code>securelevel</code> of the kernel.</p></div><div class=paragraph><p>The base system of FreeBSD contains a basic set of tools for viewing information about the active jails, and attaching to a jail to run administrative commands. The <a href="https://man.freebsd.org/cgi/man.cgi?query=jls&amp;sektion=8&amp;format=html">jls(8)</a> and <a href="https://man.freebsd.org/cgi/man.cgi?query=jexec&amp;sektion=8&amp;format=html">jexec(8)</a> commands are part of the base FreeBSD system, and can be used to perform the following simple tasks:</p></div><div class=ulist><ul><li><p>Print a list of active jails and their corresponding jail identifier (JID), IP address, hostname and path.</p></li><li><p>Attach to a running jail, from its host system, and run a command inside the jail or perform administrative tasks inside the jail itself. This is especially useful when the <code>root</code> user wants to cleanly shut down a jail. The <a href="https://man.freebsd.org/cgi/man.cgi?query=jexec&amp;sektion=8&amp;format=html">jexec(8)</a> utility can also be used to start a shell in a jail to do administration in it; for example:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># jexec 1 tcsh</span></code></pre></div></div></li></ul></div></div><div class=sect3><h4 id=jails-tuning-admintools>14.4.2. High-Level Administrative Tools in the FreeBSD Ports Collection<a class=anchor href=#jails-tuning-admintools></a></h4><div class=paragraph><p>Among the many third-party utilities for jail administration, one of the most complete and useful is <a class=package href=https://cgit.freebsd.org/ports/tree/sysutils/ezjail/>sysutils/ezjail</a>. It is a set of scripts that contribute to <a href="https://man.freebsd.org/cgi/man.cgi?query=jail&amp;sektion=8&amp;format=html">jail(8)</a> management. Please refer to <a href=#jails-ezjail>the handbook section on ezjail</a> for more information.</p></div></div><div class=sect3><h4 id=jails-updating>14.4.3. Keeping Jails Patched and up to Date<a class=anchor href=#jails-updating></a></h4><div class=paragraph><p>Jails should be kept up to date from the host operating system as attempting to patch userland from within the jail may likely fail as the default behavior in FreeBSD is to disallow the use of <a href="https://man.freebsd.org/cgi/man.cgi?query=chflags&amp;sektion=1&amp;format=html">chflags(1)</a> in a jail which prevents the replacement of some files. It is possible to change this behavior but it is recommended to use <a href="https://man.freebsd.org/cgi/man.cgi?query=freebsd-update&amp;sektion=8&amp;format=html">freebsd-update(8)</a> to maintain jails instead. Use <code>-b</code> to specify the path of the jail to be updated.</p></div><div class=paragraph><p>To update the jail to the latest patch release of the version of FreeBSD it is already running, then execute the following commands on the host:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># freebsd-update -b /here/is/the/jail fetch</span>
<span class=c># freebsd-update -b /here/is/the/jail install</span></code></pre></div></div><div class=paragraph><p>To upgrade the jail to a new major or minor version, first upgrade the host system as described in <a href=./#freebsdupdate-upgrade>“Performing Major and Minor Version Upgrades”</a>. Once the host has been upgraded and rebooted, the jail can then be upgraded. For example to upgrade from 12.0-RELEASE to 12.1-RELEASE, on the host run:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># freebsd-update -b /here/is/the/jail --currently-running 12.0-RELEASE -r 12.1-RELEASE upgrade</span>
<span class=c># freebsd-update -b /here/is/the/jail install</span>
<span class=c># service jail restart myjail</span>
<span class=c># freebsd-update -b /here/is/the/jail install</span></code></pre></div></div><div class=paragraph><p>Then, if it was a major version upgrade, reinstall all installed packages and restart the jail again. This is required because the ABI version changes when upgrading between major versions of FreeBSD. From the host:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pkg -j myjail upgrade -f</span>
<span class=c># service jail restart myjail</span></code></pre></div></div></div></div><div class=sect2><h3 id=jails-application>14.5. Updating Multiple Jails<a class=anchor href=#jails-application></a></h3><div class=paragraph><p>The management of multiple jails can become problematic because every jail has to be rebuilt from scratch whenever it is upgraded. This can be time consuming and tedious if a lot of jails are created and manually updated.</p></div><div class=paragraph><p>This section demonstrates one method to resolve this issue by safely sharing as much as is possible between jails using read-only <a href="https://man.freebsd.org/cgi/man.cgi?query=mount_nullfs&amp;sektion=8&amp;format=html">mount_nullfs(8)</a> mounts, so that updating is simpler. This makes it more attractive to put single services, such as HTTP, DNS, and SMTP, into individual jails. Additionally, it provides a simple way to add, remove, and upgrade jails.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Simpler solutions exist, such as ezjail, which provides an easier method of administering FreeBSD jails but is less versatile than this setup. ezjail is covered in more detail in <a href=#jails-ezjail>Managing Jails with ezjail</a>.</p></div></td></tr></tbody></table></div><div class=paragraph><p>The goals of the setup described in this section are:</p></div><div class=ulist><ul><li><p>Create a simple and easy to understand jail structure that does not require running a full installworld on each and every jail.</p></li><li><p>Make it easy to add new jails or remove existing ones.</p></li><li><p>Make it easy to update or upgrade existing jails.</p></li><li><p>Make it possible to run a customized FreeBSD branch.</p></li><li><p>Be paranoid about security, reducing as much as possible the possibility of compromise.</p></li><li><p>Save space and inodes, as much as possible.</p></li></ul></div><div class=paragraph><p>This design relies on a single, read-only master template which is mounted into each jail and one read-write device per jail. A device can be a separate physical disc, a partition, or a vnode backed memory device. This example uses read-write nullfs mounts.</p></div><div class=paragraph><p>The file system layout is as follows:</p></div><div class=ulist><ul><li><p>The jails are based under the <span class=filename>/home</span> partition.</p></li><li><p>Each jail will be mounted under the <span class=filename>/home/j</span> directory.</p></li><li><p>The template for each jail and the read-only partition for all of the jails is <span class=filename>/home/j/mroot</span>.</p></li><li><p>A blank directory will be created for each jail under the <span class=filename>/home/j</span> directory.</p></li><li><p>Each jail will have a <span class=filename>/s</span> directory that will be linked to the read-write portion of the system.</p></li><li><p>Each jail will have its own read-write system that is based upon <span class=filename>/home/j/skel</span>.</p></li><li><p>The read-write portion of each jail will be created in <span class=filename>/home/js</span>.</p></li></ul></div><div class=sect3><h4 id=jails-service-jails-template>14.5.1. Creating the Template<a class=anchor href=#jails-service-jails-template></a></h4><div class=paragraph><p>This section describes the steps needed to create the master template.</p></div><div class=paragraph><p>It is recommended to first update the host FreeBSD system to the latest -RELEASE branch using the instructions in <a href=./#makeworld>“Updating FreeBSD from Source”</a>. Additionally, this template uses the <a class=package href=https://cgit.freebsd.org/ports/tree/sysutils/cpdup/>sysutils/cpdup</a> package or port and portsnap will be used to download the FreeBSD Ports Collection.</p></div><div class="olist arabic procedure"><ol class=arabic><li><p>First, create a directory structure for the read-only file system which will contain the FreeBSD binaries for the jails. Then, change directory to the FreeBSD source tree and install the read-only file system to the jail template:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mkdir /home/j /home/j/mroot</span>
<span class=c># cd /usr/src</span>
<span class=c># make installworld DESTDIR=/home/j/mroot</span></code></pre></div></div></li><li><p>Next, prepare a FreeBSD Ports Collection for the jails as well as a FreeBSD source tree, which is required for mergemaster:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /home/j/mroot</span>
<span class=c># mkdir usr/ports</span>
<span class=c># portsnap -p /home/j/mroot/usr/ports fetch extract</span>
<span class=c># cpdup /usr/src /home/j/mroot/usr/src</span></code></pre></div></div></li><li><p>Create a skeleton for the read-write portion of the system:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mkdir /home/j/skel /home/j/skel/home /home/j/skel/usr-X11R6 /home/j/skel/distfiles</span>
<span class=c># mv etc /home/j/skel</span>
<span class=c># mv usr/local /home/j/skel/usr-local</span>
<span class=c># mv tmp /home/j/skel</span>
<span class=c># mv var /home/j/skel</span>
<span class=c># mv root /home/j/skel</span></code></pre></div></div></li><li><p>Use mergemaster to install missing configuration files. Then, remove the extra directories that mergemaster creates:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mergemaster -t /home/j/skel/var/tmp/temproot -D /home/j/skel -i</span>
<span class=c># cd /home/j/skel</span>
<span class=c># rm -R bin boot lib libexec mnt proc rescue sbin sys usr dev</span></code></pre></div></div></li><li><p>Now, symlink the read-write file system to the read-only file system. Ensure that the symlinks are created in the correct <span class=filename>s/</span> locations as the creation of directories in the wrong locations will cause the installation to fail.</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /home/j/mroot</span>
<span class=c># mkdir s</span>
<span class=c># ln -s s/etc etc</span>
<span class=c># ln -s s/home home</span>
<span class=c># ln -s s/root root</span>
<span class=c># ln -s ../s/usr-local usr/local</span>
<span class=c># ln -s ../s/usr-X11R6 usr/X11R6</span>
<span class=c># ln -s ../../s/distfiles usr/ports/distfiles</span>
<span class=c># ln -s s/tmp tmp</span>
<span class=c># ln -s s/var var</span></code></pre></div></div></li><li><p>As a last step, create a generic <span class=filename>/home/j/skel/etc/make.conf</span> containing this line:</p><div class="literalblock programlisting"><div class=content><pre>WRKDIRPREFIX?=  /s/portbuild</pre></div></div><div class=paragraph><p>This makes it possible to compile FreeBSD ports inside each jail. Remember that the ports directory is part of the read-only system. The custom path for <code>WRKDIRPREFIX</code> allows builds to be done in the read-write portion of every jail.</p></div></li></ol></div></div><div class=sect3><h4 id=jails-service-jails-creating>14.5.2. Creating Jails<a class=anchor href=#jails-service-jails-creating></a></h4><div class=paragraph><p>The jail template can now be used to setup and configure the jails in <span class=filename>/etc/rc.conf</span>. This example demonstrates the creation of 3 jails: <code>NS</code>, <code>MAIL</code> and <code>WWW</code>.</p></div><div class="olist arabic procedure"><ol class=arabic><li><p>Add the following lines to <span class=filename>/etc/fstab</span>, so that the read-only template for the jails and the read-write space will be available in the respective jails:</p><div class="literalblock programlisting"><div class=content><pre>/home/j/mroot   /home/j/ns     nullfs  ro  0   0
/home/j/mroot   /home/j/mail   nullfs  ro  0   0
/home/j/mroot   /home/j/www    nullfs  ro  0   0
/home/js/ns     /home/j/ns/s   nullfs  rw  0   0
/home/js/mail   /home/j/mail/s nullfs  rw  0   0
/home/js/www    /home/j/www/s  nullfs  rw  0   0</pre></div></div><div class=paragraph><p>To prevent fsck from checking nullfs mounts during boot and dump from backing up the read-only nullfs mounts of the jails, the last two columns are both set to <code>0</code>.</p></div></li><li><p>Configure the jails in <span class=filename>/etc/rc.conf</span>:</p><div class="literalblock programlisting"><div class=content><pre>jail_enable=&#34;YES&#34;
jail_set_hostname_allow=&#34;NO&#34;
jail_list=&#34;ns mail www&#34;
jail_ns_hostname=&#34;ns.example.org&#34;
jail_ns_ip=&#34;192.168.3.17&#34;
jail_ns_rootdir=&#34;/usr/home/j/ns&#34;
jail_ns_devfs_enable=&#34;YES&#34;
jail_mail_hostname=&#34;mail.example.org&#34;
jail_mail_ip=&#34;192.168.3.18&#34;
jail_mail_rootdir=&#34;/usr/home/j/mail&#34;
jail_mail_devfs_enable=&#34;YES&#34;
jail_www_hostname=&#34;www.example.org&#34;
jail_www_ip=&#34;62.123.43.14&#34;
jail_www_rootdir=&#34;/usr/home/j/www&#34;
jail_www_devfs_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>The <code>jail<em>name</em>rootdir</code> variable is set to <span class=filename>/usr/home</span> instead of <span class=filename>/home</span> because the physical path of <span class=filename>/home</span> on a default FreeBSD installation is <span class=filename>/usr/home</span>. The <code>jail<em>name</em>rootdir</code> variable must <em>not</em> be set to a path which includes a symbolic link, otherwise the jails will refuse to start.</p></div></li><li><p>Create the required mount points for the read-only file system of each jail:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mkdir /home/j/ns /home/j/mail /home/j/www</span></code></pre></div></div></li><li><p>Install the read-write template into each jail using <a class=package href=https://cgit.freebsd.org/ports/tree/sysutils/cpdup/>sysutils/cpdup</a>:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mkdir /home/js</span>
<span class=c># cpdup /home/j/skel /home/js/ns</span>
<span class=c># cpdup /home/j/skel /home/js/mail</span>
<span class=c># cpdup /home/j/skel /home/js/www</span></code></pre></div></div></li><li><p>In this phase, the jails are built and prepared to run. First, mount the required file systems for each jail, and then start them:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mount -a</span>
<span class=c># service jail start</span></code></pre></div></div></li></ol></div><div class=paragraph><p>The jails should be running now. To check if they have started correctly, use <code>jls</code>. Its output should be similar to the following:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># jls</span>
   JID  IP Address      Hostname                      Path
     3  192.168.3.17    ns.example.org                /home/j/ns
     2  192.168.3.18    mail.example.org              /home/j/mail
     1  62.123.43.14    www.example.org               /home/j/www</code></pre></div></div><div class=paragraph><p>At this point, it should be possible to log onto each jail, add new users, or configure daemons. The <code>JID</code> column indicates the jail identification number of each running jail. Use the following command to perform administrative tasks in the jail whose JID is <code>3</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># jexec 3 tcsh</span></code></pre></div></div></div><div class=sect3><h4 id=jails-service-jails-upgrading>14.5.3. Upgrading<a class=anchor href=#jails-service-jails-upgrading></a></h4><div class=paragraph><p>The design of this setup provides an easy way to upgrade existing jails while minimizing their downtime. Also, it provides a way to roll back to the older version should a problem occur.</p></div><div class="olist arabic procedure"><ol class=arabic><li><p>The first step is to upgrade the host system. Then, create a new temporary read-only template in <span class=filename>/home/j/mroot2</span>.</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mkdir /home/j/mroot2</span>
<span class=c># cd /usr/src</span>
<span class=c># make installworld DESTDIR=/home/j/mroot2</span>
<span class=c># cd /home/j/mroot2</span>
<span class=c># cpdup /usr/src usr/src</span>
<span class=c># mkdir s</span></code></pre></div></div><div class=paragraph><p>The <code>installworld</code> creates a few unnecessary directories, which should be removed:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># chflags -R 0 var</span>
<span class=c># rm -R etc var root usr/local tmp</span></code></pre></div></div></li><li><p>Recreate the read-write symlinks for the master file system:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ln -s s/etc etc</span>
<span class=c># ln -s s/root root</span>
<span class=c># ln -s s/home home</span>
<span class=c># ln -s ../s/usr-local usr/local</span>
<span class=c># ln -s ../s/usr-X11R6 usr/X11R6</span>
<span class=c># ln -s s/tmp tmp</span>
<span class=c># ln -s s/var var</span></code></pre></div></div></li><li><p>Next, stop the jails:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service jail stop</span></code></pre></div></div></li><li><p>Unmount the original file systems as the read-write systems are attached to the read-only system (<span class=filename>/s</span>):</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># umount /home/j/ns/s</span>
<span class=c># umount /home/j/ns</span>
<span class=c># umount /home/j/mail/s</span>
<span class=c># umount /home/j/mail</span>
<span class=c># umount /home/j/www/s</span>
<span class=c># umount /home/j/www</span></code></pre></div></div></li><li><p>Move the old read-only file system and replace it with the new one. This will serve as a backup and archive of the old read-only file system should something go wrong. The naming convention used here corresponds to when a new read-only file system has been created. Move the original FreeBSD Ports Collection over to the new file system to save some space and inodes:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /home/j</span>
<span class=c># mv mroot mroot.20060601</span>
<span class=c># mv mroot2 mroot</span>
<span class=c># mv mroot.20060601/usr/ports mroot/usr</span></code></pre></div></div></li><li><p>At this point the new read-only template is ready, so the only remaining task is to remount the file systems and start the jails:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mount -a</span>
<span class=c># service jail start</span></code></pre></div></div></li></ol></div><div class=paragraph><p>Use <code>jls</code> to check if the jails started correctly. Run <code>mergemaster</code> in each jail to update the configuration files.</p></div></div></div><div class=sect2><h3 id=jails-ezjail>14.6. Managing Jails with ezjail<a class=anchor href=#jails-ezjail></a></h3><div class=paragraph><p>Creating and managing multiple jails can quickly become tedious and error-prone. Dirk Engling’s ezjail automates and greatly simplifies many jail tasks. A <em>basejail</em> is created as a template. Additional jails use <a href="https://man.freebsd.org/cgi/man.cgi?query=mount_nullfs&amp;sektion=8&amp;format=html">mount_nullfs(8)</a> to share many of the basejail directories without using additional disk space. Each additional jail takes only a few megabytes of disk space before applications are installed. Upgrading the copy of the userland in the basejail automatically upgrades all of the other jails.</p></div><div class=paragraph><p>Additional benefits and features are described in detail on the ezjail web site, <a href=https://erdgeist.org/arts/software/ezjail/ class=bare>https://erdgeist.org/arts/software/ezjail/</a>.</p></div><div class=sect3><h4 id=jails-ezjail-install>14.6.1. Installing ezjail<a class=anchor href=#jails-ezjail-install></a></h4><div class=paragraph><p>Installing ezjail consists of adding a loopback interface for use in jails, installing the port or package, and enabling the service.</p></div><div id=jails-ezjail-install-procedure class="olist arabic procedure"><ol class=arabic><li><p>To keep jail loopback traffic off the host’s loopback network interface <code>lo0</code>, a second loopback interface is created by adding an entry to <span class=filename>/etc/rc.conf</span>:</p><div class="literalblock programlisting"><div class=content><pre>cloned_interfaces=&#34;lo1&#34;</pre></div></div><div class=paragraph><p>The second loopback interface <code>lo1</code> will be created when the system starts. It can also be created manually without a restart:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service netif cloneup</span>
Created clone interfaces: lo1.</code></pre></div></div><div class=paragraph><p>Jails can be allowed to use aliases of this secondary loopback interface without interfering with the host.</p></div><div class=paragraph><p>Inside a jail, access to the loopback address <code>127.0.0.1</code> is redirected to the first IP address assigned to the jail. To make the jail loopback correspond with the new <code>lo1</code> interface, that interface must be specified first in the list of interfaces and IP addresses given when creating a new jail.</p></div><div class=paragraph><p>Give each jail a unique loopback address in the <code>127.0.0.0/8</code> netblock.</p></div></li><li><p>Install <a class=package href=https://cgit.freebsd.org/ports/tree/sysutils/ezjail/>sysutils/ezjail</a>:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/ports/sysutils/ezjail</span>
<span class=c># make install clean</span></code></pre></div></div></li><li><p>Enable ezjail by adding this line to <span class=filename>/etc/rc.conf</span>:</p><div class="literalblock programlisting"><div class=content><pre>ezjail_enable=&#34;YES&#34;</pre></div></div></li><li><p>The service will automatically start on system boot. It can be started immediately for the current session:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service ezjail start</span></code></pre></div></div></li></ol></div></div><div class=sect3><h4 id=jails-ezjail-initialsetup>14.6.2. Initial Setup<a class=anchor href=#jails-ezjail-initialsetup></a></h4><div class=paragraph><p>With ezjail installed, the basejail directory structure can be created and populated. This step is only needed once on the jail host computer.</p></div><div class=paragraph><p>In both of these examples, <code>-p</code> causes the ports tree to be retrieved with <a href="https://man.freebsd.org/cgi/man.cgi?query=portsnap&amp;sektion=8&amp;format=html">portsnap(8)</a> into the basejail. That single copy of the ports directory will be shared by all the jails. Using a separate copy of the ports directory for jails isolates them from the host. The ezjailFAQ explains in more detail: <a href=http://erdgeist.org/arts/software/ezjail/#FAQ class=bare>http://erdgeist.org/arts/software/ezjail/#FAQ</a>.</p></div><div id=jails-ezjail-initialsetup-procedure class="olist arabic procedure"><ol class=arabic><li><p>To Populate the Jail with FreeBSD-RELEASE</p><div class=paragraph><p>For a basejail based on the FreeBSD RELEASE matching that of the host computer, use <code>install</code>. For example, on a host computer running FreeBSD 10-STABLE, the latest RELEASE version of FreeBSD -10 will be installed in the jail):</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ezjail-admin install -p</span></code></pre></div></div></li><li><p>To Populate the Jail with <code>installworld</code></p><div class=paragraph><p>The basejail can be installed from binaries created by <code>buildworld</code> on the host with <code>ezjail-admin update</code>.</p></div><div class=paragraph><p>In this example, FreeBSD 10-STABLE has been built from source. The jail directories are created. Then <code>installworld</code> is executed, installing the host’s <span class=filename>/usr/obj</span> into the basejail.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ezjail-admin update -i -p</span></code></pre></div></div><div class=paragraph><p>The host’s <span class=filename>/usr/src</span> is used by default. A different source directory on the host can be specified with <code>-s</code> and a path, or set with <code>ezjail_sourcetree</code> in <span class=filename>/usr/local/etc/ezjail.conf</span>.</p></div></li></ol></div><div class="admonitionblock tip"><table><tbody><tr><td class=icon><i class="fa icon-tip" title=Tip></i></td><td class=content><div class=paragraph><p>The basejail’s ports tree is shared by other jails. However, downloaded distfiles are stored in the jail that downloaded them. By default, these files are stored in <span class=filename>/var/ports/distfiles</span> within each jail. <span class=filename>/var/ports</span> inside each jail is also used as a work directory when building ports.</p></div></td></tr></tbody></table></div><div class="admonitionblock tip"><table><tbody><tr><td class=icon><i class="fa icon-tip" title=Tip></i></td><td class=content><div class=paragraph><p>The FTP protocol is used by default to download packages for the installation of the basejail. Firewall or proxy configurations can prevent or interfere with FTP transfers. The HTTP protocol works differently and avoids these problems. It can be chosen by specifying a full URL for a particular download mirror in <span class=filename>/usr/local/etc/ezjail.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>ezjail_ftphost=http://ftp.FreeBSD.org</pre></div></div><div class=paragraph><p>See <a href=./#mirrors-ftp>“FTP Sites”</a> for a list of sites.</p></div></td></tr></tbody></table></div></div><div class=sect3><h4 id=jails-ezjail-create>14.6.3. Creating and Starting a New Jail<a class=anchor href=#jails-ezjail-create></a></h4><div class=paragraph><p>New jails are created with <code>ezjail-admin create</code>. In these examples, the <code>lo1</code> loopback interface is used as described above.</p></div><div id=jails-ezjail-create-steps class="olist arabic procedure"><div class=title>Procedure: Create and Start a New Jail</div><ol class=arabic><li><p>Create the jail, specifying a name and the loopback and network interfaces to use, along with their IP addresses. In this example, the jail is named <code>dnsjail</code>.</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ezjail-admin create dnsjail &#39;lo1|127.0.1.1,em0|192.168.1.50&#39;</span></code></pre></div></div><div class="admonitionblock tip"><table><tbody><tr><td class=icon><i class="fa icon-tip" title=Tip></i></td><td class=content><div class=paragraph><p>Most network services run in jails without problems. A few network services, most notably <a href="https://man.freebsd.org/cgi/man.cgi?query=ping&amp;sektion=8&amp;format=html">ping(8)</a>, use <em>raw network sockets</em>. In jails, raw network sockets are disabled by default for security. Services that require them will not work.</p></div><div class=paragraph><p>Occasionally, a jail genuinely needs raw sockets. For example, network monitoring applications often use <a href="https://man.freebsd.org/cgi/man.cgi?query=ping&amp;sektion=8&amp;format=html">ping(8)</a> to check the availability of other computers. When raw network sockets are actually needed in a jail, they can be enabled by editing the ezjail configuration file for the individual jail, <span class=filename>/usr/local/etc/ezjail/jailname</span>. Modify the <code>parameters</code> entry:</p></div><div class="literalblock programlisting"><div class=content><pre>export jail_jailname_parameters=&#34;allow.raw_sockets=1&#34;</pre></div></div><div class=paragraph><p>Do not enable raw network sockets unless services in the jail actually require them.</p></div></td></tr></tbody></table></div></li><li><p>Start the jail:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ezjail-admin start dnsjail</span></code></pre></div></div></li><li><p>Use a console on the jail:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ezjail-admin console dnsjail</span></code></pre></div></div></li></ol></div><div class=paragraph><p>The jail is operating and additional configuration can be completed. Typical settings added at this point include:</p></div><div class="olist arabic procedure"><ol class=arabic><li><p>Set the <code>root</code> Password</p><div class=paragraph><p>Connect to the jail and set the <code>root</code> user’s password:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ezjail-admin console dnsjail</span>
<span class=c># passwd</span>
Changing <span class=nb>local </span>password <span class=k>for </span>root
New Password:
Retype New Password:</code></pre></div></div></li><li><p>Time Zone Configuration</p><div class=paragraph><p>The jail’s time zone can be set with <a href="https://man.freebsd.org/cgi/man.cgi?query=tzsetup&amp;sektion=8&amp;format=html">tzsetup(8)</a>. To avoid spurious error messages, the <a href="https://man.freebsd.org/cgi/man.cgi?query=adjkerntz&amp;sektion=8&amp;format=html">adjkerntz(8)</a> entry in <span class=filename>/etc/crontab</span> can be commented or removed. This job attempts to update the computer’s hardware clock with time zone changes, but jails are not allowed to access that hardware.</p></div></li><li><p>DNS Servers</p><div class=paragraph><p>Enter domain name server lines in <span class=filename>/etc/resolv.conf</span> so DNS works in the jail.</p></div></li><li><p>Edit <span class=filename>/etc/hosts</span></p><div class=paragraph><p>Change the address and add the jail name to the <code>localhost</code> entries in <span class=filename>/etc/hosts</span>.</p></div></li><li><p>Configure <span class=filename>/etc/rc.conf</span></p><div class=paragraph><p>Enter configuration settings in <span class=filename>/etc/rc.conf</span>. This is much like configuring a full computer. The host name and IP address are not set here. Those values are already provided by the jail configuration.</p></div></li></ol></div><div class=paragraph><p>With the jail configured, the applications for which the jail was created can be installed.</p></div><div class="admonitionblock tip"><table><tbody><tr><td class=icon><i class="fa icon-tip" title=Tip></i></td><td class=content><div class=paragraph><p>Some ports must be built with special options to be used in a jail. For example, both of the network monitoring plugin packages <a class=package href=https://cgit.freebsd.org/ports/tree/net-mgmt/nagios-plugins/>net-mgmt/nagios-plugins</a> and <a class=package href=https://cgit.freebsd.org/ports/tree/net-mgmt/monitoring-plugins/>net-mgmt/monitoring-plugins</a> have a <code>JAIL</code> option which must be enabled for them to work correctly inside a jail.</p></div></td></tr></tbody></table></div></div><div class=sect3><h4 id=jails-ezjail-update>14.6.4. Updating Jails<a class=anchor href=#jails-ezjail-update></a></h4><div class=sect4><h5 id=jails-ezjail-update-os>14.6.4.1. Updating the Operating System<a class=anchor href=#jails-ezjail-update-os></a></h5><div class=paragraph><p>Because the basejail’s copy of the userland is shared by the other jails, updating the basejail automatically updates all of the other jails. Either source or binary updates can be used.</p></div><div class=paragraph><p>To build the world from source on the host, then install it in the basejail, use:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ezjail-admin update -b</span></code></pre></div></div><div class=paragraph><p>If the world has already been compiled on the host, install it in the basejail with:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ezjail-admin update -i</span></code></pre></div></div><div class=paragraph><p>Binary updates use <a href="https://man.freebsd.org/cgi/man.cgi?query=freebsd-update&amp;sektion=8&amp;format=html">freebsd-update(8)</a>. These updates have the same limitations as if <a href="https://man.freebsd.org/cgi/man.cgi?query=freebsd-update&amp;sektion=8&amp;format=html">freebsd-update(8)</a> were being run directly. The most important one is that only -RELEASE versions of FreeBSD are available with this method.</p></div><div class=paragraph><p>Update the basejail to the latest patched release of the version of FreeBSD on the host. For example, updating from RELEASE-p1 to RELEASE-p2.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ezjail-admin update -u</span></code></pre></div></div><div class=paragraph><p>To upgrade the basejail to a new version, first upgrade the host system as described in <a href=./#freebsdupdate-upgrade>“Performing Major and Minor Version Upgrades”</a>. Once the host has been upgraded and rebooted, the basejail can then be upgraded. <a href="https://man.freebsd.org/cgi/man.cgi?query=freebsd-update&amp;sektion=8&amp;format=html">freebsd-update(8)</a> has no way of determining which version is currently installed in the basejail, so the original version must be specified. Use <a href="https://man.freebsd.org/cgi/man.cgi?query=file&amp;sektion=1&amp;format=html">file(1)</a> to determine the original version in the basejail:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># file /usr/jails/basejail/bin/sh</span>
/usr/jails/basejail/bin/sh: ELF 64-bit LSB executable, x86-64, version 1 <span class=o>(</span>FreeBSD<span class=o>)</span>, dynamically linked <span class=o>(</span>uses shared libs<span class=o>)</span>, <span class=k>for </span>FreeBSD 9.3, stripped</code></pre></div></div><div class=paragraph><p>Now use this information to perform the upgrade from <code>9.3-RELEASE</code> to the current version of the host system:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ezjail-admin update -U -s 9.3-RELEASE</span></code></pre></div></div><div class=paragraph><p>After updating the basejail, <a href="https://man.freebsd.org/cgi/man.cgi?query=mergemaster&amp;sektion=8&amp;format=html">mergemaster(8)</a> must be run to update each jail’s configuration files.</p></div><div class=paragraph><p>How to use <a href="https://man.freebsd.org/cgi/man.cgi?query=mergemaster&amp;sektion=8&amp;format=html">mergemaster(8)</a> depends on the purpose and trustworthiness of a jail. If a jail’s services or users are not trusted, then <a href="https://man.freebsd.org/cgi/man.cgi?query=mergemaster&amp;sektion=8&amp;format=html">mergemaster(8)</a> should only be run from within that jail:</p></div><div id=jails-ezjail-update-mergemaster-untrusted class=exampleblock><div class=title>Przykład 14. <a href="https://man.freebsd.org/cgi/man.cgi?query=mergemaster&amp;sektion=8&amp;format=html">mergemaster(8)</a> on Untrusted Jail</div><div class=content><div class=paragraph><p>Delete the link from the jail’s <span class=filename>/usr/src</span> into the basejail and create a new <span class=filename>/usr/src</span> in the jail as a mountpoint. Mount the host computer’s <span class=filename>/usr/src</span> read-only on the jail’s new <span class=filename>/usr/src</span> mountpoint:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># rm /usr/jails/jailname/usr/src</span>
<span class=c># mkdir /usr/jails/jailname/usr/src</span>
<span class=c># mount -t nullfs -o ro /usr/src /usr/jails/jailname/usr/src</span></code></pre></div></div><div class=paragraph><p>Get a console in the jail:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ezjail-admin console jailname</span></code></pre></div></div><div class=paragraph><p>Inside the jail, run <code>mergemaster</code>. Then exit the jail console:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/src</span>
<span class=c># mergemaster -U</span>
<span class=c># exit</span></code></pre></div></div><div class=paragraph><p>Finally, unmount the jail’s <span class=filename>/usr/src</span>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># umount /usr/jails/jailname/usr/src</span></code></pre></div></div></div></div><div id=jails-ezjail-update-mergemaster-trusted class=exampleblock><div class=title>Przykład 15. <a href="https://man.freebsd.org/cgi/man.cgi?query=mergemaster&amp;sektion=8&amp;format=html">mergemaster(8)</a> on Trusted Jail</div><div class=content><div class=paragraph><p>If the users and services in a jail are trusted, <a href="https://man.freebsd.org/cgi/man.cgi?query=mergemaster&amp;sektion=8&amp;format=html">mergemaster(8)</a> can be run from the host:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mergemaster -U -D /usr/jails/jailname</span></code></pre></div></div></div></div><div class="admonitionblock tip"><table><tbody><tr><td class=icon><i class="fa icon-tip" title=Tip></i></td><td class=content><div class=paragraph><p>After a major version update it is recommended by <a class=package href=https://cgit.freebsd.org/ports/tree/sysutils/ezjail/>sysutils/ezjail</a> to make sure your <code>pkg</code> is of the correct version. Therefore enter:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pkg-static upgrade -f pkg</span></code></pre></div></div><div class=paragraph><p>to upgrade or downgrade to the appropriate version.</p></div></td></tr></tbody></table></div></div><div class=sect4><h5 id=jails-ezjail-update-ports>14.6.4.2. Updating Ports<a class=anchor href=#jails-ezjail-update-ports></a></h5><div class=paragraph><p>The ports tree in the basejail is shared by the other jails. Updating that copy of the ports tree gives the other jails the updated version also.</p></div><div class=paragraph><p>The basejail ports tree is updated with <a href="https://man.freebsd.org/cgi/man.cgi?query=portsnap&amp;sektion=8&amp;format=html">portsnap(8)</a>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ezjail-admin update -P</span></code></pre></div></div></div></div><div class=sect3><h4 id=jails-ezjail-control>14.6.5. Controlling Jails<a class=anchor href=#jails-ezjail-control></a></h4><div class=sect4><h5 id=jails-ezjail-control-stop-start>14.6.5.1. Stopping and Starting Jails<a class=anchor href=#jails-ezjail-control-stop-start></a></h5><div class=paragraph><p>ezjail automatically starts jails when the computer is started. Jails can be manually stopped and restarted with <code>stop</code> and <code>start</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ezjail-admin stop sambajail</span>
Stopping jails: sambajail.</code></pre></div></div><div class=paragraph><p>By default, jails are started automatically when the host computer starts. Autostarting can be disabled with <code>config</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ezjail-admin config -r norun seldomjail</span></code></pre></div></div><div class=paragraph><p>This takes effect the next time the host computer is started. A jail that is already running will not be stopped.</p></div><div class=paragraph><p>Enabling autostart is very similar:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ezjail-admin config -r run oftenjail</span></code></pre></div></div></div><div class=sect4><h5 id=jails-ezjail-control-backup>14.6.5.2. Archiving and Restoring Jails<a class=anchor href=#jails-ezjail-control-backup></a></h5><div class=paragraph><p>Use <code>archive</code> to create a <span class=filename>.tar.gz</span> archive of a jail. The file name is composed from the name of the jail and the current date. Archive files are written to the archive directory, <span class=filename>/usr/jails/ezjail_archives</span>. A different archive directory can be chosen by setting <code>ezjail_archivedir</code> in the configuration file.</p></div><div class=paragraph><p>The archive file can be copied elsewhere as a backup, or an existing jail can be restored from it with <code>restore</code>. A new jail can be created from the archive, providing a convenient way to clone existing jails.</p></div><div class=paragraph><p>Stop and archive a jail named <code>wwwserver</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ezjail-admin stop wwwserver</span>
Stopping jails: wwwserver.
<span class=c># ezjail-admin archive wwwserver</span>
<span class=c># ls /usr/jails/ezjail-archives/</span>
wwwserver-201407271153.13.tar.gz</code></pre></div></div><div class=paragraph><p>Create a new jail named <code>wwwserver-clone</code> from the archive created in the previous step. Use the <span class=filename>em1</span> interface and assign a new IP address to avoid conflict with the original:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ezjail-admin create -a /usr/jails/ezjail_archives/wwwserver-201407271153.13.tar.gz wwwserver-clone &#39;lo1|127.0.3.1,em1|192.168.1.51&#39;</span></code></pre></div></div></div></div><div class=sect3><h4 id=jails-ezjail-example-bind>14.6.6. Full Example: BIND in a Jail<a class=anchor href=#jails-ezjail-example-bind></a></h4><div class=paragraph><p>Putting the BINDDNS server in a jail improves security by isolating it. This example creates a simple caching-only name server.</p></div><div class=ulist><ul><li><p>The jail will be called <code>dns1</code>.</p></li><li><p>The jail will use IP address <code>192.168.1.240</code> on the host’s <code>re0</code> interface.</p></li><li><p>The upstream ISP’s DNS servers are at <code>10.0.0.62</code> and <code>10.0.0.61</code>.</p></li><li><p>The basejail has already been created and a ports tree installed as shown in <a href=#jails-ezjail-initialsetup>Initial Setup</a>.</p></li></ul></div><div id=jails-ezjail-example-bind-steps class=exampleblock><div class=title>Przykład 16. Running BIND in a Jail</div><div class=content><div class=paragraph><p>Create a cloned loopback interface by adding a line to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>cloned_interfaces=&#34;lo1&#34;</pre></div></div><div class=paragraph><p>Immediately create the new loopback interface:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service netif cloneup</span>
Created clone interfaces: lo1.</code></pre></div></div><div class=paragraph><p>Create the jail:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ezjail-admin create dns1 &#39;lo1|127.0.2.1,re0|192.168.1.240&#39;</span></code></pre></div></div><div class=paragraph><p>Start the jail, connect to a console running on it, and perform some basic configuration:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ezjail-admin start dns1</span>
<span class=c># ezjail-admin console dns1</span>
<span class=c># passwd</span>
Changing <span class=nb>local </span>password <span class=k>for </span>root
New Password:
Retype New Password:
<span class=c># tzsetup</span>
<span class=c># sed -i .bak -e &#39;/adjkerntz/ s/^/#/&#39; /etc/crontab</span>
<span class=c># sed -i .bak -e &#39;s/127.0.0.1/127.0.2.1/g; s/localhost.my.domain/dns1.my.domain dns1/&#39; /etc/hosts</span></code></pre></div></div><div class=paragraph><p>Temporarily set the upstream DNS servers in <span class=filename>/etc/resolv.conf</span> so ports can be downloaded:</p></div><div class="literalblock programlisting"><div class=content><pre>nameserver 10.0.0.62
nameserver 10.0.0.61</pre></div></div><div class=paragraph><p>Still using the jail console, install <a class=package href=https://cgit.freebsd.org/ports/tree/dns/bind99/>dns/bind99</a>.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># make -C /usr/ports/dns/bind99 install clean</span></code></pre></div></div><div class=paragraph><p>Configure the name server by editing <span class=filename>/usr/local/etc/namedb/named.conf</span>.</p></div><div class=paragraph><p>Create an Access Control List (ACL) of addresses and networks that are permitted to send DNS queries to this name server. This section is added just before the <code>options</code> section already in the file:</p></div><div class="literalblock programlisting"><div class=content><pre>...
// or cause huge amounts of useless Internet traffic.

acl &#34;trusted&#34; {
	192.168.1.0/24;
	localhost;
	localnets;
};

options {
...</pre></div></div><div class=paragraph><p>Use the jail IP address in the <code>listen-on</code> setting to accept DNS queries from other computers on the network:</p></div><div class="literalblock programlisting"><div class=content><pre>	listen-on	{ 192.168.1.240; };</pre></div></div><div class=paragraph><p>A simple caching-only DNS name server is created by changing the <code>forwarders</code> section. The original file contains:</p></div><div class="literalblock programlisting"><div class=content><pre>/*
	forwarders {
		127.0.0.1;
	};
*/</pre></div></div><div class=paragraph><p>Uncomment the section by removing the <code>/*</code> and <code>*/</code> lines. Enter the IP addresses of the upstream DNS servers. Immediately after the <code>forwarders</code> section, add references to the <code>trusted</code> ACL defined earlier:</p></div><div class="literalblock programlisting"><div class=content><pre>	forwarders {
		10.0.0.62;
		10.0.0.61;
	};

	allow-query       { any; };
	allow-recursion   { trusted; };
	allow-query-cache { trusted; };</pre></div></div><div class=paragraph><p>Enable the service in <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>named_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>Start and test the name server:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service named start</span>
wrote key file <span class=s2>&#34;/usr/local/etc/namedb/rndc.key&#34;</span>
Starting named.
<span class=c># /usr/local/bin/dig @192.168.1.240 freebsd.org</span></code></pre></div></div><div class=paragraph><p>A response that includes</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=p>;;</span> Got answer<span class=p>;</span></code></pre></div></div><div class=paragraph><p>shows that the new DNS server is working. A long delay followed by a response including</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=p>;;</span> connection timed out<span class=p>;</span> no servers could be reached</code></pre></div></div><div class=paragraph><p>shows a problem. Check the configuration settings and make sure any local firewalls allow the new DNS access to the upstream DNS servers.</p></div><div class=paragraph><p>The new DNS server can use itself for local name resolution, just like other local computers. Set the address of the DNS server in the client computer’s <span class=filename>/etc/resolv.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>nameserver 192.168.1.240</pre></div></div><div class=paragraph><p>A local DHCP server can be configured to provide this address for a local DNS server, providing automatic configuration on DHCP clients.</p></div></div></div></div></div></div></div><div class=sect1><h2 id=mac>Rozdział 15. Mandatory Access Control<a class=anchor href=#mac></a></h2><div class=sectionbody><div class=sect2><h3 id=mac-synopsis>15.1. Synopsis<a class=anchor href=#mac-synopsis></a></h3><div class=paragraph><p>FreeBSD supports security extensions based on the POSIX®.1e draft. These security mechanisms include file system Access Control Lists (<a href=./#fs-acl>“Access Control Lists”</a>) and Mandatory Access Control (MAC). MAC allows access control modules to be loaded in order to implement security policies. Some modules provide protections for a narrow subset of the system, hardening a particular service. Others provide comprehensive labeled security across all subjects and objects. The mandatory part of the definition indicates that enforcement of controls is performed by administrators and the operating system. This is in contrast to the default security mechanism of Discretionary Access Control (DAC) where enforcement is left to the discretion of users.</p></div><div class=paragraph><p>This chapter focuses on the MAC framework and the set of pluggable security policy modules FreeBSD provides for enabling various security mechanisms.</p></div><div class=paragraph><p>After reading this chapter, you will know:</p></div><div class=ulist><ul><li><p>The terminology associated with the MAC framework.</p></li><li><p>The capabilities of MAC security policy modules as well as the difference between a labeled and non-labeled policy.</p></li><li><p>The considerations to take into account before configuring a system to use the MAC framework.</p></li><li><p>Which MAC security policy modules are included in FreeBSD and how to configure them.</p></li><li><p>How to implement a more secure environment using the MAC framework.</p></li><li><p>How to test the MAC configuration to ensure the framework has been properly implemented.</p></li></ul></div><div class=paragraph><p>Before reading this chapter, you should:</p></div><div class=ulist><ul><li><p>Understand UNIX® and FreeBSD basics (<a href=./#basics>FreeBSD Basics</a>).</p></li><li><p>Have some familiarity with security and how it pertains to FreeBSD (<a href=./#security>Security</a>).</p></li></ul></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>Improper MAC configuration may cause loss of system access, aggravation of users, or inability to access the features provided by Xorg. More importantly, MAC should not be relied upon to completely secure a system. The MAC framework only augments an existing security policy. Without sound security practices and regular security checks, the system will never be completely secure.</p></div><div class=paragraph><p>The examples contained within this chapter are for demonstration purposes and the example settings should <em>not</em> be implemented on a production system. Implementing any security policy takes a good deal of understanding, proper design, and thorough testing.</p></div></td></tr></tbody></table></div><div class=paragraph><p>While this chapter covers a broad range of security issues relating to the MAC framework, the development of new MAC security policy modules will not be covered. A number of security policy modules included with the MAC framework have specific characteristics which are provided for both testing and new module development. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=mac_test&amp;sektion=4&amp;format=html">mac_test(4)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=mac_stub&amp;sektion=4&amp;format=html">mac_stub(4)</a> and <a href="https://man.freebsd.org/cgi/man.cgi?query=mac_none&amp;sektion=4&amp;format=html">mac_none(4)</a> for more information on these security policy modules and the various mechanisms they provide.</p></div></div><div class=sect2><h3 id=mac-inline-glossary>15.2. Key Terms<a class=anchor href=#mac-inline-glossary></a></h3><div class=paragraph><p>The following key terms are used when referring to the MAC framework:</p></div><div class=ulist><ul><li><p><em>compartment</em>: a set of programs and data to be partitioned or separated, where users are given explicit access to specific component of a system. A compartment represents a grouping, such as a work group, department, project, or topic. Compartments make it possible to implement a need-to-know-basis security policy.</p></li><li><p><em>integrity</em>: the level of trust which can be placed on data. As the integrity of the data is elevated, so does the ability to trust that data.</p></li><li><p><em>level</em>: the increased or decreased setting of a security attribute. As the level increases, its security is considered to elevate as well.</p></li><li><p><em>label</em>: a security attribute which can be applied to files, directories, or other items in the system. It could be considered a confidentiality stamp. When a label is placed on a file, it describes the security properties of that file and will only permit access by files, users, and resources with a similar security setting. The meaning and interpretation of label values depends on the policy configuration. Some policies treat a label as representing the integrity or secrecy of an object while other policies might use labels to hold rules for access.</p></li><li><p><em>multilabel</em>: this property is a file system option which can be set in single-user mode using <a href="https://man.freebsd.org/cgi/man.cgi?query=tunefs&amp;sektion=8&amp;format=html">tunefs(8)</a>, during boot using <a href="https://man.freebsd.org/cgi/man.cgi?query=fstab&amp;sektion=5&amp;format=html">fstab(5)</a>, or during the creation of a new file system. This option permits an administrator to apply different MAC labels on different objects. This option only applies to security policy modules which support labeling.</p></li><li><p><em>single label</em>: a policy where the entire file system uses one label to enforce access control over the flow of data. Whenever <code>multilabel</code> is not set, all files will conform to the same label setting.</p></li><li><p><em>object</em>: an entity through which information flows under the direction of a <em>subject</em>. This includes directories, files, fields, screens, keyboards, memory, magnetic storage, printers or any other data storage or moving device. An object is a data container or a system resource. Access to an object effectively means access to its data.</p></li><li><p><em>subject</em>: any active entity that causes information to flow between <em>objects</em> such as a user, user process, or system process. On FreeBSD, this is almost always a thread acting in a process on behalf of a user.</p></li><li><p><em>policy</em>: a collection of rules which defines how objectives are to be achieved. A policy usually documents how certain items are to be handled. This chapter considers a policy to be a collection of rules which controls the flow of data and information and defines who has access to that data and information.</p></li><li><p><em>high-watermark</em>: this type of policy permits the raising of security levels for the purpose of accessing higher level information. In most cases, the original level is restored after the process is complete. Currently, the FreeBSD MAC framework does not include this type of policy.</p></li><li><p><em>low-watermark</em>: this type of policy permits lowering security levels for the purpose of accessing information which is less secure. In most cases, the original security level of the user is restored after the process is complete. The only security policy module in FreeBSD to use this is <a href="https://man.freebsd.org/cgi/man.cgi?query=mac_lomac&amp;sektion=4&amp;format=html">mac_lomac(4)</a>.</p></li><li><p><em>sensitivity</em>: usually used when discussing Multilevel Security (MLS). A sensitivity level describes how important or secret the data should be. As the sensitivity level increases, so does the importance of the secrecy, or confidentiality, of the data.</p></li></ul></div></div><div class=sect2><h3 id=mac-understandlabel>15.3. Understanding MAC Labels<a class=anchor href=#mac-understandlabel></a></h3><div class=paragraph><p>A MAC label is a security attribute which may be applied to subjects and objects throughout the system. When setting a label, the administrator must understand its implications in order to prevent unexpected or undesired behavior of the system. The attributes available on an object depend on the loaded policy module, as policy modules interpret their attributes in different ways.</p></div><div class=paragraph><p>The security label on an object is used as a part of a security access control decision by a policy. With some policies, the label contains all of the information necessary to make a decision. In other policies, the labels may be processed as part of a larger rule set.</p></div><div class=paragraph><p>There are two types of label policies: single label and multi label. By default, the system will use single label. The administrator should be aware of the pros and cons of each in order to implement policies which meet the requirements of the system’s security model.</p></div><div class=paragraph><p>A single label security policy only permits one label to be used for every subject or object. Since a single label policy enforces one set of access permissions across the entire system, it provides lower administration overhead, but decreases the flexibility of policies which support labeling. However, in many environments, a single label policy may be all that is required.</p></div><div class=paragraph><p>A single label policy is somewhat similar to DAC as <code>root</code> configures the policies so that users are placed in the appropriate categories and access levels. A notable difference is that many policy modules can also restrict <code>root</code>. Basic control over objects will then be released to the group, but <code>root</code> may revoke or modify the settings at any time.</p></div><div class=paragraph><p>When appropriate, a multi label policy can be set on a UFS file system by passing <code>multilabel</code> to <a href="https://man.freebsd.org/cgi/man.cgi?query=tunefs&amp;sektion=8&amp;format=html">tunefs(8)</a>. A multi label policy permits each subject or object to have its own independent MAC label. The decision to use a multi label or single label policy is only required for policies which implement the labeling feature, such as <code>biba</code>, <code>lomac</code>, and <code>mls</code>. Some policies, such as <code>seeotheruids</code>, <code>portacl</code> and <code>partition</code>, do not use labels at all.</p></div><div class=paragraph><p>Using a multi label policy on a partition and establishing a multi label security model can increase administrative overhead as everything in that file system has a label. This includes directories, files, and even device nodes.</p></div><div class=paragraph><p>The following command will set <code>multilabel</code> on the specified UFS file system. This may only be done in single-user mode and is not a requirement for the swap file system:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># tunefs -l enable /</span></code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Some users have experienced problems with setting the <code>multilabel</code> flag on the root partition. If this is the case, please review <a href=#mac-troubleshoot>Troubleshooting the MAC Framework</a>.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Since the multi label policy is set on a per-file system basis, a multi label policy may not be needed if the file system layout is well designed. Consider an example security MAC model for a FreeBSD web server. This machine uses the single label, <code>biba/high</code>, for everything in the default file systems. If the web server needs to run at <code>biba/low</code> to prevent write up capabilities, it could be installed to a separate UFS <span class=filename>/usr/local</span> file system set at <code>biba/low</code>.</p></div><div class=sect3><h4 id=_label_configuration>15.3.1. Label Configuration<a class=anchor href=#_label_configuration></a></h4><div class=paragraph><p>Virtually all aspects of label policy module configuration will be performed using the base system utilities. These commands provide a simple interface for object or subject configuration or the manipulation and verification of the configuration.</p></div><div class=paragraph><p>All configuration may be done using <code>setfmac</code>, which is used to set MAC labels on system objects, and <code>setpmac</code>, which is used to set the labels on system subjects. For example, to set the <code>biba</code> MAC label to <code>high</code> on <span class=filename>test</span>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># setfmac biba/high test</span></code></pre></div></div><div class=paragraph><p>If the configuration is successful, the prompt will be returned without error. A common error is <code>Permission denied</code> which usually occurs when the label is being set or modified on a restricted object. Other conditions may produce different failures. For instance, the file may not be owned by the user attempting to relabel the object, the object may not exist, or the object may be read-only. A mandatory policy will not allow the process to relabel the file, maybe because of a property of the file, a property of the process, or a property of the proposed new label value. For example, if a user running at low integrity tries to change the label of a high integrity file, or a user running at low integrity tries to change the label of a low integrity file to a high integrity label, these operations will fail.</p></div><div class=paragraph><p>The system administrator may use <code>setpmac</code> to override the policy module’s settings by assigning a different label to the invoked process:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># setfmac biba/high test</span>
Permission denied
<span class=c># setpmac biba/low setfmac biba/high test</span>
<span class=c># getfmac test</span>
<span class=nb>test</span>: biba/high</code></pre></div></div><div class=paragraph><p>For currently running processes, such as sendmail, <code>getpmac</code> is usually used instead. This command takes a process ID (PID) in place of a command name. If users attempt to manipulate a file not in their access, subject to the rules of the loaded policy modules, the <code>Operation not permitted</code> error will be displayed.</p></div></div><div class=sect3><h4 id=_predefined_labels>15.3.2. Predefined Labels<a class=anchor href=#_predefined_labels></a></h4><div class=paragraph><p>A few FreeBSD policy modules which support the labeling feature offer three predefined labels: <code>low</code>, <code>equal</code>, and <code>high</code>, where:</p></div><div class=ulist><ul><li><p><code>low</code> is considered the lowest label setting an object or subject may have. Setting this on objects or subjects blocks their access to objects or subjects marked high.</p></li><li><p><code>equal</code> sets the subject or object to be disabled or unaffected and should only be placed on objects considered to be exempt from the policy.</p></li><li><p><code>high</code> grants an object or subject the highest setting available in the Biba and MLS policy modules.</p></li></ul></div><div class=paragraph><p>Such policy modules include <a href="https://man.freebsd.org/cgi/man.cgi?query=mac_biba&amp;sektion=4&amp;format=html">mac_biba(4)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=mac_mls&amp;sektion=4&amp;format=html">mac_mls(4)</a> and <a href="https://man.freebsd.org/cgi/man.cgi?query=mac_lomac&amp;sektion=4&amp;format=html">mac_lomac(4)</a>. Each of the predefined labels establishes a different information flow directive. Refer to the manual page of the module to determine the traits of the generic label configurations.</p></div></div><div class=sect3><h4 id=_numeric_labels>15.3.3. Numeric Labels<a class=anchor href=#_numeric_labels></a></h4><div class=paragraph><p>The Biba and MLS policy modules support a numeric label which may be set to indicate the precise level of hierarchical control. This numeric level is used to partition or sort information into different groups of classification, only permitting access to that group or a higher group level. For example:</p></div><div class="literalblock programlisting"><div class=content><pre>biba/10:2+3+6(5:2+3-20:2+3+4+5+6)</pre></div></div><div class=paragraph><p>may be interpreted as "Biba Policy Label/Grade 10:Compartments 2, 3 and 6: (grade 5 …​")</p></div><div class=paragraph><p>In this example, the first grade would be considered the effective grade with effective compartments, the second grade is the low grade, and the last one is the high grade. In most configurations, such fine-grained settings are not needed as they are considered to be advanced configurations.</p></div><div class=paragraph><p>System objects only have a current grade and compartment. System subjects reflect the range of available rights in the system, and network interfaces, where they are used for access control.</p></div><div class=paragraph><p>The grade and compartments in a subject and object pair are used to construct a relationship known as <em>dominance</em>, in which a subject dominates an object, the object dominates the subject, neither dominates the other, or both dominate each other. The "both dominate" case occurs when the two labels are equal. Due to the information flow nature of Biba, a user has rights to a set of compartments that might correspond to projects, but objects also have a set of compartments. Users may have to subset their rights using <code>su</code> or <code>setpmac</code> in order to access objects in a compartment from which they are not restricted.</p></div></div><div class=sect3><h4 id=_user_labels>15.3.4. User Labels<a class=anchor href=#_user_labels></a></h4><div class=paragraph><p>Users are required to have labels so that their files and processes properly interact with the security policy defined on the system. This is configured in <span class=filename>/etc/login.conf</span> using login classes. Every policy module that uses labels will implement the user class setting.</p></div><div class=paragraph><p>To set the user class default label which will be enforced by MAC, add a <code>label</code> entry. An example <code>label</code> entry containing every policy module is displayed below. Note that in a real configuration, the administrator would never enable every policy module. It is recommended that the rest of this chapter be reviewed before any configuration is implemented.</p></div><div class="literalblock programlisting"><div class=content><pre>default:\
	:copyright=/etc/COPYRIGHT:\
	:welcome=/etc/motd:\
	:setenv=MAIL=/var/mail/$,BLOCKSIZE=K:\
	:path=~/bin:/sbin:/bin:/usr/sbin:/usr/bin:/usr/local/sbin:/usr/local/bin:\
	:manpath=/usr/shared/man /usr/local/man:\
	:nologin=/usr/sbin/nologin:\
	:cputime=1h30m:\
	:datasize=8M:\
	:vmemoryuse=100M:\
	:stacksize=2M:\
	:memorylocked=4M:\
	:memoryuse=8M:\
	:filesize=8M:\
	:coredumpsize=8M:\
	:openfiles=24:\
	:maxproc=32:\
	:priority=0:\
	:requirehome:\
	:passwordtime=91d:\
	:umask=022:\
	:ignoretime@:\
	:label=partition/13,mls/5,biba/10(5-15),lomac/10[2]:</pre></div></div><div class=paragraph><p>While users can not modify the default value, they may change their label after they login, subject to the constraints of the policy. The example above tells the Biba policy that a process’s minimum integrity is <code>5</code>, its maximum is <code>15</code>, and the default effective label is <code>10</code>. The process will run at <code>10</code> until it chooses to change label, perhaps due to the user using <code>setpmac</code>, which will be constrained by Biba to the configured range.</p></div><div class=paragraph><p>After any change to <span class=filename>login.conf</span>, the login class capability database must be rebuilt using <code>cap_mkdb</code>.</p></div><div class=paragraph><p>Many sites have a large number of users requiring several different user classes. In depth planning is required as this can become difficult to manage.</p></div></div><div class=sect3><h4 id=_network_interface_labels>15.3.5. Network Interface Labels<a class=anchor href=#_network_interface_labels></a></h4><div class=paragraph><p>Labels may be set on network interfaces to help control the flow of data across the network. Policies using network interface labels function in the same way that policies function with respect to objects. Users at high settings in Biba, for example, will not be permitted to access network interfaces with a label of <code>low</code>.</p></div><div class=paragraph><p>When setting the MAC label on network interfaces, <code>maclabel</code> may be passed to <code>ifconfig</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig bge0 maclabel biba/equal</span></code></pre></div></div><div class=paragraph><p>This example will set the MAC label of <code>biba/equal</code> on the <code>bge0</code> interface. When using a setting similar to <code>biba/high(low-high)</code>, the entire label should be quoted to prevent an error from being returned.</p></div><div class=paragraph><p>Each policy module which supports labeling has a tunable which may be used to disable the MAC label on network interfaces. Setting the label to <code>equal</code> will have a similar effect. Review the output of <code>sysctl</code>, the policy manual pages, and the information in the rest of this chapter for more information on those tunables.</p></div></div></div><div class=sect2><h3 id=mac-planning>15.4. Planning the Security Configuration<a class=anchor href=#mac-planning></a></h3><div class=paragraph><p>Before implementing any MAC policies, a planning phase is recommended. During the planning stages, an administrator should consider the implementation requirements and goals, such as:</p></div><div class=ulist><ul><li><p>How to classify information and resources available on the target systems.</p></li><li><p>Which information or resources to restrict access to along with the type of restrictions that should be applied.</p></li><li><p>Which MAC modules will be required to achieve this goal.</p></li></ul></div><div class=paragraph><p>A trial run of the trusted system and its configuration should occur <em>before</em> a MAC implementation is used on production systems. Since different environments have different needs and requirements, establishing a complete security profile will decrease the need of changes once the system goes live.</p></div><div class=paragraph><p>Consider how the MAC framework augments the security of the system as a whole. The various security policy modules provided by the MAC framework could be used to protect the network and file systems or to block users from accessing certain ports and sockets. Perhaps the best use of the policy modules is to load several security policy modules at a time in order to provide a MLS environment. This approach differs from a hardening policy, which typically hardens elements of a system which are used only for specific purposes. The downside to MLS is increased administrative overhead.</p></div><div class=paragraph><p>The overhead is minimal when compared to the lasting effect of a framework which provides the ability to pick and choose which policies are required for a specific configuration and which keeps performance overhead down. The reduction of support for unneeded policies can increase the overall performance of the system as well as offer flexibility of choice. A good implementation would consider the overall security requirements and effectively implement the various security policy modules offered by the framework.</p></div><div class=paragraph><p>A system utilizing MAC guarantees that a user will not be permitted to change security attributes at will. All user utilities, programs, and scripts must work within the constraints of the access rules provided by the selected security policy modules and control of the MAC access rules is in the hands of the system administrator.</p></div><div class=paragraph><p>It is the duty of the system administrator to carefully select the correct security policy modules. For an environment that needs to limit access control over the network, the <a href="https://man.freebsd.org/cgi/man.cgi?query=mac_portacl&amp;sektion=4&amp;format=html">mac_portacl(4)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=mac_ifoff&amp;sektion=4&amp;format=html">mac_ifoff(4)</a>, and <a href="https://man.freebsd.org/cgi/man.cgi?query=mac_biba&amp;sektion=4&amp;format=html">mac_biba(4)</a> policy modules make good starting points. For an environment where strict confidentiality of file system objects is required, consider the <a href="https://man.freebsd.org/cgi/man.cgi?query=mac_bsdextended&amp;sektion=4&amp;format=html">mac_bsdextended(4)</a> and <a href="https://man.freebsd.org/cgi/man.cgi?query=mac_mls&amp;sektion=4&amp;format=html">mac_mls(4)</a> policy modules.</p></div><div class=paragraph><p>Policy decisions could be made based on network configuration. If only certain users should be permitted access to <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;format=html">ssh(1)</a>, the <a href="https://man.freebsd.org/cgi/man.cgi?query=mac_portacl&amp;sektion=4&amp;format=html">mac_portacl(4)</a> policy module is a good choice. In the case of file systems, access to objects might be considered confidential to some users, but not to others. As an example, a large development team might be broken off into smaller projects where developers in project A might not be permitted to access objects written by developers in project B. Yet both projects might need to access objects created by developers in project C. Using the different security policy modules provided by the MAC framework, users could be divided into these groups and then given access to the appropriate objects.</p></div><div class=paragraph><p>Each security policy module has a unique way of dealing with the overall security of a system. Module selection should be based on a well thought out security policy which may require revision and reimplementation. Understanding the different security policy modules offered by the MAC framework will help administrators choose the best policies for their situations.</p></div><div class=paragraph><p>The rest of this chapter covers the available modules, describes their use and configuration, and in some cases, provides insight on applicable situations.</p></div><div class="admonitionblock caution"><table><tbody><tr><td class=icon><i class="fa icon-caution" title=Caution></i></td><td class=content><div class=paragraph><p>Implementing MAC is much like implementing a firewall since care must be taken to prevent being completely locked out of the system. The ability to revert back to a previous configuration should be considered and the implementation of MAC over a remote connection should be done with extreme caution.</p></div></td></tr></tbody></table></div></div><div class=sect2><h3 id=mac-policies>15.5. Available MAC Policies<a class=anchor href=#mac-policies></a></h3><div class=paragraph><p>The default FreeBSD kernel includes <code>options MAC</code>. This means that every module included with the MAC framework can be loaded with <code>kldload</code> as a run-time kernel module. After testing the module, add the module name to <span class=filename>/boot/loader.conf</span> so that it will load during boot. Each module also provides a kernel option for those administrators who choose to compile their own custom kernel.</p></div><div class=paragraph><p>FreeBSD includes a group of policies that will cover most security requirements. Each policy is summarized below. The last three policies support integer settings in place of the three default labels.</p></div><div class=sect3><h4 id=mac-seeotheruids>15.5.1. The MAC See Other UIDs Policy<a class=anchor href=#mac-seeotheruids></a></h4><div class=paragraph><p>Module name: <span class=filename>mac_seeotheruids.ko</span></p></div><div class=paragraph><p>Kernel configuration line: <code>options MAC_SEEOTHERUIDS</code></p></div><div class=paragraph><p>Boot option: <code>mac_seeotheruids_load="YES"</code></p></div><div class=paragraph><p>The <a href="https://man.freebsd.org/cgi/man.cgi?query=mac_seeotheruids&amp;sektion=4&amp;format=html">mac_seeotheruids(4)</a> module extends the <code>security.bsd.see_other_uids</code> and <code>security.bsd.see_other_gids sysctl</code> tunables. This option does not require any labels to be set before configuration and can operate transparently with other modules.</p></div><div class=paragraph><p>After loading the module, the following <code>sysctl</code> tunables may be used to control its features:</p></div><div class=ulist><ul><li><p><code>security.mac.seeotheruids.enabled</code> enables the module and implements the default settings which deny users the ability to view processes and sockets owned by other users.</p></li><li><p><code>security.mac.seeotheruids.specificgid_enabled</code> allows specified groups to be exempt from this policy. To exempt specific groups, use the <code>security.mac.seeotheruids.specificgid=<em>XXX</em> sysctl</code> tunable, replacing <em>XXX</em> with the numeric group ID to be exempted.</p></li><li><p><code>security.mac.seeotheruids.primarygroup_enabled</code> is used to exempt specific primary groups from this policy. When using this tunable, <code>security.mac.seeotheruids.specificgid_enabled</code> may not be set.</p></li></ul></div></div><div class=sect3><h4 id=mac-bsdextended>15.5.2. The MAC BSD Extended Policy<a class=anchor href=#mac-bsdextended></a></h4><div class=paragraph><p>Module name: <span class=filename>mac_bsdextended.ko</span></p></div><div class=paragraph><p>Kernel configuration line: <code>options MAC_BSDEXTENDED</code></p></div><div class=paragraph><p>Boot option: <code>mac_bsdextended_load="YES"</code></p></div><div class=paragraph><p>The <a href="https://man.freebsd.org/cgi/man.cgi?query=mac_bsdextended&amp;sektion=4&amp;format=html">mac_bsdextended(4)</a> module enforces a file system firewall. It provides an extension to the standard file system permissions model, permitting an administrator to create a firewall-like ruleset to protect files, utilities, and directories in the file system hierarchy. When access to a file system object is attempted, the list of rules is iterated until either a matching rule is located or the end is reached. This behavior may be changed using <code>security.mac.bsdextended.firstmatch_enabled</code>. Similar to other firewall modules in FreeBSD, a file containing the access control rules can be created and read by the system at boot time using an <a href="https://man.freebsd.org/cgi/man.cgi?query=rc.conf&amp;sektion=5&amp;format=html">rc.conf(5)</a> variable.</p></div><div class=paragraph><p>The rule list may be entered using <a href="https://man.freebsd.org/cgi/man.cgi?query=ugidfw&amp;sektion=8&amp;format=html">ugidfw(8)</a> which has a syntax similar to <a href="https://man.freebsd.org/cgi/man.cgi?query=ipfw&amp;sektion=8&amp;format=html">ipfw(8)</a>. More tools can be written by using the functions in the <a href="https://man.freebsd.org/cgi/man.cgi?query=libugidfw&amp;sektion=3&amp;format=html">libugidfw(3)</a> library.</p></div><div class=paragraph><p>After the <a href="https://man.freebsd.org/cgi/man.cgi?query=mac_bsdextended&amp;sektion=4&amp;format=html">mac_bsdextended(4)</a> module has been loaded, the following command may be used to list the current rule configuration:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ugidfw list</span>
0 slots, 0 rules</code></pre></div></div><div class=paragraph><p>By default, no rules are defined and everything is completely accessible. To create a rule which blocks all access by users but leaves <code>root</code> unaffected:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ugidfw add subject not uid root new object not uid root mode n</span></code></pre></div></div><div class=paragraph><p>While this rule is simple to implement, it is a very bad idea as it blocks all users from issuing any commands. A more realistic example blocks <code>user1</code> all access, including directory listings, to <code><em>user2</em></code>'s home directory:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ugidfw set 2 subject uid user1 object uid user2 mode n</span>
<span class=c># ugidfw set 3 subject uid user1 object gid user2 mode n</span></code></pre></div></div><div class=paragraph><p>Instead of <code>user1</code>, <code>not uid <em>user2</em></code> could be used in order to enforce the same access restrictions for all users. However, the <code>root</code> user is unaffected by these rules.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Extreme caution should be taken when working with this module as incorrect use could block access to certain parts of the file system.</p></div></td></tr></tbody></table></div></div><div class=sect3><h4 id=mac-ifoff>15.5.3. The MAC Interface Silencing Policy<a class=anchor href=#mac-ifoff></a></h4><div class=paragraph><p>Module name: <span class=filename>mac_ifoff.ko</span></p></div><div class=paragraph><p>Kernel configuration line: <code>options MAC_IFOFF</code></p></div><div class=paragraph><p>Boot option: <code>mac_ifoff_load="YES"</code></p></div><div class=paragraph><p>The <a href="https://man.freebsd.org/cgi/man.cgi?query=mac_ifoff&amp;sektion=4&amp;format=html">mac_ifoff(4)</a> module is used to disable network interfaces on the fly and to keep network interfaces from being brought up during system boot. It does not use labels and does not depend on any other MAC modules.</p></div><div class=paragraph><p>Most of this module’s control is performed through these <code>sysctl</code> tunables:</p></div><div class=ulist><ul><li><p><code>security.mac.ifoff.lo_enabled</code> enables or disables all traffic on the loopback, <a href="https://man.freebsd.org/cgi/man.cgi?query=lo&amp;sektion=4&amp;format=html">lo(4)</a>, interface.</p></li><li><p><code>security.mac.ifoff.bpfrecv_enabled</code> enables or disables all traffic on the Berkeley Packet Filter interface, <a href="https://man.freebsd.org/cgi/man.cgi?query=bpf&amp;sektion=4&amp;format=html">bpf(4)</a>.</p></li><li><p><code>security.mac.ifoff.other_enabled</code> enables or disables traffic on all other interfaces.</p></li></ul></div><div class=paragraph><p>One of the most common uses of <a href="https://man.freebsd.org/cgi/man.cgi?query=mac_ifoff&amp;sektion=4&amp;format=html">mac_ifoff(4)</a> is network monitoring in an environment where network traffic should not be permitted during the boot sequence. Another use would be to write a script which uses an application such as <a class=package href=https://cgit.freebsd.org/ports/tree/security/aide/>security/aide</a> to automatically block network traffic if it finds new or altered files in protected directories.</p></div></div><div class=sect3><h4 id=mac-portacl>15.5.4. The MAC Port Access Control List Policy<a class=anchor href=#mac-portacl></a></h4><div class=paragraph><p>Module name: <span class=filename>mac_portacl.ko</span></p></div><div class=paragraph><p>Kernel configuration line: <code>MAC_PORTACL</code></p></div><div class=paragraph><p>Boot option: <code>mac_portacl_load="YES"</code></p></div><div class=paragraph><p>The <a href="https://man.freebsd.org/cgi/man.cgi?query=mac_portacl&amp;sektion=4&amp;format=html">mac_portacl(4)</a> module is used to limit binding to local TCP and UDP ports, making it possible to allow non-<code>root</code> users to bind to specified privileged ports below 1024.</p></div><div class=paragraph><p>Once loaded, this module enables the MAC policy on all sockets. The following tunables are available:</p></div><div class=ulist><ul><li><p><code>security.mac.portacl.enabled</code> enables or disables the policy completely.</p></li><li><p><code>security.mac.portacl.port_high</code> sets the highest port number that <a href="https://man.freebsd.org/cgi/man.cgi?query=mac_portacl&amp;sektion=4&amp;format=html">mac_portacl(4)</a> protects.</p></li><li><p><code>security.mac.portacl.suser_exempt</code>, when set to a non-zero value, exempts the <code>root</code> user from this policy.</p></li><li><p><code>security.mac.portacl.rules</code> specifies the policy as a text string of the form <code>rule[,rule,…​]</code>, with as many rules as needed, and where each rule is of the form <code>idtype:id:protocol:port</code>. The <code>idtype</code> is either <code>uid</code> or <code>gid</code>. The <code>protocol</code> parameter can be <code>tcp</code> or <code>udp</code>. The <code>port</code> parameter is the port number to allow the specified user or group to bind to. Only numeric values can be used for the user ID, group ID, and port parameters.</p></li></ul></div><div class=paragraph><p>By default, ports below 1024 can only be used by privileged processes which run as <code>root</code>. For <a href="https://man.freebsd.org/cgi/man.cgi?query=mac_portacl&amp;sektion=4&amp;format=html">mac_portacl(4)</a> to allow non-privileged processes to bind to ports below 1024, set the following tunables as follows:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sysctl security.mac.portacl.port_high=1023</span>
<span class=c># sysctl net.inet.ip.portrange.reservedlow=0</span>
<span class=c># sysctl net.inet.ip.portrange.reservedhigh=0</span></code></pre></div></div><div class=paragraph><p>To prevent the <code>root</code> user from being affected by this policy, set <code>security.mac.portacl.suser_exempt</code> to a non-zero value.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sysctl security.mac.portacl.suser_exempt=1</span></code></pre></div></div><div class=paragraph><p>To allow the <code>www</code> user with UID 80 to bind to port 80 without ever needing <code>root</code> privilege:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sysctl security.mac.portacl.rules=uid:80:tcp:80</span></code></pre></div></div><div class=paragraph><p>This next example permits the user with the UID of 1001 to bind to TCP ports 110 (POP3) and 995 (POP3s):</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sysctl security.mac.portacl.rules=uid:1001:tcp:110,uid:1001:tcp:995</span></code></pre></div></div></div><div class=sect3><h4 id=mac-partition>15.5.5. The MAC Partition Policy<a class=anchor href=#mac-partition></a></h4><div class=paragraph><p>Module name: <span class=filename>mac_partition.ko</span></p></div><div class=paragraph><p>Kernel configuration line: <code>options MAC_PARTITION</code></p></div><div class=paragraph><p>Boot option: <code>mac_partition_load="YES"</code></p></div><div class=paragraph><p>The <a href="https://man.freebsd.org/cgi/man.cgi?query=mac_partition&amp;sektion=4&amp;format=html">mac_partition(4)</a> policy drops processes into specific "partitions" based on their MAC label. Most configuration for this policy is done using <a href="https://man.freebsd.org/cgi/man.cgi?query=setpmac&amp;sektion=8&amp;format=html">setpmac(8)</a>. One <code>sysctl</code> tunable is available for this policy:</p></div><div class=ulist><ul><li><p><code>security.mac.partition.enabled</code> enables the enforcement of MAC process partitions.</p></li></ul></div><div class=paragraph><p>When this policy is enabled, users will only be permitted to see their processes, and any others within their partition, but will not be permitted to work with utilities outside the scope of this partition. For instance, a user in the <code>insecure</code> class will not be permitted to access <code>top</code> as well as many other commands that must spawn a process.</p></div><div class=paragraph><p>This example adds <code>top</code> to the label set on users in the <code>insecure</code> class. All processes spawned by users in the <code>insecure</code> class will stay in the <code>partition/13</code> label.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># setpmac partition/13 top</span></code></pre></div></div><div class=paragraph><p>This command displays the partition label and the process list:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ps Zax</span></code></pre></div></div><div class=paragraph><p>This command displays another user’s process partition label and that user’s currently running processes:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ps -ZU trhodes</span></code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Users can see processes in <code>root</code>'s label unless the <a href="https://man.freebsd.org/cgi/man.cgi?query=mac_seeotheruids&amp;sektion=4&amp;format=html">mac_seeotheruids(4)</a> policy is loaded.</p></div></td></tr></tbody></table></div></div><div class=sect3><h4 id=mac-mls>15.5.6. The MAC Multi-Level Security Module<a class=anchor href=#mac-mls></a></h4><div class=paragraph><p>Module name: <span class=filename>mac_mls.ko</span></p></div><div class=paragraph><p>Kernel configuration line: <code>options MAC_MLS</code></p></div><div class=paragraph><p>Boot option: <code>mac_mls_load="YES"</code></p></div><div class=paragraph><p>The <a href="https://man.freebsd.org/cgi/man.cgi?query=mac_mls&amp;sektion=4&amp;format=html">mac_mls(4)</a> policy controls access between subjects and objects in the system by enforcing a strict information flow policy.</p></div><div class=paragraph><p>In MLS environments, a "clearance" level is set in the label of each subject or object, along with compartments. Since these clearance levels can reach numbers greater than several thousand, it would be a daunting task to thoroughly configure every subject or object. To ease this administrative overhead, three labels are included in this policy: <code>mls/low</code>, <code>mls/equal</code>, and <code>mls/high</code>, where:</p></div><div class=ulist><ul><li><p>Anything labeled with <code>mls/low</code> will have a low clearance level and not be permitted to access information of a higher level. This label also prevents objects of a higher clearance level from writing or passing information to a lower level.</p></li><li><p><code>mls/equal</code> should be placed on objects which should be exempt from the policy.</p></li><li><p><code>mls/high</code> is the highest level of clearance possible. Objects assigned this label will hold dominance over all other objects in the system; however, they will not permit the leaking of information to objects of a lower class.</p></li></ul></div><div class=paragraph><p>MLS provides:</p></div><div class=ulist><ul><li><p>A hierarchical security level with a set of non-hierarchical categories.</p></li><li><p>Fixed rules of <code>no read up, no write down</code>. This means that a subject can have read access to objects on its own level or below, but not above. Similarly, a subject can have write access to objects on its own level or above, but not beneath.</p></li><li><p>Secrecy, or the prevention of inappropriate disclosure of data.</p></li><li><p>A basis for the design of systems that concurrently handle data at multiple sensitivity levels without leaking information between secret and confidential.</p></li></ul></div><div class=paragraph><p>The following <code>sysctl</code> tunables are available:</p></div><div class=ulist><ul><li><p><code>security.mac.mls.enabled</code> is used to enable or disable the MLS policy.</p></li><li><p><code>security.mac.mls.ptys_equal</code> labels all <a href="https://man.freebsd.org/cgi/man.cgi?query=pty&amp;sektion=4&amp;format=html">pty(4)</a> devices as <code>mls/equal</code> during creation.</p></li><li><p><code>security.mac.mls.revocation_enabled</code> revokes access to objects after their label changes to a label of a lower grade.</p></li><li><p><code>security.mac.mls.max_compartments</code> sets the maximum number of compartment levels allowed on a system.</p></li></ul></div><div class=paragraph><p>To manipulate MLS labels, use <a href="https://man.freebsd.org/cgi/man.cgi?query=setfmac&amp;sektion=8&amp;format=html">setfmac(8)</a>. To assign a label to an object:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># setfmac mls/5 test</span></code></pre></div></div><div class=paragraph><p>To get the MLS label for the file <span class=filename>test</span>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># getfmac test</span></code></pre></div></div><div class=paragraph><p>Another approach is to create a master policy file in <span class=filename>/etc/</span> which specifies the MLS policy information and to feed that file to <code>setfmac</code>.</p></div><div class=paragraph><p>When using the MLS policy module, an administrator plans to control the flow of sensitive information. The default <code>block read up block write down</code> sets everything to a low state. Everything is accessible and an administrator slowly augments the confidentiality of the information.</p></div><div class=paragraph><p>Beyond the three basic label options, an administrator may group users and groups as required to block the information flow between them. It might be easier to look at the information in clearance levels using descriptive words, such as classifications of <code>Confidential</code>, <code>Secret</code>, and <code>Top Secret</code>. Some administrators instead create different groups based on project levels. Regardless of the classification method, a well thought out plan must exist before implementing a restrictive policy.</p></div><div class=paragraph><p>Some example situations for the MLS policy module include an e-commerce web server, a file server holding critical company information, and financial institution environments.</p></div></div><div class=sect3><h4 id=mac-biba>15.5.7. The MAC Biba Module<a class=anchor href=#mac-biba></a></h4><div class=paragraph><p>Module name: <span class=filename>mac_biba.ko</span></p></div><div class=paragraph><p>Kernel configuration line: <code>options MAC_BIBA</code></p></div><div class=paragraph><p>Boot option: <code>mac_biba_load="YES"</code></p></div><div class=paragraph><p>The <a href="https://man.freebsd.org/cgi/man.cgi?query=mac_biba&amp;sektion=4&amp;format=html">mac_biba(4)</a> module loads the MAC Biba policy. This policy is similar to the MLS policy with the exception that the rules for information flow are slightly reversed. This is to prevent the downward flow of sensitive information whereas the MLS policy prevents the upward flow of sensitive information.</p></div><div class=paragraph><p>In Biba environments, an "integrity" label is set on each subject or object. These labels are made up of hierarchical grades and non-hierarchical components. As a grade ascends, so does its integrity.</p></div><div class=paragraph><p>Supported labels are <code>biba/low</code>, <code>biba/equal</code>, and <code>biba/high</code>, where:</p></div><div class=ulist><ul><li><p><code>biba/low</code> is considered the lowest integrity an object or subject may have. Setting this on objects or subjects blocks their write access to objects or subjects marked as <code>biba/high</code>, but will not prevent read access.</p></li><li><p><code>biba/equal</code> should only be placed on objects considered to be exempt from the policy.</p></li><li><p><code>biba/high</code> permits writing to objects set at a lower label, but does not permit reading that object. It is recommended that this label be placed on objects that affect the integrity of the entire system.</p></li></ul></div><div class=paragraph><p>Biba provides:</p></div><div class=ulist><ul><li><p>Hierarchical integrity levels with a set of non-hierarchical integrity categories.</p></li><li><p>Fixed rules are <code>no write up, no read down</code>, the opposite of MLS. A subject can have write access to objects on its own level or below, but not above. Similarly, a subject can have read access to objects on its own level or above, but not below.</p></li><li><p>Integrity by preventing inappropriate modification of data.</p></li><li><p>Integrity levels instead of MLS sensitivity levels.</p></li></ul></div><div class=paragraph><p>The following tunables can be used to manipulate the Biba policy:</p></div><div class=ulist><ul><li><p><code>security.mac.biba.enabled</code> is used to enable or disable enforcement of the Biba policy on the target machine.</p></li><li><p><code>security.mac.biba.ptys_equal</code> is used to disable the Biba policy on <a href="https://man.freebsd.org/cgi/man.cgi?query=pty&amp;sektion=4&amp;format=html">pty(4)</a> devices.</p></li><li><p><code>security.mac.biba.revocation_enabled</code> forces the revocation of access to objects if the label is changed to dominate the subject.</p></li></ul></div><div class=paragraph><p>To access the Biba policy setting on system objects, use <code>setfmac</code> and <code>getfmac</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># setfmac biba/low test</span>
<span class=c># getfmac test</span>
<span class=nb>test</span>: biba/low</code></pre></div></div><div class=paragraph><p>Integrity, which is different from sensitivity, is used to guarantee that information is not manipulated by untrusted parties. This includes information passed between subjects and objects. It ensures that users will only be able to modify or access information they have been given explicit access to. The <a href="https://man.freebsd.org/cgi/man.cgi?query=mac_biba&amp;sektion=4&amp;format=html">mac_biba(4)</a> security policy module permits an administrator to configure which files and programs a user may see and invoke while assuring that the programs and files are trusted by the system for that user.</p></div><div class=paragraph><p>During the initial planning phase, an administrator must be prepared to partition users into grades, levels, and areas. The system will default to a high label once this policy module is enabled, and it is up to the administrator to configure the different grades and levels for users. Instead of using clearance levels, a good planning method could include topics. For instance, only allow developers modification access to the source code repository, source code compiler, and other development utilities. Other users would be grouped into other categories such as testers, designers, or end users and would only be permitted read access.</p></div><div class=paragraph><p>A lower integrity subject is unable to write to a higher integrity subject and a higher integrity subject cannot list or read a lower integrity object. Setting a label at the lowest possible grade could make it inaccessible to subjects. Some prospective environments for this security policy module would include a constrained web server, a development and test machine, and a source code repository. A less useful implementation would be a personal workstation, a machine used as a router, or a network firewall.</p></div></div><div class=sect3><h4 id=mac-lomac>15.5.8. The MAC Low-watermark Module<a class=anchor href=#mac-lomac></a></h4><div class=paragraph><p>Module name: <span class=filename>mac_lomac.ko</span></p></div><div class=paragraph><p>Kernel configuration line: <code>options MAC_LOMAC</code></p></div><div class=paragraph><p>Boot option: <code>mac_lomac_load="YES"</code></p></div><div class=paragraph><p>Unlike the MAC Biba policy, the <a href="https://man.freebsd.org/cgi/man.cgi?query=mac_lomac&amp;sektion=4&amp;format=html">mac_lomac(4)</a> policy permits access to lower integrity objects only after decreasing the integrity level to not disrupt any integrity rules.</p></div><div class=paragraph><p>The Low-watermark integrity policy works almost identically to Biba, with the exception of using floating labels to support subject demotion via an auxiliary grade compartment. This secondary compartment takes the form <code>[auxgrade]</code>. When assigning a policy with an auxiliary grade, use the syntax <code>lomac/10[2]</code>, where <code>2</code> is the auxiliary grade.</p></div><div class=paragraph><p>This policy relies on the ubiquitous labeling of all system objects with integrity labels, permitting subjects to read from low integrity objects and then downgrading the label on the subject to prevent future writes to high integrity objects using <code>[auxgrade]</code>. The policy may provide greater compatibility and require less initial configuration than Biba.</p></div><div class=paragraph><p>Like the Biba and MLS policies, <code>setfmac</code> and <code>setpmac</code> are used to place labels on system objects:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># setfmac /usr/home/trhodes lomac/high[low]</span>
<span class=c># getfmac /usr/home/trhodes lomac/high[low]</span></code></pre></div></div><div class=paragraph><p>The auxiliary grade <code>low</code> is a feature provided only by the MACLOMAC policy.</p></div></div></div><div class=sect2><h3 id=mac-userlocked>15.6. User Lock Down<a class=anchor href=#mac-userlocked></a></h3><div class=paragraph><p>This example considers a relatively small storage system with fewer than fifty users. Users will have login capabilities and are permitted to store data and access resources.</p></div><div class=paragraph><p>For this scenario, the <a href="https://man.freebsd.org/cgi/man.cgi?query=mac_bsdextended&amp;sektion=4&amp;format=html">mac_bsdextended(4)</a> and <a href="https://man.freebsd.org/cgi/man.cgi?query=mac_seeotheruids&amp;sektion=4&amp;format=html">mac_seeotheruids(4)</a> policy modules could co-exist and block access to system objects while hiding user processes.</p></div><div class=paragraph><p>Begin by adding the following line to <span class=filename>/boot/loader.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>mac_seeotheruids_load=&#34;YES&#34;</pre></div></div><div class=paragraph><p>The <a href="https://man.freebsd.org/cgi/man.cgi?query=mac_bsdextended&amp;sektion=4&amp;format=html">mac_bsdextended(4)</a> security policy module may be activated by adding this line to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>ugidfw_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>Default rules stored in <span class=filename>/etc/rc.bsdextended</span> will be loaded at system initialization. However, the default entries may need modification. Since this machine is expected only to service users, everything may be left commented out except the last two lines in order to force the loading of user owned system objects by default.</p></div><div class=paragraph><p>Add the required users to this machine and reboot. For testing purposes, try logging in as a different user across two consoles. Run <code>ps aux</code> to see if processes of other users are visible. Verify that running <a href="https://man.freebsd.org/cgi/man.cgi?query=ls&amp;sektion=1&amp;format=html">ls(1)</a> on another user’s home directory fails.</p></div><div class=paragraph><p>Do not try to test with the <code>root</code> user unless the specific <code>sysctl</code>s have been modified to block super user access.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>When a new user is added, their <a href="https://man.freebsd.org/cgi/man.cgi?query=mac_bsdextended&amp;sektion=4&amp;format=html">mac_bsdextended(4)</a> rule will not be in the ruleset list. To update the ruleset quickly, unload the security policy module and reload it again using <a href="https://man.freebsd.org/cgi/man.cgi?query=kldunload&amp;sektion=8&amp;format=html">kldunload(8)</a> and <a href="https://man.freebsd.org/cgi/man.cgi?query=kldload&amp;sektion=8&amp;format=html">kldload(8)</a>.</p></div></td></tr></tbody></table></div></div><div class=sect2><h3 id=mac-implementing>15.7. Nagios in a MAC Jail<a class=anchor href=#mac-implementing></a></h3><div class=paragraph><p>This section demonstrates the steps that are needed to implement the Nagios network monitoring system in a MAC environment. This is meant as an example which still requires the administrator to test that the implemented policy meets the security requirements of the network before using in a production environment.</p></div><div class=paragraph><p>This example requires <code>multilabel</code> to be set on each file system. It also assumes that <a class=package href=https://cgit.freebsd.org/ports/tree/net-mgmt/nagios-plugins/>net-mgmt/nagios-plugins</a>, <a class=package href=https://cgit.freebsd.org/ports/tree/net-mgmt/nagios/>net-mgmt/nagios</a>, and <a class=package href=https://cgit.freebsd.org/ports/tree/www/apache22/>www/apache22</a> are all installed, configured, and working correctly before attempting the integration into the MAC framework.</p></div><div class=sect3><h4 id=_create_an_insecure_user_class>15.7.1. Create an Insecure User Class<a class=anchor href=#_create_an_insecure_user_class></a></h4><div class=paragraph><p>Begin the procedure by adding the following user class to <span class=filename>/etc/login.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>insecure:\
:copyright=/etc/COPYRIGHT:\
:welcome=/etc/motd:\
:setenv=MAIL=/var/mail/$,BLOCKSIZE=K:\
:path=~/bin:/sbin:/bin:/usr/sbin:/usr/bin:/usr/local/sbin:/usr/local/bin
:manpath=/usr/shared/man /usr/local/man:\
:nologin=/usr/sbin/nologin:\
:cputime=1h30m:\
:datasize=8M:\
:vmemoryuse=100M:\
:stacksize=2M:\
:memorylocked=4M:\
:memoryuse=8M:\
:filesize=8M:\
:coredumpsize=8M:\
:openfiles=24:\
:maxproc=32:\
:priority=0:\
:requirehome:\
:passwordtime=91d:\
:umask=022:\
:ignoretime@:\
:label=biba/10(10-10):</pre></div></div><div class=paragraph><p>Then, add the following line to the default user class section:</p></div><div class="literalblock programlisting"><div class=content><pre>:label=biba/high:</pre></div></div><div class=paragraph><p>Save the edits and issue the following command to rebuild the database:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cap_mkdb /etc/login.conf</span></code></pre></div></div></div><div class=sect3><h4 id=_configure_users>15.7.2. Configure Users<a class=anchor href=#_configure_users></a></h4><div class=paragraph><p>Set the <code>root</code> user to the default class using:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pw usermod root -L default</span></code></pre></div></div><div class=paragraph><p>All user accounts that are not <code>root</code> will now require a login class. The login class is required, otherwise users will be refused access to common commands. The following <code>sh</code> script should do the trick:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># for x in `awk -F: &#39;($3 &gt;= 1001) &amp;&amp; ($3 != 65534) { print $1 }&#39; \</span>
	/etc/passwd<span class=sb>`</span><span class=p>;</span> <span class=k>do </span>pw usermod <span class=nv>$x</span> <span class=nt>-L</span> default<span class=p>;</span> <span class=k>done</span><span class=p>;</span></code></pre></div></div><div class=paragraph><p>Next, drop the <code>nagios</code> and <code>www</code> accounts into the insecure class:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pw usermod nagios -L insecure</span>
<span class=c># pw usermod www -L insecure</span></code></pre></div></div></div><div class=sect3><h4 id=_create_the_contexts_file>15.7.3. Create the Contexts File<a class=anchor href=#_create_the_contexts_file></a></h4><div class=paragraph><p>A contexts file should now be created as <span class=filename>/etc/policy.contexts</span>:</p></div><div class="literalblock programlisting"><div class=content><pre># This is the default BIBA policy for this system.

# System:
/var/run(/.*)?			biba/equal

/dev/(/.*)?			biba/equal

/var				biba/equal
/var/spool(/.*)?		biba/equal

/var/log(/.*)?			biba/equal

/tmp(/.*)?			biba/equal
/var/tmp(/.*)?			biba/equal

/var/spool/mqueue		biba/equal
/var/spool/clientmqueue		biba/equal

# For Nagios:
/usr/local/etc/nagios(/.*)?	biba/10

/var/spool/nagios(/.*)?		biba/10

# For apache
/usr/local/etc/apache(/.*)?	biba/10</pre></div></div><div class=paragraph><p>This policy enforces security by setting restrictions on the flow of information. In this specific configuration, users, including <code>root</code>, should never be allowed to access Nagios. Configuration files and processes that are a part of Nagios will be completely self contained or jailed.</p></div><div class=paragraph><p>This file will be read after running <code>setfsmac</code> on every file system. This example sets the policy on the root file system:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># setfsmac -ef /etc/policy.contexts /</span></code></pre></div></div><div class=paragraph><p>Next, add these edits to the main section of <span class=filename>/etc/mac.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>default_labels file ?biba
default_labels ifnet ?biba
default_labels process ?biba
default_labels socket ?biba</pre></div></div></div><div class=sect3><h4 id=_loader_configuration>15.7.4. Loader Configuration<a class=anchor href=#_loader_configuration></a></h4><div class=paragraph><p>To finish the configuration, add the following lines to <span class=filename>/boot/loader.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>mac_biba_load=&#34;YES&#34;
mac_seeotheruids_load=&#34;YES&#34;
security.mac.biba.trust_all_interfaces=1</pre></div></div><div class=paragraph><p>And the following line to the network card configuration stored in <span class=filename>/etc/rc.conf</span>. If the primary network configuration is done via DHCP, this may need to be configured manually after every system boot:</p></div><div class="literalblock programlisting"><div class=content><pre>maclabel biba/equal</pre></div></div></div><div class=sect3><h4 id=_testing_the_configuration>15.7.5. Testing the Configuration<a class=anchor href=#_testing_the_configuration></a></h4><div class=paragraph><p>First, ensure that the web server and Nagios will not be started on system initialization and reboot. Ensure that <code>root</code> cannot access any of the files in the Nagios configuration directory. If <code>root</code> can list the contents of <span class=filename>/var/spool/nagios</span>, something is wrong. Instead, a "permission denied" error should be returned.</p></div><div class=paragraph><p>If all seems well, Nagios, Apache, and Sendmail can now be started:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /etc/mail &amp;&amp; make stop &amp;&amp; \</span>
setpmac biba/equal make start <span class=o>&amp;&amp;</span> setpmac biba/10<span class=se>\(</span>10-10<span class=se>\)</span> apachectl start <span class=o>&amp;&amp;</span> <span class=se>\</span>
setpmac biba/10<span class=se>\(</span>10-10<span class=se>\)</span> /usr/local/etc/rc.d/nagios.sh forcestart</code></pre></div></div><div class=paragraph><p>Double check to ensure that everything is working properly. If not, check the log files for error messages. If needed, use <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a> to disable the <a href="https://man.freebsd.org/cgi/man.cgi?query=mac_biba&amp;sektion=4&amp;format=html">mac_biba(4)</a> security policy module and try starting everything again as usual.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>The <code>root</code> user can still change the security enforcement and edit its configuration files. The following command will permit the degradation of the security policy to a lower grade for a newly spawned shell:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># setpmac biba/10 csh</span></code></pre></div></div><div class=paragraph><p>To block this from happening, force the user into a range using <a href="https://man.freebsd.org/cgi/man.cgi?query=login.conf&amp;sektion=5&amp;format=html">login.conf(5)</a>. If <a href="https://man.freebsd.org/cgi/man.cgi?query=setpmac&amp;sektion=8&amp;format=html">setpmac(8)</a> attempts to run a command outside of the compartment’s range, an error will be returned and the command will not be executed. In this case, set root to <code>biba/high(high-high)</code>.</p></div></td></tr></tbody></table></div></div></div><div class=sect2><h3 id=mac-troubleshoot>15.8. Troubleshooting the MAC Framework<a class=anchor href=#mac-troubleshoot></a></h3><div class=paragraph><p>This section discusses common configuration errors and how to resolve them.</p></div><div class=dlist><dl><dt class=hdlist1>The <code>multilabel</code> flag does not stay enabled on the root (<span class=filename>/</span>) partition</dt><dd><p>The following steps may resolve this transient error:</p></dd></dl></div><div class="exampleblock procedure"><div class=content><div class="olist arabic"><ol class=arabic><li><p>Edit <span class=filename>/etc/fstab</span> and set the root partition to <code>ro</code> for read-only.</p></li><li><p>Reboot into single user mode.</p></li><li><p>Run <code>tunefs -l enable</code> on <span class=filename>/</span>.</p></li><li><p>Reboot the system.</p></li><li><p>Run <code>mount -urw</code><span class=filename>/</span> and change the <code>ro</code> back to <code>rw</code> in <span class=filename>/etc/fstab</span> and reboot the system again.</p></li><li><p>Double-check the output from <code>mount</code> to ensure that <code>multilabel</code> has been properly set on the root file system.</p></li></ol></div></div></div><div class=dlist><dl><dt class=hdlist1>After establishing a secure environment with MAC, Xorg no longer starts</dt><dd><p>This could be caused by the MAC <code>partition</code> policy or by a mislabeling in one of the MAC labeling policies. To debug, try the following:</p></dd></dl></div><div class="exampleblock procedure"><div class=content><div class="olist arabic"><ol class=arabic><li><p>Check the error message. If the user is in the <code>insecure</code> class, the <code>partition</code> policy may be the culprit. Try setting the user’s class back to the <code>default</code> class and rebuild the database with <code>cap_mkdb</code>. If this does not alleviate the problem, go to step two.</p></li><li><p>Double-check that the label policies are set correctly for the user, Xorg, and the <span class=filename>/dev</span> entries.</p></li><li><p>If neither of these resolve the problem, send the error message and a description of the environment to the <a href=https://lists.FreeBSD.org/subscription/freebsd-questions>FreeBSD general questions mailing list</a>.</p></li></ol></div></div></div><div class=dlist><dl><dt class=hdlist1>The <code>_secure_path: unable to stat .login_conf</code> error appears</dt><dd><p>This error can appear when a user attempts to switch from the <code>root</code> user to another user in the system. This message usually occurs when the user has a higher label setting than that of the user they are attempting to become. For instance, if <code>joe</code> has a default label of <code>biba/low</code> and <code>root</code> has a label of <code>biba/high</code>, <code>root</code> cannot view <code>joe</code>'s home directory. This will happen whether or not <code>root</code> has used <code>su</code> to become <code>joe</code> as the Biba integrity model will not permit <code>root</code> to view objects set at a lower integrity level.</p></dd><dt class=hdlist1>The system no longer recognizes <code>root</code></dt><dd><p>When this occurs, <code>whoami</code> returns <code>0</code> and <code>su</code> returns <code>who are you?</code>.</p><div class=paragraph><p>This can happen if a labeling policy has been disabled by <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a> or the policy module was unloaded. If the policy is disabled, the login capabilities database needs to be reconfigured. Double check <span class=filename>/etc/login.conf</span> to ensure that all <code>label</code> options have been removed and rebuild the database with <code>cap_mkdb</code>.</p></div><div class=paragraph><p>This may also happen if a policy restricts access to <span class=filename>master.passwd</span>. This is usually caused by an administrator altering the file under a label which conflicts with the general policy being used by the system. In these cases, the user information would be read by the system and access would be blocked as the file has inherited the new label. Disable the policy using <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a> and everything should return to normal.</p></div></dd></dl></div></div></div></div><div class=sect1><h2 id=audit>Rozdział 16. Security Event Auditing<a class=anchor href=#audit></a></h2><div class=sectionbody><div class=sect2><h3 id=audit-synopsis>16.1. Synopsis<a class=anchor href=#audit-synopsis></a></h3><div class=paragraph><p>The FreeBSD operating system includes support for security event auditing. Event auditing supports reliable, fine-grained, and configurable logging of a variety of security-relevant system events, including logins, configuration changes, and file and network access. These log records can be invaluable for live system monitoring, intrusion detection, and postmortem analysis. FreeBSD implements Sun™'s published Basic Security Module (BSM) Application Programming Interface (API) and file format, and is interoperable with the Solaris™ and Mac OS® X audit implementations.</p></div><div class=paragraph><p>This chapter focuses on the installation and configuration of event auditing. It explains audit policies and provides an example audit configuration.</p></div><div class=paragraph><p>After reading this chapter, you will know:</p></div><div class=ulist><ul><li><p>What event auditing is and how it works.</p></li><li><p>How to configure event auditing on FreeBSD for users and processes.</p></li><li><p>How to review the audit trail using the audit reduction and review tools.</p></li></ul></div><div class=paragraph><p>Before reading this chapter, you should:</p></div><div class=ulist><ul><li><p>Understand UNIX® and FreeBSD basics (<a href=./#basics>FreeBSD Basics</a>).</p></li><li><p>Be familiar with the basics of kernel configuration/compilation (<a href=./#kernelconfig>Configuring the FreeBSD Kernel</a>).</p></li><li><p>Have some familiarity with security and how it pertains to FreeBSD (<a href=./#security>Security</a>).</p></li></ul></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>The audit facility has some known limitations. Not all security-relevant system events are auditable and some login mechanisms, such as Xorg-based display managers and third-party daemons, do not properly configure auditing for user login sessions.</p></div><div class=paragraph><p>The security event auditing facility is able to generate very detailed logs of system activity. On a busy system, trail file data can be very large when configured for high detail, exceeding gigabytes a week in some configurations. Administrators should take into account the disk space requirements associated with high volume audit configurations. For example, it may be desirable to dedicate a file system to <span class=filename>/var/audit</span> so that other file systems are not affected if the audit file system becomes full.</p></div></td></tr></tbody></table></div></div><div class=sect2><h3 id=audit-inline-glossary>16.2. Key Terms<a class=anchor href=#audit-inline-glossary></a></h3><div class=paragraph><p>The following terms are related to security event auditing:</p></div><div class=ulist><ul><li><p><em>event</em>: an auditable event is any event that can be logged using the audit subsystem. Examples of security-relevant events include the creation of a file, the building of a network connection, or a user logging in. Events are either "attributable", meaning that they can be traced to an authenticated user, or "non-attributable". Examples of non-attributable events are any events that occur before authentication in the login process, such as bad password attempts.</p></li><li><p><em>class</em>: a named set of related events which are used in selection expressions. Commonly used classes of events include "file creation" (fc), "exec" (ex), and "login_logout" (lo).</p></li><li><p><em>record</em>: an audit log entry describing a security event. Records contain a record event type, information on the subject (user) performing the action, date and time information, information on any objects or arguments, and a success or failure condition.</p></li><li><p><em>trail</em>: a log file consisting of a series of audit records describing security events. Trails are in roughly chronological order with respect to the time events completed. Only authorized processes are allowed to commit records to the audit trail.</p></li><li><p><em>selection expression</em>: a string containing a list of prefixes and audit event class names used to match events.</p></li><li><p><em>preselection</em>: the process by which the system identifies which events are of interest to the administrator. The preselection configuration uses a series of selection expressions to identify which classes of events to audit for which users, as well as global settings that apply to both authenticated and unauthenticated processes.</p></li><li><p><em>reduction</em>: the process by which records from existing audit trails are selected for preservation, printing, or analysis. Likewise, the process by which undesired audit records are removed from the audit trail. Using reduction, administrators can implement policies for the preservation of audit data. For example, detailed audit trails might be kept for one month, but after that, trails might be reduced in order to preserve only login information for archival purposes.</p></li></ul></div></div><div class=sect2><h3 id=audit-config>16.3. Audit Configuration<a class=anchor href=#audit-config></a></h3><div class=paragraph><p>User space support for event auditing is installed as part of the base FreeBSD operating system. Kernel support is available in the <span class=filename>GENERIC</span> kernel by default, and <a href="https://man.freebsd.org/cgi/man.cgi?query=auditd&amp;sektion=8&amp;format=html">auditd(8)</a> can be enabled by adding the following line to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>auditd_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>Then, start the audit daemon:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service auditd start</span></code></pre></div></div><div class=paragraph><p>Users who prefer to compile a custom kernel must include the following line in their custom kernel configuration file:</p></div><div class="literalblock programlisting"><div class=content><pre>options	AUDIT</pre></div></div><div class=sect3><h4 id=_event_selection_expressions>16.3.1. Event Selection Expressions<a class=anchor href=#_event_selection_expressions></a></h4><div class=paragraph><p>Selection expressions are used in a number of places in the audit configuration to determine which events should be audited. Expressions contain a list of event classes to match. Selection expressions are evaluated from left to right, and two expressions are combined by appending one onto the other.</p></div><div class=paragraph><p><a href=#event-selection>Default Audit Event Classes</a> summarizes the default audit event classes:</p></div><table id=event-selection class="tableblock frame-none grid-all stretch"><caption class=title>Tabela 13. Default Audit Event Classes</caption><col style=width:33.3333%><col style=width:33.3333%><col style=width:33.3334%><thead><tr><th class="tableblock halign-left valign-top">Class Name</th><th class="tableblock halign-left valign-top">Description</th><th class="tableblock halign-left valign-top">Action</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock>all</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>all</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Match all event classes.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>aa</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>authentication and authorization</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>ad</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>administrative</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Administrative actions performed on the system as a whole.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>ap</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>application</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Application defined action.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>cl</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>file close</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Audit calls to the <code>close</code> system call.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>ex</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>exec</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Audit program execution. Auditing of command line arguments and environmental variables is controlled via <a href="https://man.freebsd.org/cgi/man.cgi?query=audit_control&amp;sektion=5&amp;format=html">audit_control(5)</a> using the <code>argv</code> and <code>envv</code> parameters to the <code>policy</code> setting.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>fa</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>file attribute access</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Audit the access of object attributes such as <a href="https://man.freebsd.org/cgi/man.cgi?query=stat&amp;sektion=1&amp;format=html">stat(1)</a> and <a href="https://man.freebsd.org/cgi/man.cgi?query=pathconf&amp;sektion=2&amp;format=html">pathconf(2)</a>.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>fc</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>file create</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Audit events where a file is created as a result.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>fd</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>file delete</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Audit events where file deletion occurs.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>fm</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>file attribute modify</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Audit events where file attribute modification occurs, such as by <a href="https://man.freebsd.org/cgi/man.cgi?query=chown&amp;sektion=8&amp;format=html">chown(8)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=chflags&amp;sektion=1&amp;format=html">chflags(1)</a>, and <a href="https://man.freebsd.org/cgi/man.cgi?query=flock&amp;sektion=2&amp;format=html">flock(2)</a>.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>fr</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>file read</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Audit events in which data is read or files are opened for reading.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>fw</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>file write</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Audit events in which data is written or files are written or modified.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>io</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>ioctl</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Audit use of the <code>ioctl</code> system call.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>ip</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>ipc</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Audit various forms of Inter-Process Communication, including POSIX pipes and System V IPC operations.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>lo</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>login_logout</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Audit <a href="https://man.freebsd.org/cgi/man.cgi?query=login&amp;sektion=1&amp;format=html">login(1)</a> and <a href="https://man.freebsd.org/cgi/man.cgi?query=logout&amp;sektion=1&amp;format=html">logout(1)</a> events.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>na</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>non attributable</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Audit non-attributable events.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>no</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>invalid class</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Match no audit events.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>nt</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>network</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Audit events related to network actions such as <a href="https://man.freebsd.org/cgi/man.cgi?query=connect&amp;sektion=2&amp;format=html">connect(2)</a> and <a href="https://man.freebsd.org/cgi/man.cgi?query=accept&amp;sektion=2&amp;format=html">accept(2)</a>.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>ot</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>other</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Audit miscellaneous events.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>pc</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>process</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Audit process operations such as <a href="https://man.freebsd.org/cgi/man.cgi?query=exec&amp;sektion=3&amp;format=html">exec(3)</a> and <a href="https://man.freebsd.org/cgi/man.cgi?query=exit&amp;sektion=3&amp;format=html">exit(3)</a>.</p></td></tr></tbody></table><div class=paragraph><p>These audit event classes may be customized by modifying the <span class=filename>audit_class</span> and <span class=filename>audit_event</span> configuration files.</p></div><div class=paragraph><p>Each audit event class may be combined with a prefix indicating whether successful/failed operations are matched, and whether the entry is adding or removing matching for the class and type. <a href=#event-prefixes>Prefixes for Audit Event Classes</a> summarizes the available prefixes:</p></div><table id=event-prefixes class="tableblock frame-none grid-all stretch"><caption class=title>Tabela 14. Prefixes for Audit Event Classes</caption><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">Prefix</th><th class="tableblock halign-left valign-top">Action</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock>+</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Audit successful events in this class.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>-</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Audit failed events in this class.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>^</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Audit neither successful nor failed events in this class.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>^+</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Do not audit successful events in this class.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>^-</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Do not audit failed events in this class.</p></td></tr></tbody></table><div class=paragraph><p>If no prefix is present, both successful and failed instances of the event will be audited.</p></div><div class=paragraph><p>The following example selection string selects both successful and failed login/logout events, but only successful execution events:</p></div><div class="literalblock programlisting"><div class=content><pre>lo,+ex</pre></div></div></div><div class=sect3><h4 id=_configuration_files>16.3.2. Configuration Files<a class=anchor href=#_configuration_files></a></h4><div class=paragraph><p>The following configuration files for security event auditing are found in <span class=filename>/etc/security</span>:</p></div><div class=ulist><ul><li><p><span class=filename>audit_class</span>: contains the definitions of the audit classes.</p></li><li><p><span class=filename>audit_control</span>: controls aspects of the audit subsystem, such as default audit classes, minimum disk space to leave on the audit log volume, and maximum audit trail size.</p></li><li><p><span class=filename>audit_event</span>: textual names and descriptions of system audit events and a list of which classes each event is in.</p></li><li><p><span class=filename>audit_user</span>: user-specific audit requirements to be combined with the global defaults at login.</p></li><li><p><span class=filename>audit_warn</span>: a customizable shell script used by <a href="https://man.freebsd.org/cgi/man.cgi?query=auditd&amp;sektion=8&amp;format=html">auditd(8)</a> to generate warning messages in exceptional situations, such as when space for audit records is running low or when the audit trail file has been rotated.</p></li></ul></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>Audit configuration files should be edited and maintained carefully, as errors in configuration may result in improper logging of events.</p></div></td></tr></tbody></table></div><div class=paragraph><p>In most cases, administrators will only need to modify <span class=filename>audit_control</span> and <span class=filename>audit_user</span>. The first file controls system-wide audit properties and policies and the second file may be used to fine-tune auditing by user.</p></div><div class=sect4><h5 id=audit-auditcontrol>16.3.2.1. The <span class=filename>audit_control</span> File<a class=anchor href=#audit-auditcontrol></a></h5><div class=paragraph><p>A number of defaults for the audit subsystem are specified in <span class=filename>audit_control</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>dir:/var/audit
dist:off
flags:lo,aa
minfree:5
naflags:lo,aa
policy:cnt,argv
filesz:2M
expire-after:10M</pre></div></div><div class=paragraph><p>The <code>dir</code> entry is used to set one or more directories where audit logs will be stored. If more than one directory entry appears, they will be used in order as they fill. It is common to configure audit so that audit logs are stored on a dedicated file system, in order to prevent interference between the audit subsystem and other subsystems if the file system fills.</p></div><div class=paragraph><p>If the <code>dist</code> field is set to <code>on</code> or <code>yes</code>, hard links will be created to all trail files in <span class=filename>/var/audit/dist</span>.</p></div><div class=paragraph><p>The <code>flags</code> field sets the system-wide default preselection mask for attributable events. In the example above, successful and failed login/logout events as well as authentication and authorization are audited for all users.</p></div><div class=paragraph><p>The <code>minfree</code> entry defines the minimum percentage of free space for the file system where the audit trail is stored.</p></div><div class=paragraph><p>The <code>naflags</code> entry specifies audit classes to be audited for non-attributed events, such as the login/logout process and authentication and authorization.</p></div><div class=paragraph><p>The <code>policy</code> entry specifies a comma-separated list of policy flags controlling various aspects of audit behavior. The <code>cnt</code> indicates that the system should continue running despite an auditing failure (this flag is highly recommended). The other flag, <code>argv</code>, causes command line arguments to the <a href="https://man.freebsd.org/cgi/man.cgi?query=execve&amp;sektion=2&amp;format=html">execve(2)</a> system call to be audited as part of command execution.</p></div><div class=paragraph><p>The <code>filesz</code> entry specifies the maximum size for an audit trail before automatically terminating and rotating the trail file. A value of <code>0</code> disables automatic log rotation. If the requested file size is below the minimum of 512k, it will be ignored and a log message will be generated.</p></div><div class=paragraph><p>The <code>expire-after</code> field specifies when audit log files will expire and be removed.</p></div></div><div class=sect4><h5 id=audit-audituser>16.3.2.2. The <span class=filename>audit_user</span> File<a class=anchor href=#audit-audituser></a></h5><div class=paragraph><p>The administrator can specify further audit requirements for specific users in <span class=filename>audit_user</span>. Each line configures auditing for a user via two fields: the <code>alwaysaudit</code> field specifies a set of events that should always be audited for the user, and the <code>neveraudit</code> field specifies a set of events that should never be audited for the user.</p></div><div class=paragraph><p>The following example entries audit login/logout events and successful command execution for <code>root</code> and file creation and successful command execution for <code>www</code>. If used with the default <span class=filename>audit_control</span>, the <code>lo</code> entry for <code>root</code> is redundant, and login/logout events will also be audited for <code>www</code>.</p></div><div class="literalblock programlisting"><div class=content><pre>root:lo,+ex:no
www:fc,+ex:no</pre></div></div></div></div></div><div class=sect2><h3 id=audit-administration>16.4. Working with Audit Trails<a class=anchor href=#audit-administration></a></h3><div class=paragraph><p>Since audit trails are stored in the BSM binary format, several built-in tools are available to modify or convert these trails to text. To convert trail files to a simple text format, use <code>praudit</code>. To reduce the audit trail file for analysis, archiving, or printing purposes, use <code>auditreduce</code>. This utility supports a variety of selection parameters, including event type, event class, user, date or time of the event, and the file path or object acted on.</p></div><div class=paragraph><p>For example, to dump the entire contents of a specified audit log in plain text:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># praudit /var/audit/AUDITFILE</span></code></pre></div></div><div class=paragraph><p>Where <em>AUDITFILE</em> is the audit log to dump.</p></div><div class=paragraph><p>Audit trails consist of a series of audit records made up of tokens, which <code>praudit</code> prints sequentially, one per line. Each token is of a specific type, such as <code>header</code> (an audit record header) or <code>path</code> (a file path from a name lookup). The following is an example of an <code>execve</code> event:</p></div><div class="literalblock programlisting"><div class=content><pre>header,133,10,execve(2),0,Mon Sep 25 15:58:03 2006, + 384 msec
exec arg,finger,doug
path,/usr/bin/finger
attribute,555,root,wheel,90,24918,104944
subject,robert,root,wheel,root,wheel,38439,38032,42086,128.232.9.100
return,success,0
trailer,133</pre></div></div><div class=paragraph><p>This audit represents a successful <code>execve</code> call, in which the command <code>finger doug</code> has been run. The <code>exec arg</code> token contains the processed command line presented by the shell to the kernel. The <code>path</code> token holds the path to the executable as looked up by the kernel. The <code>attribute</code> token describes the binary and includes the file mode. The <code>subject</code> token stores the audit user ID, effective user ID and group ID, real user ID and group ID, process ID, session ID, port ID, and login address. Notice that the audit user ID and real user ID differ as the user <code>robert</code> switched to the <code>root</code> account before running this command, but it is audited using the original authenticated user. The <code>return</code> token indicates the successful execution and the <code>trailer</code> concludes the record.</p></div><div class=paragraph><p>XML output format is also supported and can be selected by including <code>-x</code>.</p></div><div class=paragraph><p>Since audit logs may be very large, a subset of records can be selected using <code>auditreduce</code>. This example selects all audit records produced for the user <code>trhodes</code> stored in <span class=filename>AUDITFILE</span>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># auditreduce -u trhodes /var/audit/AUDITFILE | praudit</span></code></pre></div></div><div class=paragraph><p>Members of the <code>audit</code> group have permission to read audit trails in <span class=filename>/var/audit</span>. By default, this group is empty, so only the <code>root</code> user can read audit trails. Users may be added to the <code>audit</code> group in order to delegate audit review rights. As the ability to track audit log contents provides significant insight into the behavior of users and processes, it is recommended that the delegation of audit review rights be performed with caution.</p></div><div class=sect3><h4 id=_live_monitoring_using_audit_pipes>16.4.1. Live Monitoring Using Audit Pipes<a class=anchor href=#_live_monitoring_using_audit_pipes></a></h4><div class=paragraph><p>Audit pipes are cloning pseudo-devices which allow applications to tap the live audit record stream. This is primarily of interest to authors of intrusion detection and system monitoring applications. However, the audit pipe device is a convenient way for the administrator to allow live monitoring without running into problems with audit trail file ownership or log rotation interrupting the event stream. To track the live audit event stream:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># praudit /dev/auditpipe</span></code></pre></div></div><div class=paragraph><p>By default, audit pipe device nodes are accessible only to the <code>root</code> user. To make them accessible to the members of the <code>audit</code> group, add a <code>devfs</code> rule to <span class=filename>/etc/devfs.rules</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>add path &#39;auditpipe*&#39; mode 0440 group audit</pre></div></div><div class=paragraph><p>See <a href="https://man.freebsd.org/cgi/man.cgi?query=devfs.rules&amp;sektion=5&amp;format=html">devfs.rules(5)</a> for more information on configuring the devfs file system.</p></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>It is easy to produce audit event feedback cycles, in which the viewing of each audit event results in the generation of more audit events. For example, if all network I/O is audited, and <code>praudit</code> is run from an SSH session, a continuous stream of audit events will be generated at a high rate, as each event being printed will generate another event. For this reason, it is advisable to run <code>praudit</code> on an audit pipe device from sessions without fine-grained I/O auditing.</p></div></td></tr></tbody></table></div></div><div class=sect3><h4 id=_rotating_and_compressing_audit_trail_files>16.4.2. Rotating and Compressing Audit Trail Files<a class=anchor href=#_rotating_and_compressing_audit_trail_files></a></h4><div class=paragraph><p>Audit trails are written to by the kernel and managed by the audit daemon, <a href="https://man.freebsd.org/cgi/man.cgi?query=auditd&amp;sektion=8&amp;format=html">auditd(8)</a>. Administrators should not attempt to use <a href="https://man.freebsd.org/cgi/man.cgi?query=newsyslog.conf&amp;sektion=5&amp;format=html">newsyslog.conf(5)</a> or other tools to directly rotate audit logs. Instead, <code>audit</code> should be used to shut down auditing, reconfigure the audit system, and perform log rotation. The following command causes the audit daemon to create a new audit log and signal the kernel to switch to using the new log. The old log will be terminated and renamed, at which point it may then be manipulated by the administrator:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># audit -n</span></code></pre></div></div><div class=paragraph><p>If <a href="https://man.freebsd.org/cgi/man.cgi?query=auditd&amp;sektion=8&amp;format=html">auditd(8)</a> is not currently running, this command will fail and an error message will be produced.</p></div><div class=paragraph><p>Adding the following line to <span class=filename>/etc/crontab</span> will schedule this rotation every twelve hours:</p></div><div class="literalblock programlisting"><div class=content><pre>0     */12       *       *       *       root    /usr/sbin/audit -n</pre></div></div><div class=paragraph><p>The change will take effect once <span class=filename>/etc/crontab</span> is saved.</p></div><div class=paragraph><p>Automatic rotation of the audit trail file based on file size is possible using <code>filesz</code> in <span class=filename>audit_control</span> as described in <a href=#audit-auditcontrol>The <span class=filename>audit_control</span> File</a>.</p></div><div class=paragraph><p>As audit trail files can become very large, it is often desirable to compress or otherwise archive trails once they have been closed by the audit daemon. The <span class=filename>audit_warn</span> script can be used to perform customized operations for a variety of audit-related events, including the clean termination of audit trails when they are rotated. For example, the following may be added to <span class=filename>/etc/security/audit_warn</span> to compress audit trails on close:</p></div><div class="literalblock programlisting"><div class=content><pre>#
# Compress audit trail files on close.
#
if [ &#34;$1&#34; = closefile ]; then
        gzip -9 $2
fi</pre></div></div><div class=paragraph><p>Other archiving activities might include copying trail files to a centralized server, deleting old trail files, or reducing the audit trail to remove unneeded records. This script will be run only when audit trail files are cleanly terminated, so will not be run on trails left unterminated following an improper shutdown.</p></div></div></div></div></div><div class=sect1><h2 id=disks>Rozdział 17. Storage<a class=anchor href=#disks></a></h2><div class=sectionbody><div class=sect2><h3 id=disks-synopsis>17.1. Synopsis<a class=anchor href=#disks-synopsis></a></h3><div class=paragraph><p>This chapter covers the use of disks and storage media in FreeBSD. This includes SCSI and IDE disks, CD and DVD media, memory-backed disks, and USB storage devices.</p></div><div class=paragraph><p>After reading this chapter, you will know:</p></div><div class=ulist><ul><li><p>How to add additional hard disks to a FreeBSD system.</p></li><li><p>How to grow the size of a disk’s partition on FreeBSD.</p></li><li><p>How to configure FreeBSD to use USB storage devices.</p></li><li><p>How to use CD and DVD media on a FreeBSD system.</p></li><li><p>How to use the backup programs available under FreeBSD.</p></li><li><p>How to set up memory disks.</p></li><li><p>What file system snapshots are and how to use them efficiently.</p></li><li><p>How to use quotas to limit disk space usage.</p></li><li><p>How to encrypt disks and swap to secure them against attackers.</p></li><li><p>How to configure a highly available storage network.</p></li></ul></div><div class=paragraph><p>Before reading this chapter, you should:</p></div><div class=ulist><ul><li><p>Know how to <a href=./#kernelconfig>configure and install a new FreeBSD kernel</a>.</p></li></ul></div></div><div class=sect2><h3 id=disks-adding>17.2. Adding Disks<a class=anchor href=#disks-adding></a></h3><div class=paragraph><p>This section describes how to add a new SATA disk to a machine that currently only has a single drive. First, turn off the computer and install the drive in the computer following the instructions of the computer, controller, and drive manufacturers. Reboot the system and become <code>root</code>.</p></div><div class=paragraph><p>Inspect <span class=filename>/var/run/dmesg.boot</span> to ensure the new disk was found. In this example, the newly added SATA drive will appear as <span class=filename>ada1</span>.</p></div><div class=paragraph><p>For this example, a single large partition will be created on the new disk. The <a href=http://en.wikipedia.org/wiki/GUID_Partition_Table>GPT</a> partitioning scheme will be used in preference to the older and less versatile MBR scheme.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>If the disk to be added is not blank, old partition information can be removed with <code>gpart delete</code>. See <a href="https://man.freebsd.org/cgi/man.cgi?query=gpart&amp;sektion=8&amp;format=html">gpart(8)</a> for details.</p></div></td></tr></tbody></table></div><div class=paragraph><p>The partition scheme is created, and then a single partition is added. To improve performance on newer disks with larger hardware block sizes, the partition is aligned to one megabyte boundaries:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># gpart create -s GPT ada1</span>
<span class=c># gpart add -t freebsd-ufs -a 1M ada1</span></code></pre></div></div><div class=paragraph><p>Depending on use, several smaller partitions may be desired. See <a href="https://man.freebsd.org/cgi/man.cgi?query=gpart&amp;sektion=8&amp;format=html">gpart(8)</a> for options to create partitions smaller than a whole disk.</p></div><div class=paragraph><p>The disk partition information can be viewed with <code>gpart show</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% gpart show ada1
<span class=o>=&gt;</span>        34  1465146988  ada1  GPT  <span class=o>(</span>699G<span class=o>)</span>
          34        2014        - free -  <span class=o>(</span>1.0M<span class=o>)</span>
        2048  1465143296     1  freebsd-ufs  <span class=o>(</span>699G<span class=o>)</span>
  1465145344        1678        - free -  <span class=o>(</span>839K<span class=o>)</span></code></pre></div></div><div class=paragraph><p>A file system is created in the new partition on the new disk:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># newfs -U /dev/ada1p1</span></code></pre></div></div><div class=paragraph><p>An empty directory is created as a <em>mountpoint</em>, a location for mounting the new disk in the original disk’s file system:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mkdir /newdisk</span></code></pre></div></div><div class=paragraph><p>Finally, an entry is added to <span class=filename>/etc/fstab</span> so the new disk will be mounted automatically at startup:</p></div><div class="literalblock programlisting"><div class=content><pre>/dev/ada1p1	/newdisk	ufs	rw	2	2</pre></div></div><div class=paragraph><p>The new disk can be mounted manually, without restarting the system:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mount /newdisk</span></code></pre></div></div></div><div class=sect2><h3 id=disks-growing>17.3. Resizing and Growing Disks<a class=anchor href=#disks-growing></a></h3><div class=paragraph><p>A disk’s capacity can increase without any changes to the data already present. This happens commonly with virtual machines, when the virtual disk turns out to be too small and is enlarged. Sometimes a disk image is written to a USB memory stick, but does not use the full capacity. Here we describe how to resize or <em>grow</em> disk contents to take advantage of increased capacity.</p></div><div class=paragraph><p>Determine the device name of the disk to be resized by inspecting <span class=filename>/var/run/dmesg.boot</span>. In this example, there is only one SATA disk in the system, so the drive will appear as <span class=filename>ada0</span>.</p></div><div class=paragraph><p>List the partitions on the disk to see the current configuration:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># gpart show ada0</span>
<span class=o>=&gt;</span>      34  83886013  ada0  GPT  <span class=o>(</span>48G<span class=o>)</span> <span class=o>[</span>CORRUPT]
        34       128     1  freebsd-boot  <span class=o>(</span>64k<span class=o>)</span>
       162  79691648     2  freebsd-ufs  <span class=o>(</span>38G<span class=o>)</span>
  79691810   4194236     3  freebsd-swap  <span class=o>(</span>2G<span class=o>)</span>
  83886046         1        - free -  <span class=o>(</span>512B<span class=o>)</span></code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>If the disk was formatted with the <a href=http://en.wikipedia.org/wiki/GUID_Partition_Table>GPT</a> partitioning scheme, it may show as "corrupted" because the GPT backup partition table is no longer at the end of the drive. Fix the backup partition table with <code>gpart</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># gpart recover ada0</span>
ada0 recovered</code></pre></div></div></td></tr></tbody></table></div><div class=paragraph><p>Now the additional space on the disk is available for use by a new partition, or an existing partition can be expanded:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># gpart show ada0</span>
<span class=o>=&gt;</span>       34  102399933  ada0  GPT  <span class=o>(</span>48G<span class=o>)</span>
         34        128     1  freebsd-boot  <span class=o>(</span>64k<span class=o>)</span>
        162   79691648     2  freebsd-ufs  <span class=o>(</span>38G<span class=o>)</span>
   79691810    4194236     3  freebsd-swap  <span class=o>(</span>2G<span class=o>)</span>
   83886046   18513921        - free -  <span class=o>(</span>8.8G<span class=o>)</span></code></pre></div></div><div class=paragraph><p>Partitions can only be resized into contiguous free space. Here, the last partition on the disk is the swap partition, but the second partition is the one that needs to be resized. Swap partitions only contain temporary data, so it can safely be unmounted, deleted, and then recreate the third partition after resizing the second partition.</p></div><div class=paragraph><p>Disable the swap partition:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># swapoff /dev/ada0p3</span></code></pre></div></div><div class=paragraph><p>Delete the third partition, specified by the <code>-i</code> flag, from the disk <em>ada0</em>.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># gpart delete -i 3 ada0</span>
ada0p3 deleted
<span class=c># gpart show ada0</span>
<span class=o>=&gt;</span>       34  102399933  ada0  GPT  <span class=o>(</span>48G<span class=o>)</span>
         34        128     1  freebsd-boot  <span class=o>(</span>64k<span class=o>)</span>
        162   79691648     2  freebsd-ufs  <span class=o>(</span>38G<span class=o>)</span>
   79691810   22708157        - free -  <span class=o>(</span>10G<span class=o>)</span></code></pre></div></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>There is risk of data loss when modifying the partition table of a mounted file system. It is best to perform the following steps on an unmounted file system while running from a live CD-ROM or USB device. However, if absolutely necessary, a mounted file system can be resized after disabling GEOM safety features:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sysctl kern.geom.debugflags=16</span></code></pre></div></div></td></tr></tbody></table></div><div class=paragraph><p>Resize the partition, leaving room to recreate a swap partition of the desired size. The partition to resize is specified with <code>-i</code>, and the new desired size with <code>-s</code>. Optionally, alignment of the partition is controlled with <code>-a</code>. This only modifies the size of the partition. The file system in the partition will be expanded in a separate step.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># gpart resize -i 2 -s 47G -a 4k ada0</span>
ada0p2 resized
<span class=c># gpart show ada0</span>
<span class=o>=&gt;</span>       34  102399933  ada0  GPT  <span class=o>(</span>48G<span class=o>)</span>
         34        128     1  freebsd-boot  <span class=o>(</span>64k<span class=o>)</span>
        162   98566144     2  freebsd-ufs  <span class=o>(</span>47G<span class=o>)</span>
   98566306    3833661        - free -  <span class=o>(</span>1.8G<span class=o>)</span></code></pre></div></div><div class=paragraph><p>Recreate the swap partition and activate it. If no size is specified with <code>-s</code>, all remaining space is used:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># gpart add -t freebsd-swap -a 4k ada0</span>
ada0p3 added
<span class=c># gpart show ada0</span>
<span class=o>=&gt;</span>       34  102399933  ada0  GPT  <span class=o>(</span>48G<span class=o>)</span>
         34        128     1  freebsd-boot  <span class=o>(</span>64k<span class=o>)</span>
        162   98566144     2  freebsd-ufs  <span class=o>(</span>47G<span class=o>)</span>
   98566306    3833661     3  freebsd-swap  <span class=o>(</span>1.8G<span class=o>)</span>
<span class=c># swapon /dev/ada0p3</span></code></pre></div></div><div class=paragraph><p>Grow the UFS file system to use the new capacity of the resized partition:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># growfs /dev/ada0p2</span>
Device is mounted read-write<span class=p>;</span> resizing will result <span class=k>in </span>temporary write suspension <span class=k>for</span> /.
It<span class=s1>&#39;s strongly recommended to make a backup before growing the file system.
OK to grow file system on /dev/ada0p2, mounted on /, from 38GB to 47GB? [Yes/No] Yes
super-block backups (for fsck -b #) at:
 80781312, 82063552, 83345792, 84628032, 85910272, 87192512, 88474752,
 89756992, 91039232, 92321472, 93603712, 94885952, 96168192, 97450432</span></code></pre></div></div><div class=paragraph><p>If the file system is ZFS, the resize is triggered by running the <code>online</code> subcommand with <code>-e</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zpool online -e zroot /dev/ada0p2</span></code></pre></div></div><div class=paragraph><p>Both the partition and the file system on it have now been resized to use the newly-available disk space.</p></div></div><div class=sect2><h3 id=usb-disks>17.4. USB Storage Devices<a class=anchor href=#usb-disks></a></h3><div class=paragraph><p>Many external storage solutions, such as hard drives, USB thumbdrives, and CD and DVD burners, use the Universal Serial Bus (USB). FreeBSD provides support for USB 1.x, 2.0, and 3.0 devices.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>USB 3.0 support is not compatible with some hardware, including Haswell (Lynx point) chipsets. If FreeBSD boots with a <code>failed with error 19</code> message, disable xHCI/USB3 in the system BIOS.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Support for USB storage devices is built into the <span class=filename>GENERIC</span> kernel. For a custom kernel, be sure that the following lines are present in the kernel configuration file:</p></div><div class="literalblock programlisting"><div class=content><pre>device scbus	# SCSI bus (required for ATA/SCSI)
device da	# Direct Access (disks)
device pass	# Passthrough device (direct ATA/SCSI access)
device uhci	# provides USB 1.x support
device ohci	# provides USB 1.x support
device ehci	# provides USB 2.0 support
device xhci	# provides USB 3.0 support
device usb	# USB Bus (required)
device umass	# Disks/Mass storage - Requires scbus and da
device cd	# needed for CD and DVD burners</pre></div></div><div class=paragraph><p>FreeBSD uses the <a href="https://man.freebsd.org/cgi/man.cgi?query=umass&amp;sektion=4&amp;format=html">umass(4)</a> driver which uses the SCSI subsystem to access USB storage devices. Since any USB device will be seen as a SCSI device by the system, if the USB device is a CD or DVD burner, do <em>not</em> include <code>device atapicam</code> in a custom kernel configuration file.</p></div><div class=paragraph><p>The rest of this section demonstrates how to verify that a USB storage device is recognized by FreeBSD and how to configure the device so that it can be used.</p></div><div class=sect3><h4 id=_device_configuration>17.4.1. Device Configuration<a class=anchor href=#_device_configuration></a></h4><div class=paragraph><p>To test the USB configuration, plug in the USB device. Use <code>dmesg</code> to confirm that the drive appears in the system message buffer. It should look something like this:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>umass0: &lt;STECH Simple Drive, class 0/0, rev 2.00/1.04, addr 3&gt; on usbus0
umass0:  SCSI over Bulk-Only<span class=p>;</span> quirks <span class=o>=</span> 0x0100
umass0:4:0:-1: Attached to scbus4
da0 at umass-sim0 bus 0 scbus4 target 0 lun 0
da0: &lt;STECH Simple Drive 1.04&gt; Fixed Direct Access SCSI-4 device
da0: Serial Number WD-WXE508CAN263
da0: 40.000MB/s transfers
da0: 152627MB <span class=o>(</span>312581808 512 byte sectors: 255H 63S/T 19457C<span class=o>)</span>
da0: <span class=nv>quirks</span><span class=o>=</span>0x2&lt;NO_6_BYTE&gt;</code></pre></div></div><div class=paragraph><p>The brand, device node (<span class=filename>da0</span>), speed, and size will differ according to the device.</p></div><div class=paragraph><p>Since the USB device is seen as a SCSI one, <code>camcontrol</code> can be used to list the USB storage devices attached to the system:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># camcontrol devlist</span>
&lt;STECH Simple Drive 1.04&gt;          at scbus4 target 0 lun 0 <span class=o>(</span>pass3,da0<span class=o>)</span></code></pre></div></div><div class=paragraph><p>Alternately, <code>usbconfig</code> can be used to list the device. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=usbconfig&amp;sektion=8&amp;format=html">usbconfig(8)</a> for more information about this command.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># usbconfig</span>
ugen0.3: &lt;Simple Drive STECH&gt; at usbus0, <span class=nv>cfg</span><span class=o>=</span>0 <span class=nv>md</span><span class=o>=</span>HOST <span class=nv>spd</span><span class=o>=</span>HIGH <span class=o>(</span>480Mbps<span class=o>)</span> <span class=nv>pwr</span><span class=o>=</span>ON <span class=o>(</span>2mA<span class=o>)</span></code></pre></div></div><div class=paragraph><p>If the device has not been formatted, refer to <a href=#disks-adding>Adding Disks</a> for instructions on how to format and create partitions on the USB drive. If the drive comes with a file system, it can be mounted by <code>root</code> using the instructions in <a href=./#mount-unmount>“Mounting and Unmounting File Systems”</a>.</p></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>Allowing untrusted users to mount arbitrary media, by enabling <code>vfs.usermount</code> as described below, should not be considered safe from a security point of view. Most file systems were not built to safeguard against malicious devices.</p></div></td></tr></tbody></table></div><div class=paragraph><p>To make the device mountable as a normal user, one solution is to make all users of the device a member of the <code>operator</code> group using <a href="https://man.freebsd.org/cgi/man.cgi?query=pw&amp;sektion=8&amp;format=html">pw(8)</a>. Next, ensure that <code>operator</code> is able to read and write the device by adding these lines to <span class=filename>/etc/devfs.rules</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>[localrules=5]
add path &#39;da*&#39; mode 0660 group operator</pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>If internal SCSI disks are also installed in the system, change the second line as follows:</p></div><div class="literalblock programlisting"><div class=content><pre>add path &#39;da[3-9]*&#39; mode 0660 group operator</pre></div></div><div class=paragraph><p>This will exclude the first three SCSI disks (<span class=filename>da0</span> to <span class=filename>da2</span>)from belonging to the <code>operator</code> group. Replace <em>3</em> with the number of internal SCSI disks. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=devfs.rules&amp;sektion=5&amp;format=html">devfs.rules(5)</a> for more information about this file.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Next, enable the ruleset in <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>devfs_system_ruleset=&#34;localrules&#34;</pre></div></div><div class=paragraph><p>Then, instruct the system to allow regular users to mount file systems by adding the following line to <span class=filename>/etc/sysctl.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>vfs.usermount=1</pre></div></div><div class=paragraph><p>Since this only takes effect after the next reboot, use <code>sysctl</code> to set this variable now:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sysctl vfs.usermount=1</span>
vfs.usermount: 0 -&gt; 1</code></pre></div></div><div class=paragraph><p>The final step is to create a directory where the file system is to be mounted. This directory needs to be owned by the user that is to mount the file system. One way to do that is for <code>root</code> to create a subdirectory owned by that user as <span class=filename>/mnt/username</span>. In the following example, replace <em>username</em> with the login name of the user and <em>usergroup</em> with the user’s primary group:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mkdir /mnt/username</span>
<span class=c># chown username:usergroup /mnt/username</span></code></pre></div></div><div class=paragraph><p>Suppose a USB thumbdrive is plugged in, and a device <span class=filename>/dev/da0s1</span> appears. If the device is formatted with a FAT file system, the user can mount it using:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% mount <span class=nt>-t</span> msdosfs <span class=nt>-o</span> <span class=nt>-m</span><span class=o>=</span>644,-M<span class=o>=</span>755 /dev/da0s1 /mnt/username</code></pre></div></div><div class=paragraph><p>Before the device can be unplugged, it <em>must</em> be unmounted first:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% umount /mnt/username</code></pre></div></div><div class=paragraph><p>After device removal, the system message buffer will show messages similar to the following:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>umass0: at uhub3, port 2, addr 3 <span class=o>(</span>disconnected<span class=o>)</span>
da0 at umass-sim0 bus 0 scbus4 target 0 lun 0
da0: &lt;STECH Simple Drive 1.04&gt; s/n WD-WXE508CAN263          detached
<span class=o>(</span>da0:umass-sim0:0:0:0<span class=o>)</span>: Periph destroyed</code></pre></div></div></div><div class=sect3><h4 id=_automounting_removable_media>17.4.2. Automounting Removable Media<a class=anchor href=#_automounting_removable_media></a></h4><div class=paragraph><p>USB devices can be automatically mounted by uncommenting this line in <span class=filename>/etc/auto_master</span>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>/media		<span class=nt>-media</span>		<span class=nt>-nosuid</span></code></pre></div></div><div class=paragraph><p>Then add these lines to <span class=filename>/etc/devd.conf</span>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>notify 100 <span class=o>{</span>
	match <span class=s2>&#34;system&#34;</span> <span class=s2>&#34;GEOM&#34;</span><span class=p>;</span>
	match <span class=s2>&#34;subsystem&#34;</span> <span class=s2>&#34;DEV&#34;</span><span class=p>;</span>
	action <span class=s2>&#34;/usr/sbin/automount -c&#34;</span><span class=p>;</span>
<span class=o>}</span><span class=p>;</span></code></pre></div></div><div class=paragraph><p>Reload the configuration if <a href="https://man.freebsd.org/cgi/man.cgi?query=autofs&amp;sektion=5&amp;format=html">autofs(5)</a> and <a href="https://man.freebsd.org/cgi/man.cgi?query=devd&amp;sektion=8&amp;format=html">devd(8)</a> are already running:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service automount restart</span>
<span class=c># service devd restart</span></code></pre></div></div><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=autofs&amp;sektion=5&amp;format=html">autofs(5)</a> can be set to start at boot by adding this line to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>autofs_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=autofs&amp;sektion=5&amp;format=html">autofs(5)</a> requires <a href="https://man.freebsd.org/cgi/man.cgi?query=devd&amp;sektion=8&amp;format=html">devd(8)</a> to be enabled, as it is by default.</p></div><div class=paragraph><p>Start the services immediately with:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service automount start</span>
<span class=c># service automountd start</span>
<span class=c># service autounmountd start</span>
<span class=c># service devd start</span></code></pre></div></div><div class=paragraph><p>Each file system that can be automatically mounted appears as a directory in <span class=filename>/media/</span>. The directory is named after the file system label. If the label is missing, the directory is named after the device node.</p></div><div class=paragraph><p>The file system is transparently mounted on the first access, and unmounted after a period of inactivity. Automounted drives can also be unmounted manually:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># automount -fu</span></code></pre></div></div><div class=paragraph><p>This mechanism is typically used for memory cards and USB memory sticks. It can be used with any block device, including optical drives or iSCSILUNs.</p></div></div></div><div class=sect2><h3 id=creating-cds>17.5. Creating and Using CD Media<a class=anchor href=#creating-cds></a></h3><div class=paragraph><p>Compact Disc (CD) media provide a number of features that differentiate them from conventional disks. They are designed so that they can be read continuously without delays to move the head between tracks. While CD media do have tracks, these refer to a section of data to be read continuously, and not a physical property of the disk. The ISO 9660 file system was designed to deal with these differences.</p></div><div class=paragraph><p>The FreeBSD Ports Collection provides several utilities for burning and duplicating audio and data CDs. This chapter demonstrates the use of several command line utilities. For CD burning software with a graphical utility, consider installing the <a class=package href=https://cgit.freebsd.org/ports/tree/sysutils/xcdroast/>sysutils/xcdroast</a> or <a class=package href=https://cgit.freebsd.org/ports/tree/sysutils/k3b/>sysutils/k3b</a> packages or ports.</p></div><div class=sect3><h4 id=atapicam>17.5.1. Supported Devices<a class=anchor href=#atapicam></a></h4><div class=paragraph><p>The <span class=filename>GENERIC</span> kernel provides support for SCSI, USB, and ATAPICD readers and burners. If a custom kernel is used, the options that need to be present in the kernel configuration file vary by the type of device.</p></div><div class=paragraph><p>For a SCSI burner, make sure these options are present:</p></div><div class="literalblock programlisting"><div class=content><pre>device scbus	# SCSI bus (required for ATA/SCSI)
device da	# Direct Access (disks)
device pass	# Passthrough device (direct ATA/SCSI access)
device cd	# needed for CD and DVD burners</pre></div></div><div class=paragraph><p>For a USB burner, make sure these options are present:</p></div><div class="literalblock programlisting"><div class=content><pre>device scbus	# SCSI bus (required for ATA/SCSI)
device da	# Direct Access (disks)
device pass	# Passthrough device (direct ATA/SCSI access)
device cd	# needed for CD and DVD burners
device uhci	# provides USB 1.x support
device ohci	# provides USB 1.x support
device ehci	# provides USB 2.0 support
device xhci	# provides USB 3.0 support
device usb	# USB Bus (required)
device umass	# Disks/Mass storage - Requires scbus and da</pre></div></div><div class=paragraph><p>For an ATAPI burner, make sure these options are present:</p></div><div class="literalblock programlisting"><div class=content><pre>device ata	# Legacy ATA/SATA controllers
device scbus	# SCSI bus (required for ATA/SCSI)
device pass	# Passthrough device (direct ATA/SCSI access)
device cd	# needed for CD and DVD burners</pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>On FreeBSD versions prior to 10.x, this line is also needed in the kernel configuration file if the burner is an ATAPI device:</p></div><div class="literalblock programlisting"><div class=content><pre>device atapicam</pre></div></div><div class=paragraph><p>Alternately, this driver can be loaded at boot time by adding the following line to <span class=filename>/boot/loader.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>atapicam_load=&#34;YES&#34;</pre></div></div><div class=paragraph><p>This will require a reboot of the system as this driver can only be loaded at boot time.</p></div></td></tr></tbody></table></div><div class=paragraph><p>To verify that FreeBSD recognizes the device, run <code>dmesg</code> and look for an entry for the device. On systems prior to 10.x, the device name in the first line of the output will be <span class=filename>acd0</span> instead of <span class=filename>cd0</span>.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% dmesg | <span class=nb>grep cd
</span>cd0 at ahcich1 bus 0 scbus1 target 0 lun 0
cd0: &lt;HL-DT-ST DVDRAM GU70N LT20&gt; Removable CD-ROM SCSI-0 device
cd0: Serial Number M3OD3S34152
cd0: 150.000MB/s transfers <span class=o>(</span>SATA 1.x, UDMA6, ATAPI 12bytes, PIO 8192bytes<span class=o>)</span>
cd0: Attempt to query device size failed: NOT READY, Medium not present - tray closed</code></pre></div></div></div><div class=sect3><h4 id=cdrecord>17.5.2. Burning a CD<a class=anchor href=#cdrecord></a></h4><div class=paragraph><p>In FreeBSD, <code>cdrecord</code> can be used to burn CDs. This command is installed with the <a class=package href=https://cgit.freebsd.org/ports/tree/sysutils/cdrtools/>sysutils/cdrtools</a> package or port.</p></div><div class=paragraph><p>While <code>cdrecord</code> has many options, basic usage is simple. Specify the name of the ISO file to burn and, if the system has multiple burner devices, specify the name of the device to use:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cdrecord dev=device imagefile.iso</span></code></pre></div></div><div class=paragraph><p>To determine the device name of the burner, use <code>-scanbus</code> which might produce results like this:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cdrecord -scanbus</span>
ProDVD-ProBD-Clone 3.00 <span class=o>(</span>amd64-unknown-freebsd10.0<span class=o>)</span> Copyright <span class=o>(</span>C<span class=o>)</span> 1995-2010 Jörg Schilling
Using libscg version <span class=s1>&#39;schily-0.9&#39;</span>
scsibus0:
        0,0,0     0<span class=o>)</span> <span class=s1>&#39;SEAGATE &#39;</span> <span class=s1>&#39;ST39236LW       &#39;</span> <span class=s1>&#39;0004&#39;</span> Disk
        0,1,0     1<span class=o>)</span> <span class=s1>&#39;SEAGATE &#39;</span> <span class=s1>&#39;ST39173W        &#39;</span> <span class=s1>&#39;5958&#39;</span> Disk
        0,2,0     2<span class=o>)</span> <span class=k>*</span>
        0,3,0     3<span class=o>)</span> <span class=s1>&#39;iomega  &#39;</span> <span class=s1>&#39;jaz 1GB         &#39;</span> <span class=s1>&#39;J.86&#39;</span> Removable Disk
        0,4,0     4<span class=o>)</span> <span class=s1>&#39;NEC     &#39;</span> <span class=s1>&#39;CD-ROM DRIVE:466&#39;</span> <span class=s1>&#39;1.26&#39;</span> Removable CD-ROM
        0,5,0     5<span class=o>)</span> <span class=k>*</span>
        0,6,0     6<span class=o>)</span> <span class=k>*</span>
        0,7,0     7<span class=o>)</span> <span class=k>*</span>
scsibus1:
        1,0,0   100<span class=o>)</span> <span class=k>*</span>
        1,1,0   101<span class=o>)</span> <span class=k>*</span>
        1,2,0   102<span class=o>)</span> <span class=k>*</span>
        1,3,0   103<span class=o>)</span> <span class=k>*</span>
        1,4,0   104<span class=o>)</span> <span class=k>*</span>
        1,5,0   105<span class=o>)</span> <span class=s1>&#39;YAMAHA  &#39;</span> <span class=s1>&#39;CRW4260         &#39;</span> <span class=s1>&#39;1.0q&#39;</span> Removable CD-ROM
        1,6,0   106<span class=o>)</span> <span class=s1>&#39;ARTEC   &#39;</span> <span class=s1>&#39;AM12S           &#39;</span> <span class=s1>&#39;1.06&#39;</span> Scanner
        1,7,0   107<span class=o>)</span> <span class=k>*</span></code></pre></div></div><div class=paragraph><p>Locate the entry for the CD burner and use the three numbers separated by commas as the value for <code>dev</code>. In this case, the Yamaha burner device is <code>1,5,0</code>, so the appropriate input to specify that device is <code>dev=1,5,0</code>. Refer to the manual page for <code>cdrecord</code> for other ways to specify this value and for information on writing audio tracks and controlling the write speed.</p></div><div class=paragraph><p>Alternately, run the following command to get the device address of the burner:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># camcontrol devlist</span>
&lt;MATSHITA CDRW/DVD UJDA740 1.00&gt;   at scbus1 target 0 lun 0 <span class=o>(</span>cd0,pass0<span class=o>)</span></code></pre></div></div><div class=paragraph><p>Use the numeric values for <code>scbus</code>, <code>target</code>, and <code>lun</code>. For this example, <code>1,0,0</code> is the device name to use.</p></div></div><div class=sect3><h4 id=mkisofs>17.5.3. Writing Data to an ISO File System<a class=anchor href=#mkisofs></a></h4><div class=paragraph><p>In order to produce a data CD, the data files that are going to make up the tracks on the CD must be prepared before they can be burned to the CD. In FreeBSD, <a class=package href=https://cgit.freebsd.org/ports/tree/sysutils/cdrtools/>sysutils/cdrtools</a> installs <code>mkisofs</code>, which can be used to produce an ISO 9660 file system that is an image of a directory tree within a UNIX® file system. The simplest usage is to specify the name of the ISO file to create and the path to the files to place into the ISO 9660 file system:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mkisofs -o imagefile.iso /path/to/tree</span></code></pre></div></div><div class=paragraph><p>This command maps the file names in the specified path to names that fit the limitations of the standard ISO 9660 file system, and will exclude files that do not meet the standard for ISO file systems.</p></div><div class=paragraph><p>A number of options are available to overcome the restrictions imposed by the standard. In particular, <code>-R</code> enables the Rock Ridge extensions common to UNIX® systems and <code>-J</code> enables Joliet extensions used by Microsoft® systems.</p></div><div class=paragraph><p>For CDs that are going to be used only on FreeBSD systems, <code>-U</code> can be used to disable all filename restrictions. When used with <code>-R</code>, it produces a file system image that is identical to the specified FreeBSD tree, even if it violates the ISO 9660 standard.</p></div><div class=paragraph><p>The last option of general use is <code>-b</code>. This is used to specify the location of a boot image for use in producing an "El Torito" bootable CD. This option takes an argument which is the path to a boot image from the top of the tree being written to the CD. By default, <code>mkisofs</code> creates an ISO image in "floppy disk emulation" mode, and thus expects the boot image to be exactly 1200, 1440 or 2880 KB in size. Some boot loaders, like the one used by the FreeBSD distribution media, do not use emulation mode. In this case, <code>-no-emul-boot</code> should be used. So, if <span class=filename>/tmp/myboot</span> holds a bootable FreeBSD system with the boot image in <span class=filename>/tmp/myboot/boot/cdboot</span>, this command would produce <span class=filename>/tmp/bootable.iso</span>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mkisofs -R -no-emul-boot -b boot/cdboot -o /tmp/bootable.iso /tmp/myboot</span></code></pre></div></div><div class=paragraph><p>The resulting ISO image can be mounted as a memory disk with:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mdconfig -a -t vnode -f /tmp/bootable.iso -u 0</span>
<span class=c># mount -t cd9660 /dev/md0 /mnt</span></code></pre></div></div><div class=paragraph><p>One can then verify that <span class=filename>/mnt</span> and <span class=filename>/tmp/myboot</span> are identical.</p></div><div class=paragraph><p>There are many other options available for <code>mkisofs</code> to fine-tune its behavior. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=mkisofs&amp;sektion=8&amp;format=html">mkisofs(8)</a> for details.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>It is possible to copy a data CD to an image file that is functionally equivalent to the image file created with <code>mkisofs</code>. To do so, use <span class=filename>dd</span> with the device name as the input file and the name of the ISO to create as the output file:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># dd if=/dev/cd0 of=file.iso bs=2048</span></code></pre></div></div><div class=paragraph><p>The resulting image file can be burned to CD as described in <a href=#cdrecord>Burning a CD</a>.</p></div></td></tr></tbody></table></div></div><div class=sect3><h4 id=mounting-cd>17.5.4. Using Data CDs<a class=anchor href=#mounting-cd></a></h4><div class=paragraph><p>Once an ISO has been burned to a CD, it can be mounted by specifying the file system type, the name of the device containing the CD, and an existing mount point:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mount -t cd9660 /dev/cd0 /mnt</span></code></pre></div></div><div class=paragraph><p>Since <code>mount</code> assumes that a file system is of type <code>ufs</code>, a <code>Incorrect super block</code> error will occur if <code>-t cd9660</code> is not included when mounting a data CD.</p></div><div class=paragraph><p>While any data CD can be mounted this way, disks with certain ISO 9660 extensions might behave oddly. For example, Joliet disks store all filenames in two-byte Unicode characters. If some non-English characters show up as question marks, specify the local charset with <code>-C</code>. For more information, refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=mount_cd9660&amp;sektion=8&amp;format=html">mount_cd9660(8)</a>.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>In order to do this character conversion with the help of <code>-C</code>, the kernel requires the <span class=filename>cd9660_iconv.ko</span> module to be loaded. This can be done either by adding this line to <span class=filename>loader.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>cd9660_iconv_load=&#34;YES&#34;</pre></div></div><div class=paragraph><p>and then rebooting the machine, or by directly loading the module with <code>kldload</code>.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Occasionally, <code>Device not configured</code> will be displayed when trying to mount a data CD. This usually means that the CD drive has not detected a disk in the tray, or that the drive is not visible on the bus. It can take a couple of seconds for a CD drive to detect media, so be patient.</p></div><div class=paragraph><p>Sometimes, a SCSICD drive may be missed because it did not have enough time to answer the bus reset. To resolve this, a custom kernel can be created which increases the default SCSI delay. Add the following option to the custom kernel configuration file and rebuild the kernel using the instructions in <a href=./#kernelconfig-building>“Building and Installing a Custom Kernel”</a>:</p></div><div class="literalblock programlisting"><div class=content><pre>options SCSI_DELAY=15000</pre></div></div><div class=paragraph><p>This tells the SCSI bus to pause 15 seconds during boot, to give the CD drive every possible chance to answer the bus reset.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>It is possible to burn a file directly to CD, without creating an ISO 9660 file system. This is known as burning a raw data CD and some people do this for backup purposes.</p></div><div class=paragraph><p>This type of disk can not be mounted as a normal data CD. In order to retrieve the data burned to such a CD, the data must be read from the raw device node. For example, this command will extract a compressed tar file located on the second CD device into the current working directory:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># tar xzvf /dev/cd1</span></code></pre></div></div><div class=paragraph><p>In order to mount a data CD, the data must be written using <code>mkisofs</code>.</p></div></td></tr></tbody></table></div></div><div class=sect3><h4 id=duplicating-audiocds>17.5.5. Duplicating Audio CDs<a class=anchor href=#duplicating-audiocds></a></h4><div class=paragraph><p>To duplicate an audio CD, extract the audio data from the CD to a series of files, then write these files to a blank CD.</p></div><div class=paragraph><p><a href=#using-cdrecord>Procedure: Duplicating an Audio CD</a> describes how to duplicate and burn an audio CD. If the FreeBSD version is less than 10.0 and the device is ATAPI, the <code>atapicam</code> module must be first loaded using the instructions in <a href=#atapicam>Supported Devices</a>.</p></div><div id=using-cdrecord class="olist arabic procedure"><div class=title>Procedure: Duplicating an Audio CD</div><ol class=arabic><li><p>The <a class=package href=https://cgit.freebsd.org/ports/tree/sysutils/cdrtools/>sysutils/cdrtools</a> package or port installs <code>cdda2wav</code>. This command can be used to extract all of the audio tracks, with each track written to a separate WAV file in the current working directory:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% cdda2wav <span class=nt>-vall</span> <span class=nt>-B</span> <span class=nt>-Owav</span></code></pre></div></div><div class=paragraph><p>A device name does not need to be specified if there is only one CD device on the system. Refer to the <code>cdda2wav</code> manual page for instructions on how to specify a device and to learn more about the other options available for this command.</p></div></li><li><p>Use <code>cdrecord</code> to write the <span class=filename>.wav</span> files:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% cdrecord <span class=nt>-v</span> <span class=nv>dev</span><span class=o>=</span>2,0 <span class=nt>-dao</span> <span class=nt>-useinfo</span>  <span class=k>*</span>.wav</code></pre></div></div><div class=paragraph><p>Make sure that <em>2,0</em> is set appropriately, as described in <a href=#cdrecord>Burning a CD</a>.</p></div></li></ol></div></div></div><div class=sect2><h3 id=creating-dvds>17.6. Creating and Using DVD Media<a class=anchor href=#creating-dvds></a></h3><div class=paragraph><p>Compared to the CD, the DVD is the next generation of optical media storage technology. The DVD can hold more data than any CD and is the standard for video publishing.</p></div><div class=paragraph><p>Five physical recordable formats can be defined for a recordable DVD:</p></div><div class=ulist><ul><li><p>DVD-R: This was the first DVD recordable format available. The DVD-R standard is defined by the <a href=http://www.dvdforum.org/forum.shtml>DVD Forum</a>. This format is write once.</p></li><li><p>DVD-RW: This is the rewritable version of the DVD-R standard. A DVD-RW can be rewritten about 1000 times.</p></li><li><p>DVD-RAM: This is a rewritable format which can be seen as a removable hard drive. However, this media is not compatible with most DVD-ROM drives and DVD-Video players as only a few DVD writers support the DVD-RAM format. Refer to <a href=#creating-dvd-ram>Using a DVD-RAM</a> for more information on DVD-RAM use.</p></li><li><p>DVD+RW: This is a rewritable format defined by the <a href=https://en.wikipedia.org/wiki/DVD%2BRW_Alliance>DVD+RW Alliance</a>. A DVD+RW can be rewritten about 1000 times.</p></li><li><p>DVD+R: This format is the write once variation of the DVD+RW format.</p></li></ul></div><div class=paragraph><p>A single layer recordable DVD can hold up to 4,700,000,000 bytes which is actually 4.38 GB or 4485 MB as 1 kilobyte is 1024 bytes.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>A distinction must be made between the physical media and the application. For example, a DVD-Video is a specific file layout that can be written on any recordable DVD physical media such as DVD-R, DVD+R, or DVD-RW. Before choosing the type of media, ensure that both the burner and the DVD-Video player are compatible with the media under consideration.</p></div></td></tr></tbody></table></div><div class=sect3><h4 id=_configuration>17.6.1. Configuration<a class=anchor href=#_configuration></a></h4><div class=paragraph><p>To perform DVD recording, use <a href="https://man.freebsd.org/cgi/man.cgi?query=growisofs&amp;sektion=1&amp;format=html">growisofs(1)</a>. This command is part of the <a class=package href=https://cgit.freebsd.org/ports/tree/sysutils/dvd+rw-tools/>sysutils/dvd+rw-tools</a> utilities which support all DVD media types.</p></div><div class=paragraph><p>These tools use the SCSI subsystem to access the devices, therefore <a href=#atapicam>ATAPI/CAM support</a> must be loaded or statically compiled into the kernel. This support is not needed if the burner uses the USB interface. Refer to <a href=#usb-disks>USB Storage Devices</a> for more details on USB device configuration.</p></div><div class=paragraph><p>DMA access must also be enabled for ATAPI devices, by adding the following line to <span class=filename>/boot/loader.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>hw.ata.atapi_dma=&#34;1&#34;</pre></div></div><div class=paragraph><p>Before attempting to use dvd+rw-tools, consult the <a href=http://fy.chalmers.se/~appro/linux/DVD+RW/hcn.html>Hardware Compatibility Notes</a>.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>For a graphical user interface, consider using <a class=package href=https://cgit.freebsd.org/ports/tree/sysutils/k3b/>sysutils/k3b</a> which provides a user friendly interface to <a href="https://man.freebsd.org/cgi/man.cgi?query=growisofs&amp;sektion=1&amp;format=html">growisofs(1)</a> and many other burning tools.</p></div></td></tr></tbody></table></div></div><div class=sect3><h4 id=_burning_data_dvds>17.6.2. Burning Data DVDs<a class=anchor href=#_burning_data_dvds></a></h4><div class=paragraph><p>Since <a href="https://man.freebsd.org/cgi/man.cgi?query=growisofs&amp;sektion=1&amp;format=html">growisofs(1)</a> is a front-end to <a href=#mkisofs>mkisofs</a>, it will invoke <a href="https://man.freebsd.org/cgi/man.cgi?query=mkisofs&amp;sektion=8&amp;format=html">mkisofs(8)</a> to create the file system layout and perform the write on the DVD. This means that an image of the data does not need to be created before the burning process.</p></div><div class=paragraph><p>To burn to a DVD+R or a DVD-R the data in <span class=filename>/path/to/data</span>, use the following command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># growisofs -dvd-compat -Z /dev/cd0 -J -R /path/to/data</span></code></pre></div></div><div class=paragraph><p>In this example, <code>-J -R</code> is passed to <a href="https://man.freebsd.org/cgi/man.cgi?query=mkisofs&amp;sektion=8&amp;format=html">mkisofs(8)</a> to create an ISO 9660 file system with Joliet and Rock Ridge extensions. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=mkisofs&amp;sektion=8&amp;format=html">mkisofs(8)</a> for more details.</p></div><div class=paragraph><p>For the initial session recording, <code>-Z</code> is used for both single and multiple sessions. Replace <em>/dev/cd0</em>, with the name of the DVD device. Using <code>-dvd-compat</code> indicates that the disk will be closed and that the recording will be unappendable. This should also provide better media compatibility with DVD-ROM drives.</p></div><div class=paragraph><p>To burn a pre-mastered image, such as <em>imagefile.iso</em>, use:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># growisofs -dvd-compat -Z /dev/cd0=imagefile.iso</span></code></pre></div></div><div class=paragraph><p>The write speed should be detected and automatically set according to the media and the drive being used. To force the write speed, use <code>-speed=</code>. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=growisofs&amp;sektion=1&amp;format=html">growisofs(1)</a> for example usage.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>In order to support working files larger than 4.38GB, an UDF/ISO-9660 hybrid file system must be created by passing <code>-udf -iso-level 3</code> to <a href="https://man.freebsd.org/cgi/man.cgi?query=mkisofs&amp;sektion=8&amp;format=html">mkisofs(8)</a> and all related programs, such as <a href="https://man.freebsd.org/cgi/man.cgi?query=growisofs&amp;sektion=1&amp;format=html">growisofs(1)</a>. This is required only when creating an ISO image file or when writing files directly to a disk. Since a disk created this way must be mounted as an UDF file system with <a href="https://man.freebsd.org/cgi/man.cgi?query=mount_udf&amp;sektion=8&amp;format=html">mount_udf(8)</a>, it will be usable only on an UDF aware operating system. Otherwise it will look as if it contains corrupted files.</p></div><div class=paragraph><p>To create this type of ISO file:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% mkisofs <span class=nt>-R</span> <span class=nt>-J</span> <span class=nt>-udf</span> <span class=nt>-iso-level</span> 3 <span class=nt>-o</span> imagefile.iso /path/to/data</code></pre></div></div><div class=paragraph><p>To burn files directly to a disk:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># growisofs -dvd-compat -udf -iso-level 3 -Z /dev/cd0 -J -R /path/to/data</span></code></pre></div></div><div class=paragraph><p>When an ISO image already contains large files, no additional options are required for <a href="https://man.freebsd.org/cgi/man.cgi?query=growisofs&amp;sektion=1&amp;format=html">growisofs(1)</a> to burn that image on a disk.</p></div><div class=paragraph><p>Be sure to use an up-to-date version of <a class=package href=https://cgit.freebsd.org/ports/tree/sysutils/cdrtools/>sysutils/cdrtools</a>, which contains <a href="https://man.freebsd.org/cgi/man.cgi?query=mkisofs&amp;sektion=8&amp;format=html">mkisofs(8)</a>, as an older version may not contain large files support. If the latest version does not work, install <a class=package href=https://cgit.freebsd.org/ports/tree/sysutils/cdrtools-devel/>sysutils/cdrtools-devel</a> and read its <a href="https://man.freebsd.org/cgi/man.cgi?query=mkisofs&amp;sektion=8&amp;format=html">mkisofs(8)</a>.</p></div></td></tr></tbody></table></div></div><div class=sect3><h4 id=_burning_a_dvd_video>17.6.3. Burning a DVD-Video<a class=anchor href=#_burning_a_dvd_video></a></h4><div class=paragraph><p>A DVD-Video is a specific file layout based on the ISO 9660 and micro-UDF (M-UDF) specifications. Since DVD-Video presents a specific data structure hierarchy, a particular program such as <a class=package href=https://cgit.freebsd.org/ports/tree/multimedia/dvdauthor/>multimedia/dvdauthor</a> is needed to author the DVD.</p></div><div class=paragraph><p>If an image of the DVD-Video file system already exists, it can be burned in the same way as any other image. If <code>dvdauthor</code> was used to make the DVD and the result is in <span class=filename>/path/to/video</span>, the following command should be used to burn the DVD-Video:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># growisofs -Z /dev/cd0 -dvd-video /path/to/video</span></code></pre></div></div><div class=paragraph><p><code>-dvd-video</code> is passed to <a href="https://man.freebsd.org/cgi/man.cgi?query=mkisofs&amp;sektion=8&amp;format=html">mkisofs(8)</a> to instruct it to create a DVD-Video file system layout. This option implies the <code>-dvd-compat</code> <a href="https://man.freebsd.org/cgi/man.cgi?query=growisofs&amp;sektion=1&amp;format=html">growisofs(1)</a> option.</p></div></div><div class=sect3><h4 id=_using_a_dvdrw>17.6.4. Using a DVD+RW<a class=anchor href=#_using_a_dvdrw></a></h4><div class=paragraph><p>Unlike CD-RW, a virgin DVD+RW needs to be formatted before first use. It is <em>recommended</em> to let <a href="https://man.freebsd.org/cgi/man.cgi?query=growisofs&amp;sektion=1&amp;format=html">growisofs(1)</a> take care of this automatically whenever appropriate. However, it is possible to use <code>dvd+rw-format</code> to format the DVD+RW:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># dvd+rw-format /dev/cd0</span></code></pre></div></div><div class=paragraph><p>Only perform this operation once and keep in mind that only virgin DVD+RW medias need to be formatted. Once formatted, the DVD+RW can be burned as usual.</p></div><div class=paragraph><p>To burn a totally new file system and not just append some data onto a DVD+RW, the media does not need to be blanked first. Instead, write over the previous recording like this:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># growisofs -Z /dev/cd0 -J -R /path/to/newdata</span></code></pre></div></div><div class=paragraph><p>The DVD+RW format supports appending data to a previous recording. This operation consists of merging a new session to the existing one as it is not considered to be multi-session writing. <a href="https://man.freebsd.org/cgi/man.cgi?query=growisofs&amp;sektion=1&amp;format=html">growisofs(1)</a> will <em>grow</em> the ISO 9660 file system present on the media.</p></div><div class=paragraph><p>For example, to append data to a DVD+RW, use the following:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># growisofs -M /dev/cd0 -J -R /path/to/nextdata</span></code></pre></div></div><div class=paragraph><p>The same <a href="https://man.freebsd.org/cgi/man.cgi?query=mkisofs&amp;sektion=8&amp;format=html">mkisofs(8)</a> options used to burn the initial session should be used during next writes.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Use <code>-dvd-compat</code> for better media compatibility with DVD-ROM drives. When using DVD+RW, this option will not prevent the addition of data.</p></div></td></tr></tbody></table></div><div class=paragraph><p>To blank the media, use:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># growisofs -Z /dev/cd0=/dev/zero</span></code></pre></div></div></div><div class=sect3><h4 id=_using_a_dvd_rw>17.6.5. Using a DVD-RW<a class=anchor href=#_using_a_dvd_rw></a></h4><div class=paragraph><p>A DVD-RW accepts two disc formats: incremental sequential and restricted overwrite. By default, DVD-RW discs are in sequential format.</p></div><div class=paragraph><p>A virgin DVD-RW can be directly written without being formatted. However, a non-virgin DVD-RW in sequential format needs to be blanked before writing a new initial session.</p></div><div class=paragraph><p>To blank a DVD-RW in sequential mode:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># dvd+rw-format -blank=full /dev/cd0</span></code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>A full blanking using <code>-blank=full</code> will take about one hour on a 1x media. A fast blanking can be performed using <code>-blank</code>, if the DVD-RW will be recorded in Disk-At-Once (DAO) mode. To burn the DVD-RW in DAO mode, use the command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># growisofs -use-the-force-luke=dao -Z /dev/cd0=imagefile.iso</span></code></pre></div></div><div class=paragraph><p>Since <a href="https://man.freebsd.org/cgi/man.cgi?query=growisofs&amp;sektion=1&amp;format=html">growisofs(1)</a> automatically attempts to detect fast blanked media and engage DAO write, <code>-use-the-force-luke=dao</code> should not be required.</p></div><div class=paragraph><p>One should instead use restricted overwrite mode with any DVD-RW as this format is more flexible than the default of incremental sequential.</p></div></td></tr></tbody></table></div><div class=paragraph><p>To write data on a sequential DVD-RW, use the same instructions as for the other DVD formats:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># growisofs -Z /dev/cd0 -J -R /path/to/data</span></code></pre></div></div><div class=paragraph><p>To append some data to a previous recording, use <code>-M</code> with <a href="https://man.freebsd.org/cgi/man.cgi?query=growisofs&amp;sektion=1&amp;format=html">growisofs(1)</a>. However, if data is appended on a DVD-RW in incremental sequential mode, a new session will be created on the disc and the result will be a multi-session disc.</p></div><div class=paragraph><p>A DVD-RW in restricted overwrite format does not need to be blanked before a new initial session. Instead, overwrite the disc with <code>-Z</code>. It is also possible to grow an existing ISO 9660 file system written on the disc with <code>-M</code>. The result will be a one-session DVD.</p></div><div class=paragraph><p>To put a DVD-RW in restricted overwrite format, the following command must be used:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># dvd+rw-format /dev/cd0</span></code></pre></div></div><div class=paragraph><p>To change back to sequential format, use:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># dvd+rw-format -blank=full /dev/cd0</span></code></pre></div></div></div><div class=sect3><h4 id=_multi_session>17.6.6. Multi-Session<a class=anchor href=#_multi_session></a></h4><div class=paragraph><p>Few DVD-ROM drives support multi-session DVDs and most of the time only read the first session. DVD+R, DVD-R and DVD-RW in sequential format can accept multiple sessions. The notion of multiple sessions does not exist for the DVD+RW and the DVD-RW restricted overwrite formats.</p></div><div class=paragraph><p>Using the following command after an initial non-closed session on a DVD+R, DVD-R, or DVD-RW in sequential format, will add a new session to the disc:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># growisofs -M /dev/cd0 -J -R /path/to/nextdata</span></code></pre></div></div><div class=paragraph><p>Using this command with a DVD+RW or a DVD-RW in restricted overwrite mode will append data while merging the new session to the existing one. The result will be a single-session disc. Use this method to add data after an initial write on these types of media.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Since some space on the media is used between each session to mark the end and start of sessions, one should add sessions with a large amount of data to optimize media space. The number of sessions is limited to 154 for a DVD+R, about 2000 for a DVD-R, and 127 for a DVD+R Double Layer.</p></div></td></tr></tbody></table></div></div><div class=sect3><h4 id=_for_more_information>17.6.7. For More Information<a class=anchor href=#_for_more_information></a></h4><div class=paragraph><p>To obtain more information about a DVD, use <code>dvd+rw-mediainfo <em>/dev/cd0</em></code> while the disc in the specified drive.</p></div><div class=paragraph><p>More information about dvd+rw-tools can be found in <a href="https://man.freebsd.org/cgi/man.cgi?query=growisofs&amp;sektion=1&amp;format=html">growisofs(1)</a>, on the <a href=http://fy.chalmers.se/~appro/linux/DVD+RW/>dvd+rw-tools web site</a>, and in the <a href=http://lists.debian.org/cdwrite/>cdwrite mailing list</a> archives.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>When creating a problem report related to the use of dvd+rw-tools, always include the output of <code>dvd+rw-mediainfo</code>.</p></div></td></tr></tbody></table></div></div><div class=sect3><h4 id=creating-dvd-ram>17.6.8. Using a DVD-RAM<a class=anchor href=#creating-dvd-ram></a></h4><div class=paragraph><p>DVD-RAM writers can use either a SCSI or ATAPI interface. For ATAPI devices, DMA access has to be enabled by adding the following line to <span class=filename>/boot/loader.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>hw.ata.atapi_dma=&#34;1&#34;</pre></div></div><div class=paragraph><p>A DVD-RAM can be seen as a removable hard drive. Like any other hard drive, the DVD-RAM must be formatted before it can be used. In this example, the whole disk space will be formatted with a standard UFS2 file system:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># dd if=/dev/zero of=/dev/acd0 bs=2k count=1</span>
<span class=c># bsdlabel -Bw acd0</span>
<span class=c># newfs /dev/acd0</span></code></pre></div></div><div class=paragraph><p>The DVD device, <span class=filename>acd0</span>, must be changed according to the configuration.</p></div><div class=paragraph><p>Once the DVD-RAM has been formatted, it can be mounted as a normal hard drive:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mount /dev/acd0 /mnt</span></code></pre></div></div><div class=paragraph><p>Once mounted, the DVD-RAM will be both readable and writeable.</p></div></div></div><div class=sect2><h3 id=floppies>17.7. Creating and Using Floppy Disks<a class=anchor href=#floppies></a></h3><div class=paragraph><p>This section explains how to format a 3.5 inch floppy disk in FreeBSD.</p></div><div class="exampleblock procedure"><div class=content><div class=paragraph><p><strong>Procedure: Steps to Format a Floppy</strong></p></div><div class=paragraph><p>A floppy disk needs to be low-level formatted before it can be used. This is usually done by the vendor, but formatting is a good way to check media integrity. To low-level format the floppy disk on FreeBSD, use <a href="https://man.freebsd.org/cgi/man.cgi?query=fdformat&amp;sektion=1&amp;format=html">fdformat(1)</a>. When using this utility, make note of any error messages, as these can help determine if the disk is good or bad.</p></div><div class="olist arabic"><ol class=arabic><li><p>To format the floppy, insert a new 3.5 inch floppy disk into the first floppy drive and issue:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># /usr/sbin/fdformat -f 1440 /dev/fd0</span></code></pre></div></div></li><li><p>After low-level formatting the disk, create a disk label as it is needed by the system to determine the size of the disk and its geometry. The supported geometry values are listed in <span class=filename>/etc/disktab</span>.</p><div class=paragraph><p>To write the disk label, use <a href="https://man.freebsd.org/cgi/man.cgi?query=bsdlabel&amp;sektion=8&amp;format=html">bsdlabel(8)</a>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># /sbin/bsdlabel -B -w /dev/fd0 fd1440</span></code></pre></div></div></li><li><p>The floppy is now ready to be high-level formatted with a file system. The floppy’s file system can be either UFS or FAT, where FAT is generally a better choice for floppies.</p><div class=paragraph><p>To format the floppy with FAT, issue:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># /sbin/newfs_msdos /dev/fd0</span></code></pre></div></div></li></ol></div></div></div><div class=paragraph><p>The disk is now ready for use. To use the floppy, mount it with <a href="https://man.freebsd.org/cgi/man.cgi?query=mount_msdosfs&amp;sektion=8&amp;format=html">mount_msdosfs(8)</a>. One can also install and use <a class=package href=https://cgit.freebsd.org/ports/tree/emulators/mtools/>emulators/mtools</a> from the Ports Collection.</p></div></div><div class=sect2><h3 id=backup-basics>17.8. Backup Basics<a class=anchor href=#backup-basics></a></h3><div class=paragraph><p>Implementing a backup plan is essential in order to have the ability to recover from disk failure, accidental file deletion, random file corruption, or complete machine destruction, including destruction of on-site backups.</p></div><div class=paragraph><p>The backup type and schedule will vary, depending upon the importance of the data, the granularity needed for file restores, and the amount of acceptable downtime. Some possible backup techniques include:</p></div><div class=ulist><ul><li><p>Archives of the whole system, backed up onto permanent, off-site media. This provides protection against all of the problems listed above, but is slow and inconvenient to restore from, especially for non-privileged users.</p></li><li><p>File system snapshots, which are useful for restoring deleted files or previous versions of files.</p></li><li><p>Copies of whole file systems or disks which are synchronized with another system on the network using a scheduled <a class=package href=https://cgit.freebsd.org/ports/tree/net/rsync/>net/rsync</a>.</p></li><li><p>Hardware or software RAID, which minimizes or avoids downtime when a disk fails.</p></li></ul></div><div class=paragraph><p>Typically, a mix of backup techniques is used. For example, one could create a schedule to automate a weekly, full system backup that is stored off-site and to supplement this backup with hourly ZFS snapshots. In addition, one could make a manual backup of individual directories or files before making file edits or deletions.</p></div><div class=paragraph><p>This section describes some of the utilities which can be used to create and manage backups on a FreeBSD system.</p></div><div class=sect3><h4 id=_file_system_backups>17.8.1. File System Backups<a class=anchor href=#_file_system_backups></a></h4><div class=paragraph><p>The traditional UNIX® programs for backing up a file system are <a href="https://man.freebsd.org/cgi/man.cgi?query=dump&amp;sektion=8&amp;format=html">dump(8)</a>, which creates the backup, and <a href="https://man.freebsd.org/cgi/man.cgi?query=restore&amp;sektion=8&amp;format=html">restore(8)</a>, which restores the backup. These utilities work at the disk block level, below the abstractions of the files, links, and directories that are created by file systems. Unlike other backup software, <code>dump</code> backs up an entire file system and is unable to backup only part of a file system or a directory tree that spans multiple file systems. Instead of writing files and directories, <code>dump</code> writes the raw data blocks that comprise files and directories.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>If <code>dump</code> is used on the root directory, it will not back up <span class=filename>/home</span>, <span class=filename>/usr</span> or many other directories since these are typically mount points for other file systems or symbolic links into those file systems.</p></div></td></tr></tbody></table></div><div class=paragraph><p>When used to restore data, <code>restore</code> stores temporary files in <span class=filename>/tmp/</span> by default. When using a recovery disk with a small <span class=filename>/tmp</span>, set <code>TMPDIR</code> to a directory with more free space in order for the restore to succeed.</p></div><div class=paragraph><p>When using <code>dump</code>, be aware that some quirks remain from its early days in Version 6 of AT&amp;T UNIX®,circa 1975. The default parameters assume a backup to a 9-track tape, rather than to another type of media or to the high-density tapes available today. These defaults must be overridden on the command line.</p></div><div class=paragraph><p>It is possible to backup a file system across the network to a another system or to a tape drive attached to another computer. While the <a href="https://man.freebsd.org/cgi/man.cgi?query=rdump&amp;sektion=8&amp;format=html">rdump(8)</a> and <a href="https://man.freebsd.org/cgi/man.cgi?query=rrestore&amp;sektion=8&amp;format=html">rrestore(8)</a> utilities can be used for this purpose, they are not considered to be secure.</p></div><div class=paragraph><p>Instead, one can use <code>dump</code> and <code>restore</code> in a more secure fashion over an SSH connection. This example creates a full, compressed backup of <span class=filename>/usr</span> and sends the backup file to the specified host over a SSH connection.</p></div><div class=exampleblock><div class=title>Przykład 17. Using <code>dump</code> over ssh</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># /sbin/dump -0uan -f - /usr | gzip -2 | ssh -c blowfish \</span>
          targetuser@targetmachine.example.com <span class=nb>dd </span><span class=nv>of</span><span class=o>=</span>/mybigfiles/dump-usr-l0.gz</code></pre></div></div></div></div><div class=paragraph><p>This example sets <code>RSH</code> in order to write the backup to a tape drive on a remote system over a SSH connection:</p></div><div class=exampleblock><div class=title>Przykład 18. Using <code>dump</code> over ssh with <code>RSH</code> Set</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># env RSH=/usr/bin/ssh /sbin/dump -0uan -f targetuser@targetmachine.example.com:/dev/sa0 /usr</span></code></pre></div></div></div></div></div><div class=sect3><h4 id=_directory_backups>17.8.2. Directory Backups<a class=anchor href=#_directory_backups></a></h4><div class=paragraph><p>Several built-in utilities are available for backing up and restoring specified files and directories as needed.</p></div><div class=paragraph><p>A good choice for making a backup of all of the files in a directory is <a href="https://man.freebsd.org/cgi/man.cgi?query=tar&amp;sektion=1&amp;format=html">tar(1)</a>. This utility dates back to Version 6 of AT&amp;T UNIX® and by default assumes a recursive backup to a local tape device. Switches can be used to instead specify the name of a backup file.</p></div><div class=paragraph><p>This example creates a compressed backup of the current directory and saves it to <span class=filename>/tmp/mybackup.tgz</span>. When creating a backup file, make sure that the backup is not saved to the same directory that is being backed up.</p></div><div class=exampleblock><div class=title>Przykład 19. Backing Up the Current Directory with <code>tar</code></div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># tar czvf /tmp/mybackup.tgz .</span></code></pre></div></div></div></div><div class=paragraph><p>To restore the entire backup, <code>cd</code> into the directory to restore into and specify the name of the backup. Note that this will overwrite any newer versions of files in the restore directory. When in doubt, restore to a temporary directory or specify the name of the file within the backup to restore.</p></div><div class=exampleblock><div class=title>Przykład 20. Restoring Up the Current Directory with <code>tar</code></div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># tar xzvf /tmp/mybackup.tgz</span></code></pre></div></div></div></div><div class=paragraph><p>There are dozens of available switches which are described in <a href="https://man.freebsd.org/cgi/man.cgi?query=tar&amp;sektion=1&amp;format=html">tar(1)</a>. This utility also supports the use of exclude patterns to specify which files should not be included when backing up the specified directory or restoring files from a backup.</p></div><div class=paragraph><p>To create a backup using a specified list of files and directories, <a href="https://man.freebsd.org/cgi/man.cgi?query=cpio&amp;sektion=1&amp;format=html">cpio(1)</a> is a good choice. Unlike <code>tar</code>, <code>cpio</code> does not know how to walk the directory tree and it must be provided the list of files to backup.</p></div><div class=paragraph><p>For example, a list of files can be created using <code>ls</code> or <code>find</code>. This example creates a recursive listing of the current directory which is then piped to <code>cpio</code> in order to create an output backup file named <span class=filename>/tmp/mybackup.cpio</span>.</p></div><div class=exampleblock><div class=title>Przykład 21. Using <code>ls</code> and <code>cpio</code> to Make a Recursive Backup of the Current Directory</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ls -R | cpio -ovF /tmp/mybackup.cpio</span></code></pre></div></div></div></div><div class=paragraph><p>A backup utility which tries to bridge the features provided by <code>tar</code> and <code>cpio</code> is <a href="https://man.freebsd.org/cgi/man.cgi?query=pax&amp;sektion=1&amp;format=html">pax(1)</a>. Over the years, the various versions of <code>tar</code> and <code>cpio</code> became slightly incompatible. POSIX® created <code>pax</code> which attempts to read and write many of the various <code>cpio</code> and <code>tar</code> formats, plus new formats of its own.</p></div><div class=paragraph><p>The <code>pax</code> equivalent to the previous examples would be:</p></div><div class=exampleblock><div class=title>Przykład 22. Backing Up the Current Directory with <code>pax</code></div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pax -wf /tmp/mybackup.pax .</span></code></pre></div></div></div></div></div><div class=sect3><h4 id=backups-tapebackups>17.8.3. Using Data Tapes for Backups<a class=anchor href=#backups-tapebackups></a></h4><div class=paragraph><p>While tape technology has continued to evolve, modern backup systems tend to combine off-site backups with local removable media. FreeBSD supports any tape drive that uses SCSI, such as LTO or DAT. There is limited support for SATA and USB tape drives.</p></div><div class=paragraph><p>For SCSI tape devices, FreeBSD uses the <a href="https://man.freebsd.org/cgi/man.cgi?query=sa&amp;sektion=4&amp;format=html">sa(4)</a> driver and the <span class=filename>/dev/sa0</span>, <span class=filename>/dev/nsa0</span>, and <span class=filename>/dev/esa0</span> devices. The physical device name is <span class=filename>/dev/sa0</span>. When <span class=filename>/dev/nsa0</span> is used, the backup application will not rewind the tape after writing a file, which allows writing more than one file to a tape. Using <span class=filename>/dev/esa0</span> ejects the tape after the device is closed.</p></div><div class=paragraph><p>In FreeBSD, <code>mt</code> is used to control operations of the tape drive, such as seeking through files on a tape or writing tape control marks to the tape. For example, the first three files on a tape can be preserved by skipping past them before writing a new file:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mt -f /dev/nsa0 fsf 3</span></code></pre></div></div><div class=paragraph><p>This utility supports many operations. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=mt&amp;sektion=1&amp;format=html">mt(1)</a> for details.</p></div><div class=paragraph><p>To write a single file to tape using <code>tar</code>, specify the name of the tape device and the file to backup:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># tar cvf /dev/sa0 file</span></code></pre></div></div><div class=paragraph><p>To recover files from a <code>tar</code> archive on tape into the current directory:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># tar xvf /dev/sa0</span></code></pre></div></div><div class=paragraph><p>To backup a UFS file system, use <code>dump</code>. This examples backs up <span class=filename>/usr</span> without rewinding the tape when finished:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># dump -0aL -b64 -f /dev/nsa0 /usr</span></code></pre></div></div><div class=paragraph><p>To interactively restore files from a <code>dump</code> file on tape into the current directory:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># restore -i -f /dev/nsa0</span></code></pre></div></div></div><div class=sect3><h4 id=backups-programs-amanda>17.8.4. Third-Party Backup Utilities<a class=anchor href=#backups-programs-amanda></a></h4><div class=paragraph><p>The FreeBSD Ports Collection provides many third-party utilities which can be used to schedule the creation of backups, simplify tape backup, and make backups easier and more convenient. Many of these applications are client/server based and can be used to automate the backups of a single system or all of the computers in a network.</p></div><div class=paragraph><p>Popular utilities include Amanda, Bacula, rsync, and duplicity.</p></div></div><div class=sect3><h4 id=_emergency_recovery>17.8.5. Emergency Recovery<a class=anchor href=#_emergency_recovery></a></h4><div class=paragraph><p>In addition to regular backups, it is recommended to perform the following steps as part of an emergency preparedness plan.</p></div><div class=paragraph><p>Create a print copy of the output of the following commands:</p></div><div class=ulist><ul><li><p><code>gpart show</code></p></li><li><p><code>more /etc/fstab</code></p></li><li><p><code>dmesg</code></p></li></ul></div><div class=paragraph><p>Store this printout and a copy of the installation media in a secure location. Should an emergency restore be needed, boot into the installation media and select <code>Live CD</code> to access a rescue shell. This rescue mode can be used to view the current state of the system, and if needed, to reformat disks and restore data from backups.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>The installation media for FreeBSD/i386 11.2-RELEASE does not include a rescue shell. For this version, instead download and burn a Livefs CD image from <a href=ftp://ftp.FreeBSD.org/pub/FreeBSD/releases/i386/ISO-IMAGES/11.2/FreeBSD-11.2-RELEASE-i386-livefs.iso>ftp://ftp.FreeBSD.org/pub/FreeBSD/releases/i386/ISO-IMAGES/11.2/FreeBSD-11.2-RELEASE-i386-livefs.iso</a>.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Next, test the rescue shell and the backups. Make notes of the procedure. Store these notes with the media, the printouts, and the backups. These notes may prevent the inadvertent destruction of the backups while under the stress of performing an emergency recovery.</p></div><div class=paragraph><p>For an added measure of security, store the latest backup at a remote location which is physically separated from the computers and disk drives by a significant distance.</p></div></div></div><div class=sect2><h3 id=disks-virtual>17.9. Memory Disks<a class=anchor href=#disks-virtual></a></h3><div class=paragraph><p>In addition to physical disks, FreeBSD also supports the creation and use of memory disks. One possible use for a memory disk is to access the contents of an ISO file system without the overhead of first burning it to a CD or DVD, then mounting the CD/DVD media.</p></div><div class=paragraph><p>In FreeBSD, the <a href="https://man.freebsd.org/cgi/man.cgi?query=md&amp;sektion=4&amp;format=html">md(4)</a> driver is used to provide support for memory disks. The <span class=filename>GENERIC</span> kernel includes this driver. When using a custom kernel configuration file, ensure it includes this line:</p></div><div class="literalblock programlisting"><div class=content><pre>device md</pre></div></div><div class=sect3><h4 id=disks-mdconfig>17.9.1. Attaching and Detaching Existing Images<a class=anchor href=#disks-mdconfig></a></h4><div class=paragraph><p>To mount an existing file system image, use <code>mdconfig</code> to specify the name of the ISO file and a free unit number. Then, refer to that unit number to mount it on an existing mount point. Once mounted, the files in the ISO will appear in the mount point. This example attaches <em>diskimage.iso</em> to the memory device <span class=filename>/dev/md0</span> then mounts that memory device on <span class=filename>/mnt</span>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mdconfig -f diskimage.iso -u 0</span>
<span class=c># mount -t cd9660 /dev/md0 /mnt</span></code></pre></div></div><div class=paragraph><p>Notice that <code>-t cd9660</code> was used to mount an ISO format. If a unit number is not specified with <code>-u</code>, <code>mdconfig</code> will automatically allocate an unused memory device and output the name of the allocated unit, such as <span class=filename>md4</span>. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=mdconfig&amp;sektion=8&amp;format=html">mdconfig(8)</a> for more details about this command and its options.</p></div><div class=paragraph><p>When a memory disk is no longer in use, its resources should be released back to the system. First, unmount the file system, then use <code>mdconfig</code> to detach the disk from the system and release its resources. To continue this example:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># umount /mnt</span>
<span class=c># mdconfig -d -u 0</span></code></pre></div></div><div class=paragraph><p>To determine if any memory disks are still attached to the system, type <code>mdconfig -l</code>.</p></div></div><div class=sect3><h4 id=disks-md-freebsd5>17.9.2. Creating a File- or Memory-Backed Memory Disk<a class=anchor href=#disks-md-freebsd5></a></h4><div class=paragraph><p>FreeBSD also supports memory disks where the storage to use is allocated from either a hard disk or an area of memory. The first method is commonly referred to as a file-backed file system and the second method as a memory-backed file system. Both types can be created using <code>mdconfig</code>.</p></div><div class=paragraph><p>To create a new memory-backed file system, specify a type of <code>swap</code> and the size of the memory disk to create. Then, format the memory disk with a file system and mount as usual. This example creates a 5M memory disk on unit <code>1</code>. That memory disk is then formatted with the UFS file system before it is mounted:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mdconfig -a -t swap -s 5m -u 1</span>
<span class=c># newfs -U md1</span>
/dev/md1: 5.0MB <span class=o>(</span>10240 sectors<span class=o>)</span> block size 16384, fragment size 2048
        using 4 cylinder <span class=nb>groups </span>of 1.27MB, 81 blks, 192 inodes.
        with soft updates
super-block backups <span class=o>(</span><span class=k>for </span>fsck <span class=nt>-b</span> <span class=c>#) at:</span>
 160, 2752, 5344, 7936
<span class=c># mount /dev/md1 /mnt</span>
<span class=c># df /mnt</span>
Filesystem 1K-blocks Used Avail Capacity  Mounted on
/dev/md1        4718    4  4338     0%    /mnt</code></pre></div></div><div class=paragraph><p>To create a new file-backed memory disk, first allocate an area of disk to use. This example creates an empty 5MB file named <span class=filename>newimage</span>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># dd if=/dev/zero of=newimage bs=1k count=5k</span>
5120+0 records <span class=k>in
</span>5120+0 records out</code></pre></div></div><div class=paragraph><p>Next, attach that file to a memory disk, label the memory disk and format it with the UFS file system, mount the memory disk, and verify the size of the file-backed disk:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mdconfig -f newimage -u 0</span>
<span class=c># bsdlabel -w md0 auto</span>
<span class=c># newfs -U md0a</span>
/dev/md0a: 5.0MB <span class=o>(</span>10224 sectors<span class=o>)</span> block size 16384, fragment size 2048
        using 4 cylinder <span class=nb>groups </span>of 1.25MB, 80 blks, 192 inodes.
super-block backups <span class=o>(</span><span class=k>for </span>fsck <span class=nt>-b</span> <span class=c>#) at:</span>
 160, 2720, 5280, 7840
<span class=c># mount /dev/md0a /mnt</span>
<span class=c># df /mnt</span>
Filesystem 1K-blocks Used Avail Capacity  Mounted on
/dev/md0a       4710    4  4330     0%    /mnt</code></pre></div></div><div class=paragraph><p>It takes several commands to create a file- or memory-backed file system using <code>mdconfig</code>. FreeBSD also comes with <code>mdmfs</code> which automatically configures a memory disk, formats it with the UFS file system, and mounts it. For example, after creating <em>newimage</em> with <code>dd</code>, this one command is equivalent to running the <code>bsdlabel</code>, <code>newfs</code>, and <code>mount</code> commands shown above:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mdmfs -F newimage -s 5m md0 /mnt</span></code></pre></div></div><div class=paragraph><p>To instead create a new memory-based memory disk with <code>mdmfs</code>, use this one command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mdmfs -s 5m md1 /mnt</span></code></pre></div></div><div class=paragraph><p>If the unit number is not specified, <code>mdmfs</code> will automatically select an unused memory device. For more details about <code>mdmfs</code>, refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=mdmfs&amp;sektion=8&amp;format=html">mdmfs(8)</a>.</p></div></div></div><div class=sect2><h3 id=snapshots>17.10. File System Snapshots<a class=anchor href=#snapshots></a></h3><div class=paragraph><p>FreeBSD offers a feature in conjunction with <a href=./#soft-updates>Soft Updates</a>: file system snapshots.</p></div><div class=paragraph><p>UFS snapshots allow a user to create images of specified file systems, and treat them as a file. Snapshot files must be created in the file system that the action is performed on, and a user may create no more than 20 snapshots per file system. Active snapshots are recorded in the superblock so they are persistent across unmount and remount operations along with system reboots. When a snapshot is no longer required, it can be removed using <a href="https://man.freebsd.org/cgi/man.cgi?query=rm&amp;sektion=1&amp;format=html">rm(1)</a>. While snapshots may be removed in any order, all the used space may not be acquired because another snapshot will possibly claim some of the released blocks.</p></div><div class=paragraph><p>The un-alterable <code>snapshot</code> file flag is set by <a href="https://man.freebsd.org/cgi/man.cgi?query=mksnap_ffs&amp;sektion=8&amp;format=html">mksnap_ffs(8)</a> after initial creation of a snapshot file. <a href="https://man.freebsd.org/cgi/man.cgi?query=unlink&amp;sektion=1&amp;format=html">unlink(1)</a> makes an exception for snapshot files since it allows them to be removed.</p></div><div class=paragraph><p>Snapshots are created using <a href="https://man.freebsd.org/cgi/man.cgi?query=mount&amp;sektion=8&amp;format=html">mount(8)</a>. To place a snapshot of <span class=filename>/var</span> in the file <span class=filename>/var/snapshot/snap</span>, use the following command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mount -u -o snapshot /var/snapshot/snap /var</span></code></pre></div></div><div class=paragraph><p>Alternatively, use <a href="https://man.freebsd.org/cgi/man.cgi?query=mksnap_ffs&amp;sektion=8&amp;format=html">mksnap_ffs(8)</a> to create the snapshot:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mksnap_ffs /var /var/snapshot/snap</span></code></pre></div></div><div class=paragraph><p>One can find snapshot files on a file system, such as <span class=filename>/var</span>, using <a href="https://man.freebsd.org/cgi/man.cgi?query=find&amp;sektion=1&amp;format=html">find(1)</a>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># find /var -flags snapshot</span></code></pre></div></div><div class=paragraph><p>Once a snapshot has been created, it has several uses:</p></div><div class=ulist><ul><li><p>Some administrators will use a snapshot file for backup purposes, because the snapshot can be transferred to CDs or tape.</p></li><li><p>The file system integrity checker, <a href="https://man.freebsd.org/cgi/man.cgi?query=fsck&amp;sektion=8&amp;format=html">fsck(8)</a>, may be run on the snapshot. Assuming that the file system was clean when it was mounted, this should always provide a clean and unchanging result.</p></li><li><p>Running <a href="https://man.freebsd.org/cgi/man.cgi?query=dump&amp;sektion=8&amp;format=html">dump(8)</a> on the snapshot will produce a dump file that is consistent with the file system and the timestamp of the snapshot. <a href="https://man.freebsd.org/cgi/man.cgi?query=dump&amp;sektion=8&amp;format=html">dump(8)</a> can also take a snapshot, create a dump image, and then remove the snapshot in one command by using <code>-L</code>.</p></li><li><p>The snapshot can be mounted as a frozen image of the file system. To <a href="https://man.freebsd.org/cgi/man.cgi?query=mount&amp;sektion=8&amp;format=html">mount(8)</a> the snapshot <span class=filename>/var/snapshot/snap</span> run:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mdconfig -a -t vnode -o readonly -f /var/snapshot/snap -u 4</span>
<span class=c># mount -r /dev/md4 /mnt</span></code></pre></div></div></li></ul></div><div class=paragraph><p>The frozen <span class=filename>/var</span> is now available through <span class=filename>/mnt</span>. Everything will initially be in the same state it was during the snapshot creation time. The only exception is that any earlier snapshots will appear as zero length files. To unmount the snapshot, use:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># umount /mnt</span>
<span class=c># mdconfig -d -u 4</span></code></pre></div></div><div class=paragraph><p>For more information about <code>softupdates</code> and file system snapshots, including technical papers, visit Marshall Kirk McKusick’s website at <a href=http://www.mckusick.com/>http://www.mckusick.com/</a>.</p></div></div><div class=sect2><h3 id=quotas>17.11. Disk Quotas<a class=anchor href=#quotas></a></h3><div class=paragraph><p>Disk quotas can be used to limit the amount of disk space or the number of files a user or members of a group may allocate on a per-file system basis. This prevents one user or group of users from consuming all of the available disk space.</p></div><div class=paragraph><p>This section describes how to configure disk quotas for the UFS file system. To configure quotas on the ZFS file system, refer to <a href=./#zfs-zfs-quota>Dataset, User, and Group Quotas</a></p></div><div class=sect3><h4 id=_enabling_disk_quotas>17.11.1. Enabling Disk Quotas<a class=anchor href=#_enabling_disk_quotas></a></h4><div class=paragraph><p>To determine if the FreeBSD kernel provides support for disk quotas:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% sysctl kern.features.ufs_quota
kern.features.ufs_quota: 1</code></pre></div></div><div class=paragraph><p>In this example, the <code>1</code> indicates quota support. If the value is instead <code>0</code>, add the following line to a custom kernel configuration file and rebuild the kernel using the instructions in <a href=./#kernelconfig>Configuring the FreeBSD Kernel</a>:</p></div><div class="literalblock programlisting"><div class=content><pre>options QUOTA</pre></div></div><div class=paragraph><p>Next, enable disk quotas in <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>quota_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>Normally on bootup, the quota integrity of each file system is checked by <a href="https://man.freebsd.org/cgi/man.cgi?query=quotacheck&amp;sektion=8&amp;format=html">quotacheck(8)</a>. This program insures that the data in the quota database properly reflects the data on the file system. This is a time consuming process that will significantly affect the time the system takes to boot. To skip this step, add this variable to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>check_quotas=&#34;NO&#34;</pre></div></div><div class=paragraph><p>Finally, edit <span class=filename>/etc/fstab</span> to enable disk quotas on a per-file system basis. To enable per-user quotas on a file system, add <code>userquota</code> to the options field in the <span class=filename>/etc/fstab</span> entry for the file system to enable quotas on. For example:</p></div><div class="literalblock programlisting"><div class=content><pre>/dev/da1s2g   /home    ufs rw,userquota 1 2</pre></div></div><div class=paragraph><p>To enable group quotas, use <code>groupquota</code> instead. To enable both user and group quotas, separate the options with a comma:</p></div><div class="literalblock programlisting"><div class=content><pre>/dev/da1s2g    /home    ufs rw,userquota,groupquota 1 2</pre></div></div><div class=paragraph><p>By default, quota files are stored in the root directory of the file system as <span class=filename>quota.user</span> and <span class=filename>quota.group</span>. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=fstab&amp;sektion=5&amp;format=html">fstab(5)</a> for more information. Specifying an alternate location for the quota files is not recommended.</p></div><div class=paragraph><p>Once the configuration is complete, reboot the system and <span class=filename>/etc/rc</span> will automatically run the appropriate commands to create the initial quota files for all of the quotas enabled in <span class=filename>/etc/fstab</span>.</p></div><div class=paragraph><p>In the normal course of operations, there should be no need to manually run <a href="https://man.freebsd.org/cgi/man.cgi?query=quotacheck&amp;sektion=8&amp;format=html">quotacheck(8)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=quotaon&amp;sektion=8&amp;format=html">quotaon(8)</a>, or <a href="https://man.freebsd.org/cgi/man.cgi?query=quotaoff&amp;sektion=8&amp;format=html">quotaoff(8)</a>. However, one should read these manual pages to be familiar with their operation.</p></div></div><div class=sect3><h4 id=_setting_quota_limits>17.11.2. Setting Quota Limits<a class=anchor href=#_setting_quota_limits></a></h4><div class=paragraph><p>To verify that quotas are enabled, run:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># quota -v</span></code></pre></div></div><div class=paragraph><p>There should be a one line summary of disk usage and current quota limits for each file system that quotas are enabled on.</p></div><div class=paragraph><p>The system is now ready to be assigned quota limits with <code>edquota</code>.</p></div><div class=paragraph><p>Several options are available to enforce limits on the amount of disk space a user or group may allocate, and how many files they may create. Allocations can be limited based on disk space (block quotas), number of files (inode quotas), or a combination of both. Each limit is further broken down into two categories: hard and soft limits.</p></div><div class=paragraph><p>A hard limit may not be exceeded. Once a user reaches a hard limit, no further allocations can be made on that file system by that user. For example, if the user has a hard limit of 500 kbytes on a file system and is currently using 490 kbytes, the user can only allocate an additional 10 kbytes. Attempting to allocate an additional 11 kbytes will fail.</p></div><div class=paragraph><p>Soft limits can be exceeded for a limited amount of time, known as the grace period, which is one week by default. If a user stays over their limit longer than the grace period, the soft limit turns into a hard limit and no further allocations are allowed. When the user drops back below the soft limit, the grace period is reset.</p></div><div class=paragraph><p>In the following example, the quota for the <code>test</code> account is being edited. When <code>edquota</code> is invoked, the editor specified by <code>EDITOR</code> is opened in order to edit the quota limits. The default editor is set to vi.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># edquota -u test</span>
Quotas <span class=k>for </span>user <span class=nb>test</span>:
/usr: kbytes <span class=k>in </span>use: 65, limits <span class=o>(</span>soft <span class=o>=</span> 50, hard <span class=o>=</span> 75<span class=o>)</span>
        inodes <span class=k>in </span>use: 7, limits <span class=o>(</span>soft <span class=o>=</span> 50, hard <span class=o>=</span> 60<span class=o>)</span>
/usr/var: kbytes <span class=k>in </span>use: 0, limits <span class=o>(</span>soft <span class=o>=</span> 50, hard <span class=o>=</span> 75<span class=o>)</span>
        inodes <span class=k>in </span>use: 0, limits <span class=o>(</span>soft <span class=o>=</span> 50, hard <span class=o>=</span> 60<span class=o>)</span></code></pre></div></div><div class=paragraph><p>There are normally two lines for each file system that has quotas enabled. One line represents the block limits and the other represents the inode limits. Change the value to modify the quota limit. For example, to raise the block limit on <span class=filename>/usr</span> to a soft limit of <code>500</code> and a hard limit of <code>600</code>, change the values in that line as follows:</p></div><div class="literalblock programlisting"><div class=content><pre>/usr: kbytes in use: 65, limits (soft = 500, hard = 600)</pre></div></div><div class=paragraph><p>The new quota limits take effect upon exiting the editor.</p></div><div class=paragraph><p>Sometimes it is desirable to set quota limits on a range of users. This can be done by first assigning the desired quota limit to a user. Then, use <code>-p</code> to duplicate that quota to a specified range of user IDs (UIDs). The following command will duplicate those quota limits for UIDs <code>10,000</code> through <code>19,999</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># edquota -p test 10000-19999</span></code></pre></div></div><div class=paragraph><p>For more information, refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=edquota&amp;sektion=8&amp;format=html">edquota(8)</a>.</p></div></div><div class=sect3><h4 id=_checking_quota_limits_and_disk_usage>17.11.3. Checking Quota Limits and Disk Usage<a class=anchor href=#_checking_quota_limits_and_disk_usage></a></h4><div class=paragraph><p>To check individual user or group quotas and disk usage, use <a href="https://man.freebsd.org/cgi/man.cgi?query=quota&amp;sektion=1&amp;format=html">quota(1)</a>. A user may only examine their own quota and the quota of a group they are a member of. Only the superuser may view all user and group quotas. To get a summary of all quotas and disk usage for file systems with quotas enabled, use <a href="https://man.freebsd.org/cgi/man.cgi?query=repquota&amp;sektion=8&amp;format=html">repquota(8)</a>.</p></div><div class=paragraph><p>Normally, file systems that the user is not using any disk space on will not show in the output of <code>quota</code>, even if the user has a quota limit assigned for that file system. Use <code>-v</code> to display those file systems. The following is sample output from <code>quota -v</code> for a user that has quota limits on two file systems.</p></div><div class="literalblock programlisting"><div class=content><pre>Disk quotas for user test (uid 1002):
     Filesystem  usage    quota   limit   grace   files   quota   limit   grace
           /usr      65*     50      75   5days       7      50      60
       /usr/var       0      50      75               0      50      60</pre></div></div><div class=paragraph><p>In this example, the user is currently 15 kbytes over the soft limit of 50 kbytes on <span class=filename>/usr</span> and has 5 days of grace period left. The asterisk <code>*</code> indicates that the user is currently over the quota limit.</p></div></div><div class=sect3><h4 id=_quotas_over_nfs>17.11.4. Quotas over NFS<a class=anchor href=#_quotas_over_nfs></a></h4><div class=paragraph><p>Quotas are enforced by the quota subsystem on the NFS server. The <a href="https://man.freebsd.org/cgi/man.cgi?query=rpc.rquotad&amp;sektion=8&amp;format=html">rpc.rquotad(8)</a> daemon makes quota information available to <code>quota</code> on NFS clients, allowing users on those machines to see their quota statistics.</p></div><div class=paragraph><p>On the NFS server, enable <code>rpc.rquotad</code> by removing the <code>#</code> from this line in <strong class=filename>/etc/inetd.conf</strong>:</p></div><div class="literalblock programlisting"><div class=content><pre>rquotad/1      dgram rpc/udp wait root /usr/libexec/rpc.rquotad rpc.rquotad</pre></div></div><div class=paragraph><p>Then, restart <code>inetd</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service inetd restart</span></code></pre></div></div></div></div><div class=sect2><h3 id=disks-encrypting>17.12. Encrypting Disk Partitions<a class=anchor href=#disks-encrypting></a></h3><div class=paragraph><p>FreeBSD offers excellent online protections against unauthorized data access. File permissions and <a href=./#mac>Mandatory Access Control</a> (MAC) help prevent unauthorized users from accessing data while the operating system is active and the computer is powered up. However, the permissions enforced by the operating system are irrelevant if an attacker has physical access to a computer and can move the computer’s hard drive to another system to copy and analyze the data.</p></div><div class=paragraph><p>Regardless of how an attacker may have come into possession of a hard drive or powered-down computer, the GEOM-based cryptographic subsystems built into FreeBSD are able to protect the data on the computer’s file systems against even highly-motivated attackers with significant resources. Unlike encryption methods that encrypt individual files, the built-in <code>gbde</code> and <code>geli</code> utilities can be used to transparently encrypt entire file systems. No cleartext ever touches the hard drive’s platter.</p></div><div class=paragraph><p>This chapter demonstrates how to create an encrypted file system on FreeBSD. It first demonstrates the process using <code>gbde</code> and then demonstrates the same example using <code>geli</code>.</p></div><div class=sect3><h4 id=_disk_encryption_with_gbde>17.12.1. Disk Encryption with gbde<a class=anchor href=#_disk_encryption_with_gbde></a></h4><div class=paragraph><p>The objective of the <a href="https://man.freebsd.org/cgi/man.cgi?query=gbde&amp;sektion=4&amp;format=html">gbde(4)</a> facility is to provide a formidable challenge for an attacker to gain access to the contents of a <em>cold</em> storage device. However, if the computer is compromised while up and running and the storage device is actively attached, or the attacker has access to a valid passphrase, it offers no protection to the contents of the storage device. Thus, it is important to provide physical security while the system is running and to protect the passphrase used by the encryption mechanism.</p></div><div class=paragraph><p>This facility provides several barriers to protect the data stored in each disk sector. It encrypts the contents of a disk sector using 128-bit AES in CBC mode. Each sector on the disk is encrypted with a different AES key. For more information on the cryptographic design, including how the sector keys are derived from the user-supplied passphrase, refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=gbde&amp;sektion=4&amp;format=html">gbde(4)</a>.</p></div><div class=paragraph><p>FreeBSD provides a kernel module for gbde which can be loaded with this command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># kldload geom_bde</span></code></pre></div></div><div class=paragraph><p>If using a custom kernel configuration file, ensure it contains this line:</p></div><div class=paragraph><p><code>options GEOM_BDE</code></p></div><div class=paragraph><p>The following example demonstrates adding a new hard drive to a system that will hold a single encrypted partition that will be mounted as <span class=filename>/private</span>.</p></div><div class="olist arabic procedure"><div class=title>Procedure: Encrypting a Partition with gbde</div><ol class=arabic><li><p>Add the New Hard Drive</p><div class=paragraph><p>Install the new drive to the system as explained in <a href=#disks-adding>Adding Disks</a>. For the purposes of this example, a new hard drive partition has been added as <span class=filename>/dev/ad4s1c</span> and <span class=filename>/dev/ad0s1*</span> represents the existing standard FreeBSD partitions.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ls /dev/ad*</span>
/dev/ad0        /dev/ad0s1b     /dev/ad0s1e     /dev/ad4s1
/dev/ad0s1      /dev/ad0s1c     /dev/ad0s1f     /dev/ad4s1c
/dev/ad0s1a     /dev/ad0s1d     /dev/ad4</code></pre></div></div></li><li><p>Create a Directory to Hold <code>gbde</code> Lock Files</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mkdir /etc/gbde</span></code></pre></div></div><div class=paragraph><p>The gbde lock file contains information that gbde requires to access encrypted partitions. Without access to the lock file, gbde will not be able to decrypt the data contained in the encrypted partition without significant manual intervention which is not supported by the software. Each encrypted partition uses a separate lock file.</p></div></li><li><p>Initialize the <code>gbde</code> Partition</p><div class=paragraph><p>A gbde partition must be initialized before it can be used. This initialization needs to be performed only once. This command will open the default editor, in order to set various configuration options in a template. For use with the UFS file system, set the sector_size to 2048:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># gbde init /dev/ad4s1c -i -L /etc/gbde/ad4s1c.lock</span>
<span class=c># $FreeBSD: src/sbin/gbde/template.txt,v 1.1.36.1 2009/08/03 08:13:06 kensmith Exp $</span>
<span class=c>#</span>
<span class=c># Sector size is the smallest unit of data which can be read or written.</span>
<span class=c># Making it too small decreases performance and decreases available space.</span>
<span class=c># Making it too large may prevent filesystems from working.  512 is the</span>
<span class=c># minimum and always safe.  For UFS, use the fragment size</span>
<span class=c>#</span>
sector_size	<span class=o>=</span>	2048
<span class=o>[</span>...]</code></pre></div></div><div class=paragraph><p>Once the edit is saved, the user will be asked twice to type the passphrase used to secure the data. The passphrase must be the same both times. The ability of gbde to protect data depends entirely on the quality of the passphrase. For tips on how to select a secure passphrase that is easy to remember, see <a href=http://world.std.com/~reinhold/diceware.html>http://world.std.com/~reinhold/diceware.htm</a>.</p></div><div class=paragraph><p>This initialization creates a lock file for the gbde partition. In this example, it is stored as <span class=filename>/etc/gbde/ad4s1c.lock</span>. Lock files must end in ".lock" in order to be correctly detected by the <span class=filename>/etc/rc.d/gbde</span> start up script.</p></div><div class="admonitionblock caution"><table><tbody><tr><td class=icon><i class="fa icon-caution" title=Caution></i></td><td class=content><div class=paragraph><p>Lock files <em>must</em> be backed up together with the contents of any encrypted partitions. Without the lock file, the legitimate owner will be unable to access the data on the encrypted partition.</p></div></td></tr></tbody></table></div></li><li><p>Attach the Encrypted Partition to the Kernel</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># gbde attach /dev/ad4s1c -l /etc/gbde/ad4s1c.lock</span></code></pre></div></div><div class=paragraph><p>This command will prompt to input the passphrase that was selected during the initialization of the encrypted partition. The new encrypted device will appear in <span class=filename>/dev</span> as <span class=filename>/dev/device_name.bde</span>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ls /dev/ad*</span>
/dev/ad0        /dev/ad0s1b     /dev/ad0s1e     /dev/ad4s1
/dev/ad0s1      /dev/ad0s1c     /dev/ad0s1f     /dev/ad4s1c
/dev/ad0s1a     /dev/ad0s1d     /dev/ad4        /dev/ad4s1c.bde</code></pre></div></div></li><li><p>Create a File System on the Encrypted Device</p><div class=paragraph><p>Once the encrypted device has been attached to the kernel, a file system can be created on the device. This example creates a UFS file system with soft updates enabled. Be sure to specify the partition which has a <span class=filename>*.bde</span> extension:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># newfs -U /dev/ad4s1c.bde</span></code></pre></div></div></li><li><p>Mount the Encrypted Partition</p><div class=paragraph><p>Create a mount point and mount the encrypted file system:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mkdir /private</span>
<span class=c># mount /dev/ad4s1c.bde /private</span></code></pre></div></div></li><li><p>Verify That the Encrypted File System is Available</p><div class=paragraph><p>The encrypted file system should now be visible and available for use:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% <span class=nb>df</span> <span class=nt>-H</span>
Filesystem        Size   Used  Avail Capacity  Mounted on
/dev/ad0s1a      1037M    72M   883M     8%    /
/devfs            1.0K   1.0K     0B   100%    /dev
/dev/ad0s1f       8.1G    55K   7.5G     0%    /home
/dev/ad0s1e      1037M   1.1M   953M     0%    /tmp
/dev/ad0s1d       6.1G   1.9G   3.7G    35%    /usr
/dev/ad4s1c.bde   150G   4.1K   138G     0%    /private</code></pre></div></div></li></ol></div><div class=paragraph><p>After each boot, any encrypted file systems must be manually re-attached to the kernel, checked for errors, and mounted, before the file systems can be used. To configure these steps, add the following lines to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>gbde_autoattach_all=&#34;YES&#34;
gbde_devices=&#34;ad4s1c&#34;
gbde_lockdir=&#34;/etc/gbde&#34;</pre></div></div><div class=paragraph><p>This requires that the passphrase be entered at the console at boot time. After typing the correct passphrase, the encrypted partition will be mounted automatically. Additional gbde boot options are available and listed in <a href="https://man.freebsd.org/cgi/man.cgi?query=rc.conf&amp;sektion=5&amp;format=html">rc.conf(5)</a>.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>sysinstall is incompatible with gbde-encrypted devices. All <span class=filename>*.bde</span> devices must be detached from the kernel before starting sysinstall or it will crash during its initial probing for devices. To detach the encrypted device used in the example, use the following command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># gbde detach /dev/ad4s1c</span></code></pre></div></div></td></tr></tbody></table></div></div><div class=sect3><h4 id=disks-encrypting-geli>17.12.2. Disk Encryption with <code>geli</code><a class=anchor href=#disks-encrypting-geli></a></h4><div class=paragraph><p>An alternative cryptographic GEOM class is available using <code>geli</code>. This control utility adds some features and uses a different scheme for doing cryptographic work. It provides the following features:</p></div><div class=ulist><ul><li><p>Utilizes the <a href="https://man.freebsd.org/cgi/man.cgi?query=crypto&amp;sektion=9&amp;format=html">crypto(9)</a> framework and automatically uses cryptographic hardware when it is available.</p></li><li><p>Supports multiple cryptographic algorithms such as AES, Blowfish, and 3DES.</p></li><li><p>Allows the root partition to be encrypted. The passphrase used to access the encrypted root partition will be requested during system boot.</p></li><li><p>Allows the use of two independent keys.</p></li><li><p>It is fast as it performs simple sector-to-sector encryption.</p></li><li><p>Allows backup and restore of master keys. If a user destroys their keys, it is still possible to get access to the data by restoring keys from the backup.</p></li><li><p>Allows a disk to attach with a random, one-time key which is useful for swap partitions and temporary file systems.</p></li></ul></div><div class=paragraph><p>More features and usage examples can be found in <a href="https://man.freebsd.org/cgi/man.cgi?query=geli&amp;sektion=8&amp;format=html">geli(8)</a>.</p></div><div class=paragraph><p>The following example describes how to generate a key file which will be used as part of the master key for the encrypted provider mounted under <span class=filename>/private</span>. The key file will provide some random data used to encrypt the master key. The master key will also be protected by a passphrase. The provider’s sector size will be 4kB. The example describes how to attach to the <code>geli</code> provider, create a file system on it, mount it, work with it, and finally, how to detach it.</p></div><div class="olist arabic procedure"><div class=title>Procedure: Encrypting a Partition with <code>geli</code></div><ol class=arabic><li><p>Load <code>geli</code> Support</p><div class=paragraph><p>Support for <code>geli</code> is available as a loadable kernel module. To configure the system to automatically load the module at boot time, add the following line to <span class=filename>/boot/loader.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>geom_eli_load=&#34;YES&#34;</pre></div></div><div class=paragraph><p>To load the kernel module now:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># kldload geom_eli</span></code></pre></div></div><div class=paragraph><p>For a custom kernel, ensure the kernel configuration file contains these lines:</p></div><div class="literalblock programlisting"><div class=content><pre>options GEOM_ELI
device crypto</pre></div></div></li><li><p>Generate the Master Key</p><div class=paragraph><p>The following commands generate a master key that all data will be encrypted with. This key can never be changed. Rather than using it directly, it is encrypted with one or more user keys. The user keys are made up of an optional combination of random bytes from a file, <span class=filename>/root/da2.key</span>, and/or a passphrase. In this case, the data source for the key file is <span class=filename>/dev/random</span>. This command also configures the sector size of the provider (<span class=filename>/dev/da2.eli</span>) as 4kB, for better performance:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># dd if=/dev/random of=/root/da2.key bs=64 count=1</span>
<span class=c># geli init -K /root/da2.key -s 4096 /dev/da2</span>
Enter new passphrase:
Reenter new passphrase:</code></pre></div></div><div class=paragraph><p>It is not mandatory to use both a passphrase and a key file as either method of securing the master key can be used in isolation.</p></div><div class=paragraph><p>If the key file is given as "-", standard input will be used. For example, this command generates three key files:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cat keyfile1 keyfile2 keyfile3 | geli init -K - /dev/da2</span></code></pre></div></div></li><li><p>Attach the Provider with the Generated Key</p><div class=paragraph><p>To attach the provider, specify the key file, the name of the disk, and the passphrase:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># geli attach -k /root/da2.key /dev/da2</span>
Enter passphrase:</code></pre></div></div><div class=paragraph><p>This creates a new device with an <span class=filename>.eli</span> extension:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ls /dev/da2*</span>
/dev/da2  /dev/da2.eli</code></pre></div></div></li><li><p>Create the New File System</p><div class=paragraph><p>Next, format the device with the UFS file system and mount it on an existing mount point:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># dd if=/dev/random of=/dev/da2.eli bs=1m</span>
<span class=c># newfs /dev/da2.eli</span>
<span class=c># mount /dev/da2.eli /private</span></code></pre></div></div><div class=paragraph><p>The encrypted file system should now be available for use:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># df -H</span>
Filesystem     Size   Used  Avail Capacity  Mounted on
/dev/ad0s1a    248M    89M   139M    38%    /
/devfs         1.0K   1.0K     0B   100%    /dev
/dev/ad0s1f    7.7G   2.3G   4.9G    32%    /usr
/dev/ad0s1d    989M   1.5M   909M     0%    /tmp
/dev/ad0s1e    3.9G   1.3G   2.3G    35%    /var
/dev/da2.eli   150G   4.1K   138G     0%    /private</code></pre></div></div></li></ol></div><div class=paragraph><p>Once the work on the encrypted partition is done, and the <span class=filename>/private</span> partition is no longer needed, it is prudent to put the device into cold storage by unmounting and detaching the <code>geli</code> encrypted partition from the kernel:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># umount /private</span>
<span class=c># geli detach da2.eli</span></code></pre></div></div><div class=paragraph><p>A <span class=filename>rc.d</span> script is provided to simplify the mounting of <code>geli</code>-encrypted devices at boot time. For this example, add these lines to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>geli_devices=&#34;da2&#34;
geli_da2_flags=&#34;-k /root/da2.key&#34;</pre></div></div><div class=paragraph><p>This configures <span class=filename>/dev/da2</span> as a <code>geli</code> provider with a master key of <span class=filename>/root/da2.key</span>. The system will automatically detach the provider from the kernel before the system shuts down. During the startup process, the script will prompt for the passphrase before attaching the provider. Other kernel messages might be shown before and after the password prompt. If the boot process seems to stall, look carefully for the password prompt among the other messages. Once the correct passphrase is entered, the provider is attached. The file system is then mounted, typically by an entry in <span class=filename>/etc/fstab</span>. Refer to <a href=./#mount-unmount>“Mounting and Unmounting File Systems”</a> for instructions on how to configure a file system to mount at boot time.</p></div></div></div><div class=sect2><h3 id=swap-encrypting>17.13. Encrypting Swap<a class=anchor href=#swap-encrypting></a></h3><div class=paragraph><p>Like the encryption of disk partitions, encryption of swap space is used to protect sensitive information. Consider an application that deals with passwords. As long as these passwords stay in physical memory, they are not written to disk and will be cleared after a reboot. However, if FreeBSD starts swapping out memory pages to free space, the passwords may be written to the disk unencrypted. Encrypting swap space can be a solution for this scenario.</p></div><div class=paragraph><p>This section demonstrates how to configure an encrypted swap partition using <a href="https://man.freebsd.org/cgi/man.cgi?query=gbde&amp;sektion=8&amp;format=html">gbde(8)</a> or <a href="https://man.freebsd.org/cgi/man.cgi?query=geli&amp;sektion=8&amp;format=html">geli(8)</a> encryption. It assumes that <span class=filename>/dev/ada0s1b</span> is the swap partition.</p></div><div class=sect3><h4 id=_configuring_encrypted_swap>17.13.1. Configuring Encrypted Swap<a class=anchor href=#_configuring_encrypted_swap></a></h4><div class=paragraph><p>Swap partitions are not encrypted by default and should be cleared of any sensitive data before continuing. To overwrite the current swap partition with random garbage, execute the following command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># dd if=/dev/random of=/dev/ada0s1b bs=1m</span></code></pre></div></div><div class=paragraph><p>To encrypt the swap partition using <a href="https://man.freebsd.org/cgi/man.cgi?query=gbde&amp;sektion=8&amp;format=html">gbde(8)</a>, add the <code>.bde</code> suffix to the swap line in <span class=filename>/etc/fstab</span>:</p></div><div class="literalblock programlisting"><div class=content><pre># Device		Mountpoint	FStype	Options		Dump	Pass#
/dev/ada0s1b.bde	none		swap	sw		0	0</pre></div></div><div class=paragraph><p>To instead encrypt the swap partition using <a href="https://man.freebsd.org/cgi/man.cgi?query=geli&amp;sektion=8&amp;format=html">geli(8)</a>, use the <code>.eli</code> suffix:</p></div><div class="literalblock programlisting"><div class=content><pre># Device		Mountpoint	FStype	Options		Dump	Pass#
/dev/ada0s1b.eli	none		swap	sw		0	0</pre></div></div><div class=paragraph><p>By default, <a href="https://man.freebsd.org/cgi/man.cgi?query=geli&amp;sektion=8&amp;format=html">geli(8)</a> uses the AES algorithm with a key length of 128 bits. Normally the default settings will suffice. If desired, these defaults can be altered in the options field in <span class=filename>/etc/fstab</span>. The possible flags are:</p></div><div class=dlist><dl><dt class=hdlist1>aalgo</dt><dd><p>Data integrity verification algorithm used to ensure that the encrypted data has not been tampered with. See <a href="https://man.freebsd.org/cgi/man.cgi?query=geli&amp;sektion=8&amp;format=html">geli(8)</a> for a list of supported algorithms.</p></dd><dt class=hdlist1>ealgo</dt><dd><p>Encryption algorithm used to protect the data. See <a href="https://man.freebsd.org/cgi/man.cgi?query=geli&amp;sektion=8&amp;format=html">geli(8)</a> for a list of supported algorithms.</p></dd><dt class=hdlist1>keylen</dt><dd><p>The length of the key used for the encryption algorithm. See <a href="https://man.freebsd.org/cgi/man.cgi?query=geli&amp;sektion=8&amp;format=html">geli(8)</a> for the key lengths that are supported by each encryption algorithm.</p></dd><dt class=hdlist1>sectorsize</dt><dd><p>The size of the blocks data is broken into before it is encrypted. Larger sector sizes increase performance at the cost of higher storage overhead. The recommended size is 4096 bytes.</p></dd></dl></div><div class=paragraph><p>This example configures an encrypted swap partition using the Blowfish algorithm with a key length of 128 bits and a sectorsize of 4 kilobytes:</p></div><div class="literalblock programlisting"><div class=content><pre># Device		Mountpoint	FStype	Options				Dump	Pass#
/dev/ada0s1b.eli	none		swap	sw,ealgo=blowfish,keylen=128,sectorsize=4096	0	0</pre></div></div></div><div class=sect3><h4 id=_encrypted_swap_verification>17.13.2. Encrypted Swap Verification<a class=anchor href=#_encrypted_swap_verification></a></h4><div class=paragraph><p>Once the system has rebooted, proper operation of the encrypted swap can be verified using <code>swapinfo</code>.</p></div><div class=paragraph><p>If <a href="https://man.freebsd.org/cgi/man.cgi?query=gbde&amp;sektion=8&amp;format=html">gbde(8)</a> is being used:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% swapinfo
Device          1K-blocks     Used    Avail Capacity
/dev/ada0s1b.bde   542720        0   542720     0</code></pre></div></div><div class=paragraph><p>If <a href="https://man.freebsd.org/cgi/man.cgi?query=geli&amp;sektion=8&amp;format=html">geli(8)</a> is being used:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% swapinfo
Device          1K-blocks     Used    Avail Capacity
/dev/ada0s1b.eli   542720        0   542720     0</code></pre></div></div></div></div><div class=sect2><h3 id=disks-hast>17.14. Highly Available Storage (HAST)<a class=anchor href=#disks-hast></a></h3><div class=paragraph><p>High availability is one of the main requirements in serious business applications and highly-available storage is a key component in such environments. In FreeBSD, the Highly Available STorage (HAST) framework allows transparent storage of the same data across several physically separated machines connected by a TCP/IP network. HAST can be understood as a network-based RAID1 (mirror), and is similar to the DRBD® storage system used in the GNU/Linux® platform. In combination with other high-availability features of FreeBSD like CARP, HAST makes it possible to build a highly-available storage cluster that is resistant to hardware failures.</p></div><div class=paragraph><p>The following are the main features of HAST:</p></div><div class=ulist><ul><li><p>Can be used to mask I/O errors on local hard drives.</p></li><li><p>File system agnostic as it works with any file system supported by FreeBSD.</p></li><li><p>Efficient and quick resynchronization as only the blocks that were modified during the downtime of a node are synchronized.</p></li><li><p>Can be used in an already deployed environment to add additional redundancy.</p></li><li><p>Together with CARP, Heartbeat, or other tools, it can be used to build a robust and durable storage system.</p></li></ul></div><div class=paragraph><p>After reading this section, you will know:</p></div><div class=ulist><ul><li><p>What HAST is, how it works, and which features it provides.</p></li><li><p>How to set up and use HAST on FreeBSD.</p></li><li><p>How to integrate CARP and <a href="https://man.freebsd.org/cgi/man.cgi?query=devd&amp;sektion=8&amp;format=html">devd(8)</a> to build a robust storage system.</p></li></ul></div><div class=paragraph><p>Before reading this section, you should:</p></div><div class=ulist><ul><li><p>Understand UNIX® and FreeBSD basics (<a href=./#basics>FreeBSD Basics</a>).</p></li><li><p>Know how to configure network interfaces and other core FreeBSD subsystems (<a href=./#config-tuning>Configuration and Tuning</a>).</p></li><li><p>Have a good understanding of FreeBSD networking (<a href=./#network-communication>Network Communication</a>).</p></li></ul></div><div class=paragraph><p>The HAST project was sponsored by The FreeBSD Foundation with support from <a href=http://www.omc.net/>http://www.omc.net/</a> and <a href=http://www.transip.nl/>http://www.transip.nl/</a>.</p></div><div class=sect3><h4 id=_hast_operation>17.14.1. HAST Operation<a class=anchor href=#_hast_operation></a></h4><div class=paragraph><p>HAST provides synchronous block-level replication between two physical machines: the <em>primary</em>, also known as the <em>master</em> node, and the <em>secondary</em>, or <em>slave</em> node. These two machines together are referred to as a cluster.</p></div><div class=paragraph><p>Since HAST works in a primary-secondary configuration, it allows only one of the cluster nodes to be active at any given time. The primary node, also called <em>active</em>, is the one which will handle all the I/O requests to HAST-managed devices. The secondary node is automatically synchronized from the primary node.</p></div><div class=paragraph><p>The physical components of the HAST system are the local disk on primary node, and the disk on the remote, secondary node.</p></div><div class=paragraph><p>HAST operates synchronously on a block level, making it transparent to file systems and applications. HAST provides regular GEOM providers in <span class=filename>/dev/hast/</span> for use by other tools or applications. There is no difference between using HAST-provided devices and raw disks or partitions.</p></div><div class=paragraph><p>Each write, delete, or flush operation is sent to both the local disk and to the remote disk over TCP/IP. Each read operation is served from the local disk, unless the local disk is not up-to-date or an I/O error occurs. In such cases, the read operation is sent to the secondary node.</p></div><div class=paragraph><p>HAST tries to provide fast failure recovery. For this reason, it is important to reduce synchronization time after a node’s outage. To provide fast synchronization, HAST manages an on-disk bitmap of dirty extents and only synchronizes those during a regular synchronization, with an exception of the initial sync.</p></div><div class=paragraph><p>There are many ways to handle synchronization. HAST implements several replication modes to handle different synchronization methods:</p></div><div class=ulist><ul><li><p><em>memsync</em>: This mode reports a write operation as completed when the local write operation is finished and when the remote node acknowledges data arrival, but before actually storing the data. The data on the remote node will be stored directly after sending the acknowledgement. This mode is intended to reduce latency, but still provides good reliability. This mode is the default.</p></li><li><p><em>fullsync</em>: This mode reports a write operation as completed when both the local write and the remote write complete. This is the safest and the slowest replication mode.</p></li><li><p><em>async</em>: This mode reports a write operation as completed when the local write completes. This is the fastest and the most dangerous replication mode. It should only be used when replicating to a distant node where latency is too high for other modes.</p></li></ul></div></div><div class=sect3><h4 id=_hast_configuration>17.14.2. HAST Configuration<a class=anchor href=#_hast_configuration></a></h4><div class=paragraph><p>The HAST framework consists of several components:</p></div><div class=ulist><ul><li><p>The <a href="https://man.freebsd.org/cgi/man.cgi?query=hastd&amp;sektion=8&amp;format=html">hastd(8)</a> daemon which provides data synchronization. When this daemon is started, it will automatically load <code>geom_gate.ko</code>.</p></li><li><p>The userland management utility, <a href="https://man.freebsd.org/cgi/man.cgi?query=hastctl&amp;sektion=8&amp;format=html">hastctl(8)</a>.</p></li><li><p>The <a href="https://man.freebsd.org/cgi/man.cgi?query=hast.conf&amp;sektion=5&amp;format=html">hast.conf(5)</a> configuration file. This file must exist before starting hastd.</p></li></ul></div><div class=paragraph><p>Users who prefer to statically build <code>GEOM_GATE</code> support into the kernel should add this line to the custom kernel configuration file, then rebuild the kernel using the instructions in <a href=./#kernelconfig>Configuring the FreeBSD Kernel</a>:</p></div><div class="literalblock programlisting"><div class=content><pre>options	GEOM_GATE</pre></div></div><div class=paragraph><p>The following example describes how to configure two nodes in master-slave/primary-secondary operation using HAST to replicate the data between the two. The nodes will be called <code>hasta</code>, with an IP address of <code>172.16.0.1</code>, and <code>hastb</code>, with an IP address of <code>172.16.0.2</code>. Both nodes will have a dedicated hard drive <span class=filename>/dev/ad6</span> of the same size for HAST operation. The HAST pool, sometimes referred to as a resource or the GEOM provider in <span class=filename>/dev/hast/</span>, will be called <code>test</code>.</p></div><div class=paragraph><p>Configuration of HAST is done using <span class=filename>/etc/hast.conf</span>. This file should be identical on both nodes. The simplest configuration is:</p></div><div class="literalblock programlisting"><div class=content><pre>resource test {
	on hasta {
		local /dev/ad6
		remote 172.16.0.2
	}
	on hastb {
		local /dev/ad6
		remote 172.16.0.1
	}
}</pre></div></div><div class=paragraph><p>For more advanced configuration, refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=hast.conf&amp;sektion=5&amp;format=html">hast.conf(5)</a>.</p></div><div class="admonitionblock tip"><table><tbody><tr><td class=icon><i class="fa icon-tip" title=Tip></i></td><td class=content><div class=paragraph><p>It is also possible to use host names in the <code>remote</code> statements if the hosts are resolvable and defined either in <span class=filename>/etc/hosts</span> or in the local DNS.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Once the configuration exists on both nodes, the HAST pool can be created. Run these commands on both nodes to place the initial metadata onto the local disk and to start <a href="https://man.freebsd.org/cgi/man.cgi?query=hastd&amp;sektion=8&amp;format=html">hastd(8)</a>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># hastctl create test</span>
<span class=c># service hastd onestart</span></code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>It is <em>not</em> possible to use GEOM providers with an existing file system or to convert an existing storage to a HAST-managed pool. This procedure needs to store some metadata on the provider and there will not be enough required space available on an existing provider.</p></div></td></tr></tbody></table></div><div class=paragraph><p>A HAST node’s <code>primary</code> or <code>secondary</code> role is selected by an administrator, or software like Heartbeat, using <a href="https://man.freebsd.org/cgi/man.cgi?query=hastctl&amp;sektion=8&amp;format=html">hastctl(8)</a>. On the primary node, <code>hasta</code>, issue this command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># hastctl role primary test</span></code></pre></div></div><div class=paragraph><p>Run this command on the secondary node, <code>hastb</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># hastctl role secondary test</span></code></pre></div></div><div class=paragraph><p>Verify the result by running <code>hastctl</code> on each node:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># hastctl status test</span></code></pre></div></div><div class=paragraph><p>Check the <code>status</code> line in the output. If it says <code>degraded</code>, something is wrong with the configuration file. It should say <code>complete</code> on each node, meaning that the synchronization between the nodes has started. The synchronization completes when <code>hastctl status</code> reports 0 bytes of <code>dirty</code> extents.</p></div><div class=paragraph><p>The next step is to create a file system on the GEOM provider and mount it. This must be done on the <code>primary</code> node. Creating the file system can take a few minutes, depending on the size of the hard drive. This example creates a UFS file system on <span class=filename>/dev/hast/test</span>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># newfs -U /dev/hast/test</span>
<span class=c># mkdir /hast/test</span>
<span class=c># mount /dev/hast/test /hast/test</span></code></pre></div></div><div class=paragraph><p>Once the HAST framework is configured properly, the final step is to make sure that HAST is started automatically during system boot. Add this line to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>hastd_enable=&#34;YES&#34;</pre></div></div><div class=sect4><h5 id=_failover_configuration>17.14.2.1. Failover Configuration<a class=anchor href=#_failover_configuration></a></h5><div class=paragraph><p>The goal of this example is to build a robust storage system which is resistant to the failure of any given node. If the primary node fails, the secondary node is there to take over seamlessly, check and mount the file system, and continue to work without missing a single bit of data.</p></div><div class=paragraph><p>To accomplish this task, the Common Address Redundancy Protocol (CARP) is used to provide for automatic failover at the IP layer. CARP allows multiple hosts on the same network segment to share an IP address. Set up CARP on both nodes of the cluster according to the documentation available in <a href=./#carp>“Common Address Redundancy Protocol (CARP)”</a>. In this example, each node will have its own management IP address and a shared IP address of <em>172.16.0.254</em>. The primary HAST node of the cluster must be the master CARP node.</p></div><div class=paragraph><p>The HAST pool created in the previous section is now ready to be exported to the other hosts on the network. This can be accomplished by exporting it through NFS or Samba, using the shared IP address <em>172.16.0.254</em>. The only problem which remains unresolved is an automatic failover should the primary node fail.</p></div><div class=paragraph><p>In the event of CARP interfaces going up or down, the FreeBSD operating system generates a <a href="https://man.freebsd.org/cgi/man.cgi?query=devd&amp;sektion=8&amp;format=html">devd(8)</a> event, making it possible to watch for state changes on the CARP interfaces. A state change on the CARP interface is an indication that one of the nodes failed or came back online. These state change events make it possible to run a script which will automatically handle the HAST failover.</p></div><div class=paragraph><p>To catch state changes on the CARP interfaces, add this configuration to <span class=filename>/etc/devd.conf</span> on each node:</p></div><div class="literalblock programlisting"><div class=content><pre>notify 30 {
	match &#34;system&#34; &#34;IFNET&#34;;
	match &#34;subsystem&#34; &#34;carp0&#34;;
	match &#34;type&#34; &#34;LINK_UP&#34;;
	action &#34;/usr/local/sbin/carp-hast-switch master&#34;;
};

notify 30 {
	match &#34;system&#34; &#34;IFNET&#34;;
	match &#34;subsystem&#34; &#34;carp0&#34;;
	match &#34;type&#34; &#34;LINK_DOWN&#34;;
	action &#34;/usr/local/sbin/carp-hast-switch slave&#34;;
};</pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>If the systems are running FreeBSD 10 or higher, replace <span class=filename>carp0</span> with the name of the CARP-configured interface.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Restart <a href="https://man.freebsd.org/cgi/man.cgi?query=devd&amp;sektion=8&amp;format=html">devd(8)</a> on both nodes to put the new configuration into effect:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service devd restart</span></code></pre></div></div><div class=paragraph><p>When the specified interface state changes by going up or down , the system generates a notification, allowing the <a href="https://man.freebsd.org/cgi/man.cgi?query=devd&amp;sektion=8&amp;format=html">devd(8)</a> subsystem to run the specified automatic failover script, <span class=filename>/usr/local/sbin/carp-hast-switch</span>. For further clarification about this configuration, refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=devd.conf&amp;sektion=5&amp;format=html">devd.conf(5)</a>.</p></div><div class=paragraph><p>Here is an example of an automated failover script:</p></div><div class="literalblock programlisting"><div class=content><pre>#!/bin/sh

# Original script by Freddie Cash &lt;fjwcash@gmail.com&gt;
# Modified by Michael W. Lucas &lt;mwlucas@BlackHelicopters.org&gt;
# and Viktor Petersson &lt;vpetersson@wireload.net&gt;

# The names of the HAST resources, as listed in /etc/hast.conf
resources=&#34;test&#34;

# delay in mounting HAST resource after becoming master
# make your best guess
delay=3

# logging
log=&#34;local0.debug&#34;
name=&#34;carp-hast&#34;

# end of user configurable stuff

case &#34;$1&#34; in
	master)
		logger -p $log -t $name &#34;Switching to primary provider for ${resources}.&#34;
		sleep ${delay}

		# Wait for any &#34;hastd secondary&#34; processes to stop
		for disk in ${resources}; do
			while $( pgrep -lf &#34;hastd: ${disk} \(secondary\)&#34; &gt; /dev/null 2&gt;&amp;1 ); do
				sleep 1
			done

			# Switch role for each disk
			hastctl role primary ${disk}
			if [ $? -ne 0 ]; then
				logger -p $log -t $name &#34;Unable to change role to primary for resource ${disk}.&#34;
				exit 1
			fi
		done

		# Wait for the /dev/hast/* devices to appear
		for disk in ${resources}; do
			for I in $( jot 60 ); do
				[ -c &#34;/dev/hast/${disk}&#34; ] &amp;&amp; break
				sleep 0.5
			done

			if [ ! -c &#34;/dev/hast/${disk}&#34; ]; then
				logger -p $log -t $name &#34;GEOM provider /dev/hast/${disk} did not appear.&#34;
				exit 1
			fi
		done

		logger -p $log -t $name &#34;Role for HAST resources ${resources} switched to primary.&#34;

		logger -p $log -t $name &#34;Mounting disks.&#34;
		for disk in ${resources}; do
			mkdir -p /hast/${disk}
			fsck -p -y -t ufs /dev/hast/${disk}
			mount /dev/hast/${disk} /hast/${disk}
		done

	;;

	slave)
		logger -p $log -t $name &#34;Switching to secondary provider for ${resources}.&#34;

		# Switch roles for the HAST resources
		for disk in ${resources}; do
			if ! mount | grep -q &#34;^/dev/hast/${disk} on &#34;
			then
			else
				umount -f /hast/${disk}
			fi
			sleep $delay
			hastctl role secondary ${disk} 2&gt;&amp;1
			if [ $? -ne 0 ]; then
				logger -p $log -t $name &#34;Unable to switch role to secondary for resource ${disk}.&#34;
				exit 1
			fi
			logger -p $log -t $name &#34;Role switched to secondary for resource ${disk}.&#34;
		done
	;;
esac</pre></div></div><div class=paragraph><p>In a nutshell, the script takes these actions when a node becomes master:</p></div><div class=ulist><ul><li><p>Promotes the HAST pool to primary on the other node.</p></li><li><p>Checks the file system under the HAST pool.</p></li><li><p>Mounts the pool.</p></li></ul></div><div class=paragraph><p>When a node becomes secondary:</p></div><div class=ulist><ul><li><p>Unmounts the HAST pool.</p></li><li><p>Degrades the HAST pool to secondary.</p></li></ul></div><div class="admonitionblock caution"><table><tbody><tr><td class=icon><i class="fa icon-caution" title=Caution></i></td><td class=content><div class=paragraph><p>This is just an example script which serves as a proof of concept. It does not handle all the possible scenarios and can be extended or altered in any way, for example, to start or stop required services.</p></div></td></tr></tbody></table></div><div class="admonitionblock tip"><table><tbody><tr><td class=icon><i class="fa icon-tip" title=Tip></i></td><td class=content><div class=paragraph><p>For this example, a standard UFS file system was used. To reduce the time needed for recovery, a journal-enabled UFS or ZFS file system can be used instead.</p></div></td></tr></tbody></table></div><div class=paragraph><p>More detailed information with additional examples can be found at <a href=http://wiki.FreeBSD.org/HAST>http://wiki.FreeBSD.org/HAST</a>.</p></div></div></div><div class=sect3><h4 id=_troubleshooting_3>17.14.3. Troubleshooting<a class=anchor href=#_troubleshooting_3></a></h4><div class=paragraph><p>HAST should generally work without issues. However, as with any other software product, there may be times when it does not work as supposed. The sources of the problems may be different, but the rule of thumb is to ensure that the time is synchronized between the nodes of the cluster.</p></div><div class=paragraph><p>When troubleshooting HAST, the debugging level of <a href="https://man.freebsd.org/cgi/man.cgi?query=hastd&amp;sektion=8&amp;format=html">hastd(8)</a> should be increased by starting <code>hastd</code> with <code>-d</code>. This argument may be specified multiple times to further increase the debugging level. Consider also using <code>-F</code>, which starts <code>hastd</code> in the foreground.</p></div><div class=sect4><h5 id=disks-hast-sb>17.14.3.1. Recovering from the Split-brain Condition<a class=anchor href=#disks-hast-sb></a></h5><div class=paragraph><p><em>Split-brain</em> occurs when the nodes of the cluster are unable to communicate with each other, and both are configured as primary. This is a dangerous condition because it allows both nodes to make incompatible changes to the data. This problem must be corrected manually by the system administrator.</p></div><div class=paragraph><p>The administrator must either decide which node has more important changes, or perform the merge manually. Then, let HAST perform full synchronization of the node which has the broken data. To do this, issue these commands on the node which needs to be resynchronized:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># hastctl role init test</span>
<span class=c># hastctl create test</span>
<span class=c># hastctl role secondary test</span></code></pre></div></div></div></div></div></div></div><div class=sect1><h2 id=geom>Rozdział 18. GEOM: Modular Disk Transformation Framework<a class=anchor href=#geom></a></h2><div class=sectionbody><div class=sect2><h3 id=geom-synopsis>18.1. Synopsis<a class=anchor href=#geom-synopsis></a></h3><div class=paragraph><p>In FreeBSD, the GEOM framework permits access and control to classes, such as Master Boot Records and BSD labels, through the use of providers, or the disk devices in <span class=filename>/dev</span>. By supporting various software RAID configurations, GEOM transparently provides access to the operating system and operating system utilities.</p></div><div class=paragraph><p>This chapter covers the use of disks under the GEOM framework in FreeBSD. This includes the major RAID control utilities which use the framework for configuration. This chapter is not a definitive guide to RAID configurations and only GEOM-supported RAID classifications are discussed.</p></div><div class=paragraph><p>After reading this chapter, you will know:</p></div><div class=ulist><ul><li><p>What type of RAID support is available through GEOM.</p></li><li><p>How to use the base utilities to configure, maintain, and manipulate the various RAID levels.</p></li><li><p>How to mirror, stripe, encrypt, and remotely connect disk devices through GEOM.</p></li><li><p>How to troubleshoot disks attached to the GEOM framework.</p></li></ul></div><div class=paragraph><p>Before reading this chapter, you should:</p></div><div class=ulist><ul><li><p>Understand how FreeBSD treats disk devices (<a href=./#disks>Storage</a>).</p></li><li><p>Know how to configure and install a new kernel (<a href=./#kernelconfig>Configuring the FreeBSD Kernel</a>).</p></li></ul></div></div><div class=sect2><h3 id=geom-striping>18.2. RAID0 - Striping<a class=anchor href=#geom-striping></a></h3><div class=paragraph><p>Striping combines several disk drives into a single volume. Striping can be performed through the use of hardware RAID controllers. The GEOM disk subsystem provides software support for disk striping, also known as RAID0, without the need for a RAID disk controller.</p></div><div class=paragraph><p>In RAID0, data is split into blocks that are written across all the drives in the array. As seen in the following illustration, instead of having to wait on the system to write 256k to one disk, RAID0 can simultaneously write 64k to each of the four disks in the array, offering superior I/O performance. This performance can be enhanced further by using multiple disk controllers.</p></div><div class=imageblock><div class=content><img src=../../../../images/books/handbook/geom/striping.png alt="Disk Striping Illustration"></div></div><div class=paragraph><p>Each disk in a RAID0 stripe must be of the same size, since I/O requests are interleaved to read or write to multiple disks in parallel.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>RAID0 does <em>not</em> provide any redundancy. This means that if one disk in the array fails, all of the data on the disks is lost. If the data is important, implement a backup strategy that regularly saves backups to a remote system or device.</p></div></td></tr></tbody></table></div><div class=paragraph><p>The process for creating a software, GEOM-based RAID0 on a FreeBSD system using commodity disks is as follows. Once the stripe is created, refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=gstripe&amp;sektion=8&amp;format=html">gstripe(8)</a> for more information on how to control an existing stripe.</p></div><div class="sidebarblock procedure"><div class=content><div class=paragraph><p><strong>Procedure: Creating a Stripe of Unformatted ATA Disks</strong></p></div><div class="olist arabic"><ol class=arabic><li><p>Load the <span class=filename>geom_stripe.ko</span> module:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># kldload geom_stripe</span></code></pre></div></div></li><li><p>Ensure that a suitable mount point exists. If this volume will become a root partition, then temporarily use another mount point such as <span class=filename>/mnt</span>.</p></li><li><p>Determine the device names for the disks which will be striped, and create the new stripe device. For example, to stripe two unused and unpartitioned ATA disks with device names of <span class=filename>/dev/ad2</span> and <span class=filename>/dev/ad3</span>:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># gstripe label -v st0 /dev/ad2 /dev/ad3</span>
Metadata value stored on /dev/ad2.
Metadata value stored on /dev/ad3.
Done.</code></pre></div></div></li><li><p>Write a standard label, also known as a partition table, on the new volume and install the default bootstrap code:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># bsdlabel -wB /dev/stripe/st0</span></code></pre></div></div></li><li><p>This process should create two other devices in <span class=filename>/dev/stripe</span> in addition to <span class=filename>st0</span>. Those include <span class=filename>st0a</span> and <span class=filename>st0c</span>. At this point, a UFS file system can be created on <span class=filename>st0a</span> using <code>newfs</code>:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># newfs -U /dev/stripe/st0a</span></code></pre></div></div><div class=paragraph><p>Many numbers will glide across the screen, and after a few seconds, the process will be complete. The volume has been created and is ready to be mounted.</p></div></li><li><p>To manually mount the created disk stripe:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mount /dev/stripe/st0a /mnt</span></code></pre></div></div></li><li><p>To mount this striped file system automatically during the boot process, place the volume information in <span class=filename>/etc/fstab</span>. In this example, a permanent mount point, named <span class=filename>stripe</span>, is created:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mkdir /stripe</span>
<span class=c># echo &#34;/dev/stripe/st0a /stripe ufs rw 2 2&#34; \</span>
<span class=o>&gt;&gt;</span> /etc/fstab</code></pre></div></div></li><li><p>The <span class=filename>geom_stripe.ko</span> module must also be automatically loaded during system initialization, by adding a line to <span class=filename>/boot/loader.conf</span>:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># echo &#39;geom_stripe_load=&#34;YES&#34;&#39; &gt;&gt; /boot/loader.conf</span></code></pre></div></div></li></ol></div></div></div></div><div class=sect2><h3 id=geom-mirror>18.3. RAID1 - Mirroring<a class=anchor href=#geom-mirror></a></h3><div class=paragraph><p>RAID1, or <em>mirroring</em>, is the technique of writing the same data to more than one disk drive. Mirrors are usually used to guard against data loss due to drive failure. Each drive in a mirror contains an identical copy of the data. When an individual drive fails, the mirror continues to work, providing data from the drives that are still functioning. The computer keeps running, and the administrator has time to replace the failed drive without user interruption.</p></div><div class=paragraph><p>Two common situations are illustrated in these examples. The first creates a mirror out of two new drives and uses it as a replacement for an existing single drive. The second example creates a mirror on a single new drive, copies the old drive’s data to it, then inserts the old drive into the mirror. While this procedure is slightly more complicated, it only requires one new drive.</p></div><div class=paragraph><p>Traditionally, the two drives in a mirror are identical in model and capacity, but <a href="https://man.freebsd.org/cgi/man.cgi?query=gmirror&amp;sektion=8&amp;format=html">gmirror(8)</a> does not require that. Mirrors created with dissimilar drives will have a capacity equal to that of the smallest drive in the mirror. Extra space on larger drives will be unused. Drives inserted into the mirror later must have at least as much capacity as the smallest drive already in the mirror.</p></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>The mirroring procedures shown here are non-destructive, but as with any major disk operation, make a full backup first.</p></div></td></tr></tbody></table></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>While <a href="https://man.freebsd.org/cgi/man.cgi?query=dump&amp;sektion=8&amp;format=html">dump(8)</a> is used in these procedures to copy file systems, it does not work on file systems with soft updates journaling. See <a href="https://man.freebsd.org/cgi/man.cgi?query=tunefs&amp;sektion=8&amp;format=html">tunefs(8)</a> for information on detecting and disabling soft updates journaling.</p></div></td></tr></tbody></table></div><div class=sect3><h4 id=geom-mirror-metadata>18.3.1. Metadata Issues<a class=anchor href=#geom-mirror-metadata></a></h4><div class=paragraph><p>Many disk systems store metadata at the end of each disk. Old metadata should be erased before reusing the disk for a mirror. Most problems are caused by two particular types of leftover metadata: GPT partition tables and old metadata from a previous mirror.</p></div><div class=paragraph><p>GPT metadata can be erased with <a href="https://man.freebsd.org/cgi/man.cgi?query=gpart&amp;sektion=8&amp;format=html">gpart(8)</a>. This example erases both primary and backup GPT partition tables from disk <span class=filename>ada8</span>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># gpart destroy -F ada8</span></code></pre></div></div><div class=paragraph><p>A disk can be removed from an active mirror and the metadata erased in one step using <a href="https://man.freebsd.org/cgi/man.cgi?query=gmirror&amp;sektion=8&amp;format=html">gmirror(8)</a>. Here, the example disk <span class=filename>ada8</span> is removed from the active mirror <span class=filename>gm4</span>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># gmirror remove gm4 ada8</span></code></pre></div></div><div class=paragraph><p>If the mirror is not running, but old mirror metadata is still on the disk, use <code>gmirror clear</code> to remove it:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># gmirror clear ada8</span></code></pre></div></div><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=gmirror&amp;sektion=8&amp;format=html">gmirror(8)</a> stores one block of metadata at the end of the disk. Because GPT partition schemes also store metadata at the end of the disk, mirroring entire GPT disks with <a href="https://man.freebsd.org/cgi/man.cgi?query=gmirror&amp;sektion=8&amp;format=html">gmirror(8)</a> is not recommended. MBR partitioning is used here because it only stores a partition table at the start of the disk and does not conflict with the mirror metadata.</p></div></div><div class=sect3><h4 id=geom-mirror-two-new-disks>18.3.2. Creating a Mirror with Two New Disks<a class=anchor href=#geom-mirror-two-new-disks></a></h4><div class=paragraph><p>In this example, FreeBSD has already been installed on a single disk, <span class=filename>ada0</span>. Two new disks, <span class=filename>ada1</span> and <span class=filename>ada2</span>, have been connected to the system. A new mirror will be created on these two disks and used to replace the old single disk.</p></div><div class=paragraph><p>The <span class=filename>geom_mirror.ko</span> kernel module must either be built into the kernel or loaded at boot- or run-time. Manually load the kernel module now:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># gmirror load</span></code></pre></div></div><div class=paragraph><p>Create the mirror with the two new drives:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># gmirror label -v gm0 /dev/ada1 /dev/ada2</span></code></pre></div></div><div class=paragraph><p><span class=filename>gm0</span> is a user-chosen device name assigned to the new mirror. After the mirror has been started, this device name appears in <span class=filename>/dev/mirror/</span>.</p></div><div class=paragraph><p>MBR and bsdlabel partition tables can now be created on the mirror with <a href="https://man.freebsd.org/cgi/man.cgi?query=gpart&amp;sektion=8&amp;format=html">gpart(8)</a>. This example uses a traditional file system layout, with partitions for <span class=filename>/</span>, swap, <span class=filename>/var</span>, <span class=filename>/tmp</span>, and <span class=filename>/usr</span>. A single <span class=filename>/</span> and a swap partition will also work.</p></div><div class=paragraph><p>Partitions on the mirror do not have to be the same size as those on the existing disk, but they must be large enough to hold all the data already present on <span class=filename>ada0</span>.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># gpart create -s MBR mirror/gm0</span>
<span class=c># gpart add -t freebsd -a 4k mirror/gm0</span>
<span class=c># gpart show mirror/gm0</span>
<span class=o>=&gt;</span>       63  156301423  mirror/gm0  MBR  <span class=o>(</span>74G<span class=o>)</span>
         63         63                    - free -  <span class=o>(</span>31k<span class=o>)</span>
        126  156301299                 1  freebsd  <span class=o>(</span>74G<span class=o>)</span>
  156301425         61                    - free -  <span class=o>(</span>30k<span class=o>)</span></code></pre></div></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># gpart create -s BSD mirror/gm0s1</span>
<span class=c># gpart add -t freebsd-ufs  -a 4k -s 2g mirror/gm0s1</span>
<span class=c># gpart add -t freebsd-swap -a 4k -s 4g mirror/gm0s1</span>
<span class=c># gpart add -t freebsd-ufs  -a 4k -s 2g mirror/gm0s1</span>
<span class=c># gpart add -t freebsd-ufs  -a 4k -s 1g mirror/gm0s1</span>
<span class=c># gpart add -t freebsd-ufs  -a 4k mirror/gm0s1</span>
<span class=c># gpart show mirror/gm0s1</span>
<span class=o>=&gt;</span>        0  156301299  mirror/gm0s1  BSD  <span class=o>(</span>74G<span class=o>)</span>
          0          2                      - free -  <span class=o>(</span>1.0k<span class=o>)</span>
          2    4194304                   1  freebsd-ufs  <span class=o>(</span>2.0G<span class=o>)</span>
    4194306    8388608                   2  freebsd-swap <span class=o>(</span>4.0G<span class=o>)</span>
   12582914    4194304                   4  freebsd-ufs  <span class=o>(</span>2.0G<span class=o>)</span>
   16777218    2097152                   5  freebsd-ufs  <span class=o>(</span>1.0G<span class=o>)</span>
   18874370  137426928                   6  freebsd-ufs  <span class=o>(</span>65G<span class=o>)</span>
  156301298          1                      - free -  <span class=o>(</span>512B<span class=o>)</span></code></pre></div></div><div class=paragraph><p>Make the mirror bootable by installing bootcode in the MBR and bsdlabel and setting the active slice:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># gpart bootcode -b /boot/mbr mirror/gm0</span>
<span class=c># gpart set -a active -i 1 mirror/gm0</span>
<span class=c># gpart bootcode -b /boot/boot mirror/gm0s1</span></code></pre></div></div><div class=paragraph><p>Format the file systems on the new mirror, enabling soft-updates.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># newfs -U /dev/mirror/gm0s1a</span>
<span class=c># newfs -U /dev/mirror/gm0s1d</span>
<span class=c># newfs -U /dev/mirror/gm0s1e</span>
<span class=c># newfs -U /dev/mirror/gm0s1f</span></code></pre></div></div><div class=paragraph><p>File systems from the original <span class=filename>ada0</span> disk can now be copied onto the mirror with <a href="https://man.freebsd.org/cgi/man.cgi?query=dump&amp;sektion=8&amp;format=html">dump(8)</a> and <a href="https://man.freebsd.org/cgi/man.cgi?query=restore&amp;sektion=8&amp;format=html">restore(8)</a>.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mount /dev/mirror/gm0s1a /mnt</span>
<span class=c># dump -C16 -b64 -0aL -f - / | (cd /mnt &amp;&amp; restore -rf -)</span>
<span class=c># mount /dev/mirror/gm0s1d /mnt/var</span>
<span class=c># mount /dev/mirror/gm0s1e /mnt/tmp</span>
<span class=c># mount /dev/mirror/gm0s1f /mnt/usr</span>
<span class=c># dump -C16 -b64 -0aL -f - /var | (cd /mnt/var &amp;&amp; restore -rf -)</span>
<span class=c># dump -C16 -b64 -0aL -f - /tmp | (cd /mnt/tmp &amp;&amp; restore -rf -)</span>
<span class=c># dump -C16 -b64 -0aL -f - /usr | (cd /mnt/usr &amp;&amp; restore -rf -)</span></code></pre></div></div><div class=paragraph><p>Edit <span class=filename>/mnt/etc/fstab</span> to point to the new mirror file systems:</p></div><div class="literalblock programlisting"><div class=content><pre># Device		Mountpoint	FStype	Options	Dump	Pass#
/dev/mirror/gm0s1a	/		ufs	rw	1	1
/dev/mirror/gm0s1b	none		swap	sw	0	0
/dev/mirror/gm0s1d	/var		ufs	rw	2	2
/dev/mirror/gm0s1e	/tmp		ufs	rw	2	2
/dev/mirror/gm0s1f	/usr		ufs	rw	2	2</pre></div></div><div class=paragraph><p>If the <span class=filename>geom_mirror.ko</span> kernel module has not been built into the kernel, <span class=filename>/mnt/boot/loader.conf</span> is edited to load the module at boot:</p></div><div class="literalblock programlisting"><div class=content><pre>geom_mirror_load=&#34;YES&#34;</pre></div></div><div class=paragraph><p>Reboot the system to test the new mirror and verify that all data has been copied. The BIOS will see the mirror as two individual drives rather than a mirror. Because the drives are identical, it does not matter which is selected to boot.</p></div><div class=paragraph><p>See <a href=#gmirror-troubleshooting>Troubleshooting</a> if there are problems booting. Powering down and disconnecting the original <span class=filename>ada0</span> disk will allow it to be kept as an offline backup.</p></div><div class=paragraph><p>In use, the mirror will behave just like the original single drive.</p></div></div><div class=sect3><h4 id=geom-mirror-existing-drive>18.3.3. Creating a Mirror with an Existing Drive<a class=anchor href=#geom-mirror-existing-drive></a></h4><div class=paragraph><p>In this example, FreeBSD has already been installed on a single disk, <span class=filename>ada0</span>. A new disk, <span class=filename>ada1</span>, has been connected to the system. A one-disk mirror will be created on the new disk, the existing system copied onto it, and then the old disk will be inserted into the mirror. This slightly complex procedure is required because <code>gmirror</code> needs to put a 512-byte block of metadata at the end of each disk, and the existing <span class=filename>ada0</span> has usually had all of its space already allocated.</p></div><div class=paragraph><p>Load the <span class=filename>geom_mirror.ko</span> kernel module:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># gmirror load</span></code></pre></div></div><div class=paragraph><p>Check the media size of the original disk with <code>diskinfo</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># diskinfo -v ada0 | head -n3</span>
/dev/ada0
        512             <span class=c># sectorsize</span>
        1000204821504   <span class=c># mediasize in bytes (931G)</span></code></pre></div></div><div class=paragraph><p>Create a mirror on the new disk. To make certain that the mirror capacity is not any larger than the original <span class=filename>ada0</span> drive, <a href="https://man.freebsd.org/cgi/man.cgi?query=gnop&amp;sektion=8&amp;format=html">gnop(8)</a> is used to create a fake drive of the exact same size. This drive does not store any data, but is used only to limit the size of the mirror. When <a href="https://man.freebsd.org/cgi/man.cgi?query=gmirror&amp;sektion=8&amp;format=html">gmirror(8)</a> creates the mirror, it will restrict the capacity to the size of <span class=filename>gzero.nop</span>, even if the new <span class=filename>ada1</span> drive has more space. Note that the <em>1000204821504</em> in the second line is equal to <span class=filename>ada0</span>'s media size as shown by <code>diskinfo</code> above.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># geom zero load</span>
<span class=c># gnop create -s 1000204821504 gzero</span>
<span class=c># gmirror label -v gm0 gzero.nop ada1</span>
<span class=c># gmirror forget gm0</span></code></pre></div></div><div class=paragraph><p>Since <span class=filename>gzero.nop</span> does not store any data, the mirror does not see it as connected. The mirror is told to "forget" unconnected components, removing references to <span class=filename>gzero.nop</span>. The result is a mirror device containing only a single disk, <span class=filename>ada1</span>.</p></div><div class=paragraph><p>After creating <span class=filename>gm0</span>, view the partition table on <span class=filename>ada0</span>. This output is from a 1 TB drive. If there is some unallocated space at the end of the drive, the contents may be copied directly from <span class=filename>ada0</span> to the new mirror.</p></div><div class=paragraph><p>However, if the output shows that all of the space on the disk is allocated, as in the following listing, there is no space available for the 512-byte mirror metadata at the end of the disk.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># gpart show ada0</span>
<span class=o>=&gt;</span>        63  1953525105        ada0  MBR  <span class=o>(</span>931G<span class=o>)</span>
          63  1953525105           1  freebsd  <span class=o>[</span>active]  <span class=o>(</span>931G<span class=o>)</span></code></pre></div></div><div class=paragraph><p>In this case, the partition table must be edited to reduce the capacity by one sector on <span class=filename>mirror/gm0</span>. The procedure will be explained later.</p></div><div class=paragraph><p>In either case, partition tables on the primary disk should be first copied using <code>gpart backup</code> and <code>gpart restore</code>.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># gpart backup ada0 &gt; table.ada0</span>
<span class=c># gpart backup ada0s1 &gt; table.ada0s1</span></code></pre></div></div><div class=paragraph><p>These commands create two files, <span class=filename>table.ada0</span> and <span class=filename>table.ada0s1</span>. This example is from a 1 TB drive:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cat table.ada0</span>
MBR 4
1 freebsd         63 1953525105   <span class=o>[</span>active]</code></pre></div></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cat table.ada0s1</span>
BSD 8
1  freebsd-ufs          0    4194304
2 freebsd-swap    4194304   33554432
4  freebsd-ufs   37748736   50331648
5  freebsd-ufs   88080384   41943040
6  freebsd-ufs  130023424  838860800
7  freebsd-ufs  968884224  984640881</code></pre></div></div><div class=paragraph><p>If no free space is shown at the end of the disk, the size of both the slice and the last partition must be reduced by one sector. Edit the two files, reducing the size of both the slice and last partition by one. These are the last numbers in each listing.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cat table.ada0</span>
MBR 4
1 freebsd         63 1953525104   <span class=o>[</span>active]</code></pre></div></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cat table.ada0s1</span>
BSD 8
1  freebsd-ufs          0    4194304
2 freebsd-swap    4194304   33554432
4  freebsd-ufs   37748736   50331648
5  freebsd-ufs   88080384   41943040
6  freebsd-ufs  130023424  838860800
7  freebsd-ufs  968884224  984640880</code></pre></div></div><div class=paragraph><p>If at least one sector was unallocated at the end of the disk, these two files can be used without modification.</p></div><div class=paragraph><p>Now restore the partition table into <span class=filename>mirror/gm0</span>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># gpart restore mirror/gm0 &lt; table.ada0</span>
<span class=c># gpart restore mirror/gm0s1 &lt; table.ada0s1</span></code></pre></div></div><div class=paragraph><p>Check the partition table with <code>gpart show</code>. This example has <span class=filename>gm0s1a</span> for <span class=filename>/</span>, <span class=filename>gm0s1d</span> for <span class=filename>/var</span>, <span class=filename>gm0s1e</span> for <span class=filename>/usr</span>, <span class=filename>gm0s1f</span> for <span class=filename>/data1</span>, and <span class=filename>gm0s1g</span> for <span class=filename>/data2</span>.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># gpart show mirror/gm0</span>
<span class=o>=&gt;</span>        63  1953525104  mirror/gm0  MBR  <span class=o>(</span>931G<span class=o>)</span>
          63  1953525042           1  freebsd  <span class=o>[</span>active]  <span class=o>(</span>931G<span class=o>)</span>
  1953525105          62              - free -  <span class=o>(</span>31k<span class=o>)</span>

<span class=c># gpart show mirror/gm0s1</span>
<span class=o>=&gt;</span>         0  1953525042  mirror/gm0s1  BSD  <span class=o>(</span>931G<span class=o>)</span>
           0     2097152             1  freebsd-ufs  <span class=o>(</span>1.0G<span class=o>)</span>
     2097152    16777216             2  freebsd-swap  <span class=o>(</span>8.0G<span class=o>)</span>
    18874368    41943040             4  freebsd-ufs  <span class=o>(</span>20G<span class=o>)</span>
    60817408    20971520             5  freebsd-ufs  <span class=o>(</span>10G<span class=o>)</span>
    81788928   629145600             6  freebsd-ufs  <span class=o>(</span>300G<span class=o>)</span>
   710934528  1242590514             7  freebsd-ufs  <span class=o>(</span>592G<span class=o>)</span>
  1953525042          63                - free -  <span class=o>(</span>31k<span class=o>)</span></code></pre></div></div><div class=paragraph><p>Both the slice and the last partition must have at least one free block at the end of the disk.</p></div><div class=paragraph><p>Create file systems on these new partitions. The number of partitions will vary to match the original disk, <span class=filename>ada0</span>.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># newfs -U /dev/mirror/gm0s1a</span>
<span class=c># newfs -U /dev/mirror/gm0s1d</span>
<span class=c># newfs -U /dev/mirror/gm0s1e</span>
<span class=c># newfs -U /dev/mirror/gm0s1f</span>
<span class=c># newfs -U /dev/mirror/gm0s1g</span></code></pre></div></div><div class=paragraph><p>Make the mirror bootable by installing bootcode in the MBR and bsdlabel and setting the active slice:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># gpart bootcode -b /boot/mbr mirror/gm0</span>
<span class=c># gpart set -a active -i 1 mirror/gm0</span>
<span class=c># gpart bootcode -b /boot/boot mirror/gm0s1</span></code></pre></div></div><div class=paragraph><p>Adjust <span class=filename>/etc/fstab</span> to use the new partitions on the mirror. Back up this file first by copying it to <span class=filename>/etc/fstab.orig</span>.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cp /etc/fstab /etc/fstab.orig</span></code></pre></div></div><div class=paragraph><p>Edit <span class=filename>/etc/fstab</span>, replacing <span class=filename>/dev/ada0</span> with <span class=filename>mirror/gm0</span>.</p></div><div class="literalblock programlisting"><div class=content><pre># Device		Mountpoint	FStype	Options	Dump	Pass#
/dev/mirror/gm0s1a	/		ufs	rw	1	1
/dev/mirror/gm0s1b	none		swap	sw	0	0
/dev/mirror/gm0s1d	/var		ufs	rw	2	2
/dev/mirror/gm0s1e	/usr		ufs	rw	2	2
/dev/mirror/gm0s1f	/data1		ufs	rw	2	2
/dev/mirror/gm0s1g	/data2		ufs	rw	2	2</pre></div></div><div class=paragraph><p>If the <span class=filename>geom_mirror.ko</span> kernel module has not been built into the kernel, edit <span class=filename>/boot/loader.conf</span> to load it at boot:</p></div><div class="literalblock programlisting"><div class=content><pre>geom_mirror_load=&#34;YES&#34;</pre></div></div><div class=paragraph><p>File systems from the original disk can now be copied onto the mirror with <a href="https://man.freebsd.org/cgi/man.cgi?query=dump&amp;sektion=8&amp;format=html">dump(8)</a> and <a href="https://man.freebsd.org/cgi/man.cgi?query=restore&amp;sektion=8&amp;format=html">restore(8)</a>. Each file system dumped with <code>dump -L</code> will create a snapshot first, which can take some time.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mount /dev/mirror/gm0s1a /mnt</span>
<span class=c># dump -C16 -b64 -0aL -f - /    | (cd /mnt &amp;&amp; restore -rf -)</span>
<span class=c># mount /dev/mirror/gm0s1d /mnt/var</span>
<span class=c># mount /dev/mirror/gm0s1e /mnt/usr</span>
<span class=c># mount /dev/mirror/gm0s1f /mnt/data1</span>
<span class=c># mount /dev/mirror/gm0s1g /mnt/data2</span>
<span class=c># dump -C16 -b64 -0aL -f - /usr | (cd /mnt/usr &amp;&amp; restore -rf -)</span>
<span class=c># dump -C16 -b64 -0aL -f - /var | (cd /mnt/var &amp;&amp; restore -rf -)</span>
<span class=c># dump -C16 -b64 -0aL -f - /data1 | (cd /mnt/data1 &amp;&amp; restore -rf -)</span>
<span class=c># dump -C16 -b64 -0aL -f - /data2 | (cd /mnt/data2 &amp;&amp; restore -rf -)</span></code></pre></div></div><div class=paragraph><p>Restart the system, booting from <span class=filename>ada1</span>. If everything is working, the system will boot from <span class=filename>mirror/gm0</span>, which now contains the same data as <span class=filename>ada0</span> had previously. See <a href=#gmirror-troubleshooting>Troubleshooting</a> if there are problems booting.</p></div><div class=paragraph><p>At this point, the mirror still consists of only the single <span class=filename>ada1</span> disk.</p></div><div class=paragraph><p>After booting from <span class=filename>mirror/gm0</span> successfully, the final step is inserting <span class=filename>ada0</span> into the mirror.</p></div><div class="admonitionblock important"><table><tbody><tr><td class=icon><i class="fa icon-important" title=Important></i></td><td class=content><div class=paragraph><p>When <span class=filename>ada0</span> is inserted into the mirror, its former contents will be overwritten by data from the mirror. Make certain that <span class=filename>mirror/gm0</span> has the same contents as <span class=filename>ada0</span> before adding <span class=filename>ada0</span> to the mirror. If the contents previously copied by <a href="https://man.freebsd.org/cgi/man.cgi?query=dump&amp;sektion=8&amp;format=html">dump(8)</a> and <a href="https://man.freebsd.org/cgi/man.cgi?query=restore&amp;sektion=8&amp;format=html">restore(8)</a> are not identical to what was on <span class=filename>ada0</span>, revert <span class=filename>/etc/fstab</span> to mount the file systems on <span class=filename>ada0</span>, reboot, and start the whole procedure again.</p></div></td></tr></tbody></table></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># gmirror insert gm0 ada0</span>
GEOM_MIRROR: Device gm0: rebuilding provider ada0</code></pre></div></div><div class=paragraph><p>Synchronization between the two disks will start immediately. Use <code>gmirror status</code> to view the progress.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># gmirror status</span>
      Name    Status  Components
girror/gm0  DEGRADED  ada1 <span class=o>(</span>ACTIVE<span class=o>)</span>
                      ada0 <span class=o>(</span>SYNCHRONIZING, 64%<span class=o>)</span></code></pre></div></div><div class=paragraph><p>After a while, synchronization will finish.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>GEOM_MIRROR: Device gm0: rebuilding provider ada0 finished.
<span class=c># gmirror status</span>
      Name    Status  Components
mirror/gm0  COMPLETE  ada1 <span class=o>(</span>ACTIVE<span class=o>)</span>
                      ada0 <span class=o>(</span>ACTIVE<span class=o>)</span></code></pre></div></div><div class=paragraph><p><span class=filename>mirror/gm0</span> now consists of the two disks <span class=filename>ada0</span> and <span class=filename>ada1</span>, and the contents are automatically synchronized with each other. In use, <span class=filename>mirror/gm0</span> will behave just like the original single drive.</p></div></div><div class=sect3><h4 id=gmirror-troubleshooting>18.3.4. Troubleshooting<a class=anchor href=#gmirror-troubleshooting></a></h4><div class=paragraph><p>If the system no longer boots, BIOS settings may have to be changed to boot from one of the new mirrored drives. Either mirror drive can be used for booting, as they contain identical data.</p></div><div class=paragraph><p>If the boot stops with this message, something is wrong with the mirror device:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>Mounting from ufs:/dev/mirror/gm0s1a failed with error 19.

Loader variables:
  vfs.root.mountfrom<span class=o>=</span>ufs:/dev/mirror/gm0s1a
  vfs.root.mountfrom.options<span class=o>=</span>rw

Manual root filesystem specification:
  &lt;fstype&gt;:&lt;device&gt; <span class=o>[</span>options]
      Mount &lt;device&gt; using filesystem &lt;fstype&gt;
      and with the specified <span class=o>(</span>optional<span class=o>)</span> option list.

    eg. ufs:/dev/da0s1a
        zfs:tank
        cd9660:/dev/acd0 ro
          <span class=o>(</span>which is equivalent to: mount <span class=nt>-t</span> cd9660 <span class=nt>-o</span> ro /dev/acd0 /<span class=o>)</span>

  ?               List valid disk boot devices
  <span class=nb>.</span>               Yield 1 second <span class=o>(</span><span class=k>for </span>background tasks<span class=o>)</span>
  &lt;empty line&gt;    Abort manual input

mountroot&gt;</code></pre></div></div><div class=paragraph><p>Forgetting to load the <span class=filename>geom_mirror.ko</span> module in <span class=filename>/boot/loader.conf</span> can cause this problem. To fix it, boot from a FreeBSD installation media and choose <code>Shell</code> at the first prompt. Then load the mirror module and mount the mirror device:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># gmirror load</span>
<span class=c># mount /dev/mirror/gm0s1a /mnt</span></code></pre></div></div><div class=paragraph><p>Edit <span class=filename>/mnt/boot/loader.conf</span>, adding a line to load the mirror module:</p></div><div class="literalblock programlisting"><div class=content><pre>geom_mirror_load=&#34;YES&#34;</pre></div></div><div class=paragraph><p>Save the file and reboot.</p></div><div class=paragraph><p>Other problems that cause <code>error 19</code> require more effort to fix. Although the system should boot from <span class=filename>ada0</span>, another prompt to select a shell will appear if <span class=filename>/etc/fstab</span> is incorrect. Enter <code>ufs:/dev/ada0s1a</code> at the boot loader prompt and press <kbd>Enter</kbd>. Undo the edits in <span class=filename>/etc/fstab</span> then mount the file systems from the original disk (<span class=filename>ada0</span>) instead of the mirror. Reboot the system and try the procedure again.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>Enter full pathname of shell or RETURN <span class=k>for</span> /bin/sh:
<span class=c># cp /etc/fstab.orig /etc/fstab</span>
<span class=c># reboot</span></code></pre></div></div></div><div class=sect3><h4 id=_recovering_from_disk_failure>18.3.5. Recovering from Disk Failure<a class=anchor href=#_recovering_from_disk_failure></a></h4><div class=paragraph><p>The benefit of disk mirroring is that an individual disk can fail without causing the mirror to lose any data. In the above example, if <span class=filename>ada0</span> fails, the mirror will continue to work, providing data from the remaining working drive, <span class=filename>ada1</span>.</p></div><div class=paragraph><p>To replace the failed drive, shut down the system and physically replace the failed drive with a new drive of equal or greater capacity. Manufacturers use somewhat arbitrary values when rating drives in gigabytes, and the only way to really be sure is to compare the total count of sectors shown by <code>diskinfo -v</code>. A drive with larger capacity than the mirror will work, although the extra space on the new drive will not be used.</p></div><div class=paragraph><p>After the computer is powered back up, the mirror will be running in a "degraded" mode with only one drive. The mirror is told to forget drives that are not currently connected:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># gmirror forget gm0</span></code></pre></div></div><div class=paragraph><p>Any old metadata should be cleared from the replacement disk using the instructions in <a href=#geom-mirror-metadata>Metadata Issues</a>. Then the replacement disk, <span class=filename>ada4</span> for this example, is inserted into the mirror:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># gmirror insert gm0 /dev/ada4</span></code></pre></div></div><div class=paragraph><p>Resynchronization begins when the new drive is inserted into the mirror. This process of copying mirror data to a new drive can take a while. Performance of the mirror will be greatly reduced during the copy, so inserting new drives is best done when there is low demand on the computer.</p></div><div class=paragraph><p>Progress can be monitored with <code>gmirror status</code>, which shows drives that are being synchronized and the percentage of completion. During resynchronization, the status will be <code>DEGRADED</code>, changing to <code>COMPLETE</code> when the process is finished.</p></div></div></div><div class=sect2><h3 id=geom-raid3>18.4. RAID3 - Byte-level Striping with Dedicated Parity<a class=anchor href=#geom-raid3></a></h3><div class=paragraph><p>RAID3 is a method used to combine several disk drives into a single volume with a dedicated parity disk. In a RAID3 system, data is split up into a number of bytes that are written across all the drives in the array except for one disk which acts as a dedicated parity disk. This means that disk reads from a RAID3 implementation access all disks in the array. Performance can be enhanced by using multiple disk controllers. The RAID3 array provides a fault tolerance of 1 drive, while providing a capacity of 1 - 1/n times the total capacity of all drives in the array, where n is the number of hard drives in the array. Such a configuration is mostly suitable for storing data of larger sizes such as multimedia files.</p></div><div class=paragraph><p>At least 3 physical hard drives are required to build a RAID3 array. Each disk must be of the same size, since I/O requests are interleaved to read or write to multiple disks in parallel. Also, due to the nature of RAID3, the number of drives must be equal to 3, 5, 9, 17, and so on, or 2^n + 1.</p></div><div class=paragraph><p>This section demonstrates how to create a software RAID3 on a FreeBSD system.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>While it is theoretically possible to boot from a RAID3 array on FreeBSD, that configuration is uncommon and is not advised.</p></div></td></tr></tbody></table></div><div class=sect3><h4 id=_creating_a_dedicated_raid3_array>18.4.1. Creating a Dedicated RAID3 Array<a class=anchor href=#_creating_a_dedicated_raid3_array></a></h4><div class=paragraph><p>In FreeBSD, support for RAID3 is implemented by the <a href="https://man.freebsd.org/cgi/man.cgi?query=graid3&amp;sektion=8&amp;format=html">graid3(8)</a> GEOM class. Creating a dedicated RAID3 array on FreeBSD requires the following steps.</p></div><div class="olist arabic procedure"><ol class=arabic><li><p>First, load the <span class=filename>geom_raid3.ko</span> kernel module by issuing one of the following commands:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># graid3 load</span></code></pre></div></div><div class=paragraph><p>or:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># kldload geom_raid3</span></code></pre></div></div></li><li><p>Ensure that a suitable mount point exists. This command creates a new directory to use as the mount point:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mkdir /multimedia</span></code></pre></div></div></li><li><p>Determine the device names for the disks which will be added to the array, and create the new RAID3 device. The final device listed will act as the dedicated parity disk. This example uses three unpartitioned ATA drives: <span class=filename>ada1</span> and <span class=filename>ada2</span> for data, and <span class=filename>ada3</span> for parity.</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># graid3 label -v gr0 /dev/ada1 /dev/ada2 /dev/ada3</span>
Metadata value stored on /dev/ada1.
Metadata value stored on /dev/ada2.
Metadata value stored on /dev/ada3.
Done.</code></pre></div></div></li><li><p>Partition the newly created <span class=filename>gr0</span> device and put a UFS file system on it:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># gpart create -s GPT /dev/raid3/gr0</span>
<span class=c># gpart add -t freebsd-ufs /dev/raid3/gr0</span>
<span class=c># newfs -j /dev/raid3/gr0p1</span></code></pre></div></div><div class=paragraph><p>Many numbers will glide across the screen, and after a bit of time, the process will be complete. The volume has been created and is ready to be mounted:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mount /dev/raid3/gr0p1 /multimedia/</span></code></pre></div></div><div class=paragraph><p>The RAID3 array is now ready to use.</p></div></li></ol></div><div class=paragraph><p>Additional configuration is needed to retain this setup across system reboots.</p></div><div class="olist arabic procedure"><ol class=arabic><li><p>The <span class=filename>geom_raid3.ko</span> module must be loaded before the array can be mounted. To automatically load the kernel module during system initialization, add the following line to <span class=filename>/boot/loader.conf</span>:</p><div class="literalblock programlisting"><div class=content><pre>geom_raid3_load=&#34;YES&#34;</pre></div></div></li><li><p>The following volume information must be added to <span class=filename>/etc/fstab</span> in order to automatically mount the array’s file system during the system boot process:</p><div class="literalblock programlisting"><div class=content><pre>/dev/raid3/gr0p1	/multimedia	ufs	rw	2	2</pre></div></div></li></ol></div></div></div><div class=sect2><h3 id=geom-graid>18.5. Software RAID Devices<a class=anchor href=#geom-graid></a></h3><div class=paragraph><p>Some motherboards and expansion cards add some simple hardware, usually just a ROM, that allows the computer to boot from a RAID array. After booting, access to the RAID array is handled by software running on the computer’s main processor. This "hardware-assisted software RAID" gives RAID arrays that are not dependent on any particular operating system, and which are functional even before an operating system is loaded.</p></div><div class=paragraph><p>Several levels of RAID are supported, depending on the hardware in use. See <a href="https://man.freebsd.org/cgi/man.cgi?query=graid&amp;sektion=8&amp;format=html">graid(8)</a> for a complete list.</p></div><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=graid&amp;sektion=8&amp;format=html">graid(8)</a> requires the <span class=filename>geom_raid.ko</span> kernel module, which is included in the <span class=filename>GENERIC</span> kernel starting with FreeBSD 9.1. If needed, it can be loaded manually with <code>graid load</code>.</p></div><div class=sect3><h4 id=geom-graid-creating>18.5.1. Creating an Array<a class=anchor href=#geom-graid-creating></a></h4><div class=paragraph><p>Software RAID devices often have a menu that can be entered by pressing special keys when the computer is booting. The menu can be used to create and delete RAID arrays. <a href="https://man.freebsd.org/cgi/man.cgi?query=graid&amp;sektion=8&amp;format=html">graid(8)</a> can also create arrays directly from the command line.</p></div><div class=paragraph><p><code>graid label</code> is used to create a new array. The motherboard used for this example has an Intel software RAID chipset, so the Intel metadata format is specified. The new array is given a label of <span class=filename>gm0</span>, it is a mirror (RAID1), and uses drives <span class=filename>ada0</span> and <span class=filename>ada1</span>.</p></div><div class="admonitionblock caution"><table><tbody><tr><td class=icon><i class="fa icon-caution" title=Caution></i></td><td class=content><div class=paragraph><p>Some space on the drives will be overwritten when they are made into a new array. Back up existing data first!</p></div></td></tr></tbody></table></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># graid label Intel gm0 RAID1 ada0 ada1</span>
GEOM_RAID: Intel-a29ea104: Array Intel-a29ea104 created.
GEOM_RAID: Intel-a29ea104: Disk ada0 state changed from NONE to ACTIVE.
GEOM_RAID: Intel-a29ea104: Subdisk gm0:0-ada0 state changed from NONE to ACTIVE.
GEOM_RAID: Intel-a29ea104: Disk ada1 state changed from NONE to ACTIVE.
GEOM_RAID: Intel-a29ea104: Subdisk gm0:1-ada1 state changed from NONE to ACTIVE.
GEOM_RAID: Intel-a29ea104: Array started.
GEOM_RAID: Intel-a29ea104: Volume gm0 state changed from STARTING to OPTIMAL.
Intel-a29ea104 created
GEOM_RAID: Intel-a29ea104: Provider raid/r0 <span class=k>for </span>volume gm0 created.</code></pre></div></div><div class=paragraph><p>A status check shows the new mirror is ready for use:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># graid status</span>
   Name   Status  Components
raid/r0  OPTIMAL  ada0 <span class=o>(</span>ACTIVE <span class=o>(</span>ACTIVE<span class=o>))</span>
                  ada1 <span class=o>(</span>ACTIVE <span class=o>(</span>ACTIVE<span class=o>))</span></code></pre></div></div><div class=paragraph><p>The array device appears in <span class=filename>/dev/raid/</span>. The first array is called <span class=filename>r0</span>. Additional arrays, if present, will be <span class=filename>r1</span>, <span class=filename>r2</span>, and so on.</p></div><div class=paragraph><p>The BIOS menu on some of these devices can create arrays with special characters in their names. To avoid problems with those special characters, arrays are given simple numbered names like <span class=filename>r0</span>. To show the actual labels, like <span class=filename>gm0</span> in the example above, use <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sysctl kern.geom.raid.name_format=1</span></code></pre></div></div></div><div class=sect3><h4 id=geom-graid-volumes>18.5.2. Multiple Volumes<a class=anchor href=#geom-graid-volumes></a></h4><div class=paragraph><p>Some software RAID devices support more than one <em>volume</em> on an array. Volumes work like partitions, allowing space on the physical drives to be split and used in different ways. For example, Intel software RAID devices support two volumes. This example creates a 40 G mirror for safely storing the operating system, followed by a 20 G RAID0 (stripe) volume for fast temporary storage:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># graid label -S 40G Intel gm0 RAID1 ada0 ada1</span>
<span class=c># graid add -S 20G gm0 RAID0</span></code></pre></div></div><div class=paragraph><p>Volumes appear as additional <span class=filename>rX</span> entries in <span class=filename>/dev/raid/</span>. An array with two volumes will show <span class=filename>r0</span> and <span class=filename>r1</span>.</p></div><div class=paragraph><p>See <a href="https://man.freebsd.org/cgi/man.cgi?query=graid&amp;sektion=8&amp;format=html">graid(8)</a> for the number of volumes supported by different software RAID devices.</p></div></div><div class=sect3><h4 id=geom-graid-converting>18.5.3. Converting a Single Drive to a Mirror<a class=anchor href=#geom-graid-converting></a></h4><div class=paragraph><p>Under certain specific conditions, it is possible to convert an existing single drive to a <a href="https://man.freebsd.org/cgi/man.cgi?query=graid&amp;sektion=8&amp;format=html">graid(8)</a> array without reformatting. To avoid data loss during the conversion, the existing drive must meet these minimum requirements:</p></div><div class=ulist><ul><li><p>The drive must be partitioned with the MBR partitioning scheme. GPT or other partitioning schemes with metadata at the end of the drive will be overwritten and corrupted by the <a href="https://man.freebsd.org/cgi/man.cgi?query=graid&amp;sektion=8&amp;format=html">graid(8)</a> metadata.</p></li><li><p>There must be enough unpartitioned and unused space at the end of the drive to hold the <a href="https://man.freebsd.org/cgi/man.cgi?query=graid&amp;sektion=8&amp;format=html">graid(8)</a> metadata. This metadata varies in size, but the largest occupies 64 M, so at least that much free space is recommended.</p></li></ul></div><div class=paragraph><p>If the drive meets these requirements, start by making a full backup. Then create a single-drive mirror with that drive:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># graid label Intel gm0 RAID1 ada0 NONE</span></code></pre></div></div><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=graid&amp;sektion=8&amp;format=html">graid(8)</a> metadata was written to the end of the drive in the unused space. A second drive can now be inserted into the mirror:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># graid insert raid/r0 ada1</span></code></pre></div></div><div class=paragraph><p>Data from the original drive will immediately begin to be copied to the second drive. The mirror will operate in degraded status until the copy is complete.</p></div></div><div class=sect3><h4 id=geom-graid-inserting>18.5.4. Inserting New Drives into the Array<a class=anchor href=#geom-graid-inserting></a></h4><div class=paragraph><p>Drives can be inserted into an array as replacements for drives that have failed or are missing. If there are no failed or missing drives, the new drive becomes a spare. For example, inserting a new drive into a working two-drive mirror results in a two-drive mirror with one spare drive, not a three-drive mirror.</p></div><div class=paragraph><p>In the example mirror array, data immediately begins to be copied to the newly-inserted drive. Any existing information on the new drive will be overwritten.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># graid insert raid/r0 ada1</span>
GEOM_RAID: Intel-a29ea104: Disk ada1 state changed from NONE to ACTIVE.
GEOM_RAID: Intel-a29ea104: Subdisk gm0:1-ada1 state changed from NONE to NEW.
GEOM_RAID: Intel-a29ea104: Subdisk gm0:1-ada1 state changed from NEW to REBUILD.
GEOM_RAID: Intel-a29ea104: Subdisk gm0:1-ada1 rebuild start at 0.</code></pre></div></div></div><div class=sect3><h4 id=geom-graid-removing>18.5.5. Removing Drives from the Array<a class=anchor href=#geom-graid-removing></a></h4><div class=paragraph><p>Individual drives can be permanently removed from a from an array and their metadata erased:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># graid remove raid/r0 ada1</span>
GEOM_RAID: Intel-a29ea104: Disk ada1 state changed from ACTIVE to OFFLINE.
GEOM_RAID: Intel-a29ea104: Subdisk gm0:1-[unknown] state changed from ACTIVE to NONE.
GEOM_RAID: Intel-a29ea104: Volume gm0 state changed from OPTIMAL to DEGRADED.</code></pre></div></div></div><div class=sect3><h4 id=geom-graid-stopping>18.5.6. Stopping the Array<a class=anchor href=#geom-graid-stopping></a></h4><div class=paragraph><p>An array can be stopped without removing metadata from the drives. The array will be restarted when the system is booted.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># graid stop raid/r0</span></code></pre></div></div></div><div class=sect3><h4 id=geom-graid-status>18.5.7. Checking Array Status<a class=anchor href=#geom-graid-status></a></h4><div class=paragraph><p>Array status can be checked at any time. After a drive was added to the mirror in the example above, data is being copied from the original drive to the new drive:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># graid status</span>
   Name    Status  Components
raid/r0  DEGRADED  ada0 <span class=o>(</span>ACTIVE <span class=o>(</span>ACTIVE<span class=o>))</span>
                   ada1 <span class=o>(</span>ACTIVE <span class=o>(</span>REBUILD 28%<span class=o>))</span></code></pre></div></div><div class=paragraph><p>Some types of arrays, like <code>RAID0</code> or <code>CONCAT</code>, may not be shown in the status report if disks have failed. To see these partially-failed arrays, add <code>-ga</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># graid status -ga</span>
          Name  Status  Components
Intel-e2d07d9a  BROKEN  ada6 <span class=o>(</span>ACTIVE <span class=o>(</span>ACTIVE<span class=o>))</span></code></pre></div></div></div><div class=sect3><h4 id=geom-graid-deleting>18.5.8. Deleting Arrays<a class=anchor href=#geom-graid-deleting></a></h4><div class=paragraph><p>Arrays are destroyed by deleting all of the volumes from them. When the last volume present is deleted, the array is stopped and metadata is removed from the drives:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># graid delete raid/r0</span></code></pre></div></div></div><div class=sect3><h4 id=geom-graid-unexpected>18.5.9. Deleting Unexpected Arrays<a class=anchor href=#geom-graid-unexpected></a></h4><div class=paragraph><p>Drives may unexpectedly contain <a href="https://man.freebsd.org/cgi/man.cgi?query=graid&amp;sektion=8&amp;format=html">graid(8)</a> metadata, either from previous use or manufacturer testing. <a href="https://man.freebsd.org/cgi/man.cgi?query=graid&amp;sektion=8&amp;format=html">graid(8)</a> will detect these drives and create an array, interfering with access to the individual drive. To remove the unwanted metadata:</p></div><div class="olist arabic procedure"><ol class=arabic><li><p>Boot the system. At the boot menu, select <code>2</code> for the loader prompt. Enter:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>OK <span class=nb>set </span>kern.geom.raid.enable<span class=o>=</span>0
OK boot</code></pre></div></div><div class=paragraph><p>The system will boot with <a href="https://man.freebsd.org/cgi/man.cgi?query=graid&amp;sektion=8&amp;format=html">graid(8)</a> disabled.</p></div></li><li><p>Back up all data on the affected drive.</p></li><li><p>As a workaround, <a href="https://man.freebsd.org/cgi/man.cgi?query=graid&amp;sektion=8&amp;format=html">graid(8)</a> array detection can be disabled by adding</p><div class="literalblock programlisting"><div class=content><pre>kern.geom.raid.enable=0</pre></div></div><div class=paragraph><p>to <span class=filename>/boot/loader.conf</span>.</p></div><div class=paragraph><p>To permanently remove the <a href="https://man.freebsd.org/cgi/man.cgi?query=graid&amp;sektion=8&amp;format=html">graid(8)</a> metadata from the affected drive, boot a FreeBSD installation CD-ROM or memory stick, and select <code>Shell</code>. Use <code>status</code> to find the name of the array, typically <code>raid/r0</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># graid status</span>
   Name   Status  Components
raid/r0  OPTIMAL  ada0 <span class=o>(</span>ACTIVE <span class=o>(</span>ACTIVE<span class=o>))</span>
                  ada1 <span class=o>(</span>ACTIVE <span class=o>(</span>ACTIVE<span class=o>))</span></code></pre></div></div><div class=paragraph><p>Delete the volume by name:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># graid delete raid/r0</span></code></pre></div></div><div class=paragraph><p>If there is more than one volume shown, repeat the process for each volume. After the last array has been deleted, the volume will be destroyed.</p></div><div class=paragraph><p>Reboot and verify data, restoring from backup if necessary. After the metadata has been removed, the <code>kern.geom.raid.enable=0</code> entry in <span class=filename>/boot/loader.conf</span> can also be removed.</p></div></li></ol></div></div></div><div class=sect2><h3 id=geom-ggate>18.6. GEOM Gate Network<a class=anchor href=#geom-ggate></a></h3><div class=paragraph><p>GEOM provides a simple mechanism for providing remote access to devices such as disks, CDs, and file systems through the use of the GEOM Gate network daemon, ggated. The system with the device runs the server daemon which handles requests made by clients using ggatec. The devices should not contain any sensitive data as the connection between the client and the server is not encrypted.</p></div><div class=paragraph><p>Similar to NFS, which is discussed in <a href=./#network-nfs>Network File System (NFS)</a>, ggated is configured using an exports file. This file specifies which systems are permitted to access the exported resources and what level of access they are offered. For example, to give the client <code>192.168.1.5</code> read and write access to the fourth slice on the first SCSI disk, create <span class=filename>/etc/gg.exports</span> with this line:</p></div><div class="literalblock programlisting"><div class=content><pre>192.168.1.5 RW /dev/da0s4d</pre></div></div><div class=paragraph><p>Before exporting the device, ensure it is not currently mounted. Then, start ggated:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ggated</span></code></pre></div></div><div class=paragraph><p>Several options are available for specifying an alternate listening port or changing the default location of the exports file. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=ggated&amp;sektion=8&amp;format=html">ggated(8)</a> for details.</p></div><div class=paragraph><p>To access the exported device on the client machine, first use <code>ggatec</code> to specify the IP address of the server and the device name of the exported device. If successful, this command will display a <code>ggate</code> device name to mount. Mount that specified device name on a free mount point. This example connects to the <span class=filename>/dev/da0s4d</span> partition on <code>192.168.1.1</code>, then mounts <span class=filename>/dev/ggate0</span> on <span class=filename>/mnt</span>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ggatec create -o rw 192.168.1.1 /dev/da0s4d</span>
ggate0
<span class=c># mount /dev/ggate0 /mnt</span></code></pre></div></div><div class=paragraph><p>The device on the server may now be accessed through <span class=filename>/mnt</span> on the client. For more details about <code>ggatec</code> and a few usage examples, refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=ggatec&amp;sektion=8&amp;format=html">ggatec(8)</a>.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>The mount will fail if the device is currently mounted on either the server or any other client on the network. If simultaneous access is needed to network resources, use NFS instead.</p></div></td></tr></tbody></table></div><div class=paragraph><p>When the device is no longer needed, unmount it with <code>umount</code> so that the resource is available to other clients.</p></div></div><div class=sect2><h3 id=geom-glabel>18.7. Labeling Disk Devices<a class=anchor href=#geom-glabel></a></h3><div class=paragraph><p>During system initialization, the FreeBSD kernel creates device nodes as devices are found. This method of probing for devices raises some issues. For instance, what if a new disk device is added via USB? It is likely that a flash device may be handed the device name of <span class=filename>da0</span> and the original <span class=filename>da0</span> shifted to <span class=filename>da1</span>. This will cause issues mounting file systems if they are listed in <span class=filename>/etc/fstab</span> which may also prevent the system from booting.</p></div><div class=paragraph><p>One solution is to chain SCSI devices in order so a new device added to the SCSI card will be issued unused device numbers. But what about USB devices which may replace the primary SCSI disk? This happens because USB devices are usually probed before the SCSI card. One solution is to only insert these devices after the system has been booted. Another method is to use only a single ATA drive and never list the SCSI devices in <span class=filename>/etc/fstab</span>.</p></div><div class=paragraph><p>A better solution is to use <code>glabel</code> to label the disk devices and use the labels in <span class=filename>/etc/fstab</span>. Because <code>glabel</code> stores the label in the last sector of a given provider, the label will remain persistent across reboots. By using this label as a device, the file system may always be mounted regardless of what device node it is accessed through.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p><code>glabel</code> can create both transient and permanent labels. Only permanent labels are consistent across reboots. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=glabel&amp;sektion=8&amp;format=html">glabel(8)</a> for more information on the differences between labels.</p></div></td></tr></tbody></table></div><div class=sect3><h4 id=_label_types_and_examples>18.7.1. Label Types and Examples<a class=anchor href=#_label_types_and_examples></a></h4><div class=paragraph><p>Permanent labels can be a generic or a file system label. Permanent file system labels can be created with <a href="https://man.freebsd.org/cgi/man.cgi?query=tunefs&amp;sektion=8&amp;format=html">tunefs(8)</a> or <a href="https://man.freebsd.org/cgi/man.cgi?query=newfs&amp;sektion=8&amp;format=html">newfs(8)</a>. These types of labels are created in a sub-directory of <span class=filename>/dev</span>, and will be named according to the file system type. For example, UFS2 file system labels will be created in <span class=filename>/dev/ufs</span>. Generic permanent labels can be created with <code>glabel label</code>. These are not file system specific and will be created in <span class=filename>/dev/label</span>.</p></div><div class=paragraph><p>Temporary labels are destroyed at the next reboot. These labels are created in <span class=filename>/dev/label</span> and are suited to experimentation. A temporary label can be created using <code>glabel create</code>.</p></div><div class=paragraph><p>To create a permanent label for a UFS2 file system without destroying any data, issue the following command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># tunefs -L home /dev/da3</span></code></pre></div></div><div class=paragraph><p>A label should now exist in <span class=filename>/dev/ufs</span> which may be added to <span class=filename>/etc/fstab</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>/dev/ufs/home		/home            ufs     rw              2      2</pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>The file system must not be mounted while attempting to run <code>tunefs</code>.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Now the file system may be mounted:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mount /home</span></code></pre></div></div><div class=paragraph><p>From this point on, so long as the <span class=filename>geom_label.ko</span> kernel module is loaded at boot with <span class=filename>/boot/loader.conf</span> or the <code>GEOM_LABEL</code> kernel option is present, the device node may change without any ill effect on the system.</p></div><div class=paragraph><p>File systems may also be created with a default label by using the <code>-L</code> flag with <code>newfs</code>. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=newfs&amp;sektion=8&amp;format=html">newfs(8)</a> for more information.</p></div><div class=paragraph><p>The following command can be used to destroy the label:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># glabel destroy home</span></code></pre></div></div><div class=paragraph><p>The following example shows how to label the partitions of a boot disk.</p></div><div class=exampleblock><div class=title>Przykład 23. Labeling Partitions on the Boot Disk</div><div class=content><div class=paragraph><p>By permanently labeling the partitions on the boot disk, the system should be able to continue to boot normally, even if the disk is moved to another controller or transferred to a different system. For this example, it is assumed that a single ATA disk is used, which is currently recognized by the system as <span class=filename>ad0</span>. It is also assumed that the standard FreeBSD partition scheme is used, with <span class=filename>/</span>, <span class=filename>/var</span>, <span class=filename>/usr</span> and <span class=filename>/tmp</span>, as well as a swap partition.</p></div><div class=paragraph><p>Reboot the system, and at the <a href="https://man.freebsd.org/cgi/man.cgi?query=loader&amp;sektion=8&amp;format=html">loader(8)</a> prompt, press <kbd>4</kbd> to boot into single user mode. Then enter the following commands:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># glabel label rootfs /dev/ad0s1a</span>
GEOM_LABEL: Label <span class=k>for </span>provider /dev/ad0s1a is label/rootfs
<span class=c># glabel label var /dev/ad0s1d</span>
GEOM_LABEL: Label <span class=k>for </span>provider /dev/ad0s1d is label/var
<span class=c># glabel label usr /dev/ad0s1f</span>
GEOM_LABEL: Label <span class=k>for </span>provider /dev/ad0s1f is label/usr
<span class=c># glabel label tmp /dev/ad0s1e</span>
GEOM_LABEL: Label <span class=k>for </span>provider /dev/ad0s1e is label/tmp
<span class=c># glabel label swap /dev/ad0s1b</span>
GEOM_LABEL: Label <span class=k>for </span>provider /dev/ad0s1b is label/swap
<span class=c># exit</span></code></pre></div></div><div class=paragraph><p>The system will continue with multi-user boot. After the boot completes, edit <span class=filename>/etc/fstab</span> and replace the conventional device names, with their respective labels. The final <span class=filename>/etc/fstab</span> will look like this:</p></div><div class="literalblock programlisting"><div class=content><pre># Device                Mountpoint      FStype  Options         Dump    Pass#
/dev/label/swap         none            swap    sw              0       0
/dev/label/rootfs       /               ufs     rw              1       1
/dev/label/tmp          /tmp            ufs     rw              2       2
/dev/label/usr          /usr            ufs     rw              2       2
/dev/label/var          /var            ufs     rw              2       2</pre></div></div><div class=paragraph><p>The system can now be rebooted. If everything went well, it will come up normally and <code>mount</code> will show:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mount</span>
/dev/label/rootfs on / <span class=o>(</span>ufs, <span class=nb>local</span><span class=o>)</span>
devfs on /dev <span class=o>(</span>devfs, <span class=nb>local</span><span class=o>)</span>
/dev/label/tmp on /tmp <span class=o>(</span>ufs, <span class=nb>local</span>, soft-updates<span class=o>)</span>
/dev/label/usr on /usr <span class=o>(</span>ufs, <span class=nb>local</span>, soft-updates<span class=o>)</span>
/dev/label/var on /var <span class=o>(</span>ufs, <span class=nb>local</span>, soft-updates<span class=o>)</span></code></pre></div></div></div></div><div class=paragraph><p>The <a href="https://man.freebsd.org/cgi/man.cgi?query=glabel&amp;sektion=8&amp;format=html">glabel(8)</a> class supports a label type for UFS file systems, based on the unique file system id, <code>ufsid</code>. These labels may be found in <span class=filename>/dev/ufsid</span> and are created automatically during system startup. It is possible to use <code>ufsid</code> labels to mount partitions using <span class=filename>/etc/fstab</span>. Use <code>glabel status</code> to receive a list of file systems and their corresponding <code>ufsid</code> labels:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% glabel status
                  Name  Status  Components
ufsid/486b6fc38d330916     N/A  ad4s1d
ufsid/486b6fc16926168e     N/A  ad4s1f</code></pre></div></div><div class=paragraph><p>In the above example, <span class=filename>ad4s1d</span> represents <span class=filename>/var</span>, while <span class=filename>ad4s1f</span> represents <span class=filename>/usr</span>. Using the <code>ufsid</code> values shown, these partitions may now be mounted with the following entries in <span class=filename>/etc/fstab</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>/dev/ufsid/486b6fc38d330916        /var        ufs        rw        2      2
/dev/ufsid/486b6fc16926168e        /usr        ufs        rw        2      2</pre></div></div><div class=paragraph><p>Any partitions with <code>ufsid</code> labels can be mounted in this way, eliminating the need to manually create permanent labels, while still enjoying the benefits of device name independent mounting.</p></div></div></div><div class=sect2><h3 id=geom-gjournal>18.8. UFS Journaling Through GEOM<a class=anchor href=#geom-gjournal></a></h3><div class=paragraph><p>Support for journals on UFS file systems is available on FreeBSD. The implementation is provided through the GEOM subsystem and is configured using <code>gjournal</code>. Unlike other file system journaling implementations, the <code>gjournal</code> method is block based and not implemented as part of the file system. It is a GEOM extension.</p></div><div class=paragraph><p>Journaling stores a log of file system transactions, such as changes that make up a complete disk write operation, before meta-data and file writes are committed to the disk. This transaction log can later be replayed to redo file system transactions, preventing file system inconsistencies.</p></div><div class=paragraph><p>This method provides another mechanism to protect against data loss and inconsistencies of the file system. Unlike Soft Updates, which tracks and enforces meta-data updates, and snapshots, which create an image of the file system, a log is stored in disk space specifically for this task. For better performance, the journal may be stored on another disk. In this configuration, the journal provider or storage device should be listed after the device to enable journaling on.</p></div><div class=paragraph><p>The <span class=filename>GENERIC</span> kernel provides support for <code>gjournal</code>. To automatically load the <span class=filename>geom_journal.ko</span> kernel module at boot time, add the following line to <span class=filename>/boot/loader.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>geom_journal_load=&#34;YES&#34;</pre></div></div><div class=paragraph><p>If a custom kernel is used, ensure the following line is in the kernel configuration file:</p></div><div class="literalblock programlisting"><div class=content><pre>options	GEOM_JOURNAL</pre></div></div><div class=paragraph><p>Once the module is loaded, a journal can be created on a new file system using the following steps. In this example, <span class=filename>da4</span> is a new SCSI disk:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># gjournal load</span>
<span class=c># gjournal label /dev/da4</span></code></pre></div></div><div class=paragraph><p>This will load the module and create a <span class=filename>/dev/da4.journal</span> device node on <span class=filename>/dev/da4</span>.</p></div><div class=paragraph><p>A UFS file system may now be created on the journaled device, then mounted on an existing mount point:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># newfs -O 2 -J /dev/da4.journal</span>
<span class=c># mount /dev/da4.journal /mnt</span></code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>In the case of several slices, a journal will be created for each individual slice. For instance, if <span class=filename>ad4s1</span> and <span class=filename>ad4s2</span> are both slices, then <code>gjournal</code> will create <span class=filename>ad4s1.journal</span> and <span class=filename>ad4s2.journal</span>.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Journaling may also be enabled on current file systems by using <code>tunefs</code>. However, <em>always</em> make a backup before attempting to alter an existing file system. In most cases, <code>gjournal</code> will fail if it is unable to create the journal, but this does not protect against data loss incurred as a result of misusing <code>tunefs</code>. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=gjournal&amp;sektion=8&amp;format=html">gjournal(8)</a> and <a href="https://man.freebsd.org/cgi/man.cgi?query=tunefs&amp;sektion=8&amp;format=html">tunefs(8)</a> for more information about these commands.</p></div><div class=paragraph><p>It is possible to journal the boot disk of a FreeBSD system. Refer to the article <a href=https://docs.freebsd.org/en/articles/gjournal-desktop/>Implementing UFS Journaling on a Desktop PC</a> for detailed instructions.</p></div></div></div></div><div class=sect1><h2 id=zfs>Rozdział 19. The Z File System (ZFS)<a class=anchor href=#zfs></a></h2><div class=sectionbody><div class=paragraph><p>The <em>Z File System</em>, or ZFS, is an advanced file system designed to overcome many of the major problems found in previous designs.</p></div><div class=paragraph><p>Originally developed at Sun™, ongoing open source ZFS development has moved to the <a href=http://open-zfs.org>OpenZFS Project</a>.</p></div><div class=paragraph><p>ZFS has three major design goals:</p></div><div class=ulist><ul><li><p>Data integrity: All data includes a <a href=#zfs-term-checksum>checksum</a> of the data. When data is written, the checksum is calculated and written along with it. When that data is later read back, the checksum is calculated again. If the checksums do not match, a data error has been detected. ZFS will attempt to automatically correct errors when data redundancy is available.</p></li><li><p>Pooled storage: physical storage devices are added to a pool, and storage space is allocated from that shared pool. Space is available to all file systems, and can be increased by adding new storage devices to the pool.</p></li><li><p>Performance: multiple caching mechanisms provide increased performance. <a href=#zfs-term-arc>ARC</a> is an advanced memory-based read cache. A second level of disk-based read cache can be added with <a href=#zfs-term-l2arc>L2ARC</a>, and disk-based synchronous write cache is available with <a href=#zfs-term-zil>ZIL</a>.</p></li></ul></div><div class=paragraph><p>A complete list of features and terminology is shown in <a href=#zfs-term>ZFS Features and Terminology</a>.</p></div><div class=sect2><h3 id=zfs-differences>19.1. What Makes ZFS Different<a class=anchor href=#zfs-differences></a></h3><div class=paragraph><p>ZFS is significantly different from any previous file system because it is more than just a file system. Combining the traditionally separate roles of volume manager and file system provides ZFS with unique advantages. The file system is now aware of the underlying structure of the disks. Traditional file systems could only be created on a single disk at a time. If there were two disks then two separate file systems would have to be created. In a traditional hardware RAID configuration, this problem was avoided by presenting the operating system with a single logical disk made up of the space provided by a number of physical disks, on top of which the operating system placed a file system. Even in the case of software RAID solutions like those provided by GEOM, the UFS file system living on top of the RAID transform believed that it was dealing with a single device. ZFS’s combination of the volume manager and the file system solves this and allows the creation of many file systems all sharing a pool of available storage. One of the biggest advantages to ZFS’s awareness of the physical layout of the disks is that existing file systems can be grown automatically when additional disks are added to the pool. This new space is then made available to all of the file systems. ZFS also has a number of different properties that can be applied to each file system, giving many advantages to creating a number of different file systems and datasets rather than a single monolithic file system.</p></div></div><div class=sect2><h3 id=zfs-quickstart>19.2. Quick Start Guide<a class=anchor href=#zfs-quickstart></a></h3><div class=paragraph><p>There is a startup mechanism that allows FreeBSD to mount ZFS pools during system initialization. To enable it, add this line to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>zfs_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>Then start the service:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service zfs start</span></code></pre></div></div><div class=paragraph><p>The examples in this section assume three SCSI disks with the device names <span class=filename>da0</span>, <span class=filename>da1</span>, and <span class=filename>da2</span>. Users of SATA hardware should instead use <span class=filename>ada</span> device names.</p></div><div class=sect3><h4 id=zfs-quickstart-single-disk-pool>19.2.1. Single Disk Pool<a class=anchor href=#zfs-quickstart-single-disk-pool></a></h4><div class=paragraph><p>To create a simple, non-redundant pool using a single disk device:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zpool create example /dev/da0</span></code></pre></div></div><div class=paragraph><p>To view the new pool, review the output of <code>df</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># df</span>
Filesystem  1K-blocks    Used    Avail Capacity  Mounted on
/dev/ad0s1a   2026030  235230  1628718    13%    /
devfs               1       1        0   100%    /dev
/dev/ad0s1d  54098308 1032846 48737598     2%    /usr
example      17547136       0 17547136     0%    /example</code></pre></div></div><div class=paragraph><p>This output shows that the <code>example</code> pool has been created and mounted. It is now accessible as a file system. Files can be created on it and users can browse it:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /example</span>
<span class=c># ls</span>
<span class=c># touch testfile</span>
<span class=c># ls -al</span>
total 4
drwxr-xr-x   2 root  wheel    3 Aug 29 23:15 <span class=nb>.</span>
drwxr-xr-x  21 root  wheel  512 Aug 29 23:12 ..
<span class=nt>-rw-r--r--</span>   1 root  wheel    0 Aug 29 23:15 testfile</code></pre></div></div><div class=paragraph><p>However, this pool is not taking advantage of any ZFS features. To create a dataset on this pool with compression enabled:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zfs create example/compressed</span>
<span class=c># zfs set compression=gzip example/compressed</span></code></pre></div></div><div class=paragraph><p>The <code>example/compressed</code> dataset is now a ZFS compressed file system. Try copying some large files to <span class=filename>/example/compressed</span>.</p></div><div class=paragraph><p>Compression can be disabled with:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zfs set compression=off example/compressed</span></code></pre></div></div><div class=paragraph><p>To unmount a file system, use <code>zfs umount</code> and then verify with <code>df</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zfs umount example/compressed</span>
<span class=c># df</span>
Filesystem  1K-blocks    Used    Avail Capacity  Mounted on
/dev/ad0s1a   2026030  235232  1628716    13%    /
devfs               1       1        0   100%    /dev
/dev/ad0s1d  54098308 1032864 48737580     2%    /usr
example      17547008       0 17547008     0%    /example</code></pre></div></div><div class=paragraph><p>To re-mount the file system to make it accessible again, use <code>zfs mount</code> and verify with <code>df</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zfs mount example/compressed</span>
<span class=c># df</span>
Filesystem         1K-blocks    Used    Avail Capacity  Mounted on
/dev/ad0s1a          2026030  235234  1628714    13%    /
devfs                      1       1        0   100%    /dev
/dev/ad0s1d         54098308 1032864 48737580     2%    /usr
example             17547008       0 17547008     0%    /example
example/compressed  17547008       0 17547008     0%    /example/compressed</code></pre></div></div><div class=paragraph><p>The pool and file system may also be observed by viewing the output from <code>mount</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mount</span>
/dev/ad0s1a on / <span class=o>(</span>ufs, <span class=nb>local</span><span class=o>)</span>
devfs on /dev <span class=o>(</span>devfs, <span class=nb>local</span><span class=o>)</span>
/dev/ad0s1d on /usr <span class=o>(</span>ufs, <span class=nb>local</span>, soft-updates<span class=o>)</span>
example on /example <span class=o>(</span>zfs, <span class=nb>local</span><span class=o>)</span>
example/compressed on /example/compressed <span class=o>(</span>zfs, <span class=nb>local</span><span class=o>)</span></code></pre></div></div><div class=paragraph><p>After creation, ZFS datasets can be used like any file systems. However, many other features are available which can be set on a per-dataset basis. In the example below, a new file system called <code>data</code> is created. Important files will be stored here, so it is configured to keep two copies of each data block:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zfs create example/data</span>
<span class=c># zfs set copies=2 example/data</span></code></pre></div></div><div class=paragraph><p>It is now possible to see the data and space utilization by issuing <code>df</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># df</span>
Filesystem         1K-blocks    Used    Avail Capacity  Mounted on
/dev/ad0s1a          2026030  235234  1628714    13%    /
devfs                      1       1        0   100%    /dev
/dev/ad0s1d         54098308 1032864 48737580     2%    /usr
example             17547008       0 17547008     0%    /example
example/compressed  17547008       0 17547008     0%    /example/compressed
example/data        17547008       0 17547008     0%    /example/data</code></pre></div></div><div class=paragraph><p>Notice that each file system on the pool has the same amount of available space. This is the reason for using <code>df</code> in these examples, to show that the file systems use only the amount of space they need and all draw from the same pool. ZFS eliminates concepts such as volumes and partitions, and allows multiple file systems to occupy the same pool.</p></div><div class=paragraph><p>To destroy the file systems and then destroy the pool as it is no longer needed:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zfs destroy example/compressed</span>
<span class=c># zfs destroy example/data</span>
<span class=c># zpool destroy example</span></code></pre></div></div></div><div class=sect3><h4 id=zfs-quickstart-raid-z>19.2.2. RAID-Z<a class=anchor href=#zfs-quickstart-raid-z></a></h4><div class=paragraph><p>Disks fail. One method of avoiding data loss from disk failure is to implement RAID. ZFS supports this feature in its pool design. RAID-Z pools require three or more disks but provide more usable space than mirrored pools.</p></div><div class=paragraph><p>This example creates a RAID-Z pool, specifying the disks to add to the pool:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zpool create storage raidz da0 da1 da2</span></code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Sun™ recommends that the number of devices used in a RAID-Z configuration be between three and nine. For environments requiring a single pool consisting of 10 disks or more, consider breaking it up into smaller RAID-Z groups. If only two disks are available and redundancy is a requirement, consider using a ZFS mirror. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=zpool&amp;sektion=8&amp;format=html">zpool(8)</a> for more details.</p></div></td></tr></tbody></table></div><div class=paragraph><p>The previous example created the <code>storage</code> zpool. This example makes a new file system called <code>home</code> in that pool:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zfs create storage/home</span></code></pre></div></div><div class=paragraph><p>Compression and keeping extra copies of directories and files can be enabled:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zfs set copies=2 storage/home</span>
<span class=c># zfs set compression=gzip storage/home</span></code></pre></div></div><div class=paragraph><p>To make this the new home directory for users, copy the user data to this directory and create the appropriate symbolic links:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cp -rp /home/* /storage/home</span>
<span class=c># rm -rf /home /usr/home</span>
<span class=c># ln -s /storage/home /home</span>
<span class=c># ln -s /storage/home /usr/home</span></code></pre></div></div><div class=paragraph><p>Users data is now stored on the freshly-created <span class=filename>/storage/home</span>. Test by adding a new user and logging in as that user.</p></div><div class=paragraph><p>Try creating a file system snapshot which can be rolled back later:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zfs snapshot storage/home@08-30-08</span></code></pre></div></div><div class=paragraph><p>Snapshots can only be made of a full file system, not a single directory or file.</p></div><div class=paragraph><p>The <code>@</code> character is a delimiter between the file system name or the volume name. If an important directory has been accidentally deleted, the file system can be backed up, then rolled back to an earlier snapshot when the directory still existed:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zfs rollback storage/home@08-30-08</span></code></pre></div></div><div class=paragraph><p>To list all available snapshots, run <code>ls</code> in the file system’s <span class=filename>.zfs/snapshot</span> directory. For example, to see the previously taken snapshot:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ls /storage/home/.zfs/snapshot</span></code></pre></div></div><div class=paragraph><p>It is possible to write a script to perform regular snapshots on user data. However, over time, snapshots can consume a great deal of disk space. The previous snapshot can be removed using the command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zfs destroy storage/home@08-30-08</span></code></pre></div></div><div class=paragraph><p>After testing, <span class=filename>/storage/home</span> can be made the real <span class=filename>/home</span> using this command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zfs set mountpoint=/home storage/home</span></code></pre></div></div><div class=paragraph><p>Run <code>df</code> and <code>mount</code> to confirm that the system now treats the file system as the real <span class=filename>/home</span>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mount</span>
/dev/ad0s1a on / <span class=o>(</span>ufs, <span class=nb>local</span><span class=o>)</span>
devfs on /dev <span class=o>(</span>devfs, <span class=nb>local</span><span class=o>)</span>
/dev/ad0s1d on /usr <span class=o>(</span>ufs, <span class=nb>local</span>, soft-updates<span class=o>)</span>
storage on /storage <span class=o>(</span>zfs, <span class=nb>local</span><span class=o>)</span>
storage/home on /home <span class=o>(</span>zfs, <span class=nb>local</span><span class=o>)</span>
<span class=c># df</span>
Filesystem   1K-blocks    Used    Avail Capacity  Mounted on
/dev/ad0s1a    2026030  235240  1628708    13%    /
devfs                1       1        0   100%    /dev
/dev/ad0s1d   54098308 1032826 48737618     2%    /usr
storage       26320512       0 26320512     0%    /storage
storage/home  26320512       0 26320512     0%    /home</code></pre></div></div><div class=paragraph><p>This completes the RAID-Z configuration. Daily status updates about the file systems created can be generated as part of the nightly <a href="https://man.freebsd.org/cgi/man.cgi?query=periodic&amp;sektion=8&amp;format=html">periodic(8)</a> runs. Add this line to <span class=filename>/etc/periodic.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>daily_status_zfs_enable=&#34;YES&#34;</pre></div></div></div><div class=sect3><h4 id=zfs-quickstart-recovering-raid-z>19.2.3. Recovering RAID-Z<a class=anchor href=#zfs-quickstart-recovering-raid-z></a></h4><div class=paragraph><p>Every software RAID has a method of monitoring its <code>state</code>. The status of RAID-Z devices may be viewed with this command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zpool status -x</span></code></pre></div></div><div class=paragraph><p>If all pools are <a href=#zfs-term-online>Online</a> and everything is normal, the message shows:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>all pools are healthy</code></pre></div></div><div class=paragraph><p>If there is an issue, perhaps a disk is in the <a href=#zfs-term-offline>Offline</a> state, the pool state will look similar to:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>  pool: storage
 state: DEGRADED
status: One or more devices has been taken offline by the administrator.
	Sufficient replicas exist <span class=k>for </span>the pool to <span class=k>continue </span>functioning <span class=k>in </span>a
	degraded state.
action: Online the device using <span class=s1>&#39;zpool online&#39;</span> or replace the device with
	<span class=s1>&#39;zpool replace&#39;</span><span class=nb>.</span>
 scrub: none requested
config:

	NAME        STATE     READ WRITE CKSUM
	storage     DEGRADED     0     0     0
	  raidz1    DEGRADED     0     0     0
	    da0     ONLINE       0     0     0
	    da1     OFFLINE      0     0     0
	    da2     ONLINE       0     0     0

errors: No known data errors</code></pre></div></div><div class=paragraph><p>This indicates that the device was previously taken offline by the administrator with this command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zpool offline storage da1</span></code></pre></div></div><div class=paragraph><p>Now the system can be powered down to replace <span class=filename>da1</span>. When the system is back online, the failed disk can replaced in the pool:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zpool replace storage da1</span></code></pre></div></div><div class=paragraph><p>From here, the status may be checked again, this time without <code>-x</code> so that all pools are shown:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zpool status storage</span>
 pool: storage
 state: ONLINE
 scrub: resilver completed with 0 errors on Sat Aug 30 19:44:11 2008
config:

	NAME        STATE     READ WRITE CKSUM
	storage     ONLINE       0     0     0
	  raidz1    ONLINE       0     0     0
	    da0     ONLINE       0     0     0
	    da1     ONLINE       0     0     0
	    da2     ONLINE       0     0     0

errors: No known data errors</code></pre></div></div><div class=paragraph><p>In this example, everything is normal.</p></div></div><div class=sect3><h4 id=zfs-quickstart-data-verification>19.2.4. Data Verification<a class=anchor href=#zfs-quickstart-data-verification></a></h4><div class=paragraph><p>ZFS uses checksums to verify the integrity of stored data. These are enabled automatically upon creation of file systems.</p></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>Checksums can be disabled, but it is <em>not</em> recommended! Checksums take very little storage space and provide data integrity. Many ZFS features will not work properly with checksums disabled. There is no noticeable performance gain from disabling these checksums.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Checksum verification is known as <em>scrubbing</em>. Verify the data integrity of the <code>storage</code> pool with this command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zpool scrub storage</span></code></pre></div></div><div class=paragraph><p>The duration of a scrub depends on the amount of data stored. Larger amounts of data will take proportionally longer to verify. Scrubs are very I/O intensive, and only one scrub is allowed to run at a time. After the scrub completes, the status can be viewed with <code>status</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zpool status storage</span>
 pool: storage
 state: ONLINE
 scrub: scrub completed with 0 errors on Sat Jan 26 19:57:37 2013
config:

	NAME        STATE     READ WRITE CKSUM
	storage     ONLINE       0     0     0
	  raidz1    ONLINE       0     0     0
	    da0     ONLINE       0     0     0
	    da1     ONLINE       0     0     0
	    da2     ONLINE       0     0     0

errors: No known data errors</code></pre></div></div><div class=paragraph><p>The completion date of the last scrub operation is displayed to help track when another scrub is required. Routine scrubs help protect data from silent corruption and ensure the integrity of the pool.</p></div><div class=paragraph><p>Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=zfs&amp;sektion=8&amp;format=html">zfs(8)</a> and <a href="https://man.freebsd.org/cgi/man.cgi?query=zpool&amp;sektion=8&amp;format=html">zpool(8)</a> for other ZFS options.</p></div></div></div><div class=sect2><h3 id=zfs-zpool>19.3. <code>zpool</code> Administration<a class=anchor href=#zfs-zpool></a></h3><div class=paragraph><p>ZFS administration is divided between two main utilities. The <code>zpool</code> utility controls the operation of the pool and deals with adding, removing, replacing, and managing disks. The <a href=#zfs-zfs><code>zfs</code></a> utility deals with creating, destroying, and managing datasets, both <a href=#zfs-term-filesystem>file systems</a> and <a href=#zfs-term-volume>volumes</a>.</p></div><div class=sect3><h4 id=zfs-zpool-create>19.3.1. Creating and Destroying Storage Pools<a class=anchor href=#zfs-zpool-create></a></h4><div class=paragraph><p>Creating a ZFS storage pool (<em>zpool</em>) involves making a number of decisions that are relatively permanent because the structure of the pool cannot be changed after the pool has been created. The most important decision is what types of vdevs into which to group the physical disks. See the list of <a href=#zfs-term-vdev>vdev types</a> for details about the possible options. After the pool has been created, most vdev types do not allow additional disks to be added to the vdev. The exceptions are mirrors, which allow additional disks to be added to the vdev, and stripes, which can be upgraded to mirrors by attaching an additional disk to the vdev. Although additional vdevs can be added to expand a pool, the layout of the pool cannot be changed after pool creation. Instead, the data must be backed up and the pool destroyed and recreated.</p></div><div class=paragraph><p>Create a simple mirror pool:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zpool create mypool mirror /dev/ada1 /dev/ada2</span>
<span class=c># zpool status</span>
  pool: mypool
 state: ONLINE
  scan: none requested
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          mirror-0  ONLINE       0     0     0
            ada1    ONLINE       0     0     0
            ada2    ONLINE       0     0     0

errors: No known data errors</code></pre></div></div><div class=paragraph><p>Multiple vdevs can be created at once. Specify multiple groups of disks separated by the vdev type keyword, <code>mirror</code> in this example:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zpool create mypool mirror /dev/ada1 /dev/ada2 mirror /dev/ada3 /dev/ada4</span>
  pool: mypool
 state: ONLINE
  scan: none requested
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          mirror-0  ONLINE       0     0     0
            ada1    ONLINE       0     0     0
            ada2    ONLINE       0     0     0
          mirror-1  ONLINE       0     0     0
            ada3    ONLINE       0     0     0
            ada4    ONLINE       0     0     0

errors: No known data errors</code></pre></div></div><div class=paragraph><p>Pools can also be constructed using partitions rather than whole disks. Putting ZFS in a separate partition allows the same disk to have other partitions for other purposes. In particular, partitions with bootcode and file systems needed for booting can be added. This allows booting from disks that are also members of a pool. There is no performance penalty on FreeBSD when using a partition rather than a whole disk. Using partitions also allows the administrator to <em>under-provision</em> the disks, using less than the full capacity. If a future replacement disk of the same nominal size as the original actually has a slightly smaller capacity, the smaller partition will still fit, and the replacement disk can still be used.</p></div><div class=paragraph><p>Create a <a href=#zfs-term-vdev-raidz>RAID-Z2</a> pool using partitions:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zpool create mypool raidz2 /dev/ada0p3 /dev/ada1p3 /dev/ada2p3 /dev/ada3p3 /dev/ada4p3 /dev/ada5p3</span>
<span class=c># zpool status</span>
  pool: mypool
 state: ONLINE
  scan: none requested
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          raidz2-0  ONLINE       0     0     0
            ada0p3  ONLINE       0     0     0
            ada1p3  ONLINE       0     0     0
            ada2p3  ONLINE       0     0     0
            ada3p3  ONLINE       0     0     0
            ada4p3  ONLINE       0     0     0
            ada5p3  ONLINE       0     0     0

errors: No known data errors</code></pre></div></div><div class=paragraph><p>A pool that is no longer needed can be destroyed so that the disks can be reused. Destroying a pool involves first unmounting all of the datasets in that pool. If the datasets are in use, the unmount operation will fail and the pool will not be destroyed. The destruction of the pool can be forced with <code>-f</code>, but this can cause undefined behavior in applications which had open files on those datasets.</p></div></div><div class=sect3><h4 id=zfs-zpool-attach>19.3.2. Adding and Removing Devices<a class=anchor href=#zfs-zpool-attach></a></h4><div class=paragraph><p>There are two cases for adding disks to a zpool: attaching a disk to an existing vdev with <code>zpool attach</code>, or adding vdevs to the pool with <code>zpool add</code>. Only some <a href=#zfs-term-vdev>vdev types</a> allow disks to be added to the vdev after creation.</p></div><div class=paragraph><p>A pool created with a single disk lacks redundancy. Corruption can be detected but not repaired, because there is no other copy of the data. The <a href=#zfs-term-copies>copies</a> property may be able to recover from a small failure such as a bad sector, but does not provide the same level of protection as mirroring or RAID-Z. Starting with a pool consisting of a single disk vdev, <code>zpool attach</code> can be used to add an additional disk to the vdev, creating a mirror. <code>zpool attach</code> can also be used to add additional disks to a mirror group, increasing redundancy and read performance. If the disks being used for the pool are partitioned, replicate the layout of the first disk on to the second. <code>gpart backup</code> and <code>gpart restore</code> can be used to make this process easier.</p></div><div class=paragraph><p>Upgrade the single disk (stripe) vdev <em>ada0p3</em> to a mirror by attaching <em>ada1p3</em>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zpool status</span>
  pool: mypool
 state: ONLINE
  scan: none requested
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          ada0p3    ONLINE       0     0     0

errors: No known data errors
<span class=c># zpool attach mypool ada0p3 ada1p3</span>
Make sure to <span class=nb>wait </span><span class=k>until </span>resilver is <span class=k>done </span>before rebooting.

If you boot from pool <span class=s1>&#39;mypool&#39;</span>, you may need to update
boot code on newly attached disk <span class=s1>&#39;ada1p3&#39;</span><span class=nb>.</span>

Assuming you use GPT partitioning and <span class=s1>&#39;da0&#39;</span> is your new boot disk
you may use the following <span class=nb>command</span>:

        gpart bootcode <span class=nt>-b</span> /boot/pmbr <span class=nt>-p</span> /boot/gptzfsboot <span class=nt>-i</span> 1 da0
<span class=c># gpart bootcode -b /boot/pmbr -p /boot/gptzfsboot -i 1 ada1</span>
bootcode written to ada1
<span class=c># zpool status</span>
  pool: mypool
 state: ONLINE
status: One or more devices is currently being resilvered.  The pool will
        <span class=k>continue </span>to <span class=k>function</span>, possibly <span class=k>in </span>a degraded state.
action: Wait <span class=k>for </span>the resilver to complete.
  scan: resilver <span class=k>in </span>progress since Fri May 30 08:19:19 2014
        527M scanned out of 781M at 47.9M/s, 0h0m to go
        527M resilvered, 67.53% <span class=k>done
</span>config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          mirror-0  ONLINE       0     0     0
            ada0p3  ONLINE       0     0     0
            ada1p3  ONLINE       0     0     0  <span class=o>(</span>resilvering<span class=o>)</span>

errors: No known data errors
<span class=c># zpool status</span>
  pool: mypool
 state: ONLINE
  scan: resilvered 781M <span class=k>in </span>0h0m with 0 errors on Fri May 30 08:15:58 2014
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          mirror-0  ONLINE       0     0     0
            ada0p3  ONLINE       0     0     0
            ada1p3  ONLINE       0     0     0

errors: No known data errors</code></pre></div></div><div class=paragraph><p>When adding disks to the existing vdev is not an option, as for RAID-Z, an alternative method is to add another vdev to the pool. Additional vdevs provide higher performance, distributing writes across the vdevs. Each vdev is responsible for providing its own redundancy. It is possible, but discouraged, to mix vdev types, like <code>mirror</code> and <code>RAID-Z</code>. Adding a non-redundant vdev to a pool containing mirror or RAID-Z vdevs risks the data on the entire pool. Writes are distributed, so the failure of the non-redundant disk will result in the loss of a fraction of every block that has been written to the pool.</p></div><div class=paragraph><p>Data is striped across each of the vdevs. For example, with two mirror vdevs, this is effectively a RAID 10 that stripes writes across two sets of mirrors. Space is allocated so that each vdev reaches 100% full at the same time. There is a performance penalty if the vdevs have different amounts of free space, as a disproportionate amount of the data is written to the less full vdev.</p></div><div class=paragraph><p>When attaching additional devices to a boot pool, remember to update the bootcode.</p></div><div class=paragraph><p>Attach a second mirror group (<span class=filename>ada2p3</span> and <span class=filename>ada3p3</span>) to the existing mirror:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zpool status</span>
  pool: mypool
 state: ONLINE
  scan: resilvered 781M <span class=k>in </span>0h0m with 0 errors on Fri May 30 08:19:35 2014
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          mirror-0  ONLINE       0     0     0
            ada0p3  ONLINE       0     0     0
            ada1p3  ONLINE       0     0     0

errors: No known data errors
<span class=c># zpool add mypool mirror ada2p3 ada3p3</span>
<span class=c># gpart bootcode -b /boot/pmbr -p /boot/gptzfsboot -i 1 ada2</span>
bootcode written to ada2
<span class=c># gpart bootcode -b /boot/pmbr -p /boot/gptzfsboot -i 1 ada3</span>
bootcode written to ada3
<span class=c># zpool status</span>
  pool: mypool
 state: ONLINE
  scan: scrub repaired 0 <span class=k>in </span>0h0m with 0 errors on Fri May 30 08:29:51 2014
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          mirror-0  ONLINE       0     0     0
            ada0p3  ONLINE       0     0     0
            ada1p3  ONLINE       0     0     0
          mirror-1  ONLINE       0     0     0
            ada2p3  ONLINE       0     0     0
            ada3p3  ONLINE       0     0     0

errors: No known data errors</code></pre></div></div><div class=paragraph><p>Currently, vdevs cannot be removed from a pool, and disks can only be removed from a mirror if there is enough remaining redundancy. If only one disk in a mirror group remains, it ceases to be a mirror and reverts to being a stripe, risking the entire pool if that remaining disk fails.</p></div><div class=paragraph><p>Remove a disk from a three-way mirror group:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zpool status</span>
  pool: mypool
 state: ONLINE
  scan: scrub repaired 0 <span class=k>in </span>0h0m with 0 errors on Fri May 30 08:29:51 2014
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          mirror-0  ONLINE       0     0     0
            ada0p3  ONLINE       0     0     0
            ada1p3  ONLINE       0     0     0
            ada2p3  ONLINE       0     0     0

errors: No known data errors
<span class=c># zpool detach mypool ada2p3</span>
<span class=c># zpool status</span>
  pool: mypool
 state: ONLINE
  scan: scrub repaired 0 <span class=k>in </span>0h0m with 0 errors on Fri May 30 08:29:51 2014
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          mirror-0  ONLINE       0     0     0
            ada0p3  ONLINE       0     0     0
            ada1p3  ONLINE       0     0     0

errors: No known data errors</code></pre></div></div></div><div class=sect3><h4 id=zfs-zpool-status>19.3.3. Checking the Status of a Pool<a class=anchor href=#zfs-zpool-status></a></h4><div class=paragraph><p>Pool status is important. If a drive goes offline or a read, write, or checksum error is detected, the corresponding error count increases. The <code>status</code> output shows the configuration and status of each device in the pool and the status of the entire pool. Actions that need to be taken and details about the last <a href=#zfs-zpool-scrub><code>scrub</code></a> are also shown.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zpool status</span>
  pool: mypool
 state: ONLINE
  scan: scrub repaired 0 <span class=k>in </span>2h25m with 0 errors on Sat Sep 14 04:25:50 2013
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          raidz2-0  ONLINE       0     0     0
            ada0p3  ONLINE       0     0     0
            ada1p3  ONLINE       0     0     0
            ada2p3  ONLINE       0     0     0
            ada3p3  ONLINE       0     0     0
            ada4p3  ONLINE       0     0     0
            ada5p3  ONLINE       0     0     0

errors: No known data errors</code></pre></div></div></div><div class=sect3><h4 id=zfs-zpool-clear>19.3.4. Clearing Errors<a class=anchor href=#zfs-zpool-clear></a></h4><div class=paragraph><p>When an error is detected, the read, write, or checksum counts are incremented. The error message can be cleared and the counts reset with <code>zpool clear <em>mypool</em></code>. Clearing the error state can be important for automated scripts that alert the administrator when the pool encounters an error. Further errors may not be reported if the old errors are not cleared.</p></div></div><div class=sect3><h4 id=zfs-zpool-replace>19.3.5. Replacing a Functioning Device<a class=anchor href=#zfs-zpool-replace></a></h4><div class=paragraph><p>There are a number of situations where it may be desirable to replace one disk with a different disk. When replacing a working disk, the process keeps the old disk online during the replacement. The pool never enters a <a href=#zfs-term-degraded>degraded</a> state, reducing the risk of data loss. <code>zpool replace</code> copies all of the data from the old disk to the new one. After the operation completes, the old disk is disconnected from the vdev. If the new disk is larger than the old disk, it may be possible to grow the zpool, using the new space. See <a href=#zfs-zpool-online>Growing a Pool</a>.</p></div><div class=paragraph><p>Replace a functioning device in the pool:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zpool status</span>
  pool: mypool
 state: ONLINE
  scan: none requested
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          mirror-0  ONLINE       0     0     0
            ada0p3  ONLINE       0     0     0
            ada1p3  ONLINE       0     0     0

errors: No known data errors
<span class=c># zpool replace mypool ada1p3 ada2p3</span>
Make sure to <span class=nb>wait </span><span class=k>until </span>resilver is <span class=k>done </span>before rebooting.

If you boot from pool <span class=s1>&#39;zroot&#39;</span>, you may need to update
boot code on newly attached disk <span class=s1>&#39;ada2p3&#39;</span><span class=nb>.</span>

Assuming you use GPT partitioning and <span class=s1>&#39;da0&#39;</span> is your new boot disk
you may use the following <span class=nb>command</span>:

        gpart bootcode <span class=nt>-b</span> /boot/pmbr <span class=nt>-p</span> /boot/gptzfsboot <span class=nt>-i</span> 1 da0
<span class=c># gpart bootcode -b /boot/pmbr -p /boot/gptzfsboot -i 1 ada2</span>
<span class=c># zpool status</span>
  pool: mypool
 state: ONLINE
status: One or more devices is currently being resilvered.  The pool will
        <span class=k>continue </span>to <span class=k>function</span>, possibly <span class=k>in </span>a degraded state.
action: Wait <span class=k>for </span>the resilver to complete.
  scan: resilver <span class=k>in </span>progress since Mon Jun  2 14:21:35 2014
        604M scanned out of 781M at 46.5M/s, 0h0m to go
        604M resilvered, 77.39% <span class=k>done
</span>config:

        NAME             STATE     READ WRITE CKSUM
        mypool           ONLINE       0     0     0
          mirror-0       ONLINE       0     0     0
            ada0p3       ONLINE       0     0     0
            replacing-1  ONLINE       0     0     0
              ada1p3     ONLINE       0     0     0
              ada2p3     ONLINE       0     0     0  <span class=o>(</span>resilvering<span class=o>)</span>

errors: No known data errors
<span class=c># zpool status</span>
  pool: mypool
 state: ONLINE
  scan: resilvered 781M <span class=k>in </span>0h0m with 0 errors on Mon Jun  2 14:21:52 2014
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          mirror-0  ONLINE       0     0     0
            ada0p3  ONLINE       0     0     0
            ada2p3  ONLINE       0     0     0

errors: No known data errors</code></pre></div></div></div><div class=sect3><h4 id=zfs-zpool-resilver>19.3.6. Dealing with Failed Devices<a class=anchor href=#zfs-zpool-resilver></a></h4><div class=paragraph><p>When a disk in a pool fails, the vdev to which the disk belongs enters the <a href=#zfs-term-degraded>degraded</a> state. All of the data is still available, but performance may be reduced because missing data must be calculated from the available redundancy. To restore the vdev to a fully functional state, the failed physical device must be replaced. ZFS is then instructed to begin the <a href=#zfs-term-resilver>resilver</a> operation. Data that was on the failed device is recalculated from available redundancy and written to the replacement device. After completion, the vdev returns to <a href=#zfs-term-online>online</a> status.</p></div><div class=paragraph><p>If the vdev does not have any redundancy, or if multiple devices have failed and there is not enough redundancy to compensate, the pool enters the <a href=#zfs-term-faulted>faulted</a> state. If a sufficient number of devices cannot be reconnected to the pool, the pool becomes inoperative and data must be restored from backups.</p></div><div class=paragraph><p>When replacing a failed disk, the name of the failed disk is replaced with the GUID of the device. A new device name parameter for <code>zpool replace</code> is not required if the replacement device has the same device name.</p></div><div class=paragraph><p>Replace a failed disk using <code>zpool replace</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zpool status</span>
  pool: mypool
 state: DEGRADED
status: One or more devices could not be opened.  Sufficient replicas exist <span class=k>for
        </span>the pool to <span class=k>continue </span>functioning <span class=k>in </span>a degraded state.
action: Attach the missing device and online it using <span class=s1>&#39;zpool online&#39;</span><span class=nb>.</span>
   see: http://illumos.org/msg/ZFS-8000-2Q
  scan: none requested
config:

        NAME                    STATE     READ WRITE CKSUM
        mypool                  DEGRADED     0     0     0
          mirror-0              DEGRADED     0     0     0
            ada0p3              ONLINE       0     0     0
            316502962686821739  UNAVAIL      0     0     0  was /dev/ada1p3

errors: No known data errors
<span class=c># zpool replace mypool 316502962686821739 ada2p3</span>
<span class=c># zpool status</span>
  pool: mypool
 state: DEGRADED
status: One or more devices is currently being resilvered.  The pool will
        <span class=k>continue </span>to <span class=k>function</span>, possibly <span class=k>in </span>a degraded state.
action: Wait <span class=k>for </span>the resilver to complete.
  scan: resilver <span class=k>in </span>progress since Mon Jun  2 14:52:21 2014
        641M scanned out of 781M at 49.3M/s, 0h0m to go
        640M resilvered, 82.04% <span class=k>done
</span>config:

        NAME                        STATE     READ WRITE CKSUM
        mypool                      DEGRADED     0     0     0
          mirror-0                  DEGRADED     0     0     0
            ada0p3                  ONLINE       0     0     0
            replacing-1             UNAVAIL      0     0     0
              15732067398082357289  UNAVAIL      0     0     0  was /dev/ada1p3/old
              ada2p3                ONLINE       0     0     0  <span class=o>(</span>resilvering<span class=o>)</span>

errors: No known data errors
<span class=c># zpool status</span>
  pool: mypool
 state: ONLINE
  scan: resilvered 781M <span class=k>in </span>0h0m with 0 errors on Mon Jun  2 14:52:38 2014
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          mirror-0  ONLINE       0     0     0
            ada0p3  ONLINE       0     0     0
            ada2p3  ONLINE       0     0     0

errors: No known data errors</code></pre></div></div></div><div class=sect3><h4 id=zfs-zpool-scrub>19.3.7. Scrubbing a Pool<a class=anchor href=#zfs-zpool-scrub></a></h4><div class=paragraph><p>It is recommended that pools be <a href=#zfs-term-scrub>scrubbed</a> regularly, ideally at least once every month. The <code>scrub</code> operation is very disk-intensive and will reduce performance while running. Avoid high-demand periods when scheduling <code>scrub</code> or use <a href=#zfs-advanced-tuning-scrub_delay><code>vfs.zfs.scrub_delay</code></a> to adjust the relative priority of the <code>scrub</code> to prevent it interfering with other workloads.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zpool scrub mypool</span>
<span class=c># zpool status</span>
  pool: mypool
 state: ONLINE
  scan: scrub <span class=k>in </span>progress since Wed Feb 19 20:52:54 2014
        116G scanned out of 8.60T at 649M/s, 3h48m to go
        0 repaired, 1.32% <span class=k>done
</span>config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          raidz2-0  ONLINE       0     0     0
            ada0p3  ONLINE       0     0     0
            ada1p3  ONLINE       0     0     0
            ada2p3  ONLINE       0     0     0
            ada3p3  ONLINE       0     0     0
            ada4p3  ONLINE       0     0     0
            ada5p3  ONLINE       0     0     0

errors: No known data errors</code></pre></div></div><div class=paragraph><p>In the event that a scrub operation needs to be cancelled, issue <code>zpool scrub -s <em>mypool</em></code>.</p></div></div><div class=sect3><h4 id=zfs-zpool-selfheal>19.3.8. Self-Healing<a class=anchor href=#zfs-zpool-selfheal></a></h4><div class=paragraph><p>The checksums stored with data blocks enable the file system to <em>self-heal</em>. This feature will automatically repair data whose checksum does not match the one recorded on another device that is part of the storage pool. For example, a mirror with two disks where one drive is starting to malfunction and cannot properly store the data any more. This is even worse when the data has not been accessed for a long time, as with long term archive storage. Traditional file systems need to run algorithms that check and repair the data like <a href="https://man.freebsd.org/cgi/man.cgi?query=fsck&amp;sektion=8&amp;format=html">fsck(8)</a>. These commands take time, and in severe cases, an administrator has to manually decide which repair operation must be performed. When ZFS detects a data block with a checksum that does not match, it tries to read the data from the mirror disk. If that disk can provide the correct data, it will not only give that data to the application requesting it, but also correct the wrong data on the disk that had the bad checksum. This happens without any interaction from a system administrator during normal pool operation.</p></div><div class=paragraph><p>The next example demonstrates this self-healing behavior. A mirrored pool of disks <span class=filename>/dev/ada0</span> and <span class=filename>/dev/ada1</span> is created.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zpool create healer mirror /dev/ada0 /dev/ada1</span>
<span class=c># zpool status healer</span>
  pool: healer
 state: ONLINE
  scan: none requested
config:

    NAME        STATE     READ WRITE CKSUM
    healer      ONLINE       0     0     0
      mirror-0  ONLINE       0     0     0
       ada0     ONLINE       0     0     0
       ada1     ONLINE       0     0     0

errors: No known data errors
<span class=c># zpool list</span>
NAME     SIZE  ALLOC   FREE   CKPOINT  EXPANDSZ   FRAG   CAP  DEDUP  HEALTH  ALTROOT
healer   960M  92.5K   960M         -         -     0%    0%  1.00x  ONLINE  -</code></pre></div></div><div class=paragraph><p>Some important data that have to be protected from data errors using the self-healing feature are copied to the pool. A checksum of the pool is created for later comparison.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cp /some/important/data /healer</span>
<span class=c># zfs list</span>
NAME     SIZE  ALLOC   FREE    CAP  DEDUP  HEALTH  ALTROOT
healer   960M  67.7M   892M     7%  1.00x  ONLINE  -
<span class=c># sha1 /healer &gt; checksum.txt</span>
<span class=c># cat checksum.txt</span>
SHA1 <span class=o>(</span>/healer<span class=o>)</span> <span class=o>=</span> 2753eff56d77d9a536ece6694bf0a82740344d1f</code></pre></div></div><div class=paragraph><p>Data corruption is simulated by writing random data to the beginning of one of the disks in the mirror. To prevent ZFS from healing the data as soon as it is detected, the pool is exported before the corruption and imported again afterwards.</p></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>This is a dangerous operation that can destroy vital data. It is shown here for demonstrational purposes only and should not be attempted during normal operation of a storage pool. Nor should this intentional corruption example be run on any disk with a different file system on it. Do not use any other disk device names other than the ones that are part of the pool. Make certain that proper backups of the pool are created before running the command!</p></div></td></tr></tbody></table></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zpool export healer</span>
<span class=c># dd if=/dev/random of=/dev/ada1 bs=1m count=200</span>
200+0 records <span class=k>in
</span>200+0 records out
209715200 bytes transferred <span class=k>in </span>62.992162 secs <span class=o>(</span>3329227 bytes/sec<span class=o>)</span>
<span class=c># zpool import healer</span></code></pre></div></div><div class=paragraph><p>The pool status shows that one device has experienced an error. Note that applications reading data from the pool did not receive any incorrect data. ZFS provided data from the <span class=filename>ada0</span> device with the correct checksums. The device with the wrong checksum can be found easily as the <code>CKSUM</code> column contains a nonzero value.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zpool status healer</span>
    pool: healer
   state: ONLINE
  status: One or more devices has experienced an unrecoverable error.  An
          attempt was made to correct the error.  Applications are unaffected.
  action: Determine <span class=k>if </span>the device needs to be replaced, and clear the errors
          using <span class=s1>&#39;zpool clear&#39;</span> or replace the device with <span class=s1>&#39;zpool replace&#39;</span><span class=nb>.</span>
     see: http://illumos.org/msg/ZFS-8000-4J
    scan: none requested
  config:

      NAME        STATE     READ WRITE CKSUM
      healer      ONLINE       0     0     0
        mirror-0  ONLINE       0     0     0
         ada0     ONLINE       0     0     0
         ada1     ONLINE       0     0     1

errors: No known data errors</code></pre></div></div><div class=paragraph><p>The error was detected and handled by using the redundancy present in the unaffected <span class=filename>ada0</span> mirror disk. A checksum comparison with the original one will reveal whether the pool is consistent again.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sha1 /healer &gt;&gt; checksum.txt</span>
<span class=c># cat checksum.txt</span>
SHA1 <span class=o>(</span>/healer<span class=o>)</span> <span class=o>=</span> 2753eff56d77d9a536ece6694bf0a82740344d1f
SHA1 <span class=o>(</span>/healer<span class=o>)</span> <span class=o>=</span> 2753eff56d77d9a536ece6694bf0a82740344d1f</code></pre></div></div><div class=paragraph><p>The two checksums that were generated before and after the intentional tampering with the pool data still match. This shows how ZFS is capable of detecting and correcting any errors automatically when the checksums differ. Note that this is only possible when there is enough redundancy present in the pool. A pool consisting of a single device has no self-healing capabilities. That is also the reason why checksums are so important in ZFS and should not be disabled for any reason. No <a href="https://man.freebsd.org/cgi/man.cgi?query=fsck&amp;sektion=8&amp;format=html">fsck(8)</a> or similar file system consistency check program is required to detect and correct this and the pool was still available during the time there was a problem. A scrub operation is now required to overwrite the corrupted data on <span class=filename>ada1</span>.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zpool scrub healer</span>
<span class=c># zpool status healer</span>
  pool: healer
 state: ONLINE
status: One or more devices has experienced an unrecoverable error.  An
            attempt was made to correct the error.  Applications are unaffected.
action: Determine <span class=k>if </span>the device needs to be replaced, and clear the errors
            using <span class=s1>&#39;zpool clear&#39;</span> or replace the device with <span class=s1>&#39;zpool replace&#39;</span><span class=nb>.</span>
   see: http://illumos.org/msg/ZFS-8000-4J
  scan: scrub <span class=k>in </span>progress since Mon Dec 10 12:23:30 2012
        10.4M scanned out of 67.0M at 267K/s, 0h3m to go
        9.63M repaired, 15.56% <span class=k>done
</span>config:

    NAME        STATE     READ WRITE CKSUM
    healer      ONLINE       0     0     0
      mirror-0  ONLINE       0     0     0
       ada0     ONLINE       0     0     0
       ada1     ONLINE       0     0   627  <span class=o>(</span>repairing<span class=o>)</span>

errors: No known data errors</code></pre></div></div><div class=paragraph><p>The scrub operation reads data from <span class=filename>ada0</span> and rewrites any data with an incorrect checksum on <span class=filename>ada1</span>. This is indicated by the <code>(repairing)</code> output from <code>zpool status</code>. After the operation is complete, the pool status changes to:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zpool status healer</span>
  pool: healer
 state: ONLINE
status: One or more devices has experienced an unrecoverable error.  An
        attempt was made to correct the error.  Applications are unaffected.
action: Determine <span class=k>if </span>the device needs to be replaced, and clear the errors
             using <span class=s1>&#39;zpool clear&#39;</span> or replace the device with <span class=s1>&#39;zpool replace&#39;</span><span class=nb>.</span>
   see: http://illumos.org/msg/ZFS-8000-4J
  scan: scrub repaired 66.5M <span class=k>in </span>0h2m with 0 errors on Mon Dec 10 12:26:25 2012
config:

    NAME        STATE     READ WRITE CKSUM
    healer      ONLINE       0     0     0
      mirror-0  ONLINE       0     0     0
       ada0     ONLINE       0     0     0
       ada1     ONLINE       0     0 2.72K

errors: No known data errors</code></pre></div></div><div class=paragraph><p>After the scrub operation completes and all the data has been synchronized from <span class=filename>ada0</span> to <span class=filename>ada1</span>, the error messages can be <a href=#zfs-zpool-clear>cleared</a> from the pool status by running <code>zpool clear</code>.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zpool clear healer</span>
<span class=c># zpool status healer</span>
  pool: healer
 state: ONLINE
  scan: scrub repaired 66.5M <span class=k>in </span>0h2m with 0 errors on Mon Dec 10 12:26:25 2012
config:

    NAME        STATE     READ WRITE CKSUM
    healer      ONLINE       0     0     0
      mirror-0  ONLINE       0     0     0
       ada0     ONLINE       0     0     0
       ada1     ONLINE       0     0     0

errors: No known data errors</code></pre></div></div><div class=paragraph><p>The pool is now back to a fully working state and all the errors have been cleared.</p></div></div><div class=sect3><h4 id=zfs-zpool-online>19.3.9. Growing a Pool<a class=anchor href=#zfs-zpool-online></a></h4><div class=paragraph><p>The usable size of a redundant pool is limited by the capacity of the smallest device in each vdev. The smallest device can be replaced with a larger device. After completing a <a href=#zfs-zpool-replace>replace</a> or <a href=#zfs-term-resilver>resilver</a> operation, the pool can grow to use the capacity of the new device. For example, consider a mirror of a 1 TB drive and a 2 TB drive. The usable space is 1 TB. When the 1 TB drive is replaced with another 2 TB drive, the resilvering process copies the existing data onto the new drive. Because both of the devices now have 2 TB capacity, the mirror’s available space can be grown to 2 TB.</p></div><div class=paragraph><p>Expansion is triggered by using <code>zpool online -e</code> on each device. After expansion of all devices, the additional space becomes available to the pool.</p></div></div><div class=sect3><h4 id=zfs-zpool-import>19.3.10. Importing and Exporting Pools<a class=anchor href=#zfs-zpool-import></a></h4><div class=paragraph><p>Pools are <em>exported</em> before moving them to another system. All datasets are unmounted, and each device is marked as exported but still locked so it cannot be used by other disk subsystems. This allows pools to be <em>imported</em> on other machines, other operating systems that support ZFS, and even different hardware architectures (with some caveats, see <a href="https://man.freebsd.org/cgi/man.cgi?query=zpool&amp;sektion=8&amp;format=html">zpool(8)</a>). When a dataset has open files, <code>zpool export -f</code> can be used to force the export of a pool. Use this with caution. The datasets are forcibly unmounted, potentially resulting in unexpected behavior by the applications which had open files on those datasets.</p></div><div class=paragraph><p>Export a pool that is not in use:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zpool export mypool</span></code></pre></div></div><div class=paragraph><p>Importing a pool automatically mounts the datasets. This may not be the desired behavior, and can be prevented with <code>zpool import -N</code>. <code>zpool import -o</code> sets temporary properties for this import only. <code>zpool import altroot=</code> allows importing a pool with a base mount point instead of the root of the file system. If the pool was last used on a different system and was not properly exported, an import might have to be forced with <code>zpool import -f</code>. <code>zpool import -a</code> imports all pools that do not appear to be in use by another system.</p></div><div class=paragraph><p>List all available pools for import:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zpool import</span>
   pool: mypool
     <span class=nb>id</span>: 9930174748043525076
  state: ONLINE
 action: The pool can be imported using its name or numeric identifier.
 config:

        mypool      ONLINE
          ada2p3    ONLINE</code></pre></div></div><div class=paragraph><p>Import the pool with an alternative root directory:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zpool import -o altroot=/mnt mypool</span>
<span class=c># zfs list</span>
zfs list
NAME                 USED  AVAIL  REFER  MOUNTPOINT
mypool               110K  47.0G    31K  /mnt/mypool</code></pre></div></div></div><div class=sect3><h4 id=zfs-zpool-upgrade>19.3.11. Upgrading a Storage Pool<a class=anchor href=#zfs-zpool-upgrade></a></h4><div class=paragraph><p>After upgrading FreeBSD, or if a pool has been imported from a system using an older version of ZFS, the pool can be manually upgraded to the latest version of ZFS to support newer features. Consider whether the pool may ever need to be imported on an older system before upgrading. Upgrading is a one-way process. Older pools can be upgraded, but pools with newer features cannot be downgraded.</p></div><div class=paragraph><p>Upgrade a v28 pool to support <code>Feature Flags</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zpool status</span>
  pool: mypool
 state: ONLINE
status: The pool is formatted using a legacy on-disk format.  The pool can
        still be used, but some features are unavailable.
action: Upgrade the pool using <span class=s1>&#39;zpool upgrade&#39;</span><span class=nb>.</span>  Once this is <span class=k>done</span>, the
        pool will no longer be accessible on software that does not support feat
        flags.
  scan: none requested
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          mirror-0  ONLINE       0     0     0
	    ada0    ONLINE       0     0     0
	    ada1    ONLINE       0     0     0

errors: No known data errors
<span class=c># zpool upgrade</span>
This system supports ZFS pool feature flags.

The following pools are formatted with legacy version numbers and can
be upgraded to use feature flags.  After being upgraded, these pools
will no longer be accessible by software that does not support feature
flags.

VER  POOL
<span class=nt>---</span>  <span class=nt>------------</span>
28   mypool

Use <span class=s1>&#39;zpool upgrade -v&#39;</span> <span class=k>for </span>a list of available legacy versions.
Every feature flags pool has all supported features enabled.
<span class=c># zpool upgrade mypool</span>
This system supports ZFS pool feature flags.

Successfully upgraded <span class=s1>&#39;mypool&#39;</span> from version 28 to feature flags.
Enabled the following features on <span class=s1>&#39;mypool&#39;</span>:
  async_destroy
  empty_bpobj
  lz4_compress
  multi_vdev_crash_dump</code></pre></div></div><div class=paragraph><p>The newer features of ZFS will not be available until <code>zpool upgrade</code> has completed. <code>zpool upgrade -v</code> can be used to see what new features will be provided by upgrading, as well as which features are already supported.</p></div><div class=paragraph><p>Upgrade a pool to support additional feature flags:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zpool status</span>
  pool: mypool
 state: ONLINE
status: Some supported features are not enabled on the pool. The pool can
        still be used, but some features are unavailable.
action: Enable all features using <span class=s1>&#39;zpool upgrade&#39;</span><span class=nb>.</span> Once this is <span class=k>done</span>,
        the pool may no longer be accessible by software that does not support
        the features. See zpool-features<span class=o>(</span>7<span class=o>)</span> <span class=k>for </span>details.
  scan: none requested
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          mirror-0  ONLINE       0     0     0
	    ada0    ONLINE       0     0     0
	    ada1    ONLINE       0     0     0

errors: No known data errors
<span class=c># zpool upgrade</span>
This system supports ZFS pool feature flags.

All pools are formatted using feature flags.

Some supported features are not enabled on the following pools. Once a
feature is enabled the pool may become incompatible with software
that does not support the feature. See zpool-features<span class=o>(</span>7<span class=o>)</span> <span class=k>for </span>details.

POOL  FEATURE
<span class=nt>---------------</span>
zstore
      multi_vdev_crash_dump
      spacemap_histogram
      enabled_txg
      hole_birth
      extensible_dataset
      bookmarks
      filesystem_limits
<span class=c># zpool upgrade mypool</span>
This system supports ZFS pool feature flags.

Enabled the following features on <span class=s1>&#39;mypool&#39;</span>:
  spacemap_histogram
  enabled_txg
  hole_birth
  extensible_dataset
  bookmarks
  filesystem_limits</code></pre></div></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>The boot code on systems that boot from a pool must be updated to support the new pool version. Use <code>gpart bootcode</code> on the partition that contains the boot code. There are two types of bootcode available, depending on way the system boots: GPT (the most common option) and EFI (for more modern systems).</p></div><div class=paragraph><p>For legacy boot using GPT, use the following command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># gpart bootcode -b /boot/pmbr -p /boot/gptzfsboot -i 1 ada1</span></code></pre></div></div><div class=paragraph><p>For systems using EFI to boot, execute the following command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># gpart bootcode -p /boot/boot1.efifat -i 1 ada1</span></code></pre></div></div><div class=paragraph><p>Apply the bootcode to all bootable disks in the pool. See <a href="https://man.freebsd.org/cgi/man.cgi?query=gpart&amp;sektion=8&amp;format=html">gpart(8)</a> for more information.</p></div></td></tr></tbody></table></div></div><div class=sect3><h4 id=zfs-zpool-history>19.3.12. Displaying Recorded Pool History<a class=anchor href=#zfs-zpool-history></a></h4><div class=paragraph><p>Commands that modify the pool are recorded. Recorded actions include the creation of datasets, changing properties, or replacement of a disk. This history is useful for reviewing how a pool was created and which user performed a specific action and when. History is not kept in a log file, but is part of the pool itself. The command to review this history is aptly named <code>zpool history</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zpool history</span>
History <span class=k>for</span> <span class=s1>&#39;tank&#39;</span>:
2013-02-26.23:02:35 zpool create tank mirror /dev/ada0 /dev/ada1
2013-02-27.18:50:58 zfs <span class=nb>set </span><span class=nv>atime</span><span class=o>=</span>off tank
2013-02-27.18:51:09 zfs <span class=nb>set </span><span class=nv>checksum</span><span class=o>=</span>fletcher4 tank
2013-02-27.18:51:18 zfs create tank/backup</code></pre></div></div><div class=paragraph><p>The output shows <code>zpool</code> and <code>zfs</code> commands that were executed on the pool along with a timestamp. Only commands that alter the pool in some way are recorded. Commands like <code>zfs list</code> are not included. When no pool name is specified, the history of all pools is displayed.</p></div><div class=paragraph><p><code>zpool history</code> can show even more information when the options <code>-i</code> or <code>-l</code> are provided. <code>-i</code> displays user-initiated events as well as internally logged ZFS events.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zpool history -i</span>
History <span class=k>for</span> <span class=s1>&#39;tank&#39;</span>:
2013-02-26.23:02:35 <span class=o>[</span>internal pool create txg:5] pool spa 28<span class=p>;</span> zfs spa 28<span class=p>;</span> zpl 5<span class=p>;</span>uts  9.1-RELEASE 901000 amd64
2013-02-27.18:50:53 <span class=o>[</span>internal property <span class=nb>set </span>txg:50] <span class=nv>atime</span><span class=o>=</span>0 dataset <span class=o>=</span> 21
2013-02-27.18:50:58 zfs <span class=nb>set </span><span class=nv>atime</span><span class=o>=</span>off tank
2013-02-27.18:51:04 <span class=o>[</span>internal property <span class=nb>set </span>txg:53] <span class=nv>checksum</span><span class=o>=</span>7 dataset <span class=o>=</span> 21
2013-02-27.18:51:09 zfs <span class=nb>set </span><span class=nv>checksum</span><span class=o>=</span>fletcher4 tank
2013-02-27.18:51:13 <span class=o>[</span>internal create txg:55] dataset <span class=o>=</span> 39
2013-02-27.18:51:18 zfs create tank/backup</code></pre></div></div><div class=paragraph><p>More details can be shown by adding <code>-l</code>. History records are shown in a long format, including information like the name of the user who issued the command and the hostname on which the change was made.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zpool history -l</span>
History <span class=k>for</span> <span class=s1>&#39;tank&#39;</span>:
2013-02-26.23:02:35 zpool create tank mirror /dev/ada0 /dev/ada1 <span class=o>[</span>user 0 <span class=o>(</span>root<span class=o>)</span> on :global]
2013-02-27.18:50:58 zfs <span class=nb>set </span><span class=nv>atime</span><span class=o>=</span>off tank <span class=o>[</span>user 0 <span class=o>(</span>root<span class=o>)</span> on myzfsbox:global]
2013-02-27.18:51:09 zfs <span class=nb>set </span><span class=nv>checksum</span><span class=o>=</span>fletcher4 tank <span class=o>[</span>user 0 <span class=o>(</span>root<span class=o>)</span> on myzfsbox:global]
2013-02-27.18:51:18 zfs create tank/backup <span class=o>[</span>user 0 <span class=o>(</span>root<span class=o>)</span> on myzfsbox:global]</code></pre></div></div><div class=paragraph><p>The output shows that the <code>root</code> user created the mirrored pool with disks <span class=filename>/dev/ada0</span> and <span class=filename>/dev/ada1</span>. The hostname <code>myzfsbox</code> is also shown in the commands after the pool’s creation. The hostname display becomes important when the pool is exported from one system and imported on another. The commands that are issued on the other system can clearly be distinguished by the hostname that is recorded for each command.</p></div><div class=paragraph><p>Both options to <code>zpool history</code> can be combined to give the most detailed information possible for any given pool. Pool history provides valuable information when tracking down the actions that were performed or when more detailed output is needed for debugging.</p></div></div><div class=sect3><h4 id=zfs-zpool-iostat>19.3.13. Performance Monitoring<a class=anchor href=#zfs-zpool-iostat></a></h4><div class=paragraph><p>A built-in monitoring system can display pool I/O statistics in real time. It shows the amount of free and used space on the pool, how many read and write operations are being performed per second, and how much I/O bandwidth is currently being utilized. By default, all pools in the system are monitored and displayed. A pool name can be provided to limit monitoring to just that pool. A basic example:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zpool iostat</span>
               capacity     operations    bandwidth
pool        alloc   free   <span class=nb>read  </span>write   <span class=nb>read  </span>write
<span class=nt>----------</span>  <span class=nt>-----</span>  <span class=nt>-----</span>  <span class=nt>-----</span>  <span class=nt>-----</span>  <span class=nt>-----</span>  <span class=nt>-----</span>
data         288G  1.53T      2     11  11.3K  57.1K</code></pre></div></div><div class=paragraph><p>To continuously monitor I/O activity, a number can be specified as the last parameter, indicating a interval in seconds to wait between updates. The next statistic line is printed after each interval. Press <span class=keyseq><kbd>Ctrl</kbd>+<kbd>C</kbd></span> to stop this continuous monitoring. Alternatively, give a second number on the command line after the interval to specify the total number of statistics to display.</p></div><div class=paragraph><p>Even more detailed I/O statistics can be displayed with <code>-v</code>. Each device in the pool is shown with a statistics line. This is useful in seeing how many read and write operations are being performed on each device, and can help determine if any individual device is slowing down the pool. This example shows a mirrored pool with two devices:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zpool iostat -v</span>
                            capacity     operations    bandwidth
pool                     alloc   free   <span class=nb>read  </span>write   <span class=nb>read  </span>write
<span class=nt>-----------------------</span>  <span class=nt>-----</span>  <span class=nt>-----</span>  <span class=nt>-----</span>  <span class=nt>-----</span>  <span class=nt>-----</span>  <span class=nt>-----</span>
data                      288G  1.53T      2     12  9.23K  61.5K
  mirror                  288G  1.53T      2     12  9.23K  61.5K
    ada1                     -      -      0      4  5.61K  61.7K
    ada2                     -      -      1      4  5.04K  61.7K
<span class=nt>-----------------------</span>  <span class=nt>-----</span>  <span class=nt>-----</span>  <span class=nt>-----</span>  <span class=nt>-----</span>  <span class=nt>-----</span>  <span class=nt>-----</span></code></pre></div></div></div><div class=sect3><h4 id=zfs-zpool-split>19.3.14. Splitting a Storage Pool<a class=anchor href=#zfs-zpool-split></a></h4><div class=paragraph><p>A pool consisting of one or more mirror vdevs can be split into two pools. Unless otherwise specified, the last member of each mirror is detached and used to create a new pool containing the same data. The operation should first be attempted with <code>-n</code>. The details of the proposed operation are displayed without it actually being performed. This helps confirm that the operation will do what the user intends.</p></div></div></div><div class=sect2><h3 id=zfs-zfs>19.4. <code>zfs</code> Administration<a class=anchor href=#zfs-zfs></a></h3><div class=paragraph><p>The <code>zfs</code> utility is responsible for creating, destroying, and managing all ZFS datasets that exist within a pool. The pool is managed using <a href=#zfs-zpool><code>zpool</code></a>.</p></div><div class=sect3><h4 id=zfs-zfs-create>19.4.1. Creating and Destroying Datasets<a class=anchor href=#zfs-zfs-create></a></h4><div class=paragraph><p>Unlike traditional disks and volume managers, space in ZFS is <em>not</em> preallocated. With traditional file systems, after all of the space is partitioned and assigned, there is no way to add an additional file system without adding a new disk. With ZFS, new file systems can be created at any time. Each <a href=#zfs-term-dataset><em>dataset</em></a> has properties including features like compression, deduplication, caching, and quotas, as well as other useful properties like readonly, case sensitivity, network file sharing, and a mount point. Datasets can be nested inside each other, and child datasets will inherit properties from their parents. Each dataset can be administered, <a href=#zfs-zfs-allow>delegated</a>, <a href=#zfs-zfs-send>replicated</a>, <a href=#zfs-zfs-snapshot>snapshotted</a>, <a href=#zfs-zfs-jail>jailed</a>, and destroyed as a unit. There are many advantages to creating a separate dataset for each different type or set of files. The only drawbacks to having an extremely large number of datasets is that some commands like <code>zfs list</code> will be slower, and the mounting of hundreds or even thousands of datasets can slow the FreeBSD boot process.</p></div><div class=paragraph><p>Create a new dataset and enable <a href=#zfs-term-compression-lz4>LZ4 compression</a> on it:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zfs list</span>
NAME                  USED  AVAIL  REFER  MOUNTPOINT
mypool                781M  93.2G   144K  none
mypool/ROOT           777M  93.2G   144K  none
mypool/ROOT/default   777M  93.2G   777M  /
mypool/tmp            176K  93.2G   176K  /tmp
mypool/usr            616K  93.2G   144K  /usr
mypool/usr/home       184K  93.2G   184K  /usr/home
mypool/usr/ports      144K  93.2G   144K  /usr/ports
mypool/usr/src        144K  93.2G   144K  /usr/src
mypool/var           1.20M  93.2G   608K  /var
mypool/var/crash      148K  93.2G   148K  /var/crash
mypool/var/log        178K  93.2G   178K  /var/log
mypool/var/mail       144K  93.2G   144K  /var/mail
mypool/var/tmp        152K  93.2G   152K  /var/tmp
<span class=c># zfs create -o compress=lz4 mypool/usr/mydataset</span>
<span class=c># zfs list</span>
NAME                   USED  AVAIL  REFER  MOUNTPOINT
mypool                 781M  93.2G   144K  none
mypool/ROOT            777M  93.2G   144K  none
mypool/ROOT/default    777M  93.2G   777M  /
mypool/tmp             176K  93.2G   176K  /tmp
mypool/usr             704K  93.2G   144K  /usr
mypool/usr/home        184K  93.2G   184K  /usr/home
mypool/usr/mydataset  87.5K  93.2G  87.5K  /usr/mydataset
mypool/usr/ports       144K  93.2G   144K  /usr/ports
mypool/usr/src         144K  93.2G   144K  /usr/src
mypool/var            1.20M  93.2G   610K  /var
mypool/var/crash       148K  93.2G   148K  /var/crash
mypool/var/log         178K  93.2G   178K  /var/log
mypool/var/mail        144K  93.2G   144K  /var/mail
mypool/var/tmp         152K  93.2G   152K  /var/tmp</code></pre></div></div><div class=paragraph><p>Destroying a dataset is much quicker than deleting all of the files that reside on the dataset, as it does not involve scanning all of the files and updating all of the corresponding metadata.</p></div><div class=paragraph><p>Destroy the previously-created dataset:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zfs list</span>
NAME                   USED  AVAIL  REFER  MOUNTPOINT
mypool                 880M  93.1G   144K  none
mypool/ROOT            777M  93.1G   144K  none
mypool/ROOT/default    777M  93.1G   777M  /
mypool/tmp             176K  93.1G   176K  /tmp
mypool/usr             101M  93.1G   144K  /usr
mypool/usr/home        184K  93.1G   184K  /usr/home
mypool/usr/mydataset   100M  93.1G   100M  /usr/mydataset
mypool/usr/ports       144K  93.1G   144K  /usr/ports
mypool/usr/src         144K  93.1G   144K  /usr/src
mypool/var            1.20M  93.1G   610K  /var
mypool/var/crash       148K  93.1G   148K  /var/crash
mypool/var/log         178K  93.1G   178K  /var/log
mypool/var/mail        144K  93.1G   144K  /var/mail
mypool/var/tmp         152K  93.1G   152K  /var/tmp
<span class=c># zfs destroy mypool/usr/mydataset</span>
<span class=c># zfs list</span>
NAME                  USED  AVAIL  REFER  MOUNTPOINT
mypool                781M  93.2G   144K  none
mypool/ROOT           777M  93.2G   144K  none
mypool/ROOT/default   777M  93.2G   777M  /
mypool/tmp            176K  93.2G   176K  /tmp
mypool/usr            616K  93.2G   144K  /usr
mypool/usr/home       184K  93.2G   184K  /usr/home
mypool/usr/ports      144K  93.2G   144K  /usr/ports
mypool/usr/src        144K  93.2G   144K  /usr/src
mypool/var           1.21M  93.2G   612K  /var
mypool/var/crash      148K  93.2G   148K  /var/crash
mypool/var/log        178K  93.2G   178K  /var/log
mypool/var/mail       144K  93.2G   144K  /var/mail
mypool/var/tmp        152K  93.2G   152K  /var/tmp</code></pre></div></div><div class=paragraph><p>In modern versions of ZFS, <code>zfs destroy</code> is asynchronous, and the free space might take several minutes to appear in the pool. Use <code>zpool get freeing <em>poolname</em></code> to see the <code>freeing</code> property, indicating how many datasets are having their blocks freed in the background. If there are child datasets, like <a href=#zfs-term-snapshot>snapshots</a> or other datasets, then the parent cannot be destroyed. To destroy a dataset and all of its children, use <code>-r</code> to recursively destroy the dataset and all of its children. Use <code>-n -v</code> to list datasets and snapshots that would be destroyed by this operation, but do not actually destroy anything. Space that would be reclaimed by destruction of snapshots is also shown.</p></div></div><div class=sect3><h4 id=zfs-zfs-volume>19.4.2. Creating and Destroying Volumes<a class=anchor href=#zfs-zfs-volume></a></h4><div class=paragraph><p>A volume is a special type of dataset. Rather than being mounted as a file system, it is exposed as a block device under <span class=filename>/dev/zvol/poolname/dataset</span>. This allows the volume to be used for other file systems, to back the disks of a virtual machine, or to be exported using protocols like iSCSI or HAST.</p></div><div class=paragraph><p>A volume can be formatted with any file system, or used without a file system to store raw data. To the user, a volume appears to be a regular disk. Putting ordinary file systems on these <em>zvols</em> provides features that ordinary disks or file systems do not normally have. For example, using the compression property on a 250 MB volume allows creation of a compressed FAT file system.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zfs create -V 250m -o compression=on tank/fat32</span>
<span class=c># zfs list tank</span>
NAME USED AVAIL REFER MOUNTPOINT
tank 258M  670M   31K /tank
<span class=c># newfs_msdos -F32 /dev/zvol/tank/fat32</span>
<span class=c># mount -t msdosfs /dev/zvol/tank/fat32 /mnt</span>
<span class=c># df -h /mnt | grep fat32</span>
Filesystem           Size Used Avail Capacity Mounted on
/dev/zvol/tank/fat32 249M  24k  249M     0%   /mnt
<span class=c># mount | grep fat32</span>
/dev/zvol/tank/fat32 on /mnt <span class=o>(</span>msdosfs, <span class=nb>local</span><span class=o>)</span></code></pre></div></div><div class=paragraph><p>Destroying a volume is much the same as destroying a regular file system dataset. The operation is nearly instantaneous, but it may take several minutes for the free space to be reclaimed in the background.</p></div></div><div class=sect3><h4 id=zfs-zfs-rename>19.4.3. Renaming a Dataset<a class=anchor href=#zfs-zfs-rename></a></h4><div class=paragraph><p>The name of a dataset can be changed with <code>zfs rename</code>. The parent of a dataset can also be changed with this command. Renaming a dataset to be under a different parent dataset will change the value of those properties that are inherited from the parent dataset. When a dataset is renamed, it is unmounted and then remounted in the new location (which is inherited from the new parent dataset). This behavior can be prevented with <code>-u</code>.</p></div><div class=paragraph><p>Rename a dataset and move it to be under a different parent dataset:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zfs list</span>
NAME                   USED  AVAIL  REFER  MOUNTPOINT
mypool                 780M  93.2G   144K  none
mypool/ROOT            777M  93.2G   144K  none
mypool/ROOT/default    777M  93.2G   777M  /
mypool/tmp             176K  93.2G   176K  /tmp
mypool/usr             704K  93.2G   144K  /usr
mypool/usr/home        184K  93.2G   184K  /usr/home
mypool/usr/mydataset  87.5K  93.2G  87.5K  /usr/mydataset
mypool/usr/ports       144K  93.2G   144K  /usr/ports
mypool/usr/src         144K  93.2G   144K  /usr/src
mypool/var            1.21M  93.2G   614K  /var
mypool/var/crash       148K  93.2G   148K  /var/crash
mypool/var/log         178K  93.2G   178K  /var/log
mypool/var/mail        144K  93.2G   144K  /var/mail
mypool/var/tmp         152K  93.2G   152K  /var/tmp
<span class=c># zfs rename mypool/usr/mydataset mypool/var/newname</span>
<span class=c># zfs list</span>
NAME                  USED  AVAIL  REFER  MOUNTPOINT
mypool                780M  93.2G   144K  none
mypool/ROOT           777M  93.2G   144K  none
mypool/ROOT/default   777M  93.2G   777M  /
mypool/tmp            176K  93.2G   176K  /tmp
mypool/usr            616K  93.2G   144K  /usr
mypool/usr/home       184K  93.2G   184K  /usr/home
mypool/usr/ports      144K  93.2G   144K  /usr/ports
mypool/usr/src        144K  93.2G   144K  /usr/src
mypool/var           1.29M  93.2G   614K  /var
mypool/var/crash      148K  93.2G   148K  /var/crash
mypool/var/log        178K  93.2G   178K  /var/log
mypool/var/mail       144K  93.2G   144K  /var/mail
mypool/var/newname   87.5K  93.2G  87.5K  /var/newname
mypool/var/tmp        152K  93.2G   152K  /var/tmp</code></pre></div></div><div class=paragraph><p>Snapshots can also be renamed like this. Due to the nature of snapshots, they cannot be renamed into a different parent dataset. To rename a recursive snapshot, specify <code>-r</code>, and all snapshots with the same name in child datasets with also be renamed.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zfs list -t snapshot</span>
NAME                                USED  AVAIL  REFER  MOUNTPOINT
mypool/var/newname@first_snapshot      0      -  87.5K  -
<span class=c># zfs rename mypool/var/newname@first_snapshot new_snapshot_name</span>
<span class=c># zfs list -t snapshot</span>
NAME                                   USED  AVAIL  REFER  MOUNTPOINT
mypool/var/newname@new_snapshot_name      0      -  87.5K  -</code></pre></div></div></div><div class=sect3><h4 id=zfs-zfs-set>19.4.4. Setting Dataset Properties<a class=anchor href=#zfs-zfs-set></a></h4><div class=paragraph><p>Each ZFS dataset has a number of properties that control its behavior. Most properties are automatically inherited from the parent dataset, but can be overridden locally. Set a property on a dataset with <code>zfs set <em>property=value dataset</em></code>. Most properties have a limited set of valid values, <code>zfs get</code> will display each possible property and valid values. Most properties can be reverted to their inherited values using <code>zfs inherit</code>.</p></div><div class=paragraph><p>User-defined properties can also be set. They become part of the dataset configuration and can be used to provide additional information about the dataset or its contents. To distinguish these custom properties from the ones supplied as part of ZFS, a colon (<code>:</code>) is used to create a custom namespace for the property.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zfs set custom:costcenter=1234 tank</span>
<span class=c># zfs get custom:costcenter tank</span>
NAME PROPERTY           VALUE SOURCE
tank custom:costcenter  1234  <span class=nb>local</span></code></pre></div></div><div class=paragraph><p>To remove a custom property, use <code>zfs inherit</code> with <code>-r</code>. If the custom property is not defined in any of the parent datasets, it will be removed completely (although the changes are still recorded in the pool’s history).</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zfs inherit -r custom:costcenter tank</span>
<span class=c># zfs get custom:costcenter tank</span>
NAME    PROPERTY           VALUE              SOURCE
tank    custom:costcenter  -                  -
<span class=c># zfs get all tank | grep custom:costcenter</span>
<span class=c>#</span></code></pre></div></div><div class=sect4><h5 id=zfs-zfs-set-share>19.4.4.1. Getting and Setting Share Properties<a class=anchor href=#zfs-zfs-set-share></a></h5><div class=paragraph><p>Two commonly used and useful dataset properties are the NFS and SMB share options. Setting these define if and how ZFS datasets may be shared on the network. At present, only setting sharing via NFS is supported on FreeBSD. To get the current status of a share, enter:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zfs get sharenfs mypool/usr/home</span>
NAME             PROPERTY  VALUE    SOURCE
mypool/usr/home  sharenfs  on       <span class=nb>local</span>
<span class=c># zfs get sharesmb mypool/usr/home</span>
NAME             PROPERTY  VALUE    SOURCE
mypool/usr/home  sharesmb  off      <span class=nb>local</span></code></pre></div></div><div class=paragraph><p>To enable sharing of a dataset, enter:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c>#  zfs set sharenfs=on mypool/usr/home</span></code></pre></div></div><div class=paragraph><p>It is also possible to set additional options for sharing datasets through NFS, such as <code>-alldirs</code>, <code>-maproot</code> and <code>-network</code>. To set additional options to a dataset shared through NFS, enter:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c>#  zfs set sharenfs=&#34;-alldirs,-maproot=root,-network=192.168.1.0/24&#34; mypool/usr/home</span></code></pre></div></div></div></div><div class=sect3><h4 id=zfs-zfs-snapshot>19.4.5. Managing Snapshots<a class=anchor href=#zfs-zfs-snapshot></a></h4><div class=paragraph><p><a href=#zfs-term-snapshot>Snapshots</a> are one of the most powerful features of ZFS. A snapshot provides a read-only, point-in-time copy of the dataset. With Copy-On-Write (COW), snapshots can be created quickly by preserving the older version of the data on disk. If no snapshots exist, space is reclaimed for future use when data is rewritten or deleted. Snapshots preserve disk space by recording only the differences between the current dataset and a previous version. Snapshots are allowed only on whole datasets, not on individual files or directories. When a snapshot is created from a dataset, everything contained in it is duplicated. This includes the file system properties, files, directories, permissions, and so on. Snapshots use no additional space when they are first created, only consuming space as the blocks they reference are changed. Recursive snapshots taken with <code>-r</code> create a snapshot with the same name on the dataset and all of its children, providing a consistent moment-in-time snapshot of all of the file systems. This can be important when an application has files on multiple datasets that are related or dependent upon each other. Without snapshots, a backup would have copies of the files from different points in time.</p></div><div class=paragraph><p>Snapshots in ZFS provide a variety of features that even other file systems with snapshot functionality lack. A typical example of snapshot use is to have a quick way of backing up the current state of the file system when a risky action like a software installation or a system upgrade is performed. If the action fails, the snapshot can be rolled back and the system has the same state as when the snapshot was created. If the upgrade was successful, the snapshot can be deleted to free up space. Without snapshots, a failed upgrade often requires a restore from backup, which is tedious, time consuming, and may require downtime during which the system cannot be used. Snapshots can be rolled back quickly, even while the system is running in normal operation, with little or no downtime. The time savings are enormous with multi-terabyte storage systems and the time required to copy the data from backup. Snapshots are not a replacement for a complete backup of a pool, but can be used as a quick and easy way to store a copy of the dataset at a specific point in time.</p></div><div class=sect4><h5 id=zfs-zfs-snapshot-creation>19.4.5.1. Creating Snapshots<a class=anchor href=#zfs-zfs-snapshot-creation></a></h5><div class=paragraph><p>Snapshots are created with <code>zfs snapshot <em>dataset</em>@<em>snapshotname</em></code>. Adding <code>-r</code> creates a snapshot recursively, with the same name on all child datasets.</p></div><div class=paragraph><p>Create a recursive snapshot of the entire pool:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zfs list -t all</span>
NAME                                   USED  AVAIL  REFER  MOUNTPOINT
mypool                                 780M  93.2G   144K  none
mypool/ROOT                            777M  93.2G   144K  none
mypool/ROOT/default                    777M  93.2G   777M  /
mypool/tmp                             176K  93.2G   176K  /tmp
mypool/usr                             616K  93.2G   144K  /usr
mypool/usr/home                        184K  93.2G   184K  /usr/home
mypool/usr/ports                       144K  93.2G   144K  /usr/ports
mypool/usr/src                         144K  93.2G   144K  /usr/src
mypool/var                            1.29M  93.2G   616K  /var
mypool/var/crash                       148K  93.2G   148K  /var/crash
mypool/var/log                         178K  93.2G   178K  /var/log
mypool/var/mail                        144K  93.2G   144K  /var/mail
mypool/var/newname                    87.5K  93.2G  87.5K  /var/newname
mypool/var/newname@new_snapshot_name      0      -  87.5K  -
mypool/var/tmp                         152K  93.2G   152K  /var/tmp
<span class=c># zfs snapshot -r mypool@my_recursive_snapshot</span>
<span class=c># zfs list -t snapshot</span>
NAME                                        USED  AVAIL  REFER  MOUNTPOINT
mypool@my_recursive_snapshot                   0      -   144K  -
mypool/ROOT@my_recursive_snapshot              0      -   144K  -
mypool/ROOT/default@my_recursive_snapshot      0      -   777M  -
mypool/tmp@my_recursive_snapshot               0      -   176K  -
mypool/usr@my_recursive_snapshot               0      -   144K  -
mypool/usr/home@my_recursive_snapshot          0      -   184K  -
mypool/usr/ports@my_recursive_snapshot         0      -   144K  -
mypool/usr/src@my_recursive_snapshot           0      -   144K  -
mypool/var@my_recursive_snapshot               0      -   616K  -
mypool/var/crash@my_recursive_snapshot         0      -   148K  -
mypool/var/log@my_recursive_snapshot           0      -   178K  -
mypool/var/mail@my_recursive_snapshot          0      -   144K  -
mypool/var/newname@new_snapshot_name           0      -  87.5K  -
mypool/var/newname@my_recursive_snapshot       0      -  87.5K  -
mypool/var/tmp@my_recursive_snapshot           0      -   152K  -</code></pre></div></div><div class=paragraph><p>Snapshots are not shown by a normal <code>zfs list</code> operation. To list snapshots, <code>-t snapshot</code> is appended to <code>zfs list</code>. <code>-t all</code> displays both file systems and snapshots.</p></div><div class=paragraph><p>Snapshots are not mounted directly, so no path is shown in the <code>MOUNTPOINT</code> column. There is no mention of available disk space in the <code>AVAIL</code> column, as snapshots cannot be written to after they are created. Compare the snapshot to the original dataset from which it was created:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zfs list -rt all mypool/usr/home</span>
NAME                                    USED  AVAIL  REFER  MOUNTPOINT
mypool/usr/home                         184K  93.2G   184K  /usr/home
mypool/usr/home@my_recursive_snapshot      0      -   184K  -</code></pre></div></div><div class=paragraph><p>Displaying both the dataset and the snapshot together reveals how snapshots work in <a href=#zfs-term-cow>COW</a> fashion. They save only the changes (<em>delta</em>) that were made and not the complete file system contents all over again. This means that snapshots take little space when few changes are made. Space usage can be made even more apparent by copying a file to the dataset, then making a second snapshot:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cp /etc/passwd /var/tmp</span>
<span class=c># zfs snapshot mypool/var/tmp@after_cp</span>
<span class=c># zfs list -rt all mypool/var/tmp</span>
NAME                                   USED  AVAIL  REFER  MOUNTPOINT
mypool/var/tmp                         206K  93.2G   118K  /var/tmp
mypool/var/tmp@my_recursive_snapshot    88K      -   152K  -
mypool/var/tmp@after_cp                   0      -   118K  -</code></pre></div></div><div class=paragraph><p>The second snapshot contains only the changes to the dataset after the copy operation. This yields enormous space savings. Notice that the size of the snapshot <code><em>mypool/var/tmp@my_recursive_snapshot</em></code> also changed in the <code>USED</code> column to indicate the changes between itself and the snapshot taken afterwards.</p></div></div><div class=sect4><h5 id=zfs-zfs-snapshot-diff>19.4.5.2. Comparing Snapshots<a class=anchor href=#zfs-zfs-snapshot-diff></a></h5><div class=paragraph><p>ZFS provides a built-in command to compare the differences in content between two snapshots. This is helpful when many snapshots were taken over time and the user wants to see how the file system has changed over time. For example, <code>zfs diff</code> lets a user find the latest snapshot that still contains a file that was accidentally deleted. Doing this for the two snapshots that were created in the previous section yields this output:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zfs list -rt all mypool/var/tmp</span>
NAME                                   USED  AVAIL  REFER  MOUNTPOINT
mypool/var/tmp                         206K  93.2G   118K  /var/tmp
mypool/var/tmp@my_recursive_snapshot    88K      -   152K  -
mypool/var/tmp@after_cp                   0      -   118K  -
<span class=c># zfs diff mypool/var/tmp@my_recursive_snapshot</span>
M       /var/tmp/
+       /var/tmp/passwd</code></pre></div></div><div class=paragraph><p>The command lists the changes between the specified snapshot (in this case <code><em>mypool/var/tmp@my_recursive_snapshot</em></code>) and the live file system. The first column shows the type of change:</p></div><table class="tableblock frame-all grid-all stretch informaltable"><col style=width:20%><col style=width:80%><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock>+</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>The path or file was added.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>-</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>The path or file was deleted.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>M</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>The path or file was modified.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>R</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>The path or file was renamed.</p></td></tr></tbody></table><div class=paragraph><p>Comparing the output with the table, it becomes clear that <span class=filename>passwd</span> was added after the snapshot <code><em>mypool/var/tmp@my_recursive_snapshot</em></code> was created. This also resulted in a modification to the parent directory mounted at <code><em>/var/tmp</em></code>.</p></div><div class=paragraph><p>Comparing two snapshots is helpful when using the ZFS replication feature to transfer a dataset to a different host for backup purposes.</p></div><div class=paragraph><p>Compare two snapshots by providing the full dataset name and snapshot name of both datasets:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cp /var/tmp/passwd /var/tmp/passwd.copy</span>
<span class=c># zfs snapshot mypool/var/tmp@diff_snapshot</span>
<span class=c># zfs diff mypool/var/tmp@my_recursive_snapshot mypool/var/tmp@diff_snapshot</span>
M       /var/tmp/
+       /var/tmp/passwd
+       /var/tmp/passwd.copy
<span class=c># zfs diff mypool/var/tmp@my_recursive_snapshot mypool/var/tmp@after_cp</span>
M       /var/tmp/
+       /var/tmp/passwd</code></pre></div></div><div class=paragraph><p>A backup administrator can compare two snapshots received from the sending host and determine the actual changes in the dataset. See the <a href=#zfs-zfs-send>Replication</a> section for more information.</p></div></div><div class=sect4><h5 id=zfs-zfs-snapshot-rollback>19.4.5.3. Snapshot Rollback<a class=anchor href=#zfs-zfs-snapshot-rollback></a></h5><div class=paragraph><p>When at least one snapshot is available, it can be rolled back to at any time. Most of the time this is the case when the current state of the dataset is no longer required and an older version is preferred. Scenarios such as local development tests have gone wrong, botched system updates hampering the system’s overall functionality, or the requirement to restore accidentally deleted files or directories are all too common occurrences. Luckily, rolling back a snapshot is just as easy as typing <code>zfs rollback <em>snapshotname</em></code>. Depending on how many changes are involved, the operation will finish in a certain amount of time. During that time, the dataset always remains in a consistent state, much like a database that conforms to ACID principles is performing a rollback. This is happening while the dataset is live and accessible without requiring a downtime. Once the snapshot has been rolled back, the dataset has the same state as it had when the snapshot was originally taken. All other data in that dataset that was not part of the snapshot is discarded. Taking a snapshot of the current state of the dataset before rolling back to a previous one is a good idea when some data is required later. This way, the user can roll back and forth between snapshots without losing data that is still valuable.</p></div><div class=paragraph><p>In the first example, a snapshot is rolled back because of a careless <code>rm</code> operation that removes too much data than was intended.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zfs list -rt all mypool/var/tmp</span>
NAME                                   USED  AVAIL  REFER  MOUNTPOINT
mypool/var/tmp                         262K  93.2G   120K  /var/tmp
mypool/var/tmp@my_recursive_snapshot    88K      -   152K  -
mypool/var/tmp@after_cp               53.5K      -   118K  -
mypool/var/tmp@diff_snapshot              0      -   120K  -
<span class=c># ls /var/tmp</span>
passwd          passwd.copy     vi.recover
<span class=c># rm /var/tmp/passwd*</span>
<span class=c># ls /var/tmp</span>
vi.recover</code></pre></div></div><div class=paragraph><p>At this point, the user realized that too many files were deleted and wants them back. ZFS provides an easy way to get them back using rollbacks, but only when snapshots of important data are performed on a regular basis. To get the files back and start over from the last snapshot, issue the command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zfs rollback mypool/var/tmp@diff_snapshot</span>
<span class=c># ls /var/tmp</span>
passwd          passwd.copy     vi.recover</code></pre></div></div><div class=paragraph><p>The rollback operation restored the dataset to the state of the last snapshot. It is also possible to roll back to a snapshot that was taken much earlier and has other snapshots that were created after it. When trying to do this, ZFS will issue this warning:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zfs list -rt snapshot mypool/var/tmp</span>
AME                                   USED  AVAIL  REFER  MOUNTPOINT
mypool/var/tmp@my_recursive_snapshot    88K      -   152K  -
mypool/var/tmp@after_cp               53.5K      -   118K  -
mypool/var/tmp@diff_snapshot              0      -   120K  -
<span class=c># zfs rollback mypool/var/tmp@my_recursive_snapshot</span>
cannot rollback to <span class=s1>&#39;mypool/var/tmp@my_recursive_snapshot&#39;</span>: more recent snapshots exist
use <span class=s1>&#39;-r&#39;</span> to force deletion of the following snapshots:
mypool/var/tmp@after_cp
mypool/var/tmp@diff_snapshot</code></pre></div></div><div class=paragraph><p>This warning means that snapshots exist between the current state of the dataset and the snapshot to which the user wants to roll back. To complete the rollback, these snapshots must be deleted. ZFS cannot track all the changes between different states of the dataset, because snapshots are read-only. ZFS will not delete the affected snapshots unless the user specifies <code>-r</code> to indicate that this is the desired action. If that is the intention, and the consequences of losing all intermediate snapshots is understood, the command can be issued:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zfs rollback -r mypool/var/tmp@my_recursive_snapshot</span>
<span class=c># zfs list -rt snapshot mypool/var/tmp</span>
NAME                                   USED  AVAIL  REFER  MOUNTPOINT
mypool/var/tmp@my_recursive_snapshot     8K      -   152K  -
<span class=c># ls /var/tmp</span>
vi.recover</code></pre></div></div><div class=paragraph><p>The output from <code>zfs list -t snapshot</code> confirms that the intermediate snapshots were removed as a result of <code>zfs rollback -r</code>.</p></div></div><div class=sect4><h5 id=zfs-zfs-snapshot-snapdir>19.4.5.4. Restoring Individual Files from Snapshots<a class=anchor href=#zfs-zfs-snapshot-snapdir></a></h5><div class=paragraph><p>Snapshots are mounted in a hidden directory under the parent dataset: <span class=filename>.zfs/snapshots/snapshotname</span>. By default, these directories will not be displayed even when a standard <code>ls -a</code> is issued. Although the directory is not displayed, it is there nevertheless and can be accessed like any normal directory. The property named <code>snapdir</code> controls whether these hidden directories show up in a directory listing. Setting the property to <code>visible</code> allows them to appear in the output of <code>ls</code> and other commands that deal with directory contents.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zfs get snapdir mypool/var/tmp</span>
NAME            PROPERTY  VALUE    SOURCE
mypool/var/tmp  snapdir   hidden   default
<span class=c># ls -a /var/tmp</span>
<span class=nb>.</span>               ..              passwd          vi.recover
<span class=c># zfs set snapdir=visible mypool/var/tmp</span>
<span class=c># ls -a /var/tmp</span>
<span class=nb>.</span>               ..              .zfs            passwd          vi.recover</code></pre></div></div><div class=paragraph><p>Individual files can easily be restored to a previous state by copying them from the snapshot back to the parent dataset. The directory structure below <span class=filename>.zfs/snapshot</span> has a directory named exactly like the snapshots taken earlier to make it easier to identify them. In the next example, it is assumed that a file is to be restored from the hidden <span class=filename>.zfs</span> directory by copying it from the snapshot that contained the latest version of the file:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># rm /var/tmp/passwd</span>
<span class=c># ls -a /var/tmp</span>
<span class=nb>.</span>               ..              .zfs            vi.recover
<span class=c># ls /var/tmp/.zfs/snapshot</span>
after_cp                my_recursive_snapshot
<span class=c># ls /var/tmp/.zfs/snapshot/after_cp</span>
passwd          vi.recover
<span class=c># cp /var/tmp/.zfs/snapshot/after_cp/passwd /var/tmp</span></code></pre></div></div><div class=paragraph><p>When <code>ls .zfs/snapshot</code> was issued, the <code>snapdir</code> property might have been set to hidden, but it would still be possible to list the contents of that directory. It is up to the administrator to decide whether these directories will be displayed. It is possible to display these for certain datasets and prevent it for others. Copying files or directories from this hidden <span class=filename>.zfs/snapshot</span> is simple enough. Trying it the other way around results in this error:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cp /etc/rc.conf /var/tmp/.zfs/snapshot/after_cp/</span>
<span class=nb>cp</span>: /var/tmp/.zfs/snapshot/after_cp/rc.conf: Read-only file system</code></pre></div></div><div class=paragraph><p>The error reminds the user that snapshots are read-only and cannot be changed after creation. Files cannot be copied into or removed from snapshot directories because that would change the state of the dataset they represent.</p></div><div class=paragraph><p>Snapshots consume space based on how much the parent file system has changed since the time of the snapshot. The <code>written</code> property of a snapshot tracks how much space is being used by the snapshot.</p></div><div class=paragraph><p>Snapshots are destroyed and the space reclaimed with <code>zfs destroy <em>dataset</em>@<em>snapshot</em></code>. Adding <code>-r</code> recursively removes all snapshots with the same name under the parent dataset. Adding <code>-n -v</code> to the command displays a list of the snapshots that would be deleted and an estimate of how much space would be reclaimed without performing the actual destroy operation.</p></div></div></div><div class=sect3><h4 id=zfs-zfs-clones>19.4.6. Managing Clones<a class=anchor href=#zfs-zfs-clones></a></h4><div class=paragraph><p>A clone is a copy of a snapshot that is treated more like a regular dataset. Unlike a snapshot, a clone is not read only, is mounted, and can have its own properties. Once a clone has been created using <code>zfs clone</code>, the snapshot it was created from cannot be destroyed. The child/parent relationship between the clone and the snapshot can be reversed using <code>zfs promote</code>. After a clone has been promoted, the snapshot becomes a child of the clone, rather than of the original parent dataset. This will change how the space is accounted, but not actually change the amount of space consumed. The clone can be mounted at any point within the ZFS file system hierarchy, not just below the original location of the snapshot.</p></div><div class=paragraph><p>To demonstrate the clone feature, this example dataset is used:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zfs list -rt all camino/home/joe</span>
NAME                    USED  AVAIL  REFER  MOUNTPOINT
camino/home/joe         108K   1.3G    87K  /usr/home/joe
camino/home/joe@plans    21K      -  85.5K  -
camino/home/joe@backup    0K      -    87K  -</code></pre></div></div><div class=paragraph><p>A typical use for clones is to experiment with a specific dataset while keeping the snapshot around to fall back to in case something goes wrong. Since snapshots cannot be changed, a read/write clone of a snapshot is created. After the desired result is achieved in the clone, the clone can be promoted to a dataset and the old file system removed. This is not strictly necessary, as the clone and dataset can coexist without problems.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zfs clone camino/home/joe@backup camino/home/joenew</span>
<span class=c># ls /usr/home/joe*</span>
/usr/home/joe:
backup.txz     plans.txt

/usr/home/joenew:
backup.txz     plans.txt
<span class=c># df -h /usr/home</span>
Filesystem          Size    Used   Avail Capacity  Mounted on
usr/home/joe        1.3G     31k    1.3G     0%    /usr/home/joe
usr/home/joenew     1.3G     31k    1.3G     0%    /usr/home/joenew</code></pre></div></div><div class=paragraph><p>After a clone is created it is an exact copy of the state the dataset was in when the snapshot was taken. The clone can now be changed independently from its originating dataset. The only connection between the two is the snapshot. ZFS records this connection in the property <code>origin</code>. Once the dependency between the snapshot and the clone has been removed by promoting the clone using <code>zfs promote</code>, the <code>origin</code> of the clone is removed as it is now an independent dataset. This example demonstrates it:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zfs get origin camino/home/joenew</span>
NAME                  PROPERTY  VALUE                     SOURCE
camino/home/joenew    origin    camino/home/joe@backup    -
<span class=c># zfs promote camino/home/joenew</span>
<span class=c># zfs get origin camino/home/joenew</span>
NAME                  PROPERTY  VALUE   SOURCE
camino/home/joenew    origin    -       -</code></pre></div></div><div class=paragraph><p>After making some changes like copying <span class=filename>loader.conf</span> to the promoted clone, for example, the old directory becomes obsolete in this case. Instead, the promoted clone can replace it. This can be achieved by two consecutive commands: <code>zfs destroy</code> on the old dataset and <code>zfs rename</code> on the clone to name it like the old dataset (it could also get an entirely different name).</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cp /boot/defaults/loader.conf /usr/home/joenew</span>
<span class=c># zfs destroy -f camino/home/joe</span>
<span class=c># zfs rename camino/home/joenew camino/home/joe</span>
<span class=c># ls /usr/home/joe</span>
backup.txz     loader.conf     plans.txt
<span class=c># df -h /usr/home</span>
Filesystem          Size    Used   Avail Capacity  Mounted on
usr/home/joe        1.3G    128k    1.3G     0%    /usr/home/joe</code></pre></div></div><div class=paragraph><p>The cloned snapshot is now handled like an ordinary dataset. It contains all the data from the original snapshot plus the files that were added to it like <span class=filename>loader.conf</span>. Clones can be used in different scenarios to provide useful features to ZFS users. For example, jails could be provided as snapshots containing different sets of installed applications. Users can clone these snapshots and add their own applications as they see fit. Once they are satisfied with the changes, the clones can be promoted to full datasets and provided to end users to work with like they would with a real dataset. This saves time and administrative overhead when providing these jails.</p></div></div><div class=sect3><h4 id=zfs-zfs-send>19.4.7. Replication<a class=anchor href=#zfs-zfs-send></a></h4><div class=paragraph><p>Keeping data on a single pool in one location exposes it to risks like theft and natural or human disasters. Making regular backups of the entire pool is vital. ZFS provides a built-in serialization feature that can send a stream representation of the data to standard output. Using this technique, it is possible to not only store the data on another pool connected to the local system, but also to send it over a network to another system. Snapshots are the basis for this replication (see the section on <a href=#zfs-zfs-snapshot>ZFS snapshots</a>). The commands used for replicating data are <code>zfs send</code> and <code>zfs receive</code>.</p></div><div class=paragraph><p>These examples demonstrate ZFS replication with these two pools:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zpool list</span>
NAME    SIZE  ALLOC   FREE   CKPOINT  EXPANDSZ   FRAG   CAP  DEDUP  HEALTH  ALTROOT
backup  960M    77K   896M         -         -     0%    0%  1.00x  ONLINE  -
mypool  984M  43.7M   940M         -         -     0%    4%  1.00x  ONLINE  -</code></pre></div></div><div class=paragraph><p>The pool named <em>mypool</em> is the primary pool where data is written to and read from on a regular basis. A second pool, <em>backup</em> is used as a standby in case the primary pool becomes unavailable. Note that this fail-over is not done automatically by ZFS, but must be manually done by a system administrator when needed. A snapshot is used to provide a consistent version of the file system to be replicated. Once a snapshot of <em>mypool</em> has been created, it can be copied to the <em>backup</em> pool. Only snapshots can be replicated. Changes made since the most recent snapshot will not be included.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zfs snapshot mypool@backup1</span>
<span class=c># zfs list -t snapshot</span>
NAME                    USED  AVAIL  REFER  MOUNTPOINT
mypool@backup1             0      -  43.6M  -</code></pre></div></div><div class=paragraph><p>Now that a snapshot exists, <code>zfs send</code> can be used to create a stream representing the contents of the snapshot. This stream can be stored as a file or received by another pool. The stream is written to standard output, but must be redirected to a file or pipe or an error is produced:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zfs send mypool@backup1</span>
Error: Stream can not be written to a terminal.
You must redirect standard output.</code></pre></div></div><div class=paragraph><p>To back up a dataset with <code>zfs send</code>, redirect to a file located on the mounted backup pool. Ensure that the pool has enough free space to accommodate the size of the snapshot being sent, which means all of the data contained in the snapshot, not just the changes from the previous snapshot.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zfs send mypool@backup1 &gt; /backup/backup1</span>
<span class=c># zpool list</span>
NAME    SIZE  ALLOC   FREE   CKPOINT  EXPANDSZ   FRAG    CAP  DEDUP  HEALTH  ALTROOT
backup  960M  63.7M   896M         -         -     0%     6%  1.00x  ONLINE  -
mypool  984M  43.7M   940M         -         -     0%     4%  1.00x  ONLINE  -</code></pre></div></div><div class=paragraph><p>The <code>zfs send</code> transferred all the data in the snapshot called <em>backup1</em> to the pool named <em>backup</em>. Creating and sending these snapshots can be done automatically with a <a href="https://man.freebsd.org/cgi/man.cgi?query=cron&amp;sektion=8&amp;format=html">cron(8)</a> job.</p></div><div class=paragraph><p>Instead of storing the backups as archive files, ZFS can receive them as a live file system, allowing the backed up data to be accessed directly. To get to the actual data contained in those streams, <code>zfs receive</code> is used to transform the streams back into files and directories. The example below combines <code>zfs send</code> and <code>zfs receive</code> using a pipe to copy the data from one pool to another. The data can be used directly on the receiving pool after the transfer is complete. A dataset can only be replicated to an empty dataset.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zfs snapshot mypool@replica1</span>
<span class=c># zfs send -v mypool@replica1 | zfs receive backup/mypool</span>
send from @ to mypool@replica1 estimated size is 50.1M
total estimated size is 50.1M
TIME        SENT   SNAPSHOT

<span class=c># zpool list</span>
NAME    SIZE  ALLOC   FREE   CKPOINT  EXPANDSZ   FRAG    CAP  DEDUP  HEALTH  ALTROOT
backup  960M  63.7M   896M         -         -     0%     6%  1.00x  ONLINE  -
mypool  984M  43.7M   940M         -         -     0%     4%  1.00x  ONLINE  -</code></pre></div></div><div class=sect4><h5 id=zfs-send-incremental>19.4.7.1. Incremental Backups<a class=anchor href=#zfs-send-incremental></a></h5><div class=paragraph><p><code>zfs send</code> can also determine the difference between two snapshots and send only the differences between the two. This saves disk space and transfer time. For example:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zfs snapshot mypool@replica2</span>
<span class=c># zfs list -t snapshot</span>
NAME                    USED  AVAIL  REFER  MOUNTPOINT
mypool@replica1         5.72M      -  43.6M  -
mypool@replica2             0      -  44.1M  -
<span class=c># zpool list</span>
NAME    SIZE  ALLOC   FREE   CKPOINT  EXPANDSZ   FRAG   CAP  DEDUP  HEALTH  ALTROOT
backup  960M  61.7M   898M         -         -     0%    6%  1.00x  ONLINE  -
mypool  960M  50.2M   910M         -         -     0%    5%  1.00x  ONLINE  -</code></pre></div></div><div class=paragraph><p>A second snapshot called <em>replica2</em> was created. This second snapshot contains only the changes that were made to the file system between now and the previous snapshot, <em>replica1</em>. Using <code>zfs send -i</code> and indicating the pair of snapshots generates an incremental replica stream containing only the data that has changed. This can only succeed if the initial snapshot already exists on the receiving side.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zfs send -v -i mypool@replica1 mypool@replica2 | zfs receive /backup/mypool</span>
send from @replica1 to mypool@replica2 estimated size is 5.02M
total estimated size is 5.02M
TIME        SENT   SNAPSHOT

<span class=c># zpool list</span>
NAME    SIZE  ALLOC   FREE   CKPOINT  EXPANDSZ   FRAG  CAP  DEDUP  HEALTH  ALTROOT
backup  960M  80.8M   879M         -         -     0%   8%  1.00x  ONLINE  -
mypool  960M  50.2M   910M         -         -     0%   5%  1.00x  ONLINE  -

<span class=c># zfs list</span>
NAME                         USED  AVAIL  REFER  MOUNTPOINT
backup                      55.4M   240G   152K  /backup
backup/mypool               55.3M   240G  55.2M  /backup/mypool
mypool                      55.6M  11.6G  55.0M  /mypool

<span class=c># zfs list -t snapshot</span>
NAME                                         USED  AVAIL  REFER  MOUNTPOINT
backup/mypool@replica1                       104K      -  50.2M  -
backup/mypool@replica2                          0      -  55.2M  -
mypool@replica1                             29.9K      -  50.0M  -
mypool@replica2                                 0      -  55.0M  -</code></pre></div></div><div class=paragraph><p>The incremental stream was successfully transferred. Only the data that had changed was replicated, rather than the entirety of <em>replica1</em>. Only the differences were sent, which took much less time to transfer and saved disk space by not copying the complete pool each time. This is useful when having to rely on slow networks or when costs per transferred byte must be considered.</p></div><div class=paragraph><p>A new file system, <em>backup/mypool</em>, is available with all of the files and data from the pool <em>mypool</em>. If <code>-P</code> is specified, the properties of the dataset will be copied, including compression settings, quotas, and mount points. When <code>-R</code> is specified, all child datasets of the indicated dataset will be copied, along with all of their properties. Sending and receiving can be automated so that regular backups are created on the second pool.</p></div></div><div class=sect4><h5 id=zfs-send-ssh>19.4.7.2. Sending Encrypted Backups over SSH<a class=anchor href=#zfs-send-ssh></a></h5><div class=paragraph><p>Sending streams over the network is a good way to keep a remote backup, but it does come with a drawback. Data sent over the network link is not encrypted, allowing anyone to intercept and transform the streams back into data without the knowledge of the sending user. This is undesirable, especially when sending the streams over the internet to a remote host. SSH can be used to securely encrypt data send over a network connection. Since ZFS only requires the stream to be redirected from standard output, it is relatively easy to pipe it through SSH. To keep the contents of the file system encrypted in transit and on the remote system, consider using <a href=https://wiki.freebsd.org/PEFS>PEFS</a>.</p></div><div class=paragraph><p>A few settings and security precautions must be completed first. Only the necessary steps required for the <code>zfs send</code> operation are shown here. For more information on SSH, see <a href=./#openssh>OpenSSH</a>.</p></div><div class=paragraph><p>This configuration is required:</p></div><div class=ulist><ul><li><p>Passwordless SSH access between sending and receiving host using SSH keys</p></li><li><p>Normally, the privileges of the <code>root</code> user are needed to send and receive streams. This requires logging in to the receiving system as <code>root</code>. However, logging in as <code>root</code> is disabled by default for security reasons. The <a href=#zfs-zfs-allow>ZFS Delegation</a> system can be used to allow a non-<code>root</code> user on each system to perform the respective send and receive operations.</p></li><li><p>On the sending system:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zfs allow -u someuser send,snapshot mypool</span></code></pre></div></div></li><li><p>To mount the pool, the unprivileged user must own the directory, and regular users must be allowed to mount file systems. On the receiving system:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sysctl vfs.usermount=1</span>
vfs.usermount: 0 -&gt; 1
<span class=c># echo vfs.usermount=1 &gt;&gt; /etc/sysctl.conf</span>
<span class=c># zfs create recvpool/backup</span>
<span class=c># zfs allow -u someuser create,mount,receive recvpool/backup</span>
<span class=c># chown someuser /recvpool/backup</span></code></pre></div></div></li></ul></div><div class=paragraph><p>The unprivileged user now has the ability to receive and mount datasets, and the <em>home</em> dataset can be replicated to the remote system:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% zfs snapshot <span class=nt>-r</span> mypool/home@monday
% zfs send <span class=nt>-R</span> mypool/home@monday | ssh someuser@backuphost zfs recv <span class=nt>-dvu</span> recvpool/backup</code></pre></div></div><div class=paragraph><p>A recursive snapshot called <em>monday</em> is made of the file system dataset <em>home</em> that resides on the pool <em>mypool</em>. Then it is sent with <code>zfs send -R</code> to include the dataset, all child datasets, snapshots, clones, and settings in the stream. The output is piped to the waiting <code>zfs receive</code> on the remote host <em>backuphost</em> through SSH. Using a fully qualified domain name or IP address is recommended. The receiving machine writes the data to the <em>backup</em> dataset on the <em>recvpool</em> pool. Adding <code>-d</code> to <code>zfs recv</code> overwrites the name of the pool on the receiving side with the name of the snapshot. <code>-u</code> causes the file systems to not be mounted on the receiving side. When <code>-v</code> is included, more detail about the transfer is shown, including elapsed time and the amount of data transferred.</p></div></div></div><div class=sect3><h4 id=zfs-zfs-quota>19.4.8. Dataset, User, and Group Quotas<a class=anchor href=#zfs-zfs-quota></a></h4><div class=paragraph><p><a href=#zfs-term-quota>Dataset quotas</a> are used to restrict the amount of space that can be consumed by a particular dataset. <a href=#zfs-term-refquota>Reference Quotas</a> work in very much the same way, but only count the space used by the dataset itself, excluding snapshots and child datasets. Similarly, <a href=#zfs-term-userquota>user</a> and <a href=#zfs-term-groupquota>group</a> quotas can be used to prevent users or groups from using all of the space in the pool or dataset.</p></div><div class=paragraph><p>The following examples assume that the users already exist in the system. Before adding a user to the system, make sure to create their home dataset first and set the <code>mountpoint</code> to <code>/home/<em>bob</em></code>. Then, create the user and make the home directory point to the dataset’s <code>mountpoint</code> location. This will properly set owner and group permissions without shadowing any pre-existing home directory paths that might exist.</p></div><div class=paragraph><p>To enforce a dataset quota of 10 GB for <span class=filename>storage/home/bob</span>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zfs set quota=10G storage/home/bob</span></code></pre></div></div><div class=paragraph><p>To enforce a reference quota of 10 GB for <span class=filename>storage/home/bob</span>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zfs set refquota=10G storage/home/bob</span></code></pre></div></div><div class=paragraph><p>To remove a quota of 10 GB for <span class=filename>storage/home/bob</span>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zfs set quota=none storage/home/bob</span></code></pre></div></div><div class=paragraph><p>The general format is <code>userquota@<em>user</em>=<em>size</em></code>, and the user’s name must be in one of these formats:</p></div><div class=ulist><ul><li><p>POSIX compatible name such as <em>joe</em>.</p></li><li><p>POSIX numeric ID such as <em>789</em>.</p></li><li><p>SID name such as <em>joe.bloggs@example.com</em>.</p></li><li><p>SID numeric ID such as <em>S-1-123-456-789</em>.</p></li></ul></div><div class=paragraph><p>For example, to enforce a user quota of 50 GB for the user named <em>joe</em>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zfs set userquota@joe=50G</span></code></pre></div></div><div class=paragraph><p>To remove any quota:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zfs set userquota@joe=none</span></code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>User quota properties are not displayed by <code>zfs get all</code>. Non-<code>root</code> users can only see their own quotas unless they have been granted the <code>userquota</code> privilege. Users with this privilege are able to view and set everyone’s quota.</p></div></td></tr></tbody></table></div><div class=paragraph><p>The general format for setting a group quota is: <code>groupquota@<em>group</em>=<em>size</em></code>.</p></div><div class=paragraph><p>To set the quota for the group <em>firstgroup</em> to 50 GB, use:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zfs set groupquota@firstgroup=50G</span></code></pre></div></div><div class=paragraph><p>To remove the quota for the group <em>firstgroup</em>, or to make sure that one is not set, instead use:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zfs set groupquota@firstgroup=none</span></code></pre></div></div><div class=paragraph><p>As with the user quota property, non-<code>root</code> users can only see the quotas associated with the groups to which they belong. However, <code>root</code> or a user with the <code>groupquota</code> privilege can view and set all quotas for all groups.</p></div><div class=paragraph><p>To display the amount of space used by each user on a file system or snapshot along with any quotas, use <code>zfs userspace</code>. For group information, use <code>zfs groupspace</code>. For more information about supported options or how to display only specific options, refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=zfs&amp;sektion=1&amp;format=html">zfs(1)</a>.</p></div><div class=paragraph><p>Users with sufficient privileges, and <code>root</code>, can list the quota for <span class=filename>storage/home/bob</span> using:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zfs get quota storage/home/bob</span></code></pre></div></div></div><div class=sect3><h4 id=zfs-zfs-reservation>19.4.9. Reservations<a class=anchor href=#zfs-zfs-reservation></a></h4><div class=paragraph><p><a href=#zfs-term-reservation>Reservations</a> guarantee a minimum amount of space will always be available on a dataset. The reserved space will not be available to any other dataset. This feature can be especially useful to ensure that free space is available for an important dataset or log files.</p></div><div class=paragraph><p>The general format of the <code>reservation</code> property is <code>reservation=<em>size</em></code>, so to set a reservation of 10 GB on <span class=filename>storage/home/bob</span>, use:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zfs set reservation=10G storage/home/bob</span></code></pre></div></div><div class=paragraph><p>To clear any reservation:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zfs set reservation=none storage/home/bob</span></code></pre></div></div><div class=paragraph><p>The same principle can be applied to the <code>refreservation</code> property for setting a <a href=#zfs-term-refreservation>Reference Reservation</a>, with the general format <code>refreservation=<em>size</em></code>.</p></div><div class=paragraph><p>This command shows any reservations or refreservations that exist on <span class=filename>storage/home/bob</span>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zfs get reservation storage/home/bob</span>
<span class=c># zfs get refreservation storage/home/bob</span></code></pre></div></div></div><div class=sect3><h4 id=zfs-zfs-compression>19.4.10. Compression<a class=anchor href=#zfs-zfs-compression></a></h4><div class=paragraph><p>ZFS provides transparent compression. Compressing data at the block level as it is written not only saves space, but can also increase disk throughput. If data is compressed by 25%, but the compressed data is written to the disk at the same rate as the uncompressed version, resulting in an effective write speed of 125%. Compression can also be a great alternative to <a href=#zfs-zfs-deduplication>Deduplication</a> because it does not require additional memory.</p></div><div class=paragraph><p>ZFS offers several different compression algorithms, each with different trade-offs. With the introduction of LZ4 compression in ZFS v5000, it is possible to enable compression for the entire pool without the large performance trade-off of other algorithms. The biggest advantage to LZ4 is the <em>early abort</em> feature. If LZ4 does not achieve at least 12.5% compression in the first part of the data, the block is written uncompressed to avoid wasting CPU cycles trying to compress data that is either already compressed or uncompressible. For details about the different compression algorithms available in ZFS, see the <a href=#zfs-term-compression>Compression</a> entry in the terminology section.</p></div><div class=paragraph><p>The administrator can monitor the effectiveness of compression using a number of dataset properties.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zfs get used,compressratio,compression,logicalused mypool/compressed_dataset</span>
NAME        PROPERTY          VALUE     SOURCE
mypool/compressed_dataset  used              449G      -
mypool/compressed_dataset  compressratio     1.11x     -
mypool/compressed_dataset  compression       lz4       <span class=nb>local
</span>mypool/compressed_dataset  logicalused       496G      -</code></pre></div></div><div class=paragraph><p>The dataset is currently using 449 GB of space (the used property). Without compression, it would have taken 496 GB of space (the <code>logicalused</code> property). This results in the 1.11:1 compression ratio.</p></div><div class=paragraph><p>Compression can have an unexpected side effect when combined with <a href=#zfs-term-userquota>User Quotas</a>. User quotas restrict how much space a user can consume on a dataset, but the measurements are based on how much space is used <em>after compression</em>. So if a user has a quota of 10 GB, and writes 10 GB of compressible data, they will still be able to store additional data. If they later update a file, say a database, with more or less compressible data, the amount of space available to them will change. This can result in the odd situation where a user did not increase the actual amount of data (the <code>logicalused</code> property), but the change in compression caused them to reach their quota limit.</p></div><div class=paragraph><p>Compression can have a similar unexpected interaction with backups. Quotas are often used to limit how much data can be stored to ensure there is sufficient backup space available. However since quotas do not consider compression, more data may be written than would fit with uncompressed backups.</p></div></div><div class=sect3><h4 id=zfs-zfs-deduplication>19.4.11. Deduplication<a class=anchor href=#zfs-zfs-deduplication></a></h4><div class=paragraph><p>When enabled, <a href=#zfs-term-deduplication>deduplication</a> uses the checksum of each block to detect duplicate blocks. When a new block is a duplicate of an existing block, ZFS writes an additional reference to the existing data instead of the whole duplicate block. Tremendous space savings are possible if the data contains many duplicated files or repeated information. Be warned: deduplication requires an extremely large amount of memory, and most of the space savings can be had without the extra cost by enabling compression instead.</p></div><div class=paragraph><p>To activate deduplication, set the <code>dedup</code> property on the target pool:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zfs set dedup=on pool</span></code></pre></div></div><div class=paragraph><p>Only new data being written to the pool will be deduplicated. Data that has already been written to the pool will not be deduplicated merely by activating this option. A pool with a freshly activated deduplication property will look like this example:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zpool list</span>
NAME  SIZE ALLOC  FREE   CKPOINT  EXPANDSZ   FRAG   CAP   DEDUP   HEALTH   ALTROOT
pool 2.84G 2.19M 2.83G         -         -     0%    0%   1.00x   ONLINE   -</code></pre></div></div><div class=paragraph><p>The <code>DEDUP</code> column shows the actual rate of deduplication for the pool. A value of <code>1.00x</code> shows that data has not been deduplicated yet. In the next example, the ports tree is copied three times into different directories on the deduplicated pool created above.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># for d in dir1 dir2 dir3; do</span>
<span class=o>&gt;</span> <span class=nb>mkdir</span> <span class=nv>$d</span> <span class=o>&amp;&amp;</span> <span class=nb>cp</span> <span class=nt>-R</span> /usr/ports <span class=nv>$d</span> &amp;
<span class=o>&gt;</span> <span class=k>done</span></code></pre></div></div><div class=paragraph><p>Redundant data is detected and deduplicated:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zpool list</span>
NAME SIZE  ALLOC  FREE   CKPOINT  EXPANDSZ   FRAG  CAP   DEDUP   HEALTH   ALTROOT
pool 2.84G 20.9M 2.82G         -         -     0%   0%   3.00x   ONLINE   -</code></pre></div></div><div class=paragraph><p>The <code>DEDUP</code> column shows a factor of <code>3.00x</code>. Multiple copies of the ports tree data was detected and deduplicated, using only a third of the space. The potential for space savings can be enormous, but comes at the cost of having enough memory to keep track of the deduplicated blocks.</p></div><div class=paragraph><p>Deduplication is not always beneficial, especially when the data on a pool is not redundant. ZFS can show potential space savings by simulating deduplication on an existing pool:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zdb -S pool</span>
Simulated DDT histogram:

bucket              allocated                       referenced
______   ______________________________   ______________________________
refcnt   blocks   LSIZE   PSIZE   DSIZE   blocks   LSIZE   PSIZE   DSIZE
<span class=nt>------</span>   <span class=nt>------</span>   <span class=nt>-----</span>   <span class=nt>-----</span>   <span class=nt>-----</span>   <span class=nt>------</span>   <span class=nt>-----</span>   <span class=nt>-----</span>   <span class=nt>-----</span>
     1    2.58M    289G    264G    264G    2.58M    289G    264G    264G
     2     206K   12.6G   10.4G   10.4G     430K   26.4G   21.6G   21.6G
     4    37.6K    692M    276M    276M     170K   3.04G   1.26G   1.26G
     8    2.18K   45.2M   19.4M   19.4M    20.0K    425M    176M    176M
    16      174   2.83M   1.20M   1.20M    3.33K   48.4M   20.4M   20.4M
    32       40   2.17M    222K    222K    1.70K   97.2M   9.91M   9.91M
    64        9     56K   10.5K   10.5K      865   4.96M    948K    948K
   128        2   9.50K      2K      2K      419   2.11M    438K    438K
   256        5   61.5K     12K     12K    1.90K   23.0M   4.47M   4.47M
    1K        2      1K      1K      1K    2.98K   1.49M   1.49M   1.49M
 Total    2.82M    303G    275G    275G    3.20M    319G    287G    287G

dedup <span class=o>=</span> 1.05, compress <span class=o>=</span> 1.11, copies <span class=o>=</span> 1.00, dedup <span class=k>*</span> compress / copies <span class=o>=</span> 1.16</code></pre></div></div><div class=paragraph><p>After <code>zdb -S</code> finishes analyzing the pool, it shows the space reduction ratio that would be achieved by activating deduplication. In this case, <code>1.16</code> is a very poor space saving ratio that is mostly provided by compression. Activating deduplication on this pool would not save any significant amount of space, and is not worth the amount of memory required to enable deduplication. Using the formula <em>ratio = dedup * compress / copies</em>, system administrators can plan the storage allocation, deciding whether the workload will contain enough duplicate blocks to justify the memory requirements. If the data is reasonably compressible, the space savings may be very good. Enabling compression first is recommended, and compression can also provide greatly increased performance. Only enable deduplication in cases where the additional savings will be considerable and there is sufficient memory for the <a href=#zfs-term-deduplication>DDT</a>.</p></div></div><div class=sect3><h4 id=zfs-zfs-jail>19.4.12. ZFS and Jails<a class=anchor href=#zfs-zfs-jail></a></h4><div class=paragraph><p><code>zfs jail</code> and the corresponding <code>jailed</code> property are used to delegate a ZFS dataset to a <a href=./#jails>Jail</a>. <code>zfs jail <em>jailid</em></code> attaches a dataset to the specified jail, and <code>zfs unjail</code> detaches it. For the dataset to be controlled from within a jail, the <code>jailed</code> property must be set. Once a dataset is jailed, it can no longer be mounted on the host because it may have mount points that would compromise the security of the host.</p></div></div></div><div class=sect2><h3 id=zfs-zfs-allow>19.5. Delegated Administration<a class=anchor href=#zfs-zfs-allow></a></h3><div class=paragraph><p>A comprehensive permission delegation system allows unprivileged users to perform ZFS administration functions. For example, if each user’s home directory is a dataset, users can be given permission to create and destroy snapshots of their home directories. A backup user can be given permission to use replication features. A usage statistics script can be allowed to run with access only to the space utilization data for all users. It is even possible to delegate the ability to delegate permissions. Permission delegation is possible for each subcommand and most properties.</p></div><div class=sect3><h4 id=zfs-zfs-allow-create>19.5.1. Delegating Dataset Creation<a class=anchor href=#zfs-zfs-allow-create></a></h4><div class=paragraph><p><code>zfs allow <em>someuser</em> create <em>mydataset</em></code> gives the specified user permission to create child datasets under the selected parent dataset. There is a caveat: creating a new dataset involves mounting it. That requires setting the FreeBSD <code>vfs.usermount</code> <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a> to <code>1</code> to allow non-root users to mount a file system. There is another restriction aimed at preventing abuse: non-<code>root</code> users must own the mountpoint where the file system is to be mounted.</p></div></div><div class=sect3><h4 id=zfs-zfs-allow-allow>19.5.2. Delegating Permission Delegation<a class=anchor href=#zfs-zfs-allow-allow></a></h4><div class=paragraph><p><code>zfs allow <em>someuser</em> allow <em>mydataset</em></code> gives the specified user the ability to assign any permission they have on the target dataset, or its children, to other users. If a user has the <code>snapshot</code> permission and the <code>allow</code> permission, that user can then grant the <code>snapshot</code> permission to other users.</p></div></div></div><div class=sect2><h3 id=zfs-advanced>19.6. Advanced Topics<a class=anchor href=#zfs-advanced></a></h3><div class=sect3><h4 id=zfs-advanced-tuning>19.6.1. Tuning<a class=anchor href=#zfs-advanced-tuning></a></h4><div class=paragraph><p>There are a number of tunables that can be adjusted to make ZFS perform best for different workloads.</p></div><div class=ulist><ul><li><p><a id=zfs-advanced-tuning-arc_max></a><code><em>vfs.zfs.arc_max</em></code> - Maximum size of the <a href=#zfs-term-arc>ARC</a>. The default is all RAM but 1 GB, or 5/8 of all RAM, whichever is more. However, a lower value should be used if the system will be running any other daemons or processes that may require memory. This value can be adjusted at runtime with <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a> and can be set in <span class=filename>/boot/loader.conf</span> or <span class=filename>/etc/sysctl.conf</span>.</p></li><li><p><a id=zfs-advanced-tuning-arc_meta_limit></a><code><em>vfs.zfs.arc_meta_limit</em></code> - Limit the portion of the <a href=#zfs-term-arc>ARC</a> that can be used to store metadata. The default is one fourth of <code>vfs.zfs.arc_max</code>. Increasing this value will improve performance if the workload involves operations on a large number of files and directories, or frequent metadata operations, at the cost of less file data fitting in the <a href=#zfs-term-arc>ARC</a>. This value can be adjusted at runtime with <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a> and can be set in <span class=filename>/boot/loader.conf</span> or <span class=filename>/etc/sysctl.conf</span>.</p></li><li><p><a id=zfs-advanced-tuning-arc_min></a><code><em>vfs.zfs.arc_min</em></code> - Minimum size of the <a href=#zfs-term-arc>ARC</a>. The default is one half of <code>vfs.zfs.arc_meta_limit</code>. Adjust this value to prevent other applications from pressuring out the entire <a href=#zfs-term-arc>ARC</a>. This value can be adjusted at runtime with <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a> and can be set in <span class=filename>/boot/loader.conf</span> or <span class=filename>/etc/sysctl.conf</span>.</p></li><li><p><a id=zfs-advanced-tuning-vdev-cache-size></a><code><em>vfs.zfs.vdev.cache.size</em></code> - A preallocated amount of memory reserved as a cache for each device in the pool. The total amount of memory used will be this value multiplied by the number of devices. This value can only be adjusted at boot time, and is set in <span class=filename>/boot/loader.conf</span>.</p></li><li><p><a id=zfs-advanced-tuning-min-auto-ashift></a><code><em>vfs.zfs.min_auto_ashift</em></code> - Minimum <code>ashift</code> (sector size) that will be used automatically at pool creation time. The value is a power of two. The default value of <code>9</code> represents <code>2^9 = 512</code>, a sector size of 512 bytes. To avoid <em>write amplification</em> and get the best performance, set this value to the largest sector size used by a device in the pool.</p><div class=paragraph><p>Many drives have 4 KB sectors. Using the default <code>ashift</code> of <code>9</code> with these drives results in write amplification on these devices. Data that could be contained in a single 4 KB write must instead be written in eight 512-byte writes. ZFS tries to read the native sector size from all devices when creating a pool, but many drives with 4 KB sectors report that their sectors are 512 bytes for compatibility. Setting <code>vfs.zfs.min_auto_ashift</code> to <code>12</code> (<code>2^12 = 4096</code>) before creating a pool forces ZFS to use 4 KB blocks for best performance on these drives.</p></div><div class=paragraph><p>Forcing 4 KB blocks is also useful on pools where disk upgrades are planned. Future disks are likely to use 4 KB sectors, and <code>ashift</code> values cannot be changed after a pool is created.</p></div><div class=paragraph><p>In some specific cases, the smaller 512-byte block size might be preferable. When used with 512-byte disks for databases, or as storage for virtual machines, less data is transferred during small random reads. This can provide better performance, especially when using a smaller ZFS record size.</p></div></li><li><p><a id=zfs-advanced-tuning-prefetch_disable></a><code><em>vfs.zfs.prefetch_disable</em></code> - Disable prefetch. A value of <code>0</code> is enabled and <code>1</code> is disabled. The default is <code>0</code>, unless the system has less than 4 GB of RAM. Prefetch works by reading larger blocks than were requested into the <a href=#zfs-term-arc>ARC</a> in hopes that the data will be needed soon. If the workload has a large number of random reads, disabling prefetch may actually improve performance by reducing unnecessary reads. This value can be adjusted at any time with <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a>.</p></li><li><p><a id=zfs-advanced-tuning-vdev-trim_on_init></a><code><em>vfs.zfs.vdev.trim_on_init</em></code> - Control whether new devices added to the pool have the <code>TRIM</code> command run on them. This ensures the best performance and longevity for SSDs, but takes extra time. If the device has already been secure erased, disabling this setting will make the addition of the new device faster. This value can be adjusted at any time with <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a>.</p></li><li><p><a id=zfs-advanced-tuning-vdev-max_pending></a><code><em>vfs.zfs.vdev.max_pending</em></code> - Limit the number of pending I/O requests per device. A higher value will keep the device command queue full and may give higher throughput. A lower value will reduce latency. This value can be adjusted at any time with <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a>.</p></li><li><p><a id=zfs-advanced-tuning-top_maxinflight></a><code><em>vfs.zfs.top_maxinflight</em></code> - Maxmimum number of outstanding I/Os per top-level <a href=#zfs-term-vdev>vdev</a>. Limits the depth of the command queue to prevent high latency. The limit is per top-level vdev, meaning the limit applies to each <a href=#zfs-term-vdev-mirror>mirror</a>, <a href=#zfs-term-vdev-raidz>RAID-Z</a>, or other vdev independently. This value can be adjusted at any time with <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a>.</p></li><li><p><a id=zfs-advanced-tuning-l2arc_write_max></a><code><em>vfs.zfs.l2arc_write_max</em></code> - Limit the amount of data written to the <a href=#zfs-term-l2arc>L2ARC</a> per second. This tunable is designed to extend the longevity of SSDs by limiting the amount of data written to the device. This value can be adjusted at any time with <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a>.</p></li><li><p><a id=zfs-advanced-tuning-l2arc_write_boost></a><code><em>vfs.zfs.l2arc_write_boost</em></code> - The value of this tunable is added to <a href=#zfs-advanced-tuning-l2arc_write_max><code>vfs.zfs.l2arc_write_max</code></a> and increases the write speed to the SSD until the first block is evicted from the <a href=#zfs-term-l2arc>L2ARC</a>. This "Turbo Warmup Phase" is designed to reduce the performance loss from an empty <a href=#zfs-term-l2arc>L2ARC</a> after a reboot. This value can be adjusted at any time with <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a>.</p></li><li><p><a id=zfs-advanced-tuning-scrub_delay></a><code><em>vfs.zfs.scrub_delay</em></code> - Number of ticks to delay between each I/O during a <a href=#zfs-term-scrub><code>scrub</code></a>. To ensure that a <code>scrub</code> does not interfere with the normal operation of the pool, if any other I/O is happening the <code>scrub</code> will delay between each command. This value controls the limit on the total IOPS (I/Os Per Second) generated by the <code>scrub</code>. The granularity of the setting is determined by the value of <code>kern.hz</code> which defaults to 1000 ticks per second. This setting may be changed, resulting in a different effective IOPS limit. The default value is <code>4</code>, resulting in a limit of: 1000 ticks/sec / 4 = 250 IOPS. Using a value of <em>20</em> would give a limit of: 1000 ticks/sec / 20 = 50 IOPS. The speed of <code>scrub</code> is only limited when there has been recent activity on the pool, as determined by <a href=#zfs-advanced-tuning-scan_idle><code>vfs.zfs.scan_idle</code></a>. This value can be adjusted at any time with <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a>.</p></li><li><p><a id=zfs-advanced-tuning-resilver_delay></a><code><em>vfs.zfs.resilver_delay</em></code> - Number of milliseconds of delay inserted between each I/O during a <a href=#zfs-term-resilver>resilver</a>. To ensure that a resilver does not interfere with the normal operation of the pool, if any other I/O is happening the resilver will delay between each command. This value controls the limit of total IOPS (I/Os Per Second) generated by the resilver. The granularity of the setting is determined by the value of <code>kern.hz</code> which defaults to 1000 ticks per second. This setting may be changed, resulting in a different effective IOPS limit. The default value is 2, resulting in a limit of: 1000 ticks/sec / 2 = 500 IOPS. Returning the pool to an <a href=#zfs-term-online>Online</a> state may be more important if another device failing could <a href=#zfs-term-faulted>Fault</a> the pool, causing data loss. A value of 0 will give the resilver operation the same priority as other operations, speeding the healing process. The speed of resilver is only limited when there has been other recent activity on the pool, as determined by <a href=#zfs-advanced-tuning-scan_idle><code>vfs.zfs.scan_idle</code></a>. This value can be adjusted at any time with <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a>.</p></li><li><p><a id=zfs-advanced-tuning-scan_idle></a><code><em>vfs.zfs.scan_idle</em></code> - Number of milliseconds since the last operation before the pool is considered idle. When the pool is idle the rate limiting for <a href=#zfs-term-scrub><code>scrub</code></a> and <a href=#zfs-term-resilver>resilver</a> are disabled. This value can be adjusted at any time with <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a>.</p></li><li><p><a id=zfs-advanced-tuning-txg-timeout></a><code><em>vfs.zfs.txg.timeout</em></code> - Maximum number of seconds between <a href=#zfs-term-txg>transaction group</a>s. The current transaction group will be written to the pool and a fresh transaction group started if this amount of time has elapsed since the previous transaction group. A transaction group my be triggered earlier if enough data is written. The default value is 5 seconds. A larger value may improve read performance by delaying asynchronous writes, but this may cause uneven performance when the transaction group is written. This value can be adjusted at any time with <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a>.</p></li></ul></div></div><div class=sect3><h4 id=zfs-advanced-i386>19.6.2. ZFS on i386<a class=anchor href=#zfs-advanced-i386></a></h4><div class=paragraph><p>Some of the features provided by ZFS are memory intensive, and may require tuning for maximum efficiency on systems with limited RAM.</p></div><div class=sect4><h5 id=_memory>19.6.2.1. Memory<a class=anchor href=#_memory></a></h5><div class=paragraph><p>As a bare minimum, the total system memory should be at least one gigabyte. The amount of recommended RAM depends upon the size of the pool and which ZFS features are used. A general rule of thumb is 1 GB of RAM for every 1 TB of storage. If the deduplication feature is used, a general rule of thumb is 5 GB of RAM per TB of storage to be deduplicated. While some users successfully use ZFS with less RAM, systems under heavy load may panic due to memory exhaustion. Further tuning may be required for systems with less than the recommended RAM requirements.</p></div></div><div class=sect4><h5 id=_kernel_configuration>19.6.2.2. Kernel Configuration<a class=anchor href=#_kernel_configuration></a></h5><div class=paragraph><p>Due to the address space limitations of the i386™ platform, ZFS users on the i386™ architecture must add this option to a custom kernel configuration file, rebuild the kernel, and reboot:</p></div><div class="literalblock programlisting"><div class=content><pre>options        KVA_PAGES=512</pre></div></div><div class=paragraph><p>This expands the kernel address space, allowing the <code>vm.kvm_size</code> tunable to be pushed beyond the currently imposed limit of 1 GB, or the limit of 2 GB for PAE. To find the most suitable value for this option, divide the desired address space in megabytes by four. In this example, it is <code>512</code> for 2 GB.</p></div></div><div class=sect4><h5 id=_loader_tunables>19.6.2.3. Loader Tunables<a class=anchor href=#_loader_tunables></a></h5><div class=paragraph><p>The <span class=filename>kmem</span> address space can be increased on all FreeBSD architectures. On a test system with 1 GB of physical memory, success was achieved with these options added to <span class=filename>/boot/loader.conf</span>, and the system restarted:</p></div><div class="literalblock programlisting"><div class=content><pre>vm.kmem_size=&#34;330M&#34;
vm.kmem_size_max=&#34;330M&#34;
vfs.zfs.arc_max=&#34;40M&#34;
vfs.zfs.vdev.cache.size=&#34;5M&#34;</pre></div></div><div class=paragraph><p>For a more detailed list of recommendations for ZFS-related tuning, see <a href=https://wiki.freebsd.org/ZFSTuningGuide class=bare>https://wiki.freebsd.org/ZFSTuningGuide</a>.</p></div></div></div></div><div class=sect2><h3 id=zfs-links>19.7. Additional Resources<a class=anchor href=#zfs-links></a></h3><div class=ulist><ul><li><p><a href=http://open-zfs.org>OpenZFS</a></p></li><li><p><a href=https://wiki.freebsd.org/ZFSTuningGuide>FreeBSD Wiki - ZFS Tuning</a></p></li><li><p><a href=http://docs.oracle.com/cd/E19253-01/819-5461/index.html>Oracle Solaris ZFS Administration Guide</a></p></li><li><p><a href=https://calomel.org/zfs_raid_speed_capacity.html>Calomel Blog - ZFS Raidz Performance, Capacity and Integrity</a></p></li></ul></div></div><div class=sect2><h3 id=zfs-term>19.8. ZFS Features and Terminology<a class=anchor href=#zfs-term></a></h3><div class=paragraph><p>ZFS is a fundamentally different file system because it is more than just a file system. ZFS combines the roles of file system and volume manager, enabling additional storage devices to be added to a live system and having the new space available on all of the existing file systems in that pool immediately. By combining the traditionally separate roles, ZFS is able to overcome previous limitations that prevented RAID groups being able to grow. Each top level device in a pool is called a <em>vdev</em>, which can be a simple disk or a RAID transformation such as a mirror or RAID-Z array. ZFS file systems (called <em>datasets</em>) each have access to the combined free space of the entire pool. As blocks are allocated from the pool, the space available to each file system decreases. This approach avoids the common pitfall with extensive partitioning where free space becomes fragmented across the partitions.</p></div><table class="tableblock frame-all grid-all stretch informaltable"><col style=width:10%><col style=width:90%><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a id=zfs-term-pool></a>pool</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>A storage <em>pool</em> is the most basic building block of ZFS. A pool is made up of one or more vdevs, the underlying devices that store the data. A pool is then used to create one or more file systems (datasets) or block devices (volumes). These datasets and volumes share the pool of remaining free space. Each pool is uniquely identified by a name and a GUID. The features available are determined by the ZFS version number on the pool.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a id=zfs-term-vdev></a>vdev Types</p></td><td class="tableblock halign-left valign-top"><div class=content><div class=paragraph><p>A pool is made up of one or more vdevs, which themselves can be a single disk or a group of disks, in the case of a RAID transform. When multiple vdevs are used, ZFS spreads data across the vdevs to increase performance and maximize usable space.</p></div><div class=ulist><ul><li><p><a id=zfs-term-vdev-disk></a><em>Disk</em> - The most basic type of vdev is a standard block device. This can be an entire disk (such as <span class=filename>/dev/ada0</span> or <span class=filename>/dev/da0</span>) or a partition (<span class=filename>/dev/ada0p3</span>). On FreeBSD, there is no performance penalty for using a partition rather than the entire disk. This differs from recommendations made by the Solaris documentation.</p><div class="admonitionblock caution"><table><tbody><tr><td class=icon><i class="fa icon-caution" title=Caution></i></td><td class=content><div class=paragraph><p>Using an entire disk as part of a bootable pool is strongly discouraged, as this may render the pool unbootable. Likewise, you should not use an entire disk as part of a mirror or RAID-Z vdev. These are because it it impossible to reliably determine the size of an unpartitioned disk at boot time and because there’s no place to put in boot code.</p></div></td></tr></tbody></table></div></li><li><p><a id=zfs-term-vdev-file></a><em>File</em> - In addition to disks, ZFS pools can be backed by regular files, this is especially useful for testing and experimentation. Use the full path to the file as the device path in <code>zpool create</code>. All vdevs must be at least 128 MB in size.</p></li><li><p><a id=zfs-term-vdev-mirror></a><em>Mirror</em> - When creating a mirror, specify the <code>mirror</code> keyword followed by the list of member devices for the mirror. A mirror consists of two or more devices, all data will be written to all member devices. A mirror vdev will only hold as much data as its smallest member. A mirror vdev can withstand the failure of all but one of its members without losing any data.</p><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>A regular single disk vdev can be upgraded to a mirror vdev at any time with <code>zpool <a href=#zfs-zpool-attach>attach</a></code>.</p></div></td></tr></tbody></table></div></li><li><p><a id=zfs-term-vdev-raidz></a><em>RAID-Z</em> - ZFS implements RAID-Z, a variation on standard RAID-5 that offers better distribution of parity and eliminates the "RAID-5 write hole" in which the data and parity information become inconsistent after an unexpected restart. ZFS supports three levels of RAID-Z which provide varying levels of redundancy in exchange for decreasing levels of usable storage. The types are named RAID-Z1 through RAID-Z3 based on the number of parity devices in the array and the number of disks which can fail while the pool remains operational.</p><div class=paragraph><p>In a RAID-Z1 configuration with four disks, each 1 TB, usable storage is 3 TB and the pool will still be able to operate in degraded mode with one faulted disk. If an additional disk goes offline before the faulted disk is replaced and resilvered, all data in the pool can be lost.</p></div><div class=paragraph><p>In a RAID-Z3 configuration with eight disks of 1 TB, the volume will provide 5 TB of usable space and still be able to operate with three faulted disks. Sun™ recommends no more than nine disks in a single vdev. If the configuration has more disks, it is recommended to divide them into separate vdevs and the pool data will be striped across them.</p></div><div class=paragraph><p>A configuration of two RAID-Z2 vdevs consisting of 8 disks each would create something similar to a RAID-60 array. A RAID-Z group’s storage capacity is approximately the size of the smallest disk multiplied by the number of non-parity disks. Four 1 TB disks in RAID-Z1 has an effective size of approximately 3 TB, and an array of eight 1 TB disks in RAID-Z3 will yield 5 TB of usable space.</p></div></li><li><p><a id=zfs-term-vdev-spare></a><em>Spare</em> - ZFS has a special pseudo-vdev type for keeping track of available hot spares. Note that installed hot spares are not deployed automatically; they must manually be configured to replace the failed device using <code>zfs replace</code>.</p></li><li><p><a id=zfs-term-vdev-log></a><em>Log</em> - ZFS Log Devices, also known as ZFS Intent Log (<a href=#zfs-term-zil>ZIL</a>) move the intent log from the regular pool devices to a dedicated device, typically an SSD. Having a dedicated log device can significantly improve the performance of applications with a high volume of synchronous writes, especially databases. Log devices can be mirrored, but RAID-Z is not supported. If multiple log devices are used, writes will be load balanced across them.</p></li><li><p><a id=zfs-term-vdev-cache></a><em>Cache</em> - Adding a cache vdev to a pool will add the storage of the cache to the <a href=#zfs-term-l2arc>L2ARC</a>. Cache devices cannot be mirrored. Since a cache device only stores additional copies of existing data, there is no risk of data loss.</p></li></ul></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a id=zfs-term-txg></a>Transaction Group (TXG)</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Transaction Groups are the way changed blocks are grouped together and eventually written to the pool. Transaction groups are the atomic unit that ZFS uses to assert consistency. Each transaction group is assigned a unique 64-bit consecutive identifier. There can be up to three active transaction groups at a time, one in each of these three states:</p><p class=tableblock>* <em>Open</em> - When a new transaction group is created, it is in the open state, and accepts new writes. There is always a transaction group in the open state, however the transaction group may refuse new writes if it has reached a limit. Once the open transaction group has reached a limit, or the <a href=#zfs-advanced-tuning-txg-timeout><code>vfs.zfs.txg.timeout</code></a> has been reached, the transaction group advances to the next state.
* <em>Quiescing</em> - A short state that allows any pending operations to finish while not blocking the creation of a new open transaction group. Once all of the transactions in the group have completed, the transaction group advances to the final state.
* <em>Syncing</em> - All of the data in the transaction group is written to stable storage. This process will in turn modify other data, such as metadata and space maps, that will also need to be written to stable storage. The process of syncing involves multiple passes. The first, all of the changed data blocks, is the biggest, followed by the metadata, which may take multiple passes to complete. Since allocating space for the data blocks generates new metadata, the syncing state cannot finish until a pass completes that does not allocate any additional space. The syncing state is also where <em>synctasks</em> are completed. Synctasks are administrative operations, such as creating or destroying snapshots and datasets, that modify the uberblock are completed. Once the sync state is complete, the transaction group in the quiescing state is advanced to the syncing state.
All administrative functions, such as <a href=#zfs-term-snapshot><code>snapshot</code></a> are written as part of the transaction group. When a synctask is created, it is added to the currently open transaction group, and that group is advanced as quickly as possible to the syncing state to reduce the latency of administrative commands.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a id=zfs-term-arc></a>Adaptive Replacement Cache (ARC)</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>ZFS uses an Adaptive Replacement Cache (ARC), rather than a more traditional Least Recently Used (LRU) cache. An LRU cache is a simple list of items in the cache, sorted by when each object was most recently used. New items are added to the top of the list. When the cache is full, items from the bottom of the list are evicted to make room for more active objects. An ARC consists of four lists; the Most Recently Used (MRU) and Most Frequently Used (MFU) objects, plus a ghost list for each. These ghost lists track recently evicted objects to prevent them from being added back to the cache. This increases the cache hit ratio by avoiding objects that have a history of only being used occasionally. Another advantage of using both an MRU and MFU is that scanning an entire file system would normally evict all data from an MRU or LRU cache in favor of this freshly accessed content. With ZFS, there is also an MFU that only tracks the most frequently used objects, and the cache of the most commonly accessed blocks remains.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a id=zfs-term-l2arc></a>L2ARC</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>L2ARC is the second level of the ZFS caching system. The primary ARC is stored in RAM. Since the amount of available RAM is often limited, ZFS can also use <a href=#zfs-term-vdev-cache>cache vdevs</a>. Solid State Disks (SSDs) are often used as these cache devices due to their higher speed and lower latency compared to traditional spinning disks. L2ARC is entirely optional, but having one will significantly increase read speeds for files that are cached on the SSD instead of having to be read from the regular disks. L2ARC can also speed up <a href=#zfs-term-deduplication>deduplication</a> because a DDT that does not fit in RAM but does fit in the L2ARC will be much faster than a DDT that must be read from disk. The rate at which data is added to the cache devices is limited to prevent prematurely wearing out SSDs with too many writes. Until the cache is full (the first block has been evicted to make room), writing to the L2ARC is limited to the sum of the write limit and the boost limit, and afterwards limited to the write limit. A pair of <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a> values control these rate limits. <a href=#zfs-advanced-tuning-l2arc_write_max><code>vfs.zfs.l2arc_write_max</code></a> controls how many bytes are written to the cache per second, while <a href=#zfs-advanced-tuning-l2arc_write_boost><code>vfs.zfs.l2arc_write_boost</code></a> adds to this limit during the "Turbo Warmup Phase" (Write Boost).</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a id=zfs-term-zil></a>ZIL</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>ZIL accelerates synchronous transactions by using storage devices like SSDs that are faster than those used in the main storage pool. When an application requests a synchronous write (a guarantee that the data has been safely stored to disk rather than merely cached to be written later), the data is written to the faster ZIL storage, then later flushed out to the regular disks. This greatly reduces latency and improves performance. Only synchronous workloads like databases will benefit from a ZIL. Regular asynchronous writes such as copying files will not use the ZIL at all.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a id=zfs-term-cow></a>Copy-On-Write</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Unlike a traditional file system, when data is overwritten on ZFS, the new data is written to a different block rather than overwriting the old data in place. Only when this write is complete is the metadata then updated to point to the new location. In the event of a shorn write (a system crash or power loss in the middle of writing a file), the entire original contents of the file are still available and the incomplete write is discarded. This also means that ZFS does not require a <a href="https://man.freebsd.org/cgi/man.cgi?query=fsck&amp;sektion=8&amp;format=html">fsck(8)</a> after an unexpected shutdown.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a id=zfs-term-dataset></a>Dataset</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><em>Dataset</em> is the generic term for a ZFS file system, volume, snapshot or clone. Each dataset has a unique name in the format <em>poolname/path@snapshot</em>. The root of the pool is technically a dataset as well. Child datasets are named hierarchically like directories. For example, <em>mypool/home</em>, the home dataset, is a child of <em>mypool</em> and inherits properties from it. This can be expanded further by creating <em>mypool/home/user</em>. This grandchild dataset will inherit properties from the parent and grandparent. Properties on a child can be set to override the defaults inherited from the parents and grandparents. Administration of datasets and their children can be <a href=#zfs-zfs-allow>delegated</a>.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a id=zfs-term-filesystem></a>File system</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>A ZFS dataset is most often used as a file system. Like most other file systems, a ZFS file system is mounted somewhere in the systems directory hierarchy and contains files and directories of its own with permissions, flags, and other metadata.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a id=zfs-term-volume></a>Volume</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>In addition to regular file system datasets, ZFS can also create volumes, which are block devices. Volumes have many of the same features, including copy-on-write, snapshots, clones, and checksumming. Volumes can be useful for running other file system formats on top of ZFS, such as UFS virtualization, or exporting iSCSI extents.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a id=zfs-term-snapshot></a>Snapshot</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>The <a href=#zfs-term-cow>copy-on-write</a> (COW) design of ZFS allows for nearly instantaneous, consistent snapshots with arbitrary names. After taking a snapshot of a dataset, or a recursive snapshot of a parent dataset that will include all child datasets, new data is written to new blocks, but the old blocks are not reclaimed as free space. The snapshot contains the original version of the file system, and the live file system contains any changes made since the snapshot was taken. No additional space is used. As new data is written to the live file system, new blocks are allocated to store this data. The apparent size of the snapshot will grow as the blocks are no longer used in the live file system, but only in the snapshot. These snapshots can be mounted read only to allow for the recovery of previous versions of files. It is also possible to <a href=#zfs-zfs-snapshot>rollback</a> a live file system to a specific snapshot, undoing any changes that took place after the snapshot was taken. Each block in the pool has a reference counter which keeps track of how many snapshots, clones, datasets, or volumes make use of that block. As files and snapshots are deleted, the reference count is decremented. When a block is no longer referenced, it is reclaimed as free space. Snapshots can also be marked with a <a href=#zfs-zfs-snapshot>hold</a>. When a snapshot is held, any attempt to destroy it will return an <code>EBUSY</code> error. Each snapshot can have multiple holds, each with a unique name. The <a href=#zfs-zfs-snapshot>release</a> command removes the hold so the snapshot can deleted. Snapshots can be taken on volumes, but they can only be cloned or rolled back, not mounted independently.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a id=zfs-term-clone></a>Clone</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Snapshots can also be cloned. A clone is a writable version of a snapshot, allowing the file system to be forked as a new dataset. As with a snapshot, a clone initially consumes no additional space. As new data is written to a clone and new blocks are allocated, the apparent size of the clone grows. When blocks are overwritten in the cloned file system or volume, the reference count on the previous block is decremented. The snapshot upon which a clone is based cannot be deleted because the clone depends on it. The snapshot is the parent, and the clone is the child. Clones can be <em>promoted</em>, reversing this dependency and making the clone the parent and the previous parent the child. This operation requires no additional space. Because the amount of space used by the parent and child is reversed, existing quotas and reservations might be affected.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a id=zfs-term-checksum></a>Checksum</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Every block that is allocated is also checksummed. The checksum algorithm used is a per-dataset property, see <a href=#zfs-zfs-set><code>set</code></a>. The checksum of each block is transparently validated as it is read, allowing ZFS to detect silent corruption. If the data that is read does not match the expected checksum, ZFS will attempt to recover the data from any available redundancy, like mirrors or RAID-Z). Validation of all checksums can be triggered with <a href=#zfs-term-scrub><code>scrub</code></a>. Checksum algorithms include:</p><p class=tableblock>* <code>fletcher2</code>
* <code>fletcher4</code>
* <code>sha256</code>
The <code>fletcher</code> algorithms are faster, but <code>sha256</code> is a strong cryptographic hash and has a much lower chance of collisions at the cost of some performance. Checksums can be disabled, but it is not recommended.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a id=zfs-term-compression></a>Compression</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Each dataset has a compression property, which defaults to off. This property can be set to one of a number of compression algorithms. This will cause all new data that is written to the dataset to be compressed. Beyond a reduction in space used, read and write throughput often increases because fewer blocks are read or written.</p><p class=tableblock><a id=zfs-term-compression-lz4></a>* <em>LZ4</em> - Added in ZFS pool version 5000 (feature flags), LZ4 is now the recommended compression algorithm. LZ4 compresses approximately 50% faster than LZJB when operating on compressible data, and is over three times faster when operating on uncompressible data. LZ4 also decompresses approximately 80% faster than LZJB. On modern CPUs, LZ4 can often compress at over 500 MB/s, and decompress at over 1.5 GB/s (per single CPU core).
<a id=zfs-term-compression-lzjb></a>* <em>LZJB</em> - The default compression algorithm. Created by Jeff Bonwick (one of the original creators of ZFS). LZJB offers good compression with less CPU overhead compared to GZIP. In the future, the default compression algorithm will likely change to LZ4.
<a id=zfs-term-compression-gzip></a>* <em>GZIP</em> - A popular stream compression algorithm available in ZFS. One of the main advantages of using GZIP is its configurable level of compression. When setting the <code>compress</code> property, the administrator can choose the level of compression, ranging from <code>gzip1</code>, the lowest level of compression, to <code>gzip9</code>, the highest level of compression. This gives the administrator control over how much CPU time to trade for saved disk space.
<a id=zfs-term-compression-zle></a>* <em>ZLE</em> - Zero Length Encoding is a special compression algorithm that only compresses continuous runs of zeros. This compression algorithm is only useful when the dataset contains large blocks of zeros.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a id=zfs-term-copies></a>Copies</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>When set to a value greater than 1, the <code>copies</code> property instructs ZFS to maintain multiple copies of each block in the <a href=#zfs-term-filesystem>File System</a> or <a href=#zfs-term-volume>Volume</a>. Setting this property on important datasets provides additional redundancy from which to recover a block that does not match its checksum. In pools without redundancy, the copies feature is the only form of redundancy. The copies feature can recover from a single bad sector or other forms of minor corruption, but it does not protect the pool from the loss of an entire disk.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a id=zfs-term-deduplication></a>Deduplication</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Checksums make it possible to detect duplicate blocks of data as they are written. With deduplication, the reference count of an existing, identical block is increased, saving storage space. To detect duplicate blocks, a deduplication table (DDT) is kept in memory. The table contains a list of unique checksums, the location of those blocks, and a reference count. When new data is written, the checksum is calculated and compared to the list. If a match is found, the existing block is used. The SHA256 checksum algorithm is used with deduplication to provide a secure cryptographic hash. Deduplication is tunable. If <code>dedup</code> is <code>on</code>, then a matching checksum is assumed to mean that the data is identical. If <code>dedup</code> is set to <code>verify</code>, then the data in the two blocks will be checked byte-for-byte to ensure it is actually identical. If the data is not identical, the hash collision will be noted and the two blocks will be stored separately. Because DDT must store the hash of each unique block, it consumes a very large amount of memory. A general rule of thumb is 5-6 GB of ram per 1 TB of deduplicated data). In situations where it is not practical to have enough RAM to keep the entire DDT in memory, performance will suffer greatly as the DDT must be read from disk before each new block is written. Deduplication can use L2ARC to store the DDT, providing a middle ground between fast system memory and slower disks. Consider using compression instead, which often provides nearly as much space savings without the additional memory requirement.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a id=zfs-term-scrub></a>Scrub</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Instead of a consistency check like <a href="https://man.freebsd.org/cgi/man.cgi?query=fsck&amp;sektion=8&amp;format=html">fsck(8)</a>, ZFS has <code>scrub</code>. <code>scrub</code> reads all data blocks stored on the pool and verifies their checksums against the known good checksums stored in the metadata. A periodic check of all the data stored on the pool ensures the recovery of any corrupted blocks before they are needed. A scrub is not required after an unclean shutdown, but is recommended at least once every three months. The checksum of each block is verified as blocks are read during normal use, but a scrub makes certain that even infrequently used blocks are checked for silent corruption. Data security is improved, especially in archival storage situations. The relative priority of <code>scrub</code> can be adjusted with <a href=#zfs-advanced-tuning-scrub_delay><code>vfs.zfs.scrub_delay</code></a> to prevent the scrub from degrading the performance of other workloads on the pool.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a id=zfs-term-quota></a>Dataset Quota</p></td><td class="tableblock halign-left valign-top"><div class=content><div class=paragraph><p>ZFS provides very fast and accurate dataset, user, and group space accounting in addition to quotas and space reservations. This gives the administrator fine grained control over how space is allocated and allows space to be reserved for critical file systems.</p></div><div class=paragraph><p>ZFS supports different types of quotas: the dataset quota, the <a href=#zfs-term-refquota>reference quota (refquota)</a>, the <a href=#zfs-term-userquota>user quota</a>, and the <a href=#zfs-term-groupquota>group quota</a>.</p></div><div class=paragraph><p>Quotas limit the amount of space that a dataset and all of its descendants, including snapshots of the dataset, child datasets, and the snapshots of those datasets, can consume.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Quotas cannot be set on volumes, as the <code>volsize</code> property acts as an implicit quota.</p></div></td></tr></tbody></table></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a id=zfs-term-refquota></a>Reference Quota</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>A reference quota limits the amount of space a dataset can consume by enforcing a hard limit. However, this hard limit includes only space that the dataset references and does not include space used by descendants, such as file systems or snapshots.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a id=zfs-term-userquota></a>User Quota</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>User quotas are useful to limit the amount of space that can be used by the specified user.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a id=zfs-term-groupquota></a>Group Quota</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>The group quota limits the amount of space that a specified group can consume.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a id=zfs-term-reservation></a>Dataset Reservation</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>The <code>reservation</code> property makes it possible to guarantee a minimum amount of space for a specific dataset and its descendants. If a 10 GB reservation is set on <span class=filename>storage/home/bob</span>, and another dataset tries to use all of the free space, at least 10 GB of space is reserved for this dataset. If a snapshot is taken of <span class=filename>storage/home/bob</span>, the space used by that snapshot is counted against the reservation. The <a href=#zfs-term-refreservation><code>refreservation</code></a> property works in a similar way, but it <em>excludes</em> descendants like snapshots.</p><p class=tableblock>Reservations of any sort are useful in many situations, such as planning and testing the suitability of disk space allocation in a new system, or ensuring that enough space is available on file systems for audio logs or system recovery procedures and files.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a id=zfs-term-refreservation></a>Reference Reservation</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>The <code>refreservation</code> property makes it possible to guarantee a minimum amount of space for the use of a specific dataset <em>excluding</em> its descendants. This means that if a 10 GB reservation is set on <span class=filename>storage/home/bob</span>, and another dataset tries to use all of the free space, at least 10 GB of space is reserved for this dataset. In contrast to a regular <a href=#zfs-term-reservation>reservation</a>, space used by snapshots and descendant datasets is not counted against the reservation. For example, if a snapshot is taken of <span class=filename>storage/home/bob</span>, enough disk space must exist outside of the <code>refreservation</code> amount for the operation to succeed. Descendants of the main data set are not counted in the <code>refreservation</code> amount and so do not encroach on the space set.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a id=zfs-term-resilver></a>Resilver</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>When a disk fails and is replaced, the new disk must be filled with the data that was lost. The process of using the parity information distributed across the remaining drives to calculate and write the missing data to the new drive is called <em>resilvering</em>.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a id=zfs-term-online></a>Online</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>A pool or vdev in the <code>Online</code> state has all of its member devices connected and fully operational. Individual devices in the <code>Online</code> state are functioning normally.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a id=zfs-term-offline></a>Offline</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Individual devices can be put in an <code>Offline</code> state by the administrator if there is sufficient redundancy to avoid putting the pool or vdev into a <a href=#zfs-term-faulted>Faulted</a> state. An administrator may choose to offline a disk in preparation for replacing it, or to make it easier to identify.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a id=zfs-term-degraded></a>Degraded</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>A pool or vdev in the <code>Degraded</code> state has one or more disks that have been disconnected or have failed. The pool is still usable, but if additional devices fail, the pool could become unrecoverable. Reconnecting the missing devices or replacing the failed disks will return the pool to an <a href=#zfs-term-online>Online</a> state after the reconnected or new device has completed the <a href=#zfs-term-resilver>Resilver</a> process.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a id=zfs-term-faulted></a>Faulted</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>A pool or vdev in the <code>Faulted</code> state is no longer operational. The data on it can no longer be accessed. A pool or vdev enters the <code>Faulted</code> state when the number of missing or failed devices exceeds the level of redundancy in the vdev. If missing devices can be reconnected, the pool will return to a <a href=#zfs-term-online>Online</a> state. If there is insufficient redundancy to compensate for the number of failed disks, then the contents of the pool are lost and must be restored from backups.</p></td></tr></tbody></table></div></div></div><div class=sect1><h2 id=filesystems>Rozdział 20. Other File Systems<a class=anchor href=#filesystems></a></h2><div class=sectionbody><div class=sect2><h3 id=filesystems-synopsis>20.1. Synopsis<a class=anchor href=#filesystems-synopsis></a></h3><div class=paragraph><p>File systems are an integral part of any operating system. They allow users to upload and store files, provide access to data, and make hard drives useful. Different operating systems differ in their native file system. Traditionally, the native FreeBSD file system has been the Unix File System UFS which has been modernized as UFS2. Since FreeBSD 7.0, the Z File System (ZFS) is also available as a native file system. See <a href=./#zfs>The Z File System (ZFS)</a> for more information.</p></div><div class=paragraph><p>In addition to its native file systems, FreeBSD supports a multitude of other file systems so that data from other operating systems can be accessed locally, such as data stored on locally attached USB storage devices, flash drives, and hard disks. This includes support for the Linux® Extended File System (EXT).</p></div><div class=paragraph><p>There are different levels of FreeBSD support for the various file systems. Some require a kernel module to be loaded and others may require a toolset to be installed. Some non-native file system support is full read-write while others are read-only.</p></div><div class=paragraph><p>After reading this chapter, you will know:</p></div><div class=ulist><ul><li><p>The difference between native and supported file systems.</p></li><li><p>Which file systems are supported by FreeBSD.</p></li><li><p>How to enable, configure, access, and make use of non-native file systems.</p></li></ul></div><div class=paragraph><p>Before reading this chapter, you should:</p></div><div class=ulist><ul><li><p>Understand UNIX® and <a href=./#basics>FreeBSD basics</a>.</p></li><li><p>Be familiar with the basics of <a href=./#kernelconfig>kernel configuration and compilation</a>.</p></li><li><p>Feel comfortable <a href=./#ports>installing software</a> in FreeBSD.</p></li><li><p>Have some familiarity with <a href=./#disks>disks</a>, storage, and device names in FreeBSD.</p></li></ul></div></div><div class=sect2><h3 id=filesystems-linux>20.2. Linux® File Systems<a class=anchor href=#filesystems-linux></a></h3><div class=paragraph><p>FreeBSD provides built-in support for several Linux® file systems. This section demonstrates how to load support for and how to mount the supported Linux® file systems.</p></div><div class=sect3><h4 id=_ext2>20.2.1. ext2<a class=anchor href=#_ext2></a></h4><div class=paragraph><p>Kernel support for ext2 file systems has been available since FreeBSD 2.2. In FreeBSD 8.x and earlier, the code is licensed under the GPL. Since FreeBSD 9.0, the code has been rewritten and is now BSD licensed.</p></div><div class=paragraph><p>The <a href="https://man.freebsd.org/cgi/man.cgi?query=ext2fs&amp;sektion=5&amp;format=html">ext2fs(5)</a> driver allows the FreeBSD kernel to both read and write to ext2 file systems.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>This driver can also be used to access ext3 and ext4 file systems. The <a href="https://man.freebsd.org/cgi/man.cgi?query=ext2fs&amp;sektion=5&amp;format=html">ext2fs(5)</a> filesystem has full read and write support for ext4 as of FreeBSD 12.0-RELEASE. Additionally, extended attributes and ACLs are also supported, while journalling and encryption are not. Starting with FreeBSD 12.1-RELEASE, a DTrace provider will be available as well. Prior versions of FreeBSD can access ext4 in read and write mode using <a class=package href=https://cgit.freebsd.org/ports/tree/sysutils/fusefs-ext2/>sysutils/fusefs-ext2</a>.</p></div></td></tr></tbody></table></div><div class=paragraph><p>To access an ext file system, first load the kernel loadable module:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># kldload ext2fs</span></code></pre></div></div><div class=paragraph><p>Then, mount the ext volume by specifying its FreeBSD partition name and an existing mount point. This example mounts <span class=filename>/dev/ad1s1</span> on <span class=filename>/mnt</span>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mount -t ext2fs /dev/ad1s1 /mnt</span></code></pre></div></div></div></div></div></div><div class=sect1><h2 id=virtualization>Rozdział 21. Virtualization<a class=anchor href=#virtualization></a></h2><div class=sectionbody><div class=sect2><h3 id=virtualization-synopsis>21.1. Synopsis<a class=anchor href=#virtualization-synopsis></a></h3><div class=paragraph><p>Virtualization software allows multiple operating systems to run simultaneously on the same computer. Such software systems for PCs often involve a host operating system which runs the virtualization software and supports any number of guest operating systems.</p></div><div class=paragraph><p>After reading this chapter, you will know:</p></div><div class=ulist><ul><li><p>The difference between a host operating system and a guest operating system.</p></li><li><p>How to install FreeBSD on an Intel®-based Apple® Mac® computer.</p></li><li><p>How to install FreeBSD on Microsoft® Windows® with Virtual PC.</p></li><li><p>How to install FreeBSD as a guest in bhyve.</p></li><li><p>How to tune a FreeBSD system for best performance under virtualization.</p></li></ul></div><div class=paragraph><p>Before reading this chapter, you should:</p></div><div class=ulist><ul><li><p>Understand the <a href=./#basics>basics of UNIX® and FreeBSD</a>.</p></li><li><p>Know how to <a href=./#bsdinstall>install FreeBSD</a>.</p></li><li><p>Know how to <a href=./#advanced-networking>set up a network connection</a>.</p></li><li><p>Know how to <a href=./#ports>install additional third-party software</a>.</p></li></ul></div></div><div class=sect2><h3 id=virtualization-guest-parallels>21.2. FreeBSD as a Guest on Parallels for Mac OS® X<a class=anchor href=#virtualization-guest-parallels></a></h3><div class=paragraph><p>Parallels Desktop for Mac® is a commercial software product available for Intel® based Apple® Mac® computers running Mac OS® 10.4.6 or higher. FreeBSD is a fully supported guest operating system. Once Parallels has been installed on Mac OS® X, the user must configure a virtual machine and then install the desired guest operating system.</p></div><div class=sect3><h4 id=virtualization-guest-parallels-install>21.2.1. Installing FreeBSD on Parallels/Mac OS® X<a class=anchor href=#virtualization-guest-parallels-install></a></h4><div class=paragraph><p>The first step in installing FreeBSD on Parallels is to create a new virtual machine for installing FreeBSD. Select <span class=guimenuitem>FreeBSD</span> as the <b class=menuref>Guest OS Type</b> when prompted:</p></div><div class=imageblock><div class=content><img src=../../../../images/books/handbook/virtualization/parallels-freebsd1.png alt="parallels freebsd1"></div></div><div class=paragraph><p>Choose a reasonable amount of disk and memory depending on the plans for this virtual FreeBSD instance. 4GB of disk space and 512MB of RAM work well for most uses of FreeBSD under Parallels:</p></div><div class=imageblock><div class=content><img src=../../../../images/books/handbook/virtualization/parallels-freebsd2.png alt="parallels freebsd2"></div></div><div class=imageblock><div class=content><img src=../../../../images/books/handbook/virtualization/parallels-freebsd3.png alt="parallels freebsd3"></div></div><div class=imageblock><div class=content><img src=../../../../images/books/handbook/virtualization/parallels-freebsd4.png alt="parallels freebsd4"></div></div><div class=imageblock><div class=content><img src=../../../../images/books/handbook/virtualization/parallels-freebsd5.png alt="parallels freebsd5"></div></div><div class=paragraph><p>Select the type of networking and a network interface:</p></div><div class=imageblock><div class=content><img src=../../../../images/books/handbook/virtualization/parallels-freebsd6.png alt="parallels freebsd6"></div></div><div class=imageblock><div class=content><img src=../../../../images/books/handbook/virtualization/parallels-freebsd7.png alt="parallels freebsd7"></div></div><div class=paragraph><p>Save and finish the configuration:</p></div><div class=imageblock><div class=content><img src=../../../../images/books/handbook/virtualization/parallels-freebsd8.png alt="parallels freebsd8"></div></div><div class=imageblock><div class=content><img src=../../../../images/books/handbook/virtualization/parallels-freebsd9.png alt="parallels freebsd9"></div></div><div class=paragraph><p>After the FreeBSD virtual machine has been created, FreeBSD can be installed on it. This is best done with an official FreeBSD CD/DVD or with an ISO image downloaded from an official FTP site. Copy the appropriate ISO image to the local Mac® filesystem or insert a CD/DVD in the Mac®'s CD-ROM drive. Click on the disc icon in the bottom right corner of the FreeBSD Parallels window. This will bring up a window that can be used to associate the CD-ROM drive in the virtual machine with the ISO file on disk or with the real CD-ROM drive.</p></div><div class=imageblock><div class=content><img src=../../../../images/books/handbook/virtualization/parallels-freebsd11.png alt="parallels freebsd11"></div></div><div class=paragraph><p>Once this association with the CD-ROM source has been made, reboot the FreeBSD virtual machine by clicking the reboot icon. Parallels will reboot with a special BIOS that first checks if there is a CD-ROM.</p></div><div class=imageblock><div class=content><img src=../../../../images/books/handbook/virtualization/parallels-freebsd10.png alt="parallels freebsd10"></div></div><div class=paragraph><p>In this case it will find the FreeBSD installation media and begin a normal FreeBSD installation. Perform the installation, but do not attempt to configure Xorg at this time.</p></div><div class=imageblock><div class=content><img src=../../../../images/books/handbook/virtualization/parallels-freebsd12.png alt="parallels freebsd12"></div></div><div class=paragraph><p>When the installation is finished, reboot into the newly installed FreeBSD virtual machine.</p></div><div class=imageblock><div class=content><img src=../../../../images/books/handbook/virtualization/parallels-freebsd13.png alt="parallels freebsd13"></div></div></div><div class=sect3><h4 id=virtualization-guest-parallels-configure>21.2.2. Configuring FreeBSD on Parallels<a class=anchor href=#virtualization-guest-parallels-configure></a></h4><div class=paragraph><p>After FreeBSD has been successfully installed on Mac OS® X with Parallels, there are a number of configuration steps that can be taken to optimize the system for virtualized operation.</p></div><div class="olist arabic procedure"><ol class=arabic><li><p>Set Boot Loader Variables</p><div class=paragraph><p>The most important step is to reduce the <code>kern.hz</code> tunable to reduce the CPU utilization of FreeBSD under the Parallels environment. This is accomplished by adding the following line to <span class=filename>/boot/loader.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>kern.hz=100</pre></div></div><div class=paragraph><p>Without this setting, an idle FreeBSD Parallels guest will use roughly 15% of the CPU of a single processor iMac®. After this change the usage will be closer to 5%.</p></div></li><li><p>Create a New Kernel Configuration File</p><div class=paragraph><p>All of the SCSI, FireWire, and USB device drivers can be removed from a custom kernel configuration file. Parallels provides a virtual network adapter used by the <a href="https://man.freebsd.org/cgi/man.cgi?query=ed&amp;sektion=4&amp;format=html">ed(4)</a> driver, so all network devices except for <a href="https://man.freebsd.org/cgi/man.cgi?query=ed&amp;sektion=4&amp;format=html">ed(4)</a> and <a href="https://man.freebsd.org/cgi/man.cgi?query=miibus&amp;sektion=4&amp;format=html">miibus(4)</a> can be removed from the kernel.</p></div></li><li><p>Configure Networking</p><div class=paragraph><p>The most basic networking setup uses DHCP to connect the virtual machine to the same local area network as the host Mac®. This can be accomplished by adding <code>ifconfig_ed0="DHCP"</code> to <span class=filename>/etc/rc.conf</span>. More advanced networking setups are described in <a href=./#advanced-networking>Advanced Networking</a>.</p></div></li></ol></div></div></div><div class=sect2><h3 id=virtualization-guest-virtualpc>21.3. FreeBSD as a Guest on Virtual PC for Windows®<a class=anchor href=#virtualization-guest-virtualpc></a></h3><div class=paragraph><p>Virtual PC for Windows® is a Microsoft® software product available for free download. See this website for the <a href=http://www.microsoft.com/windows/downloads/virtualpc/sysreq.mspx>system requirements</a>. Once Virtual PC has been installed on Microsoft® Windows®, the user can configure a virtual machine and then install the desired guest operating system.</p></div><div class=sect3><h4 id=virtualization-guest-virtualpc-install>21.3.1. Installing FreeBSD on Virtual PC<a class=anchor href=#virtualization-guest-virtualpc-install></a></h4><div class=paragraph><p>The first step in installing FreeBSD on Virtual PC is to create a new virtual machine for installing FreeBSD. Select <span class=guimenuitem>Create a virtual machine</span> when prompted:</p></div><div class=imageblock><div class=content><img src=../../../../images/books/handbook/virtualization/virtualpc-freebsd1.png alt="virtualpc freebsd1"></div></div><div class=imageblock><div class=content><img src=../../../../images/books/handbook/virtualization/virtualpc-freebsd2.png alt="virtualpc freebsd2"></div></div><div class=paragraph><p>Select <span class=guimenuitem>Other</span> as the <span class=guimenuitem>Operating system</span> when prompted:</p></div><div class=imageblock><div class=content><img src=../../../../images/books/handbook/virtualization/virtualpc-freebsd3.png alt="virtualpc freebsd3"></div></div><div class=paragraph><p>Then, choose a reasonable amount of disk and memory depending on the plans for this virtual FreeBSD instance. 4GB of disk space and 512MB of RAM work well for most uses of FreeBSD under Virtual PC:</p></div><div class=imageblock><div class=content><img src=../../../../images/books/handbook/virtualization/virtualpc-freebsd4.png alt="virtualpc freebsd4"></div></div><div class=imageblock><div class=content><img src=../../../../images/books/handbook/virtualization/virtualpc-freebsd5.png alt="virtualpc freebsd5"></div></div><div class=paragraph><p>Save and finish the configuration:</p></div><div class=imageblock><div class=content><img src=../../../../images/books/handbook/virtualization/virtualpc-freebsd6.png alt="virtualpc freebsd6"></div></div><div class=paragraph><p>Select the FreeBSD virtual machine and click <b class=menuref>Settings</b>, then set the type of networking and a network interface:</p></div><div class=imageblock><div class=content><img src=../../../../images/books/handbook/virtualization/virtualpc-freebsd7.png alt="virtualpc freebsd7"></div></div><div class=imageblock><div class=content><img src=../../../../images/books/handbook/virtualization/virtualpc-freebsd8.png alt="virtualpc freebsd8"></div></div><div class=paragraph><p>After the FreeBSD virtual machine has been created, FreeBSD can be installed on it. This is best done with an official FreeBSD CD/DVD or with an ISO image downloaded from an official FTP site. Copy the appropriate ISO image to the local Windows® filesystem or insert a CD/DVD in the CD drive, then double click on the FreeBSD virtual machine to boot. Then, click <b class=menuref>CD</b> and choose <b class=menuref>Capture ISO Image…​</b> on the Virtual PC window. This will bring up a window where the CD-ROM drive in the virtual machine can be associated with an ISO file on disk or with the real CD-ROM drive.</p></div><div class=imageblock><div class=content><img src=../../../../images/books/handbook/virtualization/virtualpc-freebsd9.png alt="virtualpc freebsd9"></div></div><div class=imageblock><div class=content><img src=../../../../images/books/handbook/virtualization/virtualpc-freebsd10.png alt="virtualpc freebsd10"></div></div><div class=paragraph><p>Once this association with the CD-ROM source has been made, reboot the FreeBSD virtual machine by clicking <b class=menuref>Action</b> and <b class=menuref>Reset</b>. Virtual PC will reboot with a special BIOS that first checks for a CD-ROM.</p></div><div class=imageblock><div class=content><img src=../../../../images/books/handbook/virtualization/virtualpc-freebsd11.png alt="virtualpc freebsd11"></div></div><div class=paragraph><p>In this case it will find the FreeBSD installation media and begin a normal FreeBSD installation. Continue with the installation, but do not attempt to configure Xorg at this time.</p></div><div class=imageblock><div class=content><img src=../../../../images/books/handbook/virtualization/virtualpc-freebsd12.png alt="virtualpc freebsd12"></div></div><div class=paragraph><p>When the installation is finished, remember to eject the CD/DVD or release the ISO image. Finally, reboot into the newly installed FreeBSD virtual machine.</p></div><div class=imageblock><div class=content><img src=../../../../images/books/handbook/virtualization/virtualpc-freebsd13.png alt="virtualpc freebsd13"></div></div></div><div class=sect3><h4 id=virtualization-guest-virtualpc-configure>21.3.2. Configuring FreeBSD on Virtual PC<a class=anchor href=#virtualization-guest-virtualpc-configure></a></h4><div class=paragraph><p>After FreeBSD has been successfully installed on Microsoft® Windows® with Virtual PC, there are a number of configuration steps that can be taken to optimize the system for virtualized operation.</p></div><div class="olist arabic procedure"><ol class=arabic><li><p>Set Boot Loader Variables</p><div class=paragraph><p>The most important step is to reduce the <code>kern.hz</code> tunable to reduce the CPU utilization of FreeBSD under the Virtual PC environment. This is accomplished by adding the following line to <span class=filename>/boot/loader.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>kern.hz=100</pre></div></div><div class=paragraph><p>Without this setting, an idle FreeBSD Virtual PC guest OS will use roughly 40% of the CPU of a single processor computer. After this change, the usage will be closer to 3%.</p></div></li><li><p>Create a New Kernel Configuration File</p><div class=paragraph><p>All of the SCSI, FireWire, and USB device drivers can be removed from a custom kernel configuration file. Virtual PC provides a virtual network adapter used by the <a href="https://man.freebsd.org/cgi/man.cgi?query=de&amp;sektion=4&amp;format=html">de(4)</a> driver, so all network devices except for <a href="https://man.freebsd.org/cgi/man.cgi?query=de&amp;sektion=4&amp;format=html">de(4)</a> and <a href="https://man.freebsd.org/cgi/man.cgi?query=miibus&amp;sektion=4&amp;format=html">miibus(4)</a> can be removed from the kernel.</p></div></li><li><p>Configure Networking</p><div class=paragraph><p>The most basic networking setup uses DHCP to connect the virtual machine to the same local area network as the Microsoft® Windows® host. This can be accomplished by adding <code>ifconfig_de0="DHCP"</code> to <span class=filename>/etc/rc.conf</span>. More advanced networking setups are described in <a href=./#advanced-networking>Advanced Networking</a>.</p></div></li></ol></div></div></div><div class=sect2><h3 id=virtualization-guest-vmware>21.4. FreeBSD as a Guest on VMware Fusion for Mac OS®<a class=anchor href=#virtualization-guest-vmware></a></h3><div class=paragraph><p>VMware Fusion for Mac® is a commercial software product available for Intel® based Apple® Mac® computers running Mac OS® 10.4.9 or higher. FreeBSD is a fully supported guest operating system. Once VMware Fusion has been installed on Mac OS® X, the user can configure a virtual machine and then install the desired guest operating system.</p></div><div class=sect3><h4 id=virtualization-guest-vmware-install>21.4.1. Installing FreeBSD on VMware Fusion<a class=anchor href=#virtualization-guest-vmware-install></a></h4><div class=paragraph><p>The first step is to start VMware Fusion which will load the Virtual Machine Library. Click <span class=guimenuitem>New</span> to create the virtual machine:</p></div><div class=imageblock><div class=content><img src=../../../../images/books/handbook/virtualization/vmware-freebsd01.png alt="vmware freebsd01"></div></div><div class=paragraph><p>This will load the New Virtual Machine Assistant. Click <span class=guimenuitem>Continue</span> to proceed:</p></div><div class=imageblock><div class=content><img src=../../../../images/books/handbook/virtualization/vmware-freebsd02.png alt="vmware freebsd02"></div></div><div class=paragraph><p>Select <span class=guimenuitem>Other</span> as the <span class=guimenuitem>Operating System</span> and either <span class=guimenuitem>FreeBSD</span> or <span class=guimenuitem>FreeBSD 64-bit</span>, as the <b class=menuref>Version</b> when prompted:</p></div><div class=imageblock><div class=content><img src=../../../../images/books/handbook/virtualization/vmware-freebsd03.png alt="vmware freebsd03"></div></div><div class=paragraph><p>Choose the name of the virtual machine and the directory where it should be saved:</p></div><div class=imageblock><div class=content><img src=../../../../images/books/handbook/virtualization/vmware-freebsd04.png alt="vmware freebsd04"></div></div><div class=paragraph><p>Choose the size of the Virtual Hard Disk for the virtual machine:</p></div><div class=imageblock><div class=content><img src=../../../../images/books/handbook/virtualization/vmware-freebsd05.png alt="vmware freebsd05"></div></div><div class=paragraph><p>Choose the method to install the virtual machine, either from an ISO image or from a CD/DVD:</p></div><div class=imageblock><div class=content><img src=../../../../images/books/handbook/virtualization/vmware-freebsd06.png alt="vmware freebsd06"></div></div><div class=paragraph><p>Click <span class=guimenuitem>Finish</span> and the virtual machine will boot:</p></div><div class=imageblock><div class=content><img src=../../../../images/books/handbook/virtualization/vmware-freebsd07.png alt="vmware freebsd07"></div></div><div class=paragraph><p>Install FreeBSD as usual:</p></div><div class=imageblock><div class=content><img src=../../../../images/books/handbook/virtualization/vmware-freebsd08.png alt="vmware freebsd08"></div></div><div class=paragraph><p>Once the install is complete, the settings of the virtual machine can be modified, such as memory usage:</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>The System Hardware settings of the virtual machine cannot be modified while the virtual machine is running.</p></div></td></tr></tbody></table></div><div class=imageblock><div class=content><img src=../../../../images/books/handbook/virtualization/vmware-freebsd09.png alt="vmware freebsd09"></div></div><div class=paragraph><p>The number of CPUs the virtual machine will have access to:</p></div><div class=imageblock><div class=content><img src=../../../../images/books/handbook/virtualization/vmware-freebsd10.png alt="vmware freebsd10"></div></div><div class=paragraph><p>The status of the CD-ROM device. Normally the CD/DVD/ISO is disconnected from the virtual machine when it is no longer needed.</p></div><div class=imageblock><div class=content><img src=../../../../images/books/handbook/virtualization/vmware-freebsd11.png alt="vmware freebsd11"></div></div><div class=paragraph><p>The last thing to change is how the virtual machine will connect to the network. To allow connections to the virtual machine from other machines besides the host, choose <span class=guimenuitem>Connect directly to the physical network (Bridged)</span>. Otherwise, <span class=guimenuitem>Share the host’s internet connection (NAT)</span> is preferred so that the virtual machine can have access to the Internet, but the network cannot access the virtual machine.</p></div><div class=imageblock><div class=content><img src=../../../../images/books/handbook/virtualization/vmware-freebsd12.png alt="vmware freebsd12"></div></div><div class=paragraph><p>After modifying the settings, boot the newly installed FreeBSD virtual machine.</p></div></div><div class=sect3><h4 id=virtualization-guest-vmware-configure>21.4.2. Configuring FreeBSD on VMware Fusion<a class=anchor href=#virtualization-guest-vmware-configure></a></h4><div class=paragraph><p>After FreeBSD has been successfully installed on Mac OS® X with VMware Fusion, there are a number of configuration steps that can be taken to optimize the system for virtualized operation.</p></div><div class="olist arabic procedure"><ol class=arabic><li><p>Set Boot Loader Variables</p><div class=paragraph><p>The most important step is to reduce the <code>kern.hz</code> tunable to reduce the CPU utilization of FreeBSD under the VMware Fusion environment. This is accomplished by adding the following line to <span class=filename>/boot/loader.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>kern.hz=100</pre></div></div><div class=paragraph><p>Without this setting, an idle FreeBSD VMware Fusion guest will use roughly 15% of the CPU of a single processor iMac®. After this change, the usage will be closer to 5%.</p></div></li><li><p>Create a New Kernel Configuration File</p><div class=paragraph><p>All of the FireWire, and USB device drivers can be removed from a custom kernel configuration file. VMware Fusion provides a virtual network adapter used by the <a href="https://man.freebsd.org/cgi/man.cgi?query=em&amp;sektion=4&amp;format=html">em(4)</a> driver, so all network devices except for <a href="https://man.freebsd.org/cgi/man.cgi?query=em&amp;sektion=4&amp;format=html">em(4)</a> can be removed from the kernel.</p></div></li><li><p>Configure Networking</p><div class=paragraph><p>The most basic networking setup uses DHCP to connect the virtual machine to the same local area network as the host Mac®. This can be accomplished by adding <code>ifconfig_em0="DHCP"</code> to <span class=filename>/etc/rc.conf</span>. More advanced networking setups are described in <a href=./#advanced-networking>Advanced Networking</a>.</p></div></li></ol></div></div></div><div class=sect2><h3 id=virtualization-guest-virtualbox>21.5. FreeBSD as a Guest on VirtualBox™<a class=anchor href=#virtualization-guest-virtualbox></a></h3><div class=paragraph><p>FreeBSD works well as a guest in VirtualBox™. The virtualization software is available for most common operating systems, including FreeBSD itself.</p></div><div class=paragraph><p>The VirtualBox™ guest additions provide support for:</p></div><div class=ulist><ul><li><p>Clipboard sharing.</p></li><li><p>Mouse pointer integration.</p></li><li><p>Host time synchronization.</p></li><li><p>Window scaling.</p></li><li><p>Seamless mode.</p></li></ul></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>These commands are run in the FreeBSD guest.</p></div></td></tr></tbody></table></div><div class=paragraph><p>First, install the <a class=package href=https://cgit.freebsd.org/ports/tree/emulators/virtualbox-ose-additions/>emulators/virtualbox-ose-additions</a> package or port in the FreeBSD guest. This will install the port:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/ports/emulators/virtualbox-ose-additions &amp;&amp; make install clean</span></code></pre></div></div><div class=paragraph><p>Add these lines to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>vboxguest_enable=&#34;YES&#34;
vboxservice_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>If <a href="https://man.freebsd.org/cgi/man.cgi?query=ntpd&amp;sektion=8&amp;format=html">ntpd(8)</a> or <a href="https://man.freebsd.org/cgi/man.cgi?query=ntpdate&amp;sektion=8&amp;format=html">ntpdate(8)</a> is used, disable host time synchronization:</p></div><div class="literalblock programlisting"><div class=content><pre>vboxservice_flags=&#34;--disable-timesync&#34;</pre></div></div><div class=paragraph><p>Xorg will automatically recognize the <code>vboxvideo</code> driver. It can also be manually entered in <span class=filename>/etc/X11/xorg.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>Section &#34;Device&#34;
	Identifier &#34;Card0&#34;
	Driver &#34;vboxvideo&#34;
	VendorName &#34;InnoTek Systemberatung GmbH&#34;
	BoardName &#34;VirtualBox Graphics Adapter&#34;
EndSection</pre></div></div><div class=paragraph><p>To use the <code>vboxmouse</code> driver, adjust the mouse section in <span class=filename>/etc/X11/xorg.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>Section &#34;InputDevice&#34;
	Identifier &#34;Mouse0&#34;
	Driver &#34;vboxmouse&#34;
EndSection</pre></div></div><div class=paragraph><p>HAL users should create the following <span class=filename>/usr/local/etc/hal/fdi/policy/90-vboxguest.fdi</span> or copy it from <span class=filename>/usr/local/shared/hal/fdi/policy/10osvendor/90-vboxguest.fdi</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;
&lt;!--
# Sun VirtualBox
# Hal driver description for the vboxmouse driver
# $Id: chapter.xml,v 1.33 2012-03-17 04:53:52 eadler Exp $

	Copyright (C) 2008-2009 Sun Microsystems, Inc.

	This file is part of VirtualBox Open Source Edition (OSE, as
	available from http://www.virtualbox.org. This file is free software;
	you can redistribute it and/or modify it under the terms of the GNU
	General Public License (GPL) as published by the Free Software
	Foundation, in version 2 as it comes in the &#34;COPYING&#34; file of the
	VirtualBox OSE distribution. VirtualBox OSE is distributed in the
	hope that it will be useful, but WITHOUT ANY WARRANTY of any kind.

	Please contact Sun Microsystems, Inc., 4150 Network Circle, Santa
	Clara, CA 95054 USA or visit http://www.sun.com if you need
	additional information or have any questions.
--&gt;
&lt;deviceinfo version=&#34;0.2&#34;&gt;
  &lt;device&gt;
    &lt;match key=&#34;info.subsystem&#34; string=&#34;pci&#34;&gt;
      &lt;match key=&#34;info.product&#34; string=&#34;VirtualBox guest Service&#34;&gt;
        &lt;append key=&#34;info.capabilities&#34; type=&#34;strlist&#34;&gt;input&lt;/append&gt;
	&lt;append key=&#34;info.capabilities&#34; type=&#34;strlist&#34;&gt;input.mouse&lt;/append&gt;
        &lt;merge key=&#34;input.x11_driver&#34; type=&#34;string&#34;&gt;vboxmouse&lt;/merge&gt;
	&lt;merge key=&#34;input.device&#34; type=&#34;string&#34;&gt;/dev/vboxguest&lt;/merge&gt;
      &lt;/match&gt;
    &lt;/match&gt;
  &lt;/device&gt;
&lt;/deviceinfo&gt;</pre></div></div><div class=paragraph><p>Shared folders for file transfers between host and VM are accessible by mounting them using <code>mount_vboxvfs</code>. A shared folder can be created on the host using the VirtualBox GUI or via <code>vboxmanage</code>. For example, to create a shared folder called <em>myshare</em> under <span class=filename>/mnt/bsdboxshare</span> for the VM named <em>BSDBox</em>, run:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># vboxmanage sharedfolder add &#39;BSDBox&#39; --name myshare --hostpath /mnt/bsdboxshare</span></code></pre></div></div><div class=paragraph><p>Note that the shared folder name must not contain spaces. Mount the shared folder from within the guest system like this:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mount_vboxvfs -w myshare /mnt</span></code></pre></div></div></div><div class=sect2><h3 id=virtualization-host-virtualbox>21.6. FreeBSD as a Host with VirtualBox™<a class=anchor href=#virtualization-host-virtualbox></a></h3><div class=paragraph><p>VirtualBox™ is an actively developed, complete virtualization package, that is available for most operating systems including Windows®, Mac OS®, Linux® and FreeBSD. It is equally capable of running Windows® or UNIX®-like guests. It is released as open source software, but with closed-source components available in a separate extension pack. These components include support for USB 2.0 devices. More information may be found on the <a href=http://www.virtualbox.org/wiki/Downloads>Downloads page of the VirtualBox™ wiki</a>. Currently, these extensions are not available for FreeBSD.</p></div><div class=sect3><h4 id=virtualization-virtualbox-install>21.6.1. Installing VirtualBox™<a class=anchor href=#virtualization-virtualbox-install></a></h4><div class=paragraph><p>VirtualBox™ is available as a FreeBSD package or port in <a class=package href=https://cgit.freebsd.org/ports/tree/emulators/virtualbox-ose/>emulators/virtualbox-ose</a>. The port can be installed using these commands:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/ports/emulators/virtualbox-ose</span>
<span class=c># make install clean</span></code></pre></div></div><div class=paragraph><p>One useful option in the port’s configuration menu is the <code>GuestAdditions</code> suite of programs. These provide a number of useful features in guest operating systems, like mouse pointer integration (allowing the mouse to be shared between host and guest without the need to press a special keyboard shortcut to switch) and faster video rendering, especially in Windows® guests. The guest additions are available in the <b class=menuref>Devices</b> menu, after the installation of the guest is finished.</p></div><div class=paragraph><p>A few configuration changes are needed before VirtualBox™ is started for the first time. The port installs a kernel module in <span class=filename>/boot/modules</span> which must be loaded into the running kernel:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># kldload vboxdrv</span></code></pre></div></div><div class=paragraph><p>To ensure the module is always loaded after a reboot, add this line to <span class=filename>/boot/loader.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>vboxdrv_load=&#34;YES&#34;</pre></div></div><div class=paragraph><p>To use the kernel modules that allow bridged or host-only networking, add this line to <span class=filename>/etc/rc.conf</span> and reboot the computer:</p></div><div class="literalblock programlisting"><div class=content><pre>vboxnet_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>The <code>vboxusers</code> group is created during installation of VirtualBox™. All users that need access to VirtualBox™ will have to be added as members of this group. <code>pw</code> can be used to add new members:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pw groupmod vboxusers -m yourusername</span></code></pre></div></div><div class=paragraph><p>The default permissions for <span class=filename>/dev/vboxnetctl</span> are restrictive and need to be changed for bridged networking:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># chown root:vboxusers /dev/vboxnetctl</span>
<span class=c># chmod 0660 /dev/vboxnetctl</span></code></pre></div></div><div class=paragraph><p>To make this permissions change permanent, add these lines to <span class=filename>/etc/devfs.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>own     vboxnetctl root:vboxusers
perm    vboxnetctl 0660</pre></div></div><div class=paragraph><p>To launch VirtualBox™, type from a Xorg session:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% VirtualBox</code></pre></div></div><div class=paragraph><p>For more information on configuring and using VirtualBox™, refer to the <a href=http://www.virtualbox.org>official website</a>. For FreeBSD-specific information and troubleshooting instructions, refer to the <a href=http://wiki.FreeBSD.org/VirtualBox>relevant page in the FreeBSD wiki</a>.</p></div></div><div class=sect3><h4 id=virtualization-virtualbox-usb-support>21.6.2. VirtualBox™ USB Support<a class=anchor href=#virtualization-virtualbox-usb-support></a></h4><div class=paragraph><p>VirtualBox™ can be configured to pass USB devices through to the guest operating system. The host controller of the OSE version is limited to emulating USB 1.1 devices until the extension pack supporting USB 2.0 and 3.0 devices becomes available on FreeBSD.</p></div><div class=paragraph><p>For VirtualBox™ to be aware of USB devices attached to the machine, the user needs to be a member of the <code>operator</code> group.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pw groupmod operator -m yourusername</span></code></pre></div></div><div class=paragraph><p>Then, add the following to <span class=filename>/etc/devfs.rules</span>, or create this file if it does not exist yet:</p></div><div class="literalblock programlisting"><div class=content><pre>[system=10]
add path &#39;usb/*&#39; mode 0660 group operator</pre></div></div><div class=paragraph><p>To load these new rules, add the following to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>devfs_system_ruleset=&#34;system&#34;</pre></div></div><div class=paragraph><p>Then, restart devfs:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service devfs restart</span></code></pre></div></div><div class=paragraph><p>Restart the login session and VirtualBox™ for these changes to take effect, and create USB filters as necessary.</p></div></div><div class=sect3><h4 id=virtualization-virtualbox-host-dvd-cd-access>21.6.3. VirtualBox™ Host DVD/CD Access<a class=anchor href=#virtualization-virtualbox-host-dvd-cd-access></a></h4><div class=paragraph><p>Access to the host DVD/CD drives from guests is achieved through the sharing of the physical drives. Within VirtualBox™, this is set up from the Storage window in the Settings of the virtual machine. If needed, create an empty IDECD/DVD device first. Then choose the Host Drive from the popup menu for the virtual CD/DVD drive selection. A checkbox labeled <code>Passthrough</code> will appear. This allows the virtual machine to use the hardware directly. For example, audio CDs or the burner will only function if this option is selected.</p></div><div class=paragraph><p>HAL needs to run for VirtualBox™DVD/CD functions to work, so enable it in <span class=filename>/etc/rc.conf</span> and start it if it is not already running:</p></div><div class="literalblock programlisting"><div class=content><pre>hald_enable=&#34;YES&#34;</pre></div></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service hald start</span></code></pre></div></div><div class=paragraph><p>In order for users to be able to use VirtualBox™DVD/CD functions, they need access to <span class=filename>/dev/xpt0</span>, <span class=filename>/dev/cdN</span>, and <span class=filename>/dev/passN</span>. This is usually achieved by making the user a member of <code>operator</code>. Permissions to these devices have to be corrected by adding these lines to <span class=filename>/etc/devfs.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>perm cd* 0660
perm xpt0 0660
perm pass* 0660</pre></div></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service devfs restart</span></code></pre></div></div></div></div><div class=sect2><h3 id=virtualization-host-bhyve>21.7. FreeBSD as a Host with bhyve<a class=anchor href=#virtualization-host-bhyve></a></h3><div class=paragraph><p>The bhyveBSD-licensed hypervisor became part of the base system with FreeBSD 10.0-RELEASE. This hypervisor supports a number of guests, including FreeBSD, OpenBSD, and many Linux® distributions. By default, bhyve provides access to serial console and does not emulate a graphical console. Virtualization offload features of newer CPUs are used to avoid the legacy methods of translating instructions and manually managing memory mappings.</p></div><div class=paragraph><p>The bhyve design requires a processor that supports Intel® Extended Page Tables (EPT) or AMD® Rapid Virtualization Indexing (RVI) or Nested Page Tables (NPT). Hosting Linux® guests or FreeBSD guests with more than one vCPU requires VMX unrestricted mode support (UG). Most newer processors, specifically the Intel® Core™ i3/i5/i7 and Intel® Xeon™ E3/E5/E7, support these features. UG support was introduced with Intel’s Westmere micro-architecture. For a complete list of Intel® processors that support EPT, refer to <a href="https://ark.intel.com/content/www/us/en/ark/search/featurefilter.html?productType=873&amp;0_ExtendedPageTables=True" class=bare>https://ark.intel.com/content/www/us/en/ark/search/featurefilter.html?productType=873&amp;0_ExtendedPageTables=True</a>. RVI is found on the third generation and later of the AMD Opteron™ (Barcelona) processors. The easiest way to tell if a processor supports bhyve is to run <code>dmesg</code> or look in <span class=filename>/var/run/dmesg.boot</span> for the <code>POPCNT</code> processor feature flag on the <code>Features2</code> line for AMD® processors or <code>EPT</code> and <code>UG</code> on the <code>VT-x</code> line for Intel® processors.</p></div><div class=sect3><h4 id=virtualization-bhyve-prep>21.7.1. Preparing the Host<a class=anchor href=#virtualization-bhyve-prep></a></h4><div class=paragraph><p>The first step to creating a virtual machine in bhyve is configuring the host system. First, load the bhyve kernel module:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># kldload vmm</span></code></pre></div></div><div class=paragraph><p>Then, create a <span class=filename>tap</span> interface for the network device in the virtual machine to attach to. In order for the network device to participate in the network, also create a bridge interface containing the <span class=filename>tap</span> interface and the physical interface as members. In this example, the physical interface is <em>igb0</em>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig tap0 create</span>
<span class=c># sysctl net.link.tap.up_on_open=1</span>
net.link.tap.up_on_open: 0 -&gt; 1
<span class=c># ifconfig bridge0 create</span>
<span class=c># ifconfig bridge0 addm igb0 addm tap0</span>
<span class=c># ifconfig bridge0 up</span></code></pre></div></div></div><div class=sect3><h4 id=virtualization-bhyve-freebsd>21.7.2. Creating a FreeBSD Guest<a class=anchor href=#virtualization-bhyve-freebsd></a></h4><div class=paragraph><p>Create a file to use as the virtual disk for the guest machine. Specify the size and name of the virtual disk:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># truncate -s 16G guest.img</span></code></pre></div></div><div class=paragraph><p>Download an installation image of FreeBSD to install:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># fetch ftp://ftp.freebsd.org/pub/FreeBSD/releases/ISO-IMAGES/10.3/FreeBSD-10.3-RELEASE-amd64-bootonly.iso</span>
FreeBSD-10.3-RELEASE-amd64-bootonly.iso       100% of  230 MB  570 kBps 06m17s</code></pre></div></div><div class=paragraph><p>FreeBSD comes with an example script for running a virtual machine in bhyve. The script will start the virtual machine and run it in a loop, so it will automatically restart if it crashes. The script takes a number of options to control the configuration of the machine: <code>-c</code> controls the number of virtual CPUs, <code>-m</code> limits the amount of memory available to the guest, <code>-t</code> defines which <span class=filename>tap</span> device to use, <code>-d</code> indicates which disk image to use, <code>-i</code> tells bhyve to boot from the CD image instead of the disk, and <code>-I</code> defines which CD image to use. The last parameter is the name of the virtual machine, used to track the running machines. This example starts the virtual machine in installation mode:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sh /usr/shared/examples/bhyve/vmrun.sh -c 1 -m 1024M -t tap0 -d guest.img -i -I FreeBSD-10.3-RELEASE-amd64-bootonly.iso guestname</span></code></pre></div></div><div class=paragraph><p>The virtual machine will boot and start the installer. After installing a system in the virtual machine, when the system asks about dropping in to a shell at the end of the installation, choose <b class=button>Yes</b>.</p></div><div class=paragraph><p>Reboot the virtual machine. While rebooting the virtual machine causes bhyve to exit, the <span class=filename>vmrun.sh</span> script runs <code>bhyve</code> in a loop and will automatically restart it. When this happens, choose the reboot option from the boot loader menu in order to escape the loop. Now the guest can be started from the virtual disk:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sh /usr/shared/examples/bhyve/vmrun.sh -c 4 -m 1024M -t tap0 -d guest.img guestname</span></code></pre></div></div></div><div class=sect3><h4 id=virtualization-bhyve-linux>21.7.3. Creating a Linux® Guest<a class=anchor href=#virtualization-bhyve-linux></a></h4><div class=paragraph><p>In order to boot operating systems other than FreeBSD, the <a class=package href=https://cgit.freebsd.org/ports/tree/sysutils/grub2-bhyve/>sysutils/grub2-bhyve</a> port must be first installed.</p></div><div class=paragraph><p>Next, create a file to use as the virtual disk for the guest machine:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># truncate -s 16G linux.img</span></code></pre></div></div><div class=paragraph><p>Starting a virtual machine with bhyve is a two step process. First a kernel must be loaded, then the guest can be started. The Linux® kernel is loaded with <a class=package href=https://cgit.freebsd.org/ports/tree/sysutils/grub2-bhyve/>sysutils/grub2-bhyve</a>. Create a <span class=filename>device.map</span> that grub will use to map the virtual devices to the files on the host system:</p></div><div class="literalblock programlisting"><div class=content><pre>(hd0) ./linux.img
(cd0) ./somelinux.iso</pre></div></div><div class=paragraph><p>Use <a class=package href=https://cgit.freebsd.org/ports/tree/sysutils/grub2-bhyve/>sysutils/grub2-bhyve</a> to load the Linux® kernel from the ISO image:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># grub-bhyve -m device.map -r cd0 -M 1024M linuxguest</span></code></pre></div></div><div class=paragraph><p>This will start grub. If the installation CD contains a <span class=filename>grub.cfg</span>, a menu will be displayed. If not, the <code>vmlinuz</code> and <code>initrd</code> files must be located and loaded manually:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>grub&gt; <span class=nb>ls</span>
<span class=o>(</span>hd0<span class=o>)</span> <span class=o>(</span>cd0<span class=o>)</span> <span class=o>(</span>cd0,msdos1<span class=o>)</span> <span class=o>(</span>host<span class=o>)</span>
grub&gt; <span class=nb>ls</span> <span class=o>(</span>cd0<span class=o>)</span>/isolinux
boot.cat boot.msg grub.conf initrd.img isolinux.bin isolinux.cfg memtest
splash.jpg TRANS.TBL vesamenu.c32 vmlinuz
grub&gt; linux <span class=o>(</span>cd0<span class=o>)</span>/isolinux/vmlinuz
grub&gt; initrd <span class=o>(</span>cd0<span class=o>)</span>/isolinux/initrd.img
grub&gt; boot</code></pre></div></div><div class=paragraph><p>Now that the Linux® kernel is loaded, the guest can be started:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># bhyve -A -H -P -s 0:0,hostbridge -s 1:0,lpc -s 2:0,virtio-net,tap0 -s 3:0,virtio-blk,./linux.img \</span>
    <span class=nt>-s</span> 4:0,ahci-cd,./somelinux.iso <span class=nt>-l</span> com1,stdio <span class=nt>-c</span> 4 <span class=nt>-m</span> 1024M linuxguest</code></pre></div></div><div class=paragraph><p>The system will boot and start the installer. After installing a system in the virtual machine, reboot the virtual machine. This will cause bhyve to exit. The instance of the virtual machine needs to be destroyed before it can be started again:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># bhyvectl --destroy --vm=linuxguest</span></code></pre></div></div><div class=paragraph><p>Now the guest can be started directly from the virtual disk. Load the kernel:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># grub-bhyve -m device.map -r hd0,msdos1 -M 1024M linuxguest</span>
grub&gt; <span class=nb>ls</span>
<span class=o>(</span>hd0<span class=o>)</span> <span class=o>(</span>hd0,msdos2<span class=o>)</span> <span class=o>(</span>hd0,msdos1<span class=o>)</span> <span class=o>(</span>cd0<span class=o>)</span> <span class=o>(</span>cd0,msdos1<span class=o>)</span> <span class=o>(</span>host<span class=o>)</span>
<span class=o>(</span>lvm/VolGroup-lv_swap<span class=o>)</span> <span class=o>(</span>lvm/VolGroup-lv_root<span class=o>)</span>
grub&gt; <span class=nb>ls</span> <span class=o>(</span>hd0,msdos1<span class=o>)</span>/
lost+found/ grub/ efi/ System.map-2.6.32-431.el6.x86_64 config-2.6.32-431.el6.x
86_64 symvers-2.6.32-431.el6.x86_64.gz vmlinuz-2.6.32-431.el6.x86_64
initramfs-2.6.32-431.el6.x86_64.img
grub&gt; linux <span class=o>(</span>hd0,msdos1<span class=o>)</span>/vmlinuz-2.6.32-431.el6.x86_64 <span class=nv>root</span><span class=o>=</span>/dev/mapper/VolGroup-lv_root
grub&gt; initrd <span class=o>(</span>hd0,msdos1<span class=o>)</span>/initramfs-2.6.32-431.el6.x86_64.img
grub&gt; boot</code></pre></div></div><div class=paragraph><p>Boot the virtual machine:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># bhyve -A -H -P -s 0:0,hostbridge -s 1:0,lpc -s 2:0,virtio-net,tap0 \</span>
    <span class=nt>-s</span> 3:0,virtio-blk,./linux.img <span class=nt>-l</span> com1,stdio <span class=nt>-c</span> 4 <span class=nt>-m</span> 1024M linuxguest</code></pre></div></div><div class=paragraph><p>Linux® will now boot in the virtual machine and eventually present you with the login prompt. Login and use the virtual machine. When you are finished, reboot the virtual machine to exit bhyve. Destroy the virtual machine instance:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># bhyvectl --destroy --vm=linuxguest</span></code></pre></div></div></div><div class=sect3><h4 id=virtualization-bhyve-uefi>21.7.4. Booting bhyve Virtual Machines with UEFI Firmware<a class=anchor href=#virtualization-bhyve-uefi></a></h4><div class=paragraph><p>In addition to bhyveload and grub-bhyve, the bhyve hypervisor can also boot virtual machines using the UEFI userspace firmware. This option may support guest operating systems that are not supported by the other loaders.</p></div><div class=paragraph><p>In order to make use of the UEFI support in bhyve, first obtain the UEFI firmware images. This can be done by installing <a class=package href=https://cgit.freebsd.org/ports/tree/sysutils/bhyve-firmware/>sysutils/bhyve-firmware</a> port or package.</p></div><div class=paragraph><p>With the firmware in place, add the flags <code>-l bootrom,<em>/path/to/firmware</em></code> to your bhyve command line. The actual bhyve command may look like this:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># bhyve -AHP -s 0:0,hostbridge -s 1:0,lpc \</span>
<span class=nt>-s</span> 2:0,virtio-net,tap1 <span class=nt>-s</span> 3:0,virtio-blk,./disk.img <span class=se>\</span>
<span class=nt>-s</span> 4:0,ahci-cd,./install.iso <span class=nt>-c</span> 4 <span class=nt>-m</span> 1024M <span class=se>\</span>
<span class=nt>-l</span> bootrom,/usr/local/shared/uefi-firmware/BHYVE_UEFI.fd <span class=se>\</span>
guest</code></pre></div></div><div class=paragraph><p><a class=package href=https://cgit.freebsd.org/ports/tree/sysutils/bhyve-firmware/>sysutils/bhyve-firmware</a> also contains a CSM-enabled firmware, to boot guests with no UEFI support in legacy BIOS mode:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># bhyve -AHP -s 0:0,hostbridge -s 1:0,lpc \</span>
<span class=nt>-s</span> 2:0,virtio-net,tap1 <span class=nt>-s</span> 3:0,virtio-blk,./disk.img <span class=se>\</span>
<span class=nt>-s</span> 4:0,ahci-cd,./install.iso <span class=nt>-c</span> 4 <span class=nt>-m</span> 1024M <span class=se>\</span>
<span class=nt>-l</span> bootrom,/usr/local/shared/uefi-firmware/BHYVE_UEFI_CSM.fd <span class=se>\</span>
guest</code></pre></div></div></div><div class=sect3><h4 id=virtualization-bhyve-framebuffer>21.7.5. Graphical UEFI Framebuffer for bhyve Guests<a class=anchor href=#virtualization-bhyve-framebuffer></a></h4><div class=paragraph><p>The UEFI firmware support is particularly useful with predominantly graphical guest operating systems such as Microsoft Windows®.</p></div><div class=paragraph><p>Support for the UEFI-GOP framebuffer may also be enabled with the <code>-s 29,fbuf,tcp=<em>0.0.0.0:5900</em></code> flags. The framebuffer resolution may be configured with <code>w=<em>800</em></code> and <code>h=<em>600</em></code>, and bhyve can be instructed to wait for a VNC connection before booting the guest by adding <code>wait</code>. The framebuffer may be accessed from the host or over the network via the VNC protocol. Additionally, <code>-s 30,xhci,tablet</code> can be added to achieve precise mouse cursor synchronization with the host.</p></div><div class=paragraph><p>The resulting bhyve command would look like this:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># bhyve -AHP -s 0:0,hostbridge -s 31:0,lpc \</span>
<span class=nt>-s</span> 2:0,virtio-net,tap1 <span class=nt>-s</span> 3:0,virtio-blk,./disk.img <span class=se>\</span>
<span class=nt>-s</span> 4:0,ahci-cd,./install.iso <span class=nt>-c</span> 4 <span class=nt>-m</span> 1024M <span class=se>\</span>
<span class=nt>-s</span> 29,fbuf,tcp<span class=o>=</span>0.0.0.0:5900,w<span class=o>=</span>800,h<span class=o>=</span>600,wait <span class=se>\</span>
<span class=nt>-s</span> 30,xhci,tablet <span class=se>\</span>
<span class=nt>-l</span> bootrom,/usr/local/shared/uefi-firmware/BHYVE_UEFI.fd <span class=se>\</span>
guest</code></pre></div></div><div class=paragraph><p>Note, in BIOS emulation mode, the framebuffer will cease receiving updates once control is passed from firmware to guest operating system.</p></div></div><div class=sect3><h4 id=virtualization-bhyve-zfs>21.7.6. Using ZFS with bhyve Guests<a class=anchor href=#virtualization-bhyve-zfs></a></h4><div class=paragraph><p>If ZFS is available on the host machine, using ZFS volumes instead of disk image files can provide significant performance benefits for the guest VMs. A ZFS volume can be created by:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zfs create -V16G -o volmode=dev zroot/linuxdisk0</span></code></pre></div></div><div class=paragraph><p>When starting the VM, specify the ZFS volume as the disk drive:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># bhyve -A -H -P -s 0:0,hostbridge -s 1:0,lpc -s 2:0,virtio-net,tap0 -s3:0,virtio-blk,/dev/zvol/zroot/linuxdisk0 \</span>
    <span class=nt>-l</span> com1,stdio <span class=nt>-c</span> 4 <span class=nt>-m</span> 1024M linuxguest</code></pre></div></div></div><div class=sect3><h4 id=virtualization-bhyve-nmdm>21.7.7. Virtual Machine Consoles<a class=anchor href=#virtualization-bhyve-nmdm></a></h4><div class=paragraph><p>It is advantageous to wrap the bhyve console in a session management tool such as <a class=package href=https://cgit.freebsd.org/ports/tree/sysutils/tmux/>sysutils/tmux</a> or <a class=package href=https://cgit.freebsd.org/ports/tree/sysutils/screen/>sysutils/screen</a> in order to detach and reattach to the console. It is also possible to have the console of bhyve be a null modem device that can be accessed with <code>cu</code>. To do this, load the <span class=filename>nmdm</span> kernel module and replace <code>-l com1,stdio</code> with <code>-l com1,/dev/nmdm0A</code>. The <span class=filename>/dev/nmdm</span> devices are created automatically as needed, where each is a pair, corresponding to the two ends of the null modem cable (<span class=filename>/dev/nmdm0A</span> and <span class=filename>/dev/nmdm0B</span>). See <a href="https://man.freebsd.org/cgi/man.cgi?query=nmdm&amp;sektion=4&amp;format=html">nmdm(4)</a> for more information.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># kldload nmdm</span>
<span class=c># bhyve -A -H -P -s 0:0,hostbridge -s 1:0,lpc -s 2:0,virtio-net,tap0 -s 3:0,virtio-blk,./linux.img \</span>
    <span class=nt>-l</span> com1,/dev/nmdm0A <span class=nt>-c</span> 4 <span class=nt>-m</span> 1024M linuxguest
<span class=c># cu -l /dev/nmdm0B</span>
Connected

Ubuntu 13.10 handbook ttyS0

handbook login:</code></pre></div></div></div><div class=sect3><h4 id=virtualization-bhyve-managing>21.7.8. Managing Virtual Machines<a class=anchor href=#virtualization-bhyve-managing></a></h4><div class=paragraph><p>A device node is created in <span class=filename>/dev/vmm</span> for each virtual machine. This allows the administrator to easily see a list of the running virtual machines:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ls -al /dev/vmm</span>
total 1
dr-xr-xr-x   2 root  wheel    512 Mar 17 12:19 ./
dr-xr-xr-x  14 root  wheel    512 Mar 17 06:38 ../
crw-------   1 root  wheel  0x1a2 Mar 17 12:20 guestname
crw-------   1 root  wheel  0x19f Mar 17 12:19 linuxguest
crw-------   1 root  wheel  0x1a1 Mar 17 12:19 otherguest</code></pre></div></div><div class=paragraph><p>A specified virtual machine can be destroyed using <code>bhyvectl</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># bhyvectl --destroy --vm=guestname</span></code></pre></div></div></div><div class=sect3><h4 id=virtualization-bhyve-onboot>21.7.9. Persistent Configuration<a class=anchor href=#virtualization-bhyve-onboot></a></h4><div class=paragraph><p>In order to configure the system to start bhyve guests at boot time, the following configurations must be made in the specified files:</p></div><div class="olist arabic procedure"><ol class=arabic><li><p><span class=filename>/etc/sysctl.conf</span></p><div class="literalblock programlisting"><div class=content><pre>net.link.tap.up_on_open=1</pre></div></div></li><li><p><span class=filename>/etc/rc.conf</span></p><div class="literalblock programlisting"><div class=content><pre>cloned_interfaces=&#34;bridge0 tap0&#34;
ifconfig_bridge0=&#34;addm igb0 addm tap0&#34;
kld_list=&#34;nmdm vmm&#34;</pre></div></div></li></ol></div></div></div><div class=sect2><h3 id=virtualization-host-xen>21.8. FreeBSD as a Xen™-Host<a class=anchor href=#virtualization-host-xen></a></h3><div class=paragraph><p>Xen is a GPLv2-licensed <a href=https://en.wikipedia.org/wiki/Hypervisor#Classification>type 1 hypervisor</a> for Intel® and ARM® architectures. FreeBSD has included i386™ and AMD® 64-Bit <a href=https://wiki.xenproject.org/wiki/DomU>DomU</a> and <a href=https://en.wikipedia.org/wiki/Amazon_Elastic_Compute_Cloud>Amazon EC2</a> unprivileged domain (virtual machine) support since FreeBSD 8.0 and includes Dom0 control domain (host) support in FreeBSD 11.0. Support for para-virtualized (PV) domains has been removed from FreeBSD 11 in favor of hardware virtualized (HVM) domains, which provides better performance.</p></div><div class=paragraph><p>Xen™ is a bare-metal hypervisor, which means that it is the first program loaded after the BIOS. A special privileged guest called the Domain-0 (<code>Dom0</code> for short) is then started. The Dom0 uses its special privileges to directly access the underlying physical hardware, making it a high-performance solution. It is able to access the disk controllers and network adapters directly. The Xen™ management tools to manage and control the Xen™ hypervisor are also used by the Dom0 to create, list, and destroy VMs. Dom0 provides virtual disks and networking for unprivileged domains, often called <code>DomU</code>. Xen™ Dom0 can be compared to the service console of other hypervisor solutions, while the DomU is where individual guest VMs are run.</p></div><div class=paragraph><p>Xen™ can migrate VMs between different Xen™ servers. When the two xen hosts share the same underlying storage, the migration can be done without having to shut the VM down first. Instead, the migration is performed live while the DomU is running and there is no need to restart it or plan a downtime. This is useful in maintenance scenarios or upgrade windows to ensure that the services provided by the DomU are still provided. Many more features of Xen™ are listed on the <a href=https://wiki.xenproject.org/wiki/Category:Overview>Xen Wiki Overview page</a>. Note that not all features are supported on FreeBSD yet.</p></div><div class=sect3><h4 id=virtualization-host-xen-requirements>21.8.1. Hardware Requirements for Xen™ Dom0<a class=anchor href=#virtualization-host-xen-requirements></a></h4><div class=paragraph><p>To run the Xen™ hypervisor on a host, certain hardware functionality is required. Hardware virtualized domains require Extended Page Table (<a href=http://en.wikipedia.org/wiki/Extended_Page_Table>EPT</a>) and Input/Output Memory Management Unit (<a href=http://en.wikipedia.org/wiki/List_of_IOMMU-supporting_hardware>IOMMU</a>) support in the host processor.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>In order to run a FreeBSD Xen™ Dom0 the box must be booted using legacy boot (BIOS).</p></div></td></tr></tbody></table></div></div><div class=sect3><h4 id=virtualization-host-xen-dom0-setup>21.8.2. Xen™ Dom0 Control Domain Setup<a class=anchor href=#virtualization-host-xen-dom0-setup></a></h4><div class=paragraph><p>Users of FreeBSD 11 should install the <a class=package href=https://cgit.freebsd.org/ports/tree/emulators/xen-kernel47/>emulators/xen-kernel47</a> and <a class=package href=https://cgit.freebsd.org/ports/tree/sysutils/xen-tools47/>sysutils/xen-tools47</a> packages that are based on Xen version 4.7. Systems running on FreeBSD-12.0 or newer can use Xen 4.11 provided by <a class=package href=https://cgit.freebsd.org/ports/tree/emulators/xen-kernel411/>emulators/xen-kernel411</a> and <a class=package href=https://cgit.freebsd.org/ports/tree/sysutils/xen-tools411/>sysutils/xen-tools411</a>, respectively.</p></div><div class=paragraph><p>Configuration files must be edited to prepare the host for the Dom0 integration after the Xen packages are installed. An entry to <span class=filename>/etc/sysctl.conf</span> disables the limit on how many pages of memory are allowed to be wired. Otherwise, DomU VMs with higher memory requirements will not run.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># echo &#39;vm.max_wired=-1&#39; &gt;&gt; /etc/sysctl.conf</span></code></pre></div></div><div class=paragraph><p>Another memory-related setting involves changing <span class=filename>/etc/login.conf</span>, setting the <code>memorylocked</code> option to <code>unlimited</code>. Otherwise, creating DomU domains may fail with <code>Cannot allocate memory</code> errors. After making the change to <span class=filename>/etc/login.conf</span>, run <code>cap_mkdb</code> to update the capability database. See <a href=./#security-resourcelimits>Resource Limits</a> for details.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sed -i &#39;&#39; -e &#39;s/memorylocked=64K/memorylocked=unlimited/&#39; /etc/login.conf</span>
<span class=c># cap_mkdb /etc/login.conf</span></code></pre></div></div><div class=paragraph><p>Add an entry for the Xen™ console to <span class=filename>/etc/ttys</span>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># echo &#39;xc0     &#34;/usr/libexec/getty Pc&#34;         xterm   onifconsole  secure&#39; &gt;&gt; /etc/ttys</span></code></pre></div></div><div class=paragraph><p>Selecting a Xen™ kernel in <span class=filename>/boot/loader.conf</span> activates the Dom0. Xen™ also requires resources like CPU and memory from the host machine for itself and other DomU domains. How much CPU and memory depends on the individual requirements and hardware capabilities. In this example, 8 GB of memory and 4 virtual CPUs are made available for the Dom0. The serial console is also activated and logging options are defined.</p></div><div class=paragraph><p>The following command is used for Xen 4.7 packages:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sysrc -f /boot/loader.conf hw.pci.mcfg=0</span>
<span class=c># sysrc -f /boot/loader.conf if_tap_load=&#34;YES&#34;</span>
<span class=c># sysrc -f /boot/loader.conf xen_kernel=&#34;/boot/xen&#34;</span>
<span class=c># sysrc -f /boot/loader.conf xen_cmdline=&#34;dom0_mem=8192M dom0_max_vcpus=4 dom0pvh=1 console=com1,vga com1=115200,8n1 guest_loglvl=all loglvl=all&#34;</span></code></pre></div></div><div class=paragraph><p>For Xen versions 4.11 and higher, the following command should be used instead:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sysrc -f /boot/loader.conf if_tap_load=&#34;YES&#34;</span>
<span class=c># sysrc -f /boot/loader.conf xen_kernel=&#34;/boot/xen&#34;</span>
<span class=c># sysrc -f /boot/loader.conf xen_cmdline=&#34;dom0_mem=8192M dom0_max_vcpus=4 dom0=pvh console=com1,vga com1=115200,8n1 guest_loglvl=all loglvl=all&#34;</span></code></pre></div></div><div class="admonitionblock tip"><table><tbody><tr><td class=icon><i class="fa icon-tip" title=Tip></i></td><td class=content><div class=paragraph><p>Log files that Xen™ creates for the DomU VMs are stored in <span class=filename>/var/log/xen</span>. Please be sure to check the contents of that directory if experiencing issues.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Activate the xencommons service during system startup:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sysrc xencommons_enable=yes</span></code></pre></div></div><div class=paragraph><p>These settings are enough to start a Dom0-enabled system. However, it lacks network functionality for the DomU machines. To fix that, define a bridged interface with the main NIC of the system which the DomU VMs can use to connect to the network. Replace <em>em0</em> with the host network interface name.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sysrc cloned_interfaces=&#34;bridge0&#34;</span>
<span class=c># sysrc ifconfig_bridge0=&#34;addm em0 SYNCDHCP&#34;</span>
<span class=c># sysrc ifconfig_em0=&#34;up&#34;</span></code></pre></div></div><div class=paragraph><p>Restart the host to load the Xen™ kernel and start the Dom0.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># reboot</span></code></pre></div></div><div class=paragraph><p>After successfully booting the Xen™ kernel and logging into the system again, the Xen™ management tool <code>xl</code> is used to show information about the domains.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># xl list</span>
Name                                        ID   Mem VCPUs      State   Time<span class=o>(</span>s<span class=o>)</span>
Domain-0                                     0  8192     4     r-----     962.0</code></pre></div></div><div class=paragraph><p>The output confirms that the Dom0 (called <code>Domain-0</code>) has the ID <code>0</code> and is running. It also has the memory and virtual CPUs that were defined in <span class=filename>/boot/loader.conf</span> earlier. More information can be found in the <a href=https://www.xenproject.org/help/documentation.html>Xen™ Documentation</a>. DomU guest VMs can now be created.</p></div></div><div class=sect3><h4 id=virtualization-host-xen-domu-setup>21.8.3. Xen™ DomU Guest VM Configuration<a class=anchor href=#virtualization-host-xen-domu-setup></a></h4><div class=paragraph><p>Unprivileged domains consist of a configuration file and virtual or physical hard disks. Virtual disk storage for the DomU can be files created by <a href="https://man.freebsd.org/cgi/man.cgi?query=truncate&amp;sektion=1&amp;format=html">truncate(1)</a> or ZFS volumes as described in <a href=./#zfs-zfs-volume>“Creating and Destroying Volumes”</a>. In this example, a 20 GB volume is used. A VM is created with the ZFS volume, a FreeBSD ISO image, 1 GB of RAM and two virtual CPUs. The ISO installation file is retrieved with <a href="https://man.freebsd.org/cgi/man.cgi?query=fetch&amp;sektion=1&amp;format=html">fetch(1)</a> and saved locally in a file called <span class=filename>freebsd.iso</span>.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># fetch ftp://ftp.freebsd.org/pub/FreeBSD/releases/ISO-IMAGES/12.0/FreeBSD-12.0-RELEASE-amd64-bootonly.iso -o freebsd.iso</span></code></pre></div></div><div class=paragraph><p>A ZFS volume of 20 GB called <span class=filename>xendisk0</span> is created to serve as the disk space for the VM.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zfs create -V20G -o volmode=dev zroot/xendisk0</span></code></pre></div></div><div class=paragraph><p>The new DomU guest VM is defined in a file. Some specific definitions like name, keymap, and VNC connection details are also defined. The following <span class=filename>freebsd.cfg</span> contains a minimum DomU configuration for this example:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cat freebsd.cfg</span>
builder <span class=o>=</span> <span class=s2>&#34;hvm&#34;</span> <i class=conum data-value=1></i><b>(1)</b>
name <span class=o>=</span> <span class=s2>&#34;freebsd&#34;</span> <i class=conum data-value=2></i><b>(2)</b>
memory <span class=o>=</span> 1024 <i class=conum data-value=3></i><b>(3)</b>
vcpus <span class=o>=</span> 2 <i class=conum data-value=4></i><b>(4)</b>
vif <span class=o>=</span> <span class=o>[</span> <span class=s1>&#39;mac=00:16:3E:74:34:32,bridge=bridge0&#39;</span> <span class=o>]</span> <i class=conum data-value=5></i><b>(5)</b>
disk <span class=o>=</span> <span class=o>[</span>
<span class=s1>&#39;/dev/zvol/tank/xendisk0,raw,hda,rw&#39;</span>, <i class=conum data-value=6></i><b>(6)</b>
<span class=s1>&#39;/root/freebsd.iso,raw,hdc:cdrom,r&#39;</span> <i class=conum data-value=7></i><b>(7)</b>
  <span class=o>]</span>
vnc <span class=o>=</span> 1 <i class=conum data-value=8></i><b>(8)</b>
vnclisten <span class=o>=</span> <span class=s2>&#34;0.0.0.0&#34;</span>
serial <span class=o>=</span> <span class=s2>&#34;pty&#34;</span>
usbdevice <span class=o>=</span> <span class=s2>&#34;tablet&#34;</span></code></pre></div></div><div class=paragraph><p>These lines are explained in more detail:</p></div><div class="colist arabic"><table><tbody><tr><td><i class=conum data-value=1></i><b>1</b></td><td>This defines what kind of virtualization to use. <code>hvm</code> refers to hardware-assisted virtualization or hardware virtual machine. Guest operating systems can run unmodified on CPUs with virtualization extensions, providing nearly the same performance as running on physical hardware. <code>generic</code> is the default value and creates a PV domain.</td></tr><tr><td><i class=conum data-value=2></i><b>2</b></td><td>Name of this virtual machine to distinguish it from others running on the same Dom0. Required.</td></tr><tr><td><i class=conum data-value=3></i><b>3</b></td><td>Quantity of RAM in megabytes to make available to the VM. This amount is subtracted from the hypervisor’s total available memory, not the memory of the Dom0.</td></tr><tr><td><i class=conum data-value=4></i><b>4</b></td><td>Number of virtual CPUs available to the guest VM. For best performance, do not create guests with more virtual CPUs than the number of physical CPUs on the host.</td></tr><tr><td><i class=conum data-value=5></i><b>5</b></td><td>Virtual network adapter. This is the bridge connected to the network interface of the host. The <code>mac</code> parameter is the MAC address set on the virtual network interface. This parameter is optional, if no MAC is provided Xen™ will generate a random one.</td></tr><tr><td><i class=conum data-value=6></i><b>6</b></td><td>Full path to the disk, file, or ZFS volume of the disk storage for this VM. Options and multiple disk definitions are separated by commas.</td></tr><tr><td><i class=conum data-value=7></i><b>7</b></td><td>Defines the Boot medium from which the initial operating system is installed. In this example, it is the ISO imaged downloaded earlier. Consult the Xen™ documentation for other kinds of devices and options to set.</td></tr><tr><td><i class=conum data-value=8></i><b>8</b></td><td>Options controlling VNC connectivity to the serial console of the DomU. In order, these are: active VNC support, define IP address on which to listen, device node for the serial console, and the input method for precise positioning of the mouse and other input methods. <code>keymap</code> defines which keymap to use, and is <code>english</code> by default.</td></tr></tbody></table></div><div class=paragraph><p>After the file has been created with all the necessary options, the DomU is created by passing it to <code>xl create</code> as a parameter.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># xl create freebsd.cfg</span></code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Each time the Dom0 is restarted, the configuration file must be passed to <code>xl create</code> again to re-create the DomU. By default, only the Dom0 is created after a reboot, not the individual VMs. The VMs can continue where they left off as they stored the operating system on the virtual disk. The virtual machine configuration can change over time (for example, when adding more memory). The virtual machine configuration files must be properly backed up and kept available to be able to re-create the guest VM when needed.</p></div></td></tr></tbody></table></div><div class=paragraph><p>The output of <code>xl list</code> confirms that the DomU has been created.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># xl list</span>
Name                                        ID   Mem VCPUs      State   Time<span class=o>(</span>s<span class=o>)</span>
Domain-0                                     0  8192     4     r-----  1653.4
freebsd                                      1  1024     1     <span class=nt>-b----</span>   663.9</code></pre></div></div><div class=paragraph><p>To begin the installation of the base operating system, start the VNC client, directing it to the main network address of the host or to the IP address defined on the <code>vnclisten</code> line of <span class=filename>freebsd.cfg</span>. After the operating system has been installed, shut down the DomU and disconnect the VNC viewer. Edit <span class=filename>freebsd.cfg</span>, removing the line with the <code>cdrom</code> definition or commenting it out by inserting a <code>#</code> character at the beginning of the line. To load this new configuration, it is necessary to remove the old DomU with <code>xl destroy</code>, passing either the name or the id as the parameter. Afterwards, recreate it using the modified <strong class=filename>freebsd.cfg</strong>.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># xl destroy freebsd</span>
<span class=c># xl create freebsd.cfg</span></code></pre></div></div><div class=paragraph><p>The machine can then be accessed again using the VNC viewer. This time, it will boot from the virtual disk where the operating system has been installed and can be used as a virtual machine.</p></div></div><div class=sect3><h4 id=virtualization-host-xen-troubleshooting>21.8.4. Troubleshooting<a class=anchor href=#virtualization-host-xen-troubleshooting></a></h4><div class=paragraph><p>This section contains basic information in order to help troubleshoot issues found when using FreeBSD as a Xen™ host or guest.</p></div><div class=sect4><h5 id=virtualization-host-xen-troubleshooting-host>21.8.4.1. Host Boot Troubleshooting<a class=anchor href=#virtualization-host-xen-troubleshooting-host></a></h5><div class=paragraph><p>Please note that the following troubleshooting tips are intended for Xen™ 4.11 or newer. If you are still using Xen™ 4.7 and having issues consider migrating to a newer version of Xen™.</p></div><div class=paragraph><p>In order to troubleshoot host boot issues you will likely need a serial cable, or a debug USB cable. Verbose Xen™ boot output can be obtained by adding options to the <code>xen_cmdline</code> option found in <span class=filename>loader.conf</span>. A couple of relevant debug options are:</p></div><div class=ulist><ul><li><p><code>iommu=debug</code>: can be used to print additional diagnostic information about the iommu.</p></li><li><p><code>dom0=verbose</code>: can be used to print additional diagnostic information about the dom0 build process.</p></li><li><p><code>sync_console</code>: flag to force synchronous console output. Useful for debugging to avoid losing messages due to rate limiting. Never use this option in production environments since it can allow malicious guests to perform DoS attacks against Xen™ using the console.</p></li></ul></div><div class=paragraph><p>FreeBSD should also be booted in verbose mode in order to identify any issues. To activate verbose booting, run this command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sysrc -f /boot/loader.conf boot_verbose=&#34;YES&#34;</span></code></pre></div></div><div class=paragraph><p>If none of these options help solving the problem, please send the serial boot log to <a href=mailto:freebsd-xen@FreeBSD.org>freebsd-xen@FreeBSD.org</a> and <a href=mailto:xen-devel@lists.xenproject.org>xen-devel@lists.xenproject.org</a> for further analysis.</p></div></div><div class=sect4><h5 id=virtualization-host-xen-troubleshooting-guest>21.8.4.2. Guest Creation Troubleshooting<a class=anchor href=#virtualization-host-xen-troubleshooting-guest></a></h5><div class=paragraph><p>Issues can also arise when creating guests, the following attempts to provide some help for those trying to diagnose guest creation issues.</p></div><div class=paragraph><p>The most common cause of guest creation failures is the <code>xl</code> command spitting some error and exiting with a return code different than 0. If the error provided is not enough to help identify the issue, more verbose output can also be obtained from <code>xl</code> by using the <code>v</code> option repeatedly.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># xl -vvv create freebsd.cfg</span>
Parsing config from freebsd.cfg
libxl: debug: libxl_create.c:1693:do_domain_create: Domain 0:ao 0x800d750a0: create: <span class=nv>how</span><span class=o>=</span>0x0 <span class=nv>callback</span><span class=o>=</span>0x0 <span class=nv>poller</span><span class=o>=</span>0x800d6f0f0
libxl: debug: libxl_device.c:397:libxl__device_disk_set_backend: Disk <span class=nv>vdev</span><span class=o>=</span>xvda spec.backend<span class=o>=</span>unknown
libxl: debug: libxl_device.c:432:libxl__device_disk_set_backend: Disk <span class=nv>vdev</span><span class=o>=</span>xvda, using backend phy
libxl: debug: libxl_create.c:1018:initiate_domain_create: Domain 1:running bootloader
libxl: debug: libxl_bootloader.c:328:libxl__bootloader_run: Domain 1:not a PV/PVH domain, skipping bootloader
libxl: debug: libxl_event.c:689:libxl__ev_xswatch_deregister: watch <span class=nv>w</span><span class=o>=</span>0x800d96b98: deregister unregistered
domainbuilder: detail: xc_dom_allocate: <span class=nv>cmdline</span><span class=o>=</span><span class=s2>&#34;&#34;</span>, <span class=nv>features</span><span class=o>=</span><span class=s2>&#34;&#34;</span>
domainbuilder: detail: xc_dom_kernel_file: <span class=nv>filename</span><span class=o>=</span><span class=s2>&#34;/usr/local/lib/xen/boot/hvmloader&#34;</span>
domainbuilder: detail: xc_dom_malloc_filemap    : 326 kB
libxl: debug: libxl_dom.c:988:libxl__load_hvm_firmware_module: Loading BIOS: /usr/local/shared/seabios/bios.bin
...</code></pre></div></div><div class=paragraph><p>If the verbose output does not help diagnose the issue there are also QEMU and Xen™ toolstack logs in <span class=filename>/var/log/xen</span>. Note that the name of the domain is appended to the log name, so if the domain is named <code>freebsd</code> you should find a <span class=filename>/var/log/xen/xl-freebsd.log</span> and likely a <span class=filename>/var/log/xen/qemu-dm-freebsd.log</span>. Both log files can contain useful information for debugging. If none of this helps solve the issue, please send the description of the issue you are facing and as much information as possible to <a href=mailto:freebsd-xen@FreeBSD.org>freebsd-xen@FreeBSD.org</a> and <a href=mailto:xen-devel@lists.xenproject.org>xen-devel@lists.xenproject.org</a> in order to get help.</p></div></div></div></div></div></div><div class=sect1><h2 id=l10n>Rozdział 22. Localization - i18n/L10n Usage and Setup<a class=anchor href=#l10n></a></h2><div class=sectionbody><div class=sect2><h3 id=l10n-synopsis>22.1. Synopsis<a class=anchor href=#l10n-synopsis></a></h3><div class=paragraph><p>FreeBSD is a distributed project with users and contributors located all over the world. As such, FreeBSD supports localization into many languages, allowing users to view, input, or process data in non-English languages. One can choose from most of the major languages, including, but not limited to: Chinese, German, Japanese, Korean, French, Russian, and Vietnamese.</p></div><div class=paragraph><p>The term internationalization has been shortened to i18n, which represents the number of letters between the first and the last letters of <code>internationalization</code>. L10n uses the same naming scheme, but from <code>localization</code>. The i18n/L10n methods, protocols, and applications allow users to use languages of their choice.</p></div><div class=paragraph><p>This chapter discusses the internationalization and localization features of FreeBSD. After reading this chapter, you will know:</p></div><div class=ulist><ul><li><p>How locale names are constructed.</p></li><li><p>How to set the locale for a login shell.</p></li><li><p>How to configure the console for non-English languages.</p></li><li><p>How to configure Xorg for different languages.</p></li><li><p>How to find i18n-compliant applications.</p></li><li><p>Where to find more information for configuring specific languages.</p></li></ul></div><div class=paragraph><p>Before reading this chapter, you should:</p></div><div class=ulist><ul><li><p>Know how to <a href=./#ports>install additional third-party applications</a>.</p></li></ul></div></div><div class=sect2><h3 id=using-localization>22.2. Using Localization<a class=anchor href=#using-localization></a></h3><div class=paragraph><p>Localization settings are based on three components: the language code, country code, and encoding. Locale names are constructed from these parts as follows:</p></div><div class="literalblock programlisting"><div class=content><pre>LanguageCode_CountryCode.Encoding</pre></div></div><div class=paragraph><p>The <em>LanguageCode</em> and <em>CountryCode</em> are used to determine the country and the specific language variation. <a href=#locale-lang-country>Common Language and Country Codes</a> provides some examples of <em>LanguageCode_CountryCode</em>:</p></div><table id=locale-lang-country class="tableblock frame-none grid-all stretch"><caption class=title>Tabela 15. Common Language and Country Codes</caption><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">LanguageCode_Country Code</th><th class="tableblock halign-left valign-top">Description</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock>en_US</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>English, United States</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>ru_RU</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Russian, Russia</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>zh_TW</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Traditional Chinese, Taiwan</p></td></tr></tbody></table><div class=paragraph><p>A complete listing of available locales can be found by typing:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% locale <span class=nt>-a</span> | more</code></pre></div></div><div class=paragraph><p>To determine the current locale setting:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% locale</code></pre></div></div><div class=paragraph><p>Language specific character sets, such as ISO8859-1, ISO8859-15, KOI8-R, and CP437, are described in <a href="https://man.freebsd.org/cgi/man.cgi?query=multibyte&amp;sektion=3&amp;format=html">multibyte(3)</a>. The active list of character sets can be found at the <a href=http://www.iana.org/assignments/character-sets>IANA Registry</a>.</p></div><div class=paragraph><p>Some languages, such as Chinese or Japanese, cannot be represented using ASCII characters and require an extended language encoding using either wide or multibyte characters. Examples of wide or multibyte encodings include EUC and Big5. Older applications may mistake these encodings for control characters while newer applications usually recognize these characters. Depending on the implementation, users may be required to compile an application with wide or multibyte character support, or to configure it correctly.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>FreeBSD uses Xorg-compatible locale encodings.</p></div></td></tr></tbody></table></div><div class=paragraph><p>The rest of this section describes the various methods for configuring the locale on a FreeBSD system. The next section will discuss the considerations for finding and compiling applications with i18n support.</p></div><div class=sect3><h4 id=setting-locale>22.2.1. Setting Locale for Login Shell<a class=anchor href=#setting-locale></a></h4><div class=paragraph><p>Locale settings are configured either in a user’s <span class=filename>~/.login_conf</span> or in the startup file of the user’s shell: <span class=filename>~/.profile</span>, <span class=filename>~/.bashrc</span>, or <span class=filename>~/.cshrc</span>.</p></div><div class=paragraph><p>Two environment variables should be set:</p></div><div class=ulist><ul><li><p><code>LANG</code>, which sets the locale</p></li><li><p><code>MM_CHARSET</code>, which sets the MIME character set used by applications</p></li></ul></div><div class=paragraph><p>In addition to the user’s shell configuration, these variables should also be set for specific application configuration and Xorg configuration.</p></div><div class=paragraph><p>Two methods are available for making the needed variable assignments: the <a href=#login-class>login class</a> method, which is the recommended method, and the <a href=#startup-file>startup file</a> method. The next two sections demonstrate how to use both methods.</p></div><div class=sect4><h5 id=login-class>22.2.1.1. Login Classes Method<a class=anchor href=#login-class></a></h5><div class=paragraph><p>This first method is the recommended method as it assigns the required environment variables for locale name and MIME character sets for every possible shell. This setup can either be performed by each user or it can be configured for all users by the superuser.</p></div><div class=paragraph><p>This minimal example sets both variables for Latin-1 encoding in the <span class=filename>.login_conf</span> of an individual user’s home directory:</p></div><div class="literalblock programlisting"><div class=content><pre>me:\
	:charset=ISO-8859-1:\
	:lang=de_DE.ISO8859-1:</pre></div></div><div class=paragraph><p>Here is an example of a user’s <span class=filename>~/.login_conf</span> that sets the variables for Traditional Chinese in BIG-5 encoding. More variables are needed because some applications do not correctly respect locale variables for Chinese, Japanese, and Korean:</p></div><div class="literalblock programlisting"><div class=content><pre>#Users who do not wish to use monetary units or time formats
#of Taiwan can manually change each variable
me:\
	:lang=zh_TW.Big5:\
	:setenv=LC_ALL=zh_TW.Big5,LC_COLLATE=zh_TW.Big5,LC_CTYPE=zh_TW.Big5,LC_MESSAGES=zh_TW.Big5,LC_MONETARY=zh_TW.Big5,LC_NUMERIC=zh_TW.Big5,LC_TIME=zh_TW.Big5:\
	:charset=big5:\
	:xmodifiers=&#34;@im=gcin&#34;: #Set gcin as the XIM Input Server</pre></div></div><div class=paragraph><p>Alternately, the superuser can configure all users of the system for localization. The following variables in <span class=filename>/etc/login.conf</span> are used to set the locale and MIME character set:</p></div><div class="literalblock programlisting"><div class=content><pre>language_name|Account Type Description:\
	:charset=MIME_charset:\
	:lang=locale_name:\
	:tc=default:</pre></div></div><div class=paragraph><p>So, the previous Latin-1 example would look like this:</p></div><div class="literalblock programlisting"><div class=content><pre>german|German Users Accounts:\
	:charset=ISO-8859-1:\
	:lang=de_DE.ISO8859-1:\
	:tc=default:</pre></div></div><div class=paragraph><p>See <a href="https://man.freebsd.org/cgi/man.cgi?query=login.conf&amp;sektion=5&amp;format=html">login.conf(5)</a> for more details about these variables. Note that it already contains pre-defined <em>russian</em> class.</p></div><div class=paragraph><p>Whenever <span class=filename>/etc/login.conf</span> is edited, remember to execute the following command to update the capability database:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cap_mkdb /etc/login.conf</span></code></pre></div></div><div class=sect5><h6 id=_utilities_which_change_login_classes>22.2.1.1.1. Utilities Which Change Login Classes<a class=anchor href=#_utilities_which_change_login_classes></a></h6><div class=paragraph><p>In addition to manually editing <span class=filename>/etc/login.conf</span>, several utilities are available for setting the locale for newly created users.</p></div><div class=paragraph><p>When using <code>vipw</code> to add new users, specify the <em>language</em> to set the locale:</p></div><div class="literalblock programlisting"><div class=content><pre>user:password:1111:11:language:0:0:User Name:/home/user:/bin/sh</pre></div></div><div class=paragraph><p>When using <code>adduser</code> to add new users, the default language can be pre-configured for all new users or specified for an individual user.</p></div><div class=paragraph><p>If all new users use the same language, set <code>defaultclass=<em>language</em></code> in <span class=filename>/etc/adduser.conf</span>.</p></div><div class=paragraph><p>To override this setting when creating a user, either input the required locale at this prompt:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>Enter login class: default <span class=o>[]</span>:</code></pre></div></div><div class=paragraph><p>or specify the locale to set when invoking <code>adduser</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># adduser -class language</span></code></pre></div></div><div class=paragraph><p>If <code>pw</code> is used to add new users, specify the locale as follows:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pw useradd user_name -L language</span></code></pre></div></div><div class=paragraph><p>To change the login class of an existing user, <code>chpass</code> can be used. Invoke it as superuser and provide the username to edit as the argument.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># chpass user_name</span></code></pre></div></div></div></div><div class=sect4><h5 id=startup-file>22.2.1.2. Shell Startup File Method<a class=anchor href=#startup-file></a></h5><div class=paragraph><p>This second method is not recommended as each shell that is used requires manual configuration, where each shell has a different configuration file and differing syntax. As an example, to set the German language for the <code>sh</code> shell, these lines could be added to <span class=filename>~/.profile</span> to set the shell for that user only. These lines could also be added to <span class=filename>/etc/profile</span> or <span class=filename>/usr/shared/skel/dot.profile</span> to set that shell for all users:</p></div><div class="literalblock programlisting"><div class=content><pre>LANG=de_DE.ISO8859-1; export LANG
MM_CHARSET=ISO-8859-1; export MM_CHARSET</pre></div></div><div class=paragraph><p>However, the name of the configuration file and the syntax used differs for the <code>csh</code> shell. These are the equivalent settings for <span class=filename>~/.csh.login</span>, <span class=filename>/etc/csh.login</span>, or <span class=filename>/usr/shared/skel/dot.login</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>setenv LANG de_DE.ISO8859-1
setenv MM_CHARSET ISO-8859-1</pre></div></div><div class=paragraph><p>To complicate matters, the syntax needed to configure Xorg in <span class=filename>~/.xinitrc</span> also depends upon the shell. The first example is for the <code>sh</code> shell and the second is for the <code>csh</code> shell:</p></div><div class="literalblock programlisting"><div class=content><pre>LANG=de_DE.ISO8859-1; export LANG</pre></div></div><div class="literalblock programlisting"><div class=content><pre>setenv LANG de_DE.ISO8859-1</pre></div></div></div></div><div class=sect3><h4 id=setting-console>22.2.2. Console Setup<a class=anchor href=#setting-console></a></h4><div class=paragraph><p>Several localized fonts are available for the console. To see a listing of available fonts, type <code>ls /usr/shared/syscons/fonts</code>. To configure the console font, specify the <em>font_name</em>, without the <span class=filename>.fnt</span> suffix, in <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>font8x16=font_name
font8x14=font_name
font8x8=font_name</pre></div></div><div class=paragraph><p>The keymap and screenmap can be set by adding the following to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>scrnmap=screenmap_name
keymap=keymap_name
keychange=&#34;fkey_number sequence&#34;</pre></div></div><div class=paragraph><p>To see the list of available screenmaps, type <code>ls /usr/shared/syscons/scrnmaps</code>. Do not include the <span class=filename>.scm</span> suffix when specifying <code><em>screenmap_name</em></code>. A screenmap with a corresponding mapped font is usually needed as a workaround for expanding bit 8 to bit 9 on a VGA adapter’s font character matrix so that letters are moved out of the pseudographics area if the screen font uses a bit 8 column.</p></div><div class=paragraph><p>To see the list of available keymaps, type <code>ls /usr/shared/syscons/keymaps</code>. When specifying the <code><em>keymap_name</em></code>, do not include the <span class=filename>.kbd</span> suffix. To test keymaps without rebooting, use <a href="https://man.freebsd.org/cgi/man.cgi?query=kbdmap&amp;sektion=1&amp;format=html">kbdmap(1)</a>.</p></div><div class=paragraph><p>The <code>keychange</code> entry is usually needed to program function keys to match the selected terminal type because function key sequences cannot be defined in the keymap.</p></div><div class=paragraph><p>Next, set the correct console terminal type in <span class=filename>/etc/ttys</span> for all virtual terminal entries. <a href=#locale-charset>Defined Terminal Types for Character Sets</a> summarizes the available terminal types.:</p></div><table id=locale-charset class="tableblock frame-none grid-all stretch"><caption class=title>Tabela 16. Defined Terminal Types for Character Sets</caption><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">Character Set</th><th class="tableblock halign-left valign-top">Terminal Type</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock>ISO8859-1 or ISO8859-15</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>cons25l1</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>ISO8859-2</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>cons25l2</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>ISO8859-7</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>cons25l7</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>KOI8-R</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>cons25r</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>KOI8-U</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>cons25u</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>CP437 (VGA default)</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>cons25</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>US-ASCII</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>cons25w</code></p></td></tr></tbody></table><div class=paragraph><p>For languages with wide or multibyte characters, install a console for that language from the FreeBSD Ports Collection. The available ports are summarized in <a href=#locale-console>Available Console from Ports Collection</a>. Once installed, refer to the port’s <span class=filename>pkg-message</span> or man pages for configuration and usage instructions.</p></div><table id=locale-console class="tableblock frame-none grid-all stretch"><caption class=title>Tabela 17. Available Console from Ports Collection</caption><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">Language</th><th class="tableblock halign-left valign-top">Port Location</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Traditional Chinese (BIG-5)</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><a class=package href=https://cgit.freebsd.org/ports/tree/chinese/big5con/>chinese/big5con</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Chinese/Japanese/Korean</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><a class=package href=https://cgit.freebsd.org/ports/tree/chinese/cce/>chinese/cce</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Chinese/Japanese/Korean</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><a class=package href=https://cgit.freebsd.org/ports/tree/chinese/zhcon/>chinese/zhcon</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Japanese</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><a class=package href=https://cgit.freebsd.org/ports/tree/chinese/kon2/>chinese/kon2</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Japanese</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><a class=package href=https://cgit.freebsd.org/ports/tree/japanese/kon2-14dot/>japanese/kon2-14dot</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Japanese</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><a class=package href=https://cgit.freebsd.org/ports/tree/japanese/kon2-16dot/>japanese/kon2-16dot</a></p></td></tr></tbody></table><div class=paragraph><p>If moused is enabled in <span class=filename>/etc/rc.conf</span>, additional configuration may be required. By default, the mouse cursor of the <a href="https://man.freebsd.org/cgi/man.cgi?query=syscons&amp;sektion=4&amp;format=html">syscons(4)</a> driver occupies the <code>0xd0</code>-<code>0xd3</code> range in the character set. If the language uses this range, move the cursor’s range by adding the following line to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>mousechar_start=3</pre></div></div></div><div class=sect3><h4 id=_xorg_setup>22.2.3. Xorg Setup<a class=anchor href=#_xorg_setup></a></h4><div class=paragraph><p><a href=./#x11>The X Window System</a> describes how to install and configure Xorg. When configuring Xorg for localization, additional fonts and input methods are available from the FreeBSD Ports Collection. Application specific i18n settings such as fonts and menus can be tuned in <span class=filename>~/.Xresources</span> and should allow users to view their selected language in graphical application menus.</p></div><div class=paragraph><p>The X Input Method (XIM) protocol is an Xorg standard for inputting non-English characters. <a href=#locale-xim>Available Input Methods</a> summarizes the input method applications which are available in the FreeBSD Ports Collection. Additional Fcitx and Uim applications are also available.</p></div><table id=locale-xim class="tableblock frame-none grid-all stretch"><caption class=title>Tabela 18. Available Input Methods</caption><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">Language</th><th class="tableblock halign-left valign-top">Input Method</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Chinese</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><a class=package href=https://cgit.freebsd.org/ports/tree/chinese/gcin/>chinese/gcin</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Chinese</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><a class=package href=https://cgit.freebsd.org/ports/tree/chinese/ibus-chewing/>chinese/ibus-chewing</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Chinese</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><a class=package href=https://cgit.freebsd.org/ports/tree/chinese/ibus-pinyin/>chinese/ibus-pinyin</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Chinese</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><a class=package href=https://cgit.freebsd.org/ports/tree/chinese/oxim/>chinese/oxim</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Chinese</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><a class=package href=https://cgit.freebsd.org/ports/tree/chinese/scim-fcitx/>chinese/scim-fcitx</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Chinese</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><a class=package href=https://cgit.freebsd.org/ports/tree/chinese/scim-pinyin/>chinese/scim-pinyin</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Chinese</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><a class=package href=https://cgit.freebsd.org/ports/tree/chinese/scim-tables/>chinese/scim-tables</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Japanese</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><a class=package href=https://cgit.freebsd.org/ports/tree/japanese/ibus-anthy/>japanese/ibus-anthy</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Japanese</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><a class=package href=https://cgit.freebsd.org/ports/tree/japanese/ibus-mozc/>japanese/ibus-mozc</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Japanese</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><a class=package href=https://cgit.freebsd.org/ports/tree/japanese/ibus-skk/>japanese/ibus-skk</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Japanese</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><a class=package href=https://cgit.freebsd.org/ports/tree/japanese/im-ja/>japanese/im-ja</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Japanese</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><a class=package href=https://cgit.freebsd.org/ports/tree/japanese/kinput2/>japanese/kinput2</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Japanese</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><a class=package href=https://cgit.freebsd.org/ports/tree/japanese/scim-anthy/>japanese/scim-anthy</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Japanese</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><a class=package href=https://cgit.freebsd.org/ports/tree/japanese/scim-canna/>japanese/scim-canna</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Japanese</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><a class=package href=https://cgit.freebsd.org/ports/tree/japanese/scim-honoka/>japanese/scim-honoka</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Japanese</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><a class=package href=https://cgit.freebsd.org/ports/tree/japanese/scim-honoka-plugin-romkan/>japanese/scim-honoka-plugin-romkan</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Japanese</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><a class=package href=https://cgit.freebsd.org/ports/tree/japanese/scim-honoka-plugin-wnn/>japanese/scim-honoka-plugin-wnn</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Japanese</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><a class=package href=https://cgit.freebsd.org/ports/tree/japanese/scim-prime/>japanese/scim-prime</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Japanese</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><a class=package href=https://cgit.freebsd.org/ports/tree/japanese/scim-skk/>japanese/scim-skk</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Japanese</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><a class=package href=https://cgit.freebsd.org/ports/tree/japanese/scim-tables/>japanese/scim-tables</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Japanese</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><a class=package href=https://cgit.freebsd.org/ports/tree/japanese/scim-tomoe/>japanese/scim-tomoe</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Japanese</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><a class=package href=https://cgit.freebsd.org/ports/tree/japanese/scim-uim/>japanese/scim-uim</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Japanese</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><a class=package href=https://cgit.freebsd.org/ports/tree/japanese/skkinput/>japanese/skkinput</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Japanese</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><a class=package href=https://cgit.freebsd.org/ports/tree/japanese/skkinput3/>japanese/skkinput3</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Japanese</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><a class=package href=https://cgit.freebsd.org/ports/tree/japanese/uim-anthy/>japanese/uim-anthy</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Korean</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><a class=package href=https://cgit.freebsd.org/ports/tree/korean/ibus-hangul/>korean/ibus-hangul</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Korean</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><a class=package href=https://cgit.freebsd.org/ports/tree/korean/imhangul/>korean/imhangul</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Korean</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><a class=package href=https://cgit.freebsd.org/ports/tree/korean/nabi/>korean/nabi</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Korean</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><a class=package href=https://cgit.freebsd.org/ports/tree/korean/scim-hangul/>korean/scim-hangul</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Korean</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><a class=package href=https://cgit.freebsd.org/ports/tree/korean/scim-tables/>korean/scim-tables</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Vietnamese</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><a class=package href=https://cgit.freebsd.org/ports/tree/vietnamese/xvnkb/>vietnamese/xvnkb</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Vietnamese</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><a class=package href=https://cgit.freebsd.org/ports/tree/vietnamese/x-unikey/>vietnamese/x-unikey</a></p></td></tr></tbody></table></div></div><div class=sect2><h3 id=l10n-compiling>22.3. Finding i18n Applications<a class=anchor href=#l10n-compiling></a></h3><div class=paragraph><p>i18n applications are programmed using i18n kits under libraries. These allow developers to write a simple file and translate displayed menus and texts to each language.</p></div><div class=paragraph><p>The <a href=https://www.FreeBSD.org/ports/>FreeBSD Ports Collection</a> contains many applications with built-in support for wide or multibyte characters for several languages. Such applications include <code>i18n</code> in their names for easy identification. However, they do not always support the language needed.</p></div><div class=paragraph><p>Some applications can be compiled with the specific charset. This is usually done in the port’s <span class=filename>Makefile</span> or by passing a value to configure. Refer to the i18n documentation in the respective FreeBSD port’s source for more information on how to determine the needed configure value or the port’s <span class=filename>Makefile</span> to determine which compile options to use when building the port.</p></div></div><div class=sect2><h3 id=lang-setup>22.4. Locale Configuration for Specific Languages<a class=anchor href=#lang-setup></a></h3><div class=paragraph><p>This section provides configuration examples for localizing a FreeBSD system for the Russian language. It then provides some additional resources for localizing other languages.</p></div><div class=sect3><h4 id=ru-localize>22.4.1. Russian Language (KOI8-R Encoding)<a class=anchor href=#ru-localize></a></h4><div class=paragraph><p>This section shows the specific settings needed to localize a FreeBSD system for the Russian language. Refer to <a href=#using-localization>Using Localization</a> for a more complete description of each type of setting.</p></div><div class=paragraph><p>To set this locale for the login shell, add the following lines to each user’s <span class=filename>~/.login_conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>me:My Account:\
	:charset=KOI8-R:\
	:lang=ru_RU.KOI8-R:</pre></div></div><div class=paragraph><p>To configure the console, add the following lines to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>keymap=&#34;ru.utf-8&#34;
scrnmap=&#34;utf-82cp866&#34;
font8x16=&#34;cp866b-8x16&#34;
font8x14=&#34;cp866-8x14&#34;
font8x8=&#34;cp866-8x8&#34;
mousechar_start=3</pre></div></div><div class=paragraph><p>For each <code>ttyv</code> entry in <span class=filename>/etc/ttys</span>, use <code>cons25r</code> as the terminal type.</p></div><div class=paragraph><p>To configure printing, a special output filter is needed to convert from KOI8-R to CP866 since most printers with Russian characters come with hardware code page CP866. FreeBSD includes a default filter for this purpose, <span class=filename>/usr/libexec/lpr/ru/koi2alt</span>. To use this filter, add this entry to <span class=filename>/etc/printcap</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>lp|Russian local line printer:\
	:sh:of=/usr/libexec/lpr/ru/koi2alt:\
	:lp=/dev/lpt0:sd=/var/spool/output/lpd:lf=/var/log/lpd-errs:</pre></div></div><div class=paragraph><p>Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=printcap&amp;sektion=5&amp;format=html">printcap(5)</a> for a more detailed explanation.</p></div><div class=paragraph><p>To configure support for Russian filenames in mounted MS-DOS® file systems, include <code>-L</code> and the locale name when adding an entry to <span class=filename>/etc/fstab</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>/dev/ad0s2      /dos/c  msdos   rw,-Lru_RU.KOI8-R 0 0</pre></div></div><div class=paragraph><p>Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=mount_msdosfs&amp;sektion=8&amp;format=html">mount_msdosfs(8)</a> for more details.</p></div><div class=paragraph><p>To configure Russian fonts for Xorg, install the <a class=package href=https://cgit.freebsd.org/ports/tree/x11-fonts/xorg-fonts-cyrillic/>x11-fonts/xorg-fonts-cyrillic</a> package. Then, check the <code>"Files"</code> section in <span class=filename>/etc/X11/xorg.conf</span>. The following line must be added <em>before</em> any other <code>FontPath</code> entries:</p></div><div class="literalblock programlisting"><div class=content><pre>FontPath   &#34;/usr/local/lib/X11/fonts/cyrillic&#34;</pre></div></div><div class=paragraph><p>Additional Cyrillic fonts are available in the Ports Collection.</p></div><div class=paragraph><p>To activate a Russian keyboard, add the following to the <code>"Keyboard"</code> section of <span class=filename>/etc/xorg.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>Option &#34;XkbLayout&#34;   &#34;us,ru&#34;
Option &#34;XkbOptions&#34;  &#34;grp:toggle&#34;</pre></div></div><div class=paragraph><p>Make sure that <code>XkbDisable</code> is commented out in that file.</p></div><div class=paragraph><p>For <code>grp:toggle</code> use <kbd>Right Alt</kbd>, for <code>grp:ctrl_shift_toggle</code> use <span class=keyseq><kbd>Ctrl</kbd>+<kbd>Shift</kbd></span>. For <code>grp:caps_toggle</code> use <kbd>CapsLock</kbd>. The old <kbd>CapsLock</kbd> function is still available in LAT mode only using <span class=keyseq><kbd>Shift</kbd>+<kbd>CapsLock</kbd></span>. <code>grp:caps_toggle</code> does not work in Xorg for some unknown reason.</p></div><div class=paragraph><p>If the keyboard has "Windows®" keys, and some non-alphabetical keys are mapped incorrectly, add the following line to <span class=filename>/etc/xorg.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>Option &#34;XkbVariant&#34; &#34;,winkeys&#34;</pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>The Russian XKB keyboard may not work with non-localized applications. Minimally localized applications should call a <code>XtSetLanguageProc (NULL, NULL, NULL);</code> function early in the program.</p></div></td></tr></tbody></table></div><div class=paragraph><p>See <a href=http://koi8.pp.ru/xwin.html>http://koi8.pp.ru/xwin.html</a> for more instructions on localizing Xorg applications. For more general information about KOI8-R encoding, refer to <a href=http://koi8.pp.ru/>http://koi8.pp.ru/</a>.</p></div></div><div class=sect3><h4 id=_additional_language_specific_resources>22.4.2. Additional Language-Specific Resources<a class=anchor href=#_additional_language_specific_resources></a></h4><div class=paragraph><p>This section lists some additional resources for configuring other locales.</p></div><div class=dlist><dl><dt class=hdlist1>Traditional Chinese for Taiwan</dt><dd><p>The FreeBSD-Taiwan Project has a Chinese HOWTO for FreeBSD at <a href=http://netlab.cse.yzu.edu.tw/~statue/freebsd/zh-tut/>http://netlab.cse.yzu.edu.tw/~statue/freebsd/zh-tut/</a>.</p></dd><dt class=hdlist1>Greek Language Localization</dt><dd><p>A complete article on Greek support in FreeBSD is available <a href=https://www.FreeBSD.org/doc/gr/articles/greek-language-support/>here</a>, in Greek only, as part of the official FreeBSD Greek documentation.</p></dd><dt class=hdlist1>Japanese and Korean Language Localization</dt><dd><p>For Japanese, refer to <a href=http://www.jp.FreeBSD.org/>http://www.jp.FreeBSD.org/</a>, and for Korean, refer to <a href=http://www.kr.FreeBSD.org/>http://www.kr.FreeBSD.org/</a>.</p></dd><dt class=hdlist1>Non-English FreeBSD Documentation</dt><dd><p>Some FreeBSD contributors have translated parts of the FreeBSD documentation to other languages. They are available through links on the <a href=https://www.FreeBSD.org/>FreeBSD web site</a> or in <span class=filename>/usr/shared/doc</span>.</p></dd></dl></div></div></div></div></div><div class=sect1><h2 id=updating-upgrading>Rozdział 23. Updating and Upgrading FreeBSD<a class=anchor href=#updating-upgrading></a></h2><div class=sectionbody><div class=sect2><h3 id=updating-upgrading-synopsis>23.1. Synopsis<a class=anchor href=#updating-upgrading-synopsis></a></h3><div class=paragraph><p>FreeBSD is under constant development between releases. Some people prefer to use the officially released versions, while others prefer to keep in sync with the latest developments. However, even official releases are often updated with security and other critical fixes. Regardless of the version used, FreeBSD provides all the necessary tools to keep the system updated, and allows for easy upgrades between versions. This chapter describes how to track the development system and the basic tools for keeping a FreeBSD system up-to-date.</p></div><div class=paragraph><p>After reading this chapter, you will know:</p></div><div class=ulist><ul><li><p>How to keep a FreeBSD system up-to-date with freebsd-update or Subversion.</p></li><li><p>How to compare the state of an installed system against a known pristine copy.</p></li><li><p>How to keep the installed documentation up-to-date with Subversion or documentation ports.</p></li><li><p>The difference between the two development branches: FreeBSD-STABLE and FreeBSD-CURRENT.</p></li><li><p>How to rebuild and reinstall the entire base system.</p></li></ul></div><div class=paragraph><p>Before reading this chapter, you should:</p></div><div class=ulist><ul><li><p>Properly set up the network connection (<a href=./#advanced-networking>Advanced Networking</a>).</p></li><li><p>Know how to install additional third-party software (<a href=./#ports>Installing Applications: Packages and Ports</a>).</p></li></ul></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Throughout this chapter, <code>svnlite</code> is used to obtain and update FreeBSD sources. Optionally, the <a class=package href=https://cgit.freebsd.org/ports/tree/devel/subversion/>devel/subversion</a> port or package may be used.</p></div></td></tr></tbody></table></div></div><div class=sect2><h3 id=updating-upgrading-freebsdupdate>23.2. FreeBSD Update<a class=anchor href=#updating-upgrading-freebsdupdate></a></h3><div class=paragraph><p>Applying security patches in a timely manner and upgrading to a newer release of an operating system are important aspects of ongoing system administration. FreeBSD includes a utility called <code>freebsd-update</code> which can be used to perform both these tasks.</p></div><div class=paragraph><p>This utility supports binary security and errata updates to FreeBSD, without the need to manually compile and install the patch or a new kernel. Binary updates are available for all architectures and releases currently supported by the security team. The list of supported releases and their estimated end-of-life dates are listed at <a href=https://www.FreeBSD.org/security/>https://www.FreeBSD.org/security/</a>.</p></div><div class=paragraph><p>This utility also supports operating system upgrades to minor point releases as well as upgrades to another release branch. Before upgrading to a new release, review its release announcement as it contains important information pertinent to the release. Release announcements are available from <a href=https://www.FreeBSD.org/releases/>https://www.FreeBSD.org/releases/</a>.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>If a <code>crontab</code> utilizing the features of <a href="https://man.freebsd.org/cgi/man.cgi?query=freebsd-update&amp;sektion=8&amp;format=html">freebsd-update(8)</a> exists, it must be disabled before upgrading the operating system.</p></div></td></tr></tbody></table></div><div class=paragraph><p>This section describes the configuration file used by <code>freebsd-update</code>, demonstrates how to apply a security patch and how to upgrade to a minor or major operating system release, and discusses some of the considerations when upgrading the operating system.</p></div><div class=sect3><h4 id=freebsdupdate-config-file>23.2.1. The Configuration File<a class=anchor href=#freebsdupdate-config-file></a></h4><div class=paragraph><p>The default configuration file for <code>freebsd-update</code> works as-is. Some users may wish to tweak the default configuration in <span class=filename>/etc/freebsd-update.conf</span>, allowing better control of the process. The comments in this file explain the available options, but the following may require a bit more explanation:</p></div><div class="literalblock programlisting"><div class=content><pre># Components of the base system which should be kept updated.
Components world kernel</pre></div></div><div class=paragraph><p>This parameter controls which parts of FreeBSD will be kept up-to-date. The default is to update the entire base system and the kernel. Individual components can instead be specified, such as <code>src/base</code> or <code>src/sys</code>. However, the best option is to leave this at the default as changing it to include specific items requires every needed item to be listed. Over time, this could have disastrous consequences as source code and binaries may become out of sync.</p></div><div class="literalblock programlisting"><div class=content><pre># Paths which start with anything matching an entry in an IgnorePaths
# statement will be ignored.
IgnorePaths /boot/kernel/linker.hints</pre></div></div><div class=paragraph><p>To leave specified directories, such as <span class=filename>/bin</span> or <span class=filename>/sbin</span>, untouched during the update process, add their paths to this statement. This option may be used to prevent <code>freebsd-update</code> from overwriting local modifications.</p></div><div class="literalblock programlisting"><div class=content><pre># Paths which start with anything matching an entry in an UpdateIfUnmodified
# statement will only be updated if the contents of the file have not been
# modified by the user (unless changes are merged; see below).
UpdateIfUnmodified /etc/ /var/ /root/ /.cshrc /.profile</pre></div></div><div class=paragraph><p>This option will only update unmodified configuration files in the specified directories. Any changes made by the user will prevent the automatic updating of these files. There is another option, <code>KeepModifiedMetadata</code>, which will instruct <code>freebsd-update</code> to save the changes during the merge.</p></div><div class="literalblock programlisting"><div class=content><pre># When upgrading to a new FreeBSD release, files which match MergeChanges
# will have any local changes merged into the version from the new release.
MergeChanges /etc/ /var/named/etc/ /boot/device.hints</pre></div></div><div class=paragraph><p>List of directories with configuration files that <code>freebsd-update</code> should attempt to merge. The file merge process is a series of <a href="https://man.freebsd.org/cgi/man.cgi?query=diff&amp;sektion=1&amp;format=html">diff(1)</a> patches similar to <a href="https://man.freebsd.org/cgi/man.cgi?query=mergemaster&amp;sektion=8&amp;format=html">mergemaster(8)</a>, but with fewer options. Merges are either accepted, open an editor, or cause <code>freebsd-update</code> to abort. When in doubt, backup <span class=filename>/etc</span> and just accept the merges. See <a href="https://man.freebsd.org/cgi/man.cgi?query=mergemaster&amp;sektion=8&amp;format=html">mergemaster(8)</a> for more information about <code>mergemaster</code>.</p></div><div class="literalblock programlisting"><div class=content><pre># Directory in which to store downloaded updates and temporary
# files used by FreeBSD Update.
# WorkDir /var/db/freebsd-update</pre></div></div><div class=paragraph><p>This directory is where all patches and temporary files are placed. In cases where the user is doing a version upgrade, this location should have at least a gigabyte of disk space available.</p></div><div class="literalblock programlisting"><div class=content><pre># When upgrading between releases, should the list of Components be
# read strictly (StrictComponents yes) or merely as a list of components
# which *might* be installed of which FreeBSD Update should figure out
# which actually are installed and upgrade those (StrictComponents no)?
# StrictComponents no</pre></div></div><div class=paragraph><p>When this option is set to <code>yes</code>, <code>freebsd-update</code> will assume that the <code>Components</code> list is complete and will not attempt to make changes outside of the list. Effectively, <code>freebsd-update</code> will attempt to update every file which belongs to the <code>Components</code> list.</p></div></div><div class=sect3><h4 id=freebsdupdate-security-patches>23.2.2. Applying Security Patches<a class=anchor href=#freebsdupdate-security-patches></a></h4><div class=paragraph><p>The process of applying FreeBSD security patches has been simplified, allowing an administrator to keep a system fully patched using <code>freebsd-update</code>. More information about FreeBSD security advisories can be found in <a href=./#security-advisories>FreeBSD Security Advisories</a>.</p></div><div class=paragraph><p>FreeBSD security patches may be downloaded and installed using the following commands. The first command will determine if any outstanding patches are available, and if so, will list the files that will be modifed if the patches are applied. The second command will apply the patches.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># freebsd-update fetch</span>
<span class=c># freebsd-update install</span></code></pre></div></div><div class=paragraph><p>If the update applies any kernel patches, the system will need a reboot in order to boot into the patched kernel. If the patch was applied to any running binaries, the affected applications should be restarted so that the patched version of the binary is used.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Usually, the user needs to be prepared to reboot the system. To know if a reboot is required by a kernel update, execute the commands <code>freebsd-version -k</code> and <code>uname -r</code> and if it differs a reboot is required.</p></div></td></tr></tbody></table></div><div class=paragraph><p>The system can be configured to automatically check for updates once every day by adding this entry to <span class=filename>/etc/crontab</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>@daily                                  root    freebsd-update cron</pre></div></div><div class=paragraph><p>If patches exist, they will automatically be downloaded but will not be applied. The <code>root</code> user will be sent an email so that the patches may be reviewed and manually installed with <code>freebsd-update install</code>.</p></div><div class=paragraph><p>If anything goes wrong, <code>freebsd-update</code> has the ability to roll back the last set of changes with the following command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># freebsd-update rollback</span>
Uninstalling updates... <span class=k>done</span>.</code></pre></div></div><div class=paragraph><p>Again, the system should be restarted if the kernel or any kernel modules were modified and any affected binaries should be restarted.</p></div><div class=paragraph><p>Only the <span class=filename>GENERIC</span> kernel can be automatically updated by <code>freebsd-update</code>. If a custom kernel is installed, it will have to be rebuilt and reinstalled after <code>freebsd-update</code> finishes installing the updates. The default kernel name is <em>GENERIC</em>. The <a href="https://man.freebsd.org/cgi/man.cgi?query=uname&amp;sektion=1&amp;format=html">uname(1)</a> command may be used to verify its installation.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Always keep a copy of the <span class=filename>GENERIC</span> kernel in <span class=filename>/boot/GENERIC</span>. It will be helpful in diagnosing a variety of problems and in performing version upgrades. Refer to <a href=#freebsd-update-custom-kernel-9x>Custom Kernels with FreeBSD 9.X and Later</a> for instructions on how to get a copy of the <span class=filename>GENERIC</span> kernel.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Unless the default configuration in <span class=filename>/etc/freebsd-update.conf</span> has been changed, <code>freebsd-update</code> will install the updated kernel sources along with the rest of the updates. Rebuilding and reinstalling a new custom kernel can then be performed in the usual way.</p></div><div class=paragraph><p>The updates distributed by <code>freebsd-update</code> do not always involve the kernel. It is not necessary to rebuild a custom kernel if the kernel sources have not been modified by <code>freebsd-update install</code>. However, <code>freebsd-update</code> will always update <span class=filename>/usr/src/sys/conf/newvers.sh</span>. The current patch level, as indicated by the <code>-p</code> number reported by <code>uname -r</code>, is obtained from this file. Rebuilding a custom kernel, even if nothing else changed, allows <code>uname</code> to accurately report the current patch level of the system. This is particularly helpful when maintaining multiple systems, as it allows for a quick assessment of the updates installed in each one.</p></div></div><div class=sect3><h4 id=freebsdupdate-upgrade>23.2.3. Performing Major and Minor Version Upgrades<a class=anchor href=#freebsdupdate-upgrade></a></h4><div class=paragraph><p>Upgrades from one minor version of FreeBSD to another, like from FreeBSD 9.0 to FreeBSD 9.1, are called <em>minor version</em> upgrades. <em>Major version</em> upgrades occur when FreeBSD is upgraded from one major version to another, like from FreeBSD 9.X to FreeBSD 10.X. Both types of upgrades can be performed by providing <code>freebsd-update</code> with a release version target.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>If the system is running a custom kernel, make sure that a copy of the <span class=filename>GENERIC</span> kernel exists in <span class=filename>/boot/GENERIC</span> before starting the upgrade. Refer to <a href=#freebsd-update-custom-kernel-9x>Custom Kernels with FreeBSD 9.X and Later</a> for instructions on how to get a copy of the <span class=filename>GENERIC</span> kernel.</p></div></td></tr></tbody></table></div><div class=paragraph><p>The following command, when run on a FreeBSD 9.0 system, will upgrade it to FreeBSD 9.1:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># freebsd-update -r 9.1-RELEASE upgrade</span></code></pre></div></div><div class=paragraph><p>After the command has been received, <code>freebsd-update</code> will evaluate the configuration file and current system in an attempt to gather the information necessary to perform the upgrade. A screen listing will display which components have and have not been detected. For example:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>Looking up update.FreeBSD.org mirrors... 1 mirrors found.
Fetching metadata signature <span class=k>for </span>9.0-RELEASE from update1.FreeBSD.org... <span class=k>done</span><span class=nb>.</span>
Fetching metadata index... <span class=k>done</span><span class=nb>.</span>
Inspecting system... <span class=k>done</span><span class=nb>.</span>

The following components of FreeBSD seem to be installed:
kernel/smp src/base src/bin src/contrib src/crypto src/etc src/games
src/gnu src/include src/krb5 src/lib src/libexec src/release src/rescue
src/sbin src/secure src/share src/sys src/tools src/ubin src/usbin
world/base world/info world/lib32 world/manpages

The following components of FreeBSD <span class=k>do </span>not seem to be installed:
kernel/generic world/catpages world/dict world/doc world/games
world/proflibs

Does this look reasonable <span class=o>(</span>y/n<span class=o>)</span>? y</code></pre></div></div><div class=paragraph><p>At this point, <code>freebsd-update</code> will attempt to download all files required for the upgrade. In some cases, the user may be prompted with questions regarding what to install or how to proceed.</p></div><div class=paragraph><p>When using a custom kernel, the above step will produce a warning similar to the following:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>WARNING: This system is running a <span class=s2>&#34;MYKERNEL&#34;</span> kernel, which is not a
kernel configuration distributed as part of FreeBSD 9.0-RELEASE.
This kernel will not be updated: you MUST update the kernel manually
before running <span class=s2>&#34;/usr/sbin/freebsd-update install&#34;</span></code></pre></div></div><div class=paragraph><p>This warning may be safely ignored at this point. The updated <span class=filename>GENERIC</span> kernel will be used as an intermediate step in the upgrade process.</p></div><div class=paragraph><p>Once all the patches have been downloaded to the local system, they will be applied. This process may take a while, depending on the speed and workload of the machine. Configuration files will then be merged. The merging process requires some user intervention as a file may be merged or an editor may appear on screen for a manual merge. The results of every successful merge will be shown to the user as the process continues. A failed or ignored merge will cause the process to abort. Users may wish to make a backup of <span class=filename>/etc</span> and manually merge important files, such as <span class=filename>master.passwd</span> or <span class=filename>group</span> at a later time.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>The system is not being altered yet as all patching and merging is happening in another directory. Once all patches have been applied successfully, all configuration files have been merged and it seems the process will go smoothly, the changes can be committed to disk by the user using the following command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># freebsd-update install</span></code></pre></div></div></td></tr></tbody></table></div><div class=paragraph><p>The kernel and kernel modules will be patched first. If the system is running with a custom kernel, use <a href="https://man.freebsd.org/cgi/man.cgi?query=nextboot&amp;sektion=8&amp;format=html">nextboot(8)</a> to set the kernel for the next boot to the updated <span class=filename>/boot/GENERIC</span>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># nextboot -k GENERIC</span></code></pre></div></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>Before rebooting with the <span class=filename>GENERIC</span> kernel, make sure it contains all the drivers required for the system to boot properly and connect to the network, if the machine being updated is accessed remotely. In particular, if the running custom kernel contains built-in functionality usually provided by kernel modules, make sure to temporarily load these modules into the <span class=filename>GENERIC</span> kernel using the <span class=filename>/boot/loader.conf</span> facility. It is recommended to disable non-essential services as well as any disk and network mounts until the upgrade process is complete.</p></div></td></tr></tbody></table></div><div class=paragraph><p>The machine should now be restarted with the updated kernel:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># shutdown -r now</span></code></pre></div></div><div class=paragraph><p>Once the system has come back online, restart <code>freebsd-update</code> using the following command. Since the state of the process has been saved, <code>freebsd-update</code> will not start from the beginning, but will instead move on to the next phase and remove all old shared libraries and object files.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># freebsd-update install</span></code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Depending upon whether any library version numbers were bumped, there may only be two install phases instead of three.</p></div></td></tr></tbody></table></div><div class=paragraph><p>The upgrade is now complete. If this was a major version upgrade, reinstall all ports and packages as described in <a href=#freebsdupdate-portsrebuild>Upgrading Packages After a Major Version Upgrade</a>.</p></div><div class=sect4><h5 id=freebsd-update-custom-kernel-9x>23.2.3.1. Custom Kernels with FreeBSD 9.X and Later<a class=anchor href=#freebsd-update-custom-kernel-9x></a></h5><div class=paragraph><p>Before using <code>freebsd-update</code>, ensure that a copy of the <span class=filename>GENERIC</span> kernel exists in <span class=filename>/boot/GENERIC</span>. If a custom kernel has only been built once, the kernel in <span class=filename>/boot/kernel.old</span> is the <code>GENERIC</code> kernel. Simply rename this directory to <span class=filename>/boot/kernel</span>.</p></div><div class=paragraph><p>If a custom kernel has been built more than once or if it is unknown how many times the custom kernel has been built, obtain a copy of the <code>GENERIC</code> kernel that matches the current version of the operating system. If physical access to the system is available, a copy of the <code>GENERIC</code> kernel can be installed from the installation media:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mount /cdrom</span>
<span class=c># cd /cdrom/usr/freebsd-dist</span>
<span class=c># tar -C/ -xvf kernel.txz boot/kernel/kernel</span></code></pre></div></div><div class=paragraph><p>Alternately, the <code>GENERIC</code> kernel may be rebuilt and installed from source:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/src</span>
<span class=c># make kernel __MAKE_CONF=/dev/null SRCCONF=/dev/null</span></code></pre></div></div><div class=paragraph><p>For this kernel to be identified as the <code>GENERIC</code> kernel by <code>freebsd-update</code>, the <span class=filename>GENERIC</span> configuration file must not have been modified in any way. It is also suggested that the kernel is built without any other special options.</p></div><div class=paragraph><p>Rebooting into the <span class=filename>GENERIC</span> kernel is not required as <code>freebsd-update</code> only needs <span class=filename>/boot/GENERIC</span> to exist.</p></div></div><div class=sect4><h5 id=freebsdupdate-portsrebuild>23.2.3.2. Upgrading Packages After a Major Version Upgrade<a class=anchor href=#freebsdupdate-portsrebuild></a></h5><div class=paragraph><p>Generally, installed applications will continue to work without problems after minor version upgrades. Major versions use different Application Binary Interfaces (ABIs), which will break most third-party applications. After a major version upgrade, all installed packages and ports need to be upgraded. Packages can be upgraded using <code>pkg upgrade</code>. To upgrade installed ports, use a utility such as <a class=package href=https://cgit.freebsd.org/ports/tree/ports-mgmt/portmaster/>ports-mgmt/portmaster</a>.</p></div><div class=paragraph><p>A forced upgrade of all installed packages will replace the packages with fresh versions from the repository even if the version number has not increased. This is required because of the ABI version change when upgrading between major versions of FreeBSD. The forced upgrade can be accomplished by performing:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pkg-static upgrade -f</span></code></pre></div></div><div class=paragraph><p>A rebuild of all installed applications can be accomplished with this command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># portmaster -af</span></code></pre></div></div><div class=paragraph><p>This command will display the configuration screens for each application that has configurable options and wait for the user to interact with those screens. To prevent this behavior, and use only the default options, include <code>-G</code> in the above command.</p></div><div class=paragraph><p>Once the software upgrades are complete, finish the upgrade process with a final call to <code>freebsd-update</code> in order to tie up all the loose ends in the upgrade process:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># freebsd-update install</span></code></pre></div></div><div class=paragraph><p>If the <span class=filename>GENERIC</span> kernel was temporarily used, this is the time to build and install a new custom kernel using the instructions in <a href=./#kernelconfig>Configuring the FreeBSD Kernel</a>.</p></div><div class=paragraph><p>Reboot the machine into the new FreeBSD version. The upgrade process is now complete.</p></div></div></div><div class=sect3><h4 id=freebsdupdate-system-comparison>23.2.4. System State Comparison<a class=anchor href=#freebsdupdate-system-comparison></a></h4><div class=paragraph><p>The state of the installed FreeBSD version against a known good copy can be tested using <code>freebsd-update IDS</code>. This command evaluates the current version of system utilities, libraries, and configuration files and can be used as a built-in Intrusion Detection System (IDS).</p></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>This command is not a replacement for a real IDS such as <a class=package href=https://cgit.freebsd.org/ports/tree/security/snort/>security/snort</a>. As <code>freebsd-update</code> stores data on disk, the possibility of tampering is evident. While this possibility may be reduced using <code>kern.securelevel</code> and by storing the <code>freebsd-update</code> data on a read-only file system when not in use, a better solution would be to compare the system against a secure disk, such as a DVD or securely stored external USB disk device. An alternative method for providing IDS functionality using a built-in utility is described in <a href=./#security-ids>Binary Verification</a></p></div></td></tr></tbody></table></div><div class=paragraph><p>To begin the comparison, specify the output file to save the results to:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># freebsd-update IDS &gt;&gt; outfile.ids</span></code></pre></div></div><div class=paragraph><p>The system will now be inspected and a lengthy listing of files, along with the SHA256 hash values for both the known value in the release and the current installation, will be sent to the specified output file.</p></div><div class=paragraph><p>The entries in the listing are extremely long, but the output format may be easily parsed. For instance, to obtain a list of all files which differ from those in the release, issue the following command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cat outfile.ids | awk &#39;{ print $1 }&#39; | more</span>
/etc/master.passwd
/etc/motd
/etc/passwd
/etc/pf.conf</code></pre></div></div><div class=paragraph><p>This sample output has been truncated as many more files exist. Some files have natural modifications. For example, <span class=filename>/etc/passwd</span> will be modified if users have been added to the system. Kernel modules may differ as <code>freebsd-update</code> may have updated them. To exclude specific files or directories, add them to the <code>IDSIgnorePaths</code> option in <span class=filename>/etc/freebsd-update.conf</span>.</p></div></div></div><div class=sect2><h3 id=updating-upgrading-documentation>23.3. Updating the Documentation Set<a class=anchor href=#updating-upgrading-documentation></a></h3><div class=paragraph><p>Documentation is an integral part of the FreeBSD operating system. While an up-to-date version of the FreeBSD documentation is always available on the FreeBSD web site (<a href=https://www.FreeBSD.org/doc/>https://www.freebsd.org/doc/</a>), it can be handy to have an up-to-date, local copy of the FreeBSD website, handbooks, FAQ, and articles.</p></div><div class=paragraph><p>This section describes how to use either source or the FreeBSD Ports Collection to keep a local copy of the FreeBSD documentation up-to-date.</p></div><div class=paragraph><p>For information on editing and submitting corrections to the documentation, refer to the FreeBSD Documentation Project Primer for New Contributors (<a href=https://docs.freebsd.org/en/books/fdp-primer/>FreeBSD Documentation Project Primer for New Contributors</a>).</p></div><div class=sect3><h4 id=updating-installed-documentation>23.3.1. Updating Documentation from Source<a class=anchor href=#updating-installed-documentation></a></h4><div class=paragraph><p>Rebuilding the FreeBSD documentation from source requires a collection of tools which are not part of the FreeBSD base system. The required tools can be installed from the <a class=package href=https://cgit.freebsd.org/ports/tree/textproc/docproj/>textproc/docproj</a> package or port developed by the FreeBSD Documentation Project.</p></div><div class=paragraph><p>Once installed, use svnlite to fetch a clean copy of the documentation source:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># svnlite checkout https://svn.FreeBSD.org/doc/head /usr/doc</span></code></pre></div></div><div class=paragraph><p>The initial download of the documentation sources may take a while. Let it run until it completes.</p></div><div class=paragraph><p>Future updates of the documentation sources may be fetched by running:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># svnlite update /usr/doc</span></code></pre></div></div><div class=paragraph><p>Once an up-to-date snapshot of the documentation sources has been fetched to <span class=filename>/usr/doc</span>, everything is ready for an update of the installed documentation.</p></div><div class=paragraph><p>A full update of all available languages may be performed by typing:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/doc</span>
<span class=c># make install clean</span></code></pre></div></div><div class=paragraph><p>If an update of only a specific language is desired, <code>make</code> can be invoked in a language-specific subdirectory of <span class=filename>/usr/doc</span>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/doc/en_US.ISO8859-1</span>
<span class=c># make install clean</span></code></pre></div></div><div class=paragraph><p>An alternative way of updating the documentation is to run this command from <span class=filename>/usr/doc</span> or the desired language-specific subdirectory:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># make update</span></code></pre></div></div><div class=paragraph><p>The output formats that will be installed may be specified by setting <code>FORMATS</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/doc</span>
<span class=c># make FORMATS=&#39;html html-split&#39; install clean</span></code></pre></div></div><div class=paragraph><p>Several options are available to ease the process of updating only parts of the documentation, or the build of specific translations. These options can be set either as system-wide options in <span class=filename>/etc/make.conf</span>, or as command-line options passed to <code>make</code>.</p></div><div class=paragraph><p>The options include:</p></div><div class=dlist><dl><dt class=hdlist1><code>DOC_LANG</code></dt><dd><p>The list of languages and encodings to build and install, such as <code>en_US.ISO8859-1</code> for English documentation.</p></dd><dt class=hdlist1><code>FORMATS</code></dt><dd><p>A single format or a list of output formats to be built. Currently, <code>html</code>, <code>html-split</code>, <code>txt</code>, <code>ps</code>, and <code>pdf</code> are supported.</p></dd><dt class=hdlist1><code>DOCDIR</code></dt><dd><p>Where to install the documentation. It defaults to <span class=filename>/usr/shared/doc</span>.</p></dd></dl></div><div class=paragraph><p>For more <code>make</code> variables supported as system-wide options in FreeBSD, refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=make.conf&amp;sektion=5&amp;format=html">make.conf(5)</a>.</p></div></div><div class=sect3><h4 id=doc-ports-install-package>23.3.2. Updating Documentation from Ports<a class=anchor href=#doc-ports-install-package></a></h4><div class=paragraph><p>The previous section presented a method for updating the FreeBSD documentation from sources. This section describes an alternative method which uses the Ports Collection and makes it possible to:</p></div><div class=ulist><ul><li><p>Install pre-built packages of the documentation, without having to locally build anything or install the documentation toolchain.</p></li><li><p>Build the documentation sources through the ports framework, making the checkout and build steps a bit easier.</p></li></ul></div><div class=paragraph><p>This method of updating the FreeBSD documentation is supported by a set of documentation ports and packages which are updated by the Documentation Engineering Team &lt;<a href=mailto:doceng@FreeBSD.org>doceng@FreeBSD.org</a>> on a monthly basis. These are listed in the FreeBSD Ports Collection, under the docs category (<a href=http://www.freshports.org/docs/>http://www.freshports.org/docs/</a>).</p></div><div class=paragraph><p>Organization of the documentation ports is as follows:</p></div><div class=ulist><ul><li><p>The <a class=package href=https://cgit.freebsd.org/ports/tree/misc/freebsd-doc-en/>misc/freebsd-doc-en</a> package or port installs all of the English documentation.</p></li><li><p>The <a class=package href=https://cgit.freebsd.org/ports/tree/misc/freebsd-doc-all/>misc/freebsd-doc-all</a> meta-package or port installs all documentation in all available languages.</p></li><li><p>There is a package and port for each translation, such as <a class=package href=https://cgit.freebsd.org/ports/tree/misc/freebsd-doc-hu/>misc/freebsd-doc-hu</a> for the Hungarian documentation.</p></li></ul></div><div class=paragraph><p>When binary packages are used, the FreeBSD documentation will be installed in all available formats for the given language. For example, the following command will install the latest package of the Hungarian documentation:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pkg install hu-freebsd-doc</span></code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Packages use a format that differs from the corresponding port’s name: <code><em>lang</em>-freebsd-doc</code>, where <em>lang</em> is the short format of the language code, such as <code>hu</code> for Hungarian, or <code>zh_cn</code> for Simplified Chinese.</p></div></td></tr></tbody></table></div><div class=paragraph><p>To specify the format of the documentation, build the port instead of installing the package. For example, to build and install the English documentation:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/ports/misc/freebsd-doc-en</span>
<span class=c># make install clean</span></code></pre></div></div><div class=paragraph><p>The port provides a configuration menu where the format to build and install can be specified. By default, split HTML, similar to the format used on <a href=http://www.FreeBSD.org>http://www.FreeBSD.org</a>, and PDF are selected.</p></div><div class=paragraph><p>Alternately, several <code>make</code> options can be specified when building a documentation port, including:</p></div><div class=dlist><dl><dt class=hdlist1><code>WITH_HTML</code></dt><dd><p>Builds the HTML format with a single HTML file per document. The formatted documentation is saved to a file called <span class=filename>article.html</span>, or <span class=filename>book.html</span>.</p></dd><dt class=hdlist1><code>WITH_PDF</code></dt><dd><p>The formatted documentation is saved to a file called <span class=filename>article.pdf</span> or <span class=filename>book.pdf</span>.</p></dd><dt class=hdlist1><code>DOCBASE</code></dt><dd><p>Specifies where to install the documentation. It defaults to <span class=filename>/usr/local/shared/doc/freebsd</span>.</p></dd></dl></div><div class=paragraph><p>This example uses variables to install the Hungarian documentation as a PDF in the specified directory:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/ports/misc/freebsd-doc-hu</span>
<span class=c># make -DWITH_PDF DOCBASE=share/doc/freebsd/hu install clean</span></code></pre></div></div><div class=paragraph><p>Documentation packages or ports can be updated using the instructions in <a href=./#ports>Installing Applications: Packages and Ports</a>. For example, the following command updates the installed Hungarian documentation using <a class=package href=https://cgit.freebsd.org/ports/tree/ports-mgmt/portmaster/>ports-mgmt/portmaster</a> by using packages only:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># portmaster -PP hu-freebsd-doc</span></code></pre></div></div></div></div><div class=sect2><h3 id=current-stable>23.4. Tracking a Development Branch<a class=anchor href=#current-stable></a></h3><div class=paragraph><p>FreeBSD has two development branches: FreeBSD-CURRENT and FreeBSD-STABLE.</p></div><div class=paragraph><p>This section provides an explanation of each branch and its intended audience, as well as how to keep a system up-to-date with each respective branch.</p></div><div class=sect3><h4 id=current>23.4.1. Using FreeBSD-CURRENT<a class=anchor href=#current></a></h4><div class=paragraph><p>FreeBSD-CURRENT is the "bleeding edge" of FreeBSD development and FreeBSD-CURRENT users are expected to have a high degree of technical skill. Less technical users who wish to track a development branch should track FreeBSD-STABLE instead.</p></div><div class=paragraph><p>FreeBSD-CURRENT is the very latest source code for FreeBSD and includes works in progress, experimental changes, and transitional mechanisms that might or might not be present in the next official release. While many FreeBSD developers compile the FreeBSD-CURRENT source code daily, there are short periods of time when the source may not be buildable. These problems are resolved as quickly as possible, but whether or not FreeBSD-CURRENT brings disaster or new functionality can be a matter of when the source code was synced.</p></div><div class=paragraph><p>FreeBSD-CURRENT is made available for three primary interest groups:</p></div><div class="olist arabic"><ol class=arabic><li><p>Members of the FreeBSD community who are actively working on some part of the source tree.</p></li><li><p>Members of the FreeBSD community who are active testers. They are willing to spend time solving problems, making topical suggestions on changes and the general direction of FreeBSD, and submitting patches.</p></li><li><p>Users who wish to keep an eye on things, use the current source for reference purposes, or make the occasional comment or code contribution.</p></li></ol></div><div class=paragraph><p>FreeBSD-CURRENT should <em>not</em> be considered a fast-track to getting new features before the next release as pre-release features are not yet fully tested and most likely contain bugs. It is not a quick way of getting bug fixes as any given commit is just as likely to introduce new bugs as to fix existing ones. FreeBSD-CURRENT is not in any way "officially supported".</p></div><div class=paragraph><p>To track FreeBSD-CURRENT:</p></div><div class="olist arabic"><ol class=arabic><li><p>Join the <a href=https://lists.FreeBSD.org/subscription/freebsd-current>FreeBSD-CURRENT mailing list</a> and the <a href=https://lists.FreeBSD.org/subscription/svn-src-head>SVN commit messages for the src tree for head/-current</a> lists. This is <em>essential</em> in order to see the comments that people are making about the current state of the system and to receive important bulletins about the current state of FreeBSD-CURRENT.</p><div class=paragraph><p>The <a href=https://lists.FreeBSD.org/subscription/svn-src-head>SVN commit messages for the src tree for head/-current</a> list records the commit log entry for each change as it is made, along with any pertinent information on possible side effects.</p></div><div class=paragraph><p>To join these lists, go to <a href=https://lists.freebsd.org>FreeBSD list server</a>, click on the list to subscribe to, and follow the instructions. In order to track changes to the whole source tree, not just the changes to FreeBSD-CURRENT, subscribe to the <a href=https://lists.FreeBSD.org/subscription/svn-src-all>SVN commit messages for the entire src tree (except for user and "projects")</a>.</p></div></li><li><p>Synchronize with the FreeBSD-CURRENT sources. Typically, <a href=#svn>svnlite</a> is used to check out the -CURRENT code from the <code>head</code> branch of one of the Subversion mirror sites listed in <a href=./#svn-mirrors>“Subversion Mirror Sites”</a>.</p></li><li><p>Due to the size of the repository, some users choose to only synchronize the sections of source that interest them or which they are contributing patches to. However, users that plan to compile the operating system from source must download <em>all</em> of FreeBSD-CURRENT, not just selected portions.</p><div class=paragraph><p>Before compiling FreeBSD-CURRENT , read <span class=filename>/usr/src/Makefile</span> very carefully and follow the instructions in <a href=#makeworld>Updating FreeBSD from Source</a>. Read the <a href=https://lists.FreeBSD.org/subscription/freebsd-current>FreeBSD-CURRENT mailing list</a> and <span class=filename>/usr/src/UPDATING</span> to stay up-to-date on other bootstrapping procedures that sometimes become necessary on the road to the next release.</p></div></li><li><p>Be active! FreeBSD-CURRENT users are encouraged to submit their suggestions for enhancements or bug fixes. Suggestions with accompanying code are always welcome.</p></li></ol></div></div><div class=sect3><h4 id=stable>23.4.2. Using FreeBSD-STABLE<a class=anchor href=#stable></a></h4><div class=paragraph><p>FreeBSD-STABLE is the development branch from which major releases are made. Changes go into this branch at a slower pace and with the general assumption that they have first been tested in FreeBSD-CURRENT. This is <em>still</em> a development branch and, at any given time, the sources for FreeBSD-STABLE may or may not be suitable for general use. It is simply another engineering development track, not a resource for end-users. Users who do not have the resources to perform testing should instead run the most recent release of FreeBSD.</p></div><div class=paragraph><p>Those interested in tracking or contributing to the FreeBSD development process, especially as it relates to the next release of FreeBSD, should consider following FreeBSD-STABLE.</p></div><div class=paragraph><p>While the FreeBSD-STABLE branch should compile and run at all times, this cannot be guaranteed. Since more people run FreeBSD-STABLE than FreeBSD-CURRENT, it is inevitable that bugs and corner cases will sometimes be found in FreeBSD-STABLE that were not apparent in FreeBSD-CURRENT. For this reason, one should not blindly track FreeBSD-STABLE. It is particularly important <em>not</em> to update any production servers to FreeBSD-STABLE without thoroughly testing the code in a development or testing environment.</p></div><div class=paragraph><p>To track FreeBSD-STABLE:</p></div><div class="olist arabic"><ol class=arabic><li><p>Join the <a href=https://lists.FreeBSD.org/subscription/freebsd-stable>FreeBSD-STABLE; mailing list</a> in order to stay informed of build dependencies that may appear in FreeBSD-STABLE or any other issues requiring special attention. Developers will also make announcements in this mailing list when they are contemplating some controversial fix or update, giving the users a chance to respond if they have any issues to raise concerning the proposed change.</p><div class=paragraph><p>Join the relevant svn list for the branch being tracked. For example, users tracking the 9-STABLE branch should join the <a href=https://lists.FreeBSD.org/subscription/svn-src-stable-9>SVN commit messages for only the 9-stable src tree</a>. This list records the commit log entry for each change as it is made, along with any pertinent information on possible side effects.</p></div><div class=paragraph><p>To join these lists, go to <a href=https://lists.freebsd.org>FreeBSD list server</a>, click on the list to subscribe to, and follow the instructions. In order to track changes for the whole source tree, subscribe to <a href=https://lists.FreeBSD.org/subscription/svn-src-all>SVN commit messages for the entire src tree (except for user and "projects")</a>.</p></div></li><li><p>To install a new FreeBSD-STABLE system, install the most recent FreeBSD-STABLE release from the <a href=./#mirrors>FreeBSD mirror sites</a> or use a monthly snapshot built from FreeBSD-STABLE. Refer to <a href=https://www.FreeBSD.org/snapshots/>www.freebsd.org/snapshots</a> for more information about snapshots.</p><div class=paragraph><p>To compile or upgrade to an existing FreeBSD system to FreeBSD-STABLE, use <a href=./#svn>svn</a> to check out the source for the desired branch. Branch names, such as <code>stable/9</code>, are listed at <a href=https://www.FreeBSD.org/releng/>www.freebsd.org/releng</a>.</p></div></li><li><p>Before compiling or upgrading to FreeBSD-STABLE , read <span class=filename>/usr/src/Makefile</span> carefully and follow the instructions in <a href=#makeworld>Updating FreeBSD from Source</a>. Read the <a href=https://lists.FreeBSD.org/subscription/freebsd-stable>FreeBSD-STABLE; mailing list</a> and <span class=filename>/usr/src/UPDATING</span> to keep up-to-date on other bootstrapping procedures that sometimes become necessary on the road to the next release.</p></li></ol></div></div></div><div class=sect2><h3 id=makeworld>23.5. Updating FreeBSD from Source<a class=anchor href=#makeworld></a></h3><div class=paragraph><p>Updating FreeBSD by compiling from source offers several advantages over binary updates. Code can be built with options to take advantage of specific hardware. Parts of the base system can be built with non-default settings, or left out entirely where they are not needed or desired. The build process takes longer to update a system than just installing binary updates, but allows complete customization to produce a tailored version of FreeBSD.</p></div><div class=sect3><h4 id=updating-src-quick-start>23.5.1. Quick Start<a class=anchor href=#updating-src-quick-start></a></h4><div class=paragraph><p>This is a quick reference for the typical steps used to update FreeBSD by building from source. Later sections describe the process in more detail.</p></div><div class="exampleblock procedure"><div class=content><div class=ulist><ul><li><p>Update and Build</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># svnlite update /usr/src  </span><i class=conum data-value=1></i><b>(1)</b>
check /usr/src/UPDATING  <i class=conum data-value=2></i><b>(2)</b>
<span class=c># cd /usr/src          </span><i class=conum data-value=3></i><b>(3)</b>
<span class=c># make -j4 buildworld  </span><i class=conum data-value=4></i><b>(4)</b>
<span class=c># make -j4 kernel      </span><i class=conum data-value=5></i><b>(5)</b>
<span class=c># shutdown -r now      </span><i class=conum data-value=6></i><b>(6)</b>
<span class=c># cd /usr/src          </span><i class=conum data-value=7></i><b>(7)</b>
<span class=c># make installworld    </span><i class=conum data-value=8></i><b>(8)</b>
<span class=c># mergemaster -Ui      </span><i class=conum data-value=9></i><b>(9)</b>
<span class=c># shutdown -r now      1</span><i class=conum data-value=10></i><b>(10)</b></code></pre></div></div></li></ul></div><div class="colist arabic"><table><tbody><tr><td><i class=conum data-value=1></i><b>1</b></td><td>Get the latest version of the source. See <a href=#updating-src-obtaining-src>Updating the Source</a> for more information on obtaining and updating source.</td></tr><tr><td><i class=conum data-value=2></i><b>2</b></td><td>Check <span class=filename>/usr/src/UPDATING</span> for any manual steps required before or after building from source.</td></tr><tr><td><i class=conum data-value=3></i><b>3</b></td><td>Go to the source directory.</td></tr><tr><td><i class=conum data-value=4></i><b>4</b></td><td>Compile the world, everything except the kernel.</td></tr><tr><td><i class=conum data-value=5></i><b>5</b></td><td>Compile and install the kernel. This is equivalent to <code>make buildkernel installkernel</code>.</td></tr><tr><td><i class=conum data-value=6></i><b>6</b></td><td>Reboot the system to the new kernel.</td></tr><tr><td><i class=conum data-value=7></i><b>7</b></td><td>Go to the source directory.</td></tr><tr><td><i class=conum data-value=8></i><b>8</b></td><td>Install the world.</td></tr><tr><td><i class=conum data-value=9></i><b>9</b></td><td>Update and merge configuration files in <span class=filename>/etc/</span>.</td></tr><tr><td><i class=conum data-value=10></i><b>10</b></td><td>Restart the system to use the newly-built world and kernel.</td></tr></tbody></table></div></div></div></div><div class=sect3><h4 id=updating-src-preparing>23.5.2. Preparing for a Source Update<a class=anchor href=#updating-src-preparing></a></h4><div class=paragraph><p>Read <span class=filename>/usr/src/UPDATING</span>. Any manual steps that must be performed before or after an update are described in this file.</p></div></div><div class=sect3><h4 id=updating-src-obtaining-src>23.5.3. Updating the Source<a class=anchor href=#updating-src-obtaining-src></a></h4><div class=paragraph><p>FreeBSD source code is located in <span class=filename>/usr/src/</span>. The preferred method of updating this source is through the Subversion version control system. Verify that the source code is under version control:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># svnlite info /usr/src</span>
Path: /usr/src
Working Copy Root Path: /usr/src
...</code></pre></div></div><div class=paragraph><p>This indicates that <span class=filename>/usr/src/</span> is under version control and can be updated with <a href="https://man.freebsd.org/cgi/man.cgi?query=svnlite&amp;sektion=1&amp;format=html">svnlite(1)</a>:</p></div><div id=synching class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># svnlite update /usr/src</span></code></pre></div></div><div class=paragraph><p>The update process can take some time if the directory has not been updated recently. After it finishes, the source code is up to date and the build process described in the next section can begin.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p><strong>Obtaining the Source:</strong><br></p></div><div class=paragraph><p>If the output says <code>'/usr/src' is not a working copy</code>, the files there are missing or were installed with a different method. A new checkout of the source is required.</p></div><table id=updating-src-obtaining-src-repopath class="tableblock frame-all grid-all stretch"><caption class=title>Tabela 19. FreeBSD Versions and Repository Paths</caption><col style=width:10%><col style=width:10%><col style=width:80%><thead><tr><th class="tableblock halign-left valign-top">uname -r Output</th><th class="tableblock halign-left valign-top">Repository Path</th><th class="tableblock halign-left valign-top">Description</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code><em>X.Y</em>-RELEASE</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>base/releng/<em>X.Y</em></code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>The Release version plus only critical security and bug fix patches. This branch is recommended for most users.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code><em>X.Y</em>-STABLE</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>base/stable/<em>X</em></code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>The Release version plus all additional development on that branch. <em>STABLE</em> refers to the Applications Binary Interface (ABI) not changing, so software compiled for earlier versions still runs. For example, software compiled to run on FreeBSD 10.1 will still run on FreeBSD 10-STABLE compiled later.</p><p class=tableblock>STABLE branches occasionally have bugs or incompatibilities which might affect users, although these are typically fixed quickly.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code><em>X</em>-CURRENT</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>base/head/</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>The latest unreleased development version of FreeBSD. The CURRENT branch can have major bugs or incompatibilities and is recommended only for advanced users.</p></td></tr></tbody></table><div class=paragraph><p>Determine which version of FreeBSD is being used with <a href="https://man.freebsd.org/cgi/man.cgi?query=uname&amp;sektion=1&amp;format=html">uname(1)</a>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># uname -r</span>
10.3-RELEASE</code></pre></div></div><div class=paragraph><p>Based on <a href=#updating-src-obtaining-src-repopath>FreeBSD Versions and Repository Paths</a>, the source used to update <code>10.3-RELEASE</code> has a repository path of <code>base/releng/10.3</code>. That path is used when checking out the source:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mv /usr/src /usr/src.bak </span><i class=conum data-value=1></i><b>(1)</b>
<span class=c># svnlite checkout https://svn.freebsd.org/base/releng/10.3 /usr/src </span><i class=conum data-value=2></i><b>(2)</b></code></pre></div></div><div class="colist arabic"><table><tbody><tr><td><i class=conum data-value=1></i><b>1</b></td><td>Move the old directory out of the way. If there are no local modifications in this directory, it can be deleted.</td></tr><tr><td><i class=conum data-value=2></i><b>2</b></td><td>The path from <a href=#updating-src-obtaining-src-repopath>FreeBSD Versions and Repository Paths</a> is added to the repository URL. The third parameter is the destination directory for the source code on the local system.</td></tr></tbody></table></div></td></tr></tbody></table></div></div><div class=sect3><h4 id=updating-src-building>23.5.4. Building from Source<a class=anchor href=#updating-src-building></a></h4><div class=paragraph><p>The <em>world</em>, or all of the operating system except the kernel, is compiled. This is done first to provide up-to-date tools to build the kernel. Then the kernel itself is built:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/src</span>
<span class=c># make buildworld</span>
<span class=c># make buildkernel</span></code></pre></div></div><div class=paragraph><p>The compiled code is written to <span class=filename>/usr/obj</span>.</p></div><div class=paragraph><p>These are the basic steps. Additional options to control the build are described below.</p></div><div class=sect4><h5 id=updating-src-building-clean-build>23.5.4.1. Performing a Clean Build<a class=anchor href=#updating-src-building-clean-build></a></h5><div class=paragraph><p>Some versions of the FreeBSD build system leave previously-compiled code in the temporary object directory, <span class=filename>/usr/obj</span>. This can speed up later builds by avoiding recompiling code that has not changed. To force a clean rebuild of everything, use <code>cleanworld</code> before starting a build:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># make cleanworld</span></code></pre></div></div></div><div class=sect4><h5 id=updating-src-building-jobs>23.5.4.2. Setting the Number of Jobs<a class=anchor href=#updating-src-building-jobs></a></h5><div class=paragraph><p>Increasing the number of build jobs on multi-core processors can improve build speed. Determine the number of cores with <code>sysctl hw.ncpu</code>. Processors vary, as do the build systems used with different versions of FreeBSD, so testing is the only sure method to tell how a different number of jobs affects the build speed. For a starting point, consider values between half and double the number of cores. The number of jobs is specified with <code>-j</code>.</p></div><div id=updating-src-building-jobs-example class=exampleblock><div class=title>Przykład 24. Increasing the Number of Build Jobs</div><div class=content><div class=paragraph><p>Building the world and kernel with four jobs:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># make -j4 buildworld buildkernel</span></code></pre></div></div></div></div></div><div class=sect4><h5 id=updating-src-building-only-kernel>23.5.4.3. Building Only the Kernel<a class=anchor href=#updating-src-building-only-kernel></a></h5><div class=paragraph><p>A <code>buildworld</code> must be completed if the source code has changed. After that, a <code>buildkernel</code> to build a kernel can be run at any time. To build just the kernel:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/src</span>
<span class=c># make buildkernel</span></code></pre></div></div></div><div class=sect4><h5 id=updating-src-building-custom-kernel>23.5.4.4. Building a Custom Kernel<a class=anchor href=#updating-src-building-custom-kernel></a></h5><div class=paragraph><p>The standard FreeBSD kernel is based on a <em>kernel config file</em> called <span class=filename>GENERIC</span>. The <span class=filename>GENERIC</span> kernel includes the most commonly-needed device drivers and options. Sometimes it is useful or necessary to build a custom kernel, adding or removing device drivers or options to fit a specific need.</p></div><div class=paragraph><p>For example, someone developing a small embedded computer with severely limited RAM could remove unneeded device drivers or options to make the kernel slightly smaller.</p></div><div class=paragraph><p>Kernel config files are located in <span class=filename>/usr/src/sys/arch/conf/</span>, where <em>arch</em> is the output from <code>uname -m</code>. On most computers, that is <code>amd64</code>, giving a config file directory of <span class=filename>/usr/src/sys/amd64/conf/</span>.</p></div><div class="admonitionblock tip"><table><tbody><tr><td class=icon><i class="fa icon-tip" title=Tip></i></td><td class=content><div class=paragraph><p><span class=filename>/usr/src</span> can be deleted or recreated, so it is preferable to keep custom kernel config files in a separate directory, like <span class=filename>/root</span>. Link the kernel config file into the <span class=filename>conf</span> directory. If that directory is deleted or overwritten, the kernel config can be re-linked into the new one.</p></div></td></tr></tbody></table></div><div class=paragraph><p>A custom config file can be created by copying the <span class=filename>GENERIC</span> config file. In this example, the new custom kernel is for a storage server, so is named <span class=filename>STORAGESERVER</span>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cp /usr/src/sys/amd64/conf/GENERIC /root/STORAGESERVER</span>
<span class=c># cd /usr/src/sys/amd64/conf</span>
<span class=c># ln -s /root/STORAGESERVER .</span></code></pre></div></div><div class=paragraph><p><span class=filename>/root/STORAGESERVER</span> is then edited, adding or removing devices or options as shown in <a href="https://man.freebsd.org/cgi/man.cgi?query=config&amp;sektion=5&amp;format=html">config(5)</a>.</p></div><div class=paragraph><p>The custom kernel is built by setting <code>KERNCONF</code> to the kernel config file on the command line:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># make buildkernel KERNCONF=STORAGESERVER</span></code></pre></div></div></div></div><div class=sect3><h4 id=updating-src-installing>23.5.5. Installing the Compiled Code<a class=anchor href=#updating-src-installing></a></h4><div class=paragraph><p>After the <code>buildworld</code> and <code>buildkernel</code> steps have been completed, the new kernel and world are installed:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/src</span>
<span class=c># make installkernel</span>
<span class=c># shutdown -r now</span>
<span class=c># cd /usr/src</span>
<span class=c># make installworld</span>
<span class=c># shutdown -r now</span></code></pre></div></div><div class=paragraph><p>If a custom kernel was built, <code>KERNCONF</code> must also be set to use the new custom kernel:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/src</span>
<span class=c># make installkernel KERNCONF=STORAGESERVER</span>
<span class=c># shutdown -r now</span>
<span class=c># cd /usr/src</span>
<span class=c># make installworld</span>
<span class=c># shutdown -r now</span></code></pre></div></div></div><div class=sect3><h4 id=updating-src-completing>23.5.6. Completing the Update<a class=anchor href=#updating-src-completing></a></h4><div class=paragraph><p>A few final tasks complete the update. Any modified configuration files are merged with the new versions, outdated libraries are located and removed, then the system is restarted.</p></div><div class=sect4><h5 id=updating-src-completing-merge-mergemaster>23.5.6.1. Merging Configuration Files with <a href="https://man.freebsd.org/cgi/man.cgi?query=mergemaster&amp;sektion=8&amp;format=html">mergemaster(8)</a><a class=anchor href=#updating-src-completing-merge-mergemaster></a></h5><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=mergemaster&amp;sektion=8&amp;format=html">mergemaster(8)</a> provides an easy way to merge changes that have been made to system configuration files with new versions of those files.</p></div><div class=paragraph><p>With <code>-Ui</code>, <a href="https://man.freebsd.org/cgi/man.cgi?query=mergemaster&amp;sektion=8&amp;format=html">mergemaster(8)</a> automatically updates files that have not been user-modified and installs new files that are not already present:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mergemaster -Ui</span></code></pre></div></div><div class=paragraph><p>If a file must be manually merged, an interactive display allows the user to choose which portions of the files are kept. See <a href="https://man.freebsd.org/cgi/man.cgi?query=mergemaster&amp;sektion=8&amp;format=html">mergemaster(8)</a> for more information.</p></div></div><div class=sect4><h5 id=updating-src-completing-check-old>23.5.6.2. Checking for Outdated Files and Libraries<a class=anchor href=#updating-src-completing-check-old></a></h5><div class=paragraph><p>Some obsolete files or directories can remain after an update. These files can be located:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># make check-old</span></code></pre></div></div><div class=paragraph><p>and deleted:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># make delete-old</span></code></pre></div></div><div class=paragraph><p>Some obsolete libraries can also remain. These can be detected with:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># make check-old-libs</span></code></pre></div></div><div class=paragraph><p>and deleted with</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># make delete-old-libs</span></code></pre></div></div><div class=paragraph><p>Programs which were still using those old libraries will stop working when the library has been deleted. These programs must be rebuilt or replaced after deleting the old libraries.</p></div><div class="admonitionblock tip"><table><tbody><tr><td class=icon><i class="fa icon-tip" title=Tip></i></td><td class=content><div class=paragraph><p>When all the old files or directories are known to be safe to delete, pressing <kbd>y</kbd> and <kbd>Enter</kbd> to delete each file can be avoided by setting <code>BATCH_DELETE_OLD_FILES</code> in the command. For example:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># make BATCH_DELETE_OLD_FILES=yes delete-old-libs</span></code></pre></div></div></td></tr></tbody></table></div></div><div class=sect4><h5 id=updating-src-completing-restart>23.5.6.3. Restarting After the Update<a class=anchor href=#updating-src-completing-restart></a></h5><div class=paragraph><p>The last step after updating is to restart the computer so all the changes take effect:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># shutdown -r now</span></code></pre></div></div></div></div></div><div class=sect2><h3 id=small-lan>23.6. Tracking for Multiple Machines<a class=anchor href=#small-lan></a></h3><div class=paragraph><p>When multiple machines need to track the same source tree, it is a waste of disk space, network bandwidth, and CPU cycles to have each system download the sources and rebuild everything. The solution is to have one machine do most of the work, while the rest of the machines mount that work via NFS. This section outlines a method of doing so. For more information about using NFS, refer to <a href=./#network-nfs>Network File System (NFS)</a>.</p></div><div class=paragraph><p>First, identify a set of machines which will run the same set of binaries, known as a <em>build set</em>. Each machine can have a custom kernel, but will run the same userland binaries. From that set, choose a machine to be the <em>build machine</em> that the world and kernel are built on. Ideally, this is a fast machine that has sufficient spare CPU to run <code>make buildworld</code> and <code>make buildkernel</code>.</p></div><div class=paragraph><p>Select a machine to be the <em>test machine</em>, which will test software updates before they are put into production. This <em>must</em> be a machine that can afford to be down for an extended period of time. It can be the build machine, but need not be.</p></div><div class=paragraph><p>All the machines in this build set need to mount <span class=filename>/usr/obj</span> and <span class=filename>/usr/src</span> from the build machine via NFS. For multiple build sets, <span class=filename>/usr/src</span> should be on one build machine, and NFS mounted on the rest.</p></div><div class=paragraph><p>Ensure that <span class=filename>/etc/make.conf</span> and <span class=filename>/etc/src.conf</span> on all the machines in the build set agree with the build machine. That means that the build machine must build all the parts of the base system that any machine in the build set is going to install. Also, each build machine should have its kernel name set with <code>KERNCONF</code> in <span class=filename>/etc/make.conf</span>, and the build machine should list them all in its <code>KERNCONF</code>, listing its own kernel first. The build machine must have the kernel configuration files for each machine in its <span class=filename>/usr/src/sys/arch/conf</span>.</p></div><div class=paragraph><p>On the build machine, build the kernel and world as described in <a href=#makeworld>Updating FreeBSD from Source</a>, but do not install anything on the build machine. Instead, install the built kernel on the test machine. On the test machine, mount <span class=filename>/usr/src</span> and <span class=filename>/usr/obj</span> via NFS. Then, run <code>shutdown now</code> to go to single-user mode in order to install the new kernel and world and run <code>mergemaster</code> as usual. When done, reboot to return to normal multi-user operations.</p></div><div class=paragraph><p>After verifying that everything on the test machine is working properly, use the same procedure to install the new software on each of the other machines in the build set.</p></div><div class=paragraph><p>The same methodology can be used for the ports tree. The first step is to share <span class=filename>/usr/ports</span> via NFS to all the machines in the build set. To configure <span class=filename>/etc/make.conf</span> to share distfiles, set <code>DISTDIR</code> to a common shared directory that is writable by whichever user <code>root</code> is mapped to by the NFS mount. Each machine should set <code>WRKDIRPREFIX</code> to a local build directory, if ports are to be built locally. Alternately, if the build system is to build and distribute packages to the machines in the build set, set <code>PACKAGES</code> on the build system to a directory similar to <code>DISTDIR</code>.</p></div></div></div></div><div class=sect1><h2 id=dtrace>Rozdział 24. DTrace<a class=anchor href=#dtrace></a></h2><div class=sectionbody><div class=sect2><h3 id=dtrace-synopsis>24.1. Synopsis<a class=anchor href=#dtrace-synopsis></a></h3><div class=paragraph><p>DTrace, also known as Dynamic Tracing, was developed by Sun™ as a tool for locating performance bottlenecks in production and pre-production systems. In addition to diagnosing performance problems, DTrace can be used to help investigate and debug unexpected behavior in both the FreeBSD kernel and in userland programs.</p></div><div class=paragraph><p>DTrace is a remarkable profiling tool, with an impressive array of features for diagnosing system issues. It may also be used to run pre-written scripts to take advantage of its capabilities. Users can author their own utilities using the DTrace D Language, allowing them to customize their profiling based on specific needs.</p></div><div class=paragraph><p>The FreeBSD implementation provides full support for kernel DTrace and experimental support for userland DTrace. Userland DTrace allows users to perform function boundary tracing for userland programs using the <code>pid</code> provider, and to insert static probes into userland programs for later tracing. Some ports, such as <a class=package href=https://cgit.freebsd.org/ports/tree/databases/postgresql12-server/>databases/postgresql12-server</a> and <a class=package href=https://cgit.freebsd.org/ports/tree/lang/php74/>lang/php74</a> have a DTrace option to enable static probes.</p></div><div class=paragraph><p>The official guide to DTrace is maintained by the Illumos project at <a href=http://dtrace.org/guide>DTrace Guide</a>.</p></div><div class=paragraph><p>After reading this chapter, you will know:</p></div><div class=ulist><ul><li><p>What DTrace is and what features it provides.</p></li><li><p>Differences between the Solaris™ DTrace implementation and the one provided by FreeBSD.</p></li><li><p>How to enable and use DTrace on FreeBSD.</p></li></ul></div><div class=paragraph><p>Before reading this chapter, you should:</p></div><div class=ulist><ul><li><p>Understand UNIX® and FreeBSD basics (<a href=./#basics>FreeBSD Basics</a>).</p></li><li><p>Have some familiarity with security and how it pertains to FreeBSD (<a href=./#security>Security</a>).</p></li></ul></div></div><div class=sect2><h3 id=dtrace-implementation>24.2. Implementation Differences<a class=anchor href=#dtrace-implementation></a></h3><div class=paragraph><p>While the DTrace in FreeBSD is similar to that found in Solaris™, differences do exist. The primary difference is that in FreeBSD, DTrace is implemented as a set of kernel modules and DTrace can not be used until the modules are loaded. To load all of the necessary modules:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># kldload dtraceall</span></code></pre></div></div><div class=paragraph><p>Beginning with FreeBSD 10.0-RELEASE, the modules are automatically loaded when <code>dtrace</code> is run.</p></div><div class=paragraph><p>FreeBSD uses the <code>DDB_CTF</code> kernel option to enable support for loading <code>CTF</code> data from kernel modules and the kernel itself. <code>CTF</code> is the Solaris™ Compact C Type Format which encapsulates a reduced form of debugging information similar to <code>DWARF</code> and the venerable stabs. <code>CTF</code> data is added to binaries by the <code>ctfconvert</code> and <code>ctfmerge</code> build tools. The <code>ctfconvert</code> utility parses <code>DWARF<code>ELF</code> debug sections created by the compiler and <code>ctfmerge</code> merges <code>CTF</code>ELF</code> sections from objects into either executables or shared libraries.</p></div><div class=paragraph><p>Some different providers exist for FreeBSD than for Solaris™. Most notable is the <code>dtmalloc</code> provider, which allows tracing <code>malloc()</code> by type in the FreeBSD kernel. Some of the providers found in Solaris™, such as <code>cpc</code> and <code>mib</code>, are not present in FreeBSD. These may appear in future versions of FreeBSD. Moreover, some of the providers available in both operating systems are not compatible, in the sense that their probes have different argument types. Thus, <code>D</code> scripts written on Solaris™ may or may not work unmodified on FreeBSD, and vice versa.</p></div><div class=paragraph><p>Due to security differences, only <code>root</code> may use DTrace on FreeBSD. Solaris™ has a few low level security checks which do not yet exist in FreeBSD. As such, the <span class=filename>/dev/dtrace/dtrace</span> is strictly limited to <code>root</code>.</p></div><div class=paragraph><p>DTrace falls under the Common Development and Distribution License (<code>CDDL</code>) license. To view this license on FreeBSD, see <span class=filename>/usr/src/cddl/contrib/opensolaris/OPENSOLARIS.LICENSE</span> or view it online at <a href=http://opensource.org/licenses/CDDL-1.0>http://opensource.org/licenses/CDDL-1.0</a>. While a FreeBSD kernel with DTrace support is <code>BSD</code> licensed, the <code>CDDL</code> is used when the modules are distributed in binary form or the binaries are loaded.</p></div></div><div class=sect2><h3 id=dtrace-enable>24.3. Enabling DTrace Support<a class=anchor href=#dtrace-enable></a></h3><div class=paragraph><p>In FreeBSD 9.2 and 10.0, DTrace support is built into the <span class=filename>GENERIC</span> kernel. Users of earlier versions of FreeBSD or who prefer to statically compile in DTrace support should add the following lines to a custom kernel configuration file and recompile the kernel using the instructions in <a href=./#kernelconfig>Configuring the FreeBSD Kernel</a>:</p></div><div class="literalblock programlisting"><div class=content><pre>options         KDTRACE_HOOKS
options         DDB_CTF
makeoptions	DEBUG=-g
makeoptions	WITH_CTF=1</pre></div></div><div class=paragraph><p>Users of the AMD64 architecture should also add this line:</p></div><div class="literalblock programlisting"><div class=content><pre>options         KDTRACE_FRAME</pre></div></div><div class=paragraph><p>This option provides support for <code>FBT</code>. While DTrace will work without this option, there will be limited support for function boundary tracing.</p></div><div class=paragraph><p>Once the FreeBSD system has rebooted into the new kernel, or the DTrace kernel modules have been loaded using <code>kldload dtraceall</code>, the system will need support for the Korn shell as the DTrace Toolkit has several utilities written in <code>ksh</code>. Make sure that the <a class=package href=https://cgit.freebsd.org/ports/tree/shells/ksh93/>shells/ksh93</a> package or port is installed. It is also possible to run these tools under <a class=package href=https://cgit.freebsd.org/ports/tree/shells/pdksh/>shells/pdksh</a> or <a class=package href=https://cgit.freebsd.org/ports/tree/shells/mksh/>shells/mksh</a>.</p></div><div class=paragraph><p>Finally, install the current DTrace Toolkit, a collection of ready-made scripts for collecting system information. There are scripts to check open files, memory, <code>CPU</code> usage, and a lot more. FreeBSD 10 installs a few of these scripts into <span class=filename>/usr/shared/dtrace</span>. On other FreeBSD versions, or to install the full DTrace Toolkit, use the <a class=package href=https://cgit.freebsd.org/ports/tree/sysutils/dtrace-toolkit/>sysutils/dtrace-toolkit</a> package or port.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>The scripts found in <span class=filename>/usr/shared/dtrace</span> have been specifically ported to FreeBSD. Not all of the scripts found in the DTrace Toolkit will work as-is on FreeBSD and some scripts may require some effort in order for them to work on FreeBSD.</p></div></td></tr></tbody></table></div><div class=paragraph><p>The DTrace Toolkit includes many scripts in the special language of DTrace. This language is called the D language and it is very similar to C++. An in depth discussion of the language is beyond the scope of this document. It is covered extensively in the <a href=http://www.dtrace.org/guide>Illumos Dynamic Tracing Guide</a>.</p></div></div><div class=sect2><h3 id=dtrace-using>24.4. Using DTrace<a class=anchor href=#dtrace-using></a></h3><div class=paragraph><p>DTrace scripts consist of a list of one or more <em>probes</em>, or instrumentation points, where each probe is associated with an action. Whenever the condition for a probe is met, the associated action is executed. For example, an action may occur when a file is opened, a process is started, or a line of code is executed. The action might be to log some information or to modify context variables. The reading and writing of context variables allows probes to share information and to cooperatively analyze the correlation of different events.</p></div><div class=paragraph><p>To view all probes, the administrator can execute the following command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># dtrace -l | more</span></code></pre></div></div><div class=paragraph><p>Each probe has an <code>ID</code>, a <code>PROVIDER</code> (dtrace or fbt), a <code>MODULE</code>, and a <code>FUNCTION NAME</code>. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=dtrace&amp;sektion=1&amp;format=html">dtrace(1)</a> for more information about this command.</p></div><div class=paragraph><p>The examples in this section provide an overview of how to use two of the fully supported scripts from the DTrace Toolkit: the <span class=filename>hotkernel</span> and <span class=filename>procsystime</span> scripts.</p></div><div class=paragraph><p>The <span class=filename>hotkernel</span> script is designed to identify which function is using the most kernel time. It will produce output similar to the following:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/local/share/dtrace-toolkit</span>
<span class=c># ./hotkernel</span>
Sampling... Hit Ctrl-C to end.</code></pre></div></div><div class=paragraph><p>As instructed, use the <span class=keyseq><kbd>Ctrl</kbd>+<kbd>C</kbd></span> key combination to stop the process. Upon termination, the script will display a list of kernel functions and timing information, sorting the output in increasing order of time:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>kernel<span class=sb>`</span>_thread_lock_flags                                   2   0.0%
0xc1097063                                                  2   0.0%
kernel<span class=sb>`</span>sched_userret                                        2   0.0%
kernel<span class=sb>`</span>kern_select                                          2   0.0%
kernel<span class=sb>`</span>generic_copyin                                       3   0.0%
kernel<span class=sb>`</span>_mtx_assert                                          3   0.0%
kernel<span class=sb>`</span>vm_fault                                             3   0.0%
kernel<span class=sb>`</span>sopoll_generic                                       3   0.0%
kernel<span class=sb>`</span>fixup_filename                                       4   0.0%
kernel<span class=sb>`</span>_isitmyx                                             4   0.0%
kernel<span class=sb>`</span>find_instance                                        4   0.0%
kernel<span class=sb>`</span>_mtx_unlock_flags                                    5   0.0%
kernel<span class=sb>`</span>syscall                                              5   0.0%
kernel<span class=sb>`</span>DELAY                                                5   0.0%
0xc108a253                                                  6   0.0%
kernel<span class=sb>`</span>witness_lock                                         7   0.0%
kernel<span class=sb>`</span>read_aux_data_no_wait                                7   0.0%
kernel<span class=sb>`</span>Xint0x80_syscall                                     7   0.0%
kernel<span class=sb>`</span>witness_checkorder                                   7   0.0%
kernel<span class=sb>`</span>sse2_pagezero                                        8   0.0%
kernel<span class=sb>`</span>strncmp                                              9   0.0%
kernel<span class=sb>`</span>spinlock_exit                                       10   0.0%
kernel<span class=sb>`</span>_mtx_lock_flags                                     11   0.0%
kernel<span class=sb>`</span>witness_unlock                                      15   0.0%
kernel<span class=sb>`</span>sched_idletd                                       137   0.3%
0xc10981a5                                              42139  99.3%</code></pre></div></div><div class=paragraph><p>This script will also work with kernel modules. To use this feature, run the script with <code>-m</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ./hotkernel -m</span>
Sampling... Hit Ctrl-C to end.
^C
MODULE                                                  COUNT   PCNT
0xc107882e                                                  1   0.0%
0xc10e6aa4                                                  1   0.0%
0xc1076983                                                  1   0.0%
0xc109708a                                                  1   0.0%
0xc1075a5d                                                  1   0.0%
0xc1077325                                                  1   0.0%
0xc108a245                                                  1   0.0%
0xc107730d                                                  1   0.0%
0xc1097063                                                  2   0.0%
0xc108a253                                                 73   0.0%
kernel                                                    874   0.4%
0xc10981a5                                             213781  99.6%</code></pre></div></div><div class=paragraph><p>The <span class=filename>procsystime</span> script captures and prints the system call time usage for a given process <code>ID</code> (<code>PID</code>) or process name. In the following example, a new instance of <span class=filename>/bin/csh</span> was spawned. Then, <span class=filename>procsystime</span> was executed and remained waiting while a few commands were typed on the other incarnation of <code>csh</code>. These are the results of this test:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ./procsystime -n csh</span>
Tracing... Hit Ctrl-C to end...
^C

Elapsed Times <span class=k>for </span>processes csh,

         SYSCALL          TIME <span class=o>(</span>ns<span class=o>)</span>
          getpid               6131
       sigreturn               8121
           close              19127
           fcntl              19959
             dup              26955
         setpgid              28070
            <span class=nb>stat              </span>31899
       setitimer              40938
           wait4              62717
       sigaction              67372
     sigprocmask             119091
    gettimeofday             183710
           write             263242
          execve             492547
           ioctl             770073
           vfork            3258923
      sigsuspend            6985124
            <span class=nb>read         </span>3988049784</code></pre></div></div><div class=paragraph><p>As shown, the <code>read()</code> system call used the most time in nanoseconds while the <code>getpid()</code> system call used the least amount of time.</p></div></div></div></div><div class=sect1><h2 id=usb-device-mode>Rozdział 25. USB Device Mode / USB OTG<a class=anchor href=#usb-device-mode></a></h2><div class=sectionbody><div class=sect2><h3 id=usb-device-mode-synopsis>25.1. Synopsis<a class=anchor href=#usb-device-mode-synopsis></a></h3><div class=paragraph><p>This chapter covers the use of USB Device Mode and USB On The Go (USB OTG) in FreeBSD. This includes virtual serial consoles, virtual network interfaces, and virtual USB drives.</p></div><div class=paragraph><p>When running on hardware that supports USB device mode or USB OTG, like that built into many embedded boards, the FreeBSD USB stack can run in <em>device mode</em>. Device mode makes it possible for the computer to present itself as different kinds of USB device classes, including serial ports, network adapters, and mass storage, or a combination thereof. A USB host like a laptop or desktop computer is able to access them just like physical USB devices. Device mode is sometimes called the "USB gadget mode".</p></div><div class=paragraph><p>There are two basic ways the hardware can provide the device mode functionality: with a separate "client port", which only supports the device mode, and with a USB OTG port, which can provide both device and host mode. For USB OTG ports, the USB stack switches between host-side and device-side automatically, depending on what is connected to the port. Connecting a USB device like a memory stick to the port causes FreeBSD to switch to host mode. Connecting a USB host like a computer causes FreeBSD to switch to device mode. Single purpose "client ports" always work in device mode.</p></div><div class=paragraph><p>What FreeBSD presents to the USB host depends on the <code>hw.usb.template</code> sysctl. Some templates provide a single device, such as a serial terminal; others provide multiple ones, which can all be used at the same time. An example is the template 10, which provides a mass storage device, a serial console, and a network interface. See <a href="https://man.freebsd.org/cgi/man.cgi?query=usb_template&amp;sektion=4&amp;format=html">usb_template(4)</a> for the list of available values.</p></div><div class=paragraph><p>Note that in some cases, depending on the hardware and the hosts operating system, for the host to notice the configuration change, it must be either physically disconnected and reconnected, or forced to rescan the USB bus in a system-specific way. When FreeBSD is running on the host, <a href="https://man.freebsd.org/cgi/man.cgi?query=usbconfig&amp;sektion=8&amp;format=html">usbconfig(8)</a> <code>reset</code> can be used. This also must be done after loading <span class=filename>usb_template.ko</span> if the USB host was already connected to the USBOTG socket.</p></div><div class=paragraph><p>After reading this chapter, you will know:</p></div><div class=ulist><ul><li><p>How to set up USB Device Mode functionality on FreeBSD.</p></li><li><p>How to configure the virtual serial port on FreeBSD.</p></li><li><p>How to connect to the virtual serial port from various operating systems.</p></li><li><p>How to configure FreeBSD to provide a virtual USB network interface.</p></li><li><p>How to configure FreeBSD to provide a virtual USB storage device.</p></li></ul></div></div><div class=sect2><h3 id=usb-device-mode-terminals>25.2. USB Virtual Serial Ports<a class=anchor href=#usb-device-mode-terminals></a></h3><div class=sect3><h4 id=_configuring_usb_device_mode_serial_ports>25.2.1. Configuring USB Device Mode Serial Ports<a class=anchor href=#_configuring_usb_device_mode_serial_ports></a></h4><div class=paragraph><p>Virtual serial port support is provided by templates number 3, 8, and 10. Note that template 3 works with Microsoft Windows 10 without the need for special drivers and INF files. Other host operating systems work with all three templates. Both <a href="https://man.freebsd.org/cgi/man.cgi?query=usb_template&amp;sektion=4&amp;format=html">usb_template(4)</a> and <a href="https://man.freebsd.org/cgi/man.cgi?query=umodem&amp;sektion=4&amp;format=html">umodem(4)</a> kernel modules must be loaded.</p></div><div class=paragraph><p>To enable USB device mode serial ports, add those lines to <span class=filename>/etc/ttys</span>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>ttyU0	<span class=s2>&#34;/usr/libexec/getty 3wire&#34;</span>	vt100	onifconsole secure
ttyU1	<span class=s2>&#34;/usr/libexec/getty 3wire&#34;</span>	vt100	onifconsole secure</code></pre></div></div><div class=paragraph><p>Then add these lines to <span class=filename>/etc/devd.conf</span>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>notify 100 <span class=o>{</span>
	match <span class=s2>&#34;system&#34;</span>		<span class=s2>&#34;DEVFS&#34;</span><span class=p>;</span>
	match <span class=s2>&#34;subsystem&#34;</span>	<span class=s2>&#34;CDEV&#34;</span><span class=p>;</span>
	match <span class=s2>&#34;type&#34;</span>		<span class=s2>&#34;CREATE&#34;</span><span class=p>;</span>
	match <span class=s2>&#34;cdev&#34;</span>		<span class=s2>&#34;ttyU[0-9]+&#34;</span><span class=p>;</span>
	action <span class=s2>&#34;/sbin/init q&#34;</span><span class=p>;</span>
<span class=o>}</span><span class=p>;</span></code></pre></div></div><div class=paragraph><p>Reload the configuration if <a href="https://man.freebsd.org/cgi/man.cgi?query=devd&amp;sektion=8&amp;format=html">devd(8)</a> is already running:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service devd restart</span></code></pre></div></div><div class=paragraph><p>Make sure the necessary modules are loaded and the correct template is set at boot by adding those lines to <span class=filename>/boot/loader.conf</span>, creating it if it does not already exist:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=nv>umodem_load</span><span class=o>=</span><span class=s2>&#34;YES&#34;</span>
hw.usb.template<span class=o>=</span>3</code></pre></div></div><div class=paragraph><p>To load the module and set the template without rebooting use:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># kldload umodem</span>
<span class=c># sysctl hw.usb.template=3</span></code></pre></div></div></div><div class=sect3><h4 id=_connecting_to_usb_device_mode_serial_ports_from_freebsd>25.2.2. Connecting to USB Device Mode Serial Ports from FreeBSD<a class=anchor href=#_connecting_to_usb_device_mode_serial_ports_from_freebsd></a></h4><div class=paragraph><p>To connect to a board configured to provide USB device mode serial ports, connect the USB host, such as a laptop, to the boards USB OTG or USB client port. Use <code>pstat -t</code> on the host to list the terminal lines. Near the end of the list you should see a USB serial port, eg "ttyU0". To open the connection, use:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cu -l /dev/ttyU0</span></code></pre></div></div><div class=paragraph><p>After pressing the Enter key a few times you will see a login prompt.</p></div></div><div class=sect3><h4 id=_connecting_to_usb_device_mode_serial_ports_from_macos>25.2.3. Connecting to USB Device Mode Serial Ports from macOS<a class=anchor href=#_connecting_to_usb_device_mode_serial_ports_from_macos></a></h4><div class=paragraph><p>To connect to a board configured to provide USB device mode serial ports, connect the USB host, such as a laptop, to the boards USB OTG or USB client port. To open the connection, use:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cu -l /dev/cu.usbmodemFreeBSD1</span></code></pre></div></div></div><div class=sect3><h4 id=_connecting_to_usb_device_mode_serial_ports_from_linux>25.2.4. Connecting to USB Device Mode Serial Ports from Linux<a class=anchor href=#_connecting_to_usb_device_mode_serial_ports_from_linux></a></h4><div class=paragraph><p>To connect to a board configured to provide USB device mode serial ports, connect the USB host, such as a laptop, to the boards USB OTG or USB client port. To open the connection, use:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># minicom -D /dev/ttyACM0</span></code></pre></div></div></div><div class=sect3><h4 id=_connecting_to_usb_device_mode_serial_ports_from_microsoft_windows_10>25.2.5. Connecting to USB Device Mode Serial Ports from Microsoft Windows 10<a class=anchor href=#_connecting_to_usb_device_mode_serial_ports_from_microsoft_windows_10></a></h4><div class=paragraph><p>To connect to a board configured to provide USB device mode serial ports, connect the USB host, such as a laptop, to the boards USB OTG or USB client port. To open a connection you will need a serial terminal program, such as PuTTY. To check the COM port name used by Windows, run Device Manager, expand "Ports (COM & LPT)". You will see a name similar to "USB Serial Device (COM4)". Run serial terminal program of your choice, for example PuTTY. In the PuTTY dialog set "Connection type" to "Serial", type the COMx obtained from Device Manager in the "Serial line" dialog box and click Open.</p></div></div></div><div class=sect2><h3 id=usb-device-mode-network>25.3. USB Device Mode Network Interfaces<a class=anchor href=#usb-device-mode-network></a></h3><div class=paragraph><p>Virtual network interfaces support is provided by templates number 1, 8, and 10. Note that none of them works with Microsoft Windows. Other host operating systems work with all three templates. Both <a href="https://man.freebsd.org/cgi/man.cgi?query=usb_template&amp;sektion=4&amp;format=html">usb_template(4)</a> and <a href="https://man.freebsd.org/cgi/man.cgi?query=if_cdce&amp;sektion=4&amp;format=html">if_cdce(4)</a> kernel modules must be loaded.</p></div><div class=paragraph><p>Make sure the necessary modules are loaded and the correct template is set at boot by adding those lines to <span class=filename>/boot/loader.conf</span>, creating it if it does not already exist:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=nv>if_cdce_load</span><span class=o>=</span><span class=s2>&#34;YES&#34;</span>
hw.usb.template<span class=o>=</span>1</code></pre></div></div><div class=paragraph><p>To load the module and set the template without rebooting use:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># kldload if_cdce</span>
<span class=c># sysctl hw.usb.template=1</span></code></pre></div></div></div><div class=sect2><h3 id=usb-device-mode-storage>25.4. USB Virtual Storage Device<a class=anchor href=#usb-device-mode-storage></a></h3><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>The <a href="https://man.freebsd.org/cgi/man.cgi?query=cfumass&amp;sektion=4&amp;format=html">cfumass(4)</a> driver is a USB device mode driver first available in FreeBSD 12.0.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Mass Storage target is provided by templates 0 and 10. Both <a href="https://man.freebsd.org/cgi/man.cgi?query=usb_template&amp;sektion=4&amp;format=html">usb_template(4)</a> and <a href="https://man.freebsd.org/cgi/man.cgi?query=cfumass&amp;sektion=4&amp;format=html">cfumass(4)</a> kernel modules must be loaded. <a href="https://man.freebsd.org/cgi/man.cgi?query=cfumass&amp;sektion=4&amp;format=html">cfumass(4)</a> interfaces to the CTL subsystem, the same one that is used for iSCSI or Fibre Channel targets. On the host side, USB Mass Storage initiators can only access a single LUN, LUN 0.</p></div><div class=sect3><h4 id=_configuring_usb_mass_storage_target_using_the_cfumass_startup_script>25.4.1. Configuring USB Mass Storage Target Using the cfumass Startup Script<a class=anchor href=#_configuring_usb_mass_storage_target_using_the_cfumass_startup_script></a></h4><div class=paragraph><p>The simplest way to set up a read-only USB storage target is to use the <span class=filename>cfumass</span> rc script. To configure it this way, copy the files to be presented to the USB host machine into the <code>/var/cfumass</code> directory, and add this line to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>cfumass_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>To configure the target without restarting, run this command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service cfumass start</span></code></pre></div></div><div class=paragraph><p>Differently from serial and network functionality, the template should not be set to 0 or 10 in <span class=filename>/boot/loader.conf</span>. This is because the LUN must be set up before setting the template. The cfumass startup script sets the correct template number automatically when started.</p></div></div><div class=sect3><h4 id=_configuring_usb_mass_storage_using_other_means>25.4.2. Configuring USB Mass Storage Using Other Means<a class=anchor href=#_configuring_usb_mass_storage_using_other_means></a></h4><div class=paragraph><p>The rest of this chapter provides detailed description of setting the target without using the cfumass rc file. This is necessary if eg one wants to provide a writeable LUN.</p></div><div class=paragraph><p>USB Mass Storage does not require the <a href="https://man.freebsd.org/cgi/man.cgi?query=ctld&amp;sektion=8&amp;format=html">ctld(8)</a> daemon to be running, although it can be used if desired. This is different from iSCSI. Thus, there are two ways to configure the target: <a href="https://man.freebsd.org/cgi/man.cgi?query=ctladm&amp;sektion=8&amp;format=html">ctladm(8)</a>, or <a href="https://man.freebsd.org/cgi/man.cgi?query=ctld&amp;sektion=8&amp;format=html">ctld(8)</a>. Both require the <span class=filename>cfumass.ko</span> kernel module to be loaded. The module can be loaded manually:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># kldload cfumass</span></code></pre></div></div><div class=paragraph><p>If <span class=filename>cfumass.ko</span> has not been built into the kernel, <span class=filename>/boot/loader.conf</span> can be set to load the module at boot:</p></div><div class="literalblock programlisting"><div class=content><pre>cfumass_load=&#34;YES&#34;</pre></div></div><div class=paragraph><p>A LUN can be created without the <a href="https://man.freebsd.org/cgi/man.cgi?query=ctld&amp;sektion=8&amp;format=html">ctld(8)</a> daemon:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ctladm create -b block -o file=/data/target0</span></code></pre></div></div><div class=paragraph><p>This presents the contents of the image file <span class=filename>/data/target0</span> as a LUN to the USB host. The file must exist before executing the command. To configure the LUN at system startup, add the command to <span class=filename>/etc/rc.local</span>.</p></div><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=ctld&amp;sektion=8&amp;format=html">ctld(8)</a> can also be used to manage LUNs. Create <span class=filename>/etc/ctl.conf</span>, add a line to <span class=filename>/etc/rc.conf</span> to make sure <a href="https://man.freebsd.org/cgi/man.cgi?query=ctld&amp;sektion=8&amp;format=html">ctld(8)</a> is automatically started at boot, and then start the daemon.</p></div><div class=paragraph><p>This is an example of a simple <span class=filename>/etc/ctl.conf</span> configuration file. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=ctl.conf&amp;sektion=5&amp;format=html">ctl.conf(5)</a> for a more complete description of the options.</p></div><div class="literalblock programlisting"><div class=content><pre>target naa.50015178f369f092 {
	lun 0 {
		path /data/target0
		size 4G
	}
}</pre></div></div><div class=paragraph><p>The example creates a single target with a single LUN. The <code>naa.50015178f369f092</code> is a device identifier composed of 32 random hexadecimal digits. The <code>path</code> line defines the full path to a file or zvol backing the LUN. That file must exist before starting <a href="https://man.freebsd.org/cgi/man.cgi?query=ctld&amp;sektion=8&amp;format=html">ctld(8)</a>. The second line is optional and specifies the size of the LUN.</p></div><div class=paragraph><p>To make sure the <a href="https://man.freebsd.org/cgi/man.cgi?query=ctld&amp;sektion=8&amp;format=html">ctld(8)</a> daemon is started at boot, add this line to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>ctld_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>To start <a href="https://man.freebsd.org/cgi/man.cgi?query=ctld&amp;sektion=8&amp;format=html">ctld(8)</a> now, run this command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service ctld start</span></code></pre></div></div><div class=paragraph><p>As the <a href="https://man.freebsd.org/cgi/man.cgi?query=ctld&amp;sektion=8&amp;format=html">ctld(8)</a> daemon is started, it reads <span class=filename>/etc/ctl.conf</span>. If this file is edited after the daemon starts, reload the changes so they take effect immediately:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service ctld reload</span></code></pre></div></div></div></div></div></div><h1 id=network-communication class=sect0>Część IV: Komunikacja sieciowa<a class=anchor href=#network-communication></a></h1><div class="openblock partintro"><div class=content><div class=paragraph><p>FreeBSD jest jednym z najszerzej rozpowszechnionych systemów operacyjnych wykorzystywanych w wysoko wydajnych serwerach sieciowych. Rozdziały w tej części omawiają:</p></div><div class=ulist><ul><li><p>Komunikację szeregową</p></li><li><p>PPP oraz PPP over Ethernet</p></li><li><p>Pocztę elektroniczną</p></li><li><p>Prowadzenie serwerów sieciowych</p></li><li><p>Zapory ogniowe</p></li><li><p>Inne zaawansowane zagadnienia związane z pracą w sieci</p></li></ul></div><div class=paragraph><p>Poniższe rozdziały zostały tak napisane, by móc sięgnąć po nie gdy potrzebujemy danych informacji. Nie ma przymusu czytania ich w żadnej określonej kolejności, ani też przeczytania wszystkich przed rozpoczęciem pracy z FreeBSD w środowisku sieciowym.</p></div></div></div><div class=sect1><h2 id=serialcomms>Rozdział 26. Serial Communications<a class=anchor href=#serialcomms></a></h2><div class=sectionbody><div class=sect2><h3 id=serial-synopsis>26.1. Synopsis<a class=anchor href=#serial-synopsis></a></h3><div class=paragraph><p>UNIX® has always had support for serial communications as the very first UNIX® machines relied on serial lines for user input and output. Things have changed a lot from the days when the average terminal consisted of a 10-character-per-second serial printer and a keyboard. This chapter covers some of the ways serial communications can be used on FreeBSD.</p></div><div class=paragraph><p>After reading this chapter, you will know:</p></div><div class=ulist><ul><li><p>How to connect terminals to a FreeBSD system.</p></li><li><p>How to use a modem to dial out to remote hosts.</p></li><li><p>How to allow remote users to login to a FreeBSD system with a modem.</p></li><li><p>How to boot a FreeBSD system from a serial console.</p></li></ul></div><div class=paragraph><p>Before reading this chapter, you should:</p></div><div class=ulist><ul><li><p>Know how to <a href=./#kernelconfig>configure and install a custom kernel</a>.</p></li><li><p>Understand <a href=./#basics>FreeBSD permissions and processes</a>.</p></li><li><p>Have access to the technical manual for the serial hardware to be used with FreeBSD.</p></li></ul></div></div><div class=sect2><h3 id=serial>26.2. Serial Terminology and Hardware<a class=anchor href=#serial></a></h3><div class=paragraph><p>The following terms are often used in serial communications:</p></div><div class=dlist><dl><dt class=hdlist1>bps</dt><dd><p>Bits per Second (bps) is the rate at which data is transmitted.</p></dd><dt class=hdlist1>DTE</dt><dd><p>Data Terminal Equipment (DTE) is one of two endpoints in a serial communication. An example would be a computer.</p></dd><dt class=hdlist1>DCE</dt><dd><p>Data Communications Equipment (DTE) is the other endpoint in a serial communication. Typically, it is a modem or serial terminal.</p></dd><dt class=hdlist1>RS-232</dt><dd><p>The original standard which defined hardware serial communications. It has since been renamed to TIA-232.</p></dd></dl></div><div class=paragraph><p>When referring to communication data rates, this section does not use the term <em>baud</em>. Baud refers to the number of electrical state transitions made in a period of time, while bps is the correct term to use.</p></div><div class=paragraph><p>To connect a serial terminal to a FreeBSD system, a serial port on the computer and the proper cable to connect to the serial device are needed. Users who are already familiar with serial hardware and cabling can safely skip this section.</p></div><div class=sect3><h4 id=term-cables-null>26.2.1. Serial Cables and Ports<a class=anchor href=#term-cables-null></a></h4><div class=paragraph><p>There are several different kinds of serial cables. The two most common types are null-modem cables and standard RS-232 cables. The documentation for the hardware should describe the type of cable required.</p></div><div class=paragraph><p>These two types of cables differ in how the wires are connected to the connector. Each wire represents a signal, with the defined signals summarized in <a href=#serialcomms-signal-names>RS-232C Signal Names</a>. A standard serial cable passes all of the RS-232C signals straight through. For example, the "Transmitted Data" pin on one end of the cable goes to the "Transmitted Data" pin on the other end. This is the type of cable used to connect a modem to the FreeBSD system, and is also appropriate for some terminals.</p></div><div class=paragraph><p>A null-modem cable switches the "Transmitted Data" pin of the connector on one end with the "Received Data" pin on the other end. The connector can be either a DB-25 or a DB-9.</p></div><div class=paragraph><p>A null-modem cable can be constructed using the pin connections summarized in <a href=#nullmodem-db25>DB-25 to DB-25 Null-Modem Cable</a>, <a href=#nullmodem-db9>DB-9 to DB-9 Null-Modem Cable</a>, and <a href=#nullmodem-db9-25>DB-9 to DB-25 Null-Modem Cable</a>. While the standard calls for a straight-through pin 1 to pin 1 "Protective Ground" line, it is often omitted. Some terminals work using only pins 2, 3, and 7, while others require different configurations. When in doubt, refer to the documentation for the hardware.</p></div><table id=serialcomms-signal-names class="tableblock frame-none grid-all stretch"><caption class=title>Tabela 20. RS-232C Signal Names</caption><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">Acronyms</th><th class="tableblock halign-left valign-top">Names</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock>RD</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Received Data</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>TD</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Transmitted Data</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>DTR</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Data Terminal Ready</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>DSR</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Data Set Ready</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>DCD</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Data Carrier Detect</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>SG</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Signal Ground</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>RTS</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Request to Send</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>CTS</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Clear to Send</p></td></tr></tbody></table><table id=nullmodem-db25 class="tableblock frame-none grid-all stretch"><caption class=title>Tabela 21. DB-25 to DB-25 Null-Modem Cable</caption><col style=width:20%><col style=width:20%><col style=width:20%><col style=width:20%><col style=width:20%><thead><tr><th class="tableblock halign-left valign-top">Signal</th><th class="tableblock halign-left valign-top">Pin #</th><th class="tableblock halign-left valign-top"></th><th class="tableblock halign-left valign-top">Pin #</th><th class="tableblock halign-left valign-top">Signal</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock>SG</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>7</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>connects to</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>7</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>SG</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>TD</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>2</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>connects to</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>3</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>RD</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>RD</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>3</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>connects to</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>2</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>TD</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>RTS</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>4</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>connects to</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>5</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>CTS</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>CTS</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>5</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>connects to</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>4</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>RTS</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>DTR</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>20</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>connects to</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>6</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>DSR</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>DTR</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>20</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>connects to</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>8</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>DCD</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>DSR</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>6</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>connects to</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>20</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>DTR</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>DCD</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>8</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>connects to</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>20</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>DTR</p></td></tr></tbody></table><table id=nullmodem-db9 class="tableblock frame-none grid-all stretch"><caption class=title>Tabela 22. DB-9 to DB-9 Null-Modem Cable</caption><col style=width:20%><col style=width:20%><col style=width:20%><col style=width:20%><col style=width:20%><thead><tr><th class="tableblock halign-left valign-top">Signal</th><th class="tableblock halign-left valign-top">Pin #</th><th class="tableblock halign-left valign-top"></th><th class="tableblock halign-left valign-top">Pin #</th><th class="tableblock halign-left valign-top">Signal</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock>RD</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>2</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>connects to</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>3</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>TD</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>TD</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>3</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>connects to</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>2</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>RD</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>DTR</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>4</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>connects to</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>6</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>DSR</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>DTR</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>4</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>connects to</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>1</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>DCD</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>SG</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>5</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>connects to</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>5</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>SG</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>DSR</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>6</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>connects to</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>4</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>DTR</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>DCD</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>1</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>connects to</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>4</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>DTR</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>RTS</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>7</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>connects to</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>8</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>CTS</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>CTS</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>8</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>connects to</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>7</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>RTS</p></td></tr></tbody></table><table id=nullmodem-db9-25 class="tableblock frame-none grid-all stretch"><caption class=title>Tabela 23. DB-9 to DB-25 Null-Modem Cable</caption><col style=width:20%><col style=width:20%><col style=width:20%><col style=width:20%><col style=width:20%><thead><tr><th class="tableblock halign-left valign-top">Signal</th><th class="tableblock halign-left valign-top">Pin #</th><th class="tableblock halign-left valign-top"></th><th class="tableblock halign-left valign-top">Pin #</th><th class="tableblock halign-left valign-top">Signal</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock>RD</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>2</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>connects to</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>2</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>TD</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>TD</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>3</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>connects to</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>3</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>RD</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>DTR</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>4</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>connects to</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>6</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>DSR</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>DTR</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>4</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>connects to</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>8</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>DCD</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>SG</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>5</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>connects to</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>7</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>SG</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>DSR</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>6</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>connects to</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>20</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>DTR</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>DCD</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>1</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>connects to</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>20</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>DTR</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>RTS</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>7</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>connects to</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>5</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>CTS</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>CTS</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>8</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>connects to</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>4</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>RTS</p></td></tr></tbody></table><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>When one pin at one end connects to a pair of pins at the other end, it is usually implemented with one short wire between the pair of pins in their connector and a long wire to the other single pin.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Serial ports are the devices through which data is transferred between the FreeBSD host computer and the terminal. Several kinds of serial ports exist. Before purchasing or constructing a cable, make sure it will fit the ports on the terminal and on the FreeBSD system.</p></div><div class=paragraph><p>Most terminals have DB-25 ports. Personal computers may have DB-25 or DB-9 ports. A multiport serial card may have RJ-12 or RJ-45/ ports. See the documentation that accompanied the hardware for specifications on the kind of port or visually verify the type of port.</p></div><div class=paragraph><p>In FreeBSD, each serial port is accessed through an entry in <span class=filename>/dev</span>. There are two different kinds of entries:</p></div><div class=ulist><ul><li><p>Call-in ports are named <span class=filename>/dev/ttyuN</span> where <em>N</em> is the port number, starting from zero. If a terminal is connected to the first serial port (<span class=filename>COM1</span>), use <span class=filename>/dev/ttyu0</span> to refer to the terminal. If the terminal is on the second serial port (<span class=filename>COM2</span>), use <span class=filename>/dev/ttyu1</span>, and so forth. Generally, the call-in port is used for terminals. Call-in ports require that the serial line assert the "Data Carrier Detect" signal to work correctly.</p></li><li><p>Call-out ports are named <span class=filename>/dev/cuauN</span> on FreeBSD versions 8.X and higher and <span class=filename>/dev/cuadN</span> on FreeBSD versions 7.X and lower. Call-out ports are usually not used for terminals, but are used for modems. The call-out port can be used if the serial cable or the terminal does not support the "Data Carrier Detect" signal.</p></li></ul></div><div class=paragraph><p>FreeBSD also provides initialization devices (<span class=filename>/dev/ttyuN.init</span> and <span class=filename>/dev/cuauN.init</span> or <span class=filename>/dev/cuadN.init</span>) and locking devices (<span class=filename>/dev/ttyuN.lock</span> and <span class=filename>/dev/cuauN.lock</span> or <span class=filename>/dev/cuadN.lock</span>). The initialization devices are used to initialize communications port parameters each time a port is opened, such as <code>crtscts</code> for modems which use <code>RTS/CTS</code> signaling for flow control. The locking devices are used to lock flags on ports to prevent users or programs changing certain parameters. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=termios&amp;sektion=4&amp;format=html">termios(4)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=sio&amp;sektion=4&amp;format=html">sio(4)</a>, and <a href="https://man.freebsd.org/cgi/man.cgi?query=stty&amp;sektion=1&amp;format=html">stty(1)</a> for information on terminal settings, locking and initializing devices, and setting terminal options, respectively.</p></div></div><div class=sect3><h4 id=serial-hw-config>26.2.2. Serial Port Configuration<a class=anchor href=#serial-hw-config></a></h4><div class=paragraph><p>By default, FreeBSD supports four serial ports which are commonly known as <span class=filename>COM1</span>, <span class=filename>COM2</span>, <span class=filename>COM3</span>, and <span class=filename>COM4</span>. FreeBSD also supports dumb multi-port serial interface cards, such as the BocaBoard 1008 and 2016, as well as more intelligent multi-port cards such as those made by Digiboard. However, the default kernel only looks for the standard <span class=filename>COM</span> ports.</p></div><div class=paragraph><p>To see if the system recognizes the serial ports, look for system boot messages that start with <code>uart</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># grep uart /var/run/dmesg.boot</span></code></pre></div></div><div class=paragraph><p>If the system does not recognize all of the needed serial ports, additional entries can be added to <span class=filename>/boot/device.hints</span>. This file already contains <code>hint.uart.0.*</code> entries for <span class=filename>COM1</span> and <code>hint.uart.1.*</code> entries for <span class=filename>COM2</span>. When adding a port entry for <span class=filename>COM3</span> use <code>0x3E8</code>, and for <span class=filename>COM4</span> use <code>0x2E8</code>. Common IRQ addresses are <code>5</code> for <span class=filename>COM3</span> and <code>9</code> for <span class=filename>COM4</span>.</p></div><div class=paragraph><p>To determine the default set of terminal I/O settings used by the port, specify its device name. This example determines the settings for the call-in port on <span class=filename>COM2</span>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># stty -a -f /dev/ttyu1</span></code></pre></div></div><div class=paragraph><p>System-wide initialization of serial devices is controlled by <span class=filename>/etc/rc.d/serial</span>. This file affects the default settings of serial devices. To change the settings for a device, use <code>stty</code>. By default, the changed settings are in effect until the device is closed and when the device is reopened, it goes back to the default set. To permanently change the default set, open and adjust the settings of the initialization device. For example, to turn on <code>CLOCAL</code> mode, 8 bit communication, and <code>XON/XOFF</code> flow control for <span class=filename>ttyu5</span>, type:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># stty -f /dev/ttyu5.init clocal cs8 ixon ixoff</span></code></pre></div></div><div class=paragraph><p>To prevent certain settings from being changed by an application, make adjustments to the locking device. For example, to lock the speed of <span class=filename>ttyu5</span> to 57600 bps, type:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># stty -f /dev/ttyu5.lock 57600</span></code></pre></div></div><div class=paragraph><p>Now, any application that opens <span class=filename>ttyu5</span> and tries to change the speed of the port will be stuck with 57600 bps.</p></div></div></div><div class=sect2><h3 id=term>26.3. Terminals<a class=anchor href=#term></a></h3><div class=paragraph><p>Terminals provide a convenient and low-cost way to access a FreeBSD system when not at the computer’s console or on a connected network. This section describes how to use terminals with FreeBSD.</p></div><div class=paragraph><p>The original UNIX® systems did not have consoles. Instead, users logged in and ran programs through terminals that were connected to the computer’s serial ports.</p></div><div class=paragraph><p>The ability to establish a login session on a serial port still exists in nearly every UNIX®-like operating system today, including FreeBSD. By using a terminal attached to an unused serial port, a user can log in and run any text program that can normally be run on the console or in an <code>xterm</code> window.</p></div><div class=paragraph><p>Many terminals can be attached to a FreeBSD system. An older spare computer can be used as a terminal wired into a more powerful computer running FreeBSD. This can turn what might otherwise be a single-user computer into a powerful multiple-user system.</p></div><div class=paragraph><p>FreeBSD supports three types of terminals:</p></div><div class=dlist><dl><dt class=hdlist1>Dumb terminals</dt><dd><p>Dumb terminals are specialized hardware that connect to computers over serial lines. They are called "dumb" because they have only enough computational power to display, send, and receive text. No programs can be run on these devices. Instead, dumb terminals connect to a computer that runs the needed programs.</p><div class=paragraph><p>There are hundreds of kinds of dumb terminals made by many manufacturers, and just about any kind will work with FreeBSD. Some high-end terminals can even display graphics, but only certain software packages can take advantage of these advanced features.</p></div><div class=paragraph><p>Dumb terminals are popular in work environments where workers do not need access to graphical applications.</p></div></dd><dt class=hdlist1>Computers Acting as Terminals</dt><dd><p>Since a dumb terminal has just enough ability to display, send, and receive text, any spare computer can be a dumb terminal. All that is needed is the proper cable and some <em>terminal emulation</em> software to run on the computer.</p><div class=paragraph><p>This configuration can be useful. For example, if one user is busy working at the FreeBSD system’s console, another user can do some text-only work at the same time from a less powerful personal computer hooked up as a terminal to the FreeBSD system.</p></div><div class=paragraph><p>There are at least two utilities in the base-system of FreeBSD that can be used to work through a serial connection: <a href="https://man.freebsd.org/cgi/man.cgi?query=cu&amp;sektion=1&amp;format=html">cu(1)</a> and <a href="https://man.freebsd.org/cgi/man.cgi?query=tip&amp;sektion=1&amp;format=html">tip(1)</a>.</p></div><div class=paragraph><p>For example, to connect from a client system that runs FreeBSD to the serial connection of another system:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cu -l /dev/cuauN</span></code></pre></div></div><div class=paragraph><p>Ports are numbered starting from zero. This means that <span class=filename>COM1</span> is <span class=filename>/dev/cuau0</span>.</p></div><div class=paragraph><p>Additional programs are available through the Ports Collection, such as <a class=package href=https://cgit.freebsd.org/ports/tree/comms/minicom/>comms/minicom</a>.</p></div></dd><dt class=hdlist1>X Terminals</dt><dd><p>X terminals are the most sophisticated kind of terminal available. Instead of connecting to a serial port, they usually connect to a network like Ethernet. Instead of being relegated to text-only applications, they can display any Xorg application.</p><div class=paragraph><p>This chapter does not cover the setup, configuration, or use of X terminals.</p></div></dd></dl></div><div class=sect3><h4 id=term-config>26.3.1. Terminal Configuration<a class=anchor href=#term-config></a></h4><div class=paragraph><p>This section describes how to configure a FreeBSD system to enable a login session on a serial terminal. It assumes that the system recognizes the serial port to which the terminal is connected and that the terminal is connected with the correct cable.</p></div><div class=paragraph><p>In FreeBSD, <code>init</code> reads <span class=filename>/etc/ttys</span> and starts a <code>getty</code> process on the available terminals. The <code>getty</code> process is responsible for reading a login name and starting the <code>login</code> program. The ports on the FreeBSD system which allow logins are listed in <span class=filename>/etc/ttys</span>. For example, the first virtual console, <span class=filename>ttyv0</span>, has an entry in this file, allowing logins on the console. This file also contains entries for the other virtual consoles, serial ports, and pseudo-ttys. For a hardwired terminal, the serial port’s <span class=filename>/dev</span> entry is listed without the <code>/dev</code> part. For example, <span class=filename>/dev/ttyv0</span> is listed as <code>ttyv0</code>.</p></div><div class=paragraph><p>The default <span class=filename>/etc/ttys</span> configures support for the first four serial ports, <span class=filename>ttyu0</span> through <span class=filename>ttyu3</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>ttyu0   &#34;/usr/libexec/getty std.9600&#34;   dialup  off secure
ttyu1   &#34;/usr/libexec/getty std.9600&#34;   dialup  off secure
ttyu2   &#34;/usr/libexec/getty std.9600&#34;   dialup  off secure
ttyu3   &#34;/usr/libexec/getty std.9600&#34;   dialup  off secure</pre></div></div><div class=paragraph><p>When attaching a terminal to one of those ports, modify the default entry to set the required speed and terminal type, to turn the device <code>on</code> and, if needed, to change the port’s <code>secure</code> setting. If the terminal is connected to another port, add an entry for the port.</p></div><div class=paragraph><p><a href=#ex-etc-ttys>Configuring Terminal Entries</a> configures two terminals in <span class=filename>/etc/ttys</span>. The first entry configures a Wyse-50 connected to <span class=filename>COM2</span>. The second entry configures an old computer running Procomm terminal software emulating a VT-100 terminal. The computer is connected to the sixth serial port on a multi-port serial card.</p></div><div id=ex-etc-ttys class=exampleblock><div class=title>Przykład 25. Configuring Terminal Entries</div><div class=content><div class="literalblock programlisting"><div class=content><pre>ttyu1  &#34;/usr/libexec/getty std.38400&#34;  wy50   on insecure
ttyu5   &#34;/usr/libexec/getty std.19200&#34;  vt100  on insecure</pre></div></div><div class=paragraph><p>The first field specifies the device name of the serial terminal.</p></div><div class=paragraph><p>The second field tells <code>getty</code> to initialize and open the line, set the line speed, prompt for a user name, and then execute the <code>login</code> program. The optional <em>getty type</em> configures characteristics on the terminal line, like bps rate and parity. The available getty types are listed in <span class=filename>/etc/gettytab</span>. In almost all cases, the getty types that start with <code>std</code> will work for hardwired terminals as these entries ignore parity. There is a <code>std</code> entry for each bps rate from 110 to 115200. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=gettytab&amp;sektion=5&amp;format=html">gettytab(5)</a> for more information.When setting the getty type, make sure to match the communications settings used by the terminal. For this example, the Wyse-50 uses no parity and connects at 38400 bps. The computer uses no parity and connects at 19200 bps.</p></div><div class=paragraph><p>The third field is the type of terminal. For dial-up ports, <code>unknown</code> or <code>dialup</code> is typically used since users may dial up with practically any type of terminal or software. Since the terminal type does not change for hardwired terminals, a real terminal type from <span class=filename>/etc/termcap</span> can be specified. For this example, the Wyse-50 uses the real terminal type while the computer running Procomm is set to emulate a VT-100.</p></div><div class=paragraph><p>The fourth field specifies if the port should be enabled. To enable logins on this port, this field must be set to <code>on</code>.</p></div><div class=paragraph><p>The final field is used to specify whether the port is secure. Marking a port as <code>secure</code> means that it is trusted enough to allow <code>root</code> to login from that port. Insecure ports do not allow <code>root</code> logins. On an insecure port, users must login from unprivileged accounts and then use <code>su</code> or a similar mechanism to gain superuser privileges, as described in <a href=./#users-superuser>“The Superuser Account”</a>. For security reasons, it is recommended to change this setting to <code>insecure</code>.</p></div></div></div><div class=paragraph><p>After making any changes to <span class=filename>/etc/ttys</span>, send a SIGHUP (hangup) signal to the <code>init</code> process to force it to re-read its configuration file:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># kill -HUP 1</span></code></pre></div></div><div class=paragraph><p>Since <code>init</code> is always the first process run on a system, it always has a process ID of <code>1</code>.</p></div><div class=paragraph><p>If everything is set up correctly, all cables are in place, and the terminals are powered up, a <code>getty</code> process should now be running on each terminal and login prompts should be available on each terminal.</p></div></div><div class=sect3><h4 id=term-debug>26.3.2. Troubleshooting the Connection<a class=anchor href=#term-debug></a></h4><div class=paragraph><p>Even with the most meticulous attention to detail, something could still go wrong while setting up a terminal. Here is a list of common symptoms and some suggested fixes.</p></div><div class=paragraph><p>If no login prompt appears, make sure the terminal is plugged in and powered up. If it is a personal computer acting as a terminal, make sure it is running terminal emulation software on the correct serial port.</p></div><div class=paragraph><p>Make sure the cable is connected firmly to both the terminal and the FreeBSD computer. Make sure it is the right kind of cable.</p></div><div class=paragraph><p>Make sure the terminal and FreeBSD agree on the bps rate and parity settings. For a video display terminal, make sure the contrast and brightness controls are turned up. If it is a printing terminal, make sure paper and ink are in good supply.</p></div><div class=paragraph><p>Use <code>ps</code> to make sure that a <code>getty</code> process is running and serving the terminal. For example, the following listing shows that a <code>getty</code> is running on the second serial port, <span class=filename>ttyu1</span>, and is using the <code>std.38400</code> entry in <span class=filename>/etc/gettytab</span>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ps -axww|grep ttyu</span>
22189  d1  Is+    0:00.03 /usr/libexec/getty std.38400 ttyu1</code></pre></div></div><div class=paragraph><p>If no <code>getty</code> process is running, make sure the port is enabled in <span class=filename>/etc/ttys</span>. Remember to run <code>kill -HUP 1</code> after modifying <span class=filename>/etc/ttys</span>.</p></div><div class=paragraph><p>If the <code>getty</code> process is running but the terminal still does not display a login prompt, or if it displays a prompt but will not accept typed input, the terminal or cable may not support hardware handshaking. Try changing the entry in <span class=filename>/etc/ttys</span> from <code>std.38400</code> to <code>3wire.38400</code>, then run <code>kill -HUP 1</code> after modifying <span class=filename>/etc/ttys</span>. The <code>3wire</code> entry is similar to <code>std</code>, but ignores hardware handshaking. The baud rate may need to be reduced or software flow control enabled when using <code>3wire</code> to prevent buffer overflows.</p></div><div class=paragraph><p>If garbage appears instead of a login prompt, make sure the terminal and FreeBSD agree on the bps rate and parity settings. Check the <code>getty</code> processes to make sure the correct <em>getty</em> type is in use. If not, edit <span class=filename>/etc/ttys</span> and run <code>kill -HUP 1</code>.</p></div><div class=paragraph><p>If characters appear doubled and the password appears when typed, switch the terminal, or the terminal emulation software, from "half duplex" or "local echo" to "full duplex."</p></div></div></div><div class=sect2><h3 id=dialup>26.4. Dial-in Service<a class=anchor href=#dialup></a></h3><div class=paragraph><p>Configuring a FreeBSD system for dial-in service is similar to configuring terminals, except that modems are used instead of terminal devices. FreeBSD supports both external and internal modems.</p></div><div class=paragraph><p>External modems are more convenient because they often can be configured via parameters stored in non-volatile RAM and they usually provide lighted indicators that display the state of important RS-232 signals, indicating whether the modem is operating properly.</p></div><div class=paragraph><p>Internal modems usually lack non-volatile RAM, so their configuration may be limited to setting DIP switches. If the internal modem has any signal indicator lights, they are difficult to view when the system’s cover is in place.</p></div><div class=paragraph><p>When using an external modem, a proper cable is needed. A standard RS-232C serial cable should suffice.</p></div><div class=paragraph><p>FreeBSD needs the RTS and CTS signals for flow control at speeds above 2400 bps, the CD signal to detect when a call has been answered or the line has been hung up, and the DTR signal to reset the modem after a session is complete. Some cables are wired without all of the needed signals, so if a login session does not go away when the line hangs up, there may be a problem with the cable. Refer to <a href=#term-cables-null>Serial Cables and Ports</a> for more information about these signals.</p></div><div class=paragraph><p>Like other UNIX®-like operating systems, FreeBSD uses the hardware signals to find out when a call has been answered or a line has been hung up and to hangup and reset the modem after a call. FreeBSD avoids sending commands to the modem or watching for status reports from the modem.</p></div><div class=paragraph><p>FreeBSD supports the NS8250, NS16450, NS16550, and NS16550A-based RS-232C (CCITT V.24) communications interfaces. The 8250 and 16450 devices have single-character buffers. The 16550 device provides a 16-character buffer, which allows for better system performance. Bugs in plain 16550 devices prevent the use of the 16-character buffer, so use 16550A devices if possible. Because single-character-buffer devices require more work by the operating system than the 16-character-buffer devices, 16550A-based serial interface cards are preferred. If the system has many active serial ports or will have a heavy load, 16550A-based cards are better for low-error-rate communications.</p></div><div class=paragraph><p>The rest of this section demonstrates how to configure a modem to receive incoming connections, how to communicate with the modem, and offers some troubleshooting tips.</p></div><div class=sect3><h4 id=dialup-ttys>26.4.1. Modem Configuration<a class=anchor href=#dialup-ttys></a></h4><div class=paragraph><p>As with terminals, <code>init</code> spawns a <code>getty</code> process for each configured serial port used for dial-in connections. When a user dials the modem’s line and the modems connect, the "Carrier Detect" signal is reported by the modem. The kernel notices that the carrier has been detected and instructs <code>getty</code> to open the port and display a <code>login:</code> prompt at the specified initial line speed. In a typical configuration, if garbage characters are received, usually due to the modem’s connection speed being different than the configured speed, <code>getty</code> tries adjusting the line speeds until it receives reasonable characters. After the user enters their login name, <code>getty</code> executes <code>login</code>, which completes the login process by asking for the user’s password and then starting the user’s shell.</p></div><div class=paragraph><p>There are two schools of thought regarding dial-up modems. One configuration method is to set the modems and systems so that no matter at what speed a remote user dials in, the dial-in RS-232 interface runs at a locked speed. The benefit of this configuration is that the remote user always sees a system login prompt immediately. The downside is that the system does not know what a user’s true data rate is, so full-screen programs like Emacs will not adjust their screen-painting methods to make their response better for slower connections.</p></div><div class=paragraph><p>The second method is to configure the RS-232 interface to vary its speed based on the remote user’s connection speed. Because <code>getty</code> does not understand any particular modem’s connection speed reporting, it gives a <code>login:</code> message at an initial speed and watches the characters that come back in response. If the user sees junk, they should press <kbd>Enter</kbd> until they see a recognizable prompt. If the data rates do not match, <code>getty</code> sees anything the user types as junk, tries the next speed, and gives the <code>login:</code> prompt again. This procedure normally only takes a keystroke or two before the user sees a good prompt. This login sequence does not look as clean as the locked-speed method, but a user on a low-speed connection should receive better interactive response from full-screen programs.</p></div><div class=paragraph><p>When locking a modem’s data communications rate at a particular speed, no changes to <span class=filename>/etc/gettytab</span> should be needed. However, for a matching-speed configuration, additional entries may be required in order to define the speeds to use for the modem. This example configures a 14.4 Kbps modem with a top interface speed of 19.2 Kbps using 8-bit, no parity connections. It configures <code>getty</code> to start the communications rate for a V.32bis connection at 19.2 Kbps, then cycles through 9600 bps, 2400 bps, 1200 bps, 300 bps, and back to 19.2 Kbps. Communications rate cycling is implemented with the <code>nx=</code> (next table) capability. Each line uses a <code>tc=</code> (table continuation) entry to pick up the rest of the settings for a particular data rate.</p></div><div class="literalblock programlisting"><div class=content><pre>#
# Additions for a V.32bis Modem
#
um|V300|High Speed Modem at 300,8-bit:\
        :nx=V19200:tc=std.300:
un|V1200|High Speed Modem at 1200,8-bit:\
        :nx=V300:tc=std.1200:
uo|V2400|High Speed Modem at 2400,8-bit:\
        :nx=V1200:tc=std.2400:
up|V9600|High Speed Modem at 9600,8-bit:\
        :nx=V2400:tc=std.9600:
uq|V19200|High Speed Modem at 19200,8-bit:\
        :nx=V9600:tc=std.19200:</pre></div></div><div class=paragraph><p>For a 28.8 Kbps modem, or to take advantage of compression on a 14.4 Kbps modem, use a higher communications rate, as seen in this example:</p></div><div class="literalblock programlisting"><div class=content><pre>#
# Additions for a V.32bis or V.34 Modem
# Starting at 57.6 Kbps
#
vm|VH300|Very High Speed Modem at 300,8-bit:\
        :nx=VH57600:tc=std.300:
vn|VH1200|Very High Speed Modem at 1200,8-bit:\
        :nx=VH300:tc=std.1200:
vo|VH2400|Very High Speed Modem at 2400,8-bit:\
        :nx=VH1200:tc=std.2400:
vp|VH9600|Very High Speed Modem at 9600,8-bit:\
        :nx=VH2400:tc=std.9600:
vq|VH57600|Very High Speed Modem at 57600,8-bit:\
        :nx=VH9600:tc=std.57600:</pre></div></div><div class=paragraph><p>For a slow CPU or a heavily loaded system without 16550A-based serial ports, this configuration may produce <code>sio</code> "silo" errors at 57.6 Kbps.</p></div><div class=paragraph><p>The configuration of <span class=filename>/etc/ttys</span> is similar to <a href=#ex-etc-ttys>Configuring Terminal Entries</a>, but a different argument is passed to <code>getty</code> and <code>dialup</code> is used for the terminal type. Replace <em>xxx</em> with the process <code>init</code> will run on the device:</p></div><div class="literalblock programlisting"><div class=content><pre>ttyu0   &#34;/usr/libexec/getty xxx&#34;   dialup on</pre></div></div><div class=paragraph><p>The <code>dialup</code> terminal type can be changed. For example, setting <code>vt102</code> as the default terminal type allows users to use VT102 emulation on their remote systems.</p></div><div class=paragraph><p>For a locked-speed configuration, specify the speed with a valid type listed in <span class=filename>/etc/gettytab</span>. This example is for a modem whose port speed is locked at 19.2 Kbps:</p></div><div class="literalblock programlisting"><div class=content><pre>ttyu0   &#34;/usr/libexec/getty std.19200&#34;   dialup on</pre></div></div><div class=paragraph><p>In a matching-speed configuration, the entry needs to reference the appropriate beginning "auto-baud" entry in <span class=filename>/etc/gettytab</span>. To continue the example for a matching-speed modem that starts at 19.2 Kbps, use this entry:</p></div><div class="literalblock programlisting"><div class=content><pre>ttyu0   &#34;/usr/libexec/getty V19200&#34;   dialup on</pre></div></div><div class=paragraph><p>After editing <span class=filename>/etc/ttys</span>, wait until the modem is properly configured and connected before signaling <code>init</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># kill -HUP 1</span></code></pre></div></div><div class=paragraph><p>High-speed modems, like V.32, V.32bis, and V.34 modems, use hardware (<code>RTS/CTS</code>) flow control. Use <code>stty</code> to set the hardware flow control flag for the modem port. This example sets the <code>crtscts</code> flag on <span class=filename>COM2</span>'s dial-in and dial-out initialization devices:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># stty -f /dev/ttyu1.init crtscts</span>
<span class=c># stty -f /dev/cuau1.init crtscts</span></code></pre></div></div></div><div class=sect3><h4 id=_troubleshooting_4>26.4.2. Troubleshooting<a class=anchor href=#_troubleshooting_4></a></h4><div class=paragraph><p>This section provides a few tips for troubleshooting a dial-up modem that will not connect to a FreeBSD system.</p></div><div class=paragraph><p>Hook up the modem to the FreeBSD system and boot the system. If the modem has status indication lights, watch to see whether the modem’s DTR indicator lights when the <code>login:</code> prompt appears on the system’s console. If it lights up, that should mean that FreeBSD has started a <code>getty</code> process on the appropriate communications port and is waiting for the modem to accept a call.</p></div><div class=paragraph><p>If the DTR indicator does not light, login to the FreeBSD system through the console and type <code>ps ax</code> to see if FreeBSD is running a <code>getty</code> process on the correct port:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>  114 ??  I      0:00.10 /usr/libexec/getty V19200 ttyu0</code></pre></div></div><div class=paragraph><p>If the second column contains a <code>d0</code> instead of a <code>??</code> and the modem has not accepted a call yet, this means that <code>getty</code> has completed its open on the communications port. This could indicate a problem with the cabling or a misconfigured modem because <code>getty</code> should not be able to open the communications port until the carrier detect signal has been asserted by the modem.</p></div><div class=paragraph><p>If no <code>getty</code> processes are waiting to open the port, double-check that the entry for the port is correct in <span class=filename>/etc/ttys</span>. Also, check <span class=filename>/var/log/messages</span> to see if there are any log messages from <code>init</code> or <code>getty</code>.</p></div><div class=paragraph><p>Next, try dialing into the system. Be sure to use 8 bits, no parity, and 1 stop bit on the remote system. If a prompt does not appear right away, or the prompt shows garbage, try pressing <kbd>Enter</kbd> about once per second. If there is still no <code>login:</code> prompt, try sending a <code>BREAK</code>. When using a high-speed modem, try dialing again after locking the dialing modem’s interface speed.</p></div><div class=paragraph><p>If there is still no <code>login:</code> prompt, check <span class=filename>/etc/gettytab</span> again and double-check that:</p></div><div class=ulist><ul><li><p>The initial capability name specified in the entry in <span class=filename>/etc/ttys</span> matches the name of a capability in <span class=filename>/etc/gettytab</span>.</p></li><li><p>Each <code>nx=</code> entry matches another <span class=filename>gettytab</span> capability name.</p></li><li><p>Each <code>tc=</code> entry matches another <span class=filename>gettytab</span> capability name.</p></li></ul></div><div class=paragraph><p>If the modem on the FreeBSD system will not answer, make sure that the modem is configured to answer the phone when DTR is asserted. If the modem seems to be configured correctly, verify that the DTR line is asserted by checking the modem’s indicator lights.</p></div><div class=paragraph><p>If it still does not work, try sending an email to the <a href=https://lists.FreeBSD.org/subscription/freebsd-questions>FreeBSD general questions mailing list</a> describing the modem and the problem.</p></div></div></div><div class=sect2><h3 id=dialout>26.5. Dial-out Service<a class=anchor href=#dialout></a></h3><div class=paragraph><p>The following are tips for getting the host to connect over the modem to another computer. This is appropriate for establishing a terminal session with a remote host.</p></div><div class=paragraph><p>This kind of connection can be helpful to get a file on the Internet if there are problems using PPP. If PPP is not working, use the terminal session to FTP the needed file. Then use zmodem to transfer it to the machine.</p></div><div class=sect3><h4 id=hayes-unsupported>26.5.1. Using a Stock Hayes Modem<a class=anchor href=#hayes-unsupported></a></h4><div class=paragraph><p>A generic Hayes dialer is built into <code>tip</code>. Use <code>at=hayes</code> in <span class=filename>/etc/remote</span>.</p></div><div class=paragraph><p>The Hayes driver is not smart enough to recognize some of the advanced features of newer modems messages like <code>BUSY</code>, <code>NO DIALTONE</code>, or <code>CONNECT 115200</code>. Turn those messages off when using <code>tip</code> with <code>ATX0&amp;W</code>.</p></div><div class=paragraph><p>The dial timeout for <code>tip</code> is 60 seconds. The modem should use something less, or else <code>tip</code> will think there is a communication problem. Try <code>ATS7=45&amp;W</code>.</p></div></div><div class=sect3><h4 id=direct-at>26.5.2. Using <code>AT</code> Commands<a class=anchor href=#direct-at></a></h4><div class=paragraph><p>Create a "direct" entry in <span class=filename>/etc/remote</span>. For example, if the modem is hooked up to the first serial port, <span class=filename>/dev/cuau0</span>, use the following line:</p></div><div class="literalblock programlisting"><div class=content><pre>cuau0:dv=/dev/cuau0:br#19200:pa=none</pre></div></div><div class=paragraph><p>Use the highest bps rate the modem supports in the <code>br</code> capability. Then, type <code>tip cuau0</code> to connect to the modem.</p></div><div class=paragraph><p>Or, use <code>cu</code> as <code>root</code> with the following command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cu -lline -sspeed</span></code></pre></div></div><div class=paragraph><p><em>line</em> is the serial port, such as <span class=filename>/dev/cuau0</span>, and <em>speed</em> is the speed, such as <code>57600</code>. When finished entering the AT commands, type <code>~.</code> to exit.</p></div></div><div class=sect3><h4 id=gt-failure>26.5.3. The <code>@</code> Sign Does Not Work<a class=anchor href=#gt-failure></a></h4><div class=paragraph><p>The <code>@</code> sign in the phone number capability tells <code>tip</code> to look in <span class=filename>/etc/phones</span> for a phone number. But, the <code>@</code> sign is also a special character in capability files like <span class=filename>/etc/remote</span>, so it needs to be escaped with a backslash:</p></div><div class="literalblock programlisting"><div class=content><pre>pn=\@</pre></div></div></div><div class=sect3><h4 id=dial-command-line>26.5.4. Dialing from the Command Line<a class=anchor href=#dial-command-line></a></h4><div class=paragraph><p>Put a "generic" entry in <span class=filename>/etc/remote</span>. For example:</p></div><div class="literalblock programlisting"><div class=content><pre>tip115200|Dial any phone number at 115200 bps:\
        :dv=/dev/cuau0:br#115200:at=hayes:pa=none:du:
tip57600|Dial any phone number at 57600 bps:\
        :dv=/dev/cuau0:br#57600:at=hayes:pa=none:du:</pre></div></div><div class=paragraph><p>This should now work:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># tip -115200 5551234</span></code></pre></div></div><div class=paragraph><p>Users who prefer <code>cu</code> over <code>tip</code>, can use a generic <code>cu</code> entry:</p></div><div class="literalblock programlisting"><div class=content><pre>cu115200|Use cu to dial any number at 115200bps:\
        :dv=/dev/cuau1:br#57600:at=hayes:pa=none:du:</pre></div></div><div class=paragraph><p>and type:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cu 5551234 -s 115200</span></code></pre></div></div></div><div class=sect3><h4 id=set-bps>26.5.5. Setting the bps Rate<a class=anchor href=#set-bps></a></h4><div class=paragraph><p>Put in an entry for <code>tip1200</code> or <code>cu1200</code>, but go ahead and use whatever bps rate is appropriate with the <code>br</code> capability. <code>tip</code> thinks a good default is 1200 bps which is why it looks for a <code>tip1200</code> entry. 1200 bps does not have to be used, though.</p></div></div><div class=sect3><h4 id=terminal-server>26.5.6. Accessing a Number of Hosts Through a Terminal Server<a class=anchor href=#terminal-server></a></h4><div class=paragraph><p>Rather than waiting until connected and typing <code>CONNECT <em>host</em></code> each time, use <code>tip</code>'s <code>cm</code> capability. For example, these entries in <span class=filename>/etc/remote</span> will let you type <code>tip pain</code> or <code>tip muffin</code> to connect to the hosts <code>pain</code> or <code>muffin</code>, and <code>tip deep13</code> to connect to the terminal server.</p></div><div class="literalblock programlisting"><div class=content><pre>pain|pain.deep13.com|Forrester&#39;s machine:\
        :cm=CONNECT pain\n:tc=deep13:
muffin|muffin.deep13.com|Frank&#39;s machine:\
        :cm=CONNECT muffin\n:tc=deep13:
deep13:Gizmonics Institute terminal server:\
        :dv=/dev/cuau2:br#38400:at=hayes:du:pa=none:pn=5551234:</pre></div></div></div><div class=sect3><h4 id=tip-multiline>26.5.7. Using More Than One Line with <code>tip</code><a class=anchor href=#tip-multiline></a></h4><div class=paragraph><p>This is often a problem where a university has several modem lines and several thousand students trying to use them.</p></div><div class=paragraph><p>Make an entry in <span class=filename>/etc/remote</span> and use <code>@</code> for the <code>pn</code> capability:</p></div><div class="literalblock programlisting"><div class=content><pre>big-university:\
        :pn=\@:tc=dialout
dialout:\
        :dv=/dev/cuau3:br#9600:at=courier:du:pa=none:</pre></div></div><div class=paragraph><p>Then, list the phone numbers in <span class=filename>/etc/phones</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>big-university 5551111
big-university 5551112
big-university 5551113
big-university 5551114</pre></div></div><div class=paragraph><p><code>tip</code> will try each number in the listed order, then give up. To keep retrying, run <code>tip</code> in a <code>while</code> loop.</p></div></div><div class=sect3><h4 id=multi-controlp>26.5.8. Using the Force Character<a class=anchor href=#multi-controlp></a></h4><div class=paragraph><p><span class=keyseq><kbd>Ctrl</kbd>+<kbd>P</kbd></span> is the default "force" character, used to tell <code>tip</code> that the next character is literal data. The force character can be set to any other character with the <code>~s</code> escape, which means "set a variable."</p></div><div class=paragraph><p>Type <code>~sforce=<em>single-char</em></code> followed by a newline. <em>single-char</em> is any single character. If <em>single-char</em> is left out, then the force character is the null character, which is accessed by typing <span class=keyseq><kbd>Ctrl</kbd>+<kbd>2</kbd></span> or <span class=keyseq><kbd>Ctrl</kbd>+<kbd>Space</kbd></span>. A pretty good value for <em>single-char</em> is <span class=keyseq><kbd>Shift</kbd>+<kbd>Ctrl</kbd>+<kbd>6</kbd></span>, which is only used on some terminal servers.</p></div><div class=paragraph><p>To change the force character, specify the following in <span class=filename>~/.tiprc</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>force=single-char</pre></div></div></div><div class=sect3><h4 id=uppercase>26.5.9. Upper Case Characters<a class=anchor href=#uppercase></a></h4><div class=paragraph><p>This happens when <span class=keyseq><kbd>Ctrl</kbd>+<kbd>A</kbd></span> is pressed, which is <code>tip</code>'s "raise character", specially designed for people with broken caps-lock keys. Use <code>~s</code> to set <code>raisechar</code> to something reasonable. It can be set to be the same as the force character, if neither feature is used.</p></div><div class=paragraph><p>Here is a sample <span class=filename>~/.tiprc</span> for Emacs users who need to type <span class=keyseq><kbd>Ctrl</kbd>+<kbd>2</kbd></span> and <span class=keyseq><kbd>Ctrl</kbd>+<kbd>A</kbd></span>:</p></div><div class="literalblock programlisting"><div class=content><pre>force=^^
raisechar=^^</pre></div></div><div class=paragraph><p>The <code>^^</code> is <span class=keyseq><kbd>Shift</kbd>+<kbd>Ctrl</kbd>+<kbd>6</kbd></span>.</p></div></div><div class=sect3><h4 id=tip-filetransfer>26.5.10. File Transfers with <code>tip</code><a class=anchor href=#tip-filetransfer></a></h4><div class=paragraph><p>When talking to another UNIX®-like operating system, files can be sent and received using <code>~p</code> (put) and <code>~t</code> (take). These commands run <code>cat</code> and <code>echo</code> on the remote system to accept and send files. The syntax is:
<code>~p</code> local-file [ remote-file ]
<code>~t</code> remote-file [ local-file ]</p></div><div class=paragraph><p>There is no error checking, so another protocol, like zmodem, should probably be used.</p></div></div><div class=sect3><h4 id=zmodem-tip>26.5.11. Using zmodem with <code>tip</code>?<a class=anchor href=#zmodem-tip></a></h4><div class=paragraph><p>To receive files, start the sending program on the remote end. Then, type <code>~C rz</code> to begin receiving them locally.</p></div><div class=paragraph><p>To send files, start the receiving program on the remote end. Then, type <code>~C sz <em>files</em></code> to send them to the remote system.</p></div></div></div><div class=sect2><h3 id=serialconsole-setup>26.6. Setting Up the Serial Console<a class=anchor href=#serialconsole-setup></a></h3><div class=paragraph><p>FreeBSD has the ability to boot a system with a dumb terminal on a serial port as a console. This configuration is useful for system administrators who wish to install FreeBSD on machines that have no keyboard or monitor attached, and developers who want to debug the kernel or device drivers.</p></div><div class=paragraph><p>As described in <a href=./#boot>The FreeBSD Booting Process</a>, FreeBSD employs a three stage bootstrap. The first two stages are in the boot block code which is stored at the beginning of the FreeBSD slice on the boot disk. The boot block then loads and runs the boot loader as the third stage code.</p></div><div class=paragraph><p>In order to set up booting from a serial console, the boot block code, the boot loader code, and the kernel need to be configured.</p></div><div class=sect3><h4 id=serialconsole-howto-fast>26.6.1. Quick Serial Console Configuration<a class=anchor href=#serialconsole-howto-fast></a></h4><div class=paragraph><p>This section provides a fast overview of setting up the serial console. This procedure can be used when the dumb terminal is connected to <span class=filename>COM1</span>.</p></div><div class="olist arabic procedure"><div class=title>Procedure: Configuring a Serial Console on <span class=filename>COM1</span></div><ol class=arabic><li><p>Connect the serial cable to <span class=filename>COM1</span> and the controlling terminal.</p></li><li><p>To configure boot messages to display on the serial console, issue the following command as the superuser:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># echo &#39;console=&#34;comconsole&#34;&#39; &gt;&gt; /boot/loader.conf</span></code></pre></div></div></li><li><p>Edit <span class=filename>/etc/ttys</span> and change <code>off</code> to <code>on</code> and <code>dialup</code> to <code>vt100</code> for the <span class=filename>ttyu0</span> entry. Otherwise, a password will not be required to connect via the serial console, resulting in a potential security hole.</p></li><li><p>Reboot the system to see if the changes took effect.</p></li></ol></div><div class=paragraph><p>If a different configuration is required, see the next section for a more in-depth configuration explanation.</p></div></div><div class=sect3><h4 id=serialconsole-howto>26.6.2. In-Depth Serial Console Configuration<a class=anchor href=#serialconsole-howto></a></h4><div class=paragraph><p>This section provides a more detailed explanation of the steps needed to setup a serial console in FreeBSD.</p></div><div class="olist arabic procedure"><div class=title>Procedure: Configuring a Serial Console</div><ol class=arabic><li><p>Prepare a serial cable.</p><div class=paragraph><p>Use either a null-modem cable or a standard serial cable and a null-modem adapter. See <a href=#term-cables-null>Serial Cables and Ports</a> for a discussion on serial cables.</p></div></li><li><p>Unplug the keyboard.</p><div class=paragraph><p>Many systems probe for the keyboard during the Power-On Self-Test (POST) and will generate an error if the keyboard is not detected. Some machines will refuse to boot until the keyboard is plugged in.</p></div><div class=paragraph><p>If the computer complains about the error, but boots anyway, no further configuration is needed.</p></div><div class=paragraph><p>If the computer refuses to boot without a keyboard attached, configure the BIOS so that it ignores this error. Consult the motherboard’s manual for details on how to do this.</p></div><div class="admonitionblock tip"><table><tbody><tr><td class=icon><i class="fa icon-tip" title=Tip></i></td><td class=content><div class=paragraph><p>Try setting the keyboard to "Not installed" in the BIOS. This setting tells the BIOS not to probe for a keyboard at power-on so it should not complain if the keyboard is absent. If that option is not present in the BIOS, look for an "Halt on Error" option instead. Setting this to "All but Keyboard" or to "No Errors" will have the same effect.</p></div></td></tr></tbody></table></div><div class=paragraph><p>If the system has a PS/2® mouse, unplug it as well. PS/2® mice share some hardware with the keyboard and leaving the mouse plugged in can fool the keyboard probe into thinking the keyboard is still there.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>While most systems will boot without a keyboard, quite a few will not boot without a graphics adapter. Some systems can be configured to boot with no graphics adapter by changing the "graphics adapter" setting in the BIOS configuration to "Not installed". Other systems do not support this option and will refuse to boot if there is no display hardware in the system. With these machines, leave some kind of graphics card plugged in, even if it is just a junky mono board. A monitor does not need to be attached.</p></div></td></tr></tbody></table></div></li><li><p>Plug a dumb terminal, an old computer with a modem program, or the serial port on another UNIX® box into the serial port.</p></li><li><p>Add the appropriate <code>hint.sio.*</code> entries to <span class=filename>/boot/device.hints</span> for the serial port. Some multi-port cards also require kernel configuration options. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=sio&amp;sektion=4&amp;format=html">sio(4)</a> for the required options and device hints for each supported serial port.</p></li><li><p>Create <span class=filename>boot.config</span> in the root directory of the <code>a</code> partition on the boot drive.</p><div class=paragraph><p>This file instructs the boot block code how to boot the system. In order to activate the serial console, one or more of the following options are needed. When using multiple options, include them all on the same line:</p></div><div class=dlist><dl><dt class=hdlist1><code>-h</code></dt><dd><p>Toggles between the internal and serial consoles. Use this to switch console devices. For instance, to boot from the internal (video) console, use <code>-h</code> to direct the boot loader and the kernel to use the serial port as its console device. Alternatively, to boot from the serial port, use <code>-h</code> to tell the boot loader and the kernel to use the video display as the console instead.</p></dd><dt class=hdlist1><code>-D</code></dt><dd><p>Toggles between the single and dual console configurations. In the single configuration, the console will be either the internal console (video display) or the serial port, depending on the state of <code>-h</code>. In the dual console configuration, both the video display and the serial port will become the console at the same time, regardless of the state of <code>-h</code>. However, the dual console configuration takes effect only while the boot block is running. Once the boot loader gets control, the console specified by <code>-h</code> becomes the only console.</p></dd><dt class=hdlist1><code>-P</code></dt><dd><p>Makes the boot block probe the keyboard. If no keyboard is found, the <code>-D</code> and <code>-h</code> options are automatically set.</p><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Due to space constraints in the current version of the boot blocks, <code>-P</code> is capable of detecting extended keyboards only. Keyboards with less than 101 keys and without F11 and F12 keys may not be detected. Keyboards on some laptops may not be properly found because of this limitation. If this is the case, do not use <code>-P</code>.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Use either <code>-P</code> to select the console automatically or <code>-h</code> to activate the serial console. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=boot&amp;sektion=8&amp;format=html">boot(8)</a> and <a href="https://man.freebsd.org/cgi/man.cgi?query=boot.config&amp;sektion=5&amp;format=html">boot.config(5)</a> for more details.</p></div><div class=paragraph><p>The options, except for <code>-P</code>, are passed to the boot loader. The boot loader will determine whether the internal video or the serial port should become the console by examining the state of <code>-h</code>. This means that if <code>-D</code> is specified but <code>-h</code> is not specified in <span class=filename>/boot.config</span>, the serial port can be used as the console only during the boot block as the boot loader will use the internal video display as the console.</p></div></dd></dl></div></li><li><p>Boot the machine.</p><div class=paragraph><p>When FreeBSD starts, the boot blocks echo the contents of <span class=filename>/boot.config</span> to the console. For example:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>/boot.config: <span class=nt>-P</span>
Keyboard: no</code></pre></div></div><div class=paragraph><p>The second line appears only if <code>-P</code> is in <span class=filename>/boot.config</span> and indicates the presence or absence of the keyboard. These messages go to either the serial or internal console, or both, depending on the option in <span class=filename>/boot.config</span>:</p></div><table class="tableblock frame-none grid-all stretch informaltable"><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">Options</th><th class="tableblock halign-left valign-top">Message goes to</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock>none</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>internal console</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>-h</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>serial console</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>-D</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>serial and internal consoles</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>-Dh</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>serial and internal consoles</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>-P</code>, keyboard present</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>internal console</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>-P</code>, keyboard absent</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>serial console</p></td></tr></tbody></table><div class=paragraph><p>After the message, there will be a small pause before the boot blocks continue loading the boot loader and before any further messages are printed to the console. Under normal circumstances, there is no need to interrupt the boot blocks, but one can do so in order to make sure things are set up correctly.</p></div><div class=paragraph><p>Press any key, other than <kbd>Enter</kbd>, at the console to interrupt the boot process. The boot blocks will then prompt for further action:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=o>&gt;&gt;</span> FreeBSD/i386 BOOT
Default: 0:ad<span class=o>(</span>0,a<span class=o>)</span>/boot/loader
boot:</code></pre></div></div><div class=paragraph><p>Verify that the above message appears on either the serial or internal console, or both, according to the options in <span class=filename>/boot.config</span>. If the message appears in the correct console, press <kbd>Enter</kbd> to continue the boot process.</p></div><div class=paragraph><p>If there is no prompt on the serial terminal, something is wrong with the settings. Enter <code>-h</code> then <kbd>Enter</kbd> or <kbd>Return</kbd> to tell the boot block (and then the boot loader and the kernel) to choose the serial port for the console. Once the system is up, go back and check what went wrong.</p></div></li></ol></div><div class=paragraph><p>During the third stage of the boot process, one can still switch between the internal console and the serial console by setting appropriate environment variables in the boot loader. See <a href="https://man.freebsd.org/cgi/man.cgi?query=loader&amp;sektion=8&amp;format=html">loader(8)</a> for more information.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>This line in <span class=filename>/boot/loader.conf</span> or <span class=filename>/boot/loader.conf.local</span> configures the boot loader and the kernel to send their boot messages to the serial console, regardless of the options in <span class=filename>/boot.config</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>console=&#34;comconsole&#34;</pre></div></div><div class=paragraph><p>That line should be the first line of <span class=filename>/boot/loader.conf</span> so that boot messages are displayed on the serial console as early as possible.</p></div><div class=paragraph><p>If that line does not exist, or if it is set to <code>console="vidconsole"</code>, the boot loader and the kernel will use whichever console is indicated by <code>-h</code> in the boot block. See <a href="https://man.freebsd.org/cgi/man.cgi?query=loader.conf&amp;sektion=5&amp;format=html">loader.conf(5)</a> for more information.</p></div><div class=paragraph><p>At the moment, the boot loader has no option equivalent to <code>-P</code> in the boot block, and there is no provision to automatically select the internal console and the serial console based on the presence of the keyboard.</p></div></td></tr></tbody></table></div><div class="admonitionblock tip"><table><tbody><tr><td class=icon><i class="fa icon-tip" title=Tip></i></td><td class=content><div class=paragraph><p>While it is not required, it is possible to provide a <code>login</code> prompt over the serial line. To configure this, edit the entry for the serial port in <span class=filename>/etc/ttys</span> using the instructions in <a href=#term-config>Terminal Configuration</a>. If the speed of the serial port has been changed, change <code>std.9600</code> to match the new setting.</p></div></td></tr></tbody></table></div></div><div class=sect3><h4 id=_setting_a_faster_serial_port_speed>26.6.3. Setting a Faster Serial Port Speed<a class=anchor href=#_setting_a_faster_serial_port_speed></a></h4><div class=paragraph><p>By default, the serial port settings are 9600 baud, 8 bits, no parity, and 1 stop bit. To change the default console speed, use one of the following options:</p></div><div class=ulist><ul><li><p>Edit <span class=filename>/etc/make.conf</span> and set <code>BOOT_COMCONSOLE_SPEED</code> to the new console speed. Then, recompile and install the boot blocks and the boot loader:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /sys/boot</span>
<span class=c># make clean</span>
<span class=c># make</span>
<span class=c># make install</span></code></pre></div></div><div class=paragraph><p>If the serial console is configured in some other way than by booting with <code>-h</code>, or if the serial console used by the kernel is different from the one used by the boot blocks, add the following option, with the desired speed, to a custom kernel configuration file and compile a new kernel:</p></div><div class="literalblock programlisting"><div class=content><pre>options CONSPEED=19200</pre></div></div></li><li><p>Add the <code>-S<em>19200</em></code> boot option to <span class=filename>/boot.config</span>, replacing <code><em>19200</em></code> with the speed to use.</p></li><li><p>Add the following options to <span class=filename>/boot/loader.conf</span>. Replace <code><em>115200</em></code> with the speed to use.</p><div class="literalblock programlisting"><div class=content><pre>boot_multicons=&#34;YES&#34;
boot_serial=&#34;YES&#34;
comconsole_speed=&#34;115200&#34;
console=&#34;comconsole,vidconsole&#34;</pre></div></div></li></ul></div></div><div class=sect3><h4 id=serialconsole-ddb>26.6.4. Entering the DDB Debugger from the Serial Line<a class=anchor href=#serialconsole-ddb></a></h4><div class=paragraph><p>To configure the ability to drop into the kernel debugger from the serial console, add the following options to a custom kernel configuration file and compile the kernel using the instructions in <a href=./#kernelconfig>Configuring the FreeBSD Kernel</a>. Note that while this is useful for remote diagnostics, it is also dangerous if a spurious BREAK is generated on the serial port. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=ddb&amp;sektion=4&amp;format=html">ddb(4)</a> and <a href="https://man.freebsd.org/cgi/man.cgi?query=ddb&amp;sektion=8&amp;format=html">ddb(8)</a> for more information about the kernel debugger.</p></div><div class="literalblock programlisting"><div class=content><pre>options BREAK_TO_DEBUGGER
options DDB</pre></div></div></div></div></div></div><div class=sect1><h2 id=ppp-and-slip>Rozdział 27. PPP<a class=anchor href=#ppp-and-slip></a></h2><div class=sectionbody><div class=sect2><h3 id=ppp-and-slip-synopsis>27.1. Synopsis<a class=anchor href=#ppp-and-slip-synopsis></a></h3><div class=paragraph><p>FreeBSD supports the Point-to-Point (PPP) protocol which can be used to establish a network or Internet connection using a dial-up modem. This chapter describes how to configure modem-based communication services in FreeBSD.</p></div><div class=paragraph><p>After reading this chapter, you will know:</p></div><div class=ulist><ul><li><p>How to configure, use, and troubleshoot a PPP connection.</p></li><li><p>How to set up PPP over Ethernet (PPPoE).</p></li><li><p>How to set up PPP over ATM (PPPoA).</p></li></ul></div><div class=paragraph><p>Before reading this chapter, you should:</p></div><div class=ulist><ul><li><p>Be familiar with basic network terminology.</p></li><li><p>Understand the basics and purpose of a dial-up connection and PPP.</p></li></ul></div></div><div class=sect2><h3 id=userppp>27.2. Configuring PPP<a class=anchor href=#userppp></a></h3><div class=paragraph><p>FreeBSD provides built-in support for managing dial-up PPP connections using <a href="https://man.freebsd.org/cgi/man.cgi?query=ppp&amp;sektion=8&amp;format=html">ppp(8)</a>. The default FreeBSD kernel provides support for <span class=filename>tun</span> which is used to interact with a modem hardware. Configuration is performed by editing at least one configuration file, and configuration files containing examples are provided. Finally, <code>ppp</code> is used to start and manage connections.</p></div><div class=paragraph><p>In order to use a PPP connection, the following items are needed:</p></div><div class=ulist><ul><li><p>A dial-up account with an Internet Service Provider (ISP).</p></li><li><p>A dial-up modem.</p></li><li><p>The dial-up number for the ISP.</p></li><li><p>The login name and password assigned by the ISP.</p></li><li><p>The IP address of one or more DNS servers. Normally, the ISP provides these addresses. If it did not, FreeBSD can be configured to use DNS negotiation.</p></li></ul></div><div class=paragraph><p>If any of the required information is missing, contact the ISP.</p></div><div class=paragraph><p>The following information may be supplied by the ISP, but is not necessary:</p></div><div class=ulist><ul><li><p>The IP address of the default gateway. If this information is unknown, the ISP will automatically provide the correct value during connection setup. When configuring PPP on FreeBSD, this address is referred to as <code>HISADDR</code>.</p></li><li><p>The subnet mask. If the ISP has not provided one, <code>255.255.255.255</code> will be used in the <a href="https://man.freebsd.org/cgi/man.cgi?query=ppp&amp;sektion=8&amp;format=html">ppp(8)</a> configuration file.
*</p><div class=paragraph><p>If the ISP has assigned a static IP address and hostname, it should be input into the configuration file. Otherwise, this information will be automatically provided during connection setup.</p></div></li></ul></div><div class=paragraph><p>The rest of this section demonstrates how to configure FreeBSD for common PPP connection scenarios. The required configuration file is <span class=filename>/etc/ppp/ppp.conf</span> and additional files and examples are available in <span class=filename>/usr/shared/examples/ppp/</span>.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Throughout this section, many of the file examples display line numbers. These line numbers have been added to make it easier to follow the discussion and are not meant to be placed in the actual file.</p></div><div class=paragraph><p>When editing a configuration file, proper indentation is important. Lines that end in a <code>:</code> start in the first column (beginning of the line) while all other lines should be indented as shown using spaces or tabs.</p></div></td></tr></tbody></table></div><div class=sect3><h4 id=userppp-staticIP>27.2.1. Basic Configuration<a class=anchor href=#userppp-staticIP></a></h4><div class=paragraph><p>In order to configure a PPP connection, first edit <span class=filename>/etc/ppp/ppp.conf</span> with the dial-in information for the ISP. This file is described as follows:</p></div><div class="literalblock programlisting"><div class=content><pre>1     default:
2       set log Phase Chat LCP IPCP CCP tun command
3       ident user-ppp VERSION
4       set device /dev/cuau0
5       set speed 115200
6       set dial &#34;ABORT BUSY ABORT NO\\sCARRIER TIMEOUT 5 \
7                 \&#34;\&#34; AT OK-AT-OK ATE1Q0 OK \\dATDT\\T TIMEOUT 40 CONNECT&#34;
8       set timeout 180
9       enable dns
10
11    provider:
12      set phone &#34;(123) 456 7890&#34;
13      set authname foo
14      set authkey bar
15      set timeout 300
16      set ifaddr x.x.x.x/0 y.y.y.y/0 255.255.255.255 0.0.0.0
17      add default HISADDR</pre></div></div><div class=dlist><dl><dt class=hdlist1>Line 1</dt><dd><p>Identifies the <code>default</code> entry. Commands in this entry (lines 2 through 9) are executed automatically when <code>ppp</code> is run.</p></dd><dt class=hdlist1>Line 2</dt><dd><p>Enables verbose logging parameters for testing the connection. Once the configuration is working satisfactorily, this line should be reduced to:</p><div class="literalblock programlisting"><div class=content><pre>set log phase tun</pre></div></div></dd><dt class=hdlist1>Line 3</dt><dd><p>Displays the version of <a href="https://man.freebsd.org/cgi/man.cgi?query=ppp&amp;sektion=8&amp;format=html">ppp(8)</a> to the PPP software running on the other side of the connection.</p></dd><dt class=hdlist1>Line 4</dt><dd><p>Identifies the device to which the modem is connected, where <span class=filename>COM1</span> is <span class=filename>/dev/cuau0</span> and <span class=filename>COM2</span> is <span class=filename>/dev/cuau1</span>.</p></dd><dt class=hdlist1>Line 5</dt><dd><p>Sets the connection speed. If <code>115200</code> does not work on an older modem, try <code>38400</code> instead.</p></dd><dt class=hdlist1>Lines 6 & 7</dt><dd><p>The dial string written as an expect-send syntax. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=chat&amp;sektion=8&amp;format=html">chat(8)</a> for more information.</p><div class=paragraph><p>Note that this command continues onto the next line for readability. Any command in <span class=filename>ppp.conf</span> may do this if the last character on the line is <code>\</code>.</p></div></dd><dt class=hdlist1>Line 8</dt><dd><p>Sets the idle timeout for the link in seconds.</p></dd><dt class=hdlist1>Line 9</dt><dd><p>Instructs the peer to confirm the DNS settings. If the local network is running its own DNS server, this line should be commented out, by adding a <code>#</code> at the beginning of the line, or removed.</p></dd><dt class=hdlist1>Line 10</dt><dd><p>A blank line for readability. Blank lines are ignored by <a href="https://man.freebsd.org/cgi/man.cgi?query=ppp&amp;sektion=8&amp;format=html">ppp(8)</a>.</p></dd><dt class=hdlist1>Line 11</dt><dd><p>Identifies an entry called <code>provider</code>. This could be changed to the name of the ISP so that <code>load <em>ISP</em></code> can be used to start the connection.</p></dd><dt class=hdlist1>Line 12</dt><dd><p>Use the phone number for the ISP. Multiple phone numbers may be specified using the colon (<code>:</code>) or pipe character (<code>|</code>) as a separator. To rotate through the numbers, use a colon. To always attempt to dial the first number first and only use the other numbers if the first number fails, use the pipe character. Always enclose the entire set of phone numbers between quotation marks (<code>"</code>) to prevent dialing failures.</p></dd><dt class=hdlist1>Lines 13 & 14</dt><dd><p>Use the user name and password for the ISP.</p></dd><dt class=hdlist1>Line 15</dt><dd><p>Sets the default idle timeout in seconds for the connection. In this example, the connection will be closed automatically after 300 seconds of inactivity. To prevent a timeout, set this value to zero.</p></dd><dt class=hdlist1>Line 16</dt><dd><p>Sets the interface addresses. The values used depend upon whether a static IP address has been obtained from the ISP or if it instead negotiates a dynamic IP address during connection.</p><div class=paragraph><p>If the ISP has allocated a static IP address and default gateway, replace <em>x.x.x.x</em> with the static IP address and replace <em>y.y.y.y</em> with the IP address of the default gateway. If the ISP has only provided a static IP address without a gateway address, replace <em>y.y.y.y</em> with <code>10.0.0.2/0</code>.</p></div><div class=paragraph><p>If the IP address changes whenever a connection is made, change this line to the following value. This tells <a href="https://man.freebsd.org/cgi/man.cgi?query=ppp&amp;sektion=8&amp;format=html">ppp(8)</a> to use the IP Configuration Protocol (IPCP) to negotiate a dynamic IP address:</p></div><div class="literalblock programlisting"><div class=content><pre>set ifaddr 10.0.0.1/0 10.0.0.2/0 255.255.255.255 0.0.0.0</pre></div></div></dd><dt class=hdlist1>Line 17</dt><dd><p>Keep this line as-is as it adds a default route to the gateway. The <code>HISADDR</code> will automatically be replaced with the gateway address specified on line 16. It is important that this line appears after line 16.</p></dd></dl></div><div class=paragraph><p>Depending upon whether <a href="https://man.freebsd.org/cgi/man.cgi?query=ppp&amp;sektion=8&amp;format=html">ppp(8)</a> is started manually or automatically, a <span class=filename>/etc/ppp/ppp.linkup</span> may also need to be created which contains the following lines. This file is required when running <code>ppp</code> in <code>-auto</code> mode. This file is used after the connection has been established. At this point, the IP address will have been assigned and it is now be possible to add the routing table entries. When creating this file, make sure that <em>provider</em> matches the value demonstrated in line 11 of <span class=filename>ppp.conf</span>.</p></div><div class="literalblock programlisting"><div class=content><pre>provider:
      add default HISADDR</pre></div></div><div class=paragraph><p>This file is also needed when the default gateway address is "guessed" in a static IP address configuration. In this case, remove line 17 from <span class=filename>ppp.conf</span> and create <span class=filename>/etc/ppp/ppp.linkup</span> with the above two lines. More examples for this file can be found in <span class=filename>/usr/shared/examples/ppp/</span>.</p></div><div class=paragraph><p>By default, <code>ppp</code> must be run as <code>root</code>. To change this default, add the account of the user who should run <code>ppp</code> to the <code>network</code> group in <span class=filename>/etc/group</span>.</p></div><div class=paragraph><p>Then, give the user access to one or more entries in <span class=filename>/etc/ppp/ppp.conf</span> with <code>allow</code>. For example, to give <code>fred</code> and <code>mary</code> permission to only the <code>provider:</code> entry, add this line to the <code>provider:</code> section:</p></div><div class="literalblock programlisting"><div class=content><pre>allow users fred mary</pre></div></div><div class=paragraph><p>To give the specified users access to all entries, put that line in the <code>default</code> section instead.</p></div></div><div class=sect3><h4 id=_advanced_configuration_2>27.2.2. Advanced Configuration<a class=anchor href=#_advanced_configuration_2></a></h4><div class=paragraph><p>It is possible to configure PPP to supply DNS and NetBIOS nameserver addresses on demand.</p></div><div class=paragraph><p>To enable these extensions with PPP version 1.x, the following lines might be added to the relevant section of <span class=filename>/etc/ppp/ppp.conf</span>.</p></div><div class="literalblock programlisting"><div class=content><pre>enable msext
set ns 203.14.100.1 203.14.100.2
set nbns 203.14.100.5</pre></div></div><div class=paragraph><p>And for PPP version 2 and above:</p></div><div class="literalblock programlisting"><div class=content><pre>accept dns
set dns 203.14.100.1 203.14.100.2
set nbns 203.14.100.5</pre></div></div><div class=paragraph><p>This will tell the clients the primary and secondary name server addresses, and a NetBIOS nameserver host.</p></div><div class=paragraph><p>In version 2 and above, if the <code>set dns</code> line is omitted, PPP will use the values found in <span class=filename>/etc/resolv.conf</span>.</p></div><div class=sect4><h5 id=userppp-PAPnCHAP>27.2.2.1. PAP and CHAP Authentication<a class=anchor href=#userppp-PAPnCHAP></a></h5><div class=paragraph><p>Some ISPs set their system up so that the authentication part of the connection is done using either of the PAP or CHAP authentication mechanisms. If this is the case, the ISP will not give a <code>login:</code> prompt at connection, but will start talking PPP immediately.</p></div><div class=paragraph><p>PAP is less secure than CHAP, but security is not normally an issue here as passwords, although being sent as plain text with PAP, are being transmitted down a serial line only. There is not much room for crackers to "eavesdrop".</p></div><div class=paragraph><p>The following alterations must be made:</p></div><div class="literalblock programlisting"><div class=content><pre>13      set authname MyUserName
14      set authkey MyPassword
15      set login</pre></div></div><div class=dlist><dl><dt class=hdlist1>Line 13</dt><dd><p>This line specifies the PAP/CHAP user name. Insert the correct value for <em>MyUserName</em>.</p></dd><dt class=hdlist1>Line 14</dt><dd><p>This line specifies the PAP/CHAP password. Insert the correct value for <em>MyPassword</em>. You may want to add an additional line, such as:</p><div class="literalblock programlisting"><div class=content><pre>16      accept PAP</pre></div></div><div class=paragraph><p>or</p></div><div class="literalblock programlisting"><div class=content><pre>16      accept CHAP</pre></div></div><div class=paragraph><p>to make it obvious that this is the intention, but PAP and CHAP are both accepted by default.</p></div></dd><dt class=hdlist1>Line 15</dt><dd><p>The ISP will not normally require a login to the server when using PAP or CHAP. Therefore, disable the "set login" string.</p></dd></dl></div></div><div class=sect4><h5 id=userppp-nat>27.2.2.2. Using PPP Network Address Translation Capability<a class=anchor href=#userppp-nat></a></h5><div class=paragraph><p>PPP has ability to use internal NAT without kernel diverting capabilities. This functionality may be enabled by the following line in <span class=filename>/etc/ppp/ppp.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>nat enable yes</pre></div></div><div class=paragraph><p>Alternatively, NAT may be enabled by command-line option <code>-nat</code>. There is also <span class=filename>/etc/rc.conf</span> knob named <code>ppp_nat</code>, which is enabled by default.</p></div><div class=paragraph><p>When using this feature, it may be useful to include the following <span class=filename>/etc/ppp/ppp.conf</span> options to enable incoming connections forwarding:</p></div><div class="literalblock programlisting"><div class=content><pre>nat port tcp 10.0.0.2:ftp ftp
nat port tcp 10.0.0.2:http http</pre></div></div><div class=paragraph><p>or do not trust the outside at all</p></div><div class="literalblock programlisting"><div class=content><pre>nat deny_incoming yes</pre></div></div></div></div><div class=sect3><h4 id=userppp-final>27.2.3. Final System Configuration<a class=anchor href=#userppp-final></a></h4><div class=paragraph><p>While <code>ppp</code> is now configured, some edits still need to be made to <span class=filename>/etc/rc.conf</span>.</p></div><div class=paragraph><p>Working from the top down in this file, make sure the <code>hostname=</code> line is set:</p></div><div class="literalblock programlisting"><div class=content><pre>hostname=&#34;foo.example.com&#34;</pre></div></div><div class=paragraph><p>If the ISP has supplied a static IP address and name, use this name as the host name.</p></div><div class=paragraph><p>Look for the <code>network_interfaces</code> variable. To configure the system to dial the ISP on demand, make sure the <span class=filename>tun0</span> device is added to the list, otherwise remove it.</p></div><div class="literalblock programlisting"><div class=content><pre>network_interfaces=&#34;lo0 tun0&#34;
ifconfig_tun0=</pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>The <code>ifconfig_tun0</code> variable should be empty, and a file called <span class=filename>/etc/start_if.tun0</span> should be created. This file should contain the line:</p></div><div class="literalblock programlisting"><div class=content><pre>ppp -auto mysystem</pre></div></div><div class=paragraph><p>This script is executed at network configuration time, starting the ppp daemon in automatic mode. If this machine acts as a gateway, consider including <code>-alias</code>. Refer to the manual page for further details.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Make sure that the router program is set to <code>NO</code> with the following line in <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>router_enable=&#34;NO&#34;</pre></div></div><div class=paragraph><p>It is important that the <code>routed</code> daemon is not started, as <code>routed</code> tends to delete the default routing table entries created by <code>ppp</code>.</p></div><div class=paragraph><p>It is probably a good idea to ensure that the <code>sendmail_flags</code> line does not include the <code>-q</code> option, otherwise <code>sendmail</code> will attempt to do a network lookup every now and then, possibly causing your machine to dial out. You may try:</p></div><div class="literalblock programlisting"><div class=content><pre>sendmail_flags=&#34;-bd&#34;</pre></div></div><div class=paragraph><p>The downside is that <code>sendmail</code> is forced to re-examine the mail queue whenever the ppp link. To automate this, include <code>!bg</code> in <span class=filename>ppp.linkup</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>1     provider:
2       delete ALL
3       add 0 0 HISADDR
4       !bg sendmail -bd -q30m</pre></div></div><div class=paragraph><p>An alternative is to set up a "dfilter" to block SMTP traffic. Refer to the sample files for further details.</p></div></div><div class=sect3><h4 id=_using_ppp>27.2.4. Using <code>ppp</code><a class=anchor href=#_using_ppp></a></h4><div class=paragraph><p>All that is left is to reboot the machine. After rebooting, either type:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ppp</span></code></pre></div></div><div class=paragraph><p>and then <code>dial provider</code> to start the PPP session, or, to configure <code>ppp</code> to establish sessions automatically when there is outbound traffic and <span class=filename>start_if.tun0</span> does not exist, type:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ppp -auto provider</span></code></pre></div></div><div class=paragraph><p>It is possible to talk to the <code>ppp</code> program while it is running in the background, but only if a suitable diagnostic port has been set up. To do this, add the following line to the configuration:</p></div><div class="literalblock programlisting"><div class=content><pre>set server /var/run/ppp-tun%d DiagnosticPassword 0177</pre></div></div><div class=paragraph><p>This will tell PPP to listen to the specified UNIX® domain socket, asking clients for the specified password before allowing access. The <code>%d</code> in the name is replaced with the <span class=filename>tun</span> device number that is in use.</p></div><div class=paragraph><p>Once a socket has been set up, the <a href="https://man.freebsd.org/cgi/man.cgi?query=pppctl&amp;sektion=8&amp;format=html">pppctl(8)</a> program may be used in scripts that wish to manipulate the running program.</p></div></div><div class=sect3><h4 id=userppp-mgetty>27.2.5. Configuring Dial-in Services<a class=anchor href=#userppp-mgetty></a></h4><div class=paragraph><p><a href=./#dialup>“Dial-in Service”</a> provides a good description on enabling dial-up services using <a href="https://man.freebsd.org/cgi/man.cgi?query=getty&amp;sektion=8&amp;format=html">getty(8)</a>.</p></div><div class=paragraph><p>An alternative to <code>getty</code> is <a class=package href=https://cgit.freebsd.org/ports/tree/comms/mgetty+sendfax/>comms/mgetty+sendfax</a> port), a smarter version of <code>getty</code> designed with dial-up lines in mind.</p></div><div class=paragraph><p>The advantages of using <code>mgetty</code> is that it actively <em>talks</em> to modems, meaning if port is turned off in <span class=filename>/etc/ttys</span> then the modem will not answer the phone.</p></div><div class=paragraph><p>Later versions of <code>mgetty</code> (from 0.99beta onwards) also support the automatic detection of PPP streams, allowing clients scriptless access to the server.</p></div><div class=paragraph><p>Refer to <a href=http://mgetty.greenie.net/doc/mgetty_toc.html>http://mgetty.greenie.net/doc/mgetty_toc.html</a> for more information on <code>mgetty</code>.</p></div><div class=paragraph><p>By default the <a class=package href=https://cgit.freebsd.org/ports/tree/comms/mgetty+sendfax/>comms/mgetty+sendfax</a> port comes with the <code>AUTO_PPP</code> option enabled allowing <code>mgetty</code> to detect the LCP phase of PPP connections and automatically spawn off a ppp shell. However, since the default login/password sequence does not occur it is necessary to authenticate users using either PAP or CHAP.</p></div><div class=paragraph><p>This section assumes the user has successfully compiled, and installed the <a class=package href=https://cgit.freebsd.org/ports/tree/comms/mgetty+sendfax/>comms/mgetty+sendfax</a> port on his system.</p></div><div class=paragraph><p>Ensure that <span class=filename>/usr/local/etc/mgetty+sendfax/login.config</span> has the following:</p></div><div class="literalblock programlisting"><div class=content><pre>/AutoPPP/ -     - /etc/ppp/ppp-pap-dialup</pre></div></div><div class=paragraph><p>This tells <code>mgetty</code> to run <span class=filename>ppp-pap-dialup</span> for detected PPP connections.</p></div><div class=paragraph><p>Create an executable file called <span class=filename>/etc/ppp/ppp-pap-dialup</span> containing the following:</p></div><div class="literalblock programlisting"><div class=content><pre>#!/bin/sh
exec /usr/sbin/ppp -direct pap$IDENT</pre></div></div><div class=paragraph><p>For each dial-up line enabled in <span class=filename>/etc/ttys</span>, create a corresponding entry in <span class=filename>/etc/ppp/ppp.conf</span>. This will happily co-exist with the definitions we created above.</p></div><div class="literalblock programlisting"><div class=content><pre>pap:
  enable pap
  set ifaddr 203.14.100.1 203.14.100.20-203.14.100.40
  enable proxy</pre></div></div><div class=paragraph><p>Each user logging in with this method will need to have a username/password in <span class=filename>/etc/ppp/ppp.secret</span>, or alternatively add the following option to authenticate users via PAP from <span class=filename>/etc/passwd</span>.</p></div><div class="literalblock programlisting"><div class=content><pre>enable passwdauth</pre></div></div><div class=paragraph><p>To assign some users a static IP number, specify the number as the third argument in <span class=filename>/etc/ppp/ppp.secret</span>. See <span class=filename>/usr/shared/examples/ppp/ppp.secret.sample</span> for examples.</p></div></div></div><div class=sect2><h3 id=ppp-troubleshoot>27.3. Troubleshooting PPP Connections<a class=anchor href=#ppp-troubleshoot></a></h3><div class=paragraph><p>This section covers a few issues which may arise when using PPP over a modem connection. Some ISPs present the <code>ssword</code> prompt while others present <code>password</code>. If the <code>ppp</code> script is not written accordingly, the login attempt will fail. The most common way to debug <code>ppp</code> connections is by connecting manually as described in this section.</p></div><div class=sect3><h4 id=_check_the_device_nodes>27.3.1. Check the Device Nodes<a class=anchor href=#_check_the_device_nodes></a></h4><div class=paragraph><p>When using a custom kernel, make sure to include the following line in the kernel configuration file:</p></div><div class="literalblock programlisting"><div class=content><pre>device   uart</pre></div></div><div class=paragraph><p>The <span class=filename>uart</span> device is already included in the <code>GENERIC</code> kernel, so no additional steps are necessary in this case. Just check the <code>dmesg</code> output for the modem device with:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># dmesg | grep uart</span></code></pre></div></div><div class=paragraph><p>This should display some pertinent output about the <span class=filename>uart</span> devices. These are the COM ports we need. If the modem acts like a standard serial port, it should be listed on <span class=filename>uart1</span>, or <span class=filename>COM2</span>. If so, a kernel rebuild is not required. When matching up, if the modem is on <span class=filename>uart1</span>, the modem device would be <span class=filename>/dev/cuau1</span>.</p></div></div><div class=sect3><h4 id=_connecting_manually>27.3.2. Connecting Manually<a class=anchor href=#_connecting_manually></a></h4><div class=paragraph><p>Connecting to the Internet by manually controlling <code>ppp</code> is quick, easy, and a great way to debug a connection or just get information on how the ISP treats <code>ppp</code> client connections. Lets start PPP from the command line. Note that in all of our examples we will use <em>example</em> as the hostname of the machine running PPP. To start <code>ppp</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ppp</span></code></pre></div></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>ppp ON example&gt; <span class=nb>set </span>device /dev/cuau1</code></pre></div></div><div class=paragraph><p>This second command sets the modem device to <span class=filename>cuau1</span>.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>ppp ON example&gt; <span class=nb>set </span>speed 115200</code></pre></div></div><div class=paragraph><p>This sets the connection speed to 115,200 kbps.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>ppp ON example&gt; <span class=nb>enable </span>dns</code></pre></div></div><div class=paragraph><p>This tells <code>ppp</code> to configure the resolver and add the nameserver lines to <span class=filename>/etc/resolv.conf</span>. If <code>ppp</code> cannot determine the hostname, it can manually be set later.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>ppp ON example&gt; term</code></pre></div></div><div class=paragraph><p>This switches to "terminal" mode in order to manually control the modem.</p></div><div class="literalblock programlisting"><div class=content><pre>deflink: Entering terminal mode on /dev/cuau1
type &#39;~h&#39; for help</pre></div></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>at
OK
atdt123456789</code></pre></div></div><div class=paragraph><p>Use <code>at</code> to initialize the modem, then use <code>atdt</code> and the number for the ISP to begin the dial in process.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>CONNECT</code></pre></div></div><div class=paragraph><p>Confirmation of the connection, if we are going to have any connection problems, unrelated to hardware, here is where we will attempt to resolve them.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>ISP Login:myusername</code></pre></div></div><div class=paragraph><p>At this prompt, return the prompt with the username that was provided by the ISP.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>ISP Pass:mypassword</code></pre></div></div><div class=paragraph><p>At this prompt, reply with the password that was provided by the ISP. Just like logging into FreeBSD, the password will not echo.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>Shell or PPP:ppp</code></pre></div></div><div class=paragraph><p>Depending on the ISP, this prompt might not appear. If it does, it is asking whether to use a shell on the provider or to start <code>ppp</code>. In this example, <code>ppp</code> was selected in order to establish an Internet connection.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>Ppp ON example&gt;</code></pre></div></div><div class=paragraph><p>Notice that in this example the first <code>p</code> has been capitalized. This shows that we have successfully connected to the ISP.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>Ppp ON example&gt;</code></pre></div></div><div class=paragraph><p>We have successfully authenticated with our ISP and are waiting for the assigned IP address.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>PPP ON example&gt;</code></pre></div></div><div class=paragraph><p>We have made an agreement on an IP address and successfully completed our connection.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>PPP ON example&gt;add default HISADDR</code></pre></div></div><div class=paragraph><p>Here we add our default route, we need to do this before we can talk to the outside world as currently the only established connection is with the peer. If this fails due to existing routes, put a bang character <code>!</code> in front of the <code>add</code>. Alternatively, set this before making the actual connection and it will negotiate a new route accordingly.</p></div><div class=paragraph><p>If everything went good we should now have an active connection to the Internet, which could be thrown into the background using <span class=keyseq><kbd>CTRL</kbd>+<kbd>z</kbd></span> If <code>PPP</code> returns to <code>ppp</code> then the connection has bee lost. This is good to know because it shows the connection status. Capital P’s represent a connection to the ISP and lowercase p’s show that the connection has been lost.</p></div></div><div class=sect3><h4 id=_debugging>27.3.3. Debugging<a class=anchor href=#_debugging></a></h4><div class=paragraph><p>If a connection cannot be established, turn hardware flow CTS/RTS to off using <code>set ctsrts off</code>. This is mainly the case when connected to some PPP-capable terminal servers, where PPP hangs when it tries to write data to the communication link, and waits for a Clear To Send (CTS) signal which may never come. When using this option, include <code>set accmap</code> as it may be required to defeat hardware dependent on passing certain characters from end to end, most of the time XON/XOFF. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=ppp&amp;sektion=8&amp;format=html">ppp(8)</a> for more information on this option and how it is used.</p></div><div class=paragraph><p>An older modem may need <code>set parity even</code>. Parity is set at none be default, but is used for error checking with a large increase in traffic, on older modems.</p></div><div class=paragraph><p>PPP may not return to the command mode, which is usually a negotiation error where the ISP is waiting for negotiating to begin. At this point, using <code>~p</code> will force ppp to start sending the configuration information.</p></div><div class=paragraph><p>If a login prompt never appears, PAP or CHAP authentication is most likely required. To use PAP or CHAP, add the following options to PPP before going into terminal mode:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>ppp ON example&gt; <span class=nb>set </span>authname myusername</code></pre></div></div><div class=paragraph><p>Where <em>myusername</em> should be replaced with the username that was assigned by the ISP.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>ppp ON example&gt; <span class=nb>set </span>authkey mypassword</code></pre></div></div><div class=paragraph><p>Where <em>mypassword</em> should be replaced with the password that was assigned by the ISP.</p></div><div class=paragraph><p>If a connection is established, but cannot seem to find any domain name, try to <a href="https://man.freebsd.org/cgi/man.cgi?query=ping&amp;sektion=8&amp;format=html">ping(8)</a> an IP address. If there is 100 percent (100%) packet loss, it is likely that a default route was not assigned. Double check that <code>add default HISADDR</code> was set during the connection. If a connection can be made to a remote IP address, it is possible that a resolver address has not been added to <span class=filename>/etc/resolv.conf</span>. This file should look like:</p></div><div class="literalblock programlisting"><div class=content><pre>domain example.com
nameserver x.x.x.x
nameserver y.y.y.y</pre></div></div><div class=paragraph><p>Where <em>x.x.x.x</em> and <em>y.y.y.y</em> should be replaced with the IP address of the ISP’s DNS servers.</p></div><div class=paragraph><p>To configure <a href="https://man.freebsd.org/cgi/man.cgi?query=syslog&amp;sektion=3&amp;format=html">syslog(3)</a> to provide logging for the PPP connection, make sure this line exists in <span class=filename>/etc/syslog.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>!ppp
*.*     /var/log/ppp.log</pre></div></div></div></div><div class=sect2><h3 id=pppoe>27.4. Using PPP over Ethernet (PPPoE)<a class=anchor href=#pppoe></a></h3><div class=paragraph><p>This section describes how to set up PPP over Ethernet (PPPoE).</p></div><div class=paragraph><p>Here is an example of a working <span class=filename>ppp.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>default:
  set log Phase tun command # you can add more detailed logging if you wish
  set ifaddr 10.0.0.1/0 10.0.0.2/0

name_of_service_provider:
  set device PPPoE:xl1 # replace xl1 with your Ethernet device
  set authname YOURLOGINNAME
  set authkey YOURPASSWORD
  set dial
  set login
  add default HISADDR</pre></div></div><div class=paragraph><p>As <code>root</code>, run:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ppp -ddial name_of_service_provider</span></code></pre></div></div><div class=paragraph><p>Add the following to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>ppp_enable=&#34;YES&#34;
ppp_mode=&#34;ddial&#34;
ppp_nat=&#34;YES&#34;	# if you want to enable nat for your local network, otherwise NO
ppp_profile=&#34;name_of_service_provider&#34;</pre></div></div><div class=sect3><h4 id=_using_a_pppoe_service_tag>27.4.1. Using a PPPoE Service Tag<a class=anchor href=#_using_a_pppoe_service_tag></a></h4><div class=paragraph><p>Sometimes it will be necessary to use a service tag to establish the connection. Service tags are used to distinguish between different PPPoE servers attached to a given network.</p></div><div class=paragraph><p>Any required service tag information should be in the documentation provided by the ISP.</p></div><div class=paragraph><p>As a last resort, one could try installing the <a class=package href=https://cgit.freebsd.org/ports/tree/net/rr-pppoe/>net/rr-pppoe</a> package or port. Bear in mind however, this may de-program your modem and render it useless, so think twice before doing it. Simply install the program shipped with the modem. Then, access the <b class=menuref>System</b> menu from the program. The name of the profile should be listed there. It is usually <em>ISP</em>.</p></div><div class=paragraph><p>The profile name (service tag) will be used in the PPPoE configuration entry in <span class=filename>ppp.conf</span> as the provider part for <code>set device</code>. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=ppp&amp;sektion=8&amp;format=html">ppp(8)</a> for full details. It should look like this:</p></div><div class="literalblock programlisting"><div class=content><pre>set device PPPoE:xl1:ISP</pre></div></div><div class=paragraph><p>Do not forget to change <em>xl1</em> to the proper device for the Ethernet card.</p></div><div class=paragraph><p>Do not forget to change <em>ISP</em> to the profile.</p></div><div class=paragraph><p>For additional information, refer to <a href=http://renaud.waldura.com/doc/freebsd/pppoe/>Cheaper Broadband with FreeBSD on DSL</a> by Renaud Waldura.</p></div></div><div class=sect3><h4 id=ppp-3com>27.4.2. PPPoE with a 3Com® HomeConnect™ ADSL Modem Dual Link<a class=anchor href=#ppp-3com></a></h4><div class=paragraph><p>This modem does not follow the PPPoE specification defined in <a href=http://www.faqs.org/rfcs/rfc2516.html>RFC 2516</a>.</p></div><div class=paragraph><p>In order to make FreeBSD capable of communicating with this device, a sysctl must be set. This can be done automatically at boot time by updating <span class=filename>/etc/sysctl.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>net.graph.nonstandard_pppoe=1</pre></div></div><div class=paragraph><p>or can be done immediately with the command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sysctl net.graph.nonstandard_pppoe=1</span></code></pre></div></div><div class=paragraph><p>Unfortunately, because this is a system-wide setting, it is not possible to talk to a normal PPPoE client or server and a 3Com® HomeConnect™ ADSL Modem at the same time.</p></div></div></div><div class=sect2><h3 id=pppoa>27.5. Using PPP over ATM (PPPoA)<a class=anchor href=#pppoa></a></h3><div class=paragraph><p>The following describes how to set up PPP over ATM (PPPoA). PPPoA is a popular choice among European DSL providers.</p></div><div class=sect3><h4 id=_using_mpd>27.5.1. Using mpd<a class=anchor href=#_using_mpd></a></h4><div class=paragraph><p>The mpd application can be used to connect to a variety of services, in particular PPTP services. It can be installed using the <a class=package href=https://cgit.freebsd.org/ports/tree/net/mpd5/>net/mpd5</a> package or port. Many ADSL modems require that a PPTP tunnel is created between the modem and computer.</p></div><div class=paragraph><p>Once installed, configure mpd to suit the provider’s settings. The port places a set of sample configuration files which are well documented in <span class=filename>/usr/local/etc/mpd/</span>. A complete guide to configure mpd is available in HTML format in <span class=filename>/usr/ports/shared/doc/mpd/</span>. Here is a sample configuration for connecting to an ADSL service with mpd. The configuration is spread over two files, first the <span class=filename>mpd.conf</span>:</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>This example <span class=filename>mpd.conf</span> only works with mpd 4.x.</p></div></td></tr></tbody></table></div><div class="literalblock programlisting"><div class=content><pre>default:
    load adsl

adsl:
    new -i ng0 adsl adsl
    set bundle authname username <i class=conum data-value=1></i><b>(1)</b>
    set bundle password password <i class=conum data-value=2></i><b>(2)</b>
    set bundle disable multilink

    set link no pap acfcomp protocomp
    set link disable chap
    set link accept chap
    set link keep-alive 30 10

    set ipcp no vjcomp
    set ipcp ranges 0.0.0.0/0 0.0.0.0/0

    set iface route default
    set iface disable on-demand
    set iface enable proxy-arp
    set iface idle 0

    open</pre></div></div><div class="colist arabic"><table><tbody><tr><td><i class=conum data-value=1></i><b>1</b></td><td>The username used to authenticate with your ISP.</td></tr><tr><td><i class=conum data-value=2></i><b>2</b></td><td>The password used to authenticate with your ISP.</td></tr></tbody></table></div><div class=paragraph><p>Information about the link, or links, to establish is found in <span class=filename>mpd.links</span>. An example <span class=filename>mpd.links</span> to accompany the above example is given beneath:</p></div><div class="literalblock programlisting"><div class=content><pre>adsl:
    set link type pptp
    set pptp mode active
    set pptp enable originate outcall
    set pptp self 10.0.0.1 <i class=conum data-value=1></i><b>(1)</b>
    set pptp peer 10.0.0.138 <i class=conum data-value=2></i><b>(2)</b></pre></div></div><div class="colist arabic"><table><tbody><tr><td><i class=conum data-value=1></i><b>1</b></td><td>The IP address of FreeBSD computer running mpd.</td></tr><tr><td><i class=conum data-value=2></i><b>2</b></td><td>The IP address of the ADSL modem. The Alcatel SpeedTouch™ Home defaults to <code>10.0.0.138</code>.</td></tr></tbody></table></div><div class=paragraph><p>It is possible to initialize the connection easily by issuing the following command as <code>root</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mpd -b adsl</span></code></pre></div></div><div class=paragraph><p>To view the status of the connection:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% ifconfig ng0
ng0: <span class=nv>flags</span><span class=o>=</span>88d1&lt;UP,POINTOPOINT,RUNNING,NOARP,SIMPLEX,MULTICAST&gt; mtu 1500
     inet 216.136.204.117 <span class=nt>--</span><span class=o>&gt;</span> 204.152.186.171 netmask 0xffffffff</code></pre></div></div><div class=paragraph><p>Using mpd is the recommended way to connect to an ADSL service with FreeBSD.</p></div></div><div class=sect3><h4 id=_using_pptpclient>27.5.2. Using pptpclient<a class=anchor href=#_using_pptpclient></a></h4><div class=paragraph><p>It is also possible to use FreeBSD to connect to other PPPoA services using <a class=package href=https://cgit.freebsd.org/ports/tree/net/pptpclient/>net/pptpclient</a>.</p></div><div class=paragraph><p>To use <a class=package href=https://cgit.freebsd.org/ports/tree/net/pptpclient/>net/pptpclient</a> to connect to a DSL service, install the port or package, then edit <span class=filename>/etc/ppp/ppp.conf</span>. An example section of <span class=filename>ppp.conf</span> is given below. For further information on <span class=filename>ppp.conf</span> options consult <a href="https://man.freebsd.org/cgi/man.cgi?query=ppp&amp;sektion=8&amp;format=html">ppp(8)</a>.</p></div><div class="literalblock programlisting"><div class=content><pre>adsl:
 set log phase chat lcp ipcp ccp tun command
 set timeout 0
 enable dns
 set authname username <i class=conum data-value=1></i><b>(1)</b>
 set authkey password <i class=conum data-value=2></i><b>(2)</b>
 set ifaddr 0 0
 add default HISADDR</pre></div></div><div class="colist arabic"><table><tbody><tr><td><i class=conum data-value=1></i><b>1</b></td><td>The username for the DSL provider.</td></tr><tr><td><i class=conum data-value=2></i><b>2</b></td><td>The password for your account.</td></tr></tbody></table></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>Since the account’s password is added to <span class=filename>ppp.conf</span> in plain text form, make sure nobody can read the contents of this file:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># chown root:wheel /etc/ppp/ppp.conf</span>
<span class=c># chmod 600 /etc/ppp/ppp.conf</span></code></pre></div></div></td></tr></tbody></table></div><div class=paragraph><p>This will open a tunnel for a PPP session to the DSL router. Ethernet DSL modems have a preconfigured LAN IP address to connect to. In the case of the Alcatel SpeedTouch™ Home, this address is <code>10.0.0.138</code>. The router’s documentation should list the address the device uses. To open the tunnel and start a PPP session:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pptp address adsl</span></code></pre></div></div><div class="admonitionblock tip"><table><tbody><tr><td class=icon><i class="fa icon-tip" title=Tip></i></td><td class=content><div class=paragraph><p>If an ampersand ("&") is added to the end of this command, pptp will return the prompt.</p></div></td></tr></tbody></table></div><div class=paragraph><p>A <span class=filename>tun</span> virtual tunnel device will be created for interaction between the pptp and ppp processes. Once the prompt is returned, or the pptp process has confirmed a connection, examine the tunnel:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% ifconfig tun0
tun0: <span class=nv>flags</span><span class=o>=</span>8051&lt;UP,POINTOPOINT,RUNNING,MULTICAST&gt; mtu 1500
        inet 216.136.204.21 <span class=nt>--</span><span class=o>&gt;</span> 204.152.186.171 netmask 0xffffff00
	Opened by PID 918</code></pre></div></div><div class=paragraph><p>If the connection fails, check the configuration of the router, which is usually accessible using a web browser. Also, examine the output of <code>pptp</code> and the contents of the log file, <span class=filename>/var/log/ppp.log</span> for clues.</p></div></div></div></div></div><div class=sect1><h2 id=mail>Rozdział 28. Electronic Mail<a class=anchor href=#mail></a></h2><div class=sectionbody><div class=sect2><h3 id=mail-synopsis>28.1. Synopsis<a class=anchor href=#mail-synopsis></a></h3><div class=paragraph><p>"Electronic Mail", better known as email, is one of the most widely used forms of communication today. This chapter provides a basic introduction to running a mail server on FreeBSD, as well as an introduction to sending and receiving email using FreeBSD. For more complete coverage of this subject, refer to the books listed in <a href=./#bibliography>Bibliography</a>.</p></div><div class=paragraph><p>After reading this chapter, you will know:</p></div><div class=ulist><ul><li><p>Which software components are involved in sending and receiving electronic mail.</p></li><li><p>Where basic Sendmail configuration files are located in FreeBSD.</p></li><li><p>The difference between remote and local mailboxes.</p></li><li><p>How to block spammers from illegally using a mail server as a relay.</p></li><li><p>How to install and configure an alternate Mail Transfer Agent, replacing Sendmail.</p></li><li><p>How to troubleshoot common mail server problems.</p></li><li><p>How to set up the system to send mail only.</p></li><li><p>How to use mail with a dialup connection.</p></li><li><p>How to configure SMTP authentication for added security.</p></li><li><p>How to install and use a Mail User Agent, such as mutt, to send and receive email.</p></li><li><p>How to download mail from a remote POP or IMAP server.</p></li><li><p>How to automatically apply filters and rules to incoming email.</p></li></ul></div><div class=paragraph><p>Before reading this chapter, you should:</p></div><div class=ulist><ul><li><p>Properly set up a network connection (<a href=./#advanced-networking>Advanced Networking</a>).</p></li><li><p>Properly set up the DNS information for a mail host (<a href=./#network-servers>Network Servers</a>).</p></li><li><p>Know how to install additional third-party software (<a href=./#ports>Installing Applications: Packages and Ports</a>).</p></li></ul></div></div><div class=sect2><h3 id=mail-using>28.2. Mail Components<a class=anchor href=#mail-using></a></h3><div class=paragraph><p>There are five major parts involved in an email exchange: the Mail User Agent (MUA), the Mail Transfer Agent (MTA), a mail host, a remote or local mailbox, and DNS. This section provides an overview of these components.</p></div><div class=dlist><dl><dt class=hdlist1>Mail User Agent (MUA)</dt><dd><p>The Mail User Agent (MUA) is an application which is used to compose, send, and receive emails. This application can be a command line program, such as the built-in <code>mail</code> utility or a third-party application from the Ports Collection, such as mutt, alpine, or elm. Dozens of graphical programs are also available in the Ports Collection, including Claws Mail, Evolution, and Thunderbird. Some organizations provide a web mail program which can be accessed through a web browser. More information about installing and using a MUA on FreeBSD can be found in <a href=#mail-agents>Mail User Agents</a>.</p></dd><dt class=hdlist1>Mail Transfer Agent (MTA)</dt><dd><p>The Mail Transfer Agent (MTA) is responsible for receiving incoming mail and delivering outgoing mail. FreeBSD ships with Sendmail as the default MTA, but it also supports numerous other mail server daemons, including Exim, Postfix, and qmail. Sendmail configuration is described in <a href=#sendmail>Sendmail Configuration Files</a>. If another MTA is installed using the Ports Collection, refer to its post-installation message for FreeBSD-specific configuration details and the application’s website for more general configuration instructions.</p></dd><dt class=hdlist1>Mail Host and Mailboxes</dt><dd><p>The mail host is a server that is responsible for delivering and receiving mail for a host or a network. The mail host collects all mail sent to the domain and stores it either in the default <span class=filename>mbox</span> or the alternative Maildir format, depending on the configuration. Once mail has been stored, it may either be read locally using a MUA or remotely accessed and collected using protocols such as POP or IMAP. If mail is read locally, a POP or IMAP server does not need to be installed.</p><div class=paragraph><p>To access mailboxes remotely, a POP or IMAP server is required as these protocols allow users to connect to their mailboxes from remote locations. IMAP offers several advantages over POP. These include the ability to store a copy of messages on a remote server after they are downloaded and concurrent updates. IMAP can be useful over low-speed links as it allows users to fetch the structure of messages without downloading them. It can also perform tasks such as searching on the server in order to minimize data transfer between clients and servers.</p></div><div class=paragraph><p>Several POP and IMAP servers are available in the Ports Collection. These include <a class=package href=https://cgit.freebsd.org/ports/tree/mail/qpopper/>mail/qpopper</a>, <a class=package href=https://cgit.freebsd.org/ports/tree/mail/imap-uw/>mail/imap-uw</a>, <a class=package href=https://cgit.freebsd.org/ports/tree/mail/courier-imap/>mail/courier-imap</a>, and <a class=package href=https://cgit.freebsd.org/ports/tree/mail/dovecot2/>mail/dovecot2</a>.</p></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>It should be noted that both POP and IMAP transmit information, including username and password credentials, in clear-text. To secure the transmission of information across these protocols, consider tunneling sessions over <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;format=html">ssh(1)</a> (<a href=./#security-ssh-tunneling>SSH Tunneling</a>) or using SSL (<a href=./#openssl>OpenSSL</a>).</p></div></td></tr></tbody></table></div></dd><dt class=hdlist1>Domain Name System (DNS)</dt><dd><p>The Domain Name System (DNS) and its daemon <code>named</code> play a large role in the delivery of email. In order to deliver mail from one site to another, the MTA will look up the remote site in DNS to determine which host will receive mail for the destination. This process also occurs when mail is sent from a remote host to the MTA.</p><div class=paragraph><p>In addition to mapping hostnames to IP addresses, DNS is responsible for storing information specific to mail delivery, known as Mail eXchanger MX records. The MX record specifies which hosts will receive mail for a particular domain.</p></div><div class=paragraph><p>To view the MX records for a domain, specify the type of record. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=host&amp;sektion=1&amp;format=html">host(1)</a>, for more details about this command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% host <span class=nt>-t</span> mx FreeBSD.org
FreeBSD.org mail is handled by 10 mx1.FreeBSD.org</code></pre></div></div><div class=paragraph><p>Refer to <a href=./#network-dns>Domain Name System (DNS)</a> for more information about DNS and its configuration.</p></div></dd></dl></div></div><div class=sect2><h3 id=sendmail>28.3. Sendmail Configuration Files<a class=anchor href=#sendmail></a></h3><div class=paragraph><p>Sendmail is the default MTA installed with FreeBSD. It accepts mail from MUAs and delivers it to the appropriate mail host, as defined by its configuration. Sendmail can also accept network connections and deliver mail to local mailboxes or to another program.</p></div><div class=paragraph><p>The configuration files for Sendmail are located in <span class=filename>/etc/mail</span>. This section describes these files in more detail.</p></div><div class=dlist><dl><dt class=hdlist1><span class=filename>/etc/mail/access</span></dt><dd><p>This access database file defines which hosts or IP addresses have access to the local mail server and what kind of access they have. Hosts listed as <code>OK</code>, which is the default option, are allowed to send mail to this host as long as the mail’s final destination is the local machine. Hosts listed as <code>REJECT</code> are rejected for all mail connections. Hosts listed as <code>RELAY</code> are allowed to send mail for any destination using this mail server. Hosts listed as <code>ERROR</code> will have their mail returned with the specified mail error. If a host is listed as <code>SKIP</code>, Sendmail will abort the current search for this entry without accepting or rejecting the mail. Hosts listed as <code>QUARANTINE</code> will have their messages held and will receive the specified text as the reason for the hold.</p><div class=paragraph><p>Examples of using these options for both IPv4 and IPv6 addresses can be found in the FreeBSD sample configuration, <span class=filename>/etc/mail/access.sample</span>:</p></div><div class="literalblock programlisting"><div class=content><pre># $FreeBSD$
#
# Mail relay access control list.  Default is to reject mail unless the
# destination is local, or listed in /etc/mail/local-host-names
#
## Examples (commented out for safety)
#From:cyberspammer.com          ERROR:&#34;550 We don&#39;t accept mail from spammers&#34;
#From:okay.cyberspammer.com     OK
#Connect:sendmail.org           RELAY
#To:sendmail.org                RELAY
#Connect:128.32                 RELAY
#Connect:128.32.2               SKIP
#Connect:IPv6:1:2:3:4:5:6:7     RELAY
#Connect:suspicious.example.com QUARANTINE:Mail from suspicious host
#Connect:[127.0.0.3]            OK
#Connect:[IPv6:1:2:3:4:5:6:7:8] OK</pre></div></div><div class=paragraph><p>To configure the access database, use the format shown in the sample to make entries in <span class=filename>/etc/mail/access</span>, but do not put a comment symbol (<code>#</code>) in front of the entries. Create an entry for each host or network whose access should be configured. Mail senders that match the left side of the table are affected by the action on the right side of the table.</p></div><div class=paragraph><p>Whenever this file is updated, update its database and restart Sendmail:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># makemap hash /etc/mail/access &lt; /etc/mail/access</span>
<span class=c># service sendmail restart</span></code></pre></div></div></dd><dt class=hdlist1><span class=filename>/etc/mail/aliases</span></dt><dd><p>This database file contains a list of virtual mailboxes that are expanded to users, files, programs, or other aliases. Here are a few entries to illustrate the file format:</p><div class="literalblock programlisting"><div class=content><pre>root: localuser
ftp-bugs: joe,eric,paul
bit.bucket:  /dev/null
procmail: &#34;|/usr/local/bin/procmail&#34;</pre></div></div><div class=paragraph><p>The mailbox name on the left side of the colon is expanded to the target(s) on the right. The first entry expands the <code>root</code> mailbox to the <code>localuser</code> mailbox, which is then looked up in the <span class=filename>/etc/mail/aliases</span> database. If no match is found, the message is delivered to <code>localuser</code>. The second entry shows a mail list. Mail to <code>ftp-bugs</code> is expanded to the three local mailboxes <code>joe</code>, <code>eric</code>, and <code>paul</code>. A remote mailbox could be specified as <em>user@example.com</em>. The third entry shows how to write mail to a file, in this case <span class=filename>/dev/null</span>. The last entry demonstrates how to send mail to a program, <span class=filename>/usr/local/bin/procmail</span>, through a UNIX® pipe. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=aliases&amp;sektion=5&amp;format=html">aliases(5)</a> for more information about the format of this file.</p></div><div class=paragraph><p>Whenever this file is updated, run <code>newaliases</code> to update and initialize the aliases database.</p></div></dd><dt class=hdlist1><span class=filename>/etc/mail/sendmail.cf</span></dt><dd><p>This is the master configuration file for Sendmail. It controls the overall behavior of Sendmail, including everything from rewriting email addresses to printing rejection messages to remote mail servers. Accordingly, this configuration file is quite complex. Fortunately, this file rarely needs to be changed for standard mail servers.</p><div class=paragraph><p>The master Sendmail configuration file can be built from <a href="https://man.freebsd.org/cgi/man.cgi?query=m4&amp;sektion=1&amp;format=html">m4(1)</a> macros that define the features and behavior of Sendmail. Refer to <span class=filename>/usr/src/contrib/sendmail/cf/README</span> for some of the details.</p></div><div class=paragraph><p>Whenever changes to this file are made, Sendmail needs to be restarted for the changes to take effect.</p></div></dd><dt class=hdlist1><span class=filename>/etc/mail/virtusertable</span></dt><dd><p>This database file maps mail addresses for virtual domains and users to real mailboxes. These mailboxes can be local, remote, aliases defined in <span class=filename>/etc/mail/aliases</span>, or files. This allows multiple virtual domains to be hosted on one machine.</p><div class=paragraph><p>FreeBSD provides a sample configuration file in <span class=filename>/etc/mail/virtusertable.sample</span> to further demonstrate its format. The following example demonstrates how to create custom entries using that format:</p></div><div class="literalblock programlisting"><div class=content><pre>root@example.com                root
postmaster@example.com          postmaster@noc.example.net
@example.com                    joe</pre></div></div><div class=paragraph><p>This file is processed in a first match order. When an email address matches the address on the left, it is mapped to the local mailbox listed on the right. The format of the first entry in this example maps a specific email address to a local mailbox, whereas the format of the second entry maps a specific email address to a remote mailbox. Finally, any email address from <code>example.com</code> which has not matched any of the previous entries will match the last mapping and be sent to the local mailbox <code>joe</code>. When creating custom entries, use this format and add them to <span class=filename>/etc/mail/virtusertable</span>. Whenever this file is edited, update its database and restart Sendmail:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># makemap hash /etc/mail/virtusertable &lt; /etc/mail/virtusertable</span>
<span class=c># service sendmail restart</span></code></pre></div></div></dd><dt class=hdlist1><span class=filename>/etc/mail/relay-domains</span></dt><dd><p>In a default FreeBSD installation, Sendmail is configured to only send mail from the host it is running on. For example, if a POP server is available, users will be able to check mail from remote locations but they will not be able to send outgoing emails from outside locations. Typically, a few moments after the attempt, an email will be sent from <code>MAILER-DAEMON</code> with a <code>5.7 Relaying Denied</code> message.</p><div class=paragraph><p>The most straightforward solution is to add the ISP’s FQDN to <span class=filename>/etc/mail/relay-domains</span>. If multiple addresses are needed, add them one per line:</p></div><div class="literalblock programlisting"><div class=content><pre>your.isp.example.com
other.isp.example.net
users-isp.example.org
www.example.org</pre></div></div><div class=paragraph><p>After creating or editing this file, restart Sendmail with <code>service sendmail restart</code>.</p></div><div class=paragraph><p>Now any mail sent through the system by any host in this list, provided the user has an account on the system, will succeed. This allows users to send mail from the system remotely without opening the system up to relaying SPAM from the Internet.</p></div></dd></dl></div></div><div class=sect2><h3 id=mail-changingmta>28.4. Changing the Mail Transfer Agent<a class=anchor href=#mail-changingmta></a></h3><div class=paragraph><p>FreeBSD comes with Sendmail already installed as the MTA which is in charge of outgoing and incoming mail. However, the system administrator can change the system’s MTA. A wide choice of alternative MTAs is available from the <code>mail</code> category of the FreeBSD Ports Collection.</p></div><div class=paragraph><p>Once a new MTA is installed, configure and test the new software before replacing Sendmail. Refer to the documentation of the new MTA for information on how to configure the software.</p></div><div class=paragraph><p>Once the new MTA is working, use the instructions in this section to disable Sendmail and configure FreeBSD to use the replacement MTA.</p></div><div class=sect3><h4 id=mail-disable-sendmail>28.4.1. Disable Sendmail<a class=anchor href=#mail-disable-sendmail></a></h4><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>If Sendmail’s outgoing mail service is disabled, it is important that it is replaced with an alternative mail delivery system. Otherwise, system functions such as <a href="https://man.freebsd.org/cgi/man.cgi?query=periodic&amp;sektion=8&amp;format=html">periodic(8)</a> will be unable to deliver their results by email. Many parts of the system expect a functional MTA. If applications continue to use Sendmail’s binaries to try to send email after they are disabled, mail could go into an inactive Sendmail queue and never be delivered.</p></div></td></tr></tbody></table></div><div class=paragraph><p>In order to completely disable Sendmail, add or edit the following lines in <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>sendmail_enable=&#34;NO&#34;
sendmail_submit_enable=&#34;NO&#34;
sendmail_outbound_enable=&#34;NO&#34;
sendmail_msp_queue_enable=&#34;NO&#34;</pre></div></div><div class=paragraph><p>To only disable Sendmail’s incoming mail service, use only this entry in <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>sendmail_enable=&#34;NO&#34;</pre></div></div><div class=paragraph><p>More information on Sendmail’s startup options is available in <a href="https://man.freebsd.org/cgi/man.cgi?query=rc.sendmail&amp;sektion=8&amp;format=html">rc.sendmail(8)</a>.</p></div></div><div class=sect3><h4 id=_replace_the_default_mta>28.4.2. Replace the Default MTA<a class=anchor href=#_replace_the_default_mta></a></h4><div class=paragraph><p>When a new MTA is installed using the Ports Collection, its startup script is also installed and startup instructions are mentioned in its package message. Before starting the new MTA, stop the running Sendmail processes. This example stops all of these services, then starts the Postfix service:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service sendmail stop</span>
<span class=c># service postfix start</span></code></pre></div></div><div class=paragraph><p>To start the replacement MTA at system boot, add its configuration line to <span class=filename>/etc/rc.conf</span>. This entry enables the Postfix MTA:</p></div><div class="literalblock programlisting"><div class=content><pre>postfix_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>Some extra configuration is needed as Sendmail is so ubiquitous that some software assumes it is already installed and configured. Check <span class=filename>/etc/periodic.conf</span> and make sure that these values are set to <code>NO</code>. If this file does not exist, create it with these entries:</p></div><div class="literalblock programlisting"><div class=content><pre>daily_clean_hoststat_enable=&#34;NO&#34;
daily_status_mail_rejects_enable=&#34;NO&#34;
daily_status_include_submit_mailq=&#34;NO&#34;
daily_submit_queuerun=&#34;NO&#34;</pre></div></div><div class=paragraph><p>Some alternative MTAs provide their own compatible implementations of the Sendmail command-line interface in order to facilitate using them as drop-in replacements for Sendmail. However, some MUAs may try to execute standard Sendmail binaries instead of the new MTA’s binaries. FreeBSD uses <span class=filename>/etc/mail/mailer.conf</span> to map the expected Sendmail binaries to the location of the new binaries. More information about this mapping can be found in <a href="https://man.freebsd.org/cgi/man.cgi?query=mailwrapper&amp;sektion=8&amp;format=html">mailwrapper(8)</a>.</p></div><div class=paragraph><p>The default <span class=filename>/etc/mail/mailer.conf</span> looks like this:</p></div><div class="literalblock programlisting"><div class=content><pre># $FreeBSD$
#
# Execute the &#34;real&#34; sendmail program, named /usr/libexec/sendmail/sendmail
#
sendmail        /usr/libexec/sendmail/sendmail
send-mail       /usr/libexec/sendmail/sendmail
mailq           /usr/libexec/sendmail/sendmail
newaliases      /usr/libexec/sendmail/sendmail
hoststat        /usr/libexec/sendmail/sendmail
purgestat       /usr/libexec/sendmail/sendmail</pre></div></div><div class=paragraph><p>When any of the commands listed on the left are run, the system actually executes the associated command shown on the right. This system makes it easy to change what binaries are executed when these default binaries are invoked.</p></div><div class=paragraph><p>Some MTAs, when installed using the Ports Collection, will prompt to update this file for the new binaries. For example, Postfix will update the file like this:</p></div><div class="literalblock programlisting"><div class=content><pre>#
# Execute the Postfix sendmail program, named /usr/local/sbin/sendmail
#
sendmail        /usr/local/sbin/sendmail
send-mail       /usr/local/sbin/sendmail
mailq           /usr/local/sbin/sendmail
newaliases      /usr/local/sbin/sendmail</pre></div></div><div class=paragraph><p>If the installation of the MTA does not automatically update <span class=filename>/etc/mail/mailer.conf</span>, edit this file in a text editor so that it points to the new binaries. This example points to the binaries installed by <a class=package href=https://cgit.freebsd.org/ports/tree/mail/ssmtp/>mail/ssmtp</a>:</p></div><div class="literalblock programlisting"><div class=content><pre>sendmail        /usr/local/sbin/ssmtp
send-mail       /usr/local/sbin/ssmtp
mailq           /usr/local/sbin/ssmtp
newaliases      /usr/local/sbin/ssmtp
hoststat        /usr/bin/true
purgestat       /usr/bin/true</pre></div></div><div class=paragraph><p>Once everything is configured, it is recommended to reboot the system. Rebooting provides the opportunity to ensure that the system is correctly configured to start the new MTA automatically on boot.</p></div></div></div><div class=sect2><h3 id=mail-trouble>28.5. Troubleshooting<a class=anchor href=#mail-trouble></a></h3><div class=sect3><h4 id=_why_do_i_have_to_use_the_fqdn_for_hosts_on_my_site>28.5.1. Why do I have to use the FQDN for hosts on my site?<a class=anchor href=#_why_do_i_have_to_use_the_fqdn_for_hosts_on_my_site></a></h4><div class=paragraph><p>The host may actually be in a different domain. For example, in order for a host in <code>foo.bar.edu</code> to reach a host called <code>mumble</code> in the <code>bar.edu</code> domain, refer to it by the Fully-Qualified Domain Name FQDN, <code>mumble.bar.edu</code>, instead of just <code>mumble</code>.</p></div><div class=paragraph><p>This is because the version of BIND which ships with FreeBSD no longer provides default abbreviations for non-FQDNs other than the local domain. An unqualified host such as <code>mumble</code> must either be found as <code>mumble.foo.bar.edu</code>, or it will be searched for in the root domain.</p></div><div class=paragraph><p>In older versions of BIND, the search continued across <code>mumble.bar.edu</code>, and <code>mumble.edu</code>. RFC 1535 details why this is considered bad practice or even a security hole.</p></div><div class=paragraph><p>As a good workaround, place the line:</p></div><div class="literalblock programlisting"><div class=content><pre>search foo.bar.edu bar.edu</pre></div></div><div class=paragraph><p>instead of the previous:</p></div><div class="literalblock programlisting"><div class=content><pre>domain foo.bar.edu</pre></div></div><div class=paragraph><p>into <span class=filename>/etc/resolv.conf</span>. However, make sure that the search order does not go beyond the "boundary between local and public administration", as RFC 1535 calls it.</p></div></div><div class=sect3><h4 id=_how_can_i_run_a_mail_server_on_a_dial_up_ppp_host>28.5.2. How can I run a mail server on a dial-up PPP host?<a class=anchor href=#_how_can_i_run_a_mail_server_on_a_dial_up_ppp_host></a></h4><div class=paragraph><p>Connect to a FreeBSD mail gateway on the LAN. The PPP connection is non-dedicated.</p></div><div class=paragraph><p>One way to do this is to get a full-time Internet server to provide secondary MX services for the domain. In this example, the domain is <code>example.com</code> and the ISP has configured <code>example.net</code> to provide secondary MX services to the domain:</p></div><div class="literalblock programlisting"><div class=content><pre>example.com.          MX        10      example.com.
                      MX        20      example.net.</pre></div></div><div class=paragraph><p>Only one host should be specified as the final recipient. For Sendmail, add <code>Cw example.com</code> in <span class=filename>/etc/mail/sendmail.cf</span> on <code>example.com</code>.</p></div><div class=paragraph><p>When the sending MTA attempts to deliver mail, it will try to connect to the system, <code>example.com</code>, over the PPP link. This will time out if the destination is offline. The MTA will automatically deliver it to the secondary MX site at the Internet Service Provider (ISP), <code>example.net</code>. The secondary MX site will periodically try to connect to the primary MX host, <code>example.com</code>.</p></div><div class=paragraph><p>Use something like this as a login script:</p></div><div class="literalblock programlisting"><div class=content><pre>#!/bin/sh
# Put me in /usr/local/bin/pppmyisp
( sleep 60 ; /usr/sbin/sendmail -q ) &amp;
/usr/sbin/ppp -direct pppmyisp</pre></div></div><div class=paragraph><p>When creating a separate login script for users, instead use <code>sendmail -qRexample.com</code> in the script above. This will force all mail in the queue for <code>example.com</code> to be processed immediately.</p></div><div class=paragraph><p>A further refinement of the situation can be seen from this example from the <a href=https://lists.FreeBSD.org/subscription/freebsd-isp>FreeBSD Internet service provider’s mailing list</a>:</p></div><div class="literalblock programlisting"><div class=content><pre>&gt; we provide the secondary MX for a customer. The customer connects to
&gt; our services several times a day automatically to get the mails to
&gt; his primary MX (We do not call his site when a mail for his domains
&gt; arrived). Our sendmail sends the mailqueue every 30 minutes. At the
&gt; moment he has to stay 30 minutes online to be sure that all mail is
&gt; gone to the primary MX.
&gt;
&gt; Is there a command that would initiate sendmail to send all the mails
&gt; now? The user has not root-privileges on our machine of course.

In the privacy flags section of sendmail.cf, there is a
definition Opgoaway,restrictqrun

Remove restrictqrun to allow non-root users to start the queue processing.
You might also like to rearrange the MXs. We are the 1st MX for our
customers like this, and we have defined:

# If we are the best MX for a host, try directly instead of generating
# local config error.
OwTrue

That way a remote site will deliver straight to you, without trying
the customer connection.  You then send to your customer.  Only works for
hosts, so you need to get your customer to name their mail
machine customer.com as well as
hostname.customer.com in the DNS.  Just put an A record in
the DNS for customer.com.</pre></div></div></div></div><div class=sect2><h3 id=mail-advanced>28.6. Advanced Topics<a class=anchor href=#mail-advanced></a></h3><div class=paragraph><p>This section covers more involved topics such as mail configuration and setting up mail for an entire domain.</p></div><div class=sect3><h4 id=mail-config>28.6.1. Basic Configuration<a class=anchor href=#mail-config></a></h4><div class=paragraph><p>Out of the box, one can send email to external hosts as long as <span class=filename>/etc/resolv.conf</span> is configured or the network has access to a configured DNS server. To have email delivered to the MTA on the FreeBSD host, do one of the following:</p></div><div class=ulist><ul><li><p>Run a DNS server for the domain.</p></li><li><p>Get mail delivered directly to the FQDN for the machine.</p></li></ul></div><div class=paragraph><p>In order to have mail delivered directly to a host, it must have a permanent static IP address, not a dynamic IP address. If the system is behind a firewall, it must be configured to allow SMTP traffic. To receive mail directly at a host, one of these two must be configured:</p></div><div class=ulist><ul><li><p>Make sure that the lowest-numbered MX record in DNS points to the host’s static IP address.</p></li><li><p>Make sure there is no MX entry in the DNS for the host.</p></li></ul></div><div class=paragraph><p>Either of the above will allow mail to be received directly at the host.</p></div><div class=paragraph><p>Try this:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># hostname</span>
example.FreeBSD.org
<span class=c># host example.FreeBSD.org</span>
example.FreeBSD.org has address 204.216.27.XX</code></pre></div></div><div class=paragraph><p>In this example, mail sent directly to <a href=mailto:yourlogin@example.FreeBSD.org>yourlogin@example.FreeBSD.org</a> should work without problems, assuming Sendmail is running correctly on <code>example.FreeBSD.org</code>.</p></div><div class=paragraph><p>For this example:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># host example.FreeBSD.org</span>
example.FreeBSD.org has address 204.216.27.XX
example.FreeBSD.org mail is handled <span class=o>(</span><span class=nv>pri</span><span class=o>=</span>10<span class=o>)</span> by nevdull.FreeBSD.org</code></pre></div></div><div class=paragraph><p>All mail sent to <code>example.FreeBSD.org</code> will be collected on <code>hub</code> under the same username instead of being sent directly to your host.</p></div><div class=paragraph><p>The above information is handled by the DNS server. The DNS record that carries mail routing information is the MX entry. If no MX record exists, mail will be delivered directly to the host by way of its IP address.</p></div><div class=paragraph><p>The MX entry for <code>freefall.FreeBSD.org</code> at one time looked like this:</p></div><div class="literalblock programlisting"><div class=content><pre>freefall		MX	30	mail.crl.net
freefall		MX	40	agora.rdrop.com
freefall		MX	10	freefall.FreeBSD.org
freefall		MX	20	who.cdrom.com</pre></div></div><div class=paragraph><p><code>freefall</code> had many MX entries. The lowest MX number is the host that receives mail directly, if available. If it is not accessible for some reason, the next lower-numbered host will accept messages temporarily, and pass it along when a lower-numbered host becomes available.</p></div><div class=paragraph><p>Alternate MX sites should have separate Internet connections in order to be most useful. Your ISP can provide this service.</p></div></div><div class=sect3><h4 id=mail-domain>28.6.2. Mail for a Domain<a class=anchor href=#mail-domain></a></h4><div class=paragraph><p>When configuring a MTA for a network, any mail sent to hosts in its domain should be diverted to the MTA so that users can receive their mail on the master mail server.</p></div><div class=paragraph><p>To make life easiest, a user account with the same <em>username</em> should exist on both the MTA and the system with the MUA. Use <a href="https://man.freebsd.org/cgi/man.cgi?query=adduser&amp;sektion=8&amp;format=html">adduser(8)</a> to create the user accounts.</p></div><div class=paragraph><p>The MTA must be the designated mail exchanger for each workstation on the network. This is done in theDNS configuration with an MX record:</p></div><div class="literalblock programlisting"><div class=content><pre>example.FreeBSD.org	A	204.216.27.XX		; Workstation
			MX	10 nevdull.FreeBSD.org	; Mailhost</pre></div></div><div class=paragraph><p>This will redirect mail for the workstation to the MTA no matter where the A record points. The mail is sent to the MX host.</p></div><div class=paragraph><p>This must be configured on a DNS server. If the network does not run its own DNS server, talk to the ISP or DNS provider.</p></div><div class=paragraph><p>The following is an example of virtual email hosting. Consider a customer with the domain <code>customer1.org</code>, where all the mail for <code>customer1.org</code> should be sent to <code>mail.myhost.com</code>. The DNS entry should look like this:</p></div><div class="literalblock programlisting"><div class=content><pre>customer1.org		MX	10	mail.myhost.com</pre></div></div><div class=paragraph><p>An <code>A</code>> record is <em>not</em> needed for <code>customer1.org</code> in order to only handle email for that domain. However, running <code>ping</code> against <code>customer1.org</code> will not work unless an <code>A</code> record exists for it.</p></div><div class=paragraph><p>Tell the MTA which domains and/or hostnames it should accept mail for. Either of the following will work for Sendmail:</p></div><div class=ulist><ul><li><p>Add the hosts to <span class=filename>/etc/mail/local-host-names</span> when using the <code>FEATURE(use_cw_file)</code>.</p></li><li><p>Add a <code>Cwyour.host.com</code> line to <span class=filename>/etc/sendmail.cf</span>.</p></li></ul></div></div></div><div class=sect2><h3 id=outgoing-only>28.7. Setting Up to Send Only<a class=anchor href=#outgoing-only></a></h3><div class=paragraph><p>There are many instances where one may only want to send mail through a relay. Some examples are:</p></div><div class=ulist><ul><li><p>The computer is a desktop machine that needs to use programs such as <a href="https://man.freebsd.org/cgi/man.cgi?query=mail&amp;sektion=1&amp;format=html">mail(1)</a>, using the ISP’s mail relay.</p></li><li><p>The computer is a server that does not handle mail locally, but needs to pass off all mail to a relay for processing.</p></li></ul></div><div class=paragraph><p>While any MTA is capable of filling this particular niche, it can be difficult to properly configure a full-featured MTA just to handle offloading mail. Programs such as Sendmail and Postfix are overkill for this use.</p></div><div class=paragraph><p>Additionally, a typical Internet access service agreement may forbid one from running a "mail server".</p></div><div class=paragraph><p>The easiest way to fulfill those needs is to install the <a class=package href=https://cgit.freebsd.org/ports/tree/mail/ssmtp/>mail/ssmtp</a> port:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/ports/mail/ssmtp</span>
<span class=c># make install replace clean</span></code></pre></div></div><div class=paragraph><p>Once installed, <a class=package href=https://cgit.freebsd.org/ports/tree/mail/ssmtp/>mail/ssmtp</a> can be configured with <span class=filename>/usr/local/etc/ssmtp/ssmtp.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>root=yourrealemail@example.com
mailhub=mail.example.com
rewriteDomain=example.com
hostname=_HOSTNAME_</pre></div></div><div class=paragraph><p>Use the real email address for <code>root</code>. Enter the ISP’s outgoing mail relay in place of <code>mail.example.com</code>. Some ISPs call this the "outgoing mail server" or "SMTP server".</p></div><div class=paragraph><p>Make sure to disable Sendmail, including the outgoing mail service. See <a href=#mail-disable-sendmail>Disable Sendmail</a> for details.</p></div><div class=paragraph><p><a class=package href=https://cgit.freebsd.org/ports/tree/mail/ssmtp/>mail/ssmtp</a> has some other options available. Refer to the examples in <span class=filename>/usr/local/etc/ssmtp</span> or the manual page of ssmtp for more information.</p></div><div class=paragraph><p>Setting up ssmtp in this manner allows any software on the computer that needs to send mail to function properly, while not violating the ISP’s usage policy or allowing the computer to be hijacked for spamming.</p></div></div><div class=sect2><h3 id=SMTP-dialup>28.8. Using Mail with a Dialup Connection<a class=anchor href=#SMTP-dialup></a></h3><div class=paragraph><p>When using a static IP address, one should not need to adjust the default configuration. Set the hostname to the assigned Internet name and Sendmail will do the rest.</p></div><div class=paragraph><p>When using a dynamically assigned IP address and a dialup PPP connection to the Internet, one usually has a mailbox on the ISP’s mail server. In this example, the ISP’s domain is <code>example.net</code>, the user name is <code>user</code>, the hostname is <code>bsd.home</code>, and the ISP has allowed <code>relay.example.net</code> as a mail relay.</p></div><div class=paragraph><p>In order to retrieve mail from the ISP’s mailbox, install a retrieval agent from the Ports Collection. <a class=package href=https://cgit.freebsd.org/ports/tree/mail/fetchmail/>mail/fetchmail</a> is a good choice as it supports many different protocols. Usually, the ISP will provide POP. When using user PPP, email can be automatically fetched when an Internet connection is established with the following entry in <span class=filename>/etc/ppp/ppp.linkup</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>MYADDR:
!bg su user -c fetchmail</pre></div></div><div class=paragraph><p>When using Sendmail to deliver mail to non-local accounts, configure Sendmail to process the mail queue as soon as the Internet connection is established. To do this, add this line after the above <code>fetchmail</code> entry in <span class=filename>/etc/ppp/ppp.linkup</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>  !bg su user -c &#34;sendmail -q&#34;</pre></div></div><div class=paragraph><p>In this example, there is an account for <code>user</code> on <code>bsd.home</code>. In the home directory of <code>user</code> on <code>bsd.home</code>, create a <span class=filename>.fetchmailrc</span> which contains this line:</p></div><div class="literalblock programlisting"><div class=content><pre>poll example.net protocol pop3 fetchall pass MySecret</pre></div></div><div class=paragraph><p>This file should not be readable by anyone except <code>user</code> as it contains the password <code>MySecret</code>.</p></div><div class=paragraph><p>In order to send mail with the correct <code>from:</code> header, configure Sendmail to use <a href=mailto:user@example.net>user@example.net</a> rather than <a href=mailto:user@bsd.home>user@bsd.home</a> and to send all mail via <code>relay.example.net</code>, allowing quicker mail transmission.</p></div><div class=paragraph><p>The following <span class=filename>.mc</span> should suffice:</p></div><div class="literalblock programlisting"><div class=content><pre>VERSIONID(`bsd.home.mc version 1.0&#39;)
OSTYPE(bsd4.4)dnl
FEATURE(nouucp)dnl
MAILER(local)dnl
MAILER(smtp)dnl
Cwlocalhost
Cwbsd.home
MASQUERADE_AS(`example.net&#39;)dnl
FEATURE(allmasquerade)dnl
FEATURE(masquerade_envelope)dnl
FEATURE(nocanonify)dnl
FEATURE(nodns)dnl
define(`SMART_HOST&#39;, `relay.example.net&#39;)
Dmbsd.home
define(`confDOMAIN_NAME&#39;,`bsd.home&#39;)dnl
define(`confDELIVERY_MODE&#39;,`deferred&#39;)dnl</pre></div></div><div class=paragraph><p>Refer to the previous section for details of how to convert this file into the <span class=filename>sendmail.cf</span> format. Do not forget to restart Sendmail after updating <span class=filename>sendmail.cf</span>.</p></div></div><div class=sect2><h3 id=SMTP-Auth>28.9. SMTP Authentication<a class=anchor href=#SMTP-Auth></a></h3><div class=paragraph><p>Configuring SMTP authentication on the MTA provides a number of benefits. SMTP authentication adds a layer of security to Sendmail, and provides mobile users who switch hosts the ability to use the same MTA without the need to reconfigure their mail client’s settings each time.</p></div><div class="olist arabic procedure"><ol class=arabic><li><p>Install <a class=package href=https://cgit.freebsd.org/ports/tree/security/cyrus-sasl2/>security/cyrus-sasl2</a> from the Ports Collection. This port supports a number of compile-time options. For the SMTP authentication method demonstrated in this example, make sure that <code>LOGIN</code> is not disabled.</p></li><li><p>After installing <a class=package href=https://cgit.freebsd.org/ports/tree/security/cyrus-sasl2/>security/cyrus-sasl2</a>, edit <span class=filename>/usr/local/lib/sasl2/Sendmail.conf</span>, or create it if it does not exist, and add the following line:</p><div class="literalblock programlisting"><div class=content><pre>pwcheck_method: saslauthd</pre></div></div></li><li><p>Next, install <a class=package href=https://cgit.freebsd.org/ports/tree/security/cyrus-sasl2-saslauthd/>security/cyrus-sasl2-saslauthd</a> and add the following line to <span class=filename>/etc/rc.conf</span>:</p><div class="literalblock programlisting"><div class=content><pre>saslauthd_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>Finally, start the saslauthd daemon:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service saslauthd start</span></code></pre></div></div><div class=paragraph><p>This daemon serves as a broker for Sendmail to authenticate against the FreeBSD <a href="https://man.freebsd.org/cgi/man.cgi?query=passwd&amp;sektion=5&amp;format=html">passwd(5)</a> database. This saves the trouble of creating a new set of usernames and passwords for each user that needs to use SMTP authentication, and keeps the login and mail password the same.</p></div></li><li><p>Next, edit <span class=filename>/etc/make.conf</span> and add the following lines:</p><div class="literalblock programlisting"><div class=content><pre>SENDMAIL_CFLAGS=-I/usr/local/include/sasl -DSASL
SENDMAIL_LDADD=/usr/local/lib/libsasl2.so</pre></div></div><div class=paragraph><p>These lines provide Sendmail the proper configuration options for linking to <a class=package href=https://cgit.freebsd.org/ports/tree/cyrus-sasl2/>cyrus-sasl2</a> at compile time. Make sure that <a class=package href=https://cgit.freebsd.org/ports/tree/cyrus-sasl2/>cyrus-sasl2</a> has been installed before recompiling Sendmail.</p></div></li><li><p>Recompile Sendmail by executing the following commands:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/src/lib/libsmutil</span>
<span class=c># make cleandir &amp;&amp; make obj &amp;&amp; make</span>
<span class=c># cd /usr/src/lib/libsm</span>
<span class=c># make cleandir &amp;&amp; make obj &amp;&amp; make</span>
<span class=c># cd /usr/src/usr.sbin/sendmail</span>
<span class=c># make cleandir &amp;&amp; make obj &amp;&amp; make &amp;&amp; make install</span></code></pre></div></div><div class=paragraph><p>This compile should not have any problems if <span class=filename>/usr/src</span> has not changed extensively and the shared libraries it needs are available.</p></div></li><li><p>After Sendmail has been compiled and reinstalled, edit <span class=filename>/etc/mail/freebsd.mc</span> or the local <span class=filename>.mc</span>. Many administrators choose to use the output from <a href="https://man.freebsd.org/cgi/man.cgi?query=hostname&amp;sektion=1&amp;format=html">hostname(1)</a> as the name of <span class=filename>.mc</span> for uniqueness. Add these lines:</p><div class="literalblock programlisting"><div class=content><pre>dnl set SASL options
TRUST_AUTH_MECH(`GSSAPI DIGEST-MD5 CRAM-MD5 LOGIN&#39;)dnl
define(`confAUTH_MECHANISMS&#39;, `GSSAPI DIGEST-MD5 CRAM-MD5 LOGIN&#39;)dnl</pre></div></div><div class=paragraph><p>These options configure the different methods available to Sendmail for authenticating users. To use a method other than pwcheck, refer to the Sendmail documentation.</p></div></li><li><p>Finally, run <a href="https://man.freebsd.org/cgi/man.cgi?query=make&amp;sektion=1&amp;format=html">make(1)</a> while in <span class=filename>/etc/mail</span>. That will run the new <span class=filename>.mc</span> and create a <span class=filename>.cf</span> named either <span class=filename>freebsd.cf</span> or the name used for the local <span class=filename>.mc</span>. Then, run <code>make install restart</code>, which will copy the file to <span class=filename>sendmail.cf</span>, and properly restart Sendmail. For more information about this process, refer to <span class=filename>/etc/mail/Makefile</span>.</p></li></ol></div><div class=paragraph><p>To test the configuration, use a MUA to send a test message. For further investigation, set the <code>LogLevel</code> of Sendmail to <code>13</code> and watch <span class=filename>/var/log/maillog</span> for any errors.</p></div><div class=paragraph><p>For more information, refer to <a href=http://www.sendmail.org/~ca/email/auth.html>SMTP authentication</a>.</p></div></div><div class=sect2><h3 id=mail-agents>28.10. Mail User Agents<a class=anchor href=#mail-agents></a></h3><div class=paragraph><p>A MUA is an application that is used to send and receive email. As email "evolves" and becomes more complex, MUAs are becoming increasingly powerful and provide users increased functionality and flexibility. The <code>mail</code> category of the FreeBSD Ports Collection contains numerous MUAs. These include graphical email clients such as Evolution or Balsa and console based clients such as mutt or alpine.</p></div><div class=sect3><h4 id=mail-command>28.10.1. <code>mail</code><a class=anchor href=#mail-command></a></h4><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=mail&amp;sektion=1&amp;format=html">mail(1)</a> is the default MUA installed with FreeBSD. It is a console based MUA that offers the basic functionality required to send and receive text-based email. It provides limited attachment support and can only access local mailboxes.</p></div><div class=paragraph><p>Although <code>mail</code> does not natively support interaction with POP or IMAP servers, these mailboxes may be downloaded to a local <span class=filename>mbox</span> using an application such as fetchmail.</p></div><div class=paragraph><p>In order to send and receive email, run <code>mail</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% mail</code></pre></div></div><div class=paragraph><p>The contents of the user’s mailbox in <span class=filename>/var/mail</span> are automatically read by <code>mail</code>. Should the mailbox be empty, the utility exits with a message indicating that no mail could be found. If mail exists, the application interface starts, and a list of messages will be displayed. Messages are automatically numbered, as can be seen in the following example:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>Mail version 8.1 6/6/93.  Type ? <span class=k>for </span>help.
<span class=s2>&#34;/var/mail/marcs&#34;</span>: 3 messages 3 new
<span class=o>&gt;</span>N  1 root@localhost        Mon Mar  8 14:05  14/510   <span class=s2>&#34;test&#34;</span>
 N  2 root@localhost        Mon Mar  8 14:05  14/509   <span class=s2>&#34;user account&#34;</span>
 N  3 root@localhost        Mon Mar  8 14:05  14/509   <span class=s2>&#34;sample&#34;</span></code></pre></div></div><div class=paragraph><p>Messages can now be read by typing <kbd>t</kbd> followed by the message number. This example reads the first email:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>&amp; t 1
Message 1:
From root@localhost  Mon Mar  8 14:05:52 2004
X-Original-To: marcs@localhost
Delivered-To: marcs@localhost
To: marcs@localhost
Subject: <span class=nb>test
</span>Date: Mon,  8 Mar 2004 14:05:52 +0200 <span class=o>(</span>SAST<span class=o>)</span>
From: root@localhost <span class=o>(</span>Charlie Root<span class=o>)</span>

This is a <span class=nb>test </span>message, please reply <span class=k>if </span>you receive it.</code></pre></div></div><div class=paragraph><p>As seen in this example, the message will be displayed with full headers. To display the list of messages again, press <kbd>h</kbd>.</p></div><div class=paragraph><p>If the email requires a reply, press either <kbd>R</kbd> or <kbd>r</kbd> <code>mail</code> keys. <kbd>R</kbd> instructs <code>mail</code> to reply only to the sender of the email, while <kbd>r</kbd> replies to all other recipients of the message. These commands can be suffixed with the mail number of the message to reply to. After typing the response, the end of the message should be marked by a single <kbd>.</kbd> on its own line. An example can be seen below:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>&amp; R 1
To: root@localhost
Subject: Re: <span class=nb>test

</span>Thank you, I did get your email.
<span class=nb>.</span>
EOT</code></pre></div></div><div class=paragraph><p>In order to send a new email, press <kbd>m</kbd>, followed by the recipient email address. Multiple recipients may be specified by separating each address with the <kbd>,</kbd> delimiter. The subject of the message may then be entered, followed by the message contents. The end of the message should be specified by putting a single <kbd>.</kbd> on its own line.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>&amp; mail root@localhost
Subject: I mastered mail

Now I can send and receive email using mail ... :<span class=o>)</span>
<span class=nb>.</span>
EOT</code></pre></div></div><div class=paragraph><p>While using <code>mail</code>, press <kbd>?</kbd> to display help at any time. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=mail&amp;sektion=1&amp;format=html">mail(1)</a> for more help on how to use <code>mail</code>.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=mail&amp;sektion=1&amp;format=html">mail(1)</a> was not designed to handle attachments and thus deals with them poorly. Newer MUAs handle attachments in a more intelligent way. Users who prefer to use <code>mail</code> may find the <a class=package href=https://cgit.freebsd.org/ports/tree/converters/mpack/>converters/mpack</a> port to be of considerable use.</p></div></td></tr></tbody></table></div></div><div class=sect3><h4 id=mutt-command>28.10.2. mutt<a class=anchor href=#mutt-command></a></h4><div class=paragraph><p>mutt is a powerful MUA, with many features, including:</p></div><div class=ulist><ul><li><p>The ability to thread messages.</p></li><li><p>PGP support for digital signing and encryption of email.</p></li><li><p>MIME support.</p></li><li><p>Maildir support.</p></li><li><p>Highly customizable.</p></li></ul></div><div class=paragraph><p>Refer to <a href=http://www.mutt.org>http://www.mutt.org</a> for more information on mutt.</p></div><div class=paragraph><p>mutt may be installed using the <a class=package href=https://cgit.freebsd.org/ports/tree/mail/mutt/>mail/mutt</a> port. After the port has been installed, mutt can be started by issuing the following command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% mutt</code></pre></div></div><div class=paragraph><p>mutt will automatically read and display the contents of the user mailbox in <span class=filename>/var/mail</span>. If no mails are found, mutt will wait for commands from the user. The example below shows mutt displaying a list of messages:</p></div><div class=imageblock><div class=content><img src=../../../../images/books/handbook/mail/mutt1.png alt=mutt1></div></div><div class=paragraph><p>To read an email, select it using the cursor keys and press <kbd>Enter</kbd>. An example of mutt displaying email can be seen below:</p></div><div class=imageblock><div class=content><img src=../../../../images/books/handbook/mail/mutt2.png alt=mutt2></div></div><div class=paragraph><p>Similar to <a href="https://man.freebsd.org/cgi/man.cgi?query=mail&amp;sektion=1&amp;format=html">mail(1)</a>, mutt can be used to reply only to the sender of the message as well as to all recipients. To reply only to the sender of the email, press <kbd>r</kbd>. To send a group reply to the original sender as well as all the message recipients, press <kbd>g</kbd>.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>By default, mutt uses the <a href="https://man.freebsd.org/cgi/man.cgi?query=vi&amp;sektion=1&amp;format=html">vi(1)</a> editor for creating and replying to emails. Each user can customize this by creating or editing the <span class=filename>.muttrc</span> in their home directory and setting the <code>editor</code> variable or by setting the <code>EDITOR</code> environment variable. Refer to <a href=http://www.mutt.org/>http://www.mutt.org/</a> for more information about configuring mutt.</p></div></td></tr></tbody></table></div><div class=paragraph><p>To compose a new mail message, press <kbd>m</kbd>. After a valid subject has been given, mutt will start <a href="https://man.freebsd.org/cgi/man.cgi?query=vi&amp;sektion=1&amp;format=html">vi(1)</a> so the email can be written. Once the contents of the email are complete, save and quit from <code>vi</code>. mutt will resume, displaying a summary screen of the mail that is to be delivered. In order to send the mail, press <kbd>y</kbd>. An example of the summary screen can be seen below:</p></div><div class=imageblock><div class=content><img src=../../../../images/books/handbook/mail/mutt3.png alt=mutt3></div></div><div class=paragraph><p>mutt contains extensive help which can be accessed from most of the menus by pressing <kbd>?</kbd>. The top line also displays the keyboard shortcuts where appropriate.</p></div></div><div class=sect3><h4 id=alpine-command>28.10.3. alpine<a class=anchor href=#alpine-command></a></h4><div class=paragraph><p>alpine is aimed at a beginner user, but also includes some advanced features.</p></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>alpine has had several remote vulnerabilities discovered in the past, which allowed remote attackers to execute arbitrary code as users on the local system, by the action of sending a specially-prepared email. While <em>known</em> problems have been fixed, alpine code is written in an insecure style and the FreeBSD Security Officer believes there are likely to be other undiscovered vulnerabilities. Users install alpine at their own risk.</p></div></td></tr></tbody></table></div><div class=paragraph><p>The current version of alpine may be installed using the <a class=package href=https://cgit.freebsd.org/ports/tree/mail/alpine/>mail/alpine</a> port. Once the port has installed, alpine can be started by issuing the following command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% alpine</code></pre></div></div><div class=paragraph><p>The first time alpine runs, it displays a greeting page with a brief introduction, as well as a request from the alpine development team to send an anonymous email message allowing them to judge how many users are using their client. To send this anonymous message, press <kbd>Enter</kbd>. Alternatively, press <kbd>E</kbd> to exit the greeting without sending an anonymous message. An example of the greeting page is shown below:</p></div><div class=imageblock><div class=content><img src=../../../../images/books/handbook/mail/pine1.png alt=pine1></div></div><div class=paragraph><p>The main menu is then presented, which can be navigated using the cursor keys. This main menu provides shortcuts for the composing new mails, browsing mail directories, and administering address book entries. Below the main menu, relevant keyboard shortcuts to perform functions specific to the task at hand are shown.</p></div><div class=paragraph><p>The default directory opened by alpine is <span class=filename>inbox</span>. To view the message index, press <kbd>I</kbd>, or select the <span class=guimenuitem>MESSAGE INDEX</span> option shown below:</p></div><div class=imageblock><div class=content><img src=../../../../images/books/handbook/mail/pine2.png alt=pine2></div></div><div class=paragraph><p>The message index shows messages in the current directory and can be navigated by using the cursor keys. Highlighted messages can be read by pressing <kbd>Enter</kbd>.</p></div><div class=imageblock><div class=content><img src=../../../../images/books/handbook/mail/pine3.png alt=pine3></div></div><div class=paragraph><p>In the screenshot below, a sample message is displayed by alpine. Contextual keyboard shortcuts are displayed at the bottom of the screen. An example of one of a shortcut is <kbd>r</kbd>, which tells the MUA to reply to the current message being displayed.</p></div><div class=imageblock><div class=content><img src=../../../../images/books/handbook/mail/pine4.png alt=pine4></div></div><div class=paragraph><p>Replying to an email in alpine is done using the pico editor, which is installed by default with alpine. pico makes it easy to navigate the message and is easier for novice users to use than <a href="https://man.freebsd.org/cgi/man.cgi?query=vi&amp;sektion=1&amp;format=html">vi(1)</a> or <a href="https://man.freebsd.org/cgi/man.cgi?query=mail&amp;sektion=1&amp;format=html">mail(1)</a>. Once the reply is complete, the message can be sent by pressing <span class=keyseq><kbd>Ctrl</kbd>+<kbd>X</kbd></span>. alpine will ask for confirmation before sending the message.</p></div><div class=imageblock><div class=content><img src=../../../../images/books/handbook/mail/pine5.png alt=pine5></div></div><div class=paragraph><p>alpine can be customized using the <span class=guimenuitem>SETUP</span> option from the main menu. Consult <a href=http://www.washington.edu/alpine/>http://www.washington.edu/alpine/</a> for more information.</p></div></div></div><div class=sect2><h3 id=mail-fetchmail>28.11. Using fetchmail<a class=anchor href=#mail-fetchmail></a></h3><div class=paragraph><p>fetchmail is a full-featured IMAP and POP client. It allows users to automatically download mail from remote IMAP and POP servers and save it into local mailboxes where it can be accessed more easily. fetchmail can be installed using the <a class=package href=https://cgit.freebsd.org/ports/tree/mail/fetchmail/>mail/fetchmail</a> port, and offers various features, including:</p></div><div class=ulist><ul><li><p>Support for the POP3, APOP, KPOP, IMAP, ETRN and ODMR protocols.</p></li><li><p>Ability to forward mail using SMTP, which allows filtering, forwarding, and aliasing to function normally.</p></li><li><p>May be run in daemon mode to check periodically for new messages.</p></li><li><p>Can retrieve multiple mailboxes and forward them, based on configuration, to different local users.</p></li></ul></div><div class=paragraph><p>This section explains some of the basic features of fetchmail. This utility requires a <span class=filename>.fetchmailrc</span> configuration in the user’s home directory in order to run correctly. This file includes server information as well as login credentials. Due to the sensitive nature of the contents of this file, it is advisable to make it readable only by the user, with the following command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% <span class=nb>chmod </span>600 .fetchmailrc</code></pre></div></div><div class=paragraph><p>The following <span class=filename>.fetchmailrc</span> serves as an example for downloading a single user mailbox using POP. It tells fetchmail to connect to <code>example.com</code> using a username of <code>joesoap</code> and a password of <code>XXX</code>. This example assumes that the user <code>joesoap</code> exists on the local system.</p></div><div class="literalblock programlisting"><div class=content><pre>poll example.com protocol pop3 username &#34;joesoap&#34; password &#34;XXX&#34;</pre></div></div><div class=paragraph><p>The next example connects to multiple POP and IMAP servers and redirects to different local usernames where applicable:</p></div><div class="literalblock programlisting"><div class=content><pre>poll example.com proto pop3:
user &#34;joesoap&#34;, with password &#34;XXX&#34;, is &#34;jsoap&#34; here;
user &#34;andrea&#34;, with password &#34;XXXX&#34;;
poll example2.net proto imap:
user &#34;john&#34;, with password &#34;XXXXX&#34;, is &#34;myth&#34; here;</pre></div></div><div class=paragraph><p>fetchmail can be run in daemon mode by running it with <code>-d</code>, followed by the interval (in seconds) that fetchmail should poll servers listed in <span class=filename>.fetchmailrc</span>. The following example configures fetchmail to poll every 600 seconds:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% fetchmail <span class=nt>-d</span> 600</code></pre></div></div><div class=paragraph><p>More information on fetchmail can be found at <a href=http://www.fetchmail.info/>http://www.fetchmail.info/</a>.</p></div></div><div class=sect2><h3 id=mail-procmail>28.12. Using procmail<a class=anchor href=#mail-procmail></a></h3><div class=paragraph><p>procmail is a powerful application used to filter incoming mail. It allows users to define "rules" which can be matched to incoming mails to perform specific functions or to reroute mail to alternative mailboxes or email addresses. procmail can be installed using the <a class=package href=https://cgit.freebsd.org/ports/tree/mail/procmail/>mail/procmail</a> port. Once installed, it can be directly integrated into most MTAs. Consult the MTA documentation for more information. Alternatively, procmail can be integrated by adding the following line to a <span class=filename>.forward</span> in the home directory of the user:</p></div><div class="literalblock programlisting"><div class=content><pre>&#34;|exec /usr/local/bin/procmail || exit 75&#34;</pre></div></div><div class=paragraph><p>The following section displays some basic procmail rules, as well as brief descriptions of what they do. Rules must be inserted into a <span class=filename>.procmailrc</span>, which must reside in the user’s home directory.</p></div><div class=paragraph><p>The majority of these rules can be found in <a href="https://man.freebsd.org/cgi/man.cgi?query=procmailex&amp;sektion=5&amp;format=html">procmailex(5)</a>.</p></div><div class=paragraph><p>To forward all mail from <a href=mailto:user@example.com>user@example.com</a> to an external address of <a href=mailto:goodmail@example2.com>goodmail@example2.com</a>:</p></div><div class="literalblock programlisting"><div class=content><pre>:0
* ^From.*user@example.com
! goodmail@example2.com</pre></div></div><div class=paragraph><p>To forward all mails shorter than 1000 bytes to an external address of <a href=mailto:goodmail@example2.com>goodmail@example2.com</a>:</p></div><div class="literalblock programlisting"><div class=content><pre>:0
* &lt; 1000
! goodmail@example2.com</pre></div></div><div class=paragraph><p>To send all mail sent to <a href=mailto:alternate@example.com>alternate@example.com</a> to a mailbox called <span class=filename>alternate</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>:0
* ^TOalternate@example.com
alternate</pre></div></div><div class=paragraph><p>To send all mail with a subject of "Spam" to <span class=filename>/dev/null</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>:0
^Subject:.*Spam
/dev/null</pre></div></div><div class=paragraph><p>A useful recipe that parses incoming <code>FreeBSD.org</code> mailing lists and places each list in its own mailbox:</p></div><div class="literalblock programlisting"><div class=content><pre>:0
* ^Sender:.owner-freebsd-\/[^@]+@FreeBSD.ORG
{
	LISTNAME=${MATCH}
	:0
	* LISTNAME??^\/[^@]+
	FreeBSD-${MATCH}
}</pre></div></div></div></div></div><div class=sect1><h2 id=network-servers>Rozdział 29. Network Servers<a class=anchor href=#network-servers></a></h2><div class=sectionbody><div class=sect2><h3 id=network-servers-synopsis>29.1. Synopsis<a class=anchor href=#network-servers-synopsis></a></h3><div class=paragraph><p>This chapter covers some of the more frequently used network services on UNIX® systems. This includes installing, configuring, testing, and maintaining many different types of network services. Example configuration files are included throughout this chapter for reference.</p></div><div class=paragraph><p>By the end of this chapter, readers will know:</p></div><div class=ulist><ul><li><p>How to manage the inetd daemon.</p></li><li><p>How to set up the Network File System (NFS).</p></li><li><p>How to set up the Network Information Server (NIS) for centralizing and sharing user accounts.</p></li><li><p>How to set FreeBSD up to act as an LDAP server or client</p></li><li><p>How to set up automatic network settings using DHCP.</p></li><li><p>How to set up a Domain Name Server (DNS).</p></li><li><p>How to set up the ApacheHTTP Server.</p></li><li><p>How to set up a File Transfer Protocol (FTP) server.</p></li><li><p>How to set up a file and print server for Windows® clients using Samba.</p></li><li><p>How to synchronize the time and date, and set up a time server using the Network Time Protocol (NTP).</p></li><li><p>How to set up iSCSI.</p></li></ul></div><div class=paragraph><p>This chapter assumes a basic knowledge of:</p></div><div class=ulist><ul><li><p><span class=filename>/etc/rc</span> scripts.</p></li><li><p>Network terminology.</p></li><li><p>Installation of additional third-party software (<a href=./#ports>Installing Applications: Packages and Ports</a>).</p></li></ul></div></div><div class=sect2><h3 id=network-inetd>29.2. The inetd Super-Server<a class=anchor href=#network-inetd></a></h3><div class=paragraph><p>The <a href="https://man.freebsd.org/cgi/man.cgi?query=inetd&amp;sektion=8&amp;format=html">inetd(8)</a> daemon is sometimes referred to as a Super-Server because it manages connections for many services. Instead of starting multiple applications, only the inetd service needs to be started. When a connection is received for a service that is managed by inetd, it determines which program the connection is destined for, spawns a process for that program, and delegates the program a socket. Using inetd for services that are not heavily used can reduce system load, when compared to running each daemon individually in stand-alone mode.</p></div><div class=paragraph><p>Primarily, inetd is used to spawn other daemons, but several trivial protocols are handled internally, such as chargen, auth, time, echo, discard, and daytime.</p></div><div class=paragraph><p>This section covers the basics of configuring inetd.</p></div><div class=sect3><h4 id=network-inetd-conf>29.2.1. Configuration File<a class=anchor href=#network-inetd-conf></a></h4><div class=paragraph><p>Configuration of inetd is done by editing <span class=filename>/etc/inetd.conf</span>. Each line of this configuration file represents an application which can be started by inetd. By default, every line starts with a comment (<code><mark></mark></code>), meaning that inetd is not listening for any applications. To configure inetd to listen for an application’s connections, remove the <code></code> at the beginning of the line for that application.</p></div><div class=paragraph><p>After saving your edits, configure inetd to start at system boot by editing <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>inetd_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>To start inetd now, so that it listens for the service you configured, type:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service inetd start</span></code></pre></div></div><div class=paragraph><p>Once inetd is started, it needs to be notified whenever a modification is made to <span class=filename>/etc/inetd.conf</span>:</p></div><div id=network-inetd-reread class=exampleblock><div class=title>Przykład 26. Reloading the inetd Configuration File</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service inetd reload</span></code></pre></div></div></div></div><div class=paragraph><p>Typically, the default entry for an application does not need to be edited beyond removing the <code>#</code>. In some situations, it may be appropriate to edit the default entry.</p></div><div class=paragraph><p>As an example, this is the default entry for <a href="https://man.freebsd.org/cgi/man.cgi?query=ftpd&amp;sektion=8&amp;format=html">ftpd(8)</a> over IPv4:</p></div><div class="literalblock programlisting"><div class=content><pre>ftp     stream  tcp     nowait  root    /usr/libexec/ftpd       ftpd -l</pre></div></div><div class=paragraph><p>The seven columns in an entry are as follows:</p></div><div class="literalblock programlisting"><div class=content><pre>service-name
socket-type
protocol
{wait|nowait}[/max-child[/max-connections-per-ip-per-minute[/max-child-per-ip]]]
user[:group][/login-class]
server-program
server-program-arguments</pre></div></div><div class=paragraph><p>where:</p></div><div class=dlist><dl><dt class=hdlist1>service-name</dt><dd><p>The service name of the daemon to start. It must correspond to a service listed in <span class=filename>/etc/services</span>. This determines which port inetd listens on for incoming connections to that service. When using a custom service, it must first be added to <span class=filename>/etc/services</span>.</p></dd><dt class=hdlist1>socket-type</dt><dd><p>Either <code>stream</code>, <code>dgram</code>, <code>raw</code>, or <code>seqpacket</code>. Use <code>stream</code> for TCP connections and <code>dgram</code> for UDP services.</p></dd><dt class=hdlist1>protocol</dt><dd><p>Use one of the following protocol names:</p><table class="tableblock frame-none grid-all stretch informaltable"><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">Protocol Name</th><th class="tableblock halign-left valign-top">Explanation</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock>tcp or tcp4</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>TCP IPv4</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>udp or udp4</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>UDP IPv4</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>tcp6</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>TCP IPv6</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>udp6</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>UDP IPv6</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>tcp46</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Both TCP IPv4 and IPv6</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>udp46</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Both UDP IPv4 and IPv6</p></td></tr></tbody></table></dd><dt class=hdlist1>{wait|nowait}[/max-child[/max-connections-per-ip-per-minute[/max-child-per-ip]]]</dt><dd><p>In this field, <code>wait</code> or <code>nowait</code> must be specified. <code>max-child</code>, <code>max-connections-per-ip-per-minute</code> and <code>max-child-per-ip</code> are optional.</p><div class=paragraph><p><code>wait|nowait</code> indicates whether or not the service is able to handle its own socket. <code>dgram</code> socket types must use <code>wait</code> while <code>stream</code> daemons, which are usually multi-threaded, should use <code>nowait</code>. <code>wait</code> usually hands off multiple sockets to a single daemon, while <code>nowait</code> spawns a child daemon for each new socket.</p></div><div class=paragraph><p>The maximum number of child daemons inetd may spawn is set by <code>max-child</code>. For example, to limit ten instances of the daemon, place a <code>/10</code> after <code>nowait</code>. Specifying <code>/0</code> allows an unlimited number of children.</p></div><div class=paragraph><p><code>max-connections-per-ip-per-minute</code> limits the number of connections from any particular IP address per minute. Once the limit is reached, further connections from this IP address will be dropped until the end of the minute. For example, a value of <code>/10</code> would limit any particular IP address to ten connection attempts per minute. <code>max-child-per-ip</code> limits the number of child processes that can be started on behalf on any single IP address at any moment. These options can limit excessive resource consumption and help to prevent Denial of Service attacks.</p></div><div class=paragraph><p>An example can be seen in the default settings for <a href="https://man.freebsd.org/cgi/man.cgi?query=fingerd&amp;sektion=8&amp;format=html">fingerd(8)</a>:</p></div><div class="literalblock programlisting"><div class=content><pre>finger stream  tcp     nowait/3/10 nobody /usr/libexec/fingerd fingerd -k -s</pre></div></div></dd><dt class=hdlist1>user</dt><dd><p>The username the daemon will run as. Daemons typically run as <code>root</code>, <code>daemon</code>, or <code>nobody</code>.</p></dd><dt class=hdlist1>server-program</dt><dd><p>The full path to the daemon. If the daemon is a service provided by inetd internally, use <code>internal</code>.</p></dd><dt class=hdlist1>server-program-arguments</dt><dd><p>Used to specify any command arguments to be passed to the daemon on invocation. If the daemon is an internal service, use <code>internal</code>.</p></dd></dl></div></div><div class=sect3><h4 id=network-inetd-cmdline>29.2.2. Command-Line Options<a class=anchor href=#network-inetd-cmdline></a></h4><div class=paragraph><p>Like most server daemons, inetd has a number of options that can be used to modify its behavior. By default, inetd is started with <code>-wW -C 60</code>. These options enable TCP wrappers for all services, including internal services, and prevent any IP address from requesting any service more than 60 times per minute.</p></div><div class=paragraph><p>To change the default options which are passed to inetd, add an entry for <code>inetd_flags</code> in <span class=filename>/etc/rc.conf</span>. If inetd is already running, restart it with <code>service inetd restart</code>.</p></div><div class=paragraph><p>The available rate limiting options are:</p></div><div class=dlist><dl><dt class=hdlist1>-c maximum</dt><dd><p>Specify the default maximum number of simultaneous invocations of each service, where the default is unlimited. May be overridden on a per-service basis by using <code>max-child</code> in <span class=filename>/etc/inetd.conf</span>.</p></dd><dt class=hdlist1>-C rate</dt><dd><p>Specify the default maximum number of times a service can be invoked from a single IP address per minute. May be overridden on a per-service basis by using <code>max-connections-per-ip-per-minute</code> in <span class=filename>/etc/inetd.conf</span>.</p></dd><dt class=hdlist1>-R rate</dt><dd><p>Specify the maximum number of times a service can be invoked in one minute, where the default is <code>256</code>. A rate of <code>0</code> allows an unlimited number.</p></dd><dt class=hdlist1>-s maximum</dt><dd><p>Specify the maximum number of times a service can be invoked from a single IP address at any one time, where the default is unlimited. May be overridden on a per-service basis by using <code>max-child-per-ip</code> in <span class=filename>/etc/inetd.conf</span>.</p></dd></dl></div><div class=paragraph><p>Additional options are available. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=inetd&amp;sektion=8&amp;format=html">inetd(8)</a> for the full list of options.</p></div></div><div class=sect3><h4 id=network-inetd-security>29.2.3. Security Considerations<a class=anchor href=#network-inetd-security></a></h4><div class=paragraph><p>Many of the daemons which can be managed by inetd are not security-conscious. Some daemons, such as fingerd, can provide information that may be useful to an attacker. Only enable the services which are needed and monitor the system for excessive connection attempts. <code>max-connections-per-ip-per-minute</code>, <code>max-child</code> and <code>max-child-per-ip</code> can be used to limit such attacks.</p></div><div class=paragraph><p>By default, TCP wrappers is enabled. Consult <a href="https://man.freebsd.org/cgi/man.cgi?query=hosts_access&amp;sektion=5&amp;format=html">hosts_access(5)</a> for more information on placing TCP restrictions on various inetd invoked daemons.</p></div></div></div><div class=sect2><h3 id=network-nfs>29.3. Network File System (NFS)<a class=anchor href=#network-nfs></a></h3><div class=paragraph><p>FreeBSD supports the Network File System (NFS), which allows a server to share directories and files with clients over a network. With NFS, users and programs can access files on remote systems as if they were stored locally.</p></div><div class=paragraph><p>NFS has many practical uses. Some of the more common uses include:</p></div><div class=ulist><ul><li><p>Data that would otherwise be duplicated on each client can be kept in a single location and accessed by clients on the network.</p></li><li><p>Several clients may need access to the <span class=filename>/usr/ports/distfiles</span> directory. Sharing that directory allows for quick access to the source files without having to download them to each client.</p></li><li><p>On large networks, it is often more convenient to configure a central NFS server on which all user home directories are stored. Users can log into a client anywhere on the network and have access to their home directories.</p></li><li><p>Administration of NFS exports is simplified. For example, there is only one file system where security or backup policies must be set.</p></li><li><p>Removable media storage devices can be used by other machines on the network. This reduces the number of devices throughout the network and provides a centralized location to manage their security. It is often more convenient to install software on multiple machines from a centralized installation media.</p></li></ul></div><div class=paragraph><p>NFS consists of a server and one or more clients. The client remotely accesses the data that is stored on the server machine. In order for this to function properly, a few processes have to be configured and running.</p></div><div class=paragraph><p>These daemons must be running on the server:</p></div><table class="tableblock frame-none grid-all stretch informaltable"><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">Daemon</th><th class="tableblock halign-left valign-top">Description</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock>nfsd</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>The NFS daemon which services requests from NFS clients.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>mountd</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>The NFS mount daemon which carries out requests received from nfsd.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>rpcbind</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>This daemon allows NFS clients to discover which port the NFS server is using.</p></td></tr></tbody></table><div class=paragraph><p>Running <a href="https://man.freebsd.org/cgi/man.cgi?query=nfsiod&amp;sektion=8&amp;format=html">nfsiod(8)</a> on the client can improve performance, but is not required.</p></div><div class=sect3><h4 id=network-configuring-nfs>29.3.1. Configuring the Server<a class=anchor href=#network-configuring-nfs></a></h4><div class=paragraph><p>The file systems which the NFS server will share are specified in <span class=filename>/etc/exports</span>. Each line in this file specifies a file system to be exported, which clients have access to that file system, and any access options. When adding entries to this file, each exported file system, its properties, and allowed hosts must occur on a single line. If no clients are listed in the entry, then any client on the network can mount that file system.</p></div><div class=paragraph><p>The following <span class=filename>/etc/exports</span> entries demonstrate how to export file systems. The examples can be modified to match the file systems and client names on the reader’s network. There are many options that can be used in this file, but only a few will be mentioned here. See <a href="https://man.freebsd.org/cgi/man.cgi?query=exports&amp;sektion=5&amp;format=html">exports(5)</a> for the full list of options.</p></div><div class=paragraph><p>This example shows how to export <span class=filename>/cdrom</span> to three hosts named <em>alpha</em>, <em>bravo</em>, and <em>charlie</em>:</p></div><div class="literalblock programlisting"><div class=content><pre>/cdrom -ro alpha bravo charlie</pre></div></div><div class=paragraph><p>The <code>-ro</code> flag makes the file system read-only, preventing clients from making any changes to the exported file system. This example assumes that the host names are either in DNS or in <span class=filename>/etc/hosts</span>. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=hosts&amp;sektion=5&amp;format=html">hosts(5)</a> if the network does not have a DNS server.</p></div><div class=paragraph><p>The next example exports <span class=filename>/home</span> to three clients by IP address. This can be useful for networks without DNS or <span class=filename>/etc/hosts</span> entries. The <code>-alldirs</code> flag allows subdirectories to be mount points. In other words, it will not automatically mount the subdirectories, but will permit the client to mount the directories that are required as needed.</p></div><div class="literalblock programlisting"><div class=content><pre>/usr/home  -alldirs  10.0.0.2 10.0.0.3 10.0.0.4</pre></div></div><div class=paragraph><p>This next example exports <span class=filename>/a</span> so that two clients from different domains may access that file system. The <code>-maproot=root</code> allows <code>root</code> on the remote system to write data on the exported file system as <code>root</code>. If <code>-maproot=root</code> is not specified, the client’s <code>root</code> user will be mapped to the server’s <code>nobody</code> account and will be subject to the access limitations defined for <code>nobody</code>.</p></div><div class="literalblock programlisting"><div class=content><pre>/a  -maproot=root  host.example.com box.example.org</pre></div></div><div class=paragraph><p>A client can only be specified once per file system. For example, if <span class=filename>/usr</span> is a single file system, these entries would be invalid as both entries specify the same host:</p></div><div class="literalblock programlisting"><div class=content><pre># Invalid when /usr is one file system
/usr/src   client
/usr/ports client</pre></div></div><div class=paragraph><p>The correct format for this situation is to use one entry:</p></div><div class="literalblock programlisting"><div class=content><pre>/usr/src /usr/ports  client</pre></div></div><div class=paragraph><p>The following is an example of a valid export list, where <span class=filename>/usr</span> and <span class=filename>/exports</span> are local file systems:</p></div><div class="literalblock programlisting"><div class=content><pre># Export src and ports to client01 and client02, but only
# client01 has root privileges on it
/usr/src /usr/ports -maproot=root    client01
/usr/src /usr/ports               client02
# The client machines have root and can mount anywhere
# on /exports. Anyone in the world can mount /exports/obj read-only
/exports -alldirs -maproot=root      client01 client02
/exports/obj -ro</pre></div></div><div class=paragraph><p>To enable the processes required by the NFS server at boot time, add these options to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>rpcbind_enable=&#34;YES&#34;
nfs_server_enable=&#34;YES&#34;
mountd_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>The server can be started now by running this command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service nfsd start</span></code></pre></div></div><div class=paragraph><p>Whenever the NFS server is started, mountd also starts automatically. However, mountd only reads <span class=filename>/etc/exports</span> when it is started. To make subsequent <span class=filename>/etc/exports</span> edits take effect immediately, force mountd to reread it:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service mountd reload</span></code></pre></div></div></div><div class=sect3><h4 id=_configuring_the_client>29.3.2. Configuring the Client<a class=anchor href=#_configuring_the_client></a></h4><div class=paragraph><p>To enable NFS clients, set this option in each client’s <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>nfs_client_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>Then, run this command on each NFS client:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service nfsclient start</span></code></pre></div></div><div class=paragraph><p>The client now has everything it needs to mount a remote file system. In these examples, the server’s name is <code>server</code> and the client’s name is <code>client</code>. To mount <span class=filename>/home</span> on <code>server</code> to the <span class=filename>/mnt</span> mount point on <code>client</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mount server:/home /mnt</span></code></pre></div></div><div class=paragraph><p>The files and directories in <span class=filename>/home</span> will now be available on <code>client</code>, in the <span class=filename>/mnt</span> directory.</p></div><div class=paragraph><p>To mount a remote file system each time the client boots, add it to <span class=filename>/etc/fstab</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>server:/home	/mnt	nfs	rw	0	0</pre></div></div><div class=paragraph><p>Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=fstab&amp;sektion=5&amp;format=html">fstab(5)</a> for a description of all available options.</p></div></div><div class=sect3><h4 id=_locking>29.3.3. Locking<a class=anchor href=#_locking></a></h4><div class=paragraph><p>Some applications require file locking to operate correctly. To enable locking, add these lines to <span class=filename>/etc/rc.conf</span> on both the client and server:</p></div><div class="literalblock programlisting"><div class=content><pre>rpc_lockd_enable=&#34;YES&#34;
rpc_statd_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>Then start the applications:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service lockd start</span>
<span class=c># service statd start</span></code></pre></div></div><div class=paragraph><p>If locking is not required on the server, the NFS client can be configured to lock locally by including <code>-L</code> when running mount. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=mount_nfs&amp;sektion=8&amp;format=html">mount_nfs(8)</a> for further details.</p></div></div><div class=sect3><h4 id=network-autofs>29.3.4. Automating Mounts with <a href="https://man.freebsd.org/cgi/man.cgi?query=autofs&amp;sektion=5&amp;format=html">autofs(5)</a><a class=anchor href=#network-autofs></a></h4><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>The <a href="https://man.freebsd.org/cgi/man.cgi?query=autofs&amp;sektion=5&amp;format=html">autofs(5)</a> automount facility is supported starting with FreeBSD 10.1-RELEASE. To use the automounter functionality in older versions of FreeBSD, use <a href="https://man.freebsd.org/cgi/man.cgi?query=amd&amp;sektion=8&amp;format=html">amd(8)</a> instead. This chapter only describes the <a href="https://man.freebsd.org/cgi/man.cgi?query=autofs&amp;sektion=5&amp;format=html">autofs(5)</a> automounter.</p></div></td></tr></tbody></table></div><div class=paragraph><p>The <a href="https://man.freebsd.org/cgi/man.cgi?query=autofs&amp;sektion=5&amp;format=html">autofs(5)</a> facility is a common name for several components that, together, allow for automatic mounting of remote and local filesystems whenever a file or directory within that file system is accessed. It consists of the kernel component, <a href="https://man.freebsd.org/cgi/man.cgi?query=autofs&amp;sektion=5&amp;format=html">autofs(5)</a>, and several userspace applications: <a href="https://man.freebsd.org/cgi/man.cgi?query=automount&amp;sektion=8&amp;format=html">automount(8)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=automountd&amp;sektion=8&amp;format=html">automountd(8)</a> and <a href="https://man.freebsd.org/cgi/man.cgi?query=autounmountd&amp;sektion=8&amp;format=html">autounmountd(8)</a>. It serves as an alternative for <a href="https://man.freebsd.org/cgi/man.cgi?query=amd&amp;sektion=8&amp;format=html">amd(8)</a> from previous FreeBSD releases. Amd is still provided for backward compatibility purposes, as the two use different map format; the one used by autofs is the same as with other SVR4 automounters, such as the ones in Solaris, MacOS X, and Linux.</p></div><div class=paragraph><p>The <a href="https://man.freebsd.org/cgi/man.cgi?query=autofs&amp;sektion=5&amp;format=html">autofs(5)</a> virtual filesystem is mounted on specified mountpoints by <a href="https://man.freebsd.org/cgi/man.cgi?query=automount&amp;sektion=8&amp;format=html">automount(8)</a>, usually invoked during boot.</p></div><div class=paragraph><p>Whenever a process attempts to access file within the <a href="https://man.freebsd.org/cgi/man.cgi?query=autofs&amp;sektion=5&amp;format=html">autofs(5)</a> mountpoint, the kernel will notify <a href="https://man.freebsd.org/cgi/man.cgi?query=automountd&amp;sektion=8&amp;format=html">automountd(8)</a> daemon and pause the triggering process. The <a href="https://man.freebsd.org/cgi/man.cgi?query=automountd&amp;sektion=8&amp;format=html">automountd(8)</a> daemon will handle kernel requests by finding the proper map and mounting the filesystem according to it, then signal the kernel to release blocked process. The <a href="https://man.freebsd.org/cgi/man.cgi?query=autounmountd&amp;sektion=8&amp;format=html">autounmountd(8)</a> daemon automatically unmounts automounted filesystems after some time, unless they are still being used.</p></div><div class=paragraph><p>The primary autofs configuration file is <span class=filename>/etc/auto_master</span>. It assigns individual maps to top-level mounts. For an explanation of <span class=filename>auto_master</span> and the map syntax, refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=auto_master&amp;sektion=5&amp;format=html">auto_master(5)</a>.</p></div><div class=paragraph><p>There is a special automounter map mounted on <span class=filename>/net</span>. When a file is accessed within this directory, <a href="https://man.freebsd.org/cgi/man.cgi?query=autofs&amp;sektion=5&amp;format=html">autofs(5)</a> looks up the corresponding remote mount and automatically mounts it. For instance, an attempt to access a file within <span class=filename>/net/foobar/usr</span> would tell <a href="https://man.freebsd.org/cgi/man.cgi?query=automountd&amp;sektion=8&amp;format=html">automountd(8)</a> to mount the <span class=filename>/usr</span> export from the host <code>foobar</code>.</p></div><div class=exampleblock><div class=title>Przykład 27. Mounting an Export with <a href="https://man.freebsd.org/cgi/man.cgi?query=autofs&amp;sektion=5&amp;format=html">autofs(5)</a></div><div class=content><div class=paragraph><p>In this example, <code>showmount -e</code> shows the exported file systems that can be mounted from the NFS server, <code>foobar</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% showmount <span class=nt>-e</span> foobar
Exports list on foobar:
/usr                               10.10.10.0
/a                                 10.10.10.0
% <span class=nb>cd</span> /net/foobar/usr</code></pre></div></div></div></div><div class=paragraph><p>The output from <code>showmount</code> shows <span class=filename>/usr</span> as an export. When changing directories to <span class=filename>/host/foobar/usr</span>, <a href="https://man.freebsd.org/cgi/man.cgi?query=automountd&amp;sektion=8&amp;format=html">automountd(8)</a> intercepts the request and attempts to resolve the hostname <code>foobar</code>. If successful, <a href="https://man.freebsd.org/cgi/man.cgi?query=automountd&amp;sektion=8&amp;format=html">automountd(8)</a> automatically mounts the source export.</p></div><div class=paragraph><p>To enable <a href="https://man.freebsd.org/cgi/man.cgi?query=autofs&amp;sektion=5&amp;format=html">autofs(5)</a> at boot time, add this line to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>autofs_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>Then <a href="https://man.freebsd.org/cgi/man.cgi?query=autofs&amp;sektion=5&amp;format=html">autofs(5)</a> can be started by running:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service automount start</span>
<span class=c># service automountd start</span>
<span class=c># service autounmountd start</span></code></pre></div></div><div class=paragraph><p>The <a href="https://man.freebsd.org/cgi/man.cgi?query=autofs&amp;sektion=5&amp;format=html">autofs(5)</a> map format is the same as in other operating systems. Information about this format from other sources can be useful, like the <a href=http://web.archive.org/web/20160813071113/http://images.apple.com/business/docs/Autofs.pdf>Mac OS X document</a>.</p></div><div class=paragraph><p>Consult the <a href="https://man.freebsd.org/cgi/man.cgi?query=automount&amp;sektion=8&amp;format=html">automount(8)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=automountd&amp;sektion=8&amp;format=html">automountd(8)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=autounmountd&amp;sektion=8&amp;format=html">autounmountd(8)</a>, and <a href="https://man.freebsd.org/cgi/man.cgi?query=auto_master&amp;sektion=5&amp;format=html">auto_master(5)</a> manual pages for more information.</p></div></div></div><div class=sect2><h3 id=network-nis>29.4. Network Information System (NIS)<a class=anchor href=#network-nis></a></h3><div class=paragraph><p>Network Information System (NIS) is designed to centralize administration of UNIX®-like systems such as Solaris™, HP-UX, AIX®, Linux, NetBSD, OpenBSD, and FreeBSD. NIS was originally known as Yellow Pages but the name was changed due to trademark issues. This is the reason why NIS commands begin with <code>yp</code>.</p></div><div class=paragraph><p>NIS is a Remote Procedure Call (RPC)-based client/server system that allows a group of machines within an NIS domain to share a common set of configuration files. This permits a system administrator to set up NIS client systems with only minimal configuration data and to add, remove, or modify configuration data from a single location.</p></div><div class=paragraph><p>FreeBSD uses version 2 of the NIS protocol.</p></div><div class=sect3><h4 id=_nis_terms_and_processes>29.4.1. NIS Terms and Processes<a class=anchor href=#_nis_terms_and_processes></a></h4><div class=paragraph><p>Table 28.1 summarizes the terms and important processes used by NIS:</p></div><table class="tableblock frame-none grid-all stretch"><caption class=title>Tabela 24. NIS Terminology</caption><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">Term</th><th class="tableblock halign-left valign-top">Description</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock>NIS domain name</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>NIS servers and clients share an NIS domain name. Typically, this name does not have anything to do with DNS.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href="https://man.freebsd.org/cgi/man.cgi?query=rpcbind&amp;sektion=8&amp;format=html">rpcbind(8)</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>This service enables RPC and must be running in order to run an NIS server or act as an NIS client.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href="https://man.freebsd.org/cgi/man.cgi?query=ypbind&amp;sektion=8&amp;format=html">ypbind(8)</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>This service binds an NIS client to its NIS server. It will take the NIS domain name and use RPC to connect to the server. It is the core of client/server communication in an NIS environment. If this service is not running on a client machine, it will not be able to access the NIS server.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href="https://man.freebsd.org/cgi/man.cgi?query=ypserv&amp;sektion=8&amp;format=html">ypserv(8)</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>This is the process for the NIS server. If this service stops running, the server will no longer be able to respond to NIS requests so hopefully, there is a slave server to take over. Some non-FreeBSD clients will not try to reconnect using a slave server and the ypbind process may need to be restarted on these clients.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href="https://man.freebsd.org/cgi/man.cgi?query=rpc.yppasswdd&amp;sektion=8&amp;format=html">rpc.yppasswdd(8)</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>This process only runs on NIS master servers. This daemon allows NIS clients to change their NIS passwords. If this daemon is not running, users will have to login to the NIS master server and change their passwords there.</p></td></tr></tbody></table></div><div class=sect3><h4 id=_machine_types>29.4.2. Machine Types<a class=anchor href=#_machine_types></a></h4><div class=paragraph><p>There are three types of hosts in an NIS environment:</p></div><div class=ulist><ul><li><p>NIS master server</p><div class=paragraph><p>This server acts as a central repository for host configuration information and maintains the authoritative copy of the files used by all of the NIS clients. The <span class=filename>passwd</span>, <span class=filename>group</span>, and other various files used by NIS clients are stored on the master server. While it is possible for one machine to be an NIS master server for more than one NIS domain, this type of configuration will not be covered in this chapter as it assumes a relatively small-scale NIS environment.</p></div></li><li><p>NIS slave servers</p><div class=paragraph><p>NIS slave servers maintain copies of the NIS master’s data files in order to provide redundancy. Slave servers also help to balance the load of the master server as NIS clients always attach to the NIS server which responds first.</p></div></li><li><p>NIS clients</p><div class=paragraph><p>NIS clients authenticate against the NIS server during log on.</p></div></li></ul></div><div class=paragraph><p>Information in many files can be shared using NIS. The <span class=filename>master.passwd</span>, <span class=filename>group</span>, and <span class=filename>hosts</span> files are commonly shared via NIS. Whenever a process on a client needs information that would normally be found in these files locally, it makes a query to the NIS server that it is bound to instead.</p></div></div><div class=sect3><h4 id=_planning_considerations>29.4.3. Planning Considerations<a class=anchor href=#_planning_considerations></a></h4><div class=paragraph><p>This section describes a sample NIS environment which consists of 15 FreeBSD machines with no centralized point of administration. Each machine has its own <span class=filename>/etc/passwd</span> and <span class=filename>/etc/master.passwd</span>. These files are kept in sync with each other only through manual intervention. Currently, when a user is added to the lab, the process must be repeated on all 15 machines.</p></div><div class=paragraph><p>The configuration of the lab will be as follows:</p></div><table class="tableblock frame-none grid-all stretch informaltable"><col style=width:33.3333%><col style=width:33.3333%><col style=width:33.3334%><thead><tr><th class="tableblock halign-left valign-top">Machine name</th><th class="tableblock halign-left valign-top">IP address</th><th class="tableblock halign-left valign-top">Machine role</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>ellington</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>10.0.0.2</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>NIS master</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>coltrane</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>10.0.0.3</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>NIS slave</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>basie</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>10.0.0.4</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Faculty workstation</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>bird</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>10.0.0.5</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Client machine</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>cli[1-11]</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>10.0.0.[6-17]</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Other client machines</p></td></tr></tbody></table><div class=paragraph><p>If this is the first time an NIS scheme is being developed, it should be thoroughly planned ahead of time. Regardless of network size, several decisions need to be made as part of the planning process.</p></div><div class=sect4><h5 id=_choosing_a_nis_domain_name>29.4.3.1. Choosing a NIS Domain Name<a class=anchor href=#_choosing_a_nis_domain_name></a></h5><div class=paragraph><p>When a client broadcasts its requests for info, it includes the name of the NIS domain that it is part of. This is how multiple servers on one network can tell which server should answer which request. Think of the NIS domain name as the name for a group of hosts.</p></div><div class=paragraph><p>Some organizations choose to use their Internet domain name for their NIS domain name. This is not recommended as it can cause confusion when trying to debug network problems. The NIS domain name should be unique within the network and it is helpful if it describes the group of machines it represents. For example, the Art department at Acme Inc. might be in the "acme-art"NIS domain. This example will use the domain name <code>test-domain</code>.</p></div><div class=paragraph><p>However, some non-FreeBSD operating systems require the NIS domain name to be the same as the Internet domain name. If one or more machines on the network have this restriction, the Internet domain name <em>must</em> be used as the NIS domain name.</p></div></div><div class=sect4><h5 id=_physical_server_requirements>29.4.3.2. Physical Server Requirements<a class=anchor href=#_physical_server_requirements></a></h5><div class=paragraph><p>There are several things to keep in mind when choosing a machine to use as a NIS server. Since NIS clients depend upon the availability of the server, choose a machine that is not rebooted frequently. The NIS server should ideally be a stand alone machine whose sole purpose is to be an NIS server. If the network is not heavily used, it is acceptable to put the NIS server on a machine running other services. However, if the NIS server becomes unavailable, it will adversely affect all NIS clients.</p></div></div></div><div class=sect3><h4 id=_configuring_the_nis_master_server>29.4.4. Configuring the NIS Master Server<a class=anchor href=#_configuring_the_nis_master_server></a></h4><div class=paragraph><p>The canonical copies of all NIS files are stored on the master server. The databases used to store the information are called NIS maps. In FreeBSD, these maps are stored in <span class=filename>/var/yp/[domainname]</span> where <span class=filename>[domainname]</span> is the name of the NIS domain. Since multiple domains are supported, it is possible to have several directories, one for each domain. Each domain will have its own independent set of maps.</p></div><div class=paragraph><p>NIS master and slave servers handle all NIS requests through <a href="https://man.freebsd.org/cgi/man.cgi?query=ypserv&amp;sektion=8&amp;format=html">ypserv(8)</a>. This daemon is responsible for receiving incoming requests from NIS clients, translating the requested domain and map name to a path to the corresponding database file, and transmitting data from the database back to the client.</p></div><div class=paragraph><p>Setting up a master NIS server can be relatively straight forward, depending on environmental needs. Since FreeBSD provides built-in NIS support, it only needs to be enabled by adding the following lines to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>nisdomainname=&#34;test-domain&#34; <i class=conum data-value=1></i><b>(1)</b>
nis_server_enable=&#34;YES&#34;     <i class=conum data-value=2></i><b>(2)</b>
nis_yppasswdd_enable=&#34;YES&#34;  <i class=conum data-value=3></i><b>(3)</b></pre></div></div><div class="colist arabic"><table><tbody><tr><td><i class=conum data-value=1></i><b>1</b></td><td>This line sets the NIS domain name to <code>test-domain</code>.</td></tr><tr><td><i class=conum data-value=2></i><b>2</b></td><td>This automates the start up of the NIS server processes when the system boots.</td></tr><tr><td><i class=conum data-value=3></i><b>3</b></td><td>This enables the <a href="https://man.freebsd.org/cgi/man.cgi?query=rpc.yppasswdd&amp;sektion=8&amp;format=html">rpc.yppasswdd(8)</a> daemon so that users can change their NIS password from a client machine.</td></tr></tbody></table></div><div class=paragraph><p>Care must be taken in a multi-server domain where the server machines are also NIS clients. It is generally a good idea to force the servers to bind to themselves rather than allowing them to broadcast bind requests and possibly become bound to each other. Strange failure modes can result if one server goes down and others are dependent upon it. Eventually, all the clients will time out and attempt to bind to other servers, but the delay involved can be considerable and the failure mode is still present since the servers might bind to each other all over again.</p></div><div class=paragraph><p>A server that is also a client can be forced to bind to a particular server by adding these additional lines to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>nis_client_enable=&#34;YES&#34;                  <i class=conum data-value=1></i><b>(1)</b>
nis_client_flags=&#34;-S test-domain,server&#34; <i class=conum data-value=2></i><b>(2)</b></pre></div></div><div class="colist arabic"><table><tbody><tr><td><i class=conum data-value=1></i><b>1</b></td><td>This enables running client stuff as well.</td></tr><tr><td><i class=conum data-value=2></i><b>2</b></td><td>This line sets the NIS domain name to <code>test-domain</code> and bind to itself.</td></tr></tbody></table></div><div class=paragraph><p>After saving the edits, type <code>/etc/netstart</code> to restart the network and apply the values defined in <span class=filename>/etc/rc.conf</span>. Before initializing the NIS maps, start <a href="https://man.freebsd.org/cgi/man.cgi?query=ypserv&amp;sektion=8&amp;format=html">ypserv(8)</a>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service ypserv start</span></code></pre></div></div><div class=sect4><h5 id=_initializing_the_nis_maps>29.4.4.1. Initializing the NIS Maps<a class=anchor href=#_initializing_the_nis_maps></a></h5><div class=paragraph><p>NIS maps are generated from the configuration files in <span class=filename>/etc</span> on the NIS master, with one exception: <span class=filename>/etc/master.passwd</span>. This is to prevent the propagation of passwords to all the servers in the NIS domain. Therefore, before the NIS maps are initialized, configure the primary password files:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cp /etc/master.passwd /var/yp/master.passwd</span>
<span class=c># cd /var/yp</span>
<span class=c># vi master.passwd</span></code></pre></div></div><div class=paragraph><p>It is advisable to remove all entries for system accounts as well as any user accounts that do not need to be propagated to the NIS clients, such as the <code>root</code> and any other administrative accounts.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Ensure that the <span class=filename>/var/yp/master.passwd</span> is neither group or world readable by setting its permissions to <code>600</code>.</p></div></td></tr></tbody></table></div><div class=paragraph><p>After completing this task, initialize the NIS maps. FreeBSD includes the <a href="https://man.freebsd.org/cgi/man.cgi?query=ypinit&amp;sektion=8&amp;format=html">ypinit(8)</a> script to do this. When generating maps for the master server, include <code>-m</code> and specify the NIS domain name:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>ellington# ypinit <span class=nt>-m</span> test-domain
Server Type: MASTER Domain: test-domain
Creating an YP server will require that you answer a few questions.
Questions will all be asked at the beginning of the procedure.
Do you want this procedure to quit on non-fatal errors? <span class=o>[</span>y/n: n] n
Ok, please remember to go back and redo manually whatever fails.
If not, something might not work.
At this point, we have to construct a list of this domains YP servers.
rod.darktech.org is already known as master server.
Please <span class=k>continue </span>to add any slave servers, one per line. When you are
<span class=k>done </span>with the list, <span class=nb>type </span>a &lt;control D&gt;.
master server   :  ellington
next host to add:  coltrane
next host to add:  ^D
The current list of NIS servers looks like this:
ellington
coltrane
Is this correct?  <span class=o>[</span>y/n: y] y

<span class=o>[</span>..output from map generation..]

NIS Map update completed.
ellington has been setup as an YP master server without any errors.</code></pre></div></div><div class=paragraph><p>This will create <span class=filename>/var/yp/Makefile</span> from <span class=filename>/var/yp/Makefile.dist</span>. By default, this file assumes that the environment has a single NIS server with only FreeBSD clients. Since <code>test-domain</code> has a slave server, edit this line in <span class=filename>/var/yp/Makefile</span> so that it begins with a comment (<code>#</code>):</p></div><div class="literalblock programlisting"><div class=content><pre>NOPUSH = &#34;True&#34;</pre></div></div></div><div class=sect4><h5 id=_adding_new_users>29.4.4.2. Adding New Users<a class=anchor href=#_adding_new_users></a></h5><div class=paragraph><p>Every time a new user is created, the user account must be added to the master NIS server and the NIS maps rebuilt. Until this occurs, the new user will not be able to login anywhere except on the NIS master. For example, to add the new user <code>jsmith</code> to the <code>test-domain</code> domain, run these commands on the master server:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pw useradd jsmith</span>
<span class=c># cd /var/yp</span>
<span class=c># make test-domain</span></code></pre></div></div><div class=paragraph><p>The user could also be added using <code>adduser jsmith</code> instead of <code>pw useradd smith</code>.</p></div></div></div><div class=sect3><h4 id=_setting_up_a_nis_slave_server>29.4.5. Setting up a NIS Slave Server<a class=anchor href=#_setting_up_a_nis_slave_server></a></h4><div class=paragraph><p>To set up an NIS slave server, log on to the slave server and edit <span class=filename>/etc/rc.conf</span> as for the master server. Do not generate any NIS maps, as these already exist on the master server. When running <code>ypinit</code> on the slave server, use <code>-s</code> (for slave) instead of <code>-m</code> (for master). This option requires the name of the NIS master in addition to the domain name, as seen in this example:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>coltrane# ypinit <span class=nt>-s</span> ellington test-domain

Server Type: SLAVE Domain: test-domain Master: ellington

Creating an YP server will require that you answer a few questions.
Questions will all be asked at the beginning of the procedure.

Do you want this procedure to quit on non-fatal errors? <span class=o>[</span>y/n: n]  n

Ok, please remember to go back and redo manually whatever fails.
If not, something might not work.
There will be no further questions. The remainder of the procedure
should take a few minutes, to copy the databases from ellington.
Transferring netgroup...
ypxfr: Exiting: Map successfully transferred
Transferring netgroup.byuser...
ypxfr: Exiting: Map successfully transferred
Transferring netgroup.byhost...
ypxfr: Exiting: Map successfully transferred
Transferring master.passwd.byuid...
ypxfr: Exiting: Map successfully transferred
Transferring passwd.byuid...
ypxfr: Exiting: Map successfully transferred
Transferring passwd.byname...
ypxfr: Exiting: Map successfully transferred
Transferring group.bygid...
ypxfr: Exiting: Map successfully transferred
Transferring group.byname...
ypxfr: Exiting: Map successfully transferred
Transferring services.byname...
ypxfr: Exiting: Map successfully transferred
Transferring rpc.bynumber...
ypxfr: Exiting: Map successfully transferred
Transferring rpc.byname...
ypxfr: Exiting: Map successfully transferred
Transferring protocols.byname...
ypxfr: Exiting: Map successfully transferred
Transferring master.passwd.byname...
ypxfr: Exiting: Map successfully transferred
Transferring networks.byname...
ypxfr: Exiting: Map successfully transferred
Transferring networks.byaddr...
ypxfr: Exiting: Map successfully transferred
Transferring netid.byname...
ypxfr: Exiting: Map successfully transferred
Transferring hosts.byaddr...
ypxfr: Exiting: Map successfully transferred
Transferring protocols.bynumber...
ypxfr: Exiting: Map successfully transferred
Transferring ypservers...
ypxfr: Exiting: Map successfully transferred
Transferring hosts.byname...
ypxfr: Exiting: Map successfully transferred

coltrane has been setup as an YP slave server without any errors.
Remember to update map ypservers on ellington.</code></pre></div></div><div class=paragraph><p>This will generate a directory on the slave server called <span class=filename>/var/yp/test-domain</span> which contains copies of the NIS master server’s maps. Adding these <span class=filename>/etc/crontab</span> entries on each slave server will force the slaves to sync their maps with the maps on the master server:</p></div><div class="literalblock programlisting"><div class=content><pre>20      *       *       *       *       root   /usr/libexec/ypxfr passwd.byname
21      *       *       *       *       root   /usr/libexec/ypxfr passwd.byuid</pre></div></div><div class=paragraph><p>These entries are not mandatory because the master server automatically attempts to push any map changes to its slaves. However, since clients may depend upon the slave server to provide correct password information, it is recommended to force frequent password map updates. This is especially important on busy networks where map updates might not always complete.</p></div><div class=paragraph><p>To finish the configuration, run <code>/etc/netstart</code> on the slave server in order to start the NIS services.</p></div></div><div class=sect3><h4 id=_setting_up_an_nis_client>29.4.6. Setting Up an NIS Client<a class=anchor href=#_setting_up_an_nis_client></a></h4><div class=paragraph><p>An NIS client binds to an NIS server using <a href="https://man.freebsd.org/cgi/man.cgi?query=ypbind&amp;sektion=8&amp;format=html">ypbind(8)</a>. This daemon broadcasts RPC requests on the local network. These requests specify the domain name configured on the client. If an NIS server in the same domain receives one of the broadcasts, it will respond to ypbind, which will record the server’s address. If there are several servers available, the client will use the address of the first server to respond and will direct all of its NIS requests to that server. The client will automatically ping the server on a regular basis to make sure it is still available. If it fails to receive a reply within a reasonable amount of time, ypbind will mark the domain as unbound and begin broadcasting again in the hopes of locating another server.</p></div><div class=paragraph><p>To configure a FreeBSD machine to be an NIS client:</p></div><div class="olist arabic procedure"><ol class=arabic><li><p>Edit <span class=filename>/etc/rc.conf</span> and add the following lines in order to set the NIS domain name and start <a href="https://man.freebsd.org/cgi/man.cgi?query=ypbind&amp;sektion=8&amp;format=html">ypbind(8)</a> during network startup:</p><div class="literalblock programlisting"><div class=content><pre>nisdomainname=&#34;test-domain&#34;
nis_client_enable=&#34;YES&#34;</pre></div></div></li><li><p>To import all possible password entries from the NIS server, use <code>vipw</code> to remove all user accounts except one from <span class=filename>/etc/master.passwd</span>. When removing the accounts, keep in mind that at least one local account should remain and this account should be a member of <code>wheel</code>. If there is a problem with NIS, this local account can be used to log in remotely, become the superuser, and fix the problem. Before saving the edits, add the following line to the end of the file:</p><div class="literalblock programlisting"><div class=content><pre>+:::::::::</pre></div></div><div class=paragraph><p>This line configures the client to provide anyone with a valid account in the NIS server’s password maps an account on the client. There are many ways to configure the NIS client by modifying this line. One method is described in <a href=#network-netgroups>Using Netgroups</a>. For more detailed reading, refer to the book <code>Managing NFS and NIS</code>, published by O’Reilly Media.</p></div></li><li><p>To import all possible group entries from the NIS server, add this line to <span class=filename>/etc/group</span>:</p><div class="literalblock programlisting"><div class=content><pre>+:*::</pre></div></div></li></ol></div><div class=paragraph><p>To start the NIS client immediately, execute the following commands as the superuser:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># /etc/netstart</span>
<span class=c># service ypbind start</span></code></pre></div></div><div class=paragraph><p>After completing these steps, running <code>ypcat passwd</code> on the client should show the server’s <span class=filename>passwd</span> map.</p></div></div><div class=sect3><h4 id=_nis_security>29.4.7. NIS Security<a class=anchor href=#_nis_security></a></h4><div class=paragraph><p>Since RPC is a broadcast-based service, any system running ypbind within the same domain can retrieve the contents of the NIS maps. To prevent unauthorized transactions, <a href="https://man.freebsd.org/cgi/man.cgi?query=ypserv&amp;sektion=8&amp;format=html">ypserv(8)</a> supports a feature called "securenets" which can be used to restrict access to a given set of hosts. By default, this information is stored in <span class=filename>/var/yp/securenets</span>, unless <a href="https://man.freebsd.org/cgi/man.cgi?query=ypserv&amp;sektion=8&amp;format=html">ypserv(8)</a> is started with <code>-p</code> and an alternate path. This file contains entries that consist of a network specification and a network mask separated by white space. Lines starting with <code>#</code> are considered to be comments. A sample <span class=filename>securenets</span> might look like this:</p></div><div class="literalblock programlisting"><div class=content><pre># allow connections from local host -- mandatory
127.0.0.1     255.255.255.255
# allow connections from any host
# on the 192.168.128.0 network
192.168.128.0 255.255.255.0
# allow connections from any host
# between 10.0.0.0 to 10.0.15.255
# this includes the machines in the testlab
10.0.0.0      255.255.240.0</pre></div></div><div class=paragraph><p>If <a href="https://man.freebsd.org/cgi/man.cgi?query=ypserv&amp;sektion=8&amp;format=html">ypserv(8)</a> receives a request from an address that matches one of these rules, it will process the request normally. If the address fails to match a rule, the request will be ignored and a warning message will be logged. If the <span class=filename>securenets</span> does not exist, <code>ypserv</code> will allow connections from any host.</p></div><div class=paragraph><p><a href=./#tcpwrappers>TCP Wrapper</a> is an alternate mechanism for providing access control instead of <span class=filename>securenets</span>. While either access control mechanism adds some security, they are both vulnerable to "IP spoofing" attacks. All NIS-related traffic should be blocked at the firewall.</p></div><div class=paragraph><p>Servers using <span class=filename>securenets</span> may fail to serve legitimate NIS clients with archaic TCP/IP implementations. Some of these implementations set all host bits to zero when doing broadcasts or fail to observe the subnet mask when calculating the broadcast address. While some of these problems can be fixed by changing the client configuration, other problems may force the retirement of these client systems or the abandonment of <span class=filename>securenets</span>.</p></div><div class=paragraph><p>The use of TCP Wrapper increases the latency of the NIS server. The additional delay may be long enough to cause timeouts in client programs, especially in busy networks with slow NIS servers. If one or more clients suffer from latency, convert those clients into NIS slave servers and force them to bind to themselves.</p></div><div class=sect4><h5 id=_barring_some_users>29.4.7.1. Barring Some Users<a class=anchor href=#_barring_some_users></a></h5><div class=paragraph><p>In this example, the <code>basie</code> system is a faculty workstation within the NIS domain. The <span class=filename>passwd</span> map on the master NIS server contains accounts for both faculty and students. This section demonstrates how to allow faculty logins on this system while refusing student logins.</p></div><div class=paragraph><p>To prevent specified users from logging on to a system, even if they are present in the NIS database, use <code>vipw</code> to add <code>-<em>username</em></code> with the correct number of colons towards the end of <span class=filename>/etc/master.passwd</span> on the client, where <em>username</em> is the username of a user to bar from logging in. The line with the blocked user must be before the <code>+</code> line that allows NIS users. In this example, <code>bill</code> is barred from logging on to <code>basie</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>basie# <span class=nb>cat</span> /etc/master.passwd
root:[password]:0:0::0:0:The super-user:/root:/bin/csh
toor:[password]:0:0::0:0:The other super-user:/root:/bin/sh
daemon:<span class=k>*</span>:1:1::0:0:Owner of many system processes:/root:/usr/sbin/nologin
operator:<span class=k>*</span>:2:5::0:0:System &amp;:/:/usr/sbin/nologin
bin:<span class=k>*</span>:3:7::0:0:Binaries Commands and Source,,,:/:/usr/sbin/nologin
<span class=nb>tty</span>:<span class=k>*</span>:4:65533::0:0:Tty Sandbox:/:/usr/sbin/nologin
kmem:<span class=k>*</span>:5:65533::0:0:KMem Sandbox:/:/usr/sbin/nologin
games:<span class=k>*</span>:7:13::0:0:Games pseudo-user:/usr/games:/usr/sbin/nologin
news:<span class=k>*</span>:8:8::0:0:News Subsystem:/:/usr/sbin/nologin
man:<span class=k>*</span>:9:9::0:0:Mister Man Pages:/usr/shared/man:/usr/sbin/nologin
<span class=nb>bind</span>:<span class=k>*</span>:53:53::0:0:Bind Sandbox:/:/usr/sbin/nologin
uucp:<span class=k>*</span>:66:66::0:0:UUCP pseudo-user:/var/spool/uucppublic:/usr/libexec/uucp/uucico
xten:<span class=k>*</span>:67:67::0:0:X-10 daemon:/usr/local/xten:/usr/sbin/nologin
pop:<span class=k>*</span>:68:6::0:0:Post Office Owner:/nonexistent:/usr/sbin/nologin
nobody:<span class=k>*</span>:65534:65534::0:0:Unprivileged user:/nonexistent:/usr/sbin/nologin
<span class=nt>-bill</span>:::::::::
+:::::::::

basie#</code></pre></div></div></div></div><div class=sect3><h4 id=network-netgroups>29.4.8. Using Netgroups<a class=anchor href=#network-netgroups></a></h4><div class=paragraph><p>Barring specified users from logging on to individual systems becomes unscaleable on larger networks and quickly loses the main benefit of NIS: <em>centralized</em> administration.</p></div><div class=paragraph><p>Netgroups were developed to handle large, complex networks with hundreds of users and machines. Their use is comparable to UNIX® groups, where the main difference is the lack of a numeric ID and the ability to define a netgroup by including both user accounts and other netgroups.</p></div><div class=paragraph><p>To expand on the example used in this chapter, the NIS domain will be extended to add the users and systems shown in Tables 28.2 and 28.3:</p></div><table class="tableblock frame-none grid-all stretch"><caption class=title>Tabela 25. Additional Users</caption><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">User Name(s)</th><th class="tableblock halign-left valign-top">Description</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>alpha</code>, <code>beta</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>IT department employees</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>charlie</code>, <code>delta</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>IT department apprentices</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>echo</code>, <code>foxtrott</code>, <code>golf</code>, …​</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>employees</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>able</code>, <code>baker</code>, …​</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>interns</p></td></tr></tbody></table><table class="tableblock frame-none grid-all stretch"><caption class=title>Tabela 26. Additional Systems</caption><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">Machine Name(s)</th><th class="tableblock halign-left valign-top">Description</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>war</code>, <code>death</code>, <code>famine</code>, <code>pollution</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Only IT employees are allowed to log onto these servers.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>pride</code>, <code>greed</code>, <code>envy</code>, <code>wrath</code>, <code>lust</code>, <code>sloth</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>All members of the IT department are allowed to login onto these servers.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>one</code>, <code>two</code>, <code>three</code>, <code>four</code>, …​</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Ordinary workstations used by employees.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>trashcan</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>A very old machine without any critical data. Even interns are allowed to use this system.</p></td></tr></tbody></table><div class=paragraph><p>When using netgroups to configure this scenario, each user is assigned to one or more netgroups and logins are then allowed or forbidden for all members of the netgroup. When adding a new machine, login restrictions must be defined for all netgroups. When a new user is added, the account must be added to one or more netgroups. If the NIS setup is planned carefully, only one central configuration file needs modification to grant or deny access to machines.</p></div><div class=paragraph><p>The first step is the initialization of the NIS <code>netgroup</code> map. In FreeBSD, this map is not created by default. On the NIS master server, use an editor to create a map named <span class=filename>/var/yp/netgroup</span>.</p></div><div class=paragraph><p>This example creates four netgroups to represent IT employees, IT apprentices, employees, and interns:</p></div><div class="literalblock programlisting"><div class=content><pre>IT_EMP  (,alpha,test-domain)    (,beta,test-domain)
IT_APP  (,charlie,test-domain)  (,delta,test-domain)
USERS   (,echo,test-domain)     (,foxtrott,test-domain) \
        (,golf,test-domain)
INTERNS (,able,test-domain)     (,baker,test-domain)</pre></div></div><div class=paragraph><p>Each entry configures a netgroup. The first column in an entry is the name of the netgroup. Each set of brackets represents either a group of one or more users or the name of another netgroup. When specifying a user, the three comma-delimited fields inside each group represent:</p></div><div class="olist arabic"><ol class=arabic><li><p>The name of the host(s) where the other fields representing the user are valid. If a hostname is not specified, the entry is valid on all hosts.</p></li><li><p>The name of the account that belongs to this netgroup.</p></li><li><p>The NIS domain for the account. Accounts may be imported from other NIS domains into a netgroup.</p></li></ol></div><div class=paragraph><p>If a group contains multiple users, separate each user with whitespace. Additionally, each field may contain wildcards. See <a href="https://man.freebsd.org/cgi/man.cgi?query=netgroup&amp;sektion=5&amp;format=html">netgroup(5)</a> for details.</p></div><div class=paragraph><p>Netgroup names longer than 8 characters should not be used. The names are case sensitive and using capital letters for netgroup names is an easy way to distinguish between user, machine and netgroup names.</p></div><div class=paragraph><p>Some non-FreeBSD NIS clients cannot handle netgroups containing more than 15 entries. This limit may be circumvented by creating several sub-netgroups with 15 users or fewer and a real netgroup consisting of the sub-netgroups, as seen in this example:</p></div><div class="literalblock programlisting"><div class=content><pre>BIGGRP1  (,joe1,domain)  (,joe2,domain)  (,joe3,domain) [...]
BIGGRP2  (,joe16,domain)  (,joe17,domain) [...]
BIGGRP3  (,joe31,domain)  (,joe32,domain)
BIGGROUP  BIGGRP1 BIGGRP2 BIGGRP3</pre></div></div><div class=paragraph><p>Repeat this process if more than 225 (15 times 15) users exist within a single netgroup.</p></div><div class=paragraph><p>To activate and distribute the new NIS map:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>ellington# <span class=nb>cd</span> /var/yp
ellington# make
....</code></pre></div></div><div class=paragraph><p>This will generate the three NIS maps <span class=filename>netgroup</span>, <span class=filename>netgroup.byhost</span> and <span class=filename>netgroup.byuser</span>. Use the map key option of <a href="https://man.freebsd.org/cgi/man.cgi?query=ypcat&amp;sektion=1&amp;format=html">ypcat(1)</a> to check if the new NIS maps are available:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>ellington% ypcat <span class=nt>-k</span> netgroup
ellington% ypcat <span class=nt>-k</span> netgroup.byhost
ellington% ypcat <span class=nt>-k</span> netgroup.byuser</code></pre></div></div><div class=paragraph><p>The output of the first command should resemble the contents of <span class=filename>/var/yp/netgroup</span>. The second command only produces output if host-specific netgroups were created. The third command is used to get the list of netgroups for a user.</p></div><div class=paragraph><p>To configure a client, use <a href="https://man.freebsd.org/cgi/man.cgi?query=vipw&amp;sektion=8&amp;format=html">vipw(8)</a> to specify the name of the netgroup. For example, on the server named <code>war</code>, replace this line:</p></div><div class="literalblock programlisting"><div class=content><pre>+:::::::::</pre></div></div><div class=paragraph><p>with</p></div><div class="literalblock programlisting"><div class=content><pre>+@IT_EMP:::::::::</pre></div></div><div class=paragraph><p>This specifies that only the users defined in the netgroup <code>IT_EMP</code> will be imported into this system’s password database and only those users are allowed to login to this system.</p></div><div class=paragraph><p>This configuration also applies to the <code>~</code> function of the shell and all routines which convert between user names and numerical user IDs. In other words, <code>cd ~<em>user</em></code> will not work, <code>ls -l</code> will show the numerical ID instead of the username, and <code>find . -user joe -print</code> will fail with the message <code>No such user</code>. To fix this, import all user entries without allowing them to login into the servers. This can be achieved by adding an extra line:</p></div><div class="literalblock programlisting"><div class=content><pre>+:::::::::/usr/sbin/nologin</pre></div></div><div class=paragraph><p>This line configures the client to import all entries but to replace the shell in those entries with <span class=filename>/usr/sbin/nologin</span>.</p></div><div class=paragraph><p>Make sure that extra line is placed <em>after</em> <code>+@IT_EMP:::::::::</code>. Otherwise, all user accounts imported from NIS will have <span class=filename>/usr/sbin/nologin</span> as their login shell and no one will be able to login to the system.</p></div><div class=paragraph><p>To configure the less important servers, replace the old <code>+:::::::::</code> on the servers with these lines:</p></div><div class="literalblock programlisting"><div class=content><pre>+@IT_EMP:::::::::
+@IT_APP:::::::::
+:::::::::/usr/sbin/nologin</pre></div></div><div class=paragraph><p>The corresponding lines for the workstations would be:</p></div><div class="literalblock programlisting"><div class=content><pre>+@IT_EMP:::::::::
+@USERS:::::::::
+:::::::::/usr/sbin/nologin</pre></div></div><div class=paragraph><p>NIS supports the creation of netgroups from other netgroups which can be useful if the policy regarding user access changes. One possibility is the creation of role-based netgroups. For example, one might create a netgroup called <code>BIGSRV</code> to define the login restrictions for the important servers, another netgroup called <code>SMALLSRV</code> for the less important servers, and a third netgroup called <code>USERBOX</code> for the workstations. Each of these netgroups contains the netgroups that are allowed to login onto these machines. The new entries for the NIS <code>netgroup</code> map would look like this:</p></div><div class="literalblock programlisting"><div class=content><pre>BIGSRV    IT_EMP  IT_APP
SMALLSRV  IT_EMP  IT_APP  ITINTERN
USERBOX   IT_EMP  ITINTERN USERS</pre></div></div><div class=paragraph><p>This method of defining login restrictions works reasonably well when it is possible to define groups of machines with identical restrictions. Unfortunately, this is the exception and not the rule. Most of the time, the ability to define login restrictions on a per-machine basis is required.</p></div><div class=paragraph><p>Machine-specific netgroup definitions are another possibility to deal with the policy changes. In this scenario, the <span class=filename>/etc/master.passwd</span> of each system contains two lines starting with "+". The first line adds a netgroup with the accounts allowed to login onto this machine and the second line adds all other accounts with <span class=filename>/usr/sbin/nologin</span> as shell. It is recommended to use the "ALL-CAPS" version of the hostname as the name of the netgroup:</p></div><div class="literalblock programlisting"><div class=content><pre>+@BOXNAME:::::::::
+:::::::::/usr/sbin/nologin</pre></div></div><div class=paragraph><p>Once this task is completed on all the machines, there is no longer a need to modify the local versions of <span class=filename>/etc/master.passwd</span> ever again. All further changes can be handled by modifying the NIS map. Here is an example of a possible <code>netgroup</code> map for this scenario:</p></div><div class="literalblock programlisting"><div class=content><pre># Define groups of users first
IT_EMP    (,alpha,test-domain)    (,beta,test-domain)
IT_APP    (,charlie,test-domain)  (,delta,test-domain)
DEPT1     (,echo,test-domain)     (,foxtrott,test-domain)
DEPT2     (,golf,test-domain)     (,hotel,test-domain)
DEPT3     (,india,test-domain)    (,juliet,test-domain)
ITINTERN  (,kilo,test-domain)     (,lima,test-domain)
D_INTERNS (,able,test-domain)     (,baker,test-domain)
#
# Now, define some groups based on roles
USERS     DEPT1   DEPT2     DEPT3
BIGSRV    IT_EMP  IT_APP
SMALLSRV  IT_EMP  IT_APP    ITINTERN
USERBOX   IT_EMP  ITINTERN  USERS
#
# And a groups for a special tasks
# Allow echo and golf to access our anti-virus-machine
SECURITY  IT_EMP  (,echo,test-domain)  (,golf,test-domain)
#
# machine-based netgroups
# Our main servers
WAR       BIGSRV
FAMINE    BIGSRV
# User india needs access to this server
POLLUTION  BIGSRV  (,india,test-domain)
#
# This one is really important and needs more access restrictions
DEATH     IT_EMP
#
# The anti-virus-machine mentioned above
ONE       SECURITY
#
# Restrict a machine to a single user
TWO       (,hotel,test-domain)
# [...more groups to follow]</pre></div></div><div class=paragraph><p>It may not always be advisable to use machine-based netgroups. When deploying a couple of dozen or hundreds of systems, role-based netgroups instead of machine-based netgroups may be used to keep the size of the NIS map within reasonable limits.</p></div></div><div class=sect3><h4 id=_password_formats>29.4.9. Password Formats<a class=anchor href=#_password_formats></a></h4><div class=paragraph><p>NIS requires that all hosts within an NIS domain use the same format for encrypting passwords. If users have trouble authenticating on an NIS client, it may be due to a differing password format. In a heterogeneous network, the format must be supported by all operating systems, where DES is the lowest common standard.</p></div><div class=paragraph><p>To check which format a server or client is using, look at this section of <span class=filename>/etc/login.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>default:\
	:passwd_format=des:\
	:copyright=/etc/COPYRIGHT:\
	[Further entries elided]</pre></div></div><div class=paragraph><p>In this example, the system is using the DES format. Other possible values are <code>blf</code> for Blowfish and <code>md5</code> for MD5 encrypted passwords.</p></div><div class=paragraph><p>If the format on a host needs to be edited to match the one being used in the NIS domain, the login capability database must be rebuilt after saving the change:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cap_mkdb /etc/login.conf</span></code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>The format of passwords for existing user accounts will not be updated until each user changes their password <em>after</em> the login capability database is rebuilt.</p></div></td></tr></tbody></table></div></div></div><div class=sect2><h3 id=network-ldap>29.5. Lightweight Directory Access Protocol (LDAP)<a class=anchor href=#network-ldap></a></h3><div class=paragraph><p>The Lightweight Directory Access Protocol (LDAP) is an application layer protocol used to access, modify, and authenticate objects using a distributed directory information service. Think of it as a phone or record book which stores several levels of hierarchical, homogeneous information. It is used in Active Directory and OpenLDAP networks and allows users to access to several levels of internal information utilizing a single account. For example, email authentication, pulling employee contact information, and internal website authentication might all make use of a single user account in the LDAP server’s record base.</p></div><div class=paragraph><p>This section provides a quick start guide for configuring an LDAP server on a FreeBSD system. It assumes that the administrator already has a design plan which includes the type of information to store, what that information will be used for, which users should have access to that information, and how to secure this information from unauthorized access.</p></div><div class=sect3><h4 id=_ldap_terminology_and_structure>29.5.1. LDAP Terminology and Structure<a class=anchor href=#_ldap_terminology_and_structure></a></h4><div class=paragraph><p>LDAP uses several terms which should be understood before starting the configuration. All directory entries consist of a group of <em>attributes</em>. Each of these attribute sets contains a unique identifier known as a <em>Distinguished Name</em> (DN) which is normally built from several other attributes such as the common or <em>Relative Distinguished Name</em> (RDN). Similar to how directories have absolute and relative paths, consider a DN as an absolute path and the RDN as the relative path.</p></div><div class=paragraph><p>An example LDAP entry looks like the following. This example searches for the entry for the specified user account (<code>uid</code>), organizational unit (<code>ou</code>), and organization (<code>o</code>):</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% ldapsearch <span class=nt>-xb</span> <span class=s2>&#34;uid=trhodes,ou=users,o=example.com&#34;</span>
<span class=c># extended LDIF</span>
<span class=c>#</span>
<span class=c># LDAPv3</span>
<span class=c># base &lt;uid=trhodes,ou=users,o=example.com&gt; with scope subtree</span>
<span class=c># filter: (objectclass=*)</span>
<span class=c># requesting: ALL</span>
<span class=c>#</span>

<span class=c># trhodes, users, example.com</span>
dn: <span class=nv>uid</span><span class=o>=</span>trhodes,ou<span class=o>=</span><span class=nb>users</span>,o<span class=o>=</span>example.com
mail: trhodes@example.com
cn: Tom Rhodes
uid: trhodes
telephoneNumber: <span class=o>(</span>123<span class=o>)</span> 456-7890

<span class=c># search result</span>
search: 2
result: 0 Success

<span class=c># numResponses: 2</span>
<span class=c># numEntries: 1</span></code></pre></div></div><div class=paragraph><p>This example entry shows the values for the <code>dn</code>, <code>mail</code>, <code>cn</code>, <code>uid</code>, and <code>telephoneNumber</code> attributes. The cn attribute is the RDN.</p></div><div class=paragraph><p>More information about LDAP and its terminology can be found at <a href=http://www.openldap.org/doc/admin24/intro.html>http://www.openldap.org/doc/admin24/intro.html</a>.</p></div></div><div class=sect3><h4 id=ldap-config>29.5.2. Configuring an LDAP Server<a class=anchor href=#ldap-config></a></h4><div class=paragraph><p>FreeBSD does not provide a built-in LDAP server. Begin the configuration by installing <a class=package href=https://cgit.freebsd.org/ports/tree/net/openldap-server/>net/openldap-server</a> package or port:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pkg install openldap-server</span></code></pre></div></div><div class=paragraph><p>There is a large set of default options enabled in the <a href=https://docs.freebsd.org/en/articles/linux-users/#software>package</a>. Review them by running <code>pkg info openldap-server</code>. If they are not sufficient (for example if SQL support is needed), please consider recompiling the port using the appropriate <a href=./#ports-using>framework</a>.</p></div><div class=paragraph><p>The installation creates the directory <span class=filename>/var/db/openldap-data</span> to hold the data. The directory to store the certificates must be created:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mkdir /usr/local/etc/openldap/private</span></code></pre></div></div><div class=paragraph><p>The next phase is to configure the Certificate Authority. The following commands must be executed from <span class=filename>/usr/local/etc/openldap/private</span>. This is important as the file permissions need to be restrictive and users should not have access to these files. More detailed information about certificates and their parameters can be found in <a href=./#openssl>OpenSSL</a>. To create the Certificate Authority, start with this command and follow the prompts:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># openssl req -days 365 -nodes -new -x509 -keyout ca.key -out ../ca.crt</span></code></pre></div></div><div class=paragraph><p>The entries for the prompts may be generic <em>except</em> for the <code>Common Name</code>. This entry must be <em>different</em> than the system hostname. If this will be a self signed certificate, prefix the hostname with <code>CA</code> for Certificate Authority.</p></div><div class=paragraph><p>The next task is to create a certificate signing request and a private key. Input this command and follow the prompts:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># openssl req -days 365 -nodes -new -keyout server.key -out server.csr</span></code></pre></div></div><div class=paragraph><p>During the certificate generation process, be sure to correctly set the <code>Common Name</code> attribute. The Certificate Signing Request must be signed with the Certificate Authority in order to be used as a valid certificate:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># openssl x509 -req -days 365 -in server.csr -out ../server.crt -CA ../ca.crt -CAkey ca.key -CAcreateserial</span></code></pre></div></div><div class=paragraph><p>The final part of the certificate generation process is to generate and sign the client certificates:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># openssl req -days 365 -nodes -new -keyout client.key -out client.csr</span>
<span class=c># openssl x509 -req -days 3650 -in client.csr -out ../client.crt -CA ../ca.crt -CAkey ca.key</span></code></pre></div></div><div class=paragraph><p>Remember to use the same <code>Common Name</code> attribute when prompted. When finished, ensure that a total of eight (8) new files have been generated through the proceeding commands.</p></div><div class=paragraph><p>The daemon running the OpenLDAP server is <span class=filename>slapd</span>. Its configuration is performed through <span class=filename>slapd.ldif</span>: the old <span class=filename>slapd.conf</span> has been deprecated by OpenLDAP.</p></div><div class=paragraph><p><a href=http://www.openldap.org/doc/admin24/slapdconf2.html>Configuration examples</a> for <span class=filename>slapd.ldif</span> are available and can also be found in <span class=filename>/usr/local/etc/openldap/slapd.ldif.sample</span>. Options are documented in slapd-config(5). Each section of <span class=filename>slapd.ldif</span>, like all the other LDAP attribute sets, is uniquely identified through a DN. Be sure that no blank lines are left between the <code>dn:</code> statement and the desired end of the section. In the following example, TLS will be used to implement a secure channel. The first section represents the global configuration:</p></div><div class="literalblock programlisting"><div class=content><pre>#
# See slapd-config(5) for details on configuration options.
# This file should NOT be world readable.
#
dn: cn=config
objectClass: olcGlobal
cn: config
#
#
# Define global ACLs to disable default read access.
#
olcArgsFile: /var/run/openldap/slapd.args
olcPidFile: /var/run/openldap/slapd.pid
olcTLSCertificateFile: /usr/local/etc/openldap/server.crt
olcTLSCertificateKeyFile: /usr/local/etc/openldap/private/server.key
olcTLSCACertificateFile: /usr/local/etc/openldap/ca.crt
#olcTLSCipherSuite: HIGH
olcTLSProtocolMin: 3.1
olcTLSVerifyClient: never</pre></div></div><div class=paragraph><p>The Certificate Authority, server certificate and server private key files must be specified here. It is recommended to let the clients choose the security cipher and omit option <code>olcTLSCipherSuite</code> (incompatible with TLS clients other than <span class=filename>openssl</span>). Option <code>olcTLSProtocolMin</code> lets the server require a minimum security level: it is recommended. While verification is mandatory for the server, it is not for the client: <code>olcTLSVerifyClient: never</code>.</p></div><div class=paragraph><p>The second section is about the backend modules and can be configured as follows:</p></div><div class="literalblock programlisting"><div class=content><pre>#
# Load dynamic backend modules:
#
dn: cn=module,cn=config
objectClass: olcModuleList
cn: module
olcModulepath:	/usr/local/libexec/openldap
olcModuleload:	back_mdb.la
#olcModuleload:	back_bdb.la
#olcModuleload:	back_hdb.la
#olcModuleload:	back_ldap.la
#olcModuleload:	back_passwd.la
#olcModuleload:	back_shell.la</pre></div></div><div class=paragraph><p>The third section is devoted to load the needed <code>ldif</code> schemas to be used by the databases: they are essential.</p></div><div class="literalblock programlisting"><div class=content><pre>dn: cn=schema,cn=config
objectClass: olcSchemaConfig
cn: schema

include: file:///usr/local/etc/openldap/schema/core.ldif
include: file:///usr/local/etc/openldap/schema/cosine.ldif
include: file:///usr/local/etc/openldap/schema/inetorgperson.ldif
include: file:///usr/local/etc/openldap/schema/nis.ldif</pre></div></div><div class=paragraph><p>Next, the frontend configuration section:</p></div><div class="literalblock programlisting"><div class=content><pre># Frontend settings
#
dn: olcDatabase={-1}frontend,cn=config
objectClass: olcDatabaseConfig
objectClass: olcFrontendConfig
olcDatabase: {-1}frontend
olcAccess: to * by * read
#
# Sample global access control policy:
#	Root DSE: allow anyone to read it
#	Subschema (sub)entry DSE: allow anyone to read it
#	Other DSEs:
#		Allow self write access
#		Allow authenticated users read access
#		Allow anonymous users to authenticate
#
#olcAccess: to dn.base=&#34;&#34; by * read
#olcAccess: to dn.base=&#34;cn=Subschema&#34; by * read
#olcAccess: to *
#	by self write
#	by users read
#	by anonymous auth
#
# if no access controls are present, the default policy
# allows anyone and everyone to read anything but restricts
# updates to rootdn.  (e.g., &#34;access to * by * read&#34;)
#
# rootdn can always read and write EVERYTHING!
#
olcPasswordHash: {SSHA}
# {SSHA} is already the default for olcPasswordHash</pre></div></div><div class=paragraph><p>Another section is devoted to the <em>configuration backend</em>, the only way to later access the OpenLDAP server configuration is as a global super-user.</p></div><div class="literalblock programlisting"><div class=content><pre>dn: olcDatabase={0}config,cn=config
objectClass: olcDatabaseConfig
olcDatabase: {0}config
olcAccess: to * by * none
olcRootPW: {SSHA}iae+lrQZILpiUdf16Z9KmDmSwT77Dj4U</pre></div></div><div class=paragraph><p>The default administrator username is <code>cn=config</code>. Type <span class=filename>slappasswd</span> in a shell, choose a password and use its hash in <code>olcRootPW</code>. If this option is not specified now, before <span class=filename>slapd.ldif</span> is imported, no one will be later able to modify the <em>global configuration</em> section.</p></div><div class=paragraph><p>The last section is about the database backend:</p></div><div class="literalblock programlisting"><div class=content><pre>#######################################################################
# LMDB database definitions
#######################################################################
#
dn: olcDatabase=mdb,cn=config
objectClass: olcDatabaseConfig
objectClass: olcMdbConfig
olcDatabase: mdb
olcDbMaxSize: 1073741824
olcSuffix: dc=domain,dc=example
olcRootDN: cn=mdbadmin,dc=domain,dc=example
# Cleartext passwords, especially for the rootdn, should
# be avoided.  See slappasswd(8) and slapd-config(5) for details.
# Use of strong authentication encouraged.
olcRootPW: {SSHA}X2wHvIWDk6G76CQyCMS1vDCvtICWgn0+
# The database directory MUST exist prior to running slapd AND
# should only be accessible by the slapd and slap tools.
# Mode 700 recommended.
olcDbDirectory:	/var/db/openldap-data
# Indices to maintain
olcDbIndex: objectClass eq</pre></div></div><div class=paragraph><p>This database hosts the <em>actual contents</em> of the LDAP directory. Types other than <code>mdb</code> are available. Its super-user, not to be confused with the global one, is configured here: a (possibly custom) username in <code>olcRootDN</code> and the password hash in <code>olcRootPW</code>; <span class=filename>slappasswd</span> can be used as before.</p></div><div class=paragraph><p>This <a href="http://www.openldap.org/devel/gitweb.cgi?p=openldap.git;a=tree;f=tests/data/regressions/its8444;h=8a5e808e63b0de3d2bdaf2cf34fecca8577ca7fd;hb=HEAD">repository</a> contains four examples of <span class=filename>slapd.ldif</span>. To convert an existing <span class=filename>slapd.conf</span> into <span class=filename>slapd.ldif</span>, refer to <a href=http://www.openldap.org/doc/admin24/slapdconf2.html>this page</a> (please note that this may introduce some unuseful options).</p></div><div class=paragraph><p>When the configuration is completed, <span class=filename>slapd.ldif</span> must be placed in an empty directory. It is recommended to create it as:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mkdir /usr/local/etc/openldap/slapd.d/</span></code></pre></div></div><div class=paragraph><p>Import the configuration database:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># /usr/local/sbin/slapadd -n0 -F /usr/local/etc/openldap/slapd.d/ -l /usr/local/etc/openldap/slapd.ldif</span></code></pre></div></div><div class=paragraph><p>Start the <span class=filename>slapd</span> daemon:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># /usr/local/libexec/slapd -F /usr/local/etc/openldap/slapd.d/</span></code></pre></div></div><div class=paragraph><p>Option <code>-d</code> can be used for debugging, as specified in slapd(8). To verify that the server is running and working:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ldapsearch -x -b &#39;&#39; -s base &#39;(objectclass=*)&#39; namingContexts</span>
<span class=c># extended LDIF</span>
<span class=c>#</span>
<span class=c># LDAPv3</span>
<span class=c># base &lt;&gt; with scope baseObject</span>
<span class=c># filter: (objectclass=*)</span>
<span class=c># requesting: namingContexts</span>
<span class=c>#</span>

<span class=c>#</span>
dn:
namingContexts: <span class=nv>dc</span><span class=o>=</span>domain,dc<span class=o>=</span>example

<span class=c># search result</span>
search: 2
result: 0 Success

<span class=c># numResponses: 2</span>
<span class=c># numEntries: 1</span></code></pre></div></div><div class=paragraph><p>The server must still be trusted. If that has never been done before, follow these instructions. Install the OpenSSL package or port:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pkg install openssl</span></code></pre></div></div><div class=paragraph><p>From the directory where <span class=filename>ca.crt</span> is stored (in this example, <span class=filename>/usr/local/etc/openldap</span>), run:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># c_rehash .</span></code></pre></div></div><div class=paragraph><p>Both the CA and the server certificate are now correctly recognized in their respective roles. To verify this, run this command from the <span class=filename>server.crt</span> directory:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># openssl verify -verbose -CApath . server.crt</span></code></pre></div></div><div class=paragraph><p>If <span class=filename>slapd</span> was running, restart it. As stated in <span class=filename>/usr/local/etc/rc.d/slapd</span>, to properly run <span class=filename>slapd</span> at boot the following lines must be added to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>lapd_enable=&#34;YES&#34;
slapd_flags=&#39;-h &#34;ldapi://%2fvar%2frun%2fopenldap%2fldapi/
ldap://0.0.0.0/&#34;&#39;
slapd_sockets=&#34;/var/run/openldap/ldapi&#34;
slapd_cn_config=&#34;YES&#34;</pre></div></div><div class=paragraph><p><span class=filename>slapd</span> does not provide debugging at boot. Check <span class=filename>/var/log/debug.log</span>, <span class=filename>dmesg -a</span> and <span class=filename>/var/log/messages</span> for this purpose.</p></div><div class=paragraph><p>The following example adds the group <code>team</code> and the user <code>john</code> to the <code>domain.example</code> LDAP database, which is still empty. First, create the file <span class=filename>domain.ldif</span>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cat domain.ldif</span>
dn: <span class=nv>dc</span><span class=o>=</span>domain,dc<span class=o>=</span>example
objectClass: dcObject
objectClass: organization
o: domain.example
dc: domain

dn: <span class=nv>ou</span><span class=o>=</span><span class=nb>groups</span>,dc<span class=o>=</span>domain,dc<span class=o>=</span>example
objectClass: top
objectClass: organizationalunit
ou: <span class=nb>groups

</span>dn: <span class=nv>ou</span><span class=o>=</span><span class=nb>users</span>,dc<span class=o>=</span>domain,dc<span class=o>=</span>example
objectClass: top
objectClass: organizationalunit
ou: <span class=nb>users

</span>dn: <span class=nv>cn</span><span class=o>=</span>team,ou<span class=o>=</span><span class=nb>groups</span>,dc<span class=o>=</span>domain,dc<span class=o>=</span>example
objectClass: top
objectClass: posixGroup
cn: team
gidNumber: 10001

dn: <span class=nv>uid</span><span class=o>=</span>john,ou<span class=o>=</span><span class=nb>users</span>,dc<span class=o>=</span>domain,dc<span class=o>=</span>example
objectClass: top
objectClass: account
objectClass: posixAccount
objectClass: shadowAccount
cn: John McUser
uid: john
uidNumber: 10001
gidNumber: 10001
homeDirectory: /home/john/
loginShell: /usr/bin/bash
userPassword: secret</code></pre></div></div><div class=paragraph><p>See the OpenLDAP documentation for more details. Use <span class=filename>slappasswd</span> to replace the plain text password <code>secret</code> with a hash in <code>userPassword</code>. The path specified as <code>loginShell</code> must exist in all the systems where <code>john</code> is allowed to login. Finally, use the <code>mdb</code> administrator to modify the database:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ldapadd -W -D &#34;cn=mdbadmin,dc=domain,dc=example&#34; -f domain.ldif</span></code></pre></div></div><div class=paragraph><p>Modifications to the <em>global configuration</em> section can only be performed by the global super-user. For example, assume that the option <code>olcTLSCipherSuite: HIGH:MEDIUM:SSLv3</code> was initially specified and must now be deleted. First, create a file that contains the following:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cat global_mod</span>
dn: <span class=nv>cn</span><span class=o>=</span>config
changetype: modify
delete: olcTLSCipherSuite</code></pre></div></div><div class=paragraph><p>Then, apply the modifications:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ldapmodify -f global_mod -x -D &#34;cn=config&#34; -W</span></code></pre></div></div><div class=paragraph><p>When asked, provide the password chosen in the <em>configuration backend</em> section. The username is not required: here, <code>cn=config</code> represents the DN of the database section to be modified. Alternatively, use <code>ldapmodify</code> to delete a single line of the database, <code>ldapdelete</code> to delete a whole entry.</p></div><div class=paragraph><p>If something goes wrong, or if the global super-user cannot access the configuration backend, it is possible to delete and re-write the whole configuration:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># rm -rf /usr/local/etc/openldap/slapd.d/</span></code></pre></div></div><div class=paragraph><p><span class=filename>slapd.ldif</span> can then be edited and imported again. Please, follow this procedure only when no other solution is available.</p></div><div class=paragraph><p>This is the configuration of the server only. The same machine can also host an LDAP client, with its own separate configuration.</p></div></div></div><div class=sect2><h3 id=network-dhcp>29.6. Dynamic Host Configuration Protocol (DHCP)<a class=anchor href=#network-dhcp></a></h3><div class=paragraph><p>The Dynamic Host Configuration Protocol (DHCP) allows a system to connect to a network in order to be assigned the necessary addressing information for communication on that network. FreeBSD includes the OpenBSD version of <code>dhclient</code> which is used by the client to obtain the addressing information. FreeBSD does not install a DHCP server, but several servers are available in the FreeBSD Ports Collection. The DHCP protocol is fully described in <a href=http://www.freesoft.org/CIE/RFC/2131/>RFC 2131</a>. Informational resources are also available at <a href=http://www.isc.org/downloads/dhcp/>isc.org/downloads/dhcp/</a>.</p></div><div class=paragraph><p>This section describes how to use the built-in DHCP client. It then describes how to install and configure a DHCP server.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>In FreeBSD, the <a href="https://man.freebsd.org/cgi/man.cgi?query=bpf&amp;sektion=4&amp;format=html">bpf(4)</a> device is needed by both the DHCP server and DHCP client. This device is included in the <span class=filename>GENERIC</span> kernel that is installed with FreeBSD. Users who prefer to create a custom kernel need to keep this device if DHCP is used.</p></div><div class=paragraph><p>It should be noted that <span class=filename>bpf</span> also allows privileged users to run network packet sniffers on that system.</p></div></td></tr></tbody></table></div><div class=sect3><h4 id=_configuring_a_dhcp_client>29.6.1. Configuring a DHCP Client<a class=anchor href=#_configuring_a_dhcp_client></a></h4><div class=paragraph><p>DHCP client support is included in the FreeBSD installer, making it easy to configure a newly installed system to automatically receive its networking addressing information from an existing DHCP server. Refer to <a href=./#bsdinstall-post>Accounts, Time Zone, Services and Hardening</a> for examples of network configuration.</p></div><div class=paragraph><p>When <code>dhclient</code> is executed on the client machine, it begins broadcasting requests for configuration information. By default, these requests use UDP port 68. The server replies on UDP port 67, giving the client an IP address and other relevant network information such as a subnet mask, default gateway, and DNS server addresses. This information is in the form of a DHCP"lease" and is valid for a configurable time. This allows stale IP addresses for clients no longer connected to the network to automatically be reused. DHCP clients can obtain a great deal of information from the server. An exhaustive list may be found in <a href="https://man.freebsd.org/cgi/man.cgi?query=dhcp-options&amp;sektion=5&amp;format=html">dhcp-options(5)</a>.</p></div><div class=paragraph><p>By default, when a FreeBSD system boots, its DHCP client runs in the background, or <em>asynchronously</em>. Other startup scripts continue to run while the DHCP process completes, which speeds up system startup.</p></div><div class=paragraph><p>Background DHCP works well when the DHCP server responds quickly to the client’s requests. However, DHCP may take a long time to complete on some systems. If network services attempt to run before DHCP has assigned the network addressing information, they will fail. Using DHCP in <em>synchronous</em> mode prevents this problem as it pauses startup until the DHCP configuration has completed.</p></div><div class=paragraph><p>This line in <span class=filename>/etc/rc.conf</span> is used to configure background or asynchronous mode:</p></div><div class="literalblock programlisting"><div class=content><pre>ifconfig_fxp0=&#34;DHCP&#34;</pre></div></div><div class=paragraph><p>This line may already exist if the system was configured to use DHCP during installation. Replace the <em>fxp0</em> shown in these examples with the name of the interface to be dynamically configured, as described in <a href=./#config-network-setup>“Setting Up Network Interface Cards”</a>.</p></div><div class=paragraph><p>To instead configure the system to use synchronous mode, and to pause during startup while DHCP completes, use “SYNCDHCP”:</p></div><div class="literalblock programlisting"><div class=content><pre>ifconfig_fxp0=&#34;SYNCDHCP&#34;</pre></div></div><div class=paragraph><p>Additional client options are available. Search for <code>dhclient</code> in <a href="https://man.freebsd.org/cgi/man.cgi?query=rc.conf&amp;sektion=5&amp;format=html">rc.conf(5)</a> for details.</p></div><div class=paragraph><p>The DHCP client uses the following files:</p></div><div class=ulist><ul><li><p><span class=filename>/etc/dhclient.conf</span></p><div class=paragraph><p>The configuration file used by <code>dhclient</code>. Typically, this file contains only comments as the defaults are suitable for most clients. This configuration file is described in <a href="https://man.freebsd.org/cgi/man.cgi?query=dhclient.conf&amp;sektion=5&amp;format=html">dhclient.conf(5)</a>.</p></div></li><li><p><span class=filename>/sbin/dhclient</span></p><div class=paragraph><p>More information about the command itself can be found in <a href="https://man.freebsd.org/cgi/man.cgi?query=dhclient&amp;sektion=8&amp;format=html">dhclient(8)</a>.</p></div></li><li><p><span class=filename>/sbin/dhclient-script</span></p><div class=paragraph><p>The FreeBSD-specific DHCP client configuration script. It is described in <a href="https://man.freebsd.org/cgi/man.cgi?query=dhclient-script&amp;sektion=8&amp;format=html">dhclient-script(8)</a>, but should not need any user modification to function properly.</p></div></li><li><p><span class=filename>/var/db/dhclient.leases.interface</span></p><div class=paragraph><p>The DHCP client keeps a database of valid leases in this file, which is written as a log and is described in <a href="https://man.freebsd.org/cgi/man.cgi?query=dhclient.leases&amp;sektion=5&amp;format=html">dhclient.leases(5)</a>.</p></div></li></ul></div></div><div class=sect3><h4 id=network-dhcp-server>29.6.2. Installing and Configuring a DHCP Server<a class=anchor href=#network-dhcp-server></a></h4><div class=paragraph><p>This section demonstrates how to configure a FreeBSD system to act as a DHCP server using the Internet Systems Consortium (ISC) implementation of the DHCP server. This implementation and its documentation can be installed using the <a class=package href=https://cgit.freebsd.org/ports/tree/net/isc-dhcp44-server/>net/isc-dhcp44-server</a> package or port.</p></div><div class=paragraph><p>The installation of <a class=package href=https://cgit.freebsd.org/ports/tree/net/isc-dhcp44-server/>net/isc-dhcp44-server</a> installs a sample configuration file. Copy <span class=filename>/usr/local/etc/dhcpd.conf.example</span> to <span class=filename>/usr/local/etc/dhcpd.conf</span> and make any edits to this new file.</p></div><div class=paragraph><p>The configuration file is comprised of declarations for subnets and hosts which define the information that is provided to DHCP clients. For example, these lines configure the following:</p></div><div class="literalblock programlisting"><div class=content><pre>option domain-name &#34;example.org&#34;;<i class=conum data-value=1></i><b>(1)</b>
option domain-name-servers ns1.example.org;<i class=conum data-value=2></i><b>(2)</b>
option subnet-mask 255.255.255.0;<i class=conum data-value=3></i><b>(3)</b>

default-lease-time 600;<i class=conum data-value=4></i><b>(4)</b>
max-lease-time 72400;<i class=conum data-value=5></i><b>(5)</b>
ddns-update-style none;<i class=conum data-value=6></i><b>(6)</b>

subnet 10.254.239.0 netmask 255.255.255.224 {
  range 10.254.239.10 10.254.239.20;<i class=conum data-value=7></i><b>(7)</b>
  option routers rtr-239-0-1.example.org, rtr-239-0-2.example.org;<i class=conum data-value=8></i><b>(8)</b>
}

host fantasia {
  hardware ethernet 08:00:07:26:c0:a5;<i class=conum data-value=9></i><b>(9)</b>
  fixed-address fantasia.fugue.com;<i class=conum data-value=10></i><b>(10)</b>
}</pre></div></div><div class="colist arabic"><table><tbody><tr><td><i class=conum data-value=1></i><b>1</b></td><td>This option specifies the default search domain that will be provided to clients. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=resolv.conf&amp;sektion=5&amp;format=html">resolv.conf(5)</a> for more information.</td></tr><tr><td><i class=conum data-value=2></i><b>2</b></td><td>This option specifies a comma separated list of DNS servers that the client should use. They can be listed by their Fully Qualified Domain Names (FQDN), as seen in the example, or by their IP addresses.</td></tr><tr><td><i class=conum data-value=3></i><b>3</b></td><td>The subnet mask that will be provided to clients.</td></tr><tr><td><i class=conum data-value=4></i><b>4</b></td><td>The default lease expiry time in seconds. A client can be configured to override this value.</td></tr><tr><td><i class=conum data-value=5></i><b>5</b></td><td>The maximum allowed length of time, in seconds, for a lease. Should a client request a longer lease, a lease will still be issued, but it will only be valid for <code>max-lease-time</code>.</td></tr><tr><td><i class=conum data-value=6></i><b>6</b></td><td>The default of <code>none</code> disables dynamic DNS updates. Changing this to <code>interim</code> configures the DHCP server to update a DNS server whenever it hands out a lease so that the DNS server knows which IP addresses are associated with which computers in the network. Do not change the default setting unless the DNS server has been configured to support dynamic DNS.</td></tr><tr><td><i class=conum data-value=7></i><b>7</b></td><td>This line creates a pool of available IP addresses which are reserved for allocation to DHCP clients. The range of addresses must be valid for the network or subnet specified in the previous line.</td></tr><tr><td><i class=conum data-value=8></i><b>8</b></td><td>Declares the default gateway that is valid for the network or subnet specified before the opening <code>{</code> bracket.</td></tr><tr><td><i class=conum data-value=9></i><b>9</b></td><td>Specifies the hardware MAC address of a client so that the DHCP server can recognize the client when it makes a request.</td></tr><tr><td><i class=conum data-value=10></i><b>10</b></td><td>Specifies that this host should always be given the same IP address. Using the hostname is correct, since the DHCP server will resolve the hostname before returning the lease information.</td></tr></tbody></table></div><div class=paragraph><p>This configuration file supports many more options. Refer to dhcpd.conf(5), installed with the server, for details and examples.</p></div><div class=paragraph><p>Once the configuration of <span class=filename>dhcpd.conf</span> is complete, enable the DHCP server in <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>dhcpd_enable=&#34;YES&#34;
dhcpd_ifaces=&#34;dc0&#34;</pre></div></div><div class=paragraph><p>Replace the <code>dc0</code> with the interface (or interfaces, separated by whitespace) that the DHCP server should listen on for DHCP client requests.</p></div><div class=paragraph><p>Start the server by issuing the following command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service isc-dhcpd start</span></code></pre></div></div><div class=paragraph><p>Any future changes to the configuration of the server will require the dhcpd service to be stopped and then started using <a href="https://man.freebsd.org/cgi/man.cgi?query=service&amp;sektion=8&amp;format=html">service(8)</a>.</p></div><div class=paragraph><p>The DHCP server uses the following files. Note that the manual pages are installed with the server software.</p></div><div class=ulist><ul><li><p><span class=filename>/usr/local/sbin/dhcpd</span></p><div class=paragraph><p>More information about the dhcpd server can be found in dhcpd(8).</p></div></li><li><p><span class=filename>/usr/local/etc/dhcpd.conf</span></p><div class=paragraph><p>The server configuration file needs to contain all the information that should be provided to clients, along with information regarding the operation of the server. This configuration file is described in dhcpd.conf(5).</p></div></li><li><p><span class=filename>/var/db/dhcpd.leases</span></p><div class=paragraph><p>The DHCP server keeps a database of leases it has issued in this file, which is written as a log. Refer to dhcpd.leases(5), which gives a slightly longer description.</p></div></li><li><p><span class=filename>/usr/local/sbin/dhcrelay</span></p><div class=paragraph><p>This daemon is used in advanced environments where one DHCP server forwards a request from a client to another DHCP server on a separate network. If this functionality is required, install the <a class=package href=https://cgit.freebsd.org/ports/tree/net/isc-dhcp44-relay/>net/isc-dhcp44-relay</a> package or port. The installation includes dhcrelay(8) which provides more detail.</p></div></li></ul></div></div></div><div class=sect2><h3 id=network-dns>29.7. Domain Name System (DNS)<a class=anchor href=#network-dns></a></h3><div class=paragraph><p>Domain Name System (DNS) is the protocol through which domain names are mapped to IP addresses, and vice versa. DNS is coordinated across the Internet through a somewhat complex system of authoritative root, Top Level Domain (TLD), and other smaller-scale name servers, which host and cache individual domain information. It is not necessary to run a name server to perform DNS lookups on a system.</p></div><div class=paragraph><p>The following table describes some of the terms associated with DNS:</p></div><table class="tableblock frame-none grid-all stretch"><caption class=title>Tabela 27. DNS Terminology</caption><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">Term</th><th class="tableblock halign-left valign-top">Definition</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Forward DNS</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Mapping of hostnames to IP addresses.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Origin</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Refers to the domain covered in a particular zone file.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Resolver</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>A system process through which a machine queries a name server for zone information.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Reverse DNS</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Mapping of IP addresses to hostnames.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Root zone</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>The beginning of the Internet zone hierarchy. All zones fall under the root zone, similar to how all files in a file system fall under the root directory.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Zone</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>An individual domain, subdomain, or portion of the DNS administered by the same authority.</p></td></tr></tbody></table><div class=paragraph><p>Examples of zones:</p></div><div class=ulist><ul><li><p><code>.</code> is how the root zone is usually referred to in documentation.</p></li><li><p><code>org.</code> is a Top Level Domain (TLD) under the root zone.</p></li><li><p><code>example.org.</code> is a zone under the <code>org.</code> TLD.</p></li><li><p><code>1.168.192.in-addr.arpa</code> is a zone referencing all IP addresses which fall under the <code>192.168.1.*</code> IP address space.</p></li></ul></div><div class=paragraph><p>As one can see, the more specific part of a hostname appears to its left. For example, <code>example.org.</code> is more specific than <code>org.</code>, as <code>org.</code> is more specific than the root zone. The layout of each part of a hostname is much like a file system: the <span class=filename>/dev</span> directory falls within the root, and so on.</p></div><div class=sect3><h4 id=_reasons_to_run_a_name_server>29.7.1. Reasons to Run a Name Server<a class=anchor href=#_reasons_to_run_a_name_server></a></h4><div class=paragraph><p>Name servers generally come in two forms: authoritative name servers, and caching (also known as resolving) name servers.</p></div><div class=paragraph><p>An authoritative name server is needed when:</p></div><div class=ulist><ul><li><p>One wants to serve DNS information to the world, replying authoritatively to queries.</p></li><li><p>A domain, such as <code>example.org</code>, is registered and IP addresses need to be assigned to hostnames under it.</p></li><li><p>An IP address block requires reverse DNS entries (IP to hostname).</p></li><li><p>A backup or second name server, called a slave, will reply to queries.</p></li></ul></div><div class=paragraph><p>A caching name server is needed when:</p></div><div class=ulist><ul><li><p>A local DNS server may cache and respond more quickly than querying an outside name server.</p></li></ul></div><div class=paragraph><p>When one queries for <code>www.FreeBSD.org</code>, the resolver usually queries the uplink ISP’s name server, and retrieves the reply. With a local, caching DNS server, the query only has to be made once to the outside world by the caching DNS server. Additional queries will not have to go outside the local network, since the information is cached locally.</p></div></div><div class=sect3><h4 id=_dns_server_configuration>29.7.2. DNS Server Configuration<a class=anchor href=#_dns_server_configuration></a></h4><div class=paragraph><p>Unbound is provided in the FreeBSD base system. By default, it will provide DNS resolution to the local machine only. While the base system package can be configured to provide resolution services beyond the local machine, it is recommended that such requirements be addressed by installing Unbound from the FreeBSD Ports Collection.</p></div><div class=paragraph><p>To enable Unbound, add the following to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>local_unbound_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>Any existing nameservers in <span class=filename>/etc/resolv.conf</span> will be configured as forwarders in the new Unbound configuration.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>If any of the listed nameservers do not support DNSSEC, local DNS resolution will fail. Be sure to test each nameserver and remove any that fail the test. The following command will show the trust tree or a failure for a nameserver running on <code>192.168.1.1</code>:</p></div></td></tr></tbody></table></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% drill <span class=nt>-S</span> FreeBSD.org @192.168.1.1</code></pre></div></div><div class=paragraph><p>Once each nameserver is confirmed to support DNSSEC, start Unbound:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service local_unbound onestart</span></code></pre></div></div><div class=paragraph><p>This will take care of updating <span class=filename>/etc/resolv.conf</span> so that queries for DNSSEC secured domains will now work. For example, run the following to validate the FreeBSD.org DNSSEC trust tree:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% drill <span class=nt>-S</span> FreeBSD.org
<span class=p>;;</span> Number of trusted keys: 1
<span class=p>;;</span> Chasing: freebsd.org. A

DNSSEC Trust tree:
freebsd.org. <span class=o>(</span>A<span class=o>)</span>
|---freebsd.org. <span class=o>(</span>DNSKEY keytag: 36786 alg: 8 flags: 256<span class=o>)</span>
    |---freebsd.org. <span class=o>(</span>DNSKEY keytag: 32659 alg: 8 flags: 257<span class=o>)</span>
    |---freebsd.org. <span class=o>(</span>DS keytag: 32659 digest <span class=nb>type</span>: 2<span class=o>)</span>
        |---org. <span class=o>(</span>DNSKEY keytag: 49587 alg: 7 flags: 256<span class=o>)</span>
            |---org. <span class=o>(</span>DNSKEY keytag: 9795 alg: 7 flags: 257<span class=o>)</span>
            |---org. <span class=o>(</span>DNSKEY keytag: 21366 alg: 7 flags: 257<span class=o>)</span>
            |---org. <span class=o>(</span>DS keytag: 21366 digest <span class=nb>type</span>: 1<span class=o>)</span>
            |   |---. <span class=o>(</span>DNSKEY keytag: 40926 alg: 8 flags: 256<span class=o>)</span>
            |       |---. <span class=o>(</span>DNSKEY keytag: 19036 alg: 8 flags: 257<span class=o>)</span>
            |---org. <span class=o>(</span>DS keytag: 21366 digest <span class=nb>type</span>: 2<span class=o>)</span>
                |---. <span class=o>(</span>DNSKEY keytag: 40926 alg: 8 flags: 256<span class=o>)</span>
                    |---. <span class=o>(</span>DNSKEY keytag: 19036 alg: 8 flags: 257<span class=o>)</span>
<span class=p>;;</span> Chase successful</code></pre></div></div></div></div><div class=sect2><h3 id=network-apache>29.8. Apache HTTP Server<a class=anchor href=#network-apache></a></h3><div class=paragraph><p>The open source Apache HTTP Server is the most widely used web server. FreeBSD does not install this web server by default, but it can be installed from the <a class=package href=https://cgit.freebsd.org/ports/tree/www/apache24/>www/apache24</a> package or port.</p></div><div class=paragraph><p>This section summarizes how to configure and start version 2.<em>x</em> of the Apache HTTP Server on FreeBSD. For more detailed information about Apache 2.X and its configuration directives, refer to <a href=http://httpd.apache.org/>httpd.apache.org</a>.</p></div><div class=sect3><h4 id=_configuring_and_starting_apache>29.8.1. Configuring and Starting Apache<a class=anchor href=#_configuring_and_starting_apache></a></h4><div class=paragraph><p>In FreeBSD, the main Apache HTTP Server configuration file is installed as <span class=filename>/usr/local/etc/apache2x/httpd.conf</span>, where <em>x</em> represents the version number. This ASCII text file begins comment lines with a <code>#</code>. The most frequently modified directives are:</p></div><div class=dlist><dl><dt class=hdlist1><code>ServerRoot "/usr/local"</code></dt><dd><p>Specifies the default directory hierarchy for the Apache installation. Binaries are stored in the <span class=filename>bin</span> and <span class=filename>sbin</span> subdirectories of the server root and configuration files are stored in the <span class=filename>etc/apache2x</span> subdirectory.</p></dd><dt class=hdlist1><code>ServerAdmin <a href=mailto:you@example.com>you@example.com</a></code></dt><dd><p>Change this to the email address to receive problems with the server. This address also appears on some server-generated pages, such as error documents.</p></dd><dt class=hdlist1><code>ServerName www.example.com:80</code></dt><dd><p>Allows an administrator to set a hostname which is sent back to clients for the server. For example, <code>www</code> can be used instead of the actual hostname. If the system does not have a registered DNS name, enter its IP address instead. If the server will listen on an alternate report, change <code>80</code> to the alternate port number.</p></dd><dt class=hdlist1><code>DocumentRoot "/usr/local/www/apache2<em>x</em>/data"</code></dt><dd><p>The directory where documents will be served from. By default, all requests are taken from this directory, but symbolic links and aliases may be used to point to other locations.</p></dd></dl></div><div class=paragraph><p>It is always a good idea to make a backup copy of the default Apache configuration file before making changes. When the configuration of Apache is complete, save the file and verify the configuration using <code>apachectl</code>. Running <code>apachectl configtest</code> should return <code>Syntax OK</code>.</p></div><div class=paragraph><p>To launch Apache at system startup, add the following line to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>apache24_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>If Apache should be started with non-default options, the following line may be added to <span class=filename>/etc/rc.conf</span> to specify the needed flags:</p></div><div class="literalblock programlisting"><div class=content><pre>apache24_flags=&#34;&#34;</pre></div></div><div class=paragraph><p>If apachectl does not report configuration errors, start <code>httpd</code> now:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service apache24 start</span></code></pre></div></div><div class=paragraph><p>The <code>httpd</code> service can be tested by entering <code>http://<em>localhost</em></code> in a web browser, replacing <em>localhost</em> with the fully-qualified domain name of the machine running <code>httpd</code>. The default web page that is displayed is <span class=filename>/usr/local/www/apache24/data/index.html</span>.</p></div><div class=paragraph><p>The Apache configuration can be tested for errors after making subsequent configuration changes while <code>httpd</code> is running using the following command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service apache24 configtest</span></code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>It is important to note that <code>configtest</code> is not an <a href="https://man.freebsd.org/cgi/man.cgi?query=rc&amp;sektion=8&amp;format=html">rc(8)</a> standard, and should not be expected to work for all startup scripts.</p></div></td></tr></tbody></table></div></div><div class=sect3><h4 id=_virtual_hosting>29.8.2. Virtual Hosting<a class=anchor href=#_virtual_hosting></a></h4><div class=paragraph><p>Virtual hosting allows multiple websites to run on one Apache server. The virtual hosts can be <em>IP-based</em> or <em>name-based</em>. IP-based virtual hosting uses a different IP address for each website. Name-based virtual hosting uses the clients HTTP/1.1 headers to figure out the hostname, which allows the websites to share the same IP address.</p></div><div class=paragraph><p>To setup Apache to use name-based virtual hosting, add a <code>VirtualHost</code> block for each website. For example, for the webserver named <code>www.domain.tld</code> with a virtual domain of <code>www.someotherdomain.tld</code>, add the following entries to <span class=filename>httpd.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>&lt;VirtualHost *&gt;
    ServerName www.domain.tld
    DocumentRoot /www/domain.tld
&lt;/VirtualHost&gt;

&lt;VirtualHost *&gt;
    ServerName www.someotherdomain.tld
    DocumentRoot /www/someotherdomain.tld
&lt;/VirtualHost&gt;</pre></div></div><div class=paragraph><p>For each virtual host, replace the values for <code>ServerName</code> and <code>DocumentRoot</code> with the values to be used.</p></div><div class=paragraph><p>For more information about setting up virtual hosts, consult the official Apache documentation at: <a href=http://httpd.apache.org/docs/vhosts/>http://httpd.apache.org/docs/vhosts/</a>.</p></div></div><div class=sect3><h4 id=_apache_modules>29.8.3. Apache Modules<a class=anchor href=#_apache_modules></a></h4><div class=paragraph><p>Apache uses modules to augment the functionality provided by the basic server. Refer to <a href=http://httpd.apache.org/docs/current/mod/>http://httpd.apache.org/docs/current/mod/</a> for a complete listing of and the configuration details for the available modules.</p></div><div class=paragraph><p>In FreeBSD, some modules can be compiled with the <a class=package href=https://cgit.freebsd.org/ports/tree/www/apache24/>www/apache24</a> port. Type <code>make config</code> within <span class=filename>/usr/ports/www/apache24</span> to see which modules are available and which are enabled by default. If the module is not compiled with the port, the FreeBSD Ports Collection provides an easy way to install many modules. This section describes three of the most commonly used modules.</p></div><div class=sect4><h5 id=_mod_ssl>29.8.3.1. <span class=filename>mod_ssl</span><a class=anchor href=#_mod_ssl></a></h5><div class=paragraph><p>The <span class=filename>mod_ssl</span> module uses the OpenSSL library to provide strong cryptography via the Secure Sockets Layer (SSLv3) and Transport Layer Security (TLSv1) protocols. This module provides everything necessary to request a signed certificate from a trusted certificate signing authority to run a secure web server on FreeBSD.</p></div><div class=paragraph><p>In FreeBSD, <span class=filename>mod_ssl</span> module is enabled by default in both the package and the port. The available configuration directives are explained at <a href=http://httpd.apache.org/docs/current/mod/mod_ssl.html>http://httpd.apache.org/docs/current/mod/mod_ssl.html</a>.</p></div></div><div class=sect4><h5 id=_mod_perl>29.8.3.2. <span class=filename>mod_perl</span><a class=anchor href=#_mod_perl></a></h5><div class=paragraph><p>The <span class=filename>mod_perl</span> module makes it possible to write Apache modules in Perl. In addition, the persistent interpreter embedded in the server avoids the overhead of starting an external interpreter and the penalty of Perl start-up time.</p></div><div class=paragraph><p>The <span class=filename>mod_perl</span> can be installed using the <a class=package href=https://cgit.freebsd.org/ports/tree/www/mod_perl2/>www/mod_perl2</a> package or port. Documentation for using this module can be found at <a href=http://perl.apache.org/docs/2.0/index.html>http://perl.apache.org/docs/2.0/index.html</a>.</p></div></div><div class=sect4><h5 id=_mod_php>29.8.3.3. <span class=filename>mod_php</span><a class=anchor href=#_mod_php></a></h5><div class=paragraph><p><em>PHP: Hypertext Preprocessor</em> (PHP) is a general-purpose scripting language that is especially suited for web development. Capable of being embedded into HTML, its syntax draws upon C, Java™, and Perl with the intention of allowing web developers to write dynamically generated webpages quickly.</p></div><div class=paragraph><p>To gain support for PHP5 for the Apache web server, install the <a class=package href=https://cgit.freebsd.org/ports/tree/www/mod_php56/>www/mod_php56</a> package or port. This will install and configure the modules required to support dynamic PHP applications. The installation will automatically add this line to <span class=filename>/usr/local/etc/apache24/httpd.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>LoadModule php5_module        libexec/apache24/libphp5.so</pre></div></div><div class=paragraph><p>Then, perform a graceful restart to load the PHP module:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># apachectl graceful</span></code></pre></div></div><div class=paragraph><p>The PHP support provided by <a class=package href=https://cgit.freebsd.org/ports/tree/www/mod_php56/>www/mod_php56</a> is limited. Additional support can be installed using the <a class=package href=https://cgit.freebsd.org/ports/tree/lang/php56-extensions/>lang/php56-extensions</a> port which provides a menu driven interface to the available PHP extensions.</p></div><div class=paragraph><p>Alternatively, individual extensions can be installed using the appropriate port. For instance, to add PHP support for the MySQL database server, install <a class=package href=https://cgit.freebsd.org/ports/tree/databases/php56-mysql/>databases/php56-mysql</a>.</p></div><div class=paragraph><p>After installing an extension, the Apache server must be reloaded to pick up the new configuration changes:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># apachectl graceful</span></code></pre></div></div></div></div><div class=sect3><h4 id=_dynamic_websites>29.8.4. Dynamic Websites<a class=anchor href=#_dynamic_websites></a></h4><div class=paragraph><p>In addition to mod_perl and mod_php, other languages are available for creating dynamic web content. These include Django and Ruby on Rails.</p></div><div class=sect4><h5 id=_django>29.8.4.1. Django<a class=anchor href=#_django></a></h5><div class=paragraph><p>Django is a BSD-licensed framework designed to allow developers to write high performance, elegant web applications quickly. It provides an object-relational mapper so that data types are developed as Python objects. A rich dynamic database-access API is provided for those objects without the developer ever having to write SQL. It also provides an extensible template system so that the logic of the application is separated from the HTML presentation.</p></div><div class=paragraph><p>Django depends on <span class=filename>mod_python</span>, and an SQL database engine. In FreeBSD, the <a class=package href=https://cgit.freebsd.org/ports/tree/www/py-django/>www/py-django</a> port automatically installs <span class=filename>mod_python</span> and supports the PostgreSQL, MySQL, or SQLite databases, with the default being SQLite. To change the database engine, type <code>make config</code> within <span class=filename>/usr/ports/www/py-django</span>, then install the port.</p></div><div class=paragraph><p>Once Django is installed, the application will need a project directory along with the Apache configuration in order to use the embedded Python interpreter. This interpreter is used to call the application for specific URLs on the site.</p></div><div class=paragraph><p>To configure Apache to pass requests for certain URLs to the web application, add the following to <span class=filename>httpd.conf</span>, specifying the full path to the project directory:</p></div><div class="literalblock programlisting"><div class=content><pre>&lt;Location &#34;/&#34;&gt;
    SetHandler python-program
    PythonPath &#34;[&#39;/dir/to/the/django/packages/&#39;] + sys.path&#34;
    PythonHandler django.core.handlers.modpython
    SetEnv DJANGO_SETTINGS_MODULE mysite.settings
    PythonAutoReload On
    PythonDebug On
&lt;/Location&gt;</pre></div></div><div class=paragraph><p>Refer to <a href=https://docs.djangoproject.com>https://docs.djangoproject.com</a> for more information on how to use Django.</p></div></div><div class=sect4><h5 id=_ruby_on_rails>29.8.4.2. Ruby on Rails<a class=anchor href=#_ruby_on_rails></a></h5><div class=paragraph><p>Ruby on Rails is another open source web framework that provides a full development stack. It is optimized to make web developers more productive and capable of writing powerful applications quickly. On FreeBSD, it can be installed using the <a class=package href=https://cgit.freebsd.org/ports/tree/www/rubygem-rails/>www/rubygem-rails</a> package or port.</p></div><div class=paragraph><p>Refer to <a href=http://guides.rubyonrails.org>http://guides.rubyonrails.org</a> for more information on how to use Ruby on Rails.</p></div></div></div></div><div class=sect2><h3 id=network-ftp>29.9. File Transfer Protocol (FTP)<a class=anchor href=#network-ftp></a></h3><div class=paragraph><p>The File Transfer Protocol (FTP) provides users with a simple way to transfer files to and from an FTP server. FreeBSD includes FTP server software, ftpd, in the base system.</p></div><div class=paragraph><p>FreeBSD provides several configuration files for controlling access to the FTP server. This section summarizes these files. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=ftpd&amp;sektion=8&amp;format=html">ftpd(8)</a> for more details about the built-in FTP server.</p></div><div class=sect3><h4 id=_configuration_2>29.9.1. Configuration<a class=anchor href=#_configuration_2></a></h4><div class=paragraph><p>The most important configuration step is deciding which accounts will be allowed access to the FTP server. A FreeBSD system has a number of system accounts which should not be allowed FTP access. The list of users disallowed any FTP access can be found in <span class=filename>/etc/ftpusers</span>. By default, it includes system accounts. Additional users that should not be allowed access to FTP can be added.</p></div><div class=paragraph><p>In some cases it may be desirable to restrict the access of some users without preventing them completely from using FTP. This can be accomplished be creating <span class=filename>/etc/ftpchroot</span> as described in <a href="https://man.freebsd.org/cgi/man.cgi?query=ftpchroot&amp;sektion=5&amp;format=html">ftpchroot(5)</a>. This file lists users and groups subject to FTP access restrictions.</p></div><div class=paragraph><p>To enable anonymous FTP access to the server, create a user named <code>ftp</code> on the FreeBSD system. Users will then be able to log on to the FTP server with a username of <code>ftp</code> or <code>anonymous</code>. When prompted for the password, any input will be accepted, but by convention, an email address should be used as the password. The FTP server will call <a href="https://man.freebsd.org/cgi/man.cgi?query=chroot&amp;sektion=2&amp;format=html">chroot(2)</a> when an anonymous user logs in, to restrict access to only the home directory of the <code>ftp</code> user.</p></div><div class=paragraph><p>There are two text files that can be created to specify welcome messages to be displayed to FTP clients. The contents of <span class=filename>/etc/ftpwelcome</span> will be displayed to users before they reach the login prompt. After a successful login, the contents of <span class=filename>/etc/ftpmotd</span> will be displayed. Note that the path to this file is relative to the login environment, so the contents of <span class=filename>~ftp/etc/ftpmotd</span> would be displayed for anonymous users.</p></div><div class=paragraph><p>Once the FTP server has been configured, set the appropriate variable in <span class=filename>/etc/rc.conf</span> to start the service during boot:</p></div><div class="literalblock programlisting"><div class=content><pre>ftpd_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>To start the service now:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service ftpd start</span></code></pre></div></div><div class=paragraph><p>Test the connection to the FTP server by typing:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% ftp localhost</code></pre></div></div><div class=paragraph><p>The ftpd daemon uses <a href="https://man.freebsd.org/cgi/man.cgi?query=syslog&amp;sektion=3&amp;format=html">syslog(3)</a> to log messages. By default, the system log daemon will write messages related to FTP in <span class=filename>/var/log/xferlog</span>. The location of the FTP log can be modified by changing the following line in <span class=filename>/etc/syslog.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>ftp.info      /var/log/xferlog</pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Be aware of the potential problems involved with running an anonymous FTP server. In particular, think twice about allowing anonymous users to upload files. It may turn out that the FTP site becomes a forum for the trade of unlicensed commercial software or worse. If anonymous FTP uploads are required, then verify the permissions so that these files cannot be read by other anonymous users until they have been reviewed by an administrator.</p></div></td></tr></tbody></table></div></div></div><div class=sect2><h3 id=network-samba>29.10. File and Print Services for Microsoft® Windows® Clients (Samba)<a class=anchor href=#network-samba></a></h3><div class=paragraph><p>Samba is a popular open source software package that provides file and print services using the SMB/CIFS protocol. This protocol is built into Microsoft® Windows® systems. It can be added to non-Microsoft® Windows® systems by installing the Samba client libraries. The protocol allows clients to access shared data and printers. These shares can be mapped as a local disk drive and shared printers can be used as if they were local printers.</p></div><div class=paragraph><p>On FreeBSD, the Samba client libraries can be installed using the <a class=package href=https://cgit.freebsd.org/ports/tree/net/samba410/>net/samba410</a> port or package. The client provides the ability for a FreeBSD system to access SMB/CIFS shares in a Microsoft® Windows® network.</p></div><div class=paragraph><p>A FreeBSD system can also be configured to act as a Samba server by installing the same <a class=package href=https://cgit.freebsd.org/ports/tree/net/samba410/>net/samba410</a> port or package. This allows the administrator to create SMB/CIFS shares on the FreeBSD system which can be accessed by clients running Microsoft® Windows® or the Samba client libraries.</p></div><div class=sect3><h4 id=_server_configuration>29.10.1. Server Configuration<a class=anchor href=#_server_configuration></a></h4><div class=paragraph><p>Samba is configured in <span class=filename>/usr/local/etc/smb4.conf</span>. This file must be created before Samba can be used.</p></div><div class=paragraph><p>A simple <span class=filename>smb4.conf</span> to share directories and printers with Windows® clients in a workgroup is shown here. For more complex setups involving LDAP or Active Directory, it is easier to use <a href="https://man.freebsd.org/cgi/man.cgi?query=samba-tool&amp;sektion=8&amp;format=html">samba-tool(8)</a> to create the initial <span class=filename>smb4.conf</span>.</p></div><div class="literalblock programlisting"><div class=content><pre>[global]
workgroup = WORKGROUP
server string = Samba Server Version %v
netbios name = ExampleMachine
wins support = Yes
security = user
passdb backend = tdbsam

# Example: share /usr/src accessible only to &#39;developer&#39; user
[src]
path = /usr/src
valid users = developer
writable  = yes
browsable = yes
read only = no
guest ok = no
public = no
create mask = 0666
directory mask = 0755</pre></div></div><div class=sect4><h5 id=_global_settings>29.10.1.1. Global Settings<a class=anchor href=#_global_settings></a></h5><div class=paragraph><p>Settings that describe the network are added in <span class=filename>/usr/local/etc/smb4.conf</span>:</p></div><div class=dlist><dl><dt class=hdlist1><code>workgroup</code></dt><dd><p>The name of the workgroup to be served.</p></dd><dt class=hdlist1><code>netbios name</code></dt><dd><p>The NetBIOS name by which a Samba server is known. By default, it is the same as the first component of the host’s DNS name.</p></dd><dt class=hdlist1><code>server string</code></dt><dd><p>The string that will be displayed in the output of <code>net view</code> and some other networking tools that seek to display descriptive text about the server.</p></dd><dt class=hdlist1><code>wins support</code></dt><dd><p>Whether Samba will act as a WINS server. Do not enable support for WINS on more than one server on the network.</p></dd></dl></div></div><div class=sect4><h5 id=_security_settings>29.10.1.2. Security Settings<a class=anchor href=#_security_settings></a></h5><div class=paragraph><p>The most important settings in <span class=filename>/usr/local/etc/smb4.conf</span> are the security model and the backend password format. These directives control the options:</p></div><div class=dlist><dl><dt class=hdlist1><code>security</code></dt><dd><p>The most common settings are <code>security = share</code> and <code>security = user</code>. If the clients use usernames that are the same as their usernames on the FreeBSD machine, user level security should be used. This is the default security policy and it requires clients to first log on before they can access shared resources.</p><div class=paragraph><p>In share level security, clients do not need to log onto the server with a valid username and password before attempting to connect to a shared resource. This was the default security model for older versions of Samba.</p></div></dd><dt class=hdlist1><code>passdb backend</code></dt><dd><p>Samba has several different backend authentication models. Clients may be authenticated with LDAP, NIS+, an SQL database, or a modified password file. The recommended authentication method, <code>tdbsam</code>, is ideal for simple networks and is covered here. For larger or more complex networks, <code>ldapsam</code> is recommended. <code>smbpasswd</code> was the former default and is now obsolete.</p></dd></dl></div></div><div class=sect4><h5 id=_samba_users>29.10.1.3. Samba Users<a class=anchor href=#_samba_users></a></h5><div class=paragraph><p>FreeBSD user accounts must be mapped to the <code>SambaSAMAccount</code> database for Windows® clients to access the share. Map existing FreeBSD user accounts using <a href="https://man.freebsd.org/cgi/man.cgi?query=pdbedit&amp;sektion=8&amp;format=html">pdbedit(8)</a>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pdbedit -a username</span></code></pre></div></div><div class=paragraph><p>This section has only mentioned the most commonly used settings. Refer to the <a href=https://wiki.samba.org>Official Samba Wiki</a> for additional information about the available configuration options.</p></div></div></div><div class=sect3><h4 id=_starting_samba>29.10.2. Starting Samba<a class=anchor href=#_starting_samba></a></h4><div class=paragraph><p>To enable Samba at boot time, add the following line to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>samba_server_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>To start Samba now:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service samba_server start</span>
Performing sanity check on Samba configuration: OK
Starting nmbd.
Starting smbd.</code></pre></div></div><div class=paragraph><p>Samba consists of three separate daemons. Both the nmbd and smbd daemons are started by <code>samba_enable</code>. If winbind name resolution is also required, set:</p></div><div class="literalblock programlisting"><div class=content><pre>winbindd_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>Samba can be stopped at any time by typing:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service samba_server stop</span></code></pre></div></div><div class=paragraph><p>Samba is a complex software suite with functionality that allows broad integration with Microsoft® Windows® networks. For more information about functionality beyond the basic configuration described here, refer to <a href=https://www.samba.org>https://www.samba.org</a>.</p></div></div></div><div class=sect2><h3 id=network-ntp>29.11. Clock Synchronization with NTP<a class=anchor href=#network-ntp></a></h3><div class=paragraph><p>Over time, a computer’s clock is prone to drift. This is problematic as many network services require the computers on a network to share the same accurate time. Accurate time is also needed to ensure that file timestamps stay consistent. The Network Time Protocol (NTP) is one way to provide clock accuracy in a network.</p></div><div class=paragraph><p>FreeBSD includes <a href="https://man.freebsd.org/cgi/man.cgi?query=ntpd&amp;sektion=8&amp;format=html">ntpd(8)</a> which can be configured to query other NTP servers to synchronize the clock on that machine or to provide time services to other computers in the network.</p></div><div class=paragraph><p>This section describes how to configure ntpd on FreeBSD. Further documentation can be found in <span class=filename>/usr/shared/doc/ntp/</span> in HTML format.</p></div><div class=sect3><h4 id=_ntp_configuration>29.11.1. NTP Configuration<a class=anchor href=#_ntp_configuration></a></h4><div class=paragraph><p>On FreeBSD, the built-in ntpd can be used to synchronize a system’s clock. Ntpd is configured using <a href="https://man.freebsd.org/cgi/man.cgi?query=rc.conf&amp;sektion=5&amp;format=html">rc.conf(5)</a> variables and <span class=filename>/etc/ntp.conf</span>, as detailed in the following sections.</p></div><div class=paragraph><p>Ntpd communicates with its network peers using UDP packets. Any firewalls between your machine and its NTP peers must be configured to allow UDP packets in and out on port 123.</p></div><div class=sect4><h5 id=_the_etcntp_conf_file>29.11.1.1. The <span class=filename>/etc/ntp.conf</span> file<a class=anchor href=#_the_etcntp_conf_file></a></h5><div class=paragraph><p>Ntpd reads <span class=filename>/etc/ntp.conf</span> to determine which NTP servers to query. Choosing several NTP servers is recommended in case one of the servers becomes unreachable or its clock proves unreliable. As ntpd receives responses, it favors reliable servers over the less reliable ones. The servers which are queried can be local to the network, provided by an ISP, or selected from an <a href=http://support.ntp.org/bin/view/Servers/WebHome>online list of publicly accessible NTP servers</a>. When choosing a public NTP server, select one that is geographically close and review its usage policy. The <code>pool</code> configuration keyword selects one or more servers from a pool of servers. An <a href=http://support.ntp.org/bin/view/Servers/NTPPoolServers>online list of publicly accessible NTP pools</a> is available, organized by geographic area. In addition, FreeBSD provides a project-sponsored pool, <code>0.freebsd.pool.ntp.org</code>.</p></div><div class=exampleblock><div class=title>Przykład 28. Sample <span class=filename>/etc/ntp.conf</span></div><div class=content><div class=paragraph><p>This is a simple example of an <span class=filename>ntp.conf</span> file. It can safely be used as-is; it contains the recommended <code>restrict</code> options for operation on a publicly-accessible network connection.</p></div><div class="literalblock programlisting"><div class=content><pre># Disallow ntpq control/query access.  Allow peers to be added only
# based on pool and server statements in this file.
restrict default limited kod nomodify notrap noquery nopeer
restrict source  limited kod nomodify notrap noquery

# Allow unrestricted access from localhost for queries and control.
restrict 127.0.0.1
restrict ::1

# Add a specific server.
server ntplocal.example.com iburst

# Add FreeBSD pool servers until 3-6 good servers are available.
tos minclock 3 maxclock 6
pool 0.freebsd.pool.ntp.org iburst

# Use a local leap-seconds file.
leapfile &#34;/var/db/ntpd.leap-seconds.list&#34;</pre></div></div></div></div><div class=paragraph><p>The format of this file is described in <a href="https://man.freebsd.org/cgi/man.cgi?query=ntp.conf&amp;sektion=5&amp;format=html">ntp.conf(5)</a>. The descriptions below provide a quick overview of just the keywords used in the sample file above.</p></div><div class=paragraph><p>By default, an NTP server is accessible to any network host. The <code>restrict</code> keyword controls which systems can access the server. Multiple <code>restrict</code> entries are supported, each one refining the restrictions given in previous statements. The values shown in the example grant the local system full query and control access, while allowing remote systems only the ability to query the time. For more details, refer to the <code>Access Control Support</code> subsection of <a href="https://man.freebsd.org/cgi/man.cgi?query=ntp.conf&amp;sektion=5&amp;format=html">ntp.conf(5)</a>.</p></div><div class=paragraph><p>The <code>server</code> keyword specifies a single server to query. The file can contain multiple server keywords, with one server listed on each line. The <code>pool</code> keyword specifies a pool of servers. Ntpd will add one or more servers from this pool as needed to reach the number of peers specified using the <code>tos minclock</code> value. The <code>iburst</code> keyword directs ntpd to perform a burst of eight quick packet exchanges with a server when contact is first established, to help quickly synchronize system time.</p></div><div class=paragraph><p>The <code>leapfile</code> keyword specifies the location of a file containing information about leap seconds. The file is updated automatically by <a href="https://man.freebsd.org/cgi/man.cgi?query=periodic&amp;sektion=8&amp;format=html">periodic(8)</a>. The file location specified by this keyword must match the location set in the <code>ntp_db_leapfile</code> variable in <span class=filename>/etc/rc.conf</span>.</p></div></div><div class=sect4><h5 id=_ntp_entries_in_etcrc_conf>29.11.1.2. NTP entries in <span class=filename>/etc/rc.conf</span><a class=anchor href=#_ntp_entries_in_etcrc_conf></a></h5><div class=paragraph><p>Set <code>ntpd_enable=YES</code> to start ntpd at boot time. Once <code>ntpd_enable=YES</code> has been added to <span class=filename>/etc/rc.conf</span>, ntpd can be started immediately without rebooting the system by typing:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service ntpd start</span></code></pre></div></div><div class=paragraph><p>Only <code>ntpd_enable</code> must be set to use ntpd. The <span class=filename>rc.conf</span> variables listed below may also be set as needed.</p></div><div class=paragraph><p>Set <code>ntpd_sync_on_start=YES</code> to allow ntpd to step the clock any amount, one time at startup. Normally ntpd will log an error message and exit if the clock is off by more than 1000 seconds. This option is especially useful on systems without a battery-backed realtime clock.</p></div><div class=paragraph><p>Set <code>ntpd_oomprotect=YES</code> to protect the ntpd daemon from being killed by the system attempting to recover from an Out Of Memory (OOM) condition.</p></div><div class=paragraph><p>Set <code>ntpd_config=</code> to the location of an alternate <span class=filename>ntp.conf</span> file.</p></div><div class=paragraph><p>Set <code>ntpd_flags=</code> to contain any other ntpd flags as needed, but avoid using these flags which are managed internally by <span class=filename>/etc/rc.d/ntpd</span>:</p></div><div class=ulist><ul><li><p><code>-p</code> (pid file location)</p></li><li><p><code>-c</code> (set <code>ntpd_config=</code> instead)</p></li></ul></div></div><div class=sect4><h5 id=_ntpd_and_the_unpriveleged_ntpd_user>29.11.1.3. Ntpd and the unpriveleged <code>ntpd</code> user<a class=anchor href=#_ntpd_and_the_unpriveleged_ntpd_user></a></h5><div class=paragraph><p>Ntpd on FreeBSD can start and run as an unpriveleged user. Doing so requires the <a href="https://man.freebsd.org/cgi/man.cgi?query=mac_none&amp;sektion=4&amp;format=html">mac_none(4)</a> policy module. The <span class=filename>/etc/rc.d/ntpd</span> startup script first examines the NTP configuration. If possible, it loads the <code>mac_ntpd</code> module, then starts ntpd as unpriveleged user <code>ntpd</code> (user id 123). To avoid problems with file and directory access, the startup script will not automatically start ntpd as <code>ntpd</code> when the configuration contains any file-related options.</p></div><div class=paragraph><p>The presence of any of the following in <code>ntpd_flags</code> requires manual configuration as described below to run as the <code>ntpd</code> user:</p></div><div class=ulist><ul><li><p>-f or --driftfile</p></li><li><p>-i or --jaildir</p></li><li><p>-k or --keyfile</p></li><li><p>-l or --logfile</p></li><li><p>-s or --statsdir</p></li></ul></div><div class=paragraph><p>The presence of any of the following keywords in <span class=filename>ntp.conf</span> requires manual configuration as described below to run as the <code>ntpd</code> user:</p></div><div class=ulist><ul><li><p>crypto</p></li><li><p>driftfile</p></li><li><p>key</p></li><li><p>logdir</p></li><li><p>statsdir</p></li></ul></div><div class=paragraph><p>To manually configure ntpd to run as user <code>ntpd</code> you must:</p></div><div class=ulist><ul><li><p>Ensure that the <code>ntpd</code> user has access to all the files and directories specified in the configuration.</p></li><li><p>Arrange for the <code>mac_ntpd</code> module to be loaded or compiled into the kernel. See <a href="https://man.freebsd.org/cgi/man.cgi?query=mac_none&amp;sektion=4&amp;format=html">mac_none(4)</a> for details.</p></li><li><p>Set <code>ntpd_user="ntpd"</code> in <span class=filename>/etc/rc.conf</span></p></li></ul></div></div></div><div class=sect3><h4 id=_using_ntp_with_a_ppp_connection>29.11.2. Using NTP with a PPP Connection<a class=anchor href=#_using_ntp_with_a_ppp_connection></a></h4><div class=paragraph><p>ntpd does not need a permanent connection to the Internet to function properly. However, if a PPP connection is configured to dial out on demand, NTP traffic should be prevented from triggering a dial out or keeping the connection alive. This can be configured with <code>filter</code> directives in <span class=filename>/etc/ppp/ppp.conf</span>. For example:</p></div><div class="literalblock programlisting"><div class=content><pre>set filter dial 0 deny udp src eq 123
# Prevent NTP traffic from initiating dial out
set filter dial 1 permit 0 0
set filter alive 0 deny udp src eq 123
# Prevent incoming NTP traffic from keeping the connection open
set filter alive 1 deny udp dst eq 123
# Prevent outgoing NTP traffic from keeping the connection open
set filter alive 2 permit 0/0 0/0</pre></div></div><div class=paragraph><p>For more details, refer to the <code>PACKET FILTERING</code> section in <a href="https://man.freebsd.org/cgi/man.cgi?query=ppp&amp;sektion=8&amp;format=html">ppp(8)</a> and the examples in <span class=filename>/usr/shared/examples/ppp/</span>.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Some Internet access providers block low-numbered ports, preventing NTP from functioning since replies never reach the machine.</p></div></td></tr></tbody></table></div></div></div><div class=sect2><h3 id=network-iscsi>29.12. iSCSI Initiator and Target Configuration<a class=anchor href=#network-iscsi></a></h3><div class=paragraph><p>iSCSI is a way to share storage over a network. Unlike NFS, which works at the file system level, iSCSI works at the block device level.</p></div><div class=paragraph><p>In iSCSI terminology, the system that shares the storage is known as the <em>target</em>. The storage can be a physical disk, or an area representing multiple disks or a portion of a physical disk. For example, if the disk(s) are formatted with ZFS, a zvol can be created to use as the iSCSI storage.</p></div><div class=paragraph><p>The clients which access the iSCSI storage are called <em>initiators</em>. To initiators, the storage available through iSCSI appears as a raw, unformatted disk known as a LUN. Device nodes for the disk appear in <span class=filename>/dev/</span> and the device must be separately formatted and mounted.</p></div><div class=paragraph><p>FreeBSD provides a native, kernel-based iSCSI target and initiator. This section describes how to configure a FreeBSD system as a target or an initiator.</p></div><div class=sect3><h4 id=network-iscsi-target>29.12.1. Configuring an iSCSI Target<a class=anchor href=#network-iscsi-target></a></h4><div class=paragraph><p>To configure an iSCSI target, create the <span class=filename>/etc/ctl.conf</span> configuration file, add a line to <span class=filename>/etc/rc.conf</span> to make sure the <a href="https://man.freebsd.org/cgi/man.cgi?query=ctld&amp;sektion=8&amp;format=html">ctld(8)</a> daemon is automatically started at boot, and then start the daemon.</p></div><div class=paragraph><p>The following is an example of a simple <span class=filename>/etc/ctl.conf</span> configuration file. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=ctl.conf&amp;sektion=5&amp;format=html">ctl.conf(5)</a> for a more complete description of this file’s available options.</p></div><div class="literalblock programlisting"><div class=content><pre>portal-group pg0 {
	discovery-auth-group no-authentication
	listen 0.0.0.0
	listen [::]
}

target iqn.2012-06.com.example:target0 {
	auth-group no-authentication
	portal-group pg0

	lun 0 {
		path /data/target0-0
		size 4G
	}
}</pre></div></div><div class=paragraph><p>The first entry defines the <code>pg0</code> portal group. Portal groups define which network addresses the <a href="https://man.freebsd.org/cgi/man.cgi?query=ctld&amp;sektion=8&amp;format=html">ctld(8)</a> daemon will listen on. The <code>discovery-auth-group no-authentication</code> entry indicates that any initiator is allowed to perform iSCSI target discovery without authentication. Lines three and four configure <a href="https://man.freebsd.org/cgi/man.cgi?query=ctld&amp;sektion=8&amp;format=html">ctld(8)</a> to listen on all IPv4 (<code>listen 0.0.0.0</code>) and IPv6 (<code>listen [::]</code>) addresses on the default port of 3260.</p></div><div class=paragraph><p>It is not necessary to define a portal group as there is a built-in portal group called <code>default</code>. In this case, the difference between <code>default</code> and <code>pg0</code> is that with <code>default</code>, target discovery is always denied, while with <code>pg0</code>, it is always allowed.</p></div><div class=paragraph><p>The second entry defines a single target. Target has two possible meanings: a machine serving iSCSI or a named group of LUNs. This example uses the latter meaning, where <code>iqn.2012-06.com.example:target0</code> is the target name. This target name is suitable for testing purposes. For actual use, change <code>com.example</code> to the real domain name, reversed. The <code>2012-06</code> represents the year and month of acquiring control of that domain name, and <code>target0</code> can be any value. Any number of targets can be defined in this configuration file.</p></div><div class=paragraph><p>The <code>auth-group no-authentication</code> line allows all initiators to connect to the specified target and <code>portal-group pg0</code> makes the target reachable through the <code>pg0</code> portal group.</p></div><div class=paragraph><p>The next section defines the LUN. To the initiator, each LUN will be visible as a separate disk device. Multiple LUNs can be defined for each target. Each LUN is identified by a number, where LUN 0 is mandatory. The <code>path /data/target0-0</code> line defines the full path to a file or zvol backing the LUN. That path must exist before starting <a href="https://man.freebsd.org/cgi/man.cgi?query=ctld&amp;sektion=8&amp;format=html">ctld(8)</a>. The second line is optional and specifies the size of the LUN.</p></div><div class=paragraph><p>Next, to make sure the <a href="https://man.freebsd.org/cgi/man.cgi?query=ctld&amp;sektion=8&amp;format=html">ctld(8)</a> daemon is started at boot, add this line to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>ctld_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>To start <a href="https://man.freebsd.org/cgi/man.cgi?query=ctld&amp;sektion=8&amp;format=html">ctld(8)</a> now, run this command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service ctld start</span></code></pre></div></div><div class=paragraph><p>As the <a href="https://man.freebsd.org/cgi/man.cgi?query=ctld&amp;sektion=8&amp;format=html">ctld(8)</a> daemon is started, it reads <span class=filename>/etc/ctl.conf</span>. If this file is edited after the daemon starts, use this command so that the changes take effect immediately:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service ctld reload</span></code></pre></div></div><div class=sect4><h5 id=_authentication>29.12.1.1. Authentication<a class=anchor href=#_authentication></a></h5><div class=paragraph><p>The previous example is inherently insecure as it uses no authentication, granting anyone full access to all targets. To require a username and password to access targets, modify the configuration as follows:</p></div><div class="literalblock programlisting"><div class=content><pre>auth-group ag0 {
	chap username1 secretsecret
	chap username2 anothersecret
}

portal-group pg0 {
	discovery-auth-group no-authentication
	listen 0.0.0.0
	listen [::]
}

target iqn.2012-06.com.example:target0 {
	auth-group ag0
	portal-group pg0
	lun 0 {
		path /data/target0-0
		size 4G
	}
}</pre></div></div><div class=paragraph><p>The <code>auth-group</code> section defines username and password pairs. An initiator trying to connect to <code>iqn.2012-06.com.example:target0</code> must first specify a defined username and secret. However, target discovery is still permitted without authentication. To require target discovery authentication, set <code>discovery-auth-group</code> to a defined <code>auth-group</code> name instead of <code>no-authentication</code>.</p></div><div class=paragraph><p>It is common to define a single exported target for every initiator. As a shorthand for the syntax above, the username and password can be specified directly in the target entry:</p></div><div class="literalblock programlisting"><div class=content><pre>target iqn.2012-06.com.example:target0 {
	portal-group pg0
	chap username1 secretsecret

	lun 0 {
		path /data/target0-0
		size 4G
	}
}</pre></div></div></div></div><div class=sect3><h4 id=network-iscsi-initiator>29.12.2. Configuring an iSCSI Initiator<a class=anchor href=#network-iscsi-initiator></a></h4><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>The iSCSI initiator described in this section is supported starting with FreeBSD 10.0-RELEASE. To use the iSCSI initiator available in older versions, refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=iscontrol&amp;sektion=8&amp;format=html">iscontrol(8)</a>.</p></div></td></tr></tbody></table></div><div class=paragraph><p>The iSCSI initiator requires that the <a href="https://man.freebsd.org/cgi/man.cgi?query=iscsid&amp;sektion=8&amp;format=html">iscsid(8)</a> daemon is running. This daemon does not use a configuration file. To start it automatically at boot, add this line to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>iscsid_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>To start <a href="https://man.freebsd.org/cgi/man.cgi?query=iscsid&amp;sektion=8&amp;format=html">iscsid(8)</a> now, run this command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service iscsid start</span></code></pre></div></div><div class=paragraph><p>Connecting to a target can be done with or without an <span class=filename>/etc/iscsi.conf</span> configuration file. This section demonstrates both types of connections.</p></div><div class=sect4><h5 id=_connecting_to_a_target_without_a_configuration_file>29.12.2.1. Connecting to a Target Without a Configuration File<a class=anchor href=#_connecting_to_a_target_without_a_configuration_file></a></h5><div class=paragraph><p>To connect an initiator to a single target, specify the IP address of the portal and the name of the target:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># iscsictl -A -p 10.10.10.10 -t iqn.2012-06.com.example:target0</span></code></pre></div></div><div class=paragraph><p>To verify if the connection succeeded, run <code>iscsictl</code> without any arguments. The output should look similar to this:</p></div><div class="literalblock programlisting"><div class=content><pre>Target name                                     Target portal   State
iqn.2012-06.com.example:target0                 10.10.10.10     Connected: da0</pre></div></div><div class=paragraph><p>In this example, the iSCSI session was successfully established, with <span class=filename>/dev/da0</span> representing the attached LUN. If the <code>iqn.2012-06.com.example:target0</code> target exports more than one LUN, multiple device nodes will be shown in that section of the output:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>Connected: da0 da1 da2.</code></pre></div></div><div class=paragraph><p>Any errors will be reported in the output, as well as the system logs. For example, this message usually means that the <a href="https://man.freebsd.org/cgi/man.cgi?query=iscsid&amp;sektion=8&amp;format=html">iscsid(8)</a> daemon is not running:</p></div><div class="literalblock programlisting"><div class=content><pre>Target name                                     Target portal   State
iqn.2012-06.com.example:target0                 10.10.10.10     Waiting for iscsid(8)</pre></div></div><div class=paragraph><p>The following message suggests a networking problem, such as a wrong IP address or port:</p></div><div class="literalblock programlisting"><div class=content><pre>Target name                                     Target portal   State
iqn.2012-06.com.example:target0                 10.10.10.11     Connection refused</pre></div></div><div class=paragraph><p>This message means that the specified target name is wrong:</p></div><div class="literalblock programlisting"><div class=content><pre>Target name                                     Target portal   State
iqn.2012-06.com.example:target0                 10.10.10.10     Not found</pre></div></div><div class=paragraph><p>This message means that the target requires authentication:</p></div><div class="literalblock programlisting"><div class=content><pre>Target name                                     Target portal   State
iqn.2012-06.com.example:target0                 10.10.10.10     Authentication failed</pre></div></div><div class=paragraph><p>To specify a CHAP username and secret, use this syntax:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># iscsictl -A -p 10.10.10.10 -t iqn.2012-06.com.example:target0 -u user -s secretsecret</span></code></pre></div></div></div><div class=sect4><h5 id=_connecting_to_a_target_with_a_configuration_file>29.12.2.2. Connecting to a Target with a Configuration File<a class=anchor href=#_connecting_to_a_target_with_a_configuration_file></a></h5><div class=paragraph><p>To connect using a configuration file, create <span class=filename>/etc/iscsi.conf</span> with contents like this:</p></div><div class="literalblock programlisting"><div class=content><pre>t0 {
	TargetAddress   = 10.10.10.10
	TargetName      = iqn.2012-06.com.example:target0
	AuthMethod      = CHAP
	chapIName       = user
	chapSecret      = secretsecret
}</pre></div></div><div class=paragraph><p>The <code>t0</code> specifies a nickname for the configuration file section. It will be used by the initiator to specify which configuration to use. The other lines specify the parameters to use during connection. The <code>TargetAddress</code> and <code>TargetName</code> are mandatory, whereas the other options are optional. In this example, the CHAP username and secret are shown.</p></div><div class=paragraph><p>To connect to the defined target, specify the nickname:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># iscsictl -An t0</span></code></pre></div></div><div class=paragraph><p>Alternately, to connect to all targets defined in the configuration file, use:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># iscsictl -Aa</span></code></pre></div></div><div class=paragraph><p>To make the initiator automatically connect to all targets in <span class=filename>/etc/iscsi.conf</span>, add the following to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>iscsictl_enable=&#34;YES&#34;
iscsictl_flags=&#34;-Aa&#34;</pre></div></div></div></div></div></div></div><div class=sect1><h2 id=firewalls>Rozdział 30. Firewalls<a class=anchor href=#firewalls></a></h2><div class=sectionbody><div class=sect2><h3 id=firewalls-intro>30.1. Synopsis<a class=anchor href=#firewalls-intro></a></h3><div class=paragraph><p>Firewalls make it possible to filter the incoming and outgoing traffic that flows through a system. A firewall can use one or more sets of "rules" to inspect network packets as they come in or go out of network connections and either allows the traffic through or blocks it. The rules of a firewall can inspect one or more characteristics of the packets such as the protocol type, source or destination host address, and source or destination port.</p></div><div class=paragraph><p>Firewalls can enhance the security of a host or a network. They can be used to do one or more of the following:</p></div><div class=ulist><ul><li><p>Protect and insulate the applications, services, and machines of an internal network from unwanted traffic from the public Internet.</p></li><li><p>Limit or disable access from hosts of the internal network to services of the public Internet.</p></li><li><p>Support network address translation (NAT), which allows an internal network to use private IP addresses and share a single connection to the public Internet using either a single IP address or a shared pool of automatically assigned public addresses.</p></li></ul></div><div class=paragraph><p>FreeBSD has three firewalls built into the base system: PF, IPFW, and IPFILTER, also known as IPF. FreeBSD also provides two traffic shapers for controlling bandwidth usage: <a href="https://man.freebsd.org/cgi/man.cgi?query=altq&amp;sektion=4&amp;format=html">altq(4)</a> and <a href="https://man.freebsd.org/cgi/man.cgi?query=dummynet&amp;sektion=4&amp;format=html">dummynet(4)</a>. ALTQ has traditionally been closely tied with PF and dummynet with IPFW. Each firewall uses rules to control the access of packets to and from a FreeBSD system, although they go about it in different ways and each has a different rule syntax.</p></div><div class=paragraph><p>FreeBSD provides multiple firewalls in order to meet the different requirements and preferences for a wide variety of users. Each user should evaluate which firewall best meets their needs.</p></div><div class=paragraph><p>After reading this chapter, you will know:</p></div><div class=ulist><ul><li><p>How to define packet filtering rules.</p></li><li><p>The differences between the firewalls built into FreeBSD.</p></li><li><p>How to use and configure the PF firewall.</p></li><li><p>How to use and configure the IPFW firewall.</p></li><li><p>How to use and configure the IPFILTER firewall.</p></li></ul></div><div class=paragraph><p>Before reading this chapter, you should:</p></div><div class=ulist><ul><li><p>Understand basic FreeBSD and Internet concepts.</p></li></ul></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Since all firewalls are based on inspecting the values of selected packet control fields, the creator of the firewall ruleset must have an understanding of how TCP/IP works, what the different values in the packet control fields are, and how these values are used in a normal session conversation. For a good introduction, refer to <a href=http://www.ipprimer.com>Daryl’s TCP/IP Primer</a>.</p></div></td></tr></tbody></table></div></div><div class=sect2><h3 id=firewalls-concepts>30.2. Firewall Concepts<a class=anchor href=#firewalls-concepts></a></h3><div class=paragraph><p>A ruleset contains a group of rules which pass or block packets based on the values contained in the packet. The bi-directional exchange of packets between hosts comprises a session conversation. The firewall ruleset processes both the packets arriving from the public Internet, as well as the packets produced by the system as a response to them. Each TCP/IP service is predefined by its protocol and listening port. Packets destined for a specific service originate from the source address using an unprivileged port and target the specific service port on the destination address. All the above parameters can be used as selection criteria to create rules which will pass or block services.</p></div><div class=paragraph><p>To lookup unknown port numbers, refer to <span class=filename>/etc/services</span>. Alternatively, visit <a href=http://en.wikipedia.org/wiki/List_of_TCP_and_UDP_port_numbers>http://en.wikipedia.org/wiki/List_of_TCP_and_UDP_port_numbers</a> and do a port number lookup to find the purpose of a particular port number.</p></div><div class=paragraph><p>Check out this link for <a href=http://web.archive.org/web/20150803024617/http://www.sans.org/security-resources/idfaq/oddports.php>port numbers used by Trojans</a>.</p></div><div class=paragraph><p>FTP has two modes: active mode and passive mode. The difference is in how the data channel is acquired. Passive mode is more secure as the data channel is acquired by the ordinal ftp session requester. For a good explanation of FTP and the different modes, see <a href=http://www.slacksite.com/other/ftp.html>http://www.slacksite.com/other/ftp.html</a>.</p></div><div class=paragraph><p>A firewall ruleset can be either "exclusive" or "inclusive". An exclusive firewall allows all traffic through except for the traffic matching the ruleset. An inclusive firewall does the reverse as it only allows traffic matching the rules through and blocks everything else.</p></div><div class=paragraph><p>An inclusive firewall offers better control of the outgoing traffic, making it a better choice for systems that offer services to the public Internet. It also controls the type of traffic originating from the public Internet that can gain access to a private network. All traffic that does not match the rules is blocked and logged. Inclusive firewalls are generally safer than exclusive firewalls because they significantly reduce the risk of allowing unwanted traffic.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Unless noted otherwise, all configuration and example rulesets in this chapter create inclusive firewall rulesets.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Security can be tightened further using a "stateful firewall". This type of firewall keeps track of open connections and only allows traffic which either matches an existing connection or opens a new, allowed connection.</p></div><div class=paragraph><p>Stateful filtering treats traffic as a bi-directional exchange of packets comprising a session. When state is specified on a matching rule the firewall dynamically generates internal rules for each anticipated packet being exchanged during the session. It has sufficient matching capabilities to determine if a packet is valid for a session. Any packets that do not properly fit the session template are automatically rejected.</p></div><div class=paragraph><p>When the session completes, it is removed from the dynamic state table.</p></div><div class=paragraph><p>Stateful filtering allows one to focus on blocking/passing new sessions. If the new session is passed, all its subsequent packets are allowed automatically and any impostor packets are automatically rejected. If a new session is blocked, none of its subsequent packets are allowed. Stateful filtering provides advanced matching abilities capable of defending against the flood of different attack methods employed by attackers.</p></div><div class=paragraph><p>NAT stands for <em>Network Address Translation</em>. NAT function enables the private LAN behind the firewall to share a single ISP-assigned IP address, even if that address is dynamically assigned. NAT allows each computer in the LAN to have Internet access, without having to pay the ISP for multiple Internet accounts or IP addresses.</p></div><div class=paragraph><p>NAT will automatically translate the private LAN IP address for each system on the LAN to the single public IP address as packets exit the firewall bound for the public Internet. It also performs the reverse translation for returning packets.</p></div><div class=paragraph><p>According to RFC 1918, the following IP address ranges are reserved for private networks which will never be routed directly to the public Internet, and therefore are available for use with NAT:</p></div><div class=ulist><ul><li><p><code>10.0.0.0/8</code>.</p></li><li><p><code>172.16.0.0/12</code>.</p></li><li><p><code>192.168.0.0/16</code>.</p></li></ul></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>When working with the firewall rules, be <em>very careful</em>. Some configurations <em>can lock the administrator out</em> of the server. To be on the safe side, consider performing the initial firewall configuration from the local console rather than doing it remotely over ssh.</p></div></td></tr></tbody></table></div></div><div class=sect2><h3 id=firewalls-pf>30.3. PF<a class=anchor href=#firewalls-pf></a></h3><div class=paragraph><p>Since FreeBSD 5.3, a ported version of OpenBSD’s PF firewall has been included as an integrated part of the base system. PF is a complete, full-featured firewall that has optional support for ALTQ (Alternate Queuing), which provides Quality of Service (QoS).</p></div><div class=paragraph><p>The OpenBSD Project maintains the definitive reference for PF in the <a href=http://www.openbsd.org/faq/pf/>PF FAQ</a>. Peter Hansteen maintains a thorough PF tutorial at <a href=http://home.nuug.no/~peter/pf/>http://home.nuug.no/~peter/pf/</a>.</p></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>When reading the <a href=http://www.openbsd.org/faq/pf/>PF FAQ</a>, keep in mind that FreeBSD’s version of PF has diverged substantially from the upstream OpenBSD version over the years. Not all features work the same way on FreeBSD as they do in OpenBSD and vice versa.</p></div></td></tr></tbody></table></div><div class=paragraph><p>The <a href=https://lists.FreeBSD.org/subscription/freebsd-pf>FreeBSD packet filter mailing list</a> is a good place to ask questions about configuring and running the PF firewall. Check the mailing list archives before asking a question as it may have already been answered.</p></div><div class=paragraph><p>This section of the Handbook focuses on PF as it pertains to FreeBSD. It demonstrates how to enable PF and ALTQ. It also provides several examples for creating rulesets on a FreeBSD system.</p></div><div class=sect3><h4 id=_enabling_pf>30.3.1. Enabling PF<a class=anchor href=#_enabling_pf></a></h4><div class=paragraph><p>To use PF, its kernel module must be first loaded. This section describes the entries that can be added to <span class=filename>/etc/rc.conf</span> to enable PF.</p></div><div class=paragraph><p>Start by adding <code>pf_enable=yes</code> to <span class=filename>/etc/rc.conf</span>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sysrc pf_enable=yes</span></code></pre></div></div><div class=paragraph><p>Additional options, described in <a href="https://man.freebsd.org/cgi/man.cgi?query=pfctl&amp;sektion=8&amp;format=html">pfctl(8)</a>, can be passed to PF when it is started. Add or change this entry in <span class=filename>/etc/rc.conf</span> and specify any required flags between the two quotes (<code>""</code>):</p></div><div class="literalblock programlisting"><div class=content><pre>pf_flags=&#34;&#34;                     # additional flags for pfctl startup</pre></div></div><div class=paragraph><p>PF will not start if it cannot find its ruleset configuration file. By default, FreeBSD does not ship with a ruleset and there is no <span class=filename>/etc/pf.conf</span>. Example rulesets can be found in <span class=filename>/usr/shared/examples/pf/</span>. If a custom ruleset has been saved somewhere else, add a line to <span class=filename>/etc/rc.conf</span> which specifies the full path to the file:</p></div><div class="literalblock programlisting"><div class=content><pre>pf_rules=&#34;/path/to/pf.conf&#34;</pre></div></div><div class=paragraph><p>Logging support for PF is provided by <a href="https://man.freebsd.org/cgi/man.cgi?query=pflog&amp;sektion=4&amp;format=html">pflog(4)</a>. To enable logging support, add <code>pflog_enable=yes</code> to <span class=filename>/etc/rc.conf</span>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sysrc pflog_enable=yes</span></code></pre></div></div><div class=paragraph><p>The following lines can also be added to change the default location of the log file or to specify any additional flags to pass to <a href="https://man.freebsd.org/cgi/man.cgi?query=pflog&amp;sektion=4&amp;format=html">pflog(4)</a> when it is started:</p></div><div class="literalblock programlisting"><div class=content><pre>pflog_logfile=&#34;/var/log/pflog&#34;  # where pflogd should store the logfile
pflog_flags=&#34;&#34;                  # additional flags for pflogd startup</pre></div></div><div class=paragraph><p>Finally, if there is a LAN behind the firewall and packets need to be forwarded for the computers on the LAN, or NAT is required, enable the following option:</p></div><div class="literalblock programlisting"><div class=content><pre>gateway_enable=&#34;YES&#34;            # Enable as LAN gateway</pre></div></div><div class=paragraph><p>After saving the needed edits, PF can be started with logging support by typing:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service pf start</span>
<span class=c># service pflog start</span></code></pre></div></div><div class=paragraph><p>By default, PF reads its configuration rules from <span class=filename>/etc/pf.conf</span> and modifies, drops, or passes packets according to the rules or definitions specified in this file. The FreeBSD installation includes several sample files located in <span class=filename>/usr/shared/examples/pf/</span>. Refer to the <a href=http://www.openbsd.org/faq/pf/>PF FAQ</a> for complete coverage of PF rulesets.</p></div><div class=paragraph><p>To control PF, use <code>pfctl</code>. <a href=#pfctl>Useful <code>pfctl</code> Options</a> summarizes some useful options to this command. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=pfctl&amp;sektion=8&amp;format=html">pfctl(8)</a> for a description of all available options:</p></div><table id=pfctl class="tableblock frame-none grid-all stretch"><caption class=title>Tabela 28. Useful <code>pfctl</code> Options</caption><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">Command</th><th class="tableblock halign-left valign-top">Purpose</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>pfctl -e</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Enable PF.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>pfctl -d</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Disable PF.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>pfctl -F all -f /etc/pf.conf</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Flush all NAT, filter, state, and table rules and reload <span class=filename>/etc/pf.conf</span>.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>pfctl -s [ rules | nat | states ]</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Report on the filter rules, NAT rules, or state table.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>pfctl -vnf /etc/pf.conf</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Check <span class=filename>/etc/pf.conf</span> for errors, but do not load ruleset.</p></td></tr></tbody></table><div class="admonitionblock tip"><table><tbody><tr><td class=icon><i class="fa icon-tip" title=Tip></i></td><td class=content><div class=paragraph><p><a class=package href=https://cgit.freebsd.org/ports/tree/security/sudo/>security/sudo</a> is useful for running commands like <code>pfctl</code> that require elevated privileges. It can be installed from the Ports Collection.</p></div></td></tr></tbody></table></div><div class=paragraph><p>To keep an eye on the traffic that passes through the PF firewall, consider installing the <a class=package href=https://cgit.freebsd.org/ports/tree/sysutils/pftop/>sysutils/pftop</a> package or port. Once installed, pftop can be run to view a running snapshot of traffic in a format which is similar to <a href="https://man.freebsd.org/cgi/man.cgi?query=top&amp;sektion=1&amp;format=html">top(1)</a>.</p></div></div><div class=sect3><h4 id=pf-tutorial>30.3.2. PF Rulesets<a class=anchor href=#pf-tutorial></a></h4><div class=paragraph><p>This section demonstrates how to create a customized ruleset. It starts with the simplest of rulesets and builds upon its concepts using several examples to demonstrate real-world usage of PF’s many features.</p></div><div class=paragraph><p>The simplest possible ruleset is for a single machine that does not run any services and which needs access to one network, which may be the Internet. To create this minimal ruleset, edit <span class=filename>/etc/pf.conf</span> so it looks like this:</p></div><div class="literalblock programlisting"><div class=content><pre>block in all
pass out all keep state</pre></div></div><div class=paragraph><p>The first rule denies all incoming traffic by default. The second rule allows connections created by this system to pass out, while retaining state information on those connections. This state information allows return traffic for those connections to pass back and should only be used on machines that can be trusted. The ruleset can be loaded with:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pfctl -e ; pfctl -f /etc/pf.conf</span></code></pre></div></div><div class=paragraph><p>In addition to keeping state, PF provides <em>lists</em> and <em>macros</em> which can be defined for use when creating rules. Macros can include lists and need to be defined before use. As an example, insert these lines at the very top of the ruleset:</p></div><div class="literalblock programlisting"><div class=content><pre>tcp_services = &#34;{ ssh, smtp, domain, www, pop3, auth, pop3s }&#34;
udp_services = &#34;{ domain }&#34;</pre></div></div><div class=paragraph><p>PF understands port names as well as port numbers, as long as the names are listed in <span class=filename>/etc/services</span>. This example creates two macros. The first is a list of seven TCP port names and the second is one UDP port name. Once defined, macros can be used in rules. In this example, all traffic is blocked except for the connections initiated by this system for the seven specified TCP services and the one specified UDP service:</p></div><div class="literalblock programlisting"><div class=content><pre>tcp_services = &#34;{ ssh, smtp, domain, www, pop3, auth, pop3s }&#34;
udp_services = &#34;{ domain }&#34;
block all
pass out proto tcp to any port $tcp_services keep state
pass proto udp to any port $udp_services keep state</pre></div></div><div class=paragraph><p>Even though UDP is considered to be a stateless protocol, PF is able to track some state information. For example, when a UDP request is passed which asks a name server about a domain name, PF will watch for the response to pass it back.</p></div><div class=paragraph><p>Whenever an edit is made to a ruleset, the new rules must be loaded so they can be used:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pfctl -f /etc/pf.conf</span></code></pre></div></div><div class=paragraph><p>If there are no syntax errors, <code>pfctl</code> will not output any messages during the rule load. Rules can also be tested before attempting to load them:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pfctl -nf /etc/pf.conf</span></code></pre></div></div><div class=paragraph><p>Including <code>-n</code> causes the rules to be interpreted only, but not loaded. This provides an opportunity to correct any errors. At all times, the last valid ruleset loaded will be enforced until either PF is disabled or a new ruleset is loaded.</p></div><div class="admonitionblock tip"><table><tbody><tr><td class=icon><i class="fa icon-tip" title=Tip></i></td><td class=content><div class=paragraph><p>Adding <code>-v</code> to a <code>pfctl</code> ruleset verify or load will display the fully parsed rules exactly the way they will be loaded. This is extremely useful when debugging rules.</p></div></td></tr></tbody></table></div><div class=sect4><h5 id=pftut-gateway>30.3.2.1. A Simple Gateway with NAT<a class=anchor href=#pftut-gateway></a></h5><div class=paragraph><p>This section demonstrates how to configure a FreeBSD system running PF to act as a gateway for at least one other machine. The gateway needs at least two network interfaces, each connected to a separate network. In this example, <span class=filename>xl0</span> is connected to the Internet and <span class=filename>xl1</span> is connected to the internal network.</p></div><div class=paragraph><p>First, enable the gateway to let the machine forward the network traffic it receives on one interface to another interface. This sysctl setting will forward IPv4 packets:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sysctl net.inet.ip.forwarding=1</span></code></pre></div></div><div class=paragraph><p>To forward IPv6 traffic, use:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sysctl net.inet6.ip6.forwarding=1</span></code></pre></div></div><div class=paragraph><p>To enable these settings at system boot, use <a href="https://man.freebsd.org/cgi/man.cgi?query=sysrc&amp;sektion=8&amp;format=html">sysrc(8)</a> to add them to <span class=filename>/etc/rc.conf</span>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sysrc gateway_enable=yes</span>
<span class=c># sysrc ipv6_gateway_enable=yes</span></code></pre></div></div><div class=paragraph><p>Verify with <code>ifconfig</code> that both of the interfaces are up and running.</p></div><div class=paragraph><p>Next, create the PF rules to allow the gateway to pass traffic. While the following rule allows stateful traffic from hosts of the internal network to pass to the gateway, the <code>to</code> keyword does not guarantee passage all the way from source to destination:</p></div><div class="literalblock programlisting"><div class=content><pre>pass in on xl1 from xl1:network to xl0:network port $ports keep state</pre></div></div><div class=paragraph><p>That rule only lets the traffic pass in to the gateway on the internal interface. To let the packets go further, a matching rule is needed:</p></div><div class="literalblock programlisting"><div class=content><pre>pass out on xl0 from xl1:network to xl0:network port $ports keep state</pre></div></div><div class=paragraph><p>While these two rules will work, rules this specific are rarely needed. For a busy network admin, a readable ruleset is a safer ruleset. The remainder of this section demonstrates how to keep the rules as simple as possible for readability. For example, those two rules could be replaced with one rule:</p></div><div class="literalblock programlisting"><div class=content><pre>pass from xl1:network to any port $ports keep state</pre></div></div><div class=paragraph><p>The <code>interface:network</code> notation can be replaced with a macro to make the ruleset even more readable. For example, a <code>$localnet</code> macro could be defined as the network directly attached to the internal interface (<code>$xl1:network</code>). Alternatively, the definition of <code>$localnet</code> could be changed to an <em>IP address/netmask</em> notation to denote a network, such as <code>192.168.100.1/24</code> for a subnet of private addresses.</p></div><div class=paragraph><p>If required, <code>$localnet</code> could even be defined as a list of networks. Whatever the specific needs, a sensible <code>$localnet</code> definition could be used in a typical pass rule as follows:</p></div><div class="literalblock programlisting"><div class=content><pre>pass from $localnet to any port $ports keep state</pre></div></div><div class=paragraph><p>The following sample ruleset allows all traffic initiated by machines on the internal network. It first defines two macros to represent the external and internal 3COM interfaces of the gateway.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>For dialup users, the external interface will use <span class=filename>tun0</span>. For an ADSL connection, specifically those using PPP over Ethernet (PPPoE), the correct external interface is <span class=filename>tun0</span>, not the physical Ethernet interface.</p></div></td></tr></tbody></table></div><div class="literalblock programlisting"><div class=content><pre>ext_if = &#34;xl0&#34;	# macro for external interface - use tun0 for PPPoE
int_if = &#34;xl1&#34;	# macro for internal interface
localnet = $int_if:network
# ext_if IP address could be dynamic, hence ($ext_if)
nat on $ext_if from $localnet to any -&gt; ($ext_if)
block all
pass from { lo0, $localnet } to any keep state</pre></div></div><div class=paragraph><p>This ruleset introduces the <code>nat</code> rule which is used to handle the network address translation from the non-routable addresses inside the internal network to the IP address assigned to the external interface. The parentheses surrounding the last part of the nat rule <code>($ext_if)</code> is included when the IP address of the external interface is dynamically assigned. It ensures that network traffic runs without serious interruptions even if the external IP address changes.</p></div><div class=paragraph><p>Note that this ruleset probably allows more traffic to pass out of the network than is needed. One reasonable setup could create this macro:</p></div><div class="literalblock programlisting"><div class=content><pre>client_out = &#34;{ ftp-data, ftp, ssh, domain, pop3, auth, nntp, http, \
    https, cvspserver, 2628, 5999, 8000, 8080 }&#34;</pre></div></div><div class=paragraph><p>to use in the main pass rule:</p></div><div class="literalblock programlisting"><div class=content><pre>pass inet proto tcp from $localnet to any port $client_out \
    flags S/SA keep state</pre></div></div><div class=paragraph><p>A few other pass rules may be needed. This one enables SSH on the external interface:</p></div><div class="literalblock programlisting"><div class=content><pre>pass in inet proto tcp to $ext_if port ssh</pre></div></div><div class=paragraph><p>This macro definition and rule allows DNS and NTP for internal clients:</p></div><div class="literalblock programlisting"><div class=content><pre>udp_services = &#34;{ domain, ntp }&#34;
pass quick inet proto { tcp, udp } to any port $udp_services keep state</pre></div></div><div class=paragraph><p>Note the <code>quick</code> keyword in this rule. Since the ruleset consists of several rules, it is important to understand the relationships between the rules in a ruleset. Rules are evaluated from top to bottom, in the sequence they are written. For each packet or connection evaluated by PF, <em>the last matching rule</em> in the ruleset is the one which is applied. However, when a packet matches a rule which contains the <code>quick</code> keyword, the rule processing stops and the packet is treated according to that rule. This is very useful when an exception to the general rules is needed.</p></div></div><div class=sect4><h5 id=pftut-ftp>30.3.2.2. Creating an FTP Proxy<a class=anchor href=#pftut-ftp></a></h5><div class=paragraph><p>Configuring working FTP rules can be problematic due to the nature of the FTP protocol. FTP pre-dates firewalls by several decades and is insecure in its design. The most common points against using FTP include:</p></div><div class=ulist><ul><li><p>Passwords are transferred in the clear.</p></li><li><p>The protocol demands the use of at least two TCP connections (control and data) on separate ports.</p></li><li><p>When a session is established, data is communicated using randomly selected ports.</p></li></ul></div><div class=paragraph><p>All of these points present security challenges, even before considering any potential security weaknesses in client or server software. More secure alternatives for file transfer exist, such as <a href="https://man.freebsd.org/cgi/man.cgi?query=sftp&amp;sektion=1&amp;format=html">sftp(1)</a> or <a href="https://man.freebsd.org/cgi/man.cgi?query=scp&amp;sektion=1&amp;format=html">scp(1)</a>, which both feature authentication and data transfer over encrypted connections..</p></div><div class=paragraph><p>For those situations when FTP is required, PF provides redirection of FTP traffic to a small proxy program called <a href="https://man.freebsd.org/cgi/man.cgi?query=ftp-proxy&amp;sektion=8&amp;format=html">ftp-proxy(8)</a>, which is included in the base system of FreeBSD. The role of the proxy is to dynamically insert and delete rules in the ruleset, using a set of anchors, to correctly handle FTP traffic.</p></div><div class=paragraph><p>To enable the FTP proxy, add this line to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>ftpproxy_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>Then start the proxy by running <code>service ftp-proxy start</code>.</p></div><div class=paragraph><p>For a basic configuration, three elements need to be added to <span class=filename>/etc/pf.conf</span>. First, the anchors which the proxy will use to insert the rules it generates for the FTP sessions:</p></div><div class="literalblock programlisting"><div class=content><pre>nat-anchor &#34;ftp-proxy/*&#34;
rdr-anchor &#34;ftp-proxy/*&#34;</pre></div></div><div class=paragraph><p>Second, a pass rule is needed to allow FTP traffic in to the proxy.</p></div><div class=paragraph><p>Third, redirection and NAT rules need to be defined before the filtering rules. Insert this <code>rdr</code> rule immediately after the <code>nat</code> rule:</p></div><div class="literalblock programlisting"><div class=content><pre>rdr pass on $int_if proto tcp from any to any port ftp -&gt; 127.0.0.1 port 8021</pre></div></div><div class=paragraph><p>Finally, allow the redirected traffic to pass:</p></div><div class="literalblock programlisting"><div class=content><pre>pass out proto tcp from $proxy to any port ftp</pre></div></div><div class=paragraph><p>where <code>$proxy</code> expands to the address the proxy daemon is bound to.</p></div><div class=paragraph><p>Save <span class=filename>/etc/pf.conf</span>, load the new rules, and verify from a client that FTP connections are working:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pfctl -f /etc/pf.conf</span></code></pre></div></div><div class=paragraph><p>This example covers a basic setup where the clients in the local network need to contact FTP servers elsewhere. This basic configuration should work well with most combinations of FTP clients and servers. As shown in <a href="https://man.freebsd.org/cgi/man.cgi?query=ftp-proxy&amp;sektion=8&amp;format=html">ftp-proxy(8)</a>, the proxy’s behavior can be changed in various ways by adding options to the <code>ftpproxy_flags=</code> line. Some clients or servers may have specific quirks that must be compensated for in the configuration, or there may be a need to integrate the proxy in specific ways such as assigning FTP traffic to a specific queue.</p></div><div class=paragraph><p>For ways to run an FTP server protected by PF and <a href="https://man.freebsd.org/cgi/man.cgi?query=ftp-proxy&amp;sektion=8&amp;format=html">ftp-proxy(8)</a>, configure a separate <code>ftp-proxy</code> in reverse mode, using <code>-R</code>, on a separate port with its own redirecting pass rule.</p></div></div><div class=sect4><h5 id=pftut-icmp>30.3.2.3. Managing ICMP<a class=anchor href=#pftut-icmp></a></h5><div class=paragraph><p>Many of the tools used for debugging or troubleshooting a TCP/IP network rely on the Internet Control Message Protocol (ICMP), which was designed specifically with debugging in mind.</p></div><div class=paragraph><p>The ICMP protocol sends and receives <em>control messages</em> between hosts and gateways, mainly to provide feedback to a sender about any unusual or difficult conditions enroute to the target host. Routers use ICMP to negotiate packet sizes and other transmission parameters in a process often referred to as <em>path MTU discovery</em>.</p></div><div class=paragraph><p>From a firewall perspective, some ICMP control messages are vulnerable to known attack vectors. Also, letting all diagnostic traffic pass unconditionally makes debugging easier, but it also makes it easier for others to extract information about the network. For these reasons, the following rule may not be optimal:</p></div><div class="literalblock programlisting"><div class=content><pre>pass inet proto icmp from any to any</pre></div></div><div class=paragraph><p>One solution is to let all ICMP traffic from the local network through while stopping all probes from outside the network:</p></div><div class="literalblock programlisting"><div class=content><pre>pass inet proto icmp from $localnet to any keep state
pass inet proto icmp from any to $ext_if keep state</pre></div></div><div class=paragraph><p>Additional options are available which demonstrate some of PF’s flexibility. For example, rather than allowing all ICMP messages, one can specify the messages used by <a href="https://man.freebsd.org/cgi/man.cgi?query=ping&amp;sektion=8&amp;format=html">ping(8)</a> and <a href="https://man.freebsd.org/cgi/man.cgi?query=traceroute&amp;sektion=8&amp;format=html">traceroute(8)</a>. Start by defining a macro for that type of message:</p></div><div class="literalblock programlisting"><div class=content><pre>icmp_types = &#34;echoreq&#34;</pre></div></div><div class=paragraph><p>and a rule which uses the macro:</p></div><div class="literalblock programlisting"><div class=content><pre>pass inet proto icmp all icmp-type $icmp_types keep state</pre></div></div><div class=paragraph><p>If other types of ICMP packets are needed, expand <code>icmp_types</code> to a list of those packet types. Type <code>more /usr/src/sbin/pfctl/pfctl_parser.c</code> to see the list of ICMP message types supported by PF. Refer to <a href=http://www.iana.org/assignments/icmp-parameters/icmp-parameters.xhtml>http://www.iana.org/assignments/icmp-parameters/icmp-parameters.xhtml</a> for an explanation of each message type.</p></div><div class=paragraph><p>Since Unix <code>traceroute</code> uses UDP by default, another rule is needed to allow Unix <code>traceroute</code>:</p></div><div class="literalblock programlisting"><div class=content><pre># allow out the default range for traceroute(8):
pass out on $ext_if inet proto udp from any to any port 33433 &gt;&lt; 33626 keep state</pre></div></div><div class=paragraph><p>Since <code>TRACERT.EXE</code> on Microsoft Windows systems uses ICMP echo request messages, only the first rule is needed to allow network traces from those systems. Unix <code>traceroute</code> can be instructed to use other protocols as well, and will use ICMP echo request messages if <code>-I</code> is used. Check the <a href="https://man.freebsd.org/cgi/man.cgi?query=traceroute&amp;sektion=8&amp;format=html">traceroute(8)</a> man page for details.</p></div><div class=sect5><h6 id=pftut-pathmtudisc>30.3.2.3.1. Path MTU Discovery<a class=anchor href=#pftut-pathmtudisc></a></h6><div class=paragraph><p>Internet protocols are designed to be device independent, and one consequence of device independence is that the optimal packet size for a given connection cannot always be predicted reliably. The main constraint on packet size is the <em>Maximum Transmission Unit</em> (MTU) which sets the upper limit on the packet size for an interface. Type <code>ifconfig</code> to view the MTUs for a system’s network interfaces.</p></div><div class=paragraph><p>TCP/IP uses a process known as path MTU discovery to determine the right packet size for a connection. This process sends packets of varying sizes with the "Do not fragment" flag set, expecting an ICMP return packet of "type 3, code 4" when the upper limit has been reached. Type 3 means "destination unreachable", and code 4 is short for "fragmentation needed, but the do-not-fragment flag is set". To allow path MTU discovery in order to support connections to other MTUs, add the <code>destination unreachable</code> type to the <code>icmp_types</code> macro:</p></div><div class="literalblock programlisting"><div class=content><pre>icmp_types = &#34;{ echoreq, unreach }&#34;</pre></div></div><div class=paragraph><p>Since the pass rule already uses that macro, it does not need to be modified to support the new ICMP type:</p></div><div class="literalblock programlisting"><div class=content><pre>pass inet proto icmp all icmp-type $icmp_types keep state</pre></div></div><div class=paragraph><p>PF allows filtering on all variations of ICMP types and codes. The list of possible types and codes are documented in <a href="https://man.freebsd.org/cgi/man.cgi?query=icmp&amp;sektion=4&amp;format=html">icmp(4)</a> and <a href="https://man.freebsd.org/cgi/man.cgi?query=icmp6&amp;sektion=4&amp;format=html">icmp6(4)</a>.</p></div></div></div><div class=sect4><h5 id=pftut-tables>30.3.2.4. Using Tables<a class=anchor href=#pftut-tables></a></h5><div class=paragraph><p>Some types of data are relevant to filtering and redirection at a given time, but their definition is too long to be included in the ruleset file. PF supports the use of tables, which are defined lists that can be manipulated without needing to reload the entire ruleset, and which can provide fast lookups. Table names are always enclosed within <code>&lt; ></code>, like this:</p></div><div class="literalblock programlisting"><div class=content><pre>table &lt;clients&gt; { 192.168.2.0/24, !192.168.2.5 }</pre></div></div><div class=paragraph><p>In this example, the <code>192.168.2.0/24</code> network is part of the table, except for the address <code>192.168.2.5</code>, which is excluded using the <code>!</code> operator. It is also possible to load tables from files where each item is on a separate line, as seen in this example <span class=filename>/etc/clients</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>192.168.2.0/24
!192.168.2.5</pre></div></div><div class=paragraph><p>To refer to the file, define the table like this:</p></div><div class="literalblock programlisting"><div class=content><pre>table &lt;clients&gt; persist file &#34;/etc/clients&#34;</pre></div></div><div class=paragraph><p>Once the table is defined, it can be referenced by a rule:</p></div><div class="literalblock programlisting"><div class=content><pre>pass inet proto tcp from &lt;clients&gt; to any port $client_out flags S/SA keep state</pre></div></div><div class=paragraph><p>A table’s contents can be manipulated live, using <code>pfctl</code>. This example adds another network to the table:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pfctl -t clients -T add 192.168.1.0/16</span></code></pre></div></div><div class=paragraph><p>Note that any changes made this way will take affect now, making them ideal for testing, but will not survive a power failure or reboot. To make the changes permanent, modify the definition of the table in the ruleset or edit the file that the table refers to. One can maintain the on-disk copy of the table using a <a href="https://man.freebsd.org/cgi/man.cgi?query=cron&amp;sektion=8&amp;format=html">cron(8)</a> job which dumps the table’s contents to disk at regular intervals, using a command such as <code>pfctl -t clients -T show >/etc/clients</code>. Alternatively, <span class=filename>/etc/clients</span> can be updated with the in-memory table contents:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pfctl -t clients -T replace -f /etc/clients</span></code></pre></div></div></div><div class=sect4><h5 id=pftut-overload>30.3.2.5. Using Overload Tables to Protect SSH<a class=anchor href=#pftut-overload></a></h5><div class=paragraph><p>Those who run SSH on an external interface have probably seen something like this in the authentication logs:</p></div><div class="literalblock programlisting"><div class=content><pre>Sep 26 03:12:34 skapet sshd[25771]: Failed password for root from 200.72.41.31 port 40992 ssh2
Sep 26 03:12:34 skapet sshd[5279]: Failed password for root from 200.72.41.31 port 40992 ssh2
Sep 26 03:12:35 skapet sshd[5279]: Received disconnect from 200.72.41.31: 11: Bye Bye
Sep 26 03:12:44 skapet sshd[29635]: Invalid user admin from 200.72.41.31
Sep 26 03:12:44 skapet sshd[24703]: input_userauth_request: invalid user admin
Sep 26 03:12:44 skapet sshd[24703]: Failed password for invalid user admin from 200.72.41.31 port 41484 ssh2</pre></div></div><div class=paragraph><p>This is indicative of a brute force attack where somebody or some program is trying to discover the user name and password which will let them into the system.</p></div><div class=paragraph><p>If external SSH access is needed for legitimate users, changing the default port used by SSH can offer some protection. However, PF provides a more elegant solution. Pass rules can contain limits on what connecting hosts can do and violators can be banished to a table of addresses which are denied some or all access. It is even possible to drop all existing connections from machines which overreach the limits.</p></div><div class=paragraph><p>To configure this, create this table in the tables section of the ruleset:</p></div><div class="literalblock programlisting"><div class=content><pre>table &lt;bruteforce&gt; persist</pre></div></div><div class=paragraph><p>Then, somewhere early in the ruleset, add rules to block brute access while allowing legitimate access:</p></div><div class="literalblock programlisting"><div class=content><pre>block quick from &lt;bruteforce&gt;
pass inet proto tcp from any to $localnet port $tcp_services \
    flags S/SA keep state \
    (max-src-conn 100, max-src-conn-rate 15/5, \
    overload &lt;bruteforce&gt; flush global)</pre></div></div><div class=paragraph><p>The part in parentheses defines the limits and the numbers should be changed to meet local requirements. It can be read as follows:</p></div><div class=paragraph><p><code>max-src-conn</code> is the number of simultaneous connections allowed from one host.</p></div><div class=paragraph><p><code>max-src-conn-rate</code> is the rate of new connections allowed from any single host (<em>15</em>) per number of seconds (<em>5</em>).</p></div><div class=paragraph><p><code>overload &lt;bruteforce></code> means that any host which exceeds these limits gets its address added to the <code>bruteforce</code> table. The ruleset blocks all traffic from addresses in the <code>bruteforce</code> table.</p></div><div class=paragraph><p>Finally, <code>flush global</code> says that when a host reaches the limit, that all (<code>global</code>) of that host’s connections will be terminated (<code>flush</code>).</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>These rules will <em>not</em> block slow bruteforcers, as described in <a href=http://home.nuug.no/~peter/hailmary2013/>http://home.nuug.no/~peter/hailmary2013/</a>.</p></div></td></tr></tbody></table></div><div class=paragraph><p>This example ruleset is intended mainly as an illustration. For example, if a generous number of connections in general are wanted, but the desire is to be more restrictive when it comes to ssh, supplement the rule above with something like the one below, early on in the rule set:</p></div><div class="literalblock programlisting"><div class=content><pre>pass quick proto { tcp, udp } from any to any port ssh \
    flags S/SA keep state \
    (max-src-conn 15, max-src-conn-rate 5/3, \
    overload &lt;bruteforce&gt; flush global)</pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p><strong>It May Not be Necessary to Block All Overloaders:</strong><br></p></div><div class=paragraph><p>It is worth noting that the overload mechanism is a general technique which does not apply exclusively to SSH, and it is not always optimal to entirely block all traffic from offenders.</p></div><div class=paragraph><p>For example, an overload rule could be used to protect a mail service or a web service, and the overload table could be used in a rule to assign offenders to a queue with a minimal bandwidth allocation or to redirect to a specific web page.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Over time, tables will be filled by overload rules and their size will grow incrementally, taking up more memory. Sometimes an IP address that is blocked is a dynamically assigned one, which has since been assigned to a host who has a legitimate reason to communicate with hosts in the local network.</p></div><div class=paragraph><p>For situations like these, pfctl provides the ability to expire table entries. For example, this command will remove <code>&lt;bruteforce></code> table entries which have not been referenced for <code>86400</code> seconds:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pfctl -t bruteforce -T expire 86400</span></code></pre></div></div><div class=paragraph><p>Similar functionality is provided by <a class=package href=https://cgit.freebsd.org/ports/tree/security/expiretable/>security/expiretable</a>, which removes table entries which have not been accessed for a specified period of time.</p></div><div class=paragraph><p>Once installed, expiretable can be run to remove <code>&lt;bruteforce></code> table entries older than a specified age. This example removes all entries older than 24 hours:</p></div><div class="literalblock programlisting"><div class=content><pre>/usr/local/sbin/expiretable -v -d -t 24h bruteforce</pre></div></div></div><div class=sect4><h5 id=pftut-spamd>30.3.2.6. Protecting Against SPAM<a class=anchor href=#pftut-spamd></a></h5><div class=paragraph><p>Not to be confused with the spamd daemon which comes bundled with spamassassin, <a class=package href=https://cgit.freebsd.org/ports/tree/mail/spamd/>mail/spamd</a> can be configured with PF to provide an outer defense against SPAM. This spamd hooks into the PF configuration using a set of redirections.</p></div><div class=paragraph><p>Spammers tend to send a large number of messages, and SPAM is mainly sent from a few spammer friendly networks and a large number of hijacked machines, both of which are reported to <em>blacklists</em> fairly quickly.</p></div><div class=paragraph><p>When an SMTP connection from an address in a blacklist is received, spamd presents its banner and immediately switches to a mode where it answers SMTP traffic one byte at a time. This technique, which is intended to waste as much time as possible on the spammer’s end, is called <em>tarpitting</em>. The specific implementation which uses one byte SMTP replies is often referred to as <em>stuttering</em>.</p></div><div class=paragraph><p>This example demonstrates the basic procedure for setting up spamd with automatically updated blacklists. Refer to the man pages which are installed with <a class=package href=https://cgit.freebsd.org/ports/tree/mail/spamd/>mail/spamd</a> for more information.</p></div><div class="sidebarblock procedure"><div class=content><div class="olist arabic"><div class=title>Procedure: Configuring spamd</div><ol class=arabic><li><p>Install the <a class=package href=https://cgit.freebsd.org/ports/tree/mail/spamd/>mail/spamd</a> package or port. To use spamd’s greylisting features, <a href="https://man.freebsd.org/cgi/man.cgi?query=fdescfs&amp;sektion=5&amp;format=html">fdescfs(5)</a> must be mounted at <span class=filename>/dev/fd</span>. Add the following line to <span class=filename>/etc/fstab</span>:</p><div class="literalblock programlisting"><div class=content><pre> fdescfs /dev/fd fdescfs rw 0 0</pre></div></div><div class=paragraph><p>Then, mount the filesystem:</p></div><div class="literalblock programlisting"><div class=content><pre>#  mount fdescfs</pre></div></div></li><li><p>Next, edit the PF ruleset to include:</p><div class="literalblock programlisting"><div class=content><pre>table &lt;spamd&gt; persist
table &lt;spamd-white&gt; persist
rdr pass on $ext_if inet proto tcp from &lt;spamd&gt; to \
    { $ext_if, $localnet } port smtp -&gt; 127.0.0.1 port 8025
rdr pass on $ext_if inet proto tcp from !&lt;spamd-white&gt; to \
    { $ext_if, $localnet } port smtp -&gt; 127.0.0.1 port 8025</pre></div></div><div class=paragraph><p>The two tables <code>&lt;spamd></code> and <code>&lt;spamd-white></code> are essential. SMTP traffic from an address listed in <code>&lt;spamd></code> but not in <code>&lt;spamd-white></code> is redirected to the spamd daemon listening at port 8025.</p></div></li><li><p>The next step is to configure spamd in <span class=filename>/usr/local/etc/spamd.conf</span> and to add some <span class=filename>rc.conf</span> parameters.</p><div class=paragraph><p>The installation of <a class=package href=https://cgit.freebsd.org/ports/tree/mail/spamd/>mail/spamd</a> includes a sample configuration file (<span class=filename>/usr/local/etc/spamd.conf.sample</span>) and a man page for <span class=filename>spamd.conf</span>. Refer to these for additional configuration options beyond those shown in this example.</p></div><div class=paragraph><p>One of the first lines in the configuration file that does not begin with a <code>#</code> comment sign contains the block which defines the <code>all</code> list, which specifies the lists to use:</p></div><div class="literalblock programlisting"><div class=content><pre>all:\
    :traplist:whitelist:</pre></div></div><div class=paragraph><p>This entry adds the desired blacklists, separated by colons (<code>:</code>). To use a whitelist to subtract addresses from a blacklist, add the name of the whitelist <em>immediately</em> after the name of that blacklist. For example: <code>:blacklist:whitelist:</code>.</p></div><div class=paragraph><p>This is followed by the specified blacklist’s definition:</p></div><div class="literalblock programlisting"><div class=content><pre>traplist:\
    :black:\
    :msg=&#34;SPAM. Your address %A has sent spam within the last 24 hours&#34;:\
    :method=http:\
    :file=www.openbsd.org/spamd/traplist.gz</pre></div></div><div class=paragraph><p>where the first line is the name of the blacklist and the second line specifies the list type. The <code>msg</code> field contains the message to display to blacklisted senders during the SMTP dialogue. The <code>method</code> field specifies how spamd-setup fetches the list data; supported methods are <code>http</code>, <code>ftp</code>, from a <code>file</code> in a mounted file system, and via <code>exec</code> of an external program. Finally, the <code>file</code> field specifies the name of the file spamd expects to receive.</p></div><div class=paragraph><p>The definition of the specified whitelist is similar, but omits the <code>msg</code> field since a message is not needed:</p></div><div class="literalblock programlisting"><div class=content><pre>whitelist:\
    :white:\
    :method=file:\
    :file=/var/mail/whitelist.txt</pre></div></div><div class="admonitionblock tip"><table><tbody><tr><td class=icon><i class="fa icon-tip" title=Tip></i></td><td class=content><div class=paragraph><p><strong>Choose Data Sources with Care:</strong><br></p></div><div class=paragraph><p>Using all the blacklists in the sample <span class=filename>spamd.conf</span> will blacklist large blocks of the Internet. Administrators need to edit the file to create an optimal configuration which uses applicable data sources and, when necessary, uses custom lists.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Next, add this entry to <span class=filename>/etc/rc.conf</span>. Additional flags are described in the man page specified by the comment:</p></div><div class="literalblock programlisting"><div class=content><pre>spamd_flags=&#34;-v&#34; # use &#34;&#34; and see spamd-setup(8) for flags</pre></div></div><div class=paragraph><p>When finished, reload the ruleset, start spamd by typing <code>service obspamd start</code>, and complete the configuration using <code>spamd-setup</code>. Finally, create a <a href="https://man.freebsd.org/cgi/man.cgi?query=cron&amp;sektion=8&amp;format=html">cron(8)</a> job which calls <code>spamd-setup</code> to update the tables at reasonable intervals.</p></div></li></ol></div></div></div><div class=paragraph><p>On a typical gateway in front of a mail server, hosts will soon start getting trapped within a few seconds to several minutes.</p></div><div class=paragraph><p>PF also supports <em>greylisting</em>, which temporarily rejects messages from unknown hosts with <em>45n</em> codes. Messages from greylisted hosts which try again within a reasonable time are let through. Traffic from senders which are set up to behave within the limits set by RFC 1123 and RFC 2821 are immediately let through.</p></div><div class=paragraph><p>More information about greylisting as a technique can be found at the <a href=http://www.greylisting.org/>greylisting.org</a> web site. The most amazing thing about greylisting, apart from its simplicity, is that it still works. Spammers and malware writers have been very slow to adapt to bypass this technique.</p></div><div class=paragraph><p>The basic procedure for configuring greylisting is as follows:</p></div><div class="olist arabic procedure"><div class=title>Procedure: Configuring Greylisting</div><ol class=arabic><li><p>Make sure that <a href="https://man.freebsd.org/cgi/man.cgi?query=fdescfs&amp;sektion=5&amp;format=html">fdescfs(5)</a> is mounted as described in Step 1 of the previous Procedure.</p></li><li><p>To run spamd in greylisting mode, add this line to <span class=filename>/etc/rc.conf</span>:</p><div class="literalblock programlisting"><div class=content><pre>spamd_grey=&#34;YES&#34;  # use spamd greylisting if YES</pre></div></div><div class=paragraph><p>Refer to the spamd man page for descriptions of additional related parameters.</p></div></li><li><p>To complete the greylisting setup:</p><div class="literalblock programlisting"><div class=content><pre>#  service obspamd restart
#  service obspamlogd start</pre></div></div></li></ol></div><div class=paragraph><p>Behind the scenes, the spamdb database tool and the spamlogd whitelist updater perform essential functions for the greylisting feature. spamdb is the administrator’s main interface to managing the black, grey, and white lists via the contents of the <span class=filename>/var/db/spamdb</span> database.</p></div></div><div class=sect4><h5 id=pftut-hygiene>30.3.2.7. Network Hygiene<a class=anchor href=#pftut-hygiene></a></h5><div class=paragraph><p>This section describes how <code>block-policy</code>, <code>scrub</code>, and <code>antispoof</code> can be used to make the ruleset behave sanely.</p></div><div class=paragraph><p>The <code>block-policy</code> is an option which can be set in the <code>options</code> part of the ruleset, which precedes the redirection and filtering rules. This option determines which feedback, if any, PF sends to hosts that are blocked by a rule. The option has two possible values: <code>drop</code> drops blocked packets with no feedback, and <code>return</code> returns a status code such as <code>Connection refused</code>.</p></div><div class=paragraph><p>If not set, the default policy is <code>drop</code>. To change the <code>block-policy</code>, specify the desired value:</p></div><div class="literalblock programlisting"><div class=content><pre>set block-policy return</pre></div></div><div class=paragraph><p>In PF, <code>scrub</code> is a keyword which enables network packet normalization. This process reassembles fragmented packets and drops TCP packets that have invalid flag combinations. Enabling <code>scrub</code> provides a measure of protection against certain kinds of attacks based on incorrect handling of packet fragments. A number of options are available, but the simplest form is suitable for most configurations:</p></div><div class="literalblock programlisting"><div class=content><pre>scrub in all</pre></div></div><div class=paragraph><p>Some services, such as NFS, require specific fragment handling options. Refer to <a href=https://home.nuug.no/~peter/pf/en/scrub.html>https://home.nuug.no/~peter/pf/en/scrub.html</a> for more information.</p></div><div class=paragraph><p>This example reassembles fragments, clears the "do not fragment" bit, and sets the maximum segment size to 1440 bytes:</p></div><div class="literalblock programlisting"><div class=content><pre>scrub in all fragment reassemble no-df max-mss 1440</pre></div></div><div class=paragraph><p>The <code>antispoof</code> mechanism protects against activity from spoofed or forged IP addresses, mainly by blocking packets appearing on interfaces and in directions which are logically not possible.</p></div><div class=paragraph><p>These rules weed out spoofed traffic coming in from the rest of the world as well as any spoofed packets which originate in the local network:</p></div><div class="literalblock programlisting"><div class=content><pre>antispoof for $ext_if
antispoof for $int_if</pre></div></div></div><div class=sect4><h5 id=pftut-unrouteables>30.3.2.8. Handling Non-Routable Addresses<a class=anchor href=#pftut-unrouteables></a></h5><div class=paragraph><p>Even with a properly configured gateway to handle network address translation, one may have to compensate for other people’s misconfigurations. A common misconfiguration is to let traffic with non-routable addresses out to the Internet. Since traffic from non-routeable addresses can play a part in several DoS attack techniques, consider explicitly blocking traffic from non-routeable addresses from entering the network through the external interface.</p></div><div class=paragraph><p>In this example, a macro containing non-routable addresses is defined, then used in blocking rules. Traffic to and from these addresses is quietly dropped on the gateway’s external interface.</p></div><div class="literalblock programlisting"><div class=content><pre>martians = &#34;{ 127.0.0.0/8, 192.168.0.0/16, 172.16.0.0/12, \
	      10.0.0.0/8, 169.254.0.0/16, 192.0.2.0/24, \
	      0.0.0.0/8, 240.0.0.0/4 }&#34;

block drop in quick on $ext_if from $martians to any
block drop out quick on $ext_if from any to $martians</pre></div></div></div></div><div class=sect3><h4 id=_enabling_altq>30.3.3. Enabling ALTQ<a class=anchor href=#_enabling_altq></a></h4><div class=paragraph><p>On FreeBSD, ALTQ can be used with PF to provide Quality of Service (QOS). Once ALTQ is enabled, queues can be defined in the ruleset which determine the processing priority of outbound packets.</p></div><div class=paragraph><p>Before enabling ALTQ, refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=altq&amp;sektion=4&amp;format=html">altq(4)</a> to determine if the drivers for the network cards installed on the system support it.</p></div><div class=paragraph><p>ALTQ is not available as a loadable kernel module. If the system’s interfaces support ALTQ, create a custom kernel using the instructions in <a href=./#kernelconfig>Configuring the FreeBSD Kernel</a>. The following kernel options are available. The first is needed to enable ALTQ. At least one of the other options is necessary to specify the queueing scheduler algorithm:</p></div><div class="literalblock programlisting"><div class=content><pre>options         ALTQ
options         ALTQ_CBQ        # Class Based Queuing (CBQ)
options         ALTQ_RED        # Random Early Detection (RED)
options         ALTQ_RIO        # RED In/Out
options         ALTQ_HFSC       # Hierarchical Packet Scheduler (HFSC)
options         ALTQ_PRIQ       # Priority Queuing (PRIQ)</pre></div></div><div class=paragraph><p>The following scheduler algorithms are available:</p></div><div class=dlist><dl><dt class=hdlist1>CBQ</dt><dd><p>Class Based Queuing (CBQ) is used to divide a connection’s bandwidth into different classes or queues to prioritize traffic based on filter rules.</p></dd><dt class=hdlist1>RED</dt><dd><p>Random Early Detection (RED) is used to avoid network congestion by measuring the length of the queue and comparing it to the minimum and maximum thresholds for the queue. When the queue is over the maximum, all new packets are randomly dropped.</p></dd><dt class=hdlist1>RIO</dt><dd><p>In Random Early Detection In and Out (RIO) mode, RED maintains multiple average queue lengths and multiple threshold values, one for each QOS level.</p></dd><dt class=hdlist1>HFSC</dt><dd><p>Hierarchical Fair Service Curve Packet Scheduler (HFSC) is described in <a href=http://www-2.cs.cmu.edu/~hzhang/HFSC/main.html>http://www-2.cs.cmu.edu/~hzhang/HFSC/main.html</a>.</p></dd><dt class=hdlist1>PRIQ</dt><dd><p>Priority Queuing (PRIQ) always passes traffic that is in a higher queue first.</p></dd></dl></div><div class=paragraph><p>More information about the scheduling algorithms and example rulesets are available at the <a href=https://web.archive.org/web/20151109213426/http://www.openbsd.org/faq/pf/queueing.html>OpenBSD’s web archive</a>.</p></div></div></div><div class=sect2><h3 id=firewalls-ipfw>30.4. IPFW<a class=anchor href=#firewalls-ipfw></a></h3><div class=paragraph><p>IPFW is a stateful firewall written for FreeBSD which supports both IPv4 and IPv6. It is comprised of several components: the kernel firewall filter rule processor and its integrated packet accounting facility, the logging facility, NAT, the <a href="https://man.freebsd.org/cgi/man.cgi?query=dummynet&amp;sektion=4&amp;format=html">dummynet(4)</a> traffic shaper, a forward facility, a bridge facility, and an ipstealth facility.</p></div><div class=paragraph><p>FreeBSD provides a sample ruleset in <span class=filename>/etc/rc.firewall</span> which defines several firewall types for common scenarios to assist novice users in generating an appropriate ruleset. IPFW provides a powerful syntax which advanced users can use to craft customized rulesets that meet the security requirements of a given environment.</p></div><div class=paragraph><p>This section describes how to enable IPFW, provides an overview of its rule syntax, and demonstrates several rulesets for common configuration scenarios.</p></div><div class=sect3><h4 id=firewalls-ipfw-enable>30.4.1. Enabling IPFW<a class=anchor href=#firewalls-ipfw-enable></a></h4><div class=paragraph><p>IPFW is included in the basic FreeBSD install as a kernel loadable module, meaning that a custom kernel is not needed in order to enable IPFW.</p></div><div class=paragraph><p>For those users who wish to statically compile IPFW support into a custom kernel, see <a href=#firewalls-ipfw-kernelconfig>IPFW Kernel Options</a>.</p></div><div class=paragraph><p>To configure the system to enable IPFW at boot time, add <code>firewall_enable="YES"</code> to <span class=filename>/etc/rc.conf</span>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sysrc firewall_enable=&#34;YES&#34;</span></code></pre></div></div><div class=paragraph><p>To use one of the default firewall types provided by FreeBSD, add another line which specifies the type:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sysrc firewall_type=&#34;open&#34;</span></code></pre></div></div><div class=paragraph><p>The available types are:</p></div><div class=ulist><ul><li><p><code>open</code>: passes all traffic.</p></li><li><p><code>client</code>: protects only this machine.</p></li><li><p><code>simple</code>: protects the whole network.</p></li><li><p><code>closed</code>: entirely disables IP traffic except for the loopback interface.</p></li><li><p><code>workstation</code>: protects only this machine using stateful rules.</p></li><li><p><code>UNKNOWN</code>: disables the loading of firewall rules.</p></li><li><p><span class=filename>filename</span>: full path of the file containing the firewall ruleset.</p></li></ul></div><div class=paragraph><p>If <code>firewall_type</code> is set to either <code>client</code> or <code>simple</code>, modify the default rules found in <span class=filename>/etc/rc.firewall</span> to fit the configuration of the system.</p></div><div class=paragraph><p>Note that the <code>filename</code> type is used to load a custom ruleset.</p></div><div class=paragraph><p>An alternate way to load a custom ruleset is to set the <code>firewall_script</code> variable to the absolute path of an <em>executable script</em> that includes IPFW commands. The examples used in this section assume that the <code>firewall_script</code> is set to <span class=filename>/etc/ipfw.rules</span>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sysrc firewall_script=&#34;/etc/ipfw.rules&#34;</span></code></pre></div></div><div class=paragraph><p>To enable logging through <a href="https://man.freebsd.org/cgi/man.cgi?query=syslogd&amp;sektion=8&amp;format=html">syslogd(8)</a>, include this line:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sysrc firewall_logging=&#34;YES&#34;</span></code></pre></div></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>Only firewall rules with the <code>log</code> option will be logged. The default rules do not include this option and it must be manually added. Therefore it is advisable that the default ruleset is edited for logging. In addition, log rotation may be desired if the logs are stored in a separate file.</p></div></td></tr></tbody></table></div><div class=paragraph><p>There is no <span class=filename>/etc/rc.conf</span> variable to set logging limits. To limit the number of times a rule is logged per connection attempt, specify the number using this line in <span class=filename>/etc/sysctl.conf</span>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># echo &#34;net.inet.ip.fw.verbose_limit=5&#34; &gt;&gt; /etc/sysctl.conf</span></code></pre></div></div><div class=paragraph><p>To enable logging through a dedicated interface named <code>ipfw0</code>, add this line to <span class=filename>/etc/rc.conf</span> instead:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sysrc firewall_logif=&#34;YES&#34;</span></code></pre></div></div><div class=paragraph><p>Then use tcpdump to see what is being logged:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># tcpdump -t -n -i ipfw0</span></code></pre></div></div><div class="admonitionblock tip"><table><tbody><tr><td class=icon><i class="fa icon-tip" title=Tip></i></td><td class=content><div class=paragraph><p>There is no overhead due to logging unless tcpdump is attached.</p></div></td></tr></tbody></table></div><div class=paragraph><p>After saving the needed edits, start the firewall. To enable logging limits now, also set the <code>sysctl</code> value specified above:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service ipfw start</span>
<span class=c># sysctl net.inet.ip.fw.verbose_limit=5</span></code></pre></div></div></div><div class=sect3><h4 id=firewalls-ipfw-rules>30.4.2. IPFW Rule Syntax<a class=anchor href=#firewalls-ipfw-rules></a></h4><div class=paragraph><p>When a packet enters the IPFW firewall, it is compared against the first rule in the ruleset and progresses one rule at a time, moving from top to bottom in sequence. When the packet matches the selection parameters of a rule, the rule’s action is executed and the search of the ruleset terminates for that packet. This is referred to as "first match wins". If the packet does not match any of the rules, it gets caught by the mandatory IPFW default rule number 65535, which denies all packets and silently discards them. However, if the packet matches a rule that contains the <code>count</code>, <code>skipto</code>, or <code>tee</code> keywords, the search continues. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=ipfw&amp;sektion=8&amp;format=html">ipfw(8)</a> for details on how these keywords affect rule processing.</p></div><div class=paragraph><p>When creating an IPFW rule, keywords must be written in the following order. Some keywords are mandatory while other keywords are optional. The words shown in uppercase represent a variable and the words shown in lowercase must precede the variable that follows it. The <code>#</code> symbol is used to mark the start of a comment and may appear at the end of a rule or on its own line. Blank lines are ignored.</p></div><div class=paragraph><p><code><em>CMD RULE_NUMBER set SET_NUMBER ACTION log LOG_AMOUNT PROTO from SRC SRC_PORT to DST DST_PORT OPTIONS</em></code></p></div><div class=paragraph><p>This section provides an overview of these keywords and their options. It is not an exhaustive list of every possible option. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=ipfw&amp;sektion=8&amp;format=html">ipfw(8)</a> for a complete description of the rule syntax that can be used when creating IPFW rules.</p></div><div class=dlist><dl><dt class=hdlist1>CMD</dt><dd><p>Every rule must start with <code>ipfw add</code>.</p></dd><dt class=hdlist1>RULE_NUMBER</dt><dd><p>Each rule is associated with a number from <code>1</code> to <code>65534</code>. The number is used to indicate the order of rule processing. Multiple rules can have the same number, in which case they are applied according to the order in which they have been added.</p></dd><dt class=hdlist1>SET_NUMBER</dt><dd><p>Each rule is associated with a set number from <code>0</code> to <code>31</code>. Sets can be individually disabled or enabled, making it possible to quickly add or delete a set of rules. If a SET_NUMBER is not specified, the rule will be added to set <code>0</code>.</p></dd><dt class=hdlist1>ACTION</dt><dd><p>A rule can be associated with one of the following actions. The specified action will be executed when the packet matches the selection criterion of the rule.</p><div class=paragraph><p><code>allow | accept | pass | permit</code>: these keywords are equivalent and allow packets that match the rule.</p></div><div class=paragraph><p><code>check-state</code>: checks the packet against the dynamic state table. If a match is found, execute the action associated with the rule which generated this dynamic rule, otherwise move to the next rule. A <code>check-state</code> rule does not have selection criterion. If no <code>check-state</code> rule is present in the ruleset, the dynamic rules table is checked at the first <code>keep-state</code> or <code>limit</code> rule.</p></div><div class=paragraph><p><code>count</code>: updates counters for all packets that match the rule. The search continues with the next rule.</p></div><div class=paragraph><p><code>deny | drop</code>: either word silently discards packets that match this rule.</p></div><div class=paragraph><p>Additional actions are available. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=ipfw&amp;sektion=8&amp;format=html">ipfw(8)</a> for details.</p></div></dd><dt class=hdlist1>LOG_AMOUNT</dt><dd><p>When a packet matches a rule with the <code>log</code> keyword, a message will be logged to <a href="https://man.freebsd.org/cgi/man.cgi?query=syslogd&amp;sektion=8&amp;format=html">syslogd(8)</a> with a facility name of <code>SECURITY</code>. Logging only occurs if the number of packets logged for that particular rule does not exceed a specified LOG_AMOUNT. If no LOG_AMOUNT is specified, the limit is taken from the value of <code>net.inet.ip.fw.verbose_limit</code>. A value of zero removes the logging limit. Once the limit is reached, logging can be re-enabled by clearing the logging counter or the packet counter for that rule, using <code>ipfw resetlog</code>.</p><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Logging is done after all other packet matching conditions have been met, and before performing the final action on the packet. The administrator decides which rules to enable logging on.</p></div></td></tr></tbody></table></div></dd><dt class=hdlist1>PROTO</dt><dd><p>This optional value can be used to specify any protocol name or number found in <span class=filename>/etc/protocols</span>.</p></dd><dt class=hdlist1>SRC</dt><dd><p>The <code>from</code> keyword must be followed by the source address or a keyword that represents the source address. An address can be represented by <code>any</code>, <code>me</code> (any address configured on an interface on this system), <code>me6</code>, (any IPv6 address configured on an interface on this system), or <code>table</code> followed by the number of a lookup table which contains a list of addresses. When specifying an IP address, it can be optionally followed by its CIDR mask or subnet mask. For example, <code>1.2.3.4/25</code> or <code>1.2.3.4:255.255.255.128</code>.</p></dd><dt class=hdlist1>SRC_PORT</dt><dd><p>An optional source port can be specified using the port number or name from <span class=filename>/etc/services</span>.</p></dd><dt class=hdlist1>DST</dt><dd><p>The <code>to</code> keyword must be followed by the destination address or a keyword that represents the destination address. The same keywords and addresses described in the SRC section can be used to describe the destination.</p></dd><dt class=hdlist1>DST_PORT</dt><dd><p>An optional destination port can be specified using the port number or name from <span class=filename>/etc/services</span>.</p></dd><dt class=hdlist1>OPTIONS</dt><dd><p>Several keywords can follow the source and destination. As the name suggests, OPTIONS are optional. Commonly used options include <code>in</code> or <code>out</code>, which specify the direction of packet flow, <code>icmptypes</code> followed by the type of ICMP message, and <code>keep-state</code>.</p><div class=paragraph><p>When a <code>keep-state</code> rule is matched, the firewall will create a dynamic rule which matches bidirectional traffic between the source and destination addresses and ports using the same protocol.</p></div><div class=paragraph><p>The dynamic rules facility is vulnerable to resource depletion from a SYN-flood attack which would open a huge number of dynamic rules. To counter this type of attack with IPFW, use <code>limit</code>. This option limits the number of simultaneous sessions by checking the open dynamic rules, counting the number of times this rule and IP address combination occurred. If this count is greater than the value specified by <code>limit</code>, the packet is discarded.</p></div><div class=paragraph><p>Dozens of OPTIONS are available. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=ipfw&amp;sektion=8&amp;format=html">ipfw(8)</a> for a description of each available option.</p></div></dd></dl></div></div><div class=sect3><h4 id=_example_ruleset>30.4.3. Example Ruleset<a class=anchor href=#_example_ruleset></a></h4><div class=paragraph><p>This section demonstrates how to create an example stateful firewall ruleset script named <span class=filename>/etc/ipfw.rules</span>. In this example, all connection rules use <code>in</code> or <code>out</code> to clarify the direction. They also use <code>via</code> <em>interface-name</em> to specify the interface the packet is traveling over.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>When first creating or testing a firewall ruleset, consider temporarily setting this tunable:</p></div><div class="literalblock programlisting"><div class=content><pre>net.inet.ip.fw.default_to_accept=&#34;1&#34;</pre></div></div><div class=paragraph><p>This sets the default policy of <a href="https://man.freebsd.org/cgi/man.cgi?query=ipfw&amp;sektion=8&amp;format=html">ipfw(8)</a> to be more permissive than the default <code>deny ip from any to any</code>, making it slightly more difficult to get locked out of the system right after a reboot.</p></div></td></tr></tbody></table></div><div class=paragraph><p>The firewall script begins by indicating that it is a Bourne shell script and flushes any existing rules. It then creates the <code>cmd</code> variable so that <code>ipfw add</code> does not have to be typed at the beginning of every rule. It also defines the <code>pif</code> variable which represents the name of the interface that is attached to the Internet.</p></div><div class="literalblock programlisting"><div class=content><pre>#!/bin/sh
# Flush out the list before we begin.
ipfw -q -f flush

# Set rules command prefix
cmd=&#34;ipfw -q add&#34;
pif=&#34;dc0&#34;     # interface name of NIC attached to Internet</pre></div></div><div class=paragraph><p>The first two rules allow all traffic on the trusted internal interface and on the loopback interface:</p></div><div class="literalblock programlisting"><div class=content><pre># Change xl0 to LAN NIC interface name
$cmd 00005 allow all from any to any via xl0

# No restrictions on Loopback Interface
$cmd 00010 allow all from any to any via lo0</pre></div></div><div class=paragraph><p>The next rule allows the packet through if it matches an existing entry in the dynamic rules table:</p></div><div class="literalblock programlisting"><div class=content><pre>$cmd 00101 check-state</pre></div></div><div class=paragraph><p>The next set of rules defines which stateful connections internal systems can create to hosts on the Internet:</p></div><div class="literalblock programlisting"><div class=content><pre># Allow access to public DNS
# Replace x.x.x.x with the IP address of a public DNS server
# and repeat for each DNS server in /etc/resolv.conf
$cmd 00110 allow tcp from any to x.x.x.x 53 out via $pif setup keep-state
$cmd 00111 allow udp from any to x.x.x.x 53 out via $pif keep-state

# Allow access to ISP&#39;s DHCP server for cable/DSL configurations.
# Use the first rule and check log for IP address.
# Then, uncomment the second rule, input the IP address, and delete the first rule
$cmd 00120 allow log udp from any to any 67 out via $pif keep-state
#$cmd 00120 allow udp from any to x.x.x.x 67 out via $pif keep-state

# Allow outbound HTTP and HTTPS connections
$cmd 00200 allow tcp from any to any 80 out via $pif setup keep-state
$cmd 00220 allow tcp from any to any 443 out via $pif setup keep-state

# Allow outbound email connections
$cmd 00230 allow tcp from any to any 25 out via $pif setup keep-state
$cmd 00231 allow tcp from any to any 110 out via $pif setup keep-state

# Allow outbound ping
$cmd 00250 allow icmp from any to any out via $pif keep-state

# Allow outbound NTP
$cmd 00260 allow udp from any to any 123 out via $pif keep-state

# Allow outbound SSH
$cmd 00280 allow tcp from any to any 22 out via $pif setup keep-state

# deny and log all other outbound connections
$cmd 00299 deny log all from any to any out via $pif</pre></div></div><div class=paragraph><p>The next set of rules controls connections from Internet hosts to the internal network. It starts by denying packets typically associated with attacks and then explicitly allows specific types of connections. All the authorized services that originate from the Internet use <code>limit</code> to prevent flooding.</p></div><div class="literalblock programlisting"><div class=content><pre># Deny all inbound traffic from non-routable reserved address spaces
$cmd 00300 deny all from 192.168.0.0/16 to any in via $pif     #RFC 1918 private IP
$cmd 00301 deny all from 172.16.0.0/12 to any in via $pif      #RFC 1918 private IP
$cmd 00302 deny all from 10.0.0.0/8 to any in via $pif         #RFC 1918 private IP
$cmd 00303 deny all from 127.0.0.0/8 to any in via $pif        #loopback
$cmd 00304 deny all from 0.0.0.0/8 to any in via $pif          #loopback
$cmd 00305 deny all from 169.254.0.0/16 to any in via $pif     #DHCP auto-config
$cmd 00306 deny all from 192.0.2.0/24 to any in via $pif       #reserved for docs
$cmd 00307 deny all from 204.152.64.0/23 to any in via $pif    #Sun cluster interconnect
$cmd 00308 deny all from 224.0.0.0/3 to any in via $pif        #Class D &amp; E multicast

# Deny public pings
$cmd 00310 deny icmp from any to any in via $pif

# Deny ident
$cmd 00315 deny tcp from any to any 113 in via $pif

# Deny all Netbios services.
$cmd 00320 deny tcp from any to any 137 in via $pif
$cmd 00321 deny tcp from any to any 138 in via $pif
$cmd 00322 deny tcp from any to any 139 in via $pif
$cmd 00323 deny tcp from any to any 81 in via $pif

# Deny fragments
$cmd 00330 deny all from any to any frag in via $pif

# Deny ACK packets that did not match the dynamic rule table
$cmd 00332 deny tcp from any to any established in via $pif

# Allow traffic from ISP&#39;s DHCP server.
# Replace x.x.x.x with the same IP address used in rule 00120.
#$cmd 00360 allow udp from any to x.x.x.x 67 in via $pif keep-state

# Allow HTTP connections to internal web server
$cmd 00400 allow tcp from any to me 80 in via $pif setup limit src-addr 2

# Allow inbound SSH connections
$cmd 00410 allow tcp from any to me 22 in via $pif setup limit src-addr 2

# Reject and log all other incoming connections
$cmd 00499 deny log all from any to any in via $pif</pre></div></div><div class=paragraph><p>The last rule logs all packets that do not match any of the rules in the ruleset:</p></div><div class="literalblock programlisting"><div class=content><pre># Everything else is denied and logged
$cmd 00999 deny log all from any to any</pre></div></div></div><div class=sect3><h4 id=in-kernel-nat>30.4.4. In-kernel NAT<a class=anchor href=#in-kernel-nat></a></h4><div class=paragraph><p>FreeBSD’s IPFW firewall has two implementations of NAT: the userland implementation <a href="https://man.freebsd.org/cgi/man.cgi?query=natd&amp;sektion=8&amp;format=html">natd(8)</a>, and the more recent in-kernel NAT implementation. Both work in conjunction with IPFW to provide network address translation. This can be used to provide an Internet Connection Sharing solution so that several internal computers can connect to the Internet using a single public IP address.</p></div><div class=paragraph><p>To do this, the FreeBSD machine connected to the Internet must act as a gateway. This system must have two NICs, where one is connected to the Internet and the other is connected to the internal LAN. Each machine connected to the LAN should be assigned an IP address in the private network space, as defined by <a href=https://www.ietf.org/rfc/rfc1918.txt>RFC 1918</a>.</p></div><div class=paragraph><p>Some additional configuration is needed in order to enable the in-kernel NAT facility of IPFW. To enable in-kernel NAT support at boot time, the following must be set in <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>gateway_enable=&#34;YES&#34;
firewall_enable=&#34;YES&#34;
firewall_nat_enable=&#34;YES&#34;</pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>When <code>firewall_nat_enable</code> is set but <code>firewall_enable</code> is not, it will have no effect and do nothing. This is because the in-kernel NAT implementation is only compatible with IPFW.</p></div></td></tr></tbody></table></div><div class=paragraph><p>When the ruleset contains stateful rules, the positioning of the NAT rule is critical and the <code>skipto</code> action is used. The <code>skipto</code> action requires a rule number so that it knows which rule to jump to. The example below builds upon the firewall ruleset shown in the previous section. It adds some additional entries and modifies some existing rules in order to configure the firewall for in-kernel NAT. It starts by adding some additional variables which represent the rule number to skip to, the <code>keep-state</code> option, and a list of TCP ports which will be used to reduce the number of rules.</p></div><div class="literalblock programlisting"><div class=content><pre>#!/bin/sh
ipfw -q -f flush
cmd=&#34;ipfw -q add&#34;
skip=&#34;skipto 1000&#34;
pif=dc0
ks=&#34;keep-state&#34;
good_tcpo=&#34;22,25,37,53,80,443,110&#34;</pre></div></div><div class=paragraph><p>With in-kernel NAT it is necessary to disable TCP segmentation offloading (TSO) due to the architecture of <a href="https://man.freebsd.org/cgi/man.cgi?query=libalias&amp;sektion=3&amp;format=html">libalias(3)</a>, a library implemented as a kernel module to provide the in-kernel NAT facility of IPFW. TSO can be disabled on a per network interface basis using <a href="https://man.freebsd.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;format=html">ifconfig(8)</a> or on a system wide basis using <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a>. To disable TSO system wide, the following must be set it <span class=filename>/etc/sysctl.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>net.inet.tcp.tso=&#34;0&#34;</pre></div></div><div class=paragraph><p>A NAT instance will also be configured. It is possible to have multiple NAT instances each with their own configuration. For this example only one NAT instance is needed, NAT instance number 1. The configuration can take a few options such as: <code>if</code> which indicates the public interface, <code>same_ports</code> which takes care that alliased ports and local port numbers are mapped the same, <code>unreg_only</code> will result in only unregistered (private) address spaces to be processed by the NAT instance, and <code>reset</code> which will help to keep a functioning NAT instance even when the public IP address of the IPFW machine changes. For all possible options that can be passed to a single NAT instance configuration consult <a href="https://man.freebsd.org/cgi/man.cgi?query=ipfw&amp;sektion=8&amp;format=html">ipfw(8)</a>. When configuring a stateful NATing firewall, it is neseccary to allow translated packets to be reinjected in the firewall for further processing. This can be achieved by disabling <code>one_pass</code> behavior at the start of the firewall script.</p></div><div class="literalblock programlisting"><div class=content><pre>ipfw disable one_pass
ipfw -q nat 1 config if $pif same_ports unreg_only reset</pre></div></div><div class=paragraph><p>The inbound NAT rule is inserted <em>after</em> the two rules which allow all traffic on the trusted and loopback interfaces and after the reassemble rule but <em>before</em> the <code>check-state</code> rule. It is important that the rule number selected for this NAT rule, in this example <code>100</code>, is higher than the first three rules and lower than the <code>check-state</code> rule. Furthermore, because of the behavior of in-kernel NAT it is advised to place a reassemble rule just before the first NAT rule and after the rules that allow traffic on trusted interface. Normally, IP fragmentation should not happen, but when dealing with IPSEC/ESP/GRE tunneling traffic it might and the reassembling of fragments is necessary before handing the complete packet over to the in-kernel NAT facility.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>The reassemble rule was not needed with userland <a href="https://man.freebsd.org/cgi/man.cgi?query=natd&amp;sektion=8&amp;format=html">natd(8)</a> because the internal workings of the IPFW <code>divert</code> action already takes care of reassembling packets before delivery to the socket as also stated in <a href="https://man.freebsd.org/cgi/man.cgi?query=ipfw&amp;sektion=8&amp;format=html">ipfw(8)</a>.</p></div><div class=paragraph><p>The NAT instance and rule number used in this example does not match with the default NAT instance and rule number created by <span class=filename>rc.firewall</span>. <span class=filename>rc.firewall</span> is a script that sets up the default firewall rules present in FreeBSD.</p></div></td></tr></tbody></table></div><div class="literalblock programlisting"><div class=content><pre>$cmd 005 allow all from any to any via xl0  # exclude LAN traffic
$cmd 010 allow all from any to any via lo0  # exclude loopback traffic
$cmd 099 reass all from any to any in       # reassemble inbound packets
$cmd 100 nat 1 ip from any to any in via $pif # NAT any inbound packets
# Allow the packet through if it has an existing entry in the dynamic rules table
$cmd 101 check-state</pre></div></div><div class=paragraph><p>The outbound rules are modified to replace the <code>allow</code> action with the <code>$skip</code> variable, indicating that rule processing will continue at rule <code>1000</code>. The seven <code>tcp</code> rules have been replaced by rule <code>125</code> as the <code>$good_tcpo</code> variable contains the seven allowed outbound ports.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Remember that IPFW’s performance is largely determined by the number of rules present in the ruleset.</p></div></td></tr></tbody></table></div><div class="literalblock programlisting"><div class=content><pre># Authorized outbound packets
$cmd 120 $skip udp from any to x.x.x.x 53 out via $pif $ks
$cmd 121 $skip udp from any to x.x.x.x 67 out via $pif $ks
$cmd 125 $skip tcp from any to any $good_tcpo out via $pif setup $ks
$cmd 130 $skip icmp from any to any out via $pif $ks</pre></div></div><div class=paragraph><p>The inbound rules remain the same, except for the very last rule which removes the <code>via $pif</code> in order to catch both inbound and outbound rules. The NAT rule must follow this last outbound rule, must have a higher number than that last rule, and the rule number must be referenced by the <code>skipto</code> action. In this ruleset, rule number <code>1000</code> handles passing all packets to our configured instance for NAT processing. The next rule allows any packet which has undergone NAT processing to pass.</p></div><div class="literalblock programlisting"><div class=content><pre>$cmd 999 deny log all from any to any
$cmd 1000 nat 1 ip from any to any out via $pif # skipto location for outbound stateful rules
$cmd 1001 allow ip from any to any</pre></div></div><div class=paragraph><p>In this example, rules <code>100</code>, <code>101</code>, <code>125</code>, <code>1000</code>, and <code>1001</code> control the address translation of the outbound and inbound packets so that the entries in the dynamic state table always register the private LANIP address.</p></div><div class=paragraph><p>Consider an internal web browser which initializes a new outbound HTTP session over port 80. When the first outbound packet enters the firewall, it does not match rule <code>100</code> because it is headed out rather than in. It passes rule <code>101</code> because this is the first packet and it has not been posted to the dynamic state table yet. The packet finally matches rule <code>125</code> as it is outbound on an allowed port and has a source IP address from the internal LAN. On matching this rule, two actions take place. First, the <code>keep-state</code> action adds an entry to the dynamic state table and the specified action, <code>skipto rule 1000</code>, is executed. Next, the packet undergoes NAT and is sent out to the Internet. This packet makes its way to the destination web server, where a response packet is generated and sent back. This new packet enters the top of the ruleset. It matches rule <code>100</code> and has its destination IP address mapped back to the original internal address. It then is processed by the <code>check-state</code> rule, is found in the table as an existing session, and is released to the LAN.</p></div><div class=paragraph><p>On the inbound side, the ruleset has to deny bad packets and allow only authorized services. A packet which matches an inbound rule is posted to the dynamic state table and the packet is released to the LAN. The packet generated as a response is recognized by the <code>check-state</code> rule as belonging to an existing session. It is then sent to rule <code>1000</code> to undergo NAT before being released to the outbound interface.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Transitioning from userland <a href="https://man.freebsd.org/cgi/man.cgi?query=natd&amp;sektion=8&amp;format=html">natd(8)</a> to in-kernel NAT might seem seamless at first but there is small catch. When using the GENERIC kernel, IPFW will load the <span class=filename>libalias.ko</span> kernel module, when <code>firewall_nat_enable</code> is enabled in <span class=filename>rc.conf</span>. The <span class=filename>libalias.ko</span> kernel module only provides basic NAT functionality, whereas the userland implementation <a href="https://man.freebsd.org/cgi/man.cgi?query=natd&amp;sektion=8&amp;format=html">natd(8)</a> has all NAT functionality available in its userland library without any extra configuration. All functionality refers to the following kernel modules that can additionally be loaded when needed besides the standard <span class=filename>libalias.ko</span> kernel module: <span class=filename>alias_cuseeme.ko</span>, <span class=filename>alias_ftp.ko</span>, <span class=filename>alias_bbt.ko</span>, <span class=filename>skinny.ko</span>, <span class=filename>irc.ko</span>, <span class=filename>alias_pptp.ko</span> and <span class=filename>alias_smedia.ko</span> using the <code>kld_list</code> directive in <span class=filename>rc.conf</span>. If a custom kernel is used, the full functionality of the userland library can be compiled in, in the kernel, using the <code>options LIBALIAS</code>.</p></div></td></tr></tbody></table></div><div class=sect4><h5 id=_port_redirection>30.4.4.1. Port Redirection<a class=anchor href=#_port_redirection></a></h5><div class=paragraph><p>The drawback with NAT in general is that the LAN clients are not accessible from the Internet. Clients on the LAN can make outgoing connections to the world but cannot receive incoming ones. This presents a problem if trying to run Internet services on one of the LAN client machines. A simple way around this is to redirect selected Internet ports on the NAT providing machine to a LAN client.</p></div><div class=paragraph><p>For example, an IRC server runs on client <code>A</code> and a web server runs on client <code>B</code>. For this to work properly, connections received on ports 6667 (IRC) and 80 (HTTP) must be redirected to the respective machines.</p></div><div class=paragraph><p>With in-kernel NAT all configuration is done in the NAT instance configuration. For a full list of options that an in-kernel NAT instance can use, consult <a href="https://man.freebsd.org/cgi/man.cgi?query=ipfw&amp;sektion=8&amp;format=html">ipfw(8)</a>. The IPFW syntax follows the syntax of natd. The syntax for <code>redirect_port</code> is as follows:</p></div><div class="literalblock programlisting"><div class=content><pre>redirect_port proto targetIP:targetPORT[-targetPORT]
  [aliasIP:]aliasPORT[-aliasPORT]
  [remoteIP[:remotePORT[-remotePORT]]]</pre></div></div><div class=paragraph><p>To configure the above example setup, the arguments should be:</p></div><div class="literalblock programlisting"><div class=content><pre>redirect_port tcp 192.168.0.2:6667 6667
redirect_port tcp 192.168.0.3:80 80</pre></div></div><div class=paragraph><p>After adding these arguments to the configuration of NAT instance 1 in the above ruleset, the TCP ports will be port forwarded to the LAN client machines running the IRC and HTTP services.</p></div><div class="literalblock programlisting"><div class=content><pre>ipfw -q nat 1 config if $pif same_ports unreg_only reset \
  redirect_port tcp 192.168.0.2:6667 6667 \
  redirect_port tcp 192.168.0.3:80 80</pre></div></div><div class=paragraph><p>Port ranges over individual ports can be indicated with <code>redirect_port</code>. For example, <em>tcp 192.168.0.2:2000-3000 2000-3000</em> would redirect all connections received on ports 2000 to 3000 to ports 2000 to 3000 on client <code>A</code>.</p></div></div><div class=sect4><h5 id=_address_redirection>30.4.4.2. Address Redirection<a class=anchor href=#_address_redirection></a></h5><div class=paragraph><p>Address redirection is useful if more than one IP address is available. Each LAN client can be assigned its own external IP address by <a href="https://man.freebsd.org/cgi/man.cgi?query=ipfw&amp;sektion=8&amp;format=html">ipfw(8)</a>, which will then rewrite outgoing packets from the LAN clients with the proper external IP address and redirects all traffic incoming on that particular IP address back to the specific LAN client. This is also known as static NAT. For example, if IP addresses <code>128.1.1.1</code>, <code>128.1.1.2</code>, and <code>128.1.1.3</code> are available, <code>128.1.1.1</code> can be used as the <a href="https://man.freebsd.org/cgi/man.cgi?query=ipfw&amp;sektion=8&amp;format=html">ipfw(8)</a> machine’s external IP address, while <code>128.1.1.2</code> and <code>128.1.1.3</code> are forwarded back to LAN clients <code>A</code> and <code>B</code>.</p></div><div class=paragraph><p>The <code>redirect_address</code> syntax is as below, where <code>localIP</code> is the internal IP address of the LAN client, and <code>publicIP</code> the external IP address corresponding to the LAN client.</p></div><div class="literalblock programlisting"><div class=content><pre>redirect_address localIP publicIP</pre></div></div><div class=paragraph><p>In the example, the arguments would read:</p></div><div class="literalblock programlisting"><div class=content><pre>redirect_address 192.168.0.2 128.1.1.2
redirect_address 192.168.0.3 128.1.1.3</pre></div></div><div class=paragraph><p>Like <code>redirect_port</code>, these arguments are placed in a NAT instance configuration. With address redirection, there is no need for port redirection, as all data received on a particular IP address is redirected.</p></div><div class=paragraph><p>The external IP addresses on the <a href="https://man.freebsd.org/cgi/man.cgi?query=ipfw&amp;sektion=8&amp;format=html">ipfw(8)</a> machine must be active and aliased to the external interface. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=rc.conf&amp;sektion=5&amp;format=html">rc.conf(5)</a> for details.</p></div></div><div class=sect4><h5 id=_userspace_nat>30.4.4.3. Userspace NAT<a class=anchor href=#_userspace_nat></a></h5><div class=paragraph><p>Let us start with a statement: the userspace NAT implementation: <a href="https://man.freebsd.org/cgi/man.cgi?query=natd&amp;sektion=8&amp;format=html">natd(8)</a>, has more overhead than in-kernel NAT. For <a href="https://man.freebsd.org/cgi/man.cgi?query=natd&amp;sektion=8&amp;format=html">natd(8)</a> to translate packets, the packets have to be copied from the kernel to userspace and back which brings in extra overhead that is not present with in-kernel NAT.</p></div><div class=paragraph><p>To enable the userpace NAT daemon <a href="https://man.freebsd.org/cgi/man.cgi?query=natd&amp;sektion=8&amp;format=html">natd(8)</a> at boot time, the following is a minimum configuration in <span class=filename>/etc/rc.conf</span>. Where <code>natd_interface</code> is set to the name of the NIC attached to the Internet. The <a href="https://man.freebsd.org/cgi/man.cgi?query=rc&amp;sektion=8&amp;format=html">rc(8)</a> script of <a href="https://man.freebsd.org/cgi/man.cgi?query=natd&amp;sektion=8&amp;format=html">natd(8)</a> will automatically check if a dynamic IP address is used and configure itself to handle that.</p></div><div class="literalblock programlisting"><div class=content><pre>gateway_enable=&#34;YES&#34;
natd_enable=&#34;YES&#34;
natd_interface=&#34;rl0&#34;</pre></div></div><div class=paragraph><p>In general, the above ruleset as explained for in-kernel NAT can also be used together with <a href="https://man.freebsd.org/cgi/man.cgi?query=natd&amp;sektion=8&amp;format=html">natd(8)</a>. The exceptions are the configuration of the in-kernel NAT instance <code>(ipfw -q nat 1 config …​)</code> which is not needed together with reassemble rule 99 because its functionality is included in the <code>divert</code> action. Rule number 100 and 1000 will have to change sligthly as shown below.</p></div><div class="literalblock programlisting"><div class=content><pre>$cmd 100 divert natd ip from any to any in via $pif
$cmd 1000 divert natd ip from any to any out via $pif</pre></div></div><div class=paragraph><p>To configure port or address redirection, a similar syntax as with in-kernel NAT is used. Although, now, instead of specifying the configuration in our ruleset script like with in-kernel NAT, configuration of <a href="https://man.freebsd.org/cgi/man.cgi?query=natd&amp;sektion=8&amp;format=html">natd(8)</a> is best done in a configuration file. To do this, an extra flag must be passed via <span class=filename>/etc/rc.conf</span> which specifies the path of the configuration file.</p></div><div class="literalblock programlisting"><div class=content><pre>natd_flags=&#34;-f /etc/natd.conf&#34;</pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>The specified file must contain a list of configuration options, one per line. For more information about the configuration file and possible variables, consult <a href="https://man.freebsd.org/cgi/man.cgi?query=natd&amp;sektion=8&amp;format=html">natd(8)</a>. Below are two example entries, one per line:</p></div><div class="literalblock programlisting"><div class=content><pre>redirect_port tcp 192.168.0.2:6667 6667
redirect_address 192.168.0.3 128.1.1.3</pre></div></div></td></tr></tbody></table></div></div></div><div class=sect3><h4 id=firewalls-ipfw-cmd>30.4.5. The IPFW Command<a class=anchor href=#firewalls-ipfw-cmd></a></h4><div class=paragraph><p><code>ipfw</code> can be used to make manual, single rule additions or deletions to the active firewall while it is running. The problem with using this method is that all the changes are lost when the system reboots. It is recommended to instead write all the rules in a file and to use that file to load the rules at boot time and to replace the currently running firewall rules whenever that file changes.</p></div><div class=paragraph><p><code>ipfw</code> is a useful way to display the running firewall rules to the console screen. The IPFW accounting facility dynamically creates a counter for each rule that counts each packet that matches the rule. During the process of testing a rule, listing the rule with its counter is one way to determine if the rule is functioning as expected.</p></div><div class=paragraph><p>To list all the running rules in sequence:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ipfw list</span></code></pre></div></div><div class=paragraph><p>To list all the running rules with a time stamp of when the last time the rule was matched:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ipfw -t list</span></code></pre></div></div><div class=paragraph><p>The next example lists accounting information and the packet count for matched rules along with the rules themselves. The first column is the rule number, followed by the number of matched packets and bytes, followed by the rule itself.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ipfw -a list</span></code></pre></div></div><div class=paragraph><p>To list dynamic rules in addition to static rules:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ipfw -d list</span></code></pre></div></div><div class=paragraph><p>To also show the expired dynamic rules:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ipfw -d -e list</span></code></pre></div></div><div class=paragraph><p>To zero the counters:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ipfw zero</span></code></pre></div></div><div class=paragraph><p>To zero the counters for just the rule with number <em>NUM</em>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ipfw zero NUM</span></code></pre></div></div><div class=sect4><h5 id=_logging_firewall_messages>30.4.5.1. Logging Firewall Messages<a class=anchor href=#_logging_firewall_messages></a></h5><div class=paragraph><p>Even with the logging facility enabled, IPFW will not generate any rule logging on its own. The firewall administrator decides which rules in the ruleset will be logged, and adds the <code>log</code> keyword to those rules. Normally only deny rules are logged. It is customary to duplicate the "ipfw default deny everything" rule with the <code>log</code> keyword included as the last rule in the ruleset. This way, it is possible to see all the packets that did not match any of the rules in the ruleset.</p></div><div class=paragraph><p>Logging is a two edged sword. If one is not careful, an over abundance of log data or a DoS attack can fill the disk with log files. Log messages are not only written to syslogd, but also are displayed on the root console screen and soon become annoying.</p></div><div class=paragraph><p>The <code>IPFIREWALL_VERBOSE_LIMIT=5</code> kernel option limits the number of consecutive messages sent to <a href="https://man.freebsd.org/cgi/man.cgi?query=syslogd&amp;sektion=8&amp;format=html">syslogd(8)</a>, concerning the packet matching of a given rule. When this option is enabled in the kernel, the number of consecutive messages concerning a particular rule is capped at the number specified. There is nothing to be gained from 200 identical log messages. With this option set to five, five consecutive messages concerning a particular rule would be logged to syslogd and the remainder identical consecutive messages would be counted and posted to syslogd with a phrase like the following:</p></div><div class="literalblock programlisting"><div class=content><pre>last message repeated 45 times</pre></div></div><div class=paragraph><p>All logged packets messages are written by default to <span class=filename>/var/log/security</span>, which is defined in <span class=filename>/etc/syslog.conf</span>.</p></div></div><div class=sect4><h5 id=firewalls-ipfw-rules-script>30.4.5.2. Building a Rule Script<a class=anchor href=#firewalls-ipfw-rules-script></a></h5><div class=paragraph><p>Most experienced IPFW users create a file containing the rules and code them in a manner compatible with running them as a script. The major benefit of doing this is the firewall rules can be refreshed in mass without the need of rebooting the system to activate them. This method is convenient in testing new rules as the procedure can be executed as many times as needed. Being a script, symbolic substitution can be used for frequently used values to be substituted into multiple rules.</p></div><div class=paragraph><p>This example script is compatible with the syntax used by the <a href="https://man.freebsd.org/cgi/man.cgi?query=sh&amp;sektion=1&amp;format=html">sh(1)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=csh&amp;sektion=1&amp;format=html">csh(1)</a>, and <a href="https://man.freebsd.org/cgi/man.cgi?query=tcsh&amp;sektion=1&amp;format=html">tcsh(1)</a> shells. Symbolic substitution fields are prefixed with a dollar sign ($). Symbolic fields do not have the $ prefix. The value to populate the symbolic field must be enclosed in double quotes ("").</p></div><div class=paragraph><p>Start the rules file like this:</p></div><div class="literalblock programlisting"><div class=content><pre>############### start of example ipfw rules script #############
#
ipfw -q -f flush       # Delete all rules
# Set defaults
oif=&#34;tun0&#34;             # out interface
odns=&#34;192.0.2.11&#34;      # ISP&#39;s DNS server IP address
cmd=&#34;ipfw -q add &#34;     # build rule prefix
ks=&#34;keep-state&#34;        # just too lazy to key this each time
$cmd 00500 check-state
$cmd 00502 deny all from any to any frag
$cmd 00501 deny tcp from any to any established
$cmd 00600 allow tcp from any to any 80 out via $oif setup $ks
$cmd 00610 allow tcp from any to $odns 53 out via $oif setup $ks
$cmd 00611 allow udp from any to $odns 53 out via $oif $ks
################### End of example ipfw rules script ############</pre></div></div><div class=paragraph><p>The rules are not important as the focus of this example is how the symbolic substitution fields are populated.</p></div><div class=paragraph><p>If the above example was in <span class=filename>/etc/ipfw.rules</span>, the rules could be reloaded by the following command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sh /etc/ipfw.rules</span></code></pre></div></div><div class=paragraph><p><span class=filename>/etc/ipfw.rules</span> can be located anywhere and the file can have any name.</p></div><div class=paragraph><p>The same thing could be accomplished by running these commands by hand:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ipfw -q -f flush</span>
<span class=c># ipfw -q add check-state</span>
<span class=c># ipfw -q add deny all from any to any frag</span>
<span class=c># ipfw -q add deny tcp from any to any established</span>
<span class=c># ipfw -q add allow tcp from any to any 80 out via tun0 setup keep-state</span>
<span class=c># ipfw -q add allow tcp from any to 192.0.2.11 53 out via tun0 setup keep-state</span>
<span class=c># ipfw -q add 00611 allow udp from any to 192.0.2.11 53 out via tun0 keep-state</span></code></pre></div></div></div></div><div class=sect3><h4 id=firewalls-ipfw-kernelconfig>30.4.6. IPFW Kernel Options<a class=anchor href=#firewalls-ipfw-kernelconfig></a></h4><div class=paragraph><p>In order to statically compile IPFW support into a custom kernel, refer to the instructions in <a href=./#kernelconfig>Configuring the FreeBSD Kernel</a>. The following options are available for the custom kernel configuration file:</p></div><div class="literalblock programlisting"><div class=content><pre>options    IPFIREWALL			# enables IPFW
options    IPFIREWALL_VERBOSE		# enables logging for rules with log keyword to syslogd(8)
options    IPFIREWALL_VERBOSE_LIMIT=5	# limits number of logged packets per-entry
options    IPFIREWALL_DEFAULT_TO_ACCEPT # sets default policy to pass what is not explicitly denied
options    IPFIREWALL_NAT		# enables basic in-kernel NAT support
options    LIBALIAS			# enables full in-kernel NAT support
options    IPFIREWALL_NAT64		# enables in-kernel NAT64 support
options    IPFIREWALL_NPTV6		# enables in-kernel IPv6 NPT support
options    IPFIREWALL_PMOD		# enables protocols modification module support
options    IPDIVERT			# enables NAT through natd(8)</pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>IPFW can be loaded as a kernel module: options above are built by default as modules or can be set at runtime using tunables.</p></div></td></tr></tbody></table></div></div></div><div class=sect2><h3 id=firewalls-ipf>30.5. IPFILTER (IPF)<a class=anchor href=#firewalls-ipf></a></h3><div class=paragraph><p>IPFILTER, also known as IPF, is a cross-platform, open source firewall which has been ported to several operating systems, including FreeBSD, NetBSD, OpenBSD, and Solaris™.</p></div><div class=paragraph><p>IPFILTER is a kernel-side firewall and NAT mechanism that can be controlled and monitored by userland programs. Firewall rules can be set or deleted using ipf, NAT rules can be set or deleted using ipnat, run-time statistics for the kernel parts of IPFILTER can be printed using ipfstat, and ipmon can be used to log IPFILTER actions to the system log files.</p></div><div class=paragraph><p>IPF was originally written using a rule processing logic of "the last matching rule wins" and only used stateless rules. Since then, IPF has been enhanced to include the <code>quick</code> and <code>keep state</code> options.</p></div><div class=paragraph><p>The IPF FAQ is at <a href=http://www.phildev.net/ipf/index.html>http://www.phildev.net/ipf/index.html</a>. A searchable archive of the IPFilter mailing list is available at <a href="http://marc.info/?l=ipfilter">http://marc.info/?l=ipfilter</a>.</p></div><div class=paragraph><p>This section of the Handbook focuses on IPF as it pertains to FreeBSD. It provides examples of rules that contain the <code>quick</code> and <code>keep state</code> options.</p></div><div class=sect3><h4 id=_enabling_ipf>30.5.1. Enabling IPF<a class=anchor href=#_enabling_ipf></a></h4><div class=paragraph><p>IPF is included in the basic FreeBSD install as a kernel loadable module, meaning that a custom kernel is not needed in order to enable IPF.</p></div><div class=paragraph><p>For users who prefer to statically compile IPF support into a custom kernel, refer to the instructions in <a href=./#kernelconfig>Configuring the FreeBSD Kernel</a>. The following kernel options are available:</p></div><div class="literalblock programlisting"><div class=content><pre>options IPFILTER
options IPFILTER_LOG
options IPFILTER_LOOKUP
options IPFILTER_DEFAULT_BLOCK</pre></div></div><div class=paragraph><p>where <code>options IPFILTER</code> enables support for IPFILTER, <code>options IPFILTER_LOG</code> enables IPF logging using the <span class=filename>ipl</span> packet logging pseudo-device for every rule that has the <code>log</code> keyword, <code>IPFILTER_LOOKUP</code> enables IP pools in order to speed up IP lookups, and <code>options IPFILTER_DEFAULT_BLOCK</code> changes the default behavior so that any packet not matching a firewall <code>pass</code> rule gets blocked.</p></div><div class=paragraph><p>To configure the system to enable IPF at boot time, add the following entries to <span class=filename>/etc/rc.conf</span>. These entries will also enable logging and <code>default pass all</code>. To change the default policy to <code>block all</code> without compiling a custom kernel, remember to add a <code>block all</code> rule at the end of the ruleset.</p></div><div class="literalblock programlisting"><div class=content><pre>ipfilter_enable=&#34;YES&#34;             # Start ipf firewall
ipfilter_rules=&#34;/etc/ipf.rules&#34;   # loads rules definition text file
ipv6_ipfilter_rules=&#34;/etc/ipf6.rules&#34; # loads rules definition text file for IPv6
ipmon_enable=&#34;YES&#34;                # Start IP monitor log
ipmon_flags=&#34;-Ds&#34;                 # D = start as daemon
                                  # s = log to syslog
                                  # v = log tcp window, ack, seq
                                  # n = map IP &amp; port to names</pre></div></div><div class=paragraph><p>If NAT functionality is needed, also add these lines:</p></div><div class="literalblock programlisting"><div class=content><pre>gateway_enable=&#34;YES&#34;              # Enable as LAN gateway
ipnat_enable=&#34;YES&#34;                # Start ipnat function
ipnat_rules=&#34;/etc/ipnat.rules&#34;    # rules definition file for ipnat</pre></div></div><div class=paragraph><p>Then, to start IPF now:</p></div><div class="literalblock programlisting"><div class=content><pre>#  service ipfilter start</pre></div></div><div class=paragraph><p>To load the firewall rules, specify the name of the ruleset file using <code>ipf</code>. The following command can be used to replace the currently running firewall rules:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ipf -Fa -f /etc/ipf.rules</span></code></pre></div></div><div class=paragraph><p>where <code>-Fa</code> flushes all the internal rules tables and <code>-f</code> specifies the file containing the rules to load.</p></div><div class=paragraph><p>This provides the ability to make changes to a custom ruleset and update the running firewall with a fresh copy of the rules without having to reboot the system. This method is convenient for testing new rules as the procedure can be executed as many times as needed.</p></div><div class=paragraph><p>Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=ipf&amp;sektion=8&amp;format=html">ipf(8)</a> for details on the other flags available with this command.</p></div></div><div class=sect3><h4 id=_ipf_rule_syntax>30.5.2. IPF Rule Syntax<a class=anchor href=#_ipf_rule_syntax></a></h4><div class=paragraph><p>This section describes the IPF rule syntax used to create stateful rules. When creating rules, keep in mind that unless the <code>quick</code> keyword appears in a rule, every rule is read in order, with the <em>last matching rule</em> being the one that is applied. This means that even if the first rule to match a packet is a <code>pass</code>, if there is a later matching rule that is a <code>block</code>, the packet will be dropped. Sample rulesets can be found in <span class=filename>/usr/shared/examples/ipfilter</span>.</p></div><div class=paragraph><p>When creating rules, a <code>#</code> character is used to mark the start of a comment and may appear at the end of a rule, to explain that rule’s function, or on its own line. Any blank lines are ignored.</p></div><div class=paragraph><p>The keywords which are used in rules must be written in a specific order, from left to right. Some keywords are mandatory while others are optional. Some keywords have sub-options which may be keywords themselves and also include more sub-options. The keyword order is as follows, where the words shown in uppercase represent a variable and the words shown in lowercase must precede the variable that follows it:</p></div><div class=paragraph><p><code><em>ACTION DIRECTION OPTIONS proto PROTO_TYPE from SRC_ADDR SRC_PORT to DST_ADDR DST_PORT TCP_FLAG|ICMP_TYPE keep state STATE</em></code></p></div><div class=paragraph><p>This section describes each of these keywords and their options. It is not an exhaustive list of every possible option. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=ipf&amp;sektion=5&amp;format=html">ipf(5)</a> for a complete description of the rule syntax that can be used when creating IPF rules and examples for using each keyword.</p></div><div class=dlist><dl><dt class=hdlist1>ACTION</dt><dd><p>The action keyword indicates what to do with the packet if it matches that rule. Every rule <em>must</em> have an action. The following actions are recognized:</p><div class=paragraph><p><code>block</code>: drops the packet.</p></div><div class=paragraph><p><code>pass</code>: allows the packet.</p></div><div class=paragraph><p><code>log</code>: generates a log record.</p></div><div class=paragraph><p><code>count</code>: counts the number of packets and bytes which can provide an indication of how often a rule is used.</p></div><div class=paragraph><p><code>auth</code>: queues the packet for further processing by another program.</p></div><div class=paragraph><p><code>call</code>: provides access to functions built into IPF that allow more complex actions.</p></div><div class=paragraph><p><code>decapsulate</code>: removes any headers in order to process the contents of the packet.</p></div></dd><dt class=hdlist1>DIRECTION</dt><dd><p>Next, each rule must explicitly state the direction of traffic using one of these keywords:</p><div class=paragraph><p><code>in</code>: the rule is applied against an inbound packet.</p></div><div class=paragraph><p><code>out</code>: the rule is applied against an outbound packet.</p></div><div class=paragraph><p><code>all</code>: the rule applies to either direction.</p></div><div class=paragraph><p>If the system has multiple interfaces, the interface can be specified along with the direction. An example would be <code>in on fxp0</code>.</p></div></dd><dt class=hdlist1>OPTIONS</dt><dd><p>Options are optional. However, if multiple options are specified, they must be used in the order shown here.</p><div class=paragraph><p><code>log</code>: when performing the specified ACTION, the contents of the packet’s headers will be written to the <a href="https://man.freebsd.org/cgi/man.cgi?query=ipl&amp;sektion=4&amp;format=html">ipl(4)</a> packet log pseudo-device.</p></div><div class=paragraph><p><code>quick</code>: if a packet matches this rule, the ACTION specified by the rule occurs and no further processing of any following rules will occur for this packet.</p></div><div class=paragraph><p><code>on</code>: must be followed by the interface name as displayed by <a href="https://man.freebsd.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;format=html">ifconfig(8)</a>. The rule will only match if the packet is going through the specified interface in the specified direction.</p></div><div class=paragraph><p>When using the <code>log</code> keyword, the following qualifiers may be used in this order:</p></div><div class=paragraph><p><code>body</code>: indicates that the first 128 bytes of the packet contents will be logged after the headers.</p></div><div class=paragraph><p><code>first</code>: if the <code>log</code> keyword is being used in conjunction with a <code>keep state</code> option, this option is recommended so that only the triggering packet is logged and not every packet which matches the stateful connection.</p></div><div class=paragraph><p>Additional options are available to specify error return messages. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=ipf&amp;sektion=5&amp;format=html">ipf(5)</a> for more details.</p></div></dd><dt class=hdlist1>PROTO_TYPE</dt><dd><p>The protocol type is optional. However, it is mandatory if the rule needs to specify a SRC_PORT or a DST_PORT as it defines the type of protocol. When specifying the type of protocol, use the <code>proto</code> keyword followed by either a protocol number or name from <span class=filename>/etc/protocols</span>. Example protocol names include <code>tcp</code>, <code>udp</code>, or <code>icmp</code>. If PROTO_TYPE is specified but no SRC_PORT or DST_PORT is specified, all port numbers for that protocol will match that rule.</p></dd><dt class=hdlist1>SRC_ADDR</dt><dd><p>The <code>from</code> keyword is mandatory and is followed by a keyword which represents the source of the packet. The source can be a hostname, an IP address followed by the CIDR mask, an address pool, or the keyword <code>all</code>. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=ipf&amp;sektion=5&amp;format=html">ipf(5)</a> for examples.</p><div class=paragraph><p>There is no way to match ranges of IP addresses which do not express themselves easily using the dotted numeric form / mask-length notation. The <a class=package href=https://cgit.freebsd.org/ports/tree/net-mgmt/ipcalc/>net-mgmt/ipcalc</a> package or port may be used to ease the calculation of the CIDR mask. Additional information is available at the utility’s web page: <a href=http://jodies.de/ipcalc>http://jodies.de/ipcalc</a>.</p></div></dd><dt class=hdlist1>SRC_PORT</dt><dd><p>The port number of the source is optional. However, if it is used, it requires PROTO_TYPE to be first defined in the rule. The port number must also be preceded by the <code>proto</code> keyword.</p><div class=paragraph><p>A number of different comparison operators are supported: <code>=</code> (equal to), <code>!=</code> (not equal to), <code>&lt;</code> (less than), <code>></code> (greater than), <code>⇐</code> (less than or equal to), and <code>>=</code> (greater than or equal to).</p></div><div class=paragraph><p>To specify port ranges, place the two port numbers between <code>&lt;></code> (less than and greater than ), <code>>&lt;</code> (greater than and less than ), or <code>:</code> (greater than or equal to and less than or equal to).</p></div></dd><dt class=hdlist1>DST_ADDR</dt><dd><p>The <code>to</code> keyword is mandatory and is followed by a keyword which represents the destination of the packet. Similar to SRC_ADDR, it can be a hostname, an IP address followed by the CIDR mask, an address pool, or the keyword <code>all</code>.</p></dd><dt class=hdlist1>DST_PORT</dt><dd><p>Similar to SRC_PORT, the port number of the destination is optional. However, if it is used, it requires PROTO_TYPE to be first defined in the rule. The port number must also be preceded by the <code>proto</code> keyword.</p></dd><dt class=hdlist1>TCP_FLAG|ICMP_TYPE</dt><dd><p>If <code>tcp</code> is specified as the PROTO_TYPE, flags can be specified as letters, where each letter represents one of the possible TCP flags used to determine the state of a connection. Possible values are: <code>S</code> (SYN), <code>A</code> (ACK), <code>P</code> (PSH), <code>F</code> (FIN), <code>U</code> (URG), <code>R</code> (RST), <code>C</code> (CWN), and <code>E</code> (ECN).</p><div class=paragraph><p>If <code>icmp</code> is specified as the PROTO_TYPE, the ICMP type to match can be specified. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=ipf&amp;sektion=5&amp;format=html">ipf(5)</a> for the allowable types.</p></div></dd><dt class=hdlist1>STATE</dt><dd><p>If a <code>pass</code> rule contains <code>keep state</code>, IPF will add an entry to its dynamic state table and allow subsequent packets that match the connection. IPF can track state for TCP, UDP, and ICMP sessions. Any packet that IPF can be certain is part of an active session, even if it is a different protocol, will be allowed.</p><div class=paragraph><p>In IPF, packets destined to go out through the interface connected to the public Internet are first checked against the dynamic state table. If the packet matches the next expected packet comprising an active session conversation, it exits the firewall and the state of the session conversation flow is updated in the dynamic state table. Packets that do not belong to an already active session are checked against the outbound ruleset. Packets coming in from the interface connected to the public Internet are first checked against the dynamic state table. If the packet matches the next expected packet comprising an active session, it exits the firewall and the state of the session conversation flow is updated in the dynamic state table. Packets that do not belong to an already active session are checked against the inbound ruleset.</p></div><div class=paragraph><p>Several keywords can be added after <code>keep state</code>. If used, these keywords set various options that control stateful filtering, such as setting connection limits or connection age. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=ipf&amp;sektion=5&amp;format=html">ipf(5)</a> for the list of available options and their descriptions.</p></div></dd></dl></div></div><div class=sect3><h4 id=_example_ruleset_2>30.5.3. Example Ruleset<a class=anchor href=#_example_ruleset_2></a></h4><div class=paragraph><p>This section demonstrates how to create an example ruleset which only allows services matching <code>pass</code> rules and blocks all others.</p></div><div class=paragraph><p>FreeBSD uses the loopback interface (<span class=filename>lo0</span>) and the IP address <code>127.0.0.1</code> for internal communication. The firewall ruleset must contain rules to allow free movement of these internally used packets:</p></div><div class="literalblock programlisting"><div class=content><pre># no restrictions on loopback interface
pass in quick on lo0 all
pass out quick on lo0 all</pre></div></div><div class=paragraph><p>The public interface connected to the Internet is used to authorize and control access of all outbound and inbound connections. If one or more interfaces are cabled to private networks, those internal interfaces may require rules to allow packets originating from the LAN to flow between the internal networks or to the interface attached to the Internet. The ruleset should be organized into three major sections: any trusted internal interfaces, outbound connections through the public interface, and inbound connections through the public interface.</p></div><div class=paragraph><p>These two rules allow all traffic to pass through a trusted LAN interface named <span class=filename>xl0</span>:</p></div><div class="literalblock programlisting"><div class=content><pre># no restrictions on inside LAN interface for private network
pass out quick on xl0 all
pass in quick on xl0 all</pre></div></div><div class=paragraph><p>The rules for the public interface’s outbound and inbound sections should have the most frequently matched rules placed before less commonly matched rules, with the last rule in the section blocking and logging all packets for that interface and direction.</p></div><div class=paragraph><p>This set of rules defines the outbound section of the public interface named <span class=filename>dc0</span>. These rules keep state and identify the specific services that internal systems are authorized for public Internet access. All the rules use <code>quick</code> and specify the appropriate port numbers and, where applicable, destination addresses.</p></div><div class="literalblock programlisting"><div class=content><pre># interface facing Internet (outbound)
# Matches session start requests originating from or behind the
# firewall, destined for the Internet.

# Allow outbound access to public DNS servers.
# Replace x.x.x. with address listed in /etc/resolv.conf.
# Repeat for each DNS server.
pass out quick on dc0 proto tcp from any to x.x.x. port = 53 flags S keep state
pass out quick on dc0 proto udp from any to xxx port = 53 keep state

# Allow access to ISP&#39;s specified DHCP server for cable or DSL networks.
# Use the first rule, then check log for the IP address of DHCP server.
# Then, uncomment the second rule, replace z.z.z.z with the IP address,
# and comment out the first rule
pass out log quick on dc0 proto udp from any to any port = 67 keep state
#pass out quick on dc0 proto udp from any to z.z.z.z port = 67 keep state

# Allow HTTP and HTTPS
pass out quick on dc0 proto tcp from any to any port = 80 flags S keep state
pass out quick on dc0 proto tcp from any to any port = 443 flags S keep state

# Allow email
pass out quick on dc0 proto tcp from any to any port = 110 flags S keep state
pass out quick on dc0 proto tcp from any to any port = 25 flags S keep state

# Allow NTP
pass out quick on dc0 proto tcp from any to any port = 37 flags S keep state

# Allow FTP
pass out quick on dc0 proto tcp from any to any port = 21 flags S keep state

# Allow SSH
pass out quick on dc0 proto tcp from any to any port = 22 flags S keep state

# Allow ping
pass out quick on dc0 proto icmp from any to any icmp-type 8 keep state

# Block and log everything else
block out log first quick on dc0 all</pre></div></div><div class=paragraph><p>This example of the rules in the inbound section of the public interface blocks all undesirable packets first. This reduces the number of packets that are logged by the last rule.</p></div><div class="literalblock programlisting"><div class=content><pre># interface facing Internet (inbound)
# Block all inbound traffic from non-routable or reserved address spaces
block in quick on dc0 from 192.168.0.0/16 to any    #RFC 1918 private IP
block in quick on dc0 from 172.16.0.0/12 to any     #RFC 1918 private IP
block in quick on dc0 from 10.0.0.0/8 to any        #RFC 1918 private IP
block in quick on dc0 from 127.0.0.0/8 to any       #loopback
block in quick on dc0 from 0.0.0.0/8 to any         #loopback
block in quick on dc0 from 169.254.0.0/16 to any    #DHCP auto-config
block in quick on dc0 from 192.0.2.0/24 to any      #reserved for docs
block in quick on dc0 from 204.152.64.0/23 to any   #Sun cluster interconnect
block in quick on dc0 from 224.0.0.0/3 to any       #Class D &amp; E multicast

# Block fragments and too short tcp packets
block in quick on dc0 all with frags
block in quick on dc0 proto tcp all with short

# block source routed packets
block in quick on dc0 all with opt lsrr
block in quick on dc0 all with opt ssrr

# Block OS fingerprint attempts and log first occurrence
block in log first quick on dc0 proto tcp from any to any flags FUP

# Block anything with special options
block in quick on dc0 all with ipopts

# Block public pings and ident
block in quick on dc0 proto icmp all icmp-type 8
block in quick on dc0 proto tcp from any to any port = 113

# Block incoming Netbios services
block in log first quick on dc0 proto tcp/udp from any to any port = 137
block in log first quick on dc0 proto tcp/udp from any to any port = 138
block in log first quick on dc0 proto tcp/udp from any to any port = 139
block in log first quick on dc0 proto tcp/udp from any to any port = 81</pre></div></div><div class=paragraph><p>Any time there are logged messages on a rule with the <code>log first</code> option, run <code>ipfstat -hio</code> to evaluate how many times the rule has been matched. A large number of matches may indicate that the system is under attack.</p></div><div class=paragraph><p>The rest of the rules in the inbound section define which connections are allowed to be initiated from the Internet. The last rule denies all connections which were not explicitly allowed by previous rules in this section.</p></div><div class="literalblock programlisting"><div class=content><pre># Allow traffic in from ISP&#39;s DHCP server. Replace z.z.z.z with
# the same IP address used in the outbound section.
pass in quick on dc0 proto udp from z.z.z.z to any port = 68 keep state

# Allow public connections to specified internal web server
pass in quick on dc0 proto tcp from any to x.x.x.x port = 80 flags S keep state

# Block and log only first occurrence of all remaining traffic.
block in log first quick on dc0 all</pre></div></div></div><div class=sect3><h4 id=_configuring_nat>30.5.4. Configuring NAT<a class=anchor href=#_configuring_nat></a></h4><div class=paragraph><p>To enable NAT, add these statements to <span class=filename>/etc/rc.conf</span> and specify the name of the file containing the NAT rules:</p></div><div class="literalblock programlisting"><div class=content><pre>gateway_enable=&#34;YES&#34;
ipnat_enable=&#34;YES&#34;
ipnat_rules=&#34;/etc/ipnat.rules&#34;</pre></div></div><div class=paragraph><p>NAT rules are flexible and can accomplish many different things to fit the needs of both commercial and home users. The rule syntax presented here has been simplified to demonstrate common usage. For a complete rule syntax description, refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=ipnat&amp;sektion=5&amp;format=html">ipnat(5)</a>.</p></div><div class=paragraph><p>The basic syntax for a NAT rule is as follows, where <code>map</code> starts the rule and <em>IF</em> should be replaced with the name of the external interface:</p></div><div class="literalblock programlisting"><div class=content><pre>map IF LAN_IP_RANGE -&gt; PUBLIC_ADDRESS</pre></div></div><div class=paragraph><p>The <em>LAN_IP_RANGE</em> is the range of IP addresses used by internal clients. Usually, it is a private address range such as <code>192.168.1.0/24</code>. The <em>PUBLIC_ADDRESS</em> can either be the static external IP address or the keyword <code>0/32</code> which represents the IP address assigned to <em>IF</em>.</p></div><div class=paragraph><p>In IPF, when a packet arrives at the firewall from the LAN with a public destination, it first passes through the outbound rules of the firewall ruleset. Then, the packet is passed to the NAT ruleset which is read from the top down, where the first matching rule wins. IPF tests each NAT rule against the packet’s interface name and source IP address. When a packet’s interface name matches a NAT rule, the packet’s source IP address in the private LAN is checked to see if it falls within the IP address range specified in <em>LAN_IP_RANGE</em>. On a match, the packet has its source IP address rewritten with the public IP address specified by <em>PUBLIC_ADDRESS</em>. IPF posts an entry in its internal NAT table so that when the packet returns from the Internet, it can be mapped back to its original private IP address before being passed to the firewall rules for further processing.</p></div><div class=paragraph><p>For networks that have large numbers of internal systems or multiple subnets, the process of funneling every private IP address into a single public IP address becomes a resource problem. Two methods are available to relieve this issue.</p></div><div class=paragraph><p>The first method is to assign a range of ports to use as source ports. By adding the <code>portmap</code> keyword, NAT can be directed to only use source ports in the specified range:</p></div><div class="literalblock programlisting"><div class=content><pre>map dc0 192.168.1.0/24 -&gt; 0/32 portmap tcp/udp 20000:60000</pre></div></div><div class=paragraph><p>Alternately, use the <code>auto</code> keyword which tells NAT to determine the ports that are available for use:</p></div><div class="literalblock programlisting"><div class=content><pre>map dc0 192.168.1.0/24 -&gt; 0/32 portmap tcp/udp auto</pre></div></div><div class=paragraph><p>The second method is to use a pool of public addresses. This is useful when there are too many LAN addresses to fit into a single public address and a block of public IP addresses is available. These public addresses can be used as a pool from which NAT selects an IP address as a packet’s address is mapped on its way out.</p></div><div class=paragraph><p>The range of public IP addresses can be specified using a netmask or CIDR notation. These two rules are equivalent:</p></div><div class="literalblock programlisting"><div class=content><pre>map dc0 192.168.1.0/24 -&gt; 204.134.75.0/255.255.255.0
map dc0 192.168.1.0/24 -&gt; 204.134.75.0/24</pre></div></div><div class=paragraph><p>A common practice is to have a publically accessible web server or mail server segregated to an internal network segment. The traffic from these servers still has to undergo NAT, but port redirection is needed to direct inbound traffic to the correct server. For example, to map a web server using the internal address <code>10.0.10.25</code> to its public IP address of <code>20.20.20.5</code>, use this rule:</p></div><div class="literalblock programlisting"><div class=content><pre>rdr dc0 20.20.20.5/32 port 80 -&gt; 10.0.10.25 port 80</pre></div></div><div class=paragraph><p>If it is the only web server, this rule would also work as it redirects all external HTTP requests to <code>10.0.10.25</code>:</p></div><div class="literalblock programlisting"><div class=content><pre>rdr dc0 0.0.0.0/0 port 80 -&gt; 10.0.10.25 port 80</pre></div></div><div class=paragraph><p>IPF has a built in FTP proxy which can be used with NAT. It monitors all outbound traffic for active or passive FTP connection requests and dynamically creates temporary filter rules containing the port number used by the FTP data channel. This eliminates the need to open large ranges of high order ports for FTP connections.</p></div><div class=paragraph><p>In this example, the first rule calls the proxy for outbound FTP traffic from the internal LAN. The second rule passes the FTP traffic from the firewall to the Internet, and the third rule handles all non-FTP traffic from the internal LAN:</p></div><div class="literalblock programlisting"><div class=content><pre>map dc0 10.0.10.0/29 -&gt; 0/32 proxy port 21 ftp/tcp
map dc0 0.0.0.0/0 -&gt; 0/32 proxy port 21 ftp/tcp
map dc0 10.0.10.0/29 -&gt; 0/32</pre></div></div><div class=paragraph><p>The FTP <code>map</code> rules go before the NAT rule so that when a packet matches an FTP rule, the FTP proxy creates temporary filter rules to let the FTP session packets pass and undergo NAT. All LAN packets that are not FTP will not match the FTP rules but will undergo NAT if they match the third rule.</p></div><div class=paragraph><p>Without the FTP proxy, the following firewall rules would instead be needed. Note that without the proxy, all ports above <code>1024</code> need to be allowed:</p></div><div class="literalblock programlisting"><div class=content><pre># Allow out LAN PC client FTP to public Internet
# Active and passive modes
pass out quick on rl0 proto tcp from any to any port = 21 flags S keep state

# Allow out passive mode data channel high order port numbers
pass out quick on rl0 proto tcp from any to any port &gt; 1024 flags S keep state

# Active mode let data channel in from FTP server
pass in quick on rl0 proto tcp from any to any port = 20 flags S keep state</pre></div></div><div class=paragraph><p>Whenever the file containing the NAT rules is edited, run <code>ipnat</code> with <code>-CF</code> to delete the current NAT rules and flush the contents of the dynamic translation table. Include <code>-f</code> and specify the name of the NAT ruleset to load:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ipnat -CF -f /etc/ipnat.rules</span></code></pre></div></div><div class=paragraph><p>To display the NAT statistics:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ipnat -s</span></code></pre></div></div><div class=paragraph><p>To list the NAT table’s current mappings:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ipnat -l</span></code></pre></div></div><div class=paragraph><p>To turn verbose mode on and display information relating to rule processing and active rules and table entries:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ipnat -v</span></code></pre></div></div></div><div class=sect3><h4 id=_viewing_ipf_statistics>30.5.5. Viewing IPF Statistics<a class=anchor href=#_viewing_ipf_statistics></a></h4><div class=paragraph><p>IPF includes <a href="https://man.freebsd.org/cgi/man.cgi?query=ipfstat&amp;sektion=8&amp;format=html">ipfstat(8)</a> which can be used to retrieve and display statistics which are gathered as packets match rules as they go through the firewall. Statistics are accumulated since the firewall was last started or since the last time they were reset to zero using <code>ipf -Z</code>.</p></div><div class=paragraph><p>The default <code>ipfstat</code> output looks like this:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>input packets: blocked 99286 passed 1255609 nomatch 14686 counted 0
 output packets: blocked 4200 passed 1284345 nomatch 14687 counted 0
 input packets logged: blocked 99286 passed 0
 output packets logged: blocked 0 passed 0
 packets logged: input 0 output 0
 log failures: input 3898 output 0
 fragment state<span class=o>(</span><span class=k>in</span><span class=o>)</span>: kept 0 lost 0
 fragment state<span class=o>(</span>out<span class=o>)</span>: kept 0 lost 0
 packet state<span class=o>(</span><span class=k>in</span><span class=o>)</span>: kept 169364 lost 0
 packet state<span class=o>(</span>out<span class=o>)</span>: kept 431395 lost 0
 ICMP replies: 0 TCP RSTs sent: 0
 Result cache hits<span class=o>(</span><span class=k>in</span><span class=o>)</span>: 1215208 <span class=o>(</span>out<span class=o>)</span>: 1098963
 IN Pullups succeeded: 2 failed: 0
 OUT Pullups succeeded: 0 failed: 0
 Fastroute successes: 0 failures: 0
 TCP <span class=nb>cksum </span>fails<span class=o>(</span><span class=k>in</span><span class=o>)</span>: 0 <span class=o>(</span>out<span class=o>)</span>: 0
 Packet log flags <span class=nb>set</span>: <span class=o>(</span>0<span class=o>)</span></code></pre></div></div><div class=paragraph><p>Several options are available. When supplied with either <code>-i</code> for inbound or <code>-o</code> for outbound, the command will retrieve and display the appropriate list of filter rules currently installed and in use by the kernel. To also see the rule numbers, include <code>-n</code>. For example, <code>ipfstat -on</code> displays the outbound rules table with rule numbers:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>@1 pass out on xl0 from any to any
@2 block out on dc0 from any to any
@3 pass out quick on dc0 proto tcp/udp from any to any keep state</code></pre></div></div><div class=paragraph><p>Include <code>-h</code> to prefix each rule with a count of how many times the rule was matched. For example, <code>ipfstat -oh</code> displays the outbound internal rules table, prefixing each rule with its usage count:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>2451423 pass out on xl0 from any to any
354727 block out on dc0 from any to any
430918 pass out quick on dc0 proto tcp/udp from any to any keep state</code></pre></div></div><div class=paragraph><p>To display the state table in a format similar to <a href="https://man.freebsd.org/cgi/man.cgi?query=top&amp;sektion=1&amp;format=html">top(1)</a>, use <code>ipfstat -t</code>. When the firewall is under attack, this option provides the ability to identify and see the attacking packets. The optional sub-flags give the ability to select the destination or source IP, port, or protocol to be monitored in real time. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=ipfstat&amp;sektion=8&amp;format=html">ipfstat(8)</a> for details.</p></div></div><div class=sect3><h4 id=_ipf_logging>30.5.6. IPF Logging<a class=anchor href=#_ipf_logging></a></h4><div class=paragraph><p>IPF provides <code>ipmon</code>, which can be used to write the firewall’s logging information in a human readable format. It requires that <code>options IPFILTER_LOG</code> be first added to a custom kernel using the instructions in <a href=./#kernelconfig>Configuring the FreeBSD Kernel</a>.</p></div><div class=paragraph><p>This command is typically run in daemon mode in order to provide a continuous system log file so that logging of past events may be reviewed. Since FreeBSD has a built in <a href="https://man.freebsd.org/cgi/man.cgi?query=syslogd&amp;sektion=8&amp;format=html">syslogd(8)</a> facility to automatically rotate system logs, the default <span class=filename>rc.conf</span><code>ipmon_flags</code> statement uses <code>-Ds</code>:</p></div><div class="literalblock programlisting"><div class=content><pre>ipmon_flags=&#34;-Ds&#34; # D = start as daemon
                  # s = log to syslog
                  # v = log tcp window, ack, seq
                  # n = map IP &amp; port to names</pre></div></div><div class=paragraph><p>Logging provides the ability to review, after the fact, information such as which packets were dropped, what addresses they came from, and where they were going. This information is useful in tracking down attackers.</p></div><div class=paragraph><p>Once the logging facility is enabled in <span class=filename>rc.conf</span> and started with <code>service ipmon start</code>, IPF will only log the rules which contain the <code>log</code> keyword. The firewall administrator decides which rules in the ruleset should be logged and normally only deny rules are logged. It is customary to include the <code>log</code> keyword in the last rule in the ruleset. This makes it possible to see all the packets that did not match any of the rules in the ruleset.</p></div><div class=paragraph><p>By default, <code>ipmon -Ds</code> mode uses <code>local0</code> as the logging facility. The following logging levels can be used to further segregate the logged data:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>LOG_INFO - packets logged using the <span class=s2>&#34;log&#34;</span> keyword as the action rather than pass or block.
LOG_NOTICE - packets logged which are also passed
LOG_WARNING - packets logged which are also blocked
LOG_ERR - packets which have been logged and which can be considered short due to an incomplete header</code></pre></div></div><div class=paragraph><p>In order to setup IPF to log all data to <span class=filename>/var/log/ipfilter.log</span>, first create the empty file:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># touch /var/log/ipfilter.log</span></code></pre></div></div><div class=paragraph><p>Then, to write all logged messages to the specified file, add the following statement to <span class=filename>/etc/syslog.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>local0.* /var/log/ipfilter.log</pre></div></div><div class=paragraph><p>To activate the changes and instruct <a href="https://man.freebsd.org/cgi/man.cgi?query=syslogd&amp;sektion=8&amp;format=html">syslogd(8)</a> to read the modified <span class=filename>/etc/syslog.conf</span>, run <code>service syslogd reload</code>.</p></div><div class=paragraph><p>Do not forget to edit <span class=filename>/etc/newsyslog.conf</span> to rotate the new log file.</p></div><div class=paragraph><p>Messages generated by <code>ipmon</code> consist of data fields separated by white space. Fields common to all messages are:</p></div><div class="olist arabic"><ol class=arabic><li><p>The date of packet receipt.</p></li><li><p>The time of packet receipt. This is in the form HH:MM:SS.F, for hours, minutes, seconds, and fractions of a second.</p></li><li><p>The name of the interface that processed the packet.</p></li><li><p>The group and rule number of the rule in the format <code>@0:17</code>.</p></li><li><p>The action: <code>p</code> for passed, <code>b</code> for blocked, <code>S</code> for a short packet, <code>n</code> did not match any rules, and <code>L</code> for a log rule.</p></li><li><p>The addresses written as three fields: the source address and port separated by a comma, the → symbol, and the destination address and port. For example: <code>209.53.17.22,80 → 198.73.220.17,1722</code>.</p></li><li><p><code>PR</code> followed by the protocol name or number: for example, <code>PR tcp</code>.</p></li><li><p><code>len</code> followed by the header length and total length of the packet: for example, <code>len 20 40</code>.</p></li></ol></div><div class=paragraph><p>If the packet is a TCP packet, there will be an additional field starting with a hyphen followed by letters corresponding to any flags that were set. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=ipf&amp;sektion=5&amp;format=html">ipf(5)</a> for a list of letters and their flags.</p></div><div class=paragraph><p>If the packet is an ICMP packet, there will be two fields at the end: the first always being "icmp" and the next being the ICMP message and sub-message type, separated by a slash. For example: <code>icmp 3/3</code> for a port unreachable message.</p></div></div></div><div class=sect2><h3 id=firewalls-blacklistd>30.6. Blacklistd<a class=anchor href=#firewalls-blacklistd></a></h3><div class=paragraph><p>Blacklistd is a daemon listening to sockets to receive notifications from other daemons about connection attempts that failed or were successful. It is most widely used in blocking too many connection attempts on open ports. A prime example is SSH running on the internet getting a lot of requests from bots or scripts trying to guess passwords and gain access. Using blacklistd, the daemon can notify the firewall to create a filter rule to block excessive connection attempts from a single source after a number of tries. Blacklistd was first developed on NetBSD and appeared there in version 7. FreeBSD 11 imported blacklistd from NetBSD.</p></div><div class=paragraph><p>This chapter describes how to set up blacklistd, configure it, and provides examples on how to use it. Readers should be familiar with basic firewall concepts like rules. For details, refer to the firewall chapter. PF is used in the examples, but other firewalls available on FreeBSD should be able to work with blacklistd, too.</p></div><div class=sect3><h4 id=_enabling_blacklistd>30.6.1. Enabling Blacklistd<a class=anchor href=#_enabling_blacklistd></a></h4><div class=paragraph><p>The main configuration for blacklistd is stored in <a href="https://man.freebsd.org/cgi/man.cgi?query=blacklistd.conf&amp;sektion=5&amp;format=html">blacklistd.conf(5)</a>. Various command line options are also available to change blacklistd’s run-time behavior. Persistent configuration across reboots should be stored in <span class=filename>/etc/blacklistd.conf</span>. To enable the daemon during system boot, add a <code>blacklistd_enable</code> line to <span class=filename>/etc/rc.conf</span> like this:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sysrc blacklistd_enable=yes</span></code></pre></div></div><div class=paragraph><p>To start the service manually, run this command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service blacklistd start</span></code></pre></div></div></div><div class=sect3><h4 id=_creating_a_blacklistd_ruleset>30.6.2. Creating a Blacklistd Ruleset<a class=anchor href=#_creating_a_blacklistd_ruleset></a></h4><div class=paragraph><p>Rules for blacklistd are configured in <a href="https://man.freebsd.org/cgi/man.cgi?query=blacklistd.conf&amp;sektion=5&amp;format=html">blacklistd.conf(5)</a> with one entry per line. Each rule contains a tuple separated by spaces or tabs. Rules either belong to a <code>local</code> or a <code>remote</code>, which applies to the machine where blacklistd is running or an outside source, respectively.</p></div><div class=sect4><h5 id=_local_rules>30.6.2.1. Local Rules<a class=anchor href=#_local_rules></a></h5><div class=paragraph><p>An example blacklistd.conf entry for a local rule looks like this:</p></div><div class="literalblock programlisting"><div class=content><pre>[local]
ssh             stream  *       *               *       3       24h</pre></div></div><div class=paragraph><p>All rules that follow the <code>[local]</code> section are treated as local rules (which is the default), applying to the local machine. When a <code>[remote]</code> section is encountered, all rules that follow it are handled as remote machine rules.</p></div><div class=paragraph><p>Seven fields define a rule separated by either tabs or spaces. The first four fields identify the traffic that should be blacklisted. The three fields that follow define backlistd’s behavior. Wildcards are denoted as asterisks (<code>*</code>), matching anything in this field. The first field defines the location. In local rules, these are the network ports. The syntax for the location field is as follows:</p></div><div class="literalblock programlisting"><div class=content><pre>[address|interface][/mask][:port]</pre></div></div><div class=paragraph><p>Adressses can be specified as IPv4 in numeric format or IPv6 in square brackets. An interface name like <code><em>em0</em></code> can also be used.</p></div><div class=paragraph><p>The socket type is defined by the second field. TCP sockets are of type <code>stream</code>, whereas UDP is denoted as <code>dgram</code>. The example above uses TCP, since SSH is using that protocol.</p></div><div class=paragraph><p>A protocol can be used in the third field of a blacklistd rule. The following protocols can be used: <code>tcp</code>, <code>udp</code>, <code>tcp6</code>, <code>udp6</code>, or numeric. A wildcard, like in the example, is typically used to match all protocols unless there is a reason to distinguish traffic by a certain protocol.</p></div><div class=paragraph><p>In the fourth field, the effective user or owner of the daemon process that is reporting the event is defined. The username or UID can be used here, as well as a wildcard (see example rule above).</p></div><div class=paragraph><p>The packet filter rule name is declared by the fifth field, which starts the behavior part of the rule. By default, blacklistd puts all blocks under a pf anchor called <code>blacklistd</code> in <span class=filename>pf.conf</span> like this:</p></div><div class="literalblock programlisting"><div class=content><pre>anchor &#34;blacklistd/*&#34; in on $ext_if
block in
pass out</pre></div></div><div class=paragraph><p>For separate blacklists, an anchor name can be used in this field. In other cases, the wildcard will suffice. When a name starts with a hyphen (<code>-</code>) it means that an anchor with the default rule name prepended should be used. A modified example from the above using the hyphen would look like this:</p></div><div class="literalblock programlisting"><div class=content><pre>ssh             stream  *       *               -ssh       3       24h</pre></div></div><div class=paragraph><p>With such a rule, any new blacklist rules are added to an anchor called <code>blacklistd-ssh</code>.</p></div><div class=paragraph><p>To block whole subnets for a single rule violation, a <code>/</code> in the rule name can be used. This causes the remaining portion of the name to be interpreted as the mask to be applied to the address specified in the rule. For example, this rule would block every address adjoining <code>/24</code>.</p></div><div class="literalblock programlisting"><div class=content><pre>22              stream  tcp       *               */24    3       24h</pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>It is important to specify the proper protocol here. IPv4 and IPv6 treat /24 differently, that is the reason why <code>*</code> cannot be used in the third field for this rule.</p></div></td></tr></tbody></table></div><div class=paragraph><p>This rule defines that if any one host in that network is misbehaving, everything else on that network will be blocked, too.</p></div><div class=paragraph><p>The sixth field, called <code>nfail</code>, sets the number of login failures required to blacklist the remote IP in question. When a wildcard is used at this position, it means that blocks will never happen. In the example rule above, a limit of three is defined meaning that after three attempts to log into SSH on one connection, the IP is blocked.</p></div><div class=paragraph><p>The last field in a blacklistd rule definition specifies how long a host is blacklisted. The default unit is seconds, but suffixes like <code>m</code>, <code>h</code>, and <code>d</code> can also be specified for minutes, hours, and days, respectively.</p></div><div class=paragraph><p>The example rule in its entirety means that after three times authenticating to SSH will result in a new PF block rule for that host. Rule matches are performed by first checking local rules one after another, from most specific to least specific. When a match occurs, the <code>remote</code> rules are applied and the name, <code>nfail</code>, and disable fields are changed by the <code>remote</code> rule that matched.</p></div></div><div class=sect4><h5 id=_remote_rules>30.6.2.2. Remote Rules<a class=anchor href=#_remote_rules></a></h5><div class=paragraph><p>Remote rules are used to specify how blacklistd changes its behavior depending on the remote host currently being evaluated. Each field in a remote rule is the same as in a local rule. The only difference is in the way blacklistd is using them. To explain it, this example rule is used:</p></div><div class="literalblock programlisting"><div class=content><pre>[remote]
203.0.113.128/25 *      *       *               =/25    =       48h</pre></div></div><div class=paragraph><p>The address field can be an IP address (either v4 or v6), a port or both. This allows setting special rules for a specific remote address range like in this example. The fields for type, protocol and owner are identically interpreted as in the local rule.</p></div><div class=paragraph><p>The name fields is different though: the equal sign (<code>=</code>) in a remote rule tells blacklistd to use the value from the matching local rule. It means that the firewall rule entry is taken and the <code>/25</code> prefix (a netmask of <code>255.255.255.128</code>) is added. When a connection from that address range is blacklisted, the entire subnet is affected. A PF anchor name can also be used here, in which case blacklistd will add rules for this address block to the anchor of that name. The default table is used when a wildcard is specified.</p></div><div class=paragraph><p>A custom number of failures in the <code>nfail</code> column can be defined for an address. This is useful for exceptions to a specific rule, to maybe allow someone a less strict application of rules or a bit more leniency in login tries. Blocking is disabled when an asterisk is used in this sixth field.</p></div><div class=paragraph><p>Remote rules allow a stricter enforcement of limits on attempts to log in compared to attempts coming from a local network like an office.</p></div></div></div><div class=sect3><h4 id=_blacklistd_client_configuration>30.6.3. Blacklistd Client Configuration<a class=anchor href=#_blacklistd_client_configuration></a></h4><div class=paragraph><p>There are a few software packages in FreeBSD that can utilize blacklistd’s functionality. The two most prominent ones are <a href="https://man.freebsd.org/cgi/man.cgi?query=ftpd&amp;sektion=8&amp;format=html">ftpd(8)</a> and <a href="https://man.freebsd.org/cgi/man.cgi?query=sshd&amp;sektion=8&amp;format=html">sshd(8)</a> to block excessive connection attempts. To activate blacklistd in the SSH daemon, add the following line to <span class=filename>/etc/ssh/sshd_config</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>UseBlacklist yes</pre></div></div><div class=paragraph><p>Restart sshd afterwards to make these changes take effect.</p></div><div class=paragraph><p>Blacklisting for <a href="https://man.freebsd.org/cgi/man.cgi?query=ftpd&amp;sektion=8&amp;format=html">ftpd(8)</a> is enabled using <code>-B</code>, either in <span class=filename>/etc/inetd.conf</span> or as a flag in <span class=filename>/etc/rc.conf</span> like this:</p></div><div class="literalblock programlisting"><div class=content><pre>ftpd_flags=&#34;-B&#34;</pre></div></div><div class=paragraph><p>That is all that is needed to make these programs talk to blacklistd.</p></div></div><div class=sect3><h4 id=_blacklistd_management>30.6.4. Blacklistd Management<a class=anchor href=#_blacklistd_management></a></h4><div class=paragraph><p>Blacklistd provides the user with a management utility called <a href="https://man.freebsd.org/cgi/man.cgi?query=blacklistctl&amp;sektion=8&amp;format=html">blacklistctl(8)</a>. It displays blocked addresses and networks that are blacklisted by the rules defined in <a href="https://man.freebsd.org/cgi/man.cgi?query=blacklistd.conf&amp;sektion=5&amp;format=html">blacklistd.conf(5)</a>. To see the list of currently blocked hosts, use <code>dump</code> combined with <code>-b</code> like this.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># blacklistctl dump -b</span>
      address/ma:port <span class=nb>id      </span>nfail   last access
213.0.123.128/25:22   OK      6/3     2019/06/08 14:30:19</code></pre></div></div><div class=paragraph><p>This example shows that there were 6 out of three permitted attempts on port 22 coming from the address range <code>213.0.123.128/25</code>. There are more attempts listed than are allowed because SSH allows a client to try multiple logins on a single TCP connection. A connection that is currently going on is not stopped by blacklistd. The last connection attempt is listed in the <code>last access</code> column of the output.</p></div><div class=paragraph><p>To see the remaining time that this host will be on the blacklist, add <code>-r</code> to the previous command.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># blacklistctl dump -br</span>
      address/ma:port <span class=nb>id      </span>nfail   remaining <span class=nb>time
</span>213.0.123.128/25:22   OK      6/3     36s</code></pre></div></div><div class=paragraph><p>In this example, there are 36s seconds left until this host will not be blocked any more.</p></div></div><div class=sect3><h4 id=_removing_hosts_from_the_block_list>30.6.5. Removing Hosts from the Block List<a class=anchor href=#_removing_hosts_from_the_block_list></a></h4><div class=paragraph><p>Sometimes it is necessary to remove a host from the block list before the remaining time expires. Unfortunately, there is no functionality in blacklistd to do that. However, it is possible to remove the address from the PF table using pfctl. For each blocked port, there is a child anchor inside the blacklistd anchor defined in <span class=filename>/etc/pf.conf</span>. For example, if there is a child anchor for blocking port 22 it is called <code>blacklistd/22</code>. There is a table inside that child anchor that contains the blocked addresses. This table is called port followed by the port number. In this example, it would be called <code>port22</code>. With that information at hand, it is now possible to use <a href="https://man.freebsd.org/cgi/man.cgi?query=pfctl&amp;sektion=8&amp;format=html">pfctl(8)</a> to display all addresses listed like this:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pfctl -a blacklistd/22 -t port22 -T show</span>
...
213.0.123.128/25
...</code></pre></div></div><div class=paragraph><p>After identifying the address to be unblocked from the list, the following command removes it from the list:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pfctl -a blacklistd/22 -t port22 -T delete 213.0.123.128/25</span></code></pre></div></div><div class=paragraph><p>The address is now removed from PF, but will still show up in the blacklistctl list, since it does not know about any changes made in PF. The entry in blacklistd’s database will eventually expire and be removed from its output eventually. The entry will be added again if the host is matching one of the block rules in blacklistd again.</p></div></div></div></div></div><div class=sect1><h2 id=advanced-networking>Rozdział 31. Advanced Networking<a class=anchor href=#advanced-networking></a></h2><div class=sectionbody><div class=sect2><h3 id=advanced-networking-synopsis>31.1. Synopsis<a class=anchor href=#advanced-networking-synopsis></a></h3><div class=paragraph><p>This chapter covers a number of advanced networking topics.</p></div><div class=paragraph><p>After reading this chapter, you will know:</p></div><div class=ulist><ul><li><p>The basics of gateways and routes.</p></li><li><p>How to set up USB tethering.</p></li><li><p>How to set up IEEE® 802.11 and Bluetooth® devices.</p></li><li><p>How to make FreeBSD act as a bridge.</p></li><li><p>How to set up network PXE booting.</p></li><li><p>How to set up IPv6 on a FreeBSD machine.</p></li><li><p>How to enable and utilize the features of the Common Address Redundancy Protocol (CARP) in FreeBSD.</p></li><li><p>How to configure multiple VLANs on FreeBSD.</p></li><li><p>Configure bluetooth headset.</p></li></ul></div><div class=paragraph><p>Before reading this chapter, you should:</p></div><div class=ulist><ul><li><p>Understand the basics of the <span class=filename>/etc/rc</span> scripts.</p></li><li><p>Be familiar with basic network terminology.</p></li><li><p>Know how to configure and install a new FreeBSD kernel (<a href=./#kernelconfig>Configuring the FreeBSD Kernel</a>).</p></li><li><p>Know how to install additional third-party software (<a href=./#ports>Installing Applications: Packages and Ports</a>).</p></li></ul></div></div><div class=sect2><h3 id=network-routing>31.2. Gateways and Routes<a class=anchor href=#network-routing></a></h3><div class=paragraph><p><em>Routing</em> is the mechanism that allows a system to find the network path to another system. A <em>route</em> is a defined pair of addresses which represent the "destination" and a "gateway". The route indicates that when trying to get to the specified destination, send the packets through the specified gateway. There are three types of destinations: individual hosts, subnets, and "default". The "default route" is used if no other routes apply. There are also three types of gateways: individual hosts, interfaces, also called links, and Ethernet hardware (MAC) addresses. Known routes are stored in a routing table.</p></div><div class=paragraph><p>This section provides an overview of routing basics. It then demonstrates how to configure a FreeBSD system as a router and offers some troubleshooting tips.</p></div><div class=sect3><h4 id=network-routing-default>31.2.1. Routing Basics<a class=anchor href=#network-routing-default></a></h4><div class=paragraph><p>To view the routing table of a FreeBSD system, use <a href="https://man.freebsd.org/cgi/man.cgi?query=netstat&amp;sektion=1&amp;format=html">netstat(1)</a>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% netstat <span class=nt>-r</span>
Routing tables

Internet:
Destination      Gateway            Flags     Refs     Use     Netif Expire
default          outside-gw         UGS        37      418       em0
localhost        localhost          UH          0      181       lo0
test0            0:e0:b5:36:cf:4f   UHLW        5    63288       re0     77
10.20.30.255     <span class=nb>link</span><span class=c>#1             UHLW        1     2421</span>
example.com      <span class=nb>link</span><span class=c>#1             UC          0        0</span>
host1            0:e0:a8:37:8:1e    UHLW        3     4601       lo0
host2            0:e0:a8:37:8:1e    UHLW        0        5       lo0 <span class=o>=&gt;</span>
host2.example.com <span class=nb>link</span><span class=c>#1            UC          0        0</span>
224              <span class=nb>link</span><span class=c>#1             UC          0        0</span></code></pre></div></div><div class=paragraph><p>The entries in this example are as follows:</p></div><div class=dlist><dl><dt class=hdlist1>default</dt><dd><p>The first route in this table specifies the <code>default</code> route. When the local system needs to make a connection to a remote host, it checks the routing table to determine if a known path exists. If the remote host matches an entry in the table, the system checks to see if it can connect using the interface specified in that entry.</p><div class=paragraph><p>If the destination does not match an entry, or if all known paths fail, the system uses the entry for the default route. For hosts on a local area network, the <code>Gateway</code> field in the default route is set to the system which has a direct connection to the Internet. When reading this entry, verify that the <code>Flags</code> column indicates that the gateway is usable (<code>UG</code>).</p></div><div class=paragraph><p>The default route for a machine which itself is functioning as the gateway to the outside world will be the gateway machine at the Internet Service Provider (ISP).</p></div></dd><dt class=hdlist1>localhost</dt><dd><p>The second route is the <code>localhost</code> route. The interface specified in the <code>Netif</code> column for <code>localhost</code> is <span class=filename>lo0</span>, also known as the loopback device. This indicates that all traffic for this destination should be internal, rather than sending it out over the network.</p></dd><dt class=hdlist1>MAC address</dt><dd><p>The addresses beginning with <code>0:e0:</code> are MAC addresses. FreeBSD will automatically identify any hosts, <code>test0</code> in the example, on the local Ethernet and add a route for that host over the Ethernet interface, <span class=filename>re0</span>. This type of route has a timeout, seen in the <code>Expire</code> column, which is used if the host does not respond in a specific amount of time. When this happens, the route to this host will be automatically deleted. These hosts are identified using the Routing Information Protocol (RIP), which calculates routes to local hosts based upon a shortest path determination.</p></dd><dt class=hdlist1>subnet</dt><dd><p>FreeBSD will automatically add subnet routes for the local subnet. In this example, <code>10.20.30.255</code> is the broadcast address for the subnet <code>10.20.30</code> and <code>example.com</code> is the domain name associated with that subnet. The designation <code>link#1</code> refers to the first Ethernet card in the machine.</p><div class=paragraph><p>Local network hosts and local subnets have their routes automatically configured by a daemon called <a href="https://man.freebsd.org/cgi/man.cgi?query=routed&amp;sektion=8&amp;format=html">routed(8)</a>. If it is not running, only routes which are statically defined by the administrator will exist.</p></div></dd><dt class=hdlist1>host</dt><dd><p>The <code>host1</code> line refers to the host by its Ethernet address. Since it is the sending host, FreeBSD knows to use the loopback interface (<span class=filename>lo0</span>) rather than the Ethernet interface.</p><div class=paragraph><p>The two <code>host2</code> lines represent aliases which were created using <a href="https://man.freebsd.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;format=html">ifconfig(8)</a>. The <code>⇒</code> symbol after the <span class=filename>lo0</span> interface says that an alias has been set in addition to the loopback address. Such routes only show up on the host that supports the alias and all other hosts on the local network will have a <code>link#1</code> line for such routes.</p></div></dd><dt class=hdlist1>224</dt><dd><p>The final line (destination subnet <code>224</code>) deals with multicasting.</p></dd></dl></div><div class=paragraph><p>Various attributes of each route can be seen in the <code>Flags</code> column. <a href=#routeflags>Commonly Seen Routing Table Flags</a> summarizes some of these flags and their meanings:</p></div><table id=routeflags class="tableblock frame-none grid-all stretch"><caption class=title>Tabela 29. Commonly Seen Routing Table Flags</caption><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">Command</th><th class="tableblock halign-left valign-top">Purpose</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock>U</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>The route is active (up).</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>H</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>The route destination is a single host.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>G</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Send anything for this destination on to this gateway, which will figure out from there where to send it.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>S</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>This route was statically configured.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>C</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Clones a new route based upon this route for machines to connect to. This type of route is normally used for local networks.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>W</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>The route was auto-configured based upon a local area network (clone) route.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>L</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Route involves references to Ethernet (link) hardware.</p></td></tr></tbody></table><div class=paragraph><p>On a FreeBSD system, the default route can defined in <span class=filename>/etc/rc.conf</span> by specifying the IP address of the default gateway:</p></div><div class="literalblock programlisting"><div class=content><pre>defaultrouter=&#34;10.20.30.1&#34;</pre></div></div><div class=paragraph><p>It is also possible to manually add the route using <code>route</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># route add default 10.20.30.1</span></code></pre></div></div><div class=paragraph><p>Note that manually added routes will not survive a reboot. For more information on manual manipulation of network routing tables, refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=route&amp;sektion=8&amp;format=html">route(8)</a>.</p></div></div><div class=sect3><h4 id=network-static-routes>31.2.2. Configuring a Router with Static Routes<a class=anchor href=#network-static-routes></a></h4><div class=paragraph><p>A FreeBSD system can be configured as the default gateway, or router, for a network if it is a dual-homed system. A dual-homed system is a host which resides on at least two different networks. Typically, each network is connected to a separate network interface, though IP aliasing can be used to bind multiple addresses, each on a different subnet, to one physical interface.</p></div><div class=paragraph><p>In order for the system to forward packets between interfaces, FreeBSD must be configured as a router. Internet standards and good engineering practice prevent the FreeBSD Project from enabling this feature by default, but it can be configured to start at boot by adding this line to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>gateway_enable=&#34;YES&#34;          # Set to YES if this host will be a gateway</pre></div></div><div class=paragraph><p>To enable routing now, set the <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a> variable <code>net.inet.ip.forwarding</code> to <code>1</code>. To stop routing, reset this variable to <code>0</code>.</p></div><div class=paragraph><p>The routing table of a router needs additional routes so it knows how to reach other networks. Routes can be either added manually using static routes or routes can be automatically learned using a routing protocol. Static routes are appropriate for small networks and this section describes how to add a static routing entry for a small network.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>For large networks, static routes quickly become unscalable. FreeBSD comes with the standard BSD routing daemon <a href="https://man.freebsd.org/cgi/man.cgi?query=routed&amp;sektion=8&amp;format=html">routed(8)</a>, which provides the routing protocols RIP, versions 1 and 2, and IRDP. Support for the BGP and OSPF routing protocols can be installed using the <a class=package href=https://cgit.freebsd.org/ports/tree/net/zebra/>net/zebra</a> package or port.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Consider the following network:</p></div><div class=imageblock><div class=content><img src=../../../../images/books/handbook/advanced-networking/static-routes.png alt="static routes"></div></div><div class=paragraph><p>In this scenario, <code>RouterA</code> is a FreeBSD machine that is acting as a router to the rest of the Internet. It has a default route set to <code>10.0.0.1</code> which allows it to connect with the outside world. <code>RouterB</code> is already configured to use <code>192.168.1.1</code> as its default gateway.</p></div><div class=paragraph><p>Before adding any static routes, the routing table on <code>RouterA</code> looks like this:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% netstat <span class=nt>-nr</span>
Routing tables

Internet:
Destination        Gateway            Flags    Refs      Use  Netif  Expire
default            10.0.0.1           UGS         0    49378    xl0
127.0.0.1          127.0.0.1          UH          0        6    lo0
10.0.0.0/24        <span class=nb>link</span><span class=c>#1             UC          0        0    xl0</span>
192.168.1.0/24     <span class=nb>link</span><span class=c>#2             UC          0        0    xl1</span></code></pre></div></div><div class=paragraph><p>With the current routing table, <code>RouterA</code> does not have a route to the <code>192.168.2.0/24</code> network. The following command adds the <code>Internal Net 2</code> network to <code>RouterA</code>'s routing table using <code>192.168.1.2</code> as the next hop:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># route add -net 192.168.2.0/24 192.168.1.2</span></code></pre></div></div><div class=paragraph><p>Now, <code>RouterA</code> can reach any host on the <code>192.168.2.0/24</code> network. However, the routing information will not persist if the FreeBSD system reboots. If a static route needs to be persistent, add it to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre># Add Internal Net 2 as a persistent static route
static_routes=&#34;internalnet2&#34;
route_internalnet2=&#34;-net 192.168.2.0/24 192.168.1.2&#34;</pre></div></div><div class=paragraph><p>The <code>static_routes</code> configuration variable is a list of strings separated by a space, where each string references a route name. The variable <code>route_internalnet2</code> contains the static route for that route name.</p></div><div class=paragraph><p>Using more than one string in <code>static_routes</code> creates multiple static routes. The following shows an example of adding static routes for the <code>192.168.0.0/24</code> and <code>192.168.1.0/24</code> networks:</p></div><div class="literalblock programlisting"><div class=content><pre>static_routes=&#34;net1 net2&#34;
route_net1=&#34;-net 192.168.0.0/24 192.168.0.1&#34;
route_net2=&#34;-net 192.168.1.0/24 192.168.1.1&#34;</pre></div></div></div><div class=sect3><h4 id=network-routing-troubleshooting>31.2.3. Troubleshooting<a class=anchor href=#network-routing-troubleshooting></a></h4><div class=paragraph><p>When an address space is assigned to a network, the service provider configures their routing tables so that all traffic for the network will be sent to the link for the site. But how do external sites know to send their packets to the network’s ISP?</p></div><div class=paragraph><p>There is a system that keeps track of all assigned address spaces and defines their point of connection to the Internet backbone, or the main trunk lines that carry Internet traffic across the country and around the world. Each backbone machine has a copy of a master set of tables, which direct traffic for a particular network to a specific backbone carrier, and from there down the chain of service providers until it reaches a particular network.</p></div><div class=paragraph><p>It is the task of the service provider to advertise to the backbone sites that they are the point of connection, and thus the path inward, for a site. This is known as route propagation.</p></div><div class=paragraph><p>Sometimes, there is a problem with route propagation and some sites are unable to connect. Perhaps the most useful command for trying to figure out where routing is breaking down is <code>traceroute</code>. It is useful when <code>ping</code> fails.</p></div><div class=paragraph><p>When using <code>traceroute</code>, include the address of the remote host to connect to. The output will show the gateway hosts along the path of the attempt, eventually either reaching the target host, or terminating because of a lack of connection. For more information, refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=traceroute&amp;sektion=8&amp;format=html">traceroute(8)</a>.</p></div></div><div class=sect3><h4 id=network-routing-multicast>31.2.4. Multicast Considerations<a class=anchor href=#network-routing-multicast></a></h4><div class=paragraph><p>FreeBSD natively supports both multicast applications and multicast routing. Multicast applications do not require any special configuration in order to run on FreeBSD. Support for multicast routing requires that the following option be compiled into a custom kernel:</p></div><div class="literalblock programlisting"><div class=content><pre>options MROUTING</pre></div></div><div class=paragraph><p>The multicast routing daemon, mrouted can be installed using the <a class=package href=https://cgit.freebsd.org/ports/tree/net/mrouted/>net/mrouted</a> package or port. This daemon implements the DVMRP multicast routing protocol and is configured by editing <span class=filename>/usr/local/etc/mrouted.conf</span> in order to set up the tunnels and DVMRP. The installation of mrouted also installs map-mbone and mrinfo, as well as their associated man pages. Refer to these for configuration examples.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>DVMRP has largely been replaced by the PIM protocol in many multicast installations. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=pim&amp;sektion=4&amp;format=html">pim(4)</a> for more information.</p></div></td></tr></tbody></table></div></div></div><div class=sect2><h3 id=network-wireless>31.3. Wireless Networking<a class=anchor href=#network-wireless></a></h3><div class=sect3><h4 id=_wireless_networking_basics>31.3.1. Wireless Networking Basics<a class=anchor href=#_wireless_networking_basics></a></h4><div class=paragraph><p>Most wireless networks are based on the IEEE® 802.11 standards. A basic wireless network consists of multiple stations communicating with radios that broadcast in either the 2.4GHz or 5GHz band, though this varies according to the locale and is also changing to enable communication in the 2.3GHz and 4.9GHz ranges.</p></div><div class=paragraph><p>802.11 networks are organized in two ways. In <em>infrastructure mode</em>, one station acts as a master with all the other stations associating to it, the network is known as a BSS, and the master station is termed an access point (AP). In a BSS, all communication passes through the AP; even when one station wants to communicate with another wireless station, messages must go through the AP. In the second form of network, there is no master and stations communicate directly. This form of network is termed an IBSS and is commonly known as an <em>ad-hoc network</em>.</p></div><div class=paragraph><p>802.11 networks were first deployed in the 2.4GHz band using protocols defined by the IEEE® 802.11 and 802.11b standard. These specifications include the operating frequencies and the MAC layer characteristics, including framing and transmission rates, as communication can occur at various rates. Later, the 802.11a standard defined operation in the 5GHz band, including different signaling mechanisms and higher transmission rates. Still later, the 802.11g standard defined the use of 802.11a signaling and transmission mechanisms in the 2.4GHz band in such a way as to be backwards compatible with 802.11b networks.</p></div><div class=paragraph><p>Separate from the underlying transmission techniques, 802.11 networks have a variety of security mechanisms. The original 802.11 specifications defined a simple security protocol called WEP. This protocol uses a fixed pre-shared key and the RC4 cryptographic cipher to encode data transmitted on a network. Stations must all agree on the fixed key in order to communicate. This scheme was shown to be easily broken and is now rarely used except to discourage transient users from joining networks. Current security practice is given by the IEEE® 802.11i specification that defines new cryptographic ciphers and an additional protocol to authenticate stations to an access point and exchange keys for data communication. Cryptographic keys are periodically refreshed and there are mechanisms for detecting and countering intrusion attempts. Another security protocol specification commonly used in wireless networks is termed WPA, which was a precursor to 802.11i. WPA specifies a subset of the requirements found in 802.11i and is designed for implementation on legacy hardware. Specifically, WPA requires only the TKIP cipher that is derived from the original WEP cipher. 802.11i permits use of TKIP but also requires support for a stronger cipher, AES-CCM, for encrypting data. The AES cipher was not required in WPA because it was deemed too computationally costly to be implemented on legacy hardware.</p></div><div class=paragraph><p>The other standard to be aware of is 802.11e. It defines protocols for deploying multimedia applications, such as streaming video and voice over IP (VoIP), in an 802.11 network. Like 802.11i, 802.11e also has a precursor specification termed WME (later renamed WMM) that has been defined by an industry group as a subset of 802.11e that can be deployed now to enable multimedia applications while waiting for the final ratification of 802.11e. The most important thing to know about 802.11e and WME/WMM is that it enables prioritized traffic over a wireless network through Quality of Service (QoS) protocols and enhanced media access protocols. Proper implementation of these protocols enables high speed bursting of data and prioritized traffic flow.</p></div><div class=paragraph><p>FreeBSD supports networks that operate using 802.11a, 802.11b, and 802.11g. The WPA and 802.11i security protocols are likewise supported (in conjunction with any of 11a, 11b, and 11g) and QoS and traffic prioritization required by the WME/WMM protocols are supported for a limited set of wireless devices.</p></div></div><div class=sect3><h4 id=network-wireless-quick-start>31.3.2. Quick Start<a class=anchor href=#network-wireless-quick-start></a></h4><div class=paragraph><p>Connecting a computer to an existing wireless network is a very common situation. This procedure shows the steps required.</p></div><div class="olist arabic procedure"><ol class=arabic><li><p>Obtain the SSID (Service Set Identifier) and PSK (Pre-Shared Key) for the wireless network from the network administrator.</p></li><li><p>Identify the wireless adapter. The FreeBSD <span class=filename>GENERIC</span> kernel includes drivers for many common wireless adapters. If the wireless adapter is one of those models, it will be shown in the output from <a href="https://man.freebsd.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;format=html">ifconfig(8)</a>:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% ifconfig | <span class=nb>grep</span> <span class=nt>-B3</span> <span class=nt>-i</span> wireless</code></pre></div></div><div class=paragraph><p>On FreeBSD 11 or higher, use this command instead:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% sysctl net.wlan.devices</code></pre></div></div><div class=paragraph><p>If a wireless adapter is not listed, an additional kernel module might be required, or it might be a model not supported by FreeBSD.</p></div><div class=paragraph><p>This example shows the Atheros <code>ath0</code> wireless adapter.</p></div></li><li><p>Add an entry for this network to <span class=filename>/etc/wpa_supplicant.conf</span>. If the file does not exist, create it. Replace <em>myssid</em> and <em>mypsk</em> with the SSID and PSK provided by the network administrator.</p><div class="literalblock programlisting"><div class=content><pre>network={
	ssid=&#34;myssid&#34;
	psk=&#34;mypsk&#34;
}</pre></div></div></li><li><p>Add entries to <span class=filename>/etc/rc.conf</span> to configure the network on startup:</p><div class="literalblock programlisting"><div class=content><pre>wlans_ath0=&#34;wlan0&#34;
ifconfig_wlan0=&#34;WPA SYNCDHCP&#34;</pre></div></div></li><li><p>Restart the computer, or restart the network service to connect to the network:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service netif restart</span></code></pre></div></div></li></ol></div></div><div class=sect3><h4 id=network-wireless-basic>31.3.3. Basic Setup<a class=anchor href=#network-wireless-basic></a></h4><div class=sect4><h5 id=_kernel_configuration_2>31.3.3.1. Kernel Configuration<a class=anchor href=#_kernel_configuration_2></a></h5><div class=paragraph><p>To use wireless networking, a wireless networking card is needed and the kernel needs to be configured with the appropriate wireless networking support. The kernel is separated into multiple modules so that only the required support needs to be configured.</p></div><div class=paragraph><p>The most commonly used wireless devices are those that use parts made by Atheros. These devices are supported by <a href="https://man.freebsd.org/cgi/man.cgi?query=ath&amp;sektion=4&amp;format=html">ath(4)</a> and require the following line to be added to <span class=filename>/boot/loader.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>if_ath_load=&#34;YES&#34;</pre></div></div><div class=paragraph><p>The Atheros driver is split up into three separate pieces: the driver (<a href="https://man.freebsd.org/cgi/man.cgi?query=ath&amp;sektion=4&amp;format=html">ath(4)</a>), the hardware support layer that handles chip-specific functions (<a href="https://man.freebsd.org/cgi/man.cgi?query=ath_hal&amp;sektion=4&amp;format=html">ath_hal(4)</a>), and an algorithm for selecting the rate for transmitting frames. When this support is loaded as kernel modules, any dependencies are automatically handled. To load support for a different type of wireless device, specify the module for that device. This example is for devices based on the Intersil Prism parts (<a href="https://man.freebsd.org/cgi/man.cgi?query=wi&amp;sektion=4&amp;format=html">wi(4)</a>) driver:</p></div><div class="literalblock programlisting"><div class=content><pre>if_wi_load=&#34;YES&#34;</pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>The examples in this section use an <a href="https://man.freebsd.org/cgi/man.cgi?query=ath&amp;sektion=4&amp;format=html">ath(4)</a> device and the device name in the examples must be changed according to the configuration. A list of available wireless drivers and supported adapters can be found in the FreeBSD Hardware Notes, available on the <a href=https://www.FreeBSD.org/releases/>Release Information</a> page of the FreeBSD website. If a native FreeBSD driver for the wireless device does not exist, it may be possible to use the Windows® driver with the help of the <a href=./#config-network-ndis>NDIS</a> driver wrapper.</p></div></td></tr></tbody></table></div><div class=paragraph><p>In addition, the modules that implement cryptographic support for the security protocols to use must be loaded. These are intended to be dynamically loaded on demand by the <a href="https://man.freebsd.org/cgi/man.cgi?query=wlan&amp;sektion=4&amp;format=html">wlan(4)</a> module, but for now they must be manually configured. The following modules are available: <a href="https://man.freebsd.org/cgi/man.cgi?query=wlan_wep&amp;sektion=4&amp;format=html">wlan_wep(4)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=wlan_ccmp&amp;sektion=4&amp;format=html">wlan_ccmp(4)</a>, and <a href="https://man.freebsd.org/cgi/man.cgi?query=wlan_tkip&amp;sektion=4&amp;format=html">wlan_tkip(4)</a>. The <a href="https://man.freebsd.org/cgi/man.cgi?query=wlan_ccmp&amp;sektion=4&amp;format=html">wlan_ccmp(4)</a> and <a href="https://man.freebsd.org/cgi/man.cgi?query=wlan_tkip&amp;sektion=4&amp;format=html">wlan_tkip(4)</a> drivers are only needed when using the WPA or 802.11i security protocols. If the network does not use encryption, <a href="https://man.freebsd.org/cgi/man.cgi?query=wlan_wep&amp;sektion=4&amp;format=html">wlan_wep(4)</a> support is not needed. To load these modules at boot time, add the following lines to <span class=filename>/boot/loader.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>wlan_wep_load=&#34;YES&#34;
wlan_ccmp_load=&#34;YES&#34;
wlan_tkip_load=&#34;YES&#34;</pre></div></div><div class=paragraph><p>Once this information has been added to <span class=filename>/boot/loader.conf</span>, reboot the FreeBSD box. Alternately, load the modules by hand using <a href="https://man.freebsd.org/cgi/man.cgi?query=kldload&amp;sektion=8&amp;format=html">kldload(8)</a>.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>For users who do not want to use modules, it is possible to compile these drivers into the kernel by adding the following lines to a custom kernel configuration file:</p></div><div class="literalblock programlisting"><div class=content><pre>device wlan              # 802.11 support
device wlan_wep          # 802.11 WEP support
device wlan_ccmp         # 802.11 CCMP support
device wlan_tkip         # 802.11 TKIP support
device wlan_amrr         # AMRR transmit rate control algorithm
device ath               # Atheros pci/cardbus NIC&#39;s
device ath_hal           # pci/cardbus chip support
options AH_SUPPORT_AR5416 # enable AR5416 tx/rx descriptors
device ath_rate_sample   # SampleRate tx rate control for ath</pre></div></div><div class=paragraph><p>With this information in the kernel configuration file, recompile the kernel and reboot the FreeBSD machine.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Information about the wireless device should appear in the boot messages, like this:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>ath0: &lt;Atheros 5212&gt; mem 0x88000000-0x8800ffff irq 11 at device 0.0 on cardbus1
ath0: <span class=o>[</span>ITHREAD]
ath0: AR2413 mac 7.9 RF2413 phy 4.5</code></pre></div></div></div><div class=sect4><h5 id=_setting_the_correct_region>31.3.3.2. Setting the Correct Region<a class=anchor href=#_setting_the_correct_region></a></h5><div class=paragraph><p>Since the regulatory situation is different in various parts of the world, it is necessary to correctly set the domains that apply to your location to have the correct information about what channels can be used.</p></div><div class=paragraph><p>The available region definitions can be found in <span class=filename>/etc/regdomain.xml</span>. To set the data at runtime, use <code>ifconfig</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig wlan0 regdomain ETSI country AT</span></code></pre></div></div><div class=paragraph><p>To persist the settings, add it to <span class=filename>/etc/rc.conf</span>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sysrc create_args_wlan0=&#34;country AT regdomain ETSI&#34;</span></code></pre></div></div></div></div><div class=sect3><h4 id=_infrastructure_mode>31.3.4. Infrastructure Mode<a class=anchor href=#_infrastructure_mode></a></h4><div class=paragraph><p>Infrastructure (BSS) mode is the mode that is typically used. In this mode, a number of wireless access points are connected to a wired network. Each wireless network has its own name, called the SSID. Wireless clients connect to the wireless access points.</p></div><div class=sect4><h5 id=_freebsd_clients>31.3.4.1. FreeBSD Clients<a class=anchor href=#_freebsd_clients></a></h5><div class=sect5><h6 id=_how_to_find_access_points>31.3.4.1.1. How to Find Access Points<a class=anchor href=#_how_to_find_access_points></a></h6><div class=paragraph><p>To scan for available networks, use <a href="https://man.freebsd.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;format=html">ifconfig(8)</a>. This request may take a few moments to complete as it requires the system to switch to each available wireless frequency and probe for available access points. Only the superuser can initiate a scan:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig wlan0 create wlandev ath0</span>
<span class=c># ifconfig wlan0 up scan</span>
SSID/MESH ID    BSSID              CHAN RATE   S:N     INT CAPS
dlinkap         00:13:46:49:41:76   11   54M <span class=nt>-90</span>:96   100 EPS  WPA WME
freebsdap       00:11:95:c3:0d:ac    1   54M <span class=nt>-83</span>:96   100 EPS  WPA</code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>The interface must be <code>up</code> before it can scan. Subsequent scan requests do not require the interface to be marked as up again.</p></div></td></tr></tbody></table></div><div class=paragraph><p>The output of a scan request lists each BSS/IBSS network found. Besides listing the name of the network, the <code>SSID</code>, the output also shows the <code>BSSID</code>, which is the MAC address of the access point. The <code>CAPS</code> field identifies the type of each network and the capabilities of the stations operating there:</p></div><table class="tableblock frame-none grid-all stretch"><caption class=title>Tabela 30. Station Capability Codes</caption><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">Capability Code</th><th class="tableblock halign-left valign-top">Meaning</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>E</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Extended Service Set (ESS). Indicates that the station is part of an infrastructure network rather than an IBSS/ad-hoc network.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>I</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>IBSS/ad-hoc network. Indicates that the station is part of an ad-hoc network rather than an ESS network.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>P</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Privacy. Encryption is required for all data frames exchanged within the BSS using cryptographic means such as WEP, TKIP or AES-CCMP.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>S</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Short Preamble. Indicates that the network is using short preambles, defined in 802.11b High Rate/DSSS PHY, and utilizes a 56 bit sync field rather than the 128 bit field used in long preamble mode.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>s</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Short slot time. Indicates that the 802.11g network is using a short slot time because there are no legacy (802.11b) stations present.</p></td></tr></tbody></table><div class=paragraph><p>One can also display the current list of known networks with:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig wlan0 list scan</span></code></pre></div></div><div class=paragraph><p>This information may be updated automatically by the adapter or manually with a <code>scan</code> request. Old data is automatically removed from the cache, so over time this list may shrink unless more scans are done.</p></div></div><div class=sect5><h6 id=_basic_settings>31.3.4.1.2. Basic Settings<a class=anchor href=#_basic_settings></a></h6><div class=paragraph><p>This section provides a simple example of how to make the wireless network adapter work in FreeBSD without encryption. Once familiar with these concepts, it is strongly recommend to use <a href=#network-wireless-wpa>WPA</a> to set up the wireless network.</p></div><div class=paragraph><p>There are three basic steps to configure a wireless network: select an access point, authenticate the station, and configure an IP address. The following sections discuss each step.</p></div><div class=sect6><h7 id=_selecting_an_access_point>31.3.4.1.2.1. Selecting an Access Point<a class=anchor href=#_selecting_an_access_point></a></h7><div class=paragraph><p>Most of the time, it is sufficient to let the system choose an access point using the builtin heuristics. This is the default behavior when an interface is marked as up or it is listed in <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>wlans_ath0=&#34;wlan0&#34;
ifconfig_wlan0=&#34;DHCP&#34;</pre></div></div><div class=paragraph><p>If there are multiple access points, a specific one can be selected by its SSID:</p></div><div class="literalblock programlisting"><div class=content><pre>wlans_ath0=&#34;wlan0&#34;
ifconfig_wlan0=&#34;ssid your_ssid_here DHCP&#34;</pre></div></div><div class=paragraph><p>In an environment where there are multiple access points with the same SSID, which is often done to simplify roaming, it may be necessary to associate to one specific device. In this case, the BSSID of the access point can be specified, with or without the SSID:</p></div><div class="literalblock programlisting"><div class=content><pre>wlans_ath0=&#34;wlan0&#34;
ifconfig_wlan0=&#34;ssid your_ssid_here bssid xx:xx:xx:xx:xx:xx DHCP&#34;</pre></div></div><div class=paragraph><p>There are other ways to constrain the choice of an access point, such as limiting the set of frequencies the system will scan on. This may be useful for a multi-band wireless card as scanning all the possible channels can be time-consuming. To limit operation to a specific band, use the <code>mode</code> parameter:</p></div><div class="literalblock programlisting"><div class=content><pre>wlans_ath0=&#34;wlan0&#34;
ifconfig_wlan0=&#34;mode 11g ssid your_ssid_here DHCP&#34;</pre></div></div><div class=paragraph><p>This example will force the card to operate in 802.11g, which is defined only for 2.4GHz frequencies so any 5GHz channels will not be considered. This can also be achieved with the <code>channel</code> parameter, which locks operation to one specific frequency, and the <code>chanlist</code> parameter, to specify a list of channels for scanning. More information about these parameters can be found in <a href="https://man.freebsd.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;format=html">ifconfig(8)</a>.</p></div></div><div class=sect6><h7 id=_authentication_2>31.3.4.1.2.2. Authentication<a class=anchor href=#_authentication_2></a></h7><div class=paragraph><p>Once an access point is selected, the station needs to authenticate before it can pass data. Authentication can happen in several ways. The most common scheme, open authentication, allows any station to join the network and communicate. This is the authentication to use for test purposes the first time a wireless network is setup. Other schemes require cryptographic handshakes to be completed before data traffic can flow, either using pre-shared keys or secrets, or more complex schemes that involve backend services such as RADIUS. Open authentication is the default setting. The next most common setup is WPA-PSK, also known as WPA Personal, which is described in <a href=#network-wireless-wpa-wpa-psk>WPA-PSK</a>.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>If using an Apple® AirPort® Extreme base station for an access point, shared-key authentication together with a WEP key needs to be configured. This can be configured in <span class=filename>/etc/rc.conf</span> or by using <a href="https://man.freebsd.org/cgi/man.cgi?query=wpa_supplicant&amp;sektion=8&amp;format=html">wpa_supplicant(8)</a>. For a single AirPort® base station, access can be configured with:</p></div><div class="literalblock programlisting"><div class=content><pre>wlans_ath0=&#34;wlan0&#34;
ifconfig_wlan0=&#34;authmode shared wepmode on weptxkey 1 wepkey 01234567 DHCP&#34;</pre></div></div><div class=paragraph><p>In general, shared key authentication should be avoided because it uses the WEP key material in a highly-constrained manner, making it even easier to crack the key. If WEP must be used for compatibility with legacy devices, it is better to use WEP with <code>open</code> authentication. More information regarding WEP can be found in <a href=#network-wireless-wep>WEP</a>.</p></div></td></tr></tbody></table></div></div><div class=sect6><h7 id=_getting_an_ip_address_with_dhcp>31.3.4.1.2.3. Getting an IP Address with DHCP<a class=anchor href=#_getting_an_ip_address_with_dhcp></a></h7><div class=paragraph><p>Once an access point is selected and the authentication parameters are set, an IP address must be obtained in order to communicate. Most of the time, the IP address is obtained via DHCP. To achieve that, edit <span class=filename>/etc/rc.conf</span> and add <code>DHCP</code> to the configuration for the device:</p></div><div class="literalblock programlisting"><div class=content><pre>wlans_ath0=&#34;wlan0&#34;
ifconfig_wlan0=&#34;DHCP&#34;</pre></div></div><div class=paragraph><p>The wireless interface is now ready to bring up:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service netif start</span></code></pre></div></div><div class=paragraph><p>Once the interface is running, use <a href="https://man.freebsd.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;format=html">ifconfig(8)</a> to see the status of the interface <span class=filename>ath0</span>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig wlan0</span>
wlan0: <span class=nv>flags</span><span class=o>=</span>8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500
        ether 00:11:95:d5:43:62
        inet 192.168.1.100 netmask 0xffffff00 broadcast 192.168.1.255
        media: IEEE 802.11 Wireless Ethernet OFDM/54Mbps mode 11g
        status: associated
        ssid dlinkap channel 11 <span class=o>(</span>2462 Mhz 11g<span class=o>)</span> bssid 00:13:46:49:41:76
        country US ecm authmode OPEN privacy OFF txpower 21.5 bmiss 7
        scanvalid 60 bgscan bgscanintvl 300 bgscanidle 250 roam:rssi 7
        roam:rate 5 protmode CTS wme burst</code></pre></div></div><div class=paragraph><p>The <code>status: associated</code> line means that it is connected to the wireless network. The <code>bssid 00:13:46:49:41:76</code> is the MAC address of the access point and <code>authmode OPEN</code> indicates that the communication is not encrypted.</p></div></div><div class=sect6><h7 id=_static_ip_address>31.3.4.1.2.4. Static IP Address<a class=anchor href=#_static_ip_address></a></h7><div class=paragraph><p>If an IP address cannot be obtained from a DHCP server, set a fixed IP address. Replace the <code>DHCP</code> keyword shown above with the address information. Be sure to retain any other parameters for selecting the access point:</p></div><div class="literalblock programlisting"><div class=content><pre>wlans_ath0=&#34;wlan0&#34;
ifconfig_wlan0=&#34;inet 192.168.1.100 netmask 255.255.255.0 ssid your_ssid_here&#34;</pre></div></div></div></div><div class=sect5><h6 id=network-wireless-wpa>31.3.4.1.3. WPA<a class=anchor href=#network-wireless-wpa></a></h6><div class=paragraph><p>Wi-Fi Protected Access (WPA) is a security protocol used together with 802.11 networks to address the lack of proper authentication and the weakness of WEP. WPA leverages the 802.1X authentication protocol and uses one of several ciphers instead of WEP for data integrity. The only cipher required by WPA is the Temporary Key Integrity Protocol (TKIP). TKIP is a cipher that extends the basic RC4 cipher used by WEP by adding integrity checking, tamper detection, and measures for responding to detected intrusions. TKIP is designed to work on legacy hardware with only software modification. It represents a compromise that improves security but is still not entirely immune to attack. WPA also specifies the AES-CCMP cipher as an alternative to TKIP, and that is preferred when possible. For this specification, the term WPA2 or RSN is commonly used.</p></div><div class=paragraph><p>WPA defines authentication and encryption protocols. Authentication is most commonly done using one of two techniques: by 802.1X and a backend authentication service such as RADIUS, or by a minimal handshake between the station and the access point using a pre-shared secret. The former is commonly termed WPA Enterprise and the latter is known as WPA Personal. Since most people will not set up a RADIUS backend server for their wireless network, WPA-PSK is by far the most commonly encountered configuration for WPA.</p></div><div class=paragraph><p>The control of the wireless connection and the key negotiation or authentication with a server is done using <a href="https://man.freebsd.org/cgi/man.cgi?query=wpa_supplicant&amp;sektion=8&amp;format=html">wpa_supplicant(8)</a>. This program requires a configuration file, <span class=filename>/etc/wpa_supplicant.conf</span>, to run. More information regarding this file can be found in <a href="https://man.freebsd.org/cgi/man.cgi?query=wpa_supplicant.conf&amp;sektion=5&amp;format=html">wpa_supplicant.conf(5)</a>.</p></div><div class=sect6><h7 id=network-wireless-wpa-wpa-psk>31.3.4.1.3.1. WPA-PSK<a class=anchor href=#network-wireless-wpa-wpa-psk></a></h7><div class=paragraph><p>WPA-PSK, also known as WPA Personal, is based on a pre-shared key (PSK) which is generated from a given password and used as the master key in the wireless network. This means every wireless user will share the same key. WPA-PSK is intended for small networks where the use of an authentication server is not possible or desired.</p></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>Always use strong passwords that are sufficiently long and made from a rich alphabet so that they will not be easily guessed or attacked.</p></div></td></tr></tbody></table></div><div class=paragraph><p>The first step is the configuration of <span class=filename>/etc/wpa_supplicant.conf</span> with the SSID and the pre-shared key of the network:</p></div><div class="literalblock programlisting"><div class=content><pre>network={
  ssid=&#34;freebsdap&#34;
  psk=&#34;freebsdmall&#34;
}</pre></div></div><div class=paragraph><p>Then, in <span class=filename>/etc/rc.conf</span>, indicate that the wireless device configuration will be done with WPA and the IP address will be obtained with DHCP:</p></div><div class="literalblock programlisting"><div class=content><pre>wlans_ath0=&#34;wlan0&#34;
ifconfig_wlan0=&#34;WPA DHCP&#34;</pre></div></div><div class=paragraph><p>Then, bring up the interface:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service netif start</span>
Starting wpa_supplicant.
DHCPDISCOVER on wlan0 to 255.255.255.255 port 67 interval 5
DHCPDISCOVER on wlan0 to 255.255.255.255 port 67 interval 6
DHCPOFFER from 192.168.0.1
DHCPREQUEST on wlan0 to 255.255.255.255 port 67
DHCPACK from 192.168.0.1
bound to 192.168.0.254 <span class=nt>--</span> renewal <span class=k>in </span>300 seconds.
wlan0: <span class=nv>flags</span><span class=o>=</span>8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500
      ether 00:11:95:d5:43:62
      inet 192.168.0.254 netmask 0xffffff00 broadcast 192.168.0.255
      media: IEEE 802.11 Wireless Ethernet OFDM/36Mbps mode 11g
      status: associated
      ssid freebsdap channel 1 <span class=o>(</span>2412 Mhz 11g<span class=o>)</span> bssid 00:11:95:c3:0d:ac
      country US ecm authmode WPA2/802.11i privacy ON deftxkey UNDEF
      AES-CCM 3:128-bit txpower 21.5 bmiss 7 scanvalid 450 bgscan
      bgscanintvl 300 bgscanidle 250 roam:rssi 7 roam:rate 5 protmode CTS
      wme burst roaming MANUAL</code></pre></div></div><div class=paragraph><p>Or, try to configure the interface manually using the information in <span class=filename>/etc/wpa_supplicant.conf</span>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># wpa_supplicant -i wlan0 -c /etc/wpa_supplicant.conf</span>
Trying to associate with 00:11:95:c3:0d:ac <span class=o>(</span><span class=nv>SSID</span><span class=o>=</span><span class=s1>&#39;freebsdap&#39;</span> <span class=nv>freq</span><span class=o>=</span>2412 MHz<span class=o>)</span>
Associated with 00:11:95:c3:0d:ac
WPA: Key negotiation completed with 00:11:95:c3:0d:ac <span class=o>[</span><span class=nv>PTK</span><span class=o>=</span>CCMP <span class=nv>GTK</span><span class=o>=</span>CCMP]
CTRL-EVENT-CONNECTED - Connection to 00:11:95:c3:0d:ac completed <span class=o>(</span>auth<span class=o>)</span> <span class=o>[</span><span class=nb>id</span><span class=o>=</span>0 <span class=nv>id_str</span><span class=o>=]</span></code></pre></div></div><div class=paragraph><p>The next operation is to launch <a href="https://man.freebsd.org/cgi/man.cgi?query=dhclient&amp;sektion=8&amp;format=html">dhclient(8)</a> to get the IP address from the DHCP server:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># dhclient wlan0</span>
DHCPREQUEST on wlan0 to 255.255.255.255 port 67
DHCPACK from 192.168.0.1
bound to 192.168.0.254 <span class=nt>--</span> renewal <span class=k>in </span>300 seconds.
<span class=c># ifconfig wlan0</span>
wlan0: <span class=nv>flags</span><span class=o>=</span>8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500
      ether 00:11:95:d5:43:62
      inet 192.168.0.254 netmask 0xffffff00 broadcast 192.168.0.255
      media: IEEE 802.11 Wireless Ethernet OFDM/36Mbps mode 11g
      status: associated
      ssid freebsdap channel 1 <span class=o>(</span>2412 Mhz 11g<span class=o>)</span> bssid 00:11:95:c3:0d:ac
      country US ecm authmode WPA2/802.11i privacy ON deftxkey UNDEF
      AES-CCM 3:128-bit txpower 21.5 bmiss 7 scanvalid 450 bgscan
      bgscanintvl 300 bgscanidle 250 roam:rssi 7 roam:rate 5 protmode CTS
      wme burst roaming MANUAL</code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>If <span class=filename>/etc/rc.conf</span> has an <code>ifconfig_wlan0="DHCP"</code> entry, <a href="https://man.freebsd.org/cgi/man.cgi?query=dhclient&amp;sektion=8&amp;format=html">dhclient(8)</a> will be launched automatically after <a href="https://man.freebsd.org/cgi/man.cgi?query=wpa_supplicant&amp;sektion=8&amp;format=html">wpa_supplicant(8)</a> associates with the access point.</p></div></td></tr></tbody></table></div><div class=paragraph><p>If DHCP is not possible or desired, set a static IP address after <a href="https://man.freebsd.org/cgi/man.cgi?query=wpa_supplicant&amp;sektion=8&amp;format=html">wpa_supplicant(8)</a> has authenticated the station:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig wlan0 inet 192.168.0.100 netmask 255.255.255.0</span>
<span class=c># ifconfig wlan0</span>
wlan0: <span class=nv>flags</span><span class=o>=</span>8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500
      ether 00:11:95:d5:43:62
      inet 192.168.0.100 netmask 0xffffff00 broadcast 192.168.0.255
      media: IEEE 802.11 Wireless Ethernet OFDM/36Mbps mode 11g
      status: associated
      ssid freebsdap channel 1 <span class=o>(</span>2412 Mhz 11g<span class=o>)</span> bssid 00:11:95:c3:0d:ac
      country US ecm authmode WPA2/802.11i privacy ON deftxkey UNDEF
      AES-CCM 3:128-bit txpower 21.5 bmiss 7 scanvalid 450 bgscan
      bgscanintvl 300 bgscanidle 250 roam:rssi 7 roam:rate 5 protmode CTS
      wme burst roaming MANUAL</code></pre></div></div><div class=paragraph><p>When DHCP is not used, the default gateway and the nameserver also have to be manually set:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># route add default your_default_router</span>
<span class=c># echo &#34;nameserver your_DNS_server&#34; &gt;&gt; /etc/resolv.conf</span></code></pre></div></div></div><div class=sect6><h7 id=network-wireless-wpa-eap-tls>31.3.4.1.3.2. WPA with EAP-TLS<a class=anchor href=#network-wireless-wpa-eap-tls></a></h7><div class=paragraph><p>The second way to use WPA is with an 802.1X backend authentication server. In this case, WPA is called WPA Enterprise to differentiate it from the less secure WPA Personal. Authentication in WPA Enterprise is based on the Extensible Authentication Protocol (EAP).</p></div><div class=paragraph><p>EAP does not come with an encryption method. Instead, EAP is embedded inside an encrypted tunnel. There are many EAP authentication methods, but EAP-TLS, EAP-TTLS, and EAP-PEAP are the most common.</p></div><div class=paragraph><p>EAP with Transport Layer Security (EAP-TLS) is a well-supported wireless authentication protocol since it was the first EAP method to be certified by the <a href=http://www.wi-fi.org/>Wi-Fi Alliance</a>. EAP-TLS requires three certificates to run: the certificate of the Certificate Authority (CA) installed on all machines, the server certificate for the authentication server, and one client certificate for each wireless client. In this EAP method, both the authentication server and wireless client authenticate each other by presenting their respective certificates, and then verify that these certificates were signed by the organization’s CA.</p></div><div class=paragraph><p>As previously, the configuration is done via <span class=filename>/etc/wpa_supplicant.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>network={
  ssid=&#34;freebsdap&#34; <i class=conum data-value=1></i><b>(1)</b>
  proto=RSN  <i class=conum data-value=2></i><b>(2)</b>
  key_mgmt=WPA-EAP <i class=conum data-value=3></i><b>(3)</b>
  eap=TLS <i class=conum data-value=4></i><b>(4)</b>
  identity=&#34;loader&#34; <i class=conum data-value=5></i><b>(5)</b>
  ca_cert=&#34;/etc/certs/cacert.pem&#34; <i class=conum data-value=6></i><b>(6)</b>
  client_cert=&#34;/etc/certs/clientcert.pem&#34; <i class=conum data-value=7></i><b>(7)</b>
  private_key=&#34;/etc/certs/clientkey.pem&#34; <i class=conum data-value=8></i><b>(8)</b>
  private_key_passwd=&#34;freebsdmallclient&#34; <i class=conum data-value=9></i><b>(9)</b>
}</pre></div></div><div class="colist arabic"><table><tbody><tr><td><i class=conum data-value=1></i><b>1</b></td><td>This field indicates the network name (SSID).</td></tr><tr><td><i class=conum data-value=2></i><b>2</b></td><td>This example uses the RSN IEEE® 802.11i protocol, also known as WPA2.</td></tr><tr><td><i class=conum data-value=3></i><b>3</b></td><td>The <code>key_mgmt</code> line refers to the key management protocol to use. In this example, it is WPA using EAP authentication.</td></tr><tr><td><i class=conum data-value=4></i><b>4</b></td><td>This field indicates the EAP method for the connection.</td></tr><tr><td><i class=conum data-value=5></i><b>5</b></td><td>The <code>identity</code> field contains the identity string for EAP.</td></tr><tr><td><i class=conum data-value=6></i><b>6</b></td><td>The <code>ca_cert</code> field indicates the pathname of the CA certificate file. This file is needed to verify the server certificate.</td></tr><tr><td><i class=conum data-value=7></i><b>7</b></td><td>The <code>client_cert</code> line gives the pathname to the client certificate file. This certificate is unique to each wireless client of the network.</td></tr><tr><td><i class=conum data-value=8></i><b>8</b></td><td>The <code>private_key</code> field is the pathname to the client certificate private key file.</td></tr><tr><td><i class=conum data-value=9></i><b>9</b></td><td>The <code>private_key_passwd</code> field contains the passphrase for the private key.</td></tr></tbody></table></div><div class=paragraph><p>Then, add the following lines to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>wlans_ath0=&#34;wlan0&#34;
ifconfig_wlan0=&#34;WPA DHCP&#34;</pre></div></div><div class=paragraph><p>The next step is to bring up the interface:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service netif start</span>
Starting wpa_supplicant.
DHCPREQUEST on wlan0 to 255.255.255.255 port 67 interval 7
DHCPREQUEST on wlan0 to 255.255.255.255 port 67 interval 15
DHCPACK from 192.168.0.20
bound to 192.168.0.254 <span class=nt>--</span> renewal <span class=k>in </span>300 seconds.
wlan0: <span class=nv>flags</span><span class=o>=</span>8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500
      ether 00:11:95:d5:43:62
      inet 192.168.0.254 netmask 0xffffff00 broadcast 192.168.0.255
      media: IEEE 802.11 Wireless Ethernet DS/11Mbps mode 11g
      status: associated
      ssid freebsdap channel 1 <span class=o>(</span>2412 Mhz 11g<span class=o>)</span> bssid 00:11:95:c3:0d:ac
      country US ecm authmode WPA2/802.11i privacy ON deftxkey UNDEF
      AES-CCM 3:128-bit txpower 21.5 bmiss 7 scanvalid 450 bgscan
      bgscanintvl 300 bgscanidle 250 roam:rssi 7 roam:rate 5 protmode CTS
      wme burst roaming MANUAL</code></pre></div></div><div class=paragraph><p>It is also possible to bring up the interface manually using <a href="https://man.freebsd.org/cgi/man.cgi?query=wpa_supplicant&amp;sektion=8&amp;format=html">wpa_supplicant(8)</a> and <a href="https://man.freebsd.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;format=html">ifconfig(8)</a>.</p></div></div><div class=sect6><h7 id=network-wireless-wpa-eap-ttls>31.3.4.1.3.3. WPA with EAP-TTLS<a class=anchor href=#network-wireless-wpa-eap-ttls></a></h7><div class=paragraph><p>With EAP-TLS, both the authentication server and the client need a certificate. With EAP-TTLS, a client certificate is optional. This method is similar to a web server which creates a secure SSL tunnel even if visitors do not have client-side certificates. EAP-TTLS uses an encrypted TLS tunnel for safe transport of the authentication data.</p></div><div class=paragraph><p>The required configuration can be added to <span class=filename>/etc/wpa_supplicant.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>network={
  ssid=&#34;freebsdap&#34;
  proto=RSN
  key_mgmt=WPA-EAP
  eap=TTLS <i class=conum data-value=1></i><b>(1)</b>
  identity=&#34;test&#34; <i class=conum data-value=2></i><b>(2)</b>
  password=&#34;test&#34; <i class=conum data-value=3></i><b>(3)</b>
  ca_cert=&#34;/etc/certs/cacert.pem&#34; <i class=conum data-value=4></i><b>(4)</b>
  phase2=&#34;auth=MD5&#34; <i class=conum data-value=5></i><b>(5)</b>
}</pre></div></div><div class="colist arabic"><table><tbody><tr><td><i class=conum data-value=1></i><b>1</b></td><td>This field specifies the EAP method for the connection.</td></tr><tr><td><i class=conum data-value=2></i><b>2</b></td><td>The <code>identity</code> field contains the identity string for EAP authentication inside the encrypted TLS tunnel.</td></tr><tr><td><i class=conum data-value=3></i><b>3</b></td><td>The <code>password</code> field contains the passphrase for the EAP authentication.</td></tr><tr><td><i class=conum data-value=4></i><b>4</b></td><td>The <code>ca_cert</code> field indicates the pathname of the CA certificate file. This file is needed to verify the server certificate.</td></tr><tr><td><i class=conum data-value=5></i><b>5</b></td><td>This field specifies the authentication method used in the encrypted TLS tunnel. In this example, EAP with MD5-Challenge is used. The "inner authentication" phase is often called "phase2".</td></tr></tbody></table></div><div class=paragraph><p>Next, add the following lines to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>wlans_ath0=&#34;wlan0&#34;
ifconfig_wlan0=&#34;WPA DHCP&#34;</pre></div></div><div class=paragraph><p>The next step is to bring up the interface:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service netif start</span>
Starting wpa_supplicant.
DHCPREQUEST on wlan0 to 255.255.255.255 port 67 interval 7
DHCPREQUEST on wlan0 to 255.255.255.255 port 67 interval 15
DHCPREQUEST on wlan0 to 255.255.255.255 port 67 interval 21
DHCPACK from 192.168.0.20
bound to 192.168.0.254 <span class=nt>--</span> renewal <span class=k>in </span>300 seconds.
wlan0: <span class=nv>flags</span><span class=o>=</span>8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500
      ether 00:11:95:d5:43:62
      inet 192.168.0.254 netmask 0xffffff00 broadcast 192.168.0.255
      media: IEEE 802.11 Wireless Ethernet DS/11Mbps mode 11g
      status: associated
      ssid freebsdap channel 1 <span class=o>(</span>2412 Mhz 11g<span class=o>)</span> bssid 00:11:95:c3:0d:ac
      country US ecm authmode WPA2/802.11i privacy ON deftxkey UNDEF
      AES-CCM 3:128-bit txpower 21.5 bmiss 7 scanvalid 450 bgscan
      bgscanintvl 300 bgscanidle 250 roam:rssi 7 roam:rate 5 protmode CTS
      wme burst roaming MANUAL</code></pre></div></div></div><div class=sect6><h7 id=network-wireless-wpa-eap-peap>31.3.4.1.3.4. WPA with EAP-PEAP<a class=anchor href=#network-wireless-wpa-eap-peap></a></h7><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>PEAPv0/EAP-MSCHAPv2 is the most common PEAP method. In this chapter, the term PEAP is used to refer to that method.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Protected EAP (PEAP) is designed as an alternative to EAP-TTLS and is the most used EAP standard after EAP-TLS. In a network with mixed operating systems, PEAP should be the most supported standard after EAP-TLS.</p></div><div class=paragraph><p>PEAP is similar to EAP-TTLS as it uses a server-side certificate to authenticate clients by creating an encrypted TLS tunnel between the client and the authentication server, which protects the ensuing exchange of authentication information. PEAP authentication differs from EAP-TTLS as it broadcasts the username in the clear and only the password is sent in the encrypted TLS tunnel. EAP-TTLS will use the TLS tunnel for both the username and password.</p></div><div class=paragraph><p>Add the following lines to <span class=filename>/etc/wpa_supplicant.conf</span> to configure the EAP-PEAP related settings:</p></div><div class="literalblock programlisting"><div class=content><pre>network={
  ssid=&#34;freebsdap&#34;
  proto=RSN
  key_mgmt=WPA-EAP
  eap=PEAP <i class=conum data-value=1></i><b>(1)</b>
  identity=&#34;test&#34; <i class=conum data-value=2></i><b>(2)</b>
  password=&#34;test&#34; <i class=conum data-value=3></i><b>(3)</b>
  ca_cert=&#34;/etc/certs/cacert.pem&#34; <i class=conum data-value=4></i><b>(4)</b>
  phase1=&#34;peaplabel=0&#34; <i class=conum data-value=5></i><b>(5)</b>
  phase2=&#34;auth=MSCHAPV2&#34; <i class=conum data-value=6></i><b>(6)</b>
}</pre></div></div><div class="colist arabic"><table><tbody><tr><td><i class=conum data-value=1></i><b>1</b></td><td>This field specifies the EAP method for the connection.</td></tr><tr><td><i class=conum data-value=2></i><b>2</b></td><td>The <code>identity</code> field contains the identity string for EAP authentication inside the encrypted TLS tunnel.</td></tr><tr><td><i class=conum data-value=3></i><b>3</b></td><td>The <code>password</code> field contains the passphrase for the EAP authentication.</td></tr><tr><td><i class=conum data-value=4></i><b>4</b></td><td>The <code>ca_cert</code> field indicates the pathname of the CA certificate file. This file is needed to verify the server certificate.</td></tr><tr><td><i class=conum data-value=5></i><b>5</b></td><td>This field contains the parameters for the first phase of authentication, the TLS tunnel. According to the authentication server used, specify a specific label for authentication. Most of the time, the label will be "client EAP encryption" which is set by using <code>peaplabel=0</code>. More information can be found in <a href="https://man.freebsd.org/cgi/man.cgi?query=wpa_supplicant.conf&amp;sektion=5&amp;format=html">wpa_supplicant.conf(5)</a>.</td></tr><tr><td><i class=conum data-value=6></i><b>6</b></td><td>This field specifies the authentication protocol used in the encrypted TLS tunnel. In the case of PEAP, it is <code>auth=MSCHAPV2</code>.</td></tr></tbody></table></div><div class=paragraph><p>Add the following to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>wlans_ath0=&#34;wlan0&#34;
ifconfig_wlan0=&#34;WPA DHCP&#34;</pre></div></div><div class=paragraph><p>Then, bring up the interface:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service netif start</span>
Starting wpa_supplicant.
DHCPREQUEST on wlan0 to 255.255.255.255 port 67 interval 7
DHCPREQUEST on wlan0 to 255.255.255.255 port 67 interval 15
DHCPREQUEST on wlan0 to 255.255.255.255 port 67 interval 21
DHCPACK from 192.168.0.20
bound to 192.168.0.254 <span class=nt>--</span> renewal <span class=k>in </span>300 seconds.
wlan0: <span class=nv>flags</span><span class=o>=</span>8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500
      ether 00:11:95:d5:43:62
      inet 192.168.0.254 netmask 0xffffff00 broadcast 192.168.0.255
      media: IEEE 802.11 Wireless Ethernet DS/11Mbps mode 11g
      status: associated
      ssid freebsdap channel 1 <span class=o>(</span>2412 Mhz 11g<span class=o>)</span> bssid 00:11:95:c3:0d:ac
      country US ecm authmode WPA2/802.11i privacy ON deftxkey UNDEF
      AES-CCM 3:128-bit txpower 21.5 bmiss 7 scanvalid 450 bgscan
      bgscanintvl 300 bgscanidle 250 roam:rssi 7 roam:rate 5 protmode CTS
      wme burst roaming MANUAL</code></pre></div></div></div></div><div class=sect5><h6 id=network-wireless-wep>31.3.4.1.4. WEP<a class=anchor href=#network-wireless-wep></a></h6><div class=paragraph><p>Wired Equivalent Privacy (WEP) is part of the original 802.11 standard. There is no authentication mechanism, only a weak form of access control which is easily cracked.</p></div><div class=paragraph><p>WEP can be set up using <a href="https://man.freebsd.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;format=html">ifconfig(8)</a>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig wlan0 create wlandev ath0</span>
<span class=c># ifconfig wlan0 inet 192.168.1.100 netmask 255.255.255.0 \</span>
	    ssid my_net wepmode on weptxkey 3 wepkey 3:0x3456789012</code></pre></div></div><div class=ulist><ul><li><p>The <code>weptxkey</code> specifies which WEP key will be used in the transmission. This example uses the third key. This must match the setting on the access point. When unsure which key is used by the access point, try <code>1</code> (the first key) for this value.</p></li><li><p>The <code>wepkey</code> selects one of the WEP keys. It should be in the format <em>index:key</em>. Key <code>1</code> is used by default; the index only needs to be set when using a key other than the first key.</p><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Replace the <code>0x3456789012</code> with the key configured for use on the access point.</p></div></td></tr></tbody></table></div></li></ul></div><div class=paragraph><p>Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;format=html">ifconfig(8)</a> for further information.</p></div><div class=paragraph><p>The <a href="https://man.freebsd.org/cgi/man.cgi?query=wpa_supplicant&amp;sektion=8&amp;format=html">wpa_supplicant(8)</a> facility can be used to configure a wireless interface with WEP. The example above can be set up by adding the following lines to <span class=filename>/etc/wpa_supplicant.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>network={
  ssid=&#34;my_net&#34;
  key_mgmt=NONE
  wep_key3=3456789012
  wep_tx_keyidx=3
}</pre></div></div><div class=paragraph><p>Then:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># wpa_supplicant -i wlan0 -c /etc/wpa_supplicant.conf</span>
Trying to associate with 00:13:46:49:41:76 <span class=o>(</span><span class=nv>SSID</span><span class=o>=</span><span class=s1>&#39;dlinkap&#39;</span> <span class=nv>freq</span><span class=o>=</span>2437 MHz<span class=o>)</span>
Associated with 00:13:46:49:41:76</code></pre></div></div></div></div></div><div class=sect3><h4 id=_ad_hoc_mode>31.3.5. Ad-hoc Mode<a class=anchor href=#_ad_hoc_mode></a></h4><div class=paragraph><p>IBSS mode, also called ad-hoc mode, is designed for point to point connections. For example, to establish an ad-hoc network between the machines <code>A</code> and <code>B</code>, choose two IP addresses and a SSID.</p></div><div class=paragraph><p>On <code>A</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig wlan0 create wlandev ath0 wlanmode adhoc</span>
<span class=c># ifconfig wlan0 inet 192.168.0.1 netmask 255.255.255.0 ssid freebsdap</span>
<span class=c># ifconfig wlan0</span>
  wlan0: <span class=nv>flags</span><span class=o>=</span>8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
	  ether 00:11:95:c3:0d:ac
	  inet 192.168.0.1 netmask 0xffffff00 broadcast 192.168.0.255
	  media: IEEE 802.11 Wireless Ethernet autoselect mode 11g &lt;adhoc&gt;
	  status: running
	  ssid freebsdap channel 2 <span class=o>(</span>2417 Mhz 11g<span class=o>)</span> bssid 02:11:95:c3:0d:ac
	  country US ecm authmode OPEN privacy OFF txpower 21.5 scanvalid 60
	  protmode CTS wme burst</code></pre></div></div><div class=paragraph><p>The <code>adhoc</code> parameter indicates that the interface is running in IBSS mode.</p></div><div class=paragraph><p><code>B</code> should now be able to detect <code>A</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig wlan0 create wlandev ath0 wlanmode adhoc</span>
<span class=c># ifconfig wlan0 up scan</span>
  SSID/MESH ID    BSSID              CHAN RATE   S:N     INT CAPS
  freebsdap       02:11:95:c3:0d:ac    2   54M <span class=nt>-64</span>:-96  100 IS   WME</code></pre></div></div><div class=paragraph><p>The <code>I</code> in the output confirms that <code>A</code> is in ad-hoc mode. Now, configure <code>B</code> with a different IP address:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig wlan0 inet 192.168.0.2 netmask 255.255.255.0 ssid freebsdap</span>
<span class=c># ifconfig wlan0</span>
  wlan0: <span class=nv>flags</span><span class=o>=</span>8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
	  ether 00:11:95:d5:43:62
	  inet 192.168.0.2 netmask 0xffffff00 broadcast 192.168.0.255
	  media: IEEE 802.11 Wireless Ethernet autoselect mode 11g &lt;adhoc&gt;
	  status: running
	  ssid freebsdap channel 2 <span class=o>(</span>2417 Mhz 11g<span class=o>)</span> bssid 02:11:95:c3:0d:ac
	  country US ecm authmode OPEN privacy OFF txpower 21.5 scanvalid 60
	  protmode CTS wme burst</code></pre></div></div><div class=paragraph><p>Both <code>A</code> and <code>B</code> are now ready to exchange information.</p></div></div><div class=sect3><h4 id=network-wireless-ap>31.3.6. FreeBSD Host Access Points<a class=anchor href=#network-wireless-ap></a></h4><div class=paragraph><p>FreeBSD can act as an Access Point (AP) which eliminates the need to buy a hardware AP or run an ad-hoc network. This can be particularly useful when a FreeBSD machine is acting as a gateway to another network such as the Internet.</p></div><div class=sect4><h5 id=network-wireless-ap-basic>31.3.6.1. Basic Settings<a class=anchor href=#network-wireless-ap-basic></a></h5><div class=paragraph><p>Before configuring a FreeBSD machine as an AP, the kernel must be configured with the appropriate networking support for the wireless card as well as the security protocols being used. For more details, see <a href=#network-wireless-basic>Basic Setup</a>.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>The NDIS driver wrapper for Windows® drivers does not currently support AP operation. Only native FreeBSD wireless drivers support AP mode.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Once wireless networking support is loaded, check if the wireless device supports the host-based access point mode, also known as hostap mode:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig wlan0 create wlandev ath0</span>
<span class=c># ifconfig wlan0 list caps</span>
<span class=nv>drivercaps</span><span class=o>=</span>6f85edc1&lt;STA,FF,TURBOP,IBSS,HOSTAP,AHDEMO,TXPMGT,SHSLOT,SHPREAMBLE,MONITOR,MBSS,WPA1,WPA2,BURST,WME,WDS,BGSCAN,TXFRAG&gt;
<span class=nv>cryptocaps</span><span class=o>=</span>1f&lt;WEP,TKIP,AES,AES_CCM,TKIPMIC&gt;</code></pre></div></div><div class=paragraph><p>This output displays the card’s capabilities. The <code>HOSTAP</code> word confirms that this wireless card can act as an AP. Various supported ciphers are also listed: WEP, TKIP, and AES. This information indicates which security protocols can be used on the AP.</p></div><div class=paragraph><p>The wireless device can only be put into hostap mode during the creation of the network pseudo-device, so a previously created device must be destroyed first:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig wlan0 destroy</span></code></pre></div></div><div class=paragraph><p>then regenerated with the correct option before setting the other parameters:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig wlan0 create wlandev ath0 wlanmode hostap</span>
<span class=c># ifconfig wlan0 inet 192.168.0.1 netmask 255.255.255.0 ssid freebsdap mode 11g channel 1</span></code></pre></div></div><div class=paragraph><p>Use <a href="https://man.freebsd.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;format=html">ifconfig(8)</a> again to see the status of the <span class=filename>wlan0</span> interface:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig wlan0</span>
  wlan0: <span class=nv>flags</span><span class=o>=</span>8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
	  ether 00:11:95:c3:0d:ac
	  inet 192.168.0.1 netmask 0xffffff00 broadcast 192.168.0.255
	  media: IEEE 802.11 Wireless Ethernet autoselect mode 11g &lt;hostap&gt;
	  status: running
	  ssid freebsdap channel 1 <span class=o>(</span>2412 Mhz 11g<span class=o>)</span> bssid 00:11:95:c3:0d:ac
	  country US ecm authmode OPEN privacy OFF txpower 21.5 scanvalid 60
	  protmode CTS wme burst dtimperiod 1 <span class=nt>-dfs</span></code></pre></div></div><div class=paragraph><p>The <code>hostap</code> parameter indicates the interface is running in the host-based access point mode.</p></div><div class=paragraph><p>The interface configuration can be done automatically at boot time by adding the following lines to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>wlans_ath0=&#34;wlan0&#34;
create_args_wlan0=&#34;wlanmode hostap&#34;
ifconfig_wlan0=&#34;inet 192.168.0.1 netmask 255.255.255.0 ssid freebsdap mode 11g channel 1&#34;</pre></div></div></div><div class=sect4><h5 id=_host_based_access_point_without_authentication_or_encryption>31.3.6.2. Host-based Access Point Without Authentication or Encryption<a class=anchor href=#_host_based_access_point_without_authentication_or_encryption></a></h5><div class=paragraph><p>Although it is not recommended to run an AP without any authentication or encryption, this is a simple way to check if the AP is working. This configuration is also important for debugging client issues.</p></div><div class=paragraph><p>Once the AP is configured, initiate a scan from another wireless machine to find the AP:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig wlan0 create wlandev ath0</span>
<span class=c># ifconfig wlan0 up scan</span>
SSID/MESH ID    BSSID              CHAN RATE   S:N     INT CAPS
freebsdap       00:11:95:c3:0d:ac    1   54M <span class=nt>-66</span>:-96  100 ES   WME</code></pre></div></div><div class=paragraph><p>The client machine found the AP and can be associated with it:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig wlan0 inet 192.168.0.2 netmask 255.255.255.0 ssid freebsdap</span>
<span class=c># ifconfig wlan0</span>
  wlan0: <span class=nv>flags</span><span class=o>=</span>8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
	  ether 00:11:95:d5:43:62
	  inet 192.168.0.2 netmask 0xffffff00 broadcast 192.168.0.255
	  media: IEEE 802.11 Wireless Ethernet OFDM/54Mbps mode 11g
	  status: associated
	  ssid freebsdap channel 1 <span class=o>(</span>2412 Mhz 11g<span class=o>)</span> bssid 00:11:95:c3:0d:ac
	  country US ecm authmode OPEN privacy OFF txpower 21.5 bmiss 7
	  scanvalid 60 bgscan bgscanintvl 300 bgscanidle 250 roam:rssi 7
	  roam:rate 5 protmode CTS wme burst</code></pre></div></div></div><div class=sect4><h5 id=network-wireless-ap-wpa>31.3.6.3. WPA2 Host-based Access Point<a class=anchor href=#network-wireless-ap-wpa></a></h5><div class=paragraph><p>This section focuses on setting up a FreeBSD access point using the WPA2 security protocol. More details regarding WPA and the configuration of WPA-based wireless clients can be found in <a href=#network-wireless-wpa>WPA</a>.</p></div><div class=paragraph><p>The <a href="https://man.freebsd.org/cgi/man.cgi?query=hostapd&amp;sektion=8&amp;format=html">hostapd(8)</a> daemon is used to deal with client authentication and key management on the WPA2-enabled AP.</p></div><div class=paragraph><p>The following configuration operations are performed on the FreeBSD machine acting as the AP. Once the AP is correctly working, <a href="https://man.freebsd.org/cgi/man.cgi?query=hostapd&amp;sektion=8&amp;format=html">hostapd(8)</a> can be automatically started at boot with this line in <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>hostapd_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>Before trying to configure <a href="https://man.freebsd.org/cgi/man.cgi?query=hostapd&amp;sektion=8&amp;format=html">hostapd(8)</a>, first configure the basic settings introduced in <a href=#network-wireless-ap-basic>Basic Settings</a>.</p></div><div class=sect5><h6 id=_wpa2_psk>31.3.6.3.1. WPA2-PSK<a class=anchor href=#_wpa2_psk></a></h6><div class=paragraph><p>WPA2-PSK is intended for small networks where the use of a backend authentication server is not possible or desired.</p></div><div class=paragraph><p>The configuration is done in <span class=filename>/etc/hostapd.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>interface=wlan0                  <i class=conum data-value=1></i><b>(1)</b>
debug=1                          <i class=conum data-value=2></i><b>(2)</b>
ctrl_interface=/var/run/hostapd  <i class=conum data-value=3></i><b>(3)</b>
ctrl_interface_group=wheel       <i class=conum data-value=4></i><b>(4)</b>
ssid=freebsdap                   <i class=conum data-value=5></i><b>(5)</b>
wpa=2                            <i class=conum data-value=6></i><b>(6)</b>
wpa_passphrase=freebsdmall       <i class=conum data-value=7></i><b>(7)</b>
wpa_key_mgmt=WPA-PSK             <i class=conum data-value=8></i><b>(8)</b>
wpa_pairwise=CCMP                <i class=conum data-value=9></i><b>(9)</b></pre></div></div><div class="colist arabic"><table><tbody><tr><td><i class=conum data-value=1></i><b>1</b></td><td>Wireless interface used for the access point.</td></tr><tr><td><i class=conum data-value=2></i><b>2</b></td><td>Level of verbosity used during the execution of <a href="https://man.freebsd.org/cgi/man.cgi?query=hostapd&amp;sektion=8&amp;format=html">hostapd(8)</a>. A value of <code>1</code> represents the minimal level.</td></tr><tr><td><i class=conum data-value=3></i><b>3</b></td><td>Pathname of the directory used by <a href="https://man.freebsd.org/cgi/man.cgi?query=hostapd&amp;sektion=8&amp;format=html">hostapd(8)</a> to store domain socket files for communication with external programs such as <a href="https://man.freebsd.org/cgi/man.cgi?query=hostapd_cli&amp;sektion=8&amp;format=html">hostapd_cli(8)</a>. The default value is used in this example.</td></tr><tr><td><i class=conum data-value=4></i><b>4</b></td><td>The group allowed to access the control interface files.</td></tr><tr><td><i class=conum data-value=5></i><b>5</b></td><td>The wireless network name, or SSID, that will appear in wireless scans.</td></tr><tr><td><i class=conum data-value=6></i><b>6</b></td><td>Enable WPA and specify which WPA authentication protocol will be required. A value of <code>2</code> configures the AP for WPA2 and is recommended. Set to <code>1</code> only if the obsolete WPA is required.</td></tr><tr><td><i class=conum data-value=7></i><b>7</b></td><td>ASCII passphrase for WPA authentication.</td></tr><tr><td><i class=conum data-value=8></i><b>8</b></td><td>The key management protocol to use. This example sets WPA-PSK.</td></tr><tr><td><i class=conum data-value=9></i><b>9</b></td><td>Encryption algorithms accepted by the access point. In this example, only the CCMP (AES) cipher is accepted. CCMP is an alternative to TKIP and is strongly preferred when possible. TKIP should be allowed only when there are stations incapable of using CCMP.</td></tr></tbody></table></div><div class=paragraph><p>The next step is to start <a href="https://man.freebsd.org/cgi/man.cgi?query=hostapd&amp;sektion=8&amp;format=html">hostapd(8)</a>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service hostapd forcestart</span></code></pre></div></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig wlan0</span>
wlan0: <span class=nv>flags</span><span class=o>=</span>8943&lt;UP,BROADCAST,RUNNING,PROMISC,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
	ether 04:f0:21:16:8e:10
	inet6 fe80::6f0:21ff:fe16:8e10%wlan0 prefixlen 64 scopeid 0x9
	nd6 <span class=nv>options</span><span class=o>=</span>21&lt;PERFORMNUD,AUTO_LINKLOCAL&gt;
	media: IEEE 802.11 Wireless Ethernet autoselect mode 11na &lt;hostap&gt;
	status: running
	ssid No5ignal channel 36 <span class=o>(</span>5180 MHz 11a ht/40+<span class=o>)</span> bssid 04:f0:21:16:8e:10
	country US ecm authmode WPA2/802.11i privacy MIXED deftxkey 2
	AES-CCM 2:128-bit AES-CCM 3:128-bit txpower 17 mcastrate 6 mgmtrate 6
	scanvalid 60 ampdulimit 64k ampdudensity 8 shortgi wme burst
	dtimperiod 1 <span class=nt>-dfs</span>
	<span class=nb>groups</span>: wlan</code></pre></div></div><div class=paragraph><p>Once the AP is running, the clients can associate with it. See <a href=#network-wireless-wpa>WPA</a> for more details. It is possible to see the stations associated with the AP using <code>ifconfig <em>wlan0</em> list sta</code>.</p></div></div></div><div class=sect4><h5 id=_wep_host_based_access_point>31.3.6.4. WEP Host-based Access Point<a class=anchor href=#_wep_host_based_access_point></a></h5><div class=paragraph><p>It is not recommended to use WEP for setting up an AP since there is no authentication mechanism and the encryption is easily cracked. Some legacy wireless cards only support WEP and these cards will only support an AP without authentication or encryption.</p></div><div class=paragraph><p>The wireless device can now be put into hostap mode and configured with the correct SSID and IP address:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig wlan0 create wlandev ath0 wlanmode hostap</span>
<span class=c># ifconfig wlan0 inet 192.168.0.1 netmask 255.255.255.0 \</span>
	ssid freebsdap wepmode on weptxkey 3 wepkey 3:0x3456789012 mode 11g</code></pre></div></div><div class=ulist><ul><li><p>The <code>weptxkey</code> indicates which WEP key will be used in the transmission. This example uses the third key as key numbering starts with <code>1</code>. This parameter must be specified in order to encrypt the data.</p></li><li><p>The <code>wepkey</code> sets the selected WEP key. It should be in the format <em>index:key</em>. If the index is not given, key <code>1</code> is set. The index needs to be set when using keys other than the first key.</p></li></ul></div><div class=paragraph><p>Use <a href="https://man.freebsd.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;format=html">ifconfig(8)</a> to see the status of the <span class=filename>wlan0</span> interface:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig wlan0</span>
  wlan0: <span class=nv>flags</span><span class=o>=</span>8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
	  ether 00:11:95:c3:0d:ac
	  inet 192.168.0.1 netmask 0xffffff00 broadcast 192.168.0.255
	  media: IEEE 802.11 Wireless Ethernet autoselect mode 11g &lt;hostap&gt;
	  status: running
	  ssid freebsdap channel 4 <span class=o>(</span>2427 Mhz 11g<span class=o>)</span> bssid 00:11:95:c3:0d:ac
	  country US ecm authmode OPEN privacy ON deftxkey 3 wepkey 3:40-bit
	  txpower 21.5 scanvalid 60 protmode CTS wme burst dtimperiod 1 <span class=nt>-dfs</span></code></pre></div></div><div class=paragraph><p>From another wireless machine, it is now possible to initiate a scan to find the AP:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig wlan0 create wlandev ath0</span>
<span class=c># ifconfig wlan0 up scan</span>
SSID            BSSID              CHAN RATE  S:N   INT CAPS
freebsdap       00:11:95:c3:0d:ac    1   54M 22:1   100 EPS</code></pre></div></div><div class=paragraph><p>In this example, the client machine found the AP and can associate with it using the correct parameters. See <a href=#network-wireless-wep>WEP</a> for more details.</p></div></div></div><div class=sect3><h4 id=_using_both_wired_and_wireless_connections>31.3.7. Using Both Wired and Wireless Connections<a class=anchor href=#_using_both_wired_and_wireless_connections></a></h4><div class=paragraph><p>A wired connection provides better performance and reliability, while a wireless connection provides flexibility and mobility. Laptop users typically want to roam seamlessly between the two types of connections.</p></div><div class=paragraph><p>On FreeBSD, it is possible to combine two or even more network interfaces together in a "failover" fashion. This type of configuration uses the most preferred and available connection from a group of network interfaces, and the operating system switches automatically when the link state changes.</p></div><div class=paragraph><p>Link aggregation and failover is covered in <a href=#network-aggregation>Link Aggregation and Failover</a> and an example for using both wired and wireless connections is provided at <a href=#networking-lagg-wired-and-wireless>Failover Mode Between Ethernet and Wireless Interfaces</a>.</p></div></div><div class=sect3><h4 id=_troubleshooting_5>31.3.8. Troubleshooting<a class=anchor href=#_troubleshooting_5></a></h4><div class=paragraph><p>This section describes a number of steps to help troubleshoot common wireless networking problems.</p></div><div class=ulist><ul><li><p>If the access point is not listed when scanning, check that the configuration has not limited the wireless device to a limited set of channels.</p></li><li><p>If the device cannot associate with an access point, verify that the configuration matches the settings on the access point. This includes the authentication scheme and any security protocols. Simplify the configuration as much as possible. If using a security protocol such as WPA or WEP, configure the access point for open authentication and no security to see if traffic will pass.</p><div class=paragraph><p>Debugging support is provided by <a href="https://man.freebsd.org/cgi/man.cgi?query=wpa_supplicant&amp;sektion=8&amp;format=html">wpa_supplicant(8)</a>. Try running this utility manually with <code>-dd</code> and look at the system logs.</p></div></li><li><p>Once the system can associate with the access point, diagnose the network configuration using tools like <a href="https://man.freebsd.org/cgi/man.cgi?query=ping&amp;sektion=8&amp;format=html">ping(8)</a>.</p></li><li><p>There are many lower-level debugging tools. Debugging messages can be enabled in the 802.11 protocol support layer using <a href="https://man.freebsd.org/cgi/man.cgi?query=wlandebug&amp;sektion=8&amp;format=html">wlandebug(8)</a>. For example, to enable console messages related to scanning for access points and the 802.11 protocol handshakes required to arrange communication:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># wlandebug -i wlan0 +scan+auth+debug+assoc</span>
  net.wlan.0.debug: 0 <span class=o>=&gt;</span> 0xc80000&lt;assoc,auth,scan&gt;</code></pre></div></div><div class=paragraph><p>Many useful statistics are maintained by the 802.11 layer and <code>wlanstats</code>, found in <span class=filename>/usr/src/tools/tools/net80211</span>, will dump this information. These statistics should display all errors identified by the 802.11 layer. However, some errors are identified in the device drivers that lie below the 802.11 layer so they may not show up. To diagnose device-specific problems, refer to the drivers' documentation.</p></div></li></ul></div><div class=paragraph><p>If the above information does not help to clarify the problem, submit a problem report and include output from the above tools.</p></div></div></div><div class=sect2><h3 id=network-usb-tethering>31.4. USB Tethering<a class=anchor href=#network-usb-tethering></a></h3><div class=paragraph><p>Many cellphones provide the option to share their data connection over USB (often called "tethering"). This feature uses one of RNDIS, CDC, or a custom Apple® iPhone®/iPad® protocol.</p></div><div class=ulist><ul><li><p>Android™ devices generally use the <a href="https://man.freebsd.org/cgi/man.cgi?query=urndis&amp;sektion=4&amp;format=html">urndis(4)</a> driver.</p></li><li><p>Apple® devices use the <a href="https://man.freebsd.org/cgi/man.cgi?query=ipheth&amp;sektion=4&amp;format=html">ipheth(4)</a> driver.</p></li><li><p>Older devices will often use the <a href="https://man.freebsd.org/cgi/man.cgi?query=cdce&amp;sektion=4&amp;format=html">cdce(4)</a> driver.</p></li></ul></div><div class=paragraph><p>Before attaching a device, load the appropriate driver into the kernel:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># kldload if_urndis</span>
<span class=c># kldload if_cdce</span>
<span class=c># kldload if_ipheth</span></code></pre></div></div><div class=paragraph><p>Once the device is attached <code>ue</code><em>0</em> will be available for use like a normal network device. Be sure that the "USB tethering" option is enabled on the device.</p></div><div class=paragraph><p>To make this change permanent and load the driver as a module at boot time, place the appropriate line of the following in <span class=filename>/boot/loader.conf</span>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=nv>if_urndis_load</span><span class=o>=</span><span class=s2>&#34;YES&#34;</span>
<span class=nv>if_cdce_load</span><span class=o>=</span><span class=s2>&#34;YES&#34;</span>
<span class=nv>if_ipheth_load</span><span class=o>=</span><span class=s2>&#34;YES&#34;</span></code></pre></div></div></div><div class=sect2><h3 id=network-bluetooth>31.5. Bluetooth<a class=anchor href=#network-bluetooth></a></h3><div class=paragraph><p>Bluetooth is a wireless technology for creating personal networks operating in the 2.4 GHz unlicensed band, with a range of 10 meters. Networks are usually formed ad-hoc from portable devices such as cellular phones, handhelds, and laptops. Unlike Wi-Fi wireless technology, Bluetooth offers higher level service profiles, such as FTP-like file servers, file pushing, voice transport, serial line emulation, and more.</p></div><div class=paragraph><p>This section describes the use of a USB Bluetooth dongle on a FreeBSD system. It then describes the various Bluetooth protocols and utilities.</p></div><div class=sect3><h4 id=_loading_bluetooth_support>31.5.1. Loading Bluetooth Support<a class=anchor href=#_loading_bluetooth_support></a></h4><div class=paragraph><p>The Bluetooth stack in FreeBSD is implemented using the <a href="https://man.freebsd.org/cgi/man.cgi?query=netgraph&amp;sektion=4&amp;format=html">netgraph(4)</a> framework. A broad variety of Bluetooth USB dongles is supported by <a href="https://man.freebsd.org/cgi/man.cgi?query=ng_ubt&amp;sektion=4&amp;format=html">ng_ubt(4)</a>. Broadcom BCM2033 based Bluetooth devices are supported by the <a href="https://man.freebsd.org/cgi/man.cgi?query=ubtbcmfw&amp;sektion=4&amp;format=html">ubtbcmfw(4)</a> and <a href="https://man.freebsd.org/cgi/man.cgi?query=ng_ubt&amp;sektion=4&amp;format=html">ng_ubt(4)</a> drivers. The 3Com Bluetooth PC Card 3CRWB60-A is supported by the <a href="https://man.freebsd.org/cgi/man.cgi?query=ng_bt3c&amp;sektion=4&amp;format=html">ng_bt3c(4)</a> driver. Serial and UART based Bluetooth devices are supported by <a href="https://man.freebsd.org/cgi/man.cgi?query=sio&amp;sektion=4&amp;format=html">sio(4)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=ng_h4&amp;sektion=4&amp;format=html">ng_h4(4)</a>, and <a href="https://man.freebsd.org/cgi/man.cgi?query=hcseriald&amp;sektion=8&amp;format=html">hcseriald(8)</a>.</p></div><div class=paragraph><p>Before attaching a device, determine which of the above drivers it uses, then load the driver. For example, if the device uses the <a href="https://man.freebsd.org/cgi/man.cgi?query=ng_ubt&amp;sektion=4&amp;format=html">ng_ubt(4)</a> driver:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># kldload ng_ubt</span></code></pre></div></div><div class=paragraph><p>If the Bluetooth device will be attached to the system during system startup, the system can be configured to load the module at boot time by adding the driver to <span class=filename>/boot/loader.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>ng_ubt_load=&#34;YES&#34;</pre></div></div><div class=paragraph><p>Once the driver is loaded, plug in the USB dongle. If the driver load was successful, output similar to the following should appear on the console and in <span class=filename>/var/log/messages</span>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>ubt0: vendor 0x0a12 product 0x0001, rev 1.10/5.25, addr 2
ubt0: Interface 0 endpoints: <span class=nv>interrupt</span><span class=o>=</span>0x81, bulk-in<span class=o>=</span>0x82, bulk-out<span class=o>=</span>0x2
ubt0: Interface 1 <span class=o>(</span>alt.config 5<span class=o>)</span> endpoints: isoc-in<span class=o>=</span>0x83, isoc-out<span class=o>=</span>0x3,
      <span class=nv>wMaxPacketSize</span><span class=o>=</span>49, <span class=nv>nframes</span><span class=o>=</span>6, buffer <span class=nv>size</span><span class=o>=</span>294</code></pre></div></div><div class=paragraph><p>To start and stop the Bluetooth stack, use its startup script. It is a good idea to stop the stack before unplugging the device. Starting the bluetooth stack might require <a href="https://man.freebsd.org/cgi/man.cgi?query=hcsecd&amp;sektion=8&amp;format=html">hcsecd(8)</a> to be started. When starting the stack, the output should be similar to the following:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service bluetooth start ubt0</span>
BD_ADDR: 00:02:72:00:d4:1a
Features: 0xff 0xff 0xf 00 00 00 00 00
&lt;3-Slot&gt; &lt;5-Slot&gt; &lt;Encryption&gt; &lt;Slot offset&gt;
&lt;Timing accuracy&gt; &lt;Switch&gt; &lt;Hold mode&gt; &lt;Sniff mode&gt;
&lt;Park mode&gt; &lt;RSSI&gt; &lt;Channel quality&gt; &lt;SCO <span class=nb>link</span><span class=o>&gt;</span>
&lt;HV2 packets&gt; &lt;HV3 packets&gt; &lt;u-law log&gt; &lt;A-law log&gt; &lt;CVSD&gt;
&lt;Paging scheme&gt; &lt;Power control&gt; &lt;Transparent SCO data&gt;
Max. ACL packet size: 192 bytes
Number of ACL packets: 8
Max. SCO packet size: 64 bytes
Number of SCO packets: 8</code></pre></div></div></div><div class=sect3><h4 id=_finding_other_bluetooth_devices>31.5.2. Finding Other Bluetooth Devices<a class=anchor href=#_finding_other_bluetooth_devices></a></h4><div class=paragraph><p>The Host Controller Interface (HCI) provides a uniform method for accessing Bluetooth baseband capabilities. In FreeBSD, a netgraph HCI node is created for each Bluetooth device. For more details, refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=ng_hci&amp;sektion=4&amp;format=html">ng_hci(4)</a>.</p></div><div class=paragraph><p>One of the most common tasks is discovery of Bluetooth devices within RF proximity. This operation is called <em>inquiry</em>. Inquiry and other HCI related operations are done using <a href="https://man.freebsd.org/cgi/man.cgi?query=hccontrol&amp;sektion=8&amp;format=html">hccontrol(8)</a>. The example below shows how to find out which Bluetooth devices are in range. The list of devices should be displayed in a few seconds. Note that a remote device will only answer the inquiry if it is set to <em>discoverable</em> mode.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% hccontrol <span class=nt>-n</span> ubt0hci inquiry
Inquiry result, <span class=nv>num_responses</span><span class=o>=</span>1
Inquiry result <span class=c>#0</span>
       BD_ADDR: 00:80:37:29:19:a4
       Page Scan Rep. Mode: 0x1
       Page Scan Period Mode: 00
       Page Scan Mode: 00
       Class: 52:02:04
       Clock offset: 0x78ef
Inquiry complete. Status: No error <span class=o>[</span>00]</code></pre></div></div><div class=paragraph><p>The <code>BD_ADDR</code> is the unique address of a Bluetooth device, similar to the MAC address of a network card. This address is needed for further communication with a device and it is possible to assign a human readable name to a <code>BD_ADDR</code>. Information regarding the known Bluetooth hosts is contained in <span class=filename>/etc/bluetooth/hosts</span>. The following example shows how to obtain the human readable name that was assigned to the remote device:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% hccontrol <span class=nt>-n</span> ubt0hci remote_name_request 00:80:37:29:19:a4
BD_ADDR: 00:80:37:29:19:a4
Name: Pav<span class=s1>&#39;s T39</span></code></pre></div></div><div class=paragraph><p>If an inquiry is performed on a remote Bluetooth device, it will find the computer as "your.host.name (ubt0)". The name assigned to the local device can be changed at any time.</p></div><div class=paragraph><p>Remote devices can be assigned aliases in <span class=filename>/etc/bluetooth/hosts</span>. More information about <span class=filename>/etc/bluetooth/hosts</span> file might be found in <a href="https://man.freebsd.org/cgi/man.cgi?query=bluetooth.hosts&amp;sektion=5&amp;format=html">bluetooth.hosts(5)</a>.</p></div><div class=paragraph><p>The Bluetooth system provides a point-to-point connection between two Bluetooth units, or a point-to-multipoint connection which is shared among several Bluetooth devices. The following example shows how to create a connection to a remote device:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% hccontrol <span class=nt>-n</span> ubt0hci create_connection BT_ADDR</code></pre></div></div><div class=paragraph><p><code>create_connection</code> accepts <code>BT_ADDR</code> as well as host aliases in <span class=filename>/etc/bluetooth/hosts</span>.</p></div><div class=paragraph><p>The following example shows how to obtain the list of active baseband connections for the local device:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% hccontrol <span class=nt>-n</span> ubt0hci read_connection_list
Remote BD_ADDR    Handle Type Mode Role Encrypt Pending Queue State
00:80:37:29:19:a4     41  ACL    0 MAST    NONE       0     0 OPEN</code></pre></div></div><div class=paragraph><p>A <em>connection handle</em> is useful when termination of the baseband connection is required, though it is normally not required to do this by hand. The stack will automatically terminate inactive baseband connections.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># hccontrol -n ubt0hci disconnect 41</span>
Connection handle: 41
Reason: Connection terminated by <span class=nb>local </span>host <span class=o>[</span>0x16]</code></pre></div></div><div class=paragraph><p>Type <code>hccontrol help</code> for a complete listing of available HCI commands. Most of the HCI commands do not require superuser privileges.</p></div></div><div class=sect3><h4 id=_device_pairing>31.5.3. Device Pairing<a class=anchor href=#_device_pairing></a></h4><div class=paragraph><p>By default, Bluetooth communication is not authenticated, and any device can talk to any other device. A Bluetooth device, such as a cellular phone, may choose to require authentication to provide a particular service. Bluetooth authentication is normally done with a <em>PIN code</em>, an ASCII string up to 16 characters in length. The user is required to enter the same PIN code on both devices. Once the user has entered the PIN code, both devices will generate a <em>link key</em>. After that, the link key can be stored either in the devices or in a persistent storage. Next time, both devices will use the previously generated link key. This procedure is called <em>pairing</em>. Note that if the link key is lost by either device, the pairing must be repeated.</p></div><div class=paragraph><p>The <a href="https://man.freebsd.org/cgi/man.cgi?query=hcsecd&amp;sektion=8&amp;format=html">hcsecd(8)</a> daemon is responsible for handling Bluetooth authentication requests. The default configuration file is <span class=filename>/etc/bluetooth/hcsecd.conf</span>. An example section for a cellular phone with the PIN code set to <code>1234</code> is shown below:</p></div><div class="literalblock programlisting"><div class=content><pre>device {
        bdaddr  00:80:37:29:19:a4;
        name    &#34;Pav&#39;s T39&#34;;
        key     nokey;
        pin     &#34;1234&#34;;
      }</pre></div></div><div class=paragraph><p>The only limitation on PIN codes is length. Some devices, such as Bluetooth headsets, may have a fixed PIN code built in. The <code>-d</code> switch forces <a href="https://man.freebsd.org/cgi/man.cgi?query=hcsecd&amp;sektion=8&amp;format=html">hcsecd(8)</a> to stay in the foreground, so it is easy to see what is happening. Set the remote device to receive pairing and initiate the Bluetooth connection to the remote device. The remote device should indicate that pairing was accepted and request the PIN code. Enter the same PIN code listed in <span class=filename>hcsecd.conf</span>. Now the computer and the remote device are paired. Alternatively, pairing can be initiated on the remote device.</p></div><div class=paragraph><p>The following line can be added to <span class=filename>/etc/rc.conf</span> to configure <a href="https://man.freebsd.org/cgi/man.cgi?query=hcsecd&amp;sektion=8&amp;format=html">hcsecd(8)</a> to start automatically on system start:</p></div><div class="literalblock programlisting"><div class=content><pre>hcsecd_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>The following is a sample of the <a href="https://man.freebsd.org/cgi/man.cgi?query=hcsecd&amp;sektion=8&amp;format=html">hcsecd(8)</a> daemon output:</p></div><div class="literalblock programlisting"><div class=content><pre>hcsecd[16484]: Got Link_Key_Request event from &#39;ubt0hci&#39;, remote bdaddr 0:80:37:29:19:a4
hcsecd[16484]: Found matching entry, remote bdaddr 0:80:37:29:19:a4, name &#39;Pav&#39;s T39&#39;, link key doesn&#39;t exist
hcsecd[16484]: Sending Link_Key_Negative_Reply to &#39;ubt0hci&#39; for remote bdaddr 0:80:37:29:19:a4
hcsecd[16484]: Got PIN_Code_Request event from &#39;ubt0hci&#39;, remote bdaddr 0:80:37:29:19:a4
hcsecd[16484]: Found matching entry, remote bdaddr 0:80:37:29:19:a4, name &#39;Pav&#39;s T39&#39;, PIN code exists
hcsecd[16484]: Sending PIN_Code_Reply to &#39;ubt0hci&#39; for remote bdaddr 0:80:37:29:19:a4</pre></div></div></div><div class=sect3><h4 id=_network_access_with_ppp_profiles>31.5.4. Network Access with PPP Profiles<a class=anchor href=#_network_access_with_ppp_profiles></a></h4><div class=paragraph><p>A Dial-Up Networking (DUN) profile can be used to configure a cellular phone as a wireless modem for connecting to a dial-up Internet access server. It can also be used to configure a computer to receive data calls from a cellular phone.</p></div><div class=paragraph><p>Network access with a PPP profile can be used to provide LAN access for a single Bluetooth device or multiple Bluetooth devices. It can also provide PC to PC connection using PPP networking over serial cable emulation.</p></div><div class=paragraph><p>In FreeBSD, these profiles are implemented with <a href="https://man.freebsd.org/cgi/man.cgi?query=ppp&amp;sektion=8&amp;format=html">ppp(8)</a> and the <a href="https://man.freebsd.org/cgi/man.cgi?query=rfcomm_pppd&amp;sektion=8&amp;format=html">rfcomm_pppd(8)</a> wrapper which converts a Bluetooth connection into something PPP can use. Before a profile can be used, a new PPP label must be created in <span class=filename>/etc/ppp/ppp.conf</span>. Consult <a href="https://man.freebsd.org/cgi/man.cgi?query=rfcomm_pppd&amp;sektion=8&amp;format=html">rfcomm_pppd(8)</a> for examples.</p></div><div class=paragraph><p>In this example, <a href="https://man.freebsd.org/cgi/man.cgi?query=rfcomm_pppd&amp;sektion=8&amp;format=html">rfcomm_pppd(8)</a> is used to open a connection to a remote device with a <code>BD_ADDR</code> of <code>00:80:37:29:19:a4</code> on a DUNRFCOMM channel:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># rfcomm_pppd -a 00:80:37:29:19:a4 -c -C dun -l rfcomm-dialup</span></code></pre></div></div><div class=paragraph><p>The actual channel number will be obtained from the remote device using the SDP protocol. It is possible to specify the RFCOMM channel by hand, and in this case <a href="https://man.freebsd.org/cgi/man.cgi?query=rfcomm_pppd&amp;sektion=8&amp;format=html">rfcomm_pppd(8)</a> will not perform the SDP query. Use <a href="https://man.freebsd.org/cgi/man.cgi?query=sdpcontrol&amp;sektion=8&amp;format=html">sdpcontrol(8)</a> to find out the RFCOMM channel on the remote device.</p></div><div class=paragraph><p>In order to provide network access with the PPPLAN service, <a href="https://man.freebsd.org/cgi/man.cgi?query=sdpd&amp;sektion=8&amp;format=html">sdpd(8)</a> must be running and a new entry for LAN clients must be created in <span class=filename>/etc/ppp/ppp.conf</span>. Consult <a href="https://man.freebsd.org/cgi/man.cgi?query=rfcomm_pppd&amp;sektion=8&amp;format=html">rfcomm_pppd(8)</a> for examples. Finally, start the RFCOMMPPP server on a valid RFCOMM channel number. The RFCOMMPPP server will automatically register the Bluetooth LAN service with the local SDP daemon. The example below shows how to start the RFCOMMPPP server.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># rfcomm_pppd -s -C 7 -l rfcomm-server</span></code></pre></div></div></div><div class=sect3><h4 id=_bluetooth_protocols>31.5.5. Bluetooth Protocols<a class=anchor href=#_bluetooth_protocols></a></h4><div class=paragraph><p>This section provides an overview of the various Bluetooth protocols, their function, and associated utilities.</p></div><div class=sect4><h5 id=_logical_link_control_and_adaptation_protocol_l2cap>31.5.5.1. Logical Link Control and Adaptation Protocol (L2CAP)<a class=anchor href=#_logical_link_control_and_adaptation_protocol_l2cap></a></h5><div class=paragraph><p>The Logical Link Control and Adaptation Protocol (L2CAP) provides connection-oriented and connectionless data services to upper layer protocols. L2CAP permits higher level protocols and applications to transmit and receive L2CAP data packets up to 64 kilobytes in length.</p></div><div class=paragraph><p>L2CAP is based around the concept of <em>channels</em>. A channel is a logical connection on top of a baseband connection, where each channel is bound to a single protocol in a many-to-one fashion. Multiple channels can be bound to the same protocol, but a channel cannot be bound to multiple protocols. Each L2CAP packet received on a channel is directed to the appropriate higher level protocol. Multiple channels can share the same baseband connection.</p></div><div class=paragraph><p>In FreeBSD, a netgraph L2CAP node is created for each Bluetooth device. This node is normally connected to the downstream Bluetooth HCI node and upstream Bluetooth socket nodes. The default name for the L2CAP node is "devicel2cap". For more details refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=ng_l2cap&amp;sektion=4&amp;format=html">ng_l2cap(4)</a>.</p></div><div class=paragraph><p>A useful command is <a href="https://man.freebsd.org/cgi/man.cgi?query=l2ping&amp;sektion=8&amp;format=html">l2ping(8)</a>, which can be used to ping other devices. Some Bluetooth implementations might not return all of the data sent to them, so <code>0 bytes</code> in the following example is normal.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># l2ping -a 00:80:37:29:19:a4</span>
0 bytes from 0:80:37:29:19:a4 <span class=nv>seq_no</span><span class=o>=</span>0 <span class=nb>time</span><span class=o>=</span>48.633 ms <span class=nv>result</span><span class=o>=</span>0
0 bytes from 0:80:37:29:19:a4 <span class=nv>seq_no</span><span class=o>=</span>1 <span class=nb>time</span><span class=o>=</span>37.551 ms <span class=nv>result</span><span class=o>=</span>0
0 bytes from 0:80:37:29:19:a4 <span class=nv>seq_no</span><span class=o>=</span>2 <span class=nb>time</span><span class=o>=</span>28.324 ms <span class=nv>result</span><span class=o>=</span>0
0 bytes from 0:80:37:29:19:a4 <span class=nv>seq_no</span><span class=o>=</span>3 <span class=nb>time</span><span class=o>=</span>46.150 ms <span class=nv>result</span><span class=o>=</span>0</code></pre></div></div><div class=paragraph><p>The <a href="https://man.freebsd.org/cgi/man.cgi?query=l2control&amp;sektion=8&amp;format=html">l2control(8)</a> utility is used to perform various operations on L2CAP nodes. This example shows how to obtain the list of logical connections (channels) and the list of baseband connections for the local device:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% l2control <span class=nt>-a</span> 00:02:72:00:d4:1a read_channel_list
L2CAP channels:
Remote BD_ADDR     SCID/ DCID   PSM  IMTU/ OMTU State
00:07:e0:00:0b:ca    66/   64     3   132/  672 OPEN
% l2control <span class=nt>-a</span> 00:02:72:00:d4:1a read_connection_list
L2CAP connections:
Remote BD_ADDR    Handle Flags Pending State
00:07:e0:00:0b:ca     41 O           0 OPEN</code></pre></div></div><div class=paragraph><p>Another diagnostic tool is <a href="https://man.freebsd.org/cgi/man.cgi?query=btsockstat&amp;sektion=1&amp;format=html">btsockstat(1)</a>. It is similar to <a href="https://man.freebsd.org/cgi/man.cgi?query=netstat&amp;sektion=1&amp;format=html">netstat(1)</a>, but for Bluetooth network-related data structures. The example below shows the same logical connection as <a href="https://man.freebsd.org/cgi/man.cgi?query=l2control&amp;sektion=8&amp;format=html">l2control(8)</a> above.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% btsockstat
Active L2CAP sockets
PCB      Recv-Q Send-Q Local address/PSM       Foreign address   CID   State
c2afe900      0      0 00:02:72:00:d4:1a/3     00:07:e0:00:0b:ca 66    OPEN
Active RFCOMM sessions
L2PCB    PCB      Flag MTU   Out-Q DLCs State
c2afe900 c2b53380 1    127   0     Yes  OPEN
Active RFCOMM sockets
PCB      Recv-Q Send-Q Local address     Foreign address   Chan DLCI State
c2e8bc80      0    250 00:02:72:00:d4:1a 00:07:e0:00:0b:ca 3    6    OPEN</code></pre></div></div></div><div class=sect4><h5 id=_radio_frequency_communication_rfcomm>31.5.5.2. Radio Frequency Communication (RFCOMM)<a class=anchor href=#_radio_frequency_communication_rfcomm></a></h5><div class=paragraph><p>The RFCOMM protocol provides emulation of serial ports over the L2CAP protocol. RFCOMM is a simple transport protocol, with additional provisions for emulating the 9 circuits of RS-232 (EIATIA-232-E) serial ports. It supports up to 60 simultaneous connections (RFCOMM channels) between two Bluetooth devices.</p></div><div class=paragraph><p>For the purposes of RFCOMM, a complete communication path involves two applications running on the communication endpoints with a communication segment between them. RFCOMM is intended to cover applications that make use of the serial ports of the devices in which they reside. The communication segment is a direct connect Bluetooth link from one device to another.</p></div><div class=paragraph><p>RFCOMM is only concerned with the connection between the devices in the direct connect case, or between the device and a modem in the network case. RFCOMM can support other configurations, such as modules that communicate via Bluetooth wireless technology on one side and provide a wired interface on the other side.</p></div><div class=paragraph><p>In FreeBSD, RFCOMM is implemented at the Bluetooth sockets layer.</p></div></div><div class=sect4><h5 id=_service_discovery_protocol_sdp>31.5.5.3. Service Discovery Protocol (SDP)<a class=anchor href=#_service_discovery_protocol_sdp></a></h5><div class=paragraph><p>The Service Discovery Protocol (SDP) provides the means for client applications to discover the existence of services provided by server applications as well as the attributes of those services. The attributes of a service include the type or class of service offered and the mechanism or protocol information needed to utilize the service.</p></div><div class=paragraph><p>SDP involves communication between a SDP server and a SDP client. The server maintains a list of service records that describe the characteristics of services associated with the server. Each service record contains information about a single service. A client may retrieve information from a service record maintained by the SDP server by issuing a SDP request. If the client, or an application associated with the client, decides to use a service, it must open a separate connection to the service provider in order to utilize the service. SDP provides a mechanism for discovering services and their attributes, but it does not provide a mechanism for utilizing those services.</p></div><div class=paragraph><p>Normally, a SDP client searches for services based on some desired characteristics of the services. However, there are times when it is desirable to discover which types of services are described by an SDP server’s service records without any prior information about the services. This process of looking for any offered services is called <em>browsing</em>.</p></div><div class=paragraph><p>The Bluetooth SDP server, <a href="https://man.freebsd.org/cgi/man.cgi?query=sdpd&amp;sektion=8&amp;format=html">sdpd(8)</a>, and command line client, <a href="https://man.freebsd.org/cgi/man.cgi?query=sdpcontrol&amp;sektion=8&amp;format=html">sdpcontrol(8)</a>, are included in the standard FreeBSD installation. The following example shows how to perform a SDP browse query.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% sdpcontrol <span class=nt>-a</span> 00:01:03:fc:6e:ec browse
Record Handle: 00000000
Service Class ID List:
        Service Discovery Server <span class=o>(</span>0x1000<span class=o>)</span>
Protocol Descriptor List:
        L2CAP <span class=o>(</span>0x0100<span class=o>)</span>
                Protocol specific parameter <span class=c>#1: u/int/uuid16 1</span>
                Protocol specific parameter <span class=c>#2: u/int/uuid16 1</span>

Record Handle: 0x00000001
Service Class ID List:
        Browse Group Descriptor <span class=o>(</span>0x1001<span class=o>)</span>

Record Handle: 0x00000002
Service Class ID List:
        LAN Access Using PPP <span class=o>(</span>0x1102<span class=o>)</span>
Protocol Descriptor List:
        L2CAP <span class=o>(</span>0x0100<span class=o>)</span>
        RFCOMM <span class=o>(</span>0x0003<span class=o>)</span>
                Protocol specific parameter <span class=c>#1: u/int8/bool 1</span>
Bluetooth Profile Descriptor List:
        LAN Access Using PPP <span class=o>(</span>0x1102<span class=o>)</span> ver. 1.0</code></pre></div></div><div class=paragraph><p>Note that each service has a list of attributes, such as the RFCOMM channel. Depending on the service, the user might need to make note of some of the attributes. Some Bluetooth implementations do not support service browsing and may return an empty list. In this case, it is possible to search for the specific service. The example below shows how to search for the OBEX Object Push (OPUSH) service:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% sdpcontrol <span class=nt>-a</span> 00:01:03:fc:6e:ec search OPUSH</code></pre></div></div><div class=paragraph><p>Offering services on FreeBSD to Bluetooth clients is done with the <a href="https://man.freebsd.org/cgi/man.cgi?query=sdpd&amp;sektion=8&amp;format=html">sdpd(8)</a> server. The following line can be added to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>sdpd_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>Then the <a href="https://man.freebsd.org/cgi/man.cgi?query=sdpd&amp;sektion=8&amp;format=html">sdpd(8)</a> daemon can be started with:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service sdpd start</span></code></pre></div></div><div class=paragraph><p>The local server application that wants to provide a Bluetooth service to remote clients will register the service with the local SDP daemon. An example of such an application is <a href="https://man.freebsd.org/cgi/man.cgi?query=rfcomm_pppd&amp;sektion=8&amp;format=html">rfcomm_pppd(8)</a>. Once started, it will register the Bluetooth LAN service with the local SDP daemon.</p></div><div class=paragraph><p>The list of services registered with the local SDP server can be obtained by issuing a SDP browse query via the local control channel:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sdpcontrol -l browse</span></code></pre></div></div></div><div class=sect4><h5 id=_obex_object_push_opush>31.5.5.4. OBEX Object Push (OPUSH)<a class=anchor href=#_obex_object_push_opush></a></h5><div class=paragraph><p>Object Exchange (OBEX) is a widely used protocol for simple file transfers between mobile devices. Its main use is in infrared communication, where it is used for generic file transfers between notebooks or PDAs, and for sending business cards or calendar entries between cellular phones and other devices with Personal Information Manager (PIM) applications.</p></div><div class=paragraph><p>The OBEX server and client are implemented by obexapp, which can be installed using the <a class=package href=https://cgit.freebsd.org/ports/tree/comms/obexapp/>comms/obexapp</a> package or port.</p></div><div class=paragraph><p>The OBEX client is used to push and/or pull objects from the OBEX server. An example object is a business card or an appointment. The OBEX client can obtain the RFCOMM channel number from the remote device via SDP. This can be done by specifying the service name instead of the RFCOMM channel number. Supported service names are: <code>IrMC</code>, <code>FTRN</code>, and <code>OPUSH</code>. It is also possible to specify the RFCOMM channel as a number. Below is an example of an OBEX session where the device information object is pulled from the cellular phone, and a new object, the business card, is pushed into the phone’s directory.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% obexapp <span class=nt>-a</span> 00:80:37:29:19:a4 <span class=nt>-C</span> IrMC
obex&gt; get telecom/devinfo.txt devinfo-t39.txt
Success, response: OK, Success <span class=o>(</span>0x20<span class=o>)</span>
obex&gt; put new.vcf
Success, response: OK, Success <span class=o>(</span>0x20<span class=o>)</span>
obex&gt; di
Success, response: OK, Success <span class=o>(</span>0x20<span class=o>)</span></code></pre></div></div><div class=paragraph><p>In order to provide the OPUSH service, <a href="https://man.freebsd.org/cgi/man.cgi?query=sdpd&amp;sektion=8&amp;format=html">sdpd(8)</a> must be running and a root folder, where all incoming objects will be stored, must be created. The default path to the root folder is <span class=filename>/var/spool/obex</span>. Finally, start the OBEX server on a valid RFCOMM channel number. The OBEX server will automatically register the OPUSH service with the local SDP daemon. The example below shows how to start the OBEX server.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># obexapp -s -C 10</span></code></pre></div></div></div><div class=sect4><h5 id=_serial_port_profile_spp>31.5.5.5. Serial Port Profile (SPP)<a class=anchor href=#_serial_port_profile_spp></a></h5><div class=paragraph><p>The Serial Port Profile (SPP) allows Bluetooth devices to perform serial cable emulation. This profile allows legacy applications to use Bluetooth as a cable replacement, through a virtual serial port abstraction.</p></div><div class=paragraph><p>In FreeBSD, <a href="https://man.freebsd.org/cgi/man.cgi?query=rfcomm_sppd&amp;sektion=1&amp;format=html">rfcomm_sppd(1)</a> implements SPP and a pseudo tty is used as a virtual serial port abstraction. The example below shows how to connect to a remote device’s serial port service. A RFCOMM channel does not have to be specified as <a href="https://man.freebsd.org/cgi/man.cgi?query=rfcomm_sppd&amp;sektion=1&amp;format=html">rfcomm_sppd(1)</a> can obtain it from the remote device via SDP. To override this, specify a RFCOMM channel on the command line.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># rfcomm_sppd -a 00:07:E0:00:0B:CA -t</span>
rfcomm_sppd[94692]: Starting on /dev/pts/6...
/dev/pts/6</code></pre></div></div><div class=paragraph><p>Once connected, the pseudo tty can be used as serial port:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cu -l /dev/pts/6</span></code></pre></div></div><div class=paragraph><p>The pseudo tty is printed on stdout and can be read by wrapper scripts:</p></div><div class="literalblock programlisting"><div class=content><pre>PTS=`rfcomm_sppd -a 00:07:E0:00:0B:CA -t`
cu -l $PTS</pre></div></div></div></div><div class=sect3><h4 id=_troubleshooting_6>31.5.6. Troubleshooting<a class=anchor href=#_troubleshooting_6></a></h4><div class=paragraph><p>By default, when FreeBSD is accepting a new connection, it tries to perform a role switch and become master. Some older Bluetooth devices which do not support role switching will not be able to connect. Since role switching is performed when a new connection is being established, it is not possible to ask the remote device if it supports role switching. However, there is a HCI option to disable role switching on the local side:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># hccontrol -n ubt0hci write_node_role_switch 0</span></code></pre></div></div><div class=paragraph><p>To display Bluetooth packets, use the third-party package hcidump, which can be installed using the <a class=package href=https://cgit.freebsd.org/ports/tree/comms/hcidump/>comms/hcidump</a> package or port. This utility is similar to <a href="https://man.freebsd.org/cgi/man.cgi?query=tcpdump&amp;sektion=1&amp;format=html">tcpdump(1)</a> and can be used to display the contents of Bluetooth packets on the terminal and to dump the Bluetooth packets to a file.</p></div></div></div><div class=sect2><h3 id=network-bridging>31.6. Bridging<a class=anchor href=#network-bridging></a></h3><div class=paragraph><p>It is sometimes useful to divide a network, such as an Ethernet segment, into network segments without having to create IP subnets and use a router to connect the segments together. A device that connects two networks together in this fashion is called a "bridge".</p></div><div class=paragraph><p>A bridge works by learning the MAC addresses of the devices on each of its network interfaces. It forwards traffic between networks only when the source and destination MAC addresses are on different networks. In many respects, a bridge is like an Ethernet switch with very few ports. A FreeBSD system with multiple network interfaces can be configured to act as a bridge.</p></div><div class=paragraph><p>Bridging can be useful in the following situations:</p></div><div class=dlist><dl><dt class=hdlist1>Connecting Networks</dt><dd><p>The basic operation of a bridge is to join two or more network segments. There are many reasons to use a host-based bridge instead of networking equipment, such as cabling constraints or firewalling. A bridge can also connect a wireless interface running in hostap mode to a wired network and act as an access point.</p></dd><dt class=hdlist1>Filtering/Traffic Shaping Firewall</dt><dd><p>A bridge can be used when firewall functionality is needed without routing or Network Address Translation (NAT).</p><div class=paragraph><p>An example is a small company that is connected via DSL or ISDN to an ISP. There are thirteen public IP addresses from the ISP and ten computers on the network. In this situation, using a router-based firewall is difficult because of subnetting issues. A bridge-based firewall can be configured without any IP addressing issues.</p></div></dd><dt class=hdlist1>Network Tap</dt><dd><p>A bridge can join two network segments in order to inspect all Ethernet frames that pass between them using <a href="https://man.freebsd.org/cgi/man.cgi?query=bpf&amp;sektion=4&amp;format=html">bpf(4)</a> and <a href="https://man.freebsd.org/cgi/man.cgi?query=tcpdump&amp;sektion=1&amp;format=html">tcpdump(1)</a> on the bridge interface or by sending a copy of all frames out an additional interface known as a span port.</p></dd><dt class=hdlist1>Layer 2 VPN</dt><dd><p>Two Ethernet networks can be joined across an IP link by bridging the networks to an EtherIP tunnel or a <a href="https://man.freebsd.org/cgi/man.cgi?query=tap&amp;sektion=4&amp;format=html">tap(4)</a> based solution such as OpenVPN.</p></dd><dt class=hdlist1>Layer 2 Redundancy</dt><dd><p>A network can be connected together with multiple links and use the Spanning Tree Protocol (STP) to block redundant paths.</p></dd></dl></div><div class=paragraph><p>This section describes how to configure a FreeBSD system as a bridge using <a href="https://man.freebsd.org/cgi/man.cgi?query=if_bridge&amp;sektion=4&amp;format=html">if_bridge(4)</a>. A netgraph bridging driver is also available, and is described in <a href="https://man.freebsd.org/cgi/man.cgi?query=ng_bridge&amp;sektion=4&amp;format=html">ng_bridge(4)</a>.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Packet filtering can be used with any firewall package that hooks into the <a href="https://man.freebsd.org/cgi/man.cgi?query=pfil&amp;sektion=9&amp;format=html">pfil(9)</a> framework. The bridge can be used as a traffic shaper with <a href="https://man.freebsd.org/cgi/man.cgi?query=altq&amp;sektion=4&amp;format=html">altq(4)</a> or <a href="https://man.freebsd.org/cgi/man.cgi?query=dummynet&amp;sektion=4&amp;format=html">dummynet(4)</a>.</p></div></td></tr></tbody></table></div><div class=sect3><h4 id=_enabling_the_bridge>31.6.1. Enabling the Bridge<a class=anchor href=#_enabling_the_bridge></a></h4><div class=paragraph><p>In FreeBSD, <a href="https://man.freebsd.org/cgi/man.cgi?query=if_bridge&amp;sektion=4&amp;format=html">if_bridge(4)</a> is a kernel module which is automatically loaded by <a href="https://man.freebsd.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;format=html">ifconfig(8)</a> when creating a bridge interface. It is also possible to compile bridge support into a custom kernel by adding <code>device if_bridge</code> to the custom kernel configuration file.</p></div><div class=paragraph><p>The bridge is created using interface cloning. To create the bridge interface:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig bridge create</span>
bridge0
<span class=c># ifconfig bridge0</span>
bridge0: <span class=nv>flags</span><span class=o>=</span>8802&lt;BROADCAST,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
        ether 96:3d:4b:f1:79:7a
        <span class=nb>id </span>00:00:00:00:00:00 priority 32768 hellotime 2 fwddelay 15
        maxage 20 holdcnt 6 proto rstp maxaddr 100 <span class=nb>timeout </span>1200
        root <span class=nb>id </span>00:00:00:00:00:00 priority 0 ifcost 0 port 0</code></pre></div></div><div class=paragraph><p>When a bridge interface is created, it is automatically assigned a randomly generated Ethernet address. The <code>maxaddr</code> and <code>timeout</code> parameters control how many MAC addresses the bridge will keep in its forwarding table and how many seconds before each entry is removed after it is last seen. The other parameters control how STP operates.</p></div><div class=paragraph><p>Next, specify which network interfaces to add as members of the bridge. For the bridge to forward packets, all member interfaces and the bridge need to be up:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig bridge0 addm fxp0 addm fxp1 up</span>
<span class=c># ifconfig fxp0 up</span>
<span class=c># ifconfig fxp1 up</span></code></pre></div></div><div class=paragraph><p>The bridge can now forward Ethernet frames between <span class=filename>fxp0</span> and <span class=filename>fxp1</span>. Add the following lines to <span class=filename>/etc/rc.conf</span> so the bridge is created at startup:</p></div><div class="literalblock programlisting"><div class=content><pre>cloned_interfaces=&#34;bridge0&#34;
ifconfig_bridge0=&#34;addm fxp0 addm fxp1 up&#34;
ifconfig_fxp0=&#34;up&#34;
ifconfig_fxp1=&#34;up&#34;</pre></div></div><div class=paragraph><p>If the bridge host needs an IP address, set it on the bridge interface, not on the member interfaces. The address can be set statically or via DHCP. This example sets a static IP address:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig bridge0 inet 192.168.0.1/24</span></code></pre></div></div><div class=paragraph><p>It is also possible to assign an IPv6 address to a bridge interface. To make the changes permanent, add the addressing information to <span class=filename>/etc/rc.conf</span>.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>When packet filtering is enabled, bridged packets will pass through the filter inbound on the originating interface on the bridge interface, and outbound on the appropriate interfaces. Either stage can be disabled. When direction of the packet flow is important, it is best to firewall on the member interfaces rather than the bridge itself.</p></div><div class=paragraph><p>The bridge has several configurable settings for passing non-IP and IP packets, and layer2 firewalling with <a href="https://man.freebsd.org/cgi/man.cgi?query=ipfw&amp;sektion=8&amp;format=html">ipfw(8)</a>. See <a href="https://man.freebsd.org/cgi/man.cgi?query=if_bridge&amp;sektion=4&amp;format=html">if_bridge(4)</a> for more information.</p></div></td></tr></tbody></table></div></div><div class=sect3><h4 id=_enabling_spanning_tree>31.6.2. Enabling Spanning Tree<a class=anchor href=#_enabling_spanning_tree></a></h4><div class=paragraph><p>For an Ethernet network to function properly, only one active path can exist between two devices. The STP protocol detects loops and puts redundant links into a blocked state. Should one of the active links fail, STP calculates a different tree and enables one of the blocked paths to restore connectivity to all points in the network.</p></div><div class=paragraph><p>The Rapid Spanning Tree Protocol (RSTP or 802.1w) provides backwards compatibility with legacy STP. RSTP provides faster convergence and exchanges information with neighboring switches to quickly transition to forwarding mode without creating loops. FreeBSD supports RSTP and STP as operating modes, with RSTP being the default mode.</p></div><div class=paragraph><p>STP can be enabled on member interfaces using <a href="https://man.freebsd.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;format=html">ifconfig(8)</a>. For a bridge with <span class=filename>fxp0</span> and <span class=filename>fxp1</span> as the current interfaces, enable STP with:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig bridge0 stp fxp0 stp fxp1</span>
bridge0: <span class=nv>flags</span><span class=o>=</span>8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
        ether d6:cf:d5:a0:94:6d
        <span class=nb>id </span>00:01:02:4b:d4:50 priority 32768 hellotime 2 fwddelay 15
        maxage 20 holdcnt 6 proto rstp maxaddr 100 <span class=nb>timeout </span>1200
        root <span class=nb>id </span>00:01:02:4b:d4:50 priority 32768 ifcost 0 port 0
        member: fxp0 <span class=nv>flags</span><span class=o>=</span>1c7&lt;LEARNING,DISCOVER,STP,AUTOEDGE,PTP,AUTOPTP&gt;
                port 3 priority 128 path cost 200000 proto rstp
                role designated state forwarding
        member: fxp1 <span class=nv>flags</span><span class=o>=</span>1c7&lt;LEARNING,DISCOVER,STP,AUTOEDGE,PTP,AUTOPTP&gt;
                port 4 priority 128 path cost 200000 proto rstp
                role designated state forwarding</code></pre></div></div><div class=paragraph><p>This bridge has a spanning tree ID of <code>00:01:02:4b:d4:50</code> and a priority of <code>32768</code>. As the <code>root id</code> is the same, it indicates that this is the root bridge for the tree.</p></div><div class=paragraph><p>Another bridge on the network also has STP enabled:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>bridge0: <span class=nv>flags</span><span class=o>=</span>8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
        ether 96:3d:4b:f1:79:7a
        <span class=nb>id </span>00:13:d4:9a:06:7a priority 32768 hellotime 2 fwddelay 15
        maxage 20 holdcnt 6 proto rstp maxaddr 100 <span class=nb>timeout </span>1200
        root <span class=nb>id </span>00:01:02:4b:d4:50 priority 32768 ifcost 400000 port 4
        member: fxp0 <span class=nv>flags</span><span class=o>=</span>1c7&lt;LEARNING,DISCOVER,STP,AUTOEDGE,PTP,AUTOPTP&gt;
                port 4 priority 128 path cost 200000 proto rstp
                role root state forwarding
        member: fxp1 <span class=nv>flags</span><span class=o>=</span>1c7&lt;LEARNING,DISCOVER,STP,AUTOEDGE,PTP,AUTOPTP&gt;
                port 5 priority 128 path cost 200000 proto rstp
                role designated state forwarding</code></pre></div></div><div class=paragraph><p>The line <code>root id 00:01:02:4b:d4:50 priority 32768 ifcost 400000 port 4</code> shows that the root bridge is <code>00:01:02:4b:d4:50</code> and has a path cost of <code>400000</code> from this bridge. The path to the root bridge is via <code>port 4</code> which is <span class=filename>fxp0</span>.</p></div></div><div class=sect3><h4 id=_bridge_interface_parameters>31.6.3. Bridge Interface Parameters<a class=anchor href=#_bridge_interface_parameters></a></h4><div class=paragraph><p>Several <code>ifconfig</code> parameters are unique to bridge interfaces. This section summarizes some common uses for these parameters. The complete list of available parameters is described in <a href="https://man.freebsd.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;format=html">ifconfig(8)</a>.</p></div><div class=dlist><dl><dt class=hdlist1>private</dt><dd><p>A private interface does not forward any traffic to any other port that is also designated as a private interface. The traffic is blocked unconditionally so no Ethernet frames will be forwarded, including ARP packets. If traffic needs to be selectively blocked, a firewall should be used instead.</p></dd><dt class=hdlist1>span</dt><dd><p>A span port transmits a copy of every Ethernet frame received by the bridge. The number of span ports configured on a bridge is unlimited, but if an interface is designated as a span port, it cannot also be used as a regular bridge port. This is most useful for snooping a bridged network passively on another host connected to one of the span ports of the bridge. For example, to send a copy of all frames out the interface named <span class=filename>fxp4</span>:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig bridge0 span fxp4</span></code></pre></div></div></dd><dt class=hdlist1>sticky</dt><dd><p>If a bridge member interface is marked as sticky, dynamically learned address entries are treated as static entries in the forwarding cache. Sticky entries are never aged out of the cache or replaced, even if the address is seen on a different interface. This gives the benefit of static address entries without the need to pre-populate the forwarding table. Clients learned on a particular segment of the bridge cannot roam to another segment.</p><div class=paragraph><p>An example of using sticky addresses is to combine the bridge with VLANs in order to isolate customer networks without wasting IP address space. Consider that <code>CustomerA</code> is on <code>vlan100</code>, <code>CustomerB</code> is on <code>vlan101</code>, and the bridge has the address <code>192.168.0.1</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig bridge0 addm vlan100 sticky vlan100 addm vlan101 sticky vlan101</span>
<span class=c># ifconfig bridge0 inet 192.168.0.1/24</span></code></pre></div></div><div class=paragraph><p>In this example, both clients see <code>192.168.0.1</code> as their default gateway. Since the bridge cache is sticky, one host cannot spoof the MAC address of the other customer in order to intercept their traffic.</p></div><div class=paragraph><p>Any communication between the VLANs can be blocked using a firewall or, as seen in this example, private interfaces:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig bridge0 private vlan100 private vlan101</span></code></pre></div></div><div class=paragraph><p>The customers are completely isolated from each other and the full <code>/24</code> address range can be allocated without subnetting.</p></div><div class=paragraph><p>The number of unique source MAC addresses behind an interface can be limited. Once the limit is reached, packets with unknown source addresses are dropped until an existing host cache entry expires or is removed.</p></div><div class=paragraph><p>The following example sets the maximum number of Ethernet devices for <code>CustomerA</code> on <code>vlan100</code> to 10:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig bridge0 ifmaxaddr vlan100 10</span></code></pre></div></div></dd></dl></div><div class=paragraph><p>Bridge interfaces also support monitor mode, where the packets are discarded after <a href="https://man.freebsd.org/cgi/man.cgi?query=bpf&amp;sektion=4&amp;format=html">bpf(4)</a> processing and are not processed or forwarded further. This can be used to multiplex the input of two or more interfaces into a single <a href="https://man.freebsd.org/cgi/man.cgi?query=bpf&amp;sektion=4&amp;format=html">bpf(4)</a> stream. This is useful for reconstructing the traffic for network taps that transmit the RX/TX signals out through two separate interfaces. For example, to read the input from four network interfaces as one stream:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig bridge0 addm fxp0 addm fxp1 addm fxp2 addm fxp3 monitor up</span>
<span class=c># tcpdump -i bridge0</span></code></pre></div></div></div><div class=sect3><h4 id=_snmp_monitoring>31.6.4. SNMP Monitoring<a class=anchor href=#_snmp_monitoring></a></h4><div class=paragraph><p>The bridge interface and STP parameters can be monitored via <a href="https://man.freebsd.org/cgi/man.cgi?query=bsnmpd&amp;sektion=1&amp;format=html">bsnmpd(1)</a> which is included in the FreeBSD base system. The exported bridge MIBs conform to IETF standards so any SNMP client or monitoring package can be used to retrieve the data.</p></div><div class=paragraph><p>To enable monitoring on the bridge, uncomment this line in <span class=filename>/etc/snmpd.config</span> by removing the beginning <code>#</code> symbol:</p></div><div class="literalblock programlisting"><div class=content><pre>begemotSnmpdModulePath.&#34;bridge&#34; = &#34;/usr/lib/snmp_bridge.so&#34;</pre></div></div><div class=paragraph><p>Other configuration settings, such as community names and access lists, may need to be modified in this file. See <a href="https://man.freebsd.org/cgi/man.cgi?query=bsnmpd&amp;sektion=1&amp;format=html">bsnmpd(1)</a> and <a href="https://man.freebsd.org/cgi/man.cgi?query=snmp_bridge&amp;sektion=3&amp;format=html">snmp_bridge(3)</a> for more information. Once these edits are saved, add this line to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>bsnmpd_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>Then, start <a href="https://man.freebsd.org/cgi/man.cgi?query=bsnmpd&amp;sektion=1&amp;format=html">bsnmpd(1)</a>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service bsnmpd start</span></code></pre></div></div><div class=paragraph><p>The following examples use the Net-SNMP software (<a class=package href=https://cgit.freebsd.org/ports/tree/net-mgmt/net-snmp/>net-mgmt/net-snmp</a>) to query a bridge from a client system. The <a class=package href=https://cgit.freebsd.org/ports/tree/net-mgmt/bsnmptools/>net-mgmt/bsnmptools</a> port can also be used. From the SNMP client which is running Net-SNMP, add the following lines to <span class=filename>$HOME/.snmp/snmp.conf</span> in order to import the bridge MIB definitions:</p></div><div class="literalblock programlisting"><div class=content><pre>mibdirs +/usr/shared/snmp/mibs
mibs +BRIDGE-MIB:RSTP-MIB:BEGEMOT-MIB:BEGEMOT-BRIDGE-MIB</pre></div></div><div class=paragraph><p>To monitor a single bridge using the IETF BRIDGE-MIB (RFC4188):</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% snmpwalk <span class=nt>-v</span> 2c <span class=nt>-c</span> public bridge1.example.com mib-2.dot1dBridge
BRIDGE-MIB::dot1dBaseBridgeAddress.0 <span class=o>=</span> STRING: 66:fb:9b:6e:5c:44
BRIDGE-MIB::dot1dBaseNumPorts.0 <span class=o>=</span> INTEGER: 1 ports
BRIDGE-MIB::dot1dStpTimeSinceTopologyChange.0 <span class=o>=</span> Timeticks: <span class=o>(</span>189959<span class=o>)</span> 0:31:39.59 centi-seconds
BRIDGE-MIB::dot1dStpTopChanges.0 <span class=o>=</span> Counter32: 2
BRIDGE-MIB::dot1dStpDesignatedRoot.0 <span class=o>=</span> Hex-STRING: 80 00 00 01 02 4B D4 50
...
BRIDGE-MIB::dot1dStpPortState.3 <span class=o>=</span> INTEGER: forwarding<span class=o>(</span>5<span class=o>)</span>
BRIDGE-MIB::dot1dStpPortEnable.3 <span class=o>=</span> INTEGER: enabled<span class=o>(</span>1<span class=o>)</span>
BRIDGE-MIB::dot1dStpPortPathCost.3 <span class=o>=</span> INTEGER: 200000
BRIDGE-MIB::dot1dStpPortDesignatedRoot.3 <span class=o>=</span> Hex-STRING: 80 00 00 01 02 4B D4 50
BRIDGE-MIB::dot1dStpPortDesignatedCost.3 <span class=o>=</span> INTEGER: 0
BRIDGE-MIB::dot1dStpPortDesignatedBridge.3 <span class=o>=</span> Hex-STRING: 80 00 00 01 02 4B D4 50
BRIDGE-MIB::dot1dStpPortDesignatedPort.3 <span class=o>=</span> Hex-STRING: 03 80
BRIDGE-MIB::dot1dStpPortForwardTransitions.3 <span class=o>=</span> Counter32: 1
RSTP-MIB::dot1dStpVersion.0 <span class=o>=</span> INTEGER: rstp<span class=o>(</span>2<span class=o>)</span></code></pre></div></div><div class=paragraph><p>The <code>dot1dStpTopChanges.0</code> value is two, indicating that the STP bridge topology has changed twice. A topology change means that one or more links in the network have changed or failed and a new tree has been calculated. The <code>dot1dStpTimeSinceTopologyChange.0</code> value will show when this happened.</p></div><div class=paragraph><p>To monitor multiple bridge interfaces, the private BEGEMOT-BRIDGE-MIB can be used:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% snmpwalk <span class=nt>-v</span> 2c <span class=nt>-c</span> public bridge1.example.com
enterprises.fokus.begemot.begemotBridge
BEGEMOT-BRIDGE-MIB::begemotBridgeBaseName.<span class=s2>&#34;bridge0&#34;</span> <span class=o>=</span> STRING: bridge0
BEGEMOT-BRIDGE-MIB::begemotBridgeBaseName.<span class=s2>&#34;bridge2&#34;</span> <span class=o>=</span> STRING: bridge2
BEGEMOT-BRIDGE-MIB::begemotBridgeBaseAddress.<span class=s2>&#34;bridge0&#34;</span> <span class=o>=</span> STRING: e:ce:3b:5a:9e:13
BEGEMOT-BRIDGE-MIB::begemotBridgeBaseAddress.<span class=s2>&#34;bridge2&#34;</span> <span class=o>=</span> STRING: 12:5e:4d:74:d:fc
BEGEMOT-BRIDGE-MIB::begemotBridgeBaseNumPorts.<span class=s2>&#34;bridge0&#34;</span> <span class=o>=</span> INTEGER: 1
BEGEMOT-BRIDGE-MIB::begemotBridgeBaseNumPorts.<span class=s2>&#34;bridge2&#34;</span> <span class=o>=</span> INTEGER: 1
...
BEGEMOT-BRIDGE-MIB::begemotBridgeStpTimeSinceTopologyChange.<span class=s2>&#34;bridge0&#34;</span> <span class=o>=</span> Timeticks: <span class=o>(</span>116927<span class=o>)</span> 0:19:29.27 centi-seconds
BEGEMOT-BRIDGE-MIB::begemotBridgeStpTimeSinceTopologyChange.<span class=s2>&#34;bridge2&#34;</span> <span class=o>=</span> Timeticks: <span class=o>(</span>82773<span class=o>)</span> 0:13:47.73 centi-seconds
BEGEMOT-BRIDGE-MIB::begemotBridgeStpTopChanges.<span class=s2>&#34;bridge0&#34;</span> <span class=o>=</span> Counter32: 1
BEGEMOT-BRIDGE-MIB::begemotBridgeStpTopChanges.<span class=s2>&#34;bridge2&#34;</span> <span class=o>=</span> Counter32: 1
BEGEMOT-BRIDGE-MIB::begemotBridgeStpDesignatedRoot.<span class=s2>&#34;bridge0&#34;</span> <span class=o>=</span> Hex-STRING: 80 00 00 40 95 30 5E 31
BEGEMOT-BRIDGE-MIB::begemotBridgeStpDesignatedRoot.<span class=s2>&#34;bridge2&#34;</span> <span class=o>=</span> Hex-STRING: 80 00 00 50 8B B8 C6 A9</code></pre></div></div><div class=paragraph><p>To change the bridge interface being monitored via the <code>mib-2.dot1dBridge</code> subtree:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% snmpset <span class=nt>-v</span> 2c <span class=nt>-c</span> private bridge1.example.com
BEGEMOT-BRIDGE-MIB::begemotBridgeDefaultBridgeIf.0 s bridge2</code></pre></div></div></div></div><div class=sect2><h3 id=network-aggregation>31.7. Link Aggregation and Failover<a class=anchor href=#network-aggregation></a></h3><div class=paragraph><p>FreeBSD provides the <a href="https://man.freebsd.org/cgi/man.cgi?query=lagg&amp;sektion=4&amp;format=html">lagg(4)</a> interface which can be used to aggregate multiple network interfaces into one virtual interface in order to provide failover and link aggregation. Failover allows traffic to continue to flow as long as at least one aggregated network interface has an established link. Link aggregation works best on switches which support LACP, as this protocol distributes traffic bi-directionally while responding to the failure of individual links.</p></div><div class=paragraph><p>The aggregation protocols supported by the lagg interface determine which ports are used for outgoing traffic and whether or not a specific port accepts incoming traffic. The following protocols are supported by <a href="https://man.freebsd.org/cgi/man.cgi?query=lagg&amp;sektion=4&amp;format=html">lagg(4)</a>:</p></div><div class=dlist><dl><dt class=hdlist1>failover</dt><dd><p>This mode sends and receives traffic only through the master port. If the master port becomes unavailable, the next active port is used. The first interface added to the virtual interface is the master port and all subsequently added interfaces are used as failover devices. If failover to a non-master port occurs, the original port becomes master once it becomes available again.</p></dd><dt class=hdlist1>fec / loadbalance</dt><dd><p>Cisco® Fast EtherChannel® (FEC) is found on older Cisco® switches. It provides a static setup and does not negotiate aggregation with the peer or exchange frames to monitor the link. If the switch supports LACP, that should be used instead.</p></dd><dt class=hdlist1>lacp</dt><dd><p>The IEEE® 802.3ad Link Aggregation Control Protocol (LACP) negotiates a set of aggregable links with the peer into one or more Link Aggregated Groups (LAGs). Each LAG is composed of ports of the same speed, set to full-duplex operation, and traffic is balanced across the ports in the LAG with the greatest total speed. Typically, there is only one LAG which contains all the ports. In the event of changes in physical connectivity, LACP will quickly converge to a new configuration.</p><div class=paragraph><p>LACP balances outgoing traffic across the active ports based on hashed protocol header information and accepts incoming traffic from any active port. The hash includes the Ethernet source and destination address and, if available, the VLAN tag, and the IPv4 or IPv6 source and destination address.</p></div></dd><dt class=hdlist1>roundrobin</dt><dd><p>This mode distributes outgoing traffic using a round-robin scheduler through all active ports and accepts incoming traffic from any active port. Since this mode violates Ethernet frame ordering, it should be used with caution.</p></dd></dl></div><div class=sect3><h4 id=_configuration_examples>31.7.1. Configuration Examples<a class=anchor href=#_configuration_examples></a></h4><div class=paragraph><p>This section demonstrates how to configure a Cisco® switch and a FreeBSD system for LACP load balancing. It then shows how to configure two Ethernet interfaces in failover mode as well as how to configure failover mode between an Ethernet and a wireless interface.</p></div><div id=networking-lacp-aggregation-cisco class=exampleblock><div class=title>Przykład 29. LACP Aggregation with a Cisco® Switch</div><div class=content><div class=paragraph><p>This example connects two <a href="https://man.freebsd.org/cgi/man.cgi?query=fxp&amp;sektion=4&amp;format=html">fxp(4)</a> Ethernet interfaces on a FreeBSD machine to the first two Ethernet ports on a Cisco® switch as a single load balanced and fault tolerant link. More interfaces can be added to increase throughput and fault tolerance. Replace the names of the Cisco® ports, Ethernet devices, channel group number, and IP address shown in the example to match the local configuration.</p></div><div class=paragraph><p>Frame ordering is mandatory on Ethernet links and any traffic between two stations always flows over the same physical link, limiting the maximum speed to that of one interface. The transmit algorithm attempts to use as much information as it can to distinguish different traffic flows and balance the flows across the available interfaces.</p></div><div class=paragraph><p>On the Cisco® switch, add the <em>FastEthernet0/1</em> and <em>FastEthernet0/2</em> interfaces to channel group <em>1</em>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>interface FastEthernet0/1
 channel-group 1 mode active
 channel-protocol lacp
<span class=o>!</span>
interface FastEthernet0/2
 channel-group 1 mode active
 channel-protocol lacp</code></pre></div></div><div class=paragraph><p>On the FreeBSD system, create the <a href="https://man.freebsd.org/cgi/man.cgi?query=lagg&amp;sektion=4&amp;format=html">lagg(4)</a> interface using the physical interfaces <em>fxp0</em> and <em>fxp1</em> and bring the interfaces up with an IP address of <em>10.0.0.3/24</em>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig fxp0 up</span>
<span class=c># ifconfig fxp1 up</span>
<span class=c># ifconfig lagg0 create</span>
<span class=c># ifconfig lagg0 up laggproto lacp laggport fxp0 laggport fxp1 10.0.0.3/24</span></code></pre></div></div><div class=paragraph><p>Next, verify the status of the virtual interface:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig lagg0</span>
lagg0: <span class=nv>flags</span><span class=o>=</span>8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
        <span class=nv>options</span><span class=o>=</span>8&lt;VLAN_MTU&gt;
        ether 00:05:5d:71:8d:b8
        inet 10.0.0.3 netmask 0xffffff00 broadcast 10.0.0.255
        media: Ethernet autoselect
        status: active
        laggproto lacp
        laggport: fxp1 <span class=nv>flags</span><span class=o>=</span>1c&lt;ACTIVE,COLLECTING,DISTRIBUTING&gt;
        laggport: fxp0 <span class=nv>flags</span><span class=o>=</span>1c&lt;ACTIVE,COLLECTING,DISTRIBUTING&gt;</code></pre></div></div><div class=paragraph><p>Ports marked as <code>ACTIVE</code> are part of the LAG that has been negotiated with the remote switch. Traffic will be transmitted and received through these active ports. Add <code>-v</code> to the above command to view the LAG identifiers.</p></div><div class=paragraph><p>To see the port status on the Cisco® switch:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>switch# show lacp neighbor
Flags:  S - Device is requesting Slow LACPDUs
        F - Device is requesting Fast LACPDUs
        A - Device is <span class=k>in </span>Active mode       P - Device is <span class=k>in </span>Passive mode

Channel group 1 neighbors

Partner<span class=s1>&#39;s information:

                  LACP port                        Oper    Port     Port
Port      Flags   Priority  Dev ID         Age     Key     Number   State
Fa0/1     SA      32768     0005.5d71.8db8  29s    0x146   0x3      0x3D
Fa0/2     SA      32768     0005.5d71.8db8  29s    0x146   0x4      0x3D</span></code></pre></div></div><div class=paragraph><p>For more detail, type <code>show lacp neighbor detail</code>.</p></div><div class=paragraph><p>To retain this configuration across reboots, add the following entries to <span class=filename>/etc/rc.conf</span> on the FreeBSD system:</p></div><div class="literalblock programlisting"><div class=content><pre>ifconfig_fxp0=&#34;up&#34;
ifconfig_fxp1=&#34;up&#34;
cloned_interfaces=&#34;lagg0&#34;
ifconfig_lagg0=&#34;laggproto lacp laggport fxp0 laggport fxp1 10.0.0.3/24&#34;</pre></div></div></div></div><div id=networking-lagg-failover class=exampleblock><div class=title>Przykład 30. Failover Mode</div><div class=content><div class=paragraph><p>Failover mode can be used to switch over to a secondary interface if the link is lost on the master interface. To configure failover, make sure that the underlying physical interfaces are up, then create the <a href="https://man.freebsd.org/cgi/man.cgi?query=lagg&amp;sektion=4&amp;format=html">lagg(4)</a> interface. In this example, <em>fxp0</em> is the master interface, <em>fxp1</em> is the secondary interface, and the virtual interface is assigned an IP address of <em>10.0.0.15/24</em>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig fxp0 up</span>
<span class=c># ifconfig fxp1 up</span>
<span class=c># ifconfig lagg0 create</span>
<span class=c># ifconfig lagg0 up laggproto failover laggport fxp0 laggport fxp1 10.0.0.15/24</span></code></pre></div></div><div class=paragraph><p>The virtual interface should look something like this:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig lagg0</span>
lagg0: <span class=nv>flags</span><span class=o>=</span>8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
        <span class=nv>options</span><span class=o>=</span>8&lt;VLAN_MTU&gt;
        ether 00:05:5d:71:8d:b8
        inet 10.0.0.15 netmask 0xffffff00 broadcast 10.0.0.255
        media: Ethernet autoselect
        status: active
        laggproto failover
        laggport: fxp1 <span class=nv>flags</span><span class=o>=</span>0&lt;<span class=o>&gt;</span>
        laggport: fxp0 <span class=nv>flags</span><span class=o>=</span>5&lt;MASTER,ACTIVE&gt;</code></pre></div></div><div class=paragraph><p>Traffic will be transmitted and received on <em>fxp0</em>. If the link is lost on <em>fxp0</em>, <em>fxp1</em> will become the active link. If the link is restored on the master interface, it will once again become the active link.</p></div><div class=paragraph><p>To retain this configuration across reboots, add the following entries to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>ifconfig_fxp0=&#34;up&#34;
ifconfig_fxp1=&#34;up&#34;
cloned_interfaces=&#34;lagg0&#34;
ifconfig_lagg0=&#34;laggproto failover laggport fxp0 laggport fxp1 10.0.0.15/24&#34;</pre></div></div></div></div><div id=networking-lagg-wired-and-wireless class=exampleblock><div class=title>Przykład 31. Failover Mode Between Ethernet and Wireless Interfaces</div><div class=content><div class=paragraph><p>For laptop users, it is usually desirable to configure the wireless device as a secondary which is only used when the Ethernet connection is not available. With <a href="https://man.freebsd.org/cgi/man.cgi?query=lagg&amp;sektion=4&amp;format=html">lagg(4)</a>, it is possible to configure a failover which prefers the Ethernet connection for both performance and security reasons, while maintaining the ability to transfer data over the wireless connection.</p></div><div class=paragraph><p>This is achieved by overriding the Ethernet interface’s MAC address with that of the wireless interface.</p></div><div class=sidebarblock><div class=content><div class=paragraph><p>In theory, either the Ethernet or wireless MAC address can be changed to match the other. However, some popular wireless interfaces lack support for overriding the MAC address. We therefore recommend overriding the Ethernet MAC address for this purpose.</p></div></div></div><div class=sidebarblock><div class=content><div class=paragraph><p>If the driver for the wireless interface is not loaded in the <code>GENERIC</code> or custom kernel, and the computer is running FreeBSD 12.1, load the corresponding <span class=filename>.ko</span> in <span class=filename>/boot/loader.conf</span> by adding <code><strong>driver_load="YES"</strong></code> to that file and rebooting. Another, better way is to load the driver in <span class=filename>/etc/rc.conf</span> by adding it to <code>kld_list</code> (see <a href="https://man.freebsd.org/cgi/man.cgi?query=rc.conf&amp;sektion=5&amp;format=html">rc.conf(5)</a> for details) in that file and rebooting. This is needed because otherwise the driver is not loaded yet at the time the <a href="https://man.freebsd.org/cgi/man.cgi?query=lagg&amp;sektion=4&amp;format=html">lagg(4)</a> interface is set up.</p></div></div></div><div class=paragraph><p>In this example, the Ethernet interface, <em>re0</em>, is the master and the wireless interface, <em>wlan0</em>, is the failover. The <em>wlan0</em> interface was created from the <em>ath0</em> physical wireless interface, and the Ethernet interface will be configured with the MAC address of the wireless interface. First, determine the MAC address of the wireless interface:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig wlan0</span>
wlan0: <span class=nv>flags</span><span class=o>=</span>8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
	ether b8:ee:65:5b:32:59
	<span class=nb>groups</span>: wlan
	ssid Bbox-A3BD2403 channel 6 <span class=o>(</span>2437 MHz 11g ht/20<span class=o>)</span> bssid 00:37:b7:56:4b:60
	regdomain ETSI country FR indoor ecm authmode WPA2/802.11i privacy ON
	deftxkey UNDEF AES-CCM 2:128-bit txpower 30 bmiss 7 scanvalid 60
	protmode CTS ampdulimit 64k ampdudensity 8 shortgi <span class=nt>-stbctx</span> stbcrx
	<span class=nt>-ldpc</span> wme burst roaming MANUAL
	media: IEEE 802.11 Wireless Ethernet MCS mode 11ng
	status: associated
	nd6 <span class=nv>options</span><span class=o>=</span>29&lt;PERFORMNUD,IFDISABLED,AUTO_LINKLOCAL&gt;</code></pre></div></div><div class=paragraph><p>Replace <em>wlan0</em> to match the system’s wireless interface name. The <code>ether</code> line will contain the MAC address of the specified interface. Now, change the MAC address of the Ethernet interface:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig re0 ether b8:ee:65:5b:32:59</span></code></pre></div></div><div class=paragraph><p>Bring the wireless interface up (replacing <em>FR</em> with your own 2-letter country code), but do not set an IP address:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig wlan0 create wlandev ath0 country FR ssid my_router up</span></code></pre></div></div><div class=paragraph><p>Make sure the <em>re0</em> interface is up, then create the <a href="https://man.freebsd.org/cgi/man.cgi?query=lagg&amp;sektion=4&amp;format=html">lagg(4)</a> interface with <em>re0</em> as master with failover to <em>wlan0</em>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig re0 up</span>
<span class=c># ifconfig lagg0 create</span>
<span class=c># ifconfig lagg0 up laggproto failover laggport re0 laggport wlan0</span></code></pre></div></div><div class=paragraph><p>The virtual interface should look something like this:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig lagg0</span>
lagg0: <span class=nv>flags</span><span class=o>=</span>8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
        <span class=nv>options</span><span class=o>=</span>8&lt;VLAN_MTU&gt;
        ether b8:ee:65:5b:32:59
        laggproto failover lagghash l2,l3,l4
        laggport: re0 <span class=nv>flags</span><span class=o>=</span>5&lt;MASTER,ACTIVE&gt;
        laggport: wlan0 <span class=nv>flags</span><span class=o>=</span>0&lt;<span class=o>&gt;</span>
        <span class=nb>groups</span>: lagg
        media: Ethernet autoselect
        status: active</code></pre></div></div><div class=paragraph><p>Then, start the DHCP client to obtain an IP address:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># dhclient lagg0</span></code></pre></div></div><div class=paragraph><p>To retain this configuration across reboots, add the following entries to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>ifconfig_re0=&#34;ether b8:ee:65:5b:32:59&#34;
wlans_ath0=&#34;wlan0&#34;
ifconfig_wlan0=&#34;WPA&#34;
create_args_wlan0=&#34;country FR&#34;
cloned_interfaces=&#34;lagg0&#34;
ifconfig_lagg0=&#34;up laggproto failover laggport re0 laggport wlan0 DHCP&#34;</pre></div></div></div></div></div></div><div class=sect2><h3 id=network-diskless>31.8. Diskless Operation with PXE<a class=anchor href=#network-diskless></a></h3><div class=paragraph><p>The Intel® Preboot eXecution Environment (PXE) allows an operating system to boot over the network. For example, a FreeBSD system can boot over the network and operate without a local disk, using file systems mounted from an NFS server. PXE support is usually available in the BIOS. To use PXE when the machine starts, select the <code>Boot from network</code> option in the BIOS setup or type a function key during system initialization.</p></div><div class=paragraph><p>In order to provide the files needed for an operating system to boot over the network, a PXE setup also requires properly configured DHCP, TFTP, and NFS servers, where:</p></div><div class=ulist><ul><li><p>Initial parameters, such as an IP address, executable boot filename and location, server name, and root path are obtained from the DHCP server.</p></li><li><p>The operating system loader file is booted using TFTP.</p></li><li><p>The file systems are loaded using NFS.</p></li></ul></div><div class=paragraph><p>When a computer PXE boots, it receives information over DHCP about where to obtain the initial boot loader file. After the host computer receives this information, it downloads the boot loader via TFTP and then executes the boot loader. In FreeBSD, the boot loader file is <span class=filename>/boot/pxeboot</span>. After <span class=filename>/boot/pxeboot</span> executes, the FreeBSD kernel is loaded and the rest of the FreeBSD bootup sequence proceeds, as described in <a href=./#boot>The FreeBSD Booting Process</a>.</p></div><div class=paragraph><p>This section describes how to configure these services on a FreeBSD system so that other systems can PXE boot into FreeBSD. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=diskless&amp;sektion=8&amp;format=html">diskless(8)</a> for more information.</p></div><div class="admonitionblock caution"><table><tbody><tr><td class=icon><i class="fa icon-caution" title=Caution></i></td><td class=content><div class=paragraph><p>As described, the system providing these services is insecure. It should live in a protected area of a network and be untrusted by other hosts.</p></div></td></tr></tbody></table></div><div class=sect3><h4 id=network-pxe-nfs>31.8.1. Setting Up the PXE Environment<a class=anchor href=#network-pxe-nfs></a></h4><div class=paragraph><p>The steps shown in this section configure the built-in NFS and TFTP servers. The next section demonstrates how to install and configure the DHCP server. In this example, the directory which will contain the files used by PXE users is <span class=filename>/b/tftpboot/FreeBSD/install</span>. It is important that this directory exists and that the same directory name is set in both <span class=filename>/etc/inetd.conf</span> and <span class=filename>/usr/local/etc/dhcpd.conf</span>.</p></div><div class="olist arabic procedure"><ol class=arabic><li><p>Create the root directory which will contain a FreeBSD installation to be NFS mounted:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># export NFSROOTDIR=/b/tftpboot/FreeBSD/install</span>
<span class=c># mkdir -p ${NFSROOTDIR}</span></code></pre></div></div></li><li><p>Enable the NFS server by adding this line to <span class=filename>/etc/rc.conf</span>:</p><div class="literalblock programlisting"><div class=content><pre>nfs_server_enable=&#34;YES&#34;</pre></div></div></li><li><p>Export the diskless root directory via NFS by adding the following to <span class=filename>/etc/exports</span>:</p><div class="literalblock programlisting"><div class=content><pre>/b -ro -alldirs -maproot=root</pre></div></div></li><li><p>Start the NFS server:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service nfsd start</span></code></pre></div></div></li><li><p>Enable <a href="https://man.freebsd.org/cgi/man.cgi?query=inetd&amp;sektion=8&amp;format=html">inetd(8)</a> by adding the following line to <span class=filename>/etc/rc.conf</span>:</p><div class="literalblock programlisting"><div class=content><pre>inetd_enable=&#34;YES&#34;</pre></div></div></li><li><p>Uncomment the following line in <span class=filename>/etc/inetd.conf</span> by making sure it does not start with a <code>#</code> symbol:</p><div class="literalblock programlisting"><div class=content><pre>tftp dgram udp wait root /usr/libexec/tftpd tftpd -l -s /b/tftpboot</pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Some PXE versions require the TCP version of TFTP. In this case, uncomment the second <code>tftp</code> line which contains <code>stream tcp</code>.</p></div></td></tr></tbody></table></div></li><li><p>Start <a href="https://man.freebsd.org/cgi/man.cgi?query=inetd&amp;sektion=8&amp;format=html">inetd(8)</a>:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service inetd start</span></code></pre></div></div></li><li><p>Install the base system into <span class=filename>${NFSROOTDIR}</span>, either by decompressing the official archives or by rebuilding the FreeBSD kernel and userland (refer to <a href=./#makeworld>“Updating FreeBSD from Source”</a> for more detailed instructions, but do not forget to add <code>DESTDIR=<em>${NFSROOTDIR}</em></code> when running the <code>make installkernel</code> and <code>make installworld</code> commands.</p></li><li><p>Test that the TFTP server works and can download the boot loader which will be obtained via PXE:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># tftp localhost</span>
tftp&gt; get FreeBSD/install/boot/pxeboot
Received 264951 bytes <span class=k>in </span>0.1 seconds</code></pre></div></div></li><li><p>Edit <span class=filename>${NFSROOTDIR}/etc/fstab</span> and create an entry to mount the root file system over NFS:</p><div class="literalblock programlisting"><div class=content><pre># Device                                         Mountpoint    FSType   Options  Dump Pass
myhost.example.com:/b/tftpboot/FreeBSD/install       /         nfs      ro        0    0</pre></div></div><div class=paragraph><p>Replace <em>myhost.example.com</em> with the hostname or IP address of the NFS server. In this example, the root file system is mounted read-only in order to prevent NFS clients from potentially deleting the contents of the root file system.</p></div></li><li><p>Set the root password in the PXE environment for client machines which are PXE booting :</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># chroot ${NFSROOTDIR}</span>
<span class=c># passwd</span></code></pre></div></div></li><li><p>If needed, enable <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;format=html">ssh(1)</a> root logins for client machines which are PXE booting by editing <span class=filename>${NFSROOTDIR}/etc/ssh/sshd_config</span> and enabling <code>PermitRootLogin</code>. This option is documented in <a href="https://man.freebsd.org/cgi/man.cgi?query=sshd_config&amp;sektion=5&amp;format=html">sshd_config(5)</a>.</p></li><li><p>Perform any other needed customizations of the PXE environment in <span class=filename>${NFSROOTDIR}</span>. These customizations could include things like installing packages or editing the password file with <a href="https://man.freebsd.org/cgi/man.cgi?query=vipw&amp;sektion=8&amp;format=html">vipw(8)</a>.</p></li></ol></div><div class=paragraph><p>When booting from an NFS root volume, <span class=filename>/etc/rc</span> detects the NFS boot and runs <span class=filename>/etc/rc.initdiskless</span>. In this case, <span class=filename>/etc</span> and <span class=filename>/var</span> need to be memory backed file systems so that these directories are writable but the NFS root directory is read-only:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># chroot ${NFSROOTDIR}</span>
<span class=c># mkdir -p conf/base</span>
<span class=c># tar -c -v -f conf/base/etc.cpio.gz --format cpio --gzip etc</span>
<span class=c># tar -c -v -f conf/base/var.cpio.gz --format cpio --gzip var</span></code></pre></div></div><div class=paragraph><p>When the system boots, memory file systems for <span class=filename>/etc</span> and <span class=filename>/var</span> will be created and mounted and the contents of the <span class=filename>cpio.gz</span> files will be copied into them. By default, these file systems have a maximum capacity of 5 megabytes. If your archives do not fit, which is usually the case for <span class=filename>/var</span> when binary packages have been installed, request a larger size by putting the number of 512 byte sectors needed (e.g., 5 megabytes is 10240 sectors) in <span class=filename>${NFSROOTDIR}/conf/base/etc/md_size</span> and <span class=filename>${NFSROOTDIR}/conf/base/var/md_size</span> files for <span class=filename>/etc</span> and <span class=filename>/var</span> file systems respectively.</p></div></div><div class=sect3><h4 id=network-pxe-setting-up-dhcp>31.8.2. Configuring the DHCP Server<a class=anchor href=#network-pxe-setting-up-dhcp></a></h4><div class=paragraph><p>The DHCP server does not need to be the same machine as the TFTP and NFS server, but it needs to be accessible in the network.</p></div><div class=paragraph><p>DHCP is not part of the FreeBSD base system but can be installed using the <a class=package href=https://cgit.freebsd.org/ports/tree/net/isc-dhcp44-server/>net/isc-dhcp44-server</a> port or package.</p></div><div class=paragraph><p>Once installed, edit the configuration file, <span class=filename>/usr/local/etc/dhcpd.conf</span>. Configure the <code>next-server</code>, <code>filename</code>, and <code>root-path</code> settings as seen in this example:</p></div><div class="literalblock programlisting"><div class=content><pre>subnet 192.168.0.0 netmask 255.255.255.0 {
   range 192.168.0.2 192.168.0.3 ;
   option subnet-mask 255.255.255.0 ;
   option routers 192.168.0.1 ;
   option broadcast-address 192.168.0.255 ;
   option domain-name-servers 192.168.35.35, 192.168.35.36 ;
   option domain-name &#34;example.com&#34;;

   # IP address of TFTP server
   next-server 192.168.0.1 ;

   # path of boot loader obtained via tftp
   filename &#34;FreeBSD/install/boot/pxeboot&#34; ;

   # pxeboot boot loader will try to NFS mount this directory for root FS
   option root-path &#34;192.168.0.1:/b/tftpboot/FreeBSD/install/&#34; ;

}</pre></div></div><div class=paragraph><p>The <code>next-server</code> directive is used to specify the IP address of the TFTP server.</p></div><div class=paragraph><p>The <code>filename</code> directive defines the path to <span class=filename>/boot/pxeboot</span>. A relative filename is used, meaning that <span class=filename>/b/tftpboot</span> is not included in the path.</p></div><div class=paragraph><p>The <code>root-path</code> option defines the path to the NFS root file system.</p></div><div class=paragraph><p>Once the edits are saved, enable DHCP at boot time by adding the following line to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>dhcpd_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>Then start the DHCP service:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service isc-dhcpd start</span></code></pre></div></div></div><div class=sect3><h4 id=_debugging_pxe_problems>31.8.3. Debugging PXE Problems<a class=anchor href=#_debugging_pxe_problems></a></h4><div class=paragraph><p>Once all of the services are configured and started, PXE clients should be able to automatically load FreeBSD over the network. If a particular client is unable to connect, when that client machine boots up, enter the BIOS configuration menu and confirm that it is set to boot from the network.</p></div><div class=paragraph><p>This section describes some troubleshooting tips for isolating the source of the configuration problem should no clients be able to PXE boot.</p></div><div class="sidebarblock procedure"><div class=content><div class="olist arabic"><ol class=arabic><li><p>Use the <a class=package href=https://cgit.freebsd.org/ports/tree/net/wireshark/>net/wireshark</a> package or port to debug the network traffic involved during the PXE booting process, which is illustrated in the diagram below.</p><div class=imageblock><div class=content><img src=../../../../images/books/handbook/advanced-networking/pxe-nfs.png alt="pxe nfs"></div><div class=title>Rysunek 59. PXE Booting Process with NFS Root Mount</div></div><div class="olist arabic"><ol class=arabic><li><p>Client broadcasts a DHCPDISCOVER message.</p></li><li><p>The DHCP server responds with the IP address, next-server, filename, and root-path values.</p></li><li><p>The client sends a TFTP request to next-server, asking to retrieve filename.</p></li><li><p>The TFTP server responds and sends filename to client.</p></li><li><p>The client executes filename, which is pxeboot(8), which then loads the kernel. When the kernel executes, the root file system specified by root-path is mounted over NFS.</p></li></ol></div></li><li><p>On the TFTP server, read <span class=filename>/var/log/xferlog</span> to ensure that <span class=filename>pxeboot</span> is being retrieved from the correct location. To test this example configuration:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># tftp 192.168.0.1</span>
tftp&gt; get FreeBSD/install/boot/pxeboot
Received 264951 bytes <span class=k>in </span>0.1 seconds</code></pre></div></div><div class=paragraph><p>The <code>BUGS</code> sections in <a href="https://man.freebsd.org/cgi/man.cgi?query=tftpd&amp;sektion=8&amp;format=html">tftpd(8)</a> and <a href="https://man.freebsd.org/cgi/man.cgi?query=tftp&amp;sektion=1&amp;format=html">tftp(1)</a> document some limitations with TFTP.</p></div></li><li><p>Make sure that the root file system can be mounted via NFS. To test this example configuration:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mount -t nfs 192.168.0.1:/b/tftpboot/FreeBSD/install /mnt</span></code></pre></div></div></li></ol></div></div></div></div></div><div class=sect2><h3 id=network-ipv6>31.9. IPv6<a class=anchor href=#network-ipv6></a></h3><div class=paragraph><p>IPv6 is the new version of the well known IP protocol, also known as IPv4. IPv6 provides several advantages over IPv4 as well as many new features:</p></div><div class=ulist><ul><li><p>Its 128-bit address space allows for 340,282,366,920,938,463,463,374,607,431,768,211,456 addresses. This addresses the IPv4 address shortage and eventual IPv4 address exhaustion.</p></li><li><p>Routers only store network aggregation addresses in their routing tables, thus reducing the average space of a routing table to 8192 entries. This addresses the scalability issues associated with IPv4, which required every allocated block of IPv4 addresses to be exchanged between Internet routers, causing their routing tables to become too large to allow efficient routing.</p></li><li><p>Address autoconfiguration (<a href=http://www.ietf.org/rfc/rfc2462.txt>RFC2462</a>).</p></li><li><p>Mandatory multicast addresses.</p></li><li><p>Built-in IPsec (IP security).</p></li><li><p>Simplified header structure.</p></li><li><p>Support for mobile IP.</p></li><li><p>IPv6-to-IPv4 transition mechanisms.</p></li></ul></div><div class=paragraph><p>FreeBSD includes the <a href=http://www.kame.net/>http://www.kame.net/</a> IPv6 reference implementation and comes with everything needed to use IPv6. This section focuses on getting IPv6 configured and running.</p></div><div class=sect3><h4 id=_background_on_ipv6_addresses>31.9.1. Background on IPv6 Addresses<a class=anchor href=#_background_on_ipv6_addresses></a></h4><div class=paragraph><p>There are three different types of IPv6 addresses:</p></div><div class=dlist><dl><dt class=hdlist1>Unicast</dt><dd><p>A packet sent to a unicast address arrives at the interface belonging to the address.</p></dd><dt class=hdlist1>Anycast</dt><dd><p>These addresses are syntactically indistinguishable from unicast addresses but they address a group of interfaces. The packet destined for an anycast address will arrive at the nearest router interface. Anycast addresses are only used by routers.</p></dd><dt class=hdlist1>Multicast</dt><dd><p>These addresses identify a group of interfaces. A packet destined for a multicast address will arrive at all interfaces belonging to the multicast group. The IPv4 broadcast address, usually <code>xxx.xxx.xxx.255</code>, is expressed by multicast addresses in IPv6.</p></dd></dl></div><div class=paragraph><p>When reading an IPv6 address, the canonical form is represented as <code>x:x:x:x:x:x:x:x</code>, where each <code>x</code> represents a 16 bit hex value. An example is <code>FEBC:A574:382B:23C1:AA49:4592:4EFE:9982</code>.</p></div><div class=paragraph><p>Often, an address will have long substrings of all zeros. A <code>::</code> (double colon) can be used to replace one substring per address. Also, up to three leading <code>0</code>s per hex value can be omitted. For example, <code>fe80::1</code> corresponds to the canonical form <code>fe80:0000:0000:0000:0000:0000:0000:0001</code>.</p></div><div class=paragraph><p>A third form is to write the last 32 bits using the well known IPv4 notation. For example, <code>2002::10.0.0.1</code> corresponds to the hexadecimal canonical representation <code>2002:0000:0000:0000:0000:0000:0a00:0001</code>, which in turn is equivalent to <code>2002::a00:1</code>.</p></div><div class=paragraph><p>To view a FreeBSD system’s IPv6 address, use <a href="https://man.freebsd.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;format=html">ifconfig(8)</a>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig</span></code></pre></div></div><div class="literalblock programlisting"><div class=content><pre>rl0: flags=8943&lt;UP,BROADCAST,RUNNING,PROMISC,SIMPLEX,MULTICAST&gt; mtu 1500
         inet 10.0.0.10 netmask 0xffffff00 broadcast 10.0.0.255
         inet6 fe80::200:21ff:fe03:8e1%rl0 prefixlen 64 scopeid 0x1
         ether 00:00:21:03:08:e1
         media: Ethernet autoselect (100baseTX )
         status: active</pre></div></div><div class=paragraph><p>In this example, the <span class=filename>rl0</span> interface is using <code>fe80::200:21ff:fe03:8e1%rl0</code>, an auto-configured link-local address which was automatically generated from the MAC address.</p></div><div class=paragraph><p>Some IPv6 addresses are reserved. A summary of these reserved addresses is seen in <a href=#reservedip6>Reserved IPv6 Addresses</a>:</p></div><table id=reservedip6 class="tableblock frame-none grid-all stretch"><caption class=title>Tabela 31. Reserved IPv6 Addresses</caption><col style=width:25%><col style=width:25%><col style=width:25%><col style=width:25%><thead><tr><th class="tableblock halign-left valign-top">IPv6 address</th><th class="tableblock halign-left valign-top">Prefixlength (Bits)</th><th class="tableblock halign-left valign-top">Description</th><th class="tableblock halign-left valign-top">Notes</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>::</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>128 bits</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>unspecified</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Equivalent to <code>0.0.0.0</code> in IPv4.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>::1</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>128 bits</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>loopback address</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Equivalent to <code>127.0.0.1</code> in IPv4.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>::00:xx:xx:xx:xx</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>96 bits</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>embedded IPv4</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>The lower 32 bits are the compatible IPv4 address.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>::ff:xx:xx:xx:xx</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>96 bits</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>IPv4 mapped IPv6 address</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>The lower 32 bits are the IPv4 address for hosts which do not support IPv6.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>fe80::/10</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>10 bits</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>link-local</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Equivalent to 169.254.0.0/16 in IPv4.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>fc00::/7</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>7 bits</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>unique-local</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Unique local addresses are intended for local communication and are only routable within a set of cooperating sites.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>ff00::</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>8 bits</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>multicast</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>2000::-3fff::</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>3 bits</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>global unicast</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>All global unicast addresses are assigned from this pool. The first 3 bits are <code>001</code>.</p></td></tr></tbody></table><div class=paragraph><p>For further information on the structure of IPv6 addresses, refer to <a href=http://www.ietf.org/rfc/rfc3513.txt>RFC3513</a>.</p></div></div><div class=sect3><h4 id=_configuring_ipv6>31.9.2. Configuring IPv6<a class=anchor href=#_configuring_ipv6></a></h4><div class=paragraph><p>To configure a FreeBSD system as an IPv6 client, add these two lines to <span class=filename>rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>ifconfig_rl0_ipv6=&#34;inet6 accept_rtadv&#34;
rtsold_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>The first line enables the specified interface to receive router advertisement messages. The second line enables the router solicitation daemon, <a href="https://man.freebsd.org/cgi/man.cgi?query=rtsol&amp;sektion=8&amp;format=html">rtsol(8)</a>.</p></div><div class=paragraph><p>If the interface needs a statically assigned IPv6 address, add an entry to specify the static address and associated prefix length:</p></div><div class="literalblock programlisting"><div class=content><pre>ifconfig_rl0_ipv6=&#34;inet6 2001:db8:4672:6565:2026:5043:2d42:5344 prefixlen 64&#34;</pre></div></div><div class=paragraph><p>To assign a default router, specify its address:</p></div><div class="literalblock programlisting"><div class=content><pre>ipv6_defaultrouter=&#34;2001:db8:4672:6565::1&#34;</pre></div></div></div><div class=sect3><h4 id=_connecting_to_a_provider>31.9.3. Connecting to a Provider<a class=anchor href=#_connecting_to_a_provider></a></h4><div class=paragraph><p>In order to connect to other IPv6 networks, one must have a provider or a tunnel that supports IPv6:</p></div><div class=ulist><ul><li><p>Contact an Internet Service Provider to see if they offer IPv6.</p></li><li><p><a href=http://www.tunnelbroker.net>Hurricane Electric</a> offers tunnels with end-points all around the globe.</p></li></ul></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Install the <a class=package href=https://cgit.freebsd.org/ports/tree/net/freenet6/>net/freenet6</a> package or port for a dial-up connection.</p></div></td></tr></tbody></table></div><div class=paragraph><p>This section demonstrates how to take the directions from a tunnel provider and convert them into <span class=filename>/etc/rc.conf</span> settings that will persist through reboots.</p></div><div class=paragraph><p>The first <span class=filename>/etc/rc.conf</span> entry creates the generic tunneling interface <span class=filename>gif0</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>cloned_interfaces=&#34;gif0&#34;</pre></div></div><div class=paragraph><p>Next, configure that interface with the IPv4 addresses of the local and remote endpoints. Replace <code><em>MY_IPv4_ADDR</em></code> and <code><em>REMOTE_IPv4_ADDR</em></code> with the actual IPv4 addresses:</p></div><div class="literalblock programlisting"><div class=content><pre>create_args_gif0=&#34;tunnel MY_IPv4_ADDR REMOTE_IPv4_ADDR&#34;</pre></div></div><div class=paragraph><p>To apply the IPv6 address that has been assigned for use as the IPv6 tunnel endpoint, add this line, replacing <code><em>MY_ASSIGNED_IPv6_TUNNEL_ENDPOINT_ADDR</em></code> with the assigned address:</p></div><div class="literalblock programlisting"><div class=content><pre>ifconfig_gif0_ipv6=&#34;inet6 MY_ASSIGNED_IPv6_TUNNEL_ENDPOINT_ADDR&#34;</pre></div></div><div class=paragraph><p>Then, set the default route for the other side of the IPv6 tunnel. Replace <code><em>MY_IPv6_REMOTE_TUNNEL_ENDPOINT_ADDR</em></code> with the default gateway address assigned by the provider:</p></div><div class="literalblock programlisting"><div class=content><pre>ipv6_defaultrouter=&#34;MY_IPv6_REMOTE_TUNNEL_ENDPOINT_ADDR&#34;</pre></div></div><div class=paragraph><p>If the FreeBSD system will route IPv6 packets between the rest of the network and the world, enable the gateway using this line:</p></div><div class="literalblock programlisting"><div class=content><pre>ipv6_gateway_enable=&#34;YES&#34;</pre></div></div></div><div class=sect3><h4 id=_router_advertisement_and_host_auto_configuration>31.9.4. Router Advertisement and Host Auto Configuration<a class=anchor href=#_router_advertisement_and_host_auto_configuration></a></h4><div class=paragraph><p>This section demonstrates how to setup <a href="https://man.freebsd.org/cgi/man.cgi?query=rtadvd&amp;sektion=8&amp;format=html">rtadvd(8)</a> to advertise the IPv6 default route.</p></div><div class=paragraph><p>To enable <a href="https://man.freebsd.org/cgi/man.cgi?query=rtadvd&amp;sektion=8&amp;format=html">rtadvd(8)</a>, add the following to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>rtadvd_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>It is important to specify the interface on which to do IPv6 router advertisement. For example, to tell <a href="https://man.freebsd.org/cgi/man.cgi?query=rtadvd&amp;sektion=8&amp;format=html">rtadvd(8)</a> to use <span class=filename>rl0</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>rtadvd_interfaces=&#34;rl0&#34;</pre></div></div><div class=paragraph><p>Next, create the configuration file, <span class=filename>/etc/rtadvd.conf</span> as seen in this example:</p></div><div class="literalblock programlisting"><div class=content><pre>rl0:\
	:addrs#1:addr=&#34;2001:db8:1f11:246::&#34;:prefixlen#64:tc=ether:</pre></div></div><div class=paragraph><p>Replace <span class=filename>rl0</span> with the interface to be used and <code>2001:db8:1f11:246::</code> with the prefix of the allocation.</p></div><div class=paragraph><p>For a dedicated <code>/64</code> subnet, nothing else needs to be changed. Otherwise, change the <code>prefixlen#</code> to the correct value.</p></div></div><div class=sect3><h4 id=_ipv6_and_ipv6_address_mapping>31.9.5. IPv6 and IPv6 Address Mapping<a class=anchor href=#_ipv6_and_ipv6_address_mapping></a></h4><div class=paragraph><p>When IPv6 is enabled on a server, there may be a need to enable IPv4 mapped IPv6 address communication. This compatibility option allows for IPv4 addresses to be represented as IPv6 addresses. Permitting IPv6 applications to communicate with IPv4 and vice versa may be a security issue.</p></div><div class=paragraph><p>This option may not be required in most cases and is available only for compatibility. This option will allow IPv6-only applications to work with IPv4 in a dual stack environment. This is most useful for third party applications which may not support an IPv6-only environment. To enable this feature, add the following to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>ipv6_ipv4mapping=&#34;YES&#34;</pre></div></div><div class=paragraph><p>Reviewing the information in RFC 3493, section 3.6 and 3.7 as well as RFC 4038 section 4.2 may be useful to some administrators.</p></div></div></div><div class=sect2><h3 id=carp>31.10. Common Address Redundancy Protocol (CARP)<a class=anchor href=#carp></a></h3><div class=paragraph><p>The Common Address Redundancy Protocol (CARP) allows multiple hosts to share the same IP address and Virtual Host ID (VHID) in order to provide <em>high availability</em> for one or more services. This means that one or more hosts can fail, and the other hosts will transparently take over so that users do not see a service failure.</p></div><div class=paragraph><p>In addition to the shared IP address, each host has its own IP address for management and configuration. All of the machines that share an IP address have the same VHID. The VHID for each virtual IP address must be unique across the broadcast domain of the network interface.</p></div><div class=paragraph><p>High availability using CARP is built into FreeBSD, though the steps to configure it vary slightly depending upon the FreeBSD version. This section provides the same example configuration for versions before and equal to or after FreeBSD 10.</p></div><div class=paragraph><p>This example configures failover support with three hosts, all with unique IP addresses, but providing the same web content. It has two different masters named <code>hosta.example.org</code> and <code>hostb.example.org</code>, with a shared backup named <code>hostc.example.org</code>.</p></div><div class=paragraph><p>These machines are load balanced with a Round Robin DNS configuration. The master and backup machines are configured identically except for their hostnames and management IP addresses. These servers must have the same configuration and run the same services. When the failover occurs, requests to the service on the shared IP address can only be answered correctly if the backup server has access to the same content. The backup machine has two additional CARP interfaces, one for each of the master content server’s IP addresses. When a failure occurs, the backup server will pick up the failed master machine’s IP address.</p></div><div class=sect3><h4 id=carp-10x>31.10.1. Using CARP on FreeBSD 10 and Later<a class=anchor href=#carp-10x></a></h4><div class=paragraph><p>Enable boot-time support for CARP by adding an entry for the <span class=filename>carp.ko</span> kernel module in <span class=filename>/boot/loader.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>carp_load=&#34;YES&#34;</pre></div></div><div class=paragraph><p>To load the module now without rebooting:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># kldload carp</span></code></pre></div></div><div class=paragraph><p>For users who prefer to use a custom kernel, include the following line in the custom kernel configuration file and compile the kernel as described in <a href=./#kernelconfig>Configuring the FreeBSD Kernel</a>:</p></div><div class="literalblock programlisting"><div class=content><pre>device	carp</pre></div></div><div class=paragraph><p>The hostname, management IP address and subnet mask, shared IP address, and VHID are all set by adding entries to <span class=filename>/etc/rc.conf</span>. This example is for <code>hosta.example.org</code>:</p></div><div class="literalblock programlisting"><div class=content><pre>hostname=&#34;hosta.example.org&#34;
ifconfig_em0=&#34;inet 192.168.1.3 netmask 255.255.255.0&#34;
ifconfig_em0_alias0=&#34;inet vhid 1 pass testpass alias 192.168.1.50/32&#34;</pre></div></div><div class=paragraph><p>The next set of entries are for <code>hostb.example.org</code>. Since it represents a second master, it uses a different shared IP address and VHID. However, the passwords specified with <code>pass</code> must be identical as CARP will only listen to and accept advertisements from machines with the correct password.</p></div><div class="literalblock programlisting"><div class=content><pre>hostname=&#34;hostb.example.org&#34;
ifconfig_em0=&#34;inet 192.168.1.4 netmask 255.255.255.0&#34;
ifconfig_em0_alias0=&#34;inet vhid 2 pass testpass alias 192.168.1.51/32&#34;</pre></div></div><div class=paragraph><p>The third machine, <code>hostc.example.org</code>, is configured to handle failover from either master. This machine is configured with two CARPVHIDs, one to handle the virtual IP address for each of the master hosts. The CARP advertising skew, <code>advskew</code>, is set to ensure that the backup host advertises later than the master, since <code>advskew</code> controls the order of precedence when there are multiple backup servers.</p></div><div class="literalblock programlisting"><div class=content><pre>hostname=&#34;hostc.example.org&#34;
ifconfig_em0=&#34;inet 192.168.1.5 netmask 255.255.255.0&#34;
ifconfig_em0_alias0=&#34;inet vhid 1 advskew 100 pass testpass alias 192.168.1.50/32&#34;
ifconfig_em0_alias1=&#34;inet vhid 2 advskew 100 pass testpass alias 192.168.1.51/32&#34;</pre></div></div><div class=paragraph><p>Having two CARPVHIDs configured means that <code>hostc.example.org</code> will notice if either of the master servers becomes unavailable. If a master fails to advertise before the backup server, the backup server will pick up the shared IP address until the master becomes available again.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>If the original master server becomes available again, <code>hostc.example.org</code> will not release the virtual IP address back to it automatically. For this to happen, preemption has to be enabled. The feature is disabled by default, it is controlled via the <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a> variable <code>net.inet.carp.preempt</code>. The administrator can force the backup server to return the IP address to the master:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig em0 vhid 1 state backup</span></code></pre></div></div></td></tr></tbody></table></div><div class=paragraph><p>Once the configuration is complete, either restart networking or reboot each system. High availability is now enabled.</p></div><div class=paragraph><p>CARP functionality can be controlled via several <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a> variables documented in the <a href="https://man.freebsd.org/cgi/man.cgi?query=carp&amp;sektion=4&amp;format=html">carp(4)</a> manual pages. Other actions can be triggered from CARP events by using <a href="https://man.freebsd.org/cgi/man.cgi?query=devd&amp;sektion=8&amp;format=html">devd(8)</a>.</p></div></div><div class=sect3><h4 id=carp-9x>31.10.2. Using CARP on FreeBSD 9 and Earlier<a class=anchor href=#carp-9x></a></h4><div class=paragraph><p>The configuration for these versions of FreeBSD is similar to the one described in the previous section, except that a CARP device must first be created and referred to in the configuration.</p></div><div class=paragraph><p>Enable boot-time support for CARP by loading the <span class=filename>if_carp.ko</span> kernel module in <span class=filename>/boot/loader.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>if_carp_load=&#34;YES&#34;</pre></div></div><div class=paragraph><p>To load the module now without rebooting:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># kldload carp</span></code></pre></div></div><div class=paragraph><p>For users who prefer to use a custom kernel, include the following line in the custom kernel configuration file and compile the kernel as described in <a href=./#kernelconfig>Configuring the FreeBSD Kernel</a>:</p></div><div class="literalblock programlisting"><div class=content><pre>device	carp</pre></div></div><div class=paragraph><p>Next, on each host, create a CARP device:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig carp0 create</span></code></pre></div></div><div class=paragraph><p>Set the hostname, management IP address, the shared IP address, and VHID by adding the required lines to <span class=filename>/etc/rc.conf</span>. Since a virtual CARP device is used instead of an alias, the actual subnet mask of <code>/24</code> is used instead of <code>/32</code>. Here are the entries for <code>hosta.example.org</code>:</p></div><div class="literalblock programlisting"><div class=content><pre>hostname=&#34;hosta.example.org&#34;
ifconfig_fxp0=&#34;inet 192.168.1.3 netmask 255.255.255.0&#34;
cloned_interfaces=&#34;carp0&#34;
ifconfig_carp0=&#34;vhid 1 pass testpass 192.168.1.50/24&#34;</pre></div></div><div class=paragraph><p>On <code>hostb.example.org</code>:</p></div><div class="literalblock programlisting"><div class=content><pre>hostname=&#34;hostb.example.org&#34;
ifconfig_fxp0=&#34;inet 192.168.1.4 netmask 255.255.255.0&#34;
cloned_interfaces=&#34;carp0&#34;
ifconfig_carp0=&#34;vhid 2 pass testpass 192.168.1.51/24&#34;</pre></div></div><div class=paragraph><p>The third machine, <code>hostc.example.org</code>, is configured to handle failover from either of the master hosts:</p></div><div class="literalblock programlisting"><div class=content><pre>hostname=&#34;hostc.example.org&#34;
ifconfig_fxp0=&#34;inet 192.168.1.5 netmask 255.255.255.0&#34;
cloned_interfaces=&#34;carp0 carp1&#34;
ifconfig_carp0=&#34;vhid 1 advskew 100 pass testpass 192.168.1.50/24&#34;
ifconfig_carp1=&#34;vhid 2 advskew 100 pass testpass 192.168.1.51/24&#34;</pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Preemption is disabled in the <span class=filename>GENERIC</span> FreeBSD kernel. If preemption has been enabled with a custom kernel, <code>hostc.example.org</code> may not release the IP address back to the original content server. The administrator can force the backup server to return the IP address to the master with the command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig carp0 down &amp;&amp; ifconfig carp0 up</span></code></pre></div></div><div class=paragraph><p>This should be done on the <span class=filename>carp</span> interface which corresponds to the correct host.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Once the configuration is complete, either restart networking or reboot each system. High availability is now enabled.</p></div></div></div><div class=sect2><h3 id=network-vlan>31.11. VLANs<a class=anchor href=#network-vlan></a></h3><div class=paragraph><p>VLANs are a way of virtually dividing up a network into many different subnetworks, also referred to as segmenting. Each segment will have its own broadcast domain and be isolated from other VLANs.</p></div><div class=paragraph><p>On FreeBSD, VLANs must be supported by the network card driver. To see which drivers support vlans, refer to the <a href="https://man.freebsd.org/cgi/man.cgi?query=vlan&amp;sektion=4&amp;format=html">vlan(4)</a> manual page.</p></div><div class=paragraph><p>When configuring a VLAN, a couple pieces of information must be known. First, which network interface? Second, what is the VLAN tag?</p></div><div class=paragraph><p>To configure VLANs at run time, with a NIC of <code>em0</code> and a VLAN tag of <code>5</code> the command would look like this:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig em0.5 create vlan 5 vlandev em0 inet 192.168.20.20/24</span></code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>See how the interface name includes the NIC driver name and the VLAN tag, separated by a period? This is a best practice to make maintaining the VLAN configuration easy when many VLANs are present on a machine.</p></div></td></tr></tbody></table></div><div class=paragraph><p>To configure VLANs at boot time, <span class=filename>/etc/rc.conf</span> must be updated. To duplicate the configuration above, the following will need to be added:</p></div><div class="literalblock programlisting"><div class=content><pre>vlans_em0=&#34;5&#34;
ifconfig_em0_5=&#34;inet 192.168.20.20/24&#34;</pre></div></div><div class=paragraph><p>Additional VLANs may be added, by simply adding the tag to the <code>vlans_em0</code> field and adding an additional line configuring the network on that VLAN tag’s interface.</p></div><div class=paragraph><p>It is useful to assign a symbolic name to an interface so that when the associated hardware is changed, only a few configuration variables need to be updated. For example, security cameras need to be run over VLAN 1 on <code>em0</code>. Later, if the <code>em0</code> card is replaced with a card that uses the <a href="https://man.freebsd.org/cgi/man.cgi?query=ixgb&amp;sektion=4&amp;format=html">ixgb(4)</a> driver, all references to <code>em0.1</code> will not have to change to <code>ixgb0.1</code>.</p></div><div class=paragraph><p>To configure VLAN <code>5</code>, on the NIC <code>em0</code>, assign the interface name <code>cameras</code>, and assign the interface an IP address of <code><em>192.168.20.20</em></code> with a <code>24</code>-bit prefix, use this command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig em0.5 create vlan 5 vlandev em0 name cameras inet 192.168.20.20/24</span></code></pre></div></div><div class=paragraph><p>For an interface named <code>video</code>, use the following:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig video.5 create vlan 5 vlandev video name cameras inet 192.168.20.20/24</span></code></pre></div></div><div class=paragraph><p>To apply the changes at boot time, add the following lines to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>vlans_video=&#34;cameras&#34;
create_args_cameras=&#34;vlan 5&#34;
ifconfig_cameras=&#34;inet 192.168.20.20/24&#34;</pre></div></div></div></div></div><h1 id=appendices class=sect0>Część V: Dodatki<a class=anchor href=#appendices></a></h1><div class=sect1><h2 id=mirrors>Dodatek A: Obtaining FreeBSD<a class=anchor href=#mirrors></a></h2><div class=sectionbody><div class=sect2><h3 id=mirrors-cdrom>A.1. CD and DVD Sets<a class=anchor href=#mirrors-cdrom></a></h3><div class=paragraph><p>FreeBSD CD and DVD sets are available from several online retailers:</p></div><div class=ulist><ul><li><p>FreeBSD Mall, Inc.<br>2420 Sand Creek Rd C-1 #347<br>Brentwood, CA<br>94513<br>USA<br>Phone: +1 925 240-6652<br>Fax: +1 925 674-0821<br>Email: &lt;<a href=mailto:info@freebsdmall.com>info@freebsdmall.com</a>><br>WWW: <a href=https://www.freebsdmall.com class=bare>https://www.freebsdmall.com</a></p></li><li><p>Getlinux<br>78 Rue de la Croix Rochopt<br>Épinay-sous-Sénart<br>91860<br>France<br>Email: &lt;<a href=mailto:contact@getlinux.fr>contact@getlinux.fr</a>><br>WWW: <a href=http://www.getlinux.fr/ class=bare>http://www.getlinux.fr/</a></p></li><li><p>Dr. Hinner EDV<br>Kochelseestr. 11<br>D-81371 München<br>Germany<br>Phone: (0177) 428 419 0<br>Email: &lt;<a href=mailto:infow@hinner.de>infow@hinner.de</a>><br>WWW: <a href=http://www.hinner.de/linux/freebsd.html class=bare>http://www.hinner.de/linux/freebsd.html</a></p></li><li><p>Linux Center<br>Galernaya Street, 55<br>Saint-Petersburg<br>190000<br>Russia<br>Phone: +7-812-309-06-86<br>Email: &lt;<a href=mailto:info@linuxcenter.ru>info@linuxcenter.ru</a>><br>WWW: <a href=http://linuxcenter.ru/shop/freebsd class=bare>http://linuxcenter.ru/shop/freebsd</a></p></li></ul></div></div><div class=sect2><h3 id=mirrors-ftp>A.2. FTP Sites<a class=anchor href=#mirrors-ftp></a></h3><div class=paragraph><p>The official sources for FreeBSD are available via anonymous FTP from a worldwide set of mirror sites. The site <a href=ftp://ftp.FreeBSD.org/pub/FreeBSD/>ftp://ftp.FreeBSD.org/pub/FreeBSD/</a> is available via HTTP and FTP. It is made up of many machines operated by the project cluster administrators and behind GeoDNS to direct users to the closest available mirror.</p></div><div class=paragraph><p>Additionally, FreeBSD is available via anonymous FTP from the following mirror sites. When obtaining FreeBSD via anonymous FTP, please try to use a nearby site. The mirror sites listed as "Primary Mirror Sites" typically have the entire FreeBSD archive (all the currently available versions for each of the architectures) but faster download speeds are probably available from a site that is in your country or region. The regional sites carry the most recent versions for the most popular architecture(s) but might not carry the entire FreeBSD archive. All sites provide access via anonymous FTP but some sites also provide access via other methods. The access methods available for each site are provided in parentheses after the hostname.</p></div><div class=paragraph><p><a href=#central>Central Servers</a>, <a href=#primary>Primary Mirror Sites</a>, <a href=#armenia>Armenia</a>, <a href=#australia>Australia</a>, <a href=#austria>Austria</a>, <a href=#brazil>Brazil</a>, <a href=#czech-republic>Czech Republic</a>, <a href=#denmark>Denmark</a>, <a href=#estonia>Estonia</a>, <a href=#finland>Finland</a>, <a href=#france>France</a>, <a href=#germany>Germany</a>, <a href=#greece>Greece</a>, <a href=#hong-kong>Hong Kong</a>, <a href=#ireland>Ireland</a>, <a href=#japan>Japan</a>, <a href=#korea>Korea</a>, <a href=#latvia>Latvia</a>, <a href=#lithuania>Lithuania</a>, <a href=#netherlands>Netherlands</a>, <a href=#new-zealand>New Zealand</a>, <a href=#norway>Norway</a>, <a href=#poland>Poland</a>, <a href=#russia>Russia</a>, <a href=#saudi-arabia>Saudi Arabia</a>, <a href=#slovenia>Slovenia</a>, <a href=#south-africa>South Africa</a>, <a href=#spain>Spain</a>, <a href=#sweden>Sweden</a>, <a href=#switzerland>Switzerland</a>, <a href=#taiwan>Taiwan</a>, <a href=#ukraine>Ukraine</a>, <a href=#uk>United Kingdom</a>, <a href=#usa>United States of America</a>.</p></div><div class=paragraph><p>(as of UTC)</p></div><div id=central class=paragraph><p><strong>Central Servers</strong></p></div><div class=paragraph><p><a href=ftp://ftp.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp.FreeBSD.org/pub/FreeBSD/</a> (ftp / ftpv6 / <a href=http://ftp.FreeBSD.org/pub/FreeBSD/ class=bare>http://ftp.FreeBSD.org/pub/FreeBSD/</a> / <a href=http://ftp.FreeBSD.org/pub/FreeBSD/ class=bare>http://ftp.FreeBSD.org/pub/FreeBSD/</a>)</p></div><div id=primary class=paragraph><p><strong>Primary Mirror Sites</strong></p></div><div class=paragraph><p>In case of problems, please contact the hostmaster <code>&lt;<a href=mailto:mirror-admin@FreeBSD.org>mirror-admin@FreeBSD.org</a>></code> for this domain.</p></div><div class=ulist><ul><li><p><a href=ftp://ftp1.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp1.FreeBSD.org/pub/FreeBSD/</a> (ftp)</p></li><li><p><a href=ftp://ftp2.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp2.FreeBSD.org/pub/FreeBSD/</a> (ftp)</p></li><li><p><a href=ftp://ftp3.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp3.FreeBSD.org/pub/FreeBSD/</a> (ftp)</p></li><li><p><a href=ftp://ftp4.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp4.FreeBSD.org/pub/FreeBSD/</a> (ftp / ftpv6 / <a href=http://ftp4.FreeBSD.org/pub/FreeBSD/ class=bare>http://ftp4.FreeBSD.org/pub/FreeBSD/</a> / <a href=http://ftp4.FreeBSD.org/pub/FreeBSD/ class=bare>http://ftp4.FreeBSD.org/pub/FreeBSD/</a>)</p></li><li><p><a href=ftp://ftp5.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp5.FreeBSD.org/pub/FreeBSD/</a> (ftp)</p></li><li><p><a href=ftp://ftp6.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp6.FreeBSD.org/pub/FreeBSD/</a> (ftp)</p></li><li><p><a href=ftp://ftp7.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp7.FreeBSD.org/pub/FreeBSD/</a> (ftp)</p></li><li><p><a href=ftp://ftp10.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp10.FreeBSD.org/pub/FreeBSD/</a> (ftp / ftpv6 / <a href=http://ftp10.FreeBSD.org/pub/FreeBSD/ class=bare>http://ftp10.FreeBSD.org/pub/FreeBSD/</a> / <a href=http://ftp10.FreeBSD.org/pub/FreeBSD/ class=bare>http://ftp10.FreeBSD.org/pub/FreeBSD/</a>)</p></li><li><p><a href=ftp://ftp11.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp11.FreeBSD.org/pub/FreeBSD/</a> (ftp)</p></li><li><p><a href=ftp://ftp13.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp13.FreeBSD.org/pub/FreeBSD/</a> (ftp)</p></li><li><p><a href=ftp://ftp14.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp14.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a href=http://ftp14.FreeBSD.org/pub/FreeBSD/ class=bare>http://ftp14.FreeBSD.org/pub/FreeBSD/</a>)</p></li></ul></div><div id=armenia class=paragraph><p><strong>Armenia</strong></p></div><div class=paragraph><p>In case of problems, please contact the hostmaster <code>&lt;<a href=mailto:hostmaster@am.FreeBSD.org>hostmaster@am.FreeBSD.org</a>></code> for this domain.</p></div><div class=ulist><ul><li><p><a href=ftp://ftp1.am.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp1.am.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a href=http://ftp1.am.FreeBSD.org/pub/FreeBSD/ class=bare>http://ftp1.am.FreeBSD.org/pub/FreeBSD/</a> / rsync)</p></li></ul></div><div id=australia class=paragraph><p><strong>Australia</strong></p></div><div class=paragraph><p>In case of problems, please contact the hostmaster <code>&lt;<a href=mailto:hostmaster@au.FreeBSD.org>hostmaster@au.FreeBSD.org</a>></code> for this domain.</p></div><div class=ulist><ul><li><p><a href=ftp://ftp.au.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp.au.FreeBSD.org/pub/FreeBSD/</a> (ftp)</p></li><li><p><a href=ftp://ftp2.au.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp2.au.FreeBSD.org/pub/FreeBSD/</a> (ftp)</p></li><li><p><a href=ftp://ftp3.au.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp3.au.FreeBSD.org/pub/FreeBSD/</a> (ftp)</p></li></ul></div><div id=austria class=paragraph><p><strong>Austria</strong></p></div><div class=paragraph><p>In case of problems, please contact the hostmaster <code>&lt;<a href=mailto:hostmaster@at.FreeBSD.org>hostmaster@at.FreeBSD.org</a>></code> for this domain.</p></div><div class=ulist><ul><li><p><a href=ftp://ftp.at.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp.at.FreeBSD.org/pub/FreeBSD/</a> (ftp / ftpv6 / <a href=http://ftp.at.FreeBSD.org/pub/FreeBSD/ class=bare>http://ftp.at.FreeBSD.org/pub/FreeBSD/</a> / <a href=http://ftp.at.FreeBSD.org/pub/FreeBSD/ class=bare>http://ftp.at.FreeBSD.org/pub/FreeBSD/</a>)</p></li></ul></div><div id=brazil class=paragraph><p><strong>Brazil</strong></p></div><div class=paragraph><p>In case of problems, please contact the hostmaster <code>&lt;<a href=mailto:hostmaster@br.FreeBSD.org>hostmaster@br.FreeBSD.org</a>></code> for this domain.</p></div><div class=ulist><ul><li><p><a href=ftp://ftp2.br.FreeBSD.org/FreeBSD/ class=bare>ftp://ftp2.br.FreeBSD.org/FreeBSD/</a> (ftp / <a href=http://ftp2.br.FreeBSD.org/ class=bare>http://ftp2.br.FreeBSD.org/</a>)</p></li><li><p><a href=ftp://ftp3.br.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp3.br.FreeBSD.org/pub/FreeBSD/</a> (ftp / rsync)</p></li><li><p><a href=ftp://ftp4.br.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp4.br.FreeBSD.org/pub/FreeBSD/</a> (ftp)</p></li></ul></div><div id=czech-republic class=paragraph><p><strong>Czech Republic</strong></p></div><div class=paragraph><p>In case of problems, please contact the hostmaster <code>&lt;<a href=mailto:hostmaster@cz.FreeBSD.org>hostmaster@cz.FreeBSD.org</a>></code> for this domain.</p></div><div class=ulist><ul><li><p><a href=ftp://ftp.cz.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp.cz.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a href=ftp://ftp.cz.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp.cz.FreeBSD.org/pub/FreeBSD/</a> / <a href=http://ftp.cz.FreeBSD.org/pub/FreeBSD/ class=bare>http://ftp.cz.FreeBSD.org/pub/FreeBSD/</a> / <a href=http://ftp.cz.FreeBSD.org/pub/FreeBSD/ class=bare>http://ftp.cz.FreeBSD.org/pub/FreeBSD/</a> / rsync / rsyncv6)</p></li><li><p><a href=ftp://ftp2.cz.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp2.cz.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a href=http://ftp2.cz.FreeBSD.org/pub/FreeBSD/ class=bare>http://ftp2.cz.FreeBSD.org/pub/FreeBSD/</a>)</p></li></ul></div><div id=denmark class=paragraph><p><strong>Denmark</strong></p></div><div class=paragraph><p>In case of problems, please contact the hostmaster <code>&lt;<a href=mailto:staff@dotsrc.org>staff@dotsrc.org</a>></code> for this domain.</p></div><div class=ulist><ul><li><p><a href=ftp://ftp.dk.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp.dk.FreeBSD.org/pub/FreeBSD/</a> (ftp / ftpv6 / <a href=http://ftp.dk.FreeBSD.org/pub/FreeBSD/ class=bare>http://ftp.dk.FreeBSD.org/pub/FreeBSD/</a> / <a href=http://ftp.dk.FreeBSD.org/pub/FreeBSD/ class=bare>http://ftp.dk.FreeBSD.org/pub/FreeBSD/</a>)</p></li></ul></div><div id=estonia class=paragraph><p><strong>Estonia</strong></p></div><div class=paragraph><p>In case of problems, please contact the hostmaster <code>&lt;<a href=mailto:hostmaster@ee.FreeBSD.org>hostmaster@ee.FreeBSD.org</a>></code> for this domain.</p></div><div class=ulist><ul><li><p><a href=ftp://ftp.ee.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp.ee.FreeBSD.org/pub/FreeBSD/</a> (ftp)</p></li></ul></div><div id=finland class=paragraph><p><strong>Finland</strong></p></div><div class=paragraph><p>In case of problems, please contact the hostmaster <code>&lt;<a href=mailto:hostmaster@fi.FreeBSD.org>hostmaster@fi.FreeBSD.org</a>></code> for this domain.</p></div><div class=ulist><ul><li><p><a href=ftp://ftp.fi.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp.fi.FreeBSD.org/pub/FreeBSD/</a> (ftp)</p></li></ul></div><div id=france class=paragraph><p><strong>France</strong></p></div><div class=paragraph><p>In case of problems, please contact the hostmaster <code>&lt;<a href=mailto:hostmaster@fr.FreeBSD.org>hostmaster@fr.FreeBSD.org</a>></code> for this domain.</p></div><div class=ulist><ul><li><p><a href=ftp://ftp.fr.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp.fr.FreeBSD.org/pub/FreeBSD/</a> (ftp)</p></li><li><p><a href=ftp://ftp1.fr.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp1.fr.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a href=http://ftp1.fr.FreeBSD.org/pub/FreeBSD/ class=bare>http://ftp1.fr.FreeBSD.org/pub/FreeBSD/</a> / rsync)</p></li><li><p><a href=ftp://ftp3.fr.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp3.fr.FreeBSD.org/pub/FreeBSD/</a> (ftp)</p></li><li><p><a href=ftp://ftp6.fr.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp6.fr.FreeBSD.org/pub/FreeBSD/</a> (ftp)</p></li><li><p><a href=ftp://ftp6.fr.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp6.fr.FreeBSD.org/pub/FreeBSD/</a> (ftp / rsync)</p></li><li><p><a href=ftp://ftp7.fr.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp7.fr.FreeBSD.org/pub/FreeBSD/</a> (ftp)</p></li><li><p><a href=ftp://ftp8.fr.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp8.fr.FreeBSD.org/pub/FreeBSD/</a> (ftp)</p></li></ul></div><div id=germany class=paragraph><p><strong>Germany</strong></p></div><div class=paragraph><p>In case of problems, please contact the hostmaster <code>&lt;<a href=mailto:de-bsd-hubs@de.FreeBSD.org>de-bsd-hubs@de.FreeBSD.org</a>></code> for this domain.</p></div><div class=ulist><ul><li><p><a href=ftp://ftp.de.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp.de.FreeBSD.org/pub/FreeBSD/</a> (ftp)</p></li><li><p><a href=ftp://ftp1.de.FreeBSD.org/freebsd/ class=bare>ftp://ftp1.de.FreeBSD.org/freebsd/</a> (ftp / <a href=http://www1.de.FreeBSD.org/freebsd/ class=bare>http://www1.de.FreeBSD.org/freebsd/</a> / rsync://rsync3.de.FreeBSD.org/freebsd/)</p></li><li><p><a href=ftp://ftp2.de.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp2.de.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a href=http://ftp2.de.FreeBSD.org/pub/FreeBSD/ class=bare>http://ftp2.de.FreeBSD.org/pub/FreeBSD/</a> / rsync)</p></li><li><p><a href=ftp://ftp4.de.FreeBSD.org/FreeBSD/ class=bare>ftp://ftp4.de.FreeBSD.org/FreeBSD/</a> (ftp / <a href=http://ftp4.de.FreeBSD.org/pub/FreeBSD/ class=bare>http://ftp4.de.FreeBSD.org/pub/FreeBSD/</a>)</p></li><li><p><a href=ftp://ftp5.de.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp5.de.FreeBSD.org/pub/FreeBSD/</a> (ftp)</p></li><li><p><a href=ftp://ftp7.de.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp7.de.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a href=http://ftp7.de.FreeBSD.org/pub/FreeBSD/ class=bare>http://ftp7.de.FreeBSD.org/pub/FreeBSD/</a>)</p></li></ul></div><div id=greece class=paragraph><p><strong>Greece</strong></p></div><div class=paragraph><p>In case of problems, please contact the hostmaster <code>&lt;<a href=mailto:hostmaster@gr.FreeBSD.org>hostmaster@gr.FreeBSD.org</a>></code> for this domain.</p></div><div class=ulist><ul><li><p><a href=ftp://ftp.gr.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp.gr.FreeBSD.org/pub/FreeBSD/</a> (ftp)</p></li><li><p><a href=ftp://ftp2.gr.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp2.gr.FreeBSD.org/pub/FreeBSD/</a> (ftp)</p></li></ul></div><div id=hong-kong class=paragraph><p><strong>Hong Kong</strong></p></div><div class=paragraph><p><a href=ftp://ftp.hk.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp.hk.FreeBSD.org/pub/FreeBSD/</a> (ftp)</p></div><div id=ireland class=paragraph><p><strong>Ireland</strong></p></div><div class=paragraph><p>In case of problems, please contact the hostmaster <code>&lt;<a href=mailto:hostmaster@ie.FreeBSD.org>hostmaster@ie.FreeBSD.org</a>></code> for this domain.</p></div><div class=ulist><ul><li><p><a href=ftp://ftp3.ie.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp3.ie.FreeBSD.org/pub/FreeBSD/</a> (ftp / rsync)</p></li></ul></div><div id=japan class=paragraph><p><strong>Japan</strong></p></div><div class=paragraph><p>In case of problems, please contact the hostmaster <code>&lt;<a href=mailto:hostmaster@jp.FreeBSD.org>hostmaster@jp.FreeBSD.org</a>></code> for this domain.</p></div><div class=ulist><ul><li><p><a href=ftp://ftp.jp.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp.jp.FreeBSD.org/pub/FreeBSD/</a> (ftp)</p></li><li><p><a href=ftp://ftp2.jp.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp2.jp.FreeBSD.org/pub/FreeBSD/</a> (ftp)</p></li><li><p><a href=ftp://ftp3.jp.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp3.jp.FreeBSD.org/pub/FreeBSD/</a> (ftp)</p></li><li><p><a href=ftp://ftp4.jp.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp4.jp.FreeBSD.org/pub/FreeBSD/</a> (ftp)</p></li><li><p><a href=ftp://ftp5.jp.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp5.jp.FreeBSD.org/pub/FreeBSD/</a> (ftp)</p></li><li><p><a href=ftp://ftp6.jp.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp6.jp.FreeBSD.org/pub/FreeBSD/</a> (ftp)</p></li><li><p><a href=ftp://ftp7.jp.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp7.jp.FreeBSD.org/pub/FreeBSD/</a> (ftp)</p></li><li><p><a href=ftp://ftp8.jp.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp8.jp.FreeBSD.org/pub/FreeBSD/</a> (ftp)</p></li><li><p><a href=ftp://ftp9.jp.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp9.jp.FreeBSD.org/pub/FreeBSD/</a> (ftp)</p></li></ul></div><div id=korea class=paragraph><p><strong>Korea</strong></p></div><div class=paragraph><p>In case of problems, please contact the hostmaster <code>&lt;<a href=mailto:hostmaster@kr.FreeBSD.org>hostmaster@kr.FreeBSD.org</a>></code> for this domain.</p></div><div class=ulist><ul><li><p><a href=ftp://ftp.kr.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp.kr.FreeBSD.org/pub/FreeBSD/</a> (ftp / rsync)</p></li><li><p><a href=ftp://ftp2.kr.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp2.kr.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a href=http://ftp2.kr.FreeBSD.org/pub/FreeBSD/ class=bare>http://ftp2.kr.FreeBSD.org/pub/FreeBSD/</a>)</p></li></ul></div><div id=latvia class=paragraph><p><strong>Latvia</strong></p></div><div class=paragraph><p>In case of problems, please contact the hostmaster <code>&lt;<a href=mailto:hostmaster@lv.FreeBSD.org>hostmaster@lv.FreeBSD.org</a>></code> for this domain.</p></div><div class=ulist><ul><li><p><a href=ftp://ftp.lv.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp.lv.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a href=http://ftp.lv.FreeBSD.org/pub/FreeBSD/ class=bare>http://ftp.lv.FreeBSD.org/pub/FreeBSD/</a>)</p></li></ul></div><div id=lithuania class=paragraph><p><strong>Lithuania</strong></p></div><div class=paragraph><p>In case of problems, please contact the hostmaster <code>&lt;<a href=mailto:hostmaster@lt.FreeBSD.org>hostmaster@lt.FreeBSD.org</a>></code> for this domain.</p></div><div class=ulist><ul><li><p><a href=ftp://ftp.lt.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp.lt.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a href=http://ftp.lt.FreeBSD.org/pub/FreeBSD/ class=bare>http://ftp.lt.FreeBSD.org/pub/FreeBSD/</a>)</p></li></ul></div><div id=netherlands class=paragraph><p><strong>Netherlands</strong></p></div><div class=paragraph><p>In case of problems, please contact the hostmaster <code>&lt;<a href=mailto:hostmaster@nl.FreeBSD.org>hostmaster@nl.FreeBSD.org</a>></code> for this domain.</p></div><div class=ulist><ul><li><p><a href=ftp://ftp.nl.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp.nl.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a href=http://ftp.nl.FreeBSD.org/os/FreeBSD/ class=bare>http://ftp.nl.FreeBSD.org/os/FreeBSD/</a> / rsync)</p></li><li><p><a href=ftp://ftp2.nl.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp2.nl.FreeBSD.org/pub/FreeBSD/</a> (ftp)</p></li></ul></div><div id=new-zealand class=paragraph><p><strong>New Zealand</strong></p></div><div class=ulist><ul><li><p><a href=ftp://ftp.nz.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp.nz.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a href=http://ftp.nz.FreeBSD.org/pub/FreeBSD/ class=bare>http://ftp.nz.FreeBSD.org/pub/FreeBSD/</a>)</p></li></ul></div><div id=norway class=paragraph><p><strong>Norway</strong></p></div><div class=paragraph><p>In case of problems, please contact the hostmaster <code>&lt;<a href=mailto:hostmaster@no.FreeBSD.org>hostmaster@no.FreeBSD.org</a>></code> for this domain.</p></div><div class=ulist><ul><li><p><a href=ftp://ftp.no.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp.no.FreeBSD.org/pub/FreeBSD/</a> (ftp / rsync)</p></li></ul></div><div id=poland class=paragraph><p><strong>Poland</strong></p></div><div class=paragraph><p>In case of problems, please contact the hostmaster <code>&lt;<a href=mailto:hostmaster@pl.FreeBSD.org>hostmaster@pl.FreeBSD.org</a>></code> for this domain.</p></div><div class=ulist><ul><li><p><a href=ftp://ftp.pl.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp.pl.FreeBSD.org/pub/FreeBSD/</a> (ftp)</p></li><li><p>ftp2.pl.FreeBSD.org</p></li></ul></div><div id=russia class=paragraph><p><strong>Russia</strong></p></div><div class=paragraph><p>In case of problems, please contact the hostmaster <code>&lt;<a href=mailto:hostmaster@ru.FreeBSD.org>hostmaster@ru.FreeBSD.org</a>></code> for this domain.</p></div><div class=ulist><ul><li><p><a href=ftp://ftp.ru.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp.ru.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a href=http://ftp.ru.FreeBSD.org/FreeBSD/ class=bare>http://ftp.ru.FreeBSD.org/FreeBSD/</a> / rsync)</p></li><li><p><a href=ftp://ftp2.ru.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp2.ru.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a href=http://ftp2.ru.FreeBSD.org/pub/FreeBSD/ class=bare>http://ftp2.ru.FreeBSD.org/pub/FreeBSD/</a> / rsync)</p></li><li><p><a href=ftp://ftp5.ru.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp5.ru.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a href=http://ftp5.ru.FreeBSD.org/pub/FreeBSD/ class=bare>http://ftp5.ru.FreeBSD.org/pub/FreeBSD/</a> / rsync)</p></li><li><p><a href=ftp://ftp6.ru.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp6.ru.FreeBSD.org/pub/FreeBSD/</a> (ftp)</p></li></ul></div><div id=saudi-arabia class=paragraph><p><strong>Saudi Arabia</strong></p></div><div class=paragraph><p>In case of problems, please contact the hostmaster <code>&lt;<a href=mailto:ftpadmin@isu.net.sa>ftpadmin@isu.net.sa</a>></code> for this domain.</p></div><div class=ulist><ul><li><p><a href=ftp://ftp.isu.net.sa/pub/ftp.freebsd.org class=bare>ftp://ftp.isu.net.sa/pub/ftp.freebsd.org</a> (ftp)</p></li></ul></div><div id=slovenia class=paragraph><p><strong>Slovenia</strong></p></div><div class=paragraph><p>In case of problems, please contact the hostmaster <code>&lt;<a href=mailto:hostmaster@si.FreeBSD.org>hostmaster@si.FreeBSD.org</a>></code> for this domain.</p></div><div class=ulist><ul><li><p><a href=ftp://ftp.si.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp.si.FreeBSD.org/pub/FreeBSD/</a> (ftp)</p></li></ul></div><div id=south-africa class=paragraph><p><strong>South Africa</strong></p></div><div class=paragraph><p>In case of problems, please contact the hostmaster <code>&lt;<a href=mailto:hostmaster@za.FreeBSD.org>hostmaster@za.FreeBSD.org</a>></code> for this domain.</p></div><div class=ulist><ul><li><p><a href=ftp://ftp.za.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp.za.FreeBSD.org/pub/FreeBSD/</a> (ftp)</p></li><li><p><a href=ftp://ftp2.za.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp2.za.FreeBSD.org/pub/FreeBSD/</a> (ftp)</p></li><li><p><a href=ftp://ftp4.za.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp4.za.FreeBSD.org/pub/FreeBSD/</a> (ftp)</p></li></ul></div><div id=spain class=paragraph><p><strong>Spain</strong></p></div><div class=paragraph><p>In case of problems, please contact the hostmaster <code>&lt;<a href=mailto:hostmaster@es.FreeBSD.org>hostmaster@es.FreeBSD.org</a>></code> for this domain.</p></div><div class=ulist><ul><li><p><a href=ftp://ftp.es.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp.es.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a href=http://ftp.es.FreeBSD.org/pub/FreeBSD/ class=bare>http://ftp.es.FreeBSD.org/pub/FreeBSD/</a>)</p></li><li><p><a href=ftp://ftp3.es.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp3.es.FreeBSD.org/pub/FreeBSD/</a> (ftp)</p></li></ul></div><div id=sweden class=paragraph><p><strong>Sweden</strong></p></div><div class=paragraph><p>In case of problems, please contact the hostmaster <code>&lt;<a href=mailto:hostmaster@se.FreeBSD.org>hostmaster@se.FreeBSD.org</a>></code> for this domain.</p></div><div class=ulist><ul><li><p><a href=ftp://ftp.se.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp.se.FreeBSD.org/pub/FreeBSD/</a> (ftp)</p></li><li><p><a href=ftp://ftp2.se.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp2.se.FreeBSD.org/pub/FreeBSD/</a> (ftp / rsync://ftp2.se.FreeBSD.org/)</p></li><li><p><a href=ftp://ftp3.se.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp3.se.FreeBSD.org/pub/FreeBSD/</a> (ftp)</p></li><li><p><a href=ftp://ftp4.se.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp4.se.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a href=ftp://ftp4.se.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp4.se.FreeBSD.org/pub/FreeBSD/</a> / <a href=http://ftp4.se.FreeBSD.org/pub/FreeBSD/ class=bare>http://ftp4.se.FreeBSD.org/pub/FreeBSD/</a> / <a href=http://ftp4.se.FreeBSD.org/pub/FreeBSD/ class=bare>http://ftp4.se.FreeBSD.org/pub/FreeBSD/</a> / rsync://ftp4.se.FreeBSD.org/pub/FreeBSD/ / rsync://ftp4.se.FreeBSD.org/pub/FreeBSD/)</p></li><li><p><a href=ftp://ftp6.se.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp6.se.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a href=http://ftp6.se.FreeBSD.org/pub/FreeBSD/ class=bare>http://ftp6.se.FreeBSD.org/pub/FreeBSD/</a>)</p></li></ul></div><div id=switzerland class=paragraph><p><strong>Switzerland</strong></p></div><div class=paragraph><p>In case of problems, please contact the hostmaster <code>&lt;<a href=mailto:hostmaster@ch.FreeBSD.org>hostmaster@ch.FreeBSD.org</a>></code> for this domain.</p></div><div class=ulist><ul><li><p><a href=ftp://ftp.ch.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp.ch.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a href=http://ftp.ch.FreeBSD.org/pub/FreeBSD/ class=bare>http://ftp.ch.FreeBSD.org/pub/FreeBSD/</a>)</p></li></ul></div><div id=taiwan class=paragraph><p><strong>Taiwan</strong></p></div><div class=paragraph><p>In case of problems, please contact the hostmaster <code>&lt;<a href=mailto:hostmaster@tw.FreeBSD.org>hostmaster@tw.FreeBSD.org</a>></code> for this domain.</p></div><div class=ulist><ul><li><p><a href=ftp://ftp.ch.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp.ch.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a href=ftp://ftp.tw.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp.tw.FreeBSD.org/pub/FreeBSD/</a> / rsync / rsyncv6)</p></li><li><p><a href=ftp://ftp2.tw.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp2.tw.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a href=ftp://ftp2.tw.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp2.tw.FreeBSD.org/pub/FreeBSD/</a> / <a href=http://ftp2.tw.FreeBSD.org/pub/FreeBSD/ class=bare>http://ftp2.tw.FreeBSD.org/pub/FreeBSD/</a> / <a href=http://ftp2.tw.FreeBSD.org/pub/FreeBSD/ class=bare>http://ftp2.tw.FreeBSD.org/pub/FreeBSD/</a> / rsync / rsyncv6)</p></li><li><p><a href=ftp://ftp4.tw.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp4.tw.FreeBSD.org/pub/FreeBSD/</a> (ftp)</p></li><li><p><a href=ftp://ftp5.tw.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp5.tw.FreeBSD.org/pub/FreeBSD/</a> (ftp)</p></li><li><p><a href=ftp://ftp6.tw.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp6.tw.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a href=http://ftp6.tw.FreeBSD.org/ class=bare>http://ftp6.tw.FreeBSD.org/</a> / rsync)</p></li><li><p><a href=ftp://ftp7.tw.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp7.tw.FreeBSD.org/pub/FreeBSD/</a> (ftp)</p></li><li><p><a href=ftp://ftp8.tw.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp8.tw.FreeBSD.org/pub/FreeBSD/</a> (ftp)</p></li><li><p><a href=ftp://ftp11.tw.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp11.tw.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a href=http://ftp11.tw.FreeBSD.org/FreeBSD/ class=bare>http://ftp11.tw.FreeBSD.org/FreeBSD/</a>)</p></li><li><p><a href=ftp://ftp12.tw.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp12.tw.FreeBSD.org/pub/FreeBSD/</a> (ftp)</p></li><li><p><a href=ftp://ftp13.tw.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp13.tw.FreeBSD.org/pub/FreeBSD/</a> (ftp)</p></li><li><p><a href=ftp://ftp14.tw.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp14.tw.FreeBSD.org/pub/FreeBSD/</a> (ftp)</p></li><li><p><a href=ftp://ftp15.tw.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp15.tw.FreeBSD.org/pub/FreeBSD/</a> (ftp)</p></li></ul></div><div id=ukraine class=paragraph><p><strong>Ukraine</strong></p></div><div class=ulist><ul><li><p><a href=ftp://ftp.ua.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp.ua.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a href=http://ftp.ua.FreeBSD.org/pub/FreeBSD/ class=bare>http://ftp.ua.FreeBSD.org/pub/FreeBSD/</a>)</p></li><li><p><a href=ftp://ftp6.ua.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp6.ua.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a href=http://ftp6.ua.FreeBSD.org/pub/FreeBSD class=bare>http://ftp6.ua.FreeBSD.org/pub/FreeBSD</a> / rsync://ftp6.ua.FreeBSD.org/FreeBSD/)</p></li><li><p><a href=ftp://ftp7.ua.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp7.ua.FreeBSD.org/pub/FreeBSD/</a> (ftp)</p></li></ul></div><div id=uk class=paragraph><p><strong>United Kingdom</strong></p></div><div class=paragraph><p>In case of problems, please contact the hostmaster <code>&lt;<a href=mailto:hostmaster@uk.FreeBSD.org>hostmaster@uk.FreeBSD.org</a>></code> for this domain.</p></div><div class=ulist><ul><li><p><a href=ftp://ftp.uk.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp.uk.FreeBSD.org/pub/FreeBSD/</a> (ftp)</p></li><li><p><a href=ftp://ftp2.uk.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp2.uk.FreeBSD.org/pub/FreeBSD/</a> (ftp / rsync://ftp2.uk.FreeBSD.org/ftp.freebsd.org/pub/FreeBSD/)</p></li><li><p><a href=ftp://ftp3.uk.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp3.uk.FreeBSD.org/pub/FreeBSD/</a> (ftp)</p></li><li><p><a href=ftp://ftp4.uk.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp4.uk.FreeBSD.org/pub/FreeBSD/</a> (ftp)</p></li><li><p><a href=ftp://ftp5.uk.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp5.uk.FreeBSD.org/pub/FreeBSD/</a> (ftp)</p></li></ul></div><div id=usa class=paragraph><p><strong>United States of America</strong></p></div><div class=paragraph><p>In case of problems, please contact the hostmaster <code>&lt;<a href=mailto:hostmaster@us.FreeBSD.org>hostmaster@us.FreeBSD.org</a>></code> for this domain.</p></div><div class=ulist><ul><li><p><a href=ftp://ftp1.us.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp1.us.FreeBSD.org/pub/FreeBSD/</a> (ftp)</p></li><li><p><a href=ftp://ftp2.us.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp2.us.FreeBSD.org/pub/FreeBSD/</a> (ftp)</p></li><li><p><a href=ftp://ftp3.us.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp3.us.FreeBSD.org/pub/FreeBSD/</a> (ftp)</p></li><li><p><a href=ftp://ftp4.us.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp4.us.FreeBSD.org/pub/FreeBSD/</a> (ftp / ftpv6 / <a href=http://ftp4.us.FreeBSD.org/pub/FreeBSD/ class=bare>http://ftp4.us.FreeBSD.org/pub/FreeBSD/</a> / <a href=http://ftp4.us.FreeBSD.org/pub/FreeBSD/ class=bare>http://ftp4.us.FreeBSD.org/pub/FreeBSD/</a>)</p></li><li><p><a href=ftp://ftp5.us.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp5.us.FreeBSD.org/pub/FreeBSD/</a> (ftp)</p></li><li><p><a href=ftp://ftp6.us.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp6.us.FreeBSD.org/pub/FreeBSD/</a> (ftp)</p></li><li><p><a href=ftp://ftp8.us.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp8.us.FreeBSD.org/pub/FreeBSD/</a> (ftp)</p></li><li><p><a href=ftp://ftp10.us.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp10.us.FreeBSD.org/pub/FreeBSD/</a> (ftp)</p></li><li><p><a href=ftp://ftp11.us.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp11.us.FreeBSD.org/pub/FreeBSD/</a> (ftp)</p></li><li><p><a href=ftp://ftp13.us.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp13.us.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a href=http://ftp13.us.FreeBSD.org/pub/FreeBSD/ class=bare>http://ftp13.us.FreeBSD.org/pub/FreeBSD/</a> / rsync)</p></li><li><p><a href=ftp://ftp14.us.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp14.us.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a href=http://ftp14.us.FreeBSD.org/pub/FreeBSD/ class=bare>http://ftp14.us.FreeBSD.org/pub/FreeBSD/</a>)</p></li><li><p><a href=ftp://ftp15.us.FreeBSD.org/pub/FreeBSD/ class=bare>ftp://ftp15.us.FreeBSD.org/pub/FreeBSD/</a> (ftp)</p></li></ul></div></div><div class=sect2><h3 id=svn>A.3. Using Subversion<a class=anchor href=#svn></a></h3><div class=sect3><h4 id=svn-intro>A.3.1. Introduction<a class=anchor href=#svn-intro></a></h4><div class=paragraph><p>As of July 2012, FreeBSD uses Subversion as the only version control system for storing all of FreeBSD’s source code, documentation, and the Ports Collection.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Subversion is generally a developer tool. Users may prefer to use <code>freebsd-update</code> (<a href=./#updating-upgrading-freebsdupdate>“FreeBSD Update”</a>) to update the FreeBSD base system, and <code>portsnap</code> (<a href=./#ports-using>“Using the Ports Collection”</a>) to update the FreeBSD Ports Collection.</p></div></td></tr></tbody></table></div><div class=paragraph><p>This section demonstrates how to install Subversion on a FreeBSD system and use it to create a local copy of a FreeBSD repository. Additional information on the use of Subversion is included.</p></div></div><div class=sect3><h4 id=svn-ssl-certificates>A.3.2. Root SSL Certificates<a class=anchor href=#svn-ssl-certificates></a></h4><div class=paragraph><p>Installing <a class=package href=https://cgit.freebsd.org/ports/tree/security/ca_root_nss/>security/ca_root_nss</a> allows Subversion to verify the identity of HTTPS repository servers. The root SSL certificates can be installed from a port:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/ports/security/ca_root_nss</span>
<span class=c># make install clean</span></code></pre></div></div><div class=paragraph><p>or as a package:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pkg install ca_root_nss</span></code></pre></div></div></div><div class=sect3><h4 id=svn-svnlite>A.3.3. Svnlite<a class=anchor href=#svn-svnlite></a></h4><div class=paragraph><p>A lightweight version of Subversion is already installed on FreeBSD as <code>svnlite</code>. The port or package version of Subversion is only needed if the Python or Perl API is needed, or if a later version of Subversion is desired.</p></div><div class=paragraph><p>The only difference from normal Subversion use is that the command name is <code>svnlite</code>.</p></div></div><div class=sect3><h4 id=svn-install>A.3.4. Installation<a class=anchor href=#svn-install></a></h4><div class=paragraph><p>If <code>svnlite</code> is unavailable or the full version of Subversion is needed, then it must be installed.</p></div><div class=paragraph><p>Subversion can be installed from the Ports Collection:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/ports/devel/subversion</span>
<span class=c># make install clean</span></code></pre></div></div><div class=paragraph><p>Subversion can also be installed as a package:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pkg install subversion</span></code></pre></div></div></div><div class=sect3><h4 id=svn-usage>A.3.5. Running Subversion<a class=anchor href=#svn-usage></a></h4><div class=paragraph><p>To fetch a clean copy of the sources into a local directory, use <code>svn</code>. The files in this directory are called a <em>local working copy</em>.</p></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>Move or delete an existing destination directory before using <code>checkout</code> for the first time.</p></div><div class=paragraph><p>Checkout over an existing non-<code>svn</code> directory can cause conflicts between the existing files and those brought in from the repository.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Subversion uses URLs to designate a repository, taking the form of <em>protocol://hostname/path</em>. The first component of the path is the FreeBSD repository to access. There are three different repositories, <code>base</code> for the FreeBSD base system source code, <code>ports</code> for the Ports Collection, and <code>doc</code> for documentation. For example, the URL <code><a href=https://svn.FreeBSD.org/ports/head/ class=bare>https://svn.FreeBSD.org/ports/head/</a></code> specifies the main branch of the ports repository, using the <code>https</code> protocol.</p></div><div class=paragraph><p>A checkout from a given repository is performed with a command like this:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># svn checkout https://svn.FreeBSD.org/repository/branch lwcdir</span></code></pre></div></div><div class=paragraph><p>where:</p></div><div class=ulist><ul><li><p><em>repository</em> is one of the Project repositories: <code>base</code>, <code>ports</code>, or <code>doc</code>.</p></li><li><p><em>branch</em> depends on the repository used. <code>ports</code> and <code>doc</code> are mostly updated in the <code>head</code> branch, while <code>base</code> maintains the latest version of -CURRENT under <code>head</code> and the respective latest versions of the -STABLE branches under <code>stable/9</code> (9.<em>x</em>) and <code>stable/10</code> (10.<em>x</em>).</p></li><li><p><em>lwcdir</em> is the target directory where the contents of the specified branch should be placed. This is usually <span class=filename>/usr/ports</span> for <code>ports</code>, <span class=filename>/usr/src</span> for <code>base</code>, and <span class=filename>/usr/doc</span> for <code>doc</code>.</p></li></ul></div><div class=paragraph><p>This example checks out the Ports Collection from the FreeBSD repository using the HTTPS protocol, placing the local working copy in <span class=filename>/usr/ports</span>. If <span class=filename>/usr/ports</span> is already present but was not created by <code>svn</code>, remember to rename or delete it before the checkout.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># svn checkout https://svn.FreeBSD.org/ports/head /usr/ports</span></code></pre></div></div><div class=paragraph><p>Because the initial checkout must download the full branch of the remote repository, it can take a while. Please be patient.</p></div><div class=paragraph><p>After the initial checkout, the local working copy can be updated by running:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># svn update lwcdir</span></code></pre></div></div><div class=paragraph><p>To update <span class=filename>/usr/ports</span> created in the example above, use:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># svn update /usr/ports</span></code></pre></div></div><div class=paragraph><p>The update is much quicker than a checkout, only transferring files that have changed.</p></div><div class=paragraph><p>An alternate way of updating the local working copy after checkout is provided by the <span class=filename>Makefile</span> in the <span class=filename>/usr/ports</span>, <span class=filename>/usr/src</span>, and <span class=filename>/usr/doc</span> directories. Set <code>SVN_UPDATE</code> and use the <code>update</code> target. For example, to update <span class=filename>/usr/src</span>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/src</span>
<span class=c># make update SVN_UPDATE=yes</span></code></pre></div></div></div><div class=sect3><h4 id=svn-mirrors>A.3.6. Subversion Mirror Sites<a class=anchor href=#svn-mirrors></a></h4><div class=paragraph><p>The FreeBSD Subversion repository is:</p></div><div class="literalblock programlisting"><div class=content><pre>svn.FreeBSD.org</pre></div></div><div class=paragraph><p>This is a publicly accessible mirror network that uses GeoDNS to select an appropriate back end server. To view the FreeBSD Subversion repositories through a browser, use <a href=https://svnweb.FreeBSD.org/>https://svnweb.FreeBSD.org/</a>.</p></div><div class=paragraph><p>HTTPS is the preferred protocol, but the <span class=filename>security/ca_root_nss</span> package will need to be installed in order to automatically validate certificates.</p></div></div><div class=sect3><h4 id=_for_more_information_2>A.3.7. For More Information<a class=anchor href=#_for_more_information_2></a></h4><div class=paragraph><p>For other information about using Subversion, please see the "Subversion Book", titled <a href=http://svnbook.red-bean.com/>Version Control with Subversion</a>, or the <a href=http://subversion.apache.org/docs/>Subversion Documentation</a>.</p></div></div></div><div class=sect2><h3 id=mirrors-rsync>A.4. Using rsync<a class=anchor href=#mirrors-rsync></a></h3><div class=paragraph><p>These sites make FreeBSD available through the rsync protocol. The rsync utility transfers only the differences between two sets of files. This is useful for mirror sites of the FreeBSD FTP server. The rsync suite is available for many operating systems, on FreeBSD, see the <a class=package href=https://cgit.freebsd.org/ports/tree/net/rsync/>net/rsync</a> port or use the package.</p></div><div class=dlist><dl><dt class=hdlist1>Czech Republic</dt><dd><p>rsync://ftp.cz.FreeBSD.org/</p><div class=paragraph><p>Available collections:</p></div><div class=ulist><ul><li><p>ftp: A partial mirror of the FreeBSD FTP server.</p></li><li><p>FreeBSD: A full mirror of the FreeBSD FTP server.</p></li></ul></div></dd><dt class=hdlist1>Netherlands</dt><dd><p>rsync://ftp.nl.FreeBSD.org/</p><div class=paragraph><p>Available collections:</p></div><div class=ulist><ul><li><p>FreeBSD: A full mirror of the FreeBSD FTP server.</p></li></ul></div></dd><dt class=hdlist1>Russia</dt><dd><p>rsync://ftp.mtu.ru/</p><div class=paragraph><p>Available collections:</p></div><div class=ulist><ul><li><p>FreeBSD: A full mirror of the FreeBSD FTP server.</p></li><li><p>FreeBSD-Archive: The mirror of FreeBSD Archive FTP server.</p></li></ul></div></dd><dt class=hdlist1>Sweden</dt><dd><p>rsync://ftp4.se.freebsd.org/</p><div class=paragraph><p>Available collections:</p></div><div class=ulist><ul><li><p>FreeBSD: A full mirror of the FreeBSD FTP server.</p></li></ul></div></dd><dt class=hdlist1>Taiwan</dt><dd><p>rsync://ftp.tw.FreeBSD.org/</p><div class=paragraph><p>rsync://ftp2.tw.FreeBSD.org/</p></div><div class=paragraph><p>rsync://ftp6.tw.FreeBSD.org/</p></div><div class=paragraph><p>Available collections:</p></div><div class=ulist><ul><li><p>FreeBSD: A full mirror of the FreeBSD FTP server.</p></li></ul></div></dd><dt class=hdlist1>United Kingdom</dt><dd><p>rsync://rsync.mirrorservice.org/</p><div class=paragraph><p>Available collections:</p></div><div class=ulist><ul><li><p>ftp.freebsd.org: A full mirror of the FreeBSD FTP server.</p></li></ul></div></dd><dt class=hdlist1>United States of America</dt><dd><p>rsync://ftp-master.FreeBSD.org/</p><div class=paragraph><p>This server may only be used by FreeBSD primary mirror sites.</p></div><div class=paragraph><p>Available collections:</p></div><div class=ulist><ul><li><p>FreeBSD: The master archive of the FreeBSD FTP server.</p></li><li><p>acl: The FreeBSD master ACL list.</p><div class=paragraph><p>rsync://ftp13.FreeBSD.org/</p></div><div class=paragraph><p>Available collections:</p></div></li><li><p>FreeBSD: A full mirror of the FreeBSD FTP server.</p></li></ul></div></dd></dl></div></div></div></div><div class=sect1><h2 id=bibliography>Dodatek B: Bibliografia<a class=anchor href=#bibliography></a></h2><div class=sectionbody><div class=paragraph><p>Podczas gdy strony podręcznika systemowego dostarczają szczegółowych informacji odnośnie każdego z elementów systemu operacyjnego FreeBSD, bardzo często nie przedstawiają one jak złożyć wszystkie te elementy razem tak, by usprawnić pracę całego systemu. Z tego właśnie powodu nie istnieje żaden substytut dobrej książki o administracji systemami UNIX® i dobrego podręcznika ich użytkowania.</p></div><div class=sect2><h3 id=bibliography-freebsd>B.1. Książki i czasopisma poświęcone FreeBSD<a class=anchor href=#bibliography-freebsd></a></h3><div class=paragraph><p><em>Międzynarodowe książki i czasopisma:</em></p></div><div class=ulist><ul><li><p><a href=http://jdli.tw.freebsd.org/publication/book/freebsd2/index.htm>Using FreeBSD</a> (po chińsku).</p></li><li><p>FreeBSD Unleashed (chiński przekład), wydany przez <a href=http://www.hzbook.com/>China Machine Press</a>. ISBN 7-111-10201-0.</p></li><li><p>FreeBSD From Scratch First Edition (po chińsku), wydany przez China Machine Press. ISBN 7-111-07482-3.</p></li><li><p>FreeBSD From Scratch Second Edition (po chińsku), wydany przez China Machine Press. ISBN 7-111-10286-X.</p></li><li><p>FreeBSD Handbook (chiński przekład), wydany przez <a href=http://www.ptpress.com.cn/>Posts & Telecom Press</a>. ISBN 7-115-10541-3.</p></li><li><p>FreeBSD 3.x Internet (po chińsku), wydany przez <a href=http://www.tup.tsinghua.edu.cn/>Tsinghua University Press</a>. ISBN 7-900625-66-6.</p></li><li><p>FreeBSD & Windows (po chińsku), ISBN 7-113-03845-X</p></li><li><p>FreeBSD Internet Services HOWTO (po chińsku), ISBN 7-113-03423-3</p></li><li><p>FreeBSD for PC 98’ers (po japońsku), wydany przez SHUWA System Co, LTD. ISBN 4-87966-468-5 C3055 P2900E.</p></li><li><p>FreeBSD (po japońsku), wydany przez CUTT. ISBN 4-906391-22-2 C3055 P2400E.</p></li><li><p><a href="http://www.shoeisha.com/book/Detail.asp?bid=650">Complete Introduction to FreeBSD</a> (po japońsku), wydany przez <a href=http://www.shoeisha.co.jp/>Shoeisha Co., Ltd</a>. ISBN 4-88135-473-6 P3600E.</p></li><li><p><a href=http://www.ascii.co.jp/pb/book1/shinkan/detail/1322785.html>Personal UNIX Starter Kit FreeBSD</a> (po japońsku), wydany przez <a href=http://www.ascii.co.jp/>ASCII</a>. ISBN 4-7561-1733-3 P3000E.</p></li><li><p>FreeBSD Handbook (japoński przekład), wydany przez <a href=http://www.ascii.co.jp/>ASCII</a>. ISBN 4-7561-1580-2 P3800E.</p></li><li><p>FreeBSD mit Methode (po niemiecku), wydany przez <a href=http://www.cul.de/>Computer und Literatur Verlag</a>/Vertrieb Hanser, 1998. ISBN 3-932311-31-0.</p></li><li><p><a href=http://www.cul.de/freebsd.html>FreeBSD 4 - Installieren, Konfigurieren, Administrieren</a> (po niemiecku), wydany przez <a href=http://www.cul.de/>Computer und Literatur Verlag</a>, 2001. ISBN 3-932311-88-4.</p></li><li><p><a href=http://www.cul.de/freebsd.html>FreeBSD 5 - Installieren, Konfigurieren, Administrieren</a> (po niemiecku), wydany przez <a href=http://www.cul.de/>Computer und Literatur Verlag</a>, 2003. ISBN 3-936546-06-1.</p></li><li><p><a href=http://www.mitp.de/vmi/mitp/detail/pWert/1343/>FreeBSD de Luxe</a> (po niemiecku), wydany przez <a href=http://www.mitp.de/>Verlag Modere Industrie</a>, 2003. ISBN 3-8266-1343-0.</p></li><li><p><a href=http://www.pc.mycom.co.jp/FreeBSD/install-manual.html>FreeBSD Install and Utilization Manual</a> (po japońsku), wydany przez <a href=http://www.pc.mycom.co.jp/>Mainichi Communications Inc.</a>.</p></li><li><p>Onno W Purbo, Dodi Maryanto, Syahrial Hubbany, Widjil Widodo <a href=http://maxwell.itb.ac.id/>Building Internet Server with FreeBSD</a> (w języku indonezyjskim), wydany przez <a href=http://www.elexmedia.co.id/>Elex Media Komputindo</a>.</p></li></ul></div><div class=paragraph><p>Książki i czasopisma w języku angielskim:</p></div><div class=ulist><ul><li><p><a href=http://www.absolutebsd.com/>Absolute BSD: The Ultimate Guide to FreeBSD</a>, wydany przez <a href=http://www.nostarch.com/>No Starch Press</a>, 2002. ISBN: 1886411743</p></li><li><p><a href=http://www.freebsdmall.com/cgi-bin/fm/bsdcomp>The Complete FreeBSD</a>, wydany przez <a href=http://www.oreilly.com/>O’Reilly</a>, 2003. ISBN: 0596005164</p></li><li><p><a href=http://www.freebsd-corp-net-guide.com/>The FreeBSD Corporate Networker’s Guide</a>, wydany przez <a href=http://www.awl.com/aw/>Addison-Wesley</a>, 2000. ISBN: 0201704811</p></li><li><p><a href=http://andrsn.stanford.edu/FreeBSD/introbook/>FreeBSD: An Open-Source Operating System for Your Personal Computer</a>, wydany przez The Bit Tree Press, 2001. ISBN: 0971204500</p></li><li><p>Teach Yourself FreeBSD in 24 Hours, wydany przez <a href=http://www.samspublishing.com/>Sams</a>, 2002. ISBN: 0672324245</p></li><li><p>FreeBSD unleashed, wydany przez <a href=http://www.samspublishing.com/>Sams</a>, 2002. ISBN: 0672324563</p></li><li><p>FreeBSD: The Complete Reference, wydany przez <a href=http://books.mcgraw-hill.com/>McGrawHill</a>, 2003. ISBN: 0072224096</p></li></ul></div></div></div></div><div class=sect1><h2 id=eresources>Dodatek C: Resources on the Internet<a class=anchor href=#eresources></a></h2><div class=sectionbody><div class=paragraph><p>The rapid pace of FreeBSD progress makes print media impractical as a means of following the latest developments. Electronic resources are the best, if not often the only, way to stay informed of the latest advances. Since FreeBSD is a volunteer effort, the user community itself also generally serves as a "technical support department" of sorts, with electronic mail, web forums, and USENET news being the most effective way of reaching that community.</p></div><div class=paragraph><p>The most important points of contact with the FreeBSD user community are outlined below. Please send other resources not mentioned here to the <a href=https://lists.FreeBSD.org/subscription/freebsd-doc>FreeBSD documentation project mailing list</a> so that they may also be included.</p></div><div class=sect2><h3 id=eresources-www>C.1. Websites<a class=anchor href=#eresources-www></a></h3><div class=ulist><ul><li><p><a href=https://forums.FreeBSD.org/>The FreeBSD Forums</a> provide a web based discussion forum for FreeBSD questions and technical discussion.</p></li><li><p>The <a href=http://www.youtube.com/bsdconferences>BSDConferences YouTube Channel</a> provides a collection of high quality videos from BSD conferences around the world. This is a great way to watch key developers give presentations about new work in FreeBSD.</p></li></ul></div></div><div class=sect2><h3 id=eresources-mail>C.2. Mailing Lists<a class=anchor href=#eresources-mail></a></h3><div class=paragraph><p>The mailing lists are the most direct way of addressing questions or opening a technical discussion to a concentrated FreeBSD audience. There are a wide variety of lists on a number of different FreeBSD topics. Sending questions to the most appropriate mailing list will invariably assure a faster and more accurate response.</p></div><div class=paragraph><p>The charters for the various lists are given at the bottom of this document. <em>Please read the charter before joining or sending mail to any list</em>. Most list subscribers receive many hundreds of FreeBSD related messages every day, and the charters and rules for use are meant to keep the signal-to-noise ratio of the lists high. To do less would see the mailing lists ultimately fail as an effective communications medium for the Project.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p><em>To test the ability to send email to FreeBSD lists, send a test message to <a href=https://lists.FreeBSD.org/subscription/freebsd-test>FreeBSD test mailing list</a>.</em> Please do not send test messages to any other list.</p></div></td></tr></tbody></table></div><div class=paragraph><p>When in doubt about what list to post a question to, see <a href=https://docs.freebsd.org/en/articles/freebsd-questions/>How to get best results from the FreeBSD-questions mailing list</a>.</p></div><div class=paragraph><p>Before posting to any list, please learn about how to best use the mailing lists, such as how to help avoid frequently-repeated discussions, by reading the <a href=https://docs.freebsd.org/en/articles/mailing-list-faq/>Mailing List Frequently Asked Questions</a> (FAQ) document.</p></div><div class=paragraph><p>Archives are kept for all of the mailing lists and can be searched using the <a href=https://www.FreeBSD.org/search/>FreeBSD World Wide Web server</a>. The keyword searchable archive offers an excellent way of finding answers to frequently asked questions and should be consulted before posting a question. Note that this also means that messages sent to FreeBSD mailing lists are archived in perpetuity. When protecting privacy is a concern, consider using a disposable secondary email address and posting only public information.</p></div><div class=sect3><h4 id=eresources-summary>C.2.1. List Summary<a class=anchor href=#eresources-summary></a></h4><div class=paragraph><p><em>General lists:</em> The following are general lists which anyone is free (and encouraged) to join:</p></div><table class="tableblock frame-none grid-all stretch informaltable"><col style=width:20%><col style=width:80%><thead><tr><th class="tableblock halign-left valign-top">List</th><th class="tableblock halign-left valign-top">Purpose</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-advocacy>freebsd-advocacy</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>FreeBSD Evangelism</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-announce>freebsd-announce</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Important events and Project milestones (moderated)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-arch>freebsd-arch</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Architecture and design discussions</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-bugbusters>freebsd-bugbusters</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Discussions pertaining to the maintenance of the FreeBSD problem report database and related tools</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-bugs>freebsd-bugs</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Bug reports</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-chat>freebsd-chat</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Non-technical items related to the FreeBSD community</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-chromium>freebsd-chromium</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>FreeBSD-specific Chromium issues</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-current>freebsd-current</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Discussion concerning the use of FreeBSD-CURRENT</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-isp>freebsd-isp</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Issues for Internet Service Providers using FreeBSD</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-jobs>freebsd-jobs</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>FreeBSD employment and consulting opportunities</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-quarterly-calls>freebsd-quarterly-calls</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Calls for quarterly status reports (moderated)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-questions>freebsd-questions</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>User questions and technical support</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-security-notifications>freebsd-security-notifications</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Security notifications (moderated)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-stable>freebsd-stable</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Discussion concerning the use of FreeBSD-STABLE</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-test>freebsd-test</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Where to send test messages instead of to one of the actual lists</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-women>freebsd-women</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>FreeBSD advocacy for women</p></td></tr></tbody></table><div class=paragraph><p><em>Technical lists:</em> The following lists are for technical discussion. Read the charter for each list carefully before joining or sending mail to one as there are firm guidelines for their use and content.</p></div><table class="tableblock frame-none grid-all stretch informaltable"><col style=width:20%><col style=width:80%><thead><tr><th class="tableblock halign-left valign-top">List</th><th class="tableblock halign-left valign-top">Purpose</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-acpi>freebsd-acpi</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>ACPI and power management development</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-amd64>freebsd-amd64</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Porting FreeBSD to AMD64 systems (moderated)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-apache>freebsd-apache</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Discussion about Apache related ports</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-arm>freebsd-arm</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Porting FreeBSD to ARM® processors</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-atm>freebsd-atm</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Using ATM networking with FreeBSD</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-bluetooth>freebsd-bluetooth</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Using Bluetooth® technology in FreeBSD</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-cloud>freebsd-cloud</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>FreeBSD on cloud platforms (EC2, GCE, Azure, etc.)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-cluster>freebsd-cluster</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Using FreeBSD in a clustered environment</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-database>freebsd-database</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Discussing database use and development under FreeBSD</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-desktop>freebsd-desktop</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Using and improving FreeBSD on the desktop</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/dev-ci>dev-ci</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Build and test reports from the Continuous Integration servers</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/dev-reviews>dev-reviews</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Notifications of the FreeBSD review system</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-doc>freebsd-doc</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Creating FreeBSD related documents</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-drivers>freebsd-drivers</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Writing device drivers for FreeBSD</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-dtrace>freebsd-dtrace</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Using and working on DTrace in FreeBSD</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-eclipse>freebsd-eclipse</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>FreeBSD users of Eclipse IDE, tools, rich client applications and ports.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-elastic>freebsd-elastic</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>FreeBSD-specific ElasticSearch discussions</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-embedded>freebsd-embedded</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Using FreeBSD in embedded applications</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-eol>freebsd-eol</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Peer support of FreeBSD-related software that is no longer supported by the FreeBSD Project.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-emulation>freebsd-emulation</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Emulation of other systems such as Linux/MS-DOS®/Windows®</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-enlightenment>freebsd-enlightenment</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Porting Enlightenment and Enlightenment applications</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-erlang>freebsd-erlang</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>FreeBSD-specific Erlang discussions</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-firewire>freebsd-firewire</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>FreeBSD FireWire® (iLink, IEEE 1394) technical discussion</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-fortran>freebsd-fortran</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Fortran on FreeBSD</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-fs>freebsd-fs</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>File systems</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-games>freebsd-games</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Support for Games on FreeBSD</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-gecko>freebsd-gecko</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Gecko Rendering Engine issues</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-geom>freebsd-geom</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>GEOM-specific discussions and implementations</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-git>freebsd-git</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Discussion of git use in the FreeBSD project</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-gnome>freebsd-gnome</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Porting GNOME and GNOME applications</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-hackers>freebsd-hackers</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>General technical discussion</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-haskell>freebsd-haskell</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>FreeBSD-specific Haskell issues and discussions</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-hardware>freebsd-hardware</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>General discussion of hardware for running FreeBSD</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-i18n>freebsd-i18n</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>FreeBSD Internationalization</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-infiniband>freebsd-infiniband</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Infiniband on FreeBSD</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-ipfw>freebsd-ipfw</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Technical discussion concerning the redesign of the IP firewall code</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-isdn>freebsd-isdn</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>ISDN developers</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-jail>freebsd-jail</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Discussion about the <a href="https://man.freebsd.org/cgi/man.cgi?query=jail&amp;sektion=8&amp;format=html">jail(8)</a> facility</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-java>freebsd-java</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Java™ developers and people porting JDK™s to FreeBSD</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://mail.kde.org/mailman/listinfo/kde-freebsd>freebsd-kde</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Porting KDE and KDE applications</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-lfs>freebsd-lfs</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Porting LFS to FreeBSD</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-mips>freebsd-mips</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Porting FreeBSD to MIPS®</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-mono>freebsd-mono</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Mono and C# applications on FreeBSD</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-multimedia>freebsd-multimedia</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Multimedia applications</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-new-bus>freebsd-new-bus</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Technical discussions about bus architecture</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-net>freebsd-net</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Networking discussion and TCP/IP source code</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-numerics>freebsd-numerics</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Discussions of high quality implementation of libm functions</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-ocaml>freebsd-ocaml</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>FreeBSD-specific OCaml discussions</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-office>freebsd-office</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Office applications on FreeBSD</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-performance>freebsd-performance</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Performance tuning questions for high performance/load installations</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-perl>freebsd-perl</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Maintenance of a number of Perl-related ports</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-pf>freebsd-pf</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Discussion and questions about the packet filter firewall system</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-pkg>freebsd-pkg</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Binary package management and package tools discussion</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-pkg-fallout>freebsd-pkg-fallout</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Fallout logs from package building</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-pkgbase>freebsd-pkgbase</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Packaging the FreeBSD base system</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-platforms>freebsd-platforms</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Concerning ports to non Intel® architecture platforms</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-ports>freebsd-ports</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Discussion of the Ports Collection</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-ports-announce>freebsd-ports-announce</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Important news and instructions about the Ports Collection (moderated)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-ports-bugs>freebsd-ports-bugs</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Discussion of the ports bugs/PRs</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-ppc>freebsd-ppc</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Porting FreeBSD to the PowerPC®</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-proliant>freebsd-proliant</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Technical discussion of FreeBSD on HP ProLiant server platforms</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-python>freebsd-python</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>FreeBSD-specific Python issues</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-rc>freebsd-rc</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Discussion related to the <span class=filename>rc.d</span> system and its development</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-realtime>freebsd-realtime</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Development of realtime extensions to FreeBSD</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-ruby>freebsd-ruby</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>FreeBSD-specific Ruby discussions</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-scsi>freebsd-scsi</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>The SCSI subsystem</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-security>freebsd-security</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Security issues affecting FreeBSD</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-snapshots>freebsd-snapshots</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>FreeBSD Development Snapshot Announcements</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-sparc64>freebsd-sparc64</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Porting FreeBSD to SPARC® based systems</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-standards>freebsd-standards</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>FreeBSD’s conformance to the C99 and the POSIX® standards</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-sysinstall>freebsd-sysinstall</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><a href="https://man.freebsd.org/cgi/man.cgi?query=sysinstall&amp;sektion=8&amp;format=html">sysinstall(8)</a> development</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-tcltk>freebsd-tcltk</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>FreeBSD-specific Tcl/Tk discussions</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-testing>freebsd-testing</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Testing on FreeBSD</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-tex>freebsd-tex</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Porting TeX and its applications to FreeBSD</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-threads>freebsd-threads</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Threading in FreeBSD</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-tilera>freebsd-tilera</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Porting FreeBSD to the Tilera family of CPUs</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-tokenring>freebsd-tokenring</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Support Token Ring in FreeBSD</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-toolchain>freebsd-toolchain</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Maintenance of FreeBSD’s integrated toolchain</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-translators>freebsd-translators</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Translating FreeBSD documents and programs</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-transport>freebsd-transport</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Discussions of transport level network protocols in FreeBSD</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-usb>freebsd-usb</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Discussing FreeBSD support for USB</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-virtualization>freebsd-virtualization</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Discussion of various virtualization techniques supported by FreeBSD</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-vuxml>freebsd-vuxml</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Discussion on VuXML infrastructure</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-x11>freebsd-x11</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Maintenance and support of X11 on FreeBSD</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-xen>freebsd-xen</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Discussion of the FreeBSD port to Xen™ - implementation and usage</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-xfce>freebsd-xfce</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>XFCE for FreeBSD - porting and maintaining</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-zope>freebsd-zope</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Zope for FreeBSD - porting and maintaining</p></td></tr></tbody></table><div class=paragraph><p><em>Limited lists:</em> The following lists are for more specialized (and demanding) audiences and are probably not of interest to the general public. It is also a good idea to establish a presence in the technical lists before joining one of these limited lists in order to understand the communications etiquette involved.</p></div><table class="tableblock frame-none grid-all stretch informaltable"><col style=width:20%><col style=width:80%><thead><tr><th class="tableblock halign-left valign-top">List</th><th class="tableblock halign-left valign-top">Purpose</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-hubs>freebsd-hubs</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>People running mirror sites (infrastructural support)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-user-groups>freebsd-user-groups</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>User group coordination</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-wip-status>freebsd-wip-status</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>FreeBSD Work-In-Progress Status</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/freebsd-wireless>freebsd-wireless</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Discussions of 802.11 stack, tools, device driver development</p></td></tr></tbody></table><div class=paragraph><p><em>Digest lists:</em> All of the above lists are available in a digest format. Once subscribed to a list, the digest options can be changed in the account options section.</p></div><div class=paragraph><p><em>SVN lists:</em> The following lists are for people interested in seeing the log messages for changes to various areas of the source tree. They are <em>Read-Only</em> lists and should not have mail sent to them.</p></div><table class="tableblock frame-none grid-all stretch informaltable"><col style=width:20%><col style=width:20%><col style=width:60%><thead><tr><th class="tableblock halign-left valign-top">List</th><th class="tableblock halign-left valign-top">Source area</th><th class="tableblock halign-left valign-top">Area Description (source for)</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/svn-doc-all>svn-doc-all</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/usr/doc</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>All changes to the doc Subversion repository (except for <span class=filename>user</span>, <span class=filename>projects</span> and <span class=filename>translations</span>)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/svn-doc-head>svn-doc-head</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/usr/doc</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>All changes to the "head" branch of the doc Subversion repository</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/svn-doc-projects>svn-doc-projects</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/usr/doc/projects</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>All changes to the <span class=filename>projects</span> area of the doc Subversion repository</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/svn-doc-svnadmin>svn-doc-svnadmin</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/usr/doc</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>All changes to the administrative scripts, hooks, and other configuration data of the doc Subversion repository</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/svn-ports-all>svn-ports-all</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/usr/ports</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>All changes to the ports Subversion repository</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/svn-ports-head>svn-ports-head</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/usr/ports</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>All changes to the "head" branch of the ports Subversion repository</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/svn-ports-svnadmin>svn-ports-svnadmin</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/usr/ports</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>All changes to the administrative scripts, hooks, and other configuration data of the ports Subversion repository</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/svn-src-all>svn-src-all</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/usr/src</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>All changes to the src Subversion repository (except for <span class=filename>user</span> and <span class=filename>projects</span>)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/svn-src-head>svn-src-head</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/usr/src</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>All changes to the "head" branch of the src Subversion repository (the FreeBSD-CURRENT branch)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/svn-src-projects>svn-src-projects</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/usr/projects</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>All changes to the <span class=filename>projects</span> area of the src Subversion repository</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/svn-src-release>svn-src-release</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/usr/src</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>All changes to the <span class=filename>releases</span> area of the src Subversion repository</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/svn-src-releng>svn-src-releng</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/usr/src</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>All changes to the <span class=filename>releng</span> branches of the src Subversion repository (the security / release engineering branches)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/svn-src-stable>svn-src-stable</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/usr/src</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>All changes to the all stable branches of the src Subversion repository</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/svn-src-stable-6>svn-src-stable-6</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/usr/src</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>All changes to the <span class=filename>stable/6</span> branch of the src Subversion repository</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/svn-src-stable-7>svn-src-stable-7</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/usr/src</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>All changes to the <span class=filename>stable/7</span> branch of the src Subversion repository</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/svn-src-stable-8>svn-src-stable-8</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/usr/src</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>All changes to the <span class=filename>stable/8</span> branch of the src Subversion repository</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/svn-src-stable-9>svn-src-stable-9</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/usr/src</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>All changes to the <span class=filename>stable/9</span> branch of the src Subversion repository</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/svn-src-stable-10>svn-src-stable-10</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/usr/src</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>All changes to the <span class=filename>stable/10</span> branch of the src Subversion repository</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/svn-src-stable-11>svn-src-stable-11</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/usr/src</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>All changes to the <span class=filename>stable/11</span> branch of the src Subversion repository</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/svn-src-stable-12>svn-src-stable-12</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/usr/src</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>All changes to the <span class=filename>stable/12</span> branch of the src Subversion repository</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/svn-src-stable-other>svn-src-stable-other</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/usr/src</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>All changes to the older <span class=filename>stable</span> branches of the src Subversion repository</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/svn-src-svnadmin>svn-src-svnadmin</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/usr/src</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>All changes to the administrative scripts, hooks, and other configuration data of the src Subversion repository</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/svn-src-user>svn-src-user</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/usr/src</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>All changes to the experimental <span class=filename>user</span> area of the src Subversion repository</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href=https://lists.FreeBSD.org/subscription/svn-src-vendor>svn-src-vendor</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/usr/src</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>All changes to the vendor work area of the src Subversion repository</p></td></tr></tbody></table></div><div class=sect3><h4 id=eresources-subscribe>C.2.2. How to Subscribe<a class=anchor href=#eresources-subscribe></a></h4><div class=paragraph><p>To subscribe to a list, click the list name at <a href=https://lists.freebsd.org class=bare>https://lists.freebsd.org</a>. The page that is displayed should contain all of the necessary subscription instructions for that list.</p></div><div class=paragraph><p>To actually post to a given list, send mail to <a href=mailto:listname@FreeBSD.org>listname@FreeBSD.org</a>. It will then be redistributed to mailing list members world-wide.</p></div><div class=paragraph><p>To unsubscribe from a list, click on the URL found at the bottom of every email received from the list. It is also possible to send an email to <a href=mailto:listname-unsubscribe@FreeBSD.org>listname-unsubscribe@FreeBSD.org</a> to unsubscribe.</p></div><div class=paragraph><p>It is important to keep discussion in the technical mailing lists on a technical track. To only receive important announcements, instead join the <a href=https://lists.FreeBSD.org/subscription/freebsd-announce>FreeBSD announcements mailing list</a>, which is intended for infrequent traffic.</p></div></div><div class=sect3><h4 id=eresources-charters>C.2.3. List Charters<a class=anchor href=#eresources-charters></a></h4><div class=paragraph><p><em>All</em> FreeBSD mailing lists have certain basic rules which must be adhered to by anyone using them. Failure to comply with these guidelines will result in two (2) written warnings from the FreeBSD Postmaster <a href=mailto:postmaster@FreeBSD.org>postmaster@FreeBSD.org</a>, after which, on a third offense, the poster will removed from all FreeBSD mailing lists and filtered from further posting to them. We regret that such rules and measures are necessary at all, but today’s Internet is a pretty harsh environment, it would seem, and many fail to appreciate just how fragile some of its mechanisms are.</p></div><div class=paragraph><p>Rules of the road:</p></div><div class=ulist><ul><li><p>The topic of any posting should adhere to the basic charter of the list it is posted to. If the list is about technical issues, the posting should contain technical discussion. Ongoing irrelevant chatter or flaming only detracts from the value of the mailing list for everyone on it and will not be tolerated. For free-form discussion on no particular topic, the <a href=https://lists.FreeBSD.org/subscription/freebsd-chat>FreeBSD chat mailing list</a> is freely available and should be used instead.</p></li><li><p>No posting should be made to more than 2 mailing lists, and only to 2 when a clear and obvious need to post to both lists exists. For most lists, there is already a great deal of subscriber overlap and except for the most esoteric mixes (say "-stable & -scsi"), there really is no reason to post to more than one list at a time. If a message is received with multiple mailing lists on the <code>Cc</code> line, trim the <code>Cc</code> line before replying. <em>The person who replies is still responsible for cross-posting, no matter who the originator might have been.</em></p></li><li><p>Personal attacks and profanity (in the context of an argument) are not allowed, and that includes users and developers alike. Gross breaches of netiquette, like excerpting or reposting private mail when permission to do so was not and would not be forthcoming, are frowned upon but not specifically enforced. <em>However</em>, there are also very few cases where such content would fit within the charter of a list and it would therefore probably rate a warning (or ban) on that basis alone.</p></li><li><p>Advertising of non-FreeBSD related products or services is strictly prohibited and will result in an immediate ban if it is clear that the offender is advertising by spam.</p></li></ul></div><div class=paragraph><p><em>Individual list charters:</em></p></div><div class=dlist><dl><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-acpi>freebsd-acpi</a></dt><dd><p><em>ACPI and power management development</em></p></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-announce>freebsd-announce</a></dt><dd><p><em>Important events / milestones</em></p><div class=paragraph><p>This is the mailing list for people interested only in occasional announcements of significant FreeBSD events. This includes announcements about snapshots and other releases. It contains announcements of new FreeBSD capabilities. It may contain calls for volunteers etc. This is a low volume, strictly moderated mailing list.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-arch>freebsd-arch</a></dt><dd><p><em>Architecture and design discussions</em></p><div class=paragraph><p>This list is for discussion of the FreeBSD architecture. Messages will mostly be kept strictly technical in nature. Examples of suitable topics are:</p></div><div class=ulist><ul><li><p>How to re-vamp the build system to have several customized builds running at the same time.</p></li><li><p>What needs to be fixed with VFS to make Heidemann layers work.</p></li><li><p>How do we change the device driver interface to be able to use the same drivers cleanly on many buses and architectures.</p></li><li><p>How to write a network driver.</p></li></ul></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-bluetooth>freebsd-bluetooth</a></dt><dd><p><em>Bluetooth® in FreeBSD</em></p><div class=paragraph><p>This is the forum where FreeBSD’s Bluetooth® users congregate. Design issues, implementation details, patches, bug reports, status reports, feature requests, and all matters related to Bluetooth® are fair game.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-bugbusters>freebsd-bugbusters</a></dt><dd><p><em>Coordination of the Problem Report handling effort</em></p><div class=paragraph><p>The purpose of this list is to serve as a coordination and discussion forum for the Bugmeister, his Bugbusters, and any other parties who have a genuine interest in the PR database. This list is not for discussions about specific bugs, patches or PRs.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-bugs>freebsd-bugs</a></dt><dd><p><em>Bug reports</em></p><div class=paragraph><p>This is the mailing list for reporting bugs in FreeBSD. Whenever possible, bugs should be submitted using the <a href=https://bugs.freebsd.org/bugzilla/enter_bug.cgi>web interface</a> to it.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-chat>freebsd-chat</a></dt><dd><p><em>Non technical items related to the FreeBSD community</em></p><div class=paragraph><p>This list contains the overflow from the other lists about non-technical, social information. It includes discussion about whether Jordan looks like a toon ferret or not, whether or not to type in capitals, who is drinking too much coffee, where the best beer is brewed, who is brewing beer in their basement, and so on. Occasional announcements of important events (such as upcoming parties, weddings, births, new jobs, etc) can be made to the technical lists, but the follow ups should be directed to this -chat list.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-chromium>freebsd-chromium</a></dt><dd><p><em>FreeBSD-specific Chromium issues</em></p><div class=paragraph><p>This is a list for the discussion of Chromium support for FreeBSD. This is a technical list to discuss development and installation of Chromium.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-cloud>freebsd-cloud</a></dt><dd><p><em>Running FreeBSD on various cloud platforms</em></p><div class=paragraph><p>This list discusses running FreeBSD on Amazon EC2, Google Compute Engine, Microsoft Azure, and other cloud computing platforms.</p></div></dd><dt class=hdlist1><em>FreeBSD core team</em></dt><dd><p>This is an internal mailing list for use by the core members. Messages can be sent to it when a serious FreeBSD-related matter requires arbitration or high-level scrutiny.</p></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-current>freebsd-current</a></dt><dd><p><em>Discussions about the use of FreeBSD-CURRENT</em></p><div class=paragraph><p>This is the mailing list for users of FreeBSD-CURRENT. It includes warnings about new features coming out in -CURRENT that will affect the users, and instructions on steps that must be taken to remain -CURRENT. Anyone running "CURRENT" must subscribe to this list. This is a technical mailing list for which strictly technical content is expected.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-desktop>freebsd-desktop</a></dt><dd><p><em>Using and improving FreeBSD on the desktop</em></p><div class=paragraph><p>This is a forum for discussion of FreeBSD on the desktop. It is primarily a place for desktop porters and users to discuss issues and improve FreeBSD’s desktop support.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/dev-ci>dev-ci</a></dt><dd><p><em>Continuous Integration reports of build and test results</em></p><div class=paragraph><p>All Continuous Integration reports of build and test results</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/dev-reviews>dev-reviews</a></dt><dd><p><em>Notifications of work in progress in FreeBSD’s review tool</em></p><div class=paragraph><p>Automated notifications of work in progress for review in FreeBSD’s review tools, including patches.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-doc>freebsd-doc</a></dt><dd><p><em>Documentation Project</em></p><div class=paragraph><p>This mailing list is for the discussion of issues and projects related to the creation of documentation for FreeBSD. The members of this mailing list are collectively referred to as "The FreeBSD Documentation Project". It is an open list; feel free to join and contribute!</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-drivers>freebsd-drivers</a></dt><dd><p><em>Writing device drivers for FreeBSD</em></p><div class=paragraph><p>This is a forum for technical discussions related to device drivers on FreeBSD. It is primarily a place for device driver writers to ask questions about how to write device drivers using the APIs in the FreeBSD kernel.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-dtrace>freebsd-dtrace</a></dt><dd><p><em>Using and working on DTrace in FreeBSD</em></p><div class=paragraph><p>DTrace is an integrated component of FreeBSD that provides a framework for understanding the kernel as well as user space programs at run time. The mailing list is an archived discussion for developers of the code as well as those using it.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-eclipse>freebsd-eclipse</a></dt><dd><p><em>FreeBSD users of Eclipse IDE, tools, rich client applications and ports.</em></p><div class=paragraph><p>The intention of this list is to provide mutual support for everything to do with choosing, installing, using, developing and maintaining the Eclipse IDE, tools, rich client applications on the FreeBSD platform and assisting with the porting of Eclipse IDE and plugins to the FreeBSD environment.</p></div><div class=paragraph><p>The intention is also to facilitate exchange of information between the Eclipse community and the FreeBSD community to the mutual benefit of both.</p></div><div class=paragraph><p>Although this list is focused primarily on the needs of Eclipse users it will also provide a forum for those who would like to develop FreeBSD specific applications using the Eclipse framework.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-embedded>freebsd-embedded</a></dt><dd><p><em>Using FreeBSD in embedded applications</em></p><div class=paragraph><p>This list discusses topics related to using FreeBSD in embedded systems. This is a technical mailing list for which strictly technical content is expected. For the purpose of this list, embedded systems are those computing devices which are not desktops and which usually serve a single purpose as opposed to being general computing environments. Examples include, but are not limited to, all kinds of phone handsets, network equipment such as routers, switches and PBXs, remote measuring equipment, PDAs, Point Of Sale systems, and so on.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-emulation>freebsd-emulation</a></dt><dd><p><em>Emulation of other systems such as Linux/MS-DOS®/Windows®</em></p><div class=paragraph><p>This is a forum for technical discussions related to running programs written for other operating systems on FreeBSD.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-enlightenment>freebsd-enlightenment</a></dt><dd><p><em>Enlightenment</em></p><div class=paragraph><p>Discussions concerning the Enlightenment Desktop Environment for FreeBSD systems. This is a technical mailing list for which strictly technical content is expected.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-eol>freebsd-eol</a></dt><dd><p><em>Peer support of FreeBSD-related software that is no longer supported by the FreeBSD Project.</em></p><div class=paragraph><p>This list is for those interested in providing or making use of peer support of FreeBSD-related software for which the FreeBSD Project no longer provides official support in the form of security advisories and patches.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-firewire>freebsd-firewire</a></dt><dd><p><em>FireWire® (iLink, IEEE 1394)</em></p><div class=paragraph><p>This is a mailing list for discussion of the design and implementation of a FireWire® (aka IEEE 1394 aka iLink) subsystem for FreeBSD. Relevant topics specifically include the standards, bus devices and their protocols, adapter boards/cards/chips sets, and the architecture and implementation of code for their proper support.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-fortran>freebsd-fortran</a></dt><dd><p><em>Fortran on FreeBSD</em></p><div class=paragraph><p>This is the mailing list for discussion of Fortran related ports on FreeBSD: compilers, libraries, scientific and engineering applications from laptops to HPC clusters.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-fs>freebsd-fs</a></dt><dd><p><em>File systems</em></p><div class=paragraph><p>Discussions concerning FreeBSD filesystems. This is a technical mailing list for which strictly technical content is expected.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-games>freebsd-games</a></dt><dd><p><em>Games on FreeBSD</em></p><div class=paragraph><p>This is a technical list for discussions related to bringing games to FreeBSD. It is for individuals actively working on porting games to FreeBSD, to bring up problems or discuss alternative solutions. Individuals interested in following the technical discussion are also welcome.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-gecko>freebsd-gecko</a></dt><dd><p><em>Gecko Rendering Engine</em></p><div class=paragraph><p>This is a forum about Gecko applications using FreeBSD.</p></div><div class=paragraph><p>Discussion centers around Gecko Ports applications, their installation, their development and their support within FreeBSD.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-geom>freebsd-geom</a></dt><dd><p><em>GEOM</em></p><div class=paragraph><p>Discussions specific to GEOM and related implementations. This is a technical mailing list for which strictly technical content is expected.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-git>freebsd-git</a></dt><dd><p><em>Use of git in the FreeBSD project</em></p><div class=paragraph><p>Discussions of how to use git in FreeBSD infrastructure including the github mirror and other uses of git for project collaboration. Discussion area for people using git against the FreeBSD github mirror. People wanting to get started with the mirror or git in general on FreeBSD can ask here.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-gnome>freebsd-gnome</a></dt><dd><p><em>GNOME</em></p><div class=paragraph><p>Discussions concerning The GNOME Desktop Environment for FreeBSD systems. This is a technical mailing list for which strictly technical content is expected.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-infiniband>freebsd-infiniband</a></dt><dd><p><em>Infiniband on FreeBSD</em></p><div class=paragraph><p>Technical mailing list discussing Infiniband, OFED, and OpenSM on FreeBSD.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-ipfw>freebsd-ipfw</a></dt><dd><p><em>IP Firewall</em></p><div class=paragraph><p>This is the forum for technical discussions concerning the redesign of the IP firewall code in FreeBSD. This is a technical mailing list for which strictly technical content is expected.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-isdn>freebsd-isdn</a></dt><dd><p><em>ISDN Communications</em></p><div class=paragraph><p>This is the mailing list for people discussing the development of ISDN support for FreeBSD.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-java>freebsd-java</a></dt><dd><p><em>Java™ Development</em></p><div class=paragraph><p>This is the mailing list for people discussing the development of significant Java™ applications for FreeBSD and the porting and maintenance of JDK™s.</p></div></dd></dl></div><div id=eresources-charters-jobs class=dlist><dl><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-jobs>freebsd-jobs</a></dt><dd><p><em>Jobs offered and sought</em></p><div class=paragraph><p>This is a forum for posting employment notices specifically related to FreeBSD and resumes from those seeking FreeBSD-related employment. This is <em>not</em> a mailing list for general employment issues since adequate forums for that already exist elsewhere.</p></div><div class=paragraph><p>Note that this list, like other <code>FreeBSD.org</code> mailing lists, is distributed worldwide. Be clear about the geographic location and the extent to which telecommuting or assistance with relocation is available.</p></div><div class=paragraph><p>Email should use open formats only - preferably plain text, but basic Portable Document Format (PDF), HTML, and a few others are acceptable to many readers. Closed formats such as Microsoft® Word (<span class=filename>.doc</span>) will be rejected by the mailing list server.</p></div></dd><dt class=hdlist1><a href=https://mail.kde.org/mailman/listinfo/kde-freebsd>freebsd-kde</a></dt><dd><p><em>KDE</em></p><div class=paragraph><p>Discussions concerning KDE on FreeBSD systems. This is a technical mailing list for which strictly technical content is expected.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-hackers>freebsd-hackers</a></dt><dd><p><em>Technical discussions</em></p><div class=paragraph><p>This is a forum for technical discussions related to FreeBSD. This is the primary technical mailing list. It is for individuals actively working on FreeBSD, to bring up problems or discuss alternative solutions. Individuals interested in following the technical discussion are also welcome. This is a technical mailing list for which strictly technical content is expected.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-hardware>freebsd-hardware</a></dt><dd><p><em>General discussion of FreeBSD hardware</em></p><div class=paragraph><p>General discussion about the types of hardware that FreeBSD runs on, various problems and suggestions concerning what to buy or avoid.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-hubs>freebsd-hubs</a></dt><dd><p><em>Mirror sites</em></p><div class=paragraph><p>Announcements and discussion for people who run FreeBSD mirror sites.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-isp>freebsd-isp</a></dt><dd><p><em>Issues for Internet Service Providers</em></p><div class=paragraph><p>This mailing list is for discussing topics relevant to Internet Service Providers (ISPs) using FreeBSD. This is a technical mailing list for which strictly technical content is expected.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-mono>freebsd-mono</a></dt><dd><p><em>Mono and C# applications on FreeBSD</em></p><div class=paragraph><p>This is a list for discussions related to the Mono development framework on FreeBSD. This is a technical mailing list. It is for individuals actively working on porting Mono or C# applications to FreeBSD, to bring up problems or discuss alternative solutions. Individuals interested in following the technical discussion are also welcome.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-ocaml>freebsd-ocaml</a></dt><dd><p><em>FreeBSD-specific OCaml discussions</em></p><div class=paragraph><p>This is a list for discussions related to the OCaml support on FreeBSD. This is a technical mailing list. It is for individuals working on OCaml ports, 3rd party libraries and frameworks. Individuals interested in the technical discussion are also welcome.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-office>freebsd-office</a></dt><dd><p><em>Office applications on FreeBSD</em></p><div class=paragraph><p>Discussion centers around office applications, their installation, their development and their support within FreeBSD.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-ops-announce>freebsd-ops-announce</a></dt><dd><p><em>Project Infrastructure Announcements</em></p><div class=paragraph><p>This is the mailing list for people interested in changes and issues related to the FreeBSD.org Project infrastructure.</p></div><div class=paragraph><p>This moderated list is strictly for announcements: no replies, requests, discussions, or opinions.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-performance>freebsd-performance</a></dt><dd><p><em>Discussions about tuning or speeding up FreeBSD</em></p><div class=paragraph><p>This mailing list exists to provide a place for hackers, administrators, and/or concerned parties to discuss performance related topics pertaining to FreeBSD. Acceptable topics includes talking about FreeBSD installations that are either under high load, are experiencing performance problems, or are pushing the limits of FreeBSD. Concerned parties that are willing to work toward improving the performance of FreeBSD are highly encouraged to subscribe to this list. This is a highly technical list ideally suited for experienced FreeBSD users, hackers, or administrators interested in keeping FreeBSD fast, robust, and scalable. This list is not a question-and-answer list that replaces reading through documentation, but it is a place to make contributions or inquire about unanswered performance related topics.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-pf>freebsd-pf</a></dt><dd><p><em>Discussion and questions about the packet filter firewall system</em></p><div class=paragraph><p>Discussion concerning the packet filter (pf) firewall system in terms of FreeBSD. Technical discussion and user questions are both welcome. This list is also a place to discuss the ALTQ QoS framework.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-pkg>freebsd-pkg</a></dt><dd><p><em>Binary package management and package tools discussion</em></p><div class=paragraph><p>Discussion of all aspects of managing FreeBSD systems by using binary packages to install software, including binary package toolkits and formats, their development and support within FreeBSD, package repository management, and third party packages.</p></div><div class=paragraph><p>Note that discussion of ports which fail to generate packages correctly should generally be considered as ports problems, and so inappropriate for this list.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-pkg-fallout>freebsd-pkg-fallout</a></dt><dd><p><em>Fallout logs from package building</em></p><div class=paragraph><p>All packages building failures logs from the package building clusters</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-pkgbase>freebsd-pkgbase</a></dt><dd><p><em>Packaging the FreeBSD base system.</em></p><div class=paragraph><p>Discussions surrounding implementation and issues regarding packaging the FreeBSD base system.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-platforms>freebsd-platforms</a></dt><dd><p><em>Porting to Non Intel® platforms</em></p><div class=paragraph><p>Cross-platform FreeBSD issues, general discussion and proposals for non Intel® FreeBSD ports. This is a technical mailing list for which strictly technical content is expected.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-ports>freebsd-ports</a></dt><dd><p><em>Discussion of "ports"</em></p><div class=paragraph><p>Discussions concerning FreeBSD’s "ports collection" (<span class=filename>/usr/ports</span>), ports infrastructure, and general ports coordination efforts. This is a technical mailing list for which strictly technical content is expected.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-ports-announce>freebsd-ports-announce</a></dt><dd><p><em>Important news and instructions about the FreeBSD "Ports Collection"</em></p><div class=paragraph><p>Important news for developers, porters, and users of the "Ports Collection" (<span class=filename>/usr/ports</span>), including architecture/infrastructure changes, new capabilities, critical upgrade instructions, and release engineering information. This is a low-volume mailing list, intended for announcements.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-ports-bugs>freebsd-ports-bugs</a></dt><dd><p><em>Discussion of "ports" bugs</em></p><div class=paragraph><p>Discussions concerning problem reports for FreeBSD’s "ports collection" (<span class=filename>/usr/ports</span>), proposed ports, or modifications to ports. This is a technical mailing list for which strictly technical content is expected.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-proliant>freebsd-proliant</a></dt><dd><p><em>Technical discussion of FreeBSD on HP ProLiant server platforms</em></p><div class=paragraph><p>This mailing list is to be used for the technical discussion of the usage of FreeBSD on HP ProLiant servers, including the discussion of ProLiant-specific drivers, management software, configuration tools, and BIOS updates. As such, this is the primary place to discuss the hpasmd, hpasmcli, and hpacucli modules.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-python>freebsd-python</a></dt><dd><p><em>Python on FreeBSD</em></p><div class=paragraph><p>This is a list for discussions related to improving Python-support on FreeBSD. This is a technical mailing list. It is for individuals working on porting Python, its third party modules and Zope stuff to FreeBSD. Individuals interested in following the technical discussion are also welcome.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-questions>freebsd-questions</a></dt><dd><p><em>User questions</em></p><div class=paragraph><p>This is the mailing list for questions about FreeBSD. Do not send "how to" questions to the technical lists unless the question is quite technical.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-ruby>freebsd-ruby</a></dt><dd><p><em>FreeBSD-specific Ruby discussions</em></p><div class=paragraph><p>This is a list for discussions related to the Ruby support on FreeBSD. This is a technical mailing list. It is for individuals working on Ruby ports, third party libraries and frameworks.</p></div><div class=paragraph><p>Individuals interested in the technical discussion are also welcome.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-scsi>freebsd-scsi</a></dt><dd><p><em>SCSI subsystem</em></p><div class=paragraph><p>This is the mailing list for people working on the SCSI subsystem for FreeBSD. This is a technical mailing list for which strictly technical content is expected.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-security>freebsd-security</a></dt><dd><p><em>Security issues</em></p><div class=paragraph><p>FreeBSD computer security issues (DES, Kerberos, known security holes and fixes, etc). This is a technical mailing list for which strictly technical discussion is expected. Note that this is not a question-and-answer list, but that contributions (BOTH question AND answer) to the FAQ are welcome.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-security-notifications>freebsd-security-notifications</a></dt><dd><p><em>Security Notifications</em></p><div class=paragraph><p>Notifications of FreeBSD security problems and fixes. This is not a discussion list. The discussion list is FreeBSD-security.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-snapshots>freebsd-snapshots</a></dt><dd><p><em>FreeBSD Development Snapshot Announcements</em></p><div class=paragraph><p>This list provides notifications about the availability of new FreeBSD development snapshots for the head/ and stable/ branches.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-stable>freebsd-stable</a></dt><dd><p><em>Discussions about the use of FreeBSD-STABLE</em></p><div class=paragraph><p>This is the mailing list for users of FreeBSD-STABLE. "STABLE" is the branch where development continues after a RELEASE, including bug fixes and new features. The ABI is kept stable for binary compatibility. It includes warnings about new features coming out in -STABLE that will affect the users, and instructions on steps that must be taken to remain -STABLE. Anyone running "STABLE" should subscribe to this list. This is a technical mailing list for which strictly technical content is expected.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-standards>freebsd-standards</a></dt><dd><p><em>C99 POSIX Conformance</em></p><div class=paragraph><p>This is a forum for technical discussions related to FreeBSD Conformance to the C99 and the POSIX standards.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-teaching>freebsd-teaching</a></dt><dd><p><em>Teaching with FreeBSD</em></p><div class=paragraph><p>Non technical mailing list discussing teaching with FreeBSD.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-testing>freebsd-testing</a></dt><dd><p><em>Testing on FreeBSD</em></p><div class=paragraph><p>Technical mailing list discussing testing on FreeBSD, including ATF/Kyua, test build infrastructure, port tests to FreeBSD from other operating systems (NetBSD, …​), etc.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-tex>freebsd-tex</a></dt><dd><p><em>Porting TeX and its applications to FreeBSD</em></p><div class=paragraph><p>This is a technical mailing list for discussions related to TeX and its applications on FreeBSD. It is for individuals actively working on porting TeX to FreeBSD, to bring up problems or discuss alternative solutions. Individuals interested in following the technical discussion are also welcome.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-toolchain>freebsd-toolchain</a></dt><dd><p><em>Maintenance of FreeBSD’s integrated toolchain</em></p><div class=paragraph><p>This is the mailing list for discussions related to the maintenance of the toolchain shipped with FreeBSD. This could include the state of Clang and GCC, but also pieces of software such as assemblers, linkers and debuggers.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-transport>freebsd-transport</a></dt><dd><p><em>Discussions of transport level network protocols in FreeBSD</em></p><div class=paragraph><p>The transport mailing list exists for the discussion of issues and designs around the transport level protocols in the FreeBSD network stack, including TCP, SCTP and UDP. Other networking topics, including driver specific and network protocol issues should be discussed on the <a href=https://lists.FreeBSD.org/subscription/freebsd-net>FreeBSD networking mailing list</a>.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-translators>freebsd-translators</a></dt><dd><p><em>Translating FreeBSD documents and programs</em></p><div class=paragraph><p>A discussion list where translators of FreeBSD documents from English into other languages can talk about translation methods and tools. New members are asked to introduce themselves and mention the languages they are interested in translating.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-usb>freebsd-usb</a></dt><dd><p><em>Discussing FreeBSD support for USB</em></p><div class=paragraph><p>This is a mailing list for technical discussions related to FreeBSD support for USB.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-user-groups>freebsd-user-groups</a></dt><dd><p><em>User Group Coordination List</em></p><div class=paragraph><p>This is the mailing list for the coordinators from each of the local area Users Groups to discuss matters with each other and a designated individual from the Core Team. This mail list should be limited to meeting synopsis and coordination of projects that span User Groups.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-virtualization>freebsd-virtualization</a></dt><dd><p><em>Discussion of various virtualization techniques supported by FreeBSD</em></p><div class=paragraph><p>A list to discuss the various virtualization techniques supported by FreeBSD. On one hand the focus will be on the implementation of the basic functionality as well as adding new features. On the other hand users will have a forum to ask for help in case of problems or to discuss their use cases.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-wip-status>freebsd-wip-status</a></dt><dd><p><em>FreeBSD Work-In-Progress Status</em></p><div class=paragraph><p>This mailing list can be used by developers to announce the creation and progress of FreeBSD related work. Messages will be moderated. It is suggested to send the message "To:" a more topical FreeBSD list and only "BCC:" this list. This way the WIP can also be discussed on the topical list, as no discussion is allowed on this list.</p></div><div class=paragraph><p>Look inside the archives for examples of suitable messages.</p></div><div class=paragraph><p>An editorial digest of the messages to this list might be posted to the FreeBSD website every few months as part of the Status Reports <sup class=footnote>[<a id=_footnoteref_2 class=footnote href=#_footnotedef_2 title="View footnote.">2</a>]</sup>. Past reports are archived.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-wireless>freebsd-wireless</a></dt><dd><p><em>Discussions of 802.11 stack, tools device driver development</em></p><div class=paragraph><p>The FreeBSD-wireless list focuses on 802.11 stack (sys/net80211), device driver and tools development. This includes bugs, new features and maintenance.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-xen>freebsd-xen</a></dt><dd><p><em>Discussion of the FreeBSD port to Xen™ - implementation and usage</em></p><div class=paragraph><p>A list that focuses on the FreeBSD Xen™ port. The anticipated traffic level is small enough that it is intended as a forum for both technical discussions of the implementation and design details as well as administrative deployment issues.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-xfce>freebsd-xfce</a></dt><dd><p><em>XFCE</em></p><div class=paragraph><p>This is a forum for discussions related to bring the XFCE environment to FreeBSD. This is a technical mailing list. It is for individuals actively working on porting XFCE to FreeBSD, to bring up problems or discuss alternative solutions. Individuals interested in following the technical discussion are also welcome.</p></div></dd><dt class=hdlist1><a href=https://lists.FreeBSD.org/subscription/freebsd-zope>freebsd-zope</a></dt><dd><p><em>Zope</em></p><div class=paragraph><p>This is a forum for discussions related to bring the Zope environment to FreeBSD. This is a technical mailing list. It is for individuals actively working on porting Zope to FreeBSD, to bring up problems or discuss alternative solutions. Individuals interested in following the technical discussion are also welcome.</p></div></dd></dl></div></div><div class=sect3><h4 id=eresources-mailfiltering>C.2.4. Filtering on the Mailing Lists<a class=anchor href=#eresources-mailfiltering></a></h4><div class=paragraph><p>The FreeBSD mailing lists are filtered in multiple ways to avoid the distribution of spam, viruses, and other unwanted emails. The filtering actions described in this section do not include all those used to protect the mailing lists.</p></div><div class=paragraph><p>Only certain types of attachments are allowed on the mailing lists. All attachments with a MIME content type not found in the list below will be stripped before an email is distributed on the mailing lists.</p></div><div class=ulist><ul><li><p>application/octet-stream</p></li><li><p>application/pdf</p></li><li><p>application/pgp-signature</p></li><li><p>application/x-pkcs7-signature</p></li><li><p>message/rfc822</p></li><li><p>multipart/alternative</p></li><li><p>multipart/related</p></li><li><p>multipart/signed</p></li><li><p>text/html</p></li><li><p>text/plain</p></li><li><p>text/x-diff</p></li><li><p>text/x-patch</p></li></ul></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Some of the mailing lists might allow attachments of other MIME content types, but the above list should be applicable for most of the mailing lists.</p></div></td></tr></tbody></table></div><div class=paragraph><p>If an email contains both an HTML and a plain text version, the HTML version will be removed. If an email contains only an HTML version, it will be converted to plain text.</p></div></div></div><div class=sect2><h3 id=eresources-news>C.3. Usenet Newsgroups<a class=anchor href=#eresources-news></a></h3><div class=paragraph><p>In addition to two FreeBSD specific newsgroups, there are many others in which FreeBSD is discussed or are otherwise relevant to FreeBSD users.</p></div><div class=sect3><h4 id=_bsd_specific_newsgroups>C.3.1. BSD Specific Newsgroups<a class=anchor href=#_bsd_specific_newsgroups></a></h4><div class=ulist><ul><li><p><a href=news:comp.unix.bsd.freebsd.announce>comp.unix.bsd.freebsd.announce</a></p></li><li><p><a href=news:comp.unix.bsd.freebsd.misc>comp.unix.bsd.freebsd.misc</a></p></li><li><p><a href=news:de.comp.os.unix.bsd>de.comp.os.unix.bsd</a> (German)</p></li><li><p><a href=news:fr.comp.os.bsd>fr.comp.os.bsd</a> (French)</p></li></ul></div></div><div class=sect3><h4 id=_other_unix_newsgroups_of_interest>C.3.2. Other UNIX® Newsgroups of Interest<a class=anchor href=#_other_unix_newsgroups_of_interest></a></h4><div class=ulist><ul><li><p><a href=news:comp.unix>comp.unix</a></p></li><li><p><a href=news:comp.unix.questions>comp.unix.questions</a></p></li><li><p><a href=news:comp.unix.admin>comp.unix.admin</a></p></li><li><p><a href=news:comp.unix.programmer>comp.unix.programmer</a></p></li><li><p><a href=news:comp.unix.shell>comp.unix.shell</a></p></li><li><p><a href=news:comp.unix.misc>comp.unix.misc</a></p></li><li><p><a href=news:comp.unix.bsd>comp.unix.bsd</a></p></li></ul></div></div><div class=sect3><h4 id=_x_window_system>C.3.3. X Window System<a class=anchor href=#_x_window_system></a></h4><div class=ulist><ul><li><p><a href=news:comp.windows.x>comp.windows.x</a></p></li></ul></div></div></div><div class=sect2><h3 id=eresources-web>C.4. Official Mirrors<a class=anchor href=#eresources-web></a></h3><div class=paragraph><p><a href=#central-mirrors>Central Servers</a>, <a href=#armenia-mirrors>Armenia</a>, <a href=#australia-mirrors>Australia</a>, <a href=#austria-mirrors>Austria</a>, <a href=#czech-republic-mirrors>Czech Republic</a>, <a href=#denmark-mirrors>Denmark</a>, <a href=#finland-mirrors>Finland</a>, <a href=#france-mirrors>France</a>, <a href=#germany-mirrors>Germany</a>, <a href=#hong-kong-mirrors>Hong Kong</a>, <a href=#ireland-mirrors>Ireland</a>, <a href=#japan-mirrors>Japan</a>, <a href=#latvia-mirrors>Latvia</a>, <a href=#lithuania-mirrors>Lithuania</a>, <a href=#netherlands-mirrors>Netherlands</a>, <a href=#norway-mirrors>Norway</a>, <a href=#russia-mirrors>Russia</a>, <a href=#slovenia-mirrors>Slovenia</a>, <a href=#south-africa-mirrors>South Africa</a>, <a href=#spain-mirrors>Spain</a>, <a href=#sweden-mirrors>Sweden</a>, <a href=#switzerland-mirrors>Switzerland</a>, <a href=#taiwan-mirrors>Taiwan</a>, <a href=#uk-mirrors>United Kingdom</a>, <a href=#usa-mirrors>United States of America</a>.</p></div><div class=paragraph><p>(as of UTC)</p></div><div id=central-mirrors class=paragraph><p><strong>Central Servers</strong></p></div><div class=ulist><ul><li><p><a href=https://www.FreeBSD.org/ class=bare>https://www.FreeBSD.org/</a></p></li></ul></div><div id=armenia-mirrors class=paragraph><p><strong>Armenia</strong></p></div><div class=ulist><ul><li><p><a href=http://www.at.FreeBSD.org/ class=bare>http://www.at.FreeBSD.org/</a> (IPv6)</p></li></ul></div><div id=australia-mirrors class=paragraph><p><strong>Australia</strong></p></div><div class=ulist><ul><li><p><a href=http://www.au.FreeBSD.org/ class=bare>http://www.au.FreeBSD.org/</a></p></li><li><p><a href=http://www2.au.FreeBSD.org/ class=bare>http://www2.au.FreeBSD.org/</a></p></li></ul></div><div id=austria-mirrors class=paragraph><p><strong>Austria</strong></p></div><div class=ulist><ul><li><p><a href=http://www.at.FreeBSD.org/ class=bare>http://www.at.FreeBSD.org/</a> (IPv6)</p></li></ul></div><div id=czech-republic-mirrors class=paragraph><p><strong>Czech Republic</strong></p></div><div class=ulist><ul><li><p><a href=http://www.cz.FreeBSD.org/ class=bare>http://www.cz.FreeBSD.org/</a> (IPv6)</p></li></ul></div><div id=denmark-mirrors class=paragraph><p><strong>Denmark</strong></p></div><div class=ulist><ul><li><p><a href=http://www.dk.FreeBSD.org/ class=bare>http://www.dk.FreeBSD.org/</a> (IPv6)</p></li></ul></div><div id=finland-mirrors class=paragraph><p><strong>Finland</strong></p></div><div class=ulist><ul><li><p><a href=http://www.fi.FreeBSD.org/ class=bare>http://www.fi.FreeBSD.org/</a></p></li></ul></div><div id=france-mirrors class=paragraph><p><strong>France</strong></p></div><div class=ulist><ul><li><p><a href=http://www1.fr.FreeBSD.org/ class=bare>http://www1.fr.FreeBSD.org/</a></p></li></ul></div><div id=germany-mirrors class=paragraph><p><strong>Germany</strong></p></div><div class=ulist><ul><li><p><a href=http://www.de.FreeBSD.org/ class=bare>http://www.de.FreeBSD.org/</a></p></li></ul></div><div id=hong-kong-mirrors class=paragraph><p><strong>Hong Kong</strong></p></div><div class=ulist><ul><li><p><a href=http://www.hk.FreeBSD.org/ class=bare>http://www.hk.FreeBSD.org/</a></p></li></ul></div><div id=ireland-mirrors class=paragraph><p><strong>Ireland</strong></p></div><div class=ulist><ul><li><p><a href=http://www.ie.FreeBSD.org/ class=bare>http://www.ie.FreeBSD.org/</a></p></li></ul></div><div id=japan-mirrors class=paragraph><p><strong>Japan</strong></p></div><div class=ulist><ul><li><p><a href=http://www.jp.FreeBSD.org/www.FreeBSD.org/ class=bare>http://www.jp.FreeBSD.org/www.FreeBSD.org/</a> (IPv6)</p></li></ul></div><div id=latvia-mirrors class=paragraph><p><strong>Latvia</strong></p></div><div class=ulist><ul><li><p><a href=http://www.lv.FreeBSD.org/ class=bare>http://www.lv.FreeBSD.org/</a></p></li></ul></div><div id=lithuania-mirrors class=paragraph><p><strong>Lithuania</strong></p></div><div class=ulist><ul><li><p><a href=http://www.lt.FreeBSD.org/ class=bare>http://www.lt.FreeBSD.org/</a></p></li></ul></div><div id=netherlands-mirrors class=paragraph><p><strong>Netherlands</strong></p></div><div class=ulist><ul><li><p><a href=http://www.nl.FreeBSD.org/ class=bare>http://www.nl.FreeBSD.org/</a></p></li></ul></div><div id=norway-mirrors class=paragraph><p><strong>Norway</strong></p></div><div class=ulist><ul><li><p><a href=http://www.no.FreeBSD.org/ class=bare>http://www.no.FreeBSD.org/</a></p></li></ul></div><div id=russia-mirrors class=paragraph><p><strong>Russia</strong></p></div><div class=ulist><ul><li><p><a href=http://www.ru.FreeBSD.org/ class=bare>http://www.ru.FreeBSD.org/</a> (IPv6)</p></li></ul></div><div id=slovenia-mirrors class=paragraph><p><strong>Slovenia</strong></p></div><div class=ulist><ul><li><p><a href=http://www.si.FreeBSD.org/ class=bare>http://www.si.FreeBSD.org/</a></p></li></ul></div><div id=south-africa-mirrors class=paragraph><p><strong>South Africa</strong></p></div><div class=ulist><ul><li><p><a href=http://www.za.FreeBSD.org/ class=bare>http://www.za.FreeBSD.org/</a></p></li></ul></div><div id=spain-mirrors class=paragraph><p><strong>Spain</strong></p></div><div class=ulist><ul><li><p><a href=http://www.es.FreeBSD.org/ class=bare>http://www.es.FreeBSD.org/</a></p></li><li><p><a href=http://www2.es.FreeBSD.org/ class=bare>http://www2.es.FreeBSD.org/</a></p></li></ul></div><div id=sweden-mirrors class=paragraph><p><strong>Sweden</strong></p></div><div class=ulist><ul><li><p><a href=http://www.se.FreeBSD.org/ class=bare>http://www.se.FreeBSD.org/</a></p></li></ul></div><div id=switzerland-mirrors class=paragraph><p><strong>Switzerland</strong></p></div><div class=ulist><ul><li><p><a href=http://www.ch.FreeBSD.org/ class=bare>http://www.ch.FreeBSD.org/</a> (IPv6)</p></li><li><p><a href=http://www2.ch.FreeBSD.org/ class=bare>http://www2.ch.FreeBSD.org/</a> (IPv6)</p></li></ul></div><div id=taiwan-mirrors class=paragraph><p><strong>Taiwan</strong></p></div><div class=ulist><ul><li><p><a href=http://www.tw.FreeBSD.org/ class=bare>http://www.tw.FreeBSD.org/</a></p></li><li><p><a href=http://www2.tw.FreeBSD.org/ class=bare>http://www2.tw.FreeBSD.org/</a></p></li><li><p><a href=http://www4.tw.FreeBSD.org/ class=bare>http://www4.tw.FreeBSD.org/</a></p></li><li><p><a href=http://www5.tw.FreeBSD.org/ class=bare>http://www5.tw.FreeBSD.org/</a> (IPv6)</p></li></ul></div><div id=uk-mirrors class=paragraph><p><strong>United Kingdom</strong></p></div><div class=ulist><ul><li><p><a href=http://www1.uk.FreeBSD.org class=bare>http://www1.uk.FreeBSD.org</a></p></li><li><p><a href=http://www3.uk.FreeBSD.org/ class=bare>http://www3.uk.FreeBSD.org/</a></p></li></ul></div><div id=usa-mirrors class=paragraph><p><strong>United States of America</strong></p></div><div class=ulist><ul><li><p><a href=http://www5.us.FreeBSD.org/ class=bare>http://www5.us.FreeBSD.org/</a> (IPv6)</p></li></ul></div></div></div></div><div class=sect1><h2 id=pgpkeys>Dodatek D: Klucze PGP<a class=anchor href=#pgpkeys></a></h2><div class=sectionbody><div class=paragraph><p>W tym rozdziale zostało zebranych, dla naszej wygody, wiele kluczy oficerów czy twórców FreeBSD, gdybyśmy musieli zweryfikować podpis bądź wysłać do jednego z nich zaszyfrowaną wiadomość. Kompletna baza kluczy użytkowników <code>FreeBSD.org</code> dostępna jest pod adresem <a href=https://docs.FreeBSD.org/pgpkeys/pgpkeys.txt>pgpkeyring.txt</a>.</p></div><div class=sect2><h3 id=pgpkeys-officers>D.1. Oficerowie<a class=anchor href=#pgpkeys-officers></a></h3><div class=sect3><h4 id=_security_officer_team_security_officerfreebsd_org>D.1.1. Security Officer Team <code>&lt;<a href=mailto:security-officer@FreeBSD.org>security-officer@FreeBSD.org</a>></code><a class=anchor href=#_security_officer_team_security_officerfreebsd_org></a></h4><div class="literalblock literal-block-margin"><div class=content><pre>pub   rsa4096/D9AD2A18057474CB 2022-12-11 [C] [expires: 2026-01-24]
      Key fingerprint = 0BE3 3275 D74C 953C 79F8  1107 D9AD 2A18 0574 74CB
uid                            FreeBSD Security Officer &lt;security-officer@freebsd.org&gt;
sub   rsa4096/6E58DE901F001AEF 2022-12-11 [S] [expires: 2025-01-15]
sub   rsa4096/46DB26D62F6039B7 2022-12-11 [E] [expires: 2025-01-15]</pre></div></div><div class="literalblock literal-block-margin"><div class=content><pre>-----BEGIN PGP PUBLIC KEY BLOCK-----

mQINBGOVdeUBEADHF5VGg1iPbACB+7lomX6aDytUf0k2k2Yc/Kp6lfYv7JKU+1nr
TcNF7Gt1YkajPSeWRKNZw/X94g4w5TEOHbJ6QQWx9g+N7RjEq75actQ/r2N5zY4S
ujfFTepbvgR55mLTxlxGKFBmNrfNbpHRyh4GwFRgPlxf5Jy9SB+0m54yFS4QlSd0
pIzO0CLkjHUFy/8S93oSK2zUkgok5gLWruBXom+8VC3OtBElkWswPkE1pKZvMQCv
VyM+7BS+MCFXSdZczDZZoEzpQJGhUYFsdg0KqlLv6z1rP+HsgUYKTkRpcrumDQV0
MMuCE4ECU6nFDDTnbR8Wn3LF5oTt0GtwS0nWf+nZ1SFTDURcSPR4Lp/PKjuDAkOS
P8BaruCNx1ItHSwcnXw0gS4+h8FjtWNZpsawtzjjgApcl+m9KP6dkBcbN+i1DHm6
NG6YQVtVWyN8aOKmoC/FEm1CWh1bv+ri9XOkF2EqT/ktbjbT1hFoFGBkS9/35y1G
3KKyWtwKcyF4OXcArl6sQwGgiYnZEG3sUMaGrwQovRtMf7le3cAYsMkXyiAnEufa
deuabYLD8qp9L/eNo+9aZmhJqQg4EQb+ePH7bGPNDZ+M5oGUwReX857FoWaPhs4L
dAKQ1YwASxdKKh8wnaamjIeZSGP5TCjurH7pADAIaB3/D+ZNl2a7od+C1wARAQAB
tDdGcmVlQlNEIFNlY3VyaXR5IE9mZmljZXIgPHNlY3VyaXR5LW9mZmljZXJAZnJl
ZWJzZC5vcmc+iQJSBBMBCgA8AhsBBAsJCAcEFQoJCAUWAgMBAAIeBQIXgBYhBAvj
MnXXTJU8efgRB9mtKhgFdHTLBQJjlXeQBQkF3u+rAAoJENmtKhgFdHTLOVoQALS3
cj7rqYkHiV4zDYrgPEp9O1kAyGI8VdfGAMkDVTqr+wP4v/o7LIUrgwZl5qxesVFB
VknFr0Wp5g9h0iAjasoI5sDd6tH2SmumhBHXFVdftzDQhrugxH6fWRhHs0SaFYCk
Qt5nFbcpUfWgtQ35XTbsL8iENdYpjKXsSFQrJneGSwxIjWYTFn6ps/AI3gwR8+Bn
OffEFdYugJ049O6Vu6YBFJHrnMO7NbF4v95dVYuLtpMIaXWM+V9KITmhaBzFz5fM
Q7UOzcLlbxOYKNIWcp8QQk429mayKW5VUeUExUD1ZzBHn+P6ZG7QTMDu/RmBqiHo
ewCMVz4n9uXT5BiOngE4CvS0WQwHzK+k9MLpG2u/Bo9+LT0Ceh9Ou1rfU5+0tRwl
GyOFFjf3INS7I7gkcAwxQ7dzDItN/UQPZpg8y9mABU2x4enz0AvTnb61d/1dnTEr
tdNgU433he0ZnD1HurZCjBEWC656wv6iMdWcD8gjhMbmEpPmjvXcYlTO6zhEygSM
DiwdQCWK2W4++YJerA6ULBi3niNWBpofOFH8XylV56ruhjtHCo7+/3carcMoPOJv
lVZ1zCKxLro3TRBT15JTFBGqblRyTopFK3PuxW//GTnZOtpQEOV6yL4RAXcWeC1d
1hb5k/YxUmRF6XsDNEH4b08T8ZO8dV3dAV43Wh1oiQEzBBABCAAdFiEEuyjUCzYO
7pNq7RVv5fe8y6O93fgFAmObXVYACgkQ5fe8y6O93fiBlwf/W8y1XXJIx1ZA3n6u
f7aS70rbP9KFPr4U0dixwKE/gbtIQ9ckeNXrDDWz0v0NCz4qS+33IPiJg1WcY3vR
W90e7QgAueCo5TdZPImPbCs42vadpa5byMXS4Pw+xyT+d/yp2oLKYbj3En4bg1GM
w71DezIjvV+e01UR++u1t9yZ8LOWM5Kumz1zyQLZDZ8qIKt1bBfpa+E0cEqtNQWu
iGhQE3AHI8eWV+jBkg5y2zHRIevbWb1UPsj43lgkFtAGHk9rrM8Rmgr4AXr531iD
srBwauKZ/MElcF3MINuLH+gkPPaFHw/YIpLRLaZXZVsw3Xi1RNXI2n2ea29dvs/C
Lcf1vYkCMwQQAQgAHRYhBPwOh4rlr+eIAo1jVdOXkvSep+XCBQJjm14FAAoJENOX
kvSep+XC0DcP/1ZB7k9p1T+9QbbZZE1PJiHby3815ccH3XKexbNmmakHIn3L6Cet
F891Kqt9ssbhFRMNtyZ/k/8y8Hv5bKxVep5/HMyK+8aqfDFN0WMrqZh0/CiR6DJh
gnAmPNw/hAVHMHaYGII9kCrFfPFJ02FKoc81g9F08odb7TV+UlvRjkErhRxF+dGS
wQoO0RCbf0Z1cs7nd0Vb2z4IJh4XMxBjWc/uQ2Q9dH/0uRzwpAnR4YX+MG5YrX7Z
zBvDyR0r76iQwRSDKgioNgkr6R3rq1NZGdaj+8b0LzdOqtzKJ/eupDe3+H67e/EN
qymtreGjrubpiU9bKvYArisUqhE5KtguryvR6Qz9bj87nPg33DT3WWGVrwFRxBox
dbWzjQFv0wug8m4GAwVF7fPR5/eW7IHw8zvgn0vSPcZz7MZ4e6Y5jN4kA5/xWJYZ
Sps54qQWB+FA30unIXN68KqdIzONIbtaY3W4/JjJUCm4T+wEjKaH+wJX8w1DMjlg
mkTmGh/UrTyC1vXbPgk9Sy3cRTICR1T9z7W8UlmTtnKrUklrjlFR7SXzrEXzLGOX
Fm+NEHpHNXqzcm6c3QfzY/yQ9HSAQ/t7SUQ9caRePbDz3/msyPxtGFor9roQv6VN
wRXCyRgkH4Y5tPhJAQ8G/FxX+VXFb93QL0lfelb23/BBu6cUwW63SRn5uQINBGOV
dskBEADqo8z6TFAhrvHhJV5wHdj67guoYvpXP8gvdCqos8SLluqi0AWgJEwlqu7L
mKQ6qMoJ+2DN6y+dEtvOVgBAgF63LLf3FQKq9FB/3uqeIiQlCIl3H43f8KttEZzf
/lbry4Y6QhS2OXM31Ut9Q+1IfTGwvs1E8/J1U4jQrAGqNKknXyQyMweJ0jvvcSLJ
nv3S7COUJVOT3cTgVeh3RIQlFzqK2rSQmygDpS8bT8MjCsZr+KGezKpbddKXio4a
QW/e6nCMyYR8bo0GQ9DpsyAOsaENnkghncQhA7GdPZK9xLMNQMCp0OdcZlqRVjRZ
OutuzNW6PPoczs/NQq02YWK4BPtSV7+ldS9gPZTLIpnRNQRzcnA0vnQTqSAfasVw
sAGm+MpH7zcaMf2Tw1K08u7+5gyObgzUzQmGLCgo9VIncnDis0s4gfTmtrr5jCeV
7LYDQX+2fApMtXbVXeKJem1PS+Z6LPbW2HklxYuG5nFgewCYlQjKujfiwW1Clhi4
JQeE1Naobbaar99V/VeoHrOYAEWP0bkUyrFcocLJ+0g3KpjSkctIptgGGpMBKe4U
9O7pWoTki8Yz/uYQn/p0iZcG8SfKM8I4283jdsi5SUiNNJJZCBQTVA7d8MxUVv5+
qpX/v5XqYM3pHza2DLXzwfAE9O2dgN1OMZYIld+OnWcpm2PxIwARAQABiQRyBBgB
CgAmFiEEC+MydddMlTx5+BEH2a0qGAV0dMsFAmOVdskCGwIFCQICKQACQAkQ2a0q
GAV0dMvBdCAEGQEKAB0WIQS2FSd+gQh991yBgztuWN6QHwAa7wUCY5V2yQAKCRBu
WN6QHwAa77gbEADpUBT14cesITuMsOWYsyEtNmB4UlTFWCktk/YzyCotasZxIhMP
Xih9G1tDo9ExIWT8jNjSSA+w0Viua/PirDLvI8JtX1JiK3nwMenwlXwlkRAk9TJW
y944YegHF/5ytntwZ/L4BMYc3MztyZbw+sDwnNBZKYmO8gwfYobtfoGxOR4Onb37
bbUVw62xHQIn2zafSmMQ4oMXZTm9EteIYwgcrC1h+Urv5IXCJZHrqmXCPE5g5XZ1
G9jqkwlaRYWjcLD0qxwc5m9LNrF6OBS9N6S7DncIYt9VupI5OCr1uRSqzqaBMFDC
lTTH+dAx3b6J1KFB0UiHP3FeTalFh8L3NE+dN9apNAgkUWv/v4oo/6dkRu3NZse2
RAo/o2X5r40qk/lhydQRZTSTFsiuH3VUWVsgmqAHnHW7pMMw8FAlKhyRSFnhbW7r
e0jj8XMIO7G5yjQKQCnYuPdXbx++bP1PzsEWDv9j/sph5arcosdo6tEXklWHED17
MEPIton1+NRfsU0peEVggQXlwdTcZN/h7FeCZ56dcwCWdCpSlv6CcWzRXSNUyJpK
a9qfIqBX/monjy7w5IHmhvLwAYI6IoT11h1QDEfGfhrwWPwOjnXsaYm5E7wv8w69
PxMbOJbMpWSg8L7xW3LXKR1VwXggUC1+b3y67E5Ggi1hf0lfTnTMpL2ClO2QD/oC
hMIafhzxbjh2WzgYahVHZH3gpHc1/0Bnc07s9+Pa6EYYM9r0XzezLW7bswOjVloR
FreQ3FIF/2OSN0OGdm7dyYl0OliTIDDDlwK/l8bcckUcpHNR1dw0P3KvDlmLmzZy
G4HmzzSBa9jiFirEfcg2rnGc6Zi382jGVALuYVplPXyMOUiChp0AAQZzTIYpXw/g
pBE6em2k740yuK6WqG4yXXgk67FoH10TQvMd4Q73K4zw+9DMpThlUHcfBmAoViZw
il7C0xl+ysHX8ZI3JU8s1r3XAnpqdHi4Wpixm/ctXbVnTSA3FQr2SctJYqR1VHRW
GMW+Ii2SQDS+t9bZTzOgAPLDtfy+JqhBpwCB1a1EHftkJEojpfZipaYGkf3yc+vN
wUeUHp/csF9CT7Qbqaj1t7fVWzv7jcVKpRwngIT4vTSzqbo6WC34FuUAH0t7tJ5K
eZ625AqEFLmtqtDo+ydJhZrVrXBNXPfkx5hSVW/I9hvckMNwA3t0KfQC2sz+Z1Q1
a4vDWQYRytfyrgZkWGbXMn6l1JyqIolgJZuax2kYs7Vu3t8KptqCbv0ZBAGoMm7r
RLgVodhI9voA8YxCirSChrueJYn+JKk8MIyk3DdXpBoocMIAjFJAUgXjV5NQpZMy
xR8BEiQnBcHRIKVWEEyhbLtHpmCEsnKNyKVGoxs31IkEcgQYAQoAJgIbAhYhBAvj
MnXXTJU8efgRB9mtKhgFdHTLBQJlhctvBQkD8n2mAkDBdCAEGQEKAB0WIQS2FSd+
gQh991yBgztuWN6QHwAa7wUCY5V2yQAKCRBuWN6QHwAa77gbEADpUBT14cesITuM
sOWYsyEtNmB4UlTFWCktk/YzyCotasZxIhMPXih9G1tDo9ExIWT8jNjSSA+w0Viu
a/PirDLvI8JtX1JiK3nwMenwlXwlkRAk9TJWy944YegHF/5ytntwZ/L4BMYc3Mzt
yZbw+sDwnNBZKYmO8gwfYobtfoGxOR4Onb37bbUVw62xHQIn2zafSmMQ4oMXZTm9
EteIYwgcrC1h+Urv5IXCJZHrqmXCPE5g5XZ1G9jqkwlaRYWjcLD0qxwc5m9LNrF6
OBS9N6S7DncIYt9VupI5OCr1uRSqzqaBMFDClTTH+dAx3b6J1KFB0UiHP3FeTalF
h8L3NE+dN9apNAgkUWv/v4oo/6dkRu3NZse2RAo/o2X5r40qk/lhydQRZTSTFsiu
H3VUWVsgmqAHnHW7pMMw8FAlKhyRSFnhbW7re0jj8XMIO7G5yjQKQCnYuPdXbx++
bP1PzsEWDv9j/sph5arcosdo6tEXklWHED17MEPIton1+NRfsU0peEVggQXlwdTc
ZN/h7FeCZ56dcwCWdCpSlv6CcWzRXSNUyJpKa9qfIqBX/monjy7w5IHmhvLwAYI6
IoT11h1QDEfGfhrwWPwOjnXsaYm5E7wv8w69PxMbOJbMpWSg8L7xW3LXKR1VwXgg
UC1+b3y67E5Ggi1hf0lfTnTMpL2ClAkQ2a0qGAV0dMsjqhAAorQ725G342raJ+os
6+E/EFNsr4SR5H+AeinlQ2ymNSeO/ODsV6dmyYD3hed0mAXvIJt2B46fFC4eAP9f
VOIbMMhPMpnJuZyLPDi8gXcZLgWSRhJ88R98KIsmKlh+/fdZM4RI1JLjICi7kyNR
4jtKCzLj0DYVBzp1mn0lTwtFzv7SC9djpqFLnO5YoGPWfQHHhY02Trh2posRwAHO
oacXSFvsoQv6k6XNlStJ4lnrkH6t+Od4kU3/TJ0eQXs7Zd2WEVnMe1IhbihsGcAY
mzZzZlLOhskHCeVE2taHiXC6h4tC3/69I16N8ICauxGY41clPhiNmVaAzmkunOPz
ry5utl6HkpZ5/3UMVHI1JIvsfJW+vSMUhdcQILAv6DbRWWHeax3ZZ6iAVGCtJS7U
glwZM1Xor0okGtIS+aJ/Cw7tZ8Nm18lutcrf2MVW+BWpzMQKnWFQYTn1NEWjzYnx
9Na22+E8AvW02TdS0NSiP0sG/0q7lBNEck9vH4WEbbEXktj51Dg4ISUhQyW8BWwW
X+kSiNeqtcaikUb8SFj5vpTDotTSzikfT/jisvR5goTMNFCVHFZdXCdsbUZd8Iub
egAOh6Db/06y3mFYDEfcGJipab400OY03a2xw9Vz+YxrKfELCTBo2tZv+3K8kXgq
XFcbyJnkXmjnYM/sw5kKqtzuc7i5Ag0EY5V3BwEQAMpFVczZo9ZPNsgW791UW5o6
wnrnd1nIO+S4rc37q2TEz8KGHCuxo5NwffZ2t6Ln04BI54pbapg17b7a0hPka37H
FkL28n4VyMdx0CsAm3QEfUsdK6xwKV2SucYeVcrV1upcN4PdXD7su1I7/A4CWXFJ
G047zJ0Z89lJZiQEiAq7ghvEoinC0sm+0a6ao/ocqCgWCKM1yCPOyzJXleRrv29S
RnYziMR+q2U0x9xg9Xl6GMwUmFwbJc9nORVvLH7fbU6/du8EgoAYrglFOFZG/TSo
lSGWRSMiavz0JSD/i+rEN4aIT4WfBe+L9Wy1AmrNxiAO+zKmzHQu3JSxDncr+y+h
cd+W0gqw10FoI9jWLcL7kR+6a0iOjuJSXSopq2l3DafiPxtCFmr4CGQhzBHM6e4/
v/NNd3F0XpVbJ6RQph7lkfvfz8q2lvUlHhezJ0p1xXmhff9CHjdVMhmAmz5+imBA
Xk2mottNfKb0pFEen1xY3K/UPA4g+oPsSj495MsvIg9eIMCcC3/z0SEUMWH/styy
JzPqfpyfGwZeTcIj9vg2o+RnGvmcLVYA/EGToPk905kv/cK73oy8bZyOB0zMg7T9
PaWgLUO0sqjqo0Mw3knFySg3oRXlcilPQvfPdX0JvwLpc9DWlr1+1GkCXJ08lWug
Jc96CJQupKRb1IbC0oUXABEBAAGJAjwEGAEKACYWIQQL4zJ110yVPHn4EQfZrSoY
BXR0ywUCY5V3BwIbDAUJAgIpAAAKCRDZrSoYBXR0ywwtD/wIDmEcHdFlyFRTomUB
jbeK2uzcZIhkkgL58lc63UPle5iJ2FBvmYS+0rQS53sVEsccn5KfkOwTryKllvWb
l0IzuiqfawxALcfWpfZJHzTMSnDHfgXvOOyFMQruqRDAHAr7PNC0CnbT0sEF2ZFz
ad8M9fLqtkXUx4mgECNGJ4CVqg75KY8uUzv/BmRwEf587FT5/iAIed5MjFB2VFDX
9GABcvTTbHxCZIxnxl3cs15SxT0lAofZ2ueU6kWYWZSXFeaEM/4ymPJws2mmV0Ak
bJghLXCn9Mx3nX6NTZZ9Harbru+RzW3/Hg3DZd0J9vko8PafP0l1NWtgyX74CqvT
gjzTxXTnqrRXzcczK7fhcC2u4i0prPtXXcyyi7SwpoLikaZCLFFhUmOx+mS5Tjtg
FyFZBNxnO7iAwkzfcTcC9sPoWaFmiQf6q5EIYzG+WQpncj80mxl3HWOP6oFj/hZJ
RYseKeMkvJzLTo87rFdM6CsMrLwETR6e+aWM0btPFil1rXVACNOjsy0bxTV8OJEf
yxnYmyjvnBvB0kdiaVEDdVhxgSqzLAX4mgXa49/V6M/uzMr+n3/A1Jdk4V6fVm8S
5cFIXxoUat3cB4xGaT9OWD3o1NPr6eS9Vo0EsJlRl81SG68fS+Qtk2fX27T68YG4
Aa3zMfZxUsVuFLtTuQbRC+fJpIkCPAQYAQoAJgIbDBYhBAvjMnXXTJU8efgRB9mt
KhgFdHTLBQJlhcuqBQkD8n1oAAoJENmtKhgFdHTLoO0QAJsTE9fkleb7YzPEuP9G
J3jx8PGdWm7n+8UNdr24kS6gOXVUfPZrWa5So21hcIwZb4PZDqHSVSQnRciKhSnG
7gplYPNGZ4+FWbLr/mBRYarjkVFLUuCPexSIjxV1KSGJnWs9YTVAKZAz75GpCML6
jD6biCOQCQ86wqOdWvZIZR8YvurrxR64ABB0rjbsaG8cNOUX1cwAfdLwthf64dS+
2m3lqNGDHkP5eNL0RIxC5gXYEp0lvmlMH3ZuO5WrfH73PTDg89bxXeuhrFmSEwf4
xWm603oi8/2qQvR9/7jb0o+t71NQuWrWIFONZWWgZBUGso+uyT3XgY4YqKGR3z2Q
zKHYnJ6M7SvSYpqS7RtcxcCXF0HGNfES8cAgtKVpFtbtSwXXp8O8oLyjmVIO/NjU
pbLOGdFIsarsezLFV9f2fqZ63J34hyUSg8LrYVV1fA5DJUpebbX4hLpdk0MMtgG4
3BwKIGlJTpL5RkQ/uQU3YW2kairy7o+1imDD0TRzQxtdjVOI5vnlTNcfJZIIfLx4
drABA12OvpX3dfPV62R+8BAlJFT430CG6AISJIBqJRFvuikmnZGUvEHmOUs/FLbb
aXTPkKc7tR2WIwljRvMV+Qk84cWcX6YchMslMuiDM1mtlQZig34WHGSE+zCWnXAs
lIHlSwox7qfdO0Kz2XncSbIA
=QvUh
-----END PGP PUBLIC KEY BLOCK-----</pre></div></div></div><div class=sect3><h4 id=_core_team_secretary_core_secretaryfreebsd_org>D.1.2. Core Team Secretary <code>&lt;<a href=mailto:core-secretary@FreeBSD.org>core-secretary@FreeBSD.org</a>></code><a class=anchor href=#_core_team_secretary_core_secretaryfreebsd_org></a></h4><div class="literalblock literal-block-margin"><div class=content><pre>pub   rsa4096/4D632518C3546B05 2024-02-17 [SC] [expires: 2025-02-16]
      Key fingerprint = 1A23 6A92 528D 00DD 7965  76FE 4D63 2518 C354 6B05
uid                            FreeBSD Core Team Secretary &lt;core-secretary@FreeBSD.org&gt;
sub   rsa4096/CABFDE12CA516ED2 2024-02-17 [E] [expires: 2025-02-16]</pre></div></div><div class="literalblock literal-block-margin"><div class=content><pre>-----BEGIN PGP PUBLIC KEY BLOCK-----

mQINBGXQ1o8BEAC+Rcg8cmVxuP17Vu+q5KgCx/XiulQuqKXAqqBlYCH2jqk6DINP
yFrREGBhzd/qNmlAYEahQ4Zgl0bUZNTrZVDyzicOvPP0jH+KSTQwRs7NOawEdlVO
cyHrwDCPEqf5ZzD4NhfTriEOw+j0pEH/onitUGvoQRtx15xWyaJQxDEBMTYMLewE
86D1bltwnTNczE3UZb7oQLJXkAX5hcLtou70XJGgZITvJkK+kp/xot2eFjnqRz/u
WeXnKhYAmC07EKwZ1uw047eHKwMMRBYqzApLwoQtfE430Kxf2q8de64x8zDbi6YM
1J4r8OAxOtHVyfJ0j7Q23DEZz0VVb4b1Tx5OG2Re/KSNvqI0awJO4TcRmOR88OyY
dzyXgnX6Sa7GVQY1FXvn7vtFuDAt7egZOzeomSHL9bdX07LTQ4UtM88EV9wm3q4q
smoatV9jsvPQ1zxCU3aQD/5eWTJH2/kz1LIuBL/Qi5XQpJn91lBtUWJrCgkHWPGu
f//rnnXmsG7DAChW+yZ7cFO8lfNa8sFhPqSxCYphWmJTrvadyQtDngB8JakWdnmK
pfGS6y5lel+181vw38ZZKt04AKM+nDY8051lBM7Q9Q6kTLI33UZeImndx5xYukVD
kV6aQ31HYfEark15c7iEz+OAcwFnM2ntXMt7kKGd40CqzusiPcQkPqPbAQARAQAB
tDhGcmVlQlNEIENvcmUgVGVhbSBTZWNyZXRhcnkgPGNvcmUtc2VjcmV0YXJ5QEZy
ZWVCU0Qub3JnPokCVwQTAQoAQRYhBBojapJSjQDdeWV2/k1jJRjDVGsFBQJl0NaP
AhsDBQkB4TOACAsJDQgMBwsDBRUKCQgLBRYDAgEAAh4FAheAAAoJEE1jJRjDVGsF
nacP/3PSg8JPmWoBfWrgT287NZ7OAU16/uGpDxlBUoVeEtkEDqZVW8yBFzrMhbwj
bJs3CZ+L85HMUDLZoxSwVnPM8PLVRzHTybYV7agYYzMox5C/jp2aeAgy9KYVd0Tk
07GMTYrSh4fhHWpxXz7IBOxk0RXvQxTHlg1u0DASkibYb2UTDcUNG5Q9kP/8jaIZ
kVDX8a5LDdOCgWaYdKPg4blv/UMjkegJz+Ayp7gXTcux6koW5F6ysSw9sgLBWb2D
b/KNIi4MBMe46xyXB/dqGAR4ibrUXTcQ4OAZNq1L6uWG1A49XuSgykdIwr00MzQw
wfVpKT31ww4ayVHLgj7NuqPlab9S5/fPfJ4MAvGE4GqWQFgsPKgKImUMgnnxTGpv
l7Dqk2MnWqn+wEi0bRES0PVBG96G+sZJQeaxBhoB+HwUSFqoZQg166AJIl//4t2w
bx0a1aWQSS0DZt3wsQW3NW9AE6L+FnFfIc2pQVoLjmvcGalDuvnemRmEOgotiZmt
32bi2aWxg0/Qio2rjLS2LpV+fhwDSN3Agvtnu53yUdD1TFFjTSMloM4SKhiXoPbI
XgfCLiBLNMsZL0AvO7wQfSePzPYxDLyEcwsfPJ8be+eGG1L62RUyad+MdfyXMH/S
m0sgqW/MW6Nv10RyPQOq3Jbgmp2laRMzKTOvQt5WwQf2FEl9uQINBGXQ1o8BEAC9
1cBYn6Z0QmM0OFWdXQI6fMOeNokaa6ngPgt7bzW5NjryqTdwyHOPZdm4DWf1SO/0
+fJRCqxbICyuMAFrb9fDle8bodALjm5ZquTL3D61HpZD4+RwOzOjYP6wLm7h38HT
/yIyK882Ovlw4Xz/TeSiL/VUSWE9twW7yz3oreCeLUBAfzacS9y+syO+aquEd0/x
JBz+mPQbrqfS64rCZXMZEivgsjkQoE6RM+n1rF4kw4Eu3E2kPevVwsoAaY+MEUM8
JAXaJMaNcLIhbeMy7dO/z6z2I3h5bUw5KxfVwzYSzSeRpYh53dNaB4NY+f5/vTrL
4dZmqBcLgcV0zZ02dj/u0SiwWlUFUpFGuSiW16DN7+2zG1zOWi7Nl44JawM62Tlf
mO8zruVGEHaV3e8fFwBLRKM0Sc7e3aLECISsfYeC5ZbRRbpQ1KX+VQr3FBKAMzG4
l9Go7vZ+UcLKpQx2rVPTJt1vDnRV49X6CF2Q/lV9iafQ4MTy6ACdAloT1yfH/lhU
iWQo1qDyRCSlmNBDsYl8gLrwMp4gGQAv3imZHxnJF5ru3nUYGG0U08D5mf2sWv5P
Wh7By8Jm8bmaP8cUF86lO9BJXh2d9QN5jqrAtXqYzenZ+ABSoL1XrD/yv3270rH7
H4gAUtgP+vJ3uMyRu9055OC+ie/b613NojCW5nYN2QARAQABiQI8BBgBCgAmFiEE
GiNqklKNAN15ZXb+TWMlGMNUawUFAmXQ1o8CGwwFCQHhM4AACgkQTWMlGMNUawXh
7w/+KjbEWTwAhjm2HJ3w4tXtPC5URg+A+BzYYVH/q0+956c1QeD0LYafHBw4LEMI
lhRvHQnmzwjtY8v/DgmLOVDMiMWVHo0Q2iQyMvOT1WyEPcgOTJLhvyVzDqRZx7AS
B4G8uNVkKAdBZ7OSXAP27lR/2SEoG05esw8b7Y39pVtucC3aeiua+19PLJWadBjj
XuvXuSCho0km+nk4IgadYmxIDyiMeyKZ8wCl7CJkzECm83q2OtNsMe3k8lgEXybt
KlQxnYApZmhqLMV5ob8WOk3AgAVsif1m332CiEIb1Sfx6wt3nXy/410CXdDDucuj
ndJVfJ6Un33tn0irZ5scPA2HmzK1PGMfgOGtkM8B3LE/x8kEKeWKb3l9boB32Unm
iTfKgEna+JISEab3bzOPWdCQFB8LyGXuWlhtvqmRoX8GtiMRy/F4mzh+l3lYHjj3
4EvPVyippO5zwU+S9HElJ2G37K6zrOmd5cGBrw4aBDoO70QVrMN4O86uvC9kChDb
qyFF5UgXg29QxJjiSCv98ksDMqpJ5AFYrmrsBtwU64OANrxxJ4AZLQ1apYmG9RWD
VHZgfeI60FNBLfKwix9UffFT7piQ/MLrjSde8gPH5S6ezBMrYpfGEopaI9A5qXe3
LnHz88gfdmaBM77YDZM/p23nmCrUxlE3kkbgjTY8NRjYyF8=
=MkAH
-----END PGP PUBLIC KEY BLOCK-----</pre></div></div></div><div class=sect3><h4 id=_ports_management_team_secretary_portmgr_secretaryfreebsd_org>D.1.3. Ports Management Team Secretary <code>&lt;<a href=mailto:portmgr-secretary@FreeBSD.org>portmgr-secretary@FreeBSD.org</a>></code><a class=anchor href=#_ports_management_team_secretary_portmgr_secretaryfreebsd_org></a></h4><div class="literalblock literal-block-margin"><div class=content><pre>pub   ed25519/E3C401F60D709D59 2023-03-06 [SC] [expires: 2027-03-05]
      Key fingerprint = BED4 A1D3 6555 B681 2E9F  ABDA E3C4 01F6 0D70 9D59
uid                            FreeBSD Ports Management Team Secretary &lt;portmgr-secretary@FreeBSD.org&gt;
sub   cv25519/2C92B55E27A641C3 2023-03-06 [E] [expires: 2027-03-05]</pre></div></div><div class="literalblock literal-block-margin"><div class=content><pre>-----BEGIN PGP PUBLIC KEY BLOCK-----

mDMEZAXJvxYJKwYBBAHaRw8BAQdASFAC20WL3R1T6uNyGMZbfJCxDkcP4C5vi3Op
tcZ2fbq0R0ZyZWVCU0QgUG9ydHMgTWFuYWdlbWVudCBUZWFtIFNlY3JldGFyeSA8
cG9ydG1nci1zZWNyZXRhcnlARnJlZUJTRC5vcmc+iJYEExYKAD4WIQS+1KHTZVW2
gS6fq9rjxAH2DXCdWQUCZAXJvwIbAwUJB4TOAAULCQgHAwUVCgkICwUWAwIBAAIe
BQIXgAAKCRDjxAH2DXCdWYN1AP43TjyfZtZ3DLYT++g0+SuPsoO/3yWVybA+UmFL
zb8MngEA+LLNUfvEwCuXS/soh+ww5bpfmi3UUmeGiQEAXug3iA+JATMEEAEKAB0W
IQT7N0XIbxXo7ayBMvzYKU7Du8TX1QUCZAXLkwAKCRDYKU7Du8TX1XHMB/9R1MX4
6zMgpKqPPt76GOI+eGEdBK6bY8aJZjQGdqTh9f6VtXVoTGIG7cvhc9X8tDBoB0PT
2KZWheF51AV1+NHU4HwLAQ1BMebrFvWSfkw4xg4fBGwDhz9/GN85No+Js772V5ey
8lRiL6meRVWxMlLyWcxGd8JjcC5yX/iAUQ3SBGCLqW7unWjjg7CTd+AMBwcqPGrv
ax8q6eFVguJcHJAjMnKf6HAy4cpK3s+uMoUBCGnszSN12B3ysKfyC4pNO/pix5tA
Q5v8aRqTeFPh5zmNhWo0KGPzplTPqRQSHDl7GDQC8Ru3MhzFkeWzHsexjZVwS6W2
DPcYpuuAsA0XOZIZiQIzBBABCgAdFiEEEBpxaxYrAOVb7eoFrbv4YQo3ibcFAmQF
0u0ACgkQrbv4YQo3ibccwg/9F2Xuic3nhKxRbB3mJeDo6SYQETa/Gh1qQ34+8zlt
8UMazOx67gnYQfy+pXjro6eQ2up0a4eUYezcNOudqAQD21nRz3HA6EQVNcE/TzEA
xl5CJntTaLOt7S+EDXFW5BuQIvhhoMGgm8+WNVgA0EJ7tfL0OcYBSvr19fqwChEn
9c14cSk6mgHSsleP5NvskYN053pxHwy0LTSb8YBBv52th37t/CRFC1363rS5q+D7
JixFopd1O5pKpA5ipvE4gGgRjPtwjx0SjjepwK/3fuhEJQQyKzTIKlMfu2Dj/iR2
Li1Sfccau5LQXOj9fUITU3u1YG7yrm8VGzT7ao4d+KRwgMLjd2pLqiGIbbJwGBiP
FRmtilWQoeIlmSlFX4obAA517DOK0pW1mH8+eEn4EJd3SekT3yzFyKTASv0J48Z8
3F928xg+eZvHxVC0t1J+J5IG0gt3EEncuWKIPQGR7PiQbti6R3FQVTz6WfMWOebP
Qi0E9F/Aqakr6Vj2sKGrDq+ebpaF5G8Yw1YrUl2IDiPzkCegp3ZbI0wh11Xvzhi8
LXPQGK4jBQas4G8cegfitzmtdGRHYrbMv0R9I4mvaL+WlOuD2AvyVG28lguqVhnN
AZP+ohdquYyX2CNCVvbKWAtXo6Ur0vWG8BL8m6defAtEkIwVBALaOHQOSI3aNUz4
lwy4OARkBcm/EgorBgEEAZdVAQUBAQdAsefmSfxEOdOr02+K/6noYCuJ1FeAWVz6
jFYQ+9w6jggDAQgHiH4EGBYKACYWIQS+1KHTZVW2gS6fq9rjxAH2DXCdWQUCZAXJ
vwIbDAUJB4TOAAAKCRDjxAH2DXCdWRl4AP9h5ot212BK29S6ZcMBhHvmtF5PG1oD
c7LnZycSRmbFiwEAndCMpAGOhDW8iVgDd0wLQq/ZMPe+xccfG1b3zFH2EgE=
=iiAT
-----END PGP PUBLIC KEY BLOCK-----</pre></div></div></div><div class=sect3><h4 id=_doceng_secretaryfreebsd_org>D.1.4. <code>&lt;<a href=mailto:doceng-secretary@FreeBSD.org>doceng-secretary@FreeBSD.org</a>></code><a class=anchor href=#_doceng_secretaryfreebsd_org></a></h4><div class="literalblock literal-block-margin"><div class=content><pre>pub   rsa2048/E1C03580AEB45E58 2019-10-31 [SC] [expires: 2022-10-30]
      Key fingerprint = F24D 7B32 B864 625E 5541  A0E4 E1C0 3580 AEB4 5E58
uid                            FreeBSD Doceng Team Secretary &lt;doceng-secretary@freebsd.org&gt;
sub   rsa2048/9EA8D713509472FC 2019-10-31 [E] [expires: 2022-10-30]</pre></div></div><div class="literalblock literal-block-margin"><div class=content><pre>-----BEGIN PGP PUBLIC KEY BLOCK-----

mQENBF27FFcBCADeoSsIgyQUY8vREwkTikwFFlNg31MVy5s/Nq1cNK1PRfRMnprS
yfB62KqbYuz16bmQKaA9zHN4FGfiTvR6tl66LVHm1s/5HPiLv8sP14GsruLro9zN
v72dO7a9i68bMw+jarPOnu9dGiDFEI0dACOkdCGEYKEUapQeNpmWRrQ46BeXyFwF
JcNx76bJJUkwk6fWC0W63D762e6lCEX6ndoaPjjLBnFvtx13heNGUc8RukBwe2mA
U5pSGHj47J05bdWiRSwZaXa8PcW+20zTWaP755w7zWe4h60GANY7OsT9nuOqsioJ
QonxTrJuZweKRV8fNQ1EfDws3HZr7/7iXvO3ABEBAAG0PEZyZWVCU0QgRG9jZW5n
IFRlYW0gU2VjcmV0YXJ5IDxkb2Nlbmctc2VjcmV0YXJ5QGZyZWVic2Qub3JnPokB
VAQTAQoAPhYhBPJNezK4ZGJeVUGg5OHANYCutF5YBQJduxRXAhsDBQkFo5qABQsJ
CAcDBRUKCQgLBRYDAgEAAh4BAheAAAoJEOHANYCutF5YB2IIALw+EPYmOz9qlqIn
oTFmk/5MrcdzC5iLEfxubbF6TopDWsWPiOh5mAuvfEmROSGf6ctvdYe9UtQV3VNY
KeeyskeFrIBOFo2KG/dFqKPAWef6IfhbW3HWDWo5uOBg01jHzQ/pB1n6SMKiXfsM
idL9wN+UQKxF3Y7S/bVrZTV0isRUolO9+8kQeSYT/NMojVM0H2fWrTP/TaNEW4fY
JBDAl5hsktzdl8sdbNqdC0GiX3xb4GvgVzGGQELagsxjfuXk6PfOyn6Wx2d+yRcI
FrKojmhihBp5VGFQkntBIXQkaW0xhW+WBGxwXdaAl0drQlZ3W+edgdOl705x73kf
Uw3Fh2a5AQ0EXbsUVwEIANEPAsltM4vFj2pi5xEuHEcZIrIX/ZJhoaBtZkqvkB+H
4pu3/eQHK5hg0Dw12ugffPMz8mi57iGNI9TXd8ZYMJxAdvEZSDHCKZTX9G+FcxWa
/AzKNiG25uSISzz7rMB/lV1gofCdGtpHFRFTiNxFcoacugTdlYDiscgJZMJSg/hC
GXBdEKXR5WRAgAGandcL8llCToOt1lZEOkd5vJM861w6evgDhAZ2HGhRuG8/NDxG
r4UtlnYGUCFof/Q4oPNbDJzmZXF+8OQyTNcEpVD3leEOWG1Uv5XWS2XKVHcHZZ++
ISo/B5Q6Oi3SJFCVV9f+g09YF+PgfP/mVMBgif2fT20AEQEAAYkBPAQYAQoAJhYh
BPJNezK4ZGJeVUGg5OHANYCutF5YBQJduxRXAhsMBQkFo5qAAAoJEOHANYCutF5Y
kecIAMTh2VHQqjXHTszQMsy3NjiTVVITI3z+pzY0u2EYmLytXQ2pZMzLHMcklmub
5po0X4EvL6bZiJcLMI2mSrOs0Gp8P3hyMI40IkqoLMp7VA2LFlPgIJ7K5W4oVwf8
khY6lw7qg2l69APm/MM3xAyiL4p6MU8tpvWg5AncZ6lxyy27rxVflzEtCrKQuG/a
oVaOlMjH3uxvOK6IIxlhvWD0nKs/e2h2HIAZ+ILE6ytS5ZEg2GXuigoQZdEnv71L
xyvE9JANwGZLkDxnS5pgN2ikfkQYlFpJEkrNTQleCOHIIIp8vgJngEaP51xOIbQM
CiG/y3cmKQ/ZfH7BBvlZVtZKQsI=
=MQKT
-----END PGP PUBLIC KEY BLOCK-----</pre></div></div></div></div></div></div><div id=footnotes><hr><div class=footnote id=_footnotedef_1><a href=#_footnoteref_1>1</a>. The auto-tuning algorithm sets maxusers equal to the amount of memory in the system, with a minimum of 32, and a maximum of 384.</div><div class=footnote id=_footnotedef_2><a href=#_footnoteref_2>2</a>. <a href=https://www.freebsd.org/news/status/ class=bare>https://www.freebsd.org/news/status/</a></div></div></div><hr><div class=last-modified><p><strong>Last modified on</strong>: 11 grudnia 2021 by <a href="https://cgit.freebsd.org/doc/commit/?id=2b027dd017" target=_blank>Sergio Carlavilla Delgado</a></p></div><div class=buttons><div class=home><i class="fa fa-home" aria-hidden=true title=Home></i><div class=container><a href=../ class=direction>Home</a></div></div></div><label class="hidden book-menu-overlay" for=menu-control></label></div><aside class=toc><div class=toc-content><h3>Table of Contents</h3><nav id=TableOfContents><ul><li><a href=#book-preface>Przedmowa</a><ul><li><a href=#preface-audience>Docelowy czytelnik</a></li><li><a href=#preface-changes-from2>Zmiany od wydania drugiego</a></li><li><a href=#preface-changes>Zmiany od wydania pierwszego</a></li><li><a href=#preface-overview>Układ książki</a></li><li><a href=#preface-conv>Konwencje użyte w tej książce</a></li><li><a href=#preface-acknowledgements>Podziękowania</a></li></ul></li><li><a href=#getting-started>Część I: Pierwsze kroki</a><ul><li><a href=#introduction>Rozdział 1. Wprowadzenie</a></li><li><a href=#install>Rozdział 2. Instalacja FreeBSD</a></li><li><a href=#basics>Rozdział 3. Podstawy Uniksa</a></li><li><a href=#ports>Rozdział 4. Instalacja programów: pakiety i porty</a></li><li><a href=#x11>Rozdział 5. System okien X</a></li></ul></li><li><a href=#common-tasks>Część II: Codzienne czynności</a><ul><li><a href=#desktop>Rozdział 6. Aplikacje biurowe</a></li><li><a href=#multimedia>Rozdział 7. Multimedia</a></li><li><a href=#kernelconfig>Rozdział 8. Konfiguracja jądra FreeBSD</a></li><li><a href=#printing>Rozdział 9. Printing</a></li><li><a href=#linuxemu>Rozdział 10. Linux® Binary Compatibility</a></li></ul></li><li><a href=#system-administration>Część III: Administracja systemem</a><ul><li><a href=#config-tuning>Rozdział 11. Configuration and Tuning</a></li><li><a href=#boot>Rozdział 12. The FreeBSD Booting Process</a></li><li><a href=#security>Rozdział 13. Security</a></li><li><a href=#jails>Rozdział 14. Jails</a></li><li><a href=#mac>Rozdział 15. Mandatory Access Control</a></li><li><a href=#audit>Rozdział 16. Security Event Auditing</a></li><li><a href=#disks>Rozdział 17. Storage</a></li><li><a href=#geom>Rozdział 18. GEOM: Modular Disk Transformation Framework</a></li><li><a href=#zfs>Rozdział 19. The Z File System (ZFS)</a></li><li><a href=#filesystems>Rozdział 20. Other File Systems</a></li><li><a href=#virtualization>Rozdział 21. Virtualization</a></li><li><a href=#l10n>Rozdział 22. Localization - i18n/L10n Usage and Setup</a></li><li><a href=#updating-upgrading>Rozdział 23. Updating and Upgrading FreeBSD</a></li><li><a href=#dtrace>Rozdział 24. DTrace</a></li><li><a href=#usb-device-mode>Rozdział 25. USB Device Mode / USB OTG</a></li></ul></li><li><a href=#network-communication>Część IV: Komunikacja sieciowa</a><ul><li><a href=#serialcomms>Rozdział 26. Serial Communications</a></li><li><a href=#ppp-and-slip>Rozdział 27. PPP</a></li><li><a href=#mail>Rozdział 28. Electronic Mail</a></li><li><a href=#network-servers>Rozdział 29. Network Servers</a></li><li><a href=#firewalls>Rozdział 30. Firewalls</a></li><li><a href=#advanced-networking>Rozdział 31. Advanced Networking</a></li></ul></li><li><a href=#appendices>Część V: Dodatki</a><ul><li><a href=#mirrors>Dodatek A: Obtaining FreeBSD</a></li><li><a href=#bibliography>Dodatek B: Bibliografia</a></li><li><a href=#eresources>Dodatek C: Resources on the Internet</a></li><li><a href=#pgpkeys>Dodatek D: Klucze PGP</a></li></ul></li></ul></nav><hr><div class=resources><h3>Resources</h3><ul class=contents><li><i class="fa fa-file-pdf-o" aria-hidden=true title="Download PDF"></i><a href=https://download.freebsd.org/doc/pl/books/handbook/handbook_pl.pdf>Download PDF</a></li><li><i class="fa fa-pencil-square-o" aria-hidden=true title="Edit this page"></i><a href=https://github.com/freebsd/freebsd-doc/blob/main/documentation/content/pl/book target=_blank>Edit this page</a></li></ul></div></div></aside><a class=to-top href=#top><i class="fa fa-arrow-circle-up" aria-hidden=true></i></a></main><footer><div class=footer-container><section class=logo-column><img src=https://docs.freebsd.org/images/FreeBSD-colors.svg width=160 height=50 alt="FreeBSD logo"><div class=options-container><div class=language-container><a id=languages href=https://docs.freebsd.org/pl/languages><img src=https://docs.freebsd.org/images/language.png class=language-image alt="Choose language">
<span>Polish</span></a></div><div class=theme-container><select id=theme-chooser><option value=theme-system>System</option><option value=theme-light>Light</option><option value=theme-dark>Dark</option><option value=theme-high-contrast>High contrast</option></select></div></div></section><section class=about-column><h3 class=column-title>About</h3><ul class=column-elements-container><li><a href=https://www.freebsd.org/about/ target=_blank class=column-element>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/ target=_blank class=column-element>FreeBSD Foundation</a></li><li><a href=https://www.freebsd.org/where/ target=_blank class=column-element>Get FreeBSD</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct target=_blank class=column-element>Code of Conduct</a></li><li><a href=https://www.freebsd.org/security/ target=_blank class=column-element>Security Advisories</a></li></ul></section><section class=documentation-column><h3 class=column-title>Documentation</h3><ul class=column-elements-container><li><a href=/pl class=column-element>Documentation portal</a></li><li><a href=https://man.FreeBSD.org target=_blank class=column-element>Manual pages</a></li><li><a href=https://papers.FreeBSD.org target=_blank class=column-element>Presentations and papers</a></li><li><a href=https://docs-archive.freebsd.org/doc/ target=_blank class=column-element>Previous versions</a></li><li><a href=https://docs-archive.freebsd.org/44doc/ target=_blank class=column-element>4.4BSD Documents</a></li><li><a href=https://wiki.freebsd.org/ target=_blank class=column-element>Wiki</a></li></ul></section><section class=community-column><h3 class=column-title>Community</h3><ul class=column-elements-container><li><a href=https://docs.freebsd.org/pl/articles/contributing class=column-element>Get involved</a></li><li><a href=https://forums.freebsd.org/ target=_blank class=column-element>Community forum</a></li><li><a href=https://lists.freebsd.org/ target=_blank class=column-element>Mailing lists</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank class=column-element>IRC Channels</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank class=column-element>Bug Tracker</a></li></ul></section><section class=legal-column><h3 class=column-title>Legal</h3><ul class=column-elements-container><li><a href=https://freebsdfoundation.org/donate/ target=_blank class=column-element>Donations</a></li><li><a href=https://www.freebsd.org/copyright/freebsd-license/ target=_blank class=column-element>Licensing</a></li><li><a href=https://www.freebsd.org/privacy/ target=_blank class=column-element>Privacy Policy</a></li><li><a href=https://www.freebsd.org/copyright/ target=_blank class=column-element>Legal notices</a></li></ul></section><section class=copyright-column><p>&copy; 1994-2024 The FreeBSD Project. All rights reserved</p><span>Made with <span class=heart>♥</span> by the FreeBSD Community</span></section></div></footer></body></html>