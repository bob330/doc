<!doctype html><html class=theme-light lang=zh-tw><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content><meta name=copyright content="1995-2024 The FreeBSD Foundation"><link rel=canonical href=https://docs.freebsd.org/zh-tw/books/handbook/disks/><title>章 17. 儲存設備 | FreeBSD Documentation Portal</title>
<meta name=theme-color content="#790000"><meta name=color-scheme content="system light dark high-contrast"><link rel="shortcut icon" href=https://docs.freebsd.org/favicon.ico><link rel=stylesheet href=https://docs.freebsd.org/styles/main.min.css><link rel=stylesheet href=https://docs.freebsd.org/css/font-awesome-min.css><script defer src=/js/theme-chooser.min.js></script><script defer src=/js/copy-clipboard.min.js></script><script defer src=/js/search.min.js></script><meta name=twitter:card content="summary"><meta name=twitter:domain content="docs.FreeBSD.org"><meta name=twitter:site content="@freebsd"><meta name=twitter:url content="https://twitter.com/freebsd"><meta property="og:title" content="章 17. 儲存設備"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:image" content="https://docs.freebsd.org/favicon.ico"><meta property="og:image:alt" content="FreeBSD Logo"><meta property="og:locale" content="zh-tw"><meta property="og:url" content="https://docs.freebsd.org/zh-tw/books/handbook/disks/"><meta property="og:site_name" content="FreeBSD Documentation Portal"><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","url":"https:\/\/docs.freebsd.org\/zh-tw\/books\/handbook\/disks\/","name":"FreeBSD Documentation Portal","headline":"FreeBSD Documentation Portal","description":"FreeBSD Documentation Portal"}</script></head><body><header><div class=header-container><div class=logo-menu-bars-container><a href=https://www.FreeBSD.org class=logo><img src=https://docs.freebsd.org/images/FreeBSD-monochromatic.svg width=160 height=50 alt="FreeBSD logo">
</a><label class=menu-bars for=menu-bars><i class="fa fa-bars" aria-hidden=true></i></label></div><input id=menu-bars type=checkbox><nav><ul class=menu><li class=menu-item><input id=about type=checkbox>
<a href=# aria-label="Navigate to About section"><label class=menu-item-description for=about>About
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/about/ target=_blank>About</a></li><li><a href=https://www.freebsd.org/about/ target=_blank>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/about-us/about-the-foundation/ target=_blank>FreeBSD Foundation</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct/ target=_blank>Code of Conduct</a></li></ul></li><li class=menu-item><input id=download type=checkbox>
<a href=# aria-label="Navigate to get FreeBSD section"><label class=menu-item-description for=download>Get FreeBSD
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/where/ target=_blank>Get FreeBSD</a></li><li><a href=https://www.freebsd.org/releases/ target=_blank>Release Information</a></li><li><a href=https://www.freebsd.org/releng/ target=_blank>Release Engineering</a></li><li><a href=https://www.freebsd.org/security/ target=_blank>Security Advisories</a></li></ul></li><li class=menu-item><input id=documentation type=checkbox>
<a href=# aria-label="Navigate to get Documentation section"><label class=menu-item-description for=documentation>Documentation
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=/zh-tw>Documentation portal</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook>FreeBSD Handbook</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/porters-handbook>Porter's Handbook</a></li><li><a href=https://docs.FreeBSD.org/en/books/fdp-primer>Documentation Project Handbook</a></li><li><a href=https://man.FreeBSD.org target=_blank>Manual pages</a></li><li><a href=https://papers.FreeBSD.org target=_blank>Presentations and papers</a></li><li><a href=https://wiki.FreeBSD.org target=_blank>Wiki</a></li><li><a href=https://docs.freebsd.org/zh-tw/books>Books</a></li><li><a href=https://docs.freebsd.org/zh-tw/articles>Articles</a></li></ul></li><li class=menu-item><input id=community type=checkbox>
<a href=# aria-label="Navigate to get Community section"><label class=menu-item-description for=community>Community
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/community/>Community</a></li><li><a href=https://docs.freebsd.org/zh-tw/articles/contributing>Get involved</a></li><li><a href=https://forums.freebsd.org/ target=_blank>Forum</a></li><li><a href=https://lists.freebsd.org/ target=_blank>Mailing lists</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank>IRC Channels</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank>Bug Tracker</a></li><li><a href=https://www.freebsd.org/support/ target=_blank>Support</a></li></ul></li></ul></nav><div class=search-donate-container><form class=search method=get id=search-header-form action=https://docs.freebsd.org/search name=search-header-form><input type=hidden name=DB value=zh-tw>
<input id=words name=P type=text size=20 maxlength=255>
<button>
<i class="fa fa-search" aria-hidden=true></i></button></form><div class=donate><a href=https://freebsdfoundation.org/donate/ target=_blank><span class=heart>♥</span>
Donate</a></div></div></div></header><input type=checkbox class="hidden toggle" id=menu-control><main class=main-wrapper-book><a id=top></a><aside class=book-menu><div class=book-menu-content><input id=search-book type=text placeholder=Search aria-label=Search maxlength=128><nav id=MenuContents><ul><li><input type=checkbox id=chapter-eb2a98ce203d8afd517726e6d8776be3 class=toggle>
<label class="icon cursor" for=chapter-eb2a98ce203d8afd517726e6d8776be3><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/preface/>序</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/preface/#preface-audience>給讀者的話</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/preface/#preface-changes-from3>自第三版後的主要修訂</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/preface/#preface-changes-from2>自第二版後的主要修訂 (2004)</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/preface/#preface-changes>自第一版後的主要修訂 (2001)</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/preface/#preface-overview>本書架構</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/preface/#preface-conv>本書的編排體裁</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/preface/#preface-acknowledgements>銘謝</a></li></ul></li><li><input type=checkbox id=chapter-14a525fce014b90b8a458a894818255a class=toggle>
<label for=chapter-14a525fce014b90b8a458a894818255a><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/parti/>部 I. 入門</a></li><li><input type=checkbox id=chapter-f9c9f3451644df30d224350da97d5da6 class=toggle>
<label class="icon cursor" for=chapter-f9c9f3451644df30d224350da97d5da6><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/introduction/>章 1. 簡介</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/introduction/#introduction-synopsis>1.1. 概述</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/introduction/#nutshell>1.2. 歡迎使用 FreeBSD！</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/introduction/#history>1.3. 關於 FreeBSD 計劃</a></li></ul></li><li><input type=checkbox id=chapter-f693a3fa687a72d63ec8129ee302d664 class=toggle>
<label class="icon cursor" for=chapter-f693a3fa687a72d63ec8129ee302d664><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/bsdinstall/>章 2. 安裝 FreeBSD</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/bsdinstall/#bsdinstall-synopsis>2.1. 概述</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/bsdinstall/#bsdinstall-hardware>2.2. 最低硬體需求</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/bsdinstall/#bsdinstall-pre>2.3. 安裝前準備工作</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/bsdinstall/#bsdinstall-start>2.4. 開始安裝</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/bsdinstall/#using-bsdinstall>2.5. 使用 bsdinstall</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/bsdinstall/#bsdinstall-partitioning>2.6. 配置磁碟空間</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/bsdinstall/#bsdinstall-final-warning>2.7. 確認安裝</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/bsdinstall/#bsdinstall-post>2.8. 安裝後注意事項</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/bsdinstall/#bsdinstall-install-trouble>2.9. 疑難排解</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/bsdinstall/#using-live-cd>2.10. 使用 Live CD</a></li></ul></li><li><input type=checkbox id=chapter-9f6db261075f578742036fcc6000eecd class=toggle>
<label class="icon cursor" for=chapter-9f6db261075f578742036fcc6000eecd><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/basics/>章 3. FreeBSD 基礎</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/basics/#basics-synopsis>3.1. 概述</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/basics/#consoles>3.2. 虛擬 Console 與終端機</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/basics/#users-synopsis>3.3. 使用者與基礎帳號管理</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/basics/#permissions>3.4. 權限</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/basics/#dirstructure>3.5. 目錄結構</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/basics/#disk-organization>3.6. 磁碟組織</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/basics/#mount-unmount>3.7. 掛載與卸載檔案系統</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/basics/#basics-processes>3.8. 程序與 Daemon</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/basics/#shells>3.9. Shell</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/basics/#editors>3.10. 文字編輯器</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/basics/#basics-devices>3.11. 裝置及裝置節點</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/basics/#basics-more-information>3.12. 操作手冊</a></li></ul></li><li><input type=checkbox id=chapter-01c5707e95d14c0ff84bf62600c958d1 class=toggle>
<label class="icon cursor" for=chapter-01c5707e95d14c0ff84bf62600c958d1><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/ports/>章 4. 安裝應用程式：套件與 Port</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/ports/#ports-synopsis>4.1. 概述</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/ports/#ports-overview>4.2. 安裝軟體的概要</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/ports/#ports-finding-applications>4.3. 搜尋軟體</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/ports/#pkgng-intro>4.4. 使用 pkg 管理 Binary 套件</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/ports/#ports-using>4.5. 使用 Port 套件集</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/ports/#ports-poudriere>4.6. 使用 Poudriere 編譯套件</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/ports/#ports-nextsteps>4.7. 安裝後的注意事項</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/ports/#ports-broken>4.8. 處理損壞的 Port</a></li></ul></li><li><input type=checkbox id=chapter-3405c00581365a8b5d16af70fe4d1b72 class=toggle>
<label class="icon cursor" for=chapter-3405c00581365a8b5d16af70fe4d1b72><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/x11/>章 5. X Window 系統</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/x11/#x11-synopsis>5.1. 概述</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/x11/#x-understanding>5.2. 術語</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/x11/#x-install>5.3. 安裝 Xorg</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/x11/#x-config>5.4. Xorg 設定</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/x11/#x-fonts>5.5. 在 Xorg 使用字型</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/x11/#x-xdm>5.6. X 顯示管理程式</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/x11/#x11-wm>5.7. 桌面環境</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/x11/#x-compiz-fusion>5.8. 安裝 Compiz Fusion</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/x11/#x11-understanding>5.9. 疑難排解</a></li></ul></li><li><input type=checkbox id=chapter-0eab3565e8f59f5a8a896dfba7eb3680 class=toggle>
<label for=chapter-0eab3565e8f59f5a8a896dfba7eb3680><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/partii/>部 II. 一般作業</a></li><li><input type=checkbox id=chapter-b33cf28993f3f7bf5baf036e79da0f39 class=toggle>
<label class="icon cursor" for=chapter-b33cf28993f3f7bf5baf036e79da0f39><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/desktop/>章 6. 桌面應用程式</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/desktop/#desktop-synopsis>6.1. 概述</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/desktop/#desktop-browsers>6.2. 瀏覽器</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/desktop/#desktop-productivity>6.3. 辦工工具</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/desktop/#desktop-viewers>6.4. 文件閱覽程式</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/desktop/#desktop-finance>6.5. 財務</a></li></ul></li><li><input type=checkbox id=chapter-152f694a19312ad72ec7bb4e1c3c33b2 class=toggle>
<label class="icon cursor" for=chapter-152f694a19312ad72ec7bb4e1c3c33b2><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/multimedia/>章 7. 多媒體</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/multimedia/#multimedia-synopsis>7.1. 概述</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/multimedia/#sound-setup>7.2. 設定音效卡</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/multimedia/#sound-mp3>7.3. MP3 音樂</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/multimedia/#video-playback>7.4. 影片播放</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/multimedia/#tvcard>7.5. 電視卡</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/multimedia/#mythtv>7.6. MythTV</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/multimedia/#scanners>7.7. 影像掃描器</a></li></ul></li><li><input type=checkbox id=chapter-80888b4ee02e3e409e5f71cf97a36450 class=toggle>
<label class="icon cursor" for=chapter-80888b4ee02e3e409e5f71cf97a36450><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/kernelconfig/>章 8. 設定 FreeBSD 核心</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/kernelconfig/#kernelconfig-synopsis>8.1. 概述</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/kernelconfig/#kernelconfig-custom-kernel>8.2. 為何要編譯自訂的核心?</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/kernelconfig/#kernelconfig-devices>8.3. 偵測系統硬體</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/kernelconfig/#kernelconfig-config>8.4. 設定檔</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/kernelconfig/#kernelconfig-building>8.5. 編譯與安裝自訂核心</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/kernelconfig/#kernelconfig-trouble>8.6. 如果發生錯誤</a></li></ul></li><li><input type=checkbox id=chapter-cb174c55879b17ab955f2f16989a79e0 class=toggle>
<label class="icon cursor" for=chapter-cb174c55879b17ab955f2f16989a79e0><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/printing/>章 9. 列印</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/printing/#printing-quick-start>9.1. 快速開始</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/printing/#printing-connections>9.2. 印表機連線</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/printing/#printing-pdls>9.3. 常見的頁面描述語言</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/printing/#printing-direct>9.4. 直接列印</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/printing/#printing-lpd>9.5. LPD (行列式印表機 Daemon)</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/printing/#printing-other>9.6. 其他列印系統</a></li></ul></li><li><input type=checkbox id=chapter-c12b8c3f2a8fcefce87087241f695c83 class=toggle>
<label class="icon cursor" for=chapter-c12b8c3f2a8fcefce87087241f695c83><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/linuxemu/>章 10. Linux® Binary 相容性</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/linuxemu/#linuxemu-synopsis>10.1. 概述</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/linuxemu/#linuxemu-lbc-install>10.2. 設定 Linux™ Binary 相容性</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/linuxemu/#linuxemu-advanced>10.3. 進階主題</a></li></ul></li><li><input type=checkbox id=chapter-03b11ba627b9a0c85b247f5641bde272 class=toggle>
<label for=chapter-03b11ba627b9a0c85b247f5641bde272><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/partiii/>部 III. 系統管理</a></li><li><input type=checkbox id=chapter-6c31587f8d736319f099cd4dc1961301 class=toggle>
<label class="icon cursor" for=chapter-6c31587f8d736319f099cd4dc1961301><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/config/>章 11. 設定與調校</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/config/#config-synopsis>11.1. 概述</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/config/#configtuning-starting-services>11.2. 啟動服務</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/config/#configtuning-cron>11.3. 設定 cron(8)</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/config/#configtuning-rcd>11.4. 管理 FreeBSD 中的服務</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/config/#config-network-setup>11.5. 設定網路介面卡</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/config/#configtuning-virtual-hosts>11.6. 虛擬主機</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/config/#configtuning-syslog>11.7. 設定系統日誌</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/config/#configtuning-configfiles>11.8. 設定檔</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/config/#configtuning-sysctl>11.9. 使用 sysctl(8) 調校</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/config/#configtuning-disk>11.10. 調校磁碟</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/config/#configtuning-kernel-limits>11.11. 調校核心限制</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/config/#adding-swap-space>11.12. 增加交換空間</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/config/#acpi-overview>11.13. 電源與資源管理</a></li></ul></li><li><input type=checkbox id=chapter-459f0012b3b4f0b6b123010f029da5e4 class=toggle>
<label class="icon cursor" for=chapter-459f0012b3b4f0b6b123010f029da5e4><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/boot/>章 12. FreeBSD 開機程序</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/boot/#boot-synopsis>12.1. 概述</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/boot/#boot-introduction>12.2. FreeBSD 開機程序</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/boot/#boot-splash>12.3. 設定開機啟動畫面</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/boot/#device-hints>12.4. 裝置提示</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/boot/#boot-shutdown>12.5. 關機程序</a></li></ul></li><li><input type=checkbox id=chapter-917c75fcffbb14d48ed6d0a48e7028f2 class=toggle>
<label class="icon cursor" for=chapter-917c75fcffbb14d48ed6d0a48e7028f2><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/security/>章 13. 安全性</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/security/#security-synopsis>13.1. 概述</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/security/#security-intro>13.2. 簡介</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/security/#one-time-passwords>13.3. 一次性密碼</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/security/#tcpwrappers>13.4. TCP Wrapper</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/security/#kerberos5>13.5. Kerberos</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/security/#openssl>13.6. OpenSSL</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/security/#ipsec>13.7. VPN over IPsec</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/security/#openssh>13.8. OpenSSH</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/security/#fs-acl>13.9. 存取控制清單</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/security/#security-pkg>13.10. 監視第三方安全性問題</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/security/#security-advisories>13.11. FreeBSD 安全報告</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/security/#security-accounting>13.12. 程序追蹤</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/security/#security-resourcelimits>13.13. 限制資源</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/security/#security-sudo>13.14. 使用 Sudo 分享管理權限</a></li></ul></li><li><input type=checkbox id=chapter-1a2a8e719703649c2c66d99aa7a25fd4 class=toggle>
<label class="icon cursor" for=chapter-1a2a8e719703649c2c66d99aa7a25fd4><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/jails/>章 14. Jail</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/jails/#jails-synopsis>14.1. 概述</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/jails/#jails-terms>14.2. Jail 相關術語</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/jails/#jails-build>14.3. 建立和控制 Jail</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/jails/#jails-tuning>14.4. 調校與管理</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/jails/#jails-application>14.5. 更新多個 Jail</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/jails/#jails-ezjail>14.6. 使用 ezjail 管理 Jail</a></li></ul></li><li><input type=checkbox id=chapter-8f4620c77e572cbb58917911a33c73cf class=toggle>
<label class="icon cursor" for=chapter-8f4620c77e572cbb58917911a33c73cf><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/mac/>章 15. 強制存取控制 (MAC)</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/mac/#mac-synopsis>15.1. 概述</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/mac/#mac-inline-glossary>15.2. 關鍵詞</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/mac/#mac-understandlabel>15.3. 了解 MAC 標籤</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/mac/#mac-planning>15.4. 規劃安全架構</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/mac/#mac-policies>15.5. 可用的 MAC 管理政策</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/mac/#mac-userlocked>15.6. User Lock Down</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/mac/#mac-implementing>15.7. 在 MAC Jail 中使用 Nagios</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/mac/#mac-troubleshoot>15.8. MAC 架構疑難排解</a></li></ul></li><li><input type=checkbox id=chapter-9598d66a76cb3182057b6bcd775149a0 class=toggle>
<label class="icon cursor" for=chapter-9598d66a76cb3182057b6bcd775149a0><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/audit/>章 16. 安全事件稽查</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/audit/#audit-synopsis>16.1. 概述</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/audit/#audit-inline-glossary>16.2. 關鍵詞</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/audit/#audit-config>16.3. 稽查設定</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/audit/#audit-administration>16.4. 查看稽查線索</a></li></ul></li><li><input type=checkbox id=chapter-e1edcad13d9db6e8e4cb645d378ecfaf class=toggle checked>
<label class="icon cursor" for=chapter-e1edcad13d9db6e8e4cb645d378ecfaf><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/disks/>章 17. 儲存設備</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/disks/#disks-synopsis>17.1. 概述</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/disks/#disks-adding>17.2. 加入磁碟</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/disks/#disks-growing>17.3. 重設大小與擴增磁碟</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/disks/#usb-disks>17.4. USB 儲存裝置</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/disks/#creating-cds>17.5. 建立與使用 CD 媒體</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/disks/#creating-dvds>17.6. 建立與使用 DVD 媒體</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/disks/#floppies>17.7. 建立與使用軟碟</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/disks/#backup-basics>17.8. 備份基礎概念</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/disks/#disks-virtual>17.9. 記憶體磁碟</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/disks/#snapshots>17.10. 檔案系統快照</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/disks/#quotas>17.11. 磁碟配額</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/disks/#disks-encrypting>17.12. 磁碟分割區加密</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/disks/#swap-encrypting>17.13. 交換空間加密</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/disks/#disks-hast>17.14. 高可用存儲空間 (HAST)</a></li></ul></li><li><input type=checkbox id=chapter-dde37901a0e0ea32745b67607854900f class=toggle>
<label class="icon cursor" for=chapter-dde37901a0e0ea32745b67607854900f><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/geom/>章 18. GEOM: 模組化磁碟轉換框架</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/geom/#geom-synopsis>18.1. 概述</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/geom/#geom-striping>18.2. RAID0 - 串連 (Striping)</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/geom/#geom-mirror>18.3. RAID1 - 鏡像 (Mirroring)</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/geom/#geom-raid3>18.4. RAID3 - 位元級串連與獨立奇偶校驗</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/geom/#geom-graid>18.5. 軟體 RAID 裝置</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/geom/#geom-ggate>18.6. GEOM Gate Network</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/geom/#geom-glabel>18.7. 磁碟裝置標籤</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/geom/#geom-gjournal>18.8. UFS Journaling 透過 GEOM</a></li></ul></li><li><input type=checkbox id=chapter-73e82560fcb7145b7c0e2ec47af8fc04 class=toggle>
<label class="icon cursor" for=chapter-73e82560fcb7145b7c0e2ec47af8fc04><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/zfs/>章 19. Z 檔案系統 (ZFS)</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/zfs/#zfs-differences>19.1. 什麼使 ZFS 與眾不同</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/zfs/#zfs-quickstart>19.2. 快速入門指南</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/zfs/#zfs-zpool>19.3. <code>zpool</code> 管理</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/zfs/#zfs-zfs>19.4. <code>zfs</code> 管理</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/zfs/#zfs-zfs-allow>19.5. 委託管理</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/zfs/#zfs-advanced>19.6. 進階主題</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/zfs/#zfs-links>19.7. 其他資源</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/zfs/#zfs-term>19.8. ZFS 特色與術語</a></li></ul></li><li><input type=checkbox id=chapter-7af71270807eb7b70cd3eedc6577b254 class=toggle>
<label class="icon cursor" for=chapter-7af71270807eb7b70cd3eedc6577b254><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/filesystems/>章 20. 其他檔案系統</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/filesystems/#filesystems-synopsis>20.1. 概述</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/filesystems/#filesystems-linux>20.2. Linux™ 檔案系統</a></li></ul></li><li><input type=checkbox id=chapter-375257268d95faaf87faf4f7a2e6aa67 class=toggle>
<label class="icon cursor" for=chapter-375257268d95faaf87faf4f7a2e6aa67><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/virtualization/>章 21. 虛擬化</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/virtualization/#virtualization-synopsis>21.1. 概述</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/virtualization/#virtualization-guest-parallels>21.2. 在 Mac OS™ X 的 Parallels 安裝 FreeBSD 為客端</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/virtualization/#virtualization-guest-virtualpc>21.3. 在 Windows™ 的 Virtual PC 安裝 FreeBSD 為客端</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/virtualization/#virtualization-guest-vmware>21.4. 在 Mac OS™ 的 VMware Fusion 安裝 FreeBSD 為客端</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/virtualization/#virtualization-guest-virtualbox>21.5. 在 VirtualBox™ 安裝 FreeBSD 作為客端</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/virtualization/#virtualization-host-virtualbox>21.6. 以 FreeBSD 作為主端使用 VirtualBox™</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/virtualization/#virtualization-host-bhyve>21.7. 以 FreeBSD 作為主端安裝 bhyve</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/virtualization/#virtualization-host-xen>21.8. 以 FreeBSD 作為主端安裝 Xen™</a></li></ul></li><li><input type=checkbox id=chapter-49f1e96591c090304ea532012257f4ef class=toggle>
<label class="icon cursor" for=chapter-49f1e96591c090304ea532012257f4ef><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/l10n/>章 22. 在地化 - i18n/L10n 使用與安裝</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/l10n/#l10n-synopsis>22.1. 概述</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/l10n/#using-localization>22.2. 使用語系</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/l10n/#l10n-compiling>22.3. 尋找 i18n 應用程式</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/l10n/#lang-setup>22.4. 特定語言的語系設定</a></li></ul></li><li><input type=checkbox id=chapter-dead2b4c5ea325dd390a9b0dccd8f763 class=toggle>
<label class="icon cursor" for=chapter-dead2b4c5ea325dd390a9b0dccd8f763><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/cutting-edge/>章 23. 更新與升級 FreeBSD</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/cutting-edge/#updating-upgrading-synopsis>23.1. 概述</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/cutting-edge/#updating-upgrading-freebsdupdate>23.2. FreeBSD 更新</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/cutting-edge/#updating-upgrading-documentation>23.3. 更新文件集</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/cutting-edge/#current-stable>23.4. 追蹤開發分支</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/cutting-edge/#makeworld>23.5. 從原始碼更新 FreeBSD</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/cutting-edge/#small-lan>23.6. 多部機器追蹤</a></li></ul></li><li><input type=checkbox id=chapter-913e72bfb3d6947b2869d3e9447a6eaa class=toggle>
<label class="icon cursor" for=chapter-913e72bfb3d6947b2869d3e9447a6eaa><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/usb-device-mode/>章 25. USB Device Mode / USB OTG</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/usb-device-mode/#usb-device-mode-synopsis>25.1. 概述</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/usb-device-mode/#usb-device-mode-terminals>25.2. USB 虛擬序列埠</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/usb-device-mode/#usb-device-mode-network>25.3. USB 裝置模式網路介面</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/usb-device-mode/#usb-device-mode-storage>25.4. USB 虛擬儲存裝置</a></li></ul></li><li><input type=checkbox id=chapter-bbd25f9a194f9c39ca2d658c75767db5 class=toggle>
<label for=chapter-bbd25f9a194f9c39ca2d658c75767db5><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/partiv/>部 IV. 網路通訊</a></li><li><input type=checkbox id=chapter-29c1eeb0e9dedc487a98399e2737ee8a class=toggle>
<label class="icon cursor" for=chapter-29c1eeb0e9dedc487a98399e2737ee8a><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/dtrace/>章 24. DTrace</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/dtrace/#dtrace-synopsis>24.1. 概述</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/dtrace/#dtrace-implementation>24.2. 實作差異</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/dtrace/#dtrace-enable>24.3. 開啟 DTrace 支援</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/dtrace/#dtrace-using>24.4. 使用 DTrace</a></li></ul></li><li><input type=checkbox id=chapter-499dab596afd7ddac77e80295314e0dd class=toggle>
<label class="icon cursor" for=chapter-499dab596afd7ddac77e80295314e0dd><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/serialcomms/>章 26. 序列通訊</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/serialcomms/#serial-synopsis>26.1. 概述</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/serialcomms/#serial>26.2. 序列術語與硬體</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/serialcomms/#term>26.3. 終端機</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/serialcomms/#dialup>26.4. 撥入服務</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/serialcomms/#dialout>26.5. 撥出服務</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/serialcomms/#serialconsole-setup>26.6. 設定序列 Console</a></li></ul></li><li><input type=checkbox id=chapter-95e4571c48bee1cced5e84a538d302e3 class=toggle>
<label class="icon cursor" for=chapter-95e4571c48bee1cced5e84a538d302e3><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/ppp-and-slip/>章 27. PPP</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/ppp-and-slip/#ppp-and-slip-synopsis>27.1. 概述</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/ppp-and-slip/#userppp>27.2. 設定 PPP</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/ppp-and-slip/#ppp-troubleshoot>27.3. PPP 連線疑難排解</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/ppp-and-slip/#pppoe>27.4. 在乙太網路使用 PPP (PPPoE)</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/ppp-and-slip/#pppoa>27.5. 在 ATM 使用 PPP (PPPoA)</a></li></ul></li><li><input type=checkbox id=chapter-f089ac726c401c9b4bd5c34a295e11bb class=toggle>
<label class="icon cursor" for=chapter-f089ac726c401c9b4bd5c34a295e11bb><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/mail/>章 28. 電子郵件</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/mail/#mail-synopsis>28.1. 概述</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/mail/#mail-using>28.2. 郵件組成</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/mail/#sendmail>28.3. Sendmail 設定檔</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/mail/#mail-changingmta>28.4. 更改郵件傳輸代理程式</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/mail/#mail-trouble>28.5. 疑難排解</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/mail/#mail-advanced>28.6. 進階主題</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/mail/#outgoing-only>28.7. 寄件設定</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/mail/#SMTP-dialup>28.8. 在撥號連線使用郵件</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/mail/#SMTP-Auth>28.9. SMTP 認證</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/mail/#mail-agents>28.10. 郵件使用者代理程式</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/mail/#mail-fetchmail>28.11. 使用 fetchmail</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/mail/#mail-procmail>28.12. 使用 procmail</a></li></ul></li><li><input type=checkbox id=chapter-6de4de3fe925639d4175ce4b6f8c1829 class=toggle>
<label class="icon cursor" for=chapter-6de4de3fe925639d4175ce4b6f8c1829><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/network-servers/>章 29. 網路伺服器</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/network-servers/#network-servers-synopsis>29.1. 概述</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/network-servers/#network-inetd>29.2. inetd 超級伺服器</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/network-servers/#network-nfs>29.3. 網路檔案系統 (NFS)</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/network-servers/#network-nis>29.4. 網路資訊系統 (NIS)</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/network-servers/#network-ldap>29.5. 輕量級目錄存取協定 (LDAP)</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/network-servers/#network-dhcp>29.6. 動態主機設置協定 (DHCP)</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/network-servers/#network-dns>29.7. 網域名稱系統 (DNS)</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/network-servers/#network-apache>29.8. Apache HTTP 伺服器</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/network-servers/#network-ftp>29.9. 檔案傳輸協定 (FTP)</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/network-servers/#network-samba>29.10. Microsoft™Windows™ 用戶端檔案與列印服務 (Samba)</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/network-servers/#network-ntp>29.11. NTP 時間校對</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/network-servers/#network-iscsi>29.12. iSCSI Initiator 與 Target 設定</a></li></ul></li><li><input type=checkbox id=chapter-776d855c7b75e048f90b5c2c9b35ffe0 class=toggle>
<label class="icon cursor" for=chapter-776d855c7b75e048f90b5c2c9b35ffe0><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/firewalls/>章 30. 防火牆</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/firewalls/#firewalls-intro>30.1. 概述</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/firewalls/#firewalls-concepts>30.2. 防火牆概念</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/firewalls/#firewalls-pf>30.3. PF</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/firewalls/#firewalls-ipfw>30.4. IPFW</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/firewalls/#firewalls-ipf>30.5. IPFILTER (IPF)</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/firewalls/#firewalls-blacklistd>30.6. Blacklistd</a></li></ul></li><li><input type=checkbox id=chapter-5b07f776a0e6155c1c89aa0d15610380 class=toggle>
<label class="icon cursor" for=chapter-5b07f776a0e6155c1c89aa0d15610380><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/advanced-networking/>章 31. 進階網路設定</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/advanced-networking/#advanced-networking-synopsis>31.1. 概述</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/advanced-networking/#network-routing>31.2. 通訊閘與路由</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/advanced-networking/#network-wireless>31.3. 無線網路</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/advanced-networking/#network-usb-tethering>31.4. USB 網路共享</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/advanced-networking/#network-bluetooth>31.5. 藍牙</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/advanced-networking/#network-bridging>31.6. 橋接</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/advanced-networking/#network-aggregation>31.7. Link Aggregation 與容錯移轉</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/advanced-networking/#network-diskless>31.8. PXE 無磁碟作業</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/advanced-networking/#network-ipv6>31.9. IPv6</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/advanced-networking/#carp>31.10. 共用位址備援協定 (CARP)</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/advanced-networking/#network-vlan>31.11. VLANs</a></li></ul></li><li><input type=checkbox id=chapter-171a77aa9d067a1024f849470e1f33e8 class=toggle>
<label for=chapter-171a77aa9d067a1024f849470e1f33e8><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/partv/>部 V. 附錄</a></li><li><input type=checkbox id=chapter-8050f436a0a7986a4aaded93d8e49469 class=toggle>
<label class="icon cursor" for=chapter-8050f436a0a7986a4aaded93d8e49469><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/mirrors/>附錄 A. 取得 FreeBSD</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/mirrors/#mirrors-cdrom>A.1. CD 與 DVD 合集</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/mirrors/#mirrors-ftp>A.2. FTP 站</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/mirrors/#svn>A.3. 使用 Subversion</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/mirrors/#mirrors-rsync>A.4. 使用 rsync</a></li></ul></li><li><input type=checkbox id=chapter-128b630a8f88f158e7027fe6c2184d21 class=toggle>
<label class="icon cursor" for=chapter-128b630a8f88f158e7027fe6c2184d21><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/bibliography/>附錄 B. 參考書目</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/bibliography/#bibliography-freebsd>B.1. FreeBSD 相關書籍</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/bibliography/#bibliography-userguides>B.2. 使用指南</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/bibliography/#bibliography-adminguides>B.3. 管理指南</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/bibliography/#bibliography-programmers>B.4. 開發指南</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/bibliography/#bibliography-osinternals>B.5. 深入作業系統</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/bibliography/#bibliography-security>B.6. 安全性參考文獻</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/bibliography/#bibliography-hardware>B.7. 硬體參考文獻</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/bibliography/#bibliography-history>B.8. UNIX™ 歷史</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/bibliography/#bibliography-journals>B.9. 期刊與雜誌</a></li></ul></li><li><input type=checkbox id=chapter-8bbb8867c46dac315e2253945d8c18a8 class=toggle>
<label class="icon cursor" for=chapter-8bbb8867c46dac315e2253945d8c18a8><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/eresources/>附錄 C. 網路資源</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/eresources/#eresources-www>C.1. 網站</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/eresources/#eresources-mail>C.2. 郵遞論壇 (Mailing List)</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/eresources/#eresources-news>C.3. Usenet 新聞群組</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/eresources/#eresources-web>C.4. 官方鏡像站</a></li></ul></li><li><input type=checkbox id=chapter-a80ea4f5a4480b8725422710f954ef36 class=toggle>
<label class="icon cursor" for=chapter-a80ea4f5a4480b8725422710f954ef36><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/pgpkeys/>附錄 D. OpenPGP 金鑰</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/pgpkeys/#pgpkeys-officers>D.1. Officers</a></li></ul></li><li></li></ul></nav></div></aside><div class=book><div class=book-menu-mobile><label for=menu-control><span class=menu-control-button><i class="fa fa-list" aria-hidden=true title="Book menu"></i>
Book menu</span></label></div><h1 class=title>章 17. 儲存設備</h1><div class="admonitionblock note"><p><i class="fa fa-exclamation-circle" aria-hidden=true></i>
This translation may be out of date. To help with the translations please access the <a href=https://translate-dev.freebsd.org/ target=_blank>FreeBSD translations instance</a>.</p></div><div class=toc-mobile><h3>目錄</h3><nav id=TableOfContents><ul><li><a href=#disks-synopsis>17.1. 概述</a></li><li><a href=#disks-adding>17.2. 加入磁碟</a></li><li><a href=#disks-growing>17.3. 重設大小與擴增磁碟</a></li><li><a href=#usb-disks>17.4. USB 儲存裝置</a></li><li><a href=#creating-cds>17.5. 建立與使用 CD 媒體</a></li><li><a href=#creating-dvds>17.6. 建立與使用 DVD 媒體</a></li><li><a href=#floppies>17.7. 建立與使用軟碟</a></li><li><a href=#backup-basics>17.8. 備份基礎概念</a></li><li><a href=#disks-virtual>17.9. 記憶體磁碟</a></li><li><a href=#snapshots>17.10. 檔案系統快照</a></li><li><a href=#quotas>17.11. 磁碟配額</a></li><li><a href=#disks-encrypting>17.12. 磁碟分割區加密</a></li><li><a href=#swap-encrypting>17.13. 交換空間加密</a></li><li><a href=#disks-hast>17.14. 高可用存儲空間 (HAST)</a></li></ul></nav></div><div class=book-content><div id=preamble><div class=sectionbody></div></div><div class=sect1><h2 id=disks-synopsis>17.1. 概述<a class=anchor href=#disks-synopsis></a></h2><div class=sectionbody><div class=paragraph><p>本章涵蓋如何在 FreeBSD 下使用磁碟及儲存媒體，這包含 SCSI 及 IDE 磁碟、CD 及 DVD 媒體、記憶體磁碟及 USB 儲存裝置。</p></div><div class=paragraph><p>讀完這章，您將了解：</p></div><div class=ulist><ul><li><p>如何在 FreeBSD 系統加入額外的硬碟。</p></li><li><p>如何在 FreeBSD 擴增磁碟分割區的大小。</p></li><li><p>如何設定 FreeBSD 使用 USB 儲存裝置。</p></li><li><p>如何在 FreeBSD 系統使用 CD 及 DVD 媒體。</p></li><li><p>如何使用在 FreeBSD 下可用的備份程式。</p></li><li><p>如何設定記憶體磁碟。</p></li><li><p>什麼是檔案系統快照 (Snapshot) 以及如何有效使用。</p></li><li><p>如何使用配額 (Quota) 來限制磁碟空間使用量。</p></li><li><p>如何加密磁碟及交換空間來防範攻擊者。</p></li><li><p>如何設定高可用性 (Highly available) 的儲存網路。</p></li></ul></div><div class=paragraph><p>在開始閱讀這章之前，您需要：</p></div><div class=ulist><ul><li><p>了解如何 <a href=../kernelconfig/#kernelconfig>設定並安裝新的 FreeBSD 核心</a>。</p></li></ul></div></div></div><div class=sect1><h2 id=disks-adding>17.2. 加入磁碟<a class=anchor href=#disks-adding></a></h2><div class=sectionbody><div class=paragraph><p>本節將說明如何加入新的 SATA 磁碟到目前只有一個磁碟的機器上。 首先要關閉電腦並依照電腦、控制器及磁碟製造商的操作指南將磁碟安裝到電腦。重新啟動系統並登入 <code>root</code>。</p></div><div class=paragraph><p>查看 <span class=filename>/var/run/dmesg.boot</span> 來確認已經找到新的磁碟。在本例中，會以 <span class=filename>ada1</span> 代表新加入的 SATA 磁碟。</p></div><div class=paragraph><p>在本例中，會在新的磁碟上建立單一大型分割區，使用 <a href=http://en.wikipedia.org/wiki/GUID_Partition_Table>GPT</a> 分割表格式而非較舊與通用性較差的 MBR 結構。</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>若新加入的磁碟不是空白的，可以使用 <code>gpart delete</code> 來移除舊的分割區資訊。請參考 <a href="https://man.freebsd.org/cgi/man.cgi?query=gpart&amp;sektion=8&amp;format=html">gpart(8)</a> 取得詳細資訊。</p></div></td></tr></tbody></table></div><div class=paragraph><p>建立完分割表格式後接著加入一個分割區，要在新的磁碟增進效能可使用較大的硬體區塊大小 (Block size)，此分割區會對齊 1 MB 的邊界：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># gpart create -s GPT ada1</span>
<span class=c># gpart add -t freebsd-ufs -a 1M ada1</span></code></pre></div></div><div class=paragraph><p>依據使用情況，也可以使用較小的分割區。請參考 <a href="https://man.freebsd.org/cgi/man.cgi?query=gpart&amp;sektion=8&amp;format=html">gpart(8)</a> 來取得建立較小分割區的選項。</p></div><div class=paragraph><p>磁碟分割區資訊可以使用 <code>gpart show</code> 檢視：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% gpart show ada1
<span class=o>=&gt;</span>        34  1465146988  ada1  GPT  <span class=o>(</span>699G<span class=o>)</span>
          34        2014        - free -  <span class=o>(</span>1.0M<span class=o>)</span>
        2048  1465143296     1  freebsd-ufs  <span class=o>(</span>699G<span class=o>)</span>
  1465145344        1678        - free -  <span class=o>(</span>839K<span class=o>)</span></code></pre></div></div><div class=paragraph><p>在新磁碟的新分割區上建立檔案系統：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># newfs -U /dev/ada1p1</span></code></pre></div></div><div class=paragraph><p>建立一個空的目錄做來做為<em>掛載點 (mountpoint)</em>，一個在原有磁碟的檔案系統上可用來掛載新磁碟的位置：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mkdir /newdisk</span></code></pre></div></div><div class=paragraph><p>最後，將磁碟項目加入到 <span class=filename>/etc/fstab</span>，讓啟動時會自動掛載新的磁碟：</p></div><div class="literalblock programlisting"><div class=content><pre>/dev/ada1p1	/newdisk	ufs	rw	2	2</pre></div></div><div class=paragraph><p>新的磁碟也可手動掛載，無須重新啟動系統：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mount /newdisk</span></code></pre></div></div></div></div><div class=sect1><h2 id=disks-growing>17.3. 重設大小與擴增磁碟<a class=anchor href=#disks-growing></a></h2><div class=sectionbody><div class=paragraph><p>磁碟的容量可以增加且不需要更動任何已存在的資料。這時常會用在虛擬機器，當虛擬磁碟太小且需要增加時。有時磁碟映像檔會被寫入到 USB 隨身碟，但卻沒有使用全部的容量。此節我們將說明如合重設大小或 <em>擴增</em> 磁碟內容來使用增加的容量。</p></div><div class=paragraph><p>要取得要重設大小的磁碟的代號可以查看 <span class=filename>/var/run/dmesg.boot</span>。在本例中，在系統上只有一個 SATA 磁碟，該磁碟會以 <span class=filename>ada0</span> 表示。</p></div><div class=paragraph><p>列出在磁碟上的分割區來查看目前的設定：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># gpart show ada0</span>
<span class=o>=&gt;</span>      34  83886013  ada0  GPT  <span class=o>(</span>48G<span class=o>)</span> <span class=o>[</span>CORRUPT]
        34       128     1  freebsd-boot  <span class=o>(</span>64k<span class=o>)</span>
       162  79691648     2  freebsd-ufs  <span class=o>(</span>38G<span class=o>)</span>
  79691810   4194236     3  freebsd-swap  <span class=o>(</span>2G<span class=o>)</span>
  83886046         1        - free -  <span class=o>(</span>512B<span class=o>)</span></code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>若磁碟已使用 <a href=http://en.wikipedia.org/wiki/GUID_Partition_Table>GPT</a> 分割表格式做格式化，可能會顯示為 "已損壞 (corrupted)" 因為 GPT 備份分割區已不存在於磁碟結尾。 使用 <code>gpart</code> 來修正備份分割區：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># gpart recover ada0</span>
ada0 recovered</code></pre></div></div></td></tr></tbody></table></div><div class=paragraph><p>現在在磁碟上的額外空間已經可以被新的分割區使用，或者可以拿來擴充既有的分割區：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># gpart show ada0</span>
<span class=o>=&gt;</span>       34  102399933  ada0  GPT  <span class=o>(</span>48G<span class=o>)</span>
         34        128     1  freebsd-boot  <span class=o>(</span>64k<span class=o>)</span>
        162   79691648     2  freebsd-ufs  <span class=o>(</span>38G<span class=o>)</span>
   79691810    4194236     3  freebsd-swap  <span class=o>(</span>2G<span class=o>)</span>
   83886046   18513921        - free -  <span class=o>(</span>8.8G<span class=o>)</span></code></pre></div></div><div class=paragraph><p>分割區只能在連續的未使用空間上重設大小。在這個例子中，磁碟上最後的分割區為交換 (Swap) 分割區，而第二個分割區才是需要重設大小的分割區。由於交換分割區中只會有暫存的資料，所以此時可以安全的卸載、刪除，然後在重設第二個分割區大小之後再重建最後一個分割區。</p></div><div class=paragraph><p>停用交換分割區：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># swapoff /dev/ada0p3</span></code></pre></div></div><div class=paragraph><p>刪除 <em>ada0</em> 磁碟上的第三個分割區，可使用 <code>-i</code> 參數來指定分割區。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># gpart delete -i 3 ada0</span>
ada0p3 deleted
<span class=c># gpart show ada0</span>
<span class=o>=&gt;</span>       34  102399933  ada0  GPT  <span class=o>(</span>48G<span class=o>)</span>
         34        128     1  freebsd-boot  <span class=o>(</span>64k<span class=o>)</span>
        162   79691648     2  freebsd-ufs  <span class=o>(</span>38G<span class=o>)</span>
   79691810   22708157        - free -  <span class=o>(</span>10G<span class=o>)</span></code></pre></div></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>在掛載的檔案系統上修改分割區表可能會造成資料遺失。最好的方式是在未掛載檔案系統的情況下 (使用 Live CD-ROM 或 USB 裝置) 執行以下步驟。雖然如此，若仍要這樣做的話，在關閉 GEOM 安全性功能之後可以在掛載的檔案系統上修改分割區表：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sysctl kern.geom.debugflags=16</span></code></pre></div></div></td></tr></tbody></table></div><div class=paragraph><p>重設分割區大小並保留要用來重建交換分割區的空間，要重設大小的分割區可以用 <code>-i</code> 來指定，而要重設的大小可用 <code>-s</code> 來指定，若要對齊分割區可以使用 <code>-a</code>。這個動作只會修改分割區大小，分割區中的檔案系統需在另一個步驟擴增。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># gpart resize -i 2 -s 47G -a 4k ada0</span>
ada0p2 resized
<span class=c># gpart show ada0</span>
<span class=o>=&gt;</span>       34  102399933  ada0  GPT  <span class=o>(</span>48G<span class=o>)</span>
         34        128     1  freebsd-boot  <span class=o>(</span>64k<span class=o>)</span>
        162   98566144     2  freebsd-ufs  <span class=o>(</span>47G<span class=o>)</span>
   98566306    3833661        - free -  <span class=o>(</span>1.8G<span class=o>)</span></code></pre></div></div><div class=paragraph><p>重建交換分割區並且啟動，若不使用 <code>-s</code> 指定大小則會使用所有剩餘的空間：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># gpart add -t freebsd-swap -a 4k ada0</span>
ada0p3 added
<span class=c># gpart show ada0</span>
<span class=o>=&gt;</span>       34  102399933  ada0  GPT  <span class=o>(</span>48G<span class=o>)</span>
         34        128     1  freebsd-boot  <span class=o>(</span>64k<span class=o>)</span>
        162   98566144     2  freebsd-ufs  <span class=o>(</span>47G<span class=o>)</span>
   98566306    3833661     3  freebsd-swap  <span class=o>(</span>1.8G<span class=o>)</span>
<span class=c># swapon /dev/ada0p3</span></code></pre></div></div><div class=paragraph><p>擴增 UFS 檔案系統來使用重設分割區大小之後的新容量：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># growfs /dev/ada0p2</span>
Device is mounted read-write<span class=p>;</span> resizing will result <span class=k>in </span>temporary write suspension <span class=k>for</span> /.
It<span class=s1>&#39;s strongly recommended to make a backup before growing the file system.
OK to grow file system on /dev/ada0p2, mounted on /, from 38GB to 47GB? [Yes/No] Yes
super-block backups (for fsck -b #) at:
 80781312, 82063552, 83345792, 84628032, 85910272, 87192512, 88474752,
 89756992, 91039232, 92321472, 93603712, 94885952, 96168192, 97450432</span></code></pre></div></div><div class=paragraph><p>若檔案系統使用 ZFS，重設大小需執行 <code>online</code> 子指令並使用 <code>-e</code> 來觸發動作：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zpool online -e zroot /dev/ada0p2</span></code></pre></div></div><div class=paragraph><p>現在分割區與檔案系統已透過重設大小來使用新增加的磁碟空間。</p></div></div></div><div class=sect1><h2 id=usb-disks>17.4. USB 儲存裝置<a class=anchor href=#usb-disks></a></h2><div class=sectionbody><div class=paragraph><p>許多外部儲存裝置的解決方案，例如硬碟、USB 隨身碟及 CD 與 DVD 燒錄機皆使用通用序列匯流排 (Universal Serial Bus, USB)，FreeBSD 提供了對 USB 1.x, 2.0 及 3.0 裝置的支援。</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>部份硬體尚不相容 USB 3.0，包含 Haswell (Lynx point) 晶片組，若 FreeBSD 開機出現 <code>failed with error 19</code> 訊息，請在系統 BIOS 關閉 xHCI/USB3。</p></div></td></tr></tbody></table></div><div class=paragraph><p>對 USB 儲存裝置的支援已內建於 <span class=filename>GENERIC</span> 核心，若為自訂的核心，請確定在核心設定檔中有下列幾行設定：</p></div><div class="literalblock programlisting"><div class=content><pre>device scbus	# SCSI bus (required for ATA/SCSI)
device da	# Direct Access (disks)
device pass	# Passthrough device (direct ATA/SCSI access)
device uhci	# provides USB 1.x support
device ohci	# provides USB 1.x support
device ehci	# provides USB 2.0 support
device xhci	# provides USB 3.0 support
device usb	# USB Bus (required)
device umass	# Disks/Mass storage - Requires scbus and da
device cd	# needed for CD and DVD burners</pre></div></div><div class=paragraph><p>FreeBSD 使用 <a href="https://man.freebsd.org/cgi/man.cgi?query=umass&amp;sektion=4&amp;format=html">umass(4)</a> 驅動程式透過 SCSI 子系統來存取 USB 儲存裝置，因此任何在系統的 USB 裝置都會以 SCSI 裝置呈現，若 USB 裝置是 CD 或 DVD 燒錄機，請<em>不要</em>在自訂核心設定檔中引用 <code>device atapicam</code>。</p></div><div class=paragraph><p>本節後續的部份將示範如何檢查 FreeBSD 能夠辦識 USB 儲存裝置以及如何設定該裝置。</p></div><div class=sect2><h3 id=_裝置設定>17.4.1. 裝置設定<a class=anchor href=#_裝置設定></a></h3><div class=paragraph><p>要測試 USB 設定，請先插入 USB 裝置，然後使用 <code>dmesg</code> 來確認系統訊息緩衝區中有出現該磁碟機，該訊息如下：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>umass0: &lt;STECH Simple Drive, class 0/0, rev 2.00/1.04, addr 3&gt; on usbus0
umass0:  SCSI over Bulk-Only<span class=p>;</span> quirks <span class=o>=</span> 0x0100
umass0:4:0:-1: Attached to scbus4
da0 at umass-sim0 bus 0 scbus4 target 0 lun 0
da0: &lt;STECH Simple Drive 1.04&gt; Fixed Direct Access SCSI-4 device
da0: Serial Number WD-WXE508CAN263
da0: 40.000MB/s transfers
da0: 152627MB <span class=o>(</span>312581808 512 byte sectors: 255H 63S/T 19457C<span class=o>)</span>
da0: <span class=nv>quirks</span><span class=o>=</span>0x2&lt;NO_6_BYTE&gt;</code></pre></div></div><div class=paragraph><p>不同的裝置會有不同的廠牌、裝置節點 (<span class=filename>da0</span>)、速度與大小。</p></div><div class=paragraph><p>當 USB 裝置可以做為 SCSI 檢視時，便可使用 <code>camcontrol</code> 來列出連接到系統的 USB 儲存裝置：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># camcontrol devlist</span>
&lt;STECH Simple Drive 1.04&gt;          at scbus4 target 0 lun 0 <span class=o>(</span>pass3,da0<span class=o>)</span></code></pre></div></div><div class=paragraph><p>或者，可以使用 <code>usbconfig</code> 來列出裝置，請參考 <a href="https://man.freebsd.org/cgi/man.cgi?query=usbconfig&amp;sektion=8&amp;format=html">usbconfig(8)</a> 來取得更多有關此指令的資訊。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># usbconfig</span>
ugen0.3: &lt;Simple Drive STECH&gt; at usbus0, <span class=nv>cfg</span><span class=o>=</span>0 <span class=nv>md</span><span class=o>=</span>HOST <span class=nv>spd</span><span class=o>=</span>HIGH <span class=o>(</span>480Mbps<span class=o>)</span> <span class=nv>pwr</span><span class=o>=</span>ON <span class=o>(</span>2mA<span class=o>)</span></code></pre></div></div><div class=paragraph><p>若該裝置尚未被格式化，請參考 <a href=#disks-adding>加入磁碟</a> 中有關如何在 USB 磁碟格式化與建立分割區的說明。若磁碟中有檔案系統，可由 <code>root</code> 依據 <a href=../basics/#mount-unmount>掛載與卸載檔案系統</a> 中的說明掛載磁碟。</p></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>要允許未被信任的使用者掛載任意媒體，可開啟 <code>vfs.usermount</code>，詳細說明如下。從安全性的角度來看這並不是安全的，大多的檔案系統並不會防範惡意裝置。</p></div></td></tr></tbody></table></div><div class=paragraph><p>要讓裝置可讓一般使用者掛載，其中一個解決方案便是使用 <a href="https://man.freebsd.org/cgi/man.cgi?query=pw&amp;sektion=8&amp;format=html">pw(8)</a> 讓所有裝置的使用者成為 <code>operator</code> 群組的成員。接著，將下列幾行加入 <span class=filename>/etc/devfs.rules</span> 來確保 <code>operator</code> 能夠讀取與寫入裝置：</p></div><div class="literalblock programlisting"><div class=content><pre>[localrules=5]
add path &#39;da*&#39; mode 0660 group operator</pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>若系統也同時安裝了內建 SCSI 磁碟，請更改第二行如下：</p></div><div class="literalblock programlisting"><div class=content><pre>add path &#39;da[3-9]*&#39; mode 0660 group operator</pre></div></div><div class=paragraph><p>這會從 <code>operator</code> 群組中排除前三個 SCSI 磁碟 (<span class=filename>da0</span> 到 <span class=filename>da2</span>)，接著取代 <em>3</em> 為內部 SCSI 磁碟的編號。請參考 <a href="https://man.freebsd.org/cgi/man.cgi?query=devfs.rules&amp;sektion=5&amp;format=html">devfs.rules(5)</a> 來取得更多有關此檔案的資訊。</p></div></td></tr></tbody></table></div><div class=paragraph><p>接著，在 <span class=filename>/etc/rc.conf</span> 開啟規則：</p></div><div class="literalblock programlisting"><div class=content><pre>devfs_system_ruleset=&#34;localrules&#34;</pre></div></div><div class=paragraph><p>然後，加入以下行到 <span class=filename>/etc/sysctl.conf</span> 指示系統允許正常使用者掛載檔案系統：</p></div><div class="literalblock programlisting"><div class=content><pre>vfs.usermount=1</pre></div></div><div class=paragraph><p>這樣只會在下次重新開機時生效，可使用 <code>sysctl</code> 來立即設定這個變數：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sysctl vfs.usermount=1</span>
vfs.usermount: 0 -&gt; 1</code></pre></div></div><div class=paragraph><p>最後一個步驟是建立要掛載檔案系統要的目錄，要掛載檔案系統的使用者需要擁有這個目錄。其中一個辦法是讓 <code>root</code> 建立由該使用者擁有的子目錄 <span class=filename>/mnt/username</span>。在下面的例子，將 <em>username</em> 替換為該使用者的登入名稱並將 <em>usergroup</em> 替換為該使用者的主要群組：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mkdir /mnt/username</span>
<span class=c># chown username:usergroup /mnt/username</span></code></pre></div></div><div class=paragraph><p>假如已經插入 USB 隨身碟，且已出現 <span class=filename>/dev/da0s1</span> 裝置。若裝置使用 FAT 格式的檔案系統，則使用者可使用以下指令掛載該檔案系統：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% mount <span class=nt>-t</span> msdosfs <span class=nt>-o</span> <span class=nt>-m</span><span class=o>=</span>644,-M<span class=o>=</span>755 /dev/da0s1 /mnt/username</code></pre></div></div><div class=paragraph><p>在裝置可以被拔除前，<em>必須</em>先卸載：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% umount /mnt/username</code></pre></div></div><div class=paragraph><p>裝置移除之後，系統訊息緩衝區會顯示如下的訊息：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>umass0: at uhub3, port 2, addr 3 <span class=o>(</span>disconnected<span class=o>)</span>
da0 at umass-sim0 bus 0 scbus4 target 0 lun 0
da0: &lt;STECH Simple Drive 1.04&gt; s/n WD-WXE508CAN263          detached
<span class=o>(</span>da0:umass-sim0:0:0:0<span class=o>)</span>: Periph destroyed</code></pre></div></div></div><div class=sect2><h3 id=_自動掛載可移除的媒體>17.4.2. 自動掛載可移除的媒體<a class=anchor href=#_自動掛載可移除的媒體></a></h3><div class=paragraph><p>可以取消註解在 <span class=filename>/etc/auto_master</span> 中的下行來自動掛載 USB 裝置：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>/media		<span class=nt>-media</span>		<span class=nt>-nosuid</span></code></pre></div></div><div class=paragraph><p>然後加入這些行到 <span class=filename>/etc/devd.conf</span>：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>notify 100 <span class=o>{</span>
	match <span class=s2>&#34;system&#34;</span> <span class=s2>&#34;GEOM&#34;</span><span class=p>;</span>
	match <span class=s2>&#34;subsystem&#34;</span> <span class=s2>&#34;DEV&#34;</span><span class=p>;</span>
	action <span class=s2>&#34;/usr/sbin/automount -c&#34;</span><span class=p>;</span>
<span class=o>}</span><span class=p>;</span></code></pre></div></div><div class=paragraph><p>若 <a href="https://man.freebsd.org/cgi/man.cgi?query=autofs&amp;sektion=5&amp;format=html">autofs(5)</a> 以及 <a href="https://man.freebsd.org/cgi/man.cgi?query=devd&amp;sektion=8&amp;format=html">devd(8)</a> 已經正在執行，則需重新載入設定：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service automount restart</span>
<span class=c># service devd restart</span></code></pre></div></div><div class=paragraph><p>要設定讓 <a href="https://man.freebsd.org/cgi/man.cgi?query=autofs&amp;sektion=5&amp;format=html">autofs(5)</a> 在開機時啟動可以加入此行到 <span class=filename>/etc/rc.conf</span>：</p></div><div class="literalblock programlisting"><div class=content><pre>autofs_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=autofs&amp;sektion=5&amp;format=html">autofs(5)</a> 需要開啟 <a href="https://man.freebsd.org/cgi/man.cgi?query=devd&amp;sektion=8&amp;format=html">devd(8)</a>，預設已經開啟。</p></div><div class=paragraph><p>立即啟動服務：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service automount start</span>
<span class=c># service automountd start</span>
<span class=c># service autounmountd start</span>
<span class=c># service devd start</span></code></pre></div></div><div class=paragraph><p>可以被自動掛載的檔案系統會在 <span class=filename>/media/</span> 中以目錄呈現，會以檔案系統的標籤來命名目錄，若標籤遺失，則會以裝置節點命名。</p></div><div class=paragraph><p>檔案系統會在第一次存取時自動掛載，並在一段時間未使用後自動卸載。自動掛載的磁碟也可手動卸載：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># automount -fu</span></code></pre></div></div><div class=paragraph><p>這個機制一般會用在記憶卡與 USB 隨身碟，也可用在任何 Block 裝置，包含光碟機或 iSCSILUN。</p></div></div></div></div><div class=sect1><h2 id=creating-cds>17.5. 建立與使用 CD 媒體<a class=anchor href=#creating-cds></a></h2><div class=sectionbody><div class=paragraph><p>Compact Disc (CD) media provide a number of features that differentiate them from conventional disks. They are designed so that they can be read continuously without delays to move the head between tracks. While CD media do have tracks, these refer to a section of data to be read continuously, and not a physical property of the disk. The ISO 9660 file system was designed to deal with these differences.</p></div><div class=paragraph><p>The FreeBSD Ports Collection provides several utilities for burning and duplicating audio and data CDs. This chapter demonstrates the use of several command line utilities. For CD burning software with a graphical utility, consider installing the <a class=package href=https://cgit.freebsd.org/ports/tree/sysutils/xcdroast/>sysutils/xcdroast</a> or <a class=package href=https://cgit.freebsd.org/ports/tree/sysutils/k3b/>sysutils/k3b</a> packages or ports.</p></div><div class=sect2><h3 id=atapicam>17.5.1. 支援的裝置<a class=anchor href=#atapicam></a></h3><div class=paragraph><p>The <span class=filename>GENERIC</span> kernel provides support for SCSI, USB, and ATAPICD readers and burners. If a custom kernel is used, the options that need to be present in the kernel configuration file vary by the type of device.</p></div><div class=paragraph><p>For a SCSI burner, make sure these options are present:</p></div><div class="literalblock programlisting"><div class=content><pre>device scbus	# SCSI bus (required for ATA/SCSI)
device da	# Direct Access (disks)
device pass	# Passthrough device (direct ATA/SCSI access)
device cd	# needed for CD and DVD burners</pre></div></div><div class=paragraph><p>For a USB burner, make sure these options are present:</p></div><div class="literalblock programlisting"><div class=content><pre>device scbus	# SCSI bus (required for ATA/SCSI)
device da	# Direct Access (disks)
device pass	# Passthrough device (direct ATA/SCSI access)
device cd	# needed for CD and DVD burners
device uhci	# provides USB 1.x support
device ohci	# provides USB 1.x support
device ehci	# provides USB 2.0 support
device xhci	# provides USB 3.0 support
device usb	# USB Bus (required)
device umass	# Disks/Mass storage - Requires scbus and da</pre></div></div><div class=paragraph><p>For an ATAPI burner, make sure these options are present:</p></div><div class="literalblock programlisting"><div class=content><pre>device ata	# Legacy ATA/SATA controllers
device scbus	# SCSI bus (required for ATA/SCSI)
device pass	# Passthrough device (direct ATA/SCSI access)
device cd	# needed for CD and DVD burners</pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>On FreeBSD versions prior to 10.x, this line is also needed in the kernel configuration file if the burner is an ATAPI device:</p></div><div class="literalblock programlisting"><div class=content><pre>device atapicam</pre></div></div><div class=paragraph><p>Alternately, this driver can be loaded at boot time by adding the following line to <span class=filename>/boot/loader.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>atapicam_load=&#34;YES&#34;</pre></div></div><div class=paragraph><p>This will require a reboot of the system as this driver can only be loaded at boot time.</p></div></td></tr></tbody></table></div><div class=paragraph><p>To verify that FreeBSD recognizes the device, run <code>dmesg</code> and look for an entry for the device. On systems prior to 10.x, the device name in the first line of the output will be <span class=filename>acd0</span> instead of <span class=filename>cd0</span>.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% dmesg | <span class=nb>grep cd
</span>cd0 at ahcich1 bus 0 scbus1 target 0 lun 0
cd0: &lt;HL-DT-ST DVDRAM GU70N LT20&gt; Removable CD-ROM SCSI-0 device
cd0: Serial Number M3OD3S34152
cd0: 150.000MB/s transfers <span class=o>(</span>SATA 1.x, UDMA6, ATAPI 12bytes, PIO 8192bytes<span class=o>)</span>
cd0: Attempt to query device size failed: NOT READY, Medium not present - tray closed</code></pre></div></div></div><div class=sect2><h3 id=cdrecord>17.5.2. 燒錄 CD<a class=anchor href=#cdrecord></a></h3><div class=paragraph><p>In FreeBSD, <code>cdrecord</code> can be used to burn CDs. This command is installed with the <a class=package href=https://cgit.freebsd.org/ports/tree/sysutils/cdrtools/>sysutils/cdrtools</a> package or port.</p></div><div class=paragraph><p>While <code>cdrecord</code> has many options, basic usage is simple. Specify the name of the ISO file to burn and, if the system has multiple burner devices, specify the name of the device to use:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cdrecord dev=device imagefile.iso</span></code></pre></div></div><div class=paragraph><p>To determine the device name of the burner, use <code>-scanbus</code> which might produce results like this:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cdrecord -scanbus</span>
ProDVD-ProBD-Clone 3.00 <span class=o>(</span>amd64-unknown-freebsd10.0<span class=o>)</span> Copyright <span class=o>(</span>C<span class=o>)</span> 1995-2010 Jörg Schilling
Using libscg version <span class=s1>&#39;schily-0.9&#39;</span>
scsibus0:
        0,0,0     0<span class=o>)</span> <span class=s1>&#39;SEAGATE &#39;</span> <span class=s1>&#39;ST39236LW       &#39;</span> <span class=s1>&#39;0004&#39;</span> Disk
        0,1,0     1<span class=o>)</span> <span class=s1>&#39;SEAGATE &#39;</span> <span class=s1>&#39;ST39173W        &#39;</span> <span class=s1>&#39;5958&#39;</span> Disk
        0,2,0     2<span class=o>)</span> <span class=k>*</span>
        0,3,0     3<span class=o>)</span> <span class=s1>&#39;iomega  &#39;</span> <span class=s1>&#39;jaz 1GB         &#39;</span> <span class=s1>&#39;J.86&#39;</span> Removable Disk
        0,4,0     4<span class=o>)</span> <span class=s1>&#39;NEC     &#39;</span> <span class=s1>&#39;CD-ROM DRIVE:466&#39;</span> <span class=s1>&#39;1.26&#39;</span> Removable CD-ROM
        0,5,0     5<span class=o>)</span> <span class=k>*</span>
        0,6,0     6<span class=o>)</span> <span class=k>*</span>
        0,7,0     7<span class=o>)</span> <span class=k>*</span>
scsibus1:
        1,0,0   100<span class=o>)</span> <span class=k>*</span>
        1,1,0   101<span class=o>)</span> <span class=k>*</span>
        1,2,0   102<span class=o>)</span> <span class=k>*</span>
        1,3,0   103<span class=o>)</span> <span class=k>*</span>
        1,4,0   104<span class=o>)</span> <span class=k>*</span>
        1,5,0   105<span class=o>)</span> <span class=s1>&#39;YAMAHA  &#39;</span> <span class=s1>&#39;CRW4260         &#39;</span> <span class=s1>&#39;1.0q&#39;</span> Removable CD-ROM
        1,6,0   106<span class=o>)</span> <span class=s1>&#39;ARTEC   &#39;</span> <span class=s1>&#39;AM12S           &#39;</span> <span class=s1>&#39;1.06&#39;</span> Scanner
        1,7,0   107<span class=o>)</span> <span class=k>*</span></code></pre></div></div><div class=paragraph><p>Locate the entry for the CD burner and use the three numbers separated by commas as the value for <code>dev</code>. In this case, the Yamaha burner device is <code>1,5,0</code>, so the appropriate input to specify that device is <code>dev=1,5,0</code>. Refer to the manual page for <code>cdrecord</code> for other ways to specify this value and for information on writing audio tracks and controlling the write speed.</p></div><div class=paragraph><p>Alternately, run the following command to get the device address of the burner:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># camcontrol devlist</span>
&lt;MATSHITA CDRW/DVD UJDA740 1.00&gt;   at scbus1 target 0 lun 0 <span class=o>(</span>cd0,pass0<span class=o>)</span></code></pre></div></div><div class=paragraph><p>Use the numeric values for <code>scbus</code>, <code>target</code>, and <code>lun</code>. For this example, <code>1,0,0</code> is the device name to use.</p></div></div><div class=sect2><h3 id=mkisofs>17.5.3. 寫入資料到一個 ISO 檔案系統<a class=anchor href=#mkisofs></a></h3><div class=paragraph><p>In order to produce a data CD, the data files that are going to make up the tracks on the CD must be prepared before they can be burned to the CD. In FreeBSD, <a class=package href=https://cgit.freebsd.org/ports/tree/sysutils/cdrtools/>sysutils/cdrtools</a> installs <code>mkisofs</code>, which can be used to produce an ISO 9660 file system that is an image of a directory tree within a UNIX™ file system. The simplest usage is to specify the name of the ISO file to create and the path to the files to place into the ISO 9660 file system:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mkisofs -o imagefile.iso /path/to/tree</span></code></pre></div></div><div class=paragraph><p>This command maps the file names in the specified path to names that fit the limitations of the standard ISO 9660 file system, and will exclude files that do not meet the standard for ISO file systems.</p></div><div class=paragraph><p>A number of options are available to overcome the restrictions imposed by the standard. In particular, <code>-R</code> enables the Rock Ridge extensions common to UNIX™ systems and <code>-J</code> enables Joliet extensions used by Microsoft™ systems.</p></div><div class=paragraph><p>For CDs that are going to be used only on FreeBSD systems, <code>-U</code> can be used to disable all filename restrictions. When used with <code>-R</code>, it produces a file system image that is identical to the specified FreeBSD tree, even if it violates the ISO 9660 standard.</p></div><div class=paragraph><p>The last option of general use is <code>-b</code>. This is used to specify the location of a boot image for use in producing an "El Torito" bootable CD. This option takes an argument which is the path to a boot image from the top of the tree being written to the CD. By default, <code>mkisofs</code> creates an ISO image in "floppy disk emulation" mode, and thus expects the boot image to be exactly 1200, 1440 or 2880 KB in size. Some boot loaders, like the one used by the FreeBSD distribution media, do not use emulation mode. In this case, <code>-no-emul-boot</code> should be used. So, if <span class=filename>/tmp/myboot</span> holds a bootable FreeBSD system with the boot image in <span class=filename>/tmp/myboot/boot/cdboot</span>, this command would produce <span class=filename>/tmp/bootable.iso</span>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mkisofs -R -no-emul-boot -b boot/cdboot -o /tmp/bootable.iso /tmp/myboot</span></code></pre></div></div><div class=paragraph><p>The resulting ISO image can be mounted as a memory disk with:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mdconfig -a -t vnode -f /tmp/bootable.iso -u 0</span>
<span class=c># mount -t cd9660 /dev/md0 /mnt</span></code></pre></div></div><div class=paragraph><p>One can then verify that <span class=filename>/mnt</span> and <span class=filename>/tmp/myboot</span> are identical.</p></div><div class=paragraph><p>There are many other options available for <code>mkisofs</code> to fine-tune its behavior. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=mkisofs&amp;sektion=8&amp;format=html">mkisofs(8)</a> for details.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>It is possible to copy a data CD to an image file that is functionally equivalent to the image file created with <code>mkisofs</code>. To do so, use <span class=filename>dd</span> with the device name as the input file and the name of the ISO to create as the output file:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># dd if=/dev/cd0 of=file.iso bs=2048</span></code></pre></div></div><div class=paragraph><p>The resulting image file can be burned to CD as described in <a href=#cdrecord>燒錄 CD</a>.</p></div></td></tr></tbody></table></div></div><div class=sect2><h3 id=mounting-cd>17.5.4. 使用資料 CD<a class=anchor href=#mounting-cd></a></h3><div class=paragraph><p>Once an ISO has been burned to a CD, it can be mounted by specifying the file system type, the name of the device containing the CD, and an existing mount point:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mount -t cd9660 /dev/cd0 /mnt</span></code></pre></div></div><div class=paragraph><p>Since <code>mount</code> assumes that a file system is of type <code>ufs</code>, a <code>Incorrect super block</code> error will occur if <code>-t cd9660</code> is not included when mounting a data CD.</p></div><div class=paragraph><p>While any data CD can be mounted this way, disks with certain ISO 9660 extensions might behave oddly. For example, Joliet disks store all filenames in two-byte Unicode characters. If some non-English characters show up as question marks, specify the local charset with <code>-C</code>. For more information, refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=mount_cd9660&amp;sektion=8&amp;format=html">mount_cd9660(8)</a>.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>In order to do this character conversion with the help of <code>-C</code>, the kernel requires the <span class=filename>cd9660_iconv.ko</span> module to be loaded. This can be done either by adding this line to <span class=filename>loader.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>cd9660_iconv_load=&#34;YES&#34;</pre></div></div><div class=paragraph><p>and then rebooting the machine, or by directly loading the module with <code>kldload</code>.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Occasionally, <code>Device not configured</code> will be displayed when trying to mount a data CD. This usually means that the CD drive has not detected a disk in the tray, or that the drive is not visible on the bus. It can take a couple of seconds for a CD drive to detect media, so be patient.</p></div><div class=paragraph><p>Sometimes, a SCSICD drive may be missed because it did not have enough time to answer the bus reset. To resolve this, a custom kernel can be created which increases the default SCSI delay. Add the following option to the custom kernel configuration file and rebuild the kernel using the instructions in <a href=../kernelconfig/#kernelconfig-building>編譯與安裝自訂核心</a>:</p></div><div class="literalblock programlisting"><div class=content><pre>options SCSI_DELAY=15000</pre></div></div><div class=paragraph><p>This tells the SCSI bus to pause 15 seconds during boot, to give the CD drive every possible chance to answer the bus reset.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>It is possible to burn a file directly to CD, without creating an ISO 9660 file system. This is known as burning a raw data CD and some people do this for backup purposes.</p></div><div class=paragraph><p>This type of disk can not be mounted as a normal data CD. In order to retrieve the data burned to such a CD, the data must be read from the raw device node. For example, this command will extract a compressed tar file located on the second CD device into the current working directory:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># tar xzvf /dev/cd1</span></code></pre></div></div><div class=paragraph><p>In order to mount a data CD, the data must be written using <code>mkisofs</code>.</p></div></td></tr></tbody></table></div></div><div class=sect2><h3 id=duplicating-audiocds>17.5.5. 複製音樂 CD<a class=anchor href=#duplicating-audiocds></a></h3><div class=paragraph><p>To duplicate an audio CD, extract the audio data from the CD to a series of files, then write these files to a blank CD.</p></div><div class=paragraph><p><a href=#using-cdrecord>Duplicating an Audio CD</a> describes how to duplicate and burn an audio CD. If the FreeBSD version is less than 10.0 and the device is ATAPI, the <code>atapicam</code> module must be first loaded using the instructions in <a href=#atapicam>支援的裝置</a>.</p></div><div id=using-cdrecord class="exampleblock procedure"><div class=content><div class=paragraph><p><strong>Procedure: Duplicating an Audio CD</strong></p></div><div class="olist arabic"><ol class=arabic><li><p>The <a class=package href=https://cgit.freebsd.org/ports/tree/sysutils/cdrtools/>sysutils/cdrtools</a> package or port installs <code>cdda2wav</code>. This command can be used to extract all of the audio tracks, with each track written to a separate WAV file in the current working directory:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% cdda2wav <span class=nt>-vall</span> <span class=nt>-B</span> <span class=nt>-Owav</span></code></pre></div></div><div class=paragraph><p>A device name does not need to be specified if there is only one CD device on the system. Refer to the <code>cdda2wav</code> manual page for instructions on how to specify a device and to learn more about the other options available for this command.</p></div></li><li><p>Use <code>cdrecord</code> to write the <span class=filename>.wav</span> files:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% cdrecord <span class=nt>-v</span> <span class=nv>dev</span><span class=o>=</span>2,0 <span class=nt>-dao</span> <span class=nt>-useinfo</span>  <span class=k>*</span>.wav</code></pre></div></div><div class=paragraph><p>Make sure that <em>2,0</em> is set appropriately, as described in <a href=#cdrecord>燒錄 CD</a>.</p></div></li></ol></div></div></div></div></div></div><div class=sect1><h2 id=creating-dvds>17.6. 建立與使用 DVD 媒體<a class=anchor href=#creating-dvds></a></h2><div class=sectionbody><div class=paragraph><p>Compared to the CD, the DVD is the next generation of optical media storage technology. The DVD can hold more data than any CD and is the standard for video publishing.</p></div><div class=paragraph><p>Five physical recordable formats can be defined for a recordable DVD:</p></div><div class=ulist><ul><li><p>DVD-R: This was the first DVD recordable format available. The DVD-R standard is defined by the <a href=http://www.dvdforum.org/forum.shtml>DVD Forum</a>. This format is write once.</p></li><li><p>DVD-RW: This is the rewritable version of the DVD-R standard. A DVD-RW can be rewritten about 1000 times.</p></li><li><p>DVD-RAM: This is a rewritable format which can be seen as a removable hard drive. However, this media is not compatible with most DVD-ROM drives and DVD-Video players as only a few DVD writers support the DVD-RAM format. Refer to <a href=#creating-dvd-ram>使用 DVD-RAM</a> for more information on DVD-RAM use.</p></li><li><p>DVD+RW: This is a rewritable format defined by the <a href=https://en.wikipedia.org/wiki/DVD%2BRW_Alliance>DVD+RW Alliance</a>. A DVD+RW can be rewritten about 1000 times.</p></li><li><p>DVD+R: This format is the write once variation of the DVD+RW format.</p></li></ul></div><div class=paragraph><p>A single layer recordable DVD can hold up to 4,700,000,000 bytes which is actually 4.38 GB or 4485 MB as 1 kilobyte is 1024 bytes.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>A distinction must be made between the physical media and the application. For example, a DVD-Video is a specific file layout that can be written on any recordable DVD physical media such as DVD-R, DVD+R, or DVD-RW. Before choosing the type of media, ensure that both the burner and the DVD-Video player are compatible with the media under consideration.</p></div></td></tr></tbody></table></div><div class=sect2><h3 id=_設定>17.6.1. 設定<a class=anchor href=#_設定></a></h3><div class=paragraph><p>To perform DVD recording, use <a href="https://man.freebsd.org/cgi/man.cgi?query=growisofs&amp;sektion=1&amp;format=html">growisofs(1)</a>. This command is part of the <a class=package href=https://cgit.freebsd.org/ports/tree/sysutils/dvd+rw-tools/>sysutils/dvd+rw-tools</a> utilities which support all DVD media types.</p></div><div class=paragraph><p>These tools use the SCSI subsystem to access the devices, therefore <a href=#atapicam>ATAPI/CAM support</a> must be loaded or statically compiled into the kernel. This support is not needed if the burner uses the USB interface. Refer to <a href=#usb-disks>USB 儲存裝置</a> for more details on USB device configuration.</p></div><div class=paragraph><p>DMA access must also be enabled for ATAPI devices, by adding the following line to <span class=filename>/boot/loader.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>hw.ata.atapi_dma=&#34;1&#34;</pre></div></div><div class=paragraph><p>Before attempting to use dvd+rw-tools, consult the <a href=http://fy.chalmers.se/~appro/linux/DVD+RW/hcn.html>Hardware Compatibility Notes</a>.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>For a graphical user interface, consider using <a class=package href=https://cgit.freebsd.org/ports/tree/sysutils/k3b/>sysutils/k3b</a> which provides a user friendly interface to <a href="https://man.freebsd.org/cgi/man.cgi?query=growisofs&amp;sektion=1&amp;format=html">growisofs(1)</a> and many other burning tools.</p></div></td></tr></tbody></table></div></div><div class=sect2><h3 id=_燒錄資料_dvd>17.6.2. 燒錄資料 DVD<a class=anchor href=#_燒錄資料_dvd></a></h3><div class=paragraph><p>Since <a href="https://man.freebsd.org/cgi/man.cgi?query=growisofs&amp;sektion=1&amp;format=html">growisofs(1)</a> is a front-end to <a href=#mkisofs>mkisofs</a>, it will invoke <a href="https://man.freebsd.org/cgi/man.cgi?query=mkisofs&amp;sektion=8&amp;format=html">mkisofs(8)</a> to create the file system layout and perform the write on the DVD. This means that an image of the data does not need to be created before the burning process.</p></div><div class=paragraph><p>To burn to a DVD+R or a DVD-R the data in <span class=filename>/path/to/data</span>, use the following command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># growisofs -dvd-compat -Z /dev/cd0 -J -R /path/to/data</span></code></pre></div></div><div class=paragraph><p>In this example, <code>-J -R</code> is passed to <a href="https://man.freebsd.org/cgi/man.cgi?query=mkisofs&amp;sektion=8&amp;format=html">mkisofs(8)</a> to create an ISO 9660 file system with Joliet and Rock Ridge extensions. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=mkisofs&amp;sektion=8&amp;format=html">mkisofs(8)</a> for more details.</p></div><div class=paragraph><p>For the initial session recording, <code>-Z</code> is used for both single and multiple sessions. Replace <em>/dev/cd0</em>, with the name of the DVD device. Using <code>-dvd-compat</code> indicates that the disk will be closed and that the recording will be unappendable. This should also provide better media compatibility with DVD-ROM drives.</p></div><div class=paragraph><p>To burn a pre-mastered image, such as <em>imagefile.iso</em>, use:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># growisofs -dvd-compat -Z /dev/cd0=imagefile.iso</span></code></pre></div></div><div class=paragraph><p>The write speed should be detected and automatically set according to the media and the drive being used. To force the write speed, use <code>-speed=</code>. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=growisofs&amp;sektion=1&amp;format=html">growisofs(1)</a> for example usage.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>In order to support working files larger than 4.38GB, an UDF/ISO-9660 hybrid file system must be created by passing <code>-udf -iso-level 3</code> to <a href="https://man.freebsd.org/cgi/man.cgi?query=mkisofs&amp;sektion=8&amp;format=html">mkisofs(8)</a> and all related programs, such as <a href="https://man.freebsd.org/cgi/man.cgi?query=growisofs&amp;sektion=1&amp;format=html">growisofs(1)</a>. This is required only when creating an ISO image file or when writing files directly to a disk. Since a disk created this way must be mounted as an UDF file system with <a href="https://man.freebsd.org/cgi/man.cgi?query=mount_udf&amp;sektion=8&amp;format=html">mount_udf(8)</a>, it will be usable only on an UDF aware operating system. Otherwise it will look as if it contains corrupted files.</p></div><div class=paragraph><p>To create this type of ISO file:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% mkisofs <span class=nt>-R</span> <span class=nt>-J</span> <span class=nt>-udf</span> <span class=nt>-iso-level</span> 3 <span class=nt>-o</span> imagefile.iso /path/to/data</code></pre></div></div><div class=paragraph><p>To burn files directly to a disk:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># growisofs -dvd-compat -udf -iso-level 3 -Z /dev/cd0 -J -R /path/to/data</span></code></pre></div></div><div class=paragraph><p>When an ISO image already contains large files, no additional options are required for <a href="https://man.freebsd.org/cgi/man.cgi?query=growisofs&amp;sektion=1&amp;format=html">growisofs(1)</a> to burn that image on a disk.</p></div><div class=paragraph><p>Be sure to use an up-to-date version of <a class=package href=https://cgit.freebsd.org/ports/tree/sysutils/cdrtools/>sysutils/cdrtools</a>, which contains <a href="https://man.freebsd.org/cgi/man.cgi?query=mkisofs&amp;sektion=8&amp;format=html">mkisofs(8)</a>, as an older version may not contain large files support. If the latest version does not work, install <a class=package href=https://cgit.freebsd.org/ports/tree/sysutils/cdrtools-devel/>sysutils/cdrtools-devel</a> and read its <a href="https://man.freebsd.org/cgi/man.cgi?query=mkisofs&amp;sektion=8&amp;format=html">mkisofs(8)</a>.</p></div></td></tr></tbody></table></div></div><div class=sect2><h3 id=_燒錄_dvd_video>17.6.3. 燒錄 DVD-Video<a class=anchor href=#_燒錄_dvd_video></a></h3><div class=paragraph><p>A DVD-Video is a specific file layout based on the ISO 9660 and micro-UDF (M-UDF) specifications. Since DVD-Video presents a specific data structure hierarchy, a particular program such as <a class=package href=https://cgit.freebsd.org/ports/tree/multimedia/dvdauthor/>multimedia/dvdauthor</a> is needed to author the DVD.</p></div><div class=paragraph><p>If an image of the DVD-Video file system already exists, it can be burned in the same way as any other image. If <code>dvdauthor</code> was used to make the DVD and the result is in <span class=filename>/path/to/video</span>, the following command should be used to burn the DVD-Video:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># growisofs -Z /dev/cd0 -dvd-video /path/to/video</span></code></pre></div></div><div class=paragraph><p><code>-dvd-video</code> is passed to <a href="https://man.freebsd.org/cgi/man.cgi?query=mkisofs&amp;sektion=8&amp;format=html">mkisofs(8)</a> to instruct it to create a DVD-Video file system layout. This option implies the <code>-dvd-compat</code> <a href="https://man.freebsd.org/cgi/man.cgi?query=growisofs&amp;sektion=1&amp;format=html">growisofs(1)</a> option.</p></div></div><div class=sect2><h3 id=_使用_dvdrw>17.6.4. 使用 DVD+RW<a class=anchor href=#_使用_dvdrw></a></h3><div class=paragraph><p>Unlike CD-RW, a virgin DVD+RW needs to be formatted before first use. It is <em>recommended</em> to let <a href="https://man.freebsd.org/cgi/man.cgi?query=growisofs&amp;sektion=1&amp;format=html">growisofs(1)</a> take care of this automatically whenever appropriate. However, it is possible to use <code>dvd+rw-format</code> to format the DVD+RW:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># dvd+rw-format /dev/cd0</span></code></pre></div></div><div class=paragraph><p>Only perform this operation once and keep in mind that only virgin DVD+RW medias need to be formatted. Once formatted, the DVD+RW can be burned as usual.</p></div><div class=paragraph><p>To burn a totally new file system and not just append some data onto a DVD+RW, the media does not need to be blanked first. Instead, write over the previous recording like this:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># growisofs -Z /dev/cd0 -J -R /path/to/newdata</span></code></pre></div></div><div class=paragraph><p>The DVD+RW format supports appending data to a previous recording. This operation consists of merging a new session to the existing one as it is not considered to be multi-session writing. <a href="https://man.freebsd.org/cgi/man.cgi?query=growisofs&amp;sektion=1&amp;format=html">growisofs(1)</a> will <em>grow</em> the ISO 9660 file system present on the media.</p></div><div class=paragraph><p>For example, to append data to a DVD+RW, use the following:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># growisofs -M /dev/cd0 -J -R /path/to/nextdata</span></code></pre></div></div><div class=paragraph><p>The same <a href="https://man.freebsd.org/cgi/man.cgi?query=mkisofs&amp;sektion=8&amp;format=html">mkisofs(8)</a> options used to burn the initial session should be used during next writes.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Use <code>-dvd-compat</code> for better media compatibility with DVD-ROM drives. When using DVD+RW, this option will not prevent the addition of data.</p></div></td></tr></tbody></table></div><div class=paragraph><p>To blank the media, use:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># growisofs -Z /dev/cd0=/dev/zero</span></code></pre></div></div></div><div class=sect2><h3 id=_使用_dvd_rw>17.6.5. 使用 DVD-RW<a class=anchor href=#_使用_dvd_rw></a></h3><div class=paragraph><p>A DVD-RW accepts two disc formats: incremental sequential and restricted overwrite. By default, DVD-RW discs are in sequential format.</p></div><div class=paragraph><p>A virgin DVD-RW can be directly written without being formatted. However, a non-virgin DVD-RW in sequential format needs to be blanked before writing a new initial session.</p></div><div class=paragraph><p>To blank a DVD-RW in sequential mode:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># dvd+rw-format -blank=full /dev/cd0</span></code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>A full blanking using <code>-blank=full</code> will take about one hour on a 1x media. A fast blanking can be performed using <code>-blank</code>, if the DVD-RW will be recorded in Disk-At-Once (DAO) mode. To burn the DVD-RW in DAO mode, use the command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># growisofs -use-the-force-luke=dao -Z /dev/cd0=imagefile.iso</span></code></pre></div></div><div class=paragraph><p>Since <a href="https://man.freebsd.org/cgi/man.cgi?query=growisofs&amp;sektion=1&amp;format=html">growisofs(1)</a> automatically attempts to detect fast blanked media and engage DAO write, <code>-use-the-force-luke=dao</code> should not be required.</p></div><div class=paragraph><p>One should instead use restricted overwrite mode with any DVD-RW as this format is more flexible than the default of incremental sequential.</p></div></td></tr></tbody></table></div><div class=paragraph><p>To write data on a sequential DVD-RW, use the same instructions as for the other DVD formats:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># growisofs -Z /dev/cd0 -J -R /path/to/data</span></code></pre></div></div><div class=paragraph><p>To append some data to a previous recording, use <code>-M</code> with <a href="https://man.freebsd.org/cgi/man.cgi?query=growisofs&amp;sektion=1&amp;format=html">growisofs(1)</a>. However, if data is appended on a DVD-RW in incremental sequential mode, a new session will be created on the disc and the result will be a multi-session disc.</p></div><div class=paragraph><p>A DVD-RW in restricted overwrite format does not need to be blanked before a new initial session. Instead, overwrite the disc with <code>-Z</code>. It is also possible to grow an existing ISO 9660 file system written on the disc with <code>-M</code>. The result will be a one-session DVD.</p></div><div class=paragraph><p>To put a DVD-RW in restricted overwrite format, the following command must be used:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># dvd+rw-format /dev/cd0</span></code></pre></div></div><div class=paragraph><p>To change back to sequential format, use:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># dvd+rw-format -blank=full /dev/cd0</span></code></pre></div></div></div><div class=sect2><h3 id=_多階段燒錄_multi_session>17.6.6. 多階段燒錄 (Multi-Session)<a class=anchor href=#_多階段燒錄_multi_session></a></h3><div class=paragraph><p>Few DVD-ROM drives support multi-session DVDs and most of the time only read the first session. DVD+R, DVD-R and DVD-RW in sequential format can accept multiple sessions. The notion of multiple sessions does not exist for the DVD+RW and the DVD-RW restricted overwrite formats.</p></div><div class=paragraph><p>Using the following command after an initial non-closed session on a DVD+R, DVD-R, or DVD-RW in sequential format, will add a new session to the disc:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># growisofs -M /dev/cd0 -J -R /path/to/nextdata</span></code></pre></div></div><div class=paragraph><p>Using this command with a DVD+RW or a DVD-RW in restricted overwrite mode will append data while merging the new session to the existing one. The result will be a single-session disc. Use this method to add data after an initial write on these types of media.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Since some space on the media is used between each session to mark the end and start of sessions, one should add sessions with a large amount of data to optimize media space. The number of sessions is limited to 154 for a DVD+R, about 2000 for a DVD-R, and 127 for a DVD+R Double Layer.</p></div></td></tr></tbody></table></div></div><div class=sect2><h3 id=_取得更多資訊>17.6.7. 取得更多資訊<a class=anchor href=#_取得更多資訊></a></h3><div class=paragraph><p>To obtain more information about a DVD, use <code>dvd+rw-mediainfo <em>/dev/cd0</em></code> while the disc in the specified drive.</p></div><div class=paragraph><p>More information about dvd+rw-tools can be found in <a href="https://man.freebsd.org/cgi/man.cgi?query=growisofs&amp;sektion=1&amp;format=html">growisofs(1)</a>, on the <a href=http://fy.chalmers.se/~appro/linux/DVD+RW/>dvd+rw-tools web site</a>, and in the <a href=http://lists.debian.org/cdwrite/>cdwrite mailing list</a> archives.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>When creating a problem report related to the use of dvd+rw-tools, always include the output of <code>dvd+rw-mediainfo</code>.</p></div></td></tr></tbody></table></div></div><div class=sect2><h3 id=creating-dvd-ram>17.6.8. 使用 DVD-RAM<a class=anchor href=#creating-dvd-ram></a></h3><div class=paragraph><p>DVD-RAM writers can use either a SCSI or ATAPI interface. For ATAPI devices, DMA access has to be enabled by adding the following line to <span class=filename>/boot/loader.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>hw.ata.atapi_dma=&#34;1&#34;</pre></div></div><div class=paragraph><p>A DVD-RAM can be seen as a removable hard drive. Like any other hard drive, the DVD-RAM must be formatted before it can be used. In this example, the whole disk space will be formatted with a standard UFS2 file system:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># dd if=/dev/zero of=/dev/acd0 bs=2k count=1</span>
<span class=c># bsdlabel -Bw acd0</span>
<span class=c># newfs /dev/acd0</span></code></pre></div></div><div class=paragraph><p>The DVD device, <span class=filename>acd0</span>, must be changed according to the configuration.</p></div><div class=paragraph><p>Once the DVD-RAM has been formatted, it can be mounted as a normal hard drive:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mount /dev/acd0 /mnt</span></code></pre></div></div><div class=paragraph><p>Once mounted, the DVD-RAM will be both readable and writeable.</p></div></div></div></div><div class=sect1><h2 id=floppies>17.7. 建立與使用軟碟<a class=anchor href=#floppies></a></h2><div class=sectionbody><div class=paragraph><p>This section explains how to format a 3.5 inch floppy disk in FreeBSD.</p></div><div class="exampleblock procedure"><div class=content><div class=paragraph><p><strong>Procedure: Steps to Format a Floppy</strong></p></div><div class=paragraph><p>A floppy disk needs to be low-level formatted before it can be used. This is usually done by the vendor, but formatting is a good way to check media integrity. To low-level format the floppy disk on FreeBSD, use <a href="https://man.freebsd.org/cgi/man.cgi?query=fdformat&amp;sektion=1&amp;format=html">fdformat(1)</a>. When using this utility, make note of any error messages, as these can help determine if the disk is good or bad.</p></div><div class="olist arabic"><ol class=arabic><li><p>To format the floppy, insert a new 3.5 inch floppy disk into the first floppy drive and issue:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># /usr/sbin/fdformat -f 1440 /dev/fd0</span></code></pre></div></div></li><li><p>After low-level formatting the disk, create a disk label as it is needed by the system to determine the size of the disk and its geometry. The supported geometry values are listed in <span class=filename>/etc/disktab</span>.</p><div class=paragraph><p>To write the disk label, use <a href="https://man.freebsd.org/cgi/man.cgi?query=bsdlabel&amp;sektion=8&amp;format=html">bsdlabel(8)</a>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># /sbin/bsdlabel -B -w /dev/fd0 fd1440</span></code></pre></div></div></li><li><p>The floppy is now ready to be high-level formatted with a file system. The floppy’s file system can be either UFS or FAT, where FAT is generally a better choice for floppies.</p><div class=paragraph><p>To format the floppy with FAT, issue:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># /sbin/newfs_msdos /dev/fd0</span></code></pre></div></div></li></ol></div></div></div><div class=paragraph><p>The disk is now ready for use. To use the floppy, mount it with <a href="https://man.freebsd.org/cgi/man.cgi?query=mount_msdosfs&amp;sektion=8&amp;format=html">mount_msdosfs(8)</a>. One can also install and use <a class=package href=https://cgit.freebsd.org/ports/tree/emulators/mtools/>emulators/mtools</a> from the Ports Collection.</p></div></div></div><div class=sect1><h2 id=backup-basics>17.8. 備份基礎概念<a class=anchor href=#backup-basics></a></h2><div class=sectionbody><div class=paragraph><p>為了要能夠從磁碟故障、意外刪除文件、隨機文件損壞或完全機器毀壞，包含本地備份毀壞進行恢復，執行備份計劃是必要的。</p></div><div class=paragraph><p>備份的類型與排程會依情況有所不同，取決於資料的重要性、檔案還原所需的程度以及可接受的停機時間。一些可用來備份的技術有：</p></div><div class=ulist><ul><li><p>封存整個檔案系統，備份至永久、異地媒體。這可在以上所列的所有問題發生時提供保護，但要還原會較慢且不方便，特別是對於沒有權限的使用者。</p></li><li><p>檔案系統快照 (Snapshot)，對於還原已刪除的檔案或先前版本的檔案非常有用。</p></li><li><p>整個檔案系統或磁碟的複本，使用排程的 <a class=package href=https://cgit.freebsd.org/ports/tree/net/rsync/>net/rsync</a> 來與網路上的另一個系統同步。</p></li><li><p>硬體或軟體 RAID，來最小化或避免當磁碟故障時的停機時間。</p></li></ul></div><div class=paragraph><p>通常會混合使用各種備份技術，例如，建立一個排程每週自動做儲存於異地的完整系統備份，並使用每小時的 ZFS 快照來輔助備份。此外，在對檔案做編輯或刪除前手動備份各別目錄或檔案。</p></div><div class=paragraph><p>本章節會介紹一些可以用來在 FreeBSD 上建立與管理系統備份的工具。</p></div><div class=sect2><h3 id=_檔案系統備份>17.8.1. 檔案系統備份<a class=anchor href=#_檔案系統備份></a></h3><div class=paragraph><p>要備份一個檔案系統，會用到 <a href="https://man.freebsd.org/cgi/man.cgi?query=dump&amp;sektion=8&amp;format=html">dump(8)</a> 這個傳統 UNIX™ 程式來建立備份，並可使用 <a href="https://man.freebsd.org/cgi/man.cgi?query=restore&amp;sektion=8&amp;format=html">restore(8)</a> 來還原備份。這兩個工具可在磁碟區塊的層級運作，這個層級比由檔案系統建立檔案、連結與目錄的抽象層級還要低，因此不像其他的備份軟體，<code>dump</code> 必須一次備份整個檔案系統，且無法只備份部份檔案系統或跨多個檔案系統的目錄樹，<code>dump</code> 會備份構成檔案與目錄的原始資料區塊，而非直接備份檔案與目錄。</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>在根目錄使用 <code>dump</code>，會無法備份 <span class=filename>/home</span>, <span class=filename>/usr</span> 或其他許多的目錄，由於這些目錄通常是其他檔案系統的掛載點或連結到其他檔案系統的符號連結。</p></div></td></tr></tbody></table></div><div class=paragraph><p>還原資料時，<code>restore</code> 預設會儲存暫存檔案於 <span class=filename>/tmp/</span>，當使用一個 <span class=filename>/tmp</span> 較小的復原磁碟時，請設定 <code>TMPDIR</code> 到一個擁有較多可用空間的目錄以讓還原可以順利執行。</p></div><div class=paragraph><p>當使用 <code>dump</code> 時，請小心最早自 AT&amp;T UNIX™,circa 1975 的版本 6 仍有一些問題存在，預設的參數會假設備份到一個 9 軌的磁帶，這並非其他類型的媒體或現今可用的高密度磁帶，必須另外在指令列修改這個預設值。</p></div><div class=paragraph><p>雖然可以使用 <a href="https://man.freebsd.org/cgi/man.cgi?query=rdump&amp;sektion=8&amp;format=html">rdump(8)</a> 與 <a href="https://man.freebsd.org/cgi/man.cgi?query=rrestore&amp;sektion=8&amp;format=html">rrestore(8)</a> 工具可以跨網路備份一個檔案系統到另一個系統或備份到連結另一台電腦的磁帶機，但這使用兩個工具備份的安全性並不足夠。</p></div><div class=paragraph><p>可改以在較安全的 SSH 連線上使用 <code>dump</code> 與 <code>restore</code>。以下例子會建立一個完整、壓縮的 <span class=filename>/usr</span> 備份並透過 SSH 連線傳送備份檔案到指定的主機。</p></div><div class=exampleblock><div class=title>例 1. 在 ssh 使用 <code>dump</code></div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># /sbin/dump -0uan -f - /usr | gzip -2 | ssh -c blowfish \</span>
          targetuser@targetmachine.example.com <span class=nb>dd </span><span class=nv>of</span><span class=o>=</span>/mybigfiles/dump-usr-l0.gz</code></pre></div></div></div></div><div class=paragraph><p>這個例子會設定 <code>RSH</code>，以便透過 SSH 連線寫入備份到遠端系統的磁帶機：</p></div><div class=exampleblock><div class=title>例 2. 在 ssh 使用 <code>dump</code> 透過 <code>RSH</code> 設定</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># env RSH=/usr/bin/ssh /sbin/dump -0uan -f targetuser@targetmachine.example.com:/dev/sa0 /usr</span></code></pre></div></div></div></div></div><div class=sect2><h3 id=_目錄備份>17.8.2. 目錄備份<a class=anchor href=#_目錄備份></a></h3><div class=paragraph><p>系統已有內建數個工具可在需要時用來備份與還原指定的檔案與目錄。</p></div><div class=paragraph><p>要備份一個目錄中的所有檔案最好的選擇是 <a href="https://man.freebsd.org/cgi/man.cgi?query=tar&amp;sektion=1&amp;format=html">tar(1)</a>，這個工具最早可以追朔自 AT&amp;T UNIX™ 版本 6 時，因此預設會做一個遞迴備份到一個磁帶機，可以使用參數來改指定備份檔案的名稱。</p></div><div class=paragraph><p>這個例子會建立目前目錄的壓縮備份並儲存至 <span class=filename>/tmp/mybackup.tgz</span>，在建立備份檔案時，要確認備份檔案不要儲存到與目前備份目錄相同的目錄。</p></div><div class=exampleblock><div class=title>例 3. 使用 <code>tar</code> 備份目前目錄</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># tar czvf /tmp/mybackup.tgz .</span></code></pre></div></div></div></div><div class=paragraph><p>要還原整個備份，先 <code>cd</code> 進入要放置還原檔的目錄並指定備份的名稱。注意，這個動作會覆寫任何在該還原目錄中任何較新版的檔案，當不確定時，可先還原到一個暫時的目錄或指定備份檔中的檔案做還原。</p></div><div class=exampleblock><div class=title>例 4. 使用 <code>tar</code> 還原目前目錄</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># tar xzvf /tmp/mybackup.tgz</span></code></pre></div></div></div></div><div class=paragraph><p>除此之外還有許多可用的參數在 <a href="https://man.freebsd.org/cgi/man.cgi?query=tar&amp;sektion=1&amp;format=html">tar(1)</a> 中會有說明。本工具也支援使用排除模式 (Exclude pattern) 來指定那些檔案應該在備份指定目錄或自備份還原檔案時排除。</p></div><div class=paragraph><p>要使用指定的檔案與目錄清單做備份使用 <a href="https://man.freebsd.org/cgi/man.cgi?query=cpio&amp;sektion=1&amp;format=html">cpio(1)</a> 是不錯的選擇。它並不像 <code>tar</code>，<code>cpio</code> 並不知道如何走訪目錄樹，所以必須提供檔案的清單才能做備份。</p></div><div class=paragraph><p>例如，檔案的清單可以使用 <code>ls</code> 或 <code>find</code> 來產生。以下例子會建立一個目前目錄的遞迴清單然後轉送 (Piped) 給 <code>cpio</code> 來建立名稱為 <span class=filename>/tmp/mybackup.cpio</span> 的備份檔。</p></div><div class=exampleblock><div class=title>例 5. 使用 <code>ls</code> 與 <code>cpio</code> 來製作目前目錄的遞迴備份</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ls -R | cpio -ovF /tmp/mybackup.cpio</span></code></pre></div></div></div></div><div class=paragraph><p>有一個備份工具嘗試整合 <code>tar</code> 與 <code>cpio</code> 所提供的功能，便是 <a href="https://man.freebsd.org/cgi/man.cgi?query=pax&amp;sektion=1&amp;format=html">pax(1)</a>。經歷數年，各種版本的 <code>tar</code> 與 <code>cpio</code> 變的有一些無法相容。POSIX™ 開發出 <code>pax</code>，嘗試讀取與寫入各種版本的 <code>cpio</code> and <code>tar</code> 格式並加入自己的新格式。</p></div><div class=paragraph><p>以先前的例子改使用 <code>pax</code> 會是：</p></div><div class=exampleblock><div class=title>例 6. 使用 <code>pax</code> 備份目前目錄</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pax -wf /tmp/mybackup.pax .</span></code></pre></div></div></div></div></div><div class=sect2><h3 id=backups-tapebackups>17.8.3. 使用資料磁帶備份<a class=anchor href=#backups-tapebackups></a></h3><div class=paragraph><p>隨著磁帶的技術持續發展，當今的備份系統將異地備份與本地可移除媒體做了結合。FreeBSD 支援任何使用 SCSI 的磁帶機，如 LTO 或 DAT，並有限制的支援 SATA 與 USB 磁帶機。</p></div><div class=paragraph><p>SCSI 磁帶機在 FreeBSD 會使用 <a href="https://man.freebsd.org/cgi/man.cgi?query=sa&amp;sektion=4&amp;format=html">sa(4)</a> 驅動程式以及 <span class=filename>/dev/sa0</span>, <span class=filename>/dev/nsa0</span> 與 <span class=filename>/dev/esa0</span> 裝置，實體裝置名稱為 <span class=filename>/dev/sa0</span>，當使用 <span class=filename>/dev/nsa0</span> 時，備份程式在寫入檔案之後不會倒帶，這可允許寫入超過一個檔案到磁帶，而使用 <span class=filename>/dev/esa0</span> 時，當關閉裝置後便會退出磁帶。</p></div><div class=paragraph><p>在 FreeBSD 中會使用 <code>mt</code> 來做磁帶機的控制操作，例如在磁帶中搜尋檔案或寫入磁帶控制記號到磁帶。例如，要保留磁帶上的前三個檔案，可以在寫入新檔案前跳過這些檔案：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mt -f /dev/nsa0 fsf 3</span></code></pre></div></div><div class=paragraph><p>這個工具尚支援許多操作，請參考 <a href="https://man.freebsd.org/cgi/man.cgi?query=mt&amp;sektion=1&amp;format=html">mt(1)</a> 了解詳情。</p></div><div class=paragraph><p>要使用 <code>tar</code> 寫入單一檔案到磁帶，可指定磁帶裝置的名稱以及要備份的檔案：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># tar cvf /dev/sa0 file</span></code></pre></div></div><div class=paragraph><p>要從磁帶上的 <code>tar</code> 封存檔還原檔案到目前的目錄可：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># tar xvf /dev/sa0</span></code></pre></div></div><div class=paragraph><p>要備份一個 UFS 檔案系統可使用 <code>dump</code>。以下例子會備份 <span class=filename>/usr</span> 並在完成時不做倒帶：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># dump -0aL -b64 -f /dev/nsa0 /usr</span></code></pre></div></div><div class=paragraph><p>要以互動的方式從磁帶上的 <code>dump</code> 檔案還原到目前目錄：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># restore -i -f /dev/nsa0</span></code></pre></div></div></div><div class=sect2><h3 id=backups-programs-amanda>17.8.4. 第三方備份工具<a class=anchor href=#backups-programs-amanda></a></h3><div class=paragraph><p>FreeBSD Port 套件集提供了許多第三方工具可用於排程建立備份，簡化磁帶備份並讓備份更簡單方便。許多這類的應用程式是以客戶端/伺服器為基礎，可用來自動化單一系統或網路上所有電腦的備份。</p></div><div class=paragraph><p>較熱門的工具包含 Amanda, Bacula, rsync 以及 duplicity。</p></div></div><div class=sect2><h3 id=_緊急還原>17.8.5. 緊急還原<a class=anchor href=#_緊急還原></a></h3><div class=paragraph><p>除了正常的備份外，建議將下以步驟做為緊急準備計劃的一部份。</p></div><div class=paragraph><p>替以下指令的輸出建立一份可列印的複本：</p></div><div class=ulist><ul><li><p><code>gpart show</code></p></li><li><p><code>more /etc/fstab</code></p></li><li><p><code>dmesg</code></p></li></ul></div><div class=paragraph><p>在安全的地方保存這份列印結果與安裝媒體的複本，在緊急還原時可能會需要，接著開機進入安裝媒體並選擇 <code>Live CD</code> 以存取救援 Shell (Rescue shell)，這個救援模式可以用來檢視目前系統的狀態，若有需要，可重新格式化磁碟然後自備份還原資料。</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>FreeBSD/i386 11.2-RELEASE 的安裝媒體未內含救援 Shell，針對該版本，可改自 <a href=ftp://ftp.FreeBSD.org/pub/FreeBSD/releases/i386/ISO-IMAGES/11.2/FreeBSD-11.2-RELEASE-i386-livefs.iso>ftp://ftp.FreeBSD.org/pub/FreeBSD/releases/i386/ISO-IMAGES/11.2/FreeBSD-11.2-RELEASE-i386-livefs.iso</a> 下載 Livefs CD 映像檔並燒錄。</p></div></td></tr></tbody></table></div><div class=paragraph><p>然後，測試救援 Shell 下的備份。記錄下整個程序，將這份記錄隨媒體、列印結果、備份檔一併保存，這份記錄可以避免在緊張壓力下做緊急還原時因不慎造成備份的毀壞。</p></div><div class=paragraph><p>要再安全性一點，則可將最新的備份儲存在與實體電腦與磁碟機有一段明顯距離的遠端位置。</p></div></div></div></div><div class=sect1><h2 id=disks-virtual>17.9. 記憶體磁碟<a class=anchor href=#disks-virtual></a></h2><div class=sectionbody><div class=paragraph><p>In addition to physical disks, FreeBSD also supports the creation and use of memory disks. One possible use for a memory disk is to access the contents of an ISO file system without the overhead of first burning it to a CD or DVD, then mounting the CD/DVD media.</p></div><div class=paragraph><p>In FreeBSD, the <a href="https://man.freebsd.org/cgi/man.cgi?query=md&amp;sektion=4&amp;format=html">md(4)</a> driver is used to provide support for memory disks. The <span class=filename>GENERIC</span> kernel includes this driver. When using a custom kernel configuration file, ensure it includes this line:</p></div><div class="literalblock programlisting"><div class=content><pre>device md</pre></div></div><div class=sect2><h3 id=disks-mdconfig>17.9.1. 連接與解除連接既有的映象檔<a class=anchor href=#disks-mdconfig></a></h3><div class=paragraph><p>To mount an existing file system image, use <code>mdconfig</code> to specify the name of the ISO file and a free unit number. Then, refer to that unit number to mount it on an existing mount point. Once mounted, the files in the ISO will appear in the mount point. This example attaches <em>diskimage.iso</em> to the memory device <span class=filename>/dev/md0</span> then mounts that memory device on <span class=filename>/mnt</span>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mdconfig -f diskimage.iso -u 0</span>
<span class=c># mount -t cd9660 /dev/md0 /mnt</span></code></pre></div></div><div class=paragraph><p>Notice that <code>-t cd9660</code> was used to mount an ISO format. If a unit number is not specified with <code>-u</code>, <code>mdconfig</code> will automatically allocate an unused memory device and output the name of the allocated unit, such as <span class=filename>md4</span>. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=mdconfig&amp;sektion=8&amp;format=html">mdconfig(8)</a> for more details about this command and its options.</p></div><div class=paragraph><p>When a memory disk is no longer in use, its resources should be released back to the system. First, unmount the file system, then use <code>mdconfig</code> to detach the disk from the system and release its resources. To continue this example:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># umount /mnt</span>
<span class=c># mdconfig -d -u 0</span></code></pre></div></div><div class=paragraph><p>To determine if any memory disks are still attached to the system, type <code>mdconfig -l</code>.</p></div></div><div class=sect2><h3 id=disks-md-freebsd5>17.9.2. 建立以檔案或記憶體為基底的磁碟<a class=anchor href=#disks-md-freebsd5></a></h3><div class=paragraph><p>FreeBSD also supports memory disks where the storage to use is allocated from either a hard disk or an area of memory. The first method is commonly referred to as a file-backed file system and the second method as a memory-backed file system. Both types can be created using <code>mdconfig</code>.</p></div><div class=paragraph><p>To create a new memory-backed file system, specify a type of <code>swap</code> and the size of the memory disk to create. Then, format the memory disk with a file system and mount as usual. This example creates a 5M memory disk on unit <code>1</code>. That memory disk is then formatted with the UFS file system before it is mounted:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mdconfig -a -t swap -s 5m -u 1</span>
<span class=c># newfs -U md1</span>
/dev/md1: 5.0MB <span class=o>(</span>10240 sectors<span class=o>)</span> block size 16384, fragment size 2048
        using 4 cylinder <span class=nb>groups </span>of 1.27MB, 81 blks, 192 inodes.
        with soft updates
super-block backups <span class=o>(</span><span class=k>for </span>fsck <span class=nt>-b</span> <span class=c>#) at:</span>
 160, 2752, 5344, 7936
<span class=c># mount /dev/md1 /mnt</span>
<span class=c># df /mnt</span>
Filesystem 1K-blocks Used Avail Capacity  Mounted on
/dev/md1        4718    4  4338     0%    /mnt</code></pre></div></div><div class=paragraph><p>To create a new file-backed memory disk, first allocate an area of disk to use. This example creates an empty 5MB file named <span class=filename>newimage</span>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># dd if=/dev/zero of=newimage bs=1k count=5k</span>
5120+0 records <span class=k>in
</span>5120+0 records out</code></pre></div></div><div class=paragraph><p>Next, attach that file to a memory disk, label the memory disk and format it with the UFS file system, mount the memory disk, and verify the size of the file-backed disk:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mdconfig -f newimage -u 0</span>
<span class=c># bsdlabel -w md0 auto</span>
<span class=c># newfs -U md0a</span>
/dev/md0a: 5.0MB <span class=o>(</span>10224 sectors<span class=o>)</span> block size 16384, fragment size 2048
        using 4 cylinder <span class=nb>groups </span>of 1.25MB, 80 blks, 192 inodes.
super-block backups <span class=o>(</span><span class=k>for </span>fsck <span class=nt>-b</span> <span class=c>#) at:</span>
 160, 2720, 5280, 7840
<span class=c># mount /dev/md0a /mnt</span>
<span class=c># df /mnt</span>
Filesystem 1K-blocks Used Avail Capacity  Mounted on
/dev/md0a       4710    4  4330     0%    /mnt</code></pre></div></div><div class=paragraph><p>It takes several commands to create a file- or memory-backed file system using <code>mdconfig</code>. FreeBSD also comes with <code>mdmfs</code> which automatically configures a memory disk, formats it with the UFS file system, and mounts it. For example, after creating <em>newimage</em> with <code>dd</code>, this one command is equivalent to running the <code>bsdlabel</code>, <code>newfs</code>, and <code>mount</code> commands shown above:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mdmfs -F newimage -s 5m md0 /mnt</span></code></pre></div></div><div class=paragraph><p>To instead create a new memory-based memory disk with <code>mdmfs</code>, use this one command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mdmfs -s 5m md1 /mnt</span></code></pre></div></div><div class=paragraph><p>If the unit number is not specified, <code>mdmfs</code> will automatically select an unused memory device. For more details about <code>mdmfs</code>, refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=mdmfs&amp;sektion=8&amp;format=html">mdmfs(8)</a>.</p></div></div></div></div><div class=sect1><h2 id=snapshots>17.10. 檔案系統快照<a class=anchor href=#snapshots></a></h2><div class=sectionbody><div class=paragraph><p>FreeBSD offers a feature in conjunction with <a href=../cutting-edge/#soft-updates>Soft Updates</a>: file system snapshots.</p></div><div class=paragraph><p>UFS snapshots allow a user to create images of specified file systems, and treat them as a file. Snapshot files must be created in the file system that the action is performed on, and a user may create no more than 20 snapshots per file system. Active snapshots are recorded in the superblock so they are persistent across unmount and remount operations along with system reboots. When a snapshot is no longer required, it can be removed using <a href="https://man.freebsd.org/cgi/man.cgi?query=rm&amp;sektion=1&amp;format=html">rm(1)</a>. While snapshots may be removed in any order, all the used space may not be acquired because another snapshot will possibly claim some of the released blocks.</p></div><div class=paragraph><p>The un-alterable <code>snapshot</code> file flag is set by <a href="https://man.freebsd.org/cgi/man.cgi?query=mksnap_ffs&amp;sektion=8&amp;format=html">mksnap_ffs(8)</a> after initial creation of a snapshot file. <a href="https://man.freebsd.org/cgi/man.cgi?query=unlink&amp;sektion=1&amp;format=html">unlink(1)</a> makes an exception for snapshot files since it allows them to be removed.</p></div><div class=paragraph><p>Snapshots are created using <a href="https://man.freebsd.org/cgi/man.cgi?query=mount&amp;sektion=8&amp;format=html">mount(8)</a>. To place a snapshot of <span class=filename>/var</span> in the file <span class=filename>/var/snapshot/snap</span>, use the following command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mount -u -o snapshot /var/snapshot/snap /var</span></code></pre></div></div><div class=paragraph><p>Alternatively, use <a href="https://man.freebsd.org/cgi/man.cgi?query=mksnap_ffs&amp;sektion=8&amp;format=html">mksnap_ffs(8)</a> to create the snapshot:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mksnap_ffs /var /var/snapshot/snap</span></code></pre></div></div><div class=paragraph><p>One can find snapshot files on a file system, such as <span class=filename>/var</span>, using <a href="https://man.freebsd.org/cgi/man.cgi?query=find&amp;sektion=1&amp;format=html">find(1)</a>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># find /var -flags snapshot</span></code></pre></div></div><div class=paragraph><p>Once a snapshot has been created, it has several uses:</p></div><div class=ulist><ul><li><p>Some administrators will use a snapshot file for backup purposes, because the snapshot can be transferred to CDs or tape.</p></li><li><p>The file system integrity checker, <a href="https://man.freebsd.org/cgi/man.cgi?query=fsck&amp;sektion=8&amp;format=html">fsck(8)</a>, may be run on the snapshot. Assuming that the file system was clean when it was mounted, this should always provide a clean and unchanging result.</p></li><li><p>Running <a href="https://man.freebsd.org/cgi/man.cgi?query=dump&amp;sektion=8&amp;format=html">dump(8)</a> on the snapshot will produce a dump file that is consistent with the file system and the timestamp of the snapshot. <a href="https://man.freebsd.org/cgi/man.cgi?query=dump&amp;sektion=8&amp;format=html">dump(8)</a> can also take a snapshot, create a dump image, and then remove the snapshot in one command by using <code>-L</code>.</p></li><li><p>The snapshot can be mounted as a frozen image of the file system. To <a href="https://man.freebsd.org/cgi/man.cgi?query=mount&amp;sektion=8&amp;format=html">mount(8)</a> the snapshot <span class=filename>/var/snapshot/snap</span> run:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mdconfig -a -t vnode -o readonly -f /var/snapshot/snap -u 4</span>
<span class=c># mount -r /dev/md4 /mnt</span></code></pre></div></div></li></ul></div><div class=paragraph><p>The frozen <span class=filename>/var</span> is now available through <span class=filename>/mnt</span>. Everything will initially be in the same state it was during the snapshot creation time. The only exception is that any earlier snapshots will appear as zero length files. To unmount the snapshot, use:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># umount /mnt</span>
<span class=c># mdconfig -d -u 4</span></code></pre></div></div><div class=paragraph><p>For more information about <code>softupdates</code> and file system snapshots, including technical papers, visit Marshall Kirk McKusick’s website at <a href=http://www.mckusick.com/>http://www.mckusick.com/</a>.</p></div></div></div><div class=sect1><h2 id=quotas>17.11. 磁碟配額<a class=anchor href=#quotas></a></h2><div class=sectionbody><div class=paragraph><p>磁碟配額可以用來限制使用者或群組成員能夠在各別檔案系統上使用的磁碟空間量或檔案數量。這個可避免一個使用者或群組成員耗盡所有磁碟的可用空間。</p></div><div class=paragraph><p>本節將說明如何設定 UFS 檔案系統的磁碟配額。要在 ZFS 檔案系統上設定配額，請參考 <a href=../zfs/#zfs-zfs-quota>資料集、使用者以及群組配額</a></p></div><div class=sect2><h3 id=_開啟磁碟配額>17.11.1. 開啟磁碟配額<a class=anchor href=#_開啟磁碟配額></a></h3><div class=paragraph><p>查看 FreeBSD 核心是否支援磁碟配額：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% sysctl kern.features.ufs_quota
kern.features.ufs_quota: 1</code></pre></div></div><div class=paragraph><p>在本例中，數值 <code>1</code> 代表支援磁碟配額，若為 <code>0</code>，則需加入下列設定到自訂核心設定檔然後依照 <a href=../kernelconfig/#kernelconfig>設定 FreeBSD 核心</a> 的指示重新編譯核心：</p></div><div class="literalblock programlisting"><div class=content><pre>options QUOTA</pre></div></div><div class=paragraph><p>接著，在 <span class=filename>/etc/rc.conf</span> 開啟磁碟配額：</p></div><div class="literalblock programlisting"><div class=content><pre>quota_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>正常在開機時，會使用 <a href="https://man.freebsd.org/cgi/man.cgi?query=quotacheck&amp;sektion=8&amp;format=html">quotacheck(8)</a> 檢查每個檔案系統的配額完整性，這個程式會確保在配額資料庫中的資料正確的反映了檔案系統上的資料。這是一個耗費時間的程序，會明顯的影響系統開機的時間，要跳過這個步驟可以加入此變數到 <span class=filename>/etc/rc.conf</span>：</p></div><div class="literalblock programlisting"><div class=content><pre>check_quotas=&#34;NO&#34;</pre></div></div><div class=paragraph><p>最後，編輯 <span class=filename>/etc/fstab</span> 來開啟在各個檔案系統上的磁碟配額。要開啟在檔案系統上對每個使用者的配額要加入 <code>userquota</code> 選項到 <span class=filename>/etc/fstab</span> 要開啟配額的檔案系統的項目中。例如：</p></div><div class="literalblock programlisting"><div class=content><pre>/dev/da1s2g   /home    ufs rw,userquota 1 2</pre></div></div><div class=paragraph><p>要開啟群組配額，則使用 <code>groupquota</code>。要同時開啟使用者及群組配額，可使用逗號隔開選項：</p></div><div class="literalblock programlisting"><div class=content><pre>/dev/da1s2g    /home    ufs rw,userquota,groupquota 1 2</pre></div></div><div class=paragraph><p>預設配額檔案會儲存在檔案系統的根目錄的 <span class=filename>quota.user</span> 及 <span class=filename>quota.group</span>，請參考 <a href="https://man.freebsd.org/cgi/man.cgi?query=fstab&amp;sektion=5&amp;format=html">fstab(5)</a> 來取得更多資訊，較不建議指定其他位置來儲存配額檔案。</p></div><div class=paragraph><p>設定完成之後，重新啟動系統，<span class=filename>/etc/rc</span> 會自動執行適當的指令對所有在 <span class=filename>/etc/fstab</span> 中開啟配磁的檔案系統建立初始的配額檔。</p></div><div class=paragraph><p>在一般的操作中，並不需要手動執行 <a href="https://man.freebsd.org/cgi/man.cgi?query=quotacheck&amp;sektion=8&amp;format=html">quotacheck(8)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=quotaon&amp;sektion=8&amp;format=html">quotaon(8)</a> 或是 <a href="https://man.freebsd.org/cgi/man.cgi?query=quotaoff&amp;sektion=8&amp;format=html">quotaoff(8)</a>，雖然如此，仍應閱讀這些指令的操作手冊來熟悉這些指令的操作。</p></div></div><div class=sect2><h3 id=_設定配額限制>17.11.2. 設定配額限制<a class=anchor href=#_設定配額限制></a></h3><div class=paragraph><p>要確認配額已經開啟，可執行：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># quota -v</span></code></pre></div></div><div class=paragraph><p>每個有開啟配額的檔案系統應該會有一行磁碟用量及目前配額限制的摘要。</p></div><div class=paragraph><p>現在系統已準備好可以使用 <code>edquota</code> 分配配額限制。</p></div><div class=paragraph><p>有數個選項可以強制限制使用者或群組對磁碟空間的使用量以及可以建立多少檔案。可以用磁碟空間 (block 配額)，檔案數量 (inode 配額) 或同時使用來分配。每種限制又可進一步細分為兩個類型：硬性 (Hard) 及軟性 (Soft) 限制。</p></div><div class=paragraph><p>硬性限制無法被超額使用。一旦使用者超出了硬性限制，該使用者在該檔案系統將無法再使用任何空間。舉例來說，若一個使用者在一個檔案系統上有 500 KB 的硬性限制，且目前已經使用了 490 KB，該使用者只能再使用 10 KB 的空間，若嘗試使用 11 KB 的空間將會失敗。</p></div><div class=paragraph><p>軟性限制在有限的時間內可以被超額使用，即為寬限期 (Grace period)，預設為一週。若一個使用者超出限制並超過寬限期，則軟性限制將轉為硬性限制並且將不允許再使用空間。當使用者使用的空間回到低於軟性限制內，寬限期就會被重置。</p></div><div class=paragraph><p>在下面的例子中，會編輯 <code>test</code> 的配額。當執行 <code>edquota</code> 時，將會使用 <code>EDITOR</code> 指定的編輯器來編輯配額限制。預設的編輯器為 vi。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># edquota -u test</span>
Quotas <span class=k>for </span>user <span class=nb>test</span>:
/usr: kbytes <span class=k>in </span>use: 65, limits <span class=o>(</span>soft <span class=o>=</span> 50, hard <span class=o>=</span> 75<span class=o>)</span>
        inodes <span class=k>in </span>use: 7, limits <span class=o>(</span>soft <span class=o>=</span> 50, hard <span class=o>=</span> 60<span class=o>)</span>
/usr/var: kbytes <span class=k>in </span>use: 0, limits <span class=o>(</span>soft <span class=o>=</span> 50, hard <span class=o>=</span> 75<span class=o>)</span>
        inodes <span class=k>in </span>use: 0, limits <span class=o>(</span>soft <span class=o>=</span> 50, hard <span class=o>=</span> 60<span class=o>)</span></code></pre></div></div><div class=paragraph><p>正常每個開啟配額的檔案系統會有兩行需要設定，一行代表區塊限制 (Block limit) 而另一行代表節點限制 (inode limit)，更改行內的值來修改配額限制。舉例來說，要在 <span class=filename>/usr</span> 提高區塊的軟性限制到 <code>500</code> 以及硬性限制到 <code>600</code>，可更改行內的值如下：</p></div><div class="literalblock programlisting"><div class=content><pre>/usr: kbytes in use: 65, limits (soft = 500, hard = 600)</pre></div></div><div class=paragraph><p>新的配額限制將在離開編輯器後生效。</p></div><div class=paragraph><p>有時會想要針對一群使用者設定配額限，這時可以透過指定想要的配額給第一個使用者，若然後使用 <code>-p</code> 來複製配額到指定範圍的使用者 ID (UID)。以下指定將複製配額限制給 UID <code>10,000</code> 到 <code>19,999</code> 的使用者：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># edquota -p test 10000-19999</span></code></pre></div></div><div class=paragraph><p>要取得更多資訊，請參考 <a href="https://man.freebsd.org/cgi/man.cgi?query=edquota&amp;sektion=8&amp;format=html">edquota(8)</a>。</p></div></div><div class=sect2><h3 id=_檢查配額限制與磁碟使用狀況>17.11.3. 檢查配額限制與磁碟使用狀況<a class=anchor href=#_檢查配額限制與磁碟使用狀況></a></h3><div class=paragraph><p>要檢查各別使用者或群組的配額與磁碟用量可使用 <a href="https://man.freebsd.org/cgi/man.cgi?query=quota&amp;sektion=1&amp;format=html">quota(1)</a>。使用者僅可查看自己的配額以及所屬群組的配額，只有使超級使用者可以檢視所有使用者及群組的配額。要取得某個有開啟配額的檔案系統的所有配額及磁碟用量摘要，可使用 <a href="https://man.freebsd.org/cgi/man.cgi?query=repquota&amp;sektion=8&amp;format=html">repquota(8)</a>。</p></div><div class=paragraph><p>正常情況，使用者未使用任何磁碟空間的檔案系統並不會顯示在 <code>quota</code> 的輸出結果中，即使該使用者有在該檔案系統設定配額限制，使用 <code>-v</code> 可以顯示這些檔案系統。以下是使用使用 <code>quota -v</code> 查詢某個使用者在兩個檔案系統上的配額限制的範例輸出。</p></div><div class="literalblock programlisting"><div class=content><pre>Disk quotas for user test (uid 1002):
     Filesystem  usage    quota   limit   grace   files   quota   limit   grace
           /usr      65*     50      75   5days       7      50      60
       /usr/var       0      50      75               0      50      60</pre></div></div><div class=paragraph><p>在這個例子當中，使用者在 <span class=filename>/usr</span> 的軟性限制 50 KB 已經超出了 15 KB 並已經過了 5 天寬限期。星號 <code>*</code> 代表該使用者目前已超出配額限制。</p></div></div><div class=sect2><h3 id=_nfs_上的配額>17.11.4. NFS 上的配額<a class=anchor href=#_nfs_上的配額></a></h3><div class=paragraph><p>在 NFS 伺服器上，配額會由配額子系統強制執行，<a href="https://man.freebsd.org/cgi/man.cgi?query=rpc.rquotad&amp;sektion=8&amp;format=html">rpc.rquotad(8)</a> Daemon 會提供配額資訊給 NFS 客戶端的 <code>quota</code>，讓在那些主機的使用者可以查看它們的配額統計資訊。</p></div><div class=paragraph><p>在 NFS 伺服器上將 <span class=filename>/etc/inetd.conf</span> 中 <code>rpc.rquotad</code> 行前的 <code>#</code> 移除來開啟：</p></div><div class="literalblock programlisting"><div class=content><pre>rquotad/1      dgram rpc/udp wait root /usr/libexec/rpc.rquotad rpc.rquotad</pre></div></div><div class=paragraph><p>然後重新啟動 <code>inetd</code>：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service inetd restart</span></code></pre></div></div></div></div></div><div class=sect1><h2 id=disks-encrypting>17.12. 磁碟分割區加密<a class=anchor href=#disks-encrypting></a></h2><div class=sectionbody><div class=paragraph><p>FreeBSD offers excellent online protections against unauthorized data access. File permissions and <a href=../mac/#mac>Mandatory Access Control</a> (MAC) help prevent unauthorized users from accessing data while the operating system is active and the computer is powered up. However, the permissions enforced by the operating system are irrelevant if an attacker has physical access to a computer and can move the computer’s hard drive to another system to copy and analyze the data.</p></div><div class=paragraph><p>Regardless of how an attacker may have come into possession of a hard drive or powered-down computer, the GEOM-based cryptographic subsystems built into FreeBSD are able to protect the data on the computer’s file systems against even highly-motivated attackers with significant resources. Unlike encryption methods that encrypt individual files, the built-in <code>gbde</code> and <code>geli</code> utilities can be used to transparently encrypt entire file systems. No cleartext ever touches the hard drive’s platter.</p></div><div class=paragraph><p>This chapter demonstrates how to create an encrypted file system on FreeBSD. It first demonstrates the process using <code>gbde</code> and then demonstrates the same example using <code>geli</code>.</p></div><div class=sect2><h3 id=_使用_gbde_做磁碟加密>17.12.1. 使用 gbde 做磁碟加密<a class=anchor href=#_使用_gbde_做磁碟加密></a></h3><div class=paragraph><p>The objective of the <a href="https://man.freebsd.org/cgi/man.cgi?query=gbde&amp;sektion=4&amp;format=html">gbde(4)</a> facility is to provide a formidable challenge for an attacker to gain access to the contents of a <em>cold</em> storage device. However, if the computer is compromised while up and running and the storage device is actively attached, or the attacker has access to a valid passphrase, it offers no protection to the contents of the storage device. Thus, it is important to provide physical security while the system is running and to protect the passphrase used by the encryption mechanism.</p></div><div class=paragraph><p>This facility provides several barriers to protect the data stored in each disk sector. It encrypts the contents of a disk sector using 128-bit AES in CBC mode. Each sector on the disk is encrypted with a different AES key. For more information on the cryptographic design, including how the sector keys are derived from the user-supplied passphrase, refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=gbde&amp;sektion=4&amp;format=html">gbde(4)</a>.</p></div><div class=paragraph><p>FreeBSD provides a kernel module for gbde which can be loaded with this command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># kldload geom_bde</span></code></pre></div></div><div class=paragraph><p>If using a custom kernel configuration file, ensure it contains this line:</p></div><div class=paragraph><p><code>options GEOM_BDE</code></p></div><div class=paragraph><p>The following example demonstrates adding a new hard drive to a system that will hold a single encrypted partition that will be mounted as <span class=filename>/private</span>.</p></div><div class="exampleblock procedure"><div class=content><div class=paragraph><p><strong>Procedure: Encrypting a Partition with gbde</strong></p></div><div class="olist arabic"><ol class=arabic><li><p>Add the New Hard Drive</p><div class=paragraph><p>Install the new drive to the system as explained in <a href=#disks-adding>加入磁碟</a>. For the purposes of this example, a new hard drive partition has been added as <span class=filename>/dev/ad4s1c</span> and <span class=filename>/dev/ad0s1*</span> represents the existing standard FreeBSD partitions.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ls /dev/ad*</span>
/dev/ad0        /dev/ad0s1b     /dev/ad0s1e     /dev/ad4s1
/dev/ad0s1      /dev/ad0s1c     /dev/ad0s1f     /dev/ad4s1c
/dev/ad0s1a     /dev/ad0s1d     /dev/ad4</code></pre></div></div></li><li><p>Create a Directory to Hold <code>gbde</code> Lock Files</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mkdir /etc/gbde</span></code></pre></div></div><div class=paragraph><p>The gbde lock file contains information that gbde requires to access encrypted partitions. Without access to the lock file, gbde will not be able to decrypt the data contained in the encrypted partition without significant manual intervention which is not supported by the software. Each encrypted partition uses a separate lock file.</p></div></li><li><p>Initialize the <code>gbde</code> Partition</p><div class=paragraph><p>A gbde partition must be initialized before it can be used. This initialization needs to be performed only once. This command will open the default editor, in order to set various configuration options in a template. For use with the UFS file system, set the sector_size to 2048:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># gbde init /dev/ad4s1c -i -L /etc/gbde/ad4s1c.lock</span>
<span class=c># $FreeBSD: head/zh_TW.UTF-8/books/handbook/book.xml 53653 2019-12-03 17:05:41Z rcyu $</span></code></pre></div></div><div class=paragraph><p>Once the edit is saved, the user will be asked twice to type the passphrase used to secure the data. The passphrase must be the same both times. The ability of gbde to protect data depends entirely on the quality of the passphrase. For tips on how to select a secure passphrase that is easy to remember, see <a href=http://world.std.com/~reinhold/diceware.html>http://world.std.com/~reinhold/diceware.htm</a>.</p></div><div class=paragraph><p>This initialization creates a lock file for the gbde partition. In this example, it is stored as <span class=filename>/etc/gbde/ad4s1c.lock</span>. Lock files must end in ".lock" in order to be correctly detected by the <span class=filename>/etc/rc.d/gbde</span> start up script.</p></div><div class="admonitionblock caution"><table><tbody><tr><td class=icon><i class="fa icon-caution" title=Caution></i></td><td class=content><div class=paragraph><p>Lock files <em>must</em> be backed up together with the contents of any encrypted partitions. Without the lock file, the legitimate owner will be unable to access the data on the encrypted partition.</p></div></td></tr></tbody></table></div></li><li><p>Attach the Encrypted Partition to the Kernel</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># gbde attach /dev/ad4s1c -l /etc/gbde/ad4s1c.lock</span></code></pre></div></div><div class=paragraph><p>This command will prompt to input the passphrase that was selected during the initialization of the encrypted partition. The new encrypted device will appear in <span class=filename>/dev</span> as <span class=filename>/dev/device_name.bde</span>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ls /dev/ad*</span>
/dev/ad0        /dev/ad0s1b     /dev/ad0s1e     /dev/ad4s1
/dev/ad0s1      /dev/ad0s1c     /dev/ad0s1f     /dev/ad4s1c
/dev/ad0s1a     /dev/ad0s1d     /dev/ad4        /dev/ad4s1c.bde</code></pre></div></div></li><li><p>Create a File System on the Encrypted Device</p><div class=paragraph><p>Once the encrypted device has been attached to the kernel, a file system can be created on the device. This example creates a UFS file system with soft updates enabled. Be sure to specify the partition which has a <span class=filename>*.bde</span> extension:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># newfs -U /dev/ad4s1c.bde</span></code></pre></div></div></li><li><p>Mount the Encrypted Partition</p><div class=paragraph><p>Create a mount point and mount the encrypted file system:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mkdir /private</span>
<span class=c># mount /dev/ad4s1c.bde /private</span></code></pre></div></div></li><li><p>Verify That the Encrypted File System is Available</p><div class=paragraph><p>The encrypted file system should now be visible and available for use:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% <span class=nb>df</span> <span class=nt>-H</span>
Filesystem        Size   Used  Avail Capacity  Mounted on
/dev/ad0s1a      1037M    72M   883M     8%    /
/devfs            1.0K   1.0K     0B   100%    /dev
/dev/ad0s1f       8.1G    55K   7.5G     0%    /home
/dev/ad0s1e      1037M   1.1M   953M     0%    /tmp
/dev/ad0s1d       6.1G   1.9G   3.7G    35%    /usr
/dev/ad4s1c.bde   150G   4.1K   138G     0%    /private</code></pre></div></div></li></ol></div></div></div><div class=paragraph><p>After each boot, any encrypted file systems must be manually re-attached to the kernel, checked for errors, and mounted, before the file systems can be used. To configure these steps, add the following lines to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>gbde_autoattach_all=&#34;YES&#34;
gbde_devices=&#34;ad4s1c&#34;
gbde_lockdir=&#34;/etc/gbde&#34;</pre></div></div><div class=paragraph><p>This requires that the passphrase be entered at the console at boot time. After typing the correct passphrase, the encrypted partition will be mounted automatically. Additional gbde boot options are available and listed in <a href="https://man.freebsd.org/cgi/man.cgi?query=rc.conf&amp;sektion=5&amp;format=html">rc.conf(5)</a>.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>sysinstall is incompatible with gbde-encrypted devices. All <span class=filename>*.bde</span> devices must be detached from the kernel before starting sysinstall or it will crash during its initial probing for devices. To detach the encrypted device used in the example, use the following command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># gbde detach /dev/ad4s1c</span></code></pre></div></div></td></tr></tbody></table></div></div><div class=sect2><h3 id=disks-encrypting-geli>17.12.2. 使用 <code>geli</code> 做磁碟加密<a class=anchor href=#disks-encrypting-geli></a></h3><div class=paragraph><p>An alternative cryptographic GEOM class is available using <code>geli</code>. This control utility adds some features and uses a different scheme for doing cryptographic work. It provides the following features:</p></div><div class=ulist><ul><li><p>Utilizes the <a href="https://man.freebsd.org/cgi/man.cgi?query=crypto&amp;sektion=9&amp;format=html">crypto(9)</a> framework and automatically uses cryptographic hardware when it is available.</p></li><li><p>Supports multiple cryptographic algorithms such as AES, Blowfish, and 3DES.</p></li><li><p>Allows the root partition to be encrypted. The passphrase used to access the encrypted root partition will be requested during system boot.</p></li><li><p>Allows the use of two independent keys.</p></li><li><p>It is fast as it performs simple sector-to-sector encryption.</p></li><li><p>Allows backup and restore of master keys. If a user destroys their keys, it is still possible to get access to the data by restoring keys from the backup.</p></li><li><p>Allows a disk to attach with a random, one-time key which is useful for swap partitions and temporary file systems.</p></li></ul></div><div class=paragraph><p>More features and usage examples can be found in <a href="https://man.freebsd.org/cgi/man.cgi?query=geli&amp;sektion=8&amp;format=html">geli(8)</a>.</p></div><div class=paragraph><p>The following example describes how to generate a key file which will be used as part of the master key for the encrypted provider mounted under <span class=filename>/private</span>. The key file will provide some random data used to encrypt the master key. The master key will also be protected by a passphrase. The provider’s sector size will be 4kB. The example describes how to attach to the <code>geli</code> provider, create a file system on it, mount it, work with it, and finally, how to detach it.</p></div><div class="exampleblock procedure"><div class=content><div class=paragraph><p><strong>Procedure: Encrypting a Partition with <code>geli</code></strong></p></div><div class="olist arabic"><ol class=arabic><li><p>Load <code>geli</code> Support</p><div class=paragraph><p>Support for <code>geli</code> is available as a loadable kernel module. To configure the system to automatically load the module at boot time, add the following line to <span class=filename>/boot/loader.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>geom_eli_load=&#34;YES&#34;</pre></div></div><div class=paragraph><p>To load the kernel module now:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># kldload geom_eli</span></code></pre></div></div><div class=paragraph><p>For a custom kernel, ensure the kernel configuration file contains these lines:</p></div><div class="literalblock programlisting"><div class=content><pre>options GEOM_ELI
device crypto</pre></div></div></li><li><p>Generate the Master Key</p><div class=paragraph><p>The following commands generate a master key (<span class=filename>/root/da2.key</span>) that is protected with a passphrase. The data source for the key file is <span class=filename>/dev/random</span> and the sector size of the provider (<span class=filename>/dev/da2.eli</span>) is 4kB as a bigger sector size provides better performance:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># dd if=/dev/random of=/root/da2.key bs=64 count=1</span>
<span class=c># geli init -s 4096 -K /root/da2.key /dev/da2</span>
Enter new passphrase:
Reenter new passphrase:</code></pre></div></div><div class=paragraph><p>It is not mandatory to use both a passphrase and a key file as either method of securing the master key can be used in isolation.</p></div><div class=paragraph><p>If the key file is given as "-", standard input will be used. For example, this command generates three key files:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cat keyfile1 keyfile2 keyfile3 | geli init -K - /dev/da2</span></code></pre></div></div></li><li><p>Attach the Provider with the Generated Key</p><div class=paragraph><p>To attach the provider, specify the key file, the name of the disk, and the passphrase:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># geli attach -k /root/da2.key /dev/da2</span>
Enter passphrase:</code></pre></div></div><div class=paragraph><p>This creates a new device with an <span class=filename>.eli</span> extension:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ls /dev/da2*</span>
/dev/da2  /dev/da2.eli</code></pre></div></div></li><li><p>Create the New File System</p><div class=paragraph><p>Next, format the device with the UFS file system and mount it on an existing mount point:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># dd if=/dev/random of=/dev/da2.eli bs=1m</span>
<span class=c># newfs /dev/da2.eli</span>
<span class=c># mount /dev/da2.eli /private</span></code></pre></div></div><div class=paragraph><p>The encrypted file system should now be available for use:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># df -H</span>
Filesystem     Size   Used  Avail Capacity  Mounted on
/dev/ad0s1a    248M    89M   139M    38%    /
/devfs         1.0K   1.0K     0B   100%    /dev
/dev/ad0s1f    7.7G   2.3G   4.9G    32%    /usr
/dev/ad0s1d    989M   1.5M   909M     0%    /tmp
/dev/ad0s1e    3.9G   1.3G   2.3G    35%    /var
/dev/da2.eli   150G   4.1K   138G     0%    /private</code></pre></div></div></li></ol></div></div></div><div class=paragraph><p>Once the work on the encrypted partition is done, and the <span class=filename>/private</span> partition is no longer needed, it is prudent to put the device into cold storage by unmounting and detaching the <code>geli</code> encrypted partition from the kernel:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># umount /private</span>
<span class=c># geli detach da2.eli</span></code></pre></div></div><div class=paragraph><p>A <span class=filename>rc.d</span> script is provided to simplify the mounting of <code>geli</code>-encrypted devices at boot time. For this example, add these lines to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>geli_devices=&#34;da2&#34;
geli_da2_flags=&#34;-k /root/da2.key&#34;</pre></div></div><div class=paragraph><p>This configures <span class=filename>/dev/da2</span> as a <code>geli</code> provider with a master key of <span class=filename>/root/da2.key</span>. The system will automatically detach the provider from the kernel before the system shuts down. During the startup process, the script will prompt for the passphrase before attaching the provider. Other kernel messages might be shown before and after the password prompt. If the boot process seems to stall, look carefully for the password prompt among the other messages. Once the correct passphrase is entered, the provider is attached. The file system is then mounted, typically by an entry in <span class=filename>/etc/fstab</span>. Refer to <a href=../basics/#mount-unmount>掛載與卸載檔案系統</a> for instructions on how to configure a file system to mount at boot time.</p></div></div></div></div><div class=sect1><h2 id=swap-encrypting>17.13. 交換空間加密<a class=anchor href=#swap-encrypting></a></h2><div class=sectionbody><div class=paragraph><p>Like the encryption of disk partitions, encryption of swap space is used to protect sensitive information. Consider an application that deals with passwords. As long as these passwords stay in physical memory, they are not written to disk and will be cleared after a reboot. However, if FreeBSD starts swapping out memory pages to free space, the passwords may be written to the disk unencrypted. Encrypting swap space can be a solution for this scenario.</p></div><div class=paragraph><p>This section demonstrates how to configure an encrypted swap partition using <a href="https://man.freebsd.org/cgi/man.cgi?query=gbde&amp;sektion=8&amp;format=html">gbde(8)</a> or <a href="https://man.freebsd.org/cgi/man.cgi?query=geli&amp;sektion=8&amp;format=html">geli(8)</a> encryption. It assumes that <span class=filename>/dev/ada0s1b</span> is the swap partition.</p></div><div class=sect2><h3 id=_設定已加密的交換空間>17.13.1. 設定已加密的交換空間<a class=anchor href=#_設定已加密的交換空間></a></h3><div class=paragraph><p>Swap partitions are not encrypted by default and should be cleared of any sensitive data before continuing. To overwrite the current swap partition with random garbage, execute the following command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># dd if=/dev/random of=/dev/ada0s1b bs=1m</span></code></pre></div></div><div class=paragraph><p>To encrypt the swap partition using <a href="https://man.freebsd.org/cgi/man.cgi?query=gbde&amp;sektion=8&amp;format=html">gbde(8)</a>, add the <code>.bde</code> suffix to the swap line in <span class=filename>/etc/fstab</span>:</p></div><div class="literalblock programlisting"><div class=content><pre># Device		Mountpoint	FStype	Options		Dump	Pass#
/dev/ada0s1b.bde	none		swap	sw		0	0</pre></div></div><div class=paragraph><p>To instead encrypt the swap partition using <a href="https://man.freebsd.org/cgi/man.cgi?query=geli&amp;sektion=8&amp;format=html">geli(8)</a>, use the <code>.eli</code> suffix:</p></div><div class="literalblock programlisting"><div class=content><pre># Device		Mountpoint	FStype	Options		Dump	Pass#
/dev/ada0s1b.eli	none		swap	sw		0	0</pre></div></div><div class=paragraph><p>By default, <a href="https://man.freebsd.org/cgi/man.cgi?query=geli&amp;sektion=8&amp;format=html">geli(8)</a> uses the AES algorithm with a key length of 128 bits. Normally the default settings will suffice. If desired, these defaults can be altered in the options field in <span class=filename>/etc/fstab</span>. The possible flags are:</p></div><div class=dlist><dl><dt class=hdlist1>aalgo</dt><dd><p>Data integrity verification algorithm used to ensure that the encrypted data has not been tampered with. See <a href="https://man.freebsd.org/cgi/man.cgi?query=geli&amp;sektion=8&amp;format=html">geli(8)</a> for a list of supported algorithms.</p></dd><dt class=hdlist1>ealgo</dt><dd><p>Encryption algorithm used to protect the data. See <a href="https://man.freebsd.org/cgi/man.cgi?query=geli&amp;sektion=8&amp;format=html">geli(8)</a> for a list of supported algorithms.</p></dd><dt class=hdlist1>keylen</dt><dd><p>The length of the key used for the encryption algorithm. See <a href="https://man.freebsd.org/cgi/man.cgi?query=geli&amp;sektion=8&amp;format=html">geli(8)</a> for the key lengths that are supported by each encryption algorithm.</p></dd><dt class=hdlist1>sectorsize</dt><dd><p>The size of the blocks data is broken into before it is encrypted. Larger sector sizes increase performance at the cost of higher storage overhead. The recommended size is 4096 bytes.</p></dd></dl></div><div class=paragraph><p>This example configures an encrypted swap partition using the Blowfish algorithm with a key length of 128 bits and a sectorsize of 4 kilobytes:</p></div><div class="literalblock programlisting"><div class=content><pre># Device		Mountpoint	FStype	Options				Dump	Pass#
/dev/ada0s1b.eli	none		swap	sw,ealgo=blowfish,keylen=128,sectorsize=4096	0	0</pre></div></div></div><div class=sect2><h3 id=_加密的交換空間檢驗>17.13.2. 加密的交換空間檢驗<a class=anchor href=#_加密的交換空間檢驗></a></h3><div class=paragraph><p>Once the system has rebooted, proper operation of the encrypted swap can be verified using <code>swapinfo</code>.</p></div><div class=paragraph><p>If <a href="https://man.freebsd.org/cgi/man.cgi?query=gbde&amp;sektion=8&amp;format=html">gbde(8)</a> is being used:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% swapinfo
Device          1K-blocks     Used    Avail Capacity
/dev/ada0s1b.bde   542720        0   542720     0%</code></pre></div></div><div class=paragraph><p>If <a href="https://man.freebsd.org/cgi/man.cgi?query=geli&amp;sektion=8&amp;format=html">geli(8)</a> is being used:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% swapinfo
Device          1K-blocks     Used    Avail Capacity
/dev/ada0s1b.eli   542720        0   542720     0%</code></pre></div></div></div></div></div><div class=sect1><h2 id=disks-hast>17.14. 高可用存儲空間 (HAST)<a class=anchor href=#disks-hast></a></h2><div class=sectionbody><div class=paragraph><p>High availability is one of the main requirements in serious business applications and highly-available storage is a key component in such environments. In FreeBSD, the Highly Available STorage (HAST) framework allows transparent storage of the same data across several physically separated machines connected by a TCP/IP network. HAST can be understood as a network-based RAID1 (mirror), and is similar to the DRBD® storage system used in the GNU/Linux™ platform. In combination with other high-availability features of FreeBSD like CARP, HAST makes it possible to build a highly-available storage cluster that is resistant to hardware failures.</p></div><div class=paragraph><p>The following are the main features of HAST:</p></div><div class=ulist><ul><li><p>Can be used to mask I/O errors on local hard drives.</p></li><li><p>File system agnostic as it works with any file system supported by FreeBSD.</p></li><li><p>Efficient and quick resynchronization as only the blocks that were modified during the downtime of a node are synchronized.</p></li><li><p>Can be used in an already deployed environment to add additional redundancy.</p></li><li><p>Together with CARP, Heartbeat, or other tools, it can be used to build a robust and durable storage system.</p></li></ul></div><div class=paragraph><p>After reading this section, you will know:</p></div><div class=ulist><ul><li><p>What HAST is, how it works, and which features it provides.</p></li><li><p>How to set up and use HAST on FreeBSD.</p></li><li><p>How to integrate CARP and <a href="https://man.freebsd.org/cgi/man.cgi?query=devd&amp;sektion=8&amp;format=html">devd(8)</a> to build a robust storage system.</p></li></ul></div><div class=paragraph><p>Before reading this section, you should:</p></div><div class=ulist><ul><li><p>了解 UNIX™ 及 FreeBSD 基礎 (<a href=../basics/#basics>FreeBSD 基礎</a>)。</p></li><li><p>Know how to configure network interfaces and other core FreeBSD subsystems (<a href=../config/#config-tuning>設定與調校</a>).</p></li><li><p>Have a good understanding of FreeBSD networking (<a href=../partiv/#network-communication>網路通訊</a>).</p></li></ul></div><div class=paragraph><p>The HAST project was sponsored by The FreeBSD Foundation with support from <a href=http://www.omc.net/>http://www.omc.net/</a> and <a href=http://www.transip.nl/>http://www.transip.nl/</a>.</p></div><div class=sect2><h3 id=_hast_運作模式>17.14.1. HAST 運作模式<a class=anchor href=#_hast_運作模式></a></h3><div class=paragraph><p>HAST provides synchronous block-level replication between two physical machines: the <em>primary</em>, also known as the <em>master</em> node, and the <em>secondary</em>, or <em>slave</em> node. These two machines together are referred to as a cluster.</p></div><div class=paragraph><p>Since HAST works in a primary-secondary configuration, it allows only one of the cluster nodes to be active at any given time. The primary node, also called <em>active</em>, is the one which will handle all the I/O requests to HAST-managed devices. The secondary node is automatically synchronized from the primary node.</p></div><div class=paragraph><p>The physical components of the HAST system are the local disk on primary node, and the disk on the remote, secondary node.</p></div><div class=paragraph><p>HAST operates synchronously on a block level, making it transparent to file systems and applications. HAST provides regular GEOM providers in <span class=filename>/dev/hast/</span> for use by other tools or applications. There is no difference between using HAST-provided devices and raw disks or partitions.</p></div><div class=paragraph><p>Each write, delete, or flush operation is sent to both the local disk and to the remote disk over TCP/IP. Each read operation is served from the local disk, unless the local disk is not up-to-date or an I/O error occurs. In such cases, the read operation is sent to the secondary node.</p></div><div class=paragraph><p>HAST tries to provide fast failure recovery. For this reason, it is important to reduce synchronization time after a node’s outage. To provide fast synchronization, HAST manages an on-disk bitmap of dirty extents and only synchronizes those during a regular synchronization, with an exception of the initial sync.</p></div><div class=paragraph><p>There are many ways to handle synchronization. HAST implements several replication modes to handle different synchronization methods:</p></div><div class=ulist><ul><li><p><em>memsync</em>: This mode reports a write operation as completed when the local write operation is finished and when the remote node acknowledges data arrival, but before actually storing the data. The data on the remote node will be stored directly after sending the acknowledgement. This mode is intended to reduce latency, but still provides good reliability. This mode is the default.</p></li><li><p><em>fullsync</em>: This mode reports a write operation as completed when both the local write and the remote write complete. This is the safest and the slowest replication mode.</p></li><li><p><em>async</em>: This mode reports a write operation as completed when the local write completes. This is the fastest and the most dangerous replication mode. It should only be used when replicating to a distant node where latency is too high for other modes.</p></li></ul></div></div><div class=sect2><h3 id=_hast_設定>17.14.2. HAST 設定<a class=anchor href=#_hast_設定></a></h3><div class=paragraph><p>The HAST framework consists of several components:</p></div><div class=ulist><ul><li><p>The <a href="https://man.freebsd.org/cgi/man.cgi?query=hastd&amp;sektion=8&amp;format=html">hastd(8)</a> daemon which provides data synchronization. When this daemon is started, it will automatically load <code>geom_gate.ko</code>.</p></li><li><p>The userland management utility, <a href="https://man.freebsd.org/cgi/man.cgi?query=hastctl&amp;sektion=8&amp;format=html">hastctl(8)</a>.</p></li><li><p>The <a href="https://man.freebsd.org/cgi/man.cgi?query=hast.conf&amp;sektion=5&amp;format=html">hast.conf(5)</a> configuration file. This file must exist before starting hastd.</p></li></ul></div><div class=paragraph><p>Users who prefer to statically build <code>GEOM_GATE</code> support into the kernel should add this line to the custom kernel configuration file, then rebuild the kernel using the instructions in <a href=../kernelconfig/#kernelconfig>設定 FreeBSD 核心</a>:</p></div><div class="literalblock programlisting"><div class=content><pre>options	GEOM_GATE</pre></div></div><div class=paragraph><p>The following example describes how to configure two nodes in master-slave/primary-secondary operation using HAST to replicate the data between the two. The nodes will be called <code>hasta</code>, with an IP address of <code>172.16.0.1</code>, and <code>hastb</code>, with an IP address of <code>172.16.0.2</code>. Both nodes will have a dedicated hard drive <span class=filename>/dev/ad6</span> of the same size for HAST operation. The HAST pool, sometimes referred to as a resource or the GEOM provider in <span class=filename>/dev/hast/</span>, will be called <code>test</code>.</p></div><div class=paragraph><p>Configuration of HAST is done using <span class=filename>/etc/hast.conf</span>. This file should be identical on both nodes. The simplest configuration is:</p></div><div class="literalblock programlisting"><div class=content><pre>resource test {
	on hasta {
		local /dev/ad6
		remote 172.16.0.2
	}
	on hastb {
		local /dev/ad6
		remote 172.16.0.1
	}
}</pre></div></div><div class=paragraph><p>For more advanced configuration, refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=hast.conf&amp;sektion=5&amp;format=html">hast.conf(5)</a>.</p></div><div class="admonitionblock tip"><table><tbody><tr><td class=icon><i class="fa icon-tip" title=Tip></i></td><td class=content><div class=paragraph><p>It is also possible to use host names in the <code>remote</code> statements if the hosts are resolvable and defined either in <span class=filename>/etc/hosts</span> or in the local DNS.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Once the configuration exists on both nodes, the HAST pool can be created. Run these commands on both nodes to place the initial metadata onto the local disk and to start <a href="https://man.freebsd.org/cgi/man.cgi?query=hastd&amp;sektion=8&amp;format=html">hastd(8)</a>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># hastctl create test</span>
<span class=c># service hastd onestart</span></code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>It is <em>not</em> possible to use GEOM providers with an existing file system or to convert an existing storage to a HAST-managed pool. This procedure needs to store some metadata on the provider and there will not be enough required space available on an existing provider.</p></div></td></tr></tbody></table></div><div class=paragraph><p>A HAST node’s <code>primary</code> or <code>secondary</code> role is selected by an administrator, or software like Heartbeat, using <a href="https://man.freebsd.org/cgi/man.cgi?query=hastctl&amp;sektion=8&amp;format=html">hastctl(8)</a>. On the primary node, <code>hasta</code>, issue this command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># hastctl role primary test</span></code></pre></div></div><div class=paragraph><p>Run this command on the secondary node, <code>hastb</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># hastctl role secondary test</span></code></pre></div></div><div class=paragraph><p>Verify the result by running <code>hastctl</code> on each node:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># hastctl status test</span></code></pre></div></div><div class=paragraph><p>Check the <code>status</code> line in the output. If it says <code>degraded</code>, something is wrong with the configuration file. It should say <code>complete</code> on each node, meaning that the synchronization between the nodes has started. The synchronization completes when <code>hastctl status</code> reports 0 bytes of <code>dirty</code> extents.</p></div><div class=paragraph><p>The next step is to create a file system on the GEOM provider and mount it. This must be done on the <code>primary</code> node. Creating the file system can take a few minutes, depending on the size of the hard drive. This example creates a UFS file system on <span class=filename>/dev/hast/test</span>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># newfs -U /dev/hast/test</span>
<span class=c># mkdir /hast/test</span>
<span class=c># mount /dev/hast/test /hast/test</span></code></pre></div></div><div class=paragraph><p>Once the HAST framework is configured properly, the final step is to make sure that HAST is started automatically during system boot. Add this line to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>hastd_enable=&#34;YES&#34;</pre></div></div><div class=sect3><h4 id=_容錯移轉設定>17.14.2.1. 容錯移轉設定<a class=anchor href=#_容錯移轉設定></a></h4><div class=paragraph><p>The goal of this example is to build a robust storage system which is resistant to the failure of any given node. If the primary node fails, the secondary node is there to take over seamlessly, check and mount the file system, and continue to work without missing a single bit of data.</p></div><div class=paragraph><p>To accomplish this task, the Common Address Redundancy Protocol (CARP) is used to provide for automatic failover at the IP layer. CARP allows multiple hosts on the same network segment to share an IP address. Set up CARP on both nodes of the cluster according to the documentation available in <a href=../advanced-networking/#carp>共用位址備援協定 (CARP)</a>. In this example, each node will have its own management IP address and a shared IP address of <em>172.16.0.254</em>. The primary HAST node of the cluster must be the master CARP node.</p></div><div class=paragraph><p>The HAST pool created in the previous section is now ready to be exported to the other hosts on the network. This can be accomplished by exporting it through NFS or Samba, using the shared IP address <em>172.16.0.254</em>. The only problem which remains unresolved is an automatic failover should the primary node fail.</p></div><div class=paragraph><p>In the event of CARP interfaces going up or down, the FreeBSD operating system generates a <a href="https://man.freebsd.org/cgi/man.cgi?query=devd&amp;sektion=8&amp;format=html">devd(8)</a> event, making it possible to watch for state changes on the CARP interfaces. A state change on the CARP interface is an indication that one of the nodes failed or came back online. These state change events make it possible to run a script which will automatically handle the HAST failover.</p></div><div class=paragraph><p>To catch state changes on the CARP interfaces, add this configuration to <span class=filename>/etc/devd.conf</span> on each node:</p></div><div class="literalblock programlisting"><div class=content><pre>notify 30 {
	match &#34;system&#34; &#34;IFNET&#34;;
	match &#34;subsystem&#34; &#34;carp0&#34;;
	match &#34;type&#34; &#34;LINK_UP&#34;;
	action &#34;/usr/local/sbin/carp-hast-switch master&#34;;
};

notify 30 {
	match &#34;system&#34; &#34;IFNET&#34;;
	match &#34;subsystem&#34; &#34;carp0&#34;;
	match &#34;type&#34; &#34;LINK_DOWN&#34;;
	action &#34;/usr/local/sbin/carp-hast-switch slave&#34;;
};</pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>If the systems are running FreeBSD 10 or higher, replace <span class=filename>carp0</span> with the name of the CARP-configured interface.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Restart <a href="https://man.freebsd.org/cgi/man.cgi?query=devd&amp;sektion=8&amp;format=html">devd(8)</a> on both nodes to put the new configuration into effect:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service devd restart</span></code></pre></div></div><div class=paragraph><p>When the specified interface state changes by going up or down , the system generates a notification, allowing the <a href="https://man.freebsd.org/cgi/man.cgi?query=devd&amp;sektion=8&amp;format=html">devd(8)</a> subsystem to run the specified automatic failover script, <span class=filename>/usr/local/sbin/carp-hast-switch</span>. For further clarification about this configuration, refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=devd.conf&amp;sektion=5&amp;format=html">devd.conf(5)</a>.</p></div><div class=paragraph><p>Here is an example of an automated failover script:</p></div><div class="literalblock programlisting"><div class=content><pre>#!/bin/sh

# Original script by Freddie Cash &lt;fjwcash@gmail.com&gt;
# Modified by Michael W. Lucas &lt;mwlucas@BlackHelicopters.org&gt;
# and Viktor Petersson &lt;vpetersson@wireload.net&gt;

# The names of the HAST resources, as listed in /etc/hast.conf
resources=&#34;test&#34;

# delay in mounting HAST resource after becoming master
# make your best guess
delay=3

# logging
log=&#34;local0.debug&#34;
name=&#34;carp-hast&#34;

# end of user configurable stuff

case &#34;$1&#34; in
	master)
		logger -p $log -t $name &#34;Switching to primary provider for ${resources}.&#34;
		sleep ${delay}

		# Wait for any &#34;hastd secondary&#34; processes to stop
		for disk in ${resources}; do
			while $( pgrep -lf &#34;hastd: ${disk} \(secondary\)&#34; &gt; /dev/null 2&gt;&amp;1 ); do
				sleep 1
			done

			# Switch role for each disk
			hastctl role primary ${disk}
			if [ $? -ne 0 ]; then
				logger -p $log -t $name &#34;Unable to change role to primary for resource ${disk}.&#34;
				exit 1
			fi
		done

		# Wait for the /dev/hast/* devices to appear
		for disk in ${resources}; do
			for I in $( jot 60 ); do
				[ -c &#34;/dev/hast/${disk}&#34; ] &amp;&amp; break
				sleep 0.5
			done

			if [ ! -c &#34;/dev/hast/${disk}&#34; ]; then
				logger -p $log -t $name &#34;GEOM provider /dev/hast/${disk} did not appear.&#34;
				exit 1
			fi
		done

		logger -p $log -t $name &#34;Role for HAST resources ${resources} switched to primary.&#34;

		logger -p $log -t $name &#34;Mounting disks.&#34;
		for disk in ${resources}; do
			mkdir -p /hast/${disk}
			fsck -p -y -t ufs /dev/hast/${disk}
			mount /dev/hast/${disk} /hast/${disk}
		done

	;;

	slave)
		logger -p $log -t $name &#34;Switching to secondary provider for ${resources}.&#34;

		# Switch roles for the HAST resources
		for disk in ${resources}; do
			if ! mount | grep -q &#34;^/dev/hast/${disk} on &#34;
			then
			else
				umount -f /hast/${disk}
			fi
			sleep $delay
			hastctl role secondary ${disk} 2&gt;&amp;1
			if [ $? -ne 0 ]; then
				logger -p $log -t $name &#34;Unable to switch role to secondary for resource ${disk}.&#34;
				exit 1
			fi
			logger -p $log -t $name &#34;Role switched to secondary for resource ${disk}.&#34;
		done
	;;
esac</pre></div></div><div class=paragraph><p>In a nutshell, the script takes these actions when a node becomes master:</p></div><div class=ulist><ul><li><p>Promotes the HAST pool to primary on the other node.</p></li><li><p>Checks the file system under the HAST pool.</p></li><li><p>Mounts the pool.</p></li></ul></div><div class=paragraph><p>When a node becomes secondary:</p></div><div class=ulist><ul><li><p>Unmounts the HAST pool.</p></li><li><p>Degrades the HAST pool to secondary.</p></li></ul></div><div class="admonitionblock caution"><table><tbody><tr><td class=icon><i class="fa icon-caution" title=Caution></i></td><td class=content><div class=paragraph><p>This is just an example script which serves as a proof of concept. It does not handle all the possible scenarios and can be extended or altered in any way, for example, to start or stop required services.</p></div></td></tr></tbody></table></div><div class="admonitionblock tip"><table><tbody><tr><td class=icon><i class="fa icon-tip" title=Tip></i></td><td class=content><div class=paragraph><p>For this example, a standard UFS file system was used. To reduce the time needed for recovery, a journal-enabled UFS or ZFS file system can be used instead.</p></div></td></tr></tbody></table></div><div class=paragraph><p>More detailed information with additional examples can be found at <a href=http://wiki.FreeBSD.org/HAST>http://wiki.FreeBSD.org/HAST</a>.</p></div></div></div><div class=sect2><h3 id=_疑難排解>17.14.3. 疑難排解<a class=anchor href=#_疑難排解></a></h3><div class=paragraph><p>HAST should generally work without issues. However, as with any other software product, there may be times when it does not work as supposed. The sources of the problems may be different, but the rule of thumb is to ensure that the time is synchronized between the nodes of the cluster.</p></div><div class=paragraph><p>When troubleshooting HAST, the debugging level of <a href="https://man.freebsd.org/cgi/man.cgi?query=hastd&amp;sektion=8&amp;format=html">hastd(8)</a> should be increased by starting <code>hastd</code> with <code>-d</code>. This argument may be specified multiple times to further increase the debugging level. Consider also using <code>-F</code>, which starts <code>hastd</code> in the foreground.</p></div><div class=sect3><h4 id=disks-hast-sb>17.14.3.1. 自 Split-brain 情況復原<a class=anchor href=#disks-hast-sb></a></h4><div class=paragraph><p><em>Split-brain</em> occurs when the nodes of the cluster are unable to communicate with each other, and both are configured as primary. This is a dangerous condition because it allows both nodes to make incompatible changes to the data. This problem must be corrected manually by the system administrator.</p></div><div class=paragraph><p>The administrator must either decide which node has more important changes, or perform the merge manually. Then, let HAST perform full synchronization of the node which has the broken data. To do this, issue these commands on the node which needs to be resynchronized:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># hastctl role init test</span>
<span class=c># hastctl create test</span>
<span class=c># hastctl role secondary test</span></code></pre></div></div></div></div></div></div></div><hr><div class=last-modified><p><strong>最後修改於</strong>: March 9, 2024 由 <a href="https://cgit.freebsd.org/doc/commit/?id=6199af92e7" target=_blank>Danilo G. Baio</a></p></div><div class=buttons><div class=prev><i class="fa fa-angle-left" aria-hidden=true title=Prev></i><div class=container><a href=https://docs.freebsd.org/zh-tw/books/handbook/audit class=direction>Prev</a></div></div><div class=home><i class="fa fa-home" aria-hidden=true title=Home></i><div class=container><a href=../ class=direction>Home</a></div></div><div class=next><div class=container><a href=https://docs.freebsd.org/zh-tw/books/handbook/geom class=direction>Next</a></div><i class="fa fa-angle-right" aria-hidden=true title=Next></i></div></div><label class="hidden book-menu-overlay" for=menu-control></label></div><aside class=toc><div class=toc-content><h3>目錄</h3><nav id=TableOfContents><ul><li><a href=#disks-synopsis>17.1. 概述</a></li><li><a href=#disks-adding>17.2. 加入磁碟</a></li><li><a href=#disks-growing>17.3. 重設大小與擴增磁碟</a></li><li><a href=#usb-disks>17.4. USB 儲存裝置</a></li><li><a href=#creating-cds>17.5. 建立與使用 CD 媒體</a></li><li><a href=#creating-dvds>17.6. 建立與使用 DVD 媒體</a></li><li><a href=#floppies>17.7. 建立與使用軟碟</a></li><li><a href=#backup-basics>17.8. 備份基礎概念</a></li><li><a href=#disks-virtual>17.9. 記憶體磁碟</a></li><li><a href=#snapshots>17.10. 檔案系統快照</a></li><li><a href=#quotas>17.11. 磁碟配額</a></li><li><a href=#disks-encrypting>17.12. 磁碟分割區加密</a></li><li><a href=#swap-encrypting>17.13. 交換空間加密</a></li><li><a href=#disks-hast>17.14. 高可用存儲空間 (HAST)</a></li></ul></nav><hr><div class=resources><h3>資源</h3><ul class=contents><li><i class="fa fa-file-pdf-o" aria-hidden=true title="下載 PDF"></i><a href=https://download.freebsd.org/doc/zh-tw/books/handbook/handbook_zh-tw.pdf>下載 PDF</a></li><li><i class="fa fa-pencil-square-o" aria-hidden=true title=編輯此頁></i><a href=https://github.com/freebsd/freebsd-doc/blob/main/documentation/content/zh-tw/_index target=_blank>編輯此頁</a></li></ul></div></div></aside><a class=to-top href=#top><i class="fa fa-arrow-circle-up" aria-hidden=true></i></a></main><footer><div class=footer-container><section class=logo-column><img src=https://docs.freebsd.org/images/FreeBSD-colors.svg width=160 height=50 alt="FreeBSD logo"><div class=options-container><div class=language-container><a id=languages href=https://docs.freebsd.org/zh-tw/languages><img src=https://docs.freebsd.org/images/language.png class=language-image alt=選擇語言>
<span>繁體中文</span></a></div><div class=theme-container><select id=theme-chooser><option value=theme-system>System</option><option value=theme-light>淺色</option><option value=theme-dark>深色</option><option value=theme-high-contrast>高對比</option></select></div></div></section><section class=about-column><h3 class=column-title>About</h3><ul class=column-elements-container><li><a href=https://www.freebsd.org/about/ target=_blank class=column-element>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/ target=_blank class=column-element>FreeBSD Foundation</a></li><li><a href=https://www.freebsd.org/where/ target=_blank class=column-element>Get FreeBSD</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct target=_blank class=column-element>Code of Conduct</a></li><li><a href=https://www.freebsd.org/security/ target=_blank class=column-element>Security Advisories</a></li></ul></section><section class=documentation-column><h3 class=column-title>Documentation</h3><ul class=column-elements-container><li><a href=/zh-tw class=column-element>Documentation portal</a></li><li><a href=https://man.FreeBSD.org target=_blank class=column-element>Manual pages</a></li><li><a href=https://papers.FreeBSD.org target=_blank class=column-element>Presentations and papers</a></li><li><a href=https://docs-archive.freebsd.org/doc/ target=_blank class=column-element>Previous versions</a></li><li><a href=https://docs-archive.freebsd.org/44doc/ target=_blank class=column-element>4.4BSD Documents</a></li><li><a href=https://wiki.freebsd.org/ target=_blank class=column-element>Wiki</a></li></ul></section><section class=community-column><h3 class=column-title>Community</h3><ul class=column-elements-container><li><a href=https://docs.freebsd.org/zh-tw/articles/contributing class=column-element>Get involved</a></li><li><a href=https://forums.freebsd.org/ target=_blank class=column-element>Community forum</a></li><li><a href=https://lists.freebsd.org/ target=_blank class=column-element>Mailing lists</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank class=column-element>IRC Channels</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank class=column-element>Bug Tracker</a></li></ul></section><section class=legal-column><h3 class=column-title>Legal</h3><ul class=column-elements-container><li><a href=https://freebsdfoundation.org/donate/ target=_blank class=column-element>Donations</a></li><li><a href=https://www.freebsd.org/copyright/freebsd-license/ target=_blank class=column-element>Licensing</a></li><li><a href=https://www.freebsd.org/privacy/ target=_blank class=column-element>Privacy Policy</a></li><li><a href=https://www.freebsd.org/copyright/ target=_blank class=column-element>Legal notices</a></li></ul></section><section class=copyright-column><p>&copy; 1994-2024 The FreeBSD Project. All rights reserved</p><span>Made with <span class=heart>♥</span> by the FreeBSD Community</span></section></div></footer></body></html>