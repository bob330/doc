<!doctype html><html class=theme-light lang=zh-tw><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content><meta name=copyright content="1995-2024 The FreeBSD Foundation"><link rel=canonical href=https://docs.freebsd.org/zh-tw/books/handbook/network-servers/><title>章 29. 網路伺服器 | FreeBSD Documentation Portal</title>
<meta name=theme-color content="#790000"><meta name=color-scheme content="system light dark high-contrast"><link rel="shortcut icon" href=https://docs.freebsd.org/favicon.ico><link rel=stylesheet href=https://docs.freebsd.org/styles/main.min.css><link rel=stylesheet href=https://docs.freebsd.org/css/font-awesome-min.css><script defer src=/js/theme-chooser.min.js></script><script defer src=/js/copy-clipboard.min.js></script><script defer src=/js/search.min.js></script><meta name=twitter:card content="summary"><meta name=twitter:domain content="docs.FreeBSD.org"><meta name=twitter:site content="@freebsd"><meta name=twitter:url content="https://twitter.com/freebsd"><meta property="og:title" content="章 29. 網路伺服器"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:image" content="https://docs.freebsd.org/favicon.ico"><meta property="og:image:alt" content="FreeBSD Logo"><meta property="og:locale" content="zh-tw"><meta property="og:url" content="https://docs.freebsd.org/zh-tw/books/handbook/network-servers/"><meta property="og:site_name" content="FreeBSD Documentation Portal"><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","url":"https:\/\/docs.freebsd.org\/zh-tw\/books\/handbook\/network-servers\/","name":"FreeBSD Documentation Portal","headline":"FreeBSD Documentation Portal","description":"FreeBSD Documentation Portal"}</script></head><body><header><div class=header-container><div class=logo-menu-bars-container><a href=https://www.FreeBSD.org class=logo><img src=https://docs.freebsd.org/images/FreeBSD-monochromatic.svg width=160 height=50 alt="FreeBSD logo">
</a><label class=menu-bars for=menu-bars><i class="fa fa-bars" aria-hidden=true></i></label></div><input id=menu-bars type=checkbox><nav><ul class=menu><li class=menu-item><input id=about type=checkbox>
<a href=# aria-label="Navigate to About section"><label class=menu-item-description for=about>About
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/about/ target=_blank>About</a></li><li><a href=https://www.freebsd.org/about/ target=_blank>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/about-us/about-the-foundation/ target=_blank>FreeBSD Foundation</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct/ target=_blank>Code of Conduct</a></li></ul></li><li class=menu-item><input id=download type=checkbox>
<a href=# aria-label="Navigate to get FreeBSD section"><label class=menu-item-description for=download>Get FreeBSD
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/where/ target=_blank>Get FreeBSD</a></li><li><a href=https://www.freebsd.org/releases/ target=_blank>Release Information</a></li><li><a href=https://www.freebsd.org/releng/ target=_blank>Release Engineering</a></li><li><a href=https://www.freebsd.org/security/ target=_blank>Security Advisories</a></li></ul></li><li class=menu-item><input id=documentation type=checkbox>
<a href=# aria-label="Navigate to get Documentation section"><label class=menu-item-description for=documentation>Documentation
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=/zh-tw>Documentation portal</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook>FreeBSD Handbook</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/porters-handbook>Porter's Handbook</a></li><li><a href=https://docs.FreeBSD.org/en/books/fdp-primer>Documentation Project Handbook</a></li><li><a href=https://man.FreeBSD.org target=_blank>Manual pages</a></li><li><a href=https://papers.FreeBSD.org target=_blank>Presentations and papers</a></li><li><a href=https://wiki.FreeBSD.org target=_blank>Wiki</a></li><li><a href=https://docs.freebsd.org/zh-tw/books>Books</a></li><li><a href=https://docs.freebsd.org/zh-tw/articles>Articles</a></li></ul></li><li class=menu-item><input id=community type=checkbox>
<a href=# aria-label="Navigate to get Community section"><label class=menu-item-description for=community>Community
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/community/>Community</a></li><li><a href=https://docs.freebsd.org/zh-tw/articles/contributing>Get involved</a></li><li><a href=https://forums.freebsd.org/ target=_blank>Forum</a></li><li><a href=https://lists.freebsd.org/ target=_blank>Mailing lists</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank>IRC Channels</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank>Bug Tracker</a></li><li><a href=https://www.freebsd.org/support/ target=_blank>Support</a></li></ul></li></ul></nav><div class=search-donate-container><form class=search method=get id=search-header-form action=https://docs.freebsd.org/search name=search-header-form><input type=hidden name=DB value=zh-tw>
<input id=words name=P type=text size=20 maxlength=255>
<button>
<i class="fa fa-search" aria-hidden=true></i></button></form><div class=donate><a href=https://freebsdfoundation.org/donate/ target=_blank><span class=heart>♥</span>
Donate</a></div></div></div></header><input type=checkbox class="hidden toggle" id=menu-control><main class=main-wrapper-book><a id=top></a><aside class=book-menu><div class=book-menu-content><input id=search-book type=text placeholder=Search aria-label=Search maxlength=128><nav id=MenuContents><ul><li><input type=checkbox id=chapter-eb2a98ce203d8afd517726e6d8776be3 class=toggle>
<label class="icon cursor" for=chapter-eb2a98ce203d8afd517726e6d8776be3><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/preface/>序</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/preface/#preface-audience>給讀者的話</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/preface/#preface-changes-from3>自第三版後的主要修訂</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/preface/#preface-changes-from2>自第二版後的主要修訂 (2004)</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/preface/#preface-changes>自第一版後的主要修訂 (2001)</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/preface/#preface-overview>本書架構</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/preface/#preface-conv>本書的編排體裁</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/preface/#preface-acknowledgements>銘謝</a></li></ul></li><li><input type=checkbox id=chapter-14a525fce014b90b8a458a894818255a class=toggle>
<label for=chapter-14a525fce014b90b8a458a894818255a><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/parti/>部 I. 入門</a></li><li><input type=checkbox id=chapter-f9c9f3451644df30d224350da97d5da6 class=toggle>
<label class="icon cursor" for=chapter-f9c9f3451644df30d224350da97d5da6><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/introduction/>章 1. 簡介</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/introduction/#introduction-synopsis>1.1. 概述</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/introduction/#nutshell>1.2. 歡迎使用 FreeBSD！</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/introduction/#history>1.3. 關於 FreeBSD 計劃</a></li></ul></li><li><input type=checkbox id=chapter-f693a3fa687a72d63ec8129ee302d664 class=toggle>
<label class="icon cursor" for=chapter-f693a3fa687a72d63ec8129ee302d664><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/bsdinstall/>章 2. 安裝 FreeBSD</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/bsdinstall/#bsdinstall-synopsis>2.1. 概述</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/bsdinstall/#bsdinstall-hardware>2.2. 最低硬體需求</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/bsdinstall/#bsdinstall-pre>2.3. 安裝前準備工作</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/bsdinstall/#bsdinstall-start>2.4. 開始安裝</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/bsdinstall/#using-bsdinstall>2.5. 使用 bsdinstall</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/bsdinstall/#bsdinstall-partitioning>2.6. 配置磁碟空間</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/bsdinstall/#bsdinstall-final-warning>2.7. 確認安裝</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/bsdinstall/#bsdinstall-post>2.8. 安裝後注意事項</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/bsdinstall/#bsdinstall-install-trouble>2.9. 疑難排解</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/bsdinstall/#using-live-cd>2.10. 使用 Live CD</a></li></ul></li><li><input type=checkbox id=chapter-9f6db261075f578742036fcc6000eecd class=toggle>
<label class="icon cursor" for=chapter-9f6db261075f578742036fcc6000eecd><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/basics/>章 3. FreeBSD 基礎</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/basics/#basics-synopsis>3.1. 概述</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/basics/#consoles>3.2. 虛擬 Console 與終端機</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/basics/#users-synopsis>3.3. 使用者與基礎帳號管理</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/basics/#permissions>3.4. 權限</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/basics/#dirstructure>3.5. 目錄結構</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/basics/#disk-organization>3.6. 磁碟組織</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/basics/#mount-unmount>3.7. 掛載與卸載檔案系統</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/basics/#basics-processes>3.8. 程序與 Daemon</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/basics/#shells>3.9. Shell</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/basics/#editors>3.10. 文字編輯器</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/basics/#basics-devices>3.11. 裝置及裝置節點</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/basics/#basics-more-information>3.12. 操作手冊</a></li></ul></li><li><input type=checkbox id=chapter-01c5707e95d14c0ff84bf62600c958d1 class=toggle>
<label class="icon cursor" for=chapter-01c5707e95d14c0ff84bf62600c958d1><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/ports/>章 4. 安裝應用程式：套件與 Port</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/ports/#ports-synopsis>4.1. 概述</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/ports/#ports-overview>4.2. 安裝軟體的概要</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/ports/#ports-finding-applications>4.3. 搜尋軟體</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/ports/#pkgng-intro>4.4. 使用 pkg 管理 Binary 套件</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/ports/#ports-using>4.5. 使用 Port 套件集</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/ports/#ports-poudriere>4.6. 使用 Poudriere 編譯套件</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/ports/#ports-nextsteps>4.7. 安裝後的注意事項</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/ports/#ports-broken>4.8. 處理損壞的 Port</a></li></ul></li><li><input type=checkbox id=chapter-3405c00581365a8b5d16af70fe4d1b72 class=toggle>
<label class="icon cursor" for=chapter-3405c00581365a8b5d16af70fe4d1b72><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/x11/>章 5. X Window 系統</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/x11/#x11-synopsis>5.1. 概述</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/x11/#x-understanding>5.2. 術語</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/x11/#x-install>5.3. 安裝 Xorg</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/x11/#x-config>5.4. Xorg 設定</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/x11/#x-fonts>5.5. 在 Xorg 使用字型</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/x11/#x-xdm>5.6. X 顯示管理程式</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/x11/#x11-wm>5.7. 桌面環境</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/x11/#x-compiz-fusion>5.8. 安裝 Compiz Fusion</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/x11/#x11-understanding>5.9. 疑難排解</a></li></ul></li><li><input type=checkbox id=chapter-0eab3565e8f59f5a8a896dfba7eb3680 class=toggle>
<label for=chapter-0eab3565e8f59f5a8a896dfba7eb3680><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/partii/>部 II. 一般作業</a></li><li><input type=checkbox id=chapter-b33cf28993f3f7bf5baf036e79da0f39 class=toggle>
<label class="icon cursor" for=chapter-b33cf28993f3f7bf5baf036e79da0f39><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/desktop/>章 6. 桌面應用程式</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/desktop/#desktop-synopsis>6.1. 概述</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/desktop/#desktop-browsers>6.2. 瀏覽器</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/desktop/#desktop-productivity>6.3. 辦工工具</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/desktop/#desktop-viewers>6.4. 文件閱覽程式</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/desktop/#desktop-finance>6.5. 財務</a></li></ul></li><li><input type=checkbox id=chapter-152f694a19312ad72ec7bb4e1c3c33b2 class=toggle>
<label class="icon cursor" for=chapter-152f694a19312ad72ec7bb4e1c3c33b2><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/multimedia/>章 7. 多媒體</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/multimedia/#multimedia-synopsis>7.1. 概述</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/multimedia/#sound-setup>7.2. 設定音效卡</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/multimedia/#sound-mp3>7.3. MP3 音樂</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/multimedia/#video-playback>7.4. 影片播放</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/multimedia/#tvcard>7.5. 電視卡</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/multimedia/#mythtv>7.6. MythTV</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/multimedia/#scanners>7.7. 影像掃描器</a></li></ul></li><li><input type=checkbox id=chapter-80888b4ee02e3e409e5f71cf97a36450 class=toggle>
<label class="icon cursor" for=chapter-80888b4ee02e3e409e5f71cf97a36450><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/kernelconfig/>章 8. 設定 FreeBSD 核心</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/kernelconfig/#kernelconfig-synopsis>8.1. 概述</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/kernelconfig/#kernelconfig-custom-kernel>8.2. 為何要編譯自訂的核心?</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/kernelconfig/#kernelconfig-devices>8.3. 偵測系統硬體</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/kernelconfig/#kernelconfig-config>8.4. 設定檔</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/kernelconfig/#kernelconfig-building>8.5. 編譯與安裝自訂核心</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/kernelconfig/#kernelconfig-trouble>8.6. 如果發生錯誤</a></li></ul></li><li><input type=checkbox id=chapter-cb174c55879b17ab955f2f16989a79e0 class=toggle>
<label class="icon cursor" for=chapter-cb174c55879b17ab955f2f16989a79e0><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/printing/>章 9. 列印</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/printing/#printing-quick-start>9.1. 快速開始</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/printing/#printing-connections>9.2. 印表機連線</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/printing/#printing-pdls>9.3. 常見的頁面描述語言</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/printing/#printing-direct>9.4. 直接列印</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/printing/#printing-lpd>9.5. LPD (行列式印表機 Daemon)</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/printing/#printing-other>9.6. 其他列印系統</a></li></ul></li><li><input type=checkbox id=chapter-c12b8c3f2a8fcefce87087241f695c83 class=toggle>
<label class="icon cursor" for=chapter-c12b8c3f2a8fcefce87087241f695c83><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/linuxemu/>章 10. Linux® Binary 相容性</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/linuxemu/#linuxemu-synopsis>10.1. 概述</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/linuxemu/#linuxemu-lbc-install>10.2. 設定 Linux™ Binary 相容性</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/linuxemu/#linuxemu-advanced>10.3. 進階主題</a></li></ul></li><li><input type=checkbox id=chapter-03b11ba627b9a0c85b247f5641bde272 class=toggle>
<label for=chapter-03b11ba627b9a0c85b247f5641bde272><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/partiii/>部 III. 系統管理</a></li><li><input type=checkbox id=chapter-6c31587f8d736319f099cd4dc1961301 class=toggle>
<label class="icon cursor" for=chapter-6c31587f8d736319f099cd4dc1961301><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/config/>章 11. 設定與調校</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/config/#config-synopsis>11.1. 概述</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/config/#configtuning-starting-services>11.2. 啟動服務</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/config/#configtuning-cron>11.3. 設定 cron(8)</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/config/#configtuning-rcd>11.4. 管理 FreeBSD 中的服務</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/config/#config-network-setup>11.5. 設定網路介面卡</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/config/#configtuning-virtual-hosts>11.6. 虛擬主機</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/config/#configtuning-syslog>11.7. 設定系統日誌</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/config/#configtuning-configfiles>11.8. 設定檔</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/config/#configtuning-sysctl>11.9. 使用 sysctl(8) 調校</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/config/#configtuning-disk>11.10. 調校磁碟</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/config/#configtuning-kernel-limits>11.11. 調校核心限制</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/config/#adding-swap-space>11.12. 增加交換空間</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/config/#acpi-overview>11.13. 電源與資源管理</a></li></ul></li><li><input type=checkbox id=chapter-459f0012b3b4f0b6b123010f029da5e4 class=toggle>
<label class="icon cursor" for=chapter-459f0012b3b4f0b6b123010f029da5e4><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/boot/>章 12. FreeBSD 開機程序</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/boot/#boot-synopsis>12.1. 概述</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/boot/#boot-introduction>12.2. FreeBSD 開機程序</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/boot/#boot-splash>12.3. 設定開機啟動畫面</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/boot/#device-hints>12.4. 裝置提示</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/boot/#boot-shutdown>12.5. 關機程序</a></li></ul></li><li><input type=checkbox id=chapter-917c75fcffbb14d48ed6d0a48e7028f2 class=toggle>
<label class="icon cursor" for=chapter-917c75fcffbb14d48ed6d0a48e7028f2><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/security/>章 13. 安全性</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/security/#security-synopsis>13.1. 概述</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/security/#security-intro>13.2. 簡介</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/security/#one-time-passwords>13.3. 一次性密碼</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/security/#tcpwrappers>13.4. TCP Wrapper</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/security/#kerberos5>13.5. Kerberos</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/security/#openssl>13.6. OpenSSL</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/security/#ipsec>13.7. VPN over IPsec</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/security/#openssh>13.8. OpenSSH</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/security/#fs-acl>13.9. 存取控制清單</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/security/#security-pkg>13.10. 監視第三方安全性問題</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/security/#security-advisories>13.11. FreeBSD 安全報告</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/security/#security-accounting>13.12. 程序追蹤</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/security/#security-resourcelimits>13.13. 限制資源</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/security/#security-sudo>13.14. 使用 Sudo 分享管理權限</a></li></ul></li><li><input type=checkbox id=chapter-1a2a8e719703649c2c66d99aa7a25fd4 class=toggle>
<label class="icon cursor" for=chapter-1a2a8e719703649c2c66d99aa7a25fd4><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/jails/>章 14. Jail</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/jails/#jails-synopsis>14.1. 概述</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/jails/#jails-terms>14.2. Jail 相關術語</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/jails/#jails-build>14.3. 建立和控制 Jail</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/jails/#jails-tuning>14.4. 調校與管理</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/jails/#jails-application>14.5. 更新多個 Jail</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/jails/#jails-ezjail>14.6. 使用 ezjail 管理 Jail</a></li></ul></li><li><input type=checkbox id=chapter-8f4620c77e572cbb58917911a33c73cf class=toggle>
<label class="icon cursor" for=chapter-8f4620c77e572cbb58917911a33c73cf><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/mac/>章 15. 強制存取控制 (MAC)</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/mac/#mac-synopsis>15.1. 概述</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/mac/#mac-inline-glossary>15.2. 關鍵詞</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/mac/#mac-understandlabel>15.3. 了解 MAC 標籤</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/mac/#mac-planning>15.4. 規劃安全架構</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/mac/#mac-policies>15.5. 可用的 MAC 管理政策</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/mac/#mac-userlocked>15.6. User Lock Down</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/mac/#mac-implementing>15.7. 在 MAC Jail 中使用 Nagios</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/mac/#mac-troubleshoot>15.8. MAC 架構疑難排解</a></li></ul></li><li><input type=checkbox id=chapter-9598d66a76cb3182057b6bcd775149a0 class=toggle>
<label class="icon cursor" for=chapter-9598d66a76cb3182057b6bcd775149a0><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/audit/>章 16. 安全事件稽查</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/audit/#audit-synopsis>16.1. 概述</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/audit/#audit-inline-glossary>16.2. 關鍵詞</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/audit/#audit-config>16.3. 稽查設定</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/audit/#audit-administration>16.4. 查看稽查線索</a></li></ul></li><li><input type=checkbox id=chapter-e1edcad13d9db6e8e4cb645d378ecfaf class=toggle>
<label class="icon cursor" for=chapter-e1edcad13d9db6e8e4cb645d378ecfaf><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/disks/>章 17. 儲存設備</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/disks/#disks-synopsis>17.1. 概述</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/disks/#disks-adding>17.2. 加入磁碟</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/disks/#disks-growing>17.3. 重設大小與擴增磁碟</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/disks/#usb-disks>17.4. USB 儲存裝置</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/disks/#creating-cds>17.5. 建立與使用 CD 媒體</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/disks/#creating-dvds>17.6. 建立與使用 DVD 媒體</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/disks/#floppies>17.7. 建立與使用軟碟</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/disks/#backup-basics>17.8. 備份基礎概念</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/disks/#disks-virtual>17.9. 記憶體磁碟</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/disks/#snapshots>17.10. 檔案系統快照</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/disks/#quotas>17.11. 磁碟配額</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/disks/#disks-encrypting>17.12. 磁碟分割區加密</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/disks/#swap-encrypting>17.13. 交換空間加密</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/disks/#disks-hast>17.14. 高可用存儲空間 (HAST)</a></li></ul></li><li><input type=checkbox id=chapter-dde37901a0e0ea32745b67607854900f class=toggle>
<label class="icon cursor" for=chapter-dde37901a0e0ea32745b67607854900f><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/geom/>章 18. GEOM: 模組化磁碟轉換框架</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/geom/#geom-synopsis>18.1. 概述</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/geom/#geom-striping>18.2. RAID0 - 串連 (Striping)</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/geom/#geom-mirror>18.3. RAID1 - 鏡像 (Mirroring)</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/geom/#geom-raid3>18.4. RAID3 - 位元級串連與獨立奇偶校驗</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/geom/#geom-graid>18.5. 軟體 RAID 裝置</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/geom/#geom-ggate>18.6. GEOM Gate Network</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/geom/#geom-glabel>18.7. 磁碟裝置標籤</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/geom/#geom-gjournal>18.8. UFS Journaling 透過 GEOM</a></li></ul></li><li><input type=checkbox id=chapter-73e82560fcb7145b7c0e2ec47af8fc04 class=toggle>
<label class="icon cursor" for=chapter-73e82560fcb7145b7c0e2ec47af8fc04><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/zfs/>章 19. Z 檔案系統 (ZFS)</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/zfs/#zfs-differences>19.1. 什麼使 ZFS 與眾不同</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/zfs/#zfs-quickstart>19.2. 快速入門指南</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/zfs/#zfs-zpool>19.3. <code>zpool</code> 管理</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/zfs/#zfs-zfs>19.4. <code>zfs</code> 管理</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/zfs/#zfs-zfs-allow>19.5. 委託管理</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/zfs/#zfs-advanced>19.6. 進階主題</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/zfs/#zfs-links>19.7. 其他資源</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/zfs/#zfs-term>19.8. ZFS 特色與術語</a></li></ul></li><li><input type=checkbox id=chapter-7af71270807eb7b70cd3eedc6577b254 class=toggle>
<label class="icon cursor" for=chapter-7af71270807eb7b70cd3eedc6577b254><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/filesystems/>章 20. 其他檔案系統</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/filesystems/#filesystems-synopsis>20.1. 概述</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/filesystems/#filesystems-linux>20.2. Linux™ 檔案系統</a></li></ul></li><li><input type=checkbox id=chapter-375257268d95faaf87faf4f7a2e6aa67 class=toggle>
<label class="icon cursor" for=chapter-375257268d95faaf87faf4f7a2e6aa67><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/virtualization/>章 21. 虛擬化</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/virtualization/#virtualization-synopsis>21.1. 概述</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/virtualization/#virtualization-guest-parallels>21.2. 在 Mac OS™ X 的 Parallels 安裝 FreeBSD 為客端</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/virtualization/#virtualization-guest-virtualpc>21.3. 在 Windows™ 的 Virtual PC 安裝 FreeBSD 為客端</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/virtualization/#virtualization-guest-vmware>21.4. 在 Mac OS™ 的 VMware Fusion 安裝 FreeBSD 為客端</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/virtualization/#virtualization-guest-virtualbox>21.5. 在 VirtualBox™ 安裝 FreeBSD 作為客端</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/virtualization/#virtualization-host-virtualbox>21.6. 以 FreeBSD 作為主端使用 VirtualBox™</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/virtualization/#virtualization-host-bhyve>21.7. 以 FreeBSD 作為主端安裝 bhyve</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/virtualization/#virtualization-host-xen>21.8. 以 FreeBSD 作為主端安裝 Xen™</a></li></ul></li><li><input type=checkbox id=chapter-49f1e96591c090304ea532012257f4ef class=toggle>
<label class="icon cursor" for=chapter-49f1e96591c090304ea532012257f4ef><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/l10n/>章 22. 在地化 - i18n/L10n 使用與安裝</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/l10n/#l10n-synopsis>22.1. 概述</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/l10n/#using-localization>22.2. 使用語系</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/l10n/#l10n-compiling>22.3. 尋找 i18n 應用程式</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/l10n/#lang-setup>22.4. 特定語言的語系設定</a></li></ul></li><li><input type=checkbox id=chapter-dead2b4c5ea325dd390a9b0dccd8f763 class=toggle>
<label class="icon cursor" for=chapter-dead2b4c5ea325dd390a9b0dccd8f763><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/cutting-edge/>章 23. 更新與升級 FreeBSD</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/cutting-edge/#updating-upgrading-synopsis>23.1. 概述</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/cutting-edge/#updating-upgrading-freebsdupdate>23.2. FreeBSD 更新</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/cutting-edge/#updating-upgrading-documentation>23.3. 更新文件集</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/cutting-edge/#current-stable>23.4. 追蹤開發分支</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/cutting-edge/#makeworld>23.5. 從原始碼更新 FreeBSD</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/cutting-edge/#small-lan>23.6. 多部機器追蹤</a></li></ul></li><li><input type=checkbox id=chapter-913e72bfb3d6947b2869d3e9447a6eaa class=toggle>
<label class="icon cursor" for=chapter-913e72bfb3d6947b2869d3e9447a6eaa><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/usb-device-mode/>章 25. USB Device Mode / USB OTG</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/usb-device-mode/#usb-device-mode-synopsis>25.1. 概述</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/usb-device-mode/#usb-device-mode-terminals>25.2. USB 虛擬序列埠</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/usb-device-mode/#usb-device-mode-network>25.3. USB 裝置模式網路介面</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/usb-device-mode/#usb-device-mode-storage>25.4. USB 虛擬儲存裝置</a></li></ul></li><li><input type=checkbox id=chapter-bbd25f9a194f9c39ca2d658c75767db5 class=toggle>
<label for=chapter-bbd25f9a194f9c39ca2d658c75767db5><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/partiv/>部 IV. 網路通訊</a></li><li><input type=checkbox id=chapter-29c1eeb0e9dedc487a98399e2737ee8a class=toggle>
<label class="icon cursor" for=chapter-29c1eeb0e9dedc487a98399e2737ee8a><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/dtrace/>章 24. DTrace</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/dtrace/#dtrace-synopsis>24.1. 概述</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/dtrace/#dtrace-implementation>24.2. 實作差異</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/dtrace/#dtrace-enable>24.3. 開啟 DTrace 支援</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/dtrace/#dtrace-using>24.4. 使用 DTrace</a></li></ul></li><li><input type=checkbox id=chapter-499dab596afd7ddac77e80295314e0dd class=toggle>
<label class="icon cursor" for=chapter-499dab596afd7ddac77e80295314e0dd><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/serialcomms/>章 26. 序列通訊</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/serialcomms/#serial-synopsis>26.1. 概述</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/serialcomms/#serial>26.2. 序列術語與硬體</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/serialcomms/#term>26.3. 終端機</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/serialcomms/#dialup>26.4. 撥入服務</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/serialcomms/#dialout>26.5. 撥出服務</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/serialcomms/#serialconsole-setup>26.6. 設定序列 Console</a></li></ul></li><li><input type=checkbox id=chapter-95e4571c48bee1cced5e84a538d302e3 class=toggle>
<label class="icon cursor" for=chapter-95e4571c48bee1cced5e84a538d302e3><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/ppp-and-slip/>章 27. PPP</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/ppp-and-slip/#ppp-and-slip-synopsis>27.1. 概述</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/ppp-and-slip/#userppp>27.2. 設定 PPP</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/ppp-and-slip/#ppp-troubleshoot>27.3. PPP 連線疑難排解</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/ppp-and-slip/#pppoe>27.4. 在乙太網路使用 PPP (PPPoE)</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/ppp-and-slip/#pppoa>27.5. 在 ATM 使用 PPP (PPPoA)</a></li></ul></li><li><input type=checkbox id=chapter-f089ac726c401c9b4bd5c34a295e11bb class=toggle>
<label class="icon cursor" for=chapter-f089ac726c401c9b4bd5c34a295e11bb><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/mail/>章 28. 電子郵件</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/mail/#mail-synopsis>28.1. 概述</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/mail/#mail-using>28.2. 郵件組成</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/mail/#sendmail>28.3. Sendmail 設定檔</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/mail/#mail-changingmta>28.4. 更改郵件傳輸代理程式</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/mail/#mail-trouble>28.5. 疑難排解</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/mail/#mail-advanced>28.6. 進階主題</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/mail/#outgoing-only>28.7. 寄件設定</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/mail/#SMTP-dialup>28.8. 在撥號連線使用郵件</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/mail/#SMTP-Auth>28.9. SMTP 認證</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/mail/#mail-agents>28.10. 郵件使用者代理程式</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/mail/#mail-fetchmail>28.11. 使用 fetchmail</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/mail/#mail-procmail>28.12. 使用 procmail</a></li></ul></li><li><input type=checkbox id=chapter-6de4de3fe925639d4175ce4b6f8c1829 class=toggle checked>
<label class="icon cursor" for=chapter-6de4de3fe925639d4175ce4b6f8c1829><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/network-servers/>章 29. 網路伺服器</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/network-servers/#network-servers-synopsis>29.1. 概述</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/network-servers/#network-inetd>29.2. inetd 超級伺服器</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/network-servers/#network-nfs>29.3. 網路檔案系統 (NFS)</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/network-servers/#network-nis>29.4. 網路資訊系統 (NIS)</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/network-servers/#network-ldap>29.5. 輕量級目錄存取協定 (LDAP)</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/network-servers/#network-dhcp>29.6. 動態主機設置協定 (DHCP)</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/network-servers/#network-dns>29.7. 網域名稱系統 (DNS)</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/network-servers/#network-apache>29.8. Apache HTTP 伺服器</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/network-servers/#network-ftp>29.9. 檔案傳輸協定 (FTP)</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/network-servers/#network-samba>29.10. Microsoft™Windows™ 用戶端檔案與列印服務 (Samba)</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/network-servers/#network-ntp>29.11. NTP 時間校對</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/network-servers/#network-iscsi>29.12. iSCSI Initiator 與 Target 設定</a></li></ul></li><li><input type=checkbox id=chapter-776d855c7b75e048f90b5c2c9b35ffe0 class=toggle>
<label class="icon cursor" for=chapter-776d855c7b75e048f90b5c2c9b35ffe0><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/firewalls/>章 30. 防火牆</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/firewalls/#firewalls-intro>30.1. 概述</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/firewalls/#firewalls-concepts>30.2. 防火牆概念</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/firewalls/#firewalls-pf>30.3. PF</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/firewalls/#firewalls-ipfw>30.4. IPFW</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/firewalls/#firewalls-ipf>30.5. IPFILTER (IPF)</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/firewalls/#firewalls-blacklistd>30.6. Blacklistd</a></li></ul></li><li><input type=checkbox id=chapter-5b07f776a0e6155c1c89aa0d15610380 class=toggle>
<label class="icon cursor" for=chapter-5b07f776a0e6155c1c89aa0d15610380><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/advanced-networking/>章 31. 進階網路設定</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/advanced-networking/#advanced-networking-synopsis>31.1. 概述</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/advanced-networking/#network-routing>31.2. 通訊閘與路由</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/advanced-networking/#network-wireless>31.3. 無線網路</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/advanced-networking/#network-usb-tethering>31.4. USB 網路共享</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/advanced-networking/#network-bluetooth>31.5. 藍牙</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/advanced-networking/#network-bridging>31.6. 橋接</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/advanced-networking/#network-aggregation>31.7. Link Aggregation 與容錯移轉</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/advanced-networking/#network-diskless>31.8. PXE 無磁碟作業</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/advanced-networking/#network-ipv6>31.9. IPv6</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/advanced-networking/#carp>31.10. 共用位址備援協定 (CARP)</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/advanced-networking/#network-vlan>31.11. VLANs</a></li></ul></li><li><input type=checkbox id=chapter-171a77aa9d067a1024f849470e1f33e8 class=toggle>
<label for=chapter-171a77aa9d067a1024f849470e1f33e8><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/partv/>部 V. 附錄</a></li><li><input type=checkbox id=chapter-8050f436a0a7986a4aaded93d8e49469 class=toggle>
<label class="icon cursor" for=chapter-8050f436a0a7986a4aaded93d8e49469><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/mirrors/>附錄 A. 取得 FreeBSD</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/mirrors/#mirrors-cdrom>A.1. CD 與 DVD 合集</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/mirrors/#mirrors-ftp>A.2. FTP 站</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/mirrors/#svn>A.3. 使用 Subversion</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/mirrors/#mirrors-rsync>A.4. 使用 rsync</a></li></ul></li><li><input type=checkbox id=chapter-128b630a8f88f158e7027fe6c2184d21 class=toggle>
<label class="icon cursor" for=chapter-128b630a8f88f158e7027fe6c2184d21><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/bibliography/>附錄 B. 參考書目</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/bibliography/#bibliography-freebsd>B.1. FreeBSD 相關書籍</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/bibliography/#bibliography-userguides>B.2. 使用指南</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/bibliography/#bibliography-adminguides>B.3. 管理指南</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/bibliography/#bibliography-programmers>B.4. 開發指南</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/bibliography/#bibliography-osinternals>B.5. 深入作業系統</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/bibliography/#bibliography-security>B.6. 安全性參考文獻</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/bibliography/#bibliography-hardware>B.7. 硬體參考文獻</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/bibliography/#bibliography-history>B.8. UNIX™ 歷史</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/bibliography/#bibliography-journals>B.9. 期刊與雜誌</a></li></ul></li><li><input type=checkbox id=chapter-8bbb8867c46dac315e2253945d8c18a8 class=toggle>
<label class="icon cursor" for=chapter-8bbb8867c46dac315e2253945d8c18a8><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/eresources/>附錄 C. 網路資源</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/eresources/#eresources-www>C.1. 網站</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/eresources/#eresources-mail>C.2. 郵遞論壇 (Mailing List)</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/eresources/#eresources-news>C.3. Usenet 新聞群組</a></li><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/eresources/#eresources-web>C.4. 官方鏡像站</a></li></ul></li><li><input type=checkbox id=chapter-a80ea4f5a4480b8725422710f954ef36 class=toggle>
<label class="icon cursor" for=chapter-a80ea4f5a4480b8725422710f954ef36><a role=button></a></label><a href=https://docs.freebsd.org/zh-tw/books/handbook/pgpkeys/>附錄 D. OpenPGP 金鑰</a><ul><li><a href=https://docs.freebsd.org/zh-tw/books/handbook/pgpkeys/#pgpkeys-officers>D.1. Officers</a></li></ul></li><li></li></ul></nav></div></aside><div class=book><div class=book-menu-mobile><label for=menu-control><span class=menu-control-button><i class="fa fa-list" aria-hidden=true title="Book menu"></i>
Book menu</span></label></div><h1 class=title>章 29. 網路伺服器</h1><div class="admonitionblock note"><p><i class="fa fa-exclamation-circle" aria-hidden=true></i>
This translation may be out of date. To help with the translations please access the <a href=https://translate-dev.freebsd.org/ target=_blank>FreeBSD translations instance</a>.</p></div><div class=toc-mobile><h3>目錄</h3><nav id=TableOfContents><ul><li><a href=#network-servers-synopsis>29.1. 概述</a></li><li><a href=#network-inetd>29.2. inetd 超級伺服器</a></li><li><a href=#network-nfs>29.3. 網路檔案系統 (NFS)</a></li><li><a href=#network-nis>29.4. 網路資訊系統 (NIS)</a></li><li><a href=#network-ldap>29.5. 輕量級目錄存取協定 (LDAP)</a></li><li><a href=#network-dhcp>29.6. 動態主機設置協定 (DHCP)</a></li><li><a href=#network-dns>29.7. 網域名稱系統 (DNS)</a></li><li><a href=#network-apache>29.8. Apache HTTP 伺服器</a></li><li><a href=#network-ftp>29.9. 檔案傳輸協定 (FTP)</a></li><li><a href=#network-samba>29.10. Microsoft™Windows™ 用戶端檔案與列印服務 (Samba)</a></li><li><a href=#network-ntp>29.11. NTP 時間校對</a></li><li><a href=#network-iscsi>29.12. iSCSI Initiator 與 Target 設定</a></li></ul></nav></div><div class=book-content><div id=preamble><div class=sectionbody></div></div><div class=sect1><h2 id=network-servers-synopsis>29.1. 概述<a class=anchor href=#network-servers-synopsis></a></h2><div class=sectionbody><div class=paragraph><p>本章節涵蓋一些在 UNIX™ 系統常用的網路服務，包含安裝、設定、測試及維護各種不同類型的網路服務。本章會提供範例設定檔以供參考。</p></div><div class=paragraph><p>讀完本章，您將了解：</p></div><div class=ulist><ul><li><p>如何管理 inetd Daemon。</p></li><li><p>如何設定網路檔案系統 (Network File System, NFS)。</p></li><li><p>如何設定網路資訊伺服器 (Network Information Server, NIS) 來集中管理及共用使用者帳號。</p></li><li><p>如何設定 FreeBSD 成為 LDAP 伺服器或客戶端</p></li><li><p>如何設定使用 DHCP 自動網路設定。</p></li><li><p>如何設定網域名稱伺服器 (Domain Name Server, DNS)。</p></li><li><p>如何設定 ApacheHTTP 伺服器。</p></li><li><p>如何設定檔案傳輸協定 (File Transfer Protocol, FTP) 伺服器。</p></li><li><p>如何設定 Samba 檔案與列印伺服器供 Windows™ 客戶端使用。</p></li><li><p>如何同步時間與日期，並使用網路時間協定 (Network Time Protocol, NTP) 設定時間伺服器。</p></li><li><p>如何設定 iSCSI。</p></li></ul></div><div class=paragraph><p>本章假設您有以下基礎知識：</p></div><div class=ulist><ul><li><p><span class=filename>/etc/rc</span> Script。</p></li><li><p>網路術語。</p></li><li><p>安裝其他第三方軟體 (<a href=../ports/#ports>安裝應用程式：套件與 Port</a>)。</p></li></ul></div></div></div><div class=sect1><h2 id=network-inetd>29.2. inetd 超級伺服器<a class=anchor href=#network-inetd></a></h2><div class=sectionbody><div class=paragraph><p>The <a href="https://man.freebsd.org/cgi/man.cgi?query=inetd&amp;sektion=8&amp;format=html">inetd(8)</a> daemon is sometimes referred to as a Super-Server because it manages connections for many services. Instead of starting multiple applications, only the inetd service needs to be started. When a connection is received for a service that is managed by inetd, it determines which program the connection is destined for, spawns a process for that program, and delegates the program a socket. Using inetd for services that are not heavily used can reduce system load, when compared to running each daemon individually in stand-alone mode.</p></div><div class=paragraph><p>Primarily, inetd is used to spawn other daemons, but several trivial protocols are handled internally, such as chargen, auth, time, echo, discard, and daytime.</p></div><div class=paragraph><p>This section covers the basics of configuring inetd.</p></div><div class=sect2><h3 id=network-inetd-conf>29.2.1. 設定檔<a class=anchor href=#network-inetd-conf></a></h3><div class=paragraph><p>Configuration of inetd is done by editing <span class=filename>/etc/inetd.conf</span>. Each line of this configuration file represents an application which can be started by inetd. By default, every line starts with a comment (<code><mark></mark></code>), meaning that inetd is not listening for any applications. To configure inetd to listen for an application’s connections, remove the <code></code> at the beginning of the line for that application.</p></div><div class=paragraph><p>After saving your edits, configure inetd to start at system boot by editing <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>inetd_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>To start inetd now, so that it listens for the service you configured, type:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service inetd start</span></code></pre></div></div><div class=paragraph><p>Once inetd is started, it needs to be notified whenever a modification is made to <span class=filename>/etc/inetd.conf</span>:</p></div><div id=network-inetd-reread class=exampleblock><div class=title>例 1. 重新庫入 inetd 設定檔</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service inetd reload</span></code></pre></div></div></div></div><div class=paragraph><p>Typically, the default entry for an application does not need to be edited beyond removing the <code>#</code>. In some situations, it may be appropriate to edit the default entry.</p></div><div class=paragraph><p>As an example, this is the default entry for <a href="https://man.freebsd.org/cgi/man.cgi?query=ftpd&amp;sektion=8&amp;format=html">ftpd(8)</a> over IPv4:</p></div><div class="literalblock programlisting"><div class=content><pre>ftp     stream  tcp     nowait  root    /usr/libexec/ftpd       ftpd -l</pre></div></div><div class=paragraph><p>The seven columns in an entry are as follows:</p></div><div class="literalblock programlisting"><div class=content><pre>service-name
socket-type
protocol
{wait|nowait}[/max-child[/max-connections-per-ip-per-minute[/max-child-per-ip]]]
user[:group][/login-class]
server-program
server-program-arguments</pre></div></div><div class=paragraph><p>where:</p></div><div class=dlist><dl><dt class=hdlist1>service-name</dt><dd><p>The service name of the daemon to start. It must correspond to a service listed in <span class=filename>/etc/services</span>. This determines which port inetd listens on for incoming connections to that service. When using a custom service, it must first be added to <span class=filename>/etc/services</span>.</p></dd><dt class=hdlist1>socket-type</dt><dd><p>Either <code>stream</code>, <code>dgram</code>, <code>raw</code>, or <code>seqpacket</code>. Use <code>stream</code> for TCP connections and <code>dgram</code> for UDP services.</p></dd><dt class=hdlist1>protocol</dt><dd><p>Use one of the following protocol names:</p><table class="tableblock frame-none grid-all stretch informaltable"><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">Protocol Name</th><th class="tableblock halign-left valign-top">Explanation</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock>tcp or tcp4</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>TCP IPv4</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>udp or udp4</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>UDP IPv4</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>tcp6</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>TCP IPv6</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>udp6</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>UDP IPv6</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>tcp46</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Both TCP IPv4 and IPv6</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>udp46</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Both UDP IPv4 and IPv6</p></td></tr></tbody></table></dd><dt class=hdlist1>{wait|nowait}[/max-child[/max-connections-per-ip-per-minute[/max-child-per-ip]]]</dt><dd><p>In this field, <code>wait</code> or <code>nowait</code> must be specified. <code>max-child</code>, <code>max-connections-per-ip-per-minute</code> and <code>max-child-per-ip</code> are optional.</p><div class=paragraph><p><code>wait|nowait</code> indicates whether or not the service is able to handle its own socket. <code>dgram</code> socket types must use <code>wait</code> while <code>stream</code> daemons, which are usually multi-threaded, should use <code>nowait</code>. <code>wait</code> usually hands off multiple sockets to a single daemon, while <code>nowait</code> spawns a child daemon for each new socket.</p></div><div class=paragraph><p>The maximum number of child daemons inetd may spawn is set by <code>max-child</code>. For example, to limit ten instances of the daemon, place a <code>/10</code> after <code>nowait</code>. Specifying <code>/0</code> allows an unlimited number of children.</p></div><div class=paragraph><p><code>max-connections-per-ip-per-minute</code> limits the number of connections from any particular IP address per minute. Once the limit is reached, further connections from this IP address will be dropped until the end of the minute. For example, a value of <code>/10</code> would limit any particular IP address to ten connection attempts per minute. <code>max-child-per-ip</code> limits the number of child processes that can be started on behalf on any single IP address at any moment. These options can limit excessive resource consumption and help to prevent Denial of Service attacks.</p></div><div class=paragraph><p>An example can be seen in the default settings for <a href="https://man.freebsd.org/cgi/man.cgi?query=fingerd&amp;sektion=8&amp;format=html">fingerd(8)</a>:</p></div><div class="literalblock programlisting"><div class=content><pre>finger stream  tcp     nowait/3/10 nobody /usr/libexec/fingerd fingerd -k -s</pre></div></div></dd><dt class=hdlist1>user</dt><dd><p>The username the daemon will run as. Daemons typically run as <code>root</code>, <code>daemon</code>, or <code>nobody</code>.</p></dd><dt class=hdlist1>server-program</dt><dd><p>The full path to the daemon. If the daemon is a service provided by inetd internally, use <code>internal</code>.</p></dd><dt class=hdlist1>server-program-arguments</dt><dd><p>Used to specify any command arguments to be passed to the daemon on invocation. If the daemon is an internal service, use <code>internal</code>.</p></dd></dl></div></div><div class=sect2><h3 id=network-inetd-cmdline>29.2.2. 指令列選項<a class=anchor href=#network-inetd-cmdline></a></h3><div class=paragraph><p>Like most server daemons, inetd has a number of options that can be used to modify its behavior. By default, inetd is started with <code>-wW -C 60</code>. These options enable TCP wrappers for all services, including internal services, and prevent any IP address from requesting any service more than 60 times per minute.</p></div><div class=paragraph><p>To change the default options which are passed to inetd, add an entry for <code>inetd_flags</code> in <span class=filename>/etc/rc.conf</span>. If inetd is already running, restart it with <code>service inetd restart</code>.</p></div><div class=paragraph><p>The available rate limiting options are:</p></div><div class=dlist><dl><dt class=hdlist1>-c maximum</dt><dd><p>Specify the default maximum number of simultaneous invocations of each service, where the default is unlimited. May be overridden on a per-service basis by using <code>max-child</code> in <span class=filename>/etc/inetd.conf</span>.</p></dd><dt class=hdlist1>-C rate</dt><dd><p>Specify the default maximum number of times a service can be invoked from a single IP address per minute. May be overridden on a per-service basis by using <code>max-connections-per-ip-per-minute</code> in <span class=filename>/etc/inetd.conf</span>.</p></dd><dt class=hdlist1>-R rate</dt><dd><p>Specify the maximum number of times a service can be invoked in one minute, where the default is <code>256</code>. A rate of <code>0</code> allows an unlimited number.</p></dd><dt class=hdlist1>-s maximum</dt><dd><p>Specify the maximum number of times a service can be invoked from a single IP address at any one time, where the default is unlimited. May be overridden on a per-service basis by using <code>max-child-per-ip</code> in <span class=filename>/etc/inetd.conf</span>.</p></dd></dl></div><div class=paragraph><p>Additional options are available. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=inetd&amp;sektion=8&amp;format=html">inetd(8)</a> for the full list of options.</p></div></div><div class=sect2><h3 id=network-inetd-security>29.2.3. 安全注意事項<a class=anchor href=#network-inetd-security></a></h3><div class=paragraph><p>Many of the daemons which can be managed by inetd are not security-conscious. Some daemons, such as fingerd, can provide information that may be useful to an attacker. Only enable the services which are needed and monitor the system for excessive connection attempts. <code>max-connections-per-ip-per-minute</code>, <code>max-child</code> and <code>max-child-per-ip</code> can be used to limit such attacks.</p></div><div class=paragraph><p>By default, TCP wrappers is enabled. Consult <a href="https://man.freebsd.org/cgi/man.cgi?query=hosts_access&amp;sektion=5&amp;format=html">hosts_access(5)</a> for more information on placing TCP restrictions on various inetd invoked daemons.</p></div></div></div></div><div class=sect1><h2 id=network-nfs>29.3. 網路檔案系統 (NFS)<a class=anchor href=#network-nfs></a></h2><div class=sectionbody><div class=paragraph><p>FreeBSD supports the Network File System (NFS), which allows a server to share directories and files with clients over a network. With NFS, users and programs can access files on remote systems as if they were stored locally.</p></div><div class=paragraph><p>NFS has many practical uses. Some of the more common uses include:</p></div><div class=ulist><ul><li><p>Data that would otherwise be duplicated on each client can be kept in a single location and accessed by clients on the network.</p></li><li><p>Several clients may need access to the <span class=filename>/usr/ports/distfiles</span> directory. Sharing that directory allows for quick access to the source files without having to download them to each client.</p></li><li><p>On large networks, it is often more convenient to configure a central NFS server on which all user home directories are stored. Users can log into a client anywhere on the network and have access to their home directories.</p></li><li><p>Administration of NFS exports is simplified. For example, there is only one file system where security or backup policies must be set.</p></li><li><p>Removable media storage devices can be used by other machines on the network. This reduces the number of devices throughout the network and provides a centralized location to manage their security. It is often more convenient to install software on multiple machines from a centralized installation media.</p></li></ul></div><div class=paragraph><p>NFS consists of a server and one or more clients. The client remotely accesses the data that is stored on the server machine. In order for this to function properly, a few processes have to be configured and running.</p></div><div class=paragraph><p>These daemons must be running on the server:</p></div><table class="tableblock frame-none grid-all stretch informaltable"><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">Daemon</th><th class="tableblock halign-left valign-top">說明</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock>nfsd</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>The NFS daemon which services requests from NFS clients.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>mountd</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>The NFS mount daemon which carries out requests received from nfsd.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>rpcbind</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>This daemon allows NFS clients to discover which port the NFS server is using.</p></td></tr></tbody></table><div class=paragraph><p>Running <a href="https://man.freebsd.org/cgi/man.cgi?query=nfsiod&amp;sektion=8&amp;format=html">nfsiod(8)</a> on the client can improve performance, but is not required.</p></div><div class=sect2><h3 id=network-configuring-nfs>29.3.1. 設定伺服器<a class=anchor href=#network-configuring-nfs></a></h3><div class=paragraph><p>The file systems which the NFS server will share are specified in <span class=filename>/etc/exports</span>. Each line in this file specifies a file system to be exported, which clients have access to that file system, and any access options. When adding entries to this file, each exported file system, its properties, and allowed hosts must occur on a single line. If no clients are listed in the entry, then any client on the network can mount that file system.</p></div><div class=paragraph><p>The following <span class=filename>/etc/exports</span> entries demonstrate how to export file systems. The examples can be modified to match the file systems and client names on the reader’s network. There are many options that can be used in this file, but only a few will be mentioned here. See <a href="https://man.freebsd.org/cgi/man.cgi?query=exports&amp;sektion=5&amp;format=html">exports(5)</a> for the full list of options.</p></div><div class=paragraph><p>This example shows how to export <span class=filename>/cdrom</span> to three hosts named <em>alpha</em>, <em>bravo</em>, and <em>charlie</em>:</p></div><div class="literalblock programlisting"><div class=content><pre>/cdrom -ro alpha bravo charlie</pre></div></div><div class=paragraph><p>The <code>-ro</code> flag makes the file system read-only, preventing clients from making any changes to the exported file system. This example assumes that the host names are either in DNS or in <span class=filename>/etc/hosts</span>. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=hosts&amp;sektion=5&amp;format=html">hosts(5)</a> if the network does not have a DNS server.</p></div><div class=paragraph><p>The next example exports <span class=filename>/home</span> to three clients by IP address. This can be useful for networks without DNS or <span class=filename>/etc/hosts</span> entries. The <code>-alldirs</code> flag allows subdirectories to be mount points. In other words, it will not automatically mount the subdirectories, but will permit the client to mount the directories that are required as needed.</p></div><div class="literalblock programlisting"><div class=content><pre>/usr/home  -alldirs  10.0.0.2 10.0.0.3 10.0.0.4</pre></div></div><div class=paragraph><p>This next example exports <span class=filename>/a</span> so that two clients from different domains may access that file system. The <code>-maproot=root</code> allows <code>root</code> on the remote system to write data on the exported file system as <code>root</code>. If <code>-maproot=root</code> is not specified, the client’s <code>root</code> user will be mapped to the server’s <code>nobody</code> account and will be subject to the access limitations defined for <code>nobody</code>.</p></div><div class="literalblock programlisting"><div class=content><pre>/a  -maproot=root  host.example.com box.example.org</pre></div></div><div class=paragraph><p>A client can only be specified once per file system. For example, if <span class=filename>/usr</span> is a single file system, these entries would be invalid as both entries specify the same host:</p></div><div class="literalblock programlisting"><div class=content><pre># Invalid when /usr is one file system
/usr/src   client
/usr/ports client</pre></div></div><div class=paragraph><p>The correct format for this situation is to use one entry:</p></div><div class="literalblock programlisting"><div class=content><pre>/usr/src /usr/ports  client</pre></div></div><div class=paragraph><p>The following is an example of a valid export list, where <span class=filename>/usr</span> and <span class=filename>/exports</span> are local file systems:</p></div><div class="literalblock programlisting"><div class=content><pre># Export src and ports to client01 and client02, but only
# client01 has root privileges on it
/usr/src /usr/ports -maproot=root    client01
/usr/src /usr/ports               client02
# The client machines have root and can mount anywhere
# on /exports. Anyone in the world can mount /exports/obj read-only
/exports -alldirs -maproot=root      client01 client02
/exports/obj -ro</pre></div></div><div class=paragraph><p>To enable the processes required by the NFS server at boot time, add these options to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>rpcbind_enable=&#34;YES&#34;
nfs_server_enable=&#34;YES&#34;
mountd_flags=&#34;-r&#34;</pre></div></div><div class=paragraph><p>The server can be started now by running this command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service nfsd start</span></code></pre></div></div><div class=paragraph><p>Whenever the NFS server is started, mountd also starts automatically. However, mountd only reads <span class=filename>/etc/exports</span> when it is started. To make subsequent <span class=filename>/etc/exports</span> edits take effect immediately, force mountd to reread it:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service mountd reload</span></code></pre></div></div></div><div class=sect2><h3 id=_設定客戶端>29.3.2. 設定客戶端<a class=anchor href=#_設定客戶端></a></h3><div class=paragraph><p>To enable NFS clients, set this option in each client’s <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>nfs_client_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>Then, run this command on each NFS client:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service nfsclient start</span></code></pre></div></div><div class=paragraph><p>The client now has everything it needs to mount a remote file system. In these examples, the server’s name is <code>server</code> and the client’s name is <code>client</code>. To mount <span class=filename>/home</span> on <code>server</code> to the <span class=filename>/mnt</span> mount point on <code>client</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mount server:/home /mnt</span></code></pre></div></div><div class=paragraph><p>The files and directories in <span class=filename>/home</span> will now be available on <code>client</code>, in the <span class=filename>/mnt</span> directory.</p></div><div class=paragraph><p>To mount a remote file system each time the client boots, add it to <span class=filename>/etc/fstab</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>server:/home	/mnt	nfs	rw	0	0</pre></div></div><div class=paragraph><p>Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=fstab&amp;sektion=5&amp;format=html">fstab(5)</a> for a description of all available options.</p></div></div><div class=sect2><h3 id=_鎖定>29.3.3. 鎖定<a class=anchor href=#_鎖定></a></h3><div class=paragraph><p>Some applications require file locking to operate correctly. To enable locking, add these lines to <span class=filename>/etc/rc.conf</span> on both the client and server:</p></div><div class="literalblock programlisting"><div class=content><pre>rpc_lockd_enable=&#34;YES&#34;
rpc_statd_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>Then start the applications:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service lockd start</span>
<span class=c># service statd start</span></code></pre></div></div><div class=paragraph><p>If locking is not required on the server, the NFS client can be configured to lock locally by including <code>-L</code> when running mount. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=mount_nfs&amp;sektion=8&amp;format=html">mount_nfs(8)</a> for further details.</p></div></div><div class=sect2><h3 id=network-amd>29.3.4. 使用 <a href="https://man.freebsd.org/cgi/man.cgi?query=amd&amp;sektion=8&amp;format=html">amd(8)</a> 自動掛載<a class=anchor href=#network-amd></a></h3><div class=paragraph><p>The automatic mounter daemon, amd, automatically mounts a remote file system whenever a file or directory within that file system is accessed. File systems that are inactive for a period of time will be automatically unmounted by amd.</p></div><div class=paragraph><p>This daemon provides an alternative to modifying <span class=filename>/etc/fstab</span> to list every client. It operates by attaching itself as an NFS server to the <span class=filename>/host</span> and <span class=filename>/net</span> directories. When a file is accessed within one of these directories, amd looks up the corresponding remote mount and automatically mounts it. <span class=filename>/net</span> is used to mount an exported file system from an IP address while <span class=filename>/host</span> is used to mount an export from a remote hostname. For instance, an attempt to access a file within <span class=filename>/host/foobar/usr</span> would tell amd to mount the <span class=filename>/usr</span> export on the host <code>foobar</code>.</p></div><div class=exampleblock><div class=title>例 2. 使用 amd 掛載 Export</div><div class=content><div class=paragraph><p>In this example, <code>showmount -e</code> shows the exported file systems that can be mounted from the NFS server, <code>foobar</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% showmount <span class=nt>-e</span> foobar
Exports list on foobar:
/usr                               10.10.10.0
/a                                 10.10.10.0
% <span class=nb>cd</span> /host/foobar/usr</code></pre></div></div></div></div><div class=paragraph><p>The output from <code>showmount</code> shows <span class=filename>/usr</span> as an export. When changing directories to <span class=filename>/host/foobar/usr</span>, amd intercepts the request and attempts to resolve the hostname <code>foobar</code>. If successful, amd automatically mounts the desired export.</p></div><div class=paragraph><p>To enable amd at boot time, add this line to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>amd_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>To start amd now:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service amd start</span></code></pre></div></div><div class=paragraph><p>Custom flags can be passed to amd from the <code>amd_flags</code> environment variable. By default, <code>amd_flags</code> is set to:</p></div><div class="literalblock programlisting"><div class=content><pre>amd_flags=&#34;-a /.amd_mnt -l syslog /host /etc/amd.map /net /etc/amd.map&#34;</pre></div></div><div class=paragraph><p>The default options with which exports are mounted are defined in <span class=filename>/etc/amd.map</span>. Some of the more advanced features of amd are defined in <span class=filename>/etc/amd.conf</span>.</p></div><div class=paragraph><p>Consult <a href="https://man.freebsd.org/cgi/man.cgi?query=amd&amp;sektion=8&amp;format=html">amd(8)</a> and <a href="https://man.freebsd.org/cgi/man.cgi?query=amd.conf&amp;sektion=5&amp;format=html">amd.conf(5)</a> for more information.</p></div></div><div class=sect2><h3 id=network-autofs>29.3.5. 使用 <a href="https://man.freebsd.org/cgi/man.cgi?query=autofs&amp;sektion=5&amp;format=html">autofs(5)</a> 自動掛載<a class=anchor href=#network-autofs></a></h3><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>The <a href="https://man.freebsd.org/cgi/man.cgi?query=autofs&amp;sektion=5&amp;format=html">autofs(5)</a> automount facility is supported starting with FreeBSD 10.1-RELEASE. To use the automounter functionality in older versions of FreeBSD, use <a href="https://man.freebsd.org/cgi/man.cgi?query=amd&amp;sektion=8&amp;format=html">amd(8)</a> instead. This chapter only describes the <a href="https://man.freebsd.org/cgi/man.cgi?query=autofs&amp;sektion=5&amp;format=html">autofs(5)</a> automounter.</p></div></td></tr></tbody></table></div><div class=paragraph><p>The <a href="https://man.freebsd.org/cgi/man.cgi?query=autofs&amp;sektion=5&amp;format=html">autofs(5)</a> facility is a common name for several components that, together, allow for automatic mounting of remote and local filesystems whenever a file or directory within that file system is accessed. It consists of the kernel component, <a href="https://man.freebsd.org/cgi/man.cgi?query=autofs&amp;sektion=5&amp;format=html">autofs(5)</a>, and several userspace applications: <a href="https://man.freebsd.org/cgi/man.cgi?query=automount&amp;sektion=8&amp;format=html">automount(8)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=automountd&amp;sektion=8&amp;format=html">automountd(8)</a> and <a href="https://man.freebsd.org/cgi/man.cgi?query=autounmountd&amp;sektion=8&amp;format=html">autounmountd(8)</a>. It serves as an alternative for <a href="https://man.freebsd.org/cgi/man.cgi?query=amd&amp;sektion=8&amp;format=html">amd(8)</a> from previous FreeBSD releases. Amd is still provided for backward compatibility purposes, as the two use different map format; the one used by autofs is the same as with other SVR4 automounters, such as the ones in Solaris, MacOS X, and Linux.</p></div><div class=paragraph><p>The <a href="https://man.freebsd.org/cgi/man.cgi?query=autofs&amp;sektion=5&amp;format=html">autofs(5)</a> virtual filesystem is mounted on specified mountpoints by <a href="https://man.freebsd.org/cgi/man.cgi?query=automount&amp;sektion=8&amp;format=html">automount(8)</a>, usually invoked during boot.</p></div><div class=paragraph><p>Whenever a process attempts to access file within the <a href="https://man.freebsd.org/cgi/man.cgi?query=autofs&amp;sektion=5&amp;format=html">autofs(5)</a> mountpoint, the kernel will notify <a href="https://man.freebsd.org/cgi/man.cgi?query=automountd&amp;sektion=8&amp;format=html">automountd(8)</a> daemon and pause the triggering process. The <a href="https://man.freebsd.org/cgi/man.cgi?query=automountd&amp;sektion=8&amp;format=html">automountd(8)</a> daemon will handle kernel requests by finding the proper map and mounting the filesystem according to it, then signal the kernel to release blocked process. The <a href="https://man.freebsd.org/cgi/man.cgi?query=autounmountd&amp;sektion=8&amp;format=html">autounmountd(8)</a> daemon automatically unmounts automounted filesystems after some time, unless they are still being used.</p></div><div class=paragraph><p>The primary autofs configuration file is <span class=filename>/etc/auto_master</span>. It assigns individual maps to top-level mounts. For an explanation of <span class=filename>auto_master</span> and the map syntax, refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=auto_master&amp;sektion=5&amp;format=html">auto_master(5)</a>.</p></div><div class=paragraph><p>There is a special automounter map mounted on <span class=filename>/net</span>. When a file is accessed within this directory, <a href="https://man.freebsd.org/cgi/man.cgi?query=autofs&amp;sektion=5&amp;format=html">autofs(5)</a> looks up the corresponding remote mount and automatically mounts it. For instance, an attempt to access a file within <span class=filename>/net/foobar/usr</span> would tell <a href="https://man.freebsd.org/cgi/man.cgi?query=automountd&amp;sektion=8&amp;format=html">automountd(8)</a> to mount the <span class=filename>/usr</span> export from the host <code>foobar</code>.</p></div><div class=exampleblock><div class=title>例 3. 使用 <a href="https://man.freebsd.org/cgi/man.cgi?query=autofs&amp;sektion=5&amp;format=html">autofs(5)</a> 掛載 Export</div><div class=content><div class=paragraph><p>In this example, <code>showmount -e</code> shows the exported file systems that can be mounted from the NFS server, <code>foobar</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% showmount <span class=nt>-e</span> foobar
Exports list on foobar:
/usr                               10.10.10.0
/a                                 10.10.10.0
% <span class=nb>cd</span> /net/foobar/usr</code></pre></div></div></div></div><div class=paragraph><p>The output from <code>showmount</code> shows <span class=filename>/usr</span> as an export. When changing directories to <span class=filename>/host/foobar/usr</span>, <a href="https://man.freebsd.org/cgi/man.cgi?query=automountd&amp;sektion=8&amp;format=html">automountd(8)</a> intercepts the request and attempts to resolve the hostname <code>foobar</code>. If successful, <a href="https://man.freebsd.org/cgi/man.cgi?query=automountd&amp;sektion=8&amp;format=html">automountd(8)</a> automatically mounts the source export.</p></div><div class=paragraph><p>To enable <a href="https://man.freebsd.org/cgi/man.cgi?query=autofs&amp;sektion=5&amp;format=html">autofs(5)</a> at boot time, add this line to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>autofs_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>Then <a href="https://man.freebsd.org/cgi/man.cgi?query=autofs&amp;sektion=5&amp;format=html">autofs(5)</a> can be started by running:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service automount start</span>
<span class=c># service automountd start</span>
<span class=c># service autounmountd start</span></code></pre></div></div><div class=paragraph><p>The <a href="https://man.freebsd.org/cgi/man.cgi?query=autofs&amp;sektion=5&amp;format=html">autofs(5)</a> map format is the same as in other operating systems. Information about this format from other sources can be useful, like the <a href=http://web.archive.org/web/20160813071113/http://images.apple.com/business/docs/Autofs.pdf>Mac OS X document</a>.</p></div><div class=paragraph><p>Consult the <a href="https://man.freebsd.org/cgi/man.cgi?query=automount&amp;sektion=8&amp;format=html">automount(8)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=automountd&amp;sektion=8&amp;format=html">automountd(8)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=autounmountd&amp;sektion=8&amp;format=html">autounmountd(8)</a>, and <a href="https://man.freebsd.org/cgi/man.cgi?query=auto_master&amp;sektion=5&amp;format=html">auto_master(5)</a> manual pages for more information.</p></div></div></div></div><div class=sect1><h2 id=network-nis>29.4. 網路資訊系統 (NIS)<a class=anchor href=#network-nis></a></h2><div class=sectionbody><div class=paragraph><p>Network Information System (NIS) is designed to centralize administration of UNIX™-like systems such as Solaris™, HP-UX, AIX™, Linux, NetBSD, OpenBSD, and FreeBSD. NIS was originally known as Yellow Pages but the name was changed due to trademark issues. This is the reason why NIS commands begin with <code>yp</code>.</p></div><div class=paragraph><p>NIS is a Remote Procedure Call (RPC)-based client/server system that allows a group of machines within an NIS domain to share a common set of configuration files. This permits a system administrator to set up NIS client systems with only minimal configuration data and to add, remove, or modify configuration data from a single location.</p></div><div class=paragraph><p>FreeBSD uses version 2 of the NIS protocol.</p></div><div class=sect2><h3 id=_nis_術語與程序>29.4.1. NIS 術語與程序<a class=anchor href=#_nis_術語與程序></a></h3><div class=paragraph><p>Table 28.1 summarizes the terms and important processes used by NIS:</p></div><table class="tableblock frame-none grid-all stretch"><caption class=title>表 1. NIS 術語</caption><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">術語</th><th class="tableblock halign-left valign-top">說明</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock>NIS domain name</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>NIS servers and clients share an NIS domain name. Typically, this name does not have anything to do with DNS.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href="https://man.freebsd.org/cgi/man.cgi?query=rpcbind&amp;sektion=8&amp;format=html">rpcbind(8)</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>This service enables RPC and must be running in order to run an NIS server or act as an NIS client.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href="https://man.freebsd.org/cgi/man.cgi?query=ypbind&amp;sektion=8&amp;format=html">ypbind(8)</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>This service binds an NIS client to its NIS server. It will take the NIS domain name and use RPC to connect to the server. It is the core of client/server communication in an NIS environment. If this service is not running on a client machine, it will not be able to access the NIS server.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href="https://man.freebsd.org/cgi/man.cgi?query=ypserv&amp;sektion=8&amp;format=html">ypserv(8)</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>This is the process for the NIS server. If this service stops running, the server will no longer be able to respond to NIS requests so hopefully, there is a slave server to take over. Some non-FreeBSD clients will not try to reconnect using a slave server and the ypbind process may need to be restarted on these clients.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><a href="https://man.freebsd.org/cgi/man.cgi?query=rpc.yppasswdd&amp;sektion=8&amp;format=html">rpc.yppasswdd(8)</a></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>This process only runs on NIS master servers. This daemon allows NIS clients to change their NIS passwords. If this daemon is not running, users will have to login to the NIS master server and change their passwords there.</p></td></tr></tbody></table></div><div class=sect2><h3 id=_主機類型>29.4.2. 主機類型<a class=anchor href=#_主機類型></a></h3><div class=paragraph><p>There are three types of hosts in an NIS environment:</p></div><div class=ulist><ul><li><p>NIS master server</p><div class=paragraph><p>This server acts as a central repository for host configuration information and maintains the authoritative copy of the files used by all of the NIS clients. The <span class=filename>passwd</span>, <span class=filename>group</span>, and other various files used by NIS clients are stored on the master server. While it is possible for one machine to be an NIS master server for more than one NIS domain, this type of configuration will not be covered in this chapter as it assumes a relatively small-scale NIS environment.</p></div></li><li><p>NIS slave servers</p><div class=paragraph><p>NIS slave servers maintain copies of the NIS master’s data files in order to provide redundancy. Slave servers also help to balance the load of the master server as NIS clients always attach to the NIS server which responds first.</p></div></li><li><p>NIS clients</p><div class=paragraph><p>NIS clients authenticate against the NIS server during log on.</p></div></li></ul></div><div class=paragraph><p>Information in many files can be shared using NIS. The <span class=filename>master.passwd</span>, <span class=filename>group</span>, and <span class=filename>hosts</span> files are commonly shared via NIS. Whenever a process on a client needs information that would normally be found in these files locally, it makes a query to the NIS server that it is bound to instead.</p></div></div><div class=sect2><h3 id=_規劃注意事項>29.4.3. 規劃注意事項<a class=anchor href=#_規劃注意事項></a></h3><div class=paragraph><p>This section describes a sample NIS environment which consists of 15 FreeBSD machines with no centralized point of administration. Each machine has its own <span class=filename>/etc/passwd</span> and <span class=filename>/etc/master.passwd</span>. These files are kept in sync with each other only through manual intervention. Currently, when a user is added to the lab, the process must be repeated on all 15 machines.</p></div><div class=paragraph><p>The configuration of the lab will be as follows:</p></div><table class="tableblock frame-none grid-all stretch informaltable"><col style=width:33.3333%><col style=width:33.3333%><col style=width:33.3334%><thead><tr><th class="tableblock halign-left valign-top">Machine name</th><th class="tableblock halign-left valign-top">IP 位址</th><th class="tableblock halign-left valign-top">Machine role</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>ellington</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>10.0.0.2</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>NIS master</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>coltrane</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>10.0.0.3</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>NIS slave</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>basie</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>10.0.0.4</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Faculty workstation</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>bird</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>10.0.0.5</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Client machine</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>cli[1-11]</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>10.0.0.[6-17]</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Other client machines</p></td></tr></tbody></table><div class=paragraph><p>If this is the first time an NIS scheme is being developed, it should be thoroughly planned ahead of time. Regardless of network size, several decisions need to be made as part of the planning process.</p></div><div class=sect3><h4 id=_選擇_nis_網域名稱>29.4.3.1. 選擇 NIS 網域名稱<a class=anchor href=#_選擇_nis_網域名稱></a></h4><div class=paragraph><p>When a client broadcasts its requests for info, it includes the name of the NIS domain that it is part of. This is how multiple servers on one network can tell which server should answer which request. Think of the NIS domain name as the name for a group of hosts.</p></div><div class=paragraph><p>Some organizations choose to use their Internet domain name for their NIS domain name. This is not recommended as it can cause confusion when trying to debug network problems. The NIS domain name should be unique within the network and it is helpful if it describes the group of machines it represents. For example, the Art department at Acme Inc. might be in the "acme-art"NIS domain. This example will use the domain name <code>test-domain</code>.</p></div><div class=paragraph><p>However, some non-FreeBSD operating systems require the NIS domain name to be the same as the Internet domain name. If one or more machines on the network have this restriction, the Internet domain name <em>must</em> be used as the NIS domain name.</p></div></div><div class=sect3><h4 id=_實體伺服器需求>29.4.3.2. 實體伺服器需求<a class=anchor href=#_實體伺服器需求></a></h4><div class=paragraph><p>There are several things to keep in mind when choosing a machine to use as a NIS server. Since NIS clients depend upon the availability of the server, choose a machine that is not rebooted frequently. The NIS server should ideally be a stand alone machine whose sole purpose is to be an NIS server. If the network is not heavily used, it is acceptable to put the NIS server on a machine running other services. However, if the NIS server becomes unavailable, it will adversely affect all NIS clients.</p></div></div></div><div class=sect2><h3 id=_設定_nis_master_伺服器>29.4.4. 設定 NIS Master 伺服器<a class=anchor href=#_設定_nis_master_伺服器></a></h3><div class=paragraph><p>The canonical copies of all NIS files are stored on the master server. The databases used to store the information are called NIS maps. In FreeBSD, these maps are stored in <span class=filename>/var/yp/[domainname]</span> where <span class=filename>[domainname]</span> is the name of the NIS domain. Since multiple domains are supported, it is possible to have several directories, one for each domain. Each domain will have its own independent set of maps.</p></div><div class=paragraph><p>NIS master and slave servers handle all NIS requests through <a href="https://man.freebsd.org/cgi/man.cgi?query=ypserv&amp;sektion=8&amp;format=html">ypserv(8)</a>. This daemon is responsible for receiving incoming requests from NIS clients, translating the requested domain and map name to a path to the corresponding database file, and transmitting data from the database back to the client.</p></div><div class=paragraph><p>Setting up a master NIS server can be relatively straight forward, depending on environmental needs. Since FreeBSD provides built-in NIS support, it only needs to be enabled by adding the following lines to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>nisdomainname=&#34;test-domain&#34;	<i class=conum data-value=1></i><b>(1)</b>
nis_server_enable=&#34;YES&#34;		<i class=conum data-value=2></i><b>(2)</b>
nis_yppasswdd_enable=&#34;YES&#34;	<i class=conum data-value=3></i><b>(3)</b></pre></div></div><div class="colist arabic"><table><tbody><tr><td><i class=conum data-value=1></i><b>1</b></td><td>This line sets the NIS domain name to <code>test-domain</code>.</td></tr><tr><td><i class=conum data-value=2></i><b>2</b></td><td>This automates the start up of the NIS server processes when the system boots.</td></tr><tr><td><i class=conum data-value=3></i><b>3</b></td><td>This enables the <a href="https://man.freebsd.org/cgi/man.cgi?query=rpc.yppasswdd&amp;sektion=8&amp;format=html">rpc.yppasswdd(8)</a> daemon so that users can change their NIS password from a client machine.</td></tr></tbody></table></div><div class=paragraph><p>Care must be taken in a multi-server domain where the server machines are also NIS clients. It is generally a good idea to force the servers to bind to themselves rather than allowing them to broadcast bind requests and possibly become bound to each other. Strange failure modes can result if one server goes down and others are dependent upon it. Eventually, all the clients will time out and attempt to bind to other servers, but the delay involved can be considerable and the failure mode is still present since the servers might bind to each other all over again.</p></div><div class=paragraph><p>A server that is also a client can be forced to bind to a particular server by adding these additional lines to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>nis_client_enable=&#34;YES&#34; # run client stuff as well
nis_client_flags=&#34;-S NIS domain,server&#34;</pre></div></div><div class=paragraph><p>After saving the edits, type <code>/etc/netstart</code> to restart the network and apply the values defined in <span class=filename>/etc/rc.conf</span>. Before initializing the NIS maps, start <a href="https://man.freebsd.org/cgi/man.cgi?query=ypserv&amp;sektion=8&amp;format=html">ypserv(8)</a>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service ypserv start</span></code></pre></div></div><div class=sect3><h4 id=_初始化_nis_對應表>29.4.4.1. 初始化 NIS 對應表<a class=anchor href=#_初始化_nis_對應表></a></h4><div class=paragraph><p>NIS maps are generated from the configuration files in <span class=filename>/etc</span> on the NIS master, with one exception: <span class=filename>/etc/master.passwd</span>. This is to prevent the propagation of passwords to all the servers in the NIS domain. Therefore, before the NIS maps are initialized, configure the primary password files:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cp /etc/master.passwd /var/yp/master.passwd</span>
<span class=c># cd /var/yp</span>
<span class=c># vi master.passwd</span></code></pre></div></div><div class=paragraph><p>It is advisable to remove all entries for system accounts as well as any user accounts that do not need to be propagated to the NIS clients, such as the <code>root</code> and any other administrative accounts.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Ensure that the <span class=filename>/var/yp/master.passwd</span> is neither group or world readable by setting its permissions to <code>600</code>.</p></div></td></tr></tbody></table></div><div class=paragraph><p>After completing this task, initialize the NIS maps. FreeBSD includes the <a href="https://man.freebsd.org/cgi/man.cgi?query=ypinit&amp;sektion=8&amp;format=html">ypinit(8)</a> script to do this. When generating maps for the master server, include <code>-m</code> and specify the NIS domain name:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>ellington# ypinit <span class=nt>-m</span> test-domain
Server Type: MASTER Domain: test-domain
Creating an YP server will require that you answer a few questions.
Questions will all be asked at the beginning of the procedure.
Do you want this procedure to quit on non-fatal errors? <span class=o>[</span>y/n: n] n
Ok, please remember to go back and redo manually whatever fails.
If not, something might not work.
At this point, we have to construct a list of this domains YP servers.
rod.darktech.org is already known as master server.
Please <span class=k>continue </span>to add any slave servers, one per line. When you are
<span class=k>done </span>with the list, <span class=nb>type </span>a &lt;control D&gt;.
master server   :  ellington
next host to add:  coltrane
next host to add:  ^D
The current list of NIS servers looks like this:
ellington
coltrane
Is this correct?  <span class=o>[</span>y/n: y] y

<span class=o>[</span>..output from map generation..]

NIS Map update completed.
ellington has been setup as an YP master server without any errors.</code></pre></div></div><div class=paragraph><p>This will create <span class=filename>/var/yp/Makefile</span> from <span class=filename>/var/yp/Makefile.dist</span>. By default, this file assumes that the environment has a single NIS server with only FreeBSD clients. Since <code>test-domain</code> has a slave server, edit this line in <span class=filename>/var/yp/Makefile</span> so that it begins with a comment (<code>#</code>):</p></div><div class="literalblock programlisting"><div class=content><pre>NOPUSH = &#34;True&#34;</pre></div></div></div><div class=sect3><h4 id=_新增使用者>29.4.4.2. 新增使用者<a class=anchor href=#_新增使用者></a></h4><div class=paragraph><p>Every time a new user is created, the user account must be added to the master NIS server and the NIS maps rebuilt. Until this occurs, the new user will not be able to login anywhere except on the NIS master. For example, to add the new user <code>jsmith</code> to the <code>test-domain</code> domain, run these commands on the master server:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pw useradd jsmith</span>
<span class=c># cd /var/yp</span>
<span class=c># make test-domain</span></code></pre></div></div><div class=paragraph><p>The user could also be added using <code>adduser jsmith</code> instead of <code>pw useradd smith</code>.</p></div></div></div><div class=sect2><h3 id=_設定_nis_slave_伺服器>29.4.5. 設定 NIS Slave 伺服器<a class=anchor href=#_設定_nis_slave_伺服器></a></h3><div class=paragraph><p>To set up an NIS slave server, log on to the slave server and edit <span class=filename>/etc/rc.conf</span> as for the master server. Do not generate any NIS maps, as these already exist on the master server. When running <code>ypinit</code> on the slave server, use <code>-s</code> (for slave) instead of <code>-m</code> (for master). This option requires the name of the NIS master in addition to the domain name, as seen in this example:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>coltrane# ypinit <span class=nt>-s</span> ellington test-domain

Server Type: SLAVE Domain: test-domain Master: ellington

Creating an YP server will require that you answer a few questions.
Questions will all be asked at the beginning of the procedure.

Do you want this procedure to quit on non-fatal errors? <span class=o>[</span>y/n: n]  n

Ok, please remember to go back and redo manually whatever fails.
If not, something might not work.
There will be no further questions. The remainder of the procedure
should take a few minutes, to copy the databases from ellington.
Transferring netgroup...
ypxfr: Exiting: Map successfully transferred
Transferring netgroup.byuser...
ypxfr: Exiting: Map successfully transferred
Transferring netgroup.byhost...
ypxfr: Exiting: Map successfully transferred
Transferring master.passwd.byuid...
ypxfr: Exiting: Map successfully transferred
Transferring passwd.byuid...
ypxfr: Exiting: Map successfully transferred
Transferring passwd.byname...
ypxfr: Exiting: Map successfully transferred
Transferring group.bygid...
ypxfr: Exiting: Map successfully transferred
Transferring group.byname...
ypxfr: Exiting: Map successfully transferred
Transferring services.byname...
ypxfr: Exiting: Map successfully transferred
Transferring rpc.bynumber...
ypxfr: Exiting: Map successfully transferred
Transferring rpc.byname...
ypxfr: Exiting: Map successfully transferred
Transferring protocols.byname...
ypxfr: Exiting: Map successfully transferred
Transferring master.passwd.byname...
ypxfr: Exiting: Map successfully transferred
Transferring networks.byname...
ypxfr: Exiting: Map successfully transferred
Transferring networks.byaddr...
ypxfr: Exiting: Map successfully transferred
Transferring netid.byname...
ypxfr: Exiting: Map successfully transferred
Transferring hosts.byaddr...
ypxfr: Exiting: Map successfully transferred
Transferring protocols.bynumber...
ypxfr: Exiting: Map successfully transferred
Transferring ypservers...
ypxfr: Exiting: Map successfully transferred
Transferring hosts.byname...
ypxfr: Exiting: Map successfully transferred

coltrane has been setup as an YP slave server without any errors.
Remember to update map ypservers on ellington.</code></pre></div></div><div class=paragraph><p>This will generate a directory on the slave server called <span class=filename>/var/yp/test-domain</span> which contains copies of the NIS master server’s maps. Adding these <span class=filename>/etc/crontab</span> entries on each slave server will force the slaves to sync their maps with the maps on the master server:</p></div><div class="literalblock programlisting"><div class=content><pre>20      *       *       *       *       root   /usr/libexec/ypxfr passwd.byname
21      *       *       *       *       root   /usr/libexec/ypxfr passwd.byuid</pre></div></div><div class=paragraph><p>These entries are not mandatory because the master server automatically attempts to push any map changes to its slaves. However, since clients may depend upon the slave server to provide correct password information, it is recommended to force frequent password map updates. This is especially important on busy networks where map updates might not always complete.</p></div><div class=paragraph><p>To finish the configuration, run <code>/etc/netstart</code> on the slave server in order to start the NIS services.</p></div></div><div class=sect2><h3 id=_設定_nis_客戶端>29.4.6. 設定 NIS 客戶端<a class=anchor href=#_設定_nis_客戶端></a></h3><div class=paragraph><p>An NIS client binds to an NIS server using <a href="https://man.freebsd.org/cgi/man.cgi?query=ypbind&amp;sektion=8&amp;format=html">ypbind(8)</a>. This daemon broadcasts RPC requests on the local network. These requests specify the domain name configured on the client. If an NIS server in the same domain receives one of the broadcasts, it will respond to ypbind, which will record the server’s address. If there are several servers available, the client will use the address of the first server to respond and will direct all of its NIS requests to that server. The client will automatically ping the server on a regular basis to make sure it is still available. If it fails to receive a reply within a reasonable amount of time, ypbind will mark the domain as unbound and begin broadcasting again in the hopes of locating another server.</p></div><div class=paragraph><p>To configure a FreeBSD machine to be an NIS client:</p></div><div class="exampleblock procedure"><div class=content><div class="olist arabic"><ol class=arabic><li><p>Edit <span class=filename>/etc/rc.conf</span> and add the following lines in order to set the NIS domain name and start <a href="https://man.freebsd.org/cgi/man.cgi?query=ypbind&amp;sektion=8&amp;format=html">ypbind(8)</a> during network startup:</p><div class="literalblock programlisting"><div class=content><pre>nisdomainname=&#34;test-domain&#34;
nis_client_enable=&#34;YES&#34;</pre></div></div></li><li><p>To import all possible password entries from the NIS server, use <code>vipw</code> to remove all user accounts except one from <span class=filename>/etc/master.passwd</span>. When removing the accounts, keep in mind that at least one local account should remain and this account should be a member of <code>wheel</code>. If there is a problem with NIS, this local account can be used to log in remotely, become the superuser, and fix the problem. Before saving the edits, add the following line to the end of the file:</p><div class="literalblock programlisting"><div class=content><pre>+:::::::::</pre></div></div><div class=paragraph><p>This line configures the client to provide anyone with a valid account in the NIS server’s password maps an account on the client. There are many ways to configure the NIS client by modifying this line. One method is described in <a href=#network-netgroups>使用 Netgroups</a>. For more detailed reading, refer to the book <code>Managing NFS and NIS</code>, published by O’Reilly Media.</p></div></li><li><p>To import all possible group entries from the NIS server, add this line to <span class=filename>/etc/group</span>:</p><div class="literalblock programlisting"><div class=content><pre>+:*::</pre></div></div></li></ol></div></div></div><div class=paragraph><p>To start the NIS client immediately, execute the following commands as the superuser:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># /etc/netstart</span>
<span class=c># service ypbind start</span></code></pre></div></div><div class=paragraph><p>After completing these steps, running <code>ypcat passwd</code> on the client should show the server’s <span class=filename>passwd</span> map.</p></div></div><div class=sect2><h3 id=_nis_安全性>29.4.7. NIS 安全性<a class=anchor href=#_nis_安全性></a></h3><div class=paragraph><p>Since RPC is a broadcast-based service, any system running ypbind within the same domain can retrieve the contents of the NIS maps. To prevent unauthorized transactions, <a href="https://man.freebsd.org/cgi/man.cgi?query=ypserv&amp;sektion=8&amp;format=html">ypserv(8)</a> supports a feature called "securenets" which can be used to restrict access to a given set of hosts. By default, this information is stored in <span class=filename>/var/yp/securenets</span>, unless <a href="https://man.freebsd.org/cgi/man.cgi?query=ypserv&amp;sektion=8&amp;format=html">ypserv(8)</a> is started with <code>-p</code> and an alternate path. This file contains entries that consist of a network specification and a network mask separated by white space. Lines starting with <code>#</code> are considered to be comments. A sample <span class=filename>securenets</span> might look like this:</p></div><div class="literalblock programlisting"><div class=content><pre># allow connections from local host -- mandatory
127.0.0.1     255.255.255.255
# allow connections from any host
# on the 192.168.128.0 network
192.168.128.0 255.255.255.0
# allow connections from any host
# between 10.0.0.0 to 10.0.15.255
# this includes the machines in the testlab
10.0.0.0      255.255.240.0</pre></div></div><div class=paragraph><p>If <a href="https://man.freebsd.org/cgi/man.cgi?query=ypserv&amp;sektion=8&amp;format=html">ypserv(8)</a> receives a request from an address that matches one of these rules, it will process the request normally. If the address fails to match a rule, the request will be ignored and a warning message will be logged. If the <span class=filename>securenets</span> does not exist, <code>ypserv</code> will allow connections from any host.</p></div><div class=paragraph><p><a href=../security/#tcpwrappers>TCP Wrapper</a> is an alternate mechanism for providing access control instead of <span class=filename>securenets</span>. While either access control mechanism adds some security, they are both vulnerable to "IP spoofing" attacks. All NIS-related traffic should be blocked at the firewall.</p></div><div class=paragraph><p>Servers using <span class=filename>securenets</span> may fail to serve legitimate NIS clients with archaic TCP/IP implementations. Some of these implementations set all host bits to zero when doing broadcasts or fail to observe the subnet mask when calculating the broadcast address. While some of these problems can be fixed by changing the client configuration, other problems may force the retirement of these client systems or the abandonment of <span class=filename>securenets</span>.</p></div><div class=paragraph><p>The use of TCP Wrapper increases the latency of the NIS server. The additional delay may be long enough to cause timeouts in client programs, especially in busy networks with slow NIS servers. If one or more clients suffer from latency, convert those clients into NIS slave servers and force them to bind to themselves.</p></div><div class=sect3><h4 id=_阻擋部份使用者>29.4.7.1. 阻擋部份使用者<a class=anchor href=#_阻擋部份使用者></a></h4><div class=paragraph><p>In this example, the <code>basie</code> system is a faculty workstation within the NIS domain. The <span class=filename>passwd</span> map on the master NIS server contains accounts for both faculty and students. This section demonstrates how to allow faculty logins on this system while refusing student logins.</p></div><div class=paragraph><p>To prevent specified users from logging on to a system, even if they are present in the NIS database, use <code>vipw</code> to add <code>-<em>username</em></code> with the correct number of colons towards the end of <span class=filename>/etc/master.passwd</span> on the client, where <em>username</em> is the username of a user to bar from logging in. The line with the blocked user must be before the <code>+</code> line that allows NIS users. In this example, <code>bill</code> is barred from logging on to <code>basie</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>basie# <span class=nb>cat</span> /etc/master.passwd
root:[password]:0:0::0:0:The super-user:/root:/bin/csh
toor:[password]:0:0::0:0:The other super-user:/root:/bin/sh
daemon:<span class=k>*</span>:1:1::0:0:Owner of many system processes:/root:/usr/sbin/nologin
operator:<span class=k>*</span>:2:5::0:0:System &amp;:/:/usr/sbin/nologin
bin:<span class=k>*</span>:3:7::0:0:Binaries Commands and Source,,,:/:/usr/sbin/nologin
<span class=nb>tty</span>:<span class=k>*</span>:4:65533::0:0:Tty Sandbox:/:/usr/sbin/nologin
kmem:<span class=k>*</span>:5:65533::0:0:KMem Sandbox:/:/usr/sbin/nologin
games:<span class=k>*</span>:7:13::0:0:Games pseudo-user:/usr/games:/usr/sbin/nologin
news:<span class=k>*</span>:8:8::0:0:News Subsystem:/:/usr/sbin/nologin
man:<span class=k>*</span>:9:9::0:0:Mister Man Pages:/usr/shared/man:/usr/sbin/nologin
<span class=nb>bind</span>:<span class=k>*</span>:53:53::0:0:Bind Sandbox:/:/usr/sbin/nologin
uucp:<span class=k>*</span>:66:66::0:0:UUCP pseudo-user:/var/spool/uucppublic:/usr/libexec/uucp/uucico
xten:<span class=k>*</span>:67:67::0:0:X-10 daemon:/usr/local/xten:/usr/sbin/nologin
pop:<span class=k>*</span>:68:6::0:0:Post Office Owner:/nonexistent:/usr/sbin/nologin
nobody:<span class=k>*</span>:65534:65534::0:0:Unprivileged user:/nonexistent:/usr/sbin/nologin
<span class=nt>-bill</span>:::::::::
+:::::::::

basie#</code></pre></div></div></div></div><div class=sect2><h3 id=network-netgroups>29.4.8. 使用 Netgroups<a class=anchor href=#network-netgroups></a></h3><div class=paragraph><p>Barring specified users from logging on to individual systems becomes unscaleable on larger networks and quickly loses the main benefit of NIS: <em>centralized</em> administration.</p></div><div class=paragraph><p>Netgroups were developed to handle large, complex networks with hundreds of users and machines. Their use is comparable to UNIX™ groups, where the main difference is the lack of a numeric ID and the ability to define a netgroup by including both user accounts and other netgroups.</p></div><div class=paragraph><p>To expand on the example used in this chapter, the NIS domain will be extended to add the users and systems shown in Tables 28.2 and 28.3:</p></div><table class="tableblock frame-none grid-all stretch"><caption class=title>表 2. 其他使用者</caption><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">使用者名稱</th><th class="tableblock halign-left valign-top">說明</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>alpha</code>, <code>beta</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>IT department employees</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>charlie</code>, <code>delta</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>IT department apprentices</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>echo</code>, <code>foxtrott</code>, <code>golf</code>, …​</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>employees</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>able</code>, <code>baker</code>, …​</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>interns</p></td></tr></tbody></table><table class="tableblock frame-none grid-all stretch"><caption class=title>表 3. 其他系統</caption><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">機器名稱</th><th class="tableblock halign-left valign-top">說明</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>war</code>, <code>death</code>, <code>famine</code>, <code>pollution</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Only IT employees are allowed to log onto these servers.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>pride</code>, <code>greed</code>, <code>envy</code>, <code>wrath</code>, <code>lust</code>, <code>sloth</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>All members of the IT department are allowed to login onto these servers.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>one</code>, <code>two</code>, <code>three</code>, <code>four</code>, …​</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Ordinary workstations used by employees.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>trashcan</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>A very old machine without any critical data. Even interns are allowed to use this system.</p></td></tr></tbody></table><div class=paragraph><p>When using netgroups to configure this scenario, each user is assigned to one or more netgroups and logins are then allowed or forbidden for all members of the netgroup. When adding a new machine, login restrictions must be defined for all netgroups. When a new user is added, the account must be added to one or more netgroups. If the NIS setup is planned carefully, only one central configuration file needs modification to grant or deny access to machines.</p></div><div class=paragraph><p>The first step is the initialization of the NIS <code>netgroup</code> map. In FreeBSD, this map is not created by default. On the NIS master server, use an editor to create a map named <span class=filename>/var/yp/netgroup</span>.</p></div><div class=paragraph><p>This example creates four netgroups to represent IT employees, IT apprentices, employees, and interns:</p></div><div class="literalblock programlisting"><div class=content><pre>IT_EMP  (,alpha,test-domain)    (,beta,test-domain)
IT_APP  (,charlie,test-domain)  (,delta,test-domain)
USERS   (,echo,test-domain)     (,foxtrott,test-domain) \
        (,golf,test-domain)
INTERNS (,able,test-domain)     (,baker,test-domain)</pre></div></div><div class=paragraph><p>Each entry configures a netgroup. The first column in an entry is the name of the netgroup. Each set of brackets represents either a group of one or more users or the name of another netgroup. When specifying a user, the three comma-delimited fields inside each group represent:</p></div><div class="olist arabic"><ol class=arabic><li><p>The name of the host(s) where the other fields representing the user are valid. If a hostname is not specified, the entry is valid on all hosts.</p></li><li><p>The name of the account that belongs to this netgroup.</p></li><li><p>The NIS domain for the account. Accounts may be imported from other NIS domains into a netgroup.</p></li></ol></div><div class=paragraph><p>If a group contains multiple users, separate each user with whitespace. Additionally, each field may contain wildcards. See <a href="https://man.freebsd.org/cgi/man.cgi?query=netgroup&amp;sektion=5&amp;format=html">netgroup(5)</a> for details.</p></div><div class=paragraph><p>Netgroup names longer than 8 characters should not be used. The names are case sensitive and using capital letters for netgroup names is an easy way to distinguish between user, machine and netgroup names.</p></div><div class=paragraph><p>Some non-FreeBSD NIS clients cannot handle netgroups containing more than 15 entries. This limit may be circumvented by creating several sub-netgroups with 15 users or fewer and a real netgroup consisting of the sub-netgroups, as seen in this example:</p></div><div class="literalblock programlisting"><div class=content><pre>BIGGRP1  (,joe1,domain)  (,joe2,domain)  (,joe3,domain) [...]
BIGGRP2  (,joe16,domain)  (,joe17,domain) [...]
BIGGRP3  (,joe31,domain)  (,joe32,domain)
BIGGROUP  BIGGRP1 BIGGRP2 BIGGRP3</pre></div></div><div class=paragraph><p>Repeat this process if more than 225 (15 times 15) users exist within a single netgroup.</p></div><div class=paragraph><p>To activate and distribute the new NIS map:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>ellington# <span class=nb>cd</span> /var/yp
ellington# make</code></pre></div></div><div class=paragraph><p>This will generate the three NIS maps <span class=filename>netgroup</span>, <span class=filename>netgroup.byhost</span> and <span class=filename>netgroup.byuser</span>. Use the map key option of <a href="https://man.freebsd.org/cgi/man.cgi?query=ypcat&amp;sektion=1&amp;format=html">ypcat(1)</a> to check if the new NIS maps are available:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>ellington% ypcat <span class=nt>-k</span> netgroup
ellington% ypcat <span class=nt>-k</span> netgroup.byhost
ellington% ypcat <span class=nt>-k</span> netgroup.byuser</code></pre></div></div><div class=paragraph><p>The output of the first command should resemble the contents of <span class=filename>/var/yp/netgroup</span>. The second command only produces output if host-specific netgroups were created. The third command is used to get the list of netgroups for a user.</p></div><div class=paragraph><p>To configure a client, use <a href="https://man.freebsd.org/cgi/man.cgi?query=vipw&amp;sektion=8&amp;format=html">vipw(8)</a> to specify the name of the netgroup. For example, on the server named <code>war</code>, replace this line:</p></div><div class="literalblock programlisting"><div class=content><pre>+:::::::::</pre></div></div><div class=paragraph><p>with</p></div><div class="literalblock programlisting"><div class=content><pre>+@IT_EMP:::::::::</pre></div></div><div class=paragraph><p>This specifies that only the users defined in the netgroup <code>IT_EMP</code> will be imported into this system’s password database and only those users are allowed to login to this system.</p></div><div class=paragraph><p>This configuration also applies to the <code>~</code> function of the shell and all routines which convert between user names and numerical user IDs. In other words, <code>cd ~<em>user</em></code> will not work, <code>ls -l</code> will show the numerical ID instead of the username, and <code>find . -user joe -print</code> will fail with the message <code>No such user</code>. To fix this, import all user entries without allowing them to login into the servers. This can be achieved by adding an extra line:</p></div><div class="literalblock programlisting"><div class=content><pre>+:::::::::/usr/sbin/nologin</pre></div></div><div class=paragraph><p>This line configures the client to import all entries but to replace the shell in those entries with <span class=filename>/usr/sbin/nologin</span>.</p></div><div class=paragraph><p>Make sure that extra line is placed <em>after</em> <code>+@IT_EMP:::::::::</code>. Otherwise, all user accounts imported from NIS will have <span class=filename>/usr/sbin/nologin</span> as their login shell and no one will be able to login to the system.</p></div><div class=paragraph><p>To configure the less important servers, replace the old <code>+:::::::::</code> on the servers with these lines:</p></div><div class="literalblock programlisting"><div class=content><pre>+@IT_EMP:::::::::
+@IT_APP:::::::::
+:::::::::/usr/sbin/nologin</pre></div></div><div class=paragraph><p>The corresponding lines for the workstations would be:</p></div><div class="literalblock programlisting"><div class=content><pre>+@IT_EMP:::::::::
+@USERS:::::::::
+:::::::::/usr/sbin/nologin</pre></div></div><div class=paragraph><p>NIS supports the creation of netgroups from other netgroups which can be useful if the policy regarding user access changes. One possibility is the creation of role-based netgroups. For example, one might create a netgroup called <code>BIGSRV</code> to define the login restrictions for the important servers, another netgroup called <code>SMALLSRV</code> for the less important servers, and a third netgroup called <code>USERBOX</code> for the workstations. Each of these netgroups contains the netgroups that are allowed to login onto these machines. The new entries for the NIS <code>netgroup</code> map would look like this:</p></div><div class="literalblock programlisting"><div class=content><pre>BIGSRV    IT_EMP  IT_APP
SMALLSRV  IT_EMP  IT_APP  ITINTERN
USERBOX   IT_EMP  ITINTERN USERS</pre></div></div><div class=paragraph><p>This method of defining login restrictions works reasonably well when it is possible to define groups of machines with identical restrictions. Unfortunately, this is the exception and not the rule. Most of the time, the ability to define login restrictions on a per-machine basis is required.</p></div><div class=paragraph><p>Machine-specific netgroup definitions are another possibility to deal with the policy changes. In this scenario, the <span class=filename>/etc/master.passwd</span> of each system contains two lines starting with "+". The first line adds a netgroup with the accounts allowed to login onto this machine and the second line adds all other accounts with <span class=filename>/usr/sbin/nologin</span> as shell. It is recommended to use the "ALL-CAPS" version of the hostname as the name of the netgroup:</p></div><div class="literalblock programlisting"><div class=content><pre>+@BOXNAME:::::::::
+:::::::::/usr/sbin/nologin</pre></div></div><div class=paragraph><p>Once this task is completed on all the machines, there is no longer a need to modify the local versions of <span class=filename>/etc/master.passwd</span> ever again. All further changes can be handled by modifying the NIS map. Here is an example of a possible <code>netgroup</code> map for this scenario:</p></div><div class="literalblock programlisting"><div class=content><pre># Define groups of users first
IT_EMP    (,alpha,test-domain)    (,beta,test-domain)
IT_APP    (,charlie,test-domain)  (,delta,test-domain)
DEPT1     (,echo,test-domain)     (,foxtrott,test-domain)
DEPT2     (,golf,test-domain)     (,hotel,test-domain)
DEPT3     (,india,test-domain)    (,juliet,test-domain)
ITINTERN  (,kilo,test-domain)     (,lima,test-domain)
D_INTERNS (,able,test-domain)     (,baker,test-domain)
#
# Now, define some groups based on roles
USERS     DEPT1   DEPT2     DEPT3
BIGSRV    IT_EMP  IT_APP
SMALLSRV  IT_EMP  IT_APP    ITINTERN
USERBOX   IT_EMP  ITINTERN  USERS
#
# And a groups for a special tasks
# Allow echo and golf to access our anti-virus-machine
SECURITY  IT_EMP  (,echo,test-domain)  (,golf,test-domain)
#
# machine-based netgroups
# Our main servers
WAR       BIGSRV
FAMINE    BIGSRV
# User india needs access to this server
POLLUTION  BIGSRV  (,india,test-domain)
#
# This one is really important and needs more access restrictions
DEATH     IT_EMP
#
# The anti-virus-machine mentioned above
ONE       SECURITY
#
# Restrict a machine to a single user
TWO       (,hotel,test-domain)
# [...more groups to follow]</pre></div></div><div class=paragraph><p>It may not always be advisable to use machine-based netgroups. When deploying a couple of dozen or hundreds of systems, role-based netgroups instead of machine-based netgroups may be used to keep the size of the NIS map within reasonable limits.</p></div></div><div class=sect2><h3 id=_密碼格式>29.4.9. 密碼格式<a class=anchor href=#_密碼格式></a></h3><div class=paragraph><p>NIS requires that all hosts within an NIS domain use the same format for encrypting passwords. If users have trouble authenticating on an NIS client, it may be due to a differing password format. In a heterogeneous network, the format must be supported by all operating systems, where DES is the lowest common standard.</p></div><div class=paragraph><p>To check which format a server or client is using, look at this section of <span class=filename>/etc/login.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>default:\
	:passwd_format=des:\
	:copyright=/etc/COPYRIGHT:\
	[Further entries elided]</pre></div></div><div class=paragraph><p>In this example, the system is using the DES format. Other possible values are <code>blf</code> for Blowfish and <code>md5</code> for MD5 encrypted passwords.</p></div><div class=paragraph><p>If the format on a host needs to be edited to match the one being used in the NIS domain, the login capability database must be rebuilt after saving the change:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cap_mkdb /etc/login.conf</span></code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>The format of passwords for existing user accounts will not be updated until each user changes their password <em>after</em> the login capability database is rebuilt.</p></div></td></tr></tbody></table></div></div></div></div><div class=sect1><h2 id=network-ldap>29.5. 輕量級目錄存取協定 (LDAP)<a class=anchor href=#network-ldap></a></h2><div class=sectionbody><div class=paragraph><p>輕量級目錄存取協定 (Lightweight Directory Access Protocol, LDAP) 是一個利用分散式目錄資訊服務來做到存取、修改與認証物件的應用層通訊協定，可以想像成是一本可以儲存數個階層、同質資訊的電話簿或記錄簿。它用在 Active Directory 及 OpenLDAP 網路，允許使用者利用一個帳號來存取數個階層的內部資訊，例如：電子郵件認証、取得員工聯絡資訊及內部網站的認証皆可使用 LDAP 伺服器資料庫中的單一使用者帳號來存取。</p></div><div class=paragraph><p>本章節將介紹在 FreeBSD 系統上如何快速的設定一個 LDAP 伺服器。本章節假設管理者已做好規劃，這包含：要儲存何種類型的資訊、這些資訊要來做什麼、那些使用者擁有存取這些資訊的權限以及如何確保這些資訊不會被未經授權存取。</p></div><div class=sect2><h3 id=_ldap_術語與結構>29.5.1. LDAP 術語與結構<a class=anchor href=#_ldap_術語與結構></a></h3><div class=paragraph><p>LDAP 使用了數個術語在開始設置之前必須先了解。所有的目錄項目由一群屬性 (<em>attributes</em>) 所組成，每個屬性集皆有一個獨特的辨識碼稱為辨識名稱 (<em>Distinguished Name</em>, DN)，這個辨識碼會由數個其他的屬性，如：常用或相對辨識名稱 (<em>Relative Distinguished Name</em>, RDN) 所組成，這就像目錄有絕對路徑與相對路徑，可以把 DN 當做絕對路徑，RDN 當做相對路徑。</p></div><div class=paragraph><p>LDAP 項目的例子如下。這個例子會搜尋指定使用者帳號 (<code>uid</code>)、組織單位 (<code>ou</code>) 及組織的項目 (<code>o</code>)：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% ldapsearch <span class=nt>-xb</span> <span class=s2>&#34;uid=trhodes,ou=users,o=example.com&#34;</span>
<span class=c># extended LDIF</span>
<span class=c>#</span>
<span class=c># LDAPv3</span>
<span class=c># base &lt;uid=trhodes,ou=users,o=example.com&gt; with scope subtree</span>
<span class=c># filter: (objectclass=*)</span>
<span class=c># requesting: ALL</span>
<span class=c>#</span>

<span class=c># trhodes, users, example.com</span>
dn: <span class=nv>uid</span><span class=o>=</span>trhodes,ou<span class=o>=</span><span class=nb>users</span>,o<span class=o>=</span>example.com
mail: trhodes@example.com
cn: Tom Rhodes
uid: trhodes
telephoneNumber: <span class=o>(</span>123<span class=o>)</span> 456-7890

<span class=c># search result</span>
search: 2
result: 0 Success

<span class=c># numResponses: 2</span>
<span class=c># numEntries: 1</span></code></pre></div></div><div class=paragraph><p>這個範例項目會顯示 <code>dn</code>, <code>mail</code>, <code>cn</code>, <code>uid</code> 以及 <code>telephoneNumber</code> 屬性的數值。而 cn 屬性則是 RDN。</p></div><div class=paragraph><p>更多有關 LDAP 以及其術語的資訊可在 <a href=http://www.openldap.org/doc/admin24/intro.html>http://www.openldap.org/doc/admin24/intro.html</a> 找到。</p></div></div><div class=sect2><h3 id=ldap-config>29.5.2. 設定 LDAP 伺服器<a class=anchor href=#ldap-config></a></h3><div class=paragraph><p>FreeBSD 並未提供內建的 LDAP 伺服器，要開始設定前請先安裝 <a class=package href=https://cgit.freebsd.org/ports/tree/net/openldap-server/>net/openldap-server</a> 套件或 Port：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pkg install openldap-server</span></code></pre></div></div><div class=paragraph><p>在<a href=https://docs.freebsd.org/en/articles/linux-users/#software>套件</a>中已開啟了許多的預設選項，可以透過執行 <code>pkg info openldap-server</code> 來查看已開啟的選項，若有不足的地方 (例如需要開啟 SQL 的支援)，請考慮使用適當的<a href=../ports/#ports-using>方式</a>重新編譯該 Port。</p></div><div class=paragraph><p>安裝程序會建立目錄 <span class=filename>/var/db/openldap-data</span> 來儲存資料，同時需要建立儲存憑證的目錄：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mkdir /usr/local/etc/openldap/private</span></code></pre></div></div><div class=paragraph><p>接下來是設定憑証機構 (Certificate authority)。以下指令必須在 <span class=filename>/usr/local/etc/openldap/private</span> 下執行，這很重要是由於檔案權限須要被限制且其他使用者不應有這些檔案的存取權限，更多有關憑証的詳細資訊以及相關的參數可在 <a href=../security/#openssl>OpenSSL</a> 中找到。要建立憑証授權，需先輸人這個指令並依提示操作：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># openssl req -days 365 -nodes -new -x509 -keyout ca.key -out ../ca.crt</span></code></pre></div></div><div class=paragraph><p>提示輸入的項目<em>除了</em>通用名稱 (<code>Common Name</code>) 外其他是可以一樣的，這個項目必須使用跟系統主機名稱 <em>不同</em> 的名稱。若這是一個自行簽署的憑証 (Self signed certificate)，則在憑証機構 <code>CA</code> 的前面加上主機名稱。</p></div><div class=paragraph><p>接下來的工作是建立一個伺服器的憑証簽署請求與一個私鑰。請輸入以下指令然後依提示操作：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># openssl req -days 365 -nodes -new -keyout server.key -out server.csr</span></code></pre></div></div><div class=paragraph><p>在憑証產生程序的過程中請確認 <code>Common Name</code> 屬性設定正確。憑証簽署請求 (Certificate Signing Request) 必須經過憑証機構簽署後才會成為有效的憑証：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># openssl x509 -req -days 365 -in server.csr -out ../server.crt -CA ../ca.crt -CAkey ca.key -CAcreateserial</span></code></pre></div></div><div class=paragraph><p>在憑証產生程序的最後一步是產生並簽署客戶端憑証：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># openssl req -days 365 -nodes -new -keyout client.key -out client.csr</span>
<span class=c># openssl x509 -req -days 3650 -in client.csr -out ../client.crt -CA ../ca.crt -CAkey ca.key</span></code></pre></div></div><div class=paragraph><p>記得當提示時要使用同樣的 <code>Common Name</code> 屬性。完成之後，請確認執行的指令產生了 8 個新檔案。</p></div><div class=paragraph><p>OpenLDAP 伺服器所執行的 Daemon 為 <span class=filename>slapd</span>，OpenLDAP 是透過 <span class=filename>slapd.ldif</span> 來做設定， OpenLDAP 官方已停止採用舊的 <span class=filename>slapd.conf</span> 格式。</p></div><div class=paragraph><p>這裡有些 <span class=filename>slapd.ldif</span> 的 <a href=http://www.openldap.org/doc/admin24/slapdconf2.html>設定檔範例</a> 可以使用，同時您也可以在 <span class=filename>/usr/local/etc/openldap/slapd.ldif.sample</span> 找到範例資訊。相關可用的選項在 slapd-config(5) 文件會有說明。<span class=filename>slapd.ldif</span> 的每個段落，如同其他 LDAP 屬性設定一樣會透過獨一無二 DN 來辨識，並請確保 <code>dn:</code> 描述與其相關屬性之間沒有空行。以下的範例中會實作一個使用 TLS 的安全通道，首先是全域的設定：</p></div><div class="literalblock programlisting"><div class=content><pre>#
# See slapd-config(5) for details on configuration options.
# This file should NOT be world readable.
#
dn: cn=config
objectClass: olcGlobal
cn: config
#
#
# Define global ACLs to disable default read access.
#
olcArgsFile: /var/run/openldap/slapd.args
olcPidFile: /var/run/openldap/slapd.pid
olcTLSCertificateFile: /usr/local/etc/openldap/server.crt
olcTLSCertificateKeyFile: /usr/local/etc/openldap/private/server.key
olcTLSCACertificateFile: /usr/local/etc/openldap/ca.crt
#olcTLSCipherSuite: HIGH
olcTLSProtocolMin: 3.1
olcTLSVerifyClient: never</pre></div></div><div class=paragraph><p>這個檔案中必須指定憑証機構 (Certificate Authority)、伺服器憑証 (Server Certificate) 與伺服器私鑰 (Server Private Key)，建議可讓客戶端決定使用的安全密碼 (Security Cipher)，略過 <code>olcTLSCipherSuite</code> 選項 (此選項不相容 <span class=filename>openssl</span> 以外的 TLS 客戶端)。選項 <code>olcTLSProtocolMin</code> 讓伺服器可要求一個安全等級的最低限度，建議使用。伺服器有進行驗証的必要，但客戶端並不需要，因此可設定 <code>olcTLSVerifyClient: never</code>。</p></div><div class=paragraph><p>第二個部份是設定後端要採用的模組有那些，可使用以下方式設定：</p></div><div class="literalblock programlisting"><div class=content><pre>#
# Load dynamic backend modules:
#
dn: cn=module,cn=config
objectClass: olcModuleList
cn: module
olcModulepath:	/usr/local/libexec/openldap
olcModuleload:	back_mdb.la
#olcModuleload:	back_bdb.la
#olcModuleload:	back_hdb.la
#olcModuleload:	back_ldap.la
#olcModuleload:	back_passwd.la
#olcModuleload:	back_shell.la</pre></div></div><div class=paragraph><p>第三個部份要載入資料庫所需的 <code>ldif</code> 綱要 (Schema)，這個動作是必要的。</p></div><div class="literalblock programlisting"><div class=content><pre>dn: cn=schema,cn=config
objectClass: olcSchemaConfig
cn: schema

include: file:///usr/local/etc/openldap/schema/core.ldif
include: file:///usr/local/etc/openldap/schema/cosine.ldif
include: file:///usr/local/etc/openldap/schema/inetorgperson.ldif
include: file:///usr/local/etc/openldap/schema/nis.ldif</pre></div></div><div class=paragraph><p>接下來是前端設定的部份：</p></div><div class="literalblock programlisting"><div class=content><pre># Frontend settings
#
dn: olcDatabase={-1}frontend,cn=config
objectClass: olcDatabaseConfig
objectClass: olcFrontendConfig
olcDatabase: {-1}frontend
olcAccess: to * by * read
#
# Sample global access control policy:
#	Root DSE: allow anyone to read it
#	Subschema (sub)entry DSE: allow anyone to read it
#	Other DSEs:
#		Allow self write access
#		Allow authenticated users read access
#		Allow anonymous users to authenticate
#
#olcAccess: to dn.base=&#34;&#34; by * read
#olcAccess: to dn.base=&#34;cn=Subschema&#34; by * read
#olcAccess: to *
#	by self write
#	by users read
#	by anonymous auth
#
# if no access controls are present, the default policy
# allows anyone and everyone to read anything but restricts
# updates to rootdn.  (e.g., &#34;access to * by * read&#34;)
#
# rootdn can always read and write EVERYTHING!
#
olcPasswordHash: {SSHA}
# {SSHA} is already the default for olcPasswordHash</pre></div></div><div class=paragraph><p>再來是<em>設定後端</em>的部份，之後唯一能夠存取 OpenLDAP 伺服器設定的方式是使用全域超級使用者。</p></div><div class="literalblock programlisting"><div class=content><pre>dn: olcDatabase={0}config,cn=config
objectClass: olcDatabaseConfig
olcDatabase: {0}config
olcAccess: to * by * none
olcRootPW: {SSHA}iae+lrQZILpiUdf16Z9KmDmSwT77Dj4U</pre></div></div><div class=paragraph><p>預設的管理者使用者名稱是 <code>cn=config</code>，可在 Shell 中輸入 <span class=filename>slappasswd</span>，決定要使用的密碼並將其產生的編碼放到 <code>olcRootPW</code> 欄位中。若這個選項在這時沒有設定好，在匯入 <span class=filename>slapd.ldif</span> 之後將沒有任何人有辦法修改<em>全域的設定</em>。</p></div><div class=paragraph><p>最後一個部份是有關資料庫後端的設定：</p></div><div class="literalblock programlisting"><div class=content><pre>#######################################################################
# LMDB database definitions
#######################################################################
#
dn: olcDatabase=mdb,cn=config
objectClass: olcDatabaseConfig
objectClass: olcMdbConfig
olcDatabase: mdb
olcDbMaxSize: 1073741824
olcSuffix: dc=domain,dc=example
olcRootDN: cn=mdbadmin,dc=domain,dc=example
# Cleartext passwords, especially for the rootdn, should
# be avoided.  See slappasswd(8) and slapd-config(5) for details.
# Use of strong authentication encouraged.
olcRootPW: {SSHA}X2wHvIWDk6G76CQyCMS1vDCvtICWgn0+
# The database directory MUST exist prior to running slapd AND
# should only be accessible by the slapd and slap tools.
# Mode 700 recommended.
olcDbDirectory:	/var/db/openldap-data
# Indices to maintain
olcDbIndex: objectClass eq</pre></div></div><div class=paragraph><p>這裡指定的資料庫即<em>實際用來保存</em>LDAP 目錄的資料，也可以使用 <code>mdb</code> 以外的項目，資料庫的超級使用者可在這裡設定 (與全域的超級使用者是不同的東西)：<code>olcRootDN</code>　需填寫使用者名稱 (可自訂)，<code>olcRootPW</code> 需填寫該使用者編碼後的密碼，將密碼編碼可使用 <span class=filename>slappasswd</span> 如同前面所述。</p></div><div class=paragraph><p>這裡有個<a href="http://www.openldap.org/devel/gitweb.cgi?p=openldap.git;a=tree;f=tests/data/regressions/its8444;h=8a5e808e63b0de3d2bdaf2cf34fecca8577ca7fd;hb=HEAD">檔案庫</a>內有四個 <span class=filename>slapd.ldif</span> 的範例，要將現有的 <span class=filename>slapd.conf</span> 轉換成 <span class=filename>slapd.ldif</span> 格式，可參考<a href=http://www.openldap.org/doc/admin24/slapdconf2.html>此頁</a> (注意，這裡面的說明也會介紹一些不常用的選項)。</p></div><div class=paragraph><p>當設定完成之後，需將 <span class=filename>slapd.ldif</span> 放在一個空的目錄當中，建議如以下方式建立：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mkdir /usr/local/etc/openldap/slapd.d/</span></code></pre></div></div><div class=paragraph><p>匯入設定資料庫：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># /usr/local/sbin/slapadd -n0 -F /usr/local/etc/openldap/slapd.d/ -l /usr/local/etc/openldap/slapd.ldif</span></code></pre></div></div><div class=paragraph><p>啟動 <span class=filename>slapd</span> Daemon：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># /usr/local/libexec/slapd -F /usr/local/etc/openldap/slapd.d/</span></code></pre></div></div><div class=paragraph><p>選項 <code>-d</code> 可以用來除錯使用，如同 slapd(8) 中所說明的，若要檢驗伺服器是否正常執行與運作可以：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ldapsearch -x -b &#39;&#39; -s base &#39;(objectclass=*)&#39; namingContexts</span>
<span class=c># extended LDIF</span>
<span class=c>#</span>
<span class=c># LDAPv3</span>
<span class=c># base &lt;&gt; with scope baseObject</span>
<span class=c># filter: (objectclass=*)</span>
<span class=c># requesting: namingContexts</span>
<span class=c>#</span>

<span class=c>#</span>
dn:
namingContexts: <span class=nv>dc</span><span class=o>=</span>domain,dc<span class=o>=</span>example

<span class=c># search result</span>
search: 2
result: 0 Success

<span class=c># numResponses: 2</span>
<span class=c># numEntries: 1</span></code></pre></div></div><div class=paragraph><p>伺服器端仍必須受到信任，若在此之前未做過這個動作，請依照以下指示操作。安裝 OpenSSL 套件或 Port：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pkg install openssl</span></code></pre></div></div><div class=paragraph><p>進入 <span class=filename>ca.crt</span> 所在的目錄 (以這邊使用的例子來說則是 <span class=filename>/usr/local/etc/openldap</span>)，執行：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># c_rehash .</span></code></pre></div></div><div class=paragraph><p>現在 CA 與伺服器憑証可以依其用途被辨識，可進入 <span class=filename>server.crt</span> 所在的目錄執行以下指令來檢查：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># openssl verify -verbose -CApath . server.crt</span></code></pre></div></div><div class=paragraph><p>若 <span class=filename>slapd</span> 已正在執行，就重新啟動它。如同 <span class=filename>/usr/local/etc/rc.d/slapd</span> 所述，要讓 <span class=filename>slapd</span> 開機時可正常執行，須要加入以下行到 <span class=filename>/etc/rc.conf</span>：</p></div><div class="literalblock programlisting"><div class=content><pre>lapd_enable=&#34;YES&#34;
slapd_flags=&#39;-h &#34;ldapi://%2fvar%2frun%2fopenldap%2fldapi/
ldap://0.0.0.0/&#34;&#39;
slapd_sockets=&#34;/var/run/openldap/ldapi&#34;
slapd_cn_config=&#34;YES&#34;</pre></div></div><div class=paragraph><p>開機啟動 <span class=filename>slapd</span> 並不會提供除錯的功能，您可以檢查 <span class=filename>/var/log/debug.log</span>, <span class=filename>dmesg -a</span> 及 <span class=filename>/var/log/messages</span> 檢確認是否有正常運作。</p></div><div class=paragraph><p>以下範例會新增群組 <code>team</code> 及使用者 <code>john</code> 到 <code>domain.example</code> LDAP 資料庫，而該資料庫目前是空的。首先要先建立 <span class=filename>domain.ldif</span> 檔：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cat domain.ldif</span>
dn: <span class=nv>dc</span><span class=o>=</span>domain,dc<span class=o>=</span>example
objectClass: dcObject
objectClass: organization
o: domain.example
dc: domain

dn: <span class=nv>ou</span><span class=o>=</span><span class=nb>groups</span>,dc<span class=o>=</span>domain,dc<span class=o>=</span>example
objectClass: top
objectClass: organizationalunit
ou: <span class=nb>groups

</span>dn: <span class=nv>ou</span><span class=o>=</span><span class=nb>users</span>,dc<span class=o>=</span>domain,dc<span class=o>=</span>example
objectClass: top
objectClass: organizationalunit
ou: <span class=nb>users

</span>dn: <span class=nv>cn</span><span class=o>=</span>team,ou<span class=o>=</span><span class=nb>groups</span>,dc<span class=o>=</span>domain,dc<span class=o>=</span>example
objectClass: top
objectClass: posixGroup
cn: team
gidNumber: 10001

dn: <span class=nv>uid</span><span class=o>=</span>john,ou<span class=o>=</span><span class=nb>users</span>,dc<span class=o>=</span>domain,dc<span class=o>=</span>example
objectClass: top
objectClass: account
objectClass: posixAccount
objectClass: shadowAccount
cn: John McUser
uid: john
uidNumber: 10001
gidNumber: 10001
homeDirectory: /home/john/
loginShell: /usr/bin/bash
userPassword: secret</code></pre></div></div><div class=paragraph><p>請查看 OpenLDAP 說明文件取得更詳細的資訊，使用 <span class=filename>slappasswd</span> 來將純文字的密碼 <code>secret</code> 更改為已編碼的型式來填寫 <code>userPassword</code> 欄位。在 <code>loginShell</code> 所指定的路徑，必須在所有可讓 <code>john</code> 登入的系統中存在。最後是使用 <code>mdb</code> 管理者修改資料庫：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ldapadd -W -D &#34;cn=mdbadmin,dc=domain,dc=example&#34; -f domain.ldif</span></code></pre></div></div><div class=paragraph><p>要修改<em>全域設定</em>只能使用全域的超及使用者。例如，假設一開始採用了 <code>olcTLSCipherSuite: HIGH:MEDIUM:SSLv3</code> 選項，但最後想要把它移除，可以建立一個有以下內容的檔案：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cat global_mod</span>
dn: <span class=nv>cn</span><span class=o>=</span>config
changetype: modify
delete: olcTLSCipherSuite</code></pre></div></div><div class=paragraph><p>然後套用修改內容：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ldapmodify -f global_mod -x -D &#34;cn=config&#34; -W</span></code></pre></div></div><div class=paragraph><p>當提示輸入密碼時，提供當時在<em>設定後端</em>一節所設定的密碼，在這裡無須填寫使用者名稱，<code>cn=config</code> 代表要修改資料庫資料的位置。也可以使用 <code>ldapmodify</code> 刪除其中一行屬性，或是 <code>ldapdelete</code> 刪除整筆資料。</p></div><div class=paragraph><p>若有問題無法正常執行，或是全域的超級使用者無法存取後端的設定，可以刪除並重建整個後端設定：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># rm -rf /usr/local/etc/openldap/slapd.d/</span></code></pre></div></div><div class=paragraph><p>可以修改 <span class=filename>slapd.ldif</span> 後再重新匯入一次。請注意，這個步驟只在沒有其他方式可用時才使用。</p></div><div class=paragraph><p>本章節的設定說明只針對伺服器端的部份，在同一台主機中也可以同時有安裝 LDAP 客戶端但需要額外做設定。</p></div></div></div></div><div class=sect1><h2 id=network-dhcp>29.6. 動態主機設置協定 (DHCP)<a class=anchor href=#network-dhcp></a></h2><div class=sectionbody><div class=paragraph><p>動態主機設置協定 (Dynamic Host Configuration Protocol, DHCP) 可分配必要的位置資訊給一個連線到網路的系統以在該網路通訊。FreeBSD 內含 OpenBSD 版本的 <code>dhclient</code>，可用來做為客戶端來取得位置資訊。FreeBSD 預設並不會安裝 DHCP 伺服器，但在 FreeBSD Port 套件集中有許多可用的伺服器。有關 DHCP 通訊協定的完整說明位於 <a href=http://www.freesoft.org/CIE/RFC/2131/>RFC 2131</a>，相關資源也可至 <a href=http://www.isc.org/downloads/dhcp/>isc.org/downloads/dhcp/</a> 取得。</p></div><div class=paragraph><p>本節將介紹如何使用內建的 DHCP 客戶端，接著會介紹如何安裝並設定一個 DHCP 伺服器。</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>在 FreeBSD 中，<a href="https://man.freebsd.org/cgi/man.cgi?query=bpf&amp;sektion=4&amp;format=html">bpf(4)</a> 裝置同時會被 DHCP 伺服器與 DHCP 客戶端所使用。這個裝置會在 <span class=filename>GENERIC</span> 核心中被引用並隨著 FreeBSD 安裝。想要建立自訂核心的使用者若要使用 DHCP 則須保留這個裝置。</p></div><div class=paragraph><p>另外要注意 <span class=filename>bpf</span> 也會讓有權限的使用者在該系統上可執行網路封包監聽程式。</p></div></td></tr></tbody></table></div><div class=sect2><h3 id=_設定_dhcp_客戶端>29.6.1. 設定 DHCP 客戶端<a class=anchor href=#_設定_dhcp_客戶端></a></h3><div class=paragraph><p>DHCP 客戶端內含在 FreeBSD 安裝程式當中，這讓在新安裝的系統上設定自動從 DHCP 伺服器接收網路位置資訊變的更簡單。請參考 <a href=../bsdinstall/#bsdinstall-post>安裝後注意事項</a> 取得網路設置的範例。</p></div><div class=paragraph><p>當 <code>dhclient</code> 在客戶端機器上執行時，它便會開始廣播請求取得設置資訊。預設這些請求會使用 UDP 埠號 68。而伺服器則會在 UDP 埠號 67 來回覆，將 IP 位址與其他相關的網路資訊，如：子網路遮罩、預設閘道及 DNS 伺服器位址告訴客戶端，詳細的清單可在 <a href="https://man.freebsd.org/cgi/man.cgi?query=dhcp-options&amp;sektion=5&amp;format=html">dhcp-options(5)</a> 找到。</p></div><div class=paragraph><p>預設當 FreeBSD 系統開機時，其 DHCP 客戶端會在背景執行或稱非同步 (<em>Asynchronously</em>) 執行，在完成 DHCP 程序的同時其他啟動 Script 會繼續執行，來加速系統啟動。</p></div><div class=paragraph><p>背景 DHCP 在 DHCP 伺服器可以快速的回應客戶端請求時可運作的很好。然而 DHCP 在某些系統可能需要較長的時間才能完成，若網路服務嘗試在 DHCP 尚未分配網路位置資訊前執行則會失敗。使用同步 (<em>Synchronous</em>) 模式執行 DHCP 可避免這個問題，因為同步模式會暫停啟動直到 DHCP 已設置完成。</p></div><div class=paragraph><p>在 <span class=filename>/etc/rc.conf</span> 中的這行用來設定採用背景 (非同步模式)：</p></div><div class="literalblock programlisting"><div class=content><pre>ifconfig_fxp0=&#34;DHCP&#34;</pre></div></div><div class=paragraph><p>若系統已經在安裝時設定使用 DHCP，這行可能會已存在。替換在例子中的 <em>fxp0</em> 為實際要動態設置的網路介面名稱，如 <a href=../config/#config-network-setup>設定網路介面卡</a> 中的說明。</p></div><div class=paragraph><p>要改設定系統採用同步模式，在啟動時暫停等候 DHCP 完成，使用 “SYNCDHCP”：</p></div><div class="literalblock programlisting"><div class=content><pre>ifconfig_fxp0=&#34;SYNCDHCP&#34;</pre></div></div><div class=paragraph><p>尚有其他可用的客戶端選項，請在 <a href="https://man.freebsd.org/cgi/man.cgi?query=rc.conf&amp;sektion=5&amp;format=html">rc.conf(5)</a> 搜尋 <code>dhclient</code> 來取得詳細資訊。</p></div><div class=paragraph><p>DHCP 客戶端會使用到以下檔案：</p></div><div class=ulist><ul><li><p><span class=filename>/etc/dhclient.conf</span></p><div class=paragraph><p><code>dhclient</code> 用到的設定檔。通常這個檔案只會有註解，因為預設便適用大多數客戶端。這個設定檔在 <a href="https://man.freebsd.org/cgi/man.cgi?query=dhclient.conf&amp;sektion=5&amp;format=html">dhclient.conf(5)</a> 中有說明。</p></div></li><li><p><span class=filename>/sbin/dhclient</span></p><div class=paragraph><p>有關指令本身的更多資訊可於 <a href="https://man.freebsd.org/cgi/man.cgi?query=dhclient&amp;sektion=8&amp;format=html">dhclient(8)</a> 找到。</p></div></li><li><p><span class=filename>/sbin/dhclient-script</span></p><div class=paragraph><p>FreeBSD 特定的 DHCP 客戶端設定 Script。在 <a href="https://man.freebsd.org/cgi/man.cgi?query=dhclient-script&amp;sektion=8&amp;format=html">dhclient-script(8)</a> 中有說明，但應不須做任何修改便可正常運作。</p></div></li><li><p><span class=filename>/var/db/dhclient.leases.interface</span></p><div class=paragraph><p>DHCP 客戶端會在這個檔案中儲存有效租約的資料，寫入的格式類似日誌，在 <a href="https://man.freebsd.org/cgi/man.cgi?query=dhclient.leases&amp;sektion=5&amp;format=html">dhclient.leases(5)</a> 有說明。</p></div></li></ul></div></div><div class=sect2><h3 id=network-dhcp-server>29.6.2. 安裝並設定 DHCP 伺服器<a class=anchor href=#network-dhcp-server></a></h3><div class=paragraph><p>本節將示範如何設定 FreeBSD 系統成為 DHCP 伺服器，使用 Internet Systems Consortium (ISC) 所實作的 DHCP 伺服器，這個伺服器及其文件可使用 <a class=package href=https://cgit.freebsd.org/ports/tree/net/isc-dhcp44-server/>net/isc-dhcp44-server</a> 套件或 Port 安裝。</p></div><div class=paragraph><p><a class=package href=https://cgit.freebsd.org/ports/tree/net/isc-dhcp44-server/>net/isc-dhcp44-server</a> 的安裝程式會安裝一份範例設定檔，複製 <span class=filename>/usr/local/etc/dhcpd.conf.example</span> 到 <span class=filename>/usr/local/etc/dhcpd.conf</span> 並在這個新檔案做編輯。</p></div><div class=paragraph><p>這個設定檔內容包括了子網路及主機的宣告，用來定義要提供給 DHCP 客戶端的資訊。如以下行設定：</p></div><div class="literalblock programlisting"><div class=content><pre>option domain-name &#34;example.org&#34;;<i class=conum data-value=1></i><b>(1)</b>
option domain-name-servers ns1.example.org;<i class=conum data-value=2></i><b>(2)</b>
option subnet-mask 255.255.255.0;<i class=conum data-value=3></i><b>(3)</b>

default-lease-time 600;<i class=conum data-value=4></i><b>(4)</b>
max-lease-time 72400;<i class=conum data-value=5></i><b>(5)</b>
ddns-update-style none;<i class=conum data-value=6></i><b>(6)</b>

subnet 10.254.239.0 netmask 255.255.255.224 {
  range 10.254.239.10 10.254.239.20;<i class=conum data-value=7></i><b>(7)</b>
  option routers rtr-239-0-1.example.org, rtr-239-0-2.example.org;<i class=conum data-value=8></i><b>(8)</b>
}

host fantasia {
  hardware ethernet 08:00:07:26:c0:a5;<i class=conum data-value=9></i><b>(9)</b>
  fixed-address fantasia.fugue.com;<i class=conum data-value=10></i><b>(10)</b>
}</pre></div></div><div class="colist arabic"><table><tbody><tr><td><i class=conum data-value=1></i><b>1</b></td><td>這個選項指定了要提供給客戶端的預設搜尋網域。請參考 <a href="https://man.freebsd.org/cgi/man.cgi?query=resolv.conf&amp;sektion=5&amp;format=html">resolv.conf(5)</a> 取得更多資訊。</td></tr><tr><td><i class=conum data-value=2></i><b>2</b></td><td>這個選項指定了客戶端應使用的 DNS 伺服器清單 (以逗號分隔)。如範例中所示，可使用伺服器的完整網域名稱 (Fully Qualified Domain Names, FQDN) 或伺服器的 IP
位址。</td></tr><tr><td><i class=conum data-value=3></i><b>3</b></td><td>要提供給客戶端的子網路遮罩。</td></tr><tr><td><i class=conum data-value=4></i><b>4</b></td><td>預設租約到期時間 (秒)。客戶端可以自行設定覆蓋這個數值。</td></tr><tr><td><i class=conum data-value=5></i><b>5</b></td><td>一個租約最多允許的時間長度 (秒)。若客戶端請求更長的租約，仍會發出租約，但最多只會在 <code>max-lease-time</code> 內有效。</td></tr><tr><td><i class=conum data-value=6></i><b>6</b></td><td>預設的 <code>none</code> 會關閉動態 DNS 更新。更改此值為 <code>interim</code> 可讓 DHCP 伺服器每當發出一個租約便通知 DNS 伺服器更新，如此一來 DNS 伺服器便知道網路中該電腦的 IP 位址。不要更改此預設值，除非 DNS 伺服器已設定為支援動態 DNS。</td></tr><tr><td><i class=conum data-value=7></i><b>7</b></td><td>此行會建立一個可用 IP 位址的儲存池來保留這些要分配給 DHCP 客戶端的位址。位址範圍必須在前一行所指定的網路或子網路中有效。</td></tr><tr><td><i class=conum data-value=8></i><b>8</b></td><td>宣告在開始的 <code>{</code> 括號之前所指定的網路或子網路中有效的預設通訊閘。</td></tr><tr><td><i class=conum data-value=9></i><b>9</b></td><td>指定客戶端的硬體 MAC 位址，好讓 DHCP 伺服器在客戶端發出請求時可以辨識客戶端。</td></tr><tr><td><i class=conum data-value=10></i><b>10</b></td><td>指定這個主機應分配相同的 IP 位址。在此處用主機名稱是正確的，由於 DHCP 伺服器會在回傳租約資訊前先解析主機名稱。</td></tr></tbody></table></div><div class=paragraph><p>此設定檔還支援其他選項，請參考隨伺服器一併安裝的 dhcpd.conf(5) 來取得詳細資訊與範例。</p></div><div class=paragraph><p>完成 <span class=filename>dhcpd.conf</span> 的設定之後，在 <span class=filename>/etc/rc.conf</span> 啟動 DHCP 伺服器：</p></div><div class="literalblock programlisting"><div class=content><pre>dhcpd_enable=&#34;YES&#34;
dhcpd_ifaces=&#34;dc0&#34;</pre></div></div><div class=paragraph><p>替換 <code>dc0</code> 為 DHCP 伺服器要傾聽 DHCP 客戶端請求的網路介面 (多個介面可以空白分隔)。</p></div><div class=paragraph><p>執行以下指令來啟動伺服器：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service isc-dhcpd start</span></code></pre></div></div><div class=paragraph><p>往後任何對伺服器設定的變更會需要使用 <a href="https://man.freebsd.org/cgi/man.cgi?query=service&amp;sektion=8&amp;format=html">service(8)</a> 中止 dhcpd 服務然後啟動。</p></div><div class=paragraph><p>DHCP 伺服器會使用到以下檔案。注意，操作手冊會與伺服器軟體一同安裝。</p></div><div class=ulist><ul><li><p><span class=filename>/usr/local/sbin/dhcpd</span></p><div class=paragraph><p>更多有關 dhcpd 伺服器的資訊可在 dhcpd(8) 找到。</p></div></li><li><p><span class=filename>/usr/local/etc/dhcpd.conf</span></p><div class=paragraph><p>伺服器設定檔需要含有所有要提供給客戶端的資訊以及有關伺服器運作的資訊。在 dhcpd.conf(5) 有此設定檔的說明。</p></div></li><li><p><span class=filename>/var/db/dhcpd.leases</span></p><div class=paragraph><p>DHCP 伺服器會儲存一份已發出租約的資料於這個檔案，寫入的格式類似日誌。參考 dhcpd.leases(5) 會有更完整的說明。</p></div></li><li><p><span class=filename>/usr/local/sbin/dhcrelay</span></p><div class=paragraph><p>這個 Daemon 會用在更進階的環境中，在一個 DHCP 伺服器要轉發來自客戶端的請求到另一個網路的另一個 DHCP 伺服器的環境。若需要使用此功能，請安裝 <a class=package href=https://cgit.freebsd.org/ports/tree/net/isc-dhcp44-relay/>net/isc-dhcp44-relay</a> 套件或 Port，安裝會包含 dhcrelay(8)，裡面有提供更詳細的資訊。</p></div></li></ul></div></div></div></div><div class=sect1><h2 id=network-dns>29.7. 網域名稱系統 (DNS)<a class=anchor href=#network-dns></a></h2><div class=sectionbody><div class=paragraph><p>網域名稱系統 (Domain Name System, DNS) 是一種協定用來轉換網域名稱為 IP 位址，反之亦然。DNS 會協調網際網路上有權的根節點 (Authoritative root)、最上層網域 (Top Level Domain, TLD) 及其他小規模名稱伺服器來取得結果，而這些伺服器可管理與快取個自的網域資訊。要在系統上做 DNS 查詢並不需要架設一個名稱伺服器。</p></div><div class=paragraph><p>以下表格會說明一些與 DNS 有關的術語：</p></div><table class="tableblock frame-none grid-all stretch"><caption class=title>表 4. DNS 術語</caption><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">術語</th><th class="tableblock halign-left valign-top">定義</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock>正向 DNS (Forward DNS)</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>將主機名稱對應 IP 位址的動作。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>源頭 (Origin)</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>代表某個轄區檔案中所涵蓋的網域。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>解析器 (Resolver)</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>主機向名稱伺服器查詢轄區資訊的系統程序。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>反向 DNS (Reverse DNS)</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>將 IP 對應主機名稱的動作。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>根轄區 (Root zone)</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>網際網路轄區階層的最開始，所有的轄區會在根轄區之下，類似在檔案系統中所有的檔案會在根目錄底下。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>轄區 (Zone)</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>獨立的網域、子網域或或由相同授權 (Authority) 管理的部分 DNS。</p></td></tr></tbody></table><div class=paragraph><p>轄區範例：</p></div><div class=ulist><ul><li><p><code>.</code> 是一般在文件中表達根轄區的方式。</p></li><li><p><code>org.</code> 是一個在根轄區底下的最上層網域 (Top Level Domain , TLD)。</p></li><li><p><code>example.org.</code> 是一個在 <code>org.</code> TLD 底下的轄區。</p></li><li><p><code>1.168.192.in-addr.arpa</code> 是一個轄區用來代表所有在 <code>192.168.1.*</code> IP 位址空間底下的 IP 位址。</p></li></ul></div><div class=paragraph><p>如您所見，更詳細的主機名稱會加在左方，例如 <code>example.org.</code> 比 <code>org.</code> 更具體，如同 <code>org.</code> 比根轄區更具體，主機名稱每一部份的架構很像檔案系統：<span class=filename>/dev</span> 目錄在根目錄底下，以此類推。</p></div><div class=sect2><h3 id=_要架設名稱伺服器的原因>29.7.1. 要架設名稱伺服器的原因<a class=anchor href=#_要架設名稱伺服器的原因></a></h3><div class=paragraph><p>名稱伺服器通常有兩種形式：有權的 (Authoritative) 名稱伺服器與快取 (或稱解析) 名稱伺服器。</p></div><div class=paragraph><p>以下情況會需要一台有權的名稱伺服器：</p></div><div class=ulist><ul><li><p>想要提供 DNS 資訊給全世界，做為官方回覆查詢。</p></li><li><p>已經註冊了一個網域，例如 <code>example.org</code>，且要將 IP 位址分配到主機名稱下。</p></li><li><p>一段 IP 位址範圍需要反向 DNS 項目 (IP 轉主機名稱)。</p></li><li><p>要有一台備援或次要名稱伺服器用來回覆查詢。</p></li></ul></div><div class=paragraph><p>以下情況會需要一台快取名稱伺服器：</p></div><div class=ulist><ul><li><p>比起查詢外部的名稱伺服器本地 DNS 伺服器可以快取並更快的回應。</p></li></ul></div><div class=paragraph><p>當查詢 <code>www.FreeBSD.org</code> 時，解析程式通常會查詢上游 ISP 的名稱伺服器然後接收其回覆，使用本地、快取 DNS 伺服器，只需要由快取 DNS 伺服器對外部做一次查詢，其他的查詢則不需要再向區域網路之外查詢，因為這些資訊已經在本地被快取了。</p></div></div><div class=sect2><h3 id=_dns_伺服器設定>29.7.2. DNS 伺服器設定<a class=anchor href=#_dns_伺服器設定></a></h3><div class=paragraph><p>Unbound 由 FreeBSD 基礎系統提供，預設只會提供本機的 DNS 解析，雖然基礎系統的套件可被設定提供本機以外的解析服務，但要解決這樣的需求仍建議安裝 FreeBSD Port 套件集中的 Unbound。</p></div><div class=paragraph><p>要開啟 Unbound 可加入下行到 <span class=filename>/etc/rc.conf</span>：</p></div><div class="literalblock programlisting"><div class=content><pre>local_unbound_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>任何已存在於 <span class=filename>/etc/resolv.conf</span> 中的名稱伺服器會在新的 Unbound 設定中被設為追隨者 (Forwarder)。</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>若任一個列在清單中的名稱伺服器不支援 DNSSEC，則本地的 DNS 解析便會失敗，請確認有測試每一台名稱伺服器並移除所有測試失敗的項目。以下指令會顯示出信認樹或在 <code>192.168.1.1</code> 上執行失敗的名稱伺服器：</p></div></td></tr></tbody></table></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% drill <span class=nt>-S</span> FreeBSD.org @192.168.1.1</code></pre></div></div><div class=paragraph><p>確認完每一台名稱伺服器都支援 DNSSEC 後啟動 Unbound：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service local_unbound onestart</span></code></pre></div></div><div class=paragraph><p>這將會更新 <span class=filename>/etc/resolv.conf</span> 來讓查詢已用 DNSSEC 確保安全的網域現在可以運作，例如，執行以下指令來檢驗 FreeBSD.org DNSSEC 信任樹：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% drill <span class=nt>-S</span> FreeBSD.org
<span class=p>;;</span> Number of trusted keys: 1
<span class=p>;;</span> Chasing: freebsd.org. A

DNSSEC Trust tree:
freebsd.org. <span class=o>(</span>A<span class=o>)</span>
|---freebsd.org. <span class=o>(</span>DNSKEY keytag: 36786 alg: 8 flags: 256<span class=o>)</span>
    |---freebsd.org. <span class=o>(</span>DNSKEY keytag: 32659 alg: 8 flags: 257<span class=o>)</span>
    |---freebsd.org. <span class=o>(</span>DS keytag: 32659 digest <span class=nb>type</span>: 2<span class=o>)</span>
        |---org. <span class=o>(</span>DNSKEY keytag: 49587 alg: 7 flags: 256<span class=o>)</span>
            |---org. <span class=o>(</span>DNSKEY keytag: 9795 alg: 7 flags: 257<span class=o>)</span>
            |---org. <span class=o>(</span>DNSKEY keytag: 21366 alg: 7 flags: 257<span class=o>)</span>
            |---org. <span class=o>(</span>DS keytag: 21366 digest <span class=nb>type</span>: 1<span class=o>)</span>
            |   |---. <span class=o>(</span>DNSKEY keytag: 40926 alg: 8 flags: 256<span class=o>)</span>
            |       |---. <span class=o>(</span>DNSKEY keytag: 19036 alg: 8 flags: 257<span class=o>)</span>
            |---org. <span class=o>(</span>DS keytag: 21366 digest <span class=nb>type</span>: 2<span class=o>)</span>
                |---. <span class=o>(</span>DNSKEY keytag: 40926 alg: 8 flags: 256<span class=o>)</span>
                    |---. <span class=o>(</span>DNSKEY keytag: 19036 alg: 8 flags: 257<span class=o>)</span>
<span class=p>;;</span> Chase successful</code></pre></div></div></div></div></div><div class=sect1><h2 id=network-apache>29.8. Apache HTTP 伺服器<a class=anchor href=#network-apache></a></h2><div class=sectionbody><div class=paragraph><p>開放源碼的 Apache HTTP Server 是目前最廣泛被使用的網頁伺服器，FreeBSD 預設並不會安裝這個網頁伺服器，但可從 <a class=package href=https://cgit.freebsd.org/ports/tree/www/apache24/>www/apache24</a> 套件或 Port 安裝。</p></div><div class=paragraph><p>本節將會摘要如何設定並啟動在 FreeBSD 上 2.<em>x</em> 版的 Apache HTTP Server，要取得有關 Apache 更詳細的資訊及其設定項目請參考 <a href=http://httpd.apache.org/>httpd.apache.org</a>。</p></div><div class=sect2><h3 id=_設定並啟動_apache>29.8.1. 設定並啟動 Apache<a class=anchor href=#_設定並啟動_apache></a></h3><div class=paragraph><p>在 FreeBSD 中，主 Apache HTTP Server 設定檔會安裝於 <span class=filename>/usr/local/etc/apache2x/httpd.conf</span>，其中 <em>x</em> 代表版號，這份 ASCII 文字檔中以 <code>#</code> 做為行首的是註解，而最常需修改的項目有：</p></div><div class=dlist><dl><dt class=hdlist1><code>ServerRoot "/usr/local"</code></dt><dd><p>指定該 Apache 的預設安裝路徑，Binary 檔會儲存在伺服器根目錄 (Server root) 下的 <span class=filename>bin</span> 與 <span class=filename>sbin</span> 子目錄，而設定檔會儲存在 <span class=filename>etc/apache2x</span> 子目錄。</p></dd><dt class=hdlist1><code>ServerAdmin <a href=mailto:you@example.com>you@example.com</a></code></dt><dd><p>更改此項目為您要接收問題回報的電子郵件位址，這個位址也會顯示在一些伺服器產生的頁面上，如：錯誤頁面。</p></dd><dt class=hdlist1><code>ServerName www.example.com:80</code></dt><dd><p>讓管理者可以設定伺服器要回傳給客戶端的主機名稱 (Hostname)，例如，<code>www</code> 可以更改為實際的主機名稱，若系統並未有註冊的 DNS 名稱，則可改輸入其 IP 位址，若伺服器需要傾聽其他埠號，可更改 <code>80</code> 為其他埠號。</p></dd><dt class=hdlist1><code>DocumentRoot "/usr/local/www/apache2<em>x</em>/data"</code></dt><dd><p>提供文件的目錄，預設所有的請求均會到此目錄，但可以使用符號連結與別名來指向其他地方。</p></dd></dl></div><div class=paragraph><p>在對 Apache 設定檔做變更之前，建議先做備份，在 Apache 設定完成之後，儲存讓檔案並使用 <code>apachectl</code> 檢驗設定，執行 <code>apachectl configtest</code> 的結果應回傳 <code>Syntax OK</code>。</p></div><div class=paragraph><p>要在系統啟動時執行 Apache，可加入下行到 <span class=filename>/etc/rc.conf</span>：</p></div><div class="literalblock programlisting"><div class=content><pre>apache24_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>若 Apache 要使用非預設的選項啟動，可加入下行到 <span class=filename>/etc/rc.conf</span> 來指定所需的旗標參數：</p></div><div class="literalblock programlisting"><div class=content><pre>apache24_flags=&#34;&#34;</pre></div></div><div class=paragraph><p>若 apachectl 未回報設定錯，則可啟動 <code>httpd</code>：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service apache24 start</span></code></pre></div></div><div class=paragraph><p><code>httpd</code> 服務可以透過在網頁瀏覽器中輸入 <code>http://<em>localhost</em></code> 來測試，將 <em>localhost</em> 更改為執行 <code>httpd</code> 那台主機的完整網域名稱 (Fully-qualified domain name)。預設會顯示的網頁為 <span class=filename>/usr/local/www/apache24/data/index.html</span>。</p></div><div class=paragraph><p>後續若有在 <code>httpd</code> 執行中時修改 Apache 設定檔可使用以下指令來測試是否有誤：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service apache24 configtest</span></code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>注意，<code>configtest</code> 並非採用 <a href="https://man.freebsd.org/cgi/man.cgi?query=rc&amp;sektion=8&amp;format=html">rc(8)</a> 標準，不應預期其可在所有的啟動 Script 中正常運作。</p></div></td></tr></tbody></table></div></div><div class=sect2><h3 id=_虛擬主機>29.8.2. 虛擬主機<a class=anchor href=#_虛擬主機></a></h3><div class=paragraph><p>虛擬主機允許在一個 Apache 伺服器執行多個網站，虛擬主機可以是以 IP 為主 (<em>IP-based</em>) 或以名稱為主 (<em>name-based</em>)。以 IP 為主的虛擬主機中的每一個網站要使用不同的 IP 位址。以名稱為主的虛擬主機會使用客戶端的 HTTP/1.1 標頭來判斷主機名稱，這可讓不同的網站共用相同的 IP 位址。</p></div><div class=paragraph><p>要設定 Apache 使用以名稱為主的虛擬主機可在每一個網站加入 <code>VirtualHost</code> 區塊，例如，有一個名稱為 <code>www.domain.tld</code> 的主機擁有一個 <code>www.someotherdomain.tld</code> 的虛擬網域，可加入以下項目到 <span class=filename>httpd.conf</span>：</p></div><div class="literalblock programlisting"><div class=content><pre>&lt;VirtualHost *&gt;
    ServerName www.domain.tld
    DocumentRoot /www/domain.tld
&lt;/VirtualHost&gt;

&lt;VirtualHost *&gt;
    ServerName www.someotherdomain.tld
    DocumentRoot /www/someotherdomain.tld
&lt;/VirtualHost&gt;</pre></div></div><div class=paragraph><p>每一個虛擬主機均需更改其 <code>ServerName</code> 與 <code>DocumentRoot</code> 的值為實際要使用的值。</p></div><div class=paragraph><p>更多有關設定虛擬主機的資訊，可參考 Apache 官方說明文件於：<a href=http://httpd.apache.org/docs/vhosts/>http://httpd.apache.org/docs/vhosts/</a>。</p></div></div><div class=sect2><h3 id=_apache_模組>29.8.3. Apache 模組<a class=anchor href=#_apache_模組></a></h3><div class=paragraph><p>Apache 使用模組 (Module) 來擴充伺服器所提供的功能。請參考 <a href=http://httpd.apache.org/docs/current/mod/>http://httpd.apache.org/docs/current/mod/</a> 來取得可用模組的完整清單與設定詳細資訊。</p></div><div class=paragraph><p>在 FreeBSD 中有些模組可以隨著 <a class=package href=https://cgit.freebsd.org/ports/tree/www/apache24/>www/apache24</a> Port 編譯，只要在 <span class=filename>/usr/ports/www/apache24</span> 輸入 <code>make config</code> 便可查看有那一些模組是預設開啟的，若模組未與 Port 一併編譯，FreeBSD Port 套件集也提供了一個簡單的方式可安裝各種模組，本節將介紹最常使用的三個模組。</p></div><div class=sect3><h4 id=_mod_ssl>29.8.3.1. <span class=filename>mod_ssl</span><a class=anchor href=#_mod_ssl></a></h4><div class=paragraph><p><span class=filename>mod_ssl</span> 模組利用了 OpenSSL 透過 Secure Sockets Layer (SSLv3) 與 Transport Layer Security (TLSv1) 通訊協定來提供強大的加密，這個模組提供了向受信認的憑証簽署機構申請簽章憑証所需的任何東西，讓 FreeBSD 上能夠執行安全的網頁伺服器。</p></div><div class=paragraph><p>在 FreeBSD 中 <span class=filename>mod_ssl</span> 模組預設在套件與 Port 均是開啟的，可用的設定項目在 <a href=http://httpd.apache.org/docs/current/mod/mod_ssl.html>http://httpd.apache.org/docs/current/mod/mod_ssl.html</a> 會說明。</p></div></div><div class=sect3><h4 id=_mod_perl>29.8.3.2. <span class=filename>mod_perl</span><a class=anchor href=#_mod_perl></a></h4><div class=paragraph><p><span class=filename>mod_perl</span> 模組讓您可以使用 Perl 撰寫 Apache 模組，除此之外，嵌入到伺服器的直譯器可避免啟動外部直譯器的額外開銷與 Perl 耗費的啟動時間。</p></div><div class=paragraph><p><span class=filename>mod_perl</span> 可以使用 <a class=package href=https://cgit.freebsd.org/ports/tree/www/mod_perl2/>www/mod_perl2</a> 套件或 Port 安裝，有關使用此模組的說明文件可在 <a href=http://perl.apache.org/docs/2.0/index.html>http://perl.apache.org/docs/2.0/index.html</a> 中找到。</p></div></div><div class=sect3><h4 id=_mod_php>29.8.3.3. <span class=filename>mod_php</span><a class=anchor href=#_mod_php></a></h4><div class=paragraph><p><em>PHP: Hypertext Preprocessor</em> (PHP) 是一般用途的腳本 (Script) 語言，特別適用於網站開發，能夠嵌入在 HTML 當中，它的語法參考自 C, Java™ 及 Perl，目的在讓網頁開發人員能快速的寫出動態網頁。</p></div><div class=paragraph><p>要在 Apache 網頁伺服器上加入對 PHP5 的支援，可安裝 <a class=package href=https://cgit.freebsd.org/ports/tree/www/mod_php56/>www/mod_php56</a> 套件或 Port，這會安裝並設定支援動態 PHP 應用程式所需的模組。安裝過程會自動加入下行到 <span class=filename>/usr/local/etc/apache24/httpd.conf</span>：</p></div><div class="literalblock programlisting"><div class=content><pre>LoadModule php5_module        libexec/apache24/libphp5.so</pre></div></div><div class=paragraph><p>接著，執行 graceful 重新啟動來載入 PHP 模組：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># apachectl graceful</span></code></pre></div></div><div class=paragraph><p>由 <a class=package href=https://cgit.freebsd.org/ports/tree/www/mod_php56/>www/mod_php56</a> 所提供的 PHP 支援是有限的，若需要額外的支援可以使用 <a class=package href=https://cgit.freebsd.org/ports/tree/lang/php56-extensions/>lang/php56-extensions</a> Port 來安裝，該 Port 提供了選單介面來選擇可用的 PHP 擴充套件。</p></div><div class=paragraph><p>或者，可以找到適當的 Port 來安裝各別的擴充套件，例如，要增加 PHP 對 MySQL 資料庫伺服器的支援可安裝 <a class=package href=https://cgit.freebsd.org/ports/tree/databases/php56-mysql/>databases/php56-mysql</a>。</p></div><div class=paragraph><p>在安裝完擴充套件之後，必須重新載入 Apache 伺服器來使用新的設定值：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># apachectl graceful</span></code></pre></div></div></div></div><div class=sect2><h3 id=_動態網站>29.8.4. 動態網站<a class=anchor href=#_動態網站></a></h3><div class=paragraph><p>除了 mod_perl 與 mod_php 外，也有其他語言可用來建立動態網頁內容，這包含了 Django 與 Ruby on Rails。</p></div><div class=sect3><h4 id=_django>29.8.4.1. Django<a class=anchor href=#_django></a></h4><div class=paragraph><p>Django 是以 BSD 授權的框架 (Framework)，指在讓開發人員能快速的寫出高效、優雅的網頁應用程式。它提供了物件關聯對應器 (Object-relational mapper)，所以各種資料型態可當做 Python 的物件來開發，且提供了豐富的動態資料庫存取 API 給這些物件，讓開發人員不再需要寫 SQL。它也同時提供了可擴充的樣板系統，來讓應用程式的邏輯與 HTML 呈現能夠被拆開。</p></div><div class=paragraph><p>Django 需要 <span class=filename>mod_python</span>，以及一個 SQL 資料庫引擎才能運作。在 FreeBSD 中的 <a class=package href=https://cgit.freebsd.org/ports/tree/www/py-django/>www/py-django</a> Port 會自動安裝 <span class=filename>mod_python</span> 以及對 PostgreSQL, MySQL 或 SQLite 資料庫的支援，預設為 SQLite，要更改資料庫引擎可在 <span class=filename>/usr/ports/www/py-django</span> 輸入 <code>make config</code> 然後再安裝該 Port。</p></div><div class=paragraph><p>Django 安裝完成之後，應用程式會需要一個專案目錄並搭配 Apache 設定才能使用內嵌的 Python 直譯器，此直譯器會用來呼叫網站上指定 URL 的應用程式。</p></div><div class=paragraph><p>要設定 Apache 傳遞某個 URL 請求到網站應用程式，可加入下行到 <span class=filename>httpd.conf</span> 來指定專案目錄的完整路徑：</p></div><div class="literalblock programlisting"><div class=content><pre>&lt;Location &#34;/&#34;&gt;
    SetHandler python-program
    PythonPath &#34;[&#39;/dir/to/the/django/packages/&#39;] + sys.path&#34;
    PythonHandler django.core.handlers.modpython
    SetEnv DJANGO_SETTINGS_MODULE mysite.settings
    PythonAutoReload On
    PythonDebug On
&lt;/Location&gt;</pre></div></div><div class=paragraph><p>請參考 <a href=https://docs.djangoproject.com>https://docs.djangoproject.com</a> 來取得如何使用 Django 的更多資訊。</p></div></div><div class=sect3><h4 id=_ruby_on_rails>29.8.4.2. Ruby on Rails<a class=anchor href=#_ruby_on_rails></a></h4><div class=paragraph><p>Ruby on Rails 是另外一套開放源碼的網站框架 (Framework)，提供了完整的開發堆疊，這使得網頁開發人員可以更有生產力且能夠快速的寫出強大的應用程式，在 FreeBSD 它可以使用 <a class=package href=https://cgit.freebsd.org/ports/tree/www/rubygem-rails/>www/rubygem-rails</a> 套件或 Port 安裝。</p></div><div class=paragraph><p>請參考 <a href=http://guides.rubyonrails.org>http://guides.rubyonrails.org</a> 來取得更多有關如何使用 Ruby on Rails 的資訊。</p></div></div></div></div></div><div class=sect1><h2 id=network-ftp>29.9. 檔案傳輸協定 (FTP)<a class=anchor href=#network-ftp></a></h2><div class=sectionbody><div class=paragraph><p>檔案傳輸協定 (File Transfer Protocol, FTP) 提供了使用一個簡單的方式能夠將檔案傳輸到與接收自 FTP 伺服器，FreeBSD 內建了 FTP 伺服器軟體 ftpd 在基礎系統 (Base system) 中。</p></div><div class=paragraph><p>FreeBSD 提供了多個設定檔來控制對 FTP 伺服器的存取，本節將摘要這些檔案的設定方式，請參考 <a href="https://man.freebsd.org/cgi/man.cgi?query=ftpd&amp;sektion=8&amp;format=html">ftpd(8)</a> 來取得更多有關內建 FTP 伺服器的詳細資訊。</p></div><div class=sect2><h3 id=_設定>29.9.1. 設定<a class=anchor href=#_設定></a></h3><div class=paragraph><p>最重要的一個設定步驟便是決定那些帳號能夠存取 FTP 伺服器，FreeBSD 系統有數個系統帳號，這些帳號不應該能夠擁有 FTP 存取權，不允許存取 FTP 的使用者清單可在 <span class=filename>/etc/ftpusers</span> 找到，預設該檔案內會有所有的系統帳號，其他不應允許存取 FTP 的使用者也可在此加入。</p></div><div class=paragraph><p>在某些情況可能會布望限制某些使用者的存取，而不是完全避免這些使用者使用 FTP，這可以透過建立 <span class=filename>/etc/ftpchroot</span> 來完成，詳如 <a href="https://man.freebsd.org/cgi/man.cgi?query=ftpchroot&amp;sektion=5&amp;format=html">ftpchroot(5)</a> 所述，這個檔案會列出受到 FTP 存取限制的使用者與群組。</p></div><div class=paragraph><p>要在伺服器上開啟匿名 FTP 存取權，可在 FreeBSD 系統上建立一個名稱為 <code>ftp</code> 使用者，使用者將能夠使用 <code>ftp</code> 或 <code>anonymous</code> 使用者名稱來登入 FTP 伺服器，當提示輸入密碼時，輸入任何值都會被接受，但是慣例上應使用電子郵件位址來當做密碼。當匿名使用者登入時 FTP 伺服器會呼叫 <a href="https://man.freebsd.org/cgi/man.cgi?query=chroot&amp;sektion=2&amp;format=html">chroot(2)</a> 來限制使用者只能存取 <code>ftp</code> 使用者的家目錄。</p></div><div class=paragraph><p>要設定顯示給 FTP 客戶端的歡迎訊息有兩個文字檔可以建立，<span class=filename>/etc/ftpwelcome</span> 的內容會在收到登入提示前顯示給使用者看，登入成功能後，則會顯示 <span class=filename>/etc/ftpmotd</span> 的內容。注意，這個檔案的路徑是相對於登入環境的，所以 <span class=filename>~ftp/etc/ftpmotd</span> 的內容只會對匿名使用者顯示。</p></div><div class=paragraph><p>設定完 FTP 伺服器之後，在 <span class=filename>/etc/rc.conf</span> 設定適當的變數來在開機時啟動該服務：</p></div><div class="literalblock programlisting"><div class=content><pre>ftpd_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>要立即啟動服務可：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service ftpd start</span></code></pre></div></div><div class=paragraph><p>要測試到 FTP 伺服器的連線可輸入：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% ftp localhost</code></pre></div></div><div class=paragraph><p>ftpd daemon 會使用 <a href="https://man.freebsd.org/cgi/man.cgi?query=syslog&amp;sektion=3&amp;format=html">syslog(3)</a> 來記錄訊息，預設，系統記錄 Daemon 會寫入有關 FTP 的訊息到 <span class=filename>/var/log/xferlog</span>，FTP 記錄的位置可以透過更改 <span class=filename>/etc/syslog.conf</span> 中下行來做修改：</p></div><div class="literalblock programlisting"><div class=content><pre>ftp.info      /var/log/xferlog</pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>要注意啟動匿名 FTP 伺服器可能的潛藏問題，尤其是要讓匿名使用者上傳檔案時要再次確認，因為這可能讓該 FTP 站變成用來交換未授權商業軟體的交流平台或者更糟的狀況。若真的需要匿名 FTP 上傳，那麼請檢查權限設定，讓這些檔案在尚未被管理者審查前不能夠被其他匿名使用者讀取。</p></div></td></tr></tbody></table></div></div></div></div><div class=sect1><h2 id=network-samba>29.10. Microsoft™Windows™ 用戶端檔案與列印服務 (Samba)<a class=anchor href=#network-samba></a></h2><div class=sectionbody><div class=paragraph><p>Samba 是熱門的開放源碼軟體套件，使用 SMB/CIFS 通訊協定提供檔案與列印服務，此通訊協定內建於 Microsoft™ Windows™ 系統，在非 Microsoft™ Windows™ 的系統可透過安裝 Samba 客戶端程式庫來支援此協定。此通訊協定讓客戶端可以存取共享的資料與印表機，這些共享的資源可掛載到一個本機的磁碟機，而共享的印表機則可以當做本機的印表機使用。</p></div><div class=paragraph><p>在 FreeBSD 上，可以使用 <a class=package href=https://cgit.freebsd.org/ports/tree/net/samba48/>net/samba48</a> Port 或套件來安裝 Samba 客戶端程式庫，這個客戶端提供了讓 FreeBSD 系統能存取 SMB/CIFS 在 Microsoft™ Windows™ 網路中共享的資源。</p></div><div class=paragraph><p>FreeBSD 系統也可以透過安裝 <a class=package href=https://cgit.freebsd.org/ports/tree/net/samba48/>net/samba48</a> Port 或套件來設定成 Samba 伺服器，這讓管理者可以在 FreeBSD 系統上建立 SMB/CIFS 的共享資源，讓執行 Microsoft™ Windows™ 或 Samba 客戶端程式庫的客戶端能夠存取。</p></div><div class=sect2><h3 id=_伺服器設定>29.10.1. 伺服器設定<a class=anchor href=#_伺服器設定></a></h3><div class=paragraph><p>Samba 的設定位於 <span class=filename>/usr/local/etc/smb4.conf</span>，必須先設定這個檔案才可使用 Samba。</p></div><div class=paragraph><p>要共享目錄與印表機給在工作群組中的 Windows™ 客戶端的簡易 <span class=filename>smb4.conf</span> 範例如下。對於涉及 LDAP 或 Active Directory 的複雜安裝，可使用 <a href="https://man.freebsd.org/cgi/man.cgi?query=samba-tool&amp;sektion=8&amp;format=html">samba-tool(8)</a> 來建立初始的 <span class=filename>smb4.conf</span>。</p></div><div class="literalblock programlisting"><div class=content><pre>[global]
workgroup = WORKGROUP
server string = Samba Server Version %v
netbios name = ExampleMachine
wins support = Yes
security = user
passdb backend = tdbsam

# Example: share /usr/src accessible only to &#39;developer&#39; user
[src]
path = /usr/src
valid users = developer
writable  = yes
browsable = yes
read only = no
guest ok = no
public = no
create mask = 0666
directory mask = 0755</pre></div></div><div class=sect3><h4 id=_全域設定>29.10.1.1. 全域設定<a class=anchor href=#_全域設定></a></h4><div class=paragraph><p>在 <span class=filename>/usr/local/etc/smb4.conf</span> 中加入用來描述網路環境的設定有：</p></div><div class=dlist><dl><dt class=hdlist1><code>workgroup</code></dt><dd><p>要提供的工作群組名稱。</p></dd><dt class=hdlist1><code>netbios name</code></dt><dd><p>Samba 伺服器已知的 NetBIOS 名稱，預設為主機的 DNS 名稱第一節。</p></dd><dt class=hdlist1><code>server string</code></dt><dd><p>會顯示於 <code>net view</code> 輸出結果以及其他會尋找伺服器描述文字並顯示的網路工具的文字。</p></dd><dt class=hdlist1><code>wins support</code></dt><dd><p>不論 Samba 是否要作為 WINS 伺服器，請不要在網路上開啟超過一台伺服器的 WINS 功能。</p></dd></dl></div></div><div class=sect3><h4 id=_安全性設定>29.10.1.2. 安全性設定<a class=anchor href=#_安全性設定></a></h4><div class=paragraph><p>在 <span class=filename>/usr/local/etc/smb4.conf</span> 中最重要的設定便是安全性模式以及後端密碼格式，以下項目管控的選項有：</p></div><div class=dlist><dl><dt class=hdlist1><code>security</code></dt><dd><p>最常見的設定為 <code>security = share</code> 以及 <code>security = user</code>，若客戶端使用的使用者名稱與在 FreeBSD 主機上使用的使用者名稱相同，則應該使用使用者 (user) 層級的安全性，這是預設的安全性原則且它會要求客戶端在存取共享資源前先登入。</p><div class=paragraph><p>安全性為共享 (share) 層級時，客戶端存取共享資源不需要先使用有效的使用者名稱與密碼登入伺服器，在是在舊版 Samba 所採用的預設安全性模式。</p></div></dd><dt class=hdlist1><code>passdb backend</code></dt><dd><p>Samba 支援數種不同的後端認証模式，客戶端可以使用 LDAP, NIS+, SQL 資料庫或修改過的密碼檔來認証，建議的認証方式是 <code>tdbsam</code>，適用於簡易的網路環境且在此處說明，對於較大或更複雜的網路則較建議使用 <code>ldapsam</code>，而 <code>smbpasswd</code> 是舊版的預設值，現在已廢棄不使用。</p></dd></dl></div></div><div class=sect3><h4 id=_samba_使用者>29.10.1.3. Samba 使用者<a class=anchor href=#_samba_使用者></a></h4><div class=paragraph><p>FreeBSD 使用者帳號必須對應 <code>SambaSAMAccount</code> 資料庫， 才能讓 Windows™ 客戶端存取共享資源，要對應既有的 FreeBSD 使用者帳號可使用 <a href="https://man.freebsd.org/cgi/man.cgi?query=pdbedit&amp;sektion=8&amp;format=html">pdbedit(8)</a>：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pdbedit -a username</span></code></pre></div></div><div class=paragraph><p>本節只會提到一些最常用的設定，請參考 <a href=http://www.samba.org/samba/docs/man/Samba-HOWTO-Collection/>官方 Samba HOWTO</a> 來取得有關可用設定選項的額外資訊。</p></div></div></div><div class=sect2><h3 id=_啟動_samba>29.10.2. 啟動 Samba<a class=anchor href=#_啟動_samba></a></h3><div class=paragraph><p>要在開機時啟動 Samba，可加入下行到 <span class=filename>/etc/rc.conf</span>：</p></div><div class="literalblock programlisting"><div class=content><pre>samba_server_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>要立即啟動 Samba：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service samba_server start</span>
Performing sanity check on Samba configuration: OK
Starting nmbd.
Starting smbd.</code></pre></div></div><div class=paragraph><p>Samba 由三個獨立的 Daemon 所組成，nmbd 與 smbd daemon 可透過 <code>samba_enable</code> 來啟動，若同時也需要 winbind 名稱解析服務則需額外設定：</p></div><div class="literalblock programlisting"><div class=content><pre>winbindd_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>Samba 可以隨時停止，要停止可輸入：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service samba_server stop</span></code></pre></div></div><div class=paragraph><p>Samba 是一套擁有能整合 Microsoft™ Windows™ 網路功能的複雜軟體套件，除了在此處說明的基礎設定，要取得更多的功能資訊，請參考 <a href=http://www.samba.org>http://www.samba.org</a>。</p></div></div></div></div><div class=sect1><h2 id=network-ntp>29.11. NTP 時間校對<a class=anchor href=#network-ntp></a></h2><div class=sectionbody><div class=paragraph><p>隨著使用時間，電腦的時鐘會逐漸偏移，這對需要網路上電腦有相同準確度時間的許多網路服務來說是一個大問題。準確的時間同樣能確保檔案時間戳記的一致性。網路時間協定 (Network Time Protocol, NTP) 是一種在網路上可以確保時間準確的方式。</p></div><div class=paragraph><p>FreeBSD 內含 <a href="https://man.freebsd.org/cgi/man.cgi?query=ntpd&amp;sektion=8&amp;format=html">ntpd(8)</a> 可設定來查詢其他 NTP 伺服器來同步電腦的時間或提供時間服務給其他在網路上的電腦。</p></div><div class=paragraph><p>本節將會介紹如何設定 FreeBSD 上的 ntpd，更進一步的說明文件可於 <span class=filename>/usr/shared/doc/ntp/</span> 找到 HTML 格式的版本。</p></div><div class=sect2><h3 id=_ntp_設定>29.11.1. NTP 設定<a class=anchor href=#_ntp_設定></a></h3><div class=paragraph><p>在 FreeBSD，內建的 ntpd 可用來同步系統的時間，Ntpd 要使用 <a href="https://man.freebsd.org/cgi/man.cgi?query=rc.conf&amp;sektion=5&amp;format=html">rc.conf(5)</a> 中的變數以及下一節會詳細說明的 <span class=filename>/etc/ntp.conf</span> 來設定。</p></div><div class=paragraph><p>Ntpd 與網路中各節點的通訊採用 UDP 封包，在伺服器與 NTP 各節點間的防火牆必須設定成可允許進/出埠 123 的 UDP 封包。</p></div><div class=sect3><h4 id=_etcntp_conf_檔>29.11.1.1. <span class=filename>/etc/ntp.conf</span> 檔<a class=anchor href=#_etcntp_conf_檔></a></h4><div class=paragraph><p>Ntpd 會讀取 <span class=filename>/etc/ntp.conf</span> 來得知要從那些 NTP 伺服器查詢時間，建議可設定多個 NTP 伺服器，來避免萬一其中一個伺服器無法連線或是時間不可靠的問題，當 ntpd 收到回應，它會偏好先採用較可信賴的伺服器。查詢的伺服器可以是來自本地網路的 ISP 所提供，也可從<a href=http://support.ntp.org/bin/view/Servers/WebHome>線上可公開存取的NTP 伺服器清單</a>中挑選，您可以選擇一個離您地理位置較近的伺服器並閱讀它的使用規則。也有 <a href=http://support.ntp.org/bin/view/Servers/NTPPoolServers>可公開存取的 NTP 池線上清單</a>可用，由一個地理區域所組織，除此之外 FreeBSD 提供了計劃贊助的伺服器池，<code>0.freebsd.pool.ntp.org</code>。</p></div><div class=exampleblock><div class=title>例 4. <span class=filename>/etc/ntp.conf</span> 範例</div><div class=content><div class=paragraph><p>這份簡單的 <span class=filename>ntp.conf</span> 範例檔可以放心的使用，其中包含了建議的 <code>restrict</code> 選項可避免伺服器被公開存取。</p></div><div class="literalblock programlisting"><div class=content><pre># Disallow ntpq control/query access.  Allow peers to be added only
# based on pool and server statements in this file.
restrict default limited kod nomodify notrap noquery nopeer
restrict source  limited kod nomodify notrap noquery

# Allow unrestricted access from localhost for queries and control.
restrict 127.0.0.1
restrict ::1

# Add a specific server.
server ntplocal.example.com iburst

# Add FreeBSD pool servers until 3-6 good servers are available.
tos minclock 3 maxclock 6
pool 0.freebsd.pool.ntp.org iburst

# Use a local leap-seconds file.
leapfile &#34;/var/db/ntpd.leap-seconds.list&#34;</pre></div></div></div></div><div class=paragraph><p>這個檔案的格式在 <a href="https://man.freebsd.org/cgi/man.cgi?query=ntp.conf&amp;sektion=5&amp;format=html">ntp.conf(5)</a> 有詳細說明，以下的說明僅快速的帶過以上範例檔有用到的一些關鍵字。</p></div><div class=paragraph><p>預設 NTP 伺服器是可以被任何網路主機所存取，<code>restrict</code> 關鍵字可以控制有那些系統可以存取伺服器。<code>restrict</code> 支援設定多項，每一項可再更進一步調整前面所做的設定。範例中的設定授權本地系統有完整的查詢及控制權限，而遠端系統只有查詢時間的權限。要了解更詳細的資訊請參考 <a href="https://man.freebsd.org/cgi/man.cgi?query=ntp.conf&amp;sektion=5&amp;format=html">ntp.conf(5)</a> 中的 <code>Access Control Support</code> 一節。</p></div><div class=paragraph><p><code>server</code> 關鍵字可指定要查詢的伺服器，設定檔中可以使用多個 server 關鍵字，一個伺服器列一行。<code>pool</code> 關鍵字可指定伺服器池，Ntpd 會加入該伺服器池中的一或多台伺服器，直到數量滿足 <code>tos minclock</code> 的設定。<code>iburst</code> 關鍵字會指示 ntpd 在建立連線時執行 8 連發快速封包交換，可以更快的同步系統時間。</p></div><div class=paragraph><p><code>leapfile</code> 關鍵字用來指定含有閏秒 (Leap second) 資訊的檔案位置，該檔案是由 <a href="https://man.freebsd.org/cgi/man.cgi?query=periodic&amp;sektion=8&amp;format=html">periodic(8)</a> 自動更新。這個關鍵字指定的檔案位置必須與 <span class=filename>/etc/rc.conf</span> 中設定的 <code>ntp_db_leapfile</code> 相同。</p></div></div><div class=sect3><h4 id=_在_etcrc_conf_中的_ntp_設定項目>29.11.1.2. 在 <span class=filename>/etc/rc.conf</span> 中的 NTP 設定項目<a class=anchor href=#_在_etcrc_conf_中的_ntp_設定項目></a></h4><div class=paragraph><p>設定 <code>ntpd_enable="YES"</code> 可讓開機時會啟動 ntpd。將 <code>ntpd_enable=YES</code> 加到 <span class=filename>/etc/rc.conf</span> 之後，可輸入以下指令讓 ntpd 不需重新開機立即啟動：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service ntpd start</span></code></pre></div></div><div class=paragraph><p>要使用 ntpd 必須設定 <code>ntpd_enable</code>，以下所列的 <span class=filename>rc.conf</span> 變數可視所需請況設定。</p></div><div class=paragraph><p>設定 <code>ntpd_sync_on_start=YES</code> 可讓 ntpd 可以在系統啟動時一次同步任何差距的時間，正常情況若時鐘的差距超過 1000 秒便會記錄錯誤並且中止。這個設定項目在沒有電池備援的時鐘上特別有用。</p></div><div class=paragraph><p>設定 <code>ntpd_oomprotect=YES</code> 可保護 ntpd daemon 被系統中止並嘗試從記憶體不足 (Out Of Memory, OOM) 的情況恢復運作。</p></div><div class=paragraph><p>設定 <code>ntpd_config=</code> 可更改 <span class=filename>ntp.conf</span> 檔案的位置。</p></div><div class=paragraph><p>設定 <code>ntpd_flags=</code> 可設定使用任何其他所需 ntpd 參數，但要避免使用由 <span class=filename>/etc/rc.d/ntpd</span> 內部控管的參數如下：</p></div><div class=ulist><ul><li><p><code>-p</code> (pid 檔案位置)</p></li><li><p><code>-c</code> (改用 <code>ntpd_config=</code> 設定)</p></li></ul></div></div><div class=sect3><h4 id=_使用無特權的_ntpd_使用者執行_ntpd>29.11.1.3. 使用無特權的 <code>ntpd</code> 使用者執行 Ntpd<a class=anchor href=#_使用無特權的_ntpd_使用者執行_ntpd></a></h4><div class=paragraph><p>在 FreeBSD 上的 Ntpd 現在可以使用無特權的使用者啟動並執行，要達到這個功能需要 <a href="https://man.freebsd.org/cgi/man.cgi?query=mac_ntpd&amp;sektion=4&amp;format=html">mac_ntpd(4)</a> 規則模組。<span class=filename>/etc/rc.d/ntpd</span> 啟動 Script 會先檢查 NTP 的設定，若可以的話它會載入 <code>mac_ntpd</code> 模組，然後以無特權的使用者 <code>ntpd</code> (user id 123) 來啟動 ntpd。為了避免檔案與目錄存取權限的問題，當設定中有任何檔案相關的選項時，啟動 Script 不會自動以 <code>ntpd</code> 身份啟動 ntpd。</p></div><div class=paragraph><p>在 <code>ntpd_flags</code> 若出現以下任何參數則需要以最下面的方式手動設定才能以 <code>ntpd</code> 使用者的身份執行：</p></div><div class=ulist><ul><li><p>-f 或 --driftfile</p></li><li><p>-i 或 --jaildir</p></li><li><p>-k 或 --keyfile</p></li><li><p>-l 或 --logfile</p></li><li><p>-s 或 --statsdir</p></li></ul></div><div class=paragraph><p>在 <span class=filename>ntp.conf</span> 若出現以下任何關鍵字則需要以最下面的方式手動設定才能以 <code>ntpd</code> 使用者的身份執行：</p></div><div class=ulist><ul><li><p>crypto</p></li><li><p>driftfile</p></li><li><p>key</p></li><li><p>logdir</p></li><li><p>statsdir</p></li></ul></div><div class=paragraph><p>要手動設定以使用者 <code>ntpd</code> 身份執行 ntpd 你必須：</p></div><div class=ulist><ul><li><p>確保 <code>ntpd</code> 使用者有權限存取所有在設定檔中指定的檔案與目錄。</p></li><li><p>讓 <code>mac_ntpd</code> 模組載入或編譯至核心，請參考 <a href="https://man.freebsd.org/cgi/man.cgi?query=mac_ntpd&amp;sektion=4&amp;format=html">mac_ntpd(4)</a> 取得詳細資訊。</p></li><li><p>在 <span class=filename>/etc/rc.conf</span> 中設定 <code>ntpd_user="ntpd"</code></p></li></ul></div></div></div><div class=sect2><h3 id=_在_ppp_連線使用_ntp>29.11.2. 在 PPP 連線使用 NTP<a class=anchor href=#_在_ppp_連線使用_ntp></a></h3><div class=paragraph><p>ntpd 並不需要永久的網際網路連線才能正常運作，若有一個 PPP 連線是設定成需要時撥號，那麼便需要避免 NTP 的流量觸發撥號或是保持連線不中斷，這可在 <span class=filename>/etc/ppp/ppp.conf</span> 使用 <code>filter</code> 項目設定，例如：</p></div><div class="literalblock programlisting"><div class=content><pre>set filter dial 0 deny udp src eq 123
# Prevent NTP traffic from initiating dial out
set filter dial 1 permit 0 0
set filter alive 0 deny udp src eq 123
# Prevent incoming NTP traffic from keeping the connection open
set filter alive 1 deny udp dst eq 123
# Prevent outgoing NTP traffic from keeping the connection open
set filter alive 2 permit 0/0 0/0</pre></div></div><div class=paragraph><p>要取得更詳細的資訊，請參考於 <a href="https://man.freebsd.org/cgi/man.cgi?query=ppp&amp;sektion=8&amp;format=html">ppp(8)</a> 的 <code>PACKET FILTERING</code> 小節以及在 <span class=filename>/usr/shared/examples/ppp/</span> 中的範例。</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>部份網際網路存取提供商會封鎖較小編號的埠，這會讓 NTP 無法運作，因為回應永遠無到傳送到該主機。</p></div></td></tr></tbody></table></div></div></div></div><div class=sect1><h2 id=network-iscsi>29.12. iSCSI Initiator 與 Target 設定<a class=anchor href=#network-iscsi></a></h2><div class=sectionbody><div class=paragraph><p>iSCSI is a way to share storage over a network. Unlike NFS, which works at the file system level, iSCSI works at the block device level.</p></div><div class=paragraph><p>In iSCSI terminology, the system that shares the storage is known as the <em>target</em>. The storage can be a physical disk, or an area representing multiple disks or a portion of a physical disk. For example, if the disk(s) are formatted with ZFS, a zvol can be created to use as the iSCSI storage.</p></div><div class=paragraph><p>The clients which access the iSCSI storage are called <em>initiators</em>. To initiators, the storage available through iSCSI appears as a raw, unformatted disk known as a LUN. Device nodes for the disk appear in <span class=filename>/dev/</span> and the device must be separately formatted and mounted.</p></div><div class=paragraph><p>FreeBSD provides a native, kernel-based iSCSI target and initiator. This section describes how to configure a FreeBSD system as a target or an initiator.</p></div><div class=sect2><h3 id=network-iscsi-target>29.12.1. 設定 iSCSI Target<a class=anchor href=#network-iscsi-target></a></h3><div class=paragraph><p>To configure an iSCSI target, create the <span class=filename>/etc/ctl.conf</span> configuration file, add a line to <span class=filename>/etc/rc.conf</span> to make sure the <a href="https://man.freebsd.org/cgi/man.cgi?query=ctld&amp;sektion=8&amp;format=html">ctld(8)</a> daemon is automatically started at boot, and then start the daemon.</p></div><div class=paragraph><p>The following is an example of a simple <span class=filename>/etc/ctl.conf</span> configuration file. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=ctl.conf&amp;sektion=5&amp;format=html">ctl.conf(5)</a> for a more complete description of this file’s available options.</p></div><div class="literalblock programlisting"><div class=content><pre>portal-group pg0 {
	discovery-auth-group no-authentication
	listen 0.0.0.0
	listen [::]
}

target iqn.2012-06.com.example:target0 {
	auth-group no-authentication
	portal-group pg0

	lun 0 {
		path /data/target0-0
		size 4G
	}
}</pre></div></div><div class=paragraph><p>The first entry defines the <code>pg0</code> portal group. Portal groups define which network addresses the <a href="https://man.freebsd.org/cgi/man.cgi?query=ctld&amp;sektion=8&amp;format=html">ctld(8)</a> daemon will listen on. The <code>discovery-auth-group no-authentication</code> entry indicates that any initiator is allowed to perform iSCSI target discovery without authentication. Lines three and four configure <a href="https://man.freebsd.org/cgi/man.cgi?query=ctld&amp;sektion=8&amp;format=html">ctld(8)</a> to listen on all IPv4 (<code>listen 0.0.0.0</code>) and IPv6 (<code>listen [::]</code>) addresses on the default port of 3260.</p></div><div class=paragraph><p>It is not necessary to define a portal group as there is a built-in portal group called <code>default</code>. In this case, the difference between <code>default</code> and <code>pg0</code> is that with <code>default</code>, target discovery is always denied, while with <code>pg0</code>, it is always allowed.</p></div><div class=paragraph><p>The second entry defines a single target. Target has two possible meanings: a machine serving iSCSI or a named group of LUNs. This example uses the latter meaning, where <code>iqn.2012-06.com.example:target0</code> is the target name. This target name is suitable for testing purposes. For actual use, change <code>com.example</code> to the real domain name, reversed. The <code>2012-06</code> represents the year and month of acquiring control of that domain name, and <code>target0</code> can be any value. Any number of targets can be defined in this configuration file.</p></div><div class=paragraph><p>The <code>auth-group no-authentication</code> line allows all initiators to connect to the specified target and <code>portal-group pg0</code> makes the target reachable through the <code>pg0</code> portal group.</p></div><div class=paragraph><p>The next section defines the LUN. To the initiator, each LUN will be visible as a separate disk device. Multiple LUNs can be defined for each target. Each LUN is identified by a number, where LUN 0 is mandatory. The <code>path /data/target0-0</code> line defines the full path to a file or zvol backing the LUN. That path must exist before starting <a href="https://man.freebsd.org/cgi/man.cgi?query=ctld&amp;sektion=8&amp;format=html">ctld(8)</a>. The second line is optional and specifies the size of the LUN.</p></div><div class=paragraph><p>Next, to make sure the <a href="https://man.freebsd.org/cgi/man.cgi?query=ctld&amp;sektion=8&amp;format=html">ctld(8)</a> daemon is started at boot, add this line to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>ctld_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>To start <a href="https://man.freebsd.org/cgi/man.cgi?query=ctld&amp;sektion=8&amp;format=html">ctld(8)</a> now, run this command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service ctld start</span></code></pre></div></div><div class=paragraph><p>As the <a href="https://man.freebsd.org/cgi/man.cgi?query=ctld&amp;sektion=8&amp;format=html">ctld(8)</a> daemon is started, it reads <span class=filename>/etc/ctl.conf</span>. If this file is edited after the daemon starts, use this command so that the changes take effect immediately:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service ctld reload</span></code></pre></div></div><div class=sect3><h4 id=_認證>29.12.1.1. 認證<a class=anchor href=#_認證></a></h4><div class=paragraph><p>The previous example is inherently insecure as it uses no authentication, granting anyone full access to all targets. To require a username and password to access targets, modify the configuration as follows:</p></div><div class="literalblock programlisting"><div class=content><pre>auth-group ag0 {
	chap username1 secretsecret
	chap username2 anothersecret
}

portal-group pg0 {
	discovery-auth-group no-authentication
	listen 0.0.0.0
	listen [::]
}

target iqn.2012-06.com.example:target0 {
	auth-group ag0
	portal-group pg0
	lun 0 {
		path /data/target0-0
		size 4G
	}
}</pre></div></div><div class=paragraph><p>The <code>auth-group</code> section defines username and password pairs. An initiator trying to connect to <code>iqn.2012-06.com.example:target0</code> must first specify a defined username and secret. However, target discovery is still permitted without authentication. To require target discovery authentication, set <code>discovery-auth-group</code> to a defined <code>auth-group</code> name instead of <code>no-authentication</code>.</p></div><div class=paragraph><p>It is common to define a single exported target for every initiator. As a shorthand for the syntax above, the username and password can be specified directly in the target entry:</p></div><div class="literalblock programlisting"><div class=content><pre>target iqn.2012-06.com.example:target0 {
	portal-group pg0
	chap username1 secretsecret

	lun 0 {
		path /data/target0-0
		size 4G
	}
}</pre></div></div></div></div><div class=sect2><h3 id=network-iscsi-initiator>29.12.2. 設定 iSCSI Initiator<a class=anchor href=#network-iscsi-initiator></a></h3><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>The iSCSI initiator described in this section is supported starting with FreeBSD 10.0-RELEASE. To use the iSCSI initiator available in older versions, refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=iscontrol&amp;sektion=8&amp;format=html">iscontrol(8)</a>.</p></div></td></tr></tbody></table></div><div class=paragraph><p>The iSCSI initiator requires that the <a href="https://man.freebsd.org/cgi/man.cgi?query=iscsid&amp;sektion=8&amp;format=html">iscsid(8)</a> daemon is running. This daemon does not use a configuration file. To start it automatically at boot, add this line to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>iscsid_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>To start <a href="https://man.freebsd.org/cgi/man.cgi?query=iscsid&amp;sektion=8&amp;format=html">iscsid(8)</a> now, run this command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service iscsid start</span></code></pre></div></div><div class=paragraph><p>Connecting to a target can be done with or without an <span class=filename>/etc/iscsi.conf</span> configuration file. This section demonstrates both types of connections.</p></div><div class=sect3><h4 id=_不使用設定檔連線到_target>29.12.2.1. 不使用設定檔連線到 Target<a class=anchor href=#_不使用設定檔連線到_target></a></h4><div class=paragraph><p>To connect an initiator to a single target, specify the IP address of the portal and the name of the target:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># iscsictl -A -p 10.10.10.10 -t iqn.2012-06.com.example:target0</span></code></pre></div></div><div class=paragraph><p>To verify if the connection succeeded, run <code>iscsictl</code> without any arguments. The output should look similar to this:</p></div><div class="literalblock programlisting"><div class=content><pre>Target name                                     Target portal   State
iqn.2012-06.com.example:target0                 10.10.10.10     Connected: da0</pre></div></div><div class=paragraph><p>In this example, the iSCSI session was successfully established, with <span class=filename>/dev/da0</span> representing the attached LUN. If the <code>iqn.2012-06.com.example:target0</code> target exports more than one LUN, multiple device nodes will be shown in that section of the output:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>Connected: da0 da1 da2.</code></pre></div></div><div class=paragraph><p>Any errors will be reported in the output, as well as the system logs. For example, this message usually means that the <a href="https://man.freebsd.org/cgi/man.cgi?query=iscsid&amp;sektion=8&amp;format=html">iscsid(8)</a> daemon is not running:</p></div><div class="literalblock programlisting"><div class=content><pre>Target name                                     Target portal   State
iqn.2012-06.com.example:target0                 10.10.10.10     Waiting for iscsid(8)</pre></div></div><div class=paragraph><p>The following message suggests a networking problem, such as a wrong IP address or port:</p></div><div class="literalblock programlisting"><div class=content><pre>Target name                                     Target portal   State
iqn.2012-06.com.example:target0                 10.10.10.11     Connection refused</pre></div></div><div class=paragraph><p>This message means that the specified target name is wrong:</p></div><div class="literalblock programlisting"><div class=content><pre>Target name                                     Target portal   State
iqn.2012-06.com.example:target0                 10.10.10.10     Not found</pre></div></div><div class=paragraph><p>This message means that the target requires authentication:</p></div><div class="literalblock programlisting"><div class=content><pre>Target name                                     Target portal   State
iqn.2012-06.com.example:target0                 10.10.10.10     Authentication failed</pre></div></div><div class=paragraph><p>To specify a CHAP username and secret, use this syntax:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># iscsictl -A -p 10.10.10.10 -t iqn.2012-06.com.example:target0 -u user -s secretsecret</span></code></pre></div></div></div><div class=sect3><h4 id=_使用設定檔連線到_target>29.12.2.2. 使用設定檔連線到 Target<a class=anchor href=#_使用設定檔連線到_target></a></h4><div class=paragraph><p>To connect using a configuration file, create <span class=filename>/etc/iscsi.conf</span> with contents like this:</p></div><div class="literalblock programlisting"><div class=content><pre>t0 {
	TargetAddress   = 10.10.10.10
	TargetName      = iqn.2012-06.com.example:target0
	AuthMethod      = CHAP
	chapIName       = user
	chapSecret      = secretsecret
}</pre></div></div><div class=paragraph><p>The <code>t0</code> specifies a nickname for the configuration file section. It will be used by the initiator to specify which configuration to use. The other lines specify the parameters to use during connection. The <code>TargetAddress</code> and <code>TargetName</code> are mandatory, whereas the other options are optional. In this example, the CHAP username and secret are shown.</p></div><div class=paragraph><p>To connect to the defined target, specify the nickname:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># iscsictl -An t0</span></code></pre></div></div><div class=paragraph><p>Alternately, to connect to all targets defined in the configuration file, use:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># iscsictl -Aa</span></code></pre></div></div><div class=paragraph><p>To make the initiator automatically connect to all targets in <span class=filename>/etc/iscsi.conf</span>, add the following to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>iscsictl_enable=&#34;YES&#34;
iscsictl_flags=&#34;-Aa&#34;</pre></div></div></div></div></div></div></div><hr><div class=last-modified><p><strong>最後修改於</strong>: March 9, 2024 由 <a href="https://cgit.freebsd.org/doc/commit/?id=6199af92e7" target=_blank>Danilo G. Baio</a></p></div><div class=buttons><div class=prev><i class="fa fa-angle-left" aria-hidden=true title=Prev></i><div class=container><a href=https://docs.freebsd.org/zh-tw/books/handbook/mail class=direction>Prev</a></div></div><div class=home><i class="fa fa-home" aria-hidden=true title=Home></i><div class=container><a href=../ class=direction>Home</a></div></div><div class=next><div class=container><a href=https://docs.freebsd.org/zh-tw/books/handbook/firewalls class=direction>Next</a></div><i class="fa fa-angle-right" aria-hidden=true title=Next></i></div></div><label class="hidden book-menu-overlay" for=menu-control></label></div><aside class=toc><div class=toc-content><h3>目錄</h3><nav id=TableOfContents><ul><li><a href=#network-servers-synopsis>29.1. 概述</a></li><li><a href=#network-inetd>29.2. inetd 超級伺服器</a></li><li><a href=#network-nfs>29.3. 網路檔案系統 (NFS)</a></li><li><a href=#network-nis>29.4. 網路資訊系統 (NIS)</a></li><li><a href=#network-ldap>29.5. 輕量級目錄存取協定 (LDAP)</a></li><li><a href=#network-dhcp>29.6. 動態主機設置協定 (DHCP)</a></li><li><a href=#network-dns>29.7. 網域名稱系統 (DNS)</a></li><li><a href=#network-apache>29.8. Apache HTTP 伺服器</a></li><li><a href=#network-ftp>29.9. 檔案傳輸協定 (FTP)</a></li><li><a href=#network-samba>29.10. Microsoft™Windows™ 用戶端檔案與列印服務 (Samba)</a></li><li><a href=#network-ntp>29.11. NTP 時間校對</a></li><li><a href=#network-iscsi>29.12. iSCSI Initiator 與 Target 設定</a></li></ul></nav><hr><div class=resources><h3>資源</h3><ul class=contents><li><i class="fa fa-file-pdf-o" aria-hidden=true title="下載 PDF"></i><a href=https://download.freebsd.org/doc/zh-tw/books/handbook/handbook_zh-tw.pdf>下載 PDF</a></li><li><i class="fa fa-pencil-square-o" aria-hidden=true title=編輯此頁></i><a href=https://github.com/freebsd/freebsd-doc/blob/main/documentation/content/zh-tw/_index target=_blank>編輯此頁</a></li></ul></div></div></aside><a class=to-top href=#top><i class="fa fa-arrow-circle-up" aria-hidden=true></i></a></main><footer><div class=footer-container><section class=logo-column><img src=https://docs.freebsd.org/images/FreeBSD-colors.svg width=160 height=50 alt="FreeBSD logo"><div class=options-container><div class=language-container><a id=languages href=https://docs.freebsd.org/zh-tw/languages><img src=https://docs.freebsd.org/images/language.png class=language-image alt=選擇語言>
<span>繁體中文</span></a></div><div class=theme-container><select id=theme-chooser><option value=theme-system>System</option><option value=theme-light>淺色</option><option value=theme-dark>深色</option><option value=theme-high-contrast>高對比</option></select></div></div></section><section class=about-column><h3 class=column-title>About</h3><ul class=column-elements-container><li><a href=https://www.freebsd.org/about/ target=_blank class=column-element>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/ target=_blank class=column-element>FreeBSD Foundation</a></li><li><a href=https://www.freebsd.org/where/ target=_blank class=column-element>Get FreeBSD</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct target=_blank class=column-element>Code of Conduct</a></li><li><a href=https://www.freebsd.org/security/ target=_blank class=column-element>Security Advisories</a></li></ul></section><section class=documentation-column><h3 class=column-title>Documentation</h3><ul class=column-elements-container><li><a href=/zh-tw class=column-element>Documentation portal</a></li><li><a href=https://man.FreeBSD.org target=_blank class=column-element>Manual pages</a></li><li><a href=https://papers.FreeBSD.org target=_blank class=column-element>Presentations and papers</a></li><li><a href=https://docs-archive.freebsd.org/doc/ target=_blank class=column-element>Previous versions</a></li><li><a href=https://docs-archive.freebsd.org/44doc/ target=_blank class=column-element>4.4BSD Documents</a></li><li><a href=https://wiki.freebsd.org/ target=_blank class=column-element>Wiki</a></li></ul></section><section class=community-column><h3 class=column-title>Community</h3><ul class=column-elements-container><li><a href=https://docs.freebsd.org/zh-tw/articles/contributing class=column-element>Get involved</a></li><li><a href=https://forums.freebsd.org/ target=_blank class=column-element>Community forum</a></li><li><a href=https://lists.freebsd.org/ target=_blank class=column-element>Mailing lists</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank class=column-element>IRC Channels</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank class=column-element>Bug Tracker</a></li></ul></section><section class=legal-column><h3 class=column-title>Legal</h3><ul class=column-elements-container><li><a href=https://freebsdfoundation.org/donate/ target=_blank class=column-element>Donations</a></li><li><a href=https://www.freebsd.org/copyright/freebsd-license/ target=_blank class=column-element>Licensing</a></li><li><a href=https://www.freebsd.org/privacy/ target=_blank class=column-element>Privacy Policy</a></li><li><a href=https://www.freebsd.org/copyright/ target=_blank class=column-element>Legal notices</a></li></ul></section><section class=copyright-column><p>&copy; 1994-2024 The FreeBSD Project. All rights reserved</p><span>Made with <span class=heart>♥</span> by the FreeBSD Community</span></section></div></footer></body></html>