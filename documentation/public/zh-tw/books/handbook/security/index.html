<!doctype html><html class=theme-light lang=zh-tw><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content><meta name=copyright content="1995-2024 The FreeBSD Foundation"><link rel=canonical href=http://172.16.201.134:1313/zh-tw/books/handbook/security/><title>章 13. 安全性 | FreeBSD Documentation Portal</title>
<meta name=theme-color content="#790000"><meta name=color-scheme content="system light dark high-contrast"><link rel="shortcut icon" href=http://172.16.201.134:1313/favicon.ico><link rel=stylesheet href=http://172.16.201.134:1313/styles/main.min.css><link rel=stylesheet href=http://172.16.201.134:1313/css/font-awesome-min.css><script defer src=/js/theme-chooser.min.js></script><script defer src=/js/copy-clipboard.min.js></script><script defer src=/js/search.min.js></script><meta name=twitter:card content="summary"><meta name=twitter:domain content="docs.FreeBSD.org"><meta name=twitter:site content="@freebsd"><meta name=twitter:url content="https://twitter.com/freebsd"><meta property="og:title" content="章 13. 安全性"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:image" content="http://172.16.201.134:1313/favicon.ico"><meta property="og:image:alt" content="FreeBSD Logo"><meta property="og:locale" content="zh-tw"><meta property="og:url" content="http://172.16.201.134:1313/zh-tw/books/handbook/security/"><meta property="og:site_name" content="FreeBSD Documentation Portal"><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","url":"http:\/\/172.16.201.134:1313\/zh-tw\/books\/handbook\/security\/","name":"FreeBSD Documentation Portal","headline":"FreeBSD Documentation Portal","description":"FreeBSD Documentation Portal"}</script></head><body><header><div class=header-container><div class=logo-menu-bars-container><a href=https://www.FreeBSD.org class=logo><img src=http://172.16.201.134:1313/images/FreeBSD-monochromatic.svg width=160 height=50 alt="FreeBSD logo">
</a><label class=menu-bars for=menu-bars><i class="fa fa-bars" aria-hidden=true></i></label></div><input id=menu-bars type=checkbox><nav><ul class=menu><li class=menu-item><input id=about type=checkbox>
<a href=# aria-label="Navigate to About section"><label class=menu-item-description for=about>About
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/about/ target=_blank>About</a></li><li><a href=https://www.freebsd.org/about/ target=_blank>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/about-us/about-the-foundation/ target=_blank>FreeBSD Foundation</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct/ target=_blank>Code of Conduct</a></li></ul></li><li class=menu-item><input id=download type=checkbox>
<a href=# aria-label="Navigate to get FreeBSD section"><label class=menu-item-description for=download>Get FreeBSD
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/where/ target=_blank>Get FreeBSD</a></li><li><a href=https://www.freebsd.org/releases/ target=_blank>Release Information</a></li><li><a href=https://www.freebsd.org/releng/ target=_blank>Release Engineering</a></li><li><a href=https://www.freebsd.org/security/ target=_blank>Security Advisories</a></li></ul></li><li class=menu-item><input id=documentation type=checkbox>
<a href=# aria-label="Navigate to get Documentation section"><label class=menu-item-description for=documentation>Documentation
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=/zh-tw>Documentation portal</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook>FreeBSD Handbook</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/porters-handbook>Porter's Handbook</a></li><li><a href=https://docs.FreeBSD.org/en/books/fdp-primer>Documentation Project Handbook</a></li><li><a href=https://man.FreeBSD.org target=_blank>Manual pages</a></li><li><a href=https://papers.FreeBSD.org target=_blank>Presentations and papers</a></li><li><a href=https://wiki.FreeBSD.org target=_blank>Wiki</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books>Books</a></li><li><a href=http://172.16.201.134:1313/zh-tw/articles>Articles</a></li></ul></li><li class=menu-item><input id=community type=checkbox>
<a href=# aria-label="Navigate to get Community section"><label class=menu-item-description for=community>Community
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/community/>Community</a></li><li><a href=http://172.16.201.134:1313/zh-tw/articles/contributing>Get involved</a></li><li><a href=https://forums.freebsd.org/ target=_blank>Forum</a></li><li><a href=https://lists.freebsd.org/ target=_blank>Mailing lists</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank>IRC Channels</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank>Bug Tracker</a></li><li><a href=https://www.freebsd.org/support/ target=_blank>Support</a></li></ul></li></ul></nav><div class=search-donate-container><form class=search method=get id=search-header-form action=https://docs.freebsd.org/search name=search-header-form><input type=hidden name=DB value=zh-tw>
<input id=words name=P type=text size=20 maxlength=255>
<button>
<i class="fa fa-search" aria-hidden=true></i></button></form><div class=donate><a href=https://freebsdfoundation.org/donate/ target=_blank><span class=heart>♥</span>
Donate</a></div></div></div></header><input type=checkbox class="hidden toggle" id=menu-control><main class=main-wrapper-book><a id=top></a><aside class=book-menu><div class=book-menu-content><input id=search-book type=text placeholder=Search aria-label=Search maxlength=128><nav id=MenuContents><ul><li><input type=checkbox id=chapter-eb2a98ce203d8afd517726e6d8776be3 class=toggle>
<label class="icon cursor" for=chapter-eb2a98ce203d8afd517726e6d8776be3><a role=button></a></label><a href=http://172.16.201.134:1313/zh-tw/books/handbook/preface/>序</a><ul><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/preface/#preface-audience>給讀者的話</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/preface/#preface-changes-from3>自第三版後的主要修訂</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/preface/#preface-changes-from2>自第二版後的主要修訂 (2004)</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/preface/#preface-changes>自第一版後的主要修訂 (2001)</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/preface/#preface-overview>本書架構</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/preface/#preface-conv>本書的編排體裁</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/preface/#preface-acknowledgements>銘謝</a></li></ul></li><li><input type=checkbox id=chapter-14a525fce014b90b8a458a894818255a class=toggle>
<label for=chapter-14a525fce014b90b8a458a894818255a><a role=button></a></label><a href=http://172.16.201.134:1313/zh-tw/books/handbook/parti/>部 I. 入門</a></li><li><input type=checkbox id=chapter-f9c9f3451644df30d224350da97d5da6 class=toggle>
<label class="icon cursor" for=chapter-f9c9f3451644df30d224350da97d5da6><a role=button></a></label><a href=http://172.16.201.134:1313/zh-tw/books/handbook/introduction/>章 1. 簡介</a><ul><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/introduction/#introduction-synopsis>1.1. 概述</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/introduction/#nutshell>1.2. 歡迎使用 FreeBSD！</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/introduction/#history>1.3. 關於 FreeBSD 計劃</a></li></ul></li><li><input type=checkbox id=chapter-f693a3fa687a72d63ec8129ee302d664 class=toggle>
<label class="icon cursor" for=chapter-f693a3fa687a72d63ec8129ee302d664><a role=button></a></label><a href=http://172.16.201.134:1313/zh-tw/books/handbook/bsdinstall/>章 2. 安裝 FreeBSD</a><ul><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/bsdinstall/#bsdinstall-synopsis>2.1. 概述</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/bsdinstall/#bsdinstall-hardware>2.2. 最低硬體需求</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/bsdinstall/#bsdinstall-pre>2.3. 安裝前準備工作</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/bsdinstall/#bsdinstall-start>2.4. 開始安裝</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/bsdinstall/#using-bsdinstall>2.5. 使用 bsdinstall</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/bsdinstall/#bsdinstall-partitioning>2.6. 配置磁碟空間</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/bsdinstall/#bsdinstall-final-warning>2.7. 確認安裝</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/bsdinstall/#bsdinstall-post>2.8. 安裝後注意事項</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/bsdinstall/#bsdinstall-install-trouble>2.9. 疑難排解</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/bsdinstall/#using-live-cd>2.10. 使用 Live CD</a></li></ul></li><li><input type=checkbox id=chapter-9f6db261075f578742036fcc6000eecd class=toggle>
<label class="icon cursor" for=chapter-9f6db261075f578742036fcc6000eecd><a role=button></a></label><a href=http://172.16.201.134:1313/zh-tw/books/handbook/basics/>章 3. FreeBSD 基礎</a><ul><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/basics/#basics-synopsis>3.1. 概述</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/basics/#consoles>3.2. 虛擬 Console 與終端機</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/basics/#users-synopsis>3.3. 使用者與基礎帳號管理</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/basics/#permissions>3.4. 權限</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/basics/#dirstructure>3.5. 目錄結構</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/basics/#disk-organization>3.6. 磁碟組織</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/basics/#mount-unmount>3.7. 掛載與卸載檔案系統</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/basics/#basics-processes>3.8. 程序與 Daemon</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/basics/#shells>3.9. Shell</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/basics/#editors>3.10. 文字編輯器</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/basics/#basics-devices>3.11. 裝置及裝置節點</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/basics/#basics-more-information>3.12. 操作手冊</a></li></ul></li><li><input type=checkbox id=chapter-01c5707e95d14c0ff84bf62600c958d1 class=toggle>
<label class="icon cursor" for=chapter-01c5707e95d14c0ff84bf62600c958d1><a role=button></a></label><a href=http://172.16.201.134:1313/zh-tw/books/handbook/ports/>章 4. 安裝應用程式：套件與 Port</a><ul><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/ports/#ports-synopsis>4.1. 概述</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/ports/#ports-overview>4.2. 安裝軟體的概要</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/ports/#ports-finding-applications>4.3. 搜尋軟體</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/ports/#pkgng-intro>4.4. 使用 pkg 管理 Binary 套件</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/ports/#ports-using>4.5. 使用 Port 套件集</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/ports/#ports-poudriere>4.6. 使用 Poudriere 編譯套件</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/ports/#ports-nextsteps>4.7. 安裝後的注意事項</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/ports/#ports-broken>4.8. 處理損壞的 Port</a></li></ul></li><li><input type=checkbox id=chapter-3405c00581365a8b5d16af70fe4d1b72 class=toggle>
<label class="icon cursor" for=chapter-3405c00581365a8b5d16af70fe4d1b72><a role=button></a></label><a href=http://172.16.201.134:1313/zh-tw/books/handbook/x11/>章 5. X Window 系統</a><ul><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/x11/#x11-synopsis>5.1. 概述</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/x11/#x-understanding>5.2. 術語</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/x11/#x-install>5.3. 安裝 Xorg</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/x11/#x-config>5.4. Xorg 設定</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/x11/#x-fonts>5.5. 在 Xorg 使用字型</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/x11/#x-xdm>5.6. X 顯示管理程式</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/x11/#x11-wm>5.7. 桌面環境</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/x11/#x-compiz-fusion>5.8. 安裝 Compiz Fusion</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/x11/#x11-understanding>5.9. 疑難排解</a></li></ul></li><li><input type=checkbox id=chapter-0eab3565e8f59f5a8a896dfba7eb3680 class=toggle>
<label for=chapter-0eab3565e8f59f5a8a896dfba7eb3680><a role=button></a></label><a href=http://172.16.201.134:1313/zh-tw/books/handbook/partii/>部 II. 一般作業</a></li><li><input type=checkbox id=chapter-b33cf28993f3f7bf5baf036e79da0f39 class=toggle>
<label class="icon cursor" for=chapter-b33cf28993f3f7bf5baf036e79da0f39><a role=button></a></label><a href=http://172.16.201.134:1313/zh-tw/books/handbook/desktop/>章 6. 桌面應用程式</a><ul><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/desktop/#desktop-synopsis>6.1. 概述</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/desktop/#desktop-browsers>6.2. 瀏覽器</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/desktop/#desktop-productivity>6.3. 辦工工具</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/desktop/#desktop-viewers>6.4. 文件閱覽程式</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/desktop/#desktop-finance>6.5. 財務</a></li></ul></li><li><input type=checkbox id=chapter-152f694a19312ad72ec7bb4e1c3c33b2 class=toggle>
<label class="icon cursor" for=chapter-152f694a19312ad72ec7bb4e1c3c33b2><a role=button></a></label><a href=http://172.16.201.134:1313/zh-tw/books/handbook/multimedia/>章 7. 多媒體</a><ul><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/multimedia/#multimedia-synopsis>7.1. 概述</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/multimedia/#sound-setup>7.2. 設定音效卡</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/multimedia/#sound-mp3>7.3. MP3 音樂</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/multimedia/#video-playback>7.4. 影片播放</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/multimedia/#tvcard>7.5. 電視卡</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/multimedia/#mythtv>7.6. MythTV</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/multimedia/#scanners>7.7. 影像掃描器</a></li></ul></li><li><input type=checkbox id=chapter-80888b4ee02e3e409e5f71cf97a36450 class=toggle>
<label class="icon cursor" for=chapter-80888b4ee02e3e409e5f71cf97a36450><a role=button></a></label><a href=http://172.16.201.134:1313/zh-tw/books/handbook/kernelconfig/>章 8. 設定 FreeBSD 核心</a><ul><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/kernelconfig/#kernelconfig-synopsis>8.1. 概述</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/kernelconfig/#kernelconfig-custom-kernel>8.2. 為何要編譯自訂的核心?</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/kernelconfig/#kernelconfig-devices>8.3. 偵測系統硬體</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/kernelconfig/#kernelconfig-config>8.4. 設定檔</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/kernelconfig/#kernelconfig-building>8.5. 編譯與安裝自訂核心</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/kernelconfig/#kernelconfig-trouble>8.6. 如果發生錯誤</a></li></ul></li><li><input type=checkbox id=chapter-cb174c55879b17ab955f2f16989a79e0 class=toggle>
<label class="icon cursor" for=chapter-cb174c55879b17ab955f2f16989a79e0><a role=button></a></label><a href=http://172.16.201.134:1313/zh-tw/books/handbook/printing/>章 9. 列印</a><ul><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/printing/#printing-quick-start>9.1. 快速開始</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/printing/#printing-connections>9.2. 印表機連線</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/printing/#printing-pdls>9.3. 常見的頁面描述語言</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/printing/#printing-direct>9.4. 直接列印</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/printing/#printing-lpd>9.5. LPD (行列式印表機 Daemon)</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/printing/#printing-other>9.6. 其他列印系統</a></li></ul></li><li><input type=checkbox id=chapter-c12b8c3f2a8fcefce87087241f695c83 class=toggle>
<label class="icon cursor" for=chapter-c12b8c3f2a8fcefce87087241f695c83><a role=button></a></label><a href=http://172.16.201.134:1313/zh-tw/books/handbook/linuxemu/>章 10. Linux® Binary 相容性</a><ul><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/linuxemu/#linuxemu-synopsis>10.1. 概述</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/linuxemu/#linuxemu-lbc-install>10.2. 設定 Linux™ Binary 相容性</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/linuxemu/#linuxemu-advanced>10.3. 進階主題</a></li></ul></li><li><input type=checkbox id=chapter-03b11ba627b9a0c85b247f5641bde272 class=toggle>
<label for=chapter-03b11ba627b9a0c85b247f5641bde272><a role=button></a></label><a href=http://172.16.201.134:1313/zh-tw/books/handbook/partiii/>部 III. 系統管理</a></li><li><input type=checkbox id=chapter-6c31587f8d736319f099cd4dc1961301 class=toggle>
<label class="icon cursor" for=chapter-6c31587f8d736319f099cd4dc1961301><a role=button></a></label><a href=http://172.16.201.134:1313/zh-tw/books/handbook/config/>章 11. 設定與調校</a><ul><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/config/#config-synopsis>11.1. 概述</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/config/#configtuning-starting-services>11.2. 啟動服務</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/config/#configtuning-cron>11.3. 設定 cron(8)</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/config/#configtuning-rcd>11.4. 管理 FreeBSD 中的服務</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/config/#config-network-setup>11.5. 設定網路介面卡</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/config/#configtuning-virtual-hosts>11.6. 虛擬主機</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/config/#configtuning-syslog>11.7. 設定系統日誌</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/config/#configtuning-configfiles>11.8. 設定檔</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/config/#configtuning-sysctl>11.9. 使用 sysctl(8) 調校</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/config/#configtuning-disk>11.10. 調校磁碟</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/config/#configtuning-kernel-limits>11.11. 調校核心限制</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/config/#adding-swap-space>11.12. 增加交換空間</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/config/#acpi-overview>11.13. 電源與資源管理</a></li></ul></li><li><input type=checkbox id=chapter-459f0012b3b4f0b6b123010f029da5e4 class=toggle>
<label class="icon cursor" for=chapter-459f0012b3b4f0b6b123010f029da5e4><a role=button></a></label><a href=http://172.16.201.134:1313/zh-tw/books/handbook/boot/>章 12. FreeBSD 開機程序</a><ul><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/boot/#boot-synopsis>12.1. 概述</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/boot/#boot-introduction>12.2. FreeBSD 開機程序</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/boot/#boot-splash>12.3. 設定開機啟動畫面</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/boot/#device-hints>12.4. 裝置提示</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/boot/#boot-shutdown>12.5. 關機程序</a></li></ul></li><li><input type=checkbox id=chapter-917c75fcffbb14d48ed6d0a48e7028f2 class=toggle checked>
<label class="icon cursor" for=chapter-917c75fcffbb14d48ed6d0a48e7028f2><a role=button></a></label><a href=http://172.16.201.134:1313/zh-tw/books/handbook/security/>章 13. 安全性</a><ul><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/security/#security-synopsis>13.1. 概述</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/security/#security-intro>13.2. 簡介</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/security/#one-time-passwords>13.3. 一次性密碼</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/security/#tcpwrappers>13.4. TCP Wrapper</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/security/#kerberos5>13.5. Kerberos</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/security/#openssl>13.6. OpenSSL</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/security/#ipsec>13.7. VPN over IPsec</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/security/#openssh>13.8. OpenSSH</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/security/#fs-acl>13.9. 存取控制清單</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/security/#security-pkg>13.10. 監視第三方安全性問題</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/security/#security-advisories>13.11. FreeBSD 安全報告</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/security/#security-accounting>13.12. 程序追蹤</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/security/#security-resourcelimits>13.13. 限制資源</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/security/#security-sudo>13.14. 使用 Sudo 分享管理權限</a></li></ul></li><li><input type=checkbox id=chapter-1a2a8e719703649c2c66d99aa7a25fd4 class=toggle>
<label class="icon cursor" for=chapter-1a2a8e719703649c2c66d99aa7a25fd4><a role=button></a></label><a href=http://172.16.201.134:1313/zh-tw/books/handbook/jails/>章 14. Jail</a><ul><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/jails/#jails-synopsis>14.1. 概述</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/jails/#jails-terms>14.2. Jail 相關術語</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/jails/#jails-build>14.3. 建立和控制 Jail</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/jails/#jails-tuning>14.4. 調校與管理</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/jails/#jails-application>14.5. 更新多個 Jail</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/jails/#jails-ezjail>14.6. 使用 ezjail 管理 Jail</a></li></ul></li><li><input type=checkbox id=chapter-8f4620c77e572cbb58917911a33c73cf class=toggle>
<label class="icon cursor" for=chapter-8f4620c77e572cbb58917911a33c73cf><a role=button></a></label><a href=http://172.16.201.134:1313/zh-tw/books/handbook/mac/>章 15. 強制存取控制 (MAC)</a><ul><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/mac/#mac-synopsis>15.1. 概述</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/mac/#mac-inline-glossary>15.2. 關鍵詞</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/mac/#mac-understandlabel>15.3. 了解 MAC 標籤</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/mac/#mac-planning>15.4. 規劃安全架構</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/mac/#mac-policies>15.5. 可用的 MAC 管理政策</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/mac/#mac-userlocked>15.6. User Lock Down</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/mac/#mac-implementing>15.7. 在 MAC Jail 中使用 Nagios</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/mac/#mac-troubleshoot>15.8. MAC 架構疑難排解</a></li></ul></li><li><input type=checkbox id=chapter-9598d66a76cb3182057b6bcd775149a0 class=toggle>
<label class="icon cursor" for=chapter-9598d66a76cb3182057b6bcd775149a0><a role=button></a></label><a href=http://172.16.201.134:1313/zh-tw/books/handbook/audit/>章 16. 安全事件稽查</a><ul><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/audit/#audit-synopsis>16.1. 概述</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/audit/#audit-inline-glossary>16.2. 關鍵詞</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/audit/#audit-config>16.3. 稽查設定</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/audit/#audit-administration>16.4. 查看稽查線索</a></li></ul></li><li><input type=checkbox id=chapter-e1edcad13d9db6e8e4cb645d378ecfaf class=toggle>
<label class="icon cursor" for=chapter-e1edcad13d9db6e8e4cb645d378ecfaf><a role=button></a></label><a href=http://172.16.201.134:1313/zh-tw/books/handbook/disks/>章 17. 儲存設備</a><ul><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/disks/#disks-synopsis>17.1. 概述</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/disks/#disks-adding>17.2. 加入磁碟</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/disks/#disks-growing>17.3. 重設大小與擴增磁碟</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/disks/#usb-disks>17.4. USB 儲存裝置</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/disks/#creating-cds>17.5. 建立與使用 CD 媒體</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/disks/#creating-dvds>17.6. 建立與使用 DVD 媒體</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/disks/#floppies>17.7. 建立與使用軟碟</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/disks/#backup-basics>17.8. 備份基礎概念</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/disks/#disks-virtual>17.9. 記憶體磁碟</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/disks/#snapshots>17.10. 檔案系統快照</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/disks/#quotas>17.11. 磁碟配額</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/disks/#disks-encrypting>17.12. 磁碟分割區加密</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/disks/#swap-encrypting>17.13. 交換空間加密</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/disks/#disks-hast>17.14. 高可用存儲空間 (HAST)</a></li></ul></li><li><input type=checkbox id=chapter-dde37901a0e0ea32745b67607854900f class=toggle>
<label class="icon cursor" for=chapter-dde37901a0e0ea32745b67607854900f><a role=button></a></label><a href=http://172.16.201.134:1313/zh-tw/books/handbook/geom/>章 18. GEOM: 模組化磁碟轉換框架</a><ul><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/geom/#geom-synopsis>18.1. 概述</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/geom/#geom-striping>18.2. RAID0 - 串連 (Striping)</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/geom/#geom-mirror>18.3. RAID1 - 鏡像 (Mirroring)</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/geom/#geom-raid3>18.4. RAID3 - 位元級串連與獨立奇偶校驗</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/geom/#geom-graid>18.5. 軟體 RAID 裝置</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/geom/#geom-ggate>18.6. GEOM Gate Network</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/geom/#geom-glabel>18.7. 磁碟裝置標籤</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/geom/#geom-gjournal>18.8. UFS Journaling 透過 GEOM</a></li></ul></li><li><input type=checkbox id=chapter-73e82560fcb7145b7c0e2ec47af8fc04 class=toggle>
<label class="icon cursor" for=chapter-73e82560fcb7145b7c0e2ec47af8fc04><a role=button></a></label><a href=http://172.16.201.134:1313/zh-tw/books/handbook/zfs/>章 19. Z 檔案系統 (ZFS)</a><ul><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/zfs/#zfs-differences>19.1. 什麼使 ZFS 與眾不同</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/zfs/#zfs-quickstart>19.2. 快速入門指南</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/zfs/#zfs-zpool>19.3. <code>zpool</code> 管理</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/zfs/#zfs-zfs>19.4. <code>zfs</code> 管理</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/zfs/#zfs-zfs-allow>19.5. 委託管理</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/zfs/#zfs-advanced>19.6. 進階主題</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/zfs/#zfs-links>19.7. 其他資源</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/zfs/#zfs-term>19.8. ZFS 特色與術語</a></li></ul></li><li><input type=checkbox id=chapter-7af71270807eb7b70cd3eedc6577b254 class=toggle>
<label class="icon cursor" for=chapter-7af71270807eb7b70cd3eedc6577b254><a role=button></a></label><a href=http://172.16.201.134:1313/zh-tw/books/handbook/filesystems/>章 20. 其他檔案系統</a><ul><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/filesystems/#filesystems-synopsis>20.1. 概述</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/filesystems/#filesystems-linux>20.2. Linux™ 檔案系統</a></li></ul></li><li><input type=checkbox id=chapter-375257268d95faaf87faf4f7a2e6aa67 class=toggle>
<label class="icon cursor" for=chapter-375257268d95faaf87faf4f7a2e6aa67><a role=button></a></label><a href=http://172.16.201.134:1313/zh-tw/books/handbook/virtualization/>章 21. 虛擬化</a><ul><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/virtualization/#virtualization-synopsis>21.1. 概述</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/virtualization/#virtualization-guest-parallels>21.2. 在 Mac OS™ X 的 Parallels 安裝 FreeBSD 為客端</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/virtualization/#virtualization-guest-virtualpc>21.3. 在 Windows™ 的 Virtual PC 安裝 FreeBSD 為客端</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/virtualization/#virtualization-guest-vmware>21.4. 在 Mac OS™ 的 VMware Fusion 安裝 FreeBSD 為客端</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/virtualization/#virtualization-guest-virtualbox>21.5. 在 VirtualBox™ 安裝 FreeBSD 作為客端</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/virtualization/#virtualization-host-virtualbox>21.6. 以 FreeBSD 作為主端使用 VirtualBox™</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/virtualization/#virtualization-host-bhyve>21.7. 以 FreeBSD 作為主端安裝 bhyve</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/virtualization/#virtualization-host-xen>21.8. 以 FreeBSD 作為主端安裝 Xen™</a></li></ul></li><li><input type=checkbox id=chapter-49f1e96591c090304ea532012257f4ef class=toggle>
<label class="icon cursor" for=chapter-49f1e96591c090304ea532012257f4ef><a role=button></a></label><a href=http://172.16.201.134:1313/zh-tw/books/handbook/l10n/>章 22. 在地化 - i18n/L10n 使用與安裝</a><ul><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/l10n/#l10n-synopsis>22.1. 概述</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/l10n/#using-localization>22.2. 使用語系</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/l10n/#l10n-compiling>22.3. 尋找 i18n 應用程式</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/l10n/#lang-setup>22.4. 特定語言的語系設定</a></li></ul></li><li><input type=checkbox id=chapter-dead2b4c5ea325dd390a9b0dccd8f763 class=toggle>
<label class="icon cursor" for=chapter-dead2b4c5ea325dd390a9b0dccd8f763><a role=button></a></label><a href=http://172.16.201.134:1313/zh-tw/books/handbook/cutting-edge/>章 23. 更新與升級 FreeBSD</a><ul><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/cutting-edge/#updating-upgrading-synopsis>23.1. 概述</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/cutting-edge/#updating-upgrading-freebsdupdate>23.2. FreeBSD 更新</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/cutting-edge/#updating-upgrading-documentation>23.3. 更新文件集</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/cutting-edge/#current-stable>23.4. 追蹤開發分支</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/cutting-edge/#makeworld>23.5. 從原始碼更新 FreeBSD</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/cutting-edge/#small-lan>23.6. 多部機器追蹤</a></li></ul></li><li><input type=checkbox id=chapter-913e72bfb3d6947b2869d3e9447a6eaa class=toggle>
<label class="icon cursor" for=chapter-913e72bfb3d6947b2869d3e9447a6eaa><a role=button></a></label><a href=http://172.16.201.134:1313/zh-tw/books/handbook/usb-device-mode/>章 25. USB Device Mode / USB OTG</a><ul><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/usb-device-mode/#usb-device-mode-synopsis>25.1. 概述</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/usb-device-mode/#usb-device-mode-terminals>25.2. USB 虛擬序列埠</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/usb-device-mode/#usb-device-mode-network>25.3. USB 裝置模式網路介面</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/usb-device-mode/#usb-device-mode-storage>25.4. USB 虛擬儲存裝置</a></li></ul></li><li><input type=checkbox id=chapter-bbd25f9a194f9c39ca2d658c75767db5 class=toggle>
<label for=chapter-bbd25f9a194f9c39ca2d658c75767db5><a role=button></a></label><a href=http://172.16.201.134:1313/zh-tw/books/handbook/partiv/>部 IV. 網路通訊</a></li><li><input type=checkbox id=chapter-29c1eeb0e9dedc487a98399e2737ee8a class=toggle>
<label class="icon cursor" for=chapter-29c1eeb0e9dedc487a98399e2737ee8a><a role=button></a></label><a href=http://172.16.201.134:1313/zh-tw/books/handbook/dtrace/>章 24. DTrace</a><ul><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/dtrace/#dtrace-synopsis>24.1. 概述</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/dtrace/#dtrace-implementation>24.2. 實作差異</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/dtrace/#dtrace-enable>24.3. 開啟 DTrace 支援</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/dtrace/#dtrace-using>24.4. 使用 DTrace</a></li></ul></li><li><input type=checkbox id=chapter-499dab596afd7ddac77e80295314e0dd class=toggle>
<label class="icon cursor" for=chapter-499dab596afd7ddac77e80295314e0dd><a role=button></a></label><a href=http://172.16.201.134:1313/zh-tw/books/handbook/serialcomms/>章 26. 序列通訊</a><ul><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/serialcomms/#serial-synopsis>26.1. 概述</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/serialcomms/#serial>26.2. 序列術語與硬體</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/serialcomms/#term>26.3. 終端機</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/serialcomms/#dialup>26.4. 撥入服務</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/serialcomms/#dialout>26.5. 撥出服務</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/serialcomms/#serialconsole-setup>26.6. 設定序列 Console</a></li></ul></li><li><input type=checkbox id=chapter-95e4571c48bee1cced5e84a538d302e3 class=toggle>
<label class="icon cursor" for=chapter-95e4571c48bee1cced5e84a538d302e3><a role=button></a></label><a href=http://172.16.201.134:1313/zh-tw/books/handbook/ppp-and-slip/>章 27. PPP</a><ul><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/ppp-and-slip/#ppp-and-slip-synopsis>27.1. 概述</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/ppp-and-slip/#userppp>27.2. 設定 PPP</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/ppp-and-slip/#ppp-troubleshoot>27.3. PPP 連線疑難排解</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/ppp-and-slip/#pppoe>27.4. 在乙太網路使用 PPP (PPPoE)</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/ppp-and-slip/#pppoa>27.5. 在 ATM 使用 PPP (PPPoA)</a></li></ul></li><li><input type=checkbox id=chapter-f089ac726c401c9b4bd5c34a295e11bb class=toggle>
<label class="icon cursor" for=chapter-f089ac726c401c9b4bd5c34a295e11bb><a role=button></a></label><a href=http://172.16.201.134:1313/zh-tw/books/handbook/mail/>章 28. 電子郵件</a><ul><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/mail/#mail-synopsis>28.1. 概述</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/mail/#mail-using>28.2. 郵件組成</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/mail/#sendmail>28.3. Sendmail 設定檔</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/mail/#mail-changingmta>28.4. 更改郵件傳輸代理程式</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/mail/#mail-trouble>28.5. 疑難排解</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/mail/#mail-advanced>28.6. 進階主題</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/mail/#outgoing-only>28.7. 寄件設定</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/mail/#SMTP-dialup>28.8. 在撥號連線使用郵件</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/mail/#SMTP-Auth>28.9. SMTP 認證</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/mail/#mail-agents>28.10. 郵件使用者代理程式</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/mail/#mail-fetchmail>28.11. 使用 fetchmail</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/mail/#mail-procmail>28.12. 使用 procmail</a></li></ul></li><li><input type=checkbox id=chapter-6de4de3fe925639d4175ce4b6f8c1829 class=toggle>
<label class="icon cursor" for=chapter-6de4de3fe925639d4175ce4b6f8c1829><a role=button></a></label><a href=http://172.16.201.134:1313/zh-tw/books/handbook/network-servers/>章 29. 網路伺服器</a><ul><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/network-servers/#network-servers-synopsis>29.1. 概述</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/network-servers/#network-inetd>29.2. inetd 超級伺服器</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/network-servers/#network-nfs>29.3. 網路檔案系統 (NFS)</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/network-servers/#network-nis>29.4. 網路資訊系統 (NIS)</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/network-servers/#network-ldap>29.5. 輕量級目錄存取協定 (LDAP)</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/network-servers/#network-dhcp>29.6. 動態主機設置協定 (DHCP)</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/network-servers/#network-dns>29.7. 網域名稱系統 (DNS)</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/network-servers/#network-apache>29.8. Apache HTTP 伺服器</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/network-servers/#network-ftp>29.9. 檔案傳輸協定 (FTP)</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/network-servers/#network-samba>29.10. Microsoft™Windows™ 用戶端檔案與列印服務 (Samba)</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/network-servers/#network-ntp>29.11. NTP 時間校對</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/network-servers/#network-iscsi>29.12. iSCSI Initiator 與 Target 設定</a></li></ul></li><li><input type=checkbox id=chapter-776d855c7b75e048f90b5c2c9b35ffe0 class=toggle>
<label class="icon cursor" for=chapter-776d855c7b75e048f90b5c2c9b35ffe0><a role=button></a></label><a href=http://172.16.201.134:1313/zh-tw/books/handbook/firewalls/>章 30. 防火牆</a><ul><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/firewalls/#firewalls-intro>30.1. 概述</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/firewalls/#firewalls-concepts>30.2. 防火牆概念</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/firewalls/#firewalls-pf>30.3. PF</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/firewalls/#firewalls-ipfw>30.4. IPFW</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/firewalls/#firewalls-ipf>30.5. IPFILTER (IPF)</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/firewalls/#firewalls-blacklistd>30.6. Blacklistd</a></li></ul></li><li><input type=checkbox id=chapter-5b07f776a0e6155c1c89aa0d15610380 class=toggle>
<label class="icon cursor" for=chapter-5b07f776a0e6155c1c89aa0d15610380><a role=button></a></label><a href=http://172.16.201.134:1313/zh-tw/books/handbook/advanced-networking/>章 31. 進階網路設定</a><ul><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/advanced-networking/#advanced-networking-synopsis>31.1. 概述</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/advanced-networking/#network-routing>31.2. 通訊閘與路由</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/advanced-networking/#network-wireless>31.3. 無線網路</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/advanced-networking/#network-usb-tethering>31.4. USB 網路共享</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/advanced-networking/#network-bluetooth>31.5. 藍牙</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/advanced-networking/#network-bridging>31.6. 橋接</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/advanced-networking/#network-aggregation>31.7. Link Aggregation 與容錯移轉</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/advanced-networking/#network-diskless>31.8. PXE 無磁碟作業</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/advanced-networking/#network-ipv6>31.9. IPv6</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/advanced-networking/#carp>31.10. 共用位址備援協定 (CARP)</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/advanced-networking/#network-vlan>31.11. VLANs</a></li></ul></li><li><input type=checkbox id=chapter-171a77aa9d067a1024f849470e1f33e8 class=toggle>
<label for=chapter-171a77aa9d067a1024f849470e1f33e8><a role=button></a></label><a href=http://172.16.201.134:1313/zh-tw/books/handbook/partv/>部 V. 附錄</a></li><li><input type=checkbox id=chapter-8050f436a0a7986a4aaded93d8e49469 class=toggle>
<label class="icon cursor" for=chapter-8050f436a0a7986a4aaded93d8e49469><a role=button></a></label><a href=http://172.16.201.134:1313/zh-tw/books/handbook/mirrors/>附錄 A. 取得 FreeBSD</a><ul><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/mirrors/#mirrors-cdrom>A.1. CD 與 DVD 合集</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/mirrors/#mirrors-ftp>A.2. FTP 站</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/mirrors/#svn>A.3. 使用 Subversion</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/mirrors/#mirrors-rsync>A.4. 使用 rsync</a></li></ul></li><li><input type=checkbox id=chapter-128b630a8f88f158e7027fe6c2184d21 class=toggle>
<label class="icon cursor" for=chapter-128b630a8f88f158e7027fe6c2184d21><a role=button></a></label><a href=http://172.16.201.134:1313/zh-tw/books/handbook/bibliography/>附錄 B. 參考書目</a><ul><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/bibliography/#bibliography-freebsd>B.1. FreeBSD 相關書籍</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/bibliography/#bibliography-userguides>B.2. 使用指南</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/bibliography/#bibliography-adminguides>B.3. 管理指南</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/bibliography/#bibliography-programmers>B.4. 開發指南</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/bibliography/#bibliography-osinternals>B.5. 深入作業系統</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/bibliography/#bibliography-security>B.6. 安全性參考文獻</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/bibliography/#bibliography-hardware>B.7. 硬體參考文獻</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/bibliography/#bibliography-history>B.8. UNIX™ 歷史</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/bibliography/#bibliography-journals>B.9. 期刊與雜誌</a></li></ul></li><li><input type=checkbox id=chapter-8bbb8867c46dac315e2253945d8c18a8 class=toggle>
<label class="icon cursor" for=chapter-8bbb8867c46dac315e2253945d8c18a8><a role=button></a></label><a href=http://172.16.201.134:1313/zh-tw/books/handbook/eresources/>附錄 C. 網路資源</a><ul><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/eresources/#eresources-www>C.1. 網站</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/eresources/#eresources-mail>C.2. 郵遞論壇 (Mailing List)</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/eresources/#eresources-news>C.3. Usenet 新聞群組</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/eresources/#eresources-web>C.4. 官方鏡像站</a></li></ul></li><li><input type=checkbox id=chapter-a80ea4f5a4480b8725422710f954ef36 class=toggle>
<label class="icon cursor" for=chapter-a80ea4f5a4480b8725422710f954ef36><a role=button></a></label><a href=http://172.16.201.134:1313/zh-tw/books/handbook/pgpkeys/>附錄 D. OpenPGP 金鑰</a><ul><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook/pgpkeys/#pgpkeys-officers>D.1. Officers</a></li></ul></li><li></li></ul></nav></div></aside><div class=book><div class=book-menu-mobile><label for=menu-control><span class=menu-control-button><i class="fa fa-list" aria-hidden=true title="Book menu"></i>
Book menu</span></label></div><h1 class=title>章 13. 安全性</h1><div class="admonitionblock note"><p><i class="fa fa-exclamation-circle" aria-hidden=true></i>
This translation may be out of date. To help with the translations please access the <a href=https://translate-dev.freebsd.org/ target=_blank>FreeBSD translations instance</a>.</p></div><div class=toc-mobile><h3>目錄</h3><nav id=TableOfContents><ul><li><a href=#security-synopsis>13.1. 概述</a></li><li><a href=#security-intro>13.2. 簡介</a></li><li><a href=#one-time-passwords>13.3. 一次性密碼</a></li><li><a href=#tcpwrappers>13.4. TCP Wrapper</a></li><li><a href=#kerberos5>13.5. Kerberos</a></li><li><a href=#openssl>13.6. OpenSSL</a></li><li><a href=#ipsec>13.7. VPN over IPsec</a></li><li><a href=#openssh>13.8. OpenSSH</a></li><li><a href=#fs-acl>13.9. 存取控制清單</a></li><li><a href=#security-pkg>13.10. 監視第三方安全性問題</a></li><li><a href=#security-advisories>13.11. FreeBSD 安全報告</a></li><li><a href=#security-accounting>13.12. 程序追蹤</a></li><li><a href=#security-resourcelimits>13.13. 限制資源</a></li><li><a href=#security-sudo>13.14. 使用 Sudo 分享管理權限</a></li></ul></nav></div><div class=book-content><div id=preamble><div class=sectionbody></div></div><div class=sect1><h2 id=security-synopsis>13.1. 概述<a class=anchor href=#security-synopsis></a></h2><div class=sectionbody><div class=paragraph><p>不論實體或虛擬，安全性這個主題大到有整個產業圍繞著它，上百個標準案例已經被用來搛寫如何確保系統與網路的安全性。身為 FreeBSD 必須了解如何避免攻擊與入侵。</p></div><div class=paragraph><p>在此章會討論幾個基本原理及技術。FreeBSD 系統的安全性有許多層面，且有許多第三方工具可以用來增加安全性。</p></div><div class=paragraph><p>讀完這章，您將了解：</p></div><div class=ulist><ul><li><p>基礎 FreeBSD 系統安全概念。</p></li><li><p>FreeBSD 中的幾種加密 (Crypt) 機制。</p></li><li><p>如何設定一次性密碼認證。</p></li><li><p>如何設定 <a href="https://man.freebsd.org/cgi/man.cgi?query=inetd&amp;sektion=8&amp;format=html">inetd(8)</a> 中的 TCP Wrapper。</p></li><li><p>如何在 FreeBSD 設定 Kerberos。</p></li><li><p>如何設定 IPsec 並且建立 VPN。</p></li><li><p>如何在 FreeBSD 設定並使用 OpenSSH。</p></li><li><p>如何使用檔案系統 ACL。</p></li><li><p>如何使用 pkg 來稽查從 Port 套件集安裝的第三方軟體套件。</p></li><li><p>如何利用 FreeBSD 安全報告。</p></li><li><p>什麼是程序追蹤 (Process Accounting) 以及如何在 FreeBSD 開啟。</p></li><li><p>如何使用登入類別或資源限制資料庫控制使用者資源。</p></li></ul></div><div class=paragraph><p>在開始閱讀這章之前，您需要：</p></div><div class=ulist><ul><li><p>了解 FreeBSD 基礎及網路概念。</p></li></ul></div><div class=paragraph><p>其他的安全性議題會在本操作手冊的其他處說明。例如 強制存取控制 (Mandatory Access Control, MAC) 會在 <a href=../mac/#mac>強制存取控制 (MAC)</a> 討論及網路防火牆會在 <a href=../firewalls/#firewalls>防火牆</a> 討論。</p></div></div></div><div class=sect1><h2 id=security-intro>13.2. 簡介<a class=anchor href=#security-intro></a></h2><div class=sectionbody><div class=paragraph><p>保安是每個人的責任，任何系統中的弱點都可讓入侵者取得對關鍵資訊的存取權並導致整個網路的浩劫。資訊安全的其中一個核心原則便是 CIA 三字訣，代表著資訊系統的機密性 (Confidentiality)、完整性 (Integrity) 以及可用性 (Availability)。</p></div><div class=paragraph><p>CIA 三字訣是電腦安全的基石，就如同客戶與使用者期望他們的資料得到保護一樣重要。例如，一個客戶會期望他們的信用卡資訊被安全的保存 (機密性)、他們的訂單不會在私底下被竄改 (完整性) 以及他們隨時可以存取他們的訂單資訊 (可用性)。</p></div><div class=paragraph><p>要提供 CIA，安全專家會應用防禦深度的策略。防禦深度的概念是增加數個保全階層來避免單一階層失效便導致整個安全系統瓦解。例如，系統管理者不能直接打開防火牆與評估網路或系統的安全性，還要同時稽查帳號、檢查 Binary 的完整性與確保未被安裝惡意工具。要執行有效的保安策略，必須了解威脅以及如何抵禦威脅。</p></div><div class=paragraph><p>什麼威脅影響到電腦安全性? 威脅並不僅限於在遠端嘗試未經授權存取系統的遠端攻擊者，威脅也包含員工、惡意軟體、未經許可的網路裝置、天然災害、安全性漏洞甚至是公司競爭對手。</p></div><div class=paragraph><p>系統與網路可以被未經授權存取，有時是因為意外，或是因遠端攻擊者，或在某些案例中，是因商業間諜或者前員工。做為使用者，重要的是做好防範準備以及當有失誤造成安全漏洞能夠承認並回報可能的問題給安全團隊。做為管理者，重要的是了解威脅並準備在發生時能夠減緩威脅。</p></div><div class=paragraph><p>當要應用保安到系統上時，建議由基本帳號以及系統設定開始保全，接著確保網路層，使其遵守系統政策以及組織的安全程序。許多組織已經有涵蓋科技裝置設置的安全性政策，該政策應包含工作站、桌上型電腦、行動裝置、手機、上線伺服器、開發伺服器的安全設置。在大多數案例中，也都已經有標準操作程序 (SOP)，當有疑慮時，請向安全團隊諮詢。</p></div><div class=paragraph><p>簡介接下來的部份將說明如何在 FreeBSD 系統上執行這些基礎的安全設置。本章接下來的部份將介紹在 FreeBSD 系統執行安全性政策時會用到的特定工具。</p></div><div class=sect2><h3 id=security-accounts>13.2.1. 防止登入<a class=anchor href=#security-accounts></a></h3><div class=paragraph><p>要確保一個系統的安全最好的起點便是做好帳號的稽查，確保 <code>root</code> 使用了一個強而有力的密碼，並這個密碼未在其他地方使用過，然後關閉任何無須登入存取權的帳號。</p></div><div class=paragraph><p>要防止登入存取帳號有兩種方法，第一種是鎖定帳號，以下範例會鎖定 <code>toor</code> 帳號：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pw lock toor</span></code></pre></div></div><div class=paragraph><p>第二種防止登入存取的方式是狀 Shell 更改為 <span class=filename>/usr/sbin/nologin</span>，只有超級使用者可以更改其他使用者的 Shell：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># chsh -s /usr/sbin/nologin toor</span></code></pre></div></div><div class=paragraph><p><span class=filename>/usr/sbin/nologin</span> shell 可以避免系統分配 Shell 給嘗試登入的使用者。</p></div></div><div class=sect2><h3 id=security-accountmgmt>13.2.2. 帳號升級授權<a class=anchor href=#security-accountmgmt></a></h3><div class=paragraph><p>在有一些案例，需要與其他使用者共用系統管理權限，FreeBSD 有兩種方式可以處理這種情況。第一種，也是較不建議的方式，是與 <code>wheel</code> 群組的成員共用 root 的密碼，這種方式使用者可以在需要超級使用者的存取權時輸入 <code>su</code> 然後輸入 <code>wheel</code> 的密碼，在完成需要管理存取權的指令之後，使用應輸入 <code>exit</code> 離開。要加入使用者到這個群組，可編輯 <span class=filename>/etc/group</span> 然後加入該使用者到 <code>wheel</code> 項目的最後，使用者必須以逗號字元分隔並不可有空白。</p></div><div class=paragraph><p>第二種方式，也是較建議的方式，安裝 <a class=package href=https://cgit.freebsd.org/ports/tree/security/sudo/>security/sudo</a> 套件或 Port 來提升權限。這個軟體提供了額外的稽查、更細微的使用者控制，然後可以設定鎖定使用者只能執行特定需權限的指令。</p></div><div class=paragraph><p>在安裝之後，使用 <code>visudo</code> 來編輯 <span class=filename>/usr/local/etc/sudoers</span>。這個範例會建立新 <code>webadmin</code> 群組，並加入 <code>trhodes</code> 帳號到該群組，然後設定該群組可重新啟動 <a class=package href=https://cgit.freebsd.org/ports/tree/apache24/>apache24</a> 的存取權：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pw groupadd webadmin -M trhodes -g 6000</span>
<span class=c># visudo</span>
%webadmin <span class=nv>ALL</span><span class=o>=(</span>ALL<span class=o>)</span> /usr/sbin/service apache24 <span class=k>*</span></code></pre></div></div></div><div class=sect2><h3 id=security-passwords>13.2.3. 密碼編碼方式<a class=anchor href=#security-passwords></a></h3><div class=paragraph><p>密碼是資訊科技的必要之惡，當必須使用密碼時，應要有複雜且強大的雜湊機制來加密儲存在密碼資料庫中的密碼。FreeBSD 支援 DES, MD5, SHA256, SHA512 以及 Blowfish 雜湊演算法於其 <code>crypt()</code> 程式庫。預設使用 SHA512，不建議改成更不安全的雜湊演算法，但可改成更安全的 Blowfish 演算法。</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Blowfish 不是 AES 的一部份且不符合任何聯邦資訊處理標準 (Federal Information Processing Standards, FIPS)，在某些環境可能不會允許使用這種加密方式。</p></div></td></tr></tbody></table></div><div class=paragraph><p>要知道目前用何種雜湊演算法來加密某位使用者密碼，超級使用者可以檢視在 FreeBSD 密碼資料庫中該使用者的雜湊，每個雜湊的一開始便會以符號標示其用來加密密碼所使用的雜湊機制。若使用 DES 則開始不會有任何符號，而 MD5 的符號則是 <code>$</code>，SHA256 及 SHA512 的符號是 <code>$6$</code>，Blowfish 的符號是 <code>$2a$</code>。在以下例子中 <code>dru</code> 的密碼使以預設的 SHA512 演算法加密，因為其雜湊的開始為 <code>$6$</code>。注意，該加密過的雜湊，不是原來的密碼，會儲存於密碼資料庫中：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># grep dru /etc/master.passwd</span>
dru:<span class=nv>$6$pzIjSvCAn</span>.PBYQBA<span class=nv>$PXpSeWPx3g5kscj3IMiM7tUEUSPmGexxta</span>.8Lt9TGSi2lNQqYGKszsBPuGME0:1001:1001::0:0:dru:/usr/home/dru:/bin/csh</code></pre></div></div><div class=paragraph><p>雜湊機制是設定在該使用者的登入類別 (Login class)，以此為例，該使用者屬於 <code>default</code> 登入類別，且雜湊演算法是以下行設定在 <span class=filename>/etc/login.conf</span>：</p></div><div class="literalblock programlisting"><div class=content><pre>        :passwd_format=sha512:\</pre></div></div><div class=paragraph><p>要更改演算法為 Blowfish，可修改該行如下：</p></div><div class="literalblock programlisting"><div class=content><pre>        :passwd_format=blf:\</pre></div></div><div class=paragraph><p>然後依 <a href=#users-limiting>設定登入類別</a> 中所描述的方式執行 <code>cap_mkdb /etc/login.conf</code>。注意，這個動作不會影響任何已存在的密碼雜湊，但這代表必須要求所有使用者執行 <code>passwd</code> 來更改其密碼才有辦法重新加密所有密碼。</p></div><div class=paragraph><p>針對遠端登入，應使用雙重認證 (Two-factor authentication)，舉例來說您同時要 "有某樣東西"，如：鑰匙，以及 "知道某個資訊"，如：密碼。自從 OpenSSH 是 FreeBSD 基礎系統的一部份，所有來算網路的登入應透過加密過的連線且使用以金鑰為基礎的認証來替代密碼。要了解更多資訊請參考 <a href=#openssh>OpenSSH</a>。Kerberos 的使用者可能會需要多做一些額外的更改才能在其網路上使用 OpenSSH，這些更改在 <a href=#kerberos5>Kerberos</a> 中會有說明。</p></div></div><div class=sect2><h3 id=security-pwpolicy>13.2.4. 強制密碼政策<a class=anchor href=#security-pwpolicy></a></h3><div class=paragraph><p>強制在本地帳號使用高強度密碼的政策是系統安全的基礎之一。在 FreeBSD 密碼長度、密碼強度以及密碼複雜性可使用內建的可插拔認証模組 (Pluggable Authentication Modules, PAM) 來執行。</p></div><div class=paragraph><p>本節將示範如何設定密碼長度下限與上限以及使用 <span class=filename>pam_passwdqc.so</span> 來強制使用混合字元的密碼，此模組可在使用者更改其密碼時強制要求。</p></div><div class=paragraph><p>要設定此模組，需要先成為超級使用者，然後取消註解在 <span class=filename>/etc/pam.d/passwd</span> 中含有 <code>pam_passwdqc.so</code> 的行。然後編輯該行來配合密碼政策：</p></div><div class="literalblock programlisting"><div class=content><pre>password        requisite       pam_passwdqc.so         min=disabled,disabled,disabled,12,10 similar=deny retry=3 enforce=users</pre></div></div><div class=paragraph><p>這個例子會設定新密碼所需符合的需求。<code>min</code> 設定可以控制密碼長度下限，它有五個值因為這個模組根據密碼的複雜度定義了五種類型。而複雜度是由必須在密碼中存在的字元類型來定義，例如：文字、數字、符號以及大小寫，這些密碼類型在 <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_passwdqc&amp;sektion=8&amp;format=html">pam_passwdqc(8)</a> 有詳細的說明。在這個例子，密碼類型的前三項為關閉的，代表不會接受只滿足這些複雜度的密碼，不論長度為何。<code>12</code> 設定密碼政策可接受滿足三種字元類型複雜度且至少 12 個字元的密碼，<code>10</code> 設定密碼政策接受滿足四種字元類型複雜度且至少 10 個字元的密碼。</p></div><div class=paragraph><p><code>similar</code> 設定則會拒絕以使用者前一次類似的密碼。<code>retry</code> 設定會提供使用者三次輸入新密碼的機會。</p></div><div class=paragraph><p>一這個檔案儲存之後，更改密碼的使用者將會看到如下的訊息：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% passwd
Changing <span class=nb>local </span>password <span class=k>for </span>trhodes
Old Password:

You can now choose the new password.
A valid password should be a mix of upper and lower <span class=k>case</span> letters,
digits and other characters.  You can use a 12 character long
password with characters from at least 3 of these 4 classes, or
a 10 character long password containing characters from all the
classes.  Characters that form a common pattern are discarded by
the check.
Alternatively, <span class=k>if </span>no one <span class=k>else </span>can see your terminal now, you can
pick this as your password: <span class=s2>&#34;trait-useful&amp;knob&#34;</span><span class=nb>.</span>
Enter new password:</code></pre></div></div><div class=paragraph><p>若輸入了一個不符何密碼政策的密碼，則會被拒絕並顯示警告，然後使用者會有機會再重試，直到超過設定的允許重試次數。</p></div><div class=paragraph><p>大多數密碼政策會讓密碼在多日過後過期。要在 FreeBSD 設定密碼年齡日期，可在 <span class=filename>/etc/login.conf</span> 中該使用者的登入類別設定 <code>passwordtime</code>。在 <code>default</code> 登入類別已有設定範例：</p></div><div class="literalblock programlisting"><div class=content><pre>#       :passwordtime=90d:\</pre></div></div><div class=paragraph><p>因此，要設定此登入類別的密碼在 90 天之後過期只需要移除註解符號 (<code>#</code>)，然後儲存編輯結果並執行 <code>cap_mkdb /etc/login.conf</code>。</p></div><div class=paragraph><p>要在個別使用者設定期限，可將有效日期或到期的天數與使用者名稱傳給 <code>pw</code>：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pw usermod -p 30-apr-2015 -n trhodes</span></code></pre></div></div><div class=paragraph><p>如這個例子，有效日期的格式為天、月以及年。要取得更多資訊可參考 <a href="https://man.freebsd.org/cgi/man.cgi?query=pw&amp;sektion=8&amp;format=html">pw(8)</a>。</p></div></div><div class=sect2><h3 id=security-rkhunter>13.2.5. 偵測 Root 工具 (Rootkit)<a class=anchor href=#security-rkhunter></a></h3><div class=paragraph><p><em>rootkit</em> 指的是嘗試未經授權取得系統 <code>root</code> 存取權的軟體。一旦安裝之後，這個惡意軟體將可以光明正大的開啟給另一個給攻擊者進入的大門。現實上，一但系統已被 rootkit 滲透且執行了搜索動作之後，該系統就應該從頭重新安裝，因為即使非常謹真的資安或系統工程式也可能會遺漏攻擊者留下的動西。</p></div><div class=paragraph><p>rootkit 對管理者而言唯一有幫助的是：一但偵測到，便代表某處已經被滲透，但這類型的應用程式躲藏的非常好，本節將會示範一個可以用來偵測 rootkit 的工具，<a class=package href=https://cgit.freebsd.org/ports/tree/security/rkhunter/>security/rkhunter</a>。</p></div><div class=paragraph><p>安裝此套件或 Port 之後，系統便可使用以下指令檢查。該指令提供許多資訊且會需要手動按下 <kbd>ENTER</kbd> 確認：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># rkhunter -c</span></code></pre></div></div><div class=paragraph><p>該程序完成之後，目前狀態的訊息便會顯示在畫面上。這個訊息包含了已檢查過多少檔案、可疑的檔案、可能的 rootkit 以及其他更多資訊。在檢查的過程中，可能會產生一些有關隱藏檔案、OpenSSH 通訊協定選擇及已安裝軟體已知漏洞版本的通用的安全性警告、這些問題可以立即處理或在更詳細的分析之後再處理。</p></div><div class=paragraph><p>每位管理者應了解在系統上執行了那些程式以及這些程式的用途。第三方工具如 rkhunter 與 <a class=package href=https://cgit.freebsd.org/ports/tree/sysutils/lsof/>sysutils/lsof</a> 以及原生指令如 <code>netstat</code> 與 <code>ps</code> 可以系統上大量的資訊，記錄下那一些是正常的，當有不適當的程式出現時提出疑問，然後找出答案。雖然理想要避免滲透，但也必須偵測是否已被滲透了。</p></div></div><div class=sect2><h3 id=security-ids>13.2.6. Binary 檢驗<a class=anchor href=#security-ids></a></h3><div class=paragraph><p>檢驗系統檔案與 Binary 是很重要的，因為它可以提供系統管理者與資安團隊有關系統變更的資訊，能夠監視系統變更的軟體應用程式稱為入侵偵測系統 (Intrusion Detection System, IDS)。</p></div><div class=paragraph><p>FreeBSD 原生提供了基礎的 IDS 系統，雖然每天晚上會有安全性的信件會通知管理者相關的變更，但這些資訊是儲存在本地的，這讓惡意的使用者有機會能夠修改這些資訊來隱藏其對系統的變更。也因此，會建議建立一個獨立的 Binary 簽名並將這些簽名儲存在唯度、root 擁有的目錄或在可移除的 USB 磁碟或遠端 rsync 伺服器更好。</p></div><div class=paragraph><p>內建 <code>mtree</code> 工具可以對一個目錄中的內容產生一個規格檔，產生規格檔會用到一個種子碼 (Seed) 或常數，然後在檢查規格是否有更改過時會也會需要使用這個種子碼或常數。這讓檢查一個檔案或 Binary 是否被修改變成可能的一件事。由於攻擊者並不知道種子碼，要仿冒或檢查檔案的校驗碼 (Checksum) 數值是幾乎不可能的。以下例子會產生一組 SHA256 雜湊，每一個在 <span class=filename>/bin</span> 的系統 Binary 都會有一個，並姐會將這些值以隱藏黨儲存在 <code>root</code> 的家目錄，<span class=filename>/root/.bin_chksum_mtree</span>：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mtree -s 3483151339707503 -c -K cksum,sha256digest -p /bin &gt; /root/.bin_chksum_mtree</span>
<span class=c># mtree: /bin checksum: 3427012225</span></code></pre></div></div><div class=paragraph><p><em>3483151339707503</em> 代表種子碼，這個值應要記錄下來且不可給其它人看。</p></div><div class=paragraph><p>檢視 <span class=filename>/root/.bin_cksum_mtree</span> 應會產生類似以下的輸出結果：</p></div><div class="literalblock programlisting"><div class=content><pre>#          user: root
#       machine: dreadnaught
#          tree: /bin
#          date: Mon Feb  3 10:19:53 2014

# .
/set type=file uid=0 gid=0 mode=0555 nlink=1 flags=none
.               type=dir mode=0755 nlink=2 size=1024 \
                time=1380277977.000000000
    \133        nlink=2 size=11704 time=1380277977.000000000 \
                cksum=484492447 \
                sha256digest=6207490fbdb5ed1904441fbfa941279055c3e24d3a4049aeb45094596400662a
    cat         size=12096 time=1380277975.000000000 cksum=3909216944 \
                sha256digest=65ea347b9418760b247ab10244f47a7ca2a569c9836d77f074e7a306900c1e69
    chflags     size=8168 time=1380277975.000000000 cksum=3949425175 \
                sha256digest=c99eb6fc1c92cac335c08be004a0a5b4c24a0c0ef3712017b12c89a978b2dac3
    chio        size=18520 time=1380277975.000000000 cksum=2208263309 \
                sha256digest=ddf7c8cb92a58750a675328345560d8cc7fe14fb3ccd3690c34954cbe69fc964
    chmod       size=8640 time=1380277975.000000000 cksum=2214429708 \
                sha256digest=a435972263bf814ad8df082c0752aa2a7bdd8b74ff01431ccbd52ed1e490bbe7</pre></div></div><div class=paragraph><p>機器的主機名稱、建立規格檔的日期與時間、以及建立此規格檔的使用者名稱皆會記錄在此報告當中，報告當中還會有在目錄中每個 Binary 的校驗碼、大小、時間以及 SHA256 編碼。</p></div><div class=paragraph><p>要檢驗 Binary 簽名是否有被變更過，可使用先前產生的規格檔比對目前目錄的內容，然後儲存結果到檔案。這個指令需要當初產生原規格檔所使用的種子碼：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mtree -s 3483151339707503 -p /bin &lt; /root/.bin_chksum_mtree &gt;&gt; /root/.bin_chksum_output</span>
<span class=c># mtree: /bin checksum: 3427012225</span></code></pre></div></div><div class=paragraph><p>這個動作應會產生與上次建立 <span class=filename>/bin</span> 規格檔時產生的校驗碼相同，若在此目錄的 Binary 沒有被變更過，那麼 <span class=filename>/root/.bin_chksum_output</span> 這個輸出檔將會是空的。要模擬變更，可以使用 <code>touch</code> 更改 <span class=filename>/root/.bin_chksum_output</span> 的日期然後再執行檢驗指令一次：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># touch /bin/cat</span>
<span class=c># mtree -s 3483151339707503 -p /bin &lt; /root/.bin_chksum_mtree &gt;&gt; /root/.bin_chksum_output</span>
<span class=c># more /root/.bin_chksum_output</span>
<span class=nb>cat </span>changed
	modification <span class=nb>time </span>expected Fri Sep 27 06:32:55 2013 found Mon Feb  3 10:28:43 2014</code></pre></div></div><div class=paragraph><p>建議對含有 Binary 以及設定檔的目錄建立規格檔，對含有敏感資料的目錄也是。通常會為 <span class=filename>/bin</span>, <span class=filename>/sbin</span>, <span class=filename>/usr/bin</span>, <span class=filename>/usr/sbin</span>, <span class=filename>/usr/local/bin</span>, <span class=filename>/etc</span> 及 <span class=filename>/usr/local/etc</span> 建立規格檔。</p></div><div class=paragraph><p>也有更進階的 IDS 系統，例如 <a class=package href=https://cgit.freebsd.org/ports/tree/security/aide/>security/aide</a>。大多數情況 <code>mtree</code> 已可提供管理者所需的功能。將種子碼與校驗碼結果保存在惡意使用者無法存取的地方是非常重要的一件事。更多有關 <code>mtree</code> 的資訊可在 <a href="https://man.freebsd.org/cgi/man.cgi?query=mtree&amp;sektion=8&amp;format=html">mtree(8)</a> 找到。</p></div></div><div class=sect2><h3 id=security-tuning>13.2.7. 系統安全性調校<a class=anchor href=#security-tuning></a></h3><div class=paragraph><p>在 FreeBSD，有許多系統功能可以使用 <code>sysctl</code> 調校，本節會涵蓋少數可以調校來避免阻斷服務 (Denial of Service, DoS) 攻擊的安全性功能。更多有關使用 <code>sysctl</code> 的資訊包含：如何暫時更改數值及如何在測試之後做永久更改可在 <a href=../config/#configtuning-sysctl>使用 sysctl(8) 調校</a> 找到。</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>任何時間使用 <a href=../config/#configtuning-sysctl>使用 sysctl(8) 調校</a> 做的設定變更都會讓造成不想要的傷害的可能性上升，影響到系統的可用性。因此應要對所有的變更做監視，若可能的話，先在測試系統上實驗，再到上線的系統上使用。</p></div></td></tr></tbody></table></div><div class=paragraph><p>預設 FreeBSD 核心會使用安全性層級 <code>-1</code> 來開機，這又稱作"不安全模式"，因為不可變 (Immutable) 檔案旗標可以被關閉且可以讀取或寫入所有的裝置。除非有使用 <code>sysctl</code> 或在啟動 Script 設定修改該值，否則安全性層級將會在 <code>-1</code>。安全性層級可以在系統啟動時透過在 <span class=filename>/etc/rc.conf</span> 設定 <code>kern_securelevel_enable</code> 為 <code>YES</code> 以及 設定 <code>kern_securelevel</code> 的值為想要的安全層級來提升。請參考 <a href="https://man.freebsd.org/cgi/man.cgi?query=security&amp;sektion=7&amp;format=html">security(7)</a> 以及 <a href="https://man.freebsd.org/cgi/man.cgi?query=init&amp;sektion=8&amp;format=html">init(8)</a> 以取得更多與這些設定及可用的安全性層級相關的資訊。</p></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>提高 <code>securelevel</code> 會導致 Xorg 無法執行以及造成其他問題，請做好除錯的準備。</p></div></td></tr></tbody></table></div><div class=paragraph><p><code>net.inet.tcp.blackhole</code> 以及 <code>net.inet.udp.blackhole</code> 設定可以用來丟棄在已關閉連接埠 (Port) 收到的 SYN 封包且不會回傳 RST 回應，預設的動作是會回傳 RST 來表示該連接埠已被關閉，更改預設的動作可對連接埠掃描 (用在查看在系統上執行的應用程式) 提供一定程度的保護，要這麼做可設定 <code>net.inet.tcp.blackhole</code> 為 <code>2</code> 及 <code>net.inet.udp.blackhole</code> 為 <code>1</code>。請參考 <a href="https://man.freebsd.org/cgi/man.cgi?query=blackhole&amp;sektion=4&amp;format=html">blackhole(4)</a> 以取得更多有關這些設定的資訊。</p></div><div class=paragraph><p><code>net.inet.icmp.drop_redirect</code> 以及 <code>net.inet.ip.redirect</code> 設定可以幫助避免 <em>重新導向攻擊 (Redirect attacks)</em>，重新導向攻擊是 DoS 的一種，會傳送大量 ICMP 類型 5 的封包，由於這些封包並不是必要的，設定 <code>net.inet.icmp.drop_redirect</code> 為 <code>1</code> 以及設定 <code>net.inet.ip.redirect</code> 為 <code>0</code> 可丟棄這些封包。</p></div><div class=paragraph><p>來源路由 (Source routing) 是一種偵測與存取在內部網路中不可路由位址的方法，由於不可路由位址通常是固故讓它不可路由的，因此可以關閉這個功能。要關閉這個功能可設定 <code>net.inet.ip.sourceroute</code> 以及 <code>net.inet.ip.accept_sourceroute</code> 為 <code>0</code>。</p></div><div class=paragraph><p>當一台在網路上的機器需要傳送訊息給所有在子網路上的主機時，會發送 ICMP 回應請求訊息到廣播位址。然而，外部的主機是沒有理由可以執行這個動作的。要拒絕所有來自外部的廣播請求可設定 <code>net.inet.icmp.bmcastecho</code> 為 <code>0</code>。</p></div><div class=paragraph><p>還有一些額外的設定在 <a href="https://man.freebsd.org/cgi/man.cgi?query=security&amp;sektion=7&amp;format=html">security(7)</a> 有說明。</p></div></div></div></div><div class=sect1><h2 id=one-time-passwords>13.3. 一次性密碼<a class=anchor href=#one-time-passwords></a></h2><div class=sectionbody><div class=paragraph><p>預設 FreeBSD 已內建一次性密碼 (One-time Passwords In Everything, OPIE)。OPIE 設計用來避免重送攻擊 (Replay attack)，重送攻擊指的是攻擊者發現了某位使用者的密碼，然後使用該密碼來存取系統。由於在 OPIE 的環境下，一組密碼只能被使用一次，被發現的密碼對攻擊者而言便沒有什麼作用。OPIE 使用了安全的加密方式與詰問/回應系統 (Challenge/response system) 來管理密碼。FreeBSD 在實作上預設採用 MD5 加密。</p></div><div class=paragraph><p>OPIE 使用了三種不同類型的密碼，第一種是一般的 UNIX™ 或 Kerberos 密碼，第二種是由 <code>opiekey</code> 所產生的一次性密碼，第三種是用來生一次性密碼的 "秘密密碼 (Secret password)"，秘密密碼與 UNIX™ 密碼無關且不應相同。</p></div><div class=paragraph><p>對 OPIE 來說還有另外兩個部份的資料很重要。其中一個是"種子碼 (Seed)" 或稱"金鑰 (Key)"，由兩個字母與五個數字組成。另一個則是"疊代次數 (Iteration count)"，是一個介於 1 到 100 間的數字。OPIE 會將種子碼與秘密密碼串連後，套用 MD5 加密數次後 (根據疊代次數)，再將結果轉換成六個簡短的英文單字來產生一次性密碼。認証系統會持續追蹤最後使用的一次性密碼，若使用者提供的密碼加密後與前一次的密碼相同則可通過認証。由於採用了單向的加密方式，若使用過的密碼被成功擷取也無法拿來產生之後的一次性密碼。疊代次數會在每一次登入成功之後減少，來保持使用者與登入程式間的同步。當疊代次數減少至 <code>1</code> 時，OPIE 便要重新初始化。</p></div><div class=paragraph><p>這個整個程序會牽涉到幾個程式。傳送疊代次數、種子碼與秘密密碼來產生一組一次性密碼或數個一次性密碼的 <a href="https://man.freebsd.org/cgi/man.cgi?query=opiekey&amp;sektion=1&amp;format=html">opiekey(1)</a>。除了初始化 OPIE 之外，用來更改密碼、疊代次數或種子碼的 <a href="https://man.freebsd.org/cgi/man.cgi?query=opiepasswd&amp;sektion=1&amp;format=html">opiepasswd(1)</a>。會讀取放在 <span class=filename>/etc/opiekeys</span> 的相關憑証檔來列出使用者目前的疊代次數與種子碼的 <a href="https://man.freebsd.org/cgi/man.cgi?query=opieinfo&amp;sektion=1&amp;format=html">opieinfo(1)</a>。</p></div><div class=paragraph><p>本章節將介紹四種不同的操作，第一是如何在安全連線下做第一次的一次性密碼設定，第二是如何使用在不安全的連線下使用 <code>opiepasswd</code>，第三是如何在不安全的連線下登入系統，第四是如何產生數個可以被記錄或列印下來在不安全的場所使的金鑰。</p></div><div class=sect2><h3 id=_初始化_opie>13.3.1. 初始化 OPIE<a class=anchor href=#_初始化_opie></a></h3><div class=paragraph><p>第一次要初始化 OPIE，要在安全的場所執行以下指令：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% opiepasswd <span class=nt>-c</span>
Adding unfurl:
Only use this method from the console<span class=p>;</span> NEVER from remote. If you are using
telnet, xterm, or a dial-in, <span class=nb>type</span> ^C now or <span class=nb>exit </span>with no password.
Then run opiepasswd without the <span class=nt>-c</span> parameter.
Using MD5 to compute responses.
Enter new secret pass phrase:
Again new secret pass phrase:

ID unfurl OTP key is 499 to4268
MOS MALL GOAT ARM AVID COED</code></pre></div></div><div class=paragraph><p><code>-c</code> 會設定採用假設指令在安全場所執行的 Console 模式，如在使用者掌控之中的電腦或者透過 SSH 連線到一台在使用者掌控之中的電腦。</p></div><div class=paragraph><p>提示出現後，輸入用來產生一次性登入金鑰的秘密密碼，應使用一個不容易被猜出來的密碼，且應與使用者登入帳號所使用的密碼不同，密碼必須介於 10 到 127 個字元長度之間，然後請記住這個密碼。</p></div><div class=paragraph><p><code>ID</code> 行會列出登入名稱 (<code>unfurl</code>)、預設的疊代次數 (<code>499</code>) 以及預設的種子碼 (<code>to4268</code>)。在進行登入時，系統會記住這些參數並且顯示出來，這也代表不需要另外記錄這些資訊。最後一行會列出根據這些參數與秘密密碼所產生出來的一次性密碼，在下一次登入時便要使用這個一次性密碼。</p></div></div><div class=sect2><h3 id=_在不安全連線下做初始化>13.3.2. 在不安全連線下做初始化<a class=anchor href=#_在不安全連線下做初始化></a></h3><div class=paragraph><p>要在不安全的系統上初始化或更改秘密密碼會需要某個可使用安全的連線的地方執行 <code>opiekey</code>，這可能是在某一台信任的主機上的 Shell。初始化需要設定疊代次數，100 可能是不錯的數字，種子碼可以自行指定或隨機產生，在不安全連線下要被初始化主機須使用 <a href="https://man.freebsd.org/cgi/man.cgi?query=opiepasswd&amp;sektion=1&amp;format=html">opiepasswd(1)</a>：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% opiepasswd

Updating unfurl:
You need the response from an OTP generator.
Old secret pass phrase:
	otp-md5 498 to4268 ext
	Response: GAME GAG WELT OUT DOWN CHAT
New secret pass phrase:
	otp-md5 499 to4269
	Response: LINE PAP MILK NELL BUOY TROY

ID mark OTP key is 499 gr4269
LINE PAP MILK NELL BUOY TROY</code></pre></div></div><div class=paragraph><p>要採用預設的種子碼，可直接按下 <kbd>Return</kbd> 做初始化。接著在輸入回應之前移到安全的連線然後給予相同的加密參數產生密碼：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% opiekey 498 to4268
Using the MD5 algorithm to compute response.
Reminder: Do not use opiekey from telnet or dial-in sessions.
Enter secret pass phrase:
GAME GAG WELT OUT DOWN CHAT</code></pre></div></div><div class=paragraph><p>切換回不安全的連線，然後複製產生的一次性密碼貼上。</p></div></div><div class=sect2><h3 id=_產生單組一次性密碼>13.3.3. 產生單組一次性密碼<a class=anchor href=#_產生單組一次性密碼></a></h3><div class=paragraph><p>在初始化 OPIE 之後進行登入會顯示如下的提示訊息：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% telnet example.com
Trying 10.0.0.1...
Connected to example.com
Escape character is <span class=s1>&#39;^]&#39;</span><span class=nb>.</span>

FreeBSD/i386 <span class=o>(</span>example.com<span class=o>)</span> <span class=o>(</span>ttypa<span class=o>)</span>

login: &lt;username&gt;
otp-md5 498 gr4269 ext
Password:</code></pre></div></div><div class=paragraph><p>OPIE 的提示提供了一個很有用的功能，若在密碼提示時按下 <kbd>Return</kbd>，便會開啟回應功能並顯示輸入的內容，這個功能在嘗試手工輸入列印出來的密碼時很有用。</p></div><div class=paragraph><p>此時，要產生一次性密碼來回應登入時的提示，這必須在受信任且可安全執行 <a href="https://man.freebsd.org/cgi/man.cgi?query=opiekey&amp;sektion=1&amp;format=html">opiekey(1)</a> 的系統上完成。這個指令有提供 Windows™, Mac OS™ 與 FreeBSD 版本，使用時需要疊代次數與種子碼做為在指令列的參數，剪下在要登入主機在登入時所提示的訊息。</p></div><div class=paragraph><p>在信任的系統上執行：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% opiekey 498 to4268
Using the MD5 algorithm to compute response.
Reminder: Do not use opiekey from telnet or dial-in sessions.
Enter secret pass phrase:
GAME GAG WELT OUT DOWN CHAT</code></pre></div></div><div class=paragraph><p>在產生一次性密碼後，回到登入畫面繼續登入。</p></div></div><div class=sect2><h3 id=_產生多組一次性密碼>13.3.4. 產生多組一次性密碼<a class=anchor href=#_產生多組一次性密碼></a></h3><div class=paragraph><p>有時會無法存取信任的主機或沒有安全的連線，在這種情況下，可以使用 <a href="https://man.freebsd.org/cgi/man.cgi?query=opiekey&amp;sektion=1&amp;format=html">opiekey(1)</a> 來預先產生多個一次性密碼，例如：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% opiekey <span class=nt>-n</span> 5 30 zz99999
Using the MD5 algorithm to compute response.
Reminder: Do not use opiekey from telnet or dial-in sessions.
Enter secret pass phrase: &lt;secret password&gt;
26: JOAN BORE FOSS DES NAY QUIT
27: LATE BIAS SLAY FOLK MUCH TRIG
28: SALT TIN ANTI LOON NEAL USE
29: RIO ODIN GO BYE FURY TIC
30: GREW JIVE SAN GIRD BOIL PHI</code></pre></div></div><div class=paragraph><p><code>-n 5</code> 會請求產生連續五個金鑰，而 <code>30</code> 則是指定最後一個疊代的編號。注意這些列印出的結果的順序與使用的順序<em>相反</em>。十足的偏執狂可能會想要用手寫下結果，否則就列印出清單。每一行會同時顯示疊代次數及一次性密碼，在密碼使用過後便可劃掉。</p></div></div><div class=sect2><h3 id=_限制使用_unix_密碼>13.3.5. 限制使用 UNIX™ 密碼<a class=anchor href=#_限制使用_unix_密碼></a></h3><div class=paragraph><p>OPIE 可以根據登入階段的 IP 位置限制使用 UNIX™ 密碼，相關的檔案為 <span class=filename>/etc/opieaccess</span>，這個檔案預設便存在。請參考 <a href="https://man.freebsd.org/cgi/man.cgi?query=opieaccess&amp;sektion=5&amp;format=html">opieaccess(5)</a> 來取得更多有關此檔案的資訊以及當使用時要考量的安全性問題。</p></div><div class=paragraph><p>這裡有一個範本 <span class=filename>opieaccess</span>：</p></div><div class="literalblock programlisting"><div class=content><pre>permit 192.168.0.0 255.255.0.0</pre></div></div><div class=paragraph><p>這一行允許來源 IP 位址 (容易受到詐騙的位址) 符合指定值與遮罩的使用者在任何時間可使用 UNIX™ 密碼登入。</p></div><div class=paragraph><p>若在 <span class=filename>opieaccess</span> 中沒有符合的規則，預設會拒絕非 OPIE 的登入。</p></div></div></div></div><div class=sect1><h2 id=tcpwrappers>13.4. TCP Wrapper<a class=anchor href=#tcpwrappers></a></h2><div class=sectionbody><div class=paragraph><p>TCP Wrapper is a host-based access control system which extends the abilities of <a href=../network-servers/#network-inetd>inetd 超級伺服器</a>. It can be configured to provide logging support, return messages, and connection restrictions for the server daemons under the control of inetd. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=tcpd&amp;sektion=8&amp;format=html">tcpd(8)</a> for more information about TCP Wrapper and its features.</p></div><div class=paragraph><p>TCP Wrapper should not be considered a replacement for a properly configured firewall. Instead, TCP Wrapper should be used in conjunction with a firewall and other security enhancements in order to provide another layer of protection in the implementation of a security policy.</p></div><div class=sect2><h3 id=_初始設定>13.4.1. 初始設定<a class=anchor href=#_初始設定></a></h3><div class=paragraph><p>To enable TCP Wrapper in FreeBSD, add the following lines to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>inetd_enable=&#34;YES&#34;
inetd_flags=&#34;-Ww&#34;</pre></div></div><div class=paragraph><p>Then, properly configure <span class=filename>/etc/hosts.allow</span>.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Unlike other implementations of TCP Wrapper, the use of <span class=filename>hosts.deny</span> is deprecated in FreeBSD. All configuration options should be placed in <span class=filename>/etc/hosts.allow</span>.</p></div></td></tr></tbody></table></div><div class=paragraph><p>In the simplest configuration, daemon connection policies are set to either permit or block, depending on the options in <span class=filename>/etc/hosts.allow</span>. The default configuration in FreeBSD is to allow all connections to the daemons started with inetd.</p></div><div class=paragraph><p>Basic configuration usually takes the form of <code>daemon : address : action</code>, where <code>daemon</code> is the daemon which inetd started, <code>address</code> is a valid hostname, IP address, or an IPv6 address enclosed in brackets ([ ]), and <code>action</code> is either <code>allow</code> or <code>deny</code>. TCP Wrapper uses a first rule match semantic, meaning that the configuration file is scanned from the beginning for a matching rule. When a match is found, the rule is applied and the search process stops.</p></div><div class=paragraph><p>For example, to allow POP3 connections via the <a class=package href=https://cgit.freebsd.org/ports/tree/mail/qpopper/>mail/qpopper</a> daemon, the following lines should be appended to <span class=filename>hosts.allow</span>:</p></div><div class="literalblock programlisting"><div class=content><pre># This line is required for POP3 connections:
qpopper : ALL : allow</pre></div></div><div class=paragraph><p>Whenever this file is edited, restart inetd:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service inetd restart</span></code></pre></div></div></div><div class=sect2><h3 id=_進階設定>13.4.2. 進階設定<a class=anchor href=#_進階設定></a></h3><div class=paragraph><p>TCP Wrapper provides advanced options to allow more control over the way connections are handled. In some cases, it may be appropriate to return a comment to certain hosts or daemon connections. In other cases, a log entry should be recorded or an email sent to the administrator. Other situations may require the use of a service for local connections only. This is all possible through the use of configuration options known as wildcards, expansion characters, and external command execution.</p></div><div class=paragraph><p>Suppose that a situation occurs where a connection should be denied yet a reason should be sent to the host who attempted to establish that connection. That action is possible with <code>twist</code>. When a connection attempt is made, <code>twist</code> executes a shell command or script. An example exists in <span class=filename>hosts.allow</span>:</p></div><div class="literalblock programlisting"><div class=content><pre># The rest of the daemons are protected.
ALL : ALL \
	: severity auth.info \
	: twist /bin/echo &#34;You are not welcome to use %d from %h.&#34;</pre></div></div><div class=paragraph><p>In this example, the message "You are not allowed to use <em>daemon name</em> from <em>hostname</em>." will be returned for any daemon not configured in <span class=filename>hosts.allow</span>. This is useful for sending a reply back to the connection initiator right after the established connection is dropped. Any message returned <em>must</em> be wrapped in quote (<code>"</code>) characters.</p></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>It may be possible to launch a denial of service attack on the server if an attacker floods these daemons with connection requests.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Another possibility is to use <code>spawn</code>. Like <code>twist</code>, <code>spawn</code> implicitly denies the connection and may be used to run external shell commands or scripts. Unlike <code>twist</code>, <code>spawn</code> will not send a reply back to the host who established the connection. For example, consider the following configuration:</p></div><div class="literalblock programlisting"><div class=content><pre># We do not allow connections from example.com:
ALL : .example.com \
	: spawn (/bin/echo %a from %h attempted to access %d &gt;&gt; \
	  /var/log/connections.log) \
	: deny</pre></div></div><div class=paragraph><p>This will deny all connection attempts from <code>*.example.com</code> and log the hostname, IP address, and the daemon to which access was attempted to <span class=filename>/var/log/connections.log</span>. This example uses the substitution characters <code>%a</code> and <code>%h</code>. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=hosts_access&amp;sektion=5&amp;format=html">hosts_access(5)</a> for the complete list.</p></div><div class=paragraph><p>To match every instance of a daemon, domain, or IP address, use <code>ALL</code>. Another wildcard is <code>PARANOID</code> which may be used to match any host which provides an IP address that may be forged because the IP address differs from its resolved hostname. In this example, all connection requests to Sendmail which have an IP address that varies from its hostname will be denied:</p></div><div class="literalblock programlisting"><div class=content><pre># Block possibly spoofed requests to sendmail:
sendmail : PARANOID : deny</pre></div></div><div class="admonitionblock caution"><table><tbody><tr><td class=icon><i class="fa icon-caution" title=Caution></i></td><td class=content><div class=paragraph><p>Using the <code>PARANOID</code> wildcard will result in denied connections if the client or server has a broken DNS setup.</p></div></td></tr></tbody></table></div><div class=paragraph><p>To learn more about wildcards and their associated functionality, refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=hosts_access&amp;sektion=5&amp;format=html">hosts_access(5)</a>.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>When adding new configuration lines, make sure that any unneeded entries for that daemon are commented out in <span class=filename>hosts.allow</span>.</p></div></td></tr></tbody></table></div></div></div></div><div class=sect1><h2 id=kerberos5>13.5. Kerberos<a class=anchor href=#kerberos5></a></h2><div class=sectionbody><div class=paragraph><p>Kerberos is a network authentication protocol which was originally created by the Massachusetts Institute of Technology (MIT) as a way to securely provide authentication across a potentially hostile network. The Kerberos protocol uses strong cryptography so that both a client and server can prove their identity without sending any unencrypted secrets over the network. Kerberos can be described as an identity-verifying proxy system and as a trusted third-party authentication system. After a user authenticates with Kerberos, their communications can be encrypted to assure privacy and data integrity.</p></div><div class=paragraph><p>The only function of Kerberos is to provide the secure authentication of users and servers on the network. It does not provide authorization or auditing functions. It is recommended that Kerberos be used with other security methods which provide authorization and audit services.</p></div><div class=paragraph><p>The current version of the protocol is version 5, described in RFC 4120. Several free implementations of this protocol are available, covering a wide range of operating systems. MIT continues to develop their Kerberos package. It is commonly used in the US as a cryptography product, and has historically been subject to US export regulations. In FreeBSD, MITKerberos is available as the <a class=package href=https://cgit.freebsd.org/ports/tree/security/krb5/>security/krb5</a> package or port. The Heimdal Kerberos implementation was explicitly developed outside of the US to avoid export regulations. The Heimdal Kerberos distribution is included in the base FreeBSD installation, and another distribution with more configurable options is available as <a class=package href=https://cgit.freebsd.org/ports/tree/security/heimdal/>security/heimdal</a> in the Ports Collection.</p></div><div class=paragraph><p>In Kerberos users and services are identified as "principals" which are contained within an administrative grouping, called a "realm". A typical user principal would be of the form <code><em>user</em>@<em>REALM</em></code> (realms are traditionally uppercase).</p></div><div class=paragraph><p>This section provides a guide on how to set up Kerberos using the Heimdal distribution included in FreeBSD.</p></div><div class=paragraph><p>For purposes of demonstrating a Kerberos installation, the name spaces will be as follows:</p></div><div class=ulist><ul><li><p>The DNS domain (zone) will be <code>example.org</code>.</p></li><li><p>The Kerberos realm will be <code>EXAMPLE.ORG</code>.</p></li></ul></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Use real domain names when setting up Kerberos, even if it will run internally. This avoids DNS problems and assures inter-operation with other Kerberos realms.</p></div></td></tr></tbody></table></div><div class=sect2><h3 id=_設定_heimdal_kdc>13.5.1. 設定 Heimdal KDC<a class=anchor href=#_設定_heimdal_kdc></a></h3><div class=paragraph><p>The Key Distribution Center (KDC) is the centralized authentication service that Kerberos provides, the "trusted third party" of the system. It is the computer that issues Kerberos tickets, which are used for clients to authenticate to servers. Because the KDC is considered trusted by all other computers in the Kerberos realm, it has heightened security concerns. Direct access to the KDC should be limited.</p></div><div class=paragraph><p>While running a KDC requires few computing resources, a dedicated machine acting only as a KDC is recommended for security reasons.</p></div><div class=paragraph><p>To begin setting up a KDC, add these lines to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>kdc_enable=&#34;YES&#34;
kadmind_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>Next, edit <span class=filename>/etc/krb5.conf</span> as follows:</p></div><div class="literalblock programlisting"><div class=content><pre>[libdefaults]
    default_realm = EXAMPLE.ORG
[realms]
    EXAMPLE.ORG = {
	kdc = kerberos.example.org
	admin_server = kerberos.example.org
    }
[domain_realm]
    .example.org = EXAMPLE.ORG</pre></div></div><div class=paragraph><p>In this example, the KDC will use the fully-qualified hostname <code>kerberos.example.org</code>. The hostname of the KDC must be resolvable in the DNS.</p></div><div class=paragraph><p>Kerberos can also use the DNS to locate KDCs, instead of a <code>[realms]</code> section in <span class=filename>/etc/krb5.conf</span>. For large organizations that have their own DNS servers, the above example could be trimmed to:</p></div><div class="literalblock programlisting"><div class=content><pre>[libdefaults]
      default_realm = EXAMPLE.ORG
[domain_realm]
    .example.org = EXAMPLE.ORG</pre></div></div><div class=paragraph><p>With the following lines being included in the <code>example.org</code> zone file:</p></div><div class="literalblock programlisting"><div class=content><pre>_kerberos._udp      IN  SRV     01 00 88 kerberos.example.org.
_kerberos._tcp      IN  SRV     01 00 88 kerberos.example.org.
_kpasswd._udp       IN  SRV     01 00 464 kerberos.example.org.
_kerberos-adm._tcp  IN  SRV     01 00 749 kerberos.example.org.
_kerberos           IN  TXT     EXAMPLE.ORG</pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>In order for clients to be able to find the Kerberos services, they <em>must</em> have either a fully configured <span class=filename>/etc/krb5.conf</span> or a minimally configured <span class=filename>/etc/krb5.conf</span><em>and</em> a properly configured DNS server.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Next, create the Kerberos database which contains the keys of all principals (users and hosts) encrypted with a master password. It is not required to remember this password as it will be stored in <span class=filename>/var/heimdal/m-key</span>; it would be reasonable to use a 45-character random password for this purpose. To create the master key, run <code>kstash</code> and enter a password:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># kstash</span>
Master key: xxxxxxxxxxxxxxxxxxxxxxx
Verifying password - Master key: xxxxxxxxxxxxxxxxxxxxxxx</code></pre></div></div><div class=paragraph><p>Once the master key has been created, the database should be initialized. The Kerberos administrative tool <a href="https://man.freebsd.org/cgi/man.cgi?query=kadmin&amp;sektion=8&amp;format=html">kadmin(8)</a> can be used on the KDC in a mode that operates directly on the database, without using the <a href="https://man.freebsd.org/cgi/man.cgi?query=kadmind&amp;sektion=8&amp;format=html">kadmind(8)</a> network service, as <code>kadmin -l</code>. This resolves the chicken-and-egg problem of trying to connect to the database before it is created. At the <code>kadmin</code> prompt, use <code>init</code> to create the realm’s initial database:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># kadmin -l</span>
kadmin&gt; init EXAMPLE.ORG
Realm max ticket life <span class=o>[</span>unlimited]:</code></pre></div></div><div class=paragraph><p>Lastly, while still in <code>kadmin</code>, create the first principal using <code>add</code>. Stick to the default options for the principal for now, as these can be changed later with <code>modify</code>. Type <code>?</code> at the prompt to see the available options.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>kadmin&gt; add tillman
Max ticket life <span class=o>[</span>unlimited]:
Max renewable life <span class=o>[</span>unlimited]:
Attributes <span class=o>[]</span>:
Password: xxxxxxxx
Verifying password - Password: xxxxxxxx</code></pre></div></div><div class=paragraph><p>Next, start the KDC services by running <code>service kdc start</code> and <code>service kadmind start</code>. While there will not be any kerberized daemons running at this point, it is possible to confirm that the KDC is functioning by obtaining a ticket for the principal that was just created:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% kinit tillman
tillman@EXAMPLE.ORG<span class=s1>&#39;s Password:</span></code></pre></div></div><div class=paragraph><p>Confirm that a ticket was successfully obtained using <code>klist</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% klist
Credentials cache: FILE:/tmp/krb5cc_1001
	Principal: tillman@EXAMPLE.ORG

  Issued                Expires               Principal
Aug 27 15:37:58 2013  Aug 28 01:37:58 2013  krbtgt/EXAMPLE.ORG@EXAMPLE.ORG</code></pre></div></div><div class=paragraph><p>The temporary ticket can be destroyed when the test is finished:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% kdestroy</code></pre></div></div></div><div class=sect2><h3 id=_設定伺服器使用_kerberos>13.5.2. 設定伺服器使用 Kerberos<a class=anchor href=#_設定伺服器使用_kerberos></a></h3><div class=paragraph><p>The first step in configuring a server to use Kerberos authentication is to ensure that it has the correct configuration in <span class=filename>/etc/krb5.conf</span>. The version from the KDC can be used as-is, or it can be regenerated on the new system.</p></div><div class=paragraph><p>Next, create <span class=filename>/etc/krb5.keytab</span> on the server. This is the main part of "Kerberizing" a service — it corresponds to generating a secret shared between the service and the KDC. The secret is a cryptographic key, stored in a "keytab". The keytab contains the server’s host key, which allows it and the KDC to verify each others' identity. It must be transmitted to the server in a secure fashion, as the security of the server can be broken if the key is made public. Typically, the <span class=filename>keytab</span> is generated on an administrator’s trusted machine using <code>kadmin</code>, then securely transferred to the server, e.g., with <a href="https://man.freebsd.org/cgi/man.cgi?query=scp&amp;sektion=1&amp;format=html">scp(1)</a>; it can also be created directly on the server if that is consistent with the desired security policy. It is very important that the keytab is transmitted to the server in a secure fashion: if the key is known by some other party, that party can impersonate any user to the server! Using <code>kadmin</code> on the server directly is convenient, because the entry for the host principal in the KDC database is also created using <code>kadmin</code>.</p></div><div class=paragraph><p>Of course, <code>kadmin</code> is a kerberized service; a Kerberos ticket is needed to authenticate to the network service, but to ensure that the user running <code>kadmin</code> is actually present (and their session has not been hijacked), <code>kadmin</code> will prompt for the password to get a fresh ticket. The principal authenticating to the kadmin service must be permitted to use the <code>kadmin</code> interface, as specified in <span class=filename>kadmind.acl</span>. See the section titled "Remote administration" in <code>info heimdal</code> for details on designing access control lists. Instead of enabling remote <code>kadmin</code> access, the administrator could securely connect to the KDC via the local console or <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;format=html">ssh(1)</a>, and perform administration locally using <code>kadmin -l</code>.</p></div><div class=paragraph><p>After installing <span class=filename>/etc/krb5.conf</span>, use <code>add --random-key</code> in <code>kadmin</code>. This adds the server’s host principal to the database, but does not extract a copy of the host principal key to a keytab. To generate the keytab, use <code>ext</code> to extract the server’s host principal key to its own keytab:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># kadmin</span>
kadmin&gt; add <span class=nt>--random-key</span> host/myserver.example.org
Max ticket life <span class=o>[</span>unlimited]:
Max renewable life <span class=o>[</span>unlimited]:
Principal expiration <span class=nb>time</span> <span class=o>[</span>never]:
Password expiration <span class=nb>time</span> <span class=o>[</span>never]:
Attributes <span class=o>[]</span>:
kadmin&gt; ext_keytab host/myserver.example.org
kadmin&gt; <span class=nb>exit</span></code></pre></div></div><div class=paragraph><p>Note that <code>ext_keytab</code> stores the extracted key in <span class=filename>/etc/krb5.keytab</span> by default. This is good when being run on the server being kerberized, but the <code>--keytab <em>path/to/file</em></code> argument should be used when the keytab is being extracted elsewhere:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># kadmin</span>
kadmin&gt; ext_keytab <span class=nt>--keytab</span><span class=o>=</span>/tmp/example.keytab host/myserver.example.org
kadmin&gt; <span class=nb>exit</span></code></pre></div></div><div class=paragraph><p>The keytab can then be securely copied to the server using <a href="https://man.freebsd.org/cgi/man.cgi?query=scp&amp;sektion=1&amp;format=html">scp(1)</a> or a removable media. Be sure to specify a non-default keytab name to avoid inserting unneeded keys into the system’s keytab.</p></div><div class=paragraph><p>At this point, the server can read encrypted messages from the KDC using its shared key, stored in <span class=filename>krb5.keytab</span>. It is now ready for the Kerberos-using services to be enabled. One of the most common such services is <a href="https://man.freebsd.org/cgi/man.cgi?query=sshd&amp;sektion=8&amp;format=html">sshd(8)</a>, which supports Kerberos via the GSS-API. In <span class=filename>/etc/ssh/sshd_config</span>, add the line:</p></div><div class="literalblock programlisting"><div class=content><pre>GSSAPIAuthentication yes</pre></div></div><div class=paragraph><p>做完了這個變更之後，必須重新啟動 <a href="https://man.freebsd.org/cgi/man.cgi?query=sshd&amp;sektion=8&amp;format=html">sshd(8)</a> 來使新的設定值生效：<code>service sshd restart</code>。</p></div></div><div class=sect2><h3 id=_設定客戶端使用_kerberos>13.5.3. 設定客戶端使用 Kerberos<a class=anchor href=#_設定客戶端使用_kerberos></a></h3><div class=paragraph><p>As it was for the server, the client requires configuration in <span class=filename>/etc/krb5.conf</span>. Copy the file in place (securely) or re-enter it as needed.</p></div><div class=paragraph><p>Test the client by using <code>kinit</code>, <code>klist</code>, and <code>kdestroy</code> from the client to obtain, show, and then delete a ticket for an existing principal. Kerberos applications should also be able to connect to Kerberos enabled servers. If that does not work but obtaining a ticket does, the problem is likely with the server and not with the client or the KDC. In the case of kerberized <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;format=html">ssh(1)</a>, GSS-API is disabled by default, so test using <code>ssh -o GSSAPIAuthentication=yes <em>hostname</em></code>.</p></div><div class=paragraph><p>When testing a Kerberized application, try using a packet sniffer such as <code>tcpdump</code> to confirm that no sensitive information is sent in the clear.</p></div><div class=paragraph><p>Various Kerberos client applications are available. With the advent of a bridge so that applications using SASL for authentication can use GSS-API mechanisms as well, large classes of client applications can use Kerberos for authentication, from Jabber clients to IMAP clients.</p></div><div class=paragraph><p>Users within a realm typically have their Kerberos principal mapped to a local user account. Occasionally, one needs to grant access to a local user account to someone who does not have a matching Kerberos principal. For example, <code>tillman@EXAMPLE.ORG</code> may need access to the local user account <code>webdevelopers</code>. Other principals may also need access to that local account.</p></div><div class=paragraph><p>The <span class=filename>.k5login</span> and <span class=filename>.k5users</span> files, placed in a user’s home directory, can be used to solve this problem. For example, if the following <span class=filename>.k5login</span> is placed in the home directory of <code>webdevelopers</code>, both principals listed will have access to that account without requiring a shared password:</p></div><div class="literalblock programlisting"><div class=content><pre>tillman@example.org
jdoe@example.org</pre></div></div><div class=paragraph><p>Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=ksu&amp;sektion=1&amp;format=html">ksu(1)</a> for more information about <span class=filename>.k5users</span>.</p></div></div><div class=sect2><h3 id=_與_mit_的差異>13.5.4. 與 MIT 的差異<a class=anchor href=#_與_mit_的差異></a></h3><div class=paragraph><p>The major difference between the MIT and Heimdal implementations is that <code>kadmin</code> has a different, but equivalent, set of commands and uses a different protocol. If the KDC is MIT, the Heimdal version of <code>kadmin</code> cannot be used to administer the KDC remotely, and vice versa.</p></div><div class=paragraph><p>Client applications may also use slightly different command line options to accomplish the same tasks. Following the instructions at <a href=http://web.mit.edu/Kerberos/www/>http://web.mit.edu/Kerberos/www/</a> is recommended. Be careful of path issues: the MIT port installs into <span class=filename>/usr/local/</span> by default, and the FreeBSD system applications run instead of the MIT versions if <code>PATH</code> lists the system directories first.</p></div><div class=paragraph><p>When using MIT Kerberos as a KDC on FreeBSD, the following edits should also be made to <span class=filename>rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>kerberos5_server=&#34;/usr/local/sbin/krb5kdc&#34;
kadmind5_server=&#34;/usr/local/sbin/kadmind&#34;
kerberos5_server_flags=&#34;&#34;
kerberos5_server_enable=&#34;YES&#34;
kadmind5_server_enable=&#34;YES&#34;</pre></div></div></div><div class=sect2><h3 id=_kerberos_提示技巧與疑難排解>13.5.5. Kerberos 提示、技巧與疑難排解<a class=anchor href=#_kerberos_提示技巧與疑難排解></a></h3><div class=paragraph><p>When configuring and troubleshooting Kerberos, keep the following points in mind:</p></div><div class=ulist><ul><li><p>When using either Heimdal or MITKerberos from ports, ensure that the <code>PATH</code> lists the port’s versions of the client applications before the system versions.</p></li><li><p>If all the computers in the realm do not have synchronized time settings, authentication may fail. <a href=../network-servers/#network-ntp>NTP 時間校對</a> describes how to synchronize clocks using NTP.</p></li><li><p>If the hostname is changed, the <code>host/</code> principal must be changed and the keytab updated. This also applies to special keytab entries like the <code>HTTP/</code> principal used for Apache’s <a class=package href=https://cgit.freebsd.org/ports/tree/www/mod_auth_kerb/>www/mod_auth_kerb</a>.</p></li><li><p>All hosts in the realm must be both forward and reverse resolvable in DNS or, at a minimum, exist in <span class=filename>/etc/hosts</span>. CNAMEs will work, but the A and PTR records must be correct and in place. The error message for unresolvable hosts is not intuitive: <code>Kerberos5 refuses authentication because Read req failed: Key table entry not found</code>.</p></li><li><p>Some operating systems that act as clients to the KDC do not set the permissions for <code>ksu</code> to be setuid <code>root</code>. This means that <code>ksu</code> does not work. This is a permissions problem, not a KDC error.</p></li><li><p>With MITKerberos, to allow a principal to have a ticket life longer than the default lifetime of ten hours, use <code>modify_principal</code> at the <a href="https://man.freebsd.org/cgi/man.cgi?query=kadmin&amp;sektion=8&amp;format=html">kadmin(8)</a> prompt to change the <code>maxlife</code> of both the principal in question and the <code>krbtgt</code> principal. The principal can then use <code>kinit -l</code> to request a ticket with a longer lifetime.</p></li><li><p>When running a packet sniffer on the KDC to aid in troubleshooting while running <code>kinit</code> from a workstation, the Ticket Granting Ticket (TGT) is sent immediately, even before the password is typed. This is because the Kerberos server freely transmits a TGT to any unauthorized request. However, every TGT is encrypted in a key derived from the user’s password. When a user types their password, it is not sent to the KDC, it is instead used to decrypt the TGT that <code>kinit</code> already obtained. If the decryption process results in a valid ticket with a valid time stamp, the user has valid Kerberos credentials. These credentials include a session key for establishing secure communications with the Kerberos server in the future, as well as the actual TGT, which is encrypted with the Kerberos server’s own key. This second layer of encryption allows the Kerberos server to verify the authenticity of each TGT.</p></li><li><p>Host principals can have a longer ticket lifetime. If the user principal has a lifetime of a week but the host being connected to has a lifetime of nine hours, the user cache will have an expired host principal and the ticket cache will not work as expected.</p></li><li><p>When setting up <span class=filename>krb5.dict</span> to prevent specific bad passwords from being used as described in <a href="https://man.freebsd.org/cgi/man.cgi?query=kadmind&amp;sektion=8&amp;format=html">kadmind(8)</a>, remember that it only applies to principals that have a password policy assigned to them. The format used in <span class=filename>krb5.dict</span> is one string per line. Creating a symbolic link to <span class=filename>/usr/shared/dict/words</span> might be useful.</p></li></ul></div></div><div class=sect2><h3 id=_減輕_kerberos_的限制>13.5.6. 減輕 Kerberos 的限制<a class=anchor href=#_減輕_kerberos_的限制></a></h3><div class=paragraph><p>Since Kerberos is an all or nothing approach, every service enabled on the network must either be modified to work with Kerberos or be otherwise secured against network attacks. This is to prevent user credentials from being stolen and re-used. An example is when Kerberos is enabled on all remote shells but the non-Kerberized POP3 mail server sends passwords in plain text.</p></div><div class=paragraph><p>The KDC is a single point of failure. By design, the KDC must be as secure as its master password database. The KDC should have absolutely no other services running on it and should be physically secure. The danger is high because Kerberos stores all passwords encrypted with the same master key which is stored as a file on the KDC.</p></div><div class=paragraph><p>A compromised master key is not quite as bad as one might fear. The master key is only used to encrypt the Kerberos database and as a seed for the random number generator. As long as access to the KDC is secure, an attacker cannot do much with the master key.</p></div><div class=paragraph><p>If the KDC is unavailable, network services are unusable as authentication cannot be performed. This can be alleviated with a single master KDC and one or more slaves, and with careful implementation of secondary or fall-back authentication using PAM.</p></div><div class=paragraph><p>Kerberos allows users, hosts and services to authenticate between themselves. It does not have a mechanism to authenticate the KDC to the users, hosts, or services. This means that a trojanned <code>kinit</code> could record all user names and passwords. File system integrity checking tools like <a class=package href=https://cgit.freebsd.org/ports/tree/security/tripwire/>security/tripwire</a> can alleviate this.</p></div></div><div class=sect2><h3 id=_相關資源與延伸資訊>13.5.7. 相關資源與延伸資訊<a class=anchor href=#_相關資源與延伸資訊></a></h3><div class=ulist><ul><li><p><a href=http://www.faqs.org/faqs/Kerberos-faq/general/preamble.html>The Kerberos FAQ</a></p></li><li><p><a href=http://web.mit.edu/Kerberos/www/dialogue.html>Designing an Authentication System: a Dialog in Four Scenes</a></p></li><li><p><a href=https://www.ietf.org/rfc/rfc4120.txt>RFC 4120, The Kerberos Network Authentication Service (V5)</a></p></li><li><p><a href=http://web.mit.edu/Kerberos/www/>MIT Kerberos home page</a></p></li><li><p><a href=https://www.h5l.org/>Heimdal Kerberos home page</a></p></li></ul></div></div></div></div><div class=sect1><h2 id=openssl>13.6. OpenSSL<a class=anchor href=#openssl></a></h2><div class=sectionbody><div class=paragraph><p>OpenSSL is an open source implementation of the SSL and TLS protocols. It provides an encryption transport layer on top of the normal communications layer, allowing it to be intertwined with many network applications and services.</p></div><div class=paragraph><p>The version of OpenSSL included in FreeBSD supports the Secure Sockets Layer 3.0 (SSLv3) and Transport Layer Security 1.0/1.1/1.2 (TLSv1/TLSv1.1/TLSv1.2) network security protocols and can be used as a general cryptographic library. In FreeBSD 12.0-RELEASE and above, OpenSSL also supports Transport Layer Security 1.3 (TLSv1.3).</p></div><div class=paragraph><p>OpenSSL is often used to encrypt authentication of mail clients and to secure web based transactions such as credit card payments. Some ports, such as <a class=package href=https://cgit.freebsd.org/ports/tree/www/apache24/>www/apache24</a> and <a class=package href=https://cgit.freebsd.org/ports/tree/databases/postgresql11-server/>databases/postgresql11-server</a>, include a compile option for building with OpenSSL. If selected, the port will add support using OpenSSL from the base system. To instead have the port compile against OpenSSL from the <a class=package href=https://cgit.freebsd.org/ports/tree/security/openssl/>security/openssl</a> port, add the following to <span class=filename>/etc/make.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>DEFAULT_VERSIONS+= ssl=openssl</pre></div></div><div class=paragraph><p>Another common use of OpenSSL is to provide certificates for use with software applications. Certificates can be used to verify the credentials of a company or individual. If a certificate has not been signed by an external <em>Certificate Authority</em> (CA), such as <a href=http://www.verisign.com>http://www.verisign.com</a>, the application that uses the certificate will produce a warning. There is a cost associated with obtaining a signed certificate and using a signed certificate is not mandatory as certificates can be self-signed. However, using an external authority will prevent warnings and can put users at ease.</p></div><div class=paragraph><p>This section demonstrates how to create and use certificates on a FreeBSD system. Refer to <a href=../network-servers/#ldap-config>設定 LDAP 伺服器</a> for an example of how to create a CA for signing one’s own certificates.</p></div><div class=paragraph><p>For more information about SSL, read the free <a href=https://www.feistyduck.com/books/openssl-cookbook/>OpenSSL Cookbook</a>.</p></div><div class=sect2><h3 id=_產生憑証>13.6.1. 產生憑証<a class=anchor href=#_產生憑証></a></h3><div class=paragraph><p>To generate a certificate that will be signed by an external CA, issue the following command and input the information requested at the prompts. This input information will be written to the certificate. At the <code>Common Name</code> prompt, input the fully qualified name for the system that will use the certificate. If this name does not match the server, the application verifying the certificate will issue a warning to the user, rendering the verification provided by the certificate as useless.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># openssl req -new -nodes -out req.pem -keyout cert.key -sha256 -newkey rsa:2048</span>
Generating a 2048 bit RSA private key
..................+++
.............................................................+++
writing new private key to <span class=s1>&#39;cert.key&#39;</span>
<span class=nt>-----</span>
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter <span class=s1>&#39;.&#39;</span>, the field will be left blank.
<span class=nt>-----</span>
Country Name <span class=o>(</span>2 letter code<span class=o>)</span> <span class=o>[</span>AU]:US
State or Province Name <span class=o>(</span>full name<span class=o>)</span> <span class=o>[</span>Some-State]:PA
Locality Name <span class=o>(</span>eg, city<span class=o>)</span> <span class=o>[]</span>:Pittsburgh
Organization Name <span class=o>(</span>eg, company<span class=o>)</span> <span class=o>[</span>Internet Widgits Pty Ltd]:My Company
Organizational Unit Name <span class=o>(</span>eg, section<span class=o>)</span> <span class=o>[]</span>:Systems Administrator
Common Name <span class=o>(</span>eg, YOUR name<span class=o>)</span> <span class=o>[]</span>:localhost.example.org
Email Address <span class=o>[]</span>:trhodes@FreeBSD.org

Please enter the following <span class=s1>&#39;extra&#39;</span> attributes
to be sent with your certificate request
A challenge password <span class=o>[]</span>:
An optional company name <span class=o>[]</span>:Another Name</code></pre></div></div><div class=paragraph><p>Other options, such as the expire time and alternate encryption algorithms, are available when creating a certificate. A complete list of options is described in <a href="https://man.freebsd.org/cgi/man.cgi?query=openssl&amp;sektion=1&amp;format=html">openssl(1)</a>.</p></div><div class=paragraph><p>This command will create two files in the current directory. The certificate request, <span class=filename>req.pem</span>, can be sent to a CA who will validate the entered credentials, sign the request, and return the signed certificate. The second file, <span class=filename>cert.key</span>, is the private key for the certificate and should be stored in a secure location. If this falls in the hands of others, it can be used to impersonate the user or the server.</p></div><div class=paragraph><p>Alternately, if a signature from a CA is not required, a self-signed certificate can be created. First, generate the RSA key:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># openssl genrsa -rand -genkey -out cert.key 2048</span>
0 semi-random bytes loaded
Generating RSA private key, 2048 bit long modulus
.............................................+++
.................................................................................................................+++
e is 65537 <span class=o>(</span>0x10001<span class=o>)</span></code></pre></div></div><div class=paragraph><p>Use this key to create a self-signed certificate. Follow the usual prompts for creating a certificate:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># openssl req -new -x509 -days 365 -key cert.key -out cert.crt -sha256</span>
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter <span class=s1>&#39;.&#39;</span>, the field will be left blank.
<span class=nt>-----</span>
Country Name <span class=o>(</span>2 letter code<span class=o>)</span> <span class=o>[</span>AU]:US
State or Province Name <span class=o>(</span>full name<span class=o>)</span> <span class=o>[</span>Some-State]:PA
Locality Name <span class=o>(</span>eg, city<span class=o>)</span> <span class=o>[]</span>:Pittsburgh
Organization Name <span class=o>(</span>eg, company<span class=o>)</span> <span class=o>[</span>Internet Widgits Pty Ltd]:My Company
Organizational Unit Name <span class=o>(</span>eg, section<span class=o>)</span> <span class=o>[]</span>:Systems Administrator
Common Name <span class=o>(</span>e.g. server FQDN or YOUR name<span class=o>)</span> <span class=o>[]</span>:localhost.example.org
Email Address <span class=o>[]</span>:trhodes@FreeBSD.org</code></pre></div></div><div class=paragraph><p>This will create two new files in the current directory: a private key file <span class=filename>cert.key</span>, and the certificate itself, <span class=filename>cert.crt</span>. These should be placed in a directory, preferably under <span class=filename>/etc/ssl/</span>, which is readable only by <code>root</code>. Permissions of <code>0700</code> are appropriate for these files and can be set using <code>chmod</code>.</p></div></div><div class=sect2><h3 id=_使用憑證>13.6.2. 使用憑證<a class=anchor href=#_使用憑證></a></h3><div class=paragraph><p>One use for a certificate is to encrypt connections to the Sendmail mail server in order to prevent the use of clear text authentication.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Some mail clients will display an error if the user has not installed a local copy of the certificate. Refer to the documentation included with the software for more information on certificate installation.</p></div></td></tr></tbody></table></div><div class=paragraph><p>In FreeBSD 10.0-RELEASE and above, it is possible to create a self-signed certificate for Sendmail automatically. To enable this, add the following lines to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>sendmail_enable=&#34;YES&#34;
sendmail_cert_create=&#34;YES&#34;
sendmail_cert_cn=&#34;localhost.example.org&#34;</pre></div></div><div class=paragraph><p>This will automatically create a self-signed certificate, <span class=filename>/etc/mail/certs/host.cert</span>, a signing key, <span class=filename>/etc/mail/certs/host.key</span>, and a CA certificate, <span class=filename>/etc/mail/certs/cacert.pem</span>. The certificate will use the <code>Common Name</code> specified in <code>sendmail_cert_cn</code>. After saving the edits, restart Sendmail:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service sendmail restart</span></code></pre></div></div><div class=paragraph><p>If all went well, there will be no error messages in <span class=filename>/var/log/maillog</span>. For a simple test, connect to the mail server’s listening port using <code>telnet</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># telnet example.com 25</span>
Trying 192.0.34.166...
Connected to example.com.
Escape character is <span class=s1>&#39;^]&#39;</span><span class=nb>.</span>
220 example.com ESMTP Sendmail 8.14.7/8.14.7<span class=p>;</span> Fri, 18 Apr 2014 11:50:32 <span class=nt>-0400</span> <span class=o>(</span>EDT<span class=o>)</span>
ehlo example.com
250-example.com Hello example.com <span class=o>[</span>192.0.34.166], pleased to meet you
250-ENHANCEDSTATUSCODES
250-PIPELINING
250-8BITMIME
250-SIZE
250-DSN
250-ETRN
250-AUTH LOGIN PLAIN
250-STARTTLS
250-DELIVERBY
250 HELP
quit
221 2.0.0 example.com closing connection
Connection closed by foreign host.</code></pre></div></div><div class=paragraph><p>If the <code>STARTTLS</code> line appears in the output, everything is working correctly.</p></div></div></div></div><div class=sect1><h2 id=ipsec>13.7. VPN over IPsec<a class=anchor href=#ipsec></a></h2><div class=sectionbody><div class=paragraph><p>Internet Protocol Security (IPsec) is a set of protocols which sit on top of the Internet Protocol (IP) layer. It allows two or more hosts to communicate in a secure manner by authenticating and encrypting each IP packet of a communication session. The FreeBSD IPsec network stack is based on the <a href=http://www.kame.net/>http://www.kame.net/</a> implementation and supports both IPv4 and IPv6 sessions.</p></div><div class=paragraph><p>IPsec is comprised of the following sub-protocols:</p></div><div class=ulist><ul><li><p><em>Encapsulated Security Payload (ESP)</em>: this protocol protects the IP packet data from third party interference by encrypting the contents using symmetric cryptography algorithms such as Blowfish and 3DES.</p></li><li><p><em>Authentication Header (AH)</em>: this protocol protects the IP packet header from third party interference and spoofing by computing a cryptographic checksum and hashing the IP packet header fields with a secure hashing function. This is then followed by an additional header that contains the hash, to allow the information in the packet to be authenticated.</p></li><li><p><em>IP Payload Compression Protocol (IPComp</em>): this protocol tries to increase communication performance by compressing the IP payload in order to reduce the amount of data sent.</p></li></ul></div><div class=paragraph><p>These protocols can either be used together or separately, depending on the environment.</p></div><div class=paragraph><p>IPsec supports two modes of operation. The first mode, <em>Transport Mode</em>, protects communications between two hosts. The second mode, <em>Tunnel Mode</em>, is used to build virtual tunnels, commonly known as Virtual Private Networks (VPNs). Consult <a href="https://man.freebsd.org/cgi/man.cgi?query=ipsec&amp;sektion=4&amp;format=html">ipsec(4)</a> for detailed information on the IPsec subsystem in FreeBSD.</p></div><div class=paragraph><p>在 FreeBSD 11 與之後的版本預設會開啟 IPsec 功能，先前版本的 FreeBSD 可在自訂核心設定檔中加入以下選項然後依 <a href=../kernelconfig/#kernelconfig>設定 FreeBSD 核心</a> 的指示來重新編譯核心：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>options   IPSEC        <span class=c>#IP security</span>
device    crypto</code></pre></div></div><div class=paragraph><p>If IPsec debugging support is desired, the following kernel option should also be added:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>options   IPSEC_DEBUG  debug <span class=k>for </span>IP security</code></pre></div></div><div class=paragraph><p>This rest of this chapter demonstrates the process of setting up an IPsecVPN between a home network and a corporate network. In the example scenario:</p></div><div class=ulist><ul><li><p>Both sites are connected to the Internet through a gateway that is running FreeBSD.</p></li><li><p>The gateway on each network has at least one external IP address. In this example, the corporate LAN’s external IP address is <code>172.16.5.4</code> and the home LAN’s external IP address is <code>192.168.1.12</code>.</p></li><li><p>The internal addresses of the two networks can be either public or private IP addresses. However, the address space must not collide. For example, both networks cannot use <code>192.168.1.x</code>. In this example, the corporate LAN’s internal IP address is <code>10.246.38.1</code> and the home LAN’s internal IP address is <code>10.0.0.5</code>.</p></li></ul></div><div class=sect2><h3 id=_在_freebsd_上設定_vpn>13.7.1. 在 FreeBSD 上設定 VPN<a class=anchor href=#_在_freebsd_上設定_vpn></a></h3><div class=paragraph><p>To begin, <a class=package href=https://cgit.freebsd.org/ports/tree/security/ipsec-tools/>security/ipsec-tools</a> must be installed from the Ports Collection. This software provides a number of applications which support the configuration.</p></div><div class=paragraph><p>The next requirement is to create two <a href="https://man.freebsd.org/cgi/man.cgi?query=gif&amp;sektion=4&amp;format=html">gif(4)</a> pseudo-devices which will be used to tunnel packets and allow both networks to communicate properly. As <code>root</code>, run the following commands, replacing <em>internal</em> and <em>external</em> with the real IP addresses of the internal and external interfaces of the two gateways:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig gif0 create</span>
<span class=c># ifconfig gif0 internal1 internal2</span>
<span class=c># ifconfig gif0 tunnel external1 external2</span></code></pre></div></div><div class=paragraph><p>Verify the setup on each gateway, using <code>ifconfig</code>. Here is the output from Gateway 1:</p></div><div class="literalblock programlisting"><div class=content><pre>gif0: flags=8051 mtu 1280
tunnel inet 172.16.5.4 --&gt; 192.168.1.12
inet6 fe80::2e0:81ff:fe02:5881%gif0 prefixlen 64 scopeid 0x6
inet 10.246.38.1 --&gt; 10.0.0.5 netmask 0xffffff00</pre></div></div><div class=paragraph><p>Here is the output from Gateway 2:</p></div><div class="literalblock programlisting"><div class=content><pre>gif0: flags=8051 mtu 1280
tunnel inet 192.168.1.12 --&gt; 172.16.5.4
inet 10.0.0.5 --&gt; 10.246.38.1 netmask 0xffffff00
inet6 fe80::250:bfff:fe3a:c1f%gif0 prefixlen 64 scopeid 0x4</pre></div></div><div class=paragraph><p>Once complete, both internal IP addresses should be reachable using <a href="https://man.freebsd.org/cgi/man.cgi?query=ping&amp;sektion=8&amp;format=html">ping(8)</a>:</p></div><div class="literalblock programlisting"><div class=content><pre>priv-net# ping 10.0.0.5
PING 10.0.0.5 (10.0.0.5): 56 data bytes
64 bytes from 10.0.0.5: icmp_seq=0 ttl=64 time=42.786 ms
64 bytes from 10.0.0.5: icmp_seq=1 ttl=64 time=19.255 ms
64 bytes from 10.0.0.5: icmp_seq=2 ttl=64 time=20.440 ms
64 bytes from 10.0.0.5: icmp_seq=3 ttl=64 time=21.036 ms
--- 10.0.0.5 ping statistics ---
4 packets transmitted, 4 packets received, 0% packet loss
round-trip min/avg/max/stddev = 19.255/25.879/42.786/9.782 ms

corp-net# ping 10.246.38.1
PING 10.246.38.1 (10.246.38.1): 56 data bytes
64 bytes from 10.246.38.1: icmp_seq=0 ttl=64 time=28.106 ms
64 bytes from 10.246.38.1: icmp_seq=1 ttl=64 time=42.917 ms
64 bytes from 10.246.38.1: icmp_seq=2 ttl=64 time=127.525 ms
64 bytes from 10.246.38.1: icmp_seq=3 ttl=64 time=119.896 ms
64 bytes from 10.246.38.1: icmp_seq=4 ttl=64 time=154.524 ms
--- 10.246.38.1 ping statistics ---
5 packets transmitted, 5 packets received, 0% packet loss
round-trip min/avg/max/stddev = 28.106/94.594/154.524/49.814 ms</pre></div></div><div class=paragraph><p>As expected, both sides have the ability to send and receive ICMP packets from the privately configured addresses. Next, both gateways must be told how to route packets in order to correctly send traffic from either network. The following commands will achieve this goal:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>corp-net# route add 10.0.0.0 10.0.0.5 255.255.255.0
corp-net# route add net 10.0.0.0: gateway 10.0.0.5
priv-net# route add 10.246.38.0 10.246.38.1 255.255.255.0
priv-net# route add host 10.246.38.0: gateway 10.246.38.1</code></pre></div></div><div class=paragraph><p>At this point, internal machines should be reachable from each gateway as well as from machines behind the gateways. Again, use <a href="https://man.freebsd.org/cgi/man.cgi?query=ping&amp;sektion=8&amp;format=html">ping(8)</a> to confirm:</p></div><div class="literalblock programlisting"><div class=content><pre>corp-net# ping 10.0.0.8
PING 10.0.0.8 (10.0.0.8): 56 data bytes
64 bytes from 10.0.0.8: icmp_seq=0 ttl=63 time=92.391 ms
64 bytes from 10.0.0.8: icmp_seq=1 ttl=63 time=21.870 ms
64 bytes from 10.0.0.8: icmp_seq=2 ttl=63 time=198.022 ms
64 bytes from 10.0.0.8: icmp_seq=3 ttl=63 time=22.241 ms
64 bytes from 10.0.0.8: icmp_seq=4 ttl=63 time=174.705 ms
--- 10.0.0.8 ping statistics ---
5 packets transmitted, 5 packets received, 0% packet loss
round-trip min/avg/max/stddev = 21.870/101.846/198.022/74.001 ms

priv-net# ping 10.246.38.107
PING 10.246.38.1 (10.246.38.107): 56 data bytes
64 bytes from 10.246.38.107: icmp_seq=0 ttl=64 time=53.491 ms
64 bytes from 10.246.38.107: icmp_seq=1 ttl=64 time=23.395 ms
64 bytes from 10.246.38.107: icmp_seq=2 ttl=64 time=23.865 ms
64 bytes from 10.246.38.107: icmp_seq=3 ttl=64 time=21.145 ms
64 bytes from 10.246.38.107: icmp_seq=4 ttl=64 time=36.708 ms
--- 10.246.38.107 ping statistics ---
5 packets transmitted, 5 packets received, 0% packet loss
round-trip min/avg/max/stddev = 21.145/31.721/53.491/12.179 ms</pre></div></div><div class=paragraph><p>Setting up the tunnels is the easy part. Configuring a secure link is a more in depth process. The following configuration uses pre-shared (PSK) RSA keys. Other than the IP addresses, the <span class=filename>/usr/local/etc/racoon/racoon.conf</span> on both gateways will be identical and look similar to:</p></div><div class="literalblock programlisting"><div class=content><pre>path    pre_shared_key  &#34;/usr/local/etc/racoon/psk.txt&#34;; #location of pre-shared key file
log     debug;	#log verbosity setting: set to &#39;notify&#39; when testing and debugging is complete

padding	# options are not to be changed
{
        maximum_length  20;
        randomize       off;
        strict_check    off;
        exclusive_tail  off;
}

timer	# timing options. change as needed
{
        counter         5;
        interval        20 sec;
        persend         1;
#       natt_keepalive  15 sec;
        phase1          30 sec;
        phase2          15 sec;
}

listen	# address [port] that racoon will listen on
{
        isakmp          172.16.5.4 [500];
        isakmp_natt     172.16.5.4 [4500];
}

remote  192.168.1.12 [500]
{
        exchange_mode   main,aggressive;
        doi             ipsec_doi;
        situation       identity_only;
        my_identifier   address 172.16.5.4;
        peers_identifier        address 192.168.1.12;
        lifetime        time 8 hour;
        passive         off;
        proposal_check  obey;
#       nat_traversal   off;
        generate_policy off;

                        proposal {
                                encryption_algorithm    blowfish;
                                hash_algorithm          md5;
                                authentication_method   pre_shared_key;
                                lifetime time           30 sec;
                                dh_group                1;
                        }
}

sainfo  (address 10.246.38.0/24 any address 10.0.0.0/24 any)	# address $network/$netmask $type address $network/$netmask $type ( $type being any or esp)
{								# $network must be the two internal networks you are joining.
        pfs_group       1;
        lifetime        time    36000 sec;
        encryption_algorithm    blowfish,3des;
        authentication_algorithm        hmac_md5,hmac_sha1;
        compression_algorithm   deflate;
}</pre></div></div><div class=paragraph><p>For descriptions of each available option, refer to the manual page for <span class=filename>racoon.conf</span>.</p></div><div class=paragraph><p>The Security Policy Database (SPD) needs to be configured so that FreeBSD and racoon are able to encrypt and decrypt network traffic between the hosts.</p></div><div class=paragraph><p>This can be achieved with a shell script, similar to the following, on the corporate gateway. This file will be used during system initialization and should be saved as <span class=filename>/usr/local/etc/racoon/setkey.conf</span>.</p></div><div class="literalblock programlisting"><div class=content><pre>flush;
spdflush;
# To the home network
spdadd 10.246.38.0/24 10.0.0.0/24 any -P out ipsec esp/tunnel/172.16.5.4-192.168.1.12/use;
spdadd 10.0.0.0/24 10.246.38.0/24 any -P in ipsec esp/tunnel/192.168.1.12-172.16.5.4/use;</pre></div></div><div class=paragraph><p>Once in place, racoon may be started on both gateways using the following command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># /usr/local/sbin/racoon -F -f /usr/local/etc/racoon/racoon.conf -l /var/log/racoon.log</span></code></pre></div></div><div class=paragraph><p>The output should be similar to the following:</p></div><div class="literalblock programlisting"><div class=content><pre>corp-net# /usr/local/sbin/racoon -F -f /usr/local/etc/racoon/racoon.conf
Foreground mode.
2006-01-30 01:35:47: INFO: begin Identity Protection mode.
2006-01-30 01:35:48: INFO: received Vendor ID: KAME/racoon
2006-01-30 01:35:55: INFO: received Vendor ID: KAME/racoon
2006-01-30 01:36:04: INFO: ISAKMP-SA established 172.16.5.4[500]-192.168.1.12[500] spi:623b9b3bd2492452:7deab82d54ff704a
2006-01-30 01:36:05: INFO: initiate new phase 2 negotiation: 172.16.5.4[0]192.168.1.12[0]
2006-01-30 01:36:09: INFO: IPsec-SA established: ESP/Tunnel 192.168.1.12[0]-&gt;172.16.5.4[0] spi=28496098(0x1b2d0e2)
2006-01-30 01:36:09: INFO: IPsec-SA established: ESP/Tunnel 172.16.5.4[0]-&gt;192.168.1.12[0] spi=47784998(0x2d92426)
2006-01-30 01:36:13: INFO: respond new phase 2 negotiation: 172.16.5.4[0]192.168.1.12[0]
2006-01-30 01:36:18: INFO: IPsec-SA established: ESP/Tunnel 192.168.1.12[0]-&gt;172.16.5.4[0] spi=124397467(0x76a279b)
2006-01-30 01:36:18: INFO: IPsec-SA established: ESP/Tunnel 172.16.5.4[0]-&gt;192.168.1.12[0] spi=175852902(0xa7b4d66)</pre></div></div><div class=paragraph><p>To ensure the tunnel is working properly, switch to another console and use <a href="https://man.freebsd.org/cgi/man.cgi?query=tcpdump&amp;sektion=1&amp;format=html">tcpdump(1)</a> to view network traffic using the following command. Replace <code>em0</code> with the network interface card as required:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># tcpdump -i em0 host 172.16.5.4 and dst 192.168.1.12</span></code></pre></div></div><div class=paragraph><p>Data similar to the following should appear on the console. If not, there is an issue and debugging the returned data will be required.</p></div><div class="literalblock programlisting"><div class=content><pre>01:47:32.021683 IP corporatenetwork.com &gt; 192.168.1.12.privatenetwork.com: ESP(spi=0x02acbf9f,seq=0xa)
01:47:33.022442 IP corporatenetwork.com &gt; 192.168.1.12.privatenetwork.com: ESP(spi=0x02acbf9f,seq=0xb)
01:47:34.024218 IP corporatenetwork.com &gt; 192.168.1.12.privatenetwork.com: ESP(spi=0x02acbf9f,seq=0xc)</pre></div></div><div class=paragraph><p>At this point, both networks should be available and seem to be part of the same network. Most likely both networks are protected by a firewall. To allow traffic to flow between them, rules need to be added to pass packets. For the <a href="https://man.freebsd.org/cgi/man.cgi?query=ipfw&amp;sektion=8&amp;format=html">ipfw(8)</a> firewall, add the following lines to the firewall configuration file:</p></div><div class="literalblock programlisting"><div class=content><pre>ipfw add 00201 allow log esp from any to any
ipfw add 00202 allow log ah from any to any
ipfw add 00203 allow log ipencap from any to any
ipfw add 00204 allow log udp from any 500 to any</pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>The rule numbers may need to be altered depending on the current host configuration.</p></div></td></tr></tbody></table></div><div class=paragraph><p>For users of <a href="https://man.freebsd.org/cgi/man.cgi?query=pf&amp;sektion=4&amp;format=html">pf(4)</a> or <a href="https://man.freebsd.org/cgi/man.cgi?query=ipf&amp;sektion=8&amp;format=html">ipf(8)</a>, the following rules should do the trick:</p></div><div class="literalblock programlisting"><div class=content><pre>pass in quick proto esp from any to any
pass in quick proto ah from any to any
pass in quick proto ipencap from any to any
pass in quick proto udp from any port = 500 to any port = 500
pass in quick on gif0 from any to any
pass out quick proto esp from any to any
pass out quick proto ah from any to any
pass out quick proto ipencap from any to any
pass out quick proto udp from any port = 500 to any port = 500
pass out quick on gif0 from any to any</pre></div></div><div class=paragraph><p>Finally, to allow the machine to start support for the VPN during system initialization, add the following lines to <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>ipsec_enable=&#34;YES&#34;
ipsec_program=&#34;/usr/local/sbin/setkey&#34;
ipsec_file=&#34;/usr/local/etc/racoon/setkey.conf&#34; # allows setting up spd policies on boot
racoon_enable=&#34;yes&#34;</pre></div></div></div></div></div><div class=sect1><h2 id=openssh>13.8. OpenSSH<a class=anchor href=#openssh></a></h2><div class=sectionbody><div class=paragraph><p>OpenSSH 是一套網路連線工具，可安全的存取遠端的主機，此外，透過 SSH 連線可以建立 TCP/IP 連線通道或安全的轉送 TCP/IP 的封包。OpenSSH 會對所有傳輸的資料做加密，可有效的避免竊聽 (Eavesdropping)、或連線劫持 (Connection hijacking) 與其他網路層的攻擊。</p></div><div class=paragraph><p>OpenSSH 由 OpenBSD 專案所維護且在 FreeBSD 預設會安裝，它可同時相容 SSH 版本 1 與 2 通訊協定。</p></div><div class=paragraph><p>當以未加密的方式在網路上傳送資料時，任何在客戶端與伺服器之間的網路竊聽程式 (Network sniffer) 皆可竊取使用者/密碼資訊或者在連線階段傳送的資料，OpenSSH 提供了數種認証與加密方式來避免這種事情發生。更多有關 OpenSSH 的資訊可於 <a href=http://www.openssh.com/>http://www.openssh.com/</a> 取得。</p></div><div class=paragraph><p>本節會簡單介紹如何使用內建的客戶端工具安全的存取其他系統及安全的傳輸檔案到 FreeBSD 系統，然後會說明如何設定在 FreeBSD 系統上的 SSH 伺服器。更多的資訊可於本章節所提及的操作手冊 (Man page) 取得。</p></div><div class=sect2><h3 id=_使用_ssh_客戶端工具>13.8.1. 使用 SSH 客戶端工具<a class=anchor href=#_使用_ssh_客戶端工具></a></h3><div class=paragraph><p>要登入一台 SSH 伺服器，可使用 <code>ssh</code> 然後指定在伺服器上存在的使用者名稱與 IP 位址或伺服器的主機名稱。若這是第一次連線到指定的伺服器，會提示該使用者伺服器的指紋做第一次檢驗：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ssh user@example.com</span>
The authenticity of host <span class=s1>&#39;example.com (10.0.0.1)&#39;</span> can<span class=s1>&#39;t be established.
ECDSA key fingerprint is 25:cc:73:b5:b3:96:75:3d:56:19:49:d2:5c:1f:91:3b.
Are you sure you want to continue connecting (yes/no)? yes
Permanently added &#39;</span>example.com<span class=s1>&#39; (ECDSA) to the list of known hosts.
Password for user@example.com: user_password</span></code></pre></div></div><div class=paragraph><p>SSH 會在客戶端連線時利用金鑰指紋 (Key fingerprint) 系統來驗證伺服器的真偽，當使用者在第一次連線時輸入 <code>yes</code> 接受了這個金鑰指紋，便會將該金鑰的複本儲存到使用者家目錄的 <span class=filename>.ssh/known_hosts</span>，未來嘗試登入時便會以這個存好的金鑰來驗證，若伺服器的金鑰與儲存的金鑰不同將會顯示警告訊息。若出現這個警告時，使用者應在繼續連線之前檢查金鑰變動的原因。</p></div><div class=paragraph><p>最近版本的 OpenSSH 預設只會接受 SSHv2 的連線。客戶端預設會盡可能使用版本 2 的通訊協定，若伺服器不支援版本 2 的通訊協定便會向下相容版本 1 的協定。要強制 <code>ssh</code> 只能使用指定的通訊協定，可使用 <code>-1</code> 或 <code>-2</code>，其他的選項在 <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;format=html">ssh(1)</a> 中有說明。</p></div><div class=paragraph><p>使用 <a href="https://man.freebsd.org/cgi/man.cgi?query=scp&amp;sektion=1&amp;format=html">scp(1)</a> 可從遠端主機安全的複製一個檔案，以下範例會複製在遠端主機的 <span class=filename>COPYRIGHT</span> 到本地主機的目前目錄：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># scp user@example.com:/COPYRIGHT COPYRIGHT</span>
Password <span class=k>for </span>user@example.com: <span class=k>*******</span>
COPYRIGHT            100% |<span class=k>*****************************</span>|  4735
00:00
<span class=c>#</span></code></pre></div></div><div class=paragraph><p>由於這個主機的指紋已驗證過，在提示用者輸入密碼之前伺服器的金鑰已自動檢查。</p></div><div class=paragraph><p>傳給 <code>scp</code> 的參數與傳給 <code>cp</code> 的參數相似。第一個參數是要複製的檔案，第二個參數是目地，由於檔案是透過網路取得，檔案參數需要使用 <code>user@host:&lt;path_to_remote_file></code> 格式。注意，在 <code>scp</code> 要遞迴複製目錄是使用 <code>-r</code>，如同 <code>cp</code> 使用 <code>-R</code>。</p></div><div class=paragraph><p>要開啟可互動的連線來複製檔案可使用 <code>sftp</code>，請參考 <a href="https://man.freebsd.org/cgi/man.cgi?query=sftp&amp;sektion=1&amp;format=html">sftp(1)</a> 來取得在 <code>sftp</code> 連線時可用的指令清單。</p></div><div class=sect3><h4 id=security-ssh-keygen>13.8.1.1. 以金鑰為基礎的認證<a class=anchor href=#security-ssh-keygen></a></h4><div class=paragraph><p>除了使用密碼之外，客戶端可以設定成使用金鑰來連線到遠端的主機。要產生 RSA 認証金鑰可使用 <code>ssh-keygen</code>。要產生成對的公鑰與私鑰，可指定金鑰的類型並依提示操作。建議使用容易記住但較難猜出的密碼來保護這個金鑰。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% ssh-keygen <span class=nt>-t</span> rsa
Generating public/private rsa key pair.
Enter file <span class=k>in </span>which to save the key <span class=o>(</span>/home/user/.ssh/id_rsa<span class=o>)</span>:
Enter passphrase <span class=o>(</span>empty <span class=k>for </span>no passphrase<span class=o>)</span>:  <i class=conum data-value=1></i><b>(1)</b>
Enter same passphrase again:                 <i class=conum data-value=2></i><b>(2)</b>
Your identification has been saved <span class=k>in</span> /home/user/.ssh/id_rsa.
Your public key has been saved <span class=k>in</span> /home/user/.ssh/id_rsa.pub.
The key fingerprint is:
SHA256:54Xm9Uvtv6H4NOo6yjP/YCfODryvUU7yWHzMqeXwhq8 user@host.example.com
The key<span class=s1>&#39;s randomart image is:
+---[RSA 2048]----+
|                 |
|                 |
|                 |
|        . o..    |
|       .S*+*o    |
|      . O=Oo . . |
|       = Oo= oo..|
|      .oB.* +.oo.|
|       =OE**.o..=|
+----[SHA256]-----+</span></code></pre></div></div><div class="colist arabic"><table><tbody><tr><td><i class=conum data-value=1></i><b>1</b></td><td>在此輸入密碼，密碼不可含有空白或符號。</td></tr><tr><td><i class=conum data-value=2></i><b>2</b></td><td>再輸入一次密碼驗證。</td></tr></tbody></table></div><div class=paragraph><p>私鑰會儲存於 <span class=filename>~/.ssh/id_rsa</span> 而公鑰會儲存於 <span class=filename>~/.ssh/id_rsa.pub</span>。<em>公鑰</em>必須複製到遠端主機的<span class=filename>~/.ssh/authorized_keys</span> 來讓以金鑰為基礎的認証可以運作。</p></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>許多使用者認為金鑰的設計是安全的並在產生金鑰時未使用密碼，這樣的行為其實很<em>危險</em>。管理者可以手動查看私鑰來檢查金鑰對是否受密碼保護，如果私鑰檔案中包含 <code>ENCRYPTED</code> 字詞，則代表金鑰的擁有者有使用密碼。此外，要更進一步保護最終使用者的安全，可在公鑰檔案中放入 <code>from</code>，例如，在 <code>ssh-rsa</code> 前加上 <code>from="192.168.10.5"</code> 將只允許指定的使用者由該 IP 位址登入。</p></div></td></tr></tbody></table></div><div class=paragraph><p>不同版本 OpenSSH 的選項與檔案會不同，要避免發生問題請參考 <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh-keygen&amp;sektion=1&amp;format=html">ssh-keygen(1)</a>。</p></div><div class=paragraph><p>若使用了密碼，在每次連線到伺服器時都會提示使用者輸入密碼。要將 SSH 金鑰載入到記憶體並讓每次連線時不必再輸入密碼，可使用 <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh-agent&amp;sektion=1&amp;format=html">ssh-agent(1)</a> 與 <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh-add&amp;sektion=1&amp;format=html">ssh-add(1)</a>。</p></div><div class=paragraph><p>認証可用 <code>ssh-agent</code> 來管理，只要將私鑰載入，<code>ssh-agent</code> 可用在執行其他應用程式，如 Shell 或視窗管理程式。</p></div><div class=paragraph><p>要在 Shell 使用 <code>ssh-agent</code>，使用 Shell 做為參數來啟動 <code>ssh-agent</code>。執行 <code>ssh-add</code> 來加入識別碼，然後輸入私鑰的密碼。使用者將可使用 <code>ssh</code> 連線到任何有安裝對應公鑰的主機，例如：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% ssh-agent csh
% ssh-add
Enter passphrase <span class=k>for </span>key <span class=s1>&#39;/usr/home/user/.ssh/id_rsa&#39;</span>:  <i class=conum data-value=1></i><b>(1)</b>
Identity added: /usr/home/user/.ssh/id_rsa <span class=o>(</span>/usr/home/user/.ssh/id_rsa<span class=o>)</span>
%</code></pre></div></div><div class="colist arabic"><table><tbody><tr><td><i class=conum data-value=1></i><b>1</b></td><td>輸入金鑰的密碼。</td></tr></tbody></table></div><div class=paragraph><p>要在 Xorg 使用 <code>ssh-agent</code> 可在 <span class=filename>~/.xinitrc</span> 加入一個設定項目，這可讓 <code>ssh-agent</code> 對所有在 Xorg 中執行的程式提供服務。<span class=filename>~/.xinitrc</span> 範例如下：</p></div><div class="literalblock programlisting"><div class=content><pre>exec ssh-agent startxfce4</pre></div></div><div class=paragraph><p>這會在每次啟動 Xorg 時，反過來先執行 <code>ssh-agent</code> 再由執行 XFCE，一但 Xorg 被重新啟動，要讓所有變更生效需執行 <code>ssh-add</code> 來載入所有的 SSH 金鑰。</p></div></div><div class=sect3><h4 id=security-ssh-tunneling>13.8.1.2. SSH 通道<a class=anchor href=#security-ssh-tunneling></a></h4><div class=paragraph><p>OpenSSH 可以建立一個通道 (Tunnel) 來封裝其他通訊協定到一個加密的連線。</p></div><div class=paragraph><p>以下指令會告訴 <code>ssh</code> 建立一個供 telnet 使用的通道：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% ssh <span class=nt>-2</span> <span class=nt>-N</span> <span class=nt>-f</span> <span class=nt>-L</span> 5023:localhost:23 user@foo.example.com
%</code></pre></div></div><div class=paragraph><p>這個例子使用了以下選項：</p></div><div class=dlist><dl><dt class=hdlist1><code>-2</code></dt><dd><p>強制 <code>ssh</code> 使用版本 2 的通訊協定連線到伺服器。</p></dd><dt class=hdlist1><code>-N</code></dt><dd><p>代表不需下指令、只建立通道。若省略這個選項 <code>ssh</code> 會初始化一個正常的連線。</p></dd><dt class=hdlist1><code>-f</code></dt><dd><p>強制 <code>ssh</code> 在背景執行。</p></dd><dt class=hdlist1><code>-L</code></dt><dd><p>代表這是一個本地通道，使用 <em>localport:remotehost:remoteport</em> 格式。</p></dd><dt class=hdlist1><code>user@foo.example.com</code></dt><dd><p>在指定的遠端 SSH 伺服器要使用的登入名稱。</p></dd></dl></div><div class=paragraph><p>SSH 通道會建立一個傾聽 <code>localhost</code> 指定 <code>localport</code> 的 Socket ，然後會透過 SSH 連線轉送任何在 <code>localport</code> 接收的連線。以這個例子來說在客戶端的 Port <code>5023</code> 會被轉送到遠端主機的 Port <code>23</code>，由於 Port 23 是由 telnet 使用，所以這會透過 SSH 通道建立一個加密的 telnet 連線。</p></div><div class=paragraph><p>這個方法可用來包裝許多不安全的 TCP 通訊協定，例如 SMTP, POP3 以及 FTP，如下例所示。</p></div><div class=exampleblock><div class=title>例 1. 建立供 SMTP 使用的安全通道</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% ssh <span class=nt>-2</span> <span class=nt>-N</span> <span class=nt>-f</span> <span class=nt>-L</span> 5025:localhost:25 user@mailserver.example.com
user@mailserver.example.com<span class=s1>&#39;s password: *****
% telnet localhost 5025
Trying 127.0.0.1...
Connected to localhost.
Escape character is &#39;</span>^]<span class=s1>&#39;.
220 mailserver.example.com ESMTP</span></code></pre></div></div><div class=paragraph><p>這可配合 <code>ssh-keygen</code> 與另一個使用者帳號與來建立一個更無縫的 SSH 通道環境，可使用金鑰來代替手動輸入密碼，然後該通道便可以另一個使用者執行。</p></div></div></div><div class=exampleblock><div class=title>例 2. 安全存取 POP3 伺服器</div><div class=content><div class=paragraph><p>在這個例子中有一個 SSH 伺服器會接受來自外部的連線，在同個網段下有一個郵件伺服器執行 POP3 伺服器。要使用較安全的方式檢查有沒有新郵件可建立一個 SSH 連線到 SSH 伺服器然後透過通道連線到郵件伺服器：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% ssh <span class=nt>-2</span> <span class=nt>-N</span> <span class=nt>-f</span> <span class=nt>-L</span> 2110:mail.example.com:110 user@ssh-server.example.com
user@ssh-server.example.com<span class=s1>&#39;s password: ******</span></code></pre></div></div><div class=paragraph><p>一但通道啟動並執行後，指定郵件客戶端將 POP3 請求傳送到 <code>localhost</code> 的 Port 2110，這個連線將會被安全的透過通道轉送到 <code>mail.example.com</code>。</p></div></div></div><div class=exampleblock><div class=title>例 3. 跳過防火牆</div><div class=content><div class=paragraph><p>有些防火牆會同時過濾傳入與傳出的連線。例如，防火牆很可能會限制來自遠端主機只能存取 Port 22 與 80 來只讓 SSH 與網頁瀏覽器連線，這會使得 Port 使用 22 或 80 以外的服務無法存取。</p></div><div class=paragraph><p>這問題的解決方法是建立一個 SSH 連線到在防火牆防護之外主機然後使用該連線的通道連到想要使用的服務：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% ssh <span class=nt>-2</span> <span class=nt>-N</span> <span class=nt>-f</span> <span class=nt>-L</span> 8888:music.example.com:8000 user@unfirewalled-system.example.org
user@unfirewalled-system.example.org<span class=s1>&#39;s password: *******</span></code></pre></div></div><div class=paragraph><p>在這個例子中，串流 Ogg Vorbis 客戶端現在可以指向 <code>localhost</code> Port 8888，連線將會被轉送到 <code>music.example.com</code> 於 Port 8000，成功的跳過防火牆。</p></div></div></div></div></div><div class=sect2><h3 id=_開啟_ssh_伺服器>13.8.2. 開啟 SSH 伺服器<a class=anchor href=#_開啟_ssh_伺服器></a></h3><div class=paragraph><p>除了提供內建的 SSH 客戶端工具外，還可以設定 FreeBSD 系統為一個 SSH 伺服器，以接受來自其他 SSH 客戶端的連線。</p></div><div class=paragraph><p>要查看 sshd 是否正在運作，可使用 <a href="https://man.freebsd.org/cgi/man.cgi?query=service&amp;sektion=8&amp;format=html">service(8)</a> 指令：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service sshd status</span></code></pre></div></div><div class=paragraph><p>若服務未執行，請加入下行到 <span class=filename>/etc/rc.conf</span>。</p></div><div class="literalblock programlisting"><div class=content><pre>sshd_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>這會讓下次系統開機時啟動 OpenSSH 的 Daemon 程式 sshd。若要立即啟動：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service sshd start</span></code></pre></div></div><div class=paragraph><p>在 FreeBSD 系統第一次啟動 sshd 時便會自動產生系統的主機金鑰且會顯示指紋在 Console 上，這個指紋可供使用者在第一次連線到伺服器時驗證用。</p></div><div class=paragraph><p>請參考 <a href="https://man.freebsd.org/cgi/man.cgi?query=sshd&amp;sektion=8&amp;format=html">sshd(8)</a> 可取得在啟動 sshd 時可用選項的清單以及更多完整有關認証、登入程序與各種設定檔的資訊。</p></div><div class=paragraph><p>現在，sshd 應可供所有在系統上有使用者名稱及密碼的使用者使用。</p></div></div><div class=sect2><h3 id=_ssh_伺服器安全性>13.8.3. SSH 伺服器安全性<a class=anchor href=#_ssh_伺服器安全性></a></h3><div class=paragraph><p>在 FreeBSD 廣泛使用 sshd 做為遠端管理基礎設施的同時，所有暴露在公有網路上的系統也會時常受到暴力攻擊 (Brute force attack) 與路過攻擊 (Drive by attack)。在本節會介紹一些可用來避免這些攻擊的參數。</p></div><div class=paragraph><p>使用在 OpenSSH 伺服器設定檔的 <code>AllowUsers</code> 關鍵字限制可以登入到 SSH 伺服器的使用者及來源是一個不錯的方式。例如要只允許來自 <code>192.168.1.32</code> 的 <code>root</code> 登入，可加入下行到 <span class=filename>/etc/ssh/sshd_config</span>：</p></div><div class="literalblock programlisting"><div class=content><pre>AllowUsers root@192.168.1.32</pre></div></div><div class=paragraph><p>要允許來自任何地方的 <code>admin</code> 登入，可只列出使用者名稱，不指定 IP 位址：</p></div><div class="literalblock programlisting"><div class=content><pre>AllowUsers admin</pre></div></div><div class=paragraph><p>有多位使用者也應列在同一行，例如：</p></div><div class="literalblock programlisting"><div class=content><pre>AllowUsers root@192.168.1.32 admin</pre></div></div><div class=paragraph><p>在對 <span class=filename>/etc/ssh/sshd_config</span> 做完變更後，執行以下指令告訴 sshd 重新載入設定檔：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service sshd reload</span></code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>在使用了這個關鍵字時，列出每一位需要登入此主機的使用者很重要，任何未被在該行指定的使用者將無法登入。同時，在 OpenSSH 伺服器設定檔使用的關鍵字是區分大小寫的，若關鍵字未正確的拼寫 (含其大小寫)，則將會被忽略，永遠要記得測試對這個檔案所做的更改來確保伺服器有如預期的方式運作。請參考 <a href="https://man.freebsd.org/cgi/man.cgi?query=sshd_config&amp;sektion=5&amp;format=html">sshd_config(5)</a> 來檢查拼寫以及可用的關鍵字。</p></div></td></tr></tbody></table></div><div class=paragraph><p>此外，使用者可能被強制要透過公鑰與私鑰使用雙重認證 (Two factor authentication)。當需要時，使用者可以透過使用 <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh-keygen&amp;sektion=1&amp;format=html">ssh-keygen(1)</a> 產生一堆金鑰然後將公鑰傳送給管理者，這個金鑰檔會如以上在客戶端章節所述的被放在 <span class=filename>authorized_keys</span>。要強制使用者只能使用這個金鑰，可能需要設定以下選項：</p></div><div class="literalblock programlisting"><div class=content><pre>AuthenticationMethods publickey</pre></div></div><div class="admonitionblock tip"><table><tbody><tr><td class=icon><i class="fa icon-tip" title=Tip></i></td><td class=content><div class=paragraph><p>請不要將 <span class=filename>/etc/ssh/sshd_config</span> 以及 <span class=filename>/etc/ssh/ssh_config</span> 搞混 (注意在第一節檔名有多出個 <code>d</code>)，第一個檔案用來設定伺服器，而第二個檔案用來設定客戶端。請參考 <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh_config&amp;sektion=5&amp;format=html">ssh_config(5)</a> 來取得可用的客戶端設定清單。</p></div></td></tr></tbody></table></div></div></div></div><div class=sect1><h2 id=fs-acl>13.9. 存取控制清單<a class=anchor href=#fs-acl></a></h2><div class=sectionbody><div class=paragraph><p>Access Control Lists (ACLs) extend the standard UNIX™ permission model in a POSIX™.1e compatible way. This permits an administrator to take advantage of a more fine-grained permissions model.</p></div><div class=paragraph><p>The FreeBSD <span class=filename>GENERIC</span> kernel provides ACL support for UFS file systems. Users who prefer to compile a custom kernel must include the following option in their custom kernel configuration file:</p></div><div class="literalblock programlisting"><div class=content><pre>options UFS_ACL</pre></div></div><div class=paragraph><p>If this option is not compiled in, a warning message will be displayed when attempting to mount a file system with ACL support. ACLs rely on extended attributes which are natively supported in UFS2.</p></div><div class=paragraph><p>This chapter describes how to enable ACL support and provides some usage examples.</p></div><div class=sect2><h3 id=_開啟_acl_支援>13.9.1. 開啟 ACL 支援<a class=anchor href=#_開啟_acl_支援></a></h3><div class=paragraph><p>ACLs are enabled by the mount-time administrative flag, <code>acls</code>, which may be added to <span class=filename>/etc/fstab</span>. The mount-time flag can also be automatically set in a persistent manner using <a href="https://man.freebsd.org/cgi/man.cgi?query=tunefs&amp;sektion=8&amp;format=html">tunefs(8)</a> to modify a superblock ACLs flag in the file system header. In general, it is preferred to use the superblock flag for several reasons:</p></div><div class=ulist><ul><li><p>The superblock flag cannot be changed by a remount using <code>mount -u</code> as it requires a complete <code>umount</code> and fresh <code>mount</code>. This means that ACLs cannot be enabled on the root file system after boot. It also means that ACL support on a file system cannot be changed while the system is in use.</p></li><li><p>Setting the superblock flag causes the file system to always be mounted with ACLs enabled, even if there is not an <span class=filename>fstab</span> entry or if the devices re-order. This prevents accidental mounting of the file system without ACL support.</p></li></ul></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>It is desirable to discourage accidental mounting without ACLs enabled because nasty things can happen if ACLs are enabled, then disabled, then re-enabled without flushing the extended attributes. In general, once ACLs are enabled on a file system, they should not be disabled, as the resulting file protections may not be compatible with those intended by the users of the system, and re-enabling ACLs may re-attach the previous ACLs to files that have since had their permissions changed, resulting in unpredictable behavior.</p></div></td></tr></tbody></table></div><div class=paragraph><p>File systems with ACLs enabled will show a plus (<code>+</code>) sign in their permission settings:</p></div><div class="literalblock programlisting"><div class=content><pre>drwx------  2 robert  robert  512 Dec 27 11:54 private
drwxrwx---+ 2 robert  robert  512 Dec 23 10:57 directory1
drwxrwx---+ 2 robert  robert  512 Dec 22 10:20 directory2
drwxrwx---+ 2 robert  robert  512 Dec 27 11:57 directory3
drwxr-xr-x  2 robert  robert  512 Nov 10 11:54 public_html</pre></div></div><div class=paragraph><p>In this example, <span class=filename>directory1</span>, <span class=filename>directory2</span>, and <span class=filename>directory3</span> are all taking advantage of ACLs, whereas <span class=filename>public_html</span> is not.</p></div></div><div class=sect2><h3 id=_使用_acl>13.9.2. 使用 ACL<a class=anchor href=#_使用_acl></a></h3><div class=paragraph><p>File system ACLs can be viewed using <code>getfacl</code>. For instance, to view the ACL settings on <span class=filename>test</span>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% getfacl <span class=nb>test</span>
	<span class=c>#file:test</span>
	<span class=c>#owner:1001</span>
	<span class=c>#group:1001</span>
	user::rw-
	group::r--
	other::r--</code></pre></div></div><div class=paragraph><p>To change the ACL settings on this file, use <code>setfacl</code>. To remove all of the currently defined ACLs from a file or file system, include <code>-k</code>. However, the preferred method is to use <code>-b</code> as it leaves the basic fields required for ACLs to work.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% setfacl <span class=nt>-k</span> <span class=nb>test</span></code></pre></div></div><div class=paragraph><p>To modify the default ACL entries, use <code>-m</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% setfacl <span class=nt>-m</span> u:trhodes:rwx,group:web:r--,o::--- <span class=nb>test</span></code></pre></div></div><div class=paragraph><p>In this example, there were no pre-defined entries, as they were removed by the previous command. This command restores the default options and assigns the options listed. If a user or group is added which does not exist on the system, an <code>Invalid argument</code> error will be displayed.</p></div><div class=paragraph><p>Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=getfacl&amp;sektion=1&amp;format=html">getfacl(1)</a> and <a href="https://man.freebsd.org/cgi/man.cgi?query=setfacl&amp;sektion=1&amp;format=html">setfacl(1)</a> for more information about the options available for these commands.</p></div></div></div></div><div class=sect1><h2 id=security-pkg>13.10. 監視第三方安全性問題<a class=anchor href=#security-pkg></a></h2><div class=sectionbody><div class=paragraph><p>In recent years, the security world has made many improvements to how vulnerability assessment is handled. The threat of system intrusion increases as third party utilities are installed and configured for virtually any operating system available today.</p></div><div class=paragraph><p>Vulnerability assessment is a key factor in security. While FreeBSD releases advisories for the base system, doing so for every third party utility is beyond the FreeBSD Project’s capability. There is a way to mitigate third party vulnerabilities and warn administrators of known security issues. A FreeBSD add on utility known as pkg includes options explicitly for this purpose.</p></div><div class=paragraph><p>pkg polls a database for security issues. The database is updated and maintained by the FreeBSD Security Team and ports developers.</p></div><div class=paragraph><p>Please refer to <a href=../ports/#pkgng-intro>instructions</a> for installing pkg.</p></div><div class=paragraph><p>Installation provides <a href="https://man.freebsd.org/cgi/man.cgi?query=periodic&amp;sektion=8&amp;format=html">periodic(8)</a> configuration files for maintaining the pkg audit database, and provides a programmatic method of keeping it updated. This functionality is enabled if <code>daily_status_security_pkgaudit_enable</code> is set to <code>YES</code> in <a href="https://man.freebsd.org/cgi/man.cgi?query=periodic.conf&amp;sektion=5&amp;format=html">periodic.conf(5)</a>. Ensure that daily security run emails, which are sent to <code>root</code>'s email account, are being read.</p></div><div class=paragraph><p>After installation, and to audit third party utilities as part of the Ports Collection at any time, an administrator may choose to update the database and view known vulnerabilities of installed packages by invoking:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pkg audit -F</span></code></pre></div></div><div class=paragraph><p>pkg displays messages any published vulnerabilities in installed packages:</p></div><div class="literalblock programlisting"><div class=content><pre>Affected package: cups-base-1.1.22.0_1
Type of problem: cups-base -- HPGL buffer overflow vulnerability.
Reference: &lt;https://www.FreeBSD.org/ports/portaudit/40a3bca2-6809-11d9-a9e7-0001020eed82.html&gt;

1 problem(s) in your installed packages found.

You are advised to update or deinstall the affected package(s) immediately.</pre></div></div><div class=paragraph><p>By pointing a web browser to the displayed URL, an administrator may obtain more information about the vulnerability. This will include the versions affected, by FreeBSD port version, along with other web sites which may contain security advisories.</p></div><div class=paragraph><p>pkg is a powerful utility and is extremely useful when coupled with <a class=package href=https://cgit.freebsd.org/ports/tree/ports-mgmt/portmaster/>ports-mgmt/portmaster</a>.</p></div></div></div><div class=sect1><h2 id=security-advisories>13.11. FreeBSD 安全報告<a class=anchor href=#security-advisories></a></h2><div class=sectionbody><div class=paragraph><p>Like many producers of quality operating systems, the FreeBSD Project has a security team which is responsible for determining the End-of-Life (EoL) date for each FreeBSD release and to provide security updates for supported releases which have not yet reached their EoL. More information about the FreeBSD security team and the supported releases is available on the <a href=https://www.FreeBSD.org/security>FreeBSD security page</a>.</p></div><div class=paragraph><p>One task of the security team is to respond to reported security vulnerabilities in the FreeBSD operating system. Once a vulnerability is confirmed, the security team verifies the steps necessary to fix the vulnerability and updates the source code with the fix. It then publishes the details as a "Security Advisory". Security advisories are published on the <a href=https://www.FreeBSD.org/security/advisories/>FreeBSD website</a> and mailed to the <a href=http://lists.FreeBSD.org/mailman/listinfo/freebsd-security-notifications>freebsd-security-notifications</a>, <a href=http://lists.FreeBSD.org/mailman/listinfo/freebsd-security>freebsd-security</a>, and <a href=http://lists.FreeBSD.org/mailman/listinfo/freebsd-announce>freebsd-announce</a> mailing lists.</p></div><div class=paragraph><p>This section describes the format of a FreeBSD security advisory.</p></div><div class=sect2><h3 id=_安全報告的格式>13.11.1. 安全報告的格式<a class=anchor href=#_安全報告的格式></a></h3><div class=paragraph><p>Here is an example of a FreeBSD security advisory:</p></div><div class="literalblock programlisting"><div class=content><pre>=============================================================================
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

=============================================================================
FreeBSD-SA-14:04.bind                                       Security Advisory
                                                          The FreeBSD Project

Topic:          BIND remote denial of service vulnerability

Category:       contrib
Module:         bind
Announced:      2014-01-14
Credits:        ISC
Affects:        FreeBSD 8.x and FreeBSD 9.x
Corrected:      2014-01-14 19:38:37 UTC (stable/9, 9.2-STABLE)
                2014-01-14 19:42:28 UTC (releng/9.2, 9.2-RELEASE-p3)
                2014-01-14 19:42:28 UTC (releng/9.1, 9.1-RELEASE-p10)
                2014-01-14 19:38:37 UTC (stable/8, 8.4-STABLE)
                2014-01-14 19:42:28 UTC (releng/8.4, 8.4-RELEASE-p7)
                2014-01-14 19:42:28 UTC (releng/8.3, 8.3-RELEASE-p14)
CVE Name:       CVE-2014-0591

For general information regarding FreeBSD Security Advisories,
including descriptions of the fields above, security branches, and the
following sections, please visit &lt;URL:http://security.FreeBSD.org/&gt;.

I.   Background

BIND 9 is an implementation of the Domain Name System (DNS) protocols.
The named(8) daemon is an Internet Domain Name Server.

II.  Problem Description

Because of a defect in handling queries for NSEC3-signed zones, BIND can
crash with an &#34;INSIST&#34; failure in name.c when processing queries possessing
certain properties.  This issue only affects authoritative nameservers with
at least one NSEC3-signed zone.  Recursive-only servers are not at risk.

III. Impact

An attacker who can send a specially crafted query could cause named(8)
to crash, resulting in a denial of service.

IV.  Workaround

No workaround is available, but systems not running authoritative DNS service
with at least one NSEC3-signed zone using named(8) are not vulnerable.

V.   Solution

Perform one of the following:

1) Upgrade your vulnerable system to a supported FreeBSD stable or
release / security branch (releng) dated after the correction date.

2) To update your vulnerable system via a source code patch:

The following patches have been verified to apply to the applicable
FreeBSD release branches.

a) Download the relevant patch from the location below, and verify the
detached PGP signature using your PGP utility.

[FreeBSD 8.3, 8.4, 9.1, 9.2-RELEASE and 8.4-STABLE]
# fetch http://security.FreeBSD.org/patches/SA-14:04/bind-release.patch
# fetch http://security.FreeBSD.org/patches/SA-14:04/bind-release.patch.asc
# gpg --verify bind-release.patch.asc

[FreeBSD 9.2-STABLE]
# fetch http://security.FreeBSD.org/patches/SA-14:04/bind-stable-9.patch
# fetch http://security.FreeBSD.org/patches/SA-14:04/bind-stable-9.patch.asc
# gpg --verify bind-stable-9.patch.asc

b) Execute the following commands as root:

# cd /usr/src
# patch &lt; /path/to/patch

Recompile the operating system using buildworld and installworld as
described in &lt;URL:https://www.FreeBSD.org/handbook/makeworld.html&gt;.

Restart the applicable daemons, or reboot the system.

3) To update your vulnerable system via a binary patch:

Systems running a RELEASE version of FreeBSD on the i386 or amd64
platforms can be updated via the freebsd-update(8) utility:

# freebsd-update fetch
# freebsd-update install

VI.  Correction details

The following list contains the correction revision numbers for each
affected branch.

Branch/path                                                      Revision
- -------------------------------------------------------------------------
stable/8/                                                         r260646
releng/8.3/                                                       r260647
releng/8.4/                                                       r260647
stable/9/                                                         r260646
releng/9.1/                                                       r260647
releng/9.2/                                                       r260647
- -------------------------------------------------------------------------

To see which files were modified by a particular revision, run the
following command, replacing NNNNNN with the revision number, on a
machine with Subversion installed:

# svn diff -cNNNNNN --summarize svn://svn.freebsd.org/base

Or visit the following URL, replacing NNNNNN with the revision number:

&lt;URL:https://svnweb.freebsd.org/base?view=revision&amp;revision=NNNNNN&gt;

VII. References

&lt;URL:https://kb.isc.org/article/AA-01078&gt;

&lt;URL:http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-0591&gt;

The latest revision of this advisory is available at
&lt;URL:http://security.FreeBSD.org/advisories/FreeBSD-SA-14:04.bind.asc&gt;
-----BEGIN PGP SIGNATURE-----

iQIcBAEBCgAGBQJS1ZTYAAoJEO1n7NZdz2rnOvQP/2/68/s9Cu35PmqNtSZVVxVG
ZSQP5EGWx/lramNf9566iKxOrLRMq/h3XWcC4goVd+gZFrvITJSVOWSa7ntDQ7TO
XcinfRZ/iyiJbs/Rg2wLHc/t5oVSyeouyccqODYFbOwOlk35JjOTMUG1YcX+Zasg
ax8RV+7Zt1QSBkMlOz/myBLXUjlTZ3Xg2FXVsfFQW5/g2CjuHpRSFx1bVNX6ysoG
9DT58EQcYxIS8WfkHRbbXKh9I1nSfZ7/Hky/kTafRdRMrjAgbqFgHkYTYsBZeav5
fYWKGQRJulYfeZQ90yMTvlpF42DjCC3uJYamJnwDIu8OhS1WRBI8fQfr9DRzmRua
OK3BK9hUiScDZOJB6OqeVzUTfe7MAA4/UwrDtTYQ+PqAenv1PK8DZqwXyxA9ThHb
zKO3OwuKOVHJnKvpOcr+eNwo7jbnHlis0oBksj/mrq2P9m2ueF9gzCiq5Ri5Syag
Wssb1HUoMGwqU0roS8+pRpNC8YgsWpsttvUWSZ8u6Vj/FLeHpiV3mYXPVMaKRhVm
067BA2uj4Th1JKtGleox+Em0R7OFbCc/9aWC67wiqI6KRyit9pYiF3npph+7D5Eq
7zPsUdDd+qc+UTiLp3liCRp5w6484wWdhZO6wRtmUgxGjNkxFoNnX8CitzF8AaqO
UWWemqWuz3lAZuORQ9KX
=OQzQ
-----END PGP SIGNATURE-----</pre></div></div><div class=paragraph><p>Every security advisory uses the following format:</p></div><div class=ulist><ul><li><p>Each security advisory is signed by the PGP key of the Security Officer. The public key for the Security Officer can be verified at <a href=../pgpkeys/#pgpkeys>OpenPGP 金鑰</a>.</p></li><li><p>The name of the security advisory always begins with <code>FreeBSD-SA-</code> (for FreeBSD Security Advisory), followed by the year in two digit format (<code>14:</code>), followed by the advisory number for that year (<code>04.</code>), followed by the name of the affected application or subsystem (<code>bind</code>). The advisory shown here is the fourth advisory for 2014 and it affects BIND.</p></li><li><p>The <code>Topic</code> field summarizes the vulnerability.</p></li><li><p>The <code>Category</code> refers to the affected part of the system which may be one of <code>core</code>, <code>contrib</code>, or <code>ports</code>. The <code>core</code> category means that the vulnerability affects a core component of the FreeBSD operating system. The <code>contrib</code> category means that the vulnerability affects software included with FreeBSD, such as BIND. The <code>ports</code> category indicates that the vulnerability affects software available through the Ports Collection.</p></li><li><p>The <code>Module</code> field refers to the component location. In this example, the <code>bind</code> module is affected; therefore, this vulnerability affects an application installed with the operating system.</p></li><li><p>The <code>Announced</code> field reflects the date the security advisory was published. This means that the security team has verified that the problem exists and that a patch has been committed to the FreeBSD source code repository.</p></li><li><p>The <code>Credits</code> field gives credit to the individual or organization who noticed the vulnerability and reported it.</p></li><li><p>The <code>Affects</code> field explains which releases of FreeBSD are affected by this vulnerability.</p></li><li><p>The <code>Corrected</code> field indicates the date, time, time offset, and releases that were corrected. The section in parentheses shows each branch for which the fix has been merged, and the version number of the corresponding release from that branch. The release identifier itself includes the version number and, if appropriate, the patch level. The patch level is the letter <code>p</code> followed by a number, indicating the sequence number of the patch, allowing users to track which patches have already been applied to the system.</p></li><li><p>The <code>CVE Name</code> field lists the advisory number, if one exists, in the public <a href=http://cve.mitre.org>cve.mitre.org</a> security vulnerabilities database.</p></li><li><p>The <code>Background</code> field provides a description of the affected module.</p></li><li><p>The <code>Problem Description</code> field explains the vulnerability. This can include information about the flawed code and how the utility could be maliciously used.</p></li><li><p>The <code>Impact</code> field describes what type of impact the problem could have on a system.</p></li><li><p>The <code>Workaround</code> field indicates if a workaround is available to system administrators who cannot immediately patch the system .</p></li><li><p>The <code>Solution</code> field provides the instructions for patching the affected system. This is a step by step tested and verified method for getting a system patched and working securely.</p></li><li><p>The <code>Correction Details</code> field displays each affected Subversion branch with the revision number that contains the corrected code.</p></li><li><p>The <code>References</code> field offers sources of additional information regarding the vulnerability.</p></li></ul></div></div></div></div><div class=sect1><h2 id=security-accounting>13.12. 程序追蹤<a class=anchor href=#security-accounting></a></h2><div class=sectionbody><div class=paragraph><p>Process accounting is a security method in which an administrator may keep track of system resources used and their allocation among users, provide for system monitoring, and minimally track a user’s commands.</p></div><div class=paragraph><p>Process accounting has both positive and negative points. One of the positives is that an intrusion may be narrowed down to the point of entry. A negative is the amount of logs generated by process accounting, and the disk space they may require. This section walks an administrator through the basics of process accounting.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>If more fine-grained accounting is needed, refer to <a href=../audit/#audit>安全事件稽查</a>.</p></div></td></tr></tbody></table></div><div class=sect2><h3 id=_開啟並使用程序追蹤>13.12.1. 開啟並使用程序追蹤<a class=anchor href=#_開啟並使用程序追蹤></a></h3><div class=paragraph><p>Before using process accounting, it must be enabled using the following commands:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sysrc accounting_enable=yes</span>
<span class=c># service accounting start</span></code></pre></div></div><div class=paragraph><p>The accounting information is stored in files located in <span class=filename>/var/account</span>, which is automatically created, if necessary, the first time the accounting service starts. These files contain sensitive information, including all the commands issued by all users. Write access to the files is limited to <code>root</code>, and read access is limited to <code>root</code> and members of the <code>wheel</code> group. To also prevent members of <code>wheel</code> from reading the files, change the mode of the <span class=filename>/var/account</span> directory to allow access only by <code>root</code>.</p></div><div class=paragraph><p>Once enabled, accounting will begin to track information such as CPU statistics and executed commands. All accounting logs are in a non-human readable format which can be viewed using <code>sa</code>. If issued without any options, <code>sa</code> prints information relating to the number of per-user calls, the total elapsed time in minutes, total CPU and user time in minutes, and the average number of I/O operations. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=sa&amp;sektion=8&amp;format=html">sa(8)</a> for the list of available options which control the output.</p></div><div class=paragraph><p>To display the commands issued by users, use <code>lastcomm</code>. For example, this command prints out all usage of <code>ls</code> by <code>trhodes</code> on the <code>ttyp1</code> terminal:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># lastcomm ls trhodes ttyp1</span></code></pre></div></div><div class=paragraph><p>Many other useful options exist and are explained in <a href="https://man.freebsd.org/cgi/man.cgi?query=lastcomm&amp;sektion=1&amp;format=html">lastcomm(1)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=acct&amp;sektion=5&amp;format=html">acct(5)</a>, and <a href="https://man.freebsd.org/cgi/man.cgi?query=sa&amp;sektion=8&amp;format=html">sa(8)</a>.</p></div></div></div></div><div class=sect1><h2 id=security-resourcelimits>13.13. 限制資源<a class=anchor href=#security-resourcelimits></a></h2><div class=sectionbody><div class=paragraph><p>FreeBSD provides several methods for an administrator to limit the amount of system resources an individual may use. Disk quotas limit the amount of disk space available to users. Quotas are discussed in <a href=../disks/#quotas>磁碟配額</a>.</p></div><div class=paragraph><p>Limits to other resources, such as CPU and memory, can be set using either a flat file or a command to configure a resource limits database. The traditional method defines login classes by editing <span class=filename>/etc/login.conf</span>. While this method is still supported, any changes require a multi-step process of editing this file, rebuilding the resource database, making necessary changes to <span class=filename>/etc/master.passwd</span>, and rebuilding the password database. This can become time consuming, depending upon the number of users to configure.</p></div><div class=paragraph><p><code>rctl</code> can be used to provide a more fine-grained method for controlling resource limits. This command supports more than user limits as it can also be used to set resource constraints on processes and jails.</p></div><div class=paragraph><p>This section demonstrates both methods for controlling resources, beginning with the traditional method.</p></div><div class=sect2><h3 id=users-limiting>13.13.1. 設定登入類別<a class=anchor href=#users-limiting></a></h3><div class=paragraph><p>In the traditional method, login classes and the resource limits to apply to a login class are defined in <span class=filename>/etc/login.conf</span>. Each user account can be assigned to a login class, where <code>default</code> is the default login class. Each login class has a set of login capabilities associated with it. A login capability is a <code><em>name</em>=<em>value</em></code> pair, where <em>name</em> is a well-known identifier and <em>value</em> is an arbitrary string which is processed accordingly depending on the <em>name</em>.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Whenever <span class=filename>/etc/login.conf</span> is edited, the <span class=filename>/etc/login.conf.db</span> must be updated by executing the following command:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cap_mkdb /etc/login.conf</span></code></pre></div></div></td></tr></tbody></table></div><div class=paragraph><p>Resource limits differ from the default login capabilities in two ways. First, for every limit, there is a <em>soft</em> and <em>hard</em> limit. A soft limit may be adjusted by the user or application, but may not be set higher than the hard limit. The hard limit may be lowered by the user, but can only be raised by the superuser. Second, most resource limits apply per process to a specific user.</p></div><div class=paragraph><p><a href=#resource-limits>登入類別限制資源類型</a> lists the most commonly used resource limits. All of the available resource limits and capabilities are described in detail in <a href="https://man.freebsd.org/cgi/man.cgi?query=login.conf&amp;sektion=5&amp;format=html">login.conf(5)</a>.</p></div><table id=resource-limits class="tableblock frame-none grid-all stretch"><caption class=title>表 1. 登入類別限制資源類型</caption><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">限制資源</th><th class="tableblock halign-left valign-top">說明</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock>coredumpsize</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>The limit on the size of a core file generated by a program is subordinate to other limits on disk usage, such as <code>filesize</code> or disk quotas. This limit is often used as a less severe method of controlling disk space consumption. Since users do not generate core files and often do not delete them, this setting may save them from running out of disk space should a large program crash.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>cputime</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>The maximum amount of CPU time a user’s process may consume. Offending processes will be killed by the kernel. This is a limit on CPU <em>time</em> consumed, not the percentage of the CPU as displayed in some of the fields generated by <code>top</code> and <code>ps</code>.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>filesize</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>The maximum size of a file the user may own. Unlike disk quotas (<a href=../disks/#quotas>磁碟配額</a>), this limit is enforced on individual files, not the set of all files a user owns.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>maxproc</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>The maximum number of foreground and background processes a user can run. This limit may not be larger than the system limit specified by <code>kern.maxproc</code>. Setting this limit too small may hinder a user’s productivity as some tasks, such as compiling a large program, start lots of processes.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>memorylocked</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>The maximum amount of memory a process may request to be locked into main memory using <a href="https://man.freebsd.org/cgi/man.cgi?query=mlock&amp;sektion=2&amp;format=html">mlock(2)</a>. Some system-critical programs, such as <a href="https://man.freebsd.org/cgi/man.cgi?query=amd&amp;sektion=8&amp;format=html">amd(8)</a>, lock into main memory so that if the system begins to swap, they do not contribute to disk thrashing.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>memoryuse</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>The maximum amount of memory a process may consume at any given time. It includes both core memory and swap usage. This is not a catch-all limit for restricting memory consumption, but is a good start.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>openfiles</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>The maximum number of files a process may have open. In FreeBSD, files are used to represent sockets and IPC channels, so be careful not to set this too low. The system-wide limit for this is defined by <code>kern.maxfiles</code>.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>sbsize</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>The limit on the amount of network memory a user may consume. This can be generally used to limit network communications.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>stacksize</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>The maximum size of a process stack. This alone is not sufficient to limit the amount of memory a program may use, so it should be used in conjunction with other limits.</p></td></tr></tbody></table><div class=paragraph><p>There are a few other things to remember when setting resource limits:</p></div><div class=ulist><ul><li><p>Processes started at system startup by <span class=filename>/etc/rc</span> are assigned to the <code>daemon</code> login class.</p></li><li><p>Although the default <span class=filename>/etc/login.conf</span> is a good source of reasonable values for most limits, they may not be appropriate for every system. Setting a limit too high may open the system up to abuse, while setting it too low may put a strain on productivity.</p></li><li><p>Xorg takes a lot of resources and encourages users to run more programs simultaneously.</p></li><li><p>Many limits apply to individual processes, not the user as a whole. For example, setting <code>openfiles</code> to <code>50</code> means that each process the user runs may open up to <code>50</code> files. The total amount of files a user may open is the value of <code>openfiles</code> multiplied by the value of <code>maxproc</code>. This also applies to memory consumption.</p></li></ul></div><div class=paragraph><p>For further information on resource limits and login classes and capabilities in general, refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=cap_mkdb&amp;sektion=1&amp;format=html">cap_mkdb(1)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=getrlimit&amp;sektion=2&amp;format=html">getrlimit(2)</a>, and <a href="https://man.freebsd.org/cgi/man.cgi?query=login.conf&amp;sektion=5&amp;format=html">login.conf(5)</a>.</p></div></div><div class=sect2><h3 id=_開啟並設定資源限制>13.13.2. 開啟並設定資源限制<a class=anchor href=#_開啟並設定資源限制></a></h3><div class=paragraph><p>The <code>kern.racct.enable</code> tunable must be set to a non-zero value. Custom kernels require specific configuration:</p></div><div class="literalblock programlisting"><div class=content><pre>options         RACCT
options         RCTL</pre></div></div><div class=paragraph><p>Once the system has rebooted into the new kernel, <code>rctl</code> may be used to set rules for the system.</p></div><div class=paragraph><p>Rule syntax is controlled through the use of a subject, subject-id, resource, and action, as seen in this example rule:</p></div><div class="literalblock programlisting"><div class=content><pre>user:trhodes:maxproc:deny=10/user</pre></div></div><div class=paragraph><p>In this rule, the subject is <code>user</code>, the subject-id is <code>trhodes</code>, the resource, <code>maxproc</code>, is the maximum number of processes, and the action is <code>deny</code>, which blocks any new processes from being created. This means that the user, <code>trhodes</code>, will be constrained to no greater than <code>10</code> processes. Other possible actions include logging to the console, passing a notification to <a href="https://man.freebsd.org/cgi/man.cgi?query=devd&amp;sektion=8&amp;format=html">devd(8)</a>, or sending a sigterm to the process.</p></div><div class=paragraph><p>Some care must be taken when adding rules. Since this user is constrained to <code>10</code> processes, this example will prevent the user from performing other tasks after logging in and executing a <code>screen</code> session. Once a resource limit has been hit, an error will be printed, as in this example:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% man <span class=nb>test</span>
    /usr/bin/man: Cannot fork: Resource temporarily unavailable
<span class=nb>eval</span>: Cannot fork: Resource temporarily unavailable</code></pre></div></div><div class=paragraph><p>As another example, a jail can be prevented from exceeding a memory limit. This rule could be written as:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># rctl -a jail:httpd:memoryuse:deny=2G/jail</span></code></pre></div></div><div class=paragraph><p>Rules will persist across reboots if they have been added to <span class=filename>/etc/rctl.conf</span>. The format is a rule, without the preceding command. For example, the previous rule could be added as:</p></div><div class="literalblock programlisting"><div class=content><pre># Block jail from using more than 2G memory:
jail:httpd:memoryuse:deny=2G/jail</pre></div></div><div class=paragraph><p>To remove a rule, use <code>rctl</code> to remove it from the list:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># rctl -r user:trhodes:maxproc:deny=10/user</span></code></pre></div></div><div class=paragraph><p>A method for removing all rules is documented in <a href="https://man.freebsd.org/cgi/man.cgi?query=rctl&amp;sektion=8&amp;format=html">rctl(8)</a>. However, if removing all rules for a single user is required, this command may be issued:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># rctl -r user:trhodes</span></code></pre></div></div><div class=paragraph><p>Many other resources exist which can be used to exert additional control over various <code>subjects</code>. See <a href="https://man.freebsd.org/cgi/man.cgi?query=rctl&amp;sektion=8&amp;format=html">rctl(8)</a> to learn about them.</p></div></div></div></div><div class=sect1><h2 id=security-sudo>13.14. 使用 Sudo 分享管理權限<a class=anchor href=#security-sudo></a></h2><div class=sectionbody><div class=paragraph><p>系統管理者通常會要能夠授予額外的權限給其他使用者，以讓這些使用者可以執行需權限的工作。要讓團隊成員可以存取 FreeBSD 系統來完成其特定的工作對所有管理者都會帶來挑戰，這些團隊成員通常只需要比一般使用者多出一些存取權限便可作業，但他們總是會告訴管理者若沒有超級使用者的存取權便無法完成其工作。幸好，有工具可以管理這類的需求，這樣便不需提供這麼大的權限給一般使用者。</p></div><div class=paragraph><p>到目前為止，安全性章節已說明了如何允許已授權的使用者存取以及嘗試防止未經授權的存取，而現在有另一個問題，是由已授權的使用者擁有權限存取系統資源造成的。在很多的情況，使用者會需要存取應用程式啟動 Script 的權限或是管理者團隊需要維護系統，以往會使用標準的使用者與群組、檔案權限、甚至是 <a href="https://man.freebsd.org/cgi/man.cgi?query=su&amp;sektion=1&amp;format=html">su(1)</a> 指令來管理存取權，但當應用程式需要更多存取權，更多使用者需要使用系統資源時，便需要更好的解決方案，目前最常用來解決此問題的應用程式便是 Sudo。</p></div><div class=paragraph><p>Sudo 讓管理者可以對系統指令的存取設下更嚴格的限制並提供進階的記錄功能。如同其他工具，它可自 Port 套件集取得，於其中的 <a class=package href=https://cgit.freebsd.org/ports/tree/security/sudo/>security/sudo</a>，或使用 <a href="https://man.freebsd.org/cgi/man.cgi?query=pkg&amp;sektion=8&amp;format=html">pkg(8)</a> 工具取得，若要使用 <a href="https://man.freebsd.org/cgi/man.cgi?query=pkg&amp;sektion=8&amp;format=html">pkg(8)</a> 工具可：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pkg install sudo</span></code></pre></div></div><div class=paragraph><p>安裝完成之後，可用安裝的 <code>visudo</code> 以文字編輯器開啟設定檔，強烈建議使用 <code>visudo</code> 來編輯設定檔，由於它有內建的語法檢查程式可在檔案儲存之前檢驗是否有誤。</p></div><div class=paragraph><p>設定檔由個小節所組成，透過這些小節可做常廣泛的設定，在以下的範例中，網站應用程式維護人員 user1 需要啟動、停止與重新啟動名稱為 <em>webservice</em> 的網站應用程式 。要授權此使用者執行這些工作的權限，可加入此行到 <span class=filename>/usr/local/etc/sudoers</span> 的最後：</p></div><div class="literalblock programlisting"><div class=content><pre>user1   ALL=(ALL)       /usr/sbin/service webservice *</pre></div></div><div class=paragraph><p>現在使用者可使用此指令來啟動 <em>webservice</em>：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% <span class=nb>sudo</span> /usr/sbin/service webservice start</code></pre></div></div><div class=paragraph><p>雖然這項設定可以讓一位使用者存取 webservice 服務，但在大部份組織中會有一整個網站小組負責管理該服務，因此也可以一行來授予整個群組存取權，以下步驟會建立一個網站群組、加入使用者到這個群組，然後讓該群組中的所有成員能夠管理服務：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pw groupadd -g 6001 -n webteam</span></code></pre></div></div><div class=paragraph><p>同樣使用 <a href="https://man.freebsd.org/cgi/man.cgi?query=pw&amp;sektion=8&amp;format=html">pw(8)</a> 指令來加入該使用到 webteam 群組：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pw groupmod -m user1 -n webteam</span></code></pre></div></div><div class=paragraph><p>最後，在 <span class=filename>/usr/local/etc/sudoers</span> 中的這行設定可以讓 webteam 群組的所有成員可以管理 <em>webservice</em>：</p></div><div class="literalblock programlisting"><div class=content><pre>%webteam   ALL=(ALL)       /usr/sbin/service webservice *</pre></div></div><div class=paragraph><p>與 <a href="https://man.freebsd.org/cgi/man.cgi?query=su&amp;sektion=1&amp;format=html">su(1)</a> 不同的是 Sudo 只需要一般使用者的密碼，這有一個使用者不需要共用密碼的優點，在大多數安全稽查都會發現共用密碼的問題且這種情況只有壞處可言。</p></div><div class=paragraph><p>使用 Sudo 允許使用者執行應用程式只需要輸入使用者自己的密碼，這更安全且提供比 <a href="https://man.freebsd.org/cgi/man.cgi?query=su&amp;sektion=1&amp;format=html">su(1)</a> 更佳的控制權，因為 <a href="https://man.freebsd.org/cgi/man.cgi?query=su&amp;sektion=1&amp;format=html">su(1)</a> 只要輸入 <code>root</code> 密碼之後該使用者便可取得所有的 <code>root</code> 權限。</p></div><div class="admonitionblock tip"><table><tbody><tr><td class=icon><i class="fa icon-tip" title=Tip></i></td><td class=content><div class=paragraph><p>大多數組織已正在導入或已導入雙重認証 (Two factor authentication)，在這個情境下使用者可以不用輸入密碼，Sudo 提供了 <code>NOPASSWD</code> 變數來供這個情境使用，可將該設定加入到上述的設定將可允許所有 <em>webteam</em> 群組的成員不需要輸入密碼便可管理該服務：</p></div><div class="literalblock programlisting"><div class=content><pre>%webteam   ALL=(ALL)       NOPASSWD: /usr/sbin/service webservice *</pre></div></div></td></tr></tbody></table></div><div class=sect2><h3 id=security-sudo-loggin>13.14.1. 記錄輸出<a class=anchor href=#security-sudo-loggin></a></h3><div class=paragraph><p>採用 Sudo 的另一個優點是能夠開啟連線階段的記錄。使用內建立記錄機制與內含的 sudoreplay 指令，所有透過 Sudo 初始化的指令會被記錄下來供往後檢驗用。要開啟這個功能要加入預設記錄目錄的項目，在以下範例中使用了使用者變數來做目錄名稱，也還有許多其他記錄檔名稱慣例，可參考 sudoreplay 的操作手冊來取得進一步資訊。</p></div><div class="literalblock programlisting"><div class=content><pre>Defaults iolog_dir=/var/log/sudo-io/%{user}</pre></div></div><div class="admonitionblock tip"><table><tbody><tr><td class=icon><i class="fa icon-tip" title=Tip></i></td><td class=content><div class=paragraph><p>這個目錄會在記錄功能設定之後自動建立，最好讓系統以預設的權限來建立目錄比較保險，除此之外，這個設定項目也會記錄使用 sudoreplay 指令的管理者，要更改設定請閱讀並取消在 <span class=filename>sudoers</span> 中記錄選項的註解。</p></div></td></tr></tbody></table></div><div class=paragraph><p>一旦這個設定加入至 <span class=filename>sudoers</span> 檔案之後，所有的使用者設定項目便可加上記錄存取動作的項目，在 <em>webteam</em> 項目加入額外設定之後的範例如下：</p></div><div class="literalblock programlisting"><div class=content><pre>%webteam ALL=(ALL) NOPASSWD: LOG_INPUT: LOG_OUTPUT: /usr/sbin/service webservice *</pre></div></div><div class=paragraph><p>從此之後，所有 <em>webteam</em> 修改 <em>webservice</em> 應用程式狀態的成員將會被記錄下來。要列出先前與目前連線階段的記錄可：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sudoreplay -l</span></code></pre></div></div><div class=paragraph><p>在輸出結果中要重播指定連線階段的記錄可搜尋 <code>TSID=</code> 項目，然後傳送給 sudoreplay 且不加其他選項便可以一般速度重播連線階段，例如：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sudoreplay user1/00/00/02</span></code></pre></div></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>雖然所有連線階段都會被記錄，但任何管理者都可以移除連線階段，使得沒人知道它們做了什麼事，所以非常值得在入侵偵測系統 (IDS) 或類似的軟體加入每日檢查，以便在有人為修改時通知其他管理人員。</p></div></td></tr></tbody></table></div><div class=paragraph><p><code>sudoreplay</code> 的擴充空間非常大，請參考說明文件來取得更多資訊。</p></div></div></div></div></div><hr><div class=last-modified><p><strong>最後修改於</strong>: March 9, 2024 由 <a href="https://cgit.freebsd.org/doc/commit/?id=6199af92e7" target=_blank>Danilo G. Baio</a></p></div><div class=buttons><div class=prev><i class="fa fa-angle-left" aria-hidden=true title=Prev></i><div class=container><a href=http://172.16.201.134:1313/zh-tw/books/handbook/boot class=direction>Prev</a></div></div><div class=home><i class="fa fa-home" aria-hidden=true title=Home></i><div class=container><a href=../ class=direction>Home</a></div></div><div class=next><div class=container><a href=http://172.16.201.134:1313/zh-tw/books/handbook/jails class=direction>Next</a></div><i class="fa fa-angle-right" aria-hidden=true title=Next></i></div></div><label class="hidden book-menu-overlay" for=menu-control></label></div><aside class=toc><div class=toc-content><h3>目錄</h3><nav id=TableOfContents><ul><li><a href=#security-synopsis>13.1. 概述</a></li><li><a href=#security-intro>13.2. 簡介</a></li><li><a href=#one-time-passwords>13.3. 一次性密碼</a></li><li><a href=#tcpwrappers>13.4. TCP Wrapper</a></li><li><a href=#kerberos5>13.5. Kerberos</a></li><li><a href=#openssl>13.6. OpenSSL</a></li><li><a href=#ipsec>13.7. VPN over IPsec</a></li><li><a href=#openssh>13.8. OpenSSH</a></li><li><a href=#fs-acl>13.9. 存取控制清單</a></li><li><a href=#security-pkg>13.10. 監視第三方安全性問題</a></li><li><a href=#security-advisories>13.11. FreeBSD 安全報告</a></li><li><a href=#security-accounting>13.12. 程序追蹤</a></li><li><a href=#security-resourcelimits>13.13. 限制資源</a></li><li><a href=#security-sudo>13.14. 使用 Sudo 分享管理權限</a></li></ul></nav><hr><div class=resources><h3>資源</h3><ul class=contents><li><i class="fa fa-file-pdf-o" aria-hidden=true title="下載 PDF"></i><a href=https://download.freebsd.org/doc/zh-tw/books/handbook/handbook_zh-tw.pdf>下載 PDF</a></li><li><i class="fa fa-pencil-square-o" aria-hidden=true title=編輯此頁></i><a href=https://github.com/freebsd/freebsd-doc/blob/main/documentation/content/zh-tw/_index target=_blank>編輯此頁</a></li></ul></div></div></aside><a class=to-top href=#top><i class="fa fa-arrow-circle-up" aria-hidden=true></i></a></main><footer><div class=footer-container><section class=logo-column><img src=http://172.16.201.134:1313/images/FreeBSD-colors.svg width=160 height=50 alt="FreeBSD logo"><div class=options-container><div class=language-container><a id=languages href=http://172.16.201.134:1313/zh-tw/languages><img src=http://172.16.201.134:1313/images/language.png class=language-image alt=選擇語言>
<span>繁體中文</span></a></div><div class=theme-container><select id=theme-chooser><option value=theme-system>System</option><option value=theme-light>淺色</option><option value=theme-dark>深色</option><option value=theme-high-contrast>高對比</option></select></div></div></section><section class=about-column><h3 class=column-title>About</h3><ul class=column-elements-container><li><a href=https://www.freebsd.org/about/ target=_blank class=column-element>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/ target=_blank class=column-element>FreeBSD Foundation</a></li><li><a href=https://www.freebsd.org/where/ target=_blank class=column-element>Get FreeBSD</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct target=_blank class=column-element>Code of Conduct</a></li><li><a href=https://www.freebsd.org/security/ target=_blank class=column-element>Security Advisories</a></li></ul></section><section class=documentation-column><h3 class=column-title>Documentation</h3><ul class=column-elements-container><li><a href=/zh-tw class=column-element>Documentation portal</a></li><li><a href=https://man.FreeBSD.org target=_blank class=column-element>Manual pages</a></li><li><a href=https://papers.FreeBSD.org target=_blank class=column-element>Presentations and papers</a></li><li><a href=https://docs-archive.freebsd.org/doc/ target=_blank class=column-element>Previous versions</a></li><li><a href=https://docs-archive.freebsd.org/44doc/ target=_blank class=column-element>4.4BSD Documents</a></li><li><a href=https://wiki.freebsd.org/ target=_blank class=column-element>Wiki</a></li></ul></section><section class=community-column><h3 class=column-title>Community</h3><ul class=column-elements-container><li><a href=http://172.16.201.134:1313/zh-tw/articles/contributing class=column-element>Get involved</a></li><li><a href=https://forums.freebsd.org/ target=_blank class=column-element>Community forum</a></li><li><a href=https://lists.freebsd.org/ target=_blank class=column-element>Mailing lists</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank class=column-element>IRC Channels</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank class=column-element>Bug Tracker</a></li></ul></section><section class=legal-column><h3 class=column-title>Legal</h3><ul class=column-elements-container><li><a href=https://freebsdfoundation.org/donate/ target=_blank class=column-element>Donations</a></li><li><a href=https://www.freebsd.org/copyright/freebsd-license/ target=_blank class=column-element>Licensing</a></li><li><a href=https://www.freebsd.org/privacy/ target=_blank class=column-element>Privacy Policy</a></li><li><a href=https://www.freebsd.org/copyright/ target=_blank class=column-element>Legal notices</a></li></ul></section><section class=copyright-column><p>&copy; 1994-2024 The FreeBSD Project. All rights reserved</p><span>Made with <span class=heart>♥</span> by the FreeBSD Community</span></section></div></footer></body></html>