<!doctype html><html class=theme-light lang=zh-tw><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content><meta name=copyright content="1995-2024 The FreeBSD Foundation"><link rel=canonical href=http://172.16.201.134:1313/zh-tw/articles/remote-install/><title>遠端安裝 FreeBSD 作業系統而不必接 Remote Console | FreeBSD Documentation Portal</title>
<meta name=theme-color content="#790000"><meta name=color-scheme content="system light dark high-contrast"><link rel="shortcut icon" href=http://172.16.201.134:1313/favicon.ico><link rel=stylesheet href=http://172.16.201.134:1313/styles/main.min.css><link rel=stylesheet href=http://172.16.201.134:1313/css/font-awesome-min.css><script defer src=/js/theme-chooser.min.js></script><script defer src=/js/copy-clipboard.min.js></script><script defer src=/js/search.min.js></script><meta name=twitter:card content="summary"><meta name=twitter:domain content="docs.FreeBSD.org"><meta name=twitter:site content="@freebsd"><meta name=twitter:url content="https://twitter.com/freebsd"><meta property="og:title" content="遠端安裝 FreeBSD 作業系統而不必接 Remote Console"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:image" content="http://172.16.201.134:1313/favicon.ico"><meta property="og:image:alt" content="FreeBSD Logo"><meta property="og:locale" content="zh-tw"><meta property="og:url" content="http://172.16.201.134:1313/zh-tw/articles/remote-install/"><meta property="og:site_name" content="FreeBSD Documentation Portal"><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","url":"http:\/\/172.16.201.134:1313\/zh-tw\/articles\/remote-install\/","name":"FreeBSD Documentation Portal","headline":"FreeBSD Documentation Portal","description":"FreeBSD Documentation Portal"}</script></head><body><header><div class=header-container><div class=logo-menu-bars-container><a href=https://www.FreeBSD.org class=logo><img src=http://172.16.201.134:1313/images/FreeBSD-monochromatic.svg width=160 height=50 alt="FreeBSD logo">
</a><label class=menu-bars for=menu-bars><i class="fa fa-bars" aria-hidden=true></i></label></div><input id=menu-bars type=checkbox><nav><ul class=menu><li class=menu-item><input id=about type=checkbox>
<a href=# aria-label="Navigate to About section"><label class=menu-item-description for=about>About
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/about/ target=_blank>About</a></li><li><a href=https://www.freebsd.org/about/ target=_blank>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/about-us/about-the-foundation/ target=_blank>FreeBSD Foundation</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct/ target=_blank>Code of Conduct</a></li></ul></li><li class=menu-item><input id=download type=checkbox>
<a href=# aria-label="Navigate to get FreeBSD section"><label class=menu-item-description for=download>Get FreeBSD
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/where/ target=_blank>Get FreeBSD</a></li><li><a href=https://www.freebsd.org/releases/ target=_blank>Release Information</a></li><li><a href=https://www.freebsd.org/releng/ target=_blank>Release Engineering</a></li><li><a href=https://www.freebsd.org/security/ target=_blank>Security Advisories</a></li></ul></li><li class=menu-item><input id=documentation type=checkbox>
<a href=# aria-label="Navigate to get Documentation section"><label class=menu-item-description for=documentation>Documentation
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=/zh-tw>Documentation portal</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/handbook>FreeBSD Handbook</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books/porters-handbook>Porter's Handbook</a></li><li><a href=https://docs.FreeBSD.org/en/books/fdp-primer>Documentation Project Handbook</a></li><li><a href=https://man.FreeBSD.org target=_blank>Manual pages</a></li><li><a href=https://papers.FreeBSD.org target=_blank>Presentations and papers</a></li><li><a href=https://wiki.FreeBSD.org target=_blank>Wiki</a></li><li><a href=http://172.16.201.134:1313/zh-tw/books>Books</a></li><li><a href=http://172.16.201.134:1313/zh-tw/articles>Articles</a></li></ul></li><li class=menu-item><input id=community type=checkbox>
<a href=# aria-label="Navigate to get Community section"><label class=menu-item-description for=community>Community
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/community/>Community</a></li><li><a href=http://172.16.201.134:1313/zh-tw/articles/contributing>Get involved</a></li><li><a href=https://forums.freebsd.org/ target=_blank>Forum</a></li><li><a href=https://lists.freebsd.org/ target=_blank>Mailing lists</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank>IRC Channels</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank>Bug Tracker</a></li><li><a href=https://www.freebsd.org/support/ target=_blank>Support</a></li></ul></li></ul></nav><div class=search-donate-container><form class=search method=get id=search-header-form action=https://docs.freebsd.org/search name=search-header-form><input type=hidden name=DB value=zh-tw>
<input id=words name=P type=text size=20 maxlength=255>
<button>
<i class="fa fa-search" aria-hidden=true></i></button></form><div class=donate><a href=https://freebsdfoundation.org/donate/ target=_blank><span class=heart>♥</span>
Donate</a></div></div></div></header><main class=main-wrapper-article><div class=article><h1 class=title>遠端安裝 FreeBSD 作業系統而不必接 Remote Console</h1><div class="admonitionblock note"><p><i class="fa fa-exclamation-circle" aria-hidden=true></i>
This translation may be out of date. To help with the translations please access the <a href=https://translate-dev.freebsd.org/ target=_blank>FreeBSD translations instance</a>.</p></div><div class=copyright>Copyright © 2008 The FreeBSD Documentation Project</div><div class=legalnotice><a id=trademarks></a><details><summary>註冊商標</summary><p>FreeBSD 是 FreeBSD 基金會的註冊商標。</p><p>許多製造商和經銷商使用一些稱為商標的圖案或文字設計來區別自己的產品。 本文件中出現的眾多商標，以及 FreeBSD Project 本身廣所人知的商標，後面將以 “™” 或 “®” 符號來標示。</p></details></div><div class=toc-mobile><h3>目錄</h3><nav id=TableOfContents><ul><li><a href=#background>1. 緣起</a></li><li><a href=#intro>2. 介紹</a></li><li><a href=#preparation>3. 準備 - mfsBSD</a></li><li><a href=#installation>4. FreeBSD 作業系統的安裝</a></li><li><a href=#zfs>5. ZFS</a></li></ul></nav></div><div id=preamble><div class=sectionbody><div class="paragraph abstract-title"><p>摘要</p></div><div class=paragraph><p>本文介紹如何在沒辦法連到遠端 console 的機器做 FreeBSD 遠端安裝。 本文構想來自於作者與 <code>Martin Matuska &lt;<a href=mailto:mm@FreeBSD.org>mm@FreeBSD.org</a>></code> 的合作成果， 以及 <code>Paweł Jakub Dawidek &lt;<a href=mailto:pjd@FreeBSD.org>pjd@FreeBSD.org</a>></code> 所投注的諸多心血。</p></div><hr></div></div><div class=sect1><h2 id=background>1. 緣起<a class=anchor href=#background></a></h2><div class=sectionbody><div class=paragraph><p>世上有許多 server hosting provider，但其中有官方支援 FreeBSD 則不是相當多。 他們通常會在所提供的機器上有 Linux® distribution 的安裝支援。</p></div><div class=paragraph><p>有些會讓您可選擇喜好的 Linux® distribution 來裝， 像這種情況就可以試著安裝 FreeBSD。 而有些則是會提供救急用的系統， 這種也可以用來安裝 FreeBSD。</p></div><div class=paragraph><p>本文介紹這些遠端基本安裝 FreeBSD 的方式，以及 RAID-1 與 ZFS 設定步驟。</p></div></div></div><div class=sect1><h2 id=intro>2. 介紹<a class=anchor href=#intro></a></h2><div class=sectionbody><div class=paragraph><p>茲摘錄一下本文的目的以及闡述這邊所涵蓋的東西。 對於無官方支援 FreeBSD 的代管服務(colocation)用戶而言， 本文中所介紹到的指令會相當有用。</p></div><div class="olist arabic procedure"><ol class=arabic><li><p>正如先前 <a href=#background>緣起</a> 所提到的，許多名聲還不賴的 server hosting 公司會提供一些救急用系統，可以透過 LAN 方式開機，也可以透過 SSH 方式進行管理。 通常會有該加值服務， 以讓他們的客戶可以連進來修復有問題的作業系統。 本節之後將介紹如何透過救急系統來安裝 FreeBSD。</p></li><li><p>下一節會介紹如何在本機設定以及打造最小巧的 FreeBSD ---- 該版最後會在遠端機器上透過 ramdisk 方式啟動，並以 Sysinstall 從 FTP mirror 站來安裝完整的 FreeBSD 作業系統。</p></li><li><p>本文其餘部分將介紹安裝程序，以及 ZFS 檔案系統的設定。</p></li></ol></div><div class=sect2><h3 id=requirements>2.1. 需求<a class=anchor href=#requirements></a></h3><div class=paragraph><p>為了成功完成遠端安裝，必須要有：</p></div><div class=ulist><ul><li><p>要有可以上網的作業系統，並且 SSH 可以連線。</p></li><li><p>瞭解 FreeBSD 的安裝程序</p></li><li><p>熟悉如何使用 <a href="https://man.freebsd.org/cgi/man.cgi?query=sysinstall&amp;sektion=8&amp;format=html">sysinstall(8)</a></p></li><li><p>有 FreeBSD 安裝光碟片或者 ISO image 檔</p></li></ul></div></div></div></div><div class=sect1><h2 id=preparation>3. 準備 - mfsBSD<a class=anchor href=#preparation></a></h2><div class=sectionbody><div class=paragraph><p>在裝 FreeBSD 之前，要先打造最小化的 FreeBSD 作業系統 image 檔， 以便可以從硬碟上開機。 如此一來，新的系統就可以透過網路來操作， 而剩下來的安裝部分即可不必透過 console。</p></div><div class=paragraph><p>而 mfsBSD 這套工具就是用來打造小型的 FreeBSD image 檔。 mfsBSD (名字其中 "mfs" 就是 "memory file system")所建造出來的 整套系統會透過 ramdisk 方式來運作。 由於此一特色，硬碟的部分就不受限， 因此可以用來安裝完整的 FreeBSD 作業系統。 mfsBSD 的首頁位於 <a href=http://people.freebsd.org/~mm/mfsbsd/>http://people.freebsd.org/~mm/mfsbsd/</a>， 其中連結有該工具的最新 release 部分。</p></div><div class=paragraph><p>請注意：mfsBSD 內部運作方式的細節，不 在本文介紹範圍之內。 若對這方面有興趣的讀者，可至 mfsBSD 官網查閱相關文件。</p></div><div class=paragraph><p>首先下載最新的 mfsBSD 並解壓縮之， 然後切到解壓縮後的工作目錄，也就是 mfsBSD script 檔所在處：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># fetch http://people.freebsd.org/~mm/mfsbsd/mfsbsd-latest.tar.gz</span>
<span class=c># tar xvzf mfsbsd-1.0-beta1.tar.gz</span>
<span class=c># cd mfsbsd-1.0-beta1/</span></code></pre></div></div><div class=sect2><h3 id=mfsbsd-config>3.1. 設定 mfsBSD<a class=anchor href=#mfsbsd-config></a></h3><div class=paragraph><p>在將 mfsBSD 開機之前， 有幾個重要設定要先設妥。 此時最重要的設定，很明顯就是網路設定。 到底網路怎麼設最好，則取決於所處的網路環境， 以及該網路卡會以哪一種驅動程式載入而定。 我們將會看到 mfsBSD 如何在任何網路情況下進行設定。</p></div><div class=paragraph><p>另一件重要事就是設定 <code>root</code> 密碼。 這點可以透過 <span class=filename>conf/rootpw.conf</span> 來完成。 請切記：該檔密碼是以明文方式存放，因此不建議放真正平常有在用的密碼。 然而這密碼只是臨時密碼而已，可以在之後開機時再做更換。</p></div><div class=sect3><h4 id=_設定網路confinterfaces_conf_方式>3.1.1. 設定網路(<span class=filename>conf/interfaces.conf</span> 方式)<a class=anchor href=#_設定網路confinterfaces_conf_方式></a></h4><div class=paragraph><p>若對要裝的機器網卡為何還不知道是哪一款，但可以善加利用 mfsBSD 的自動偵測功能。 mfsBSD 的開機 script 會根據網卡的 MAC 位址範圍來偵測正確的驅動程式，像是下列的 <span class=filename>conf/interfaces.conf</span> 設定內容：</p></div><div class="literalblock programlisting"><div class=content><pre>initconf_interfaces=&#34;ext1&#34;
initconf_mac_ext1=&#34;00:00:00:00:00:00&#34;
initconf_ip_ext1=&#34;192.168.0.2&#34;
initconf_netmask_ext1=&#34;255.255.255.0&#34;</pre></div></div><div class=paragraph><p>別忘了在 <span class=filename>conf/rc.conf</span> 內要加上 <code>defaultrouter</code> 的相關設定：</p></div><div class="literalblock programlisting"><div class=content><pre>defaultrouter=&#34;192.168.0.1&#34;</pre></div></div></div><div class=sect3><h4 id=_設定網路confrc_conf_方式>3.1.2. 設定網路(<span class=filename>conf/rc.conf</span> 方式)<a class=anchor href=#_設定網路confrc_conf_方式></a></h4><div class=paragraph><p>若已經知道網卡是哪一種，那麼要設定網路的話直接改 <span class=filename>conf/rc.conf</span> 會比較方便。 該檔設定語法與 FreeBSD 標準的 <a href="https://man.freebsd.org/cgi/man.cgi?query=rc.conf&amp;sektion=5&amp;format=html">rc.conf(5)</a> 是一致的。</p></div><div class=paragraph><p>舉個例子，若知道該機器網卡是用 <a href="https://man.freebsd.org/cgi/man.cgi?query=re&amp;sektion=4&amp;format=html">re(4)</a>，那麼就在 <span class=filename>conf/rc.conf</span> 做下列類似設定：</p></div><div class="literalblock programlisting"><div class=content><pre>defaultrouter=&#34;192.168.0.1&#34;
ifconfig_re0=&#34;inet 192.168.0.2 netmask 255.255.255.0&#34;</pre></div></div></div></div><div class=sect2><h3 id=mfsbsd-build>3.2. 打造 mfsBSD image<a class=anchor href=#mfsbsd-build></a></h3><div class=paragraph><p>打造 mfsBSD image 檔的過程相當簡單。</p></div><div class=paragraph><p>首先是把 FreeBSD 安裝光碟或者安裝用的 ISO image 檔丟到 <span class=filename>/cdrom</span>。 為維持所有例子的一致，本文假設都是用 FreeBSD 7.0-RELEASE ISO。 而把 ISO image 檔掛載到 <span class=filename>/cdrom</span> 目錄相當簡單， 就是用 <a href="https://man.freebsd.org/cgi/man.cgi?query=mdconfig&amp;sektion=8&amp;format=html">mdconfig(8)</a>：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mdconfig -a -t vnode -u 10 -f 7.0-RELEASE-amd64-disc1.iso</span>
<span class=c># mount_cd9660 /dev/md10 /cdrom</span></code></pre></div></div><div class=paragraph><p>接著就開始打造可開機的 mfsBSD image：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># make BASE=/cdrom/7.0-RELEASE</span></code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>上述的 make 指令要在 mfsBSD 的最上層目錄執行，比方說 <span class=filename>~/mfsbsd-1.0-beta1/</span>。</p></div></td></tr></tbody></table></div></div><div class=sect2><h3 id=_mfsbsd_開動>3.3. mfsBSD 開動<a class=anchor href=#_mfsbsd_開動></a></h3><div class=paragraph><p>現在 mfsBSD image 已經備妥， 要上傳到遠端機器的救急系統或者預先安裝的 Linux® distribution。 要完成這工作最適合的工具就是 scp：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># scp disk.img root@192.168.0.2:.</span></code></pre></div></div><div class=paragraph><p>為了能順利啟動 mfsBSD image， 要把檔案放在欲安裝機器的第一顆(可開機)硬碟上。 假設例子的第一顆開機硬碟代號為 <span class=filename>sda</span>， 那麼作法就類似下面這樣：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># dd if=/root/disk.img of=/dev/sda bs=1m</span></code></pre></div></div><div class=paragraph><p>若一切順利，該 image 檔現在應該會在第一顆硬碟的 MBR 磁區並可以開始進行重開機了。 可以用 <a href="https://man.freebsd.org/cgi/man.cgi?query=ping&amp;sektion=8&amp;format=html">ping(8)</a> 工具來檢測該機器開機完畢與否。 一旦 ping 到之後， 就可以透過 <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;format=html">ssh(1)</a> 連進去，並且用 <code>root</code> 以及剛設定的密碼登入。</p></div></div></div></div><div class=sect1><h2 id=installation>4. FreeBSD 作業系統的安裝<a class=anchor href=#installation></a></h2><div class=sectionbody><div class=paragraph><p>現在 mfsBSD 已順利啟動，並且應該可以透過 <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;format=html">ssh(1)</a> 方式來連。 本節將介紹如何建立 slice 分割、設定 gmirror 以作 RAID-1、如何以 Sysinstall 來安裝 FreeBSD 作業系統的最小化安裝。</p></div><div class=sect2><h3 id=_準備硬碟>4.1. 準備硬碟<a class=anchor href=#_準備硬碟></a></h3><div class=paragraph><p>首先要作的是配置硬碟空間給 FreeBSD，像是建立 slice 跟分割區。 很明顯地，目前在跑的作業系統是載入到系統記憶體內執行， 因此要對硬碟配置並無任何問題。 這些工作可以用 Sysinstall 或者以 <a href="https://man.freebsd.org/cgi/man.cgi?query=fdisk&amp;sektion=8&amp;format=html">fdisk(8)</a> 搭配 <a href="https://man.freebsd.org/cgi/man.cgi?query=bsdlabel&amp;sektion=8&amp;format=html">bsdlabel(8)</a> 來完成。</p></div><div class=paragraph><p>首先先把各硬碟都先清空。 請對各硬碟作下列指令：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># dd if=/dev/zero of=/dev/ad0 count=2</span></code></pre></div></div><div class=paragraph><p>接著，以您慣用的工具來建立 slice 以及設定 label。 通常會建議以 的 Sysinstall 工具來作會比較輕鬆， 或者是強而又不太會出槌的文字介面 UNIX® 標準工具(像是 <a href="https://man.freebsd.org/cgi/man.cgi?query=fdisk&amp;sektion=8&amp;format=html">fdisk(8)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=bsdlabel&amp;sektion=8&amp;format=html">bsdlabel(8)</a>)，這部分稍後也會一併介紹。 前者部分在 FreeBSD Handbook 的 <a href=https://docs.freebsd.org/en/books/handbook/install-steps#install>安裝 FreeBSD</a> 章節有相當詳盡的介紹，所以這邊主要要介紹的是如何建立 RAID-1 系統以及 ZFS。 這邊會介紹建立以 <a href="https://man.freebsd.org/cgi/man.cgi?query=gmirror&amp;sektion=8&amp;format=html">gmirror(8)</a> 做成的小型 mirrored 檔案系統： <span class=filename>/</span> (根目錄), <span class=filename>/usr</span> 以及 <span class=filename>/var</span>，而硬碟的其餘剩餘空間則通通以 <a href="https://man.freebsd.org/cgi/man.cgi?query=zpool&amp;sektion=8&amp;format=html">zpool(8)</a> 做成 ZFS 的 mirrored 檔案系統 。 請注意：必須要先把 FreeBSD 作業系統裝好並開完機後，才能進行設定 ZFS 檔案系統。</p></div><div class=paragraph><p>下面的例子會介紹如何建立 slice 以及 label、在每個分割區上啟用 <a href="https://man.freebsd.org/cgi/man.cgi?query=gmirror&amp;sektion=8&amp;format=html">gmirror(8)</a>、如何在每個 mirrored 分割區上建立 UFS2 檔案系統：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># fdisk -BI /dev/ad0 </span><i class=conum data-value=1></i><b>(1)</b>
<span class=c># fdisk -BI /dev/ad1</span>
<span class=c># bsdlabel -wB /dev/ad0s1 </span><i class=conum data-value=2></i><b>(2)</b>
<span class=c># bsdlabel -wB /dev/ad1s1</span>
<span class=c># bsdlabel -e /dev/ad0s1 </span><i class=conum data-value=3></i><b>(3)</b>
<span class=c># bsdlabel /dev/ad0s1 &gt; /tmp/bsdlabel.txt &amp;&amp; bsdlabel -R /dev/ad1s1 /tmp/bsdlabel.txt </span><i class=conum data-value=4></i><b>(4)</b>
<span class=c># gmirror label root /dev/ad[01]s1a </span><i class=conum data-value=5></i><b>(5)</b>
<span class=c># gmirror label var /dev/ad[01]s1d</span>
<span class=c># gmirror label usr /dev/ad[01]s1e</span>
<span class=c># gmirror label -F swap /dev/ad[01]s1b </span><i class=conum data-value=6></i><b>(6)</b>
<span class=c># newfs /dev/mirror/root </span><i class=conum data-value=7></i><b>(7)</b>
<span class=c># newfs /dev/mirror/var</span>
<span class=c># newfs /dev/mirror/usr</span></code></pre></div></div><div class="colist arabic"><table><tbody><tr><td><i class=conum data-value=1></i><b>1</b></td><td>對該硬碟建立 slice 並且在第零軌處將開機表作初始。 請對該機器所有硬碟都作此一動作。</td></tr><tr><td><i class=conum data-value=2></i><b>2</b></td><td>對各硬碟寫入 label 以及 bootstrap 碼。</td></tr><tr><td><i class=conum data-value=3></i><b>3</b></td><td>現在手動修改該硬碟的 label，至於如何建立分割區(partitions) 請參閱 <a href="https://man.freebsd.org/cgi/man.cgi?query=bsdlabel&amp;sektion=8&amp;format=html">bsdlabel(8)</a> 說明。 分割區分別建立：<code>a</code> 是給 <span class=filename>/</span> (根目錄)， <code>b</code> 給 swap， <code>d</code> 給 <span class=filename>/var</span>， <code>e</code> 給 <span class=filename>/usr</span>， 最後，會在稍後步驟把 <code>f</code> 給 ZFS 使用。</td></tr><tr><td><i class=conum data-value=4></i><b>4</b></td><td>把剛剛的 label 設定先匯出，再匯入到第二顆硬碟上， 如此一來兩邊的硬碟 label 設定就會同樣。</td></tr><tr><td><i class=conum data-value=5></i><b>5</b></td><td>在各分割區上啟用 <a href="https://man.freebsd.org/cgi/man.cgi?query=gmirror&amp;sektion=8&amp;format=html">gmirror(8)</a></td></tr><tr><td><i class=conum data-value=6></i><b>6</b></td><td>請注意：<code>-F</code> 選項是用在 swap 上。 這參數會讓 <a href="https://man.freebsd.org/cgi/man.cgi?query=gmirror&amp;sektion=8&amp;format=html">gmirror(8)</a> 認為該硬體是處於可靠狀態， 即使發生電源故障或系統當掉，也不會去同步。</td></tr><tr><td><i class=conum data-value=7></i><b>7</b></td><td>在各個有做 mirror 的分割區上建立 UFS2 檔案系統</td></tr></tbody></table></div></div><div class=sect2><h3 id=_系統安裝>4.2. 系統安裝<a class=anchor href=#_系統安裝></a></h3><div class=paragraph><p>這裡是最重要的一環， 本節介紹實際上如何在先前一節所做好的硬碟安裝最小化的 FreeBSD， 為了完成此一目標，所有檔案系統都必須掛載妥當，才能讓 Sysinstall 可以把 FreeBSD 裝到硬碟內：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mount /dev/mirror/root /mnt</span>
<span class=c># mkdir /mnt/var /mnt/usr</span>
<span class=c># mount /dev/mirror/var /mnt/var</span>
<span class=c># mount /dev/mirror/usr /mnt/usr</span></code></pre></div></div><div class=paragraph><p>做完上述動作之後，請執行 <a href="https://man.freebsd.org/cgi/man.cgi?query=sysinstall&amp;sektion=8&amp;format=html">sysinstall(8)</a>。 請從主選單中選擇 <span class=guimenuitem>Custom</span> 安裝，選 <span class=guimenuitem>Options</span> 按 <kbd>Enter</kbd>。 然後以方向鍵移動到 <code>Install Root</code> 處，按 <kbd>Space</kbd> 鍵然後改為 <span class=filename>/mnt</span>，再按 <kbd>Enter</kbd> 鍵以將修改值存起來，然後按 <kbd>q</kbd> 鍵即可離開這個 <span class=guimenuitem>Options</span> 畫面。</p></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>請注意：本步驟極為重要，若忽略的話那麼 Sysinstall 就沒辦法安裝 FreeBSD。</p></div></td></tr></tbody></table></div><div class=paragraph><p>接著選 <span class=guimenuitem>Distributions</span>，然後移動游標到 <code>Minimal</code> 處，按 <kbd>Space</kbd> 鍵。 本文之所以介紹最小化安裝是為了要節省網路流量，因為系統安裝是透過 ftp 方式來進行。 要離開本畫面，請選 <code>Exit</code> 即可。</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>至於 <span class=guimenuitem>Partition</span> 及 <span class=guimenuitem>Label</span> 步驟則可略過， 因為這些目前已經都設定完畢了。</p></div></td></tr></tbody></table></div><div class=paragraph><p>在 <span class=guimenuitem>Media</span> 選單中請選 <code>FTP</code>。 請選最近的 mirror 站，並且讓 Sysinstall 假設網路已經設妥。 接下來就會回到 <span class=guimenuitem>Custom</span> 選單。</p></div><div class=paragraph><p>最後，按下 <span class=guimenuitem>Commit</span> 即可開始進行安裝。 完成安裝後，即可離開 Sysinstall。</p></div></div><div class=sect2><h3 id=_後續安裝步驟>4.3. 後續安裝步驟<a class=anchor href=#_後續安裝步驟></a></h3><div class=paragraph><p>此時 FreeBSD 作業系統應該已經裝完，然而還有些後續流程要做。 必須要做一些後續設定，才能讓 FreeBSD 可以開機跟登入。</p></div><div class=paragraph><p>現在必須要用 <a href="https://man.freebsd.org/cgi/man.cgi?query=chroot&amp;sektion=8&amp;format=html">chroot(8)</a> 以切到剛剛新裝好的系統內。 指令如下：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># chroot /mnt</span></code></pre></div></div><div class=paragraph><p>然後再打下列指令以繼續完成：</p></div><div class=ulist><ul><li><p>把 <code>GENERIC</code> kernel 複製到 <span class=filename>/boot/kernel</span> 目錄：</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cp -Rp /boot/GENERIC/* /boot/kernel</span></code></pre></div></div></li><li><p>建立 <span class=filename>/etc/rc.conf</span>, <span class=filename>/etc/resolv.conf</span> 及 <span class=filename>/etc/fstab</span> 檔案。 別忘了，要記得在 <span class=filename>/etc/rc.conf</span> 檔設相關網路設定，以及把 sshd 啟用。 此外， <span class=filename>/etc/fstab</span> 檔應該會長像下面這樣：</p><div class="literalblock programlisting"><div class=content><pre># Device                Mountpoint      FStype  Options         Dump    Pass#
/dev/mirror/swap        none            swap    sw              0       0
/dev/mirror/root        /               ufs     rw              1       1
/dev/mirror/usr         /usr            ufs     rw              2       2
/dev/mirror/var         /var            ufs     rw              2       2
/dev/cd0                /cdrom          cd9660  ro,noauto       0       0</pre></div></div></li><li><p>新增 <span class=filename>/boot/loader.conf</span> 檔， 並且內容填入下列：</p><div class="literalblock programlisting"><div class=content><pre>geom_mirror_load=&#34;YES&#34;
zfs_load=&#34;YES&#34;</pre></div></div></li><li><p>執行下列指令，以在下次開機時啟用 ZFS ：</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># echo &#39;zfs_enable=&#34;YES&#34;&#39; &gt;&gt; /etc/rc.conf</span></code></pre></div></div></li><li><p>使用 <a href="https://man.freebsd.org/cgi/man.cgi?query=adduser&amp;sektion=8&amp;format=html">adduser(8)</a> 工具來新增其他使用者帳號。 別忘了， 至少要有一個帳號得加入 <code>wheel</code> 群組， 才能在重開機後以該帳號切換為 root。</p></li><li><p>再次檢查上述相關的設定，是否有遺漏或打錯。</p></li></ul></div><div class=paragraph><p>現在該系統終於可以重開機了，請用 <a href="https://man.freebsd.org/cgi/man.cgi?query=reboot&amp;sektion=8&amp;format=html">reboot(8)</a> 指令以重開機。</p></div></div></div></div><div class=sect1><h2 id=zfs>5. ZFS<a class=anchor href=#zfs></a></h2><div class=sectionbody><div class=paragraph><p>系統重開機完畢之後，應該就可以登入了。 歡迎使用全新的 FreeBSD 安裝方式， 完全透過遠端而不必接上 remote console！</p></div><div class=paragraph><p>接下來只剩要調整 <a href="https://man.freebsd.org/cgi/man.cgi?query=zpool&amp;sektion=8&amp;format=html">zpool(8)</a> 以及建立 <a href="https://man.freebsd.org/cgi/man.cgi?query=zfs&amp;sektion=8&amp;format=html">zfs(8)</a> 檔案系統而已。 ZFS 的建立及管理是相當淺顯易懂。 首先， 建立 mirrored pool：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zpool create tank mirror /dev/ad[01]s1f</span></code></pre></div></div><div class=paragraph><p>接著，建立檔案系統：</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># zfs create tank/ports</span>
<span class=c># zfs create tank/src</span>
<span class=c># zfs set compression=gzip tank/ports</span>
<span class=c># zfs set compression=on tank/src</span>
<span class=c># zfs set mountpoint=/usr/ports tank/ports</span>
<span class=c># zfs set mountpoint=/usr/src tank/src</span></code></pre></div></div><div class=paragraph><p>一切就是這樣簡單。 若對 FreeBSD 上的 ZFS 細節部分有興趣，請參閱 FreeBSD Wiki 上的 <a href=http://wiki.freebsd.org/ZFS>ZFS</a> 一節說明。</p></div></div></div><hr><div class=last-modified><p><strong>最後修改於</strong>: November 3, 2021 由 <a href="https://cgit.freebsd.org/doc/commit/?id=64acd169b8" target=_blank>Sergio Carlavilla Delgado</a></p></div></div><aside class=toc><div class=toc-content><h3>目錄</h3><nav id=TableOfContents><ul><li><a href=#background>1. 緣起</a></li><li><a href=#intro>2. 介紹</a></li><li><a href=#preparation>3. 準備 - mfsBSD</a></li><li><a href=#installation>4. FreeBSD 作業系統的安裝</a></li><li><a href=#zfs>5. ZFS</a></li></ul></nav><hr><div class=resources><h3>資源</h3><ul class=contents><li><i class="fa fa-file-pdf-o" aria-hidden=true title="下載 PDF"></i><a href=https://download.freebsd.org/doc/zh-tw/articles/remote-install/remote-install_zh-tw.pdf>下載 PDF</a></li><li><i class="fa fa-pencil-square-o" aria-hidden=true title=編輯此頁></i><a href=https://github.com/freebsd/freebsd-doc/blob/main/documentation/content/zh-tw/_index target=_blank>編輯此頁</a></li></ul></div></div></aside></main><footer><div class=footer-container><section class=logo-column><img src=http://172.16.201.134:1313/images/FreeBSD-colors.svg width=160 height=50 alt="FreeBSD logo"><div class=options-container><div class=language-container><a id=languages href=http://172.16.201.134:1313/zh-tw/languages><img src=http://172.16.201.134:1313/images/language.png class=language-image alt=選擇語言>
<span>繁體中文</span></a></div><div class=theme-container><select id=theme-chooser><option value=theme-system>System</option><option value=theme-light>淺色</option><option value=theme-dark>深色</option><option value=theme-high-contrast>高對比</option></select></div></div></section><section class=about-column><h3 class=column-title>About</h3><ul class=column-elements-container><li><a href=https://www.freebsd.org/about/ target=_blank class=column-element>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/ target=_blank class=column-element>FreeBSD Foundation</a></li><li><a href=https://www.freebsd.org/where/ target=_blank class=column-element>Get FreeBSD</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct target=_blank class=column-element>Code of Conduct</a></li><li><a href=https://www.freebsd.org/security/ target=_blank class=column-element>Security Advisories</a></li></ul></section><section class=documentation-column><h3 class=column-title>Documentation</h3><ul class=column-elements-container><li><a href=/zh-tw class=column-element>Documentation portal</a></li><li><a href=https://man.FreeBSD.org target=_blank class=column-element>Manual pages</a></li><li><a href=https://papers.FreeBSD.org target=_blank class=column-element>Presentations and papers</a></li><li><a href=https://docs-archive.freebsd.org/doc/ target=_blank class=column-element>Previous versions</a></li><li><a href=https://docs-archive.freebsd.org/44doc/ target=_blank class=column-element>4.4BSD Documents</a></li><li><a href=https://wiki.freebsd.org/ target=_blank class=column-element>Wiki</a></li></ul></section><section class=community-column><h3 class=column-title>Community</h3><ul class=column-elements-container><li><a href=http://172.16.201.134:1313/zh-tw/articles/contributing class=column-element>Get involved</a></li><li><a href=https://forums.freebsd.org/ target=_blank class=column-element>Community forum</a></li><li><a href=https://lists.freebsd.org/ target=_blank class=column-element>Mailing lists</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank class=column-element>IRC Channels</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank class=column-element>Bug Tracker</a></li></ul></section><section class=legal-column><h3 class=column-title>Legal</h3><ul class=column-elements-container><li><a href=https://freebsdfoundation.org/donate/ target=_blank class=column-element>Donations</a></li><li><a href=https://www.freebsd.org/copyright/freebsd-license/ target=_blank class=column-element>Licensing</a></li><li><a href=https://www.freebsd.org/privacy/ target=_blank class=column-element>Privacy Policy</a></li><li><a href=https://www.freebsd.org/copyright/ target=_blank class=column-element>Legal notices</a></li></ul></section><section class=copyright-column><p>&copy; 1994-2024 The FreeBSD Project. All rights reserved</p><span>Made with <span class=heart>♥</span> by the FreeBSD Community</span></section></div></footer></body></html>