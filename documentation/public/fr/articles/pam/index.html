<!doctype html><html class=theme-light lang=fr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content><meta name=copyright content="1995-2024 The FreeBSD Foundation"><link rel=canonical href=https://docs.freebsd.org/fr/articles/pam/><title>Pluggable Authentication Modules | FreeBSD Documentation Portal</title>
<meta name=theme-color content="#790000"><meta name=color-scheme content="system light dark high-contrast"><link rel="shortcut icon" href=https://docs.freebsd.org/favicon.ico><link rel=stylesheet href=https://docs.freebsd.org/styles/main.min.css><link rel=stylesheet href=https://docs.freebsd.org/css/font-awesome-min.css><script defer src=/js/theme-chooser.min.js></script><script defer src=/js/copy-clipboard.min.js></script><script defer src=/js/search.min.js></script><meta name=twitter:card content="summary"><meta name=twitter:domain content="docs.FreeBSD.org"><meta name=twitter:site content="@freebsd"><meta name=twitter:url content="https://twitter.com/freebsd"><meta property="og:title" content="Pluggable Authentication Modules"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:image" content="https://docs.freebsd.org/favicon.ico"><meta property="og:image:alt" content="FreeBSD Logo"><meta property="og:locale" content="fr"><meta property="og:url" content="https://docs.freebsd.org/fr/articles/pam/"><meta property="og:site_name" content="FreeBSD Documentation Portal"><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","url":"https:\/\/docs.freebsd.org\/fr\/articles\/pam\/","name":"FreeBSD Documentation Portal","headline":"FreeBSD Documentation Portal","description":"FreeBSD Documentation Portal"}</script></head><body><header><div class=header-container><div class=logo-menu-bars-container><a href=https://www.FreeBSD.org class=logo><img src=https://docs.freebsd.org/images/FreeBSD-monochromatic.svg width=160 height=50 alt="FreeBSD logo">
</a><label class=menu-bars for=menu-bars><i class="fa fa-bars" aria-hidden=true></i></label></div><input id=menu-bars type=checkbox><nav><ul class=menu><li class=menu-item><input id=about type=checkbox>
<a href=# aria-label="Navigate to About section"><label class=menu-item-description for=about>About
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/about/ target=_blank>About</a></li><li><a href=https://www.freebsd.org/about/ target=_blank>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/about-us/about-the-foundation/ target=_blank>FreeBSD Foundation</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct/ target=_blank>Code of Conduct</a></li></ul></li><li class=menu-item><input id=download type=checkbox>
<a href=# aria-label="Navigate to get FreeBSD section"><label class=menu-item-description for=download>Get FreeBSD
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/where/ target=_blank>Get FreeBSD</a></li><li><a href=https://www.freebsd.org/releases/ target=_blank>Release Information</a></li><li><a href=https://www.freebsd.org/releng/ target=_blank>Release Engineering</a></li><li><a href=https://www.freebsd.org/security/ target=_blank>Security Advisories</a></li></ul></li><li class=menu-item><input id=documentation type=checkbox>
<a href=# aria-label="Navigate to get Documentation section"><label class=menu-item-description for=documentation>Documentation
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=/fr>Documentation portal</a></li><li><a href=https://docs.freebsd.org/fr/books/handbook>FreeBSD Handbook</a></li><li><a href=https://docs.freebsd.org/fr/books/porters-handbook>Porter's Handbook</a></li><li><a href=https://docs.FreeBSD.org/en/books/fdp-primer>Documentation Project Handbook</a></li><li><a href=https://man.FreeBSD.org target=_blank>Manual pages</a></li><li><a href=https://papers.FreeBSD.org target=_blank>Presentations and papers</a></li><li><a href=https://wiki.FreeBSD.org target=_blank>Wiki</a></li><li><a href=https://docs.freebsd.org/fr/books>Books</a></li><li><a href=https://docs.freebsd.org/fr/articles>Articles</a></li></ul></li><li class=menu-item><input id=community type=checkbox>
<a href=# aria-label="Navigate to get Community section"><label class=menu-item-description for=community>Community
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/community/>Community</a></li><li><a href=https://docs.freebsd.org/fr/articles/contributing>Get involved</a></li><li><a href=https://forums.freebsd.org/ target=_blank>Forum</a></li><li><a href=https://lists.freebsd.org/ target=_blank>Mailing lists</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank>IRC Channels</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank>Bug Tracker</a></li><li><a href=https://www.freebsd.org/support/ target=_blank>Support</a></li></ul></li></ul></nav><div class=search-donate-container><form class=search method=get id=search-header-form action=https://docs.freebsd.org/search name=search-header-form><input type=hidden name=DB value=fr>
<input id=words name=P type=text size=20 maxlength=255>
<button>
<i class="fa fa-search" aria-hidden=true></i></button></form><div class=donate><a href=https://freebsdfoundation.org/donate/ target=_blank><span class=heart>♥</span>
Donate</a></div></div></div></header><main class=main-wrapper-article><div class=article><h1 class=title>Pluggable Authentication Modules</h1><div class="admonitionblock note"><p><i class="fa fa-exclamation-circle" aria-hidden=true></i>
This translation may be out of date. To help with the translations please access the <a href=https://translate-dev.freebsd.org/ target=_blank>FreeBSD translations instance</a>.</p></div><div class=copyright>Copyright © 2001-2003 Networks Associates Technology, Inc.</div><div class=legalnotice><a id=trademarks></a><details><summary>Marques déposées</summary><p>FreeBSD is a registered trademark of the FreeBSD Foundation.</p><p>This article was written for the FreeBSD Project by ThinkSec AS and Network Associates Laboratories, the Security Research Division of Network Associates, Inc. under DARPA/SPAWAR contract N66001-01-C-8035 (“CBOSS”), as part of the DARPA CHATS research program.</p><p>Linux is a registered trademark of Linus Torvalds.</p><p>Motif, OSF/1, and UNIX are registered trademarks and IT DialTone and The Open Group are trademarks of The Open Group in the United States and other countries.</p><p>Sun, Sun Microsystems, Java, Java Virtual Machine, JDK, JRE, JSP, JVM, Netra, OpenJDK, Solaris, StarOffice, SunOS and VirtualBox are trademarks or registered trademarks of Sun Microsystems, Inc. in the United States and other countries.</p><p>Many of the designations used by manufacturers and sellers to distinguish their products are claimed as trademarks. Where those designations appear in this document, and the FreeBSD Project was aware of the trademark claim, the designations have been followed by the “™” or the “®” symbol.</p></details></div><div class=toc-mobile><h3>Sommaire</h3><nav id=TableOfContents><ul><li><a href=#pam-intro>1. Introduction</a></li><li><a href=#pam-trademarks>2. Marques déposées</a></li><li><a href=#pam-terms>3. Termes et conventions</a></li><li><a href=#pam-definitions>4. Définitions</a></li><li><a href=#pam-usage-examples>5. Exemples d’utilisation</a></li><li><a href=#_client_et_serveurs_ne_font_quun>6. Client et serveurs ne font qu’un</a></li><li><a href=#_client_et_serveur_sont_distincts>7. Client et serveur sont distincts.</a></li><li><a href=#_exemple_de_règles>8. Exemple de règles</a></li><li><a href=#pam-conventions>9. Conventions</a></li><li><a href=#pam-essentials>10. Les bases de PAM</a></li><li><a href=#pam-facilities-primitives>11. Mécanismes et primitives</a></li><li><a href=#pam-module-naming>12. Nom des modules</a></li><li><a href=#pam-module-versioning>13. Gestion des versions de module</a></li><li><a href=#pam-chains-policies>14. Chaînes et politiques</a></li><li><a href=#pam-config>15. Configuration de PAM</a></li><li><a href=#pam-config-file-locations>16. Emplacement des fichiers de configuration</a></li><li><a href=#pam-config-breakdown>17. Breakdown of a configuration line</a></li><li><a href=#pam-policies>18. Politiques</a></li><li><a href=#pam-freebsd-modules>19. Les modules PAM de FreeBSD</a></li><li><a href=#pam-modules-ftp>20. pam_ftp(8)</a></li><li><a href=#pam-appl-prog>21. Programmation d’applications PAM</a></li><li><a href=#pam-module-prog>22. Programmation de modules PAM</a></li><li><a href=#pam-sample-appl>Annexe A: Exemples d’application PAM</a></li><li><a href=#pam-sample-module>Annexe B: Exemple d’un module PAM</a></li><li><a href=#pam-sample-conv>Annexe C: Exemple d’une fonction de conversation PAM</a></li><li><a href=#pam-further>Lectures complémentaires</a></li></ul></nav></div><div id=preamble><div class=sectionbody><div class="paragraph abstract-title"><p>Abstract</p></div><div class=paragraph><p>Cet article décrit les principes sous-jacent et les mécanismes de la bibliothèque PAM, il explique comment configurer PAM, l’intégrer dans les applications, et écrire ses propres modules PAM.</p></div><div class=paragraph><p>Version française de Clément Mathieu <code>&lt;<a href=mailto:cykl@mAdchAt.org>cykl@mAdchAt.org</a>></code>.</p></div><hr></div></div><div class=sect1><h2 id=pam-intro>1. Introduction<a class=anchor href=#pam-intro></a></h2><div class=sectionbody><div class=paragraph><p>La bibliothèque PAM est une API généralisée pour les services relevant de l’authentification permettant à un administrateur système d’ajouter une nouvelle méthode d’authentification en ajoutant simplement un nouveau module PAM, ainsi que de modifier les règles d’authentification en éditant les fichiers de configuration.</p></div><div class=paragraph><p>PAM a été conçu et développé en 1995 par Vipin Samar et Charlie Lai de Sun Microsystems, et n’a pas beaucoup évolué depuis. En 1997 l’Open Group publie les premières spécifications XSSO qui standardisent l’API PAM et ajoute des extensions pour un simple (ou plutot intégré) "sign-on". Lors de l’écriture de cet article, la spécification n’a toujours pas été adoptée comme standard.</p></div><div class=paragraph><p>Bien que cet article se concentre principalement sur FreeBSD 5.x, qui utilise OpenPAM, il devrait également être applicable à FreeBSD 4.x qui utilise Linux-PAM, ainsi qu’à d’autres systèmes d’exploitations tels que Linux ou Solaris.</p></div></div></div><div class=sect1><h2 id=pam-trademarks>2. Marques déposées<a class=anchor href=#pam-trademarks></a></h2><div class=sectionbody><div class=paragraph><p>Sun, Sun Microsystems, SunOS and Solaris are trademarks or registered trademarks of Sun Microsystems, Inc.</p></div><div class=paragraph><p>UNIX and The Open Group are trademarks or registered trademarks of The Open Group.</p></div><div class=paragraph><p>All other brand or product names mentioned in this document may be trademarks or registered trademarks of their respective owners.</p></div></div></div><div class=sect1><h2 id=pam-terms>3. Termes et conventions<a class=anchor href=#pam-terms></a></h2><div class=sectionbody></div></div><div class=sect1><h2 id=pam-definitions>4. Définitions<a class=anchor href=#pam-definitions></a></h2><div class=sectionbody><div class=paragraph><p>La terminologie de PAM est plutôt confuse. Ni la publication originale de Samar et Lai, ni la spécification XSSO n’ont essayé de définir formellement des termes pour les acteurs et les entités intervenant dans PAM, les termes qu’ils utilisent (mais ne définissent pas) sont parfois trompeurs et ambigus. Le premier essai d’établir une terminologie consistante et non ambiguë fut un papier écrit par Andrew G. Morgan (l’auteur de Linux-PAM) en 1999. Bien que les choix de Morgan furent un énorme pas en avant, ils ne sont pas parfait d’après l’auteur de ce document. Ce qui suit, largement inspiré par Morgan, est un essai de définir précisément et sans ambiguïté des termes pour chaque acteur ou entité utilisé dans PAM.</p></div><div class="dlist glosslist"><dl><dt class=hdlist1>compte</dt><dd><p>L’ensemble de permissions que le demandeur demande a l’arbitre.</p></dd><dt class=hdlist1>demandeur</dt><dd><p>L’utilisateur ou l’entité demandant authentification.</p></dd><dt class=hdlist1>arbitre</dt><dd><p>L’utilisateur ou l’entité possédant les privilèges nécessaires pour vérifier la requête du demandeur ainsi que l’autorité d’accorder ou de rejeter la requête.</p></dd><dt class=hdlist1>chaîne</dt><dd><p>Une séquence de modules qui sera invoquée pour répondre à une requête PAM. La chaîne comprend les informations concernant l’ordre dans lequel invoquer les modules, les arguments à leur passer et la façon d’interpréter les résultats.</p></dd><dt class=hdlist1>client</dt><dd><p>L’application responsable de la requête d’authentification au nom du demandeur et de recueillir l’information d’authentification nécessaire.</p></dd><dt class=hdlist1>mécanisme</dt><dd><p>Il s’agit de l’un des quatre groupes basiques de fonctionnalités fournit par PAM : authentification, gestion de compte, gestion de session et mise à jour du jeton d’authentification.</p></dd><dt class=hdlist1>module</dt><dd><p>Une collection d’une ou plusieurs fonctions implémentant un service d’authentification particulier, rassemblées dans un fichier binaire (normalement chargeable dynamiquement) et identifié par un nom unique.</p></dd><dt class=hdlist1>règles</dt><dd><p>Le jeu complet de configuration des règles décrivant comment traiter les requêtes PAM pour un service particulier. Une règle consiste normalement en quatre chaînes, une pour chaque mécanisme, bien que quelques services n’utilisent pas les quatre mécanismes.</p></dd><dt class=hdlist1>serveur</dt><dd><p>L’application agissant au nom de l’arbitre pour converser avec le client, récupérer les informations d’authentification, vérifier les droits du demandeur et autoriser ou rejeter la requête.</p></dd><dt class=hdlist1>service</dt><dd><p>Un ensemble de serveurs fournissant des fonctionnalités similaires ou liées et nécessitant une authentification similaire. Les règles de PAM sont définies sur un le principe de par-service; ainsi tous les serveurs qui demandent le même nom de service seront soumis aux mêmes règles.</p></dd><dt class=hdlist1>session</dt><dd><p>Le contexte dans lequel le service est délivré au demandeur par le serveur. L’un des quatre mécanismes de PAM, la gestion de session, s’en occupe exclusivement par la mise en place et le relâchement de ce contexte.</p></dd><dt class=hdlist1>jeton</dt><dd><p>Un morceau d’information associé avec un compte tel qu’un mot de passe ou une passphrase que le demandeur doit fournir pour prouver son identité.</p></dd><dt class=hdlist1>transaction</dt><dd><p>Une séquence de requêtes depuis le même demandeur vers la même instance du même serveur, commençant avec l’authentification et la mise en place de la session et se terminant avec le démontage de la session.</p></dd></dl></div></div></div><div class=sect1><h2 id=pam-usage-examples>5. Exemples d’utilisation<a class=anchor href=#pam-usage-examples></a></h2><div class=sectionbody><div class=paragraph><p>Cette section a pour but d’illustrer quelques-uns des termes définis précédemment à l’aide d’exemples basiques.</p></div></div></div><div class=sect1><h2 id=_client_et_serveurs_ne_font_quun>6. Client et serveurs ne font qu’un<a class=anchor href=#_client_et_serveurs_ne_font_quun></a></h2><div class=sectionbody><div class=paragraph><p>Cet exemple simple montre <code>alice</code> utilisant <a href="https://man.freebsd.org/cgi/man.cgi?query=su&amp;sektion=1&amp;format=html">su(1)</a> pour devenir <code>root</code>.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% <span class=nb>whoami
</span>alice

% <span class=nb>ls</span> <span class=nt>-l</span> <span class=sb>`</span>which su<span class=sb>`</span>
<span class=nt>-r-sr-xr-x</span>  1 root  wheel  10744 Dec  6 19:06 /usr/bin/su

% su -
Password: xi3kiune
<span class=c># whoami</span>
root</code></pre></div></div><div class=ulist><ul><li><p>Le demandeur est <code>alice</code>.</p></li><li><p>Le compte est <code>root</code>.</p></li><li><p>Le processus <a href="https://man.freebsd.org/cgi/man.cgi?query=su&amp;sektion=1&amp;format=html">su(1)</a> est à la fois client et serveur.</p></li><li><p>Le jeton d’authentification est <code>xi3kiune</code>.</p></li><li><p>L’arbitre est <code>root</code>, ce qui explique pourquoi <a href="https://man.freebsd.org/cgi/man.cgi?query=su&amp;sektion=1&amp;format=html">su(1)</a> est setuid <code>root</code>.</p></li></ul></div></div></div><div class=sect1><h2 id=_client_et_serveur_sont_distincts>7. Client et serveur sont distincts.<a class=anchor href=#_client_et_serveur_sont_distincts></a></h2><div class=sectionbody><div class=paragraph><p>L’exemple suivant montre <code>eve</code> essayant d’initier une connexion <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;format=html">ssh(1)</a> vers <code>login.exemple.com</code>, en demandant à se logguer en tant que <code>bob</code>. La connexion réussit. Bob aurait du choisir un meilleur mot de passe !</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% <span class=nb>whoami
</span>eve

% ssh bob@login.example.com
bob@login.example.com<span class=s1>&#39;s password:
% god
Last login: Thu Oct 11 09:52:57 2001 from 192.168.0.1
Copyright (c) 1980, 1983, 1986, 1988, 1990, 1991, 1993, 1994
	The Regents of the University of California.  All rights reserved.
FreeBSD 4.4-STABLE (LOGIN) 4: Tue Nov 27 18:10:34 PST 2001

Welcome to FreeBSD!
%
</span></code></pre></div></div><div class=ulist><ul><li><p>Le demandeur est <code>eve</code>.</p></li><li><p>Le client d'`eve` est représenté par les processus <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;format=html">ssh(1)</a></p></li><li><p>Le serveur est le processus <a href="https://man.freebsd.org/cgi/man.cgi?query=sshd&amp;sektion=8&amp;format=html">sshd(8)</a> sur <code>login.example.com</code></p></li><li><p>Le compte est <code>bob</code>.</p></li><li><p>Le jeton d’identification est <code>god</code>.</p></li><li><p>Bien que cela ne soit pas montré dans cet exemple, l’arbitre est <code>root</code>.</p></li></ul></div></div></div><div class=sect1><h2 id=_exemple_de_règles>8. Exemple de règles<a class=anchor href=#_exemple_de_règles></a></h2><div class=sectionbody><div class=paragraph><p>Les lignes qui suivent sont les règles par défaut de <code>sshd</code>:</p></div><div class="literalblock programlisting"><div class=content><pre>sshd	auth		required	pam_nologin.so	no_warn
sshd	auth		required	pam_unix.so	no_warn try_first_pass
sshd	account		required	pam_login_access.so
sshd	account		required	pam_unix.so
sshd	session		required	pam_lastlog.so	no_fail
sshd	password	required	pam_permit.so</pre></div></div><div class=ulist><ul><li><p>Cette politique s’applique au service <code>sshd</code> (qui n’est pas nécessairement restreint au serveur <a href="https://man.freebsd.org/cgi/man.cgi?query=sshd&amp;sektion=8&amp;format=html">sshd(8)</a>)</p></li><li><p><code>auth</code>, <code>account</code>, <code>session</code> et <code>password</code> sont des mécanismes.</p></li><li><p><span class=filename>pam_nologin.so</span>, <span class=filename>pam_unix.so</span>, <span class=filename>pam_login_access.so</span>, <span class=filename>pam_lastlog.so</span> et <span class=filename>pam_permit.so</span> sont des modules. Il est clair dans cet exemple que <span class=filename>pam_unix.so</span> fournit au moins deux mécanismes ( authentification et gestion de compte).</p></li></ul></div></div></div><div class=sect1><h2 id=pam-conventions>9. Conventions<a class=anchor href=#pam-conventions></a></h2><div class=sectionbody><div class=paragraph><p>Cette section n’a pas encore été écrite.</p></div></div></div><div class=sect1><h2 id=pam-essentials>10. Les bases de PAM<a class=anchor href=#pam-essentials></a></h2><div class=sectionbody></div></div><div class=sect1><h2 id=pam-facilities-primitives>11. Mécanismes et primitives<a class=anchor href=#pam-facilities-primitives></a></h2><div class=sectionbody><div class=paragraph><p>L’API PAM fournit six primitives d’authentification différentes regroupées dans quatre mécanismes qui seront décrits dans la partie suivante.</p></div><div class=dlist><dl><dt class=hdlist1><code>auth</code></dt><dd><p><em>Authentification.</em> Ce mécanisme concerne l’authentification du demandeur et établit les droits du compte. Il fournit deux primitives :</p><div class=ulist><ul><li><p><a href="https://man.freebsd.org/cgi/man.cgi?query=pam_authenticate&amp;sektion=3&amp;format=html">pam_authenticate(3)</a> authentifie le demandeur, généralement en demandant un jeton d’identification et en le comparant a une valeur stockée dans une base de données ou obtenue par le biais d’un serveur d’authentification.</p></li><li><p><a href="https://man.freebsd.org/cgi/man.cgi?query=pam_setcred&amp;sektion=3&amp;format=html">pam_setcred(3)</a> établi les paramètres du compte tel que l’uid, les groupes dont le compte fait parti ou les limites sur l’utilisation des ressources.</p></li></ul></div></dd><dt class=hdlist1><code>account</code></dt><dd><p><em>Gestion de compte.</em> Ce mécanisme concerne la disponibilité du compte pour des raisons autres que l’authentification. Par exemple les restrictions basées sur l’heure courante ou la charge du serveur. Il fournit une seule primitive:</p><div class=ulist><ul><li><p><a href="https://man.freebsd.org/cgi/man.cgi?query=pam_acct_mgmt&amp;sektion=3&amp;format=html">pam_acct_mgmt(3)</a> vérifie que le compte demandé est disponible.</p></li></ul></div></dd><dt class=hdlist1><code>session</code></dt><dd><p><em>Gestion de session.</em> Ce mécanisme concerne la mise en place de la session et sa terminaison, par exemple l’enregistrement de la session dans les journaux. Il fournit deux primitives:</p><div class=ulist><ul><li><p><a href="https://man.freebsd.org/cgi/man.cgi?query=pam_open_session&amp;sektion=3&amp;format=html">pam_open_session(3)</a> accomplie les tâches associées à la mise en place d’une session : ajouter une entrée dans les bases <span class=filename>utmp</span> et <span class=filename>wtmp</span>, démarrer un agent SSH…​</p></li><li><p><a href="https://man.freebsd.org/cgi/man.cgi?query=pam_close_session&amp;sektion=3&amp;format=html">pam_close_session(3)</a> accomplie les tâches associées à la terminaison d’une session : ajouter une entrée dans les bases <span class=filename>utmp</span> et <span class=filename>wtmp</span>, arrêter l’agent SSH…​</p></li></ul></div></dd><dt class=hdlist1><code>password</code></dt><dd><p><em>Gestion des mots de passe.</em> Ce mécanisme est utilisé pour modifier le jeton d’authentification associé à un compte, soit parce qu’il a expiré, soit parce que l’utilisateur désire le changer. Il fournit une seule primitive:</p><div class=ulist><ul><li><p><a href="https://man.freebsd.org/cgi/man.cgi?query=pam_chauthtok&amp;sektion=3&amp;format=html">pam_chauthtok(3)</a> modifie le jeton d’authentification, et éventuellement vérifie que celui-ci est assez robuste pour ne pas être deviné facilement ou qu’il n’a pas déjà utilisé.</p></li></ul></div></dd></dl></div><div class=sect2><h3 id=pam-modules>11.1. Modules<a class=anchor href=#pam-modules></a></h3><div class=paragraph><p>Les modules sont le concept clef de PAM; après tout ils constituent le "M" de PAM. Un module PAM est lui-même un morceau de code qui implémente les primitives d’un ou plusieurs mécanismes pour une forme particulière d’authentification; par exemple, les bases de mots de passe UNIX que sont NIS, LDAP et Radius.</p></div></div></div></div><div class=sect1><h2 id=pam-module-naming>12. Nom des modules<a class=anchor href=#pam-module-naming></a></h2><div class=sectionbody><div class=paragraph><p>FreeBSD implémente chaque mécanismes dans un module distinct nommé <code>pam_mécanisme.so</code> (par exemple <code>pam_unix.so</code> pour le mécanisme Unix .) Les autres implementations possèdent parfois des modules séparés pour des mécanismes séparés et incluent aussi bien le nom du service que celui du mécanisme dans le nom du module. Un exemple est le module <code>pam_dial_auth.so.1</code> de Solaris qui est utilisé pour authentifier les utilisateurs dialup.</p></div></div></div><div class=sect1><h2 id=pam-module-versioning>13. Gestion des versions de module<a class=anchor href=#pam-module-versioning></a></h2><div class=sectionbody><div class=paragraph><p>L’implémentation originale de PAM par FreeBSD, basée sur Linux-PAM, n’utilisait pas de numéro de version pour les modules PAM. Ceci peut poser des problèmes avec les applications tiers qui peuvent être liées avec d’anciennes bibliothèques systèmes, puisqu’il n’y a pas possibilité de charger la version correspondante du module désiré.</p></div><div class=paragraph><p>Pour sa part, OpenPAM cherche les modules qui ont la même version que la bibliothèque PAM (pour le moment 2) et se rabat sur un module sans version si aucun module avec version n’a put être chargé. Ainsi les anciens modules peuvent être fournis pour les anciennes applications, tout en permettant aux nouvelles applications (ou bien nouvellement compilées) de tirer parti des modules les plus récents.</p></div><div class=paragraph><p>Bien que les modules PAM de Solaris possèdent généralement un numéro de version, ils ne sont pas réellement versionnés car le numéro correspond à une partie du nom du module et doit être inclus dans la configuration.</p></div></div></div><div class=sect1><h2 id=pam-chains-policies>14. Chaînes et politiques<a class=anchor href=#pam-chains-policies></a></h2><div class=sectionbody><div class=paragraph><p>Lorsqu’un serveur initie une transaction PAM, la bibliothèque PAM essaie de charger une politique pour le service spécifié dans l’appel a <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_start&amp;sektion=3&amp;format=html">pam_start(3)</a> . La politique indique comment la requête d’authentification doit être traitée et est définie dans un fichier de configuration. Il s’agit de l’autre concept clef de PAM : la possibilité pour l’administrateur de configurer la politique de sécurité d’un système en éditant simplement une fichier texte.</p></div><div class=paragraph><p>Une politique consiste en quatre chaînes, une pour chacune des quatre mécanismes de PAM. Chaque chaîne est une suite de règles de configuration, chacune spécifiant un module à invoquer, des paramètres, options, à passer au module et un drapeau de contrôle qui décrit comment interpréter le code de retour du module.</p></div><div class=paragraph><p>Comprendre le drapeau de contrôle est essentiel pour comprendre les fichiers de configuration de PAM. Il existe quatre drapeaux de contrôle différents :</p></div><div class=dlist><dl><dt class=hdlist1><code>binding</code></dt><dd><p>Si le module réussit et qu’aucun module précédent de la chaîne n’a échoué, la chaîne s’interrompt immédiatement et la requête est autorisée. Si le module échoue le reste de la chaîne est exécuté, mais la requête est rejetée au final.</p><div class=paragraph><p>Ce drapeau de contrôle a été introduit par Sun Solaris dans la version 9 (SunOS 5.9); il est aussi supporté par OpenPAM.</p></div></dd><dt class=hdlist1><code>required</code></dt><dd><p>Si le module réussit, le reste de la chaîne est exécuté, et la requête est autorisée si aucun des autres modules n’échoue. Si le module échoue, le reste de la chaîne est exécuté, mais au final la requête est rejetée.</p></dd><dt class=hdlist1><code>requisite</code></dt><dd><p>Si le module réussit le reste de la chaîne est exécuté, et la requête est autorisée sauf si d’autres modules échoués. Si le module échoue la chaîne est immédiatement terminée et la requête est rejetée.</p></dd><dt class=hdlist1><code>sufficient</code></dt><dd><p>Si le module réussit et qu’aucun des modules précédent n’a échoué la chaîne est immédiatement terminée et la requête est allouée. Si le module échoue il est ignore et le reste de la chaîne est exécuté.</p><div class=paragraph><p>Puisque la sémantique de ce drapeau peut être un peu confuse, spécialement lorsqu’il s’agit de celui du dernier module de la chaîne, il est recommandé d’utiliser le drapeau <code>binding</code> à la place de celui-ci sous la condition que l’implémentation le supporte.</p></div></dd><dt class=hdlist1><code>optional</code></dt><dd><p>Le module est exécuté mais le résultat est ignoré. Si tout les modules de la chaîne sont marqués <code>optional</code>, toutes les requêtes seront toujours acceptées.</p></dd></dl></div><div class=paragraph><p>Lorsqu’un serveur invoque l’une des six primitives PAM, PAM récupère la chaîne du mécanisme à laquelle la requête correspond et invoque chaque module de la chaîne dans l’ordre indiqué, jusqu’à ce que la fin soit atteinte ou qu’aucune exécution supplémentaire ne soit nécessaire (soit à cause du succès d’un module en <code>binding</code> ou <code>sufficient</code>, soit à cause de l’échec d’un module <code>requisite</code>). La requête est acceptée si et seulement si au moins un module a été invoqué, et que tout les modules non optionnels ont réussi.</p></div><div class=paragraph><p>Notez qu’il est possible, bien que peu courant, d’avoir le même module listé plusieurs fois dans la même chaîne. Par exemple un module qui détermine le nom utilisateur et le mot de passe à l’aide d’un serveur directory peut être invoqué plusieurs fois avec des paramètres spécifiant différents serveurs a contacter. PAM considère les différentes occurrences d’un même module dans une même chaîne comme des modules différents et non liés.</p></div><div class=sect2><h3 id=pam-transactions>14.1. Transactions<a class=anchor href=#pam-transactions></a></h3><div class=paragraph><p>Le cycle de vie d’une transaction PAM typique est décrit ci-dessous. Notez que si l’une de ces étapes échoue, le serveur devrait reporter un message d’erreur au client et arrêter la transaction.</p></div><div class="olist arabic"><ol class=arabic><li><p>Si nécessaire, le serveur obtient les privilèges de l’arbitre par le biais d’un mécanisme indépendant de PAM - généralement en ayant été démarré par <code>root</code> ou en étant setuid <code>root</code>.</p></li><li><p>Le serveur appel <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_start&amp;sektion=3&amp;format=html">pam_start(3)</a> afin d’initialiser la bibliothèque PAM et indique le service et le compte cible, et enregistre une fonction de conversation appropriée.</p></li><li><p>Le serveur obtient diverses informations concernant la transaction (tel que le nom d’utilisateur du demandeur et le nom d’hôte de la machine sur lequel le client tourne) et les soumet à PAM en utilisant la fonction <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_set_item&amp;sektion=3&amp;format=html">pam_set_item(3)</a>.</p></li><li><p>Le serveur appel <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_authenticate&amp;sektion=3&amp;format=html">pam_authenticate(3)</a> pour authentifier le demandeur.</p></li><li><p>Le serveur appel la fonction <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_acct_mgmt&amp;sektion=3&amp;format=html">pam_acct_mgmt(3)</a> qui vérifie que le compte est valide et disponible. Si le mot de passe est correct mais a expiré, <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_acct_mgmt&amp;sektion=3&amp;format=html">pam_acct_mgmt(3)</a> retournera <code>PAM_NEW_AUTHTOK_REQD</code> à la place de <code>PAM_SUCCESS</code>.</p></li><li><p>Si l’étape précédente a retourné <code>PAM_NEW_AUTHTOK_REQD</code>, le serveur appel maintenant <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_chauthtok&amp;sektion=3&amp;format=html">pam_chauthtok(3)</a> pour obliger l’utilisateur à changer le jeton d’authentification du compte désiré.</p></li><li><p>Maintenant que le demandeur a été correctement authentifié, le serveur appelle <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_setcred&amp;sektion=3&amp;format=html">pam_setcred(3)</a> pour obtenir les privilèges du compte désiré. Il lui est possible de faire ceci parce qu’il agit au nom de l’arbitre dont il possède les privilèges.</p></li><li><p>Lorsque les privilèges corrects ont été établi le serveur appelle <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_open_session&amp;sektion=3&amp;format=html">pam_open_session(3)</a> pour mettre en place la session.</p></li><li><p>Maintenant le serveur effectue les services demandés par le client - par exemple fournir un shell au demandeur.</p></li><li><p>Lorsque le serveur a fini de servir le client, il appelle <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_close_session&amp;sektion=3&amp;format=html">pam_close_session(3)</a> afin de terminer la session.</p></li><li><p>Pour finir, le serveur appelle <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_end&amp;sektion=3&amp;format=html">pam_end(3)</a> afin signaler à la bibliothèque PAM que la transaction se termine et qu’elle peut libérer les ressources qu’elle a alloué au cours de la transaction.</p></li></ol></div></div></div></div><div class=sect1><h2 id=pam-config>15. Configuration de PAM<a class=anchor href=#pam-config></a></h2><div class=sectionbody></div></div><div class=sect1><h2 id=pam-config-file-locations>16. Emplacement des fichiers de configuration<a class=anchor href=#pam-config-file-locations></a></h2><div class=sectionbody><div class=paragraph><p>Le fichier de configuration de PAM est traditionnellement <span class=filename>/etc/pam.conf</span>. Ce fichier contient toutes les politiques de PAM pour votre système. Chaque ligne du fichier décrit une étape dans une chaîne, tel que nous allons le voir ci-dessous:</p></div><div class="literalblock programlisting"><div class=content><pre>login   auth    required        pam_nologin.so  no_warn</pre></div></div><div class=paragraph><p>Les champs sont respectivement, le service, le nom du mécanisme, le drapeau de contrôle, le nom du module et les arguments du module. Tout champ additionnel est considéré comme argument du module.</p></div><div class=paragraph><p>Une chaîne différente est construite pour chaque couple service/mécanisme; ainsi, alors que l’ordre des lignes est important lorsqu’il s’agit des mêmes services ou mécanismes, l’ordre dans lequel les différents services et mécanismes apparaissent ne l’est pas - excepté l’entrée pour le service <code>other</code>, qui sert de référence par défaut et doit être placé à la fin. L’exemple du papier original sur PAM regroupait les lignes de configurations par mécanisme et le fichier <span class=filename>pam.conf</span> de Solaris le fait toujours, mais FreeBSD groupe les lignes de configuration par service. Toutefois il ne s’agit pas de la seule possibilité et les autres possèdent aussi un sens.</p></div><div class=paragraph><p>OpenPAM et Linux-PAM offrent un mécanisme de configuration alternatif où les politiques sont placées dans des fichiers séparés portant le nom du service auquel ils s’appliquent. Ces fichiers sont situés dans <span class=filename>/etc/pam.d/</span> et ne contiennent que quatre champs à la place de cinq - le champ contenant le nom du service est omis. Il s’agit du mode par défaut dans FreeBSD 4.x. Notez que si le fichier <span class=filename>/etc/pam.conf</span> existe et contient des informations de configuration pour des services qui n’ont pas de politique spécifiée dans <span class=filename>/etc/pam.d</span>, ils seront utilisés pour ces services.</p></div><div class=paragraph><p>Le gros avantage de <span class=filename>/etc/pam.d/</span> sur <span class=filename>/etc/pam.conf</span> est qu’il est possible d’utiliser la même politique pour plusieurs services en liant chaque nom de service à un fichier de configuration. Par exemple pour utiliser la même politique pour les services <code>su</code> et <code>sudo</code>, nous pouvons faire comme ceci :</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /etc/pam.d</span>
<span class=c># ln -s su sudo</span></code></pre></div></div><div class=paragraph><p>Ceci fonctionne car le nom de service est déterminé a partir du nom de fichier plutôt qu’indiqué à l’intérieur du fichier de configuration, ainsi le même fichier peut être utilisé pour des services nommés différemment.</p></div><div class=paragraph><p>Un autre avantage est qu’un logiciel tiers peu facilement installer les politiques pour ses services sans avoir besoin d’éditer <span class=filename>/etc/pam.conf</span>. Pour continuer la tradition de FreeBSD, OpenPAM regardera dans <span class=filename>/usr/local/etc/pam.d</span> pour trouver les fichiers de configurations; puis si aucun n’est trouvé pour le service demandé, il cherchera dans <span class=filename>/etc/pam.d/</span> ou <span class=filename>/etc/pam.conf</span>.</p></div><div class=paragraph><p>Finalement, quelque soit le mécanisme que vous choisissiez, la politique "magique"`other` est utilisée par défaut pour tous les services qui n’ont pas leur propre politique.</p></div></div></div><div class=sect1><h2 id=pam-config-breakdown>17. Breakdown of a configuration line<a class=anchor href=#pam-config-breakdown></a></h2><div class=sectionbody><div class=paragraph><p>Comme expliqué dans <a href=#pam-config-file-locations>Emplacement des fichiers de configuration</a>, chaque ligne de <span class=filename>pam.conf</span> consiste en quatre champs ou plus: le nom de service, le nom du mécanisme, le drapeau de contrôle, le nom du module et la présence ou non d’arguments pour le module.</p></div><div class=paragraph><p>Le nom du service est généralement, mais pas toujours, le nom de l’application auquelle les règles s’appliquent. Si vous n’êtes pas sûr, référez vous à la documentation de l’application pour déterminer quel nom de service elle utilise.</p></div><div class=paragraph><p>Notez que si vous utilisez <span class=filename>/etc/pam.d/</span> à la place de <span class=filename>/etc/pam.conf</span>, le nom du service est spécifié par le nom du fichier de configuration et n’est pas indiqué dans les lignes de configuration qui, dès lors, commencent par le nom du mécanisme.</p></div><div class=paragraph><p>Le mécanisme est l’un des quatre mots clef décrit dans <a href=#pam-facilities-primitives>Mécanismes et primitives</a>.</p></div><div class=paragraph><p>De même, le drapeau de contrôle est l’un des quatre mots clef décrits dans <a href=#pam-chains-policies>Chaînes et politiques</a> et décrit comment le module doit interpréter le code de retour du module. Linux-PAM supporte une syntaxe alternative qui vous laisse spécifier l’action à associer à chaque code de retour possible; mais ceci devrait être évité puisque ce n’est pas standard et étroitement lié à la façon dont Linux-PAM appelle les services (qui diffère grandement de la façon de Solaris et OpenPAM). C’est sans étonnement que l’on apprend qu’OpenPAM ne supporte pas cette syntaxe.</p></div></div></div><div class=sect1><h2 id=pam-policies>18. Politiques<a class=anchor href=#pam-policies></a></h2><div class=sectionbody><div class=paragraph><p>Pour configurer PAM correctement, il est essentiel de comprendre comment les politiques sont interprétées.</p></div><div class=paragraph><p>Lorsqu’une application appelle <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_start&amp;sektion=3&amp;format=html">pam_start(3)</a> la bibliothèque PAM charge la politique du service spécifié et construit les quatre chaînes de module (une pour chaque mécanisme). Si une ou plusieurs chaînes sont vides, les chaînes de la politique du service <code>other</code> sont utilisées.</p></div><div class=paragraph><p>Plus tard, lorsque l’application appelle l’une des six primitives PAM, la bibliothèque PAM récupère la chaîne du mécanisme correspondant et appelle la fonction appropriée avec chaque module listé dans la chaîne. Après chaque appel d’une fonction de service, le type du module et le code d’erreur sont retournés par celle-ci pour déterminer quoi faire. À quelques exceptions près, dont nous parlerons plus tard, la table suivante s’applique:</p></div><table class="tableblock frame-all grid-all stretch"><caption class=title>Tableau 1. Résumé de la chaîne d’exécution PAM</caption><col style=width:25%><col style=width:25%><col style=width:25%><col style=width:25%><thead><tr><th class="tableblock halign-left valign-top"></th><th class="tableblock halign-left valign-top">PAM_SUCCESS</th><th class="tableblock halign-left valign-top">PAM_IGNORE</th><th class="tableblock halign-left valign-top">other</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock>binding</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>if (!fail) break;</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>-</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>fail = true;</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>required</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>-</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>-</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>fail = true;</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>requisite</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>-</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>-</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>fail = true; break;</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>sufficient</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>if (!fail) break;</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>-</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>-</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>optional</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>-</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>-</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>-</p></td></tr></tbody></table><div class=paragraph><p>Si <code>fail</code> est vrai à la fin de la chaîne, ou lorsqu’un "break" est atteint, le dispatcheur retourne le code d’erreur renvoyé par le premier module qui a échoué. Autrement <code>PAM_SUCCESS</code> est retourné.</p></div><div class=paragraph><p>La première exception est que le code d’erreur <code>PAM_NEW_AUTHOK_REQD</code> soit considéré comme un succès, sauf si aucun module n’échoue et qu’au moins un module retourne <code>PAM_NEW_AUTHOK_REQD</code> le dispatcheur retournera <code>PAM_NEW_AUTHOK_REQD</code>.</p></div><div class=paragraph><p>La seconde exception est que <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_setcred&amp;sektion=3&amp;format=html">pam_setcred(3)</a> considère les modules <code>binding</code> et <code>sufficient</code> comme s’ils étaient <code>required</code>.</p></div><div class=paragraph><p>La troisième et dernière exception est que <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_chauthtok&amp;sektion=3&amp;format=html">pam_chauthtok(3)</a> exécute la totalité de la chaîne deux fois (la première pour des vérifications préliminaires et la deuxième pour mettre le mot de passe) et lors de la première exécution il considère les modules <code>binding</code> et <code>sufficient</code> comme s’ils étaient <code>required</code>.</p></div></div></div><div class=sect1><h2 id=pam-freebsd-modules>19. Les modules PAM de FreeBSD<a class=anchor href=#pam-freebsd-modules></a></h2><div class=sectionbody><div class=sect2><h3 id=pam-modules-deny>19.1. <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_deny&amp;sektion=8&amp;format=html">pam_deny(8)</a><a class=anchor href=#pam-modules-deny></a></h3><div class=paragraph><p>Le module <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_deny&amp;sektion=8&amp;format=html">pam_deny(8)</a> est l’un des modules disponibles les plus simples; il répond à n’importe qu’elle requête par <code>PAM_AUTH_ERR</code>. Il est utile pour désactiver rapidement un service (ajoutez-le au début de chaque chaîne), ou pour terminer les chaînes de modules <code>sufficient</code>.</p></div></div><div class=sect2><h3 id=pam-modules-echo>19.2. <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_echo&amp;sektion=8&amp;format=html">pam_echo(8)</a><a class=anchor href=#pam-modules-echo></a></h3><div class=paragraph><p>Le module <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_echo&amp;sektion=8&amp;format=html">pam_echo(8)</a> passe simplement ses arguments à la fonction de conversation comme un message <code>PAM_TEXT_INFO</code>. Il est principalement utilisé pour le debogage mais il peut aussi servir à afficher un message tel que "Les accès illégaux seront poursuivits" avant de commencer la procédure d’authentification.</p></div></div><div class=sect2><h3 id=pam-modules-exec>19.3. <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_exec&amp;sektion=8&amp;format=html">pam_exec(8)</a><a class=anchor href=#pam-modules-exec></a></h3><div class=paragraph><p>Le module <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_exec&amp;sektion=8&amp;format=html">pam_exec(8)</a> prend comme premier argument le nom du programme à exécuter, les arguments restant étant utilisés comme arguments pour ce programme. L’une des applications possibles est d’utiliser un programme qui monte le répertoire de l’utilisateur lors du login.</p></div></div></div></div><div class=sect1><h2 id=pam-modules-ftp>20. pam_ftp(8)<a class=anchor href=#pam-modules-ftp></a></h2><div class=sectionbody><div class=paragraph><p>Le module pam_ftp(8)</p></div><div class=sect2><h3 id=pam-modules-ftpusers>20.1. <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_ftpusers&amp;sektion=8&amp;format=html">pam_ftpusers(8)</a><a class=anchor href=#pam-modules-ftpusers></a></h3><div class=paragraph><p>Le module <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_ftpusers&amp;sektion=8&amp;format=html">pam_ftpusers(8)</a></p></div></div><div class=sect2><h3 id=pam-modules-group>20.2. <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_group&amp;sektion=8&amp;format=html">pam_group(8)</a><a class=anchor href=#pam-modules-group></a></h3><div class=paragraph><p>Le module <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_group&amp;sektion=8&amp;format=html">pam_group(8)</a> accepte ou rejette le demandeur à partir de son appartenance à un groupe particulier (généralement <code>wheel</code> pour <a href="https://man.freebsd.org/cgi/man.cgi?query=su&amp;sektion=1&amp;format=html">su(1)</a>). Il a pour but premier de conserver le comportement traditionnel de <a href="https://man.freebsd.org/cgi/man.cgi?query=su&amp;sektion=1&amp;format=html">su(1)</a> mais possède d’autres applications comme par exemple exclure un certain groupe d’utilisateurs d’un service particulier.</p></div></div><div class=sect2><h3 id=pam-modules-krb5>20.3. <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_krb5&amp;sektion=8&amp;format=html">pam_krb5(8)</a><a class=anchor href=#pam-modules-krb5></a></h3><div class=paragraph><p>Le module <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_krb5&amp;sektion=8&amp;format=html">pam_krb5(8)</a></p></div></div><div class=sect2><h3 id=pam-modules-ksu>20.4. <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_ksu&amp;sektion=8&amp;format=html">pam_ksu(8)</a><a class=anchor href=#pam-modules-ksu></a></h3><div class=paragraph><p>Le module <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_ksu&amp;sektion=8&amp;format=html">pam_ksu(8)</a></p></div></div><div class=sect2><h3 id=pam-modules-lastlog>20.5. <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_lastlog&amp;sektion=8&amp;format=html">pam_lastlog(8)</a><a class=anchor href=#pam-modules-lastlog></a></h3><div class=paragraph><p>Le module <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_lastlog&amp;sektion=8&amp;format=html">pam_lastlog(8)</a></p></div></div><div class=sect2><h3 id=pam-modules-login-access>20.6. <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_login_access&amp;sektion=8&amp;format=html">pam_login_access(8)</a><a class=anchor href=#pam-modules-login-access></a></h3><div class=paragraph><p>Le module <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_login_access&amp;sektion=8&amp;format=html">pam_login_access(8)</a></p></div></div><div class=sect2><h3 id=pam-modules-nologin>20.7. <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_nologin&amp;sektion=8&amp;format=html">pam_nologin(8)</a><a class=anchor href=#pam-modules-nologin></a></h3><div class=paragraph><p>Le module <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_nologin&amp;sektion=8&amp;format=html">pam_nologin(8)</a></p></div></div><div class=sect2><h3 id=pam-modules-opie>20.8. <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_opie&amp;sektion=8&amp;format=html">pam_opie(8)</a><a class=anchor href=#pam-modules-opie></a></h3><div class=paragraph><p>Le module <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_opie&amp;sektion=8&amp;format=html">pam_opie(8)</a> implémente la méthode d’authentification <a href="https://man.freebsd.org/cgi/man.cgi?query=opie&amp;sektion=4&amp;format=html">opie(4)</a>. Le système <a href="https://man.freebsd.org/cgi/man.cgi?query=opie&amp;sektion=4&amp;format=html">opie(4)</a> est un mécanisme de challenge-response où la réponse à chaque challenge est une fonction directe du challenge et une phrase de passe, ainsi la réponse peut facilement être calculée "en temps voulu" par n’importe qui possédant la phrase de passe ce qui élimine le besoin d’une liste de mots de passe. De plus, puisque <a href="https://man.freebsd.org/cgi/man.cgi?query=opie&amp;sektion=4&amp;format=html">opie(4)</a> ne réutilise jamais un mot de passe qui a reçu une réponse correcte, il n’est pas vulnérable aux attaques basée sur le rejouage.</p></div></div><div class=sect2><h3 id=pam-modules-opieaccess>20.9. <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_opieaccess&amp;sektion=8&amp;format=html">pam_opieaccess(8)</a><a class=anchor href=#pam-modules-opieaccess></a></h3><div class=paragraph><p>Le module <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_opieaccess&amp;sektion=8&amp;format=html">pam_opieaccess(8)</a> est un compagnon du module <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_opie&amp;sektion=8&amp;format=html">pam_opie(8)</a>. Son but est de renforcer les restrictions codifiées dans <a href="https://man.freebsd.org/cgi/man.cgi?query=opieaccess&amp;sektion=5&amp;format=html">opieaccess(5)</a>, il régule les conditions sous lesquelles un utilisateur qui normalement devrait s’authentifier par <a href="https://man.freebsd.org/cgi/man.cgi?query=opie&amp;sektion=4&amp;format=html">opie(4)</a> est amené à utiliser d’autres méthodes. Ceci est généralement utilisé pour interdire l’authentification par mot de passe depuis des hôtes non digne de confiance.</p></div><div class=paragraph><p>Pour être réellement effectif, le module <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_opieaccess&amp;sektion=8&amp;format=html">pam_opieaccess(8)</a> doit être listé comme <code>requisite</code> immédiatement après une entrée <code>sufficient</code> pour <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_opie&amp;sektion=8&amp;format=html">pam_opie(8)</a> et avant tout autre module, dans la chaîne <code>auth</code>.</p></div></div><div class=sect2><h3 id=pam-modules-passwdqc>20.10. <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_passwdqc&amp;sektion=8&amp;format=html">pam_passwdqc(8)</a><a class=anchor href=#pam-modules-passwdqc></a></h3><div class=paragraph><p>Le module <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_passwdqc&amp;sektion=8&amp;format=html">pam_passwdqc(8)</a></p></div></div><div class=sect2><h3 id=pam-modules-permit>20.11. <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_permit&amp;sektion=8&amp;format=html">pam_permit(8)</a><a class=anchor href=#pam-modules-permit></a></h3><div class=paragraph><p>Le module <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_permit&amp;sektion=8&amp;format=html">pam_permit(8)</a> est l’un des modules disponibles les plus simples; il répond à n’importe quelle requête par <code>PAM_SUCCESS</code>. Il est utile pour les services où une ou plusieurs chaînes auraient autrement été vides.</p></div></div><div class=sect2><h3 id=pam-modules-radius>20.12. <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_radius&amp;sektion=8&amp;format=html">pam_radius(8)</a><a class=anchor href=#pam-modules-radius></a></h3><div class=paragraph><p>Le module <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_radius&amp;sektion=8&amp;format=html">pam_radius(8)</a></p></div></div><div class=sect2><h3 id=pam-modules-rhosts>20.13. <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_rhosts&amp;sektion=8&amp;format=html">pam_rhosts(8)</a><a class=anchor href=#pam-modules-rhosts></a></h3><div class=paragraph><p>Le module <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_rhosts&amp;sektion=8&amp;format=html">pam_rhosts(8)</a></p></div></div><div class=sect2><h3 id=pam-modules-rootok>20.14. <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_rootok&amp;sektion=8&amp;format=html">pam_rootok(8)</a><a class=anchor href=#pam-modules-rootok></a></h3><div class=paragraph><p>Le module <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_rootok&amp;sektion=8&amp;format=html">pam_rootok(8)</a> retourne un succès si et seulement si l’identifiant d’utilisateur réel du processus appelant est 0. Ceci est utile pour les services non basés sur le réseau tel que <a href="https://man.freebsd.org/cgi/man.cgi?query=su&amp;sektion=1&amp;format=html">su(1)</a> ou <a href="https://man.freebsd.org/cgi/man.cgi?query=passwd&amp;sektion=1&amp;format=html">passwd(1)</a> où l’utilisateur <code>root</code> doit avoir un accès automatique.</p></div></div><div class=sect2><h3 id=pam-modules-securetty>20.15. <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_securetty&amp;sektion=8&amp;format=html">pam_securetty(8)</a><a class=anchor href=#pam-modules-securetty></a></h3><div class=paragraph><p>Le module <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_securetty&amp;sektion=8&amp;format=html">pam_securetty(8)</a></p></div></div><div class=sect2><h3 id=pam-modules-self>20.16. <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_self&amp;sektion=8&amp;format=html">pam_self(8)</a><a class=anchor href=#pam-modules-self></a></h3><div class=paragraph><p>Le module <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_self&amp;sektion=8&amp;format=html">pam_self(8)</a> retourne un succès si et seulement si le nom du demandeur correspond au nom du compte désiré. Il est utile pour les services non basés sur le réseau tel que <a href="https://man.freebsd.org/cgi/man.cgi?query=su&amp;sektion=1&amp;format=html">su(1)</a> où l’identité du demandeur peut être vérifiée facilement .</p></div></div><div class=sect2><h3 id=pam-modules-ssh>20.17. <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_ssh&amp;sektion=8&amp;format=html">pam_ssh(8)</a><a class=anchor href=#pam-modules-ssh></a></h3><div class=paragraph><p>Le module <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_ssh&amp;sektion=8&amp;format=html">pam_ssh(8)</a></p></div></div><div class=sect2><h3 id=pam-modules-tacplus>20.18. <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_tacplus&amp;sektion=8&amp;format=html">pam_tacplus(8)</a><a class=anchor href=#pam-modules-tacplus></a></h3><div class=paragraph><p>Le module <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_tacplus&amp;sektion=8&amp;format=html">pam_tacplus(8)</a></p></div></div><div class=sect2><h3 id=pam-modules-unix>20.19. <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_unix&amp;sektion=8&amp;format=html">pam_unix(8)</a><a class=anchor href=#pam-modules-unix></a></h3><div class=paragraph><p>Le module <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_unix&amp;sektion=8&amp;format=html">pam_unix(8)</a> implémente l’authentification Unix traditionnelle par mot de passe, il utilise <a href="https://man.freebsd.org/cgi/man.cgi?query=getpwnam&amp;sektion=3&amp;format=html">getpwnam(3)</a> pour obtenir le mot de passe du compte visé et le compare avec celui fournit par le demandeur. Il fournit aussi des services de gestion de compte (désactivation du compte et date d’expiration) ainsi que des services pour le changement de mot de passe. Il s’agit certainement du module le plus utile car la plupart des administrateurs désirent garder le comportement historique pour quelques services.</p></div></div></div></div><div class=sect1><h2 id=pam-appl-prog>21. Programmation d’applications PAM<a class=anchor href=#pam-appl-prog></a></h2><div class=sectionbody><div class=paragraph><p>Cette section n’a pas encore été écrite.</p></div></div></div><div class=sect1><h2 id=pam-module-prog>22. Programmation de modules PAM<a class=anchor href=#pam-module-prog></a></h2><div class=sectionbody><div class=paragraph><p>Cette section n’a pas été encore écrite.</p></div></div></div><div class=sect1><h2 id=pam-sample-appl>Annexe A: Exemples d’application PAM<a class=anchor href=#pam-sample-appl></a></h2><div class=sectionbody><div class=paragraph><p>Ce qui suit est une implémentation minimale de <a href="https://man.freebsd.org/cgi/man.cgi?query=su&amp;sektion=1&amp;format=html">su(1)</a> en utilisant PAM. Notez qu’elle utilise la fonction de conversation <a href="https://man.freebsd.org/cgi/man.cgi?query=openpam_ttyconv&amp;sektion=3&amp;format=html">openpam_ttyconv(3)</a> spécifique à OpenPAM qui est prototypée dans <span class=filename>security/openpam.h</span>. Si vous désirez construire cette application sur un système utilisant une bibliothèque PAM différente vous devrez fournir votre propre fonction de conversation. Une fonction de conversation robuste est étonnamment difficile à implémenter; celle présentée dans <a href=#pam-sample-conv>Exemple d’une fonction de conversation PAM</a> est un bon point de départ, mais ne devrait pas être utilisée dans des applications réelles.</p></div><div class="literalblock programlisting"><div class=content><pre>/*-
 * Copyright (c) 2002,2003 Networks Associates Technology, Inc.
 * All rights reserved.
 *
 * This software was developed for the FreeBSD Project by ThinkSec AS and
 * Network Associates Laboratories, the Security Research Division of
 * Network Associates, Inc.  under DARPA/SPAWAR contract N66001-01-C-8035
 * (&#34;CBOSS&#34;), as part of the DARPA CHATS research program.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. The name of the author may not be used to endorse or promote
 *    products derived from this software without specific prior written
 *    permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS&#39;&#39; AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 *
 * $P4: //depot/projects/openpam/bin/su/su.c#10 $
 * $FreeBSD: head/en_US.ISO8859-1/articles/pam/su.c 38826 2012-05-17 19:12:14Z hrs $
 */

#include &lt;sys/param.h&gt;
#include &lt;sys/wait.h&gt;

#include &lt;err.h&gt;
#include &lt;pwd.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;syslog.h&gt;
#include &lt;unistd.h&gt;

#include &lt;security/pam_appl.h&gt;
#include &lt;security/openpam.h&gt;	/* for openpam_ttyconv() */

extern char **environ;

static pam_handle_t *pamh;
static struct pam_conv pamc;

static void
usage(void)
{

	fprintf(stderr, &#34;Usage: su [login [args]]\n&#34;);
	exit(1);
}

int
main(int argc, char *argv[])
{
	char hostname[MAXHOSTNAMELEN];
	const char *user, *tty;
	char **args, **pam_envlist, **pam_env;
	struct passwd *pwd;
	int o, pam_err, status;
	pid_t pid;

	while ((o = getopt(argc, argv, &#34;h&#34;)) != -1)
		switch (o) {
		case &#39;h&#39;:
		default:
			usage();
		}

	argc -= optind;
	argv += optind;

	if (argc &gt; 0) {
		user = *argv;
		--argc;
		++argv;
	} else {
		user = &#34;root&#34;;
	}

	/* initialize PAM */
	pamc.conv = &amp;openpam_ttyconv;
	pam_start(&#34;su&#34;, user, &amp;pamc, &amp;pamh);

	/* set some items */
	gethostname(hostname, sizeof(hostname));
	if ((pam_err = pam_set_item(pamh, PAM_RHOST, hostname)) != PAM_SUCCESS)
		goto pamerr;
	user = getlogin();
	if ((pam_err = pam_set_item(pamh, PAM_RUSER, user)) != PAM_SUCCESS)
		goto pamerr;
	tty = ttyname(STDERR_FILENO);
	if ((pam_err = pam_set_item(pamh, PAM_TTY, tty)) != PAM_SUCCESS)
		goto pamerr;

	/* authenticate the applicant */
	if ((pam_err = pam_authenticate(pamh, 0)) != PAM_SUCCESS)
		goto pamerr;
	if ((pam_err = pam_acct_mgmt(pamh, 0)) == PAM_NEW_AUTHTOK_REQD)
		pam_err = pam_chauthtok(pamh, PAM_CHANGE_EXPIRED_AUTHTOK);
	if (pam_err != PAM_SUCCESS)
		goto pamerr;

	/* establish the requested credentials */
	if ((pam_err = pam_setcred(pamh, PAM_ESTABLISH_CRED)) != PAM_SUCCESS)
		goto pamerr;

	/* authentication succeeded; open a session */
	if ((pam_err = pam_open_session(pamh, 0)) != PAM_SUCCESS)
		goto pamerr;

	/* get mapped user name; PAM may have changed it */
	pam_err = pam_get_item(pamh, PAM_USER, (const void **)&amp;user);
	if (pam_err != PAM_SUCCESS || (pwd = getpwnam(user)) == NULL)
		goto pamerr;

	/* export PAM environment */
	if ((pam_envlist = pam_getenvlist(pamh)) != NULL) {
		for (pam_env = pam_envlist; *pam_env != NULL; ++pam_env) {
			putenv(*pam_env);
			free(*pam_env);
		}
		free(pam_envlist);
	}

	/* build argument list */
	if ((args = calloc(argc + 2, sizeof *args)) == NULL) {
		warn(&#34;calloc()&#34;);
		goto err;
	}
	*args = pwd-&gt;pw_shell;
	memcpy(args + 1, argv, argc * sizeof *args);

	/* fork and exec */
	switch ((pid = fork())) {
	case -1:
		warn(&#34;fork()&#34;);
		goto err;
	case 0:
		/* child: give up privs and start a shell */

		/* set uid and groups */
		if (initgroups(pwd-&gt;pw_name, pwd-&gt;pw_gid) == -1) {
			warn(&#34;initgroups()&#34;);
			_exit(1);
		}
		if (setgid(pwd-&gt;pw_gid) == -1) {
			warn(&#34;setgid()&#34;);
			_exit(1);
		}
		if (setuid(pwd-&gt;pw_uid) == -1) {
			warn(&#34;setuid()&#34;);
			_exit(1);
		}
		execve(*args, args, environ);
		warn(&#34;execve()&#34;);
		_exit(1);
	default:
		/* parent: wait for child to exit */
		waitpid(pid, &amp;status, 0);

		/* close the session and release PAM resources */
		pam_err = pam_close_session(pamh, 0);
		pam_end(pamh, pam_err);

		exit(WEXITSTATUS(status));
	}

pamerr:
	fprintf(stderr, &#34;Sorry\n&#34;);
err:
	pam_end(pamh, pam_err);
	exit(1);
}</pre></div></div></div></div><div class=sect1><h2 id=pam-sample-module>Annexe B: Exemple d’un module PAM<a class=anchor href=#pam-sample-module></a></h2><div class=sectionbody><div class=paragraph><p>Ce qui suit est une implémentation minimale de <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_unix&amp;sektion=8&amp;format=html">pam_unix(8)</a> offrant uniquement les services d’authentification. Elle devrait compiler et tourner avec la plupart des implémentations PAM, mais tire parti des extensions d’OpenPAM si elles sont disponibles : notez l’utilisation de <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_get_authtok&amp;sektion=3&amp;format=html">pam_get_authtok(3)</a> qui simplifie énormément l’affichage de l’invite pour demander le mot de passe à l’utilisateur.</p></div><div class="literalblock programlisting"><div class=content><pre>/*-
 * Copyright (c) 2002 Networks Associates Technology, Inc.
 * All rights reserved.
 *
 * This software was developed for the FreeBSD Project by ThinkSec AS and
 * Network Associates Laboratories, the Security Research Division of
 * Network Associates, Inc.  under DARPA/SPAWAR contract N66001-01-C-8035
 * (&#34;CBOSS&#34;), as part of the DARPA CHATS research program.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. The name of the author may not be used to endorse or promote
 *    products derived from this software without specific prior written
 *    permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS&#39;&#39; AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 *
 * $P4: //depot/projects/openpam/modules/pam_unix/pam_unix.c#3 $
 * $FreeBSD: head/en_US.ISO8859-1/articles/pam/pam_unix.c 38826 2012-05-17 19:12:14Z hrs $
 */

#include &lt;sys/param.h&gt;

#include &lt;pwd.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;stdio.h&gt;
#include &lt;string.h&gt;
#include &lt;unistd.h&gt;

#include &lt;security/pam_modules.h&gt;
#include &lt;security/pam_appl.h&gt;

#ifndef _OPENPAM
static char password_prompt[] = &#34;Password:&#34;;
#endif

#ifndef PAM_EXTERN
#define PAM_EXTERN
#endif

PAM_EXTERN int
pam_sm_authenticate(pam_handle_t *pamh, int flags,
	int argc, const char *argv[])
{
#ifndef _OPENPAM
	struct pam_conv *conv;
	struct pam_message msg;
	const struct pam_message *msgp;
	struct pam_response *resp;
#endif
	struct passwd *pwd;
	const char *user;
	char *crypt_password, *password;
	int pam_err, retry;

	/* identify user */
	if ((pam_err = pam_get_user(pamh, &amp;user, NULL)) != PAM_SUCCESS)
		return (pam_err);
	if ((pwd = getpwnam(user)) == NULL)
		return (PAM_USER_UNKNOWN);

	/* get password */
#ifndef _OPENPAM
	pam_err = pam_get_item(pamh, PAM_CONV, (const void **)&amp;conv);
	if (pam_err != PAM_SUCCESS)
		return (PAM_SYSTEM_ERR);
	msg.msg_style = PAM_PROMPT_ECHO_OFF;
	msg.msg = password_prompt;
	msgp = &amp;msg;
#endif
	for (retry = 0; retry &lt; 3; ++retry) {
#ifdef _OPENPAM
		pam_err = pam_get_authtok(pamh, PAM_AUTHTOK,
		    (const char **)&amp;password, NULL);
#else
		resp = NULL;
		pam_err = (*conv-&gt;conv)(1, &amp;msgp, &amp;resp, conv-&gt;appdata_ptr);
		if (resp != NULL) {
			if (pam_err == PAM_SUCCESS)
				password = resp-&gt;resp;
			else
				free(resp-&gt;resp);
			free(resp);
		}
#endif
		if (pam_err == PAM_SUCCESS)
			break;
	}
	if (pam_err == PAM_CONV_ERR)
		return (pam_err);
	if (pam_err != PAM_SUCCESS)
		return (PAM_AUTH_ERR);

	/* compare passwords */
	if ((!pwd-&gt;pw_passwd[0] &amp;&amp; (flags &amp; PAM_DISALLOW_NULL_AUTHTOK)) ||
	    (crypt_password = crypt(password, pwd-&gt;pw_passwd)) == NULL ||
	    strcmp(crypt_password, pwd-&gt;pw_passwd) != 0)
		pam_err = PAM_AUTH_ERR;
	else
		pam_err = PAM_SUCCESS;
#ifndef _OPENPAM
	free(password);
#endif
	return (pam_err);
}

PAM_EXTERN int
pam_sm_setcred(pam_handle_t *pamh, int flags,
	int argc, const char *argv[])
{

	return (PAM_SUCCESS);
}

PAM_EXTERN int
pam_sm_acct_mgmt(pam_handle_t *pamh, int flags,
	int argc, const char *argv[])
{

	return (PAM_SUCCESS);
}

PAM_EXTERN int
pam_sm_open_session(pam_handle_t *pamh, int flags,
	int argc, const char *argv[])
{

	return (PAM_SUCCESS);
}

PAM_EXTERN int
pam_sm_close_session(pam_handle_t *pamh, int flags,
	int argc, const char *argv[])
{

	return (PAM_SUCCESS);
}

PAM_EXTERN int
pam_sm_chauthtok(pam_handle_t *pamh, int flags,
	int argc, const char *argv[])
{

	return (PAM_SERVICE_ERR);
}

#ifdef PAM_MODULE_ENTRY
PAM_MODULE_ENTRY(&#34;pam_unix&#34;);
#endif</pre></div></div></div></div><div class=sect1><h2 id=pam-sample-conv>Annexe C: Exemple d’une fonction de conversation PAM<a class=anchor href=#pam-sample-conv></a></h2><div class=sectionbody><div class=paragraph><p>La fonction de conversation présentée ci-dessous est une version grandement simplifiée de la fonction <a href="https://man.freebsd.org/cgi/man.cgi?query=openpam_ttyconv&amp;sektion=3&amp;format=html">openpam_ttyconv(3)</a> d’OpenPAM. Elle est pleinement fonctionnelle et devrait donner au lecteur une bonne idée de comment doit se comporter une fonction de conversation, mais elle est trop simple pour une utilisation réelle. Même si vous n’utilisez pas OpenPAM, N’hésitez pas à télécharger le code source et d’adapter <a href="https://man.freebsd.org/cgi/man.cgi?query=openpam_ttyconv&amp;sektion=3&amp;format=html">openpam_ttyconv(3)</a> à vos besoins, nous pensons qu’elle est raisonnablement aussi robuste qu’une fonction de conversation orientée tty peut l’être.</p></div><div class="literalblock programlisting"><div class=content><pre>/*-
 * Copyright (c) 2002 Networks Associates Technology, Inc.
 * All rights reserved.
 *
 * This software was developed for the FreeBSD Project by ThinkSec AS and
 * Network Associates Laboratories, the Security Research Division of
 * Network Associates, Inc.  under DARPA/SPAWAR contract N66001-01-C-8035
 * (&#34;CBOSS&#34;), as part of the DARPA CHATS research program.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. The name of the author may not be used to endorse or promote
 *    products derived from this software without specific prior written
 *    permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS&#39;&#39; AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 *
 * $FreeBSD: head/en_US.ISO8859-1/articles/pam/converse.c 38826 2012-05-17 19:12:14Z hrs $
 */

#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;unistd.h&gt;

#include &lt;security/pam_appl.h&gt;

int
converse(int n, const struct pam_message **msg,
	struct pam_response **resp, void *data)
{
	struct pam_response *aresp;
	char buf[PAM_MAX_RESP_SIZE];
	int i;

	data = data;
	if (n &lt;= 0 || n &gt; PAM_MAX_NUM_MSG)
		return (PAM_CONV_ERR);
	if ((aresp = calloc(n, sizeof *aresp)) == NULL)
		return (PAM_BUF_ERR);
	for (i = 0; i &lt; n; ++i) {
		aresp[i].resp_retcode = 0;
		aresp[i].resp = NULL;
		switch (msg[i]-&gt;msg_style) {
		case PAM_PROMPT_ECHO_OFF:
			aresp[i].resp = strdup(getpass(msg[i]-&gt;msg));
			if (aresp[i].resp == NULL)
				goto fail;
			break;
		case PAM_PROMPT_ECHO_ON:
			fputs(msg[i]-&gt;msg, stderr);
			if (fgets(buf, sizeof buf, stdin) == NULL)
				goto fail;
			aresp[i].resp = strdup(buf);
			if (aresp[i].resp == NULL)
				goto fail;
			break;
		case PAM_ERROR_MSG:
			fputs(msg[i]-&gt;msg, stderr);
			if (strlen(msg[i]-&gt;msg) &gt; 0 &amp;&amp;
			    msg[i]-&gt;msg[strlen(msg[i]-&gt;msg) - 1] != &#39;\n&#39;)
				fputc(&#39;\n&#39;, stderr);
			break;
		case PAM_TEXT_INFO:
			fputs(msg[i]-&gt;msg, stdout);
			if (strlen(msg[i]-&gt;msg) &gt; 0 &amp;&amp;
			    msg[i]-&gt;msg[strlen(msg[i]-&gt;msg) - 1] != &#39;\n&#39;)
				fputc(&#39;\n&#39;, stdout);
			break;
		default:
			goto fail;
		}
	}
	*resp = aresp;
	return (PAM_SUCCESS);
 fail:
        for (i = 0; i &lt; n; ++i) {
                if (aresp[i].resp != NULL) {
                        memset(aresp[i].resp, 0, strlen(aresp[i].resp));
                        free(aresp[i].resp);
                }
        }
        memset(aresp, 0, n * sizeof *aresp);
	*resp = NULL;
	return (PAM_CONV_ERR);
}</pre></div></div></div></div><div class=sect1><h2 id=pam-further>Lectures complémentaires<a class=anchor href=#pam-further></a></h2><div class=sectionbody><div class=sect2><h3 id=_publications>Publications<a class=anchor href=#_publications></a></h3><div class=paragraph><p><em><a href=http://www.sun.com/software/solaris/pam/pam.external.pdf>Rendre les services de connexion indépendants des technologies d’authentification</a></em>. Vipin Samar et Charlie Lai. Sun Microsystems.</p></div><div class=paragraph><p><em><a href=http://www.opengroup.org/pubs/catalog/p702.htm>X/Open Single Sign-on Preliminary Specification</a></em>. The Open Group. 1-85912-144-6. June 1997.</p></div><div class=paragraph><p><em><a href=http://www.kernel.org/pub/linux/libs/pam/pre/doc/current-draft.txt>Pluggable Authentication Modules</a></em>. Andrew G. Morgan. 1999-10-06.</p></div></div><div class=sect2><h3 id=_guides_utilisateur>Guides utilisateur<a class=anchor href=#_guides_utilisateur></a></h3><div class=paragraph><p><em><a href=http://www.sun.com/software/solaris/pam/pam.admin.pdf>Administration de PAM</a></em>. Sun Microsystems.</p></div></div><div class=sect2><h3 id=_page_internet_liées>Page internet liées<a class=anchor href=#_page_internet_liées></a></h3><div class=paragraph><p><em><a href=http://openpam.sourceforge.net/>La page d’OpenPAM</a></em>. Dag-Erling Smørgrav. ThinkSec AS.</p></div><div class=paragraph><p><em><a href=http://www.kernel.org/pub/linux/libs/pam/>La page de Linux-PAM</a></em>. Andrew G. Morgan.</p></div><div class=paragraph><p><em><a href=http://wwws.sun.com/software/solaris/pam/>La page de Solaris PAM</a></em>. Sun Microsystems.</p></div></div></div></div><hr><div class=last-modified><p><strong>Last modified on</strong>: 3 novembre 2021 by <a href="https://cgit.freebsd.org/doc/commit/?id=64acd169b8" target=_blank>Sergio Carlavilla Delgado</a></p></div></div><aside class=toc><div class=toc-content><h3>Sommaire</h3><nav id=TableOfContents><ul><li><a href=#pam-intro>1. Introduction</a></li><li><a href=#pam-trademarks>2. Marques déposées</a></li><li><a href=#pam-terms>3. Termes et conventions</a></li><li><a href=#pam-definitions>4. Définitions</a></li><li><a href=#pam-usage-examples>5. Exemples d’utilisation</a></li><li><a href=#_client_et_serveurs_ne_font_quun>6. Client et serveurs ne font qu’un</a></li><li><a href=#_client_et_serveur_sont_distincts>7. Client et serveur sont distincts.</a></li><li><a href=#_exemple_de_règles>8. Exemple de règles</a></li><li><a href=#pam-conventions>9. Conventions</a></li><li><a href=#pam-essentials>10. Les bases de PAM</a></li><li><a href=#pam-facilities-primitives>11. Mécanismes et primitives</a></li><li><a href=#pam-module-naming>12. Nom des modules</a></li><li><a href=#pam-module-versioning>13. Gestion des versions de module</a></li><li><a href=#pam-chains-policies>14. Chaînes et politiques</a></li><li><a href=#pam-config>15. Configuration de PAM</a></li><li><a href=#pam-config-file-locations>16. Emplacement des fichiers de configuration</a></li><li><a href=#pam-config-breakdown>17. Breakdown of a configuration line</a></li><li><a href=#pam-policies>18. Politiques</a></li><li><a href=#pam-freebsd-modules>19. Les modules PAM de FreeBSD</a></li><li><a href=#pam-modules-ftp>20. pam_ftp(8)</a></li><li><a href=#pam-appl-prog>21. Programmation d’applications PAM</a></li><li><a href=#pam-module-prog>22. Programmation de modules PAM</a></li><li><a href=#pam-sample-appl>Annexe A: Exemples d’application PAM</a></li><li><a href=#pam-sample-module>Annexe B: Exemple d’un module PAM</a></li><li><a href=#pam-sample-conv>Annexe C: Exemple d’une fonction de conversation PAM</a></li><li><a href=#pam-further>Lectures complémentaires</a></li></ul></nav><hr><div class=resources><h3>Ressources</h3><ul class=contents><li><i class="fa fa-file-pdf-o" aria-hidden=true title="Téléchargement en PDF"></i><a href=https://download.freebsd.org/doc/fr/articles/pam/pam_fr.pdf>Téléchargement en PDF</a></li><li><i class="fa fa-pencil-square-o" aria-hidden=true title="Éditer cette page"></i><a href=https://github.com/freebsd/freebsd-doc/blob/main/documentation/content/fr/_index target=_blank>Éditer cette page</a></li></ul></div></div></aside></main><footer><div class=footer-container><section class=logo-column><img src=https://docs.freebsd.org/images/FreeBSD-colors.svg width=160 height=50 alt="FreeBSD logo"><div class=options-container><div class=language-container><a id=languages href=https://docs.freebsd.org/fr/languages><img src=https://docs.freebsd.org/images/language.png class=language-image alt="Choose language">
<span>French</span></a></div><div class=theme-container><select id=theme-chooser><option value=theme-system>System</option><option value=theme-light>Clair</option><option value=theme-dark>Sombre</option><option value=theme-high-contrast>Contraste élevé</option></select></div></div></section><section class=about-column><h3 class=column-title>About</h3><ul class=column-elements-container><li><a href=https://www.freebsd.org/about/ target=_blank class=column-element>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/ target=_blank class=column-element>FreeBSD Foundation</a></li><li><a href=https://www.freebsd.org/where/ target=_blank class=column-element>Get FreeBSD</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct target=_blank class=column-element>Code of Conduct</a></li><li><a href=https://www.freebsd.org/security/ target=_blank class=column-element>Security Advisories</a></li></ul></section><section class=documentation-column><h3 class=column-title>Documentation</h3><ul class=column-elements-container><li><a href=/fr class=column-element>Documentation portal</a></li><li><a href=https://man.FreeBSD.org target=_blank class=column-element>Manual pages</a></li><li><a href=https://papers.FreeBSD.org target=_blank class=column-element>Presentations and papers</a></li><li><a href=https://docs-archive.freebsd.org/doc/ target=_blank class=column-element>Previous versions</a></li><li><a href=https://docs-archive.freebsd.org/44doc/ target=_blank class=column-element>4.4BSD Documents</a></li><li><a href=https://wiki.freebsd.org/ target=_blank class=column-element>Wiki</a></li></ul></section><section class=community-column><h3 class=column-title>Community</h3><ul class=column-elements-container><li><a href=https://docs.freebsd.org/fr/articles/contributing class=column-element>Get involved</a></li><li><a href=https://forums.freebsd.org/ target=_blank class=column-element>Community forum</a></li><li><a href=https://lists.freebsd.org/ target=_blank class=column-element>Mailing lists</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank class=column-element>IRC Channels</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank class=column-element>Bug Tracker</a></li></ul></section><section class=legal-column><h3 class=column-title>Legal</h3><ul class=column-elements-container><li><a href=https://freebsdfoundation.org/donate/ target=_blank class=column-element>Donations</a></li><li><a href=https://www.freebsd.org/copyright/freebsd-license/ target=_blank class=column-element>Licensing</a></li><li><a href=https://www.freebsd.org/privacy/ target=_blank class=column-element>Privacy Policy</a></li><li><a href=https://www.freebsd.org/copyright/ target=_blank class=column-element>Legal notices</a></li></ul></section><section class=copyright-column><p>&copy; 1994-2024 The FreeBSD Project. All rights reserved</p><span>Made with <span class=heart>♥</span> by the FreeBSD Community</span></section></div></footer></body></html>