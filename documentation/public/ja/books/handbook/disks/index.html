<!doctype html><html class=theme-light lang=ja><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content><meta name=copyright content="1995-2024 The FreeBSD Foundation"><link rel=canonical href=http://172.16.201.134:1313/ja/books/handbook/disks/><title>第14章 ストレージ | FreeBSD Documentation Portal</title>
<meta name=theme-color content="#790000"><meta name=color-scheme content="system light dark high-contrast"><link rel="shortcut icon" href=http://172.16.201.134:1313/favicon.ico><link rel=stylesheet href=http://172.16.201.134:1313/styles/main.min.css><link rel=stylesheet href=http://172.16.201.134:1313/css/font-awesome-min.css><script defer src=/js/theme-chooser.min.js></script><script defer src=/js/copy-clipboard.min.js></script><script defer src=/js/search.min.js></script><meta name=twitter:card content="summary"><meta name=twitter:domain content="docs.FreeBSD.org"><meta name=twitter:site content="@freebsd"><meta name=twitter:url content="https://twitter.com/freebsd"><meta property="og:title" content="第14章 ストレージ"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:image" content="http://172.16.201.134:1313/favicon.ico"><meta property="og:image:alt" content="FreeBSD Logo"><meta property="og:locale" content="ja"><meta property="og:url" content="http://172.16.201.134:1313/ja/books/handbook/disks/"><meta property="og:site_name" content="FreeBSD Documentation Portal"><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","url":"http:\/\/172.16.201.134:1313\/ja\/books\/handbook\/disks\/","name":"FreeBSD Documentation Portal","headline":"FreeBSD Documentation Portal","description":"FreeBSD Documentation Portal"}</script></head><body><header><div class=header-container><div class=logo-menu-bars-container><a href=https://www.FreeBSD.org class=logo><img src=http://172.16.201.134:1313/images/FreeBSD-monochromatic.svg width=160 height=50 alt="FreeBSD logo">
</a><label class=menu-bars for=menu-bars><i class="fa fa-bars" aria-hidden=true></i></label></div><input id=menu-bars type=checkbox><nav><ul class=menu><li class=menu-item><input id=about type=checkbox>
<a href=# aria-label="Navigate to About section"><label class=menu-item-description for=about>About
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/about/ target=_blank>About</a></li><li><a href=https://www.freebsd.org/about/ target=_blank>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/about-us/about-the-foundation/ target=_blank>FreeBSD Foundation</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct/ target=_blank>Code of Conduct</a></li></ul></li><li class=menu-item><input id=download type=checkbox>
<a href=# aria-label="Navigate to get FreeBSD section"><label class=menu-item-description for=download>Get FreeBSD
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/where/ target=_blank>Get FreeBSD</a></li><li><a href=https://www.freebsd.org/releases/ target=_blank>Release Information</a></li><li><a href=https://www.freebsd.org/releng/ target=_blank>Release Engineering</a></li><li><a href=https://www.freebsd.org/security/ target=_blank>Security Advisories</a></li></ul></li><li class=menu-item><input id=documentation type=checkbox>
<a href=# aria-label="Navigate to get Documentation section"><label class=menu-item-description for=documentation>Documentation
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=/ja>Documentation portal</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook>FreeBSD Handbook</a></li><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook>Porter's Handbook</a></li><li><a href=https://docs.FreeBSD.org/en/books/fdp-primer>Documentation Project Handbook</a></li><li><a href=https://man.FreeBSD.org target=_blank>Manual pages</a></li><li><a href=https://papers.FreeBSD.org target=_blank>Presentations and papers</a></li><li><a href=https://wiki.FreeBSD.org target=_blank>Wiki</a></li><li><a href=http://172.16.201.134:1313/ja/books>Books</a></li><li><a href=http://172.16.201.134:1313/ja/articles>Articles</a></li></ul></li><li class=menu-item><input id=community type=checkbox>
<a href=# aria-label="Navigate to get Community section"><label class=menu-item-description for=community>Community
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/community/>Community</a></li><li><a href=http://172.16.201.134:1313/ja/articles/contributing>Get involved</a></li><li><a href=https://forums.freebsd.org/ target=_blank>Forum</a></li><li><a href=https://lists.freebsd.org/ target=_blank>Mailing lists</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank>IRC Channels</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank>Bug Tracker</a></li><li><a href=https://www.freebsd.org/support/ target=_blank>Support</a></li></ul></li></ul></nav><div class=search-donate-container><form class=search method=get id=search-header-form action=https://docs.freebsd.org/search name=search-header-form><input type=hidden name=DB value=ja>
<input id=words name=P type=text size=20 maxlength=255>
<button>
<i class="fa fa-search" aria-hidden=true></i></button></form><div class=donate><a href=https://freebsdfoundation.org/donate/ target=_blank><span class=heart>♥</span>
Donate</a></div></div></div></header><input type=checkbox class="hidden toggle" id=menu-control><main class=main-wrapper-book><a id=top></a><aside class=book-menu><div class=book-menu-content><input id=search-book type=text placeholder=Search aria-label=Search maxlength=128><nav id=MenuContents><ul><li><input type=checkbox id=chapter-eb2a98ce203d8afd517726e6d8776be3 class=toggle>
<label class="icon cursor" for=chapter-eb2a98ce203d8afd517726e6d8776be3><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/handbook/preface/>前書き</a><ul><li><a href=http://172.16.201.134:1313/ja/books/handbook/preface/#preface-audience>想定している読者</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/preface/#preface-changes-from3>第 3 版からの変更</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/preface/#preface-changes-from2>第 2 版 (2004) からの変更</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/preface/#preface-changes>第 1 版 (2001) からの変更</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/preface/#preface-overview>この文書の構成</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/preface/#preface-conv>この文書で用いられている表記法</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/preface/#preface-acknowledgements>謝辞</a></li></ul></li><li><input type=checkbox id=chapter-14a525fce014b90b8a458a894818255a class=toggle>
<label for=chapter-14a525fce014b90b8a458a894818255a><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/handbook/parti/>パートI. 導入</a></li><li><input type=checkbox id=chapter-f9c9f3451644df30d224350da97d5da6 class=toggle>
<label class="icon cursor" for=chapter-f9c9f3451644df30d224350da97d5da6><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/handbook/introduction/>第1章 はじめに</a><ul><li><a href=http://172.16.201.134:1313/ja/books/handbook/introduction/#introduction-synopsis>1.1. この章では</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/introduction/#nutshell>1.2. FreeBSD へようこそ!</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/introduction/#history>1.3. FreeBSD プロジェクトについて</a></li></ul></li><li><input type=checkbox id=chapter-f693a3fa687a72d63ec8129ee302d664 class=toggle>
<label class="icon cursor" for=chapter-f693a3fa687a72d63ec8129ee302d664><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/handbook/bsdinstall/>第2章 FreeBSD のインストール</a><ul><li><a href=http://172.16.201.134:1313/ja/books/handbook/bsdinstall/#bsdinstall-synopsis>2.1. この章では</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/bsdinstall/#bsdinstall-hardware>2.2. 最小ハードウェア要件</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/bsdinstall/#bsdinstall-pre>2.3. インストール前に行う作業</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/bsdinstall/#bsdinstall-start>2.4. インストールの開始</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/bsdinstall/#using-bsdinstall>2.5. bsdinstall の使用</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/bsdinstall/#bsdinstall-partitioning>2.6. ディスク領域の割り当て</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/bsdinstall/#bsdinstall-fetching-distribution>2.7. 配布ファイルのダウンロード</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/bsdinstall/#bsdinstall-post>2.8. ネットワークインターフェース、アカウント、タイムゾーン、 サービスおよびセキュリティオプションの設定</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/bsdinstall/#bsdinstall-install-trouble>2.9. トラブルシューティング</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/bsdinstall/#using-live-cd>2.10. Live CD を使う</a></li></ul></li><li><input type=checkbox id=chapter-9f6db261075f578742036fcc6000eecd class=toggle>
<label class="icon cursor" for=chapter-9f6db261075f578742036fcc6000eecd><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/handbook/basics/>第3章 FreeBSD の基礎知識</a><ul><li><a href=http://172.16.201.134:1313/ja/books/handbook/basics/#basics-synopsis>3.1. この章では</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/basics/#consoles>3.2. 仮想コンソールと端末</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/basics/#users-synopsis>3.3. ユーザと基本的なアカウント管理</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/basics/#permissions>3.4. 許可属性</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/basics/#dirstructure>3.5. ディレクトリ構造</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/basics/#disk-organization>3.6. ディスク構成</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/basics/#mount-unmount>3.7. ファイルシステムのマウントとアンマウント</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/basics/#basics-processes>3.8. プロセスおよびデーモン</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/basics/#shells>3.9. シェル</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/basics/#editors>3.10. テキストエディタ</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/basics/#basics-devices>3.11. デバイスとデバイスノード</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/basics/#basics-more-information>3.12. マニュアルページ</a></li></ul></li><li><input type=checkbox id=chapter-01c5707e95d14c0ff84bf62600c958d1 class=toggle>
<label class="icon cursor" for=chapter-01c5707e95d14c0ff84bf62600c958d1><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/handbook/ports/>第4章 アプリケーションのインストール - packages と ports</a><ul><li><a href=http://172.16.201.134:1313/ja/books/handbook/ports/#ports-synopsis>4.1. この章では</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/ports/#ports-overview>4.2. ソフトウェアのインストール</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/ports/#ports-finding-applications>4.3. ソフトウェアの探し方</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/ports/#pkgng-intro>4.4. pkg によるバイナリ package の管理</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/ports/#ports-using>4.5. Ports Collection の利用</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/ports/#ports-poudriere>4.6. Poudriere を用いた package の構築</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/ports/#ports-nextsteps>4.7. インストール後の作業</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/ports/#ports-broken>4.8. うまく動作しない ports に遭遇した場合には</a></li></ul></li><li><input type=checkbox id=chapter-3405c00581365a8b5d16af70fe4d1b72 class=toggle>
<label class="icon cursor" for=chapter-3405c00581365a8b5d16af70fe4d1b72><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/handbook/x11/>第5章 X Window System</a><ul><li><a href=http://172.16.201.134:1313/ja/books/handbook/x11/#x11-synopsis>5.1. この章では</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/x11/#x-understanding>5.2. 用語の説明</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/x11/#x-install>5.3. Xorg のインストール</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/x11/#x-config>5.4. Xorg の設定</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/x11/#x-fonts>5.5. Xorg でのフォントの使用</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/x11/#x-xdm>5.6. X ディスプレイマネージャ</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/x11/#x11-wm>5.7. デスクトップ環境</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/x11/#x-compiz-fusion>5.8. Compiz Fusion のインストール</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/x11/#x11-troubleshooting>5.9. トラブルシューティング</a></li></ul></li><li><input type=checkbox id=chapter-0eab3565e8f59f5a8a896dfba7eb3680 class=toggle>
<label for=chapter-0eab3565e8f59f5a8a896dfba7eb3680><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/handbook/partii/>パートII. 日々の生活</a></li><li><input type=checkbox id=chapter-b33cf28993f3f7bf5baf036e79da0f39 class=toggle>
<label class="icon cursor" for=chapter-b33cf28993f3f7bf5baf036e79da0f39><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/handbook/desktop/>第6章 デスクトップアプリケーション</a><ul><li><a href=http://172.16.201.134:1313/ja/books/handbook/desktop/#desktop-synopsis>6.1. この章では</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/desktop/#desktop-browsers>6.2. ブラウザ</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/desktop/#desktop-productivity>6.3. 生産的なアプリケーション</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/desktop/#desktop-viewers>6.4. ドキュメントビューア</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/desktop/#desktop-finance>6.5. 財務管理ソフトウェア</a></li></ul></li><li><input type=checkbox id=chapter-152f694a19312ad72ec7bb4e1c3c33b2 class=toggle>
<label class="icon cursor" for=chapter-152f694a19312ad72ec7bb4e1c3c33b2><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/handbook/multimedia/>第7章 マルチメディア</a><ul><li><a href=http://172.16.201.134:1313/ja/books/handbook/multimedia/#multimedia-synopsis>7.1. この章では</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/multimedia/#sound-setup>7.2. サウンドカードの設定</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/multimedia/#sound-mp3>7.3. MP3 オーディオ</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/multimedia/#video-playback>7.4. ビデオ再生</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/multimedia/#tvcard>7.5. TV カードの設定</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/multimedia/#mythtv>7.6. MythTV</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/multimedia/#scanners>7.7. 画像スキャナ</a></li></ul></li><li><input type=checkbox id=chapter-80888b4ee02e3e409e5f71cf97a36450 class=toggle>
<label class="icon cursor" for=chapter-80888b4ee02e3e409e5f71cf97a36450><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/handbook/kernelconfig/>第8章 FreeBSD カーネルのコンフィグレーション</a><ul><li><a href=http://172.16.201.134:1313/ja/books/handbook/kernelconfig/#kernelconfig-synopsis>8.1. この章では</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/kernelconfig/#kernelconfig-custom-kernel>8.2. なぜカスタムカーネルを作るか?</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/kernelconfig/#kernelconfig-devices>8.3. システムのハードウェアについて知る</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/kernelconfig/#kernelconfig-config>8.4. コンフィグレーションファイル</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/kernelconfig/#kernelconfig-building>8.5. カスタムカーネルの構築とインストール</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/kernelconfig/#kernelconfig-trouble>8.6. 問題が起きた場合には</a></li></ul></li><li><input type=checkbox id=chapter-cb174c55879b17ab955f2f16989a79e0 class=toggle>
<label class="icon cursor" for=chapter-cb174c55879b17ab955f2f16989a79e0><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/handbook/printing/>第9章 プリンタの利用</a><ul><li><a href=http://172.16.201.134:1313/ja/books/handbook/printing/#printing-synopsis>9.1. この章では</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/printing/#printing-intro-spooler>9.2. はじめに</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/printing/#printing-intro-setup>9.3. 基本的な設定</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/printing/#printing-advanced>9.4. プリンタ設定上級編</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/printing/#printing-using>9.5. プリンタを使う</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/printing/#printing-lpd-alternatives>9.6. 標準スプーラの代替品</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/printing/#printing-troubleshooting>9.7. トラブルシューティング</a></li></ul></li><li><input type=checkbox id=chapter-c12b8c3f2a8fcefce87087241f695c83 class=toggle>
<label class="icon cursor" for=chapter-c12b8c3f2a8fcefce87087241f695c83><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/handbook/linuxemu/>第10章 Linux® バイナリ互換機能</a><ul><li><a href=http://172.16.201.134:1313/ja/books/handbook/linuxemu/#linuxemu-synopsis>10.1. この章では</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/linuxemu/#linuxemu-lbc-install>10.2. Linux® バイナリ互換機能の設定</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/linuxemu/#linuxemu-advanced>10.3. 高度なトピックス</a></li></ul></li><li><input type=checkbox id=chapter-03b11ba627b9a0c85b247f5641bde272 class=toggle>
<label for=chapter-03b11ba627b9a0c85b247f5641bde272><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/handbook/partiii/>パートIII. システム管理</a></li><li><input type=checkbox id=chapter-6c31587f8d736319f099cd4dc1961301 class=toggle>
<label class="icon cursor" for=chapter-6c31587f8d736319f099cd4dc1961301><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/handbook/config/>第11章 設定とチューニング</a><ul><li><a href=http://172.16.201.134:1313/ja/books/handbook/config/#_この章では>11.1. この章では</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/config/#configtuning-core-configuration>11.2. 中核となる設定</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/config/#configtuning-appconfig>11.3. アプリケーションの設定</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/config/#configtuning-starting-services>11.4. サービスの起動</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/config/#configtuning-virtual-hosts>11.5. バーチャルホスト</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/config/#configtuning-configfiles>11.6. 設定ファイル</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/config/#configtuning-sysctl>11.7. sysctl によるチューニング</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/config/#configtuning-disk>11.8. ディスクのチューニング</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/config/#configtuning-kernel-limits>11.9. Kernel 制限のチューニング</a></li></ul></li><li><input type=checkbox id=chapter-459f0012b3b4f0b6b123010f029da5e4 class=toggle>
<label class="icon cursor" for=chapter-459f0012b3b4f0b6b123010f029da5e4><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/handbook/boot/>第12章 FreeBSD の起動のプロセス</a><ul><li><a href=http://172.16.201.134:1313/ja/books/handbook/boot/#boot-synopsis>12.1. この章では</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/boot/#boot-introduction>12.2. FreeBSD の起動プロセス</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/boot/#device-hints>12.3. Device Hints</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/boot/#boot-shutdown>12.4. シャットダウン動作</a></li></ul></li><li><input type=checkbox id=chapter-917c75fcffbb14d48ed6d0a48e7028f2 class=toggle>
<label class="icon cursor" for=chapter-917c75fcffbb14d48ed6d0a48e7028f2><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/handbook/security/>第13章 セキュリティ</a><ul><li><a href=http://172.16.201.134:1313/ja/books/handbook/security/#security-synopsis>13.1. この章では</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/security/#security-intro>13.2. はじめに</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/security/#one-time-passwords>13.3. ワンタイムパスワード</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/security/#tcpwrappers>13.4. TCP Wrappers</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/security/#kerberos5>13.5. Kerberos5</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/security/#openssl>13.6. OpenSSL</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/security/#ipsec>13.7. VPN over IPsec</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/security/#openssh>13.8. OpenSSH</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/security/#fs-acl>13.9. ファイルシステムアクセス制御リスト (ACL)</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/security/#security-portaudit>13.10. サードパーティ製ソフトウェアのセキュリティ問題を監視する</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/security/#security-advisories>13.11. FreeBSD セキュリティ勧告</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/security/#security-accounting>13.12. プロセスアカウンティング</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/security/#security-resourcelimits>13.13. リソースの制限</a></li></ul></li><li><input type=checkbox id=chapter-e1edcad13d9db6e8e4cb645d378ecfaf class=toggle checked>
<label class="icon cursor" for=chapter-e1edcad13d9db6e8e4cb645d378ecfaf><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/handbook/disks/>第14章 ストレージ</a><ul><li><a href=http://172.16.201.134:1313/ja/books/handbook/disks/#disks-synopsis>14.1. この章では</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/disks/#disk-naming>14.2. デバイス名</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/disks/#disks-adding>14.3. ディスクの追加</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/disks/#raid>14.4. RAID</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/disks/#creating-cds>14.5. 光メディア (CD & DVD) の作成と使用</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/disks/#floppies>14.6. フロッピーディスクの作成と使用</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/disks/#backups-tapebackups>14.7. データテープの作成と使用</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/disks/#backups-floppybackups>14.8. フロッピーディスクへのバックアップ</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/disks/#backup-basics>14.9. バックアップの基本</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/disks/#disks-virtual>14.10. ネットワーク、メモリ、そしてファイルベースのファイルシステム</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/disks/#snapshots>14.11. ファイルシステムのスナップショット</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/disks/#quotas>14.12. ファイルシステムクォータ</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/disks/#disks-encrypting>14.13. ディスクパーティションの暗号化</a></li></ul></li><li><input type=checkbox id=chapter-49f1e96591c090304ea532012257f4ef class=toggle>
<label class="icon cursor" for=chapter-49f1e96591c090304ea532012257f4ef><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/handbook/l10n/>第15章 地域化 (localization) - i18n/L10n の利用と設定</a><ul><li><a href=http://172.16.201.134:1313/ja/books/handbook/l10n/#l10n-synopsis>15.1. この章では</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/l10n/#using-localization>15.2. 地域化の利用</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/l10n/#l10n-compiling>15.3. 国際化 (i18n) に対応したアプリケーションを見つける</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/l10n/#lang-setup>15.4. 特定の言語にロケールを設定する</a></li></ul></li><li><input type=checkbox id=chapter-dead2b4c5ea325dd390a9b0dccd8f763 class=toggle>
<label class="icon cursor" for=chapter-dead2b4c5ea325dd390a9b0dccd8f763><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/handbook/cutting-edge/>第16章 FreeBSD のアップデートとアップグレード</a><ul><li><a href=http://172.16.201.134:1313/ja/books/handbook/cutting-edge/#updating-upgrading-synopsis>16.1. この章では</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/cutting-edge/#updating-upgrading-freebsdupdate>16.2. FreeBSD Update</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/cutting-edge/#updating-bootcode>16.3. ブートコードのアップデート</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/cutting-edge/#updating-upgrading-documentation>16.4. ドキュメントのアップデート</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/cutting-edge/#current-stable>16.5. 開発ブランチを追いかける</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/cutting-edge/#makeworld>16.6. ソースを用いた FreeBSD のアップデート</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/cutting-edge/#small-lan>16.7. 複数のマシンで追いかける</a></li></ul></li><li><input type=checkbox id=chapter-bbd25f9a194f9c39ca2d658c75767db5 class=toggle>
<label for=chapter-bbd25f9a194f9c39ca2d658c75767db5><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/handbook/partiv/>パートIV. ネットワーク通信</a></li><li><input type=checkbox id=chapter-499dab596afd7ddac77e80295314e0dd class=toggle>
<label class="icon cursor" for=chapter-499dab596afd7ddac77e80295314e0dd><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/handbook/serialcomms/>第17章 シリアル通信</a><ul><li><a href=http://172.16.201.134:1313/ja/books/handbook/serialcomms/#serial-synopsis>17.1. この章では</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/serialcomms/#serial>17.2. はじめに</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/serialcomms/#term>17.3. シリアル端末</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/serialcomms/#dialup>17.4. ダイアルインサービス</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/serialcomms/#dialout>17.5. ダイアルアウトサービス</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/serialcomms/#serialconsole-setup>17.6. シリアルコンソールの設定</a></li></ul></li><li><input type=checkbox id=chapter-95e4571c48bee1cced5e84a538d302e3 class=toggle>
<label class="icon cursor" for=chapter-95e4571c48bee1cced5e84a538d302e3><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/handbook/ppp-and-slip/>第18章 PPP と SLIP</a><ul><li><a href=http://172.16.201.134:1313/ja/books/handbook/ppp-and-slip/#_この章では>18.1. この章では</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/ppp-and-slip/#userppp>18.2. ユーザ ppp の利用</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/ppp-and-slip/#ppp>18.3. カーネル PPP の利用</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/ppp-and-slip/#pppoe>18.4. PPP オーバイーサネット (PPPoE) の利用</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/ppp-and-slip/#slip>18.5. SLIP の利用</a></li></ul></li><li><input type=checkbox id=chapter-f089ac726c401c9b4bd5c34a295e11bb class=toggle>
<label class="icon cursor" for=chapter-f089ac726c401c9b4bd5c34a295e11bb><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/handbook/mail/>第19章 電子メール</a><ul><li><a href=http://172.16.201.134:1313/ja/books/handbook/mail/#mail-synopsis>19.1. この章では</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/mail/#mail-using>19.2. 電子メールを使う</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/mail/#sendmail>19.3. sendmail の設定</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/mail/#mail-changingmta>19.4. MTA の変更</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/mail/#mail-trouble>19.5. トラブルシュート</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/mail/#mail-advanced>19.6. 先進的なトピックス</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/mail/#SMTP-UUCP>19.7. UUCP とともに SMTP を使う</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/mail/#SMTP-dialup>19.8. ダイアルアップ接続でメールを使う</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/mail/#SMTP-Auth>19.9. SMTP 認証</a></li></ul></li><li><input type=checkbox id=chapter-5b07f776a0e6155c1c89aa0d15610380 class=toggle>
<label class="icon cursor" for=chapter-5b07f776a0e6155c1c89aa0d15610380><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/handbook/advanced-networking/>第20章 高度なネットワーク</a><ul><li><a href=http://172.16.201.134:1313/ja/books/handbook/advanced-networking/#advanced-networking-synopsis>20.1. この章では</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/advanced-networking/#network-routing>20.2. ゲートウェイと経路</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/advanced-networking/#network-wireless>20.3. 無線ネットワーク</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/advanced-networking/#network-bluetooth>20.4. Bluetooth</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/advanced-networking/#network-bridging>20.5. ブリッジ</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/advanced-networking/#network-nfs>20.6. NFS</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/advanced-networking/#network-diskless>20.7. ディスクレス稼働</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/advanced-networking/#network-isdn>20.8. ISDN</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/advanced-networking/#network-nis>20.9. NIS/YP</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/advanced-networking/#network-dhcp>20.10. DHCP</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/advanced-networking/#network-dns>20.11. DNS</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/advanced-networking/#network-ntp>20.12. NTP</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/advanced-networking/#network-natd>20.13. ネットワークアドレス変換 (NAT)</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/advanced-networking/#network-inetd>20.14. inetd"スーパサーバ"</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/advanced-networking/#network-plip>20.15. パラレルライン IP (PLIP)</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/advanced-networking/#network-ipv6>20.16. IPv6</a></li></ul></li><li><input type=checkbox id=chapter-171a77aa9d067a1024f849470e1f33e8 class=toggle>
<label for=chapter-171a77aa9d067a1024f849470e1f33e8><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/handbook/partv/>パートV. 付録</a></li><li><input type=checkbox id=chapter-8050f436a0a7986a4aaded93d8e49469 class=toggle>
<label class="icon cursor" for=chapter-8050f436a0a7986a4aaded93d8e49469><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/handbook/mirrors/>付録A FreeBSD の入手方法</a><ul><li><a href=http://172.16.201.134:1313/ja/books/handbook/mirrors/#mirrors>A.1. Mirrors</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/mirrors/#git>A.2. Git の利用</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/mirrors/#svn>A.3. Subversion の利用</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/mirrors/#mirrors-cdrom>A.4. CD および DVD セット</a></li></ul></li><li><input type=checkbox id=chapter-128b630a8f88f158e7027fe6c2184d21 class=toggle>
<label class="icon cursor" for=chapter-128b630a8f88f158e7027fe6c2184d21><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/handbook/bibliography/>付録B. 参考図書</a><ul><li><a href=http://172.16.201.134:1313/ja/books/handbook/bibliography/#bibliography-freebsd>B.1. FreeBSD 専門の書籍</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/bibliography/#bibliography-userguides>B.2. 利用者向けのガイド</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/bibliography/#bibliography-adminguides>B.3. 管理者向けのガイド</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/bibliography/#_プログラマ向けのガイド>B.4. プログラマ向けのガイド</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/bibliography/#_オペレーティングシステム内部>B.5. オペレーティングシステム内部</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/bibliography/#_セキュリティの参考資料>B.6. セキュリティの参考資料</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/bibliography/#bibliography-hardware>B.7. ハードウェアの参考資料</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/bibliography/#bibliography-history>B.8. UNIX® の歴史</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/bibliography/#bibliography-journals>B.9. 定期刊行物、雑誌およびジャーナル</a></li></ul></li><li><input type=checkbox id=chapter-8bbb8867c46dac315e2253945d8c18a8 class=toggle>
<label class="icon cursor" for=chapter-8bbb8867c46dac315e2253945d8c18a8><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/handbook/eresources/>付録 C. インターネット上のリソース</a><ul><li><a href=http://172.16.201.134:1313/ja/books/handbook/eresources/#eresources-www>C.1. ウェブサイト</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/eresources/#eresources-mail>C.2. メーリングリスト</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/eresources/#eresources-news>C.3. Usenet ニュースグループ</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/eresources/#eresources-web>C.4. オフィシャルミラー</a></li></ul></li><li><input type=checkbox id=chapter-a80ea4f5a4480b8725422710f954ef36 class=toggle>
<label class="icon cursor" for=chapter-a80ea4f5a4480b8725422710f954ef36><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/handbook/pgpkeys/>付録 D. OpenPGP Keys</a><ul><li><a href=http://172.16.201.134:1313/ja/books/handbook/pgpkeys/#pgpkeys-officers>D.1. オフィサ</a></li></ul></li><li></li></ul></nav></div></aside><div class=book><div class=book-menu-mobile><label for=menu-control><span class=menu-control-button><i class="fa fa-list" aria-hidden=true title="Book menu"></i>
Book menu</span></label></div><h1 class=title>第14章 ストレージ</h1><div class="admonitionblock note"><p><i class="fa fa-exclamation-circle" aria-hidden=true></i>
This translation may be out of date. To help with the translations please access the <a href=https://translate-dev.freebsd.org/ target=_blank>FreeBSD translations instance</a>.</p></div><div class=toc-mobile><h3>目次</h3><nav id=TableOfContents><ul><li><a href=#disks-synopsis>14.1. この章では</a></li><li><a href=#disk-naming>14.2. デバイス名</a></li><li><a href=#disks-adding>14.3. ディスクの追加</a></li><li><a href=#raid>14.4. RAID</a></li><li><a href=#creating-cds>14.5. 光メディア (CD & DVD) の作成と使用</a></li><li><a href=#floppies>14.6. フロッピーディスクの作成と使用</a></li><li><a href=#backups-tapebackups>14.7. データテープの作成と使用</a></li><li><a href=#backups-floppybackups>14.8. フロッピーディスクへのバックアップ</a></li><li><a href=#backup-basics>14.9. バックアップの基本</a></li><li><a href=#disks-virtual>14.10. ネットワーク、メモリ、そしてファイルベースのファイルシステム</a></li><li><a href=#snapshots>14.11. ファイルシステムのスナップショット</a></li><li><a href=#quotas>14.12. ファイルシステムクォータ</a></li><li><a href=#disks-encrypting>14.13. ディスクパーティションの暗号化</a></li></ul></nav></div><div class=book-content><div id=preamble><div class=sectionbody></div></div><div class=sect1><h2 id=disks-synopsis>14.1. この章では<a class=anchor href=#disks-synopsis></a></h2><div class=sectionbody><div class=paragraph><p>この章では、FreeBSD におけるディスクの使用方法を説明します。 これにはメモリディスク、ネットワークに接続されたディスク、 および標準的な SCSI/IDE 記憶デバイスが含まれます。</p></div><div class=paragraph><p>この章では、以下の分野について説明します。</p></div><div class=ulist><ul><li><p>物理ディスク上のデータ構成 について記述するために FreeBSD が使用する用語 (パーティションおよびスライス)</p></li><li><p>システムにハードディスクを追加する方法</p></li><li><p>メモリディスクのような仮想ファイルシステムを設定する方法</p></li><li><p>使用できるディスク容量を制限するためにクォータを設定する方法</p></li><li><p>攻撃者から保護するためにディスクを暗号化する方法</p></li><li><p>FreeBSD で CD や DVD を作成する方法</p></li><li><p>バックアップのためのさまざまな記憶メディアオプション</p></li><li><p>FreeBSD で利用できるバックアッププログラムの使用方法</p></li><li><p>フロッピーディスクにバックアップする方法</p></li><li><p>スナップショットとは何か、そしてそれを効果的に使用する方法</p></li></ul></div></div></div><div class=sect1><h2 id=disk-naming>14.2. デバイス名<a class=anchor href=#disk-naming></a></h2><div class=sectionbody><div class=paragraph><p>以下は、FreeBSD で対応している物理記憶デバイスとそれに対応するデバイス名のリストです。</p></div><table id=disk-naming-physical-table class="tableblock frame-all grid-all stretch"><caption class=title>表 1. 物理ディスクへの名前付け</caption><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">ドライブの種類</th><th class="tableblock halign-left valign-top">ドライブのデバイス名</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock>IDE ハードドライブ</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>ad</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>IDE CD-ROM ドライブ</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>acd</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>SCSI ハードドライブおよび USB 大容量記憶デバイス</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>da</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>SCSI CD-ROM ドライブ</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>cd</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>その他の非標準的 CD-ROM ドライブ</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>ミツミ CD-ROM は <code>mcd</code>, Sony CD-ROM は <code>scd</code>, 松下/パナソニック CD-ROM は <code>matcd</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>フロッピードライブ</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>fd</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>SCSI テープドライブ</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>sa</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>IDE テープドライブ</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>ast</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>フラッシュドライブ</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>DiskOnChip® フラッシュデバイスは <code>fla</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>RAID ドライブ</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Adaptec® AdvancedRAID は <code>aacd</code>, Mylex® は <code>mlxd</code> および <code>mlyd</code>, AMI MegaRAID® は <code>amrd</code>, Compaq Smart RAID は <code>idad</code>, 3ware® RAID は<code>twed</code></p></td></tr></tbody></table></div></div><div class=sect1><h2 id=disks-adding>14.3. ディスクの追加<a class=anchor href=#disks-adding></a></h2><div class=sectionbody><div class=paragraph><p>現在一つしかドライブがない計算機に新しく SCSI ディスクを追加したいとしましょう。まずコンピュータの電源を切り、 コンピュータやコントローラ、 ドライブの製造元の説明書に従ってドライブを取り付けます。 このあたりの手順は非常に多岐にわたるため、 詳細はこの文書の範囲外です。</p></div><div class=paragraph><p><code>root</code> ユーザでログインします。 ドライブの取り付け後は <span class=filename>/var/run/dmesg.boot</span> を調べて新しいディスクが見つかっていることを確認しておきます。 この例では、新しく付けたドライブは <span class=filename>da1</span> で、 我々はそれを <span class=filename>/1</span> にマウントしたいとしましょう (もし IDE ドライブを付けようとしているのなら、デバイス名は 4.0 以前のシステムでは <span class=filename>wd1</span>, ほとんどの 4.x システムでは <span class=filename>ad1</span> になるでしょう)。</p></div><div class=paragraph><p>FreeBSD は IBM-PC 互換のコンピュータで動くため、 PC BIOS のパーティションを考慮に入れる必要があります。 これは従来の BSD パーティションとは異なります。PC ディスクは 4 つまでの BIOS パーティションエントリを持つことができます。 もしそのディスクを本当に FreeBSD 専用にしたい場合には <em>専用</em> モードで用いることもできます。 そうでない場合には、FreeBSD は PC BIOS パーティションのどれか一つの中に入れることになります。 FreeBSD では、従来の BSD パーティションと混乱しないように PC BIOS パーティションのことを<em>スライス</em>と呼びます。 また、別の OS がインストールされていたコンピュータで使われていたが FreeBSD 専用にするディスク上でもスライスを用いることができます。 これは、他の OS の <code>fdisk</code> ユーティリティを混乱させないためです。</p></div><div class=paragraph><p>スライスの場合、ドライブは <span class=filename>/dev/da1s1e</span> として加えられるでしょう。これは、SCSI ディスクでユニット番号は 1 (二つめの SCSI ディスク), スライスは 1 (PC BIOS のパーティションが 1) で BSD パーティション <span class=filename>e</span>, と読みます。 専用ディスクの場合だと単純に <span class=filename>/dev/da1e</span> として加えられるでしょう。</p></div><div class=sect2><h3 id=_sysinstall8_の利用>14.3.1. <a href="https://man.freebsd.org/cgi/man.cgi?query=sysinstall&amp;sektion=8&amp;format=html">sysinstall(8)</a> の利用<a class=anchor href=#_sysinstall8_の利用></a></h3><div class="exampleblock procedure"><div class=content><div class="olist arabic"><ol class=arabic><li><p>sysinstall の操作</p><div class=paragraph><p><code>sysinstall</code> の使い易いメニューを利用して、 新しいディスクのパーティション分けやラベル付けを行なうことができます。 <code>root</code> ユーザでログインするか <code>su</code> コマンドを用いるかして root 権限を取得します。 <code>/stand/sysinstall</code> を実行して <code>Configure</code> メニューに入ります。<code>FreeBSD Configuration Menu</code> の中でスクロールダウンして <code>Fdisk</code> の項目を選びます。</p></div></li><li><p>fdisk パーティションエディタ</p><div class=paragraph><p>fdisk では、ディスク全体を FreeBSD で使うために <code>A</code> を入力します。 "remain cooperative with any future possible operating systems" と聞かれたら <code>YES</code> と答えます。 <code>W</code> で変更をディスクに書き込みます。ここで <code>q</code> と入力して FDISK エディタを抜けます。 次にマスタブートレコードについて聞かれます。 ここでは既に動いているシステムにディスクを追加しようとしているので <code>None</code> を選びます。</p></div></li><li><p>ディスクラベルエディタ</p><div class=paragraph><p>次に sysinstall を終了し、 もう一度起動する必要があります。同じ手順を踏んで今度は <code>Label</code> オプションを選択し、 <code>Disk Label Editor</code> に入ります。 ここでは従来の BSD パーティションを作成します。 一つのディスクは <code>a</code> から <code>h</code> までのラベルがついた最大 8 つのパーティションを持つことができます。 いくつかのパーティションラベルは特別な用途に用いられます。 <code>a</code> パーティションはルートパーティション (<span class=filename>/</span>) です。したがって、システムディスク (つまり起動ディスク) のみに <code>a</code> パーティションがあるべきです。<code>b</code> パーティションはスワップパーティションに用いられ、 複数のディスクにスワップパーティションを作ることができます。 <code>c</code> は専用モードにおけるディスク全体、 もしくはスライスモードにおけるスライス全体を指します。 他のパーティションは汎用的に用いられます。</p></div><div class=paragraph><p>sysinstall のラベルエディタ は、ルートパーティションでもスワップパーティションでもないパーティションには、<code>e</code> パーティションを採用しようとします。ラベルエディタでファイルシステムを作成するには <code>C</code> を入力してください。 FS (ファイルシステム) かスワップかを聞かれたら <code>FS</code> を選びマウントポイント (たとえば <span class=filename>/mnt</span>) を入力します。 インストール後のモードでディスクを追加する場合、 sysinstall は <span class=filename>/etc/fstab</span> にエントリを追加しないため、 ここで指定するマウントポイントはそれほど重要ではありません。</p></div><div class=paragraph><p>さて、ディスクに新しいラベルを書き込み、 そこにファイルシステムを作る準備が整いました。早速 <code>W</code> を叩いて実行しましょう。 sysinstall からの、 新しいパーティションをマウントできない、 というエラーは無視してください。Label Editor から抜け、 sysinstall を終了します。</p></div></li><li><p>終了</p><div class=paragraph><p>最後に <span class=filename>/etc/fstab</span> を編集し、 新しいディスクのエントリを追加します。</p></div></li></ol></div></div></div></div><div class=sect2><h3 id=_コマンドラインユーティリティの利用>14.3.2. コマンドラインユーティリティの利用<a class=anchor href=#_コマンドラインユーティリティの利用></a></h3><div class=sect3><h4 id=_スライスの利用>14.3.2.1. スライスの利用<a class=anchor href=#_スライスの利用></a></h4><div class=paragraph><p>このセットアップ方法では、 すでにコンピュータに他のオペレーティングシステムがインストールされていても 正しく協調動作することが可能で、他のオペレーティングシステムの <code>fdisk</code> ユーティリティを混乱させることもありません。 新しいディスクにインストールする場合は、 この方法を用いることが推奨されています。 後述する <code>専用モード</code> は、 そうしなければならない理由がある時にのみ、 利用するようにしてください。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># dd if=/dev/zero of=/dev/da1 bs=1k count=1</span>
<span class=c># fdisk -BI da1 # 新しいディスクの初期化</span>
<span class=c># disklabel -B -w -r da1s1 auto # ディスクにラベルを付ける</span>
<span class=c># disklabel -e da1s1 # 作成したディスクラベルを編集し、パーティションを追加する</span>
<span class=c># mkdir -p /1</span>
<span class=c># newfs /dev/da1s1e # 作成したすべてのパーティションに対してこれを繰り返す</span>
<span class=c># mount /dev/da1s1e /1 # パーティションをマウントする</span>
<span class=c># vi /etc/fstab # /etc/fstab に適切なエントリを追加する</span></code></pre></div></div><div class=paragraph><p>IDE ディスクを使う場合は <span class=filename>da</span> の部分を <span class=filename>ad</span> とします。4.X より前のシステムでは、 (訳注: <span class=filename>ad</span> ではなく) <span class=filename>wd</span> としてください。</p></div></div><div class=sect3><h4 id=_専用モード>14.3.2.2. 専用モード<a class=anchor href=#_専用モード></a></h4><div class=paragraph><p>新しいドライブを他の OS と共有しない場合には <code>専用</code> モードを用いることもできます。 このモードはマイクロソフトの OS を混乱させることを憶えておいてください (しかし、それらによって壊されることはありません)。 一方、IBM の OS/2® はどんなパーティションでも見つけたら理解できなくても "専有" します。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># dd if=/dev/zero of=/dev/da1 bs=1k count=1</span>
<span class=c># disklabel -Brw da1 auto</span>
<span class=c># disklabel -e da1 # `e&#39; パーティションの作成</span>
<span class=c># newfs -d0 /dev/da1e</span>
<span class=c># mkdir -p /1</span>
<span class=c># vi /etc/fstab # /dev/da1e エントリの追加</span>
<span class=c># mount /1</span></code></pre></div></div><div class=paragraph><p>もう一つの方法は次の通り。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># dd if=/dev/zero of=/dev/da1 count=2</span>
<span class=c># disklabel /dev/da1 | disklabel -BrR da1 /dev/stdin</span>
<span class=c># newfs /dev/da1e</span>
<span class=c># mkdir -p /1</span>
<span class=c># vi /etc/fstab # /dev/da1e エントリの追加</span>
<span class=c># mount /1</span></code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>FreeBSD 5.1-RELEASE から、従来の <a href="https://man.freebsd.org/cgi/man.cgi?query=disklabel&amp;sektion=8&amp;format=html">disklabel(8)</a> プログラムは <a href="https://man.freebsd.org/cgi/man.cgi?query=bsdlabel&amp;sektion=8&amp;format=html">bsdlabel(8)</a> ユーティリティに置き換えられました。<a href="https://man.freebsd.org/cgi/man.cgi?query=bsdlabel&amp;sektion=8&amp;format=html">bsdlabel(8)</a> では、 使用されていない数多くのオプションやパラメタが削除されました。 たとえば <code>-r</code> オプションは <a href="https://man.freebsd.org/cgi/man.cgi?query=bsdlabel&amp;sektion=8&amp;format=html">bsdlabel(8)</a> では取り除かれました。詳細については <a href="https://man.freebsd.org/cgi/man.cgi?query=bsdlabel&amp;sektion=8&amp;format=html">bsdlabel(8)</a> のマニュアルページを参照してください。</p></div></td></tr></tbody></table></div></div></div></div></div><div class=sect1><h2 id=raid>14.4. RAID<a class=anchor href=#raid></a></h2><div class=sectionbody><div class=sect2><h3 id=raid-soft>14.4.1. ソフトウェア RAID<a class=anchor href=#raid-soft></a></h3><div class=sect3><h4 id=ccd>14.4.1.1. Concatenated Disk Driver (CCD) の設定<a class=anchor href=#ccd></a></h4><div class=paragraph><p>大容量記録に関する解決法を選択する際にもっとも重視すべき要素は、 速度、信頼性、そして費用です。 三つを同時にバランスよく実現することは稀です。 通常、速くて信頼性のある大容量記録装置は高価であり、 費用を抑えようとすると速度または信頼性のどちらかが犠牲になります。</p></div><div class=paragraph><p>ここで例にあげるシステムの設計においては、 費用が最も重要な要素として、次に速度、最後に信頼性が選択されています。 このシステムでのデータ転送速度は結局のところネットワークによって制限されます。 信頼性は大変重要です。ただし、以下で説明する CCD ドライブは、 データ自体はすでに CD-R に完全にバックアップしてあるもの (したがって交換は簡単にできます) の、オンラインデータの役割をさせています。</p></div><div class=paragraph><p>あなた自身の要求事項を決定することは、 大容量記録に関する解決法を選択することの最初の段階です。 もしあなたの要求事項が費用より速度または信頼性を優先するなら、 解決法はこのシステムとは違うものになるでしょう。</p></div><div class=sect4><h5 id=ccd-installhw>14.4.1.1.1. ハードウェアのインストール<a class=anchor href=#ccd-installhw></a></h5><div class=paragraph><p>IDE システムディスクに加えて、Western Digital 製の 30GB, 5400RPM の IDE ディスク三台を使って、 以下に説明されているような約 90GB のオンラインストレージとなる CCD ディスクを作成しました。各 IDE ディスクがそれぞれの IDE コントローラとケーブルをもっていることが理想的ですが、 費用を最低限にするために、 IDE コントローラを追加していません。その代わり、それぞれの IDE コントローラがマスタデバイスを一つ、 スレーブデバイスを一つ持つように、 ディスクはジャンパを使って設定されています。</p></div><div class=paragraph><p>再起動の際に、システム BIOS が接続されたディスクを自動的に検出するように設定されました。 より重要なことは、FreeBSD が再起動の際にそれらを検出することです。</p></div><div class="literalblock programlisting"><div class=content><pre>ad0: 19574MB &lt;WDC WD205BA&gt; [39770/16/63] at ata0-master UDMA33
ad1: 29333MB &lt;WDC WD307AA&gt; [59598/16/63] at ata0-slave UDMA33
ad2: 29333MB &lt;WDC WD307AA&gt; [59598/16/63] at ata1-master UDMA33
ad3: 29333MB &lt;WDC WD307AA&gt; [59598/16/63] at ata1-slave UDMA33</pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>FreeBSD がディスクをすべて検出しないときは、 ジャンパを正しく設定してあるか確認してください。多くの IDE ドライブは "ケーブルセレクト" ジャンパを持っています。 これはマスタ/スレーブの関係を設定するジャンパでは <em>ありません</em>。ドライブの文書を参照して、 正しいジャンパ設定を見つけてください。</p></div></td></tr></tbody></table></div><div class=paragraph><p>次に、ファイルシステムの一部分として、 それらをどのように接続するのかを考慮します。<a href="https://man.freebsd.org/cgi/man.cgi?query=vinum&amp;sektion=8&amp;format=html">vinum(8)</a> および <a href="https://man.freebsd.org/cgi/man.cgi?query=ccd&amp;sektion=4&amp;format=html">ccd(4)</a> の両方を検討すべきでしょう。この設定では、<a href="https://man.freebsd.org/cgi/man.cgi?query=ccd&amp;sektion=4&amp;format=html">ccd(4)</a> を選択しました。</p></div></div><div class=sect4><h5 id=ccd-setup>14.4.1.1.2. CCD の設定<a class=anchor href=#ccd-setup></a></h5><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=ccd&amp;sektion=4&amp;format=html">ccd(4)</a> ドライバは、いくつかの同じディスクを使って、 一つの論理的ファイルシステムに連結することができます。 <a href="https://man.freebsd.org/cgi/man.cgi?query=ccd&amp;sektion=4&amp;format=html">ccd(4)</a> を使用するためには、カーネルが <a href="https://man.freebsd.org/cgi/man.cgi?query=ccd&amp;sektion=4&amp;format=html">ccd(4)</a> に対応している必要があります。 次の行をカーネルコンフィギュレーションファイルに追加して、 カーネルを再構築し、再インストールしてください。</p></div><div class="literalblock programlisting"><div class=content><pre>pseudo-device   ccd     4</pre></div></div><div class=paragraph><p>5.X システムでは、 上記の代わりに次の行を追加しなければなりません。</p></div><div class="literalblock programlisting"><div class=content><pre>device   ccd</pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>FreeBSD 5.X では <a href="https://man.freebsd.org/cgi/man.cgi?query=ccd&amp;sektion=4&amp;format=html">ccd(4)</a> デバイスの数を指定する必要はありません。<a href="https://man.freebsd.org/cgi/man.cgi?query=ccd&amp;sektion=4&amp;format=html">ccd(4)</a> デバイスドライバは自己複製するようになりました - 新しいデバイスインスタンスは、 必要に応じてその都度自動的に作成されます。</p></div></td></tr></tbody></table></div><div class=paragraph><p>FreeBSD 3.0 以降では、 カーネルモジュールを読み込んで <a href="https://man.freebsd.org/cgi/man.cgi?query=ccd&amp;sektion=4&amp;format=html">ccd(4)</a> に対応することもできます。</p></div><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=ccd&amp;sektion=4&amp;format=html">ccd(4)</a> を設定するために、まず <a href="https://man.freebsd.org/cgi/man.cgi?query=disklabel&amp;sektion=8&amp;format=html">disklabel(8)</a> を使用してディスクにラベルを書き込まなくてはなりません。</p></div><div class="literalblock programlisting"><div class=content><pre>disklabel -r -w ad1 auto
disklabel -r -w ad2 auto
disklabel -r -w ad3 auto</pre></div></div><div class=paragraph><p>このコマンドはディスク全体を示す <span class=filename>ad1c</span>, <span class=filename>ad2c</span> および <span class=filename>ad3c</span> に対するディスクラベルを作成します。</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>FreeBSD 5.1-RELEASE から、従来の <a href="https://man.freebsd.org/cgi/man.cgi?query=disklabel&amp;sektion=8&amp;format=html">disklabel(8)</a> プログラムは <a href="https://man.freebsd.org/cgi/man.cgi?query=bsdlabel&amp;sektion=8&amp;format=html">bsdlabel(8)</a> ユーティリティに置き換えられました。<a href="https://man.freebsd.org/cgi/man.cgi?query=bsdlabel&amp;sektion=8&amp;format=html">bsdlabel(8)</a> では、 使用されていない数多くのオプションやパラメタが削除されました。 たとえば <code>-r</code> オプションは <a href="https://man.freebsd.org/cgi/man.cgi?query=bsdlabel&amp;sektion=8&amp;format=html">bsdlabel(8)</a> では取り除かれました。詳細については <a href="https://man.freebsd.org/cgi/man.cgi?query=bsdlabel&amp;sektion=8&amp;format=html">bsdlabel(8)</a> のマニュアルページを参照してください。</p></div></td></tr></tbody></table></div><div class=paragraph><p>次に、ディスクラベルのタイプを変更します。 <a href="https://man.freebsd.org/cgi/man.cgi?query=disklabel&amp;sektion=8&amp;format=html">disklabel(8)</a> を使用してディスクラベルを編集してください。</p></div><div class="literalblock programlisting"><div class=content><pre>disklabel -e ad1
disklabel -e ad2
disklabel -e ad3</pre></div></div><div class=paragraph><p>このコマンドは <code>EDITOR</code> 環境変数に設定されているエディタ (一般的には <a href="https://man.freebsd.org/cgi/man.cgi?query=vi&amp;sektion=1&amp;format=html">vi(1)</a>) でそれぞれのディスクの現在のディスクラベルを開きます。</p></div><div class=paragraph><p>変更されていないディスクラベルは以下のようになります。</p></div><div class="literalblock programlisting"><div class=content><pre>8 partitions:
#        size   offset    fstype   [fsize bsize bps/cpg]
  c: 60074784        0    unused        0     0     0   # (Cyl.    0 - 59597)</pre></div></div><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=ccd&amp;sektion=4&amp;format=html">ccd(4)</a> で使用する <code>e</code> パーティションを作成します。通常では <code>c</code> パーティションの行をコピーすれば良いでしょう。しかし、 <code>fstype</code> は <code>4.2BSD</code> でなければ <em>なりません</em>。 ディスクラベルは以下のようになるでしょう。</p></div><div class="literalblock programlisting"><div class=content><pre>8 partitions:
#        size   offset    fstype   [fsize bsize bps/cpg]
  c: 60074784        0    unused        0     0     0   # (Cyl.    0 - 59597)
  e: 60074784        0    4.2BSD        0     0     0   # (Cyl.    0 - 59597)</pre></div></div></div><div class=sect4><h5 id=ccd-buildingfs>14.4.1.1.3. ファイルシステムの構築<a class=anchor href=#ccd-buildingfs></a></h5><div class=paragraph><p><span class=filename>ccd0c</span> デバイスノードはまだ存在していないかも知れません。 そのときは、次のコマンドを実行して作成してください。</p></div><div class="literalblock programlisting"><div class=content><pre>cd /dev
sh MAKEDEV ccd0</pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>FreeBSD 5.0 では <a href="https://man.freebsd.org/cgi/man.cgi?query=devfs&amp;sektion=5&amp;format=html">devfs(5)</a> が <span class=filename>/dev</span> 以下のデバイスノードを自動的に管理するので、 <code>MAKEDEV</code>を使用する必要はありません。</p></div></td></tr></tbody></table></div><div class=paragraph><p>すべてのディスクにラベルを書き込んだので、 <a href="https://man.freebsd.org/cgi/man.cgi?query=ccd&amp;sektion=4&amp;format=html">ccd(4)</a> を構築してください。 これを行うためには、以下のようなオプションで <a href="https://man.freebsd.org/cgi/man.cgi?query=ccdconfig&amp;sektion=8&amp;format=html">ccdconfig(8)</a> を使います。</p></div><div class="literalblock programlisting"><div class=content><pre>ccdconfig ccd0 32 0 /dev/ad1e /dev/ad2e /dev/ad3e</pre></div></div><div class=paragraph><p>各オプションの使用法と意味は以下の通りです。
* 一番目の引数は設定するデバイスです。この例の場合は <span class=filename>/dev/ccd0c</span> です。 <span class=filename>/dev/</span> の部分はオプションです。
* ファイルシステムに対するインタリーブです。インタリーブは、 ディスクブロック内のストライプサイズを定義します。 ディスクブロックは通常 512 バイトです。したがって 32 インタリーブは 16,384 バイトとなります。
* これは <a href="https://man.freebsd.org/cgi/man.cgi?query=ccdconfig&amp;sektion=8&amp;format=html">ccdconfig(8)</a> に対するフラグです。 ドライブミラーリングを有効にしたい場合、 ここにフラグを指定します。 この設定では <a href="https://man.freebsd.org/cgi/man.cgi?query=ccd&amp;sektion=4&amp;format=html">ccd(4)</a> に対するミラーリングは提供しませんので、 0 (ゼロ) を指定しています。
* この <a href="https://man.freebsd.org/cgi/man.cgi?query=ccdconfig&amp;sektion=8&amp;format=html">ccdconfig(8)</a> に対する最後の引数は、 アレイ内に置くデバイスです。 それぞれのデバイスに対する完全なパス名を使用します。</p></div><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=ccdconfig&amp;sektion=8&amp;format=html">ccdconfig(8)</a> を実行すると <a href="https://man.freebsd.org/cgi/man.cgi?query=ccd&amp;sektion=4&amp;format=html">ccd(4)</a> が設定されます。 これでファイルシステムをインストールすることが可能です。 オプションについて <a href="https://man.freebsd.org/cgi/man.cgi?query=newfs&amp;sektion=8&amp;format=html">newfs(8)</a> を参照するか、 次のように実行してください。</p></div><div class="literalblock programlisting"><div class=content><pre>newfs /dev/ccd0c</pre></div></div></div><div class=sect4><h5 id=ccd-auto>14.4.1.1.4. 自動的に設定する<a class=anchor href=#ccd-auto></a></h5><div class=paragraph><p>一般的に、再起動するたびに <a href="https://man.freebsd.org/cgi/man.cgi?query=ccd&amp;sektion=4&amp;format=html">ccd(4)</a> をマウントしたいと思うでしょう。これを行うために、 まず設定をしなければなりません。次のコマンドを用いて、 現在の設定を <span class=filename>/etc/ccd.conf</span> に書き出します。</p></div><div class="literalblock programlisting"><div class=content><pre>ccdconfig -g &gt; /etc/ccd.conf</pre></div></div><div class=paragraph><p><span class=filename>/etc/ccd.conf</span> が存在すると、 再起動の際に <code>/etc/rc</code> スクリプトが <code>ccdconfig -C</code> を実行します。これにより、 <a href="https://man.freebsd.org/cgi/man.cgi?query=ccd&amp;sektion=4&amp;format=html">ccd(4)</a> は自動的に設定された後、マウントされます。</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>シングルユーザモードで起動している場合には、 <a href="https://man.freebsd.org/cgi/man.cgi?query=ccd&amp;sektion=4&amp;format=html">ccd(4)</a> を <a href="https://man.freebsd.org/cgi/man.cgi?query=mount&amp;sektion=8&amp;format=html">mount(8)</a> する前に、 アレイを設定するために次のコマンドを実行する必要があります。</p></div><div class="literalblock programlisting"><div class=content><pre>ccdconfig -C</pre></div></div></td></tr></tbody></table></div><div class=paragraph><p>自動的に <a href="https://man.freebsd.org/cgi/man.cgi?query=ccd&amp;sektion=4&amp;format=html">ccd(4)</a> をマウントするには、 <span class=filename>/etc/fstab</span> に <a href="https://man.freebsd.org/cgi/man.cgi?query=ccd&amp;sektion=4&amp;format=html">ccd(4)</a> のエントリ追加します。このように設定すると起動時にマウントされます。</p></div><div class="literalblock programlisting"><div class=content><pre>/dev/ccd0c              /media       ufs     rw      2       2</pre></div></div></div></div><div class=sect3><h4 id=vinum>14.4.1.2. Vinum ボリュームマネージャ<a class=anchor href=#vinum></a></h4><div class=paragraph><p>Vinum ボリュームマネージャは、 仮想ディスクドライブを実装したブロックデバイスドライバです。 Vinum は、ディスクハードウェアをブロックデバイスインタフェースから 分離し、データを配置します。 その結果、ディスク記憶装置を従来のスライスで扱うのと比較して、 柔軟性、性能および信頼性が向上しています。 <a href="https://man.freebsd.org/cgi/man.cgi?query=vinum&amp;sektion=8&amp;format=html">vinum(8)</a> は RAID-0, RAID-1 および RAID-5 モデル、 そしてそれぞれの組合せを実装しています。</p></div><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=vinum&amp;sektion=8&amp;format=html">vinum(8)</a> の詳細については Vinum ボリュームマネジャ を参照してください。</p></div></div></div><div class=sect2><h3 id=raid-hard>14.4.2. ハードウェア RAID<a class=anchor href=#raid-hard></a></h3><div class=paragraph><p>FreeBSD は、さまざまなハードウェア RAID コントローラにも対応しています。これらのデバイスはアレイを制御するための 特別なソフトウェアを FreeBSD で必要することなく、 RAID サブシステムを制御します。</p></div><div class=paragraph><p>カード上の BIOS を使用して、 カードはそれ自身でディスク操作のほとんどを制御します。以下は Promise IDE RAID コントローラを使用した設定の簡単な説明です。 このカードがインストールされ、システムが起動したときには、 情報の入力を促すプロンプトを表示します。 指示にしたがってカードの設定画面に進んでください。 接続されたドライブを組み合わせるように設定することができます。 設定後、ディスクは FreeBSD に対して単一のドライブのように見えます。 他の RAID レベルは適宜設定できます。</p></div></div><div class=sect2><h3 id=_ata_raid1_アレイの再構築>14.4.3. ATA RAID1 アレイの再構築<a class=anchor href=#_ata_raid1_アレイの再構築></a></h3><div class=paragraph><p>FreeBSD はアレイ内の障害ディスクを動作中に交換できます。 ただし、再起動前にそれを検知していることが必要です。</p></div><div class=paragraph><p><span class=filename>/var/log/messages</span> または <a href="https://man.freebsd.org/cgi/man.cgi?query=dmesg&amp;sektion=8&amp;format=html">dmesg(8)</a> の出力に次のような行があるでしょう。</p></div><div class="literalblock programlisting"><div class=content><pre>ad6 on monster1 suffered a hard error.
ad6: READ command timeout tag=0 serv=0 - resetting
ad6: trying fallback to PIO mode
ata3: resetting devices .. done
ad6: hard error reading fsbn 1116119 of 0-7 (ad6 bn 1116119; cn 1107 tn 4 sn 11) status=59 error=40
ar0: WARNING - mirror lost</pre></div></div><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=atacontrol&amp;sektion=8&amp;format=html">atacontrol(8)</a> を使用して詳細を調べてください。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># atacontrol list</span>
ATA channel 0:
	Master:      no device present
	Slave:   acd0 &lt;HL-DT-ST CD-ROM GCR-8520B/1.00&gt; ATA/ATAPI rev 0

ATA channel 1:
	Master:      no device present
	Slave:       no device present

ATA channel 2:
	Master:  ad4 &lt;MAXTOR 6L080J4/A93.0500&gt; ATA/ATAPI rev 5
	Slave:       no device present

ATA channel 3:
	Master:  ad6 &lt;MAXTOR 6L080J4/A93.0500&gt; ATA/ATAPI rev 5
	Slave:       no device present

<span class=c># atacontrol status ar0</span>
ar0: ATA RAID1 subdisks: ad4 ad6 status: DEGRADED</code></pre></div></div><div class="exampleblock procedure"><div class=content><div class="olist arabic"><ol class=arabic><li><p>ディスクを安全に取り外すために、 まずアレイから切り離します。</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># atacontrol detach 3</span></code></pre></div></div></li><li><p>ディスクを取り外します。</p></li><li><p>スペアのディスクを取り付けます。</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># atacontrol attach 3</span>
Master:  ad6 &lt;MAXTOR 6L080J4/A93.0500&gt; ATA/ATAPI rev 5
Slave:   no device present</code></pre></div></div></li><li><p>アレイを再構築します。</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># atacontrol rebuild ar0</span></code></pre></div></div></li><li><p>再構築コマンドは完了するまで他の操作を受け付けません。しかし、 もう一つ別のターミナルを (<span class=keyseq><kbd>Alt</kbd>+<kbd>Fn</kbd></span> を押して) 開き、 次のコマンドを実行すると進行状態を確認することができます。</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># dmesg | tail -10</span>
<span class=o>[</span>output removed]
ad6: removed from configuration
ad6: deleted from ar0 disk1
ad6: inserted into ar0 disk1 as spare

<span class=c># atacontrol status ar0</span>
ar0: ATA RAID1 subdisks: ad4 ad6 status: REBUILDING 0% completed</code></pre></div></div></li><li><p>操作が完了するまでお待ちください。</p></li></ol></div></div></div></div></div></div><div class=sect1><h2 id=creating-cds>14.5. 光メディア (CD & DVD) の作成と使用<a class=anchor href=#creating-cds></a></h2><div class=sectionbody><div class=sect2><h3 id=_はじめに>14.5.1. はじめに<a class=anchor href=#_はじめに></a></h3><div class=paragraph><p>CD は他の一般的なディスクと異なる様々な特徴を持っています。 そもそもユーザが書き込むことができません。 また遅延なしで連続的に読み出せるように、 トラック間をヘッドが移動しないですむようにデザインされています。 さらにこのサイズのメディアの中ではシステムをまたぐデータの 移動が比較的簡単でもあります。</p></div><div class=paragraph><p>CD はトラックの概念を持っていますが、 これはデータを連続的に読み出すためのものであってディスクの物理特性ではありません。 FreeBSD で CD を作成するには、まず CD のトラックとなるデータファイルを用意し、 そのトラックを CD に書き込みます。</p></div><div class=paragraph><p>ISO 9660 ファイルシステムはこの様な差異を扱うべく設計されました。 その結果、ファイルシステムは一般的に使用するのに差しつかえない程度に 制限されて標準化されています。幸いなことに、ISO 9660 ファイルシステムには拡張機構が提供されています。適切に書かれた CD は、 拡張機構に対応したシステムでは拡張を利用して、そうでないシステムでは 拡張機構を使用しない範囲で動作するようになっています。</p></div><div class=paragraph><p><a class=package href=https://cgit.freebsd.org/ports/tree/sysutils/mkisofs/>sysutils/mkisofs</a> プログラムは ISO 9660 ファイルシステムを含むデータファイルを作成するのに使われます。 これには様々な拡張をサポートするオプションがあり、 以下で説明します。 このソフトウェアは、ports の <a class=package href=https://cgit.freebsd.org/ports/tree/sysutils/mkisofs/>sysutils/mkisofs</a> からインストールすることができます。</p></div><div class=paragraph><p>CD に書き込むためのツールは、お使いの CD ライタが ATAPI 接続か否かにも依存します。ATAPI CD ライタなら、ベースシステムの一部である <code>burncd</code> プログラムを使います。SCSI や USB の CD ライタなら、ports の <a class=package href=https://cgit.freebsd.org/ports/tree/sysutils/cdrecord/>sysutils/cdrecord</a> をインストールして <code>cdrecord</code> プログラムを使うべきでしょう。</p></div><div class=paragraph><p><code>burncd</code> が対応しているドライブは限定されています。 ドライブが対応されているかどうかを確認するには、 <a href=http://www.freebsd.dk/ata/>CD-R/RW supported drives</a> にある一覧を見てください。</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>FreeBSD 5.X または FreeBSD 4.8-RELEASE 以降のバージョンを使用している場合、 <a href=#atapicam>ATAPI/CAM モジュール</a> を使用すると ATAPI ハードウェア上で SCSI ドライブ用の <code>cdrecord</code> および他のツールを使用できるようになります。</p></div></td></tr></tbody></table></div></div><div class=sect2><h3 id=mkisofs>14.5.2. mkisofs<a class=anchor href=#mkisofs></a></h3><div class=paragraph><p><a class=package href=https://cgit.freebsd.org/ports/tree/sysutils/mkisofs/>sysutils/mkisofs</a> は UNIX® ファイルシステムの名前空間におけるディレクトリツリーのイメージとして ISO 9660 ファイルシステムを作成します。 最も簡単な使い方は以下の通りです。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mkisofs -o imagefile.iso /path/to/tree</span></code></pre></div></div><div class=paragraph><p>このコマンドは <em>/path/to/tree</em> 以下のディレクトリツリーのコピーである ISO 9660 ファイルシステムを含んだ <em>imagefile.iso</em> ファイルを作成します。この過程において、ファイル名は標準的な ISO 9660 ファイルシステムの制限に適合するようなファイル名に対応づけられ、 ISO ファイルシステムでファイル名を文字化できないファイルは除外されます。</p></div><div class=paragraph><p>この制限を回避するために利用できるオプションはいくつもあります。 特に <code>-R</code> オプションは UNIX® システムで標準的な Rock Ridge 拡張を有効にします。<code>-J</code> オプションは Microsoft のシステムで標準的な Joliet 拡張を有効にし、 <code>-hfs</code> オプションは Mac OS® で使用されている HFS ファイルシステムを作成するために使われます。</p></div><div class=paragraph><p>FreeBSD でしか使わないのであれば、<code>-U</code> オプションを使用するとあらゆるファイル名制限を無効にできます。 さらに <code>-R</code> オプションとともに使うことで FreeBSD と同一のファイルシステムイメージを作成できますが、 これは ISO 9660 標準の多くを無視しています。</p></div><div class=paragraph><p>一般的に使われる最後のオプションは <code>-b</code> オプションです。 これは "El Torito" ブータブル CD を作成するのに使う起動イメージのありかを指定します。 このオプションは引数として起動イメージへのパスを、 CD に書き込まれるディレクトリツリーの頂点からの相対位置で取ります。 したがって <span class=filename>/tmp/myboot</span> がブート可能な FreeBSD システムで <span class=filename>/tmp/myboot/boot/cdboot</span> にブートイメージがあるならば、以下のようにすることで ISO 9660 ファイルシステムのイメージを <span class=filename>/tmp/bootable.iso</span> に作成することができます。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mkisofs -U -R -b boot/cdboot -o /tmp/bootable.iso /tmp/myboot</span></code></pre></div></div><div class=paragraph><p>この後、カーネルで <span class=filename>vn</span> (FreeBSD 4.X) または <span class=filename>md</span> (FreeBSD 5.X) が設定されていれば、 ファイルシステムを以下のようにしてマウントすることができます。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># vnconfig -e vn0c /tmp/bootable.iso</span>
<span class=c># mount -t cd9660 /dev/vn0c /mnt</span></code></pre></div></div><div class=paragraph><p>FreeBSD 4.X および FreeBSD 5.X に対しては以下の通りです。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mdconfig -a -t vnode -f /tmp/bootable.iso -u 0</span>
<span class=c># mount -t cd9660 /dev/md0 /mnt</span></code></pre></div></div><div class=paragraph><p><span class=filename>/mnt</span> と <span class=filename>/tmp/myboot</span> が同一かどうか確認してください。</p></div><div class=paragraph><p><a class=package href=https://cgit.freebsd.org/ports/tree/sysutils/mkisofs/>sysutils/mkisofs</a> には挙動を細かく制御するために他にもたくさんのオプションがあります。 特に、ISO 9660 レイアウトの変更や Joliet および HFS ディスク作成などの 詳細は <a href="https://man.freebsd.org/cgi/man.cgi?query=mkisofs&amp;sektion=8&amp;format=html">mkisofs(8)</a> のマニュアルページをご覧ください。</p></div></div><div class=sect2><h3 id=burncd>14.5.3. burncd<a class=anchor href=#burncd></a></h3><div class=paragraph><p>あなたが持っているのが ATAPI CD ライタなら、CD に ISO イメージを書き込むために <code>burncd</code> コマンドが使えます。 <code>burncd</code> はベースシステムの一部で <span class=filename>/usr/sbin/burncd</span> としてインストールされています。 使い方はとても単純でオプションも少ししかありません。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># burncd -f cddevice data imagefile.iso fixate</span></code></pre></div></div><div class=paragraph><p>以上のコマンドは <em>imagefile.iso</em> のコピーを <em>cddevice</em> に書き込みます。 デフォルトのデバイスは <span class=filename>/dev/acd0c</span> です。 書き込み速度や操作完了後に CD を自動的に取り出す方法、 オーディオデータの書き込みなどのオプションについては <a href="https://man.freebsd.org/cgi/man.cgi?query=burncd&amp;sektion=8&amp;format=html">burncd(8)</a> を見てください。</p></div></div><div class=sect2><h3 id=cdrecord>14.5.4. cdrecord<a class=anchor href=#cdrecord></a></h3><div class=paragraph><p>あなたが持っている CD ライタが ATAPI ではなければ、 CD を書き込むのに <code>cdrecord</code> を使う必要があります。 <code>cdrecord</code> はベースシステムの一部ではなく、 <a class=package href=https://cgit.freebsd.org/ports/tree/sysutils/cdrtools/>sysutils/cdrtools</a> の port または 適切な package を利用してインストールしなければなりません。 なお、ベースシステムを変更するとバイナリに矛盾が発生し、 "コースター" を作ってしまうおそれがあります。 したがって、システムをアップグレードする度にこの port も作り直すか、 あるいは FreeBSD の安定版を追いかけているのならば、 新しいバージョンが利用できるようになった時に ports をアップグレードする必要があります。</p></div><div class=paragraph><p><code>cdrecord</code> にはたくさんのオプションがありますが、 基本的な使い方は <code>burncd</code> よりもさらに簡単です。 ISO 9660 イメージを書き込むには以下のようにします。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cdrecord dev=device imagefile.iso</span></code></pre></div></div><div class=paragraph><p><code>cdrecord</code> のトリッキーな部分は、使用する <code>dev</code> を見つけるところにあります。 適切な設定を見つけるためには <code>cdrecord</code> の <code>-scanbus</code> フラグを使います。 たとえば、以下のような結果が出力されるでしょう。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cdrecord -scanbus</span>
Cdrecord 1.9 <span class=o>(</span>i386-unknown-freebsd4.2<span class=o>)</span> Copyright <span class=o>(</span>C<span class=o>)</span> 1995-2000 Jörg Schilling
Using libscg version <span class=s1>&#39;schily-0.1&#39;</span>
scsibus0:
        0,0,0     0<span class=o>)</span> <span class=s1>&#39;SEAGATE &#39;</span> <span class=s1>&#39;ST39236LW       &#39;</span> <span class=s1>&#39;0004&#39;</span> Disk
        0,1,0     1<span class=o>)</span> <span class=s1>&#39;SEAGATE &#39;</span> <span class=s1>&#39;ST39173W        &#39;</span> <span class=s1>&#39;5958&#39;</span> Disk
        0,2,0     2<span class=o>)</span> <span class=k>*</span>
        0,3,0     3<span class=o>)</span> <span class=s1>&#39;iomega  &#39;</span> <span class=s1>&#39;jaz 1GB         &#39;</span> <span class=s1>&#39;J.86&#39;</span> Removable Disk
        0,4,0     4<span class=o>)</span> <span class=s1>&#39;NEC     &#39;</span> <span class=s1>&#39;CD-ROM DRIVE:466&#39;</span> <span class=s1>&#39;1.26&#39;</span> Removable CD-ROM
        0,5,0     5<span class=o>)</span> <span class=k>*</span>
        0,6,0     6<span class=o>)</span> <span class=k>*</span>
        0,7,0     7<span class=o>)</span> <span class=k>*</span>
scsibus1:
        1,0,0   100<span class=o>)</span> <span class=k>*</span>
        1,1,0   101<span class=o>)</span> <span class=k>*</span>
        1,2,0   102<span class=o>)</span> <span class=k>*</span>
        1,3,0   103<span class=o>)</span> <span class=k>*</span>
        1,4,0   104<span class=o>)</span> <span class=k>*</span>
        1,5,0   105<span class=o>)</span> <span class=s1>&#39;YAMAHA  &#39;</span> <span class=s1>&#39;CRW4260         &#39;</span> <span class=s1>&#39;1.0q&#39;</span> Removable CD-ROM
        1,6,0   106<span class=o>)</span> <span class=s1>&#39;ARTEC   &#39;</span> <span class=s1>&#39;AM12S           &#39;</span> <span class=s1>&#39;1.06&#39;</span> Scanner
        1,7,0   107<span class=o>)</span> <span class=k>*</span></code></pre></div></div><div class=paragraph><p>リストにあるデバイスに対する適切な <code>dev</code> の値がここに示されています。あなたの CD ライタをこのリストから見つけ、 カンマで区切られた 3 つの数値を <code>dev</code> の値として使ってください。この例では CRW デバイスは 1,5,0 なので、適切な入力は <code>dev=1,5,0</code> となります。 値を明示するもっと簡単な方法もあります。詳細は <a href="https://man.freebsd.org/cgi/man.cgi?query=cdrecord&amp;sektion=1&amp;format=html">cdrecord(1)</a> を見てください。そこにはオーディオトラックを書き込む方法や、 書き込み速度その他を操作する方法も書かれています。</p></div></div><div class=sect2><h3 id=duplicating-audiocds>14.5.5. オーディオ CD の複製<a class=anchor href=#duplicating-audiocds></a></h3><div class=paragraph><p>CD からオーディオデータを連続したファイルに展開し、ブランク CD にこれらのファイルを書き込むことで、オーディオ CD を複製することができます。 この手順は ATAPI および SCSI ドライブの間で少し異なります。</p></div><div class="exampleblock procedure"><div class=content><div class=paragraph><p><strong>Procedure: SCSI ドライブ</strong></p></div><div class="olist arabic"><ol class=arabic><li><p><code>cdda2wav</code> を使用してオーディオを展開します。</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% cdda2wav <span class=nt>-v255</span> <span class=nt>-D2</span>,0 <span class=nt>-B</span> <span class=nt>-Owav</span></code></pre></div></div></li><li><p><code>cdrecord</code> を使用して <span class=filename>.wav</span> ファイルに書き出します。</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% cdrecord <span class=nt>-v</span> <span class=nv>dev</span><span class=o>=</span>2,0 <span class=nt>-dao</span> <span class=nt>-useinfo</span>  <span class=k>*</span>.wav</code></pre></div></div><div class=paragraph><p><a href=#cdrecord>cdrecord</a> に説明されているように <em>2.0</em> が適切に指定されていることを確かめてください。</p></div></li></ol></div></div></div><div class="exampleblock procedure"><div class=content><div class=paragraph><p><strong>Procedure: ATAPI ドライブ</strong></p></div><div class="olist arabic"><ol class=arabic><li><p>ATAPI CD ドライバでは、それぞれのトラックを <span class=filename>/dev/acddtnn</span> のように利用できます。 ここで <em>d</em> はドライブ番号であり、 <em>nn</em> は二桁十進のトラック番号です。 一桁の場合 0 を前に付加する必要があります。 したがって、一番目のディスクの一番目のトラックは <span class=filename>/dev/acd0t01</span>、二番目のトラックは <span class=filename>/dev/acd0t02</span>、三番目のトラックは <span class=filename>/dev/acd0t03</span> などとなります。</p><div class=paragraph><p>適切なデバイスファイルが <span class=filename>/dev</span> に存在することを確かめてください。 存在しなければ、たとえば次のようにして作成します。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /dev</span>
<span class=c># sh MAKEDEV acd0t99</span></code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>FreeBSD 5.0 では <a href="https://man.freebsd.org/cgi/man.cgi?query=devfs&amp;sektion=5&amp;format=html">devfs(5)</a> が <span class=filename>/dev</span> にエントリを自動的に作成、 管理するので、<code>MAKEDEV</code> を使用する必要はありません。</p></div></td></tr></tbody></table></div></li><li><p><a href="https://man.freebsd.org/cgi/man.cgi?query=dd&amp;sektion=1&amp;format=html">dd(1)</a> を使用して各トラックを展開します。 ファイルを展開する際、ブロックサイズを指定しなければなりません。</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># dd if=/dev/acd0t01 of=track1.cdr bs=2352</span>
<span class=c># dd if=/dev/acd0t02 of=track2.cdr bs=2352</span>
...</code></pre></div></div></li><li><p><code>burncd</code> を使用して、 展開したファイルをディスクに書き込みます。 これらがオーディオファイルであること、 そして書き込みが終了したときに <code>burncd</code> がディスクを固定 (fixate) することを明示しなければなりません。</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># burncd -f /dev/acd0c audio track1.cdr track2.cdr ... fixate</span></code></pre></div></div></li></ol></div></div></div></div><div class=sect2><h3 id=imaging-cd>14.5.6. データ CD の複製<a class=anchor href=#imaging-cd></a></h3><div class=paragraph><p>データ CD を、<a class=package href=https://cgit.freebsd.org/ports/tree/sysutils/mkisofs/>sysutils/mkisofs</a> を用いて作成されたイメージファイルと機能的に等価なイメージファイルにコピーできます。 これを使用して、すべてのデータ CD を複製することができます。 ここでの例は CDROM デバイスが <span class=filename>acd0</span> であるとしています。あなたの CDROM デバイスに読み替えてください。 CDROM の場合には、パーティション全体またはディスク全体 を指定するために <code>c</code> をデバイス名の後に追加しなければなりません。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># dd if=/dev/acd0c of=file.iso bs=2048</span></code></pre></div></div><div class=paragraph><p>これでディスクイメージを取り出すことができました。 すでに説明した方法を用いて CD に書き込むことができます。</p></div></div><div class=sect2><h3 id=mounting-cd>14.5.7. データ CD の使用<a class=anchor href=#mounting-cd></a></h3><div class=paragraph><p>さて、標準的なデータ CDROM を作成したので、 おそらく次はそれをマウントしてデータを読み出したいと思うでしょう。 デフォルトでは <a href="https://man.freebsd.org/cgi/man.cgi?query=mount&amp;sektion=8&amp;format=html">mount(8)</a> は、ファイルシステムタイプを <code>ufs</code> としています。 次のように実行しようとすると、</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mount /dev/cd0c /mnt</span></code></pre></div></div><div class=paragraph><p><code>Incorrect super block</code> というエラーが返されてマウントできないでしょう。 CDROM は <code>UFS</code> ファイルシステムではないために、 このような手順でマウントしようすると失敗します。 ファイルシステムのタイプが <code>ISO9660</code> であると <a href="https://man.freebsd.org/cgi/man.cgi?query=mount&amp;sektion=8&amp;format=html">mount(8)</a> に教えさえすれば、すべてはうまく動作します。 <a href="https://man.freebsd.org/cgi/man.cgi?query=mount&amp;sektion=8&amp;format=html">mount(8)</a> に <code>-t cd9660</code> オプションを指定することでこれを行います。 たとえば <span class=filename>/dev/cd0c</span> の CDROM デバイスを <span class=filename>/mnt</span> にマウントしたい場合は、 以下のように実行します。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mount -t cd9660 /dev/cd0c /mnt</span></code></pre></div></div><div class=paragraph><p>使用している CDROM インタフェースによっては、 デバイス名 (この例では <span class=filename>/dev/cd0c</span>) が異なるかもしれないことに注意してください。 また、<code>-t cd9660</code> オプションは、単に <a href="https://man.freebsd.org/cgi/man.cgi?query=mount_cd9660&amp;sektion=8&amp;format=html">mount_cd9660(8)</a> を実行します。 この例を以下のように短縮することもできます。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mount_cd9660 /dev/cd0c /mnt</span></code></pre></div></div><div class=paragraph><p>一般的にこの方法では、すべてのメーカの データ CDROM を使用することができます。しかしながら、特定の ISO 9660 拡張が施されたディスクでは奇妙な動作をするかもしれません。 たとえば Joliet ディスクは、 すべてのファイル名を 2 バイトの Unicode 文字で格納します。 FreeBSD カーネルは (まだ) Unicode を理解できないので、 非英語文字はクエスチョンマークで表示されます (FreeBSD 4.3 以降を使用している場合、CD9660 ドライバには適切な Unicode 変換表を読み込むための急ごしらえのフックが含まれています。 いくつかの共通のエンコードに対するモジュールは <a class=package href=https://cgit.freebsd.org/ports/tree/sysutils/cd9660_unicode/>sysutils/cd9660_unicode</a> port から利用可能です)。</p></div><div class=paragraph><p>CDROM をマウントしようとする時に、 <code>Device not configured</code> と表示されるかもしれません。これは、ディスクがトレーにないと CDROM ドライブが判断しているか、 ドライブがバス上に認識できないことを通常意味します。 ディスクが挿入されたことを CDROM ドライブが認識するには数秒かかりますので、 辛抱強く待ってください。</p></div><div class=paragraph><p>バスのリセットに返答するためのタイムアウトが短いために、時々 SCSI CDROM は認識に失敗するかもしれません。SCSI CDROM を持っている場合は、 次のオプションをカーネルコンフィギュレーションファイルに追加して、 <a href=../kernelconfig/#kernelconfig-building>カーネルを再構築してください</a>。</p></div><div class="literalblock programlisting"><div class=content><pre>options SCSI_DELAY=15000</pre></div></div><div class=paragraph><p>これより、SCSI バスを起動時に 15 秒間停止させて、 CDROM ドライブがバスリセットに応答する機会を与えます。</p></div></div><div class=sect2><h3 id=rawdata-cd>14.5.8. Raw データ CD の書き込み<a class=anchor href=#rawdata-cd></a></h3><div class=paragraph><p>ISO 9660 ファイルシステムを作成すること無く、 ファイルを直接 CD に書き込むこともできます。 この方法をバックアップ目的に使用している人もいます。 これは、標準 CD を書き込むよりもさらに速く実行することができます。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># burncd -f /dev/acd1c -s 12 data archive.tar.gz fixate</span></code></pre></div></div><div class=paragraph><p>このように CD に書き込まれたデータを取得するには、 raw デバイスノードからデータを読み込まなくてはなりません。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># tar xzvf /dev/acd1c</span></code></pre></div></div><div class=paragraph><p>このディスクを通常の CDROM としてマウントすることはできません。 このような CDROM は FreeBSD を除いて、 他のすべてのオペレーティングシステムでは読み込むことはできません。 CD をマウントしたいか、 その他のオペレーティングシステムとデータを共有したい場合は、 上記に説明したように <a class=package href=https://cgit.freebsd.org/ports/tree/sysutils/mkisofs/>sysutils/mkisofs</a> を使用しなくてはなりません。</p></div></div><div class=sect2><h3 id=atapicam>14.5.9. ATAPI/CAM ドライバの使用<a class=anchor href=#atapicam></a></h3><div class=paragraph><p>このドライバは、ATAPI デバイス (CD-ROM, CD-RW, DVD ドライブなど) へ SCSI サブシステムを通じてアクセスすることを可能にします。 これにより、<a class=package href=https://cgit.freebsd.org/ports/tree/sysutils/cdrdao/>sysutils/cdrdao</a> または <a href="https://man.freebsd.org/cgi/man.cgi?query=cdrecord&amp;sektion=1&amp;format=html">cdrecord(1)</a> のようなアプリケーションが使用できるようになります。</p></div><div class=paragraph><p>このドライバを使用するためには、 カーネルコンフィギュレーションファイルに次の行を追加する必要があります。</p></div><div class="literalblock programlisting"><div class=content><pre>device atapicam
device scbus
device cd
device pass</pre></div></div><div class=paragraph><p>次の行もカーネルコンフィギュレーションファイルに必要です。</p></div><div class="literalblock programlisting"><div class=content><pre>device ata
device atapicd</pre></div></div><div class=paragraph><p>両方がすでに存在しなければなりません。</p></div><div class=paragraph><p>それから再構築し、新しいカーネルをインストールし、 コンピュータを再起動します。 起動プロセス中にディスクライタは以下のように表示されるでしょう。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>acd0: CD-RW &lt;MATSHITA CD-RW/DVD-ROM UJDA740&gt; at ata1-master PIO4
cd0 at ata1 bus 0 target 0 lun 0
cd0: &lt;MATSHITA CDRW/DVD UJDA740 1.00&gt; Removable CD-ROM SCSI-0 device
cd0: 16.000MB/s transfers
cd0: Attempt to query device size failed: NOT READY, Medium not present - tray closed</code></pre></div></div><div class=paragraph><p>ドライブは <span class=filename>/dev/cd0</span> デバイスを通じてアクセスすることが可能となります。 たとえば、次のようにして CD-ROM を <span class=filename>/mnt</span> にマウントします。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mount -t cd9660 /dev/cd0c /mnt</span></code></pre></div></div><div class=paragraph><p><code>root</code> 権限で次のコマンドを実行して、 ライタの SCSI アドレスを得ることができます。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># camcontrol devlist</span>
&lt;MATSHITA CDRW/DVD UJDA740 1.00&gt;   at scbus1 target 0 lun 0 <span class=o>(</span>pass0,cd0<span class=o>)</span></code></pre></div></div><div class=paragraph><p>したがって、<code>1,0,0</code> が <a href="https://man.freebsd.org/cgi/man.cgi?query=cdrecord&amp;sektion=1&amp;format=html">cdrecord(1)</a> およびその他の SCSI アプリケーションで使用する SCSI アドレスです。</p></div><div class=paragraph><p>ATAPI/CAM および SCSI システムの詳細は <a href="https://man.freebsd.org/cgi/man.cgi?query=atapicam&amp;sektion=4&amp;format=html">atapicam(4)</a> および <a href="https://man.freebsd.org/cgi/man.cgi?query=cam&amp;sektion=4&amp;format=html">cam(4)</a> マニュアルページを参照してください。</p></div></div></div></div><div class=sect1><h2 id=floppies>14.6. フロッピーディスクの作成と使用<a class=anchor href=#floppies></a></h2><div class=sectionbody><div class=paragraph><p>フロッピーディスクにデータを格納することはしばしば役にたちます。 たとえば、ある人が他のリムーバブル記録メディアを何も持っていないときや、 小さなデータを他のコンピュータに移動させる必要があるときです。</p></div><div class=paragraph><p>この節では、FreeBSD におけるフロッピーディスクの使用方法を説明します。 主に 3.5 インチの DOS フロッピーのフォーマットと操作方法を扱いますが、 他のフロッピーディスクの形式についても概念は似ています。</p></div><div class=sect2><h3 id=_フロッピーのフォーマット>14.6.1. フロッピーのフォーマット<a class=anchor href=#_フロッピーのフォーマット></a></h3><div class=sect3><h4 id=_デバイス>14.6.1.1. デバイス<a class=anchor href=#_デバイス></a></h4><div class=paragraph><p>他のデバイスと同様に、フロッピーディスクは <span class=filename>/dev</span> にあるエントリを通じてアクセスされます。4.X およびそれ以前のリリースにおいて raw フロッピーディスクにアクセスするには <span class=filename>/dev/fdN</span> または <span class=filename>/dev/fdNX</span> を使用します。<em>N</em> はドライブ番号を表し、 大抵は 0 です。<em>X</em> は文字を表します。</p></div><div class=paragraph><p>5.0 およびそれ以降のリリースでは、単に <span class=filename>/dev/fdN</span> を使用します。</p></div><div class=sect4><h5 id=_4_x_およびそれ以前のリリースでのディスクサイズ>14.6.1.1.1. 4.X およびそれ以前のリリースでのディスクサイズ<a class=anchor href=#_4_x_およびそれ以前のリリースでのディスクサイズ></a></h5><div class=paragraph><p><span class=filename>/dev/fdN.size</span> というデバイスもあります。 <em>size</em> はフロッピーディスクのサイズをキロバイトで示したものです。 これらのエントリは低レベルフォーマットの際に、 ディスクサイズを決定するのに使用されます。 1440kB は以下の例で使用されるサイズです。</p></div><div class=paragraph><p>時々 <span class=filename>/dev</span> 下のエントリは (再) 作成されなければなりません。次のコマンドでこれを行います。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /dev &amp;&amp; ./MAKEDEV &#34;fd*&#34;</span></code></pre></div></div></div><div class=sect4><h5 id=_5_x_およびそれ以降のリリースでのディスクサイズ>14.6.1.1.2. 5.X およびそれ以降のリリースでのディスクサイズ<a class=anchor href=#_5_x_およびそれ以降のリリースでのディスクサイズ></a></h5><div class=paragraph><p>FreeBSD 5.0 では <a href="https://man.freebsd.org/cgi/man.cgi?query=devfs&amp;sektion=5&amp;format=html">devfs(5)</a> が <span class=filename>/dev</span> 内のエントリを自動的に管理するので、 <code>MAKEDEV</code>を使用する必要はありません。</p></div><div class=paragraph><p>所望のディスクサイズは <a href="https://man.freebsd.org/cgi/man.cgi?query=fdformat&amp;sektion=1&amp;format=html">fdformat(1)</a> に <code>-f</code> フラグを通して渡されます。対応しているサイズは <a href="https://man.freebsd.org/cgi/man.cgi?query=fdcontrol&amp;sektion=8&amp;format=html">fdcontrol(8)</a> のマニュアルページに掲載されていますが、最良に動作するのは 1440kB だと助言しておきます。</p></div></div></div><div class=sect3><h4 id=_フォーマット>14.6.1.2. フォーマット<a class=anchor href=#_フォーマット></a></h4><div class=paragraph><p>フロッピーディスクは、 使用前に低レベルフォーマットをする必要があります。 通常、ベンダは低レベルフォーマット済みのディスクを出荷していますが、 フォーマットはメディアの品質を確認するよい方法です。 より大きな (または小さな) ディスクサイズにすることも可能ですが、 ほとんどのフロッピーディスクのサイズは 1440kB で動作するように設計されています。</p></div><div class=paragraph><p>フロッピーディスクを低レベルフォーマットするには <a href="https://man.freebsd.org/cgi/man.cgi?query=fdformat&amp;sektion=1&amp;format=html">fdformat(1)</a> を使用する必要があります。 このユーティリティは引数としてデバイス名を指定します。</p></div><div class=paragraph><p>ディスクが良好かあるいは不良であるかを決定するのに役立つので、 エラーメッセージをすべてメモに取っておいてください。</p></div><div class=sect4><h5 id=_4_x_以前のリリースでのフォーマット>14.6.1.2.1. 4.X 以前のリリースでのフォーマット<a class=anchor href=#_4_x_以前のリリースでのフォーマット></a></h5><div class=paragraph><p><span class=filename>/dev/fdN.size</span> デバイスを使ってフロッピーをフォーマットします。 新しい 3.5 インチフロッピーディスクをドライブに挿入し、 以下のコマンドを実行してください。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># /usr/sbin/fdformat /dev/fd0.1440</span></code></pre></div></div></div><div class=sect4><h5 id=_5_0_以降のリリースでのフォーマット>14.6.1.2.2. 5.0 以降のリリースでのフォーマット<a class=anchor href=#_5_0_以降のリリースでのフォーマット></a></h5><div class=paragraph><p><span class=filename>/dev/fdN</span> デバイスを使用してフロッピーをフォーマットします。 新しい 3.5 インチフロッピーディスクをドライブに挿入し、 以下のコマンドを実行してください。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># /usr/sbin/fdformat -f 1440 /dev/fd0</span></code></pre></div></div></div></div></div><div class=sect2><h3 id=_ディスクラベル>14.6.2. ディスクラベル<a class=anchor href=#_ディスクラベル></a></h3><div class=paragraph><p>ディスクを低レベルフォーマットしたら、 次にディスクラベルを作成する必要があります。 ディスクラベルは後で破棄されますが、 システムがディスクのサイズとジオメトリを決定するのに必要になります。</p></div><div class=paragraph><p>新しいディスクラベルはディスク全体を引き継ぎ、 フロッピーのジオメトリに関する適切な情報のすべてが含まれます。 ディスクラベルに対するジオメトリの値は <span class=filename>/etc/disktab</span> に掲載されています。</p></div><div class=paragraph><p>次のように <a href="https://man.freebsd.org/cgi/man.cgi?query=disklabel&amp;sektion=8&amp;format=html">disklabel(8)</a> を実行できます。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># /sbin/disklabel -B -r -w /dev/fd0 fd1440</span></code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>FreeBSD 5.1-RELEASE から、従来の <a href="https://man.freebsd.org/cgi/man.cgi?query=disklabel&amp;sektion=8&amp;format=html">disklabel(8)</a> プログラムは <a href="https://man.freebsd.org/cgi/man.cgi?query=bsdlabel&amp;sektion=8&amp;format=html">bsdlabel(8)</a> ユーティリティに置き換えられました。<a href="https://man.freebsd.org/cgi/man.cgi?query=bsdlabel&amp;sektion=8&amp;format=html">bsdlabel(8)</a> では、 使用されていないオプションおよびパラメタの数多くが削除されました。 たとえば <code>-r</code> オプションは <a href="https://man.freebsd.org/cgi/man.cgi?query=bsdlabel&amp;sektion=8&amp;format=html">bsdlabel(8)</a> では取り除かれました。詳細については <a href="https://man.freebsd.org/cgi/man.cgi?query=bsdlabel&amp;sektion=8&amp;format=html">bsdlabel(8)</a> マニュアルページを参照してください。</p></div></td></tr></tbody></table></div></div><div class=sect2><h3 id=_ファイルシステム>14.6.3. ファイルシステム<a class=anchor href=#_ファイルシステム></a></h3><div class=paragraph><p>これでフロッピーを高レベルフォーマットする準備ができました。これは FreeBSD がディスクを読み書きする新しいファイルシステムを作成します。 新しいファイルシステムを作成するとディスクラベルは破棄されます。 したがって、ディスクを再フォーマットするときには、 ディスクラベルを再作成しなくてはなりません。</p></div><div class=paragraph><p>フロッピーのファイルシステムには UFS または FAT を使用できます。 フロッピーに対しては FAT が一般的によりよい選択です。</p></div><div class=paragraph><p>フロッピー上に新しいファイルシステムを作成するには次のようにします。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># /sbin/newfs_msdos /dev/fd0</span></code></pre></div></div><div class=paragraph><p>これでディスクが使用できるようになりました。</p></div></div><div class=sect2><h3 id=_フロッピーの使用>14.6.4. フロッピーの使用<a class=anchor href=#_フロッピーの使用></a></h3><div class=paragraph><p>フロッピーを使用するために、<a href="https://man.freebsd.org/cgi/man.cgi?query=mount_msdos&amp;sektion=8&amp;format=html">mount_msdos(8)</a> (4.X 以前のリリース) または <a href="https://man.freebsd.org/cgi/man.cgi?query=mount_msdosfs&amp;sektion=8&amp;format=html">mount_msdosfs(8)</a> (5.0 以後のリリース) を用いてマウントします。 Ports Collection から <a class=package href=https://cgit.freebsd.org/ports/tree/emulators/mtools/>emulators/mtools</a> を使用することもできます。</p></div></div></div></div><div class=sect1><h2 id=backups-tapebackups>14.7. データテープの作成と使用<a class=anchor href=#backups-tapebackups></a></h2><div class=sectionbody><div class=paragraph><p>一般的なテープメディアには 4mm, 8mm, QIC, ミニカートリッジ、 DLT があります。</p></div><div class=sect2><h3 id=backups-tapebackups-4mm>14.7.1. 4mm (DDS: Digital Data Storage)<a class=anchor href=#backups-tapebackups-4mm></a></h3><div class=paragraph><p>4mm テープはワークステーションのバックアップメディアとして QIC に取って代わりつつあります。この傾向は QIC ドライブの主要なメーカであった Archive を Conner が買収し QIC ドライブの製造を中止したことで加速しました。 4mm ドライブは小型で静かですが 8mm ドライブが持っている信頼性ほど、その評判は良くありません。 また、4mm カートリッジは 8mm カートリッジよりも安価で小型 (3 x 2 x 0.5 インチ、76 x 51 x 12 mm) になっています。 ただし、8mm と同様に、4mm のヘッドはヘリカルスキャン方式 (訳注: VTR と同様の回転ヘッドを使う方式) を採用しているため、比較的寿命が短いです。</p></div><div class=paragraph><p>ドライブのデータスループットは、150 kB/s から 最大で 500 kB/s 程度です。 データ容量は 1.3 GB から 2.0 GB です。 ドライブのほとんどで利用可能なハードウェア圧縮を使用すると、 容量が約 2 倍になります。 マルチドライブテープライブラリユニットは 1 つの筐体に 6 つのドライブを収容可能で、自動的にテープの交換ができます。 ライブラリの容量は 240 GB に達します。</p></div><div class=paragraph><p>現在の DDS-3 標準は 12 GB (圧縮時 24 GB) までのテープ容量に対応しています。</p></div><div class=paragraph><p>8mm ドライブと同様に 4mm ドライブはヘリカルスキャンを使用します。 ヘリカルスキャン方式の利点および欠点はすべて 4mm および 8mm ドライブの両方に当てはまります。</p></div><div class=paragraph><p>テープは 2,000 回のパスあるいは 100 回フルバックアップした後には交換するべきです。</p></div></div><div class=sect2><h3 id=backups-tapebackups-8mm>14.7.2. 8mm (Exabyte)<a class=anchor href=#backups-tapebackups-8mm></a></h3><div class=paragraph><p>8mm テープは SCSI テープドライブとして最もよく使われているもので、 データ交換用として最良の選択です。ほとんどのサイトには Exabyte 2 GB 8mm テープドライブがあるでしょう。8mm ドライブは信頼性が高く、使いやすく、静かです。 カートリッジは安価で小型です (4.8 x 3.3 x 0.6 インチ、122 x 84 x 15 mm)。8mm テープの欠点は、テープとヘッドの相対的な速度が高速なために、 比較的ヘッドとテープの寿命が短いことです。</p></div><div class=paragraph><p>データスループットは 250 kB/s から 500 kB/s 程度です。データ容量は 300 MB から 7 GB です。 ほとんどのドライブで利用可能なハードウェア圧縮を利用すると、 容量が約 2 倍になります。 これらのドライブは、単一のユニットから 6 つのドライブと 120 本のテープを一つの筐体に収容したマルチドライブテープライブラリまで利用可能です。 テープはユニットによって自動的に取り換えられます。 ライブラリの容量は 840 GB 以上に達します。</p></div><div class=paragraph><p>Exabyte の "Mammoth" モデルはテープ 1 本あたり 12 GB (圧縮時 24 GB) に対応し、 従来のテープドライブと比べ費用は約 2 倍になります。</p></div><div class=paragraph><p>データはヘリカルスキャンを用いてテープに記録されます。 ヘッダはメディアに対してある傾き (約 6 度) に配置されます。 テープはヘッドのある円筒の周の 270 度にわたって接触します。 テープが円筒面を走行する間、円筒は回転しています。 この結果、高密度のデータのつまったトラックは、 狭い間隔でテープの上端と下端の間を斜めに横切ります。</p></div></div><div class=sect2><h3 id=backups-tapebackups-qic>14.7.3. QIC<a class=anchor href=#backups-tapebackups-qic></a></h3><div class=paragraph><p>QIC-150 テープとドライブは、 おそらく最も一般的に使われているドライブとメディアでしょう。 QIC テープドライブは "現実的な" バックアップドライブとしては最も高価でないものです。 欠点はメディアのコストです。QIC テープは 8mm や 4mm テープと比較して GB あたりのデータの保存で 5 倍ほど高価です。 しかし、あなたの必要とする量が半ダース程のテープで十分であれば、 QIC は正しい選択かもしれません。QIC は <em>最も</em>一般的なテープドライブです。 すべてのサイトに QIC ドライブのどれかの容量のものがあります。問題は、 QIC は同じようなテープ (まったく同じ場合もある) に多様な記録密度があることです。QIC ドライブは静かではありません。 これらのドライブはデータ記録を開始する前に音をたててシークしますし、 リード、ライト、シークの時にはっきりと聞こえる音を出します。 QIC テープの大きさは (6 x 4 x 0.7 インチ、152 x 102 x 17 mm) です。 1/4 インチ幅のテープも使用している <a href=#backups-tapebackups-mini>ミニカートリッジ</a> は別に議論します。テープライブラリやチェンジャはありません。</p></div><div class=paragraph><p>データスループットは ~1500 kB/s から ~5000 kB/s 程度です。データ容量は 400 MB から 150 GB です。 ハードウェア圧縮が最近のドライブの多くで利用できます。 QIC ドライブは DAT ドライブに置き換えられつつあり、 あまり頻繁には使用されなくなっています。</p></div><div class=paragraph><p>データは複数のトラックに分かれてテープに記録されます。 トラックはテープメディアの長さ方向の一端からもう一方の端までです (訳注: 1 トラックの read/write が終わるとテープの走行方向を反転させ 次のトラックの read/write を行います)。トラックの数と、 それに対応するトラックの幅はテープの容量によって変わります。 すべてではありませんが、 最近のドライブはほとんど、少なくとも読み出しについては (場合によっては書き込みも) 下位互換性があります。 QIC はデータの安全性についてはよいといわれています (ヘリカルスキャンドライブに比べて機構は単純でより丈夫です)。</p></div><div class=paragraph><p>テープは 5000 回のバックアップで寿命となるでしょう。</p></div></div><div class=sect2><h3 id=backups-tapebackups-mini>14.7.4. XXX* ミニカートリッジ<a class=anchor href=#backups-tapebackups-mini></a></h3></div><div class=sect2><h3 id=backups-tapebackups-dlt>14.7.5. DLT<a class=anchor href=#backups-tapebackups-dlt></a></h3><div class=paragraph><p>DLT はここに示したドライブのタイプの中で最高速のデータ転送レートを発揮します。 1/2 インチ (12.5mm) テープが単リールのカートリッジ (4 x 4 x 1 インチ、100 x 100 x 25 mm) に入っています。 カートリッジのひとつの側面全体がスイングゲートになっています。 ドライブの機構がこのゲートを開け、テープリーダを引き出します。 テープリーダには楕円形の穴があり、 ドライブがテープを "引っ掛ける" のに使います。 巻き取りのためのリールはドライブの中にあります。 ここに挙げた他のカートリッジはすべて (9 トラックテープは唯一の例外です) 送り出しリールと巻き取りリールの両方がカートリッジの中にあります。</p></div><div class=paragraph><p>データスループットは約 1.5 MB/s で、4mm, 8mm, QIC テープドライブの 3 倍です。データ容量は単一のドライブで 10 GB から 20 GB の範囲です。マルチテープチェンジャ、 マルチテープドライブ、5 から 900 巻のテープを 1 から 20 ドライブで扱うマルチドライブテープライブラリがあり、 50 GB から 9 TB の容量が得られます。</p></div><div class=paragraph><p>圧縮によって、DLT Type IV フォーマットは 70 GB までの容量に対応しています。</p></div><div class=paragraph><p>データは (QICテープのように) テープの走行方向と平行に複数あるトラックへ記録されます。 2 つのトラックに同時書き込みを行います。 read/write ヘッドの寿命は比較的長いと言えます。 テープの走行が止まればヘッドとテープの間の相対運動は無いからです。</p></div></div><div class=sect2><h3 id=_ait>14.7.6. AIT<a class=anchor href=#_ait></a></h3><div class=paragraph><p>AIT は、Sony が発表した新しいフォーマットで、 テープ 1 本あたり 50 GB (圧縮時) まで格納できます。 テープにはメモリチップが搭載されており、 テープの内容の索引情報を保持しています。 他のテープではテープ上のファイルの位置を把握するのに数分必要とするのですが、 このテープドライブでは索引情報を読んで直ちに決定することができます。 SAMS:Alexandria のようなソフトウェアは、40 を超える ATI テープライブラリを操作できるのはもちろんのこと、 テープのメモリチップと直接通信して、スクリーンに内容を表示し、 どのファイルがどのテープにバックアップされたかを調べて、 正しいテープを見つけ、読み込み、 テープからデータを復元することができます。</p></div><div class=paragraph><p>このようなライブラリは大体 $20,000 くらいするので、 愛好家が購入できる価格帯からは外れてしまいます。</p></div></div><div class=sect2><h3 id=_新品のテープを初めて使う場合>14.7.7. 新品のテープを初めて使う場合<a class=anchor href=#_新品のテープを初めて使う場合></a></h3><div class=paragraph><p>全く新品の空テープを読もうとしたり書き込もうとすると、 処理は失敗するでしょう。 次のようなメッセージがコンソールに出力されるでしょう。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>sa0<span class=o>(</span>ncr1:4:0<span class=o>)</span>: NOT READY asc:4,1
sa0<span class=o>(</span>ncr1:4:0<span class=o>)</span>:  Logical unit is <span class=k>in </span>process of becoming ready</code></pre></div></div><div class=paragraph><p>テープに識別ブロック (Identifier Block:block number 0) がありません。QIC-525 標準を採用したすべての QIC テープドライブは識別ブロックをテープに書き込みます。 2 つの解決方法があります。</p></div><div class=ulist><ul><li><p><code>mt fsf 1</code> によりテープドライブはテープに識別ブロックを書き込みます。</p></li><li><p>フロントパネルのボタンを押してテープを取り出します。</p><div class=paragraph><p>再びテープを挿入し、データをテープに <code>dump</code> します。</p></div><div class=paragraph><p><code>dump</code> は <code>DUMP: End of tape detected</code> と報告し、 コンソールには <code>HARDWARE FAILURE info:280 asc:80,96</code> と表示されるでしょう。</p></div><div class=paragraph><p><code>mt rewind</code> を使ってテープを巻戻します。</p></div><div class=paragraph><p>次からはテープの操作はうまくいくでしょう。</p></div></li></ul></div></div></div></div><div class=sect1><h2 id=backups-floppybackups>14.8. フロッピーディスクへのバックアップ<a class=anchor href=#backups-floppybackups></a></h2><div class=sectionbody><div class=sect2><h3 id=floppies-using>14.8.1. データをバックアップするのにフロッピーは使えますか?<a class=anchor href=#floppies-using></a></h3><div class=paragraph><p>フロッピーディスクは以下の理由によって、 実際にバックアップをつくるための適切なメディアではありません。</p></div><div class=ulist><ul><li><p>メディアの信頼性が (特に長期間の場合) 低い。</p></li><li><p>バックアップとリストアがとても遅い。</p></li><li><p>容量が非常に小さい (1 ダースかそこらのフロッピーディスクに ハードディスク全体をバックアップしていた時代は、 はるか遠くに過ぎ去りました)。</p></li></ul></div><div class=paragraph><p>しかしながら、データをバックアップする他の手段がないのなら、 バックアップを取らないよりもフロッピーディスクを使う方がましでしょう。</p></div><div class=paragraph><p>フロッピーディスクを使用せざるを得ないときは、 品質のよいディスクを使用してください。 事務所のその辺に数年転がっていたフロッピーは使わない方が良いでしょう。 評判のよいメーカの新しいディスクを使用することが理想です。</p></div></div><div class=sect2><h3 id=floppies-creating>14.8.2. それではどうやってデータをフロッピーにバックアップするのですか?<a class=anchor href=#floppies-creating></a></h3><div class=paragraph><p>フロッピーにバックアップする最もよい方法は、 <code>-M</code> (マルチボリューム) オプション付きで <a href="https://man.freebsd.org/cgi/man.cgi?query=tar&amp;sektion=1&amp;format=html">tar(1)</a> コマンドを使用することです。これで、 複数のフロッピーにわたってバックアップすることが可能になります。</p></div><div class=paragraph><p>カレントディレクトリとサブディレクトリ内のすべてのファイルをバックアップするには、 以下のコマンドを (<code>root</code> 権限で) 使用します。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># tar Mcvf /dev/fd0 *</span></code></pre></div></div><div class=paragraph><p>1 枚目のフロッピーが一杯になると、 <a href="https://man.freebsd.org/cgi/man.cgi?query=tar&amp;sektion=1&amp;format=html">tar(1)</a> は次のボリュームを挿入するように要求します (<a href="https://man.freebsd.org/cgi/man.cgi?query=tar&amp;sektion=1&amp;format=html">tar(1)</a> はさまざまなメディアを扱えるので、 ボリュームと表示します。この文脈ではフロッピーディスクのことです)。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>Prepare volume 2 <span class=k>for</span> /dev/fd0 and hit <span class=k>return</span>:</code></pre></div></div><div class=paragraph><p>指定したファイルがすべて保存されるまで (ボリューム番号を増やしながら) これが繰り返されます。</p></div></div><div class=sect2><h3 id=floppies-compress>14.8.3. バックアップを圧縮することはできませんか?<a class=anchor href=#floppies-compress></a></h3><div class=paragraph><p>残念なことに <a href="https://man.freebsd.org/cgi/man.cgi?query=tar&amp;sektion=1&amp;format=html">tar(1)</a> はマルチボリュームアーカイブに対して、 <code>-z</code> オプションを使うことができません。 もちろん、すべてのファイルを <a href="https://man.freebsd.org/cgi/man.cgi?query=gzip&amp;sektion=1&amp;format=html">gzip(1)</a> で圧縮し、 それらを <a href="https://man.freebsd.org/cgi/man.cgi?query=tar&amp;sektion=1&amp;format=html">tar(1)</a> を用いてフロッピーに保存して、 それから再び <a href="https://man.freebsd.org/cgi/man.cgi?query=gunzip&amp;sektion=1&amp;format=html">gunzip(1)</a> することはできます。</p></div></div><div class=sect2><h3 id=floppies-restoring>14.8.4. どのようにしてバックアップをリストアしたらいいのでしょうか?<a class=anchor href=#floppies-restoring></a></h3><div class=paragraph><p>すべてのアーカイブをリストアするには以下のようにします。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># tar Mxvf /dev/fd0</span></code></pre></div></div><div class=paragraph><p>特定のファイルだけをリストアするには 2 つの方法があります。 1 つ目は、1 枚目のフロッピーを用いて以下のようにするものです。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># tar Mxvf /dev/fd0 filename</span></code></pre></div></div><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=tar&amp;sektion=1&amp;format=html">tar(1)</a> ユーティリティは、 必要なファイルを見つけるまで次のディスクを挿入するように要求します。</p></div><div class=paragraph><p>もう 1 つは、 必要なファイルがどのフロッピーに保存されているか分かっている場合、 そのフロッピーを挿入して上記と同じコマンドを使用するだけでもよいです。 あるフロッピー上にある 1 番目のファイルが、 その前のフロッピーから続いている場合は、 そのファイルのリストアを要求していなくても <a href="https://man.freebsd.org/cgi/man.cgi?query=tar&amp;sektion=1&amp;format=html">tar(1)</a> はそれをリストアできないと警告することに注意してください!</p></div></div></div></div><div class=sect1><h2 id=backup-basics>14.9. バックアップの基本<a class=anchor href=#backup-basics></a></h2><div class=sectionbody><div class=paragraph><p>主なバックアッププログラムは <a href="https://man.freebsd.org/cgi/man.cgi?query=dump&amp;sektion=8&amp;format=html">dump(8)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=tar&amp;sektion=1&amp;format=html">tar(1)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=cpio&amp;sektion=1&amp;format=html">cpio(1)</a> の三つです。</p></div><div class=sect2><h3 id=_ダンプとリストア>14.9.1. ダンプとリストア<a class=anchor href=#_ダンプとリストア></a></h3><div class=paragraph><p>伝統的な UNIX® のバックアッププログラムは <code>dump</code> と <code>restore</code> です。 これらはファイルシステムによって作成されるファイル、リンク、 ディレクトリといった抽象の下位にある、 ディスクブロックの集合としてドライブを操作します。 <code>dump</code> はデバイス上のファイルシステム全体をバックアップします。 ファイルシステムの一部分だけ、 または二つ以上のファイルシステムにわたるディレクトリツリーをバックアップすることはできません。 <code>dump</code> はファイルおよびディレクトリをテープに書き込まずに、 ファイルおよびディレクトリを含んだ raw データブロックを書き込みます。</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>ルートディレクトリで <code>dump</code> を使った場合、 <span class=filename>/home</span>, <span class=filename>/usr</span> など、他の多くのディレクトリはバックアップされません。 これらのディレクトリは通常、 他のファイルシステムへのマウントポイントであったり、 シンボリックリンクとなっているためです。</p></div></td></tr></tbody></table></div><div class=paragraph><p><code>dump</code> には AT&amp;T UNIX のバージョン 6 (およそ 1975 年) の初期から残っている癖があります。 デフォルトのパラメタは、現在利用可能な高密度メディア (最大 62,182 ftpi) ではなく、9 トラックテープ (6250 bpi) に最適な値となっています。 現在のテープドライブの容量を利用するために、 これらのデフォルト値をコマンドラインで上書きしなければなりません。</p></div><div class=paragraph><p><code>rdump</code> と <code>rrestore</code> を用いて他のコンピュータに接続されているテープドライブにネットワーク経由でデータをバックアップすることも可能です。 どちらのプログラムもリモートのテープドライブにアクセスするために <code>rcmd</code> および <code>ruserok</code> に依存しています。 したがって、バックアップを実行するユーザがリモートコンピュータの <span class=filename>.rhosts</span> ファイルに書かれていなければなりません。 <code>rdump</code> および <code>rrestore</code> の引数はリモートコンピュータに適切なものを用いなければなりません。 FreeBSD コンピュータから <code>komodo</code> と呼ばれる Sun に接続されている Exabyte テープへ <code>rdump</code> するには以下のようにします。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># /sbin/rdump 0dsbfu 54000 13000 126 komodo:/dev/nsa8 /dev/da0a 2&gt;&amp;1</span></code></pre></div></div><div class=paragraph><p>注意: <span class=filename>.rhosts</span> 認証を許可することには、セキュリティに関する暗黙の仮定があります。 あなたの置かれている状況を注意深く調べてください。</p></div><div class=paragraph><p><code>ssh</code> 越しに <code>dump</code> と <code>restore</code> をより安全な形で使うこともできます。</p></div><div class=exampleblock><div class=title>例 1. ssh 越しの <code>dump</code> の利用</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># /sbin/dump -0uan -f - /usr | gzip -2 | ssh1 -c blowfish \</span>
          targetuser@targetmachine.example.com <span class=nb>dd </span><span class=nv>of</span><span class=o>=</span>/mybigfiles/dump-usr-l0.gz</code></pre></div></div></div></div><div class=paragraph><p>または、環境変数 <code>RSH</code> を設定して、 <code>dump</code> の組み込み機能を利用する。</p></div><div class=exampleblock><div class=title>例 2. <code>RSH</code> を設定した ssh 越しの <code>dump</code> を利用</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># RSH=/usr/bin/ssh /sbin/dump -0uan -f targetuser@targetmachine.example.com:/dev/sa0</span></code></pre></div></div></div></div></div><div class=sect2><h3 id=_tar>14.9.2. <code>tar</code><a class=anchor href=#_tar></a></h3><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=tar&amp;sektion=1&amp;format=html">tar(1)</a> は AT&amp;T UNIX の バージョン 6 (1975 年ごろ) にまで遡ることができます。<code>tar</code> はファイルシステムと協調して動作し、 ファイルとディレクトリをテープに書き込みます。<code>tar</code> は <a href="https://man.freebsd.org/cgi/man.cgi?query=cpio&amp;sektion=1&amp;format=html">cpio(1)</a> で使用可能なフルレンジのオプションには対応していませんが、 <code>tar</code> には <code>cpio</code> が使用するような奇妙なコマンドパイプラインは必要ありません。</p></div><div class=paragraph><p><code>tar</code> の多くの版はネットワーク経由のバックアップには対応していません。 FreeBSD が使用している GNU 版の <code>tar</code> は、 <code>rdump</code> と同じ構文でリモートデバイスに対応しています。 <code>komodo</code> と呼ばれる Sun に接続された Exabyte テープドライブに対して <code>tar</code> を実行するには以下のようにします。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># /usr/bin/tar cf komodo:/dev/nsa8 . 2&gt;&amp;1</span></code></pre></div></div><div class=paragraph><p>リモートデバイスに対応していない版に対しては、パイプラインと <code>rsh</code> を使用してリモートテープドライブにデータを送ることができます。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># tar cf - . | rsh hostname dd of=tape-device obs=20b</span></code></pre></div></div><div class=paragraph><p>ネットワークを越えたバックアップのセキュリティを懸念しているなら、 <code>rsh</code> の代わりに <code>ssh</code> を使うべきです。</p></div></div><div class=sect2><h3 id=_cpio>14.9.3. <code>cpio</code><a class=anchor href=#_cpio></a></h3><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=cpio&amp;sektion=1&amp;format=html">cpio(1)</a> は本来 UNIX® ファイルを磁気メディアで交換するためのプログラムです。 <code>cpio</code> はバイトスワッピング、 多くの異なるアーカイブフォーマットの書き込みオプションがあり (それ以外にも多数のオプションがあります)、 パイプで他のプログラムにデータを渡すこともできます。 この最後にあげた特徴が、<code>cpio</code> をインストールメディアとしては優れた選択肢にしています。 <code>cpio</code> はディレクトリツリーの探索の機能はなく、ファイルリストは <span class=filename>stdin</span> からの入力でなくてはなりません。</p></div><div class=paragraph><p><code>cpio</code> はネットワーク経由のバックアップには対応していません。 以下のようにパイプラインと <code>rsh</code> を用いてリモートテープドライブにデータを送ることができます。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># for f in directory_list; do</span>
find <span class=nv>$f</span> <span class=o>&gt;&gt;</span> backup.list
<span class=k>done</span>
<span class=c># cpio -v -o --format=newc &lt; backup.list | ssh user@host &#34;cat &gt; backup_device&#34;</span></code></pre></div></div><div class=paragraph><p><em>directory_list</em> はバックアップしたいディレクトリのリストで、 <em>user</em>@<em>host</em> はバックアップを実行したいユーザとホスト名の組であり、 <em>backup_device</em> はバックアップを書き込みたいデバイスです (たとえば <span class=filename>/dev/nsa0</span>)。</p></div></div><div class=sect2><h3 id=_pax>14.9.4. <code>pax</code><a class=anchor href=#_pax></a></h3><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=pax&amp;sektion=1&amp;format=html">pax(1)</a> は <code>tar</code> と <code>cpio</code> に対する IEEE/POSIX® の回答です。長年の間、さまざまな版の <code>tar</code> と <code>cpio</code> は互いにわずかに非互換になってきていました。 それらをしらみ潰しに標準化する代わりに、POSIX® は新しいアーカイブユーティリティを作りました。 <code>pax</code> は、いくつもの <code>cpio</code> や <code>tar</code> のフォーマットの読み書きに対応しようと試みているほか、 専用に新しいフォーマットを開発しました。 コマンド群は <code>tar</code> よりも <code>cpio</code> の方にいくぶん似ています。</p></div></div><div class=sect2><h3 id=backups-programs-amanda>14.9.5. Amanda<a class=anchor href=#backups-programs-amanda></a></h3><div class=paragraph><p>Amanda (Advanced Maryland Network Disk Archiver) は単一のプログラムではなく、 クライアント/サーバ型のバックアップシステムです。 Amanda サーバは、 Amanda クライアントを有する ネットワークに接続されたコンピュータからデータを受け取り、 備え付けられたテープドライブにバックアップします。 いくつもの大容量ディスクを備えたサイトでの共通の問題は、 データディレクトリをテープにバックアップするのに時間がかかりすぎることです。 Amanda はこの問題を解決します。 Amanda は "ホールディングディスク" を使用して、 同時に複数のファイルシステムのバックアップを行うことができます。 Amanda の設定ファイルにかかれたすべてのファイルシステムのフルバックアップを特定の間隔でとるために "アーカイブセット" と呼ばれるテープグループを作成します。 "アーカイブセット" には 夜間に作成されるすべてのファイルシステムの増分 (または差分) のバックアップも含まれます。 障害が起きたファイルシステムのリストアには、 最も新しいフルバックアップと増分のバックアップが必要です。</p></div><div class=paragraph><p>設定ファイルでは、バックアップの制御と Amanda によるネットワークトラフィック量を設定します。 Amanda は上記のバックアッププログラムのいずれかを使ってデータをテープに書き込みます。 Amanda は port または package として利用可能です。デフォルトではインストールされていません。</p></div></div><div class=sect2><h3 id=_何もしない>14.9.6. 何もしない<a class=anchor href=#_何もしない></a></h3><div class=paragraph><p>"何もしない" というのはコンピュータのプログラムではありませんが、 バックアップの戦略として最も広く採用されています。 これには初期投資が必要ありません。 従わなければならないバックアップスケジュールもありません。 ただ何もしないだけです。データに何か起きたら苦笑いして耐えてください!</p></div><div class=paragraph><p>あなたにとって時間やデータの価値が少ないか、 あるいはまったくないのであれば "何もしない" のはあなたのコンピュータに最も適したバックアッププログラムでしょう。 しかし注意してください。UNIX® は便利なツールです。 6 ヶ月も使用していれば、 あなたにとって価値のあるファイルの山が出来上がっているでしょう。</p></div><div class=paragraph><p>"何もしない" ことはコンピュータが同じものをもう一度作り直すことのできる <span class=filename>/usr/obj</span> やその他のディレクトリツリーについては適切なバックアップ方法です。 一例として、このハンドブックの HTML 版 または PostScript® 版を構成するファイルがあります。 これらの文書形式は SGML ファイルから作成されたものです。 HTML または PostScript® ファイルのバックアップは必要ありません。 SGML ファイルは定期的にバックアップされています。</p></div></div><div class=sect2><h3 id=_どのバックアッププログラムが最適ですか>14.9.7. どのバックアッププログラムが最適ですか?<a class=anchor href=#_どのバックアッププログラムが最適ですか></a></h3><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=dump&amp;sektion=8&amp;format=html">dump(8)</a> です。<em>以上。</em> Elizabeth D. Zwicky はここで検討したプログラムすべてについて拷問的なテストを行いました。 すべてのデータと UNIX® ファイルシステムの状態すべてを保存するのに最適なのは、明らかに <code>dump</code> です。 Elizabeth は多種多様の特異な状態 (いくつかはあまり珍しくないものもあります) を含むファイルシステムを作成し、 それらのファイルシステムのバックアップとリストアを行って、 それぞれのプログラムのテストを行いました。特異な状態とは、 ホールがあるファイル、ホールとヌルブロックがあるファイル、 奇妙な文字をファイル名に持つファイル、読み取り不可、 書き込み不可のファイル、デバイスファイル、 バックアップ中のファイルのサイズ変更、 バックアップ中のファイルの作成および削除、などです。 彼女は 1991 年 10 月の LISA V で結果を発表しています。 <a href=http://berdmann.dyndns.org/zwicky/testdump.doc.html>torture-testing Backup and Archive Programs</a> を参照してください。</p></div></div><div class=sect2><h3 id=_緊急時のリストア手順>14.9.8. 緊急時のリストア手順<a class=anchor href=#_緊急時のリストア手順></a></h3><div class=sect3><h4 id=_惨事が起きる前に>14.9.8.1. 惨事が起きる前に<a class=anchor href=#_惨事が起きる前に></a></h4><div class=paragraph><p>発生する可能性があるどのような惨事に対しても、 備えるのに必要な手順は以下の 4 ステップだけです。</p></div><div class=paragraph><p>最初に、 各ディスクのディスクラベルとファイルシステムテーブル (<span class=filename>/etc/fstab</span>)、 ブートメッセージ全体をそれぞれ 2 枚ずつ印刷します (たとえば <code>disklabel da0 | lpr</code>)。</p></div><div class=paragraph><p>2 番目に、ブートフロッピーと fix-it フロッピー (<span class=filename>boot.flp</span> および <span class=filename>fixit.flp</span>) にそのシステムのデバイスがすべて含まれているか確認します。 最も簡単に確認する方法は、フロッピーをドライブに入れてマシンをリブートしてブートメッセージを確認することです。 あなたのシステムのデバイスのすべてが含まれ、 機能していれば 3 番目の手順に進んでください。</p></div><div class=paragraph><p>さもなければ、 そのシステムのすべてのディスクをマウントでき、 テープドライブにもアクセスできるカーネルを備えた カスタムブートフロッピーを 2 枚作成する必要があります。 これらのフロッピーディスクには <code>fdisk</code>, <code>disklabel</code>, <code>newfs</code>, <code>mount</code> と、利用するバックアッププログラムが入っていなければなりません。 これらのプログラムはスタティックリンクされていなければなりません。 <code>dump</code> を使用するのなら、このフロッピーには <code>restore</code> も含まれていなければなりません。</p></div><div class=paragraph><p>3 番目に、定期的にバックアップテープを作成します。 最後のバックアップの後で行われた変更は、回復できずに失われます。 バックアップテープにライトプロテクトを施してください。</p></div><div class=paragraph><p>4 番目に、フロッピーディスク (<span class=filename>boot.flp</span> と <span class=filename>fixit.flp</span>、 か、第 2 段階で作成した 2 枚のカスタムブートフロッピーディスクのどちらか) およびバックアップテープのテストをします。 手順のメモを作りましょう。 このメモはブートフロッピー、印刷した紙、 バックアップテープと一緒に保存しておきます。 リストアを行うときには、 このメモがバックアップテープを壊すのを防ぐくらい取り乱しているかもしれません (どのように? <code>tar xvf /dev/sa0</code> の代わりに、うっかり <code>tar cvf /dev/sa0</code> と入力してバックアップテープを上書きしてしまうかもしれません)。</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=title>訳注</div><div class=paragraph><p>上書きはライトプロテクトをしておけば防げますが、 何らかの原因でプロテクトがはずれているかもしれません。 ちなみに訳者の経験から言えば、 上のようなミスタイプは結構起きます。</p></div></td></tr></tbody></table></div><div class=paragraph><p>安全性を増すために、毎回、 ブートフロッピーを作成し、 2 巻のバックアップテープを取ります。 一方を離れた場所に保管します。 離れた場所は同じ事務所の建物の地下室ではいけません。 世界貿易センタービルにあった数多くの会社は、 苦い経験によりこの教訓を得ました。離れた場所とは、 コンピュータやディスクドライブから十分な距離を取って 物理的に分離されていなければなりません。</p></div><div class=exampleblock><div class=title>例 3. ブートフロッピーを作成するスクリプト</div><div class=content><div class="literalblock programlisting"><div class=content><pre>#!/bin/sh
#
# create a restore floppy
#
# format the floppy
#
PATH=/bin:/sbin:/usr/sbin:/usr/bin

fdformat -q fd0
if [ $? -ne 0 ]
then
	 echo &#34;Bad floppy, please use a new one&#34;
	 exit 1
fi

# place boot blocks on the floppy
#
disklabel -w -B /dev/fd0c fd1440

#
# newfs the one and only partition
#
newfs -t 2 -u 18 -l 1 -c 40 -i 5120 -m 5 -o space /dev/fd0a

#
# mount the new floppy
#
mount /dev/fd0a /mnt

#
# create required directories
#
mkdir /mnt/dev
mkdir /mnt/bin
mkdir /mnt/sbin
mkdir /mnt/etc
mkdir /mnt/root
mkdir /mnt/mnt			# for the root partition
mkdir /mnt/tmp
mkdir /mnt/var

#
# populate the directories
#
if [ ! -x /sys/compile/MINI/kernel ]
then
	 cat &lt;&lt; EOM
The MINI kernel does not exist, please create one.
Here is an example config file:
#
# MINI - A kernel to get FreeBSD onto a disk.
#
machine         &#34;i386&#34;
cpu             &#34;I486_CPU&#34;
ident           MINI
maxusers        5

options         INET                    # needed for _tcp _icmpstat _ipstat
                                        #            _udpstat _tcpstat _udb
options         FFS                     #Berkeley Fast File System
options         FAT_CURSOR              #block cursor in syscons or pccons
options         SCSI_DELAY=15           #Be pessimistic about Joe SCSI device
options         NCONS=2                 #1 virtual consoles
options         USERCONFIG              #Allow user configuration with -c XXX

config          kernel	root on da0 swap on da0 and da1 dumps on da0

device          isa0
device          pci0

device          fdc0	at isa? port &#34;IO_FD1&#34; bio irq 6 drq 2 vector fdintr
device          fd0	at fdc0 drive 0

device          ncr0

device          scbus0

device          sc0	at isa? port &#34;IO_KBD&#34; tty irq 1 vector scintr
device          npx0	at isa? port &#34;IO_NPX&#34; irq 13 vector npxintr

device          da0
device          da1
device          da2

device          sa0

pseudo-device   loop            # required by INET
pseudo-device   gzip            # Exec gzipped a.out&#39;s
EOM
	 exit 1
fi

cp -f /sys/compile/MINI/kernel /mnt

gzip -c -best /sbin/init &gt; /mnt/sbin/init
gzip -c -best /sbin/fsck &gt; /mnt/sbin/fsck
gzip -c -best /sbin/mount &gt; /mnt/sbin/mount
gzip -c -best /sbin/halt &gt; /mnt/sbin/halt
gzip -c -best /sbin/restore &gt; /mnt/sbin/restore

gzip -c -best /bin/sh &gt; /mnt/bin/sh
gzip -c -best /bin/sync &gt; /mnt/bin/sync

cp /root/.profile /mnt/root

cp -f /dev/MAKEDEV /mnt/dev
chmod 755 /mnt/dev/MAKEDEV

chmod 500 /mnt/sbin/init
chmod 555 /mnt/sbin/fsck /mnt/sbin/mount /mnt/sbin/halt
chmod 555 /mnt/bin/sh /mnt/bin/sync
chmod 6555 /mnt/sbin/restore

#
# create the devices nodes
#
cd /mnt/dev
./MAKEDEV std
./MAKEDEV da0
./MAKEDEV da1
./MAKEDEV da2
./MAKEDEV sa0
./MAKEDEV pty0
cd /

#
# create minimum file system table
#
cat &amp;gt; /mnt/etc/fstab &amp;lt;&amp;lt;EOM
/dev/fd0a    /    ufs    rw  1  1
EOM

#
# create minimum passwd file
#
cat &gt; /mnt/etc/passwd &lt;&lt;EOM
root:*:0:0:Charlie &amp;:/root:/bin/sh
EOM

cat &gt; /mnt/etc/master.passwd &lt;&lt;EOM
root::0:0::0:0:Charlie &amp;:/root:/bin/sh
EOM

chmod 600 /mnt/etc/master.passwd
chmod 644 /mnt/etc/passwd
/usr/sbin/pwd_mkdb -d/mnt/etc /mnt/etc/master.passwd

#
# umount the floppy and inform the user
#
/sbin/umount /mnt
echo &#34;The floppy has been unmounted and is now ready.&#34;</pre></div></div></div></div></div><div class=sect3><h4 id=_惨事の後は>14.9.8.2. 惨事の後は<a class=anchor href=#_惨事の後は></a></h4><div class=paragraph><p>重要な問題は、ハードウェアが生き残ったかどうかです。 定期的にバックアップを取っていれば、 ソフトウェアについて心配する必要はありません。</p></div><div class=paragraph><p>ハードウェアに障害があれば、 コンピュータを使用する前にその部品を交換してください。</p></div><div class=paragraph><p>ハードウェアに問題が無ければ、フロッピーを確認してください。 カスタムブートフロッピーディスクを使用しているのであれば、 シングルユーザモードでブートして (<code>boot:</code> プロンプトで <code>-s</code> を入力します)、 次の段落は飛ばしてください。</p></div><div class=paragraph><p><span class=filename>boot.flp</span> と <span class=filename>fixit.flp</span> を使用しているのであればこのまま読み進めてください。 <span class=filename>boot.flp</span> フロッピーをフロッピードライブに入れて、 コンピュータを起動してください。 本来のインストールメニューが画面に表示されます。 <code>Fixit—​Repair mode with CDROM or floppy.</code> オプションを選択します。指示された通り <span class=filename>fixit.flp</span> をいれてください。 <code>restore</code> とその他必要となるプログラムは <span class=filename>/mnt2/stand</span> にあります。</p></div><div class=paragraph><p>そして、ファイルシステムを一つずつ回復します。</p></div><div class=paragraph><p>最初のディスクのルートパーティションを <code>mount</code> してみてください (たとえば <code>mount /dev/da0a /mnt</code>)。 ディスクラベルが破壊されている場合は、<code>disklabel</code> を用いてあらかじめ印刷して保存しておいた通りにパーティションを作り直し、ディスクラベルを作成してください。 <code>newfs</code> を使用してファイルシステムを作り直します。 ルートパーティションを読み書き可能にマウントし直します (<code>mount -u -o rw /mnt</code>)。 バックアッププログラムとバックアップテープを使用して、 このファイルシステムのデータを回復します (たとえば <code>restore vrf /dev/sa0</code>)。 ファイルシステムをアンマウントします (たとえば <code>umount /mnt</code>)。 障害を受けたファイルシステムそれぞれについて繰り返してください。</p></div><div class=paragraph><p>システムが動き出したら、 新しいテープにデータをバックアップしてください。 どのような理由で再び事故が起きたり、データが失われるかわかりません。 これに数時間を費すことで、後々の災難から救われます。</p></div></div></div></div></div><div class=sect1><h2 id=disks-virtual>14.10. ネットワーク、メモリ、そしてファイルベースのファイルシステム<a class=anchor href=#disks-virtual></a></h2><div class=sectionbody><div class=paragraph><p>FreeBSD にはフロッピーや CD, ハードディスクなどの手元の計算機に取り付けたディスクの他に、 別の形態のディスク、<em>仮想ディスク</em>、もあります。</p></div><div class=paragraph><p>これには、<a href=../advanced-networking/#network-nfs>Network File System</a> のようなネットワークファイルシステムや Coda, メモリベースのファイルシステムおよびファイルベースのファイルシステムがあります。</p></div><div class=paragraph><p>稼働させている FreeBSD のバージョンによって、 ファイルベースおよびメモリベースのファイルシステムを作成したり操作するために、異なるツールを使用しなければならないでしょう。</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>FreeBSD 4.X の使用者は必要なデバイスを作成するために <a href="https://man.freebsd.org/cgi/man.cgi?query=MAKEDEV&amp;sektion=8&amp;format=html">MAKEDEV(8)</a> を使用しなければならないでしょう。FreeBSD 5.0 以降では、<a href="https://man.freebsd.org/cgi/man.cgi?query=devfs&amp;sektion=5&amp;format=html">devfs(5)</a> がデバイスノードを自動的に割り当ててくれるので、 使用者が意識する必要はありません。</p></div></td></tr></tbody></table></div><div class=sect2><h3 id=disks-vnconfig>14.10.1. FreeBSD 4.X でファイル中に構築されるファイルシステム<a class=anchor href=#disks-vnconfig></a></h3><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=vnconfig&amp;sektion=8&amp;format=html">vnconfig(8)</a> ユーティリティを使えば擬似ディスクデバイスを設定し、 有効にすることができます。 <em>vnode</em> とはファイルの内部的な表現方法であり、 ファイルに関する操作の中心となるものです。つまり、<a href="https://man.freebsd.org/cgi/man.cgi?query=vnconfig&amp;sektion=8&amp;format=html">vnconfig(8)</a> はファイルシステムを生成したり操作したりするためにファイルを用いるのです。 一つ例を挙げると、 ファイルに収められたフロッピーや CD-ROM のイメージをマウントするために用いることができます。</p></div><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=vnconfig&amp;sektion=8&amp;format=html">vnconfig(8)</a> を使用するためには、 カーネルが <a href="https://man.freebsd.org/cgi/man.cgi?query=vn&amp;sektion=4&amp;format=html">vn(4)</a> デバイスに対応している必要があります。 そうでなければ、カーネルコンフィギュレーションファイルに 次の行を追加してカーネルを再構築し、システムを再起動してください。</p></div><div class="literalblock programlisting"><div class=content><pre>pseudo-device vn</pre></div></div><div class=paragraph><p>既にあるファイルシステムイメージのマウント</p></div><div class=exampleblock><div class=title>例 4. FreeBSD 4.X での vnconfig を用いた既存のファイルシステムイメージのマウント</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># vnconfig vn0 diskimage</span>
<span class=c># mount /dev/vn0c /mnt</span></code></pre></div></div></div></div><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=vnconfig&amp;sektion=8&amp;format=html">vnconfig(8)</a> を用いたファイルシステムイメージの新規作成</p></div><div class=exampleblock><div class=title>例 5. <code>vnconfig</code> を用いたファイルベースディスクの新規作成</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># dd if=/dev/zero of=newimage bs=1k count=5k</span>
5120+0 records <span class=k>in
</span>5120+0 records out
<span class=c># vnconfig -s labels -c vn0 newimage</span>
<span class=c># disklabel -r -w vn0 auto</span>
<span class=c># newfs vn0c</span>
Warning: 2048 sector<span class=o>(</span>s<span class=o>)</span> <span class=k>in </span>last cylinder unallocated
/dev/vn0c:     10240 sectors <span class=k>in </span>3 cylinders of 1 tracks, 4096 sectors
        5.0MB <span class=k>in </span>1 cyl <span class=nb>groups</span> <span class=o>(</span>16 c/g, 32.00MB/g, 1280 i/g<span class=o>)</span>
super-block backups <span class=o>(</span><span class=k>for </span>fsck <span class=nt>-b</span> <span class=c>#) at:</span>
 32
<span class=c># mount /dev/vn0c /mnt</span>
<span class=c># df /mnt</span>
Filesystem  1K-blocks     Used    Avail Capacity  Mounted on
/dev/vn0c        4927        1     4532     0%    /mnt</code></pre></div></div></div></div></div><div class=sect2><h3 id=disks-mdconfig>14.10.2. FreeBSD 5.X でファイル中に構築されるファイルシステム<a class=anchor href=#disks-mdconfig></a></h3><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=mdconfig&amp;sektion=8&amp;format=html">mdconfig(8)</a> ユーティリティは FreeBSD 5.X において メモリディスク (<a href="https://man.freebsd.org/cgi/man.cgi?query=md&amp;sektion=4&amp;format=html">md(4)</a>) を設定し、有効にするために使用されます。 <a href="https://man.freebsd.org/cgi/man.cgi?query=mdconfig&amp;sektion=8&amp;format=html">mdconfig(8)</a> を使用するためには <a href="https://man.freebsd.org/cgi/man.cgi?query=md&amp;sektion=4&amp;format=html">md(4)</a> モジュールを読み込むか、 カーネルコンフィギュレーションファイルに <a href="https://man.freebsd.org/cgi/man.cgi?query=md&amp;sektion=4&amp;format=html">md(4)</a> デバイスを追加してカーネルを再構築し、システムを再起動してください。</p></div><div class="literalblock programlisting"><div class=content><pre>device md</pre></div></div><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=mdconfig&amp;sektion=8&amp;format=html">mdconfig(8)</a> コマンドは、 三つのタイプのメモリベース仮想ディスクに対応しています。 <a href="https://man.freebsd.org/cgi/man.cgi?query=malloc&amp;sektion=9&amp;format=html">malloc(9)</a> を用いて割り当てられたメモリディスク、 ファイルをベースにしたメモリディスク、 およびスワップ領域をベースにしたメモリディスクです。 想定される使用法は、ファイル内に保持されたフロッピーイメージまたは CD イメージをマウントすることです。</p></div><div class=paragraph><p>既にあるファイルシステムイメージのマウント</p></div><div class=exampleblock><div class=title>例 6. FreeBSD 5.X での <code>mdconfig</code> を用いた既存のファイルシステムイメージのマウント</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mdconfig -a -t vnode -f diskimage -u 0</span>
<span class=c># mount /dev/md0c /mnt</span></code></pre></div></div></div></div><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=mdconfig&amp;sektion=8&amp;format=html">mdconfig(8)</a> を用いたファイルシステムイメージの新規作成</p></div><div class=exampleblock><div class=title>例 7. <code>mdconfig</code> を用いたファイルシステムイメージの新規作成</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># dd if=/dev/zero of=newimage bs=1k count=5k</span>
5120+0 records <span class=k>in
</span>5120+0 records out
<span class=c># mdconfig -a -t vnode -f newimage -u 0</span>
<span class=c># disklabel -r -w md0 auto</span>
<span class=c># newfs md0c</span>
/dev/md0c: 5.0MB <span class=o>(</span>10240 sectors<span class=o>)</span> block size 16384, fragment size 2048
	using 4 cylinder <span class=nb>groups </span>of 1.27MB, 81 blks, 256 inodes.
super-block backups <span class=o>(</span><span class=k>for </span>fsck <span class=nt>-b</span> <span class=c>#) at:</span>
 32, 2624, 5216, 7808
<span class=c># mount /dev/md0c /mnt</span>
<span class=c># df /mnt</span>
Filesystem  1K-blocks     Used    Avail Capacity  Mounted on
/dev/md0c        4846        2     4458     0%    /mnt</code></pre></div></div></div></div><div class=paragraph><p><code>-u</code> オプションを用いて ユニット番号を指定しない場合、<a href="https://man.freebsd.org/cgi/man.cgi?query=mdconfig&amp;sektion=8&amp;format=html">mdconfig(8)</a> は未使用のデバイスを自動的に選択するために <a href="https://man.freebsd.org/cgi/man.cgi?query=md&amp;sektion=4&amp;format=html">md(4)</a> デバイスの auto-unit 機能を使用します。 割り当てられたユニットの名前は <span class=filename>md4</span> のように標準出力に出力されます。<a href="https://man.freebsd.org/cgi/man.cgi?query=mdconfig&amp;sektion=8&amp;format=html">mdconfig(8)</a> の詳細についてはマニュアルページを参照してください。</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>FreeBSD 5.1-RELEASE から、従来の <a href="https://man.freebsd.org/cgi/man.cgi?query=disklabel&amp;sektion=8&amp;format=html">disklabel(8)</a> プログラムは <a href="https://man.freebsd.org/cgi/man.cgi?query=bsdlabel&amp;sektion=8&amp;format=html">bsdlabel(8)</a> ユーティリティに置き換えられました。<a href="https://man.freebsd.org/cgi/man.cgi?query=bsdlabel&amp;sektion=8&amp;format=html">bsdlabel(8)</a> では、 使用されていないオプションおよびパラメタの数多くが削除されました。 たとえば <code>-r</code> オプションは <a href="https://man.freebsd.org/cgi/man.cgi?query=bsdlabel&amp;sektion=8&amp;format=html">bsdlabel(8)</a> では取り除かれました。詳細については <a href="https://man.freebsd.org/cgi/man.cgi?query=bsdlabel&amp;sektion=8&amp;format=html">bsdlabel(8)</a> マニュアルページを参照してください。</p></div></td></tr></tbody></table></div><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=mdconfig&amp;sektion=8&amp;format=html">mdconfig(8)</a> ユーティリティは大変役に立ちますが、 ファイルベースのファイルシステムを作成するために、 多くのコマンドの入力が必要となります。FreeBSD 5.0 では <a href="https://man.freebsd.org/cgi/man.cgi?query=mdmfs&amp;sektion=8&amp;format=html">mdmfs(8)</a> と呼ばれるツールも用意されています。このプログラムは <a href="https://man.freebsd.org/cgi/man.cgi?query=mdconfig&amp;sektion=8&amp;format=html">mdconfig(8)</a> を用いて <a href="https://man.freebsd.org/cgi/man.cgi?query=md&amp;sektion=4&amp;format=html">md(4)</a> ディスクを設定し、<a href="https://man.freebsd.org/cgi/man.cgi?query=newfs&amp;sektion=8&amp;format=html">newfs(8)</a> を用いて UFS ファイルシステムを作成し、<a href="https://man.freebsd.org/cgi/man.cgi?query=mount&amp;sektion=8&amp;format=html">mount(8)</a> を用いてマウントします。たとえば、上記と同じファイルシステムを作成し、 マウントしたい場合は、下記のように入力するだけです。</p></div><div class=exampleblock><div class=title>例 8. <code>mdmfs</code> を用いたファイルベースディスクの設定とマウント</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># dd if=/dev/zero of=newimage bs=1k count=5k</span>
5120+0 records <span class=k>in
</span>5120+0 records out
<span class=c># mdmfs -F newimage -s 5m md0 /mnt</span>
<span class=c># df /mnt</span>
Filesystem 1K-blocks Used Avail Capacity  Mounted on
/dev/md0        4846    2  4458     0%    /mnt</code></pre></div></div></div></div><div class=paragraph><p>ユニット番号を指定せずに <code>md</code> オプションを使用した場合、<a href="https://man.freebsd.org/cgi/man.cgi?query=mdmfs&amp;sektion=8&amp;format=html">mdmfs(8)</a> は未使用のデバイスを自動的に選択するために <a href="https://man.freebsd.org/cgi/man.cgi?query=md&amp;sektion=4&amp;format=html">md(4)</a> デバイスの auto-unit 機能を使用します。<a href="https://man.freebsd.org/cgi/man.cgi?query=mdmfs&amp;sektion=8&amp;format=html">mdmfs(8)</a> についての詳細はマニュアルページを参照してください。</p></div></div><div class=sect2><h3 id=disks-md-freebsd4>14.10.3. FreeBSD 4.X でのメモリベースのファイルシステム<a class=anchor href=#disks-md-freebsd4></a></h3><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=md&amp;sektion=4&amp;format=html">md(4)</a> ドライバは FreeBSD 4.X においてメモリファイルシステムを作成するために単純で効果的な手段です。 メモリを割り当てるために <a href="https://man.freebsd.org/cgi/man.cgi?query=malloc&amp;sektion=9&amp;format=html">malloc(9)</a> 関数が使用されます。</p></div><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=vnconfig&amp;sektion=8&amp;format=html">vnconfig(8)</a> を用いて作成したファイルシステムを例に取ると、 以下のようにします。</p></div><div class=exampleblock><div class=title>例 9. FreeBSD 4.X での md メモリディスク</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># dd if=newimage of=/dev/md0</span>
5120+0 records <span class=k>in
</span>5120+0 records out
<span class=c># mount /dev/md0c /mnt</span>
<span class=c># df /mnt</span>
Filesystem  1K-blocks     Used    Avail Capacity  Mounted on
/dev/md0c        4927        1     4532     0%    /mnt</code></pre></div></div></div></div><div class=paragraph><p>詳細については <a href="https://man.freebsd.org/cgi/man.cgi?query=md&amp;sektion=4&amp;format=html">md(4)</a> マニュアルページを参照してください。</p></div></div><div class=sect2><h3 id=disks-md-freebsd5>14.10.4. FreeBSD 5.X でのメモリベースのファイルシステム<a class=anchor href=#disks-md-freebsd5></a></h3><div class=paragraph><p>メモリベースおよびファイルベースのファイルシステムに対しても 同じツール (<a href="https://man.freebsd.org/cgi/man.cgi?query=mdconfig&amp;sektion=8&amp;format=html">mdconfig(8)</a> または <a href="https://man.freebsd.org/cgi/man.cgi?query=mdmfs&amp;sektion=8&amp;format=html">mdmfs(8)</a>) を使用できます。 メモリベースのファイルシステムに対する記憶領域は <a href="https://man.freebsd.org/cgi/man.cgi?query=malloc&amp;sektion=9&amp;format=html">malloc(9)</a> 関数を用いて割り当てられます。</p></div><div class=exampleblock><div class=title>例 10. <code>mdconfig</code> を用いたメモリベースディスクの新規作成</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mdconfig -a -t malloc -s 5m -u 1</span>
<span class=c># newfs -U md1</span>
/dev/md1: 5.0MB <span class=o>(</span>10240 sectors<span class=o>)</span> block size 16384, fragment size 2048
	using 4 cylinder <span class=nb>groups </span>of 1.27MB, 81 blks, 256 inodes.
	with soft updates
super-block backups <span class=o>(</span><span class=k>for </span>fsck <span class=nt>-b</span> <span class=c>#) at:</span>
 32, 2624, 5216, 7808
<span class=c># mount /dev/md1 /mnt</span>
<span class=c># df /mnt</span>
Filesystem 1K-blocks Used Avail Capacity  Mounted on
/dev/md1        4846    2  4458     0%    /mnt</code></pre></div></div></div></div><div class=exampleblock><div class=title>例 11. <code>mdmfs</code> を用いたメモリベースディスクの新規作成</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mdmfs -M -s 5m md2 /mnt</span>
<span class=c># df /mnt</span>
Filesystem 1K-blocks Used Avail Capacity  Mounted on
/dev/md2        4846    2  4458     0%    /mnt</code></pre></div></div></div></div><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=mdconfig&amp;sektion=8&amp;format=html">mdconfig(8)</a> のコマンドラインの <code>malloc</code> を <code>swap</code> に置き換えることで、<a href="https://man.freebsd.org/cgi/man.cgi?query=malloc&amp;sektion=9&amp;format=html">malloc(9)</a> 関数によるファイルシステムを使用する代わりに スワップ領域を使用することが可能です。デフォルトでは <a href="https://man.freebsd.org/cgi/man.cgi?query=mdmfs&amp;sektion=8&amp;format=html">mdmfs(8)</a> ユーティリティはスワップベースのディスクを作成します (<code>-M</code> なし)。詳細は <a href="https://man.freebsd.org/cgi/man.cgi?query=mdconfig&amp;sektion=8&amp;format=html">mdconfig(8)</a> および <a href="https://man.freebsd.org/cgi/man.cgi?query=mdmfs&amp;sektion=8&amp;format=html">mdmfs(8)</a> マニュアルページを参照してください。</p></div></div><div class=sect2><h3 id=_システムからメモリディスクを切り離す>14.10.5. システムからメモリディスクを切り離す<a class=anchor href=#_システムからメモリディスクを切り離す></a></h3><div class=paragraph><p>メモリベースまたはファイルベースのファイルシステムが使用されていない場合、 すべてのリソースをシステムに開放するべきです。 はじめにファイルシステムをアンマウントします。 次にシステムからディスクを切り離し、リソースを開放するために <a href="https://man.freebsd.org/cgi/man.cgi?query=mdconfig&amp;sektion=8&amp;format=html">mdconfig(8)</a> を使用します。</p></div><div class=paragraph><p>たとえば <span class=filename>/dev/md4</span> によって使用されたすべてのリソースを切り離し、開放するには以下のようにします。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mdconfig -d -u 4</span></code></pre></div></div><div class=paragraph><p><code>mdconfig -l</code> コマンドを使用することによって、 設定された <a href="https://man.freebsd.org/cgi/man.cgi?query=md&amp;sektion=4&amp;format=html">md(4)</a> デバイスについての情報を表示することが可能です。</p></div><div class=paragraph><p>FreeBSD 4.X では <a href="https://man.freebsd.org/cgi/man.cgi?query=vnconfig&amp;sektion=8&amp;format=html">vnconfig(8)</a> はデバイスを切り離すのに使用されます。たとえば <span class=filename>/dev/vn4</span> によって使用されたすべてのリソースを切り離し、開放するには以下のようにします。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># vnconfig -u vn4</span></code></pre></div></div></div></div></div><div class=sect1><h2 id=snapshots>14.11. ファイルシステムのスナップショット<a class=anchor href=#snapshots></a></h2><div class=sectionbody><div class=paragraph><p>FreeBSD 5.0 は Soft Updates と協調するファイルシステムスナップショットという新しい機能を提供します。</p></div><div class=paragraph><p>スナップショットは指定したファイルシステムのイメージを作成し、 また、ファイルとして扱うことができるようになります。 スナップショットファイルはアクションが実行されるファイルシステム内で作成されなければなりません。 また、ユーザは一つのファイルシステムあたり 20 までスナップショットを作成することができます。 有効なスナップショットはスーパーブロック内に記録されるので、 リブートしてから永続的にアンマウントおよびリマウントを記録します。 スナップショットが必要無くなったときは、 標準の <a href="https://man.freebsd.org/cgi/man.cgi?query=rm&amp;sektion=1&amp;format=html">rm(1)</a> コマンドを用いて削除することができます。 スナップショットはどんな順番で削除してもよいのですが、 その他のスナップショットが開放されたブロックのうちいくらかをおそらく必要とするので、 使用されていたすべてのスペースを得られるとは限りません。</p></div><div class=paragraph><p>初めてスナップショットを作成すると、<code>root</code> でさえも書き込めないように <code>schg</code> フラグ (<a href="https://man.freebsd.org/cgi/man.cgi?query=chflags&amp;sektion=1&amp;format=html">chflags(1)</a> のマニュアルページを参照) が設定されます。 <a href="https://man.freebsd.org/cgi/man.cgi?query=unlink&amp;sektion=1&amp;format=html">unlink(1)</a> コマンドは、スナップショットに <code>schg</code> フラグが設定されていてもそれらを削除することのできる例外です。 したがって、スナップショットファイルを削除する前に、 <code>schg</code> フラグをクリアする必要はありません。</p></div><div class=paragraph><p>スナップショットは <a href="https://man.freebsd.org/cgi/man.cgi?query=mount&amp;sektion=8&amp;format=html">mount(8)</a> コマンドを用いて作成されます。 <span class=filename>/var</span> のスナップショットを <span class=filename>/var/snapshot/snap</span> に作成したいときは、 以下のコマンドを使用します。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mount -u -o snapshot /var/snapshot/snap /var</span></code></pre></div></div><div class=paragraph><p>また、スナップショットを作成するのに <a href="https://man.freebsd.org/cgi/man.cgi?query=mksnap_ffs&amp;sektion=8&amp;format=html">mksnap_ffs(8)</a> も使えます。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mksnap_ffs /var /var/snapshot/snap</span></code></pre></div></div><div class=paragraph><p>スナップショットにはいくつかの利用法があります。</p></div><div class=ulist><ul><li><p>スナップショットをバックアップ目的に使用する管理者もいます。 なぜならスナップショットは CD やテープに転送できるからです。</p></li><li><p>ファイルの完全性を検証するために、 <a href="https://man.freebsd.org/cgi/man.cgi?query=fsck&amp;sektion=8&amp;format=html">fsck(8)</a> をスナップショットに実行してもよいでしょう。 スナップショットをマウントしたときにそのファイルシステムがクリーンであったとすると、 そのスナップショットをマウントするときはいつでもクリーンな (そして変更のない) 結果を得るでしょう。 これは本質的には バックグラウンド <a href="https://man.freebsd.org/cgi/man.cgi?query=fsck&amp;sektion=8&amp;format=html">fsck(8)</a> が行うことです。</p></li><li><p>スナップショット上で <a href="https://man.freebsd.org/cgi/man.cgi?query=dump&amp;sektion=8&amp;format=html">dump(8)</a> ユーティリティを実行すると、 スナップショットのファイルシステムとタイムスタンプが一致するダンプが返されるでしょう。 <a href="https://man.freebsd.org/cgi/man.cgi?query=dump&amp;sektion=8&amp;format=html">dump(8)</a> は <code>-L</code> オプションを使用することで、 一つのコマンドでスナップショットをとり、ダンプイメージを作成して、スナップショットを削除することが可能です。</p></li><li><p>ファイルシステムの "凍結された" イメージとしてスナップショットを <a href="https://man.freebsd.org/cgi/man.cgi?query=mount&amp;sektion=8&amp;format=html">mount(8)</a> します。 <span class=filename>/var/snapshot/snap</span> のスナップショットを <a href="https://man.freebsd.org/cgi/man.cgi?query=mount&amp;sektion=8&amp;format=html">mount(8)</a> するには以下のようにします。</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mdconfig -a -t vnode -f /var/snapshot/snap -u 4</span>
<span class=c># mount -r /dev/md4 /mnt</span></code></pre></div></div></li></ul></div><div class=paragraph><p>これで <span class=filename>/mnt</span> にマウントした 凍結状態の <span class=filename>/var</span> ファイルシステム構造を探索できます。 すべてがスナップショットが作成された時と同じ状態になるはずです。ただし、 以前に作成されたスナップショットがサイズ 0 のファイルとして現れることが唯一の例外です。 スナップショットの使用を終えた場合、以下のようにアンマウントできます。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># umount /mnt</span>
<span class=c># mdconfig -d -u 4</span></code></pre></div></div><div class=paragraph><p><code>softupdates</code> およびファイルシステムスナップショットに関する詳細については、 <a href=http://www.mckusick.com/>http://www.mckusick.com/</a> にある Marshall Kirk McKusick のウェブサイトを参照してください。 ここには技術的な論文もあります。</p></div></div></div><div class=sect1><h2 id=quotas>14.12. ファイルシステムクォータ<a class=anchor href=#quotas></a></h2><div class=sectionbody><div class=paragraph><p>クォータは OS の持っているオプショナルな機能であり、 ファイルシステム毎にユーザやグループのメンバが使用するディスク容量やファイルの数を制限することができます。 この機能は、あるユーザやグループに割り当てられるリソースの量を制限することが望ましいようなタイムシェアリングシステムにおいてよく用いられます。 この機能を用いることによって使用可能なディスク容量の全てを一人のユーザやユーザのグループが使ってしまうことを防ぐことができます。</p></div><div class=sect2><h3 id=_ディスククォータを使うためのシステム設定>14.12.1. ディスククォータを使うためのシステム設定<a class=anchor href=#_ディスククォータを使うためのシステム設定></a></h3><div class=paragraph><p>ディスククォータの設定を始める前に、 まずはカーネルにクォータが組み込まれていることを確認しましょう。 カーネルのコンフィグレーションファイルに次の行を入れます。</p></div><div class="literalblock programlisting"><div class=content><pre>options QUOTA</pre></div></div><div class=paragraph><p>標準の <span class=filename>GENERIC</span> カーネルでは、 この機能は有効になっていませんので、 ディスククォータを利用するためには上記を設定後カーネルを構築しなおし、 作成されたカスタムカーネルをインストールしなければいけません。 カーネルのコンフィグレーションに関しては <a href=../kernelconfig/#kernelconfig>FreeBSD カーネルのコンフィグレーション</a> をご覧ください。</p></div><div class=paragraph><p>次に <span class=filename>/etc/rc.conf</span> でディスククォータを有効にする必要があります。 次の行を加えましょう。</p></div><div class="literalblock programlisting"><div class=content><pre>enable_quotas=&#34;YES&#34;</pre></div></div><div class=paragraph><p>起動時の動作をさらに細かくコントロールするためにもう一つ設定用の変数があります。 通常、起動時には <a href="https://man.freebsd.org/cgi/man.cgi?query=quotacheck&amp;sektion=8&amp;format=html">quotacheck(8)</a> によりそれぞれのファイルシステムのクォータの整合性がチェックされます。 <a href="https://man.freebsd.org/cgi/man.cgi?query=quotacheck&amp;sektion=8&amp;format=html">quotacheck(8)</a> の役割は、 クォータデータベースのデータが正しくファイルシステム上のデータを反映しているか確認することです。 これはかなり時間を食う処理であり、 起動にかかる時間に大きな影響を及ぼします。 このステップをとばしたい人のために <span class=filename>/etc/rc.conf</span> に次の変数が用意されています。</p></div><div class="literalblock programlisting"><div class=content><pre>check_quotas=&#34;NO&#34;</pre></div></div><div class=paragraph><p>もし 3.2-RELEASE よりも前の FreeBSD を使っているならば設定はもっと単純で、一つの変数のみです。 次の行を <span class=filename>/etc/rc.conf</span> で設定してください。</p></div><div class="literalblock programlisting"><div class=content><pre>check_quotas=&#34;YES&#34;</pre></div></div><div class=paragraph><p>最後に、ファイルシステム毎にディスククォータを有効にするために <span class=filename>/etc/fstab</span> を編集する必要があります。 ここでユーザもしくはグループ、 あるいはその両方にクォータを設定することができるのです。</p></div><div class=paragraph><p>あるファイルシステム上にユーザ毎のクォータを有効にする場合には、 <span class=filename>/etc/fstab</span> 中でクォータを有効にしたいファイルシステムエントリのオプション部に <code>userquota</code> を加えます。 例えば次のようになります。</p></div><div class="literalblock programlisting"><div class=content><pre>/dev/da1s2g   /home    ufs rw,userquota 1 2</pre></div></div><div class=paragraph><p>同様に、グループクォータを有効にするには <code>userquota</code> キーワードの代わりに <code>groupquota</code> を用います。 ユーザとグループの両方のクォータを有効にするには次のようにします。</p></div><div class="literalblock programlisting"><div class=content><pre>/dev/da1s2g    /home    ufs rw,userquota,groupquota 1 2</pre></div></div><div class=paragraph><p>デフォルトでは、 クォータファイルはそのファイルシステムのルートディレクトリに ユーザ用、グループ用それぞれ <span class=filename>quota.user</span>, <span class=filename>quota.group</span> という名前で置かれます。さらに詳しい情報は <a href="https://man.freebsd.org/cgi/man.cgi?query=fstab&amp;sektion=5&amp;format=html">fstab(5)</a> をご覧ください。<a href="https://man.freebsd.org/cgi/man.cgi?query=fstab&amp;sektion=5&amp;format=html">fstab(5)</a> マニュアルには別の場所を指定することができると書いてはありますが、 あまり勧められません。なぜなら、 様々なクォータ関係のユーティリティがそれにうまく対処できるようにないためです。</p></div><div class=paragraph><p>この時点で、 一度システムを再起動して新しいカーネルで立ち上げましょう。 <span class=filename>/etc/rc</span> が自動的に適当なコマンドを実行し、 <span class=filename>/etc/fstab</span> で有効にした全てのクォータ用に初期ファイルを作ってくれます。 従って、空のクォータファイルを手で作る必要は一切ありません。</p></div><div class=paragraph><p>通常の運用では <a href="https://man.freebsd.org/cgi/man.cgi?query=quotacheck&amp;sektion=8&amp;format=html">quotacheck(8)</a> や <a href="https://man.freebsd.org/cgi/man.cgi?query=quotaon&amp;sektion=8&amp;format=html">quotaon(8)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=quotaoff&amp;sektion=8&amp;format=html">quotaoff(8)</a> といったコマンドを手で動かす必要はないのですが、 慣れるためにもこれらのマニュアルは読んでおきましょう。</p></div></div><div class=sect2><h3 id=_クォータリミットの設定>14.12.2. クォータリミットの設定<a class=anchor href=#_クォータリミットの設定></a></h3><div class=paragraph><p>一旦クォータを有効にしたら本当に有効になっているのか確認しておきましょう。簡単な方法は次のコマンドを実行することです。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># quota -v</span></code></pre></div></div><div class=paragraph><p>ディスクの使用状況と、クォータが有効になっているファイルシステムのクォータリミットが一行にまとめて出力されるでしょう。</p></div><div class=paragraph><p>さあ、<a href="https://man.freebsd.org/cgi/man.cgi?query=edquota&amp;sektion=8&amp;format=html">edquota(8)</a> でクォータリミットを設定する準備ができました。</p></div><div class=paragraph><p>ユーザやグループが使用できるディスク容量や作成できるファイルの数に制限をかけるにはいくつかのオプションがあります。割り当てディスク容量を制限 (ブロッククォータ) することもファイル数を制限 (inode クォータ) することも、両者を組み合わせることもできるのです。 これらの制限はそれぞれさらに二つのカテゴリ、 ハードリミットとソフトリミット、に分けることができます。</p></div><div class=paragraph><p>ハードリミットを越えることはできません。 あるユーザが一旦ハードリミットにたっした場合、 そのファイルシステムではそれ以上の割り当ては望めません。 例えばあるファイルシステム上に 500 ブロックのハードリミットが設定されており現在 490 ブロックを使用している場合、さらに 10 ブロックしか使えないのです。 11 ブロックを使おうとすると失敗します。</p></div><div class=paragraph><p>一方、 ソフトリミットはある限られた時間内であれば越えることができます。 この時間は猶予期間として知られており、デフォルトでは 1 週間です。 あるユーザが自分のソフトリミットを猶予期間よりも長い間越えているとソフトリミットはハードリミットに変わり、それ以上使用することはできなくなります。 ユーザがソフトリミットよりも減らせば猶予期間はリセットされます。</p></div><div class=paragraph><p>以下は <a href="https://man.freebsd.org/cgi/man.cgi?query=edquota&amp;sektion=8&amp;format=html">edquota(8)</a> コマンドを実行した時に見ることになるであろう例です。 <a href="https://man.freebsd.org/cgi/man.cgi?query=edquota&amp;sektion=8&amp;format=html">edquota(8)</a> コマンドが起動されると環境変数 <code>EDITOR</code> で指定されるエディタに入ります。 <code>EDITOR</code> が設定されていない場合には vi が起動されます。 ここでクォータリミットを編集します。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># edquota -u test</span></code></pre></div></div><div class="literalblock programlisting"><div class=content><pre>Quotas for user test:
/usr: blocks in use: 65, limits (soft = 50, hard = 75)
        inodes in use: 7, limits (soft = 50, hard = 60)
/usr/var: blocks in use: 0, limits (soft = 50, hard = 75)
        inodes in use: 0, limits (soft = 50, hard = 60)</pre></div></div><div class=paragraph><p>通常、クォータが有効になっているファイルシステム毎に 2 行あります。 一つはブロックリミット用でもう一つは inode リミット用です。 クォータリミットを変更したいところを書き変えるだけでかまいません。 たとえばこのユーザのブロックリミットを、ソフトリミットは 50 から 500 へ、ハードリミットは 75 から 600 に変更する場合、</p></div><div class="literalblock programlisting"><div class=content><pre>/usr: blocks in use: 65, limits (soft = 50, hard = 75)</pre></div></div><div class=paragraph><p>から</p></div><div class="literalblock programlisting"><div class=content><pre> /usr: blocks in use: 65, limits (soft = 500, hard = 600)</pre></div></div><div class=paragraph><p>へ書き換えます。新しいクォータリミットはエディタを終了すれば設定されます。</p></div><div class=paragraph><p>ある範囲の UID に対してクォータリミットを設定したい場合がありますが、このような時には <a href="https://man.freebsd.org/cgi/man.cgi?query=edquota&amp;sektion=8&amp;format=html">edquota(8)</a> コマンドの <code>-p</code> オプションを使うといいでしょう。まず、 あるユーザに割り当てたいクォータリミットを設定し、次に <code>edquota -p protouser startuid-enduid</code> を実行するのです。例えばユーザ <code>test</code> にお望みのクォータリミットが付いているとしましょう。 次のコマンドにより 10,000 から 19,999 の間の UID に対して同じクォータリミットを付けることができるのです。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># edquota -p test 10000-19999</span></code></pre></div></div><div class=paragraph><p>さらに詳しいことは <a href="https://man.freebsd.org/cgi/man.cgi?query=edquota&amp;sektion=8&amp;format=html">edquota(8)</a> のマニュアルページをご覧ください。</p></div></div><div class=sect2><h3 id=_クォータリミットとディスク使用状況のチェック>14.12.3. クォータリミットとディスク使用状況のチェック<a class=anchor href=#_クォータリミットとディスク使用状況のチェック></a></h3><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=quota&amp;sektion=1&amp;format=html">quota(1)</a> または <a href="https://man.freebsd.org/cgi/man.cgi?query=repquota&amp;sektion=8&amp;format=html">repquota(8)</a> といったコマンドを使ってクォータリミットやディスクの利用状況を確認することができます。 <a href="https://man.freebsd.org/cgi/man.cgi?query=quota&amp;sektion=1&amp;format=html">quota(1)</a> コマンドは個々のユーザやグループのクォータやディスク利用状況を確認するのに使えます。 ユーザは自身のクォータ、そして所属するグループのグループのみ確認することができます。 スーパーユーザのみが他のユーザや所属していないグループのクォータと利用状況を見ることができます。 <a href="https://man.freebsd.org/cgi/man.cgi?query=repquota&amp;sektion=8&amp;format=html">repquota(8)</a> コマンドを使うと、クォータが有効になっているファイルシステム用の全てのクォータやディスク容量のサマリを得ることができます。</p></div><div class=paragraph><p>以下は二つのファイルシステムにクォータ制限がかけられているユーザに対する<code>quota -v</code> コマンドの出力例です。</p></div><div class="literalblock programlisting"><div class=content><pre>Disk quotas for user test (uid 1002):
     Filesystem  blocks   quota   limit   grace   files   quota   limit   grace
           /usr      65*     50      75   5days       7      50      60
       /usr/var       0      50      75               0      50      60</pre></div></div><div class=paragraph><p>上の例で、<span class=filename>/usr</span> ファイルシステム上ではこのユーザは現在 50 ブロックというソフトリミットを 15 ブロックオーバーし 5 日間の猶予期間が残っています。アスタリスク <code>*</code> はクォータリミットを越えているユーザを示していることに注意してください。</p></div><div class=paragraph><p>通常、そのユーザが全く使っていないファイルシステムは、 クォータリミットが付けられているとしても <a href="https://man.freebsd.org/cgi/man.cgi?query=quota&amp;sektion=1&amp;format=html">quota(1)</a> コマンドの出力には現われません。 <code>-v</code> オプションを用いればそのようなファイルシステム、 上の例では <span class=filename>/usr/var</span>、 を表示することができます。</p></div></div><div class=sect2><h3 id=_nfs_上の_クォータ>14.12.4. NFS 上の クォータ<a class=anchor href=#_nfs_上の_クォータ></a></h3><div class=paragraph><p>クォータは NFS サーバ上のクォータサブシステムにより実行されます。 <a href="https://man.freebsd.org/cgi/man.cgi?query=rpc.rquotad&amp;sektion=8&amp;format=html">rpc.rquotad(8)</a> デーモンにより、NFS クライアント上の <a href="https://man.freebsd.org/cgi/man.cgi?query=quota&amp;sektion=1&amp;format=html">quota(1)</a> コマンドは情報を得ることができ、クライアントマシン上のユーザが自分のクォータの統計を見ることができます。</p></div><div class=paragraph><p><span class=filename>/etc/inetd.conf</span> において以下のように <code>rpc.rquotad</code> を有効にしましょう。</p></div><div class="literalblock programlisting"><div class=content><pre>rquotad/1      dgram rpc/udp wait root /usr/libexec/rpc.rquotad rpc.rquotad</pre></div></div><div class=paragraph><p>そして以下のように <code>inetd</code> を再起動します。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># kill -HUP `cat /var/run/inetd.pid`</span></code></pre></div></div></div></div></div><div class=sect1><h2 id=disks-encrypting>14.13. ディスクパーティションの暗号化<a class=anchor href=#disks-encrypting></a></h2><div class=sectionbody><div class=paragraph><p>FreeBSD は無許可のデータアクセスに対する優れたオンライン保護機能を提供します。 ファイルのパーミッションおよび強制的アクセスコントロール (MAC: Mandatory Access Control) (Mandatory Access Control (MAC) を参照) は、コンピュータが動作中で、OS が実行中であるときに、 無許可の第三者がデータにアクセスするのを防ぐことに役立ちます。 しかしながら、攻撃者がコンピュータに物理的にアクセスし、 機密データをコピーし分析するためにコンピュータのハードドライブを別のシステムに移動させることができれば、 OS によって強化された許可属性は意味をなさなくなります。</p></div><div class=paragraph><p>攻撃者が電源の落ちたコンピュータや ハードドライブを手にいれる手段にかかわらず、 GEOM ベースのディスク暗号化 (gbde: GEOM Based Disk Encryption) は、著しい資源を持ち本気で攻撃を仕掛けるつもりでやってきた攻撃者からさえもコンピュータのファイルシステム上にあるデータを保護することができます。 個々のファイルだけを暗号化する煩わしい方法と異なり、 gbde は全ファイルシステムを透過的に暗号化します。 平文テキストは決してハードドライブのプラッタに関係しません。</p></div><div class=sect2><h3 id=_カーネルで_gbde_を有効にする>14.13.1. カーネルで gbde を有効にする<a class=anchor href=#_カーネルで_gbde_を有効にする></a></h3><div class="exampleblock procedure"><div class=content><div class="olist arabic"><ol class=arabic><li><p><code>root</code> になる</p><div class=paragraph><p>gbde の設定をするにはスーパユーザの権限が必要になります。 以下のコマンドを実行して、 <code>root</code> になってください。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% su -
Password:</code></pre></div></div></li><li><p>オペレーティングシステムのバージョンを確かめる</p><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=gbde&amp;sektion=4&amp;format=html">gbde(4)</a> が動作するには FreeBSD 5.0 以降が必要です。 以下のコマンドを実行して、 オペレーティングシステムのバージョンを確認してください。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># uname -r</span>
5.0-RELEASE</code></pre></div></div></li><li><p>カーネルコンフィギュレーションファイルに <a href="https://man.freebsd.org/cgi/man.cgi?query=gbde&amp;sektion=4&amp;format=html">gbde(4)</a> 対応を追加する</p><div class=paragraph><p>お好みのテキストエディタを使用して、 以下の行をカーネルコンフィギュレーションファイルに加えます。</p></div><div class=paragraph><p><code>options GEOM_BDE</code></p></div><div class=paragraph><p>FreeBSD カーネルを設定、再コンパイル、インストールします。 この手順は <a href=../kernelconfig/#kernelconfig>FreeBSD カーネルのコンフィグレーション</a> で説明されています。</p></div><div class=paragraph><p>新しいカーネルで再起動します。</p></div></li></ol></div></div></div></div><div class=sect2><h3 id=_暗号化されたハードドライブの準備>14.13.2. 暗号化されたハードドライブの準備<a class=anchor href=#_暗号化されたハードドライブの準備></a></h3><div class=paragraph><p>以下の例では、システムに新しいハードディスクを追加しようとしています。このシステムは単一の暗号化されたパーティションを保持することになります。 このパーティションは <span class=filename>/private</span> としてマウントされます。gbde は <span class=filename>/home</span> および <span class=filename>/var/mail</span> を暗号化するのにも使用できますが、 より複雑な指示を必要となるのでこの解説の範疇を越えています。</p></div><div class="exampleblock procedure"><div class=content><div class="olist arabic"><ol class=arabic><li><p>新しいハードドライブを追加する</p><div class=paragraph><p><a href=#disks-adding>ディスクの追加</a> で説明されている通りに新しいドライブをシステムに設置します。 この例では、新しいハードドライブは <span class=filename>/dev/ad4s1c</span> パーティションに 加えられたものとします。 <span class=filename>/dev/ad0s1*</span> デバイスは、この例のシステム上に存在する標準的な FreeBSD パーティションを表します。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ls /dev/ad*</span>
/dev/ad0        /dev/ad0s1b     /dev/ad0s1e     /dev/ad4s1
/dev/ad0s1      /dev/ad0s1c     /dev/ad0s1f     /dev/ad4s1c
/dev/ad0s1a     /dev/ad0s1d     /dev/ad4</code></pre></div></div></li><li><p>gbde ロックファイルを保持するディレクトリを作成する</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mkdir /etc/gbde</span></code></pre></div></div><div class=paragraph><p>gbde ロックファイルには、 暗号化されたパーティションにアクセスするのに必要となる情報が格納されています。 ロックファイルにアクセスしない場合、 gbde は 膨大な手動による介在なしには (ソフトウェアは対応していません)、暗号化されたパーティションに含まれるデータを解読することはできないでしょう。 それぞれの暗号化されたパーティションは別々のロックファイルを使用します。</p></div></li><li><p>gbde パーティションを初期化する</p><div class=paragraph><p>gbde パーティションは使用する前に初期化されなければなりません。 この初期化は一度だけ実行される必要があります。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># gbde init /dev/ad4s1c -i -L /etc/gbde/ad4s1c</span></code></pre></div></div><div class=paragraph><p>エディタが開くので、 テンプレートをもとにさまざまなオプションを設定してください。 UFS1 または UFS2 で使用するには、sector_size を 2048 に設定してください。</p></div><div class="literalblock programlisting"><div class=content><pre>$FreeBSD: src/sbin/gbde/template.txt,v 1.1 2002/10/20 11:16:13 phk Exp $
#
# Sector size is the smallest unit of data which can be read or written.
# Making it too small decreases performance and decreases available space.
# Making it too large may prevent filesystems from working.  512 is the
# minimum and always safe.  For UFS, use the fragment size
#
sector_size     =       2048
[...]</pre></div></div><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=gbde&amp;sektion=8&amp;format=html">gbde(8)</a> はデータを保護するのに使用するパスフレーズを二度尋ます。 パスフレーズはそれぞれ同じでなければなりません。 データを保護する gbde の能力は、 あなたが選択したパスフレーズの品質に完全に依存します。</p></div><div class=paragraph><p><code>gbde init</code> コマンドは gbde パーティションに対するロックファイルを作成します。この例では <span class=filename>/etc/gbde/ad4s1c</span> に格納されます。</p></div><div class="admonitionblock caution"><table><tbody><tr><td class=icon><i class="fa icon-caution" title=Caution></i></td><td class=content><div class=paragraph><p>gbde ロックファイルは、 すべての暗号化されたパーティションの内容とともにバックアップされなければ <em>なりません</em>。 ロックファイルだけを削除している間、 ロックファイルなしでは信念の固い攻撃者が gbde パーティションを解読することを防ぐことができない一方で、 正当な所有者は、<a href="https://man.freebsd.org/cgi/man.cgi?query=gbde&amp;sektion=8&amp;format=html">gbde(8)</a> およびこの設計者にまったく支持されない膨大な量の作業なしには、 暗号化されたパーティション上のデータにアクセスすることができないでしょう。</p></div></td></tr></tbody></table></div></li><li><p>カーネルに暗号化されたパーティションを接続する</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># gbde attach /dev/ad4s1c -l /etc/gbde/ad4s1c</span></code></pre></div></div><div class=paragraph><p>暗号化されたパーティションを初期化する際に選択したパスフレーズを入力するように求められます。 新しい暗号化デバイスは <span class=filename>/dev</span> に <span class=filename>/dev/device_name.bde</span> として現れます。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ls /dev/ad*</span>
/dev/ad0        /dev/ad0s1b     /dev/ad0s1e     /dev/ad4s1
/dev/ad0s1      /dev/ad0s1c     /dev/ad0s1f     /dev/ad4s1c
/dev/ad0s1a     /dev/ad0s1d     /dev/ad4        /dev/ad4s1c.bde</code></pre></div></div></li><li><p>暗号化デバイス上にファイルシステムを作成する</p><div class=paragraph><p>カーネルに暗号化デバイスが接続されると、 デバイス上にファイルシステムを作成できます。 暗号化デバイス上にファイルシステムを作成するには <a href="https://man.freebsd.org/cgi/man.cgi?query=newfs&amp;sektion=8&amp;format=html">newfs(8)</a> を使用します。従来の UFS1 ファイルシステムで初期化するより、 新しい UFS2 ファイルシステムで初期化した方が高速なので、 <code>-O2</code> オプションとともに <a href="https://man.freebsd.org/cgi/man.cgi?query=newfs&amp;sektion=8&amp;format=html">newfs(8)</a> を使用することが推奨されています。</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>FreeBSD 5.1-RELEASE 以降では、<code>-O2</code> オプションはデフォルトです。</p></div></td></tr></tbody></table></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># newfs -U -O2 /dev/ad4s1c.bde</span></code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=newfs&amp;sektion=8&amp;format=html">newfs(8)</a> は、デバイス名に <span class=filename>*.bde</span> 拡張子によって認識される、 接続された gbde パーティションに対して実行されなければなりません。</p></div></td></tr></tbody></table></div></li><li><p>暗号化パーティションをマウントする</p><div class=paragraph><p>暗号化ファイルシステムに対するマウントポイントを作成します。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mkdir /private</span></code></pre></div></div><div class=paragraph><p>暗号化ファイルシステムをマウントします。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mount /dev/ad4s1c.bde /private</span></code></pre></div></div></li><li><p>暗号化ファイルシステムが利用可能か確かめる</p><div class=paragraph><p>これで暗号化ファイルシステムは <a href="https://man.freebsd.org/cgi/man.cgi?query=df&amp;sektion=1&amp;format=html">df(1)</a> で見ることができ、 利用する準備ができました。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% <span class=nb>df</span> <span class=nt>-H</span>
Filesystem        Size   Used  Avail Capacity  Mounted on
/dev/ad0s1a      1037M    72M   883M     8%    /
/devfs            1.0K   1.0K     0B   100%    /dev
/dev/ad0s1f       8.1G    55K   7.5G     0%    /home
/dev/ad0s1e      1037M   1.1M   953M     0%    /tmp
/dev/ad0s1d       6.1G   1.9G   3.7G    35%    /usr
/dev/ad4s1c.bde   150G   4.1K   138G     0%    /private</code></pre></div></div></li></ol></div></div></div></div><div class=sect2><h3 id=_存在する暗号化ファイルシステムをマウントする>14.13.3. 存在する暗号化ファイルシステムをマウントする<a class=anchor href=#_存在する暗号化ファイルシステムをマウントする></a></h3><div class=paragraph><p>システムを起動する度に、すべての暗号化ファイルシステムは 使用前にカーネルに接続し、 エラーの有無をチェックし、マウントする必要があります。 必要なコマンドは <code>root</code> ユーザとして実行されなければなりません。</p></div><div class="exampleblock procedure"><div class=content><div class="olist arabic"><ol class=arabic><li><p>カーネルに gbde パーティションを接続する</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># gbde attach /dev/ad4s1c -l /etc/gbde/ad4s1c</span></code></pre></div></div><div class=paragraph><p>パーティションの暗号化を初期化する際に選択したパスフレーズを入力するように求められるでしょう。</p></div></li><li><p>ファイルシステムのエラーをチェックする</p><div class=paragraph><p>暗号化ファイルシステムを自動的にマウントするために <span class=filename>/etc/fstab</span> に設定を掲載することはまだできないため、 マウントする前に <a href="https://man.freebsd.org/cgi/man.cgi?query=fsck&amp;sektion=8&amp;format=html">fsck(8)</a> を実行して、 ファイルシステムのエラーをチェックしなければなりません。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># fsck -p -t ffs /dev/ad4s1c.bde</span></code></pre></div></div></li><li><p>暗号化ファイルをマウントする</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mount /dev/ad4s1c.bde /private</span></code></pre></div></div><div class=paragraph><p>これで暗号化ファイルシステムが利用できるようになりました。</p></div></li></ol></div></div></div><div class=sect3><h4 id=_暗号化パーティションを自動的にマウントする>14.13.3.1. 暗号化パーティションを自動的にマウントする<a class=anchor href=#_暗号化パーティションを自動的にマウントする></a></h4><div class=paragraph><p>スクリプトを作成して、暗号化パーティションを自動的に接続、 チェック、マウントすることは可能です。しかしながら、 安全上の理由によりスクリプトに <a href="https://man.freebsd.org/cgi/man.cgi?query=gbde&amp;sektion=8&amp;format=html">gbde(8)</a> パスワードを含めるべきではありません。その代わりに、コンソールまたは <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;format=html">ssh(1)</a> による接続からパスワードを入力するようなスクリプトが手動で実行されることが推奨されます。</p></div></div></div><div class=sect2><h3 id=_gbde_が採用した暗号の保護>14.13.4. gbde が採用した暗号の保護<a class=anchor href=#_gbde_が採用した暗号の保護></a></h3><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=gbde&amp;sektion=8&amp;format=html">gbde(8)</a> は 128bit AES の CBC モードを使用してセクタペイロードを暗号化します。 ディスク上のそれぞれのセクタは異なる AES 鍵で暗号化されます。 セクタ鍵がユーザが入力したパスフレーズからどのように導き出されるかを含め、 gbde の暗号手法の設計についての詳細は、 <a href="https://man.freebsd.org/cgi/man.cgi?query=gbde&amp;sektion=4&amp;format=html">gbde(4)</a> を参照してください。</p></div></div><div class=sect2><h3 id=_互換性に関する問題>14.13.5. 互換性に関する問題<a class=anchor href=#_互換性に関する問題></a></h3><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=sysinstall&amp;sektion=8&amp;format=html">sysinstall(8)</a> は gbde 暗号化デバイスと互換性がありません。 <a href="https://man.freebsd.org/cgi/man.cgi?query=sysinstall&amp;sektion=8&amp;format=html">sysinstall(8)</a> を実行する前に <span class=filename>*.bde</span> デバイスはすべてカーネルから切断されなければなりません。 そうしないと、<a href="https://man.freebsd.org/cgi/man.cgi?query=sysinstall&amp;sektion=8&amp;format=html">sysinstall(8)</a> が初めにデバイスを走査する際にクラッシュしてしまうでしょう。 暗号化デバイスを切断するには、以下のコマンドを使用します。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># gbde detach /dev/ad4s1c</span></code></pre></div></div></div></div></div></div><hr><div class=last-modified><p><strong>最終更新日</strong>: 2024年5月4日 by <a href="https://cgit.freebsd.org/doc/commit/?id=db637df82a" target=_blank>Danilo G. Baio</a></p></div><div class=buttons><div class=prev><i class="fa fa-angle-left" aria-hidden=true title=Prev></i><div class=container><a href=http://172.16.201.134:1313/ja/books/handbook/security class=direction>Prev</a></div></div><div class=home><i class="fa fa-home" aria-hidden=true title=Home></i><div class=container><a href=../ class=direction>Home</a></div></div><div class=next><div class=container><a href=http://172.16.201.134:1313/ja/books/handbook/l10n class=direction>Next</a></div><i class="fa fa-angle-right" aria-hidden=true title=Next></i></div></div><label class="hidden book-menu-overlay" for=menu-control></label></div><aside class=toc><div class=toc-content><h3>目次</h3><nav id=TableOfContents><ul><li><a href=#disks-synopsis>14.1. この章では</a></li><li><a href=#disk-naming>14.2. デバイス名</a></li><li><a href=#disks-adding>14.3. ディスクの追加</a></li><li><a href=#raid>14.4. RAID</a></li><li><a href=#creating-cds>14.5. 光メディア (CD & DVD) の作成と使用</a></li><li><a href=#floppies>14.6. フロッピーディスクの作成と使用</a></li><li><a href=#backups-tapebackups>14.7. データテープの作成と使用</a></li><li><a href=#backups-floppybackups>14.8. フロッピーディスクへのバックアップ</a></li><li><a href=#backup-basics>14.9. バックアップの基本</a></li><li><a href=#disks-virtual>14.10. ネットワーク、メモリ、そしてファイルベースのファイルシステム</a></li><li><a href=#snapshots>14.11. ファイルシステムのスナップショット</a></li><li><a href=#quotas>14.12. ファイルシステムクォータ</a></li><li><a href=#disks-encrypting>14.13. ディスクパーティションの暗号化</a></li></ul></nav><hr><div class=resources><h3>リソース</h3><ul class=contents><li><i class="fa fa-file-pdf-o" aria-hidden=true title="PDF 版のダウンロード"></i><a href=https://download.freebsd.org/doc/ja/books/handbook/handbook_ja.pdf>PDF 版のダウンロード</a></li><li><i class="fa fa-pencil-square-o" aria-hidden=true title="Edit this page"></i><a href=https://github.com/freebsd/freebsd-doc/blob/main/documentation/content/ja/_index target=_blank>Edit this page</a></li></ul></div></div></aside><a class=to-top href=#top><i class="fa fa-arrow-circle-up" aria-hidden=true></i></a></main><footer><div class=footer-container><section class=logo-column><img src=http://172.16.201.134:1313/images/FreeBSD-colors.svg width=160 height=50 alt="FreeBSD logo"><div class=options-container><div class=language-container><a id=languages href=http://172.16.201.134:1313/ja/languages><img src=http://172.16.201.134:1313/images/language.png class=language-image alt="Choose language">
<span>日本語</span></a></div><div class=theme-container><select id=theme-chooser><option value=theme-system>System</option><option value=theme-light>Light</option><option value=theme-dark>Dark</option><option value=theme-high-contrast>High contrast</option></select></div></div></section><section class=about-column><h3 class=column-title>About</h3><ul class=column-elements-container><li><a href=https://www.freebsd.org/about/ target=_blank class=column-element>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/ target=_blank class=column-element>FreeBSD Foundation</a></li><li><a href=https://www.freebsd.org/where/ target=_blank class=column-element>Get FreeBSD</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct target=_blank class=column-element>Code of Conduct</a></li><li><a href=https://www.freebsd.org/security/ target=_blank class=column-element>Security Advisories</a></li></ul></section><section class=documentation-column><h3 class=column-title>Documentation</h3><ul class=column-elements-container><li><a href=/ja class=column-element>Documentation portal</a></li><li><a href=https://man.FreeBSD.org target=_blank class=column-element>Manual pages</a></li><li><a href=https://papers.FreeBSD.org target=_blank class=column-element>Presentations and papers</a></li><li><a href=https://docs-archive.freebsd.org/doc/ target=_blank class=column-element>Previous versions</a></li><li><a href=https://docs-archive.freebsd.org/44doc/ target=_blank class=column-element>4.4BSD Documents</a></li><li><a href=https://wiki.freebsd.org/ target=_blank class=column-element>Wiki</a></li></ul></section><section class=community-column><h3 class=column-title>Community</h3><ul class=column-elements-container><li><a href=http://172.16.201.134:1313/ja/articles/contributing class=column-element>Get involved</a></li><li><a href=https://forums.freebsd.org/ target=_blank class=column-element>Community forum</a></li><li><a href=https://lists.freebsd.org/ target=_blank class=column-element>Mailing lists</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank class=column-element>IRC Channels</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank class=column-element>Bug Tracker</a></li></ul></section><section class=legal-column><h3 class=column-title>Legal</h3><ul class=column-elements-container><li><a href=https://freebsdfoundation.org/donate/ target=_blank class=column-element>Donations</a></li><li><a href=https://www.freebsd.org/copyright/freebsd-license/ target=_blank class=column-element>Licensing</a></li><li><a href=https://www.freebsd.org/privacy/ target=_blank class=column-element>Privacy Policy</a></li><li><a href=https://www.freebsd.org/copyright/ target=_blank class=column-element>Legal notices</a></li></ul></section><section class=copyright-column><p>&copy; 1994-2024 The FreeBSD Project. All rights reserved</p><span>Made with <span class=heart>♥</span> by the FreeBSD Community</span></section></div></footer></body></html>