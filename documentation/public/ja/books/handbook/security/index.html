<!doctype html><html class=theme-light lang=ja><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content><meta name=copyright content="1995-2024 The FreeBSD Foundation"><link rel=canonical href=http://172.16.201.134:1313/ja/books/handbook/security/><title>第13章 セキュリティ | FreeBSD Documentation Portal</title>
<meta name=theme-color content="#790000"><meta name=color-scheme content="system light dark high-contrast"><link rel="shortcut icon" href=http://172.16.201.134:1313/favicon.ico><link rel=stylesheet href=http://172.16.201.134:1313/styles/main.min.css><link rel=stylesheet href=http://172.16.201.134:1313/css/font-awesome-min.css><script defer src=/js/theme-chooser.min.js></script><script defer src=/js/copy-clipboard.min.js></script><script defer src=/js/search.min.js></script><meta name=twitter:card content="summary"><meta name=twitter:domain content="docs.FreeBSD.org"><meta name=twitter:site content="@freebsd"><meta name=twitter:url content="https://twitter.com/freebsd"><meta property="og:title" content="第13章 セキュリティ"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:image" content="http://172.16.201.134:1313/favicon.ico"><meta property="og:image:alt" content="FreeBSD Logo"><meta property="og:locale" content="ja"><meta property="og:url" content="http://172.16.201.134:1313/ja/books/handbook/security/"><meta property="og:site_name" content="FreeBSD Documentation Portal"><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","url":"http:\/\/172.16.201.134:1313\/ja\/books\/handbook\/security\/","name":"FreeBSD Documentation Portal","headline":"FreeBSD Documentation Portal","description":"FreeBSD Documentation Portal"}</script></head><body><header><div class=header-container><div class=logo-menu-bars-container><a href=https://www.FreeBSD.org class=logo><img src=http://172.16.201.134:1313/images/FreeBSD-monochromatic.svg width=160 height=50 alt="FreeBSD logo">
</a><label class=menu-bars for=menu-bars><i class="fa fa-bars" aria-hidden=true></i></label></div><input id=menu-bars type=checkbox><nav><ul class=menu><li class=menu-item><input id=about type=checkbox>
<a href=# aria-label="Navigate to About section"><label class=menu-item-description for=about>About
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/about/ target=_blank>About</a></li><li><a href=https://www.freebsd.org/about/ target=_blank>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/about-us/about-the-foundation/ target=_blank>FreeBSD Foundation</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct/ target=_blank>Code of Conduct</a></li></ul></li><li class=menu-item><input id=download type=checkbox>
<a href=# aria-label="Navigate to get FreeBSD section"><label class=menu-item-description for=download>Get FreeBSD
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/where/ target=_blank>Get FreeBSD</a></li><li><a href=https://www.freebsd.org/releases/ target=_blank>Release Information</a></li><li><a href=https://www.freebsd.org/releng/ target=_blank>Release Engineering</a></li><li><a href=https://www.freebsd.org/security/ target=_blank>Security Advisories</a></li></ul></li><li class=menu-item><input id=documentation type=checkbox>
<a href=# aria-label="Navigate to get Documentation section"><label class=menu-item-description for=documentation>Documentation
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=/ja>Documentation portal</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook>FreeBSD Handbook</a></li><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook>Porter's Handbook</a></li><li><a href=https://docs.FreeBSD.org/en/books/fdp-primer>Documentation Project Handbook</a></li><li><a href=https://man.FreeBSD.org target=_blank>Manual pages</a></li><li><a href=https://papers.FreeBSD.org target=_blank>Presentations and papers</a></li><li><a href=https://wiki.FreeBSD.org target=_blank>Wiki</a></li><li><a href=http://172.16.201.134:1313/ja/books>Books</a></li><li><a href=http://172.16.201.134:1313/ja/articles>Articles</a></li></ul></li><li class=menu-item><input id=community type=checkbox>
<a href=# aria-label="Navigate to get Community section"><label class=menu-item-description for=community>Community
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/community/>Community</a></li><li><a href=http://172.16.201.134:1313/ja/articles/contributing>Get involved</a></li><li><a href=https://forums.freebsd.org/ target=_blank>Forum</a></li><li><a href=https://lists.freebsd.org/ target=_blank>Mailing lists</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank>IRC Channels</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank>Bug Tracker</a></li><li><a href=https://www.freebsd.org/support/ target=_blank>Support</a></li></ul></li></ul></nav><div class=search-donate-container><form class=search method=get id=search-header-form action=https://docs.freebsd.org/search name=search-header-form><input type=hidden name=DB value=ja>
<input id=words name=P type=text size=20 maxlength=255>
<button>
<i class="fa fa-search" aria-hidden=true></i></button></form><div class=donate><a href=https://freebsdfoundation.org/donate/ target=_blank><span class=heart>♥</span>
Donate</a></div></div></div></header><input type=checkbox class="hidden toggle" id=menu-control><main class=main-wrapper-book><a id=top></a><aside class=book-menu><div class=book-menu-content><input id=search-book type=text placeholder=Search aria-label=Search maxlength=128><nav id=MenuContents><ul><li><input type=checkbox id=chapter-eb2a98ce203d8afd517726e6d8776be3 class=toggle>
<label class="icon cursor" for=chapter-eb2a98ce203d8afd517726e6d8776be3><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/handbook/preface/>前書き</a><ul><li><a href=http://172.16.201.134:1313/ja/books/handbook/preface/#preface-audience>想定している読者</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/preface/#preface-changes-from3>第 3 版からの変更</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/preface/#preface-changes-from2>第 2 版 (2004) からの変更</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/preface/#preface-changes>第 1 版 (2001) からの変更</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/preface/#preface-overview>この文書の構成</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/preface/#preface-conv>この文書で用いられている表記法</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/preface/#preface-acknowledgements>謝辞</a></li></ul></li><li><input type=checkbox id=chapter-14a525fce014b90b8a458a894818255a class=toggle>
<label for=chapter-14a525fce014b90b8a458a894818255a><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/handbook/parti/>パートI. 導入</a></li><li><input type=checkbox id=chapter-f9c9f3451644df30d224350da97d5da6 class=toggle>
<label class="icon cursor" for=chapter-f9c9f3451644df30d224350da97d5da6><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/handbook/introduction/>第1章 はじめに</a><ul><li><a href=http://172.16.201.134:1313/ja/books/handbook/introduction/#introduction-synopsis>1.1. この章では</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/introduction/#nutshell>1.2. FreeBSD へようこそ!</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/introduction/#history>1.3. FreeBSD プロジェクトについて</a></li></ul></li><li><input type=checkbox id=chapter-f693a3fa687a72d63ec8129ee302d664 class=toggle>
<label class="icon cursor" for=chapter-f693a3fa687a72d63ec8129ee302d664><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/handbook/bsdinstall/>第2章 FreeBSD のインストール</a><ul><li><a href=http://172.16.201.134:1313/ja/books/handbook/bsdinstall/#bsdinstall-synopsis>2.1. この章では</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/bsdinstall/#bsdinstall-hardware>2.2. 最小ハードウェア要件</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/bsdinstall/#bsdinstall-pre>2.3. インストール前に行う作業</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/bsdinstall/#bsdinstall-start>2.4. インストールの開始</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/bsdinstall/#using-bsdinstall>2.5. bsdinstall の使用</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/bsdinstall/#bsdinstall-partitioning>2.6. ディスク領域の割り当て</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/bsdinstall/#bsdinstall-fetching-distribution>2.7. 配布ファイルのダウンロード</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/bsdinstall/#bsdinstall-post>2.8. ネットワークインターフェース、アカウント、タイムゾーン、 サービスおよびセキュリティオプションの設定</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/bsdinstall/#bsdinstall-install-trouble>2.9. トラブルシューティング</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/bsdinstall/#using-live-cd>2.10. Live CD を使う</a></li></ul></li><li><input type=checkbox id=chapter-9f6db261075f578742036fcc6000eecd class=toggle>
<label class="icon cursor" for=chapter-9f6db261075f578742036fcc6000eecd><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/handbook/basics/>第3章 FreeBSD の基礎知識</a><ul><li><a href=http://172.16.201.134:1313/ja/books/handbook/basics/#basics-synopsis>3.1. この章では</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/basics/#consoles>3.2. 仮想コンソールと端末</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/basics/#users-synopsis>3.3. ユーザと基本的なアカウント管理</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/basics/#permissions>3.4. 許可属性</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/basics/#dirstructure>3.5. ディレクトリ構造</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/basics/#disk-organization>3.6. ディスク構成</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/basics/#mount-unmount>3.7. ファイルシステムのマウントとアンマウント</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/basics/#basics-processes>3.8. プロセスおよびデーモン</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/basics/#shells>3.9. シェル</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/basics/#editors>3.10. テキストエディタ</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/basics/#basics-devices>3.11. デバイスとデバイスノード</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/basics/#basics-more-information>3.12. マニュアルページ</a></li></ul></li><li><input type=checkbox id=chapter-01c5707e95d14c0ff84bf62600c958d1 class=toggle>
<label class="icon cursor" for=chapter-01c5707e95d14c0ff84bf62600c958d1><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/handbook/ports/>第4章 アプリケーションのインストール - packages と ports</a><ul><li><a href=http://172.16.201.134:1313/ja/books/handbook/ports/#ports-synopsis>4.1. この章では</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/ports/#ports-overview>4.2. ソフトウェアのインストール</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/ports/#ports-finding-applications>4.3. ソフトウェアの探し方</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/ports/#pkgng-intro>4.4. pkg によるバイナリ package の管理</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/ports/#ports-using>4.5. Ports Collection の利用</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/ports/#ports-poudriere>4.6. Poudriere を用いた package の構築</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/ports/#ports-nextsteps>4.7. インストール後の作業</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/ports/#ports-broken>4.8. うまく動作しない ports に遭遇した場合には</a></li></ul></li><li><input type=checkbox id=chapter-3405c00581365a8b5d16af70fe4d1b72 class=toggle>
<label class="icon cursor" for=chapter-3405c00581365a8b5d16af70fe4d1b72><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/handbook/x11/>第5章 X Window System</a><ul><li><a href=http://172.16.201.134:1313/ja/books/handbook/x11/#x11-synopsis>5.1. この章では</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/x11/#x-understanding>5.2. 用語の説明</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/x11/#x-install>5.3. Xorg のインストール</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/x11/#x-config>5.4. Xorg の設定</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/x11/#x-fonts>5.5. Xorg でのフォントの使用</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/x11/#x-xdm>5.6. X ディスプレイマネージャ</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/x11/#x11-wm>5.7. デスクトップ環境</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/x11/#x-compiz-fusion>5.8. Compiz Fusion のインストール</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/x11/#x11-troubleshooting>5.9. トラブルシューティング</a></li></ul></li><li><input type=checkbox id=chapter-0eab3565e8f59f5a8a896dfba7eb3680 class=toggle>
<label for=chapter-0eab3565e8f59f5a8a896dfba7eb3680><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/handbook/partii/>パートII. 日々の生活</a></li><li><input type=checkbox id=chapter-b33cf28993f3f7bf5baf036e79da0f39 class=toggle>
<label class="icon cursor" for=chapter-b33cf28993f3f7bf5baf036e79da0f39><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/handbook/desktop/>第6章 デスクトップアプリケーション</a><ul><li><a href=http://172.16.201.134:1313/ja/books/handbook/desktop/#desktop-synopsis>6.1. この章では</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/desktop/#desktop-browsers>6.2. ブラウザ</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/desktop/#desktop-productivity>6.3. 生産的なアプリケーション</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/desktop/#desktop-viewers>6.4. ドキュメントビューア</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/desktop/#desktop-finance>6.5. 財務管理ソフトウェア</a></li></ul></li><li><input type=checkbox id=chapter-152f694a19312ad72ec7bb4e1c3c33b2 class=toggle>
<label class="icon cursor" for=chapter-152f694a19312ad72ec7bb4e1c3c33b2><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/handbook/multimedia/>第7章 マルチメディア</a><ul><li><a href=http://172.16.201.134:1313/ja/books/handbook/multimedia/#multimedia-synopsis>7.1. この章では</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/multimedia/#sound-setup>7.2. サウンドカードの設定</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/multimedia/#sound-mp3>7.3. MP3 オーディオ</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/multimedia/#video-playback>7.4. ビデオ再生</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/multimedia/#tvcard>7.5. TV カードの設定</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/multimedia/#mythtv>7.6. MythTV</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/multimedia/#scanners>7.7. 画像スキャナ</a></li></ul></li><li><input type=checkbox id=chapter-80888b4ee02e3e409e5f71cf97a36450 class=toggle>
<label class="icon cursor" for=chapter-80888b4ee02e3e409e5f71cf97a36450><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/handbook/kernelconfig/>第8章 FreeBSD カーネルのコンフィグレーション</a><ul><li><a href=http://172.16.201.134:1313/ja/books/handbook/kernelconfig/#kernelconfig-synopsis>8.1. この章では</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/kernelconfig/#kernelconfig-custom-kernel>8.2. なぜカスタムカーネルを作るか?</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/kernelconfig/#kernelconfig-devices>8.3. システムのハードウェアについて知る</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/kernelconfig/#kernelconfig-config>8.4. コンフィグレーションファイル</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/kernelconfig/#kernelconfig-building>8.5. カスタムカーネルの構築とインストール</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/kernelconfig/#kernelconfig-trouble>8.6. 問題が起きた場合には</a></li></ul></li><li><input type=checkbox id=chapter-cb174c55879b17ab955f2f16989a79e0 class=toggle>
<label class="icon cursor" for=chapter-cb174c55879b17ab955f2f16989a79e0><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/handbook/printing/>第9章 プリンタの利用</a><ul><li><a href=http://172.16.201.134:1313/ja/books/handbook/printing/#printing-synopsis>9.1. この章では</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/printing/#printing-intro-spooler>9.2. はじめに</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/printing/#printing-intro-setup>9.3. 基本的な設定</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/printing/#printing-advanced>9.4. プリンタ設定上級編</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/printing/#printing-using>9.5. プリンタを使う</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/printing/#printing-lpd-alternatives>9.6. 標準スプーラの代替品</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/printing/#printing-troubleshooting>9.7. トラブルシューティング</a></li></ul></li><li><input type=checkbox id=chapter-c12b8c3f2a8fcefce87087241f695c83 class=toggle>
<label class="icon cursor" for=chapter-c12b8c3f2a8fcefce87087241f695c83><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/handbook/linuxemu/>第10章 Linux® バイナリ互換機能</a><ul><li><a href=http://172.16.201.134:1313/ja/books/handbook/linuxemu/#linuxemu-synopsis>10.1. この章では</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/linuxemu/#linuxemu-lbc-install>10.2. Linux® バイナリ互換機能の設定</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/linuxemu/#linuxemu-advanced>10.3. 高度なトピックス</a></li></ul></li><li><input type=checkbox id=chapter-03b11ba627b9a0c85b247f5641bde272 class=toggle>
<label for=chapter-03b11ba627b9a0c85b247f5641bde272><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/handbook/partiii/>パートIII. システム管理</a></li><li><input type=checkbox id=chapter-6c31587f8d736319f099cd4dc1961301 class=toggle>
<label class="icon cursor" for=chapter-6c31587f8d736319f099cd4dc1961301><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/handbook/config/>第11章 設定とチューニング</a><ul><li><a href=http://172.16.201.134:1313/ja/books/handbook/config/#_この章では>11.1. この章では</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/config/#configtuning-core-configuration>11.2. 中核となる設定</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/config/#configtuning-appconfig>11.3. アプリケーションの設定</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/config/#configtuning-starting-services>11.4. サービスの起動</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/config/#configtuning-virtual-hosts>11.5. バーチャルホスト</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/config/#configtuning-configfiles>11.6. 設定ファイル</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/config/#configtuning-sysctl>11.7. sysctl によるチューニング</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/config/#configtuning-disk>11.8. ディスクのチューニング</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/config/#configtuning-kernel-limits>11.9. Kernel 制限のチューニング</a></li></ul></li><li><input type=checkbox id=chapter-459f0012b3b4f0b6b123010f029da5e4 class=toggle>
<label class="icon cursor" for=chapter-459f0012b3b4f0b6b123010f029da5e4><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/handbook/boot/>第12章 FreeBSD の起動のプロセス</a><ul><li><a href=http://172.16.201.134:1313/ja/books/handbook/boot/#boot-synopsis>12.1. この章では</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/boot/#boot-introduction>12.2. FreeBSD の起動プロセス</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/boot/#device-hints>12.3. Device Hints</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/boot/#boot-shutdown>12.4. シャットダウン動作</a></li></ul></li><li><input type=checkbox id=chapter-917c75fcffbb14d48ed6d0a48e7028f2 class=toggle checked>
<label class="icon cursor" for=chapter-917c75fcffbb14d48ed6d0a48e7028f2><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/handbook/security/>第13章 セキュリティ</a><ul><li><a href=http://172.16.201.134:1313/ja/books/handbook/security/#security-synopsis>13.1. この章では</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/security/#security-intro>13.2. はじめに</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/security/#one-time-passwords>13.3. ワンタイムパスワード</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/security/#tcpwrappers>13.4. TCP Wrappers</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/security/#kerberos5>13.5. Kerberos5</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/security/#openssl>13.6. OpenSSL</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/security/#ipsec>13.7. VPN over IPsec</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/security/#openssh>13.8. OpenSSH</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/security/#fs-acl>13.9. ファイルシステムアクセス制御リスト (ACL)</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/security/#security-portaudit>13.10. サードパーティ製ソフトウェアのセキュリティ問題を監視する</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/security/#security-advisories>13.11. FreeBSD セキュリティ勧告</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/security/#security-accounting>13.12. プロセスアカウンティング</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/security/#security-resourcelimits>13.13. リソースの制限</a></li></ul></li><li><input type=checkbox id=chapter-e1edcad13d9db6e8e4cb645d378ecfaf class=toggle>
<label class="icon cursor" for=chapter-e1edcad13d9db6e8e4cb645d378ecfaf><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/handbook/disks/>第14章 ストレージ</a><ul><li><a href=http://172.16.201.134:1313/ja/books/handbook/disks/#disks-synopsis>14.1. この章では</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/disks/#disk-naming>14.2. デバイス名</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/disks/#disks-adding>14.3. ディスクの追加</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/disks/#raid>14.4. RAID</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/disks/#creating-cds>14.5. 光メディア (CD & DVD) の作成と使用</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/disks/#floppies>14.6. フロッピーディスクの作成と使用</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/disks/#backups-tapebackups>14.7. データテープの作成と使用</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/disks/#backups-floppybackups>14.8. フロッピーディスクへのバックアップ</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/disks/#backup-basics>14.9. バックアップの基本</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/disks/#disks-virtual>14.10. ネットワーク、メモリ、そしてファイルベースのファイルシステム</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/disks/#snapshots>14.11. ファイルシステムのスナップショット</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/disks/#quotas>14.12. ファイルシステムクォータ</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/disks/#disks-encrypting>14.13. ディスクパーティションの暗号化</a></li></ul></li><li><input type=checkbox id=chapter-49f1e96591c090304ea532012257f4ef class=toggle>
<label class="icon cursor" for=chapter-49f1e96591c090304ea532012257f4ef><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/handbook/l10n/>第15章 地域化 (localization) - i18n/L10n の利用と設定</a><ul><li><a href=http://172.16.201.134:1313/ja/books/handbook/l10n/#l10n-synopsis>15.1. この章では</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/l10n/#using-localization>15.2. 地域化の利用</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/l10n/#l10n-compiling>15.3. 国際化 (i18n) に対応したアプリケーションを見つける</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/l10n/#lang-setup>15.4. 特定の言語にロケールを設定する</a></li></ul></li><li><input type=checkbox id=chapter-dead2b4c5ea325dd390a9b0dccd8f763 class=toggle>
<label class="icon cursor" for=chapter-dead2b4c5ea325dd390a9b0dccd8f763><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/handbook/cutting-edge/>第16章 FreeBSD のアップデートとアップグレード</a><ul><li><a href=http://172.16.201.134:1313/ja/books/handbook/cutting-edge/#updating-upgrading-synopsis>16.1. この章では</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/cutting-edge/#updating-upgrading-freebsdupdate>16.2. FreeBSD Update</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/cutting-edge/#updating-bootcode>16.3. ブートコードのアップデート</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/cutting-edge/#updating-upgrading-documentation>16.4. ドキュメントのアップデート</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/cutting-edge/#current-stable>16.5. 開発ブランチを追いかける</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/cutting-edge/#makeworld>16.6. ソースを用いた FreeBSD のアップデート</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/cutting-edge/#small-lan>16.7. 複数のマシンで追いかける</a></li></ul></li><li><input type=checkbox id=chapter-bbd25f9a194f9c39ca2d658c75767db5 class=toggle>
<label for=chapter-bbd25f9a194f9c39ca2d658c75767db5><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/handbook/partiv/>パートIV. ネットワーク通信</a></li><li><input type=checkbox id=chapter-499dab596afd7ddac77e80295314e0dd class=toggle>
<label class="icon cursor" for=chapter-499dab596afd7ddac77e80295314e0dd><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/handbook/serialcomms/>第17章 シリアル通信</a><ul><li><a href=http://172.16.201.134:1313/ja/books/handbook/serialcomms/#serial-synopsis>17.1. この章では</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/serialcomms/#serial>17.2. はじめに</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/serialcomms/#term>17.3. シリアル端末</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/serialcomms/#dialup>17.4. ダイアルインサービス</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/serialcomms/#dialout>17.5. ダイアルアウトサービス</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/serialcomms/#serialconsole-setup>17.6. シリアルコンソールの設定</a></li></ul></li><li><input type=checkbox id=chapter-95e4571c48bee1cced5e84a538d302e3 class=toggle>
<label class="icon cursor" for=chapter-95e4571c48bee1cced5e84a538d302e3><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/handbook/ppp-and-slip/>第18章 PPP と SLIP</a><ul><li><a href=http://172.16.201.134:1313/ja/books/handbook/ppp-and-slip/#_この章では>18.1. この章では</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/ppp-and-slip/#userppp>18.2. ユーザ ppp の利用</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/ppp-and-slip/#ppp>18.3. カーネル PPP の利用</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/ppp-and-slip/#pppoe>18.4. PPP オーバイーサネット (PPPoE) の利用</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/ppp-and-slip/#slip>18.5. SLIP の利用</a></li></ul></li><li><input type=checkbox id=chapter-f089ac726c401c9b4bd5c34a295e11bb class=toggle>
<label class="icon cursor" for=chapter-f089ac726c401c9b4bd5c34a295e11bb><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/handbook/mail/>第19章 電子メール</a><ul><li><a href=http://172.16.201.134:1313/ja/books/handbook/mail/#mail-synopsis>19.1. この章では</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/mail/#mail-using>19.2. 電子メールを使う</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/mail/#sendmail>19.3. sendmail の設定</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/mail/#mail-changingmta>19.4. MTA の変更</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/mail/#mail-trouble>19.5. トラブルシュート</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/mail/#mail-advanced>19.6. 先進的なトピックス</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/mail/#SMTP-UUCP>19.7. UUCP とともに SMTP を使う</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/mail/#SMTP-dialup>19.8. ダイアルアップ接続でメールを使う</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/mail/#SMTP-Auth>19.9. SMTP 認証</a></li></ul></li><li><input type=checkbox id=chapter-5b07f776a0e6155c1c89aa0d15610380 class=toggle>
<label class="icon cursor" for=chapter-5b07f776a0e6155c1c89aa0d15610380><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/handbook/advanced-networking/>第20章 高度なネットワーク</a><ul><li><a href=http://172.16.201.134:1313/ja/books/handbook/advanced-networking/#advanced-networking-synopsis>20.1. この章では</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/advanced-networking/#network-routing>20.2. ゲートウェイと経路</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/advanced-networking/#network-wireless>20.3. 無線ネットワーク</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/advanced-networking/#network-bluetooth>20.4. Bluetooth</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/advanced-networking/#network-bridging>20.5. ブリッジ</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/advanced-networking/#network-nfs>20.6. NFS</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/advanced-networking/#network-diskless>20.7. ディスクレス稼働</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/advanced-networking/#network-isdn>20.8. ISDN</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/advanced-networking/#network-nis>20.9. NIS/YP</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/advanced-networking/#network-dhcp>20.10. DHCP</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/advanced-networking/#network-dns>20.11. DNS</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/advanced-networking/#network-ntp>20.12. NTP</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/advanced-networking/#network-natd>20.13. ネットワークアドレス変換 (NAT)</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/advanced-networking/#network-inetd>20.14. inetd"スーパサーバ"</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/advanced-networking/#network-plip>20.15. パラレルライン IP (PLIP)</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/advanced-networking/#network-ipv6>20.16. IPv6</a></li></ul></li><li><input type=checkbox id=chapter-171a77aa9d067a1024f849470e1f33e8 class=toggle>
<label for=chapter-171a77aa9d067a1024f849470e1f33e8><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/handbook/partv/>パートV. 付録</a></li><li><input type=checkbox id=chapter-8050f436a0a7986a4aaded93d8e49469 class=toggle>
<label class="icon cursor" for=chapter-8050f436a0a7986a4aaded93d8e49469><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/handbook/mirrors/>付録A FreeBSD の入手方法</a><ul><li><a href=http://172.16.201.134:1313/ja/books/handbook/mirrors/#mirrors>A.1. Mirrors</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/mirrors/#git>A.2. Git の利用</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/mirrors/#svn>A.3. Subversion の利用</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/mirrors/#mirrors-cdrom>A.4. CD および DVD セット</a></li></ul></li><li><input type=checkbox id=chapter-128b630a8f88f158e7027fe6c2184d21 class=toggle>
<label class="icon cursor" for=chapter-128b630a8f88f158e7027fe6c2184d21><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/handbook/bibliography/>付録B. 参考図書</a><ul><li><a href=http://172.16.201.134:1313/ja/books/handbook/bibliography/#bibliography-freebsd>B.1. FreeBSD 専門の書籍</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/bibliography/#bibliography-userguides>B.2. 利用者向けのガイド</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/bibliography/#bibliography-adminguides>B.3. 管理者向けのガイド</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/bibliography/#_プログラマ向けのガイド>B.4. プログラマ向けのガイド</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/bibliography/#_オペレーティングシステム内部>B.5. オペレーティングシステム内部</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/bibliography/#_セキュリティの参考資料>B.6. セキュリティの参考資料</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/bibliography/#bibliography-hardware>B.7. ハードウェアの参考資料</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/bibliography/#bibliography-history>B.8. UNIX® の歴史</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/bibliography/#bibliography-journals>B.9. 定期刊行物、雑誌およびジャーナル</a></li></ul></li><li><input type=checkbox id=chapter-8bbb8867c46dac315e2253945d8c18a8 class=toggle>
<label class="icon cursor" for=chapter-8bbb8867c46dac315e2253945d8c18a8><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/handbook/eresources/>付録 C. インターネット上のリソース</a><ul><li><a href=http://172.16.201.134:1313/ja/books/handbook/eresources/#eresources-www>C.1. ウェブサイト</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/eresources/#eresources-mail>C.2. メーリングリスト</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/eresources/#eresources-news>C.3. Usenet ニュースグループ</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook/eresources/#eresources-web>C.4. オフィシャルミラー</a></li></ul></li><li><input type=checkbox id=chapter-a80ea4f5a4480b8725422710f954ef36 class=toggle>
<label class="icon cursor" for=chapter-a80ea4f5a4480b8725422710f954ef36><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/handbook/pgpkeys/>付録 D. OpenPGP Keys</a><ul><li><a href=http://172.16.201.134:1313/ja/books/handbook/pgpkeys/#pgpkeys-officers>D.1. オフィサ</a></li></ul></li><li></li></ul></nav></div></aside><div class=book><div class=book-menu-mobile><label for=menu-control><span class=menu-control-button><i class="fa fa-list" aria-hidden=true title="Book menu"></i>
Book menu</span></label></div><h1 class=title>第13章 セキュリティ</h1><div class="admonitionblock note"><p><i class="fa fa-exclamation-circle" aria-hidden=true></i>
This translation may be out of date. To help with the translations please access the <a href=https://translate-dev.freebsd.org/ target=_blank>FreeBSD translations instance</a>.</p></div><div class=toc-mobile><h3>目次</h3><nav id=TableOfContents><ul><li><a href=#security-synopsis>13.1. この章では</a></li><li><a href=#security-intro>13.2. はじめに</a></li><li><a href=#one-time-passwords>13.3. ワンタイムパスワード</a></li><li><a href=#tcpwrappers>13.4. TCP Wrappers</a></li><li><a href=#kerberos5>13.5. Kerberos5</a></li><li><a href=#openssl>13.6. OpenSSL</a></li><li><a href=#ipsec>13.7. VPN over IPsec</a></li><li><a href=#openssh>13.8. OpenSSH</a></li><li><a href=#fs-acl>13.9. ファイルシステムアクセス制御リスト (ACL)</a></li><li><a href=#security-portaudit>13.10. サードパーティ製ソフトウェアのセキュリティ問題を監視する</a></li><li><a href=#security-advisories>13.11. FreeBSD セキュリティ勧告</a></li><li><a href=#security-accounting>13.12. プロセスアカウンティング</a></li><li><a href=#security-resourcelimits>13.13. リソースの制限</a></li></ul></nav></div><div class=book-content><div id=preamble><div class=sectionbody></div></div><div class=sect1><h2 id=security-synopsis>13.1. この章では<a class=anchor href=#security-synopsis></a></h2><div class=sectionbody><div class=paragraph><p>物理的もしくは仮想的に関わらず、 セキュリティは幅広いトピックであり、 業界全体がセキュリティとともに成長しています。 システムおよびネットワークを安全にする標準的な方法は数多く文書化されており、 FreeBSD のユーザも、 攻撃や侵入者から守る方法を理解しなければなりません。</p></div><div class=paragraph><p>この章では、セキュリティの基礎や技術について説明します。 FreeBSD システムは、複数のレイヤに関連するセキュリティを提供します。 そして、安全性を高めるためにサードパーティ製のユーティリティを利用することもできます。</p></div><div class=paragraph><p>この章を読むと、以下のことがわかります。</p></div><div class=ulist><ul><li><p>FreeBSD における基本的なシステムセキュリティの考え方</p></li><li><p>FreeBSD で利用できるさまざまな暗号化手法</p></li><li><p>ワンタイムパスワード認証の設定方法</p></li><li><p><a href="https://man.freebsd.org/cgi/man.cgi?query=inetd&amp;sektion=8&amp;format=html">inetd(8)</a> と組み合わせて TCP Wrappers を設定する方法</p></li><li><p>FreeBSD における Kerberos の設定方法</p></li><li><p>IPsec を設定して VPN を構築する方法</p></li><li><p>FreeBSD にける OpenSSH の設定および使用方法</p></li><li><p>ファイルシステム ACL (アクセス制御リスト) の使用方法</p></li><li><p>Ports Collection からインストールされたサードパーティ製ソフトウェア packages を Portaudit を使って監査する方法</p></li><li><p>FreeBSD セキュリティ勧告の利用方法</p></li><li><p>プロセスアカウンティングがどのようなものか、 FreeBSD 上で有効にする方法について</p></li><li><p>リソース制限データベースとは何か、 この仕組みを使ったユーザ資源の管理方法</p></li></ul></div><div class=paragraph><p>この章を読む前に、次のことが必要になります。</p></div><div class=ulist><ul><li><p>FreeBSD およびインターネットの基本概念の理解</p></li></ul></div></div></div><div class=sect1><h2 id=security-intro>13.2. はじめに<a class=anchor href=#security-intro></a></h2><div class=sectionbody><div class=paragraph><p>セキュリティを高めることはすべての人の責任です。 システムに弱い侵入ポイントが存在すると、侵入者は重要な情報を得たり、 ネットワーク全体に被害を及ぼすことができるようになります。 多くのセキュリティのトレーニングでは、 情報システムの機密性 (confidentiality)、 完全性 (integrity) および可用性 (availability) を意味するセキュリティの 3 要素である CIA が取り扱われます。</p></div><div class=paragraph><p>CIA の 3 要素は、 コンピュータセキュリティの基本となる考えです。 顧客やエンドユーザは、データのプライバシーを期待します。 彼らは、データが変更されないことや、 情報が隠されていることを期待します。 彼らはまた、いつでも情報にアクセスできることを期待します。 これらは、システムの機密性、完全性、可用性を構成します。</p></div><div class=paragraph><p>セキュリティのプロフェッショナルは、CIA を守るために、多層防衛の戦略を採用します。 この多層防衛戦略ではセキュリティのレイアを複数用意することで、 一つのレイヤが破られても、 セキュリティシステム全体が破られることを防ぎます。 システムの管理者は、ファイアウォールを単に有効にするだけではなく、 ネットワークもしくはシステムを安全に保つ必要があります。 アカウントを監査し、バイナリの完全性、 悪意のあるツールがインストールされていないことを確認する必要があります。 このために、 管理者は脅威がどのようなものかを理解する必要があります。</p></div><div class=sect2><h3 id=security-threats>13.2.1. 脅威<a class=anchor href=#security-threats></a></h3><div class=paragraph><p>コンピュータセキュリティおける脅威とは何でしょうか？ 長年、脅威はリモートの攻撃者、 すなわち遠隔からの許可のないシステムへのアクセスを企てる人々と考えられていました。 今日では、この定義は従業員、悪意のあるソフトウェア、 不正なネットワークデバイス、自然災害、セキュリティの脆弱性、 そして競合する会社でさえも含めるように拡張されています。</p></div><div class=paragraph><p>毎日、数千ものシステムおよびネットワークが攻撃され、 数百ものシステムが許可なくアクセスされています。 簡単なアクシデントといったものから、リモートからの攻撃、 産業スパイであったり、以前働いていた従業員からの攻撃といったケースもあります。 システムのユーザとしては、 間違いがセキュリティ違反に繋がった場合には、 可能性のある問題をセキュリティチームに報告することが重要です。 管理者としては、脅威を把握し、 その脅威の影響を小さくするように準備をしておくことが重要です。</p></div></div><div class=sect2><h3 id=security-groundup>13.2.2. ボトムアップアプローチ<a class=anchor href=#security-groundup></a></h3><div class=paragraph><p>セキュリティを考える上で、 しばしばボトムアップアプローチが一番良い方法となります。 この考えでは、管理者が基本的なアカウント、システム設定を行ってから、 サードパーティ製ユーティリティの設定、 そしてネットワークレイヤに設定を広げていきます。 システムポリシーおよび手続きを行う上では、 このような設定の側面があります。</p></div><div class=paragraph><p>ビジネスの多くの環境では、 使用するデバイスの設定に対するセキュリティポリシがすでに策定されています。 このポリシには、最低限エンドユーザのワークステーション、 デスクトップ、携帯電話やラップトップといったモバイルデバイス、および 製品および開発サーバの両方に対するセキュリティの設定が含まれているべきです。 多くの場合には、コンピュータのセキュリティを考える際に、 標準作業手続書 (SOP) がすでに存在します。 わからなければ、セキュリティチームに尋ねてください。</p></div></div><div class=sect2><h3 id=security-accounts>13.2.3. システムおよびユーザアカウント<a class=anchor href=#security-accounts></a></h3><div class=paragraph><p>システムを安全にするにあたり、最も適切な出発点は、 アカウントの監査です。 ルートアカウントのパスワードが強力であること、 シェルアクセスを必要としないアカウントは無効にすることを確実におこなってください。 また、権限を必要とするユーザに対しては、 <a class=package href=https://cgit.freebsd.org/ports/tree/security/sudo/>security/sudo</a> をインストールして、 アクセスが必要となるアプリケーションのみにアクセスを許可するようにしてください。 root ユーザのパスワードは、決して共有すべきではありません。</p></div><div class=paragraph><p>アカウントへのアクセスを無効にする方法は二通りあります。 一つ目の方法は、アカウントをロックする方法です。例として、 toor アカウントをロックする方法を以下に示します。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pw lock toor</span></code></pre></div></div><div class=paragraph><p>このコマンドは、アカウントの設定を "toor:*:0:0::0:0:Bourne-again Superuser:/root:" から "toor:*LOCKED**:0:0::0:0:Bourne-again Superuser:/root:" へと変更します。</p></div><div class=paragraph><p>ときには (おそらく追加のサービスのために)、 この方法が使えない場合があります。 そのような場合には、以下の例のように、 シェルを /sbin/nologin に変更することで、 ログインアクセスを拒否できます。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># chsh -s /usr/sbin/nologin toor</span></code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>他のユーザのシェルは、スーパーユーザのみが変更できます。 通常のユーザが行おうとすると失敗します。</p></div></td></tr></tbody></table></div><div class=paragraph><p>アカウント情報は、以下のように最後のエントリが "nologin" シェルとなります。</p></div><div class="literalblock programlisting"><div class=content><pre>toor:*:0:0::0:0:Bourne-again Superuser:/root:/usr/sbin/nologin</pre></div></div><div class=paragraph><p><span class=filename>/usr/sbin/nologin</span> シェルは、 <a href="https://man.freebsd.org/cgi/man.cgi?query=login&amp;sektion=1&amp;format=html">login(1)</a> コマンドがこのユーザにシェルを割り当てることをブロックします。</p></div></div><div class=sect2><h3 id=security-sudo>13.2.4. アカウントの権限を拡大する<a class=anchor href=#security-sudo></a></h3><div class=paragraph><p>場合によっては、 システム管理者へのアクセスを他のユーザと共有する必要があります。 FreeBSD はこのために二つの方法を用意しています。 第一の方法は推奨されませんが、 ルートのパスワードを共有し、ユーザを <code>wheel</code> グループに加える方法です。 これを行うにには、<span class=filename>/etc/group</span> を編集し、 最初のグループの最後にユーザを追加してください。 ユーザはカンマ区切りで管理されています。</p></div><div class=paragraph><p>権限の拡大をする適切な方法は、 <a class=package href=https://cgit.freebsd.org/ports/tree/security/sudo/>security/sudo</a> port を使う方法です。 この port は、追加の監査、よりきめ細かいユーザ管理、および ユーザを <a href="https://man.freebsd.org/cgi/man.cgi?query=service&amp;sektion=8&amp;format=html">service(8)</a> のような権限が与えられたコマンのみの実行に制限することもできます。</p></div><div class=paragraph><p>インストールが終わったら、 <code>visudo</code> インタフェースを使って <span class=filename>/usr/local/etc/sudoers</span> ファイルを編集してください。 以下の例では、新しく webadmin グループが作成され、 <code>trhodes</code> ユーザがこのグループに追加されます。 その後、ユーザに <a class=package href=https://cgit.freebsd.org/ports/tree/apache24/>apache24</a> を再起動するアクセス権限を与えます。 この手続きは以下のようになります。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pw groupadd webadmin -M trhodes -g 6000</span></code></pre></div></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># visudo</span></code></pre></div></div><div class="literalblock programlisting"><div class=content><pre>%webadmin ALL=(ALL) /usr/sbin/service apache24 *</pre></div></div><div class=paragraph><p>ローカルのユーザ管理において、 <a class=package href=https://cgit.freebsd.org/ports/tree/security/sudo/>security/sudo</a> は、 非常に貴重なリソースを提供します。 また、パスワードを不必要にして、デフォルトを <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;format=html">ssh(1)</a> 鍵の方法だけにすることもできます。 <a href="https://man.freebsd.org/cgi/man.cgi?query=sshd&amp;sektion=8&amp;format=html">sshd(8)</a> 経由のパスワードによるログインを無効にし、 <code>sudo</code> へのローカルパスワードのみを使うようにするには、 <a href=#openssh>OpenSSH</a> をご覧ください。</p></div></div><div class=sect2><h3 id=security-passwords>13.2.5. パスワード<a class=anchor href=#security-passwords></a></h3><div class=paragraph><p>パスワードは、テクノロジーにおける必要悪です。 パスワードは極めて複雑であるだけではなく、 パスワードを保護する強力なハッシュメカニズムもまた必要となります。 この文書を書いている時点では、 FreeBSD は <code>crypt()</code> ライブラリで DES, MD5, Blowfish, SHA256 および SHA512 に対応しています。 デフォルトは SHA512 であり、 強度の弱い暗号へは変更すべきではありません。 しかしながら、Blowfish を好むユーザもおります。 DES を除く各メカニズムでは、 開始の文字、使用しているハッシュメカニズムを識別可能な特徴を持っています。 MD5 メカニズムでは、シンボルは "$" の符号です。 SHA256 または、 SHA512 では、シンボルは "$6$"、 そして Blowfish は "$2a$" です。 暗号強度の弱いパスワードを使用している場合には、 次回のログイン時にユーザが <a href="https://man.freebsd.org/cgi/man.cgi?query=passwd&amp;sektion=1&amp;format=html">passwd(1)</a> を実行して再ハッシュ化することを促すべきです。</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>この文書を書いている時点で、Blowfish は AES でなければ、 FIPS (Federal Information Processing Standards) に準拠もしていません。 そのため、使用できない環境があります。</p></div></td></tr></tbody></table></div><div class=paragraph><p>ネットワークに接続しているシステムについては、 二要素認証を使用すべきです。 この認証では、通常あなたが所有する要素と知っている要素が用いられます。 FreeBSD のベースシステムに含まれている OpenSSH および ssh-keys では、 ネットワークへのすべてのログインにおける二要素認証の交換で、 パスワードを使用すべきではありません。 より詳細な情報については、ハンドブックの <a href=#openssh>OpenSSH</a> 節をご覧ください。 Kerberose のユーザは、ネットワークで OpenSSH を実装するために追加の変更が必要になるでしょう。</p></div></div><div class=sect2><h3 id=security-rkhunter>13.2.6. バックドアおよびルートキット<a class=anchor href=#security-rkhunter></a></h3><div class=paragraph><p>バックドアおよびルートキットは、 それらがインストールされた後に脅威となります。 インストールされると、この悪意のあるソフトウェアは、 攻撃者のために侵入口を設置します。 実際的には、システムが一度汚染された後に、調査が行われ、 消去されます。 慎重なセキュリティやシステムエンジニアでさえも、 攻撃者が残したソフトウェアを見逃してしまうという恐ろしいリスクが存在しています。</p></div><div class=paragraph><p>バックドアまたはルートキットソフトウェアは、 管理者にとって役に立つことが一つあります。 それは、一度検出すると、 システムのどこかが危険に冒されていることの痕跡となります。 しかし、通常この種のアプリケーションは、とてもうまく隠れています。 バックドアおよびルートキットを検出するツールが存在しており、 それうちの一つが、 <a class=package href=https://cgit.freebsd.org/ports/tree/security/rkhunter/>security/rkhunter</a> です。</p></div><div class=paragraph><p>インストール後、以下のコマンドでシステムをチェックできます。 実行すると多くの情報が出力されます。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># rkhunter -c</span></code></pre></div></div><div class=paragraph><p>このプロセスを実行中に <kbd>ENTER</kbd> キーを何度か押す必要があります。 完了すると、ステータスメッセージが画面に表示されます。 このメッセージは、チェックしたファイルの量、疑わしいファイルの数、 可能性のあるルートキット等の情報を含みます。 チェックの最中、隠されたファイル、 OpenSSH プロトコルの選択、そして、 時には、インストールされているソフトウェアの漸弱性のバージョンに関する一般的なセキュリティの警告が出力されます。 すぐに、もしくはより詳細な解析が行われた後に、対応が可能です。</p></div><div class=paragraph><p>管理者は皆、 担当しているシステム上で何が実行されているかを把握している必要があります。 rkhunter, lsof や <a href="https://man.freebsd.org/cgi/man.cgi?query=netstat&amp;sektion=1&amp;format=html">netstat(1)</a> および <a href="https://man.freebsd.org/cgi/man.cgi?query=ps&amp;sektion=1&amp;format=html">ps(1)</a> といったネイティブのツールは、 システムに関するかなり多くの情報を与えてくれます。 正常な状態がどのような状態であるかを把握しておき、 本来と違う状況になった場合には、質問をしたり、 疑い深くなってください。 セキュリティが破られることを避けることは理想ですが、 破られたことを把握することは必須です。</p></div></div><div class=sect2><h3 id=security-ids>13.2.7. バイナリ検証<a class=anchor href=#security-ids></a></h3><div class=paragraph><p>システムファイルおよびバイナリの検証は、 システム管理者およびセキュリティチームに対して、 システムの変更に関する情報を提供してくれるため重要です。 いかなるシステムにおいても、システム管理チームの知らないところで、 内部のコマンドやアプリケーションは変更すべきではありません。 システムの変更ををモニタリングするソフトウェアアプリケーションは、 侵入検知システム (Intrusion Detection System) または IDS と呼ばれます。</p></div><div class=paragraph><p>FreeBSD は、基本的な IDS システムをネイティブで提供しています。 実際に、毎晩の <a href="https://man.freebsd.org/cgi/man.cgi?query=periodic&amp;sektion=8&amp;format=html">periodic(8)</a> セキュリティに関するメールの中では、 管理者に変更点を通知します。 情報はローカルに保存されているので、 悪意のあるユーザが変更し、情報を "欺く" 可能性があります。 そのため、バイナリの署名の別のセットを作成して、 読み取り専用の root 所有のディレクトリ、できれば、 USB ディスクまたは rsync サーバといったシステムとは別のシステムに保存してください。</p></div><div class=paragraph><p>まず最初に、シードを生成する必要があります。 これは、数値定数で、ハッシュ値の生成やハッシュ値の検証で使われます。 このシードがないと、 ファイルのチェックサムの値を偽ったり検証が可能になります。 以下の例では、シードは <code>-s</code> フラグで指定されています。 最初に以下のコマンドを用いて <span class=filename>/bin</span> のハッシュ値およびチェックサムを生成してください。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mtree -s 3483151339707503 -c -K cksum,sha256digest -p /bin &gt; bin_chksum_mtree</span></code></pre></div></div><div class=paragraph><p>このコマンドの出力は以下のようになります。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mtree: /bin checksum: 3427012225</span></code></pre></div></div><div class=paragraph><p><span class=filename>bin_cksum_mtree</span> ファイルを見ると、 以下のような出力となります。</p></div><div class="literalblock programlisting"><div class=content><pre>#          user: root
#       machine: dreadnaught
#          tree: /bin
#          date: Mon Feb  3 10:19:53 2014
# .
/set type=file uid=0 gid=0 mode=0555 nlink=1 flags=none
.               type=dir mode=0755 nlink=2 size=1024 \
                time=1380277977.000000000
    \133        nlink=2 size=11704 time=1380277977.000000000 \
                cksum=484492447 \
                sha256digest=6207490fbdb5ed1904441fbfa941279055c3e24d3a4049aeb45094596400662a
    cat         size=12096 time=1380277975.000000000 cksum=3909216944 \
                sha256digest=65ea347b9418760b247ab10244f47a7ca2a569c9836d77f074e7a306900c1e69
    chflags     size=8168 time=1380277975.000000000 cksum=3949425175 \
                sha256digest=c99eb6fc1c92cac335c08be004a0a5b4c24a0c0ef3712017b12c89a978b2dac3
    chio        size=18520 time=1380277975.000000000 cksum=2208263309 \
                sha256digest=ddf7c8cb92a58750a675328345560d8cc7fe14fb3ccd3690c34954cbe69fc964
    chmod       size=8640 time=1380277975.000000000 cksum=2214429708 \
                sha256digest=a435972263bf814ad8df082c0752aa2a7bdd8b74ff01431ccbd52ed1e490bbe7</pre></div></div><div class=paragraph><p>コンピュータのホスト名、現在の日付と時間、<a href="https://man.freebsd.org/cgi/man.cgi?query=mtree&amp;sektion=8&amp;format=html">mtree(8)</a> を実行したユーザの情報すべてがこのレポートには含まれています。 また、各バイナリに対するチェックサム、サイズ、タイムスタンプおよび SHA256 ダイジェストも含まれています。</p></div><div class=paragraph><p>バイナリ署名の検証のために、 以下のコマンドを実行すると、現在の署名のリストを読み込み、 結果を出力します。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mtree -s 3483151339707503 -p /bin &lt; bin_chksum_mtree &gt;&gt; bin_chksum_output</span></code></pre></div></div><div class=paragraph><p>このコマンドを実行すると、すでにチェックサムを生成している <span class=filename>/bin</span> に対して、同様のチェックサムを生成します。 このコマンドを実行してから変更が行われていないので、 <span class=filename>bin_chksum_output</span> への主力は空となります。 変更が行われた場合をシミュレートするために、 <span class=filename>/bin/cat</span> ファイルの日付を <a href="https://man.freebsd.org/cgi/man.cgi?query=touch&amp;sektion=1&amp;format=html">touch(1)</a> を使って変更して、 再度検証のコマンドを実行してみます。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># touch /bin/cat</span></code></pre></div></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mtree -s 3483151339707503 -p /bin &lt; bin_chksum_mtree &gt;&gt; bin_chksum_output</span></code></pre></div></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cat bin_chksum_output</span></code></pre></div></div><div class="literalblock programlisting"><div class=content><pre>cat changed
	modification time expected Fri Sep 27 06:32:55 2013 found Mon Feb  3 10:28:43 2014</pre></div></div><div class=paragraph><p><a class=package href=https://cgit.freebsd.org/ports/tree/security/aide/>security/aide</a> のような、 より高度な IDS システムもありますが、 ほとんどのケースにおいて、 <a href="https://man.freebsd.org/cgi/man.cgi?query=mtree&amp;sektion=8&amp;format=html">mtree(8)</a> は管理者が必要とする機能を提供します。 悪意のあるユーザが、 シード値およびチェックサムの出力を見れないようにすることが重要です。</p></div></div><div class=sect2><h3 id=security-tuning>13.2.8. セキュリティのためのシステムの調整<a class=anchor href=#security-tuning></a></h3><div class=paragraph><p>システムの機能の多くは、<a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a> を使って調整できます。 Denial of Service (DOS) スタイルの攻撃を避けるためのセキュリティ機能に対しても同様です。 この節では、より重要な調整についても触れています。 <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a> により、設定が変更された時はいつでも、 望まない危害が起こる可能性は高まり、 システムの可用性に影響します。 システム全体の設定を変更する時には、 システムの CIA を考える必要があります。</p></div><div class=paragraph><p>以下では、<a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a> の一覧、 および変更がシステムにどのように影響するかを説明します。</p></div><div class=paragraph><p>デフォルトでは、FreeBSD のカーネルはセキュリティレベル -1 で起動します。 このセキュリティレベルは、 変更不可のファイルフラグを外したり、 すべてのデバイスに対して読み込みおよび書き込みができたりするので、 "insecure mode" と呼ばれます。 このセキュアレベルは、管理者または <a href="https://man.freebsd.org/cgi/man.cgi?query=init&amp;sektion=8&amp;format=html">init(8)</a> による起動時のスクリプトにより変更されない限り -1 のままです。 <span class=filename>/etc/rc.conf</span> において、 <code>kern_securelevel_enable</code> を <code>YES</code> とし、 <code>kern_securelevel</code> に必要とする値を設定することで、 システム起動時にセキュアレベルを高めることができます。 これらの設定についてのより詳細な情報については、 <a href="https://man.freebsd.org/cgi/man.cgi?query=security&amp;sektion=7&amp;format=html">security(7)</a> および <a href="https://man.freebsd.org/cgi/man.cgi?query=init&amp;sektion=8&amp;format=html">init(8)</a> をご覧ください。</p></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p><code>securelevel</code> を大きくしすぎると、 Xorg が動かなくなったり、他の問題が起きる可能性があります。 デバッグの心づもりをしてください。</p></div></td></tr></tbody></table></div><div class=paragraph><p>つぎに変更を検討すべき <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a> は、 net.inet.tcp.blackhole および net.inet.udp.blackhole です。 これらを設定すると、閉じたポートに対して届く SYN パケットはドロップされ、 RST レスポンスを返しません。 通常は、RST を返し、 そのポートが閉じられていることを伝えます。 これにより、システムに対する "ステルス" スキャンに対し、ある程度の防御となります。 net.inet.tcp.blackhole を "2"、 net.inet.udp.blackhole を "1" に設定してください。 詳細な情報について <a href="https://man.freebsd.org/cgi/man.cgi?query=blackhole&amp;sektion=4&amp;format=html">blackhole(4)</a> をご覧ください。</p></div><div class=paragraph><p>さらに、net.inet.icmp.drop_redirect および net.inet.ip.redirect も設定すべきです。 これら 2 つの <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a> は、リダイレクト攻撃を防ぐ助けとなるでしょう。 リダイレクト攻撃は、 故意に通常のネットワークでは必要としないような大量の ICMP タイプ 5 のパケットを発生します。 そのため net.inet.icmp.drop_redirect を "1"、 net.inet.ip.redirect を "0" に設定して下さい。</p></div><div class=paragraph><p>ソースルーティングは、 内部ネットワーク上でルーティングできないアドレスを検出したりアクセスするための方法です。 通常ルーティングできないアドレスは、 意図してルーティングできないようにしているので、 この設定はおそらく無効にすべきです。 この機能を無効にするには、 net.inet.ip.sourceroute および net.inet.ip.accept_sourceroute を "0" に設定してください。</p></div><div class=paragraph><p>ブロードキャストアドレスに対するすべての ICMP エコーリクエストは、ドロップしてください。 ネットワーク上のコンピュータがサブネットにあるすべてのホストにメッセージを送る必要がある場合には、 メッセージはブロードキャストアドレスに送られます。 外部のホストについては、 このような送信をする必要はないので、 外部からブロードキャストへのリクエストをすべて拒否するように、 net.inet.icmp.bmcastecho を "0" に設定してください。</p></div><div class=paragraph><p>まだ多くの <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a> が <a href="https://man.freebsd.org/cgi/man.cgi?query=security&amp;sektion=7&amp;format=html">security(7)</a> で説明されています。 さらに多くの情報を調べることが推奨されます。</p></div></div></div></div><div class=sect1><h2 id=one-time-passwords>13.3. ワンタイムパスワード<a class=anchor href=#one-time-passwords></a></h2><div class=sectionbody><div class=paragraph><p>デフォルトで、FreeBSD は One-time Passwords In Everything (OPIE) に対応しています。 OPIE はデフォルトでは MD5 ハッシュを使用します。</p></div><div class=paragraph><p>三種類の異なる「パスワード」があります。 まず一つ目は、通常の UNIX® スタイル、もしくは Kerberos のパスワードです。 二つ目は、<a href="https://man.freebsd.org/cgi/man.cgi?query=opiekey&amp;sektion=1&amp;format=html">opiekey(1)</a> によって生成され、 <a href="https://man.freebsd.org/cgi/man.cgi?query=opiepasswd&amp;sektion=1&amp;format=html">opiepasswd(1)</a> およびログインプロンプトが受け付けるワンタイムパスワードです。 三つ目のパスワードは、<a href="https://man.freebsd.org/cgi/man.cgi?query=opiekey&amp;sektion=1&amp;format=html">opiekey(1)</a> と場合により <code>opiepasswd</code> に対してワンタイムパスワードを生成するのに使われる "秘密のパスワード" です。</p></div><div class=paragraph><p>秘密のパスワードは、UNIX® パスワードと何の関連性もありません。 両者を同一に設定することは可能ですが、お奨めしません。古い UNIX® パスワードは長さが 8 文字に制限されていました 。 これに対し、OPIE の秘密のパスワードには 8 文字の制限はありません。 6 語から 7 語からなるパスフレーズがふつうです。ほとんどの部分で、 OPIE システムは UNIX® のパスワードシステムと完全に独立して動作するようになっています。</p></div><div class=paragraph><p>パスフレーズに加え、OPIE システムにとって重要な 2 種類のデータがあります。一つは "シード (seed: 種)" または "キー (key: 鍵)" と呼ばれるもので、2 つの文字と 5 つの数字で構成されます。もう一つは "シーケンス番号 (iteration count)" で、1 から 100 までの整数です。 OPIE はここまでに述べたデータを利用してワンタイムパスワードを生成します。 その方法は、まずシードと秘密のパスフレーズを連結し、 それに対してシーケンス番号の回数だけ MD5 ハッシュを繰り返し計算します。 そしてその結果を 6 つの短い英単語に変換します。 この 6 つの英単語がワンタイムパスワードです。 認証システム (主は PAM) は、 前回最後に受け付けたワンタイムパスワードを記録しています。 そして、その前回のワンタイムパスワードと、 ユーザが入力したワンタイムパスワードを 1 回ハッシュ関数にかけた結果とが一致した場合に、 このユーザは認証されます。 一方向ハッシュ関数を使っているので、 もし正しく認証されたワンタイムパスワードが一回盗聴されたとしても、 次回以降に使われる複数のワンタイムパスワードを生成することは不可能です。 シーケンス番号はログインが成功するたびに一つずつ減らされて、 ユーザとログインプログラムの間で同期が取られます。 シーケンス番号が 1 まで減ったら、 OPIE を再度初期化する必要があります。</p></div><div class=paragraph><p>このプロセスに関連するいくつかのプログラムがあります。 <a href="https://man.freebsd.org/cgi/man.cgi?query=opiekey&amp;sektion=1&amp;format=html">opiekey(1)</a> は、シーケンス番号と、シードと、 秘密のパスフレーズを受け付けて、ワンタイムパスワード 1 つ、 または一連のワンタイムパスワードの一覧を生成します。 <a href="https://man.freebsd.org/cgi/man.cgi?query=opiepasswd&amp;sektion=1&amp;format=html">opiepasswd(1)</a> は、OPIE の初期化に加え、パスワード、 シーケンス番号やシードを変更するためにも使用されます。 このプログラムを実行するには、秘密のパスフレーズか、 または、シーケンス番号とシードとワンタイムパスワードの 1 組かの、どちらかを与えます。 <a href="https://man.freebsd.org/cgi/man.cgi?query=opieinfo&amp;sektion=1&amp;format=html">opieinfo(1)</a> は、 認証ファイル (<span class=filename>/etc/opiekeys</span>) を調べて、 プログラムを起動したユーザの現在のシーケンス番号とシードを表示します。</p></div><div class=paragraph><p>4 種類の異なる操作があります。 1 つ目は、<a href="https://man.freebsd.org/cgi/man.cgi?query=opiepasswd&amp;sektion=1&amp;format=html">opiepasswd(1)</a> を信頼できる通信路上で利用して、 最初にワンタイムパスワードを設定したり、 秘密のパスフレーズやシードを変更する操作です。 2 つ目は、同じことを行うために <a href="https://man.freebsd.org/cgi/man.cgi?query=opiepasswd&amp;sektion=1&amp;format=html">opiepasswd(1)</a> を信頼できない通信路上で利用する操作です。 この場合は信頼できる通信路経由の <a href="https://man.freebsd.org/cgi/man.cgi?query=opiekey&amp;sektion=1&amp;format=html">opiekey(1)</a> を併用します。3 つ目は、<a href="https://man.freebsd.org/cgi/man.cgi?query=opiekey&amp;sektion=1&amp;format=html">opiekey(1)</a> を使い、信頼できない通信路を通じてログインする操作です。 4 番目は、<a href="https://man.freebsd.org/cgi/man.cgi?query=opiekey&amp;sektion=1&amp;format=html">opiekey(1)</a> を使って複数のワンタイムパスワードを一気に生成する操作です。 ここで生成した複数のワンタイムパスワードは、 メモしたり印刷したりして携帯し、 信頼できる通信路が一切ないところからの接続に利用できます。 (訳注: ワンタイムパスワードを記録した紙をなくさないこと! 電話番号や IP アドレス、ユーザ名を一緒にメモしていたら最悪です!!)</p></div><div class=sect2><h3 id=_信頼できる通信路での初期化>13.3.1. 信頼できる通信路での初期化<a class=anchor href=#_信頼できる通信路での初期化></a></h3><div class=paragraph><p>OPIE を初めて初期化するには、 <a href="https://man.freebsd.org/cgi/man.cgi?query=opiepasswd&amp;sektion=1&amp;format=html">opiepasswd(1)</a> を実行してください。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% opiepasswd <span class=nt>-c</span>
<span class=o>[</span>grimreaper] ~ <span class=nv>$ </span>opiepasswd <span class=nt>-f</span> <span class=nt>-c</span>
Adding unfurl:
Only use this method from the console<span class=p>;</span> NEVER from remote. If you are using
telnet, xterm, or a dial-in, <span class=nb>type</span> ^C now or <span class=nb>exit </span>with no password.
Then run opiepasswd without the <span class=nt>-c</span> parameter.
Using MD5 to compute responses.
Enter new secret pass phrase:
Again new secret pass phrase:

ID unfurl OTP key is 499 to4268
MOS MALL GOAT ARM AVID COED</code></pre></div></div><div class=paragraph><p><code>Enter new secret pass phrase:</code> または <code>Enter secret password:</code> というプロンプトに対して、 パスワードまたはパスフレーズを入力してください。 このパスワードは、 ログインするときに使うワンタイムパスワードを生成するために使うものであり、 ログインのためのパスワードではありません。 "ID" から始まる行は、1 回分のパラメータで、 ログイン名とシーケンス番号とシードです。 ログインするときには、 システム側がこれらのパラメータを覚えていて表示してくれるので、 これらのパラメータを覚えておく必要はありません。 最後の行が、今述べたパラメータと入力された秘密のパスワードから計算されたワンタイムパスワードです。 次にログインするときに打ち込むべきワンタイムパスワードがこれです。</p></div></div><div class=sect2><h3 id=_信頼できない通信路での初期化>13.3.2. 信頼できない通信路での初期化<a class=anchor href=#_信頼できない通信路での初期化></a></h3><div class=paragraph><p>信頼できない通信路を使って秘密のパスフレーズを初期化または変更するためには、 <a href="https://man.freebsd.org/cgi/man.cgi?query=opiekey&amp;sektion=1&amp;format=html">opiekey(1)</a> を実行するための信頼できる通信路を用意しておく必要があります。 たとえばそれは、 信頼できるマシンのシェルプロンプトだったりするでしょう。 (訳注: ここでの通信路とはマシンそのものになります。 信頼できるマシンとは、 信頼できる人がしっかり管理しているマシンということです)。 他に準備しておくものとして、シーケンス番号 (100 は適切な値といえるでしょう) と、場合によっては自分で考えた、 またはランダムに生成されたシードがあります。 信頼できない通信路を使うときには、<a href="https://man.freebsd.org/cgi/man.cgi?query=opiepasswd&amp;sektion=1&amp;format=html">opiepasswd(1)</a> を使ってコンピュータを初期化してください。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% opiepasswd

Updating unfurl:
You need the response from an OTP generator.
Old secret pass phrase:
	otp-md5 498 to4268 ext
	Response: GAME GAG WELT OUT DOWN CHAT
New secret pass phrase:
	otp-md5 499 to4269
	Response: LINE PAP MILK NELL BUOY TROY

ID mark OTP key is 499 gr4269
LINE PAP MILK NELL BUOY TROY</code></pre></div></div><div class=paragraph><p>デフォルトのシードで構わなければ、<kbd>Return</kbd> を押してください。アクセスパスワードを入れる前に、 あらかじめ用意しておいた信頼できる通信路へ移って、 先ほどと同じパラメータを入力します。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% opiekey 498 to4268
Using the MD5 algorithm to compute response.
Reminder: Do not use opiekey from telnet or dial-in sessions.
Enter secret pass phrase:
GAME GAG WELT OUT DOWN CHAT</code></pre></div></div><div class=paragraph><p>信頼できない通信路の方に戻って、 生成されたワンタイムパスワードをコピーして対応するプログラムに入力します。</p></div></div><div class=sect2><h3 id=_ワンタイムパスワードを一つ生成する>13.3.3. ワンタイムパスワードを一つ生成する<a class=anchor href=#_ワンタイムパスワードを一つ生成する></a></h3><div class=paragraph><p>OPIE を初期化したら、 ログイン時には以下のようなプロンプトが出てくるでしょう。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% telnet example.com
Trying 10.0.0.1...
Connected to example.com
Escape character is <span class=s1>&#39;^]&#39;</span><span class=nb>.</span>

FreeBSD/i386 <span class=o>(</span>example.com<span class=o>)</span> <span class=o>(</span>ttypa<span class=o>)</span>

login: &lt;ユーザ名&gt;
otp-md5 498 gr4269 ext
Password:</code></pre></div></div><div class=paragraph><p>OPIE のプロンプトには便利な機能が備わっています。 パスワードプロンプトに対して、 <kbd>Return</kbd> を押すとエコーモードに切り替わり、 タイプした文字がそのまま見えるようになるのです。 これは、 紙に印刷していたりするワンタイムパスワードを手で入力しなければならない場合に役立つ機能です。</p></div><div class=paragraph><p>次に、 このログインプロンプトに対して入力するワンタイムパスワードを生成してください。 これは、<a href="https://man.freebsd.org/cgi/man.cgi?query=opiekey&amp;sektion=1&amp;format=html">opiekey(1)</a> プログラムを使える信頼できるマシン上で行わなければなりません。 このプログラムには Windows®, Mac OS® および FreeBSD 版があります。 どちらも、 コマンドラインからシーケンス番号とシードを指定しなければなりません。 ログインしようとしているマシンのログインプロンプトから直接カットアンドペーストすると楽でしょう。</p></div><div class=paragraph><p>信頼できるシステムで</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% opiekey 498 to4268
Using the MD5 algorithm to compute response.
Reminder: Do not use opiekey from telnet or dial-in sessions.
Enter secret pass phrase:
GAME GAG WELT OUT DOWN CHAT</code></pre></div></div><div class=paragraph><p>ワンタイムパスワードが生成されたので、 ログインを続けてください。</p></div></div><div class=sect2><h3 id=_複数のワンタイムパスワードを生成する>13.3.4. 複数のワンタイムパスワードを生成する<a class=anchor href=#_複数のワンタイムパスワードを生成する></a></h3><div class=paragraph><p>都合によっては、 信頼できるマシンや信頼できる通信路が一切確保できないようなことがあるでしょう。 このような場合には、<a href="https://man.freebsd.org/cgi/man.cgi?query=opiekey&amp;sektion=1&amp;format=html">opiekey(1)</a> を使って複数のワンタイムパスワードを生成できます。 たとえば</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% opiekey <span class=nt>-n</span> 5 30 zz99999
Using the MD5 algorithm to compute response.
Reminder: Do not use opiekey from telnet or dial-in sessions.
Enter secret pass phrase: &lt;secret password&gt;
26: JOAN BORE FOSS DES NAY QUIT
27: LATE BIAS SLAY FOLK MUCH TRIG
28: SALT TIN ANTI LOON NEAL USE
29: RIO ODIN GO BYE FURY TIC
30: GREW JIVE SAN GIRD BOIL PHI</code></pre></div></div><div class=paragraph><p><code>-n 5</code> という引数によって 5 個のワンタイムパスワードを順に生成します。 また <code>30</code> は、 最後のシーケンス番号となるべき数字です。出力は使う順番とは <em>逆</em> に出力されていることに注意してください (訳注: 一番最初に使うワンタイムパスワードは一番最後に出力されたものです)。 もしあなたがセキュリティに偏執するなら、 この結果を紙と鉛筆を使って手で書き移した方がよいかもしれません。 そうでなければ、この結果を印刷すると良いでしょう。 ここで、 出力の各行はシーケンス番号とそれに対応する一回分のワンタイムパスワードです。 消費済みのワンタイムパスワードをペンで消していってください。</p></div></div><div class=sect2><h3 id=_unix_パスワードの利用を制限する>13.3.5. UNIX® パスワードの利用を制限する<a class=anchor href=#_unix_パスワードの利用を制限する></a></h3><div class=paragraph><p>OPIE は、ログインセッションの IP アドレスをベースとした UNIX® パスワードの使用を制限できます。 関連ファイルは、<span class=filename>/etc/opieaccess</span> で、 デフォルトで用意されています。 このファイルの詳細や、 このファイルを使用する際に考慮すべきセキュリィについては <a href="https://man.freebsd.org/cgi/man.cgi?query=opieaccess&amp;sektion=5&amp;format=html">opieaccess(5)</a> を確認してください。</p></div><div class=paragraph><p>以下は <span class=filename>opieaccess</span> の例です。</p></div><div class="literalblock programlisting"><div class=content><pre>permit 192.168.0.0 255.255.0.0</pre></div></div><div class=paragraph><p>この行では、(なりすましされやすい) IP ソースアドレスが、 ある値やマスクにマッチするユーザに対して、 UNIX® パスワードをいつでも許可します。</p></div><div class=paragraph><p>もし <span class=filename>opieaccess</span> のどのルールにも一致しなければ、 デフォルトでは非 OPIE ログインは使えません。</p></div></div></div></div><div class=sect1><h2 id=tcpwrappers>13.4. TCP Wrappers<a class=anchor href=#tcpwrappers></a></h2><div class=sectionbody><div class=paragraph><p>TCP Wrappers は、 すべてのサーバデーモンに対するサポートをその管理下で提供できるように、 <a href=../advanced-networking/#network-inetd>「inetd 「スーパサーバ」」</a> の機能を拡張します。 この方法を使うことで、ログへの対応、 接続に対してメッセージを返したり、 内部の接続だけを許可するようにデーモンを設定することが可能となります。 これらの機能のいくつかはファイアウォールでも実装できますが、 TCP Wrappers は、 システムを守るためのレイヤを追加し、 ファイアウォールが提供する以上の管理機能を提供します。</p></div><div class=paragraph><p>TCP Wrappers は、 適切に設定されたファイアウォールの置き換えと考えるべきではありません。 TCP Wrappers は、 ファイアウォールや他のセキュリティ強化のツールと組み合わせて使うべきです。</p></div><div class=sect2><h3 id=_初期設定>13.4.1. 初期設定<a class=anchor href=#_初期設定></a></h3><div class=paragraph><p>FreeBSD 上で TCP Wrappers を有効にするには、 <span class=filename>rc.conf</span> から <code>-Ww</code> オプションで <a href="https://man.freebsd.org/cgi/man.cgi?query=inetd&amp;sektion=8&amp;format=html">inetd(8)</a> サーバが起動されることを確認してください。 その後、<span class=filename>/etc/hosts.allow</span> を適切に設定してください。</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>他の TCP Wrappers の実装と異なり、 <span class=filename>hosts.deny</span> は廃止されました。 すべての設定オプションは <span class=filename>/etc/hosts.allow</span> に書かれている必要があります。</p></div></td></tr></tbody></table></div><div class=paragraph><p>最も簡単な設定におけるデーモンの接続ポリシは、 <span class=filename>/etc/hosts.allow</span> の中で、 オプションごとに許可またはブロックするように設定するというものです。 FreeBSD のデフォルトの設定では、<a href="https://man.freebsd.org/cgi/man.cgi?query=inetd&amp;sektion=8&amp;format=html">inetd(8)</a> から起動されたすべてのデーモンの接続を許可します。</p></div><div class=paragraph><p>基本的な設定は、通常 <code>daemon : address : action</code> という形式です。ここで、 <code>daemon</code> は、 <a href="https://man.freebsd.org/cgi/man.cgi?query=inetd&amp;sektion=8&amp;format=html">inetd(8)</a> が起動するデーモンの名前です。 <code>address</code> の部分は、有効なホスト名、 IP アドレスまたは、 括弧 ([ ]) で囲まれた IPv6 アドレスです。 <code>action</code> は、 <code>allow</code> または <code>deny</code> です。 TCP Wrappers は、 最初にマッチしたルールが適用されます。 これは、設定ファイルに対するルールにマッチするかどうかのスキャンは、 昇順に行われることを意味しています。 マッチすると、ルールが適用され、 検索のプロセスは終了します。</p></div><div class=paragraph><p>例として、POP3 の接続を <a class=package href=https://cgit.freebsd.org/ports/tree/mail/qpopper/>mail/qpopper</a> デーモン経由で許可するには、以下の行を <span class=filename>hosts.allow</span> に追加してください。</p></div><div class="literalblock programlisting"><div class=content><pre># This line is required for POP3 connections:
qpopper : ALL : allow</pre></div></div><div class=paragraph><p>この行を追加したら、 <a href="https://man.freebsd.org/cgi/man.cgi?query=inetd&amp;sektion=8&amp;format=html">inetd(8)</a> を再起動してください。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service inetd restart</span></code></pre></div></div></div><div class=sect2><h3 id=_高度な設定>13.4.2. 高度な設定<a class=anchor href=#_高度な設定></a></h3><div class=paragraph><p>TCP Wrappers は、 接続を取り扱う以上の制御を行う高度な設定も提供しています。 ある時は、 接続しているホストまたはデーモンにコメントを返すことが適切であることがあります。 別の場合では、おそらくログエントリを記録したり、 管理者にメールで送る必要があることもあるでしょう。 またその他の状況としては、 サービスをローカルの接続のみの使用に制限する必要がある場合もあります。 これらはすべて、<code>ワイルドカード</code> と呼ばれる設定のオプション (拡張文字および外部コマンドの実行) で可能となります。</p></div><div class=sect3><h4 id=_外部コマンド>13.4.2.1. 外部コマンド<a class=anchor href=#_外部コマンド></a></h4><div class=paragraph><p>接続は拒否しなければならないが、 その理由を接続の確立を試みた相手に送りたい状況を考えてください。 このアクションは、<code>twist</code> を使うことで実現可能です。 接続が試みられると、<code>twist</code> はシェルコマンドまたはスクリプトを実行します。 この場合の例は、 <span class=filename>hosts.allow</span> に書かれています。</p></div><div class="literalblock programlisting"><div class=content><pre># The rest of the daemons are protected.
ALL : ALL \
	: severity auth.info \
	: twist /bin/echo &#34;You are not welcome to use %d from %h.&#34;</pre></div></div><div class=paragraph><p>この例では、 "You are not allowed to use <code>daemon</code> from <code>hostname</code>." というメッセージを、 アクセスファイルの中で設定されていないすべてのデーモンに対して返します。 接続元に対し、 確立された接続が破棄された直後に返答することは有効です。 返信に使われるメッセージは、引用符 (<code>"</code>) で囲む <em>必要</em> があります。</p></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>攻撃者や攻撃者のグループは、 これらのデーモンの接続のリクエストであふれさせることにより、 サーバに対して DoS 攻撃を仕掛けることができます。</p></div></td></tr></tbody></table></div><div class=paragraph><p>他の可能性は <code>spawn</code> を使うことです。 <code>twist</code> と同様に、 <code>spawn</code> は、暗黙のうちに接続を拒否し、 外部のシェルコマンドやスクリプトを実行できます。 <code>twist</code> と異なり、<code>spawn</code> は、 接続を確立した相手に対し、返事を返すことはありません。 たとえば、以下のような設定の行を考えてみてください。</p></div><div class="literalblock programlisting"><div class=content><pre># We do not allow connections from example.com:
ALL : .example.com \
	: spawn (/bin/echo %a from %h attempted to access %d &gt;&gt; \
	  /var/log/connections.log) \
	: deny</pre></div></div><div class=paragraph><p>この行は、<code>*.example.com</code> からの接続をすべて拒否します。 ホスト名、IP アドレスおよびアクセスを試みたデーモンが、 <span class=filename>/var/log/connections.log</span> に記録されます。</p></div><div class=paragraph><p>この例では、置換文字 <code>%a</code> および <code>%h</code> が使われています。 置換文字の完全な一覧は <a href="https://man.freebsd.org/cgi/man.cgi?query=hosts_access&amp;sektion=5&amp;format=html">hosts_access(5)</a> をご覧ください。</p></div></div><div class=sect3><h4 id=_ワイルドカードオプション>13.4.2.2. ワイルドカードオプション<a class=anchor href=#_ワイルドカードオプション></a></h4><div class=paragraph><p><code>ALL</code> オプションは、 デーモン、ドメインまたは IP アドレスのすべてのインスタンスのどれかにマッチするかどうかに使われます。 他のワイルドカードは、偽造された IP アドレスを提供するホストにマッチするかどうかに用いられる <code>PARANOID</code> です。 たとえば、<code>PARANOID</code> を使うことで、 ホスト名と異なる IP アドレスからの接続があった時のアクションを定義できます。 以下の例では、ホスト名から検索される IP アドレスと異なる IP アドレスを持つ <a href="https://man.freebsd.org/cgi/man.cgi?query=sendmail&amp;sektion=8&amp;format=html">sendmail(8)</a> への接続のすべてのリクエストを拒否します。</p></div><div class="literalblock programlisting"><div class=content><pre># Block possibly spoofed requests to sendmail:
sendmail : PARANOID : deny</pre></div></div><div class="admonitionblock caution"><table><tbody><tr><td class=icon><i class="fa icon-caution" title=Caution></i></td><td class=content><div class=paragraph><p>クライアントもしくはサーバの DNS の設定が間違っている場合に、 <code>PARANOID</code> ワイルドカードを使うと、 サーバがとても使いづらくなります。 管理者の慎重さが求められます。</p></div></td></tr></tbody></table></div><div class=paragraph><p>ワイルドカードおよび関連する機能についてもっと知りたい場合には、 <a href="https://man.freebsd.org/cgi/man.cgi?query=hosts_access&amp;sektion=5&amp;format=html">hosts_access(5)</a> をご覧ください。</p></div><div class=paragraph><p>上記の設定が動作するには、<span class=filename>hosts.allow</span> の中で、 最初の設定の行がコメントアウトされている必要があります。</p></div></div></div></div></div><div class=sect1><h2 id=kerberos5>13.5. Kerberos5<a class=anchor href=#kerberos5></a></h2><div class=sectionbody><div class=paragraph><p>Kerberos は、 サーバのサービスによってユーザが安全に認証を受けられるようにするための、 ネットワークの付加システムおよびプロトコルです。 Kerberos は、 身元確認プロキシシステムや、 信頼される第 3 者認証システムとも説明されます。 ユーザが Kerberos を使って認証を行った後は、 通信は暗号化され、 プライバシおよびデータの完全性を保証することができます。</p></div><div class=paragraph><p>Kerberos の唯一の機能は、 ネットワーク上のユーザの安全な認証を提供することです。 承認 (どのユーザが許可されているか) や監査 (ユーザがどのような作業を行っているか) の機能は提供しません。 Kerberos を使う際は、 承認および監査サービスを提供する他のセキュリティの手段との利用が、 推奨されます。</p></div><div class=paragraph><p>この節では、FreeBSD 用として配布されている Kerberos をセットアップする際のガイドを提供します。 完全な説明が必要な場合には、 マニュアルページを参照してください。</p></div><div class=paragraph><p>この節における Kerberos のインストールのデモでは、以下のような名前空間が使われます。</p></div><div class=ulist><ul><li><p>DNS ドメイン ("ゾーン") は、 <code>example.org</code> です。</p></li><li><p>Kerberos の領域は、 <code>EXAMPLE.ORG</code> です。</p></li></ul></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Kerberos の設定では、 内部での使用でも実際のドメイン名を使ってください。 DNS の問題を避けることができ、 他の Kerberos のレルム (realm) との相互運用を保証します。</p></div></td></tr></tbody></table></div><div class=sect2><h3 id=_歴史>13.5.1. 歴史<a class=anchor href=#_歴史></a></h3><div class=paragraph><p>Kerberos は、 ネットワークのセキュリティ問題を解決するために、 MIT で開発されました。 Kerberos プロトコルは、 必ずしも安全ではないインターネット接続においても、 サーバに対して (逆もまた同様に)、 強い暗号を使って身元を証明します。</p></div><div class=paragraph><p>Kerberos は、 ネットワーク認証プロトコルの名前であり、 Kerberos telnet のように、 このプログラムを実装しているプログラムを表すための形容詞でもあります。 プロトコルの現在のバージョンはバージョン 5 で、 RFC 1510 として文書化されています。</p></div><div class=paragraph><p>このプロトコルのいくつものフリーの実装が、 さまざまなオペレーティングシステムで利用できます。 最初の Kerberos を開発したマサチューセッツ工科大学 (MIT) は、 開発した Kerberos パッケージを継続的に保守しています。 アメリカ合衆国では暗号製品として良く使われていますが、 歴史的には、 アメリカ合衆国 の輸出規制により制限されてきました。 MIT で実装された Kerberos は、 <a class=package href=https://cgit.freebsd.org/ports/tree/security/krb5/>security/krb5</a> package または port から利用できます。 バージョン 5 のもう一つの実装が、 Heimdal Kerberos です。 この実装は、アメリカ合衆国の外で開発されたため、 輸出の制限を避けることができます。 Heimdal Kerberos は <a class=package href=https://cgit.freebsd.org/ports/tree/security/heimdal/>security/heimdal</a>> package または port からインストールできますが、最小構成は FreeBSD の base インストールに含まれています。</p></div><div class=paragraph><p>以下の説明では FreeBSD に含まれている Heimdal ディストリビューションの使用を想定しています。</p></div></div><div class=sect2><h3 id=_heimdal_kdc_の設定>13.5.2. Heimdal KDC の設定<a class=anchor href=#_heimdal_kdc_の設定></a></h3><div class=paragraph><p>鍵配布センター (KDC) は、 Kerberos が提供する中心的な認証サービスで、 Kerberos チケットを発行するコンピュータです。 KDC は、 Kerberos のレルムの中のすべてのコンピュータから "信頼"されています。 そのため、厳重なセキュリティに対する配慮が必要となります。</p></div><div class=paragraph><p>Kerberos サーバの実行にコンピュータのリソースはほとんど必要ありませんが、 セキュリティの観点から、KDC としてのみ機能する専用のコンピュータが推奨されます。</p></div><div class=paragraph><p>KDC を設定するにあたって、 KDC として動作するために、 適切に <span class=filename>/etc/rc.conf</span> が設定されていることを確認してください。 必要に応じて、 システムの設定を反映するようにパスを調整する必要があります。</p></div><div class="literalblock programlisting"><div class=content><pre>kerberos5_server_enable=&#34;YES&#34;
kadmind5_server_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>次に、<span class=filename>/etc/krb5.conf</span> を以下のように編集してください。</p></div><div class="literalblock programlisting"><div class=content><pre>[libdefaults]
    default_realm = EXAMPLE.ORG
[realms]
    EXAMPLE.ORG = {
        kdc = kerberos.example.org
        admin_server = kerberos.example.org
    }
[domain_realm]
    .example.org = EXAMPLE.ORG</pre></div></div><div class=paragraph><p><span class=filename>/etc/krb5.conf</span> の中で、 KDC は、 完全修飾されたホスト名 <code>kerberos.example.org</code> を使うことが想定されています。 KDC が異なるホスト名を持つ場合には、 名前の解決が行われるように、適切に CNAME (エイリアス) エントリをゾーンファイルに追加してください。</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>適切に DNS サーバが設定されている大きなネットワークでは、 上記の例は、以下のように整理されます。</p></div><div class="literalblock programlisting"><div class=content><pre>[libdefaults]
      default_realm = EXAMPLE.ORG</pre></div></div><div class=paragraph><p>そして、<code>example.org</code> ゾーンファイルには、以下の行が付け加えられます。</p></div><div class="literalblock programlisting"><div class=content><pre>_kerberos._udp      IN  SRV     01 00 88 kerberos.example.org.
_kerberos._tcp      IN  SRV     01 00 88 kerberos.example.org.
_kpasswd._udp       IN  SRV     01 00 464 kerberos.example.org.
_kerberos-adm._tcp  IN  SRV     01 00 749 kerberos.example.org.
_kerberos           IN  TXT     EXAMPLE.ORG</pre></div></div></td></tr></tbody></table></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>クライアントが、 Kerberos サービスを見つけるためには、 <span class=filename>/etc/krb5.conf</span> を完全に設定するか、 <span class=filename>/etc/krb5.conf</span> を最低限に設定し、 <em>さらに</em> DNS サーバを適切に設定する <em>必要</em> があります。</p></div></td></tr></tbody></table></div><div class=paragraph><p>次に Kerberos データベースを作成してください。 このデータベースには、 マスター鍵により暗号化されたすべてのプリンシパルの鍵が含まれています。 このパスワードは、 <span class=filename>/var/heimdal/m-key</span> に保存されるため、 覚える必要はありません。 マスター鍵を作成するには、<a href="https://man.freebsd.org/cgi/man.cgi?query=kstash&amp;sektion=8&amp;format=html">kstash(8)</a> を実行して、 パスワードを入力してください。</p></div><div class=paragraph><p>マスター鍵を作成したら、<code>kadmin -l</code> を使ってデータベースを初期化してください。 このオプションを使うと、<a href="https://man.freebsd.org/cgi/man.cgi?query=kadmin&amp;sektion=8&amp;format=html">kadmin(8)</a> は、 <a href="https://man.freebsd.org/cgi/man.cgi?query=kadmind&amp;sektion=8&amp;format=html">kadmind(8)</a> ネットワークサービスを使わず、 ローカルのデータベースファイルを直接変更します。 これにより、 データベースを作成する前に、データベースへの接続を試みてしまうという、 卵が先か鶏が先かという問題を回避できます。 <a href="https://man.freebsd.org/cgi/man.cgi?query=kadmin&amp;sektion=8&amp;format=html">kadmin(8)</a> プロンプトで、 <code>init</code> を使って、 レルムに関する初期のデータベースを作成してください。</p></div><div class=paragraph><p>最後に、<a href="https://man.freebsd.org/cgi/man.cgi?query=kadmin&amp;sektion=8&amp;format=html">kadmin(8)</a> プロンプトで <code>add</code> を使って最初のプリンシパルを作成して下さい。 差し当たりは、 プリンシパルに対するデフォルトのオプションに従ってください。 後で <code>modify</code> を使うことで、 変更することができます。 <a href="https://man.freebsd.org/cgi/man.cgi?query=kadmin&amp;sektion=8&amp;format=html">kadmin(8)</a> プロンプトで <code>?</code> と入力すると、 利用可能なオプションを確認できます。</p></div><div class=paragraph><p>データベース作成のセッションの例は以下のようになります。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># kstash</span>
Master key: xxxxxxxx
Verifying password - Master key: xxxxxxxx

<span class=c># kadmin -l</span>
kadmin&gt; init EXAMPLE.ORG
Realm max ticket life <span class=o>[</span>unlimited]:
kadmin&gt; add tillman
Max ticket life <span class=o>[</span>unlimited]:
Max renewable life <span class=o>[</span>unlimited]:
Attributes <span class=o>[]</span>:
Password: xxxxxxxx
Verifying password - Password: xxxxxxxx</code></pre></div></div><div class=paragraph><p>次に KDC サービスを起動してください。 <code>service kerberos start</code> および <code>service kadmind start</code> を実行してサービスを起動してください。 この時点で、kerberos 化されたデーモンが走っていなくても、 KDC のコマンドラインから、作成したばかりの (ユーザ) プリンシパルのチケットを入手したり、 一覧を表示することができることを確認できます。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% kinit tillman
tillman@EXAMPLE.ORG<span class=s1>&#39;s Password:

% klist
Credentials cache: FILE:/tmp/krb5cc_500
	Principal: tillman@EXAMPLE.ORG

  Issued           Expires          Principal
Aug 27 15:37:58  Aug 28 01:37:58  krbtgt/EXAMPLE.ORG@EXAMPLE.ORG</span></code></pre></div></div><div class=paragraph><p>必要がなくなった時には、チケットを破棄できます。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% kdestroy</code></pre></div></div></div><div class=sect2><h3 id=_heimdal_kerberos_サービスを有効にする>13.5.3. Heimdal Kerberos サービスを有効にする。<a class=anchor href=#_heimdal_kerberos_サービスを有効にする></a></h3><div class=paragraph><p>最初に <span class=filename>/etc/krb5.conf</span> を KDC からクライアントコンピュータへ、 <a href="https://man.freebsd.org/cgi/man.cgi?query=scp&amp;sektion=1&amp;format=html">scp(1)</a> または物理的にリムーバブルディスクを使うといった安全な方法でコピーしてください。</p></div><div class=paragraph><p>次に <span class=filename>/etc/krb5.keytab</span> を作成してください。 これが Kerberos 化されたデーモンを提供するサーバとワークステーションの間での大きな違いです: サーバには <span class=filename>keytab</span> が置かれている必要があります。 このファイルには、サーバのホスト鍵が含まれています。 この鍵により、ホストおよび KDC が他の身元の検証ができます。 鍵が公開されてしまうと、 サーバのセキュリティが破られてしまうため、 このファイルは安全にサーバに転送しなければなりません。</p></div><div class=paragraph><p>一般的には、<a href="https://man.freebsd.org/cgi/man.cgi?query=kadmin&amp;sektion=8&amp;format=html">kadmin(8)</a> を使って、 <span class=filename>keytab</span> をサーバに転送します。 ホストプリンシパル (KDC 側の <span class=filename>krb5.keytab</span>) も <a href="https://man.freebsd.org/cgi/man.cgi?query=kadmin&amp;sektion=8&amp;format=html">kadmin(8)</a> を使って作成するので便利です。</p></div><div class=paragraph><p>すでにチケットを入手し、そのチケットは、 <a href="https://man.freebsd.org/cgi/man.cgi?query=kadmin&amp;sektion=8&amp;format=html">kadmin(8)</a> インタフェースで使用できることが <span class=filename>kadmind.acl</span> で許可されている必要があります。 アクセスコントロールリストの設計の詳細については、 <code>info heimdal</code> の "Remote administration" というタイトルの章をご覧ください。 リモートからの <code>kadmin</code> アクセスを有効にする代わりに、 管理者は、ローカルコンソールまたは <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;format=html">ssh(1)</a> を用いて安全に KDC に接続し、 <code>kadmin -l</code> を使用して、 ローカルで管理作業を行うことができます。</p></div><div class=paragraph><p><span class=filename>/etc/krb5.conf</span> をインストールしたら、 Kerberos サーバから <code>add --random-key</code> を使ってください。 このコマンドは、サーバのホストプリンシパルを追加します。 そして、<code>ext</code> を用いて、 サーバのホストプリンシパルを keytab に抽出してください。 以下は、使用例です。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># kadmin</span>

kadmin&gt; add <span class=nt>--random-key</span> host/myserver.example.org
Max ticket life <span class=o>[</span>unlimited]:
Max renewable life <span class=o>[</span>unlimited]:
Attributes <span class=o>[]</span>:
kadmin&gt; ext host/myserver.example.org
kadmin&gt; <span class=nb>exit</span></code></pre></div></div><div class=paragraph><p><code>ext</code> は、デフォルトでは、抽出された鍵を <span class=filename>/etc/krb5.keytab</span> に保存します。</p></div><div class=paragraph><p>KDC 上で <a href="https://man.freebsd.org/cgi/man.cgi?query=kadmind&amp;sektion=8&amp;format=html">kadmind(8)</a> を走らせていない場合で、 リモートから <a href="https://man.freebsd.org/cgi/man.cgi?query=kadmin&amp;sektion=8&amp;format=html">kadmin(8)</a> に接続出来ない場合には、 ホストプリンシパル (<code>host/myserver.EXAMPLE.ORG</code>) を直接 KDC 上で追加し、 その後、以下のように KDC 上の <span class=filename>/etc/krb5.keytab</span> の上書きを避けるため、 一時ファイルに抽出してください。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># kadmin</span>
kadmin&gt; ext <span class=nt>--keytab</span><span class=o>=</span>/tmp/example.keytab host/myserver.example.org
kadmin&gt; <span class=nb>exit</span></code></pre></div></div><div class=paragraph><p>その後、<a href="https://man.freebsd.org/cgi/man.cgi?query=scp&amp;sektion=1&amp;format=html">scp(1)</a> またはリムーバブルディスクを使って、 keytab を安全にサーバコンピュータにコピーしてください。 KDC 上の keytab を上書きすることを避けるため、 デフォルトとは異なる名前を指定してください。</p></div><div class=paragraph><p>これでサーバは、 <span class=filename>krb5.conf</span> を使って KDC と通信ができるようになりました。 そして、<span class=filename>krb5.keytab</span> によって身元を証明できるようになったので、 Kerberos サービスを有効にする準備が出来ました。 この例では、 <a href="https://man.freebsd.org/cgi/man.cgi?query=telnetd&amp;sektion=8&amp;format=html">telnetd(8)</a> サービスが <span class=filename>/etc/inetd.conf</span> で有効に設定され、 <code>service inetd restart</code> によって、 <a href="https://man.freebsd.org/cgi/man.cgi?query=inetd&amp;sektion=8&amp;format=html">inetd(8)</a> サービスを再起動します。</p></div><div class="literalblock programlisting"><div class=content><pre>telnet    stream  tcp     nowait  root    /usr/libexec/telnetd  telnetd -a user</pre></div></div><div class=paragraph><p>重要な変更箇所は、<code>-a</code> 認証がユーザに設定されていることです。 詳細については、 <a href="https://man.freebsd.org/cgi/man.cgi?query=telnetd&amp;sektion=8&amp;format=html">telnetd(8)</a> を参照してください。</p></div></div><div class=sect2><h3 id=_heimdal_kerberos_クライアントを有効にする>13.5.4. Heimdal Kerberos クライアントを有効にする<a class=anchor href=#_heimdal_kerberos_クライアントを有効にする></a></h3><div class=paragraph><p>クライアントコンピュータの設定は簡単です。 <span class=filename>/etc/krb5.conf</span> のみが必要です。 このファイルをセキュリティ的に安全な方法で、KDC からクライアントコンピュータへコピーしてください。</p></div><div class=paragraph><p>クライアントから、<a href="https://man.freebsd.org/cgi/man.cgi?query=kinit&amp;sektion=1&amp;format=html">kinit(1)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=klist&amp;sektion=1&amp;format=html">klist(1)</a> および <a href="https://man.freebsd.org/cgi/man.cgi?query=kdestroy&amp;sektion=1&amp;format=html">kdestroy(1)</a> を使用し、 上記で作成したプリンシパルに対するチケットの入手、表示、 削除を行い、クライアントコンピュータを試験してください。 Kerberos アプリケーションを使って Kerberos が有効なサーバに接続することもできるはずです。 もしうまく機能しない場合でも、チケットを入手できるのであれば、 問題はおそらくサーバにあり、 クライアントまたは KDC の問題ではないと考えられます。</p></div><div class=paragraph><p>Kerberos 化されたアプリケーションを試験する際には、 <a href="https://man.freebsd.org/cgi/man.cgi?query=tcpdump&amp;sektion=1&amp;format=html">tcpdump(1)</a> といったパケットスニファを使用して、 パスワードが平文で送られていないことを確認してください。</p></div><div class=paragraph><p>コア以外の さまざまな Kerberos クライアントアプリケーションが利用可能です。 FreeBSD の "最小" インストールでは、 インストールされる Kerberos 化された唯一のサービスは、<a href="https://man.freebsd.org/cgi/man.cgi?query=telnetd&amp;sektion=8&amp;format=html">telnetd(8)</a> です。</p></div><div class=paragraph><p>Heimdal port は、 Kerberos 化されている <a href="https://man.freebsd.org/cgi/man.cgi?query=ftpd&amp;sektion=8&amp;format=html">ftpd(8)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=rshd&amp;sektion=8&amp;format=html">rshd(8)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=rcp&amp;sektion=1&amp;format=html">rcp(1)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=rlogind&amp;sektion=8&amp;format=html">rlogind(8)</a> および他のあまり一般的ではないプログラムをインストールします。 MIT port も、すべての Kerberos クライアントアプリケーションをインストールします。</p></div></div><div class=sect2><h3 id=_ユーザ設定ファイル_k5login_および_k5users>13.5.5. ユーザ設定ファイル: <span class=filename>.k5login</span> および <span class=filename>.k5users</span><a class=anchor href=#_ユーザ設定ファイル_k5login_および_k5users></a></h3><div class=paragraph><p>レルムのユーザは、一般的には、 ローカルユーザアカウントに対応する Kerberos プリンシパルを持ちます。 しかしながら、時々 Kerberos プリンシパルに対応しないローカルユーザアカウントへのアクセスが必要となることがあります。 たとえば、 <code>tillman@EXAMPLE.ORG</code> が、ローカルユーザアカウント <code>webdevelopers</code> へのアクセスが必要となることがあります。そして、 他のプリンシパルが同じローカルアカウントにアクセスが必要になることもあります。</p></div><div class=paragraph><p>ユーザのホームディレクトリに置かれた <span class=filename>.k5login</span> および <span class=filename>.k5users</span> ファイルを使うことで、 この問題を解決出来ます。 たとえば、以下の行を含む <span class=filename>.k5login</span> を <code>webdevelopers</code> のホームディレクトリに置くと、 一覧にある両方のプリンシパルは、 共有のパスワードを必要としなくても、 このアカウントにアクセス出来ます。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>tillman@example.org
jdoe@example.org</code></pre></div></div><div class=paragraph><p><span class=filename>.k5users</span> の詳細については、 <a href="https://man.freebsd.org/cgi/man.cgi?query=ksu&amp;sektion=1&amp;format=html">ksu(1)</a> を参照してください。</p></div></div><div class=sect2><h3 id=_kerberos_tips_tricks_およびトラブルシューティング>13.5.6. Kerberos Tips, Tricks, およびトラブルシューティング<a class=anchor href=#_kerberos_tips_tricks_およびトラブルシューティング></a></h3><div class=ulist><ul><li><p>Heimdal または MITKerberos ports のどちらを使う場合でも、 <code>PATH</code> は、 Kerberos 版のクライアント アプリケーションが、 システムにあるアプリケーションより先に見つかるように設定されていることを確認してください。</p></li><li><p>レルムにあるすべてのコンピュータの間で時刻が同期していないと、 認証に失敗してしまいます。 NTP を用いた、時刻の同期方法については、 <a href=../advanced-networking/#network-ntp>「NTP」</a> をご覧ください。</p></li><li><p>MIT および Heimdal 間の運用は、 標準化されていない <a href="https://man.freebsd.org/cgi/man.cgi?query=kadmin&amp;sektion=8&amp;format=html">kadmin(8)</a> を除けばうまく機能します。</p></li><li><p>ホスト名が変更された場合は、 <code>host/</code> プリンシパルを変更し、keytab をアップデートする必要があります。 Apache の <a class=package href=https://cgit.freebsd.org/ports/tree/www/mod_auth_kerb/>www/mod_auth_kerb</a> で使われる <code>www/</code> プリンシパルのような特別な keytab エントリでも必要となります。</p></li><li><p>レルムの中のすべてのホストは、DNS、 もしくは、最低限 <span class=filename>/etc/hosts</span> において正引きおよび逆引き両方で名前解決できる必要があります。 CNAME は動作しますが、A および PTR レコードは、 正しく適切な位置に記述されている必要があります。 名前が解決できない場合のエラーメッセージは、 次の例のように、直感的に原因が分かるようなものではありません。 <code>Kerberos5 refuses authentication because Read req failed: Key table entry not found</code>.</p></li><li><p>KDC に対しクライアントとして振る舞うオペレーティングシステムの中には、 <a href="https://man.freebsd.org/cgi/man.cgi?query=ksu&amp;sektion=1&amp;format=html">ksu(1)</a> に対して、 <code>root</code> 権限に setuid を許可しないものがあります。 この設定では、 <a href="https://man.freebsd.org/cgi/man.cgi?query=ksu&amp;sektion=1&amp;format=html">ksu(1)</a> は動作しないことを意味します。 これは KDC のエラーではありません。</p></li><li><p>MITKerberos において、 プリンシパルが、デフォルトの 10 時間を超えるチケットの有効期限としたい場合には、 <a href="https://man.freebsd.org/cgi/man.cgi?query=kadmin&amp;sektion=8&amp;format=html">kadmin(8)</a> のプロンプトで <code>modify_principal</code> を使って、 対象のプリンシパルおよび <code>krbtgt</code> プリンシパル両方の有効期限の最大値を変更してください。 プリンシパルは、 <code>kinit -l</code> を使用して、 長い有効期限のチケットを要求できます。
*</p></li></ul></div><div class=exampleblock><div class=content><div class=paragraph><p>トラブルシューティングのために、 KDC でパケットスニファを走らせ、 一方で、ワークステーションにおいて <a href="https://man.freebsd.org/cgi/man.cgi?query=kinit&amp;sektion=1&amp;format=html">kinit(1)</a> を実行すると、 <a href="https://man.freebsd.org/cgi/man.cgi?query=kinit&amp;sektion=1&amp;format=html">kinit(1)</a> を実行するやいなや、 パスワードを入力し終わる前でも、 Ticket Granting Ticket (TGT) が送られてきます。 これに関する説明は、以下の通りです。 Kerberos サーバは、 いかなる未承認のリクエストに対して、 自由に TGT を送信します。 しかしながら、すべての TGT は、 ユーザのパスワードから生成された鍵により、暗号化されています。 そのため、ユーザがパスワードを入力した時には、 パスワードは KDC には送られません。 その代わりこのパスワードは、<a href="https://man.freebsd.org/cgi/man.cgi?query=kinit&amp;sektion=1&amp;format=html">kinit(1)</a> がすでに入手した TGT の復号化に使われます。 もし、復号化の結果、 有効なチケットで有効なタイムスタンプの場合には、 ユーザは、有効な Kerberos クレデンシャルを持ちます。 このクレデンシャルには、 Kerberos サーバ自身の鍵により暗号化された実際の TGT とともに、将来 Kerberos サーバと安全な通信を確立するためのセッション鍵が含まれています。 この暗号の 2 番目のレイヤは、 Kerberos サーバが、 各 TGT の真偽の検証を可能にしている部分です。</p></div></div></div><div class=ulist><ul><li><p>たとえば一週間といった長い有効期限のチケットを使いたい場合で、 OpenSSH を使って、 チケットが保存されているコンピュータに接続しようとする場合は、 Kerberos <code>TicketCleanup</code> が <span class=filename>sshd_config</span> において <code>no</code> と設定されているか、 チケットが、ログアウト時に削除されることを確認してください。</p></li><li><p>ホストプリンシパルは長い有効期限のチケットを持つことができます。 もし、ユーザプリンシパルが 1 週間の有効期限を持ち、 接続しているホストが、9 時間の有効期限を持っている場合には、 ユーザキャッシュは有効期限が切れたホストプリンシパルを持つことになり、 想定したように、 チケットキャッシュが振る舞わないことが起こりえます。</p></li><li><p><a href="https://man.freebsd.org/cgi/man.cgi?query=kadmind&amp;sektion=8&amp;format=html">kadmind(8)</a> で説明されているような、 特定の問題のあるパスワードが使われることを避けるために <span class=filename>krb5.dict</span> を設定する時には、 パスワードポリシが割り当てられたプリンシパルにのみ適用されることを覚えていてください。 <span class=filename>krb5.dict</span> で使われている形式では、 一行に一つの文字列が置かれています。 <span class=filename>/usr/share/dict/words</span> にシンボリックリンクを作成することは、有効です。</p></li></ul></div></div><div class=sect2><h3 id=_mit_port_との違いについて>13.5.7. MIT port との違いについて<a class=anchor href=#_mit_port_との違いについて></a></h3><div class=paragraph><p>MIT と Heimdal 版の大きな違いは、 <a href="https://man.freebsd.org/cgi/man.cgi?query=kadmin&amp;sektion=8&amp;format=html">kadmin(8)</a> に関連しています。 このプログラムは、異なる (ただし等価な) コマンド群を持ち、そして、 異なるプロトコルを使用します。 もし KDC に MIT を使用している場合には、 Heimdal 版の <a href="https://man.freebsd.org/cgi/man.cgi?query=kadmin&amp;sektion=8&amp;format=html">kadmin(8)</a> を使って KDC をリモートから (逆も同様に) 管理できないことを意味しています。</p></div><div class=paragraph><p>クライアントアプリケーションでは、同じタスクを行う際に、 若干異なるコマンドラインのオプションが使われることもあります。 MIT Kerberos <a href=http://web.mit.edu/Kerberos/www/>ウェブサイト</a> に書かれているガイドに従うことが推奨されます。 path の問題について注意してください。 MIT port はデフォルトで <span class=filename>/usr/local/</span> にインストールします。 そのため、もし <code>PATH</code> においてシステムのディレクトが最初に書かれている場合には、 MIT 版ではなく、"通常の" システムアプリケーションが起動してしまいます。</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>FreeBSD の MIT<a class=package href=https://cgit.freebsd.org/ports/tree/security/krb5/>security/krb5</a> port において、 <a href="https://man.freebsd.org/cgi/man.cgi?query=telnetd&amp;sektion=8&amp;format=html">telnetd(8)</a> および <code>klogind</code> 経由でのログインが奇妙な振る舞いをすることを理解するには、 port からインストールされる <span class=filename>/usr/local/share/doc/krb5/README.FreeBSD</span> を読んで下さい。 "incorrect permissions on cache file" の振る舞いを修正するには、 フォワードされたクレデンシャリングの所有権を適切に変更できるように、 <code>login.krb5</code> バイナリが認証に使われる必要があります。</p></div></td></tr></tbody></table></div><div class=paragraph><p><span class=filename>rc.conf</span> を以下のように変更する必要もあります。</p></div><div class="literalblock programlisting"><div class=content><pre>kerberos5_server=&#34;/usr/local/sbin/krb5kdc&#34;
kadmind5_server=&#34;/usr/local/sbin/kadmind&#34;
kerberos5_server_flags=&#34;&#34;
kerberos5_server_enable=&#34;YES&#34;
kadmind5_server_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>これを行うのは、 MIT Kerberos のアプリケーションは、 <span class=filename>/usr/local</span> 構造の下にインストールされるためです。</p></div></div><div class=sect2><h3 id=_kerberos_で見つかった制限を緩和する>13.5.8. Kerberos で見つかった制限を緩和する<a class=anchor href=#_kerberos_で見つかった制限を緩和する></a></h3><div class=sect3><h4 id=_kerberos_はall_or_nothing_アプローチです>13.5.8.1. Kerberos は、All or Nothing アプローチです。<a class=anchor href=#_kerberos_はall_or_nothing_アプローチです></a></h4><div class=paragraph><p>ネットワーク上で有効なすべてのサービスは、 Kerberos 化されるか、 または、ネットワーク攻撃に対して安全であるべきです。 さもないと、ユーザのクレデンシャルが盗まれ、 利用されることが起きるかもしれません。 この例は、 Kerberos 化されたすべてのリモートシェルです。 パスワードを平文で送るような POP3 メールサーバは変換していません。</p></div></div><div class=sect3><h4 id=_kerberos_は_シングルユーザのワークステーションでの使用を想定しています>13.5.8.2. Kerberos は、 シングルユーザのワークステーションでの使用を想定しています。<a class=anchor href=#_kerberos_は_シングルユーザのワークステーションでの使用を想定しています></a></h4><div class=paragraph><p>マルチユーザの環境では、 Kerberos は安全ではありません。 チケットは <span class=filename>/tmp</span> に保管され、 このチケットは、すべてのユーザが読むことができるためです。 もし、ユーザがコンピュータを他のユーザと同時に共有していると、 他のユーザは、そのユーザのチケットを盗んだり、 コピーが出来てしまいます。</p></div><div class=paragraph><p>この問題は、<code>-c</code> コマンドラインオプションまたは、好ましくは <code>KRB5CCNAME</code> 環境変数によって克服されます。 この問題への対応には、 チケットをユーザのホームディレクトリに保存し、 ファイルの許可属性を設定することが一般的に行われます。</p></div></div><div class=sect3><h4 id=_kdc_は単一障害点である>13.5.8.3. KDC は、単一障害点である<a class=anchor href=#_kdc_は単一障害点である></a></h4><div class=paragraph><p>設計上、KDC は、 マスターパスワードのデータベースと同様に安全である必要があります。 KDC では、 絶対に他のサービスを走らせるべきではありませんし、 物理的に安全であるべきです。 Kerberos は、 KDC 上で、ファイルとして保存されている同じ "マスター" 鍵で暗号化されたすべてのパスワードを保存しているので、 非常に危険です。</p></div><div class=paragraph><p>マスター鍵が漏洩しても、 懸念するほど悪いことにはなりません。 マスター鍵は、Kerberos データベースの暗号時にのみ、 乱数を生成するためのシードとして使われます。 KDC へのアクセスが安全である限りにおいては、 マスター鍵を用いて、それほど多くのことはできません。</p></div><div class=paragraph><p>さらに、KDC が利用できないと、 認証ができないため、ネットワークサービスを利用できなくなります。 この攻撃による被害は、 ひとつのマスタ KDC とひとつまたはそれ以上のスレーブ、 そして、セカンダリもしくは PAM を用いたフォールバック認証を注意深く実装することにより軽減できます。</p></div></div><div class=sect3><h4 id=_kerberos_の欠点>13.5.8.4. Kerberos の欠点<a class=anchor href=#_kerberos_の欠点></a></h4><div class=paragraph><p>Kerberos は、 ユーザ、ホストおよびサービスの間での認証を可能にしますが、 KDC とユーザ、 ホストまたはサービスとの間の認証のメカニズムは提供しません。 これは、トロイの木馬の <a href="https://man.freebsd.org/cgi/man.cgi?query=kinit&amp;sektion=1&amp;format=html">kinit(1)</a> が、 すべてのユーザ名とパスワードを記録できることを意味しています。 <a class=package href=https://cgit.freebsd.org/ports/tree/security/tripwire/>security/tripwire</a> のような、ファイルシステムの完全性を確認するためのツールにより、 この危険性を軽減することができます。</p></div></div></div><div class=sect2><h3 id=_kerberos_および_ssh1_を用いたアクセスの問題>13.5.9. Kerberos および <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;format=html">ssh(1)</a> を用いたアクセスの問題<a class=anchor href=#_kerberos_および_ssh1_を用いたアクセスの問題></a></h3><div class=paragraph><p>Kerberos と <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;format=html">ssh(1)</a> を使う場合には、 両者に関して知っておかねばならない問題がいくつかあります。 Kerberos は大変優れた認証プロトコルですが、Kerberos 化された <a href="https://man.freebsd.org/cgi/man.cgi?query=telnet&amp;sektion=1&amp;format=html">telnet(1)</a> および <a href="https://man.freebsd.org/cgi/man.cgi?query=rlogin&amp;sektion=1&amp;format=html">rlogin(1)</a> には、 バイナリストリームを扱うのに不向きになるようなバグがあります。 デフォルトでは、Kerberos は <code>-x</code> を使わない限りセッションを暗号化してくれません。 一方 <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;format=html">ssh(1)</a> では、 デフォルトですべてを暗号化してくれます。</p></div><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;format=html">ssh(1)</a> はとても良く動作しますが、 デフォルトで暗号鍵を転送してしまいます。 このため、<a href="https://man.freebsd.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;format=html">ssh(1)</a> を安全なワークステーションから、 安全でないマシンへのアクセスに使っているユーザに、 セキュリティリスクを引き起こします。 鍵そのものが見えてしまうわけではありませんが、 <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;format=html">ssh(1)</a> は login している間、転送用ポートを作ります。 攻撃者が安全でないマシンの <code>root</code> を破ったら、 このポートを使って、 この暗号鍵でロックが外れる他のマシンへのアクセスを得てしまいます。</p></div><div class=paragraph><p>可能な時はいつでも、スタッフのログインには Kerberos を組み合せた <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;format=html">ssh(1)</a> を使用することを勧めます。 <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;format=html">ssh(1)</a> は、Kerberos 対応機能と一緒にコンパイルできます。 このようにすることで、見えてしまう可能性のある SSH 鍵への依存を減らし、 一方で、Kerberos 経由によりパスワードが保護されます。 鍵は、安全なマシンからの自動化されたタスクのみに使用すべきです。 Kerberos はこの用途には不向きです。 また、SSH の設定で鍵転送をしないようにするか、 あるいは <span class=filename>authorized_keys</span> の <code>from=IP/DOMAIN</code> を使用して、 特定のマシンからログインしてきたときのみ鍵が有効にすることをお勧めします。</p></div></div><div class=sect2><h3 id=_リソースおよび他の情報源>13.5.10. リソースおよび他の情報源<a class=anchor href=#_リソースおよび他の情報源></a></h3><div class=ulist><ul><li><p><a href=http://www.faqs.org/faqs/Kerberos-faq/general/preamble.html>The Kerberos FAQ</a></p></li><li><p><a href=http://web.mit.edu/Kerberos/www/dialogue.html>Designing an Authentication System: a Dialog in Four Scenes</a></p></li><li><p><a href="http://www.ietf.org/rfc/rfc1510.txt?number=1510">RFC 1510, The Kerberos Network Authentication Service (V5)</a></p></li><li><p><a href=http://web.mit.edu/Kerberos/www/>MIT Kerberos home page</a></p></li><li><p><a href=http://www.pdc.kth.se/heimdal/>Heimdal Kerberos home page</a></p></li></ul></div></div></div></div><div class=sect1><h2 id=openssl>13.6. OpenSSL<a class=anchor href=#openssl></a></h2><div class=sectionbody><div class=paragraph><p>FreeBSD には、OpenSSL ツールキットが含まれています。 OpenSSL は、 通常の通信層の上位にあるトランスポート層を暗号化し、 多くのネットワークアプリケーションおよびサービスと組み合わせて使用できます。</p></div><div class=paragraph><p>OpenSSL は、 メールクライアントの暗号化された認証、 クレジットカードでの支払いといったウェブベースの取引などで使われます。 <a class=package href=https://cgit.freebsd.org/ports/tree/www/apache22/>www/apache22</a> および <a class=package href=https://cgit.freebsd.org/ports/tree/mail/claws-mail/>mail/claws-mail</a> といった多くの port では、 OpenSSL とともに構築するコンパイルに対応しています。</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>多くの場合、Ports Collection は、 make の <code>WITH_OPENSSL_BASE</code> が明示的に "yes" に設定されていないと、 <a class=package href=https://cgit.freebsd.org/ports/tree/security/openssl/>security/openssl</a> port の構築を試みます。</p></div></td></tr></tbody></table></div><div class=paragraph><p>FreeBSD に含まれている OpenSSL 　のバージョンは、Secure Sockets Layer v2/v3 (SSLv2/SSLv3) および Transport Layer Security v1 (TLSv1) ネットワークセキュリティプロトコルに対応しており、 多目的な暗号化ライブラリとして使うことができます。</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>OpenSSL は、 IDEA アルゴリズムに対応していますが、 合衆国の特許により、デフォルトでは無効になっています。 もし使用したいのであれば、ライセンス条項を必ず確認し、 ライセンス条項に合致するのであれば、 <span class=filename>/etc/make.conf</span> において <code>MAKE_IDEA</code> 変数を設定してください。</p></div></td></tr></tbody></table></div><div class=paragraph><p>最も一般的な OpenSSL の利用方法のひとつは、 ソフトウェアアプリケーションが使えるように証明書を提供することです。 これらの証明書により、会社または個人の公開鍵が、 改ざんやなりすましが行われていないことを確認できます。 もし問題となっている証明書が、"認証局" (CA) により検証されなければ、 警告が表示されます。 CA は、<a href=http://www.verisign.com>VeriSign</a> のような会社で、個人または会社の公開鍵の検証を行えるように、 証明書に署名を行います。 証明書を作成するには費用がかかり、 証明書の使用は必要条件ではありませんが、 証明書を使うことで、 ユーザを安心させることができます。</p></div><div class=sect2><h3 id=_証明書の作成>13.6.1. 証明書の作成<a class=anchor href=#_証明書の作成></a></h3><div class=paragraph><p>以下のコマンドにより、証明書を作成できます。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># openssl req -new -nodes -out req.pem -keyout cert.pem</span>
Generating a 1024 bit RSA private key
................++++++
.......................................++++++
writing new private key to <span class=s1>&#39;cert.pem&#39;</span>
<span class=nt>-----</span>
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter <span class=s1>&#39;.&#39;</span>, the field will be left blank.
<span class=nt>-----</span>
Country Name <span class=o>(</span>2 letter code<span class=o>)</span> <span class=o>[</span>AU]:US
State or Province Name <span class=o>(</span>full name<span class=o>)</span> <span class=o>[</span>Some-State]:PA
Locality Name <span class=o>(</span>eg, city<span class=o>)</span> <span class=o>[]</span>:Pittsburgh
Organization Name <span class=o>(</span>eg, company<span class=o>)</span> <span class=o>[</span>Internet Widgits Pty Ltd]:My Company
Organizational Unit Name <span class=o>(</span>eg, section<span class=o>)</span> <span class=o>[]</span>:Systems Administrator
Common Name <span class=o>(</span>eg, YOUR name<span class=o>)</span> <span class=o>[]</span>:localhost.example.org
Email Address <span class=o>[]</span>:trhodes@FreeBSD.org

Please enter the following <span class=s1>&#39;extra&#39;</span> attributes
to be sent with your certificate request
A challenge password <span class=o>[]</span>:SOME PASSWORD
An optional company name <span class=o>[]</span>:Another Name</code></pre></div></div><div class=paragraph><p>"Common Name" プロンプト直後に表示されているのは、 ドメイン名です。 このプロンプトでは、検証するサーバ名の入力が必要となります。 ドメイン名以外を入力すると、役に立たない証明書が作成されます。 他のオプションとして、有効期限を指定したり、 別の暗号化アルゴリズムを選択することができます。 オプションの完全なリストは、 <a href="https://man.freebsd.org/cgi/man.cgi?query=openssl&amp;sektion=1&amp;format=html">openssl(1)</a> で説明されています。</p></div><div class=paragraph><p>このコマンドを実行したディレクトリには、 2 つのファイルが作成されているはずです。 1 つは、証明書要求 <span class=filename>req.pem</span> です。 このファイルを CA に送ると、 CA は含まれている内容を検証し、 検証に成功すると、証明書要求に署名を行い、 作成された証明書を送り返します。 もうひとつ、<span class=filename>cert.pem</span> と呼ばれるファイルが生成されます。 これは証明書の秘密鍵であり、 どのようなことがあっても保護しなくてはなりません。 もし、他の人の手に渡ると、手に入れた人は、 ユーザまたはサーバになりすますことができてしまいます。</p></div><div class=paragraph><p>CA の署名が必要ない場合には、 自己署名証明書を作成できます。 最初に RSA の鍵を生成してください。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># openssl dsaparam -rand -genkey -out myRSA.key 1024</span></code></pre></div></div><div class=paragraph><p>次に、CA 鍵を生成してください。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># openssl gendsa -des3 -out myca.key myRSA.key</span></code></pre></div></div><div class=paragraph><p>この鍵を使って証明書を作成してください。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># openssl req -new -x509 -days 365 -key myca.key -out new.crt</span></code></pre></div></div><div class=paragraph><p>新しく 2 つのファイルがこのディレクトリに作成されます。 プライベート鍵 <span class=filename>myca.key</span> および 証明書 <span class=filename>new.crt</span> です。 これらのファイルを、好ましくは <span class=filename>/etc</span> 以下で、 <code>root</code> のみが読むことのできるディレクトリに置く必要があります。 許可属性は 0700 が適切です。 許可属性は <a href="https://man.freebsd.org/cgi/man.cgi?query=chmod&amp;sektion=1&amp;format=html">chmod(1)</a> を使って設定できます。</p></div></div><div class=sect2><h3 id=_証明書の使用>13.6.2. 証明書の使用<a class=anchor href=#_証明書の使用></a></h3><div class=paragraph><p>証明書の一つの利用方法は、SendmailMTA への接続を暗号化することです。 これにより、 ローカルの MTA 経由でメールを送信するユーザが、 テキスト認証を使用しなくてもすむようになります。</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>いくつかの MUA は、 ユーザが証明書をローカルにインストールしていないと、 エラーを出力します。 証明書のインストールに関する詳細な情報については、 ソフトウェアに付随の文書を参照してください。</p></div></td></tr></tbody></table></div><div class=paragraph><p>Sendmail を設定するには、以下の行をローカルの <span class=filename>.mc</span> ファイルに含めてください。</p></div><div class="literalblock programlisting"><div class=content><pre>dnl SSL Options
define(`confCACERT_PATH&#39;,`/etc/certs&#39;)dnl
define(`confCACERT&#39;,`/etc/certs/new.crt&#39;)dnl
define(`confSERVER_CERT&#39;,`/etc/certs/new.crt&#39;)dnl
define(`confSERVER_KEY&#39;,`/etc/certs/myca.key&#39;)dnl
define(`confTLS_SRV_OPTIONS&#39;, `V&#39;)dnl</pre></div></div><div class=paragraph><p>この例では、 ローカルで証明書および鍵ファイルは、ローカルの <span class=filename>/etc/certs/</span> に置かれています。 ファイルの編集を保存し終わったら、 <span class=filename>/etc/mail</span> において <code>make install</code> と入力することで、ローカルの <span class=filename>.cf</span> ファイルを再構築する必要があります。 その後、<code>make restart</code> と入力して、Sendmail デーモンを再起動してください。</p></div><div class=paragraph><p>すべてがうまくいっていれば、 <span class=filename>/var/log/maillog</span> にはエラーメッセージは出力されず、 Sendmail がプロセスの一覧に表示されます。</p></div><div class=paragraph><p>以下は簡単な試験の例で、<a href="https://man.freebsd.org/cgi/man.cgi?query=telnet&amp;sektion=1&amp;format=html">telnet(1)</a> を使って、 メールサーバに接続しています。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># telnet example.com 25</span>
Trying 192.0.34.166...
Connected to  example.com
Escape character is <span class=s1>&#39;^]&#39;</span><span class=nb>.</span>
220 example.com ESMTP Sendmail 8.12.10/8.12.10<span class=p>;</span> Tue, 31 Aug 2004 03:41:22 <span class=nt>-0400</span> <span class=o>(</span>EDT<span class=o>)</span>
ehlo example.com
250-example.com Hello example.com <span class=o>[</span>192.0.34.166], pleased to meet you
250-ENHANCEDSTATUSCODES
250-PIPELINING
250-8BITMIME
250-SIZE
250-DSN
250-ETRN
250-AUTH LOGIN PLAIN
250-STARTTLS
250-DELIVERBY
250 HELP
quit
221 2.0.0 example.com closing connection
Connection closed by foreign host.</code></pre></div></div><div class=paragraph><p>出力に "STARTTLS" 行が表示されれば、 すべてが適切に機能しています。</p></div></div></div></div><div class=sect1><h2 id=ipsec>13.7. VPN over IPsec<a class=anchor href=#ipsec></a></h2><div class=sectionbody><div class=sect2><h3 id=_ipsec_を理解する>13.7.1. IPsec を理解する<a class=anchor href=#_ipsec_を理解する></a></h3><div class=paragraph><p>この節では、IPsec を設定する過程を説明します。 IPsec を設定するためには、 カスタムカーネルの構築方法をよく知っている必要があります (<a href=../kernelconfig/#kernelconfig>FreeBSD カーネルのコンフィグレーション</a> をご覧ください)。</p></div><div class=paragraph><p><em>IPsec</em> は、インターネットプロトコル (IP) レイヤのトップにあるプロトコルです。 二つもしくはそれ以上のホスト間で安全に通信することを可能にします。 FreeBSD の IPsec "ネットワークスタック" は、 IPv4 および IPv6 の両方に対応している <a href=http://www.kame.net/>KAME</a> 実装をベースとしています。</p></div><div class=paragraph><p>IPsec は二つのサブプロトコルから構成されます。</p></div><div class=ulist><ul><li><p><em>Encapsulated Security Payload (ESP)</em>: このプロトコルは、Blowfish, 3DES といった対称暗号アルゴリズムを使ってデータを暗号化することで、 サードパーティのインタフェースから IP パケットデータを保護します。</p></li><li><p><em>Authentication Header AH(AH)</em>: このプロトコルは、暗号チェックサムを計算し、IP パケットのヘッドフィールドを安全なハッシュ関数でハッシュ化することで、 IP パケットヘッダをサードパーティのインタフェースやなりすましから守ります。 ハッシュを含む追加のヘッダが追加され、 パケット情報の検証が可能になります。</p></li></ul></div><div class=paragraph><p>ESP および AH は、使用する環境に合わせて、 一緒に使うことも別々に使うこともできます。</p></div><div class=paragraph><p>IPsec は、直接二つのホスト間のトラフィックを暗号化する <em>Transport Mode</em>、もしくは "virtual tunnels" を構築する <em>Tunnel Mode</em> のどちらでも用いることができます。 後者のモードはより一般的には、 <em>Virtual Private Network (VPN)</em> として知られています。 FreeBSD での IPsec サブシステムに関するより詳細な情報については、 <a href="https://man.freebsd.org/cgi/man.cgi?query=ipsec&amp;sektion=4&amp;format=html">ipsec(4)</a> を参照してください。</p></div><div class=paragraph><p>カーネルに IPsec のサポートを追加するには、 カスタムカーネルコンフィグレーションファイルに以下のオプションを追加してください。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>options   IPSEC        <span class=c>#IP security</span>
device    crypto</code></pre></div></div><div class=paragraph><p>IPsec のデバッグサポートが必要であれば、 以下のカーネルオプションを追加してください。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>options   IPSEC_DEBUG  <span class=c>#debug for IP security</span></code></pre></div></div></div><div class=sect2><h3 id=_家庭と会社間の_vpn>13.7.2. 家庭と会社間の VPN<a class=anchor href=#_家庭と会社間の_vpn></a></h3><div class=paragraph><p>VPN の構成についての標準はありません。 VPN は、数多くの技術と共に実装することが可能です。 その各技術には、それ自身の長所と短所があります。 この節では、以下のシナリオに対して VPN を実装する戦略について説明します。</p></div><div class=ulist><ul><li><p>少なくとも 2 つのサイトがあり、 それぞれのサイトは内部で IP を使っています。</p></li><li><p>2 つのサイトは、FreeBSD で運用されているゲートウェイを通して、 インターネットに接続しています。</p></li><li><p>それぞれのネットワークのゲートウェイは、 少なくとも一つのパブリック IP アドレスを持っています。</p></li><li><p>2 つのネットワークの内部アドレスは、 パブリックでもプライベート IP アドレスでも構いません。 しかしながら、アドレス空間は衝突してはいけません。 たとえば、両方のネットワークが <code>192.168.1.x</code> を使ってはいけません。</p></li></ul></div><div class=sect3><h4 id=_freebsd_上で_ipsec_を設定する>13.7.2.1. FreeBSD 上で IPsec を設定する。<a class=anchor href=#_freebsd_上で_ipsec_を設定する></a></h4><div class=paragraph><p>最初に Ports Collection から <a class=package href=https://cgit.freebsd.org/ports/tree/security/ipsec-tools/>security/ipsec-tools</a> をインストールしてください。 このソフトウェアは、 設定をサポートする数多くのアプリケーションを提供します。</p></div><div class=paragraph><p>次に、パケットをトンネリングし、 両方のネットワークが適切に通信するように、 2 つの <a href="https://man.freebsd.org/cgi/man.cgi?query=gif&amp;sektion=4&amp;format=html">gif(4)</a> 疑似デバイスを作成します。 <code>root</code> 権限で以下のコマンドを実行してください。 ただし、実行する際には、以下のコマンドの中の <em>internal</em> および <em>external</em> を、 2 つのゲートウェイの内部および外部インタフェースの実際の IP アドレスに置き換えてください。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig gif0 create</span></code></pre></div></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig gif0 internal1 internal2</span></code></pre></div></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig gif0 tunnel external1 external2</span></code></pre></div></div><div class=paragraph><p>この例では、会社の LAN の外部 IP アドレスを <code>172.16.5.4</code>、 内部 IP アドレスを <code>10.246.38.1</code> とします。また、家庭 LAN の外部 IP アドレスを <code>192.168.1.12</code>、 内部のプライベート IP アドレスを <code>10.0.0.5</code> とします。</p></div><div class=paragraph><p>この説明で分かりにくい場合は、以下の <a href="https://man.freebsd.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;format=html">ifconfig(8)</a> コマンドの出力例をご覧ください。</p></div><div class="literalblock programlisting"><div class=content><pre>Gateway 1:

gif0: flags=8051 mtu 1280
tunnel inet 172.16.5.4 --&gt; 192.168.1.12
inet6 fe80::2e0:81ff:fe02:5881%gif0 prefixlen 64 scopeid 0x6
inet 10.246.38.1 --&gt; 10.0.0.5 netmask 0xffffff00

Gateway 2:

gif0: flags=8051 mtu 1280
tunnel inet 192.168.1.12 --&gt; 172.16.5.4
inet 10.0.0.5 --&gt; 10.246.38.1 netmask 0xffffff00
inet6 fe80::250:bfff:fe3a:c1f%gif0 prefixlen 64 scopeid 0x4</pre></div></div><div class=paragraph><p>設定が完了したら、両方の内部 IP アドレスは、<a href="https://man.freebsd.org/cgi/man.cgi?query=ping&amp;sektion=8&amp;format=html">ping(8)</a> で到達できるようになっているはずです。</p></div><div class="literalblock programlisting"><div class=content><pre>priv-net# ping 10.0.0.5
PING 10.0.0.5 (10.0.0.5): 56 data bytes
64 bytes from 10.0.0.5: icmp_seq=0 ttl=64 time=42.786 ms
64 bytes from 10.0.0.5: icmp_seq=1 ttl=64 time=19.255 ms
64 bytes from 10.0.0.5: icmp_seq=2 ttl=64 time=20.440 ms
64 bytes from 10.0.0.5: icmp_seq=3 ttl=64 time=21.036 ms
--- 10.0.0.5 ping statistics ---
4 packets transmitted, 4 packets received, 0% packet loss
round-trip min/avg/max/stddev = 19.255/25.879/42.786/9.782 ms

corp-net# ping 10.246.38.1
PING 10.246.38.1 (10.246.38.1): 56 data bytes
64 bytes from 10.246.38.1: icmp_seq=0 ttl=64 time=28.106 ms
64 bytes from 10.246.38.1: icmp_seq=1 ttl=64 time=42.917 ms
64 bytes from 10.246.38.1: icmp_seq=2 ttl=64 time=127.525 ms
64 bytes from 10.246.38.1: icmp_seq=3 ttl=64 time=119.896 ms
64 bytes from 10.246.38.1: icmp_seq=4 ttl=64 time=154.524 ms
--- 10.246.38.1 ping statistics ---
5 packets transmitted, 5 packets received, 0% packet loss
round-trip min/avg/max/stddev = 28.106/94.594/154.524/49.814 ms</pre></div></div><div class=paragraph><p>予想通り、プライベートアドレスを使って、 両方のネットワークから ICMP パケットを送受信できます。 次に、どちらのネットワークからもメッセージを送信できるように、 パケットのルーティング情報を両方のゲートウェイに設定する必要があります。 これは以下のコマンドで設定できます。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># corp-net# route add 10.0.0.0 10.0.0.5 255.255.255.0</span></code></pre></div></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># corp-net# route add net 10.0.0.0: gateway 10.0.0.5</span></code></pre></div></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># priv-net# route add 10.246.38.0 10.246.38.1 255.255.255.0</span></code></pre></div></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># priv-net# route add host 10.246.38.0: gateway 10.246.38.1</span></code></pre></div></div><div class=paragraph><p>これで、ネットワーク内のコンピュータは、 ゲートウェイおよびゲートウェイの奥のコンピュータから到達可能となっています。 もう一度 <a href="https://man.freebsd.org/cgi/man.cgi?query=ping&amp;sektion=8&amp;format=html">ping(8)</a> で確認してください。</p></div><div class="literalblock programlisting"><div class=content><pre>corp-net# ping 10.0.0.8
PING 10.0.0.8 (10.0.0.8): 56 data bytes
64 bytes from 10.0.0.8: icmp_seq=0 ttl=63 time=92.391 ms
64 bytes from 10.0.0.8: icmp_seq=1 ttl=63 time=21.870 ms
64 bytes from 10.0.0.8: icmp_seq=2 ttl=63 time=198.022 ms
64 bytes from 10.0.0.8: icmp_seq=3 ttl=63 time=22.241 ms
64 bytes from 10.0.0.8: icmp_seq=4 ttl=63 time=174.705 ms
--- 10.0.0.8 ping statistics ---
5 packets transmitted, 5 packets received, 0% packet loss
round-trip min/avg/max/stddev = 21.870/101.846/198.022/74.001 ms

priv-net# ping 10.246.38.107
PING 10.246.38.1 (10.246.38.107): 56 data bytes
64 bytes from 10.246.38.107: icmp_seq=0 ttl=64 time=53.491 ms
64 bytes from 10.246.38.107: icmp_seq=1 ttl=64 time=23.395 ms
64 bytes from 10.246.38.107: icmp_seq=2 ttl=64 time=23.865 ms
64 bytes from 10.246.38.107: icmp_seq=3 ttl=64 time=21.145 ms
64 bytes from 10.246.38.107: icmp_seq=4 ttl=64 time=36.708 ms
--- 10.246.38.107 ping statistics ---
5 packets transmitted, 5 packets received, 0% packet loss
round-trip min/avg/max/stddev = 21.145/31.721/53.491/12.179 ms</pre></div></div><div class=paragraph><p>トンネリングの設定は以上のように簡単ですが、 リンクを安全にするには、もう少し掘り下げた設定が必要となります。 以下の設定では、事前共有 (PSK) RSA 鍵を使います。 IP アドレスを除けば、両方のゲートウェイの <span class=filename>/usr/local/etc/racoon/racoon.conf</span> は同じで、以下のようになります。</p></div><div class="literalblock programlisting"><div class=content><pre>path    pre_shared_key  &#34;/usr/local/etc/racoon/psk.txt&#34;; #location of pre-shared key file
log     debug;	#log verbosity setting: set to &#39;notify&#39; when testing and debugging is complete

padding	# options are not to be changed
{
        maximum_length  20;
        randomize       off;
        strict_check    off;
        exclusive_tail  off;
}

timer	# timing options. change as needed
{
        counter         5;
        interval        20 sec;
        persend         1;
#       natt_keepalive  15 sec;
        phase1          30 sec;
        phase2          15 sec;
}

listen	# address [port] that racoon will listen on
{
        isakmp          172.16.5.4 [500];
        isakmp_natt     172.16.5.4 [4500];
}

remote  192.168.1.12 [500]
{
        exchange_mode   main,aggressive;
        doi             ipsec_doi;
        situation       identity_only;
        my_identifier   address 172.16.5.4;
        peers_identifier        address 192.168.1.12;
        lifetime        time 8 hour;
        passive         off;
        proposal_check  obey;
#       nat_traversal   off;
        generate_policy off;

                        proposal {
                                encryption_algorithm    blowfish;
                                hash_algorithm          md5;
                                authentication_method   pre_shared_key;
                                lifetime time           30 sec;
                                dh_group                1;
                        }
}

sainfo  (address 10.246.38.0/24 any address 10.0.0.0/24 any)	# address $network/$netmask $type address $network/$netmask $type ( $type being any or esp)
{								# $network must be the two internal networks you are joining.
        pfs_group       1;
        lifetime        time    36000 sec;
        encryption_algorithm    blowfish,3des,des;
        authentication_algorithm        hmac_md5,hmac_sha1;
        compression_algorithm   deflate;
}</pre></div></div><div class=paragraph><p>利用可能なオプションの説明については、 racoon のマニュアルページを参照してください。</p></div><div class=paragraph><p>FreeBSD および racoon がホスト間のネットワークトラフィックを暗号化、 復号化できるようにするには、 Security Policy Database (SPD) の設定が必要です。</p></div><div class=paragraph><p>これは、会社のゲートウェイ上で、 以下のようなシェルスクリプトで設定できます。 このファイルをシステムの初期化中に使われるようにするには、 <span class=filename>/usr/local/etc/racoon/setkey.conf</span> に保存する必要があります。</p></div><div class="literalblock programlisting"><div class=content><pre>flush;
spdflush;
# To the home network
spdadd 10.246.38.0/24 10.0.0.0/24 any -P out ipsec esp/tunnel/172.16.5.4-192.168.1.12/use;
spdadd 10.0.0.0/24 10.246.38.0/24 any -P in ipsec esp/tunnel/192.168.1.12-172.16.5.4/use;</pre></div></div><div class=paragraph><p>設定ファイルを適切に置くと、以下のコマンドにより、 両方のゲートウェイ上で racoon を起動できます。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># /usr/local/sbin/racoon -F -f /usr/local/etc/racoon/racoon.conf -l /var/log/racoon.log</span></code></pre></div></div><div class=paragraph><p>出力は以下のようになるでしょう。</p></div><div class="literalblock programlisting"><div class=content><pre>corp-net# /usr/local/sbin/racoon -F -f /usr/local/etc/racoon/racoon.conf
Foreground mode.
2006-01-30 01:35:47: INFO: begin Identity Protection mode.
2006-01-30 01:35:48: INFO: received Vendor ID: KAME/racoon
2006-01-30 01:35:55: INFO: received Vendor ID: KAME/racoon
n2006-01-30 01:36:04: INFO: ISAKMP-SA established 172.16.5.4[500]-192.168.1.12[500] spi:623b9b3bd2492452:7deab82d54ff704a
2006-01-30 01:36:05: INFO: initiate new phase 2 negotiation: 172.16.5.4[0]192.168.1.12[0]
2006-01-30 01:36:09: INFO: IPsec-SA established: ESP/Tunnel 192.168.1.12[0]-&gt;172.16.5.4[0] spi=28496098(0x1b2d0e2)
2006-01-30 01:36:09: INFO: IPsec-SA established: ESP/Tunnel 172.16.5.4[0]-&gt;192.168.1.12[0] spi=47784998(0x2d92426)
2006-01-30 01:36:13: INFO: respond new phase 2 negotiation: 172.16.5.4[0]192.168.1.12[0]
2006-01-30 01:36:18: INFO: IPsec-SA established: ESP/Tunnel 192.168.1.12[0]-&gt;172.16.5.4[0] spi=124397467(0x76a279b)
2006-01-30 01:36:18: INFO: IPsec-SA established: ESP/Tunnel 172.16.5.4[0]-&gt;192.168.1.12[0] spi=175852902(0xa7b4d66)</pre></div></div><div class=paragraph><p>トンネリングが適切に行われているかどうかを確認するため、 別のコンソール上で <a href="https://man.freebsd.org/cgi/man.cgi?query=tcpdump&amp;sektion=1&amp;format=html">tcpdump(1)</a> を使い、 以下のようなコマンドでネットワークの通信を確認してください。 ただし、以下の例の <code>em0</code> の部分は、 必要に応じて使用しているネットワークインタフェースに置き換えてください。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># tcpdump -i em0 host 172.16.5.4 and dst 192.168.1.12</span></code></pre></div></div><div class=paragraph><p>以下のようなデータがコンソールに表示されます。 もし、表示されない場合は、設定に何か問題があるので、 表示されるデータを使ってデバッグする必要があります。</p></div><div class="literalblock programlisting"><div class=content><pre>01:47:32.021683 IP corporatenetwork.com &gt; 192.168.1.12.privatenetwork.com: ESP(spi=0x02acbf9f,seq=0xa)
01:47:33.022442 IP corporatenetwork.com &gt; 192.168.1.12.privatenetwork.com: ESP(spi=0x02acbf9f,seq=0xb)
01:47:34.024218 IP corporatenetwork.com &gt; 192.168.1.12.privatenetwork.com: ESP(spi=0x02acbf9f,seq=0xc)</pre></div></div><div class=paragraph><p>これで 2 つのネットワークは、 1 つのネットワークのように利用できます。 多くの場合、 両方のネットワークはファイアウォールにより保護されています。 両方を流れる通信を許可するには、 パケットが両方を行き来できるようにルールを追加する必要があります。 <a href="https://man.freebsd.org/cgi/man.cgi?query=ipfw&amp;sektion=8&amp;format=html">ipfw(8)</a> を使ったファイアウォールの場合は、 ファイアウォールの設定ファイルに、以下の行を追加してください。</p></div><div class="literalblock programlisting"><div class=content><pre>ipfw add 00201 allow log esp from any to any
ipfw add 00202 allow log ah from any to any
ipfw add 00203 allow log ipencap from any to any
ipfw add 00204 allow log udp from any 500 to any</pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>ルール番号は、 現在のホストの設定によっては変更する必要があるでしょう。</p></div></td></tr></tbody></table></div><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=pf&amp;sektion=4&amp;format=html">pf(4)</a> または <a href="https://man.freebsd.org/cgi/man.cgi?query=ipf&amp;sektion=8&amp;format=html">ipf(8)</a> を使用しているシステムでは、 以下のルールで上手くいくでしょう。</p></div><div class="literalblock programlisting"><div class=content><pre>pass in quick proto esp from any to any
pass in quick proto ah from any to any
pass in quick proto ipencap from any to any
pass in quick proto udp from any port = 500 to any port = 500
pass in quick on gif0 from any to any
pass out quick proto esp from any to any
pass out quick proto ah from any to any
pass out quick proto ipencap from any to any
pass out quick proto udp from any port = 500 to any port = 500
pass out quick on gif0 from any to any</pre></div></div><div class=paragraph><p>最後に、システムの初期化中に VPN が起動するように、以下の行を <span class=filename>/etc/rc.conf</span> に追加してください。</p></div><div class="literalblock programlisting"><div class=content><pre>ipsec_enable=&#34;YES&#34;
ipsec_program=&#34;/usr/local/sbin/setkey&#34;
ipsec_file=&#34;/usr/local/etc/racoon/setkey.conf&#34; # allows setting up spd policies on boot
racoon_enable=&#34;yes&#34;</pre></div></div></div></div></div></div><div class=sect1><h2 id=openssh>13.8. OpenSSH<a class=anchor href=#openssh></a></h2><div class=sectionbody><div class=paragraph><p>OpenSSH はリモートマシンへのセキュアなアクセスに使われるネットワーク接続ツールの集合です。 また、TCP/IP 接続を OpenSSH 接続経由でセキュアにトンネル/フォワードすることもできます。 OpenSSH はすべてのトラフィックを暗号化し、 盗聴や接続の乗っ取り等のネットワークレベルの攻撃を事実上無効化します。</p></div><div class=paragraph><p>OpenSSH は OpenBSD プロジェクトによって維持管理されており、 FreeBSD にはデフォルトでインストールされています。 OpenSSH は、 SSH バージョン 1 と 2 の両方に互換性があります。</p></div><div class=sect2><h3 id=_openssh_を使うことの利点>13.8.1. OpenSSH を使うことの利点<a class=anchor href=#_openssh_を使うことの利点></a></h3><div class=paragraph><p>データがネットワークを平文で流れてしまうと、 ネットワークをクライアントとサーバの間のどこかで盗聴することで、 あなたのユーザ/パスワード情報やセション中を流れるデータを盗むことが可能です。 OpenSSH はこれらを予防する為にさまざまな認証と暗号化の方法を提供します。</p></div></div><div class=sect2><h3 id=_ssh_サーバを有効にする>13.8.2. SSH サーバを有効にする<a class=anchor href=#_ssh_サーバを有効にする></a></h3><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=sshd&amp;sektion=8&amp;format=html">sshd(8)</a> が有効になっているかどうかを確認するには、 <span class=filename>/etc/rc.conf</span> の以下の行を確認してください。</p></div><div class="literalblock programlisting"><div class=content><pre>sshd_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>この設定により、次のシステムの初期化時に OpenSSH のデーモンプログラムである <a href="https://man.freebsd.org/cgi/man.cgi?query=sshd&amp;sektion=8&amp;format=html">sshd(8)</a> が起動します。 もしくは <a href="https://man.freebsd.org/cgi/man.cgi?query=service&amp;sektion=8&amp;format=html">service(8)</a> を使って、すぐに OpenSSH を起動することもできます。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service sshd start</span></code></pre></div></div></div><div class=sect2><h3 id=_ssh_クライアント>13.8.3. SSH クライアント<a class=anchor href=#_ssh_クライアント></a></h3><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;format=html">ssh(1)</a> を使って、 <a href="https://man.freebsd.org/cgi/man.cgi?query=sshd&amp;sektion=8&amp;format=html">sshd(8)</a> が動いているシステムに接続するには、 ログインをするユーザ名とホストを指定してください。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ssh user@example.com</span>
Host key not found from the list of known hosts.
Are you sure you want to <span class=k>continue </span>connecting <span class=o>(</span><span class=nb>yes</span>/no<span class=o>)</span>? <span class=nb>yes
</span>Host <span class=s1>&#39;example.com&#39;</span> added to the list of known hosts.
user@example.com<span class=s1>&#39;s password: *******</span></code></pre></div></div><div class=paragraph><p>SSH はクライアントが接続した時、 サーバの信頼性の検証のために鍵指紋システム (key fingerprint system) を利用します。 初めての接続の際に、ユーザは <code>yes</code> と入力することを要求されます。 これ以降の login では保存されていた鍵指紋を照合することで検証が行われ、 <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;format=html">ssh(1)</a> クライアントは保存されていた鍵指紋が login しようとした際に送られてきたものと異なっていた場合には警告を表示します。 指紋は <span class=filename>~/.ssh/known_hosts</span> に保存されます。</p></div><div class=paragraph><p>デフォルトでは、<a href="https://man.freebsd.org/cgi/man.cgi?query=sshd&amp;sektion=8&amp;format=html">sshd(8)</a> の最近の版では SSH v2 の接続のみを受け付けるように設定されています。 クライアントは可能であればバージョン 2 を用い、 バージョン 1 にフォールバックします。 クライアントは、プロトコル v1 と v2 についてそれぞれ、引数 <code>-1</code> または <code>-2</code> を渡すことで、利用するプロトコルを指定できます。 クライアントにおけるバージョン 1 への互換性は、 古いバージョンへの上位互換のために維持されています。</p></div></div><div class=sect2><h3 id=_secure_copy>13.8.4. Secure copy<a class=anchor href=#_secure_copy></a></h3><div class=paragraph><p>ローカルのファイルをリモートマシンへ、 あるいはリモートマシンのファイルをローカルに安全な方法でコピーするには、 <a href="https://man.freebsd.org/cgi/man.cgi?query=scp&amp;sektion=1&amp;format=html">scp(1)</a> を使用してください。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c>#  scp user@example.com:/COPYRIGHT COPYRIGHT</span>
user@example.com<span class=s1>&#39;s password: *******
COPYRIGHT            100% |*****************************|  4735
00:00
#</span></code></pre></div></div><div class=paragraph><p>前回の例でこのホストの指紋がすでに保存されていれば この <a href="https://man.freebsd.org/cgi/man.cgi?query=scp&amp;sektion=1&amp;format=html">scp(1)</a> を使う時に検証が行なわれます。</p></div><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=scp&amp;sektion=1&amp;format=html">scp(1)</a> に渡される引数は、<a href="https://man.freebsd.org/cgi/man.cgi?query=cp&amp;sektion=1&amp;format=html">cp(1)</a> のものと似ており、コピーするファイル (1 つまたは複数) が 1 つめの引数になり、コピー先が 2 つめの引数になります。 ファイルはネットワーク越しに SSH 接続を通して送られるので、 引数に指定するファイルに <code>user@host:&lt;path_to_remote_file></code> という形式をとるものがあります。</p></div></div><div class=sect2><h3 id=_設定>13.8.5. 設定<a class=anchor href=#_設定></a></h3><div class=paragraph><p>システム全体の設定ファイルは、OpenSSH デーモン、クライアントの両方とも <span class=filename>/etc/ssh</span> にあります。</p></div><div class=paragraph><p><span class=filename>ssh_config</span> はクライアントの動作設定、 <span class=filename>sshd_config</span> はデーモンの動作設定を行ないます。 それぞれのファイル毎にマニュアルページが用意されており、 利用可能な設定オプションについて説明されています。</p></div></div><div class=sect2><h3 id=security-ssh-keygen>13.8.6. <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh-keygen&amp;sektion=1&amp;format=html">ssh-keygen(1)</a><a class=anchor href=#security-ssh-keygen></a></h3><div class=paragraph><p>パスワードの代わりに <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh-keygen&amp;sektion=1&amp;format=html">ssh-keygen(1)</a> を使ってユーザの認証用の DSA または RSA 暗号鍵を作ることができます。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% ssh-keygen <span class=nt>-t</span> dsa
Generating public/private dsa key pair.
Enter file <span class=k>in </span>which to save the key <span class=o>(</span>/home/user/.ssh/id_dsa<span class=o>)</span>:
Created directory <span class=s1>&#39;/home/user/.ssh&#39;</span><span class=nb>.</span>
Enter passphrase <span class=o>(</span>empty <span class=k>for </span>no passphrase<span class=o>)</span>:
Enter same passphrase again:
Your identification has been saved <span class=k>in</span> /home/user/.ssh/id_dsa.
Your public key has been saved <span class=k>in</span> /home/user/.ssh/id_dsa.pub.
The key fingerprint is:
bb:48:db:f2:93:57:80:b6:aa:bc:f5:d5:ba:8f:79:17 user@host.example.com</code></pre></div></div><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=ssh-keygen&amp;sektion=1&amp;format=html">ssh-keygen(1)</a> は認証に使う為の公開鍵と秘密鍵のペアを作ります。 DSA または RSA 鍵に応じて、 秘密鍵は <span class=filename>~/.ssh/id_dsa</span> または <span class=filename>~/.ssh/id_rsa</span> に保存され、 公開鍵は <span class=filename>~/.ssh/id_dsa.pub</span> または <span class=filename>~/.ssh/id_rsa.pub</span> にそれぞれ保存されます。 公開鍵はセットアップのために、 DSA または RSA のどちらを使う場合にも、 リモートマシンの <span class=filename>~/.ssh/authorized_keys</span> に含まれてなければなりません。</p></div><div class=paragraph><p>この設定により、パスワードに代わり、 SSH 鍵を使ってリモートマシンに接続できるようになります。</p></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>多くのユーザは、鍵が設計上安全と信じ、 パスフレーズなしに鍵を利用しています。 このような使用方法は <em>危険</em> です。 管理者が鍵にパスフレーズが設定されているかを確認する方法は、 手動で鍵を調べる方法です。 秘密鍵のファイルに <code>ENCRYPTED</code> という単語が含まれている場合には、 鍵の所有者は、パスフレーズを使用しています。 弱いパスフレーズが使われている間、 少なくともシステムが危険にさらされているときには、 他のサイトへのアクセスには、 あるレベルでのパスワード類推が必要となります。 さらに、公開鍵ファイルに <code>from</code> を含めることで、 エンドユーザをより安全にできます。 たとえば、 <code>ssh-rsa</code> または <code>rsa-dsa</code> の前に、 <code>from="192.168.10.5</code> を加えることで、 この IP を持つホストからのユーザのみがアクセスできるようになります。</p></div></td></tr></tbody></table></div><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=ssh-keygen&amp;sektion=1&amp;format=html">ssh-keygen(1)</a> でパスフレーズを使っている場合は、 秘密鍵を使うためにユーザは毎回パスフレーズを入力する必要があります。 長いパスフレーズを毎回入力しなくてはならない負担は、 <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh-agent&amp;sektion=1&amp;format=html">ssh-agent(1)</a> を使うと軽減できます。 これについては、 <a href=#security-ssh-agent>SSH Agent による鍵のキャッシュ</a> で説明されています。</p></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>OpenSSH のバージョンによって、 オプションやファイルに違いが出てくることがあります。 <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh-keygen&amp;sektion=1&amp;format=html">ssh-keygen(1)</a> を参照して、 問題が起こることを避けてください。</p></div></td></tr></tbody></table></div></div><div class=sect2><h3 id=security-ssh-agent>13.8.7. SSH Agent による鍵のキャッシュ<a class=anchor href=#security-ssh-agent></a></h3><div class=paragraph><p>パスフレーズを毎回入力することなしに、 SSH 鍵を利用できるようにメモリに読み込むには、 <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh-agent&amp;sektion=1&amp;format=html">ssh-agent(1)</a> および <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh-add&amp;sektion=1&amp;format=html">ssh-add(1)</a> を使用してください。</p></div><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=ssh-agent&amp;sektion=1&amp;format=html">ssh-agent(1)</a> は、 読み込まれた秘密鍵による認証を取り扱います。 <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh-agent&amp;sektion=1&amp;format=html">ssh-agent(1)</a> は他のアプリケーションの起動に用いられる必要があります。 基本的なレベルではシェル、 またはウィンドウマネージャを起動します。</p></div><div class=paragraph><p>シェル上で <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh-agent&amp;sektion=1&amp;format=html">ssh-agent(1)</a> を使うには、 引数としてシェルを起動してください。 次に、<a href="https://man.freebsd.org/cgi/man.cgi?query=ssh-add&amp;sektion=1&amp;format=html">ssh-add(1)</a> を実行し、 秘密鍵のパスフレーズを入力することにより、 鍵を追加してください。 一度この過程を終えてしまえば、ユーザは、 対応する公開鍵が置かれているホストに <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;format=html">ssh(1)</a> でログインできるようになります。 以下はその例です。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% ssh-agent csh
% ssh-add
Enter passphrase <span class=k>for</span> /home/user/.ssh/id_dsa:
Identity added: /home/user/.ssh/id_dsa <span class=o>(</span>/home/user/.ssh/id_dsa<span class=o>)</span>
%</code></pre></div></div><div class=paragraph><p>Xorg 上で <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh-agent&amp;sektion=1&amp;format=html">ssh-agent(1)</a> を使うには、 <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh-agent&amp;sektion=1&amp;format=html">ssh-agent(1)</a> への呼び出しが <span class=filename>~/.xinitrc</span> に置かれている必要があります。 これにより、Xorg 上で起動されるすべてのプログラムにおいて、 <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh-agent&amp;sektion=1&amp;format=html">ssh-agent(1)</a> サービスが提供されるようになります。 <span class=filename>~/.xinitrc</span> の例は以下となります。</p></div><div class="literalblock programlisting"><div class=content><pre>exec ssh-agent startxfce4</pre></div></div><div class=paragraph><p>これで、Xorg を開始するときにはいつでも <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh-agent&amp;sektion=1&amp;format=html">ssh-agent(1)</a> が起動され、 このプログラムから XFCE が起動されます。 Xorg を再起動した後は有効になりますので、 <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh-add&amp;sektion=1&amp;format=html">ssh-add(1)</a> を実行して、 すべての SSH 鍵を読み込ませてください。</p></div></div><div class=sect2><h3 id=security-ssh-tunneling>13.8.8. SSH トンネリング<a class=anchor href=#security-ssh-tunneling></a></h3><div class=paragraph><p>OpenSSH は暗号化されたセッションの中に他のプロトコルをカプセル化するトンネルを作ることができます。</p></div><div class=paragraph><p>以下のコマンドは <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;format=html">ssh(1)</a> で <a href="https://man.freebsd.org/cgi/man.cgi?query=telnet&amp;sektion=1&amp;format=html">telnet(1)</a> 用のトンネルを作成します。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% ssh <span class=nt>-2</span> <span class=nt>-N</span> <span class=nt>-f</span> <span class=nt>-L</span> 5023:localhost:23 user@foo.example.com
%</code></pre></div></div><div class=paragraph><p>この例では、以下のオプションを使っています。</p></div><div class=dlist><dl><dt class=hdlist1><code>-2</code></dt><dd><p>サーバへの接続に <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;format=html">ssh(1)</a> バージョン 2 を使うことを指示します。</p></dd><dt class=hdlist1><code>-N</code></dt><dd><p>はトンネルだけでコマンドはないことを示します。 省略されると <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;format=html">ssh(1)</a> は通常のセッションを開始します。</p></dd><dt class=hdlist1><code>-f</code></dt><dd><p><a href="https://man.freebsd.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;format=html">ssh(1)</a> にバックグラウンド実行を強制します。</p></dd><dt class=hdlist1><code>-L</code></dt><dd><p>ローカルトンネルを <em>localport:remotehost:remoteport</em> という形式で指定します。</p></dd><dt class=hdlist1><code>user@foo.example.com</code></dt><dd><p>指定したリモート SSH サーバへログインに用いるログイン名。</p></dd></dl></div><div class=paragraph><p>SSH のトンネルは <code>localhost</code> の指定されたポートに listen するソケットを作ることで実現されています。 SSH はローカルのホスト/ポートで受けた接続すべてを SSH 接続経由で指定されたリモートホストのポートへ転送します。</p></div><div class=paragraph><p>この例では、<code>localhost</code> のポート <em>5023</em> がリモートマシンの <code>localhost</code> のポート <em>23</em> に転送されるようになっています。 <em>23</em> は <a href="https://man.freebsd.org/cgi/man.cgi?query=telnet&amp;sektion=1&amp;format=html">telnet(1)</a> で用いられるので、これは SSH トンネルを通る暗号化された man.telnet.1; セッションを作ります。</p></div><div class=paragraph><p>このようにして SMTP や POP3 および FTP といったセキュアではない TCP プロトコルをカプセル化できます。</p></div><div class=exampleblock><div class=title>例 1. <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;format=html">ssh(1)</a> を用いた SMTP 用の安全なトンネルの作成</div><div class=content><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% ssh <span class=nt>-2</span> <span class=nt>-N</span> <span class=nt>-f</span> <span class=nt>-L</span> 5025:localhost:25 user@mailserver.example.com
user@mailserver.example.com<span class=s1>&#39;s password: *****
% telnet localhost 5025
Trying 127.0.0.1...
Connected to localhost.
Escape character is &#39;</span>^]<span class=s1>&#39;.
220 mailserver.example.com ESMTP</span></code></pre></div></div><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=ssh-keygen&amp;sektion=1&amp;format=html">ssh-keygen(1)</a> と別のユーザアカウントを組み合わせて使うことでより透過的な SSH のトンネル環境を作ることができます。 パスワードを入力するところで暗号鍵を使い、 トンネルは別のユーザ権限で実行することが可能です。</p></div></div></div><div class=sect3><h4 id=_実用的な_ssh_トンネルの例>13.8.8.1. 実用的な SSH トンネルの例<a class=anchor href=#_実用的な_ssh_トンネルの例></a></h4><div class=sect4><h5 id=_pop3_サーバへの安全な接続>13.8.8.1.1. POP3 サーバへの安全な接続<a class=anchor href=#_pop3_サーバへの安全な接続></a></h5><div class=paragraph><p>ここでの例は、外部からの接続を受ける SSH サーバがあるとします。 同じネットワークには、POP3 サーバが動いているメールサーバがあるとします。 電子メールを安全なやり方で見るようにするには、 SSH サーバへの SSH 接続を行い、 メールサーバへのトンネルを作成することです。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% ssh <span class=nt>-2</span> <span class=nt>-N</span> <span class=nt>-f</span> <span class=nt>-L</span> 2110:mail.example.com:110 user@ssh-server.example.com
user@ssh-server.example.com<span class=s1>&#39;s password: ******</span></code></pre></div></div><div class=paragraph><p>トンネルが作成されて動作したら、 メールクライアントに対し <code>localhost</code> のポート 2110 に POP3 リクエストを送るように指示してください。 そこへの接続は、トンネルを経由して安全に <code>mail.example.com</code> に転送されます。</p></div></div><div class=sect4><h5 id=_厳格なファイアウォールをすり抜ける>13.8.8.1.2. 厳格なファイアウォールをすり抜ける<a class=anchor href=#_厳格なファイアウォールをすり抜ける></a></h5><div class=paragraph><p>内向けおよび外向きの接続両方をフィルタするファイアウォールルールを課すネットワーク管理者もいます。 たとえば、 リモートのマシンからのアクセスに、<a href="https://man.freebsd.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;format=html">ssh(1)</a> および web サーフィンのための 22 番および 80 番ポートにしか接続させてもらえないかもしれません。 この場合 22 または 80 番以外を使う他のサービスへのアクセスを妨げます。</p></div><div class=paragraph><p>それに対する解決策は、 あなたが接続しているネットワークのファイアウォールの外部にあるマシンに対して SSH 接続を行い、 希望するサービスへのトンネルに利用することです。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% ssh <span class=nt>-2</span> <span class=nt>-N</span> <span class=nt>-f</span> <span class=nt>-L</span> 8888:music.example.com:8000 user@unfirewalled-system.example.org
user@unfirewalled-system.example.org<span class=s1>&#39;s password: *******</span></code></pre></div></div><div class=paragraph><p>この例では、ストリーミング Ogg Vorbis クライアントを <code>localhost</code> の 8888 番ポートに向けると、 <code>music.example.com</code> の 8000 番ポートに転送され、ファイアウォールをすり抜けられます。</p></div></div></div></div><div class=sect2><h3 id=_allowusers_オプション>13.8.9. <code>AllowUsers</code> オプション<a class=anchor href=#_allowusers_オプション></a></h3><div class=paragraph><p>ログインできるユーザや接続元を <code>AllowUsers</code> を使って制限することは、通常は良い考えです。 たとえば、 <code>root</code> が <code>192.168.1.32</code> からのみログインできるようにするには、 以下の行を <span class=filename>/etc/ssh/sshd_config</span> に追加してください。</p></div><div class="literalblock programlisting"><div class=content><pre>AllowUsers root@192.168.1.32</pre></div></div><div class=paragraph><p><code>admin</code> がどこからでもログインできるようにするには、 ユーザ名そのものを記述してください。</p></div><div class="literalblock programlisting"><div class=content><pre>AllowUsers admin</pre></div></div><div class=paragraph><p>複数のユーザは、以下のように同じ行に追加してください。</p></div><div class="literalblock programlisting"><div class=content><pre>AllowUsers root@192.168.1.32 admin</pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>注意すべきことは、 このコンピュータにログインする必要のあるすべてのユーザを指定することです。 設定されていないと、そのユーザはログインできなくなります。</p></div></td></tr></tbody></table></div><div class=paragraph><p><span class=filename>/etc/ssh/sshd_config</span> への変更が終わったら、 以下を実行して、設定ファイルを <a href="https://man.freebsd.org/cgi/man.cgi?query=sshd&amp;sektion=8&amp;format=html">sshd(8)</a> に読み込ませてください。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># service sshd reload</span></code></pre></div></div></div><div class=sect2><h3 id=_もっと詳しく知りたい人へ>13.8.10. もっと詳しく知りたい人へ<a class=anchor href=#_もっと詳しく知りたい人へ></a></h3><div class=paragraph><p><a href=http://www.openssh.com/>OpenSSH</a> ウェブサイト</p></div><div class=paragraph><p>クライアントオプションについて <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;format=html">ssh(1)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=scp&amp;sektion=1&amp;format=html">scp(1)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh-keygen&amp;sektion=1&amp;format=html">ssh-keygen(1)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh-agent&amp;sektion=1&amp;format=html">ssh-agent(1)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh-add&amp;sektion=1&amp;format=html">ssh-add(1)</a> および <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh_config&amp;sektion=5&amp;format=html">ssh_config(5)</a></p></div><div class=paragraph><p>サーバオプションについて <a href="https://man.freebsd.org/cgi/man.cgi?query=sshd&amp;sektion=8&amp;format=html">sshd(8)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=sftp-server&amp;sektion=8&amp;format=html">sftp-server(8)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=sshd_config&amp;sektion=5&amp;format=html">sshd_config(5)</a></p></div></div></div></div><div class=sect1><h2 id=fs-acl>13.9. ファイルシステムアクセス制御リスト (ACL)<a class=anchor href=#fs-acl></a></h2><div class=sectionbody><div class=paragraph><p>アクセス制御リスト (ACL) は、標準的な UNIX® のパーミッションモデルを、 POSIX®.1e に互換する方法で拡張しています。 これにより、管理者がより洗練されたセキュリティモデルを利用し、 その恩恵を受けられるようになります。</p></div><div class=paragraph><p>FreeBSD の <span class=filename>GENERIC</span> カーネルは、 UFS ファイルシステム用の ACL サポートを提供します。 カスタムカーネルをコンパイルして使用するユーザは、 カスタムカーネルのコンフィグレーションファイルに以下を追加してください。</p></div><div class="literalblock programlisting"><div class=content><pre>options UFS_ACL</pre></div></div><div class=paragraph><p>もしこのオプションが組み込まれていなければ、ACL に対応したファイルシステムをマウントしようとすると、 警告が表示されます。ACL は、ファイルシステムの拡張属性が有効になっていることに依存しています。 拡張属性は、UFS2 でネイティブ対応されています。</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>UFS1 に拡張属性を付すように設定するのは、 UFS2 よりも高いレベルの管理オーバヘッドが必要になります。 また、UFS2 における拡張属性のパフォーマンスも大きく上がっています。 そのため、アクセス制御リストを利用する上では UFS2 を使うことが推奨されます。</p></div></td></tr></tbody></table></div><div class=paragraph><p>ACL は、マウント時の管理フラグ <code>acls</code> で有効にされます。 これは <span class=filename>/etc/fstab</span> に記述できます。 マウント時のフラグは、<a href="https://man.freebsd.org/cgi/man.cgi?query=tunefs&amp;sektion=8&amp;format=html">tunefs(8)</a> を使って、ファイルシステムヘッダのスーパブロックにある ACL フラグを変更するという方法で、 常に自動で設定されるようになります。一般的には、 下記の理由からスーパブロックフラグを使う方がよいでしょう。</p></div><div class=ulist><ul><li><p>マウント時に指定した ACL フラグは <code>mount -u</code> による再マウントでは変更できません。 完全に <a href="https://man.freebsd.org/cgi/man.cgi?query=umount&amp;sektion=8&amp;format=html">umount(8)</a> した上で、新たに <a href="https://man.freebsd.org/cgi/man.cgi?query=mount&amp;sektion=8&amp;format=html">mount(8)</a> するしかありません。これは、起動後にルートファイルシステムで ACL を有効にできないことを意味します。 また、ファイルシステムを利用し始めた後では、 その配列を変えられないことも意味しています。</p></li><li><p>スーパブロックフラグを設定すると、<span class=filename>fstab</span> に記述されていなかったり、デバイスの順番が変わってしまっても、常に ACL が有効な状態でマウントされます。 こうすることで、ファイルシステムを ACL を有効にしないままマウントしてしまい、ACL が正しくないかたちで強制されるセキュリティの問題を防ぎます。</p></li></ul></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>予期せず ACL を有効にしないでマウントしてしまうことを防ぐことが望まれます。 ACL を有効にし、その後無効にしてから、 拡張属性を取り消さないでまた有効にしてしまうと、 大変な状況になってしまいます。 一般的には、一度ファイルシステムで ACL を有効にしたら、無効にすべきではありません。そうしてしまうと、 ファイル保護がシステムのユーザの意図と齟齬をきたす可能性があるばかりか、 ACL を再度有効にすると、 それまでパーミッションが変更されてきたファイルに古い ACL を割り当ててしまい、 予想しない動作につながることも考えられます。</p></div></td></tr></tbody></table></div><div class=paragraph><p>ACL を有効にしたファイルシステムは、 パーミッション設定の表示に <code>+</code> (プラス) 記号がつきます。例えば、次のようになります。</p></div><div class="literalblock programlisting"><div class=content><pre>drwx------  2 robert  robert  512 Dec 27 11:54 private
drwxrwx---+ 2 robert  robert  512 Dec 23 10:57 directory1
drwxrwx---+ 2 robert  robert  512 Dec 22 10:20 directory2
drwxrwx---+ 2 robert  robert  512 Dec 27 11:57 directory3
drwxr-xr-x  2 robert  robert  512 Nov 10 11:54 public_html</pre></div></div><div class=paragraph><p>この例では、ディレクトリ <span class=filename>directory1</span>, <span class=filename>directory2</span> および <span class=filename>directory3</span> のすべてで ACL が働いています。 一方 <span class=filename>public_html</span> は対象外です。</p></div><div class=sect2><h3 id=_acl_を利用する>13.9.1. ACL を利用する<a class=anchor href=#_acl_を利用する></a></h3><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=getfacl&amp;sektion=1&amp;format=html">getfacl(1)</a> は、 ファイルシステムの ACL を表示します。 たとえば、<span class=filename>test</span> の ACL 設定を表示するには、 以下のコマンドを実行してください。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% getfacl <span class=nb>test</span>
	<span class=c>#file:test</span>
	<span class=c>#owner:1001</span>
	<span class=c>#group:1001</span>
	user::rw-
	group::r--
	other::r--</code></pre></div></div><div class=paragraph><p>このファイルの ACL 設定を変更するには、 <a href="https://man.freebsd.org/cgi/man.cgi?query=setfacl&amp;sektion=1&amp;format=html">setfacl(1)</a> を使用してください。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% setfacl <span class=nt>-k</span> <span class=nb>test</span></code></pre></div></div><div class=paragraph><p>ファイルまたはファイルシステムから、 現在設定されている ACL をすべて取り除くには、<code>-k</code> を使ってください。 しかしながら、より好ましい方法は、 <code>-b</code> を使う方法です。 このオプションを使うと、ACL が動作するのに必要な基本のフィールドは残ります。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% setfacl <span class=nt>-m</span> u:trhodes:rwx,group:web:r--,o::--- <span class=nb>test</span></code></pre></div></div><div class=paragraph><p>この例では、<code>-m</code> は、デフォルト ACL エントリを修正するために使われています。 先ほどのコマンドで設定は削除されたため、 定義されたエントリはありません。 このコマンドは、デフォルトオプションに戻し、 指定したオプションを割り当てます。 システムに存在しないユーザまたはグループを追加すると、 <code>Invalid argument</code> エラーが出力されてしまいます。</p></div></div></div></div><div class=sect1><h2 id=security-portaudit>13.10. サードパーティ製ソフトウェアのセキュリティ問題を監視する<a class=anchor href=#security-portaudit></a></h2><div class=sectionbody><div class=paragraph><p>近年、セキュリティの分野では、 脆弱性の評価方法に関して多くの改善が行わています。 今日ではどのオペレーティングシステムにおいても、 システムへの侵入の脅威は、 サードパーティ製ユーティリティをインストールし、 設定するほどに増加していきます。</p></div><div class=paragraph><p>脆弱性を評価することは、セキュリティにおいて主要な要素です。 FreeBSD は、ベースシステムに対して勧告を発行していますが、 すべてのサードパーティ製ユーティリティに対して勧告を発行することは、 FreeBSD プロジェクトの能力を超えています。 サードパーティ製ユーティリティに関わる脆弱性を軽減し、 管理者に対し、既知のセキュリティ問題について警告する方法が存在します。 FreeBSD には、portaudit と呼ばれる追加のユーティリティが、 この目的のために用意されています。</p></div><div class=paragraph><p><a class=package href=https://cgit.freebsd.org/ports/tree/ports-mgmt/portaudit/>ports-mgmt/portaudit</a> port は、FreeBSD セキュリティチームおよび ports 開発者がアップデートし、管理している、 既知のセキュリティ問題に対するデータベースを入手します。</p></div><div class=paragraph><p>Ports Collection から portaudit をインストールするには、以下のように実行してください。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/ports/ports-mgmt/portaudit &amp;&amp; make install clean</span></code></pre></div></div><div class=paragraph><p>インストールの途中で、 <a href="https://man.freebsd.org/cgi/man.cgi?query=periodic&amp;sektion=8&amp;format=html">periodic(8)</a> の設定ファイルはアップデートされ、 毎日のセキュリティに関するスクリプトの実行中に portaudit が出力するように設定されます。 毎日のセキュリティに関するスクリプトの実行結果のメールが読めることを確認してください。 このメールは、<code>root</code> アカウントに送られます。 他の設定は必要ありません。</p></div><div class=paragraph><p>インストールが終わったら、管理者は以下のコマンドを実行することで、 データベースをアップデートし、インストールされている package の脆弱性を調べることができます。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># portaudit -Fda</span></code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>データベースは、 <a href="https://man.freebsd.org/cgi/man.cgi?query=periodic&amp;sektion=8&amp;format=html">periodic(8)</a> の実行中に自動的にアップデートされます。 先程のコマンドの実行は任意で、 データベースを手動で直ちにアップデートするときに使われます。</p></div></td></tr></tbody></table></div><div class=paragraph><p>Ports Collection からインストールされたサードパーティ製ユーティリティを監査するには、 管理者は以下のコマンドを実行する必要があります。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># portaudit -a</span></code></pre></div></div><div class=paragraph><p>portaudit は、インストールされている package の中で、 脆弱性のあるものについて以下のようなメッセージを出力します。</p></div><div class="literalblock programlisting"><div class=content><pre>Affected package: cups-base-1.1.22.0_1
Type of problem: cups-base -- HPGL buffer overflow vulnerability.
Reference: &lt;http://www.FreeBSD.org/ports/portaudit/40a3bca2-6809-11d9-a9e7-0001020eed82.html&gt;

1 problem(s) in your installed packages found.

You are advised to update or deinstall the affected package(s) immediately.</pre></div></div><div class=paragraph><p>表示されている URL をウェブブラウザで開くと、管理者は、 脆弱性についてより多くの情報を得ることができます。 ここでの出力では、影響するバージョンが FreeBSD の port バージョンにより示され、 セキュリティ勧告を含む他のウェブサイトが含まれています。</p></div><div class=paragraph><p>portaudit は強力で、 portmaster port と共に使うときわめて有用なユーティリティです。</p></div></div></div><div class=sect1><h2 id=security-advisories>13.11. FreeBSD セキュリティ勧告<a class=anchor href=#security-advisories></a></h2><div class=sectionbody><div class=paragraph><p>多くの高品質なオペレーティングシステムのプロジェクト同様、 FreeBSD プロジェクトはセキュリティチームを持っています。
このチームは責任をもって、各 FreeBSD リリースに対する保守終了 (End-of-Life (EoL)) 日を決めたり、サポートされているリリースに対して、EoL までセキュリティアップデートを提供しています。
FreeBSD セキュリティチームおよびサポートされているリリースについての情報は、<a href=https://www.FreeBSD.org/ja/security>FreeBSD セキュリティページ</a> で提供されています。</p></div><div class=paragraph><p>セキュリティチームの仕事の 1 つは FreeBSD オペレーティングシステムのセキュリティ脆弱性に対応することです。
脆弱性が確認されると、セキュリティチームは脆弱性を修正するために必要となる手続きを検証し、修正を含めるようにソースコードをアップデートします。
その後、詳細を "セキュリティ勧告" として発行しています。
セキュリティ勧告は、 <a href=https://www.FreeBSD.org/ja/security/advisories/>FreeBSD ウェブサイト</a> で公開され、 <a href=https://lists.FreeBSD.org/subscription/freebsd-security-notifications>FreeBSD security notifications メーリングリスト</a>, <a href=https://lists.FreeBSD.org/subscription/freebsd-security>FreeBSD security メーリングリスト</a>, および <a href=https://lists.FreeBSD.org/subscription/freebsd-announce>FreeBSD announcements メーリングリスト</a> メーリングリストに投稿されます。</p></div><div class=paragraph><p>この章では、セキュリティ勧告とはどのようなものか説明します。</p></div><div class=sect2><h3 id=_セキュリティ勧告はどのようなものか>13.11.1. セキュリティ勧告はどのようなものか？<a class=anchor href=#_セキュリティ勧告はどのようなものか></a></h3><div class=paragraph><p>以下は FreeBSD セキュリティ勧告の例です。</p></div><div class="literalblock programlisting"><div class=content><pre>=============================================================================
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

=============================================================================
FreeBSD-SA-14:04.bind                                       Security Advisory
                                                          The FreeBSD Project

Topic:          BIND remote denial of service vulnerability

Category:       contrib
Module:         bind
Announced:      2014-01-14
Credits:        ISC
Affects:        FreeBSD 8.x and FreeBSD 9.x
Corrected:      2014-01-14 19:38:37 UTC (stable/9, 9.2-STABLE)
                2014-01-14 19:42:28 UTC (releng/9.2, 9.2-RELEASE-p3)
                2014-01-14 19:42:28 UTC (releng/9.1, 9.1-RELEASE-p10)
                2014-01-14 19:38:37 UTC (stable/8, 8.4-STABLE)
                2014-01-14 19:42:28 UTC (releng/8.4, 8.4-RELEASE-p7)
                2014-01-14 19:42:28 UTC (releng/8.3, 8.3-RELEASE-p14)
CVE Name:       CVE-2014-0591

For general information regarding FreeBSD Security Advisories,
including descriptions of the fields above, security branches, and the
following sections, please visit &lt;URL:http://security.FreeBSD.org/&gt;.

I.   Background

BIND 9 is an implementation of the Domain Name System (DNS) protocols.
The named(8) daemon is an Internet Domain Name Server.

II.  Problem Description

Because of a defect in handling queries for NSEC3-signed zones, BIND can
crash with an &#34;INSIST&#34; failure in name.c when processing queries possessing
certain properties.  This issue only affects authoritative nameservers with
at least one NSEC3-signed zone.  Recursive-only servers are not at risk.

III. Impact

An attacker who can send a specially crafted query could cause named(8)
to crash, resulting in a denial of service.

IV.  Workaround

No workaround is available, but systems not running authoritative DNS service
with at least one NSEC3-signed zone using named(8) are not vulnerable.

V.   Solution

Perform one of the following:

1) Upgrade your vulnerable system to a supported FreeBSD stable or
release / security branch (releng) dated after the correction date.

2) To update your vulnerable system via a source code patch:

The following patches have been verified to apply to the applicable
FreeBSD release branches.

a) Download the relevant patch from the location below, and verify the
detached PGP signature using your PGP utility.

[FreeBSD 8.3, 8.4, 9.1, 9.2-RELEASE and 8.4-STABLE]
# fetch http://security.FreeBSD.org/patches/SA-14:04/bind-release.patch
# fetch http://security.FreeBSD.org/patches/SA-14:04/bind-release.patch.asc
# gpg --verify bind-release.patch.asc

[FreeBSD 9.2-STABLE]
# fetch http://security.FreeBSD.org/patches/SA-14:04/bind-stable-9.patch
# fetch http://security.FreeBSD.org/patches/SA-14:04/bind-stable-9.patch.asc
# gpg --verify bind-stable-9.patch.asc

b) Execute the following commands as root:

# cd /usr/src
# patch &lt; /path/to/patch

Recompile the operating system using buildworld and installworld as
described in &lt;URL:https://www.FreeBSD.org/handbook/makeworld.html&gt;.

Restart the applicable daemons, or reboot the system.

3) To update your vulnerable system via a binary patch:

Systems running a RELEASE version of FreeBSD on the i386 or amd64
platforms can be updated via the man:freebsd-update[8] utility:

# freebsd-update fetch
# freebsd-update install

VI.  Correction details

The following list contains the correction revision numbers for each
affected branch.

Branch/path                                                      Revision
- -------------------------------------------------------------------------
stable/8/                                                         r260646
releng/8.3/                                                       r260647
releng/8.4/                                                       r260647
stable/9/                                                         r260646
releng/9.1/                                                       r260647
releng/9.2/                                                       r260647
- -------------------------------------------------------------------------

To see which files were modified by a particular revision, run the
following command, replacing NNNNNN with the revision number, on a
machine with Subversion installed:

# svn diff -cNNNNNN --summarize svn://svn.freebsd.org/base

Or visit the following URL, replacing NNNNNN with the revision number:

&lt;URL:https://svnweb.freebsd.org/base?view=revision&amp;revision=NNNNNN&gt;

VII. References

&lt;URL:https://kb.isc.org/article/AA-01078&gt;

&lt;URL:http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-0591&gt;

The latest revision of this advisory is available at
&lt;URL:http://security.FreeBSD.org/advisories/FreeBSD-SA-14:04.bind.asc&gt;
-----BEGIN PGP SIGNATURE-----

iQIcBAEBCgAGBQJS1ZTYAAoJEO1n7NZdz2rnOvQP/2/68/s9Cu35PmqNtSZVVxVG
ZSQP5EGWx/lramNf9566iKxOrLRMq/h3XWcC4goVd+gZFrvITJSVOWSa7ntDQ7TO
XcinfRZ/iyiJbs/Rg2wLHc/t5oVSyeouyccqODYFbOwOlk35JjOTMUG1YcX+Zasg
ax8RV+7Zt1QSBkMlOz/myBLXUjlTZ3Xg2FXVsfFQW5/g2CjuHpRSFx1bVNX6ysoG
9DT58EQcYxIS8WfkHRbbXKh9I1nSfZ7/Hky/kTafRdRMrjAgbqFgHkYTYsBZeav5
fYWKGQRJulYfeZQ90yMTvlpF42DjCC3uJYamJnwDIu8OhS1WRBI8fQfr9DRzmRua
OK3BK9hUiScDZOJB6OqeVzUTfe7MAA4/UwrDtTYQ+PqAenv1PK8DZqwXyxA9ThHb
zKO3OwuKOVHJnKvpOcr+eNwo7jbnHlis0oBksj/mrq2P9m2ueF9gzCiq5Ri5Syag
Wssb1HUoMGwqU0roS8+pRpNC8YgsWpsttvUWSZ8u6Vj/FLeHpiV3mYXPVMaKRhVm
067BA2uj4Th1JKtGleox+Em0R7OFbCc/9aWC67wiqI6KRyit9pYiF3npph+7D5Eq
7zPsUdDd+qc+UTiLp3liCRp5w6484wWdhZO6wRtmUgxGjNkxFoNnX8CitzF8AaqO
UWWemqWuz3lAZuORQ9KX
=OQzQ
-----END PGP SIGNATURE-----</pre></div></div><div class=paragraph><p>すべてのセキュリティ勧告は以下のフォーマットに基づいています。</p></div><div class=ulist><ul><li><p>各セキュリティ勧告には、セキュリティオフィサの PGP 鍵により署名されています。セキュリティオフィサの公開鍵は、<a href=../pgpkeys/#pgpkeys>OpenPGP 鍵</a> で検証できます。</p></li><li><p>FreeBSD のセキュリティ勧告の名前は常に <code>FreeBSD-SA-</code> で始まり、次に年を表す 2 桁の数字 (<code>14:</code>)、年毎の勧告の番号 (<code>04.</code>) 、そして影響するアプリケーションまたはサブシステムの名前 (<code>bind</code>) が続きます。この例は、2014 年の 4 番目の勧告で BIND に影響する脆弱性に対する勧告を意味しています。</p></li><li><p><code>Topic</code> フィールドでは、脆弱性について明記されています。</p></li><li><p><code>Category</code> では、脆弱性がシステムのどの部分に影響するかを示します。 <code>core</code>, <code>contrib</code> または <code>ports</code> のどれかが示されます。 <code>core</code> カテゴリは、 FreeBSD オペレーティングシステムの <code>core</code> コンポーネントに影響する脆弱性であることを意味します。 <code>contrib</code> カテゴリは、BIND のように FreeBSD に取り込まれているソフトウェアに影響する脆弱性であることを意味します。 <code>ports</code> カテゴリは、Ports Collection からインストールされるソフトウェアに影響する脆弱性であることを示しています。</p></li><li><p><code>Module</code> フィールドは、 影響するコンポーネントについて言及します。 この例では <code>bind</code> モジュールに影響することがわかります。 そのため、この脆弱性は、オペレーティングシステムとともにインストールされたアプリケーションに影響します。</p></li><li><p><code>Announced</code> フィールドには、セキュリティ勧告が発行された日が記載されています。 セキュリティチームによりこの問題が存在することが確認され、パッチが FreeBSD ソースコードリポジトリにコミットされたことを意味します。</p></li><li><p><code>Credits</code> フィールドは、脆弱性を発見し、報告した個人または組織を示します。</p></li><li><p><code>Affects</code> フィールドは、この脆弱性がどの FreeBSD リリースに影響するかを示しています。</p></li><li><p><code>Corrected</code> フィールドには、脆弱性が修正された日、時間、タイムゾーン、およびリリースが示されます。この括弧の中では、修正がマージされた各ブランチ、およびそのブランチで対応するリリースのバージョン番号が示されています。リリースの識別子には、バージョン番号、可能な場合はパッチレベルが含まれています。パッチレベルは <code>p</code> に番号が続いたものです。この番号はパッチのシーケンス番号で、この番号を確認することで、ユーザはどのパッチまでがシステムに適用されているかを追跡できます。</p></li><li><p><code>CVE Name</code> フィールドは、該当する脆弱性が <a href=http://cve.mitre.org>cve.mitre.org</a> セキュリティ脆弱性データベースに存在する場合に、脆弱性の番号一覧を示します。</p></li><li><p><code>Background</code> フィールドは、影響しているモジュールに関する情報を示します。</p></li><li><p><code>Problem Description</code> フィールドは、脆弱性について説明します。 問題のあるコードの情報や、このユーティリティがどのように悪意のある使われ方をされうるかといったことが示されます。</p></li><li><p><code>Impact</code> フィールドは、 この問題がシステムに対して、 どのような形式の影響を与えるかについて示します。</p></li><li><p><code>Workaround</code> フィールドは、何らかの理由により、すぐにシステムにパッチを当てることのできないシステム管理者に対して、回避方法が存在する場合にその方法を提供します。</p></li><li><p><code>Solution</code> フィールドは、影響のあるシステムにパッチを当てる手順を提供します。ここではステップごとにシステムにパッチを当て、安全に動作するように、試験され検証された方法が記載されます。</p></li><li><p><code>Correction Details</code> フィールドは、影響する各 Subversion ブランチに対する修正されたコードが取り込まれたリビジョン番号をを示します。</p></li><li><p><code>References</code> フィールドは、脆弱性に関連する他の情報へのソースを提供します。</p></li></ul></div></div></div></div><div class=sect1><h2 id=security-accounting>13.12. プロセスアカウンティング<a class=anchor href=#security-accounting></a></h2><div class=sectionbody><div class=paragraph><p>プロセスアカウンティングは、 管理者が使用されているシステムのリソースを記録したり、 リソースのユーザへの割り当て、 システムのモニタリングおよびユーザのコマンドの最低限の記録を提供します。</p></div><div class=paragraph><p>これは実際には、長所と短所があります。 長所の一つは、侵入を入り口の時点で絞ることができます。 短所は、プロセスアカウンティングにより生成されるログの量で、 多くのディスク容量を必要とします。この節では、 管理者を対象にプロセスアカウンティングの基礎を説明します。</p></div><div class=sect2><h3 id=_プロセスアカウンティングを有効にする>13.12.1. プロセスアカウンティングを有効にする<a class=anchor href=#_プロセスアカウンティングを有効にする></a></h3><div class=paragraph><p>プロセスアカウンティングを使用する前に、 以下のコマンドを使って、 プロセスアカウンティングを有効にしておく必要があります。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># touch /var/account/acct</span>
<span class=c># chmod 600 /var/account/acct</span>
<span class=c># accton /var/account/acct</span>
<span class=c># echo &#39;accounting_enable=&#34;YES&#34;&#39; &gt;&gt; /etc/rc.conf</span></code></pre></div></div><div class=paragraph><p>一度有効に設定すると、アカウンティングは、 CPU の統計、 実行されたコマンドの情報の追跡を開始します。 すべてのアカウンティングログは、 人が読めるような形式ではなく、 <a href="https://man.freebsd.org/cgi/man.cgi?query=sa&amp;sektion=8&amp;format=html">sa(8)</a> を使って見ることができます。 オプションを設定せずに実行すると、 <a href="https://man.freebsd.org/cgi/man.cgi?query=sa&amp;sektion=8&amp;format=html">sa(8)</a> はユーザコールの数、全経過時間 (分)、 全 CPU、ユーザの時間 (分)、および I/O 操作の平均数などを出力します。</p></div><div class=paragraph><p>実行されたコマンドに関する情報を見るには、 <a href="https://man.freebsd.org/cgi/man.cgi?query=lastcomm&amp;sektion=1&amp;format=html">lastcomm(1)</a> を使ってください。 このコマンドは、 ユーザが特定の <a href="https://man.freebsd.org/cgi/man.cgi?query=ttys&amp;sektion=5&amp;format=html">ttys(5)</a> で実行したコマンドを出力します。 たとえば、以下のコマンドは <code>ttyp1</code> ターミナル上で <code>trhodes</code> が実行した <a href="https://man.freebsd.org/cgi/man.cgi?query=ls&amp;sektion=1&amp;format=html">ls(1)</a> の使用について、記録されているすべて示します。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># lastcomm ls trhodes ttyp1</span></code></pre></div></div><div class=paragraph><p>他にも有用なオプションが多くあり、 <a href="https://man.freebsd.org/cgi/man.cgi?query=lastcomm&amp;sektion=1&amp;format=html">lastcomm(1)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=acct&amp;sektion=5&amp;format=html">acct(5)</a> および <a href="https://man.freebsd.org/cgi/man.cgi?query=sa&amp;sektion=8&amp;format=html">sa(8)</a> で説明されています。</p></div></div></div></div><div class=sect1><h2 id=security-resourcelimits>13.13. リソースの制限<a class=anchor href=#security-resourcelimits></a></h2><div class=sectionbody><div class=paragraph><p>FreeBSD は、個々のユーザが利用できるシステムのリソース容量を制限する方法をいくつも用意しています。
ディスククォータはユーザが使用できるディスク容量を制限します。
クォータについては <a href=../disks/#quotas>「ディスククォータ」</a> で説明されています。</p></div><div class=paragraph><p>その他のリソースの制限とは、ユーザが消費できる CPU、メモリなどのリソースを制限する手段のことです。
フラットファイルまたはコマンドによりリソースの制限に関わるデータベースを管理できます。
伝統的な方法では、ログインクラスを <span class=filename>/etc/login.conf</span> を編集することにより定義します。
この方法は、現在でも使われていますが、変更を行うには、このファイルの編集、リソースデータベースの再構築、 <span class=filename>/etc/master.passwd</span> への必要な変更、さらに、パスワードデータベースの再構築といった、複数回に渡るプロセスが必要です。
この複数回に渡るプロセスは、 多くのユーザについて設定する必要がある場合には、 大変な時間の浪費につながる可能性があります。</p></div><div class=paragraph><p><code>rctl</code> を用いると、よりきめ細かにリソースの制限を管理する方法を提供できます。
このコマンドは、ユーザだけではなく、プロセスおよび jails に対してもリソースを制限できます。</p></div><div class=paragraph><p>この節では、リソースを管理する方法について伝統的な方法と高度な方法の両方について説明します。</p></div><div class=sect2><h3 id=users-limiting>13.13.1. ログインクラスの設定<a class=anchor href=#users-limiting></a></h3><div class=paragraph><p>伝統的な方法では、ログインクラスおよびログインクラスに適用するリソースの制限は <span class=filename>/etc/login.conf</span> で定義します。
各ユーザアカウントにはログインクラスが割り当てられています (デフォルトでは <code>default</code> です)。
それぞれのログインクラスには関連するログインケーパビリティの集合が割り当てられています。
ログインケーパビリティとは、 <code>名称=値</code> の組のことで、<em>名称</em> は周知の識別子、<em>値</em> は、<em>名称</em> に応じて処理される任意の文字列です。</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p><span class=filename>/etc/login.conf</span> を編集する時には <span class=filename>/etc/login.conf.db</span> を次のコマンドを実行してアップデートする必要があります。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cap_mkdb /etc/login.conf</span></code></pre></div></div></td></tr></tbody></table></div><div class=paragraph><p>リソースの制限は、 2 つの点で標準的なログインケーパビリティと異なっています。
第一に、どの制限についても、 <em>ソフト</em> リミットと _ハード _リミットがあります。
ソフトリミットは、ユーザやアプリケーションが調整できますが、 ハードリミットを超えることはできません。
ユーザはハードリミットを下げることはできますが、 上げることはスーパユーザのみができます。
第二に、ほとんどのリソースの制限は特定のユーザに対してプロセス毎に適用されるものです。</p></div><div class=paragraph><p><a href=#resource-limits>ログインクラスのリソースの制限</a> が最もよく使われるリソースの制限です。
利用可能なすべてのリソースの制限およびのログインケーパビリティの詳細については、 <a href="https://man.freebsd.org/cgi/man.cgi?query=login.conf&amp;sektion=5&amp;format=html">login.conf(5)</a> に書かれています。</p></div><table id=resource-limits class="tableblock frame-none grid-all stretch"><caption class=title>表 1. ログインクラスのリソースの制限</caption><col style=width:20%><col style=width:80%><thead><tr><th class="tableblock halign-left valign-top">リソースの制限</th><th class="tableblock halign-left valign-top">説明</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock>coredumpsize</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>プログラムが生成する core ファイルのサイズにかかる制限は、 <code>filesize</code> やディスククォータなどの、 ほかのディスク使用に関する制限に従属します。
この制限は、ディスク領域の消費を制御するあまり厳しくない手段としてよく使われています。
ユーザは core ファイルを自分で生成するわけではなく、削除しないことも多いので、 これを設定すれば大きなプログラムが異常終了してもディスクの空きがなくならずに済みます。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>cputime</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>そのユーザのプロセスが消費できる CPU 時間の上限です。
これを超えたプロセスは、カーネルにより終了されます。
これは、消費される CPU <em>時間</em> についての制限であって、<code>top</code> や <code>ps</code> のフィールドで表示される CPU の割合に関するものではありません。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>filesize</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>ユーザが所有できるファイルの大きさの上限です。
ディスククォータ (crossref:disks[quotas,「ディスククォータ」) と違い、この制限はユーザのファイルをすべてまとめた集合にではなく、個々のファイルにかかります。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>maxproc</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>ユーザが実行できるフォアグラウンドとバックグラウンドプロセス数の上限です。
この上限は、<code>kern.maxproc</code> で指定されたシステムの制限を超えることはできません。
この値をあまり小さな値に設定すると、大きなプログラムをコンパイルする場合のように、複数のプロセスが実行されるようなタスクにおいて、ユーザの生産性が悪化する可能性があります。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>memorylocked</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>1 つのプロセスが <a href="https://man.freebsd.org/cgi/man.cgi?query=mlock&amp;sektion=2&amp;format=html">mlock(2)</a> によりメインメモリにロックされることを要求できるメモリの最大容量です。
<a href="https://man.freebsd.org/cgi/man.cgi?query=amd&amp;sektion=8&amp;format=html">amd(8)</a> のようなシステムで重要なプログラムは、 メインメモリへロックして、システムがスワップする際に、 ディスクのスラッシングを引き起こさないようにします。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>memoryuse</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>どの時点かを問わず、あるプロセスが消費できる最大のメモリ容量です。
これは、メインメモリとスワップの使用量を合わせたものです。
メモリ消費を抑えるための包括的な制限ではありませんが、手始めにはよいでしょう。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>openfiles</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>あるプロセスが開いておける最大のファイル数です。
FreeBSD では、ファイルは、ソケットや IPC チャンネルを表わすのにも使われているので、あまり低い値に設定しないよう注意してください。
これに対応するシステム全体の制限は <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a> <code>kern.maxfiles</code> で定義されます。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>sbsize</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>あるユーザが消費できるネットワークメモリの上限の量です。
これは、ネットワーク通信を制限するのに使えます。</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>stacksize</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>プロセスのスタックサイズの上限です。
あるプログラムが使用しうるメモリの量を制限するには、これだけでは十分ではないので、他の制限と組み合わせて使わなければなりません。</p></td></tr></tbody></table><div class=paragraph><p>リソースの制限を設定するにあたり、ほかにもいくつか覚えておかなければならないことがあります。</p></div><div class=ulist><ul><li><p>システム起動時に <span class=filename>/etc/rc</span> から起動されたプロセスは、<code>daemon</code> ログインクラスに割り当てられます。</p></li><li><p>システムに付属している <span class=filename>/etc/login.conf</span> はほとんどの制限について妥当な値になっていますが、すべてのシステムにおいてふさわしいというわけではありません。
制限をあまり緩くするとシステムを悪用しやすくしてしまいますし、厳しくしすぎると生産性を悪化させてしまいます。</p></li><li><p>Xorg は多くのリソースを使うだけでなく、より多くのプログラムを並行して使うことをユーザに促します。</p></li><li><p>多くの制限は個々のプロセスにかかるもので、一人のユーザにまとめてかかるものではありません。
例えば、<code>openfiles</code> を 50 に設定することは、ユーザが動かすそれぞれのプロセスが最大 50 個のファイルを開けるということです。
あるユーザが開けるファイルの総数は、 <code>openfiles</code> の値に <code>maxproc</code> をかけたものになります。
同じことがメモリ消費量にもあてはまります。</p></li></ul></div><div class=paragraph><p>リソースの制限と、ログインクラス、 ログインケーパビリティ一般についての詳しい情報は、 <a href="https://man.freebsd.org/cgi/man.cgi?query=cap.mkdb&amp;sektion=1&amp;format=html">cap.mkdb(1)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=getrlimit&amp;sektion=2&amp;format=html">getrlimit(2)</a> および <a href="https://man.freebsd.org/cgi/man.cgi?query=login.conf&amp;sektion=5&amp;format=html">login.conf(5)</a> をご覧ください。</p></div></div><div class=sect2><h3 id=_リソースの制限を有効にして設定する>13.13.2. リソースの制限を有効にして設定する<a class=anchor href=#_リソースの制限を有効にして設定する></a></h3><div class=paragraph><p><code>kern.racct.enable</code> をゼロ以外の値に設定してください。
カスタムカーネルには以下のような特別な設定が必要となります。</p></div><div class="literalblock programlisting"><div class=content><pre>options         RACCT
options         RCTL</pre></div></div><div class=paragraph><p>システムを再起動して新しいカーネルで立ち上げると、<code>rctl</code> を用いてシステムにルールを設定できるようになります。</p></div><div class=paragraph><p>ルールの構文は、 subject, subject-id, resource および action を使って管理されます。
以下のルールの例を参照してください。</p></div><div class="literalblock programlisting"><div class=content><pre>user:trhodes:maxproc:deny=10/user</pre></div></div><div class=paragraph><p>この例では、subject は <code>user</code>、subject-id は <code>trhodes</code>、resource の <code>maxproc</code> はプロセスの最大数、そして action は <code>deny</code> と設定されており、 新しいプロセスの生成がブロックされます。
これは、ユーザ <code>trhodes</code> のプロセスは <code>10</code> 個に制限され、それ以上のプロセスは作成できないことを意味しています。
他には、コンソールにログを出力したり、 <a href="https://man.freebsd.org/cgi/man.cgi?query=devd&amp;sektion=8&amp;format=html">devd(8)</a> に対し通知したり、プロセスに sigterm を送ったりといった action も利用できます。</p></div><div class=paragraph><p>ルールを追加する際には、注意すべき点がいくつかあります。
上の例では、プロセスの数が <code>10</code> に制限されているため、ログインして <code>screen</code> セッションを実行してしまうと、ユーザによる他のタスクの実行はブロックされてしまうでしょう。
リソースの制限が適応されると、エラーが出力されます。
この例では以下のような出力が行われます。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% man <span class=nb>test</span>
    /usr/bin/man: Cannot fork: Resource temporarily unavailable
<span class=nb>eval</span>: Cannot fork: Resource temporarily unavailable</code></pre></div></div><div class=paragraph><p>他の例としては、jail がメモリの制限を超えることを防ぐことができます。
このルールは以下のように書くことができます。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># rctl -a jail:httpd:memoryuse:deny=2G/jail</span></code></pre></div></div><div class=paragraph><p>ルールを <span class=filename>/etc/rctl.conf</span> に追加すると、再起動してもルールは持続します。
フォーマットは、ルールから最初のコマンドの部分を除いたものとなります。
たとえば、上のルールを追加するには、以下のように追加してください。</p></div><div class="literalblock programlisting"><div class=content><pre># Block jail from using more than 2G memory:
jail:httpd:memoryuse:deny=2G/jail</pre></div></div><div class=paragraph><p>ルールを削除するには、<code>rctl</code> に対し、リストから削除するように指定してください。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># rctl -r user:trhodes:maxproc:deny=10/user</span></code></pre></div></div><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=rctl&amp;sektion=8&amp;format=html">rctl(8)</a> には、ルールをすべて削除する方法が記載されています。
しかしながら、特定のユーザのルールをすべて削除するには、以下のようなコマンドを実行してください。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># rctl -r user:trhodes</span></code></pre></div></div><div class=paragraph><p><code>subjects</code> をコントロールするリソースは他にも多く用意されています。
これらについて知るには、<a href="https://man.freebsd.org/cgi/man.cgi?query=rctl&amp;sektion=8&amp;format=html">rctl(8)</a> をご覧ください。</p></div></div></div></div></div><hr><div class=last-modified><p><strong>最終更新日</strong>: 2024年3月9日 by <a href="https://cgit.freebsd.org/doc/commit/?id=6199af92e7" target=_blank>Danilo G. Baio</a></p></div><div class=buttons><div class=prev><i class="fa fa-angle-left" aria-hidden=true title=Prev></i><div class=container><a href=http://172.16.201.134:1313/ja/books/handbook/boot class=direction>Prev</a></div></div><div class=home><i class="fa fa-home" aria-hidden=true title=Home></i><div class=container><a href=../ class=direction>Home</a></div></div><div class=next><div class=container><a href=http://172.16.201.134:1313/ja/books/handbook/disks class=direction>Next</a></div><i class="fa fa-angle-right" aria-hidden=true title=Next></i></div></div><label class="hidden book-menu-overlay" for=menu-control></label></div><aside class=toc><div class=toc-content><h3>目次</h3><nav id=TableOfContents><ul><li><a href=#security-synopsis>13.1. この章では</a></li><li><a href=#security-intro>13.2. はじめに</a></li><li><a href=#one-time-passwords>13.3. ワンタイムパスワード</a></li><li><a href=#tcpwrappers>13.4. TCP Wrappers</a></li><li><a href=#kerberos5>13.5. Kerberos5</a></li><li><a href=#openssl>13.6. OpenSSL</a></li><li><a href=#ipsec>13.7. VPN over IPsec</a></li><li><a href=#openssh>13.8. OpenSSH</a></li><li><a href=#fs-acl>13.9. ファイルシステムアクセス制御リスト (ACL)</a></li><li><a href=#security-portaudit>13.10. サードパーティ製ソフトウェアのセキュリティ問題を監視する</a></li><li><a href=#security-advisories>13.11. FreeBSD セキュリティ勧告</a></li><li><a href=#security-accounting>13.12. プロセスアカウンティング</a></li><li><a href=#security-resourcelimits>13.13. リソースの制限</a></li></ul></nav><hr><div class=resources><h3>リソース</h3><ul class=contents><li><i class="fa fa-file-pdf-o" aria-hidden=true title="PDF 版のダウンロード"></i><a href=https://download.freebsd.org/doc/ja/books/handbook/handbook_ja.pdf>PDF 版のダウンロード</a></li><li><i class="fa fa-pencil-square-o" aria-hidden=true title="Edit this page"></i><a href=https://github.com/freebsd/freebsd-doc/blob/main/documentation/content/ja/_index target=_blank>Edit this page</a></li></ul></div></div></aside><a class=to-top href=#top><i class="fa fa-arrow-circle-up" aria-hidden=true></i></a></main><footer><div class=footer-container><section class=logo-column><img src=http://172.16.201.134:1313/images/FreeBSD-colors.svg width=160 height=50 alt="FreeBSD logo"><div class=options-container><div class=language-container><a id=languages href=http://172.16.201.134:1313/ja/languages><img src=http://172.16.201.134:1313/images/language.png class=language-image alt="Choose language">
<span>日本語</span></a></div><div class=theme-container><select id=theme-chooser><option value=theme-system>System</option><option value=theme-light>Light</option><option value=theme-dark>Dark</option><option value=theme-high-contrast>High contrast</option></select></div></div></section><section class=about-column><h3 class=column-title>About</h3><ul class=column-elements-container><li><a href=https://www.freebsd.org/about/ target=_blank class=column-element>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/ target=_blank class=column-element>FreeBSD Foundation</a></li><li><a href=https://www.freebsd.org/where/ target=_blank class=column-element>Get FreeBSD</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct target=_blank class=column-element>Code of Conduct</a></li><li><a href=https://www.freebsd.org/security/ target=_blank class=column-element>Security Advisories</a></li></ul></section><section class=documentation-column><h3 class=column-title>Documentation</h3><ul class=column-elements-container><li><a href=/ja class=column-element>Documentation portal</a></li><li><a href=https://man.FreeBSD.org target=_blank class=column-element>Manual pages</a></li><li><a href=https://papers.FreeBSD.org target=_blank class=column-element>Presentations and papers</a></li><li><a href=https://docs-archive.freebsd.org/doc/ target=_blank class=column-element>Previous versions</a></li><li><a href=https://docs-archive.freebsd.org/44doc/ target=_blank class=column-element>4.4BSD Documents</a></li><li><a href=https://wiki.freebsd.org/ target=_blank class=column-element>Wiki</a></li></ul></section><section class=community-column><h3 class=column-title>Community</h3><ul class=column-elements-container><li><a href=http://172.16.201.134:1313/ja/articles/contributing class=column-element>Get involved</a></li><li><a href=https://forums.freebsd.org/ target=_blank class=column-element>Community forum</a></li><li><a href=https://lists.freebsd.org/ target=_blank class=column-element>Mailing lists</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank class=column-element>IRC Channels</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank class=column-element>Bug Tracker</a></li></ul></section><section class=legal-column><h3 class=column-title>Legal</h3><ul class=column-elements-container><li><a href=https://freebsdfoundation.org/donate/ target=_blank class=column-element>Donations</a></li><li><a href=https://www.freebsd.org/copyright/freebsd-license/ target=_blank class=column-element>Licensing</a></li><li><a href=https://www.freebsd.org/privacy/ target=_blank class=column-element>Privacy Policy</a></li><li><a href=https://www.freebsd.org/copyright/ target=_blank class=column-element>Legal notices</a></li></ul></section><section class=copyright-column><p>&copy; 1994-2024 The FreeBSD Project. All rights reserved</p><span>Made with <span class=heart>♥</span> by the FreeBSD Community</span></section></div></footer></body></html>