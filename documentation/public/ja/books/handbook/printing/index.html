<!doctype html><html class=theme-light lang=ja><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content><meta name=copyright content="1995-2024 The FreeBSD Foundation"><link rel=canonical href=https://docs.freebsd.org/ja/books/handbook/printing/><title>第9章 プリンタの利用 | FreeBSD Documentation Portal</title>
<meta name=theme-color content="#790000"><meta name=color-scheme content="system light dark high-contrast"><link rel="shortcut icon" href=https://docs.freebsd.org/favicon.ico><link rel=stylesheet href=https://docs.freebsd.org/styles/main.min.css><link rel=stylesheet href=https://docs.freebsd.org/css/font-awesome-min.css><script defer src=/js/theme-chooser.min.js></script><script defer src=/js/copy-clipboard.min.js></script><script defer src=/js/search.min.js></script><meta name=twitter:card content="summary"><meta name=twitter:domain content="docs.FreeBSD.org"><meta name=twitter:site content="@freebsd"><meta name=twitter:url content="https://twitter.com/freebsd"><meta property="og:title" content="第9章 プリンタの利用"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:image" content="https://docs.freebsd.org/favicon.ico"><meta property="og:image:alt" content="FreeBSD Logo"><meta property="og:locale" content="ja"><meta property="og:url" content="https://docs.freebsd.org/ja/books/handbook/printing/"><meta property="og:site_name" content="FreeBSD Documentation Portal"><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","url":"https:\/\/docs.freebsd.org\/ja\/books\/handbook\/printing\/","name":"FreeBSD Documentation Portal","headline":"FreeBSD Documentation Portal","description":"FreeBSD Documentation Portal"}</script></head><body><header><div class=header-container><div class=logo-menu-bars-container><a href=https://www.FreeBSD.org class=logo><img src=https://docs.freebsd.org/images/FreeBSD-monochromatic.svg width=160 height=50 alt="FreeBSD logo">
</a><label class=menu-bars for=menu-bars><i class="fa fa-bars" aria-hidden=true></i></label></div><input id=menu-bars type=checkbox><nav><ul class=menu><li class=menu-item><input id=about type=checkbox>
<a href=# aria-label="Navigate to About section"><label class=menu-item-description for=about>About
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/about/ target=_blank>About</a></li><li><a href=https://www.freebsd.org/about/ target=_blank>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/about-us/about-the-foundation/ target=_blank>FreeBSD Foundation</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct/ target=_blank>Code of Conduct</a></li></ul></li><li class=menu-item><input id=download type=checkbox>
<a href=# aria-label="Navigate to get FreeBSD section"><label class=menu-item-description for=download>Get FreeBSD
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/where/ target=_blank>Get FreeBSD</a></li><li><a href=https://www.freebsd.org/releases/ target=_blank>Release Information</a></li><li><a href=https://www.freebsd.org/releng/ target=_blank>Release Engineering</a></li><li><a href=https://www.freebsd.org/security/ target=_blank>Security Advisories</a></li></ul></li><li class=menu-item><input id=documentation type=checkbox>
<a href=# aria-label="Navigate to get Documentation section"><label class=menu-item-description for=documentation>Documentation
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=/ja>Documentation portal</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook>FreeBSD Handbook</a></li><li><a href=https://docs.freebsd.org/ja/books/porters-handbook>Porter's Handbook</a></li><li><a href=https://docs.FreeBSD.org/en/books/fdp-primer>Documentation Project Handbook</a></li><li><a href=https://man.FreeBSD.org target=_blank>Manual pages</a></li><li><a href=https://papers.FreeBSD.org target=_blank>Presentations and papers</a></li><li><a href=https://wiki.FreeBSD.org target=_blank>Wiki</a></li><li><a href=https://docs.freebsd.org/ja/books>Books</a></li><li><a href=https://docs.freebsd.org/ja/articles>Articles</a></li></ul></li><li class=menu-item><input id=community type=checkbox>
<a href=# aria-label="Navigate to get Community section"><label class=menu-item-description for=community>Community
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/community/>Community</a></li><li><a href=https://docs.freebsd.org/ja/articles/contributing>Get involved</a></li><li><a href=https://forums.freebsd.org/ target=_blank>Forum</a></li><li><a href=https://lists.freebsd.org/ target=_blank>Mailing lists</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank>IRC Channels</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank>Bug Tracker</a></li><li><a href=https://www.freebsd.org/support/ target=_blank>Support</a></li></ul></li></ul></nav><div class=search-donate-container><form class=search method=get id=search-header-form action=https://docs.freebsd.org/search name=search-header-form><input type=hidden name=DB value=ja>
<input id=words name=P type=text size=20 maxlength=255>
<button>
<i class="fa fa-search" aria-hidden=true></i></button></form><div class=donate><a href=https://freebsdfoundation.org/donate/ target=_blank><span class=heart>♥</span>
Donate</a></div></div></div></header><input type=checkbox class="hidden toggle" id=menu-control><main class=main-wrapper-book><a id=top></a><aside class=book-menu><div class=book-menu-content><input id=search-book type=text placeholder=Search aria-label=Search maxlength=128><nav id=MenuContents><ul><li><input type=checkbox id=chapter-eb2a98ce203d8afd517726e6d8776be3 class=toggle>
<label class="icon cursor" for=chapter-eb2a98ce203d8afd517726e6d8776be3><a role=button></a></label><a href=https://docs.freebsd.org/ja/books/handbook/preface/>前書き</a><ul><li><a href=https://docs.freebsd.org/ja/books/handbook/preface/#preface-audience>想定している読者</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/preface/#preface-changes-from3>第 3 版からの変更</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/preface/#preface-changes-from2>第 2 版 (2004) からの変更</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/preface/#preface-changes>第 1 版 (2001) からの変更</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/preface/#preface-overview>この文書の構成</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/preface/#preface-conv>この文書で用いられている表記法</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/preface/#preface-acknowledgements>謝辞</a></li></ul></li><li><input type=checkbox id=chapter-14a525fce014b90b8a458a894818255a class=toggle>
<label for=chapter-14a525fce014b90b8a458a894818255a><a role=button></a></label><a href=https://docs.freebsd.org/ja/books/handbook/parti/>パートI. 導入</a></li><li><input type=checkbox id=chapter-f9c9f3451644df30d224350da97d5da6 class=toggle>
<label class="icon cursor" for=chapter-f9c9f3451644df30d224350da97d5da6><a role=button></a></label><a href=https://docs.freebsd.org/ja/books/handbook/introduction/>第1章 はじめに</a><ul><li><a href=https://docs.freebsd.org/ja/books/handbook/introduction/#introduction-synopsis>1.1. この章では</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/introduction/#nutshell>1.2. FreeBSD へようこそ!</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/introduction/#history>1.3. FreeBSD プロジェクトについて</a></li></ul></li><li><input type=checkbox id=chapter-f693a3fa687a72d63ec8129ee302d664 class=toggle>
<label class="icon cursor" for=chapter-f693a3fa687a72d63ec8129ee302d664><a role=button></a></label><a href=https://docs.freebsd.org/ja/books/handbook/bsdinstall/>第2章 FreeBSD のインストール</a><ul><li><a href=https://docs.freebsd.org/ja/books/handbook/bsdinstall/#bsdinstall-synopsis>2.1. この章では</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/bsdinstall/#bsdinstall-hardware>2.2. 最小ハードウェア要件</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/bsdinstall/#bsdinstall-pre>2.3. インストール前に行う作業</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/bsdinstall/#bsdinstall-start>2.4. インストールの開始</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/bsdinstall/#using-bsdinstall>2.5. bsdinstall の使用</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/bsdinstall/#bsdinstall-partitioning>2.6. ディスク領域の割り当て</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/bsdinstall/#bsdinstall-fetching-distribution>2.7. 配布ファイルのダウンロード</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/bsdinstall/#bsdinstall-post>2.8. ネットワークインターフェース、アカウント、タイムゾーン、 サービスおよびセキュリティオプションの設定</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/bsdinstall/#bsdinstall-install-trouble>2.9. トラブルシューティング</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/bsdinstall/#using-live-cd>2.10. Live CD を使う</a></li></ul></li><li><input type=checkbox id=chapter-9f6db261075f578742036fcc6000eecd class=toggle>
<label class="icon cursor" for=chapter-9f6db261075f578742036fcc6000eecd><a role=button></a></label><a href=https://docs.freebsd.org/ja/books/handbook/basics/>第3章 FreeBSD の基礎知識</a><ul><li><a href=https://docs.freebsd.org/ja/books/handbook/basics/#basics-synopsis>3.1. この章では</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/basics/#consoles>3.2. 仮想コンソールと端末</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/basics/#users-synopsis>3.3. ユーザと基本的なアカウント管理</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/basics/#permissions>3.4. 許可属性</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/basics/#dirstructure>3.5. ディレクトリ構造</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/basics/#disk-organization>3.6. ディスク構成</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/basics/#mount-unmount>3.7. ファイルシステムのマウントとアンマウント</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/basics/#basics-processes>3.8. プロセスおよびデーモン</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/basics/#shells>3.9. シェル</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/basics/#editors>3.10. テキストエディタ</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/basics/#basics-devices>3.11. デバイスとデバイスノード</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/basics/#basics-more-information>3.12. マニュアルページ</a></li></ul></li><li><input type=checkbox id=chapter-01c5707e95d14c0ff84bf62600c958d1 class=toggle>
<label class="icon cursor" for=chapter-01c5707e95d14c0ff84bf62600c958d1><a role=button></a></label><a href=https://docs.freebsd.org/ja/books/handbook/ports/>第4章 アプリケーションのインストール - packages と ports</a><ul><li><a href=https://docs.freebsd.org/ja/books/handbook/ports/#ports-synopsis>4.1. この章では</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/ports/#ports-overview>4.2. ソフトウェアのインストール</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/ports/#ports-finding-applications>4.3. ソフトウェアの探し方</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/ports/#pkgng-intro>4.4. pkg によるバイナリ package の管理</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/ports/#ports-using>4.5. Ports Collection の利用</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/ports/#ports-poudriere>4.6. Poudriere を用いた package の構築</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/ports/#ports-nextsteps>4.7. インストール後の作業</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/ports/#ports-broken>4.8. うまく動作しない ports に遭遇した場合には</a></li></ul></li><li><input type=checkbox id=chapter-3405c00581365a8b5d16af70fe4d1b72 class=toggle>
<label class="icon cursor" for=chapter-3405c00581365a8b5d16af70fe4d1b72><a role=button></a></label><a href=https://docs.freebsd.org/ja/books/handbook/x11/>第5章 X Window System</a><ul><li><a href=https://docs.freebsd.org/ja/books/handbook/x11/#x11-synopsis>5.1. この章では</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/x11/#x-understanding>5.2. 用語の説明</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/x11/#x-install>5.3. Xorg のインストール</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/x11/#x-config>5.4. Xorg の設定</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/x11/#x-fonts>5.5. Xorg でのフォントの使用</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/x11/#x-xdm>5.6. X ディスプレイマネージャ</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/x11/#x11-wm>5.7. デスクトップ環境</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/x11/#x-compiz-fusion>5.8. Compiz Fusion のインストール</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/x11/#x11-troubleshooting>5.9. トラブルシューティング</a></li></ul></li><li><input type=checkbox id=chapter-0eab3565e8f59f5a8a896dfba7eb3680 class=toggle>
<label for=chapter-0eab3565e8f59f5a8a896dfba7eb3680><a role=button></a></label><a href=https://docs.freebsd.org/ja/books/handbook/partii/>パートII. 日々の生活</a></li><li><input type=checkbox id=chapter-b33cf28993f3f7bf5baf036e79da0f39 class=toggle>
<label class="icon cursor" for=chapter-b33cf28993f3f7bf5baf036e79da0f39><a role=button></a></label><a href=https://docs.freebsd.org/ja/books/handbook/desktop/>第6章 デスクトップアプリケーション</a><ul><li><a href=https://docs.freebsd.org/ja/books/handbook/desktop/#desktop-synopsis>6.1. この章では</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/desktop/#desktop-browsers>6.2. ブラウザ</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/desktop/#desktop-productivity>6.3. 生産的なアプリケーション</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/desktop/#desktop-viewers>6.4. ドキュメントビューア</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/desktop/#desktop-finance>6.5. 財務管理ソフトウェア</a></li></ul></li><li><input type=checkbox id=chapter-152f694a19312ad72ec7bb4e1c3c33b2 class=toggle>
<label class="icon cursor" for=chapter-152f694a19312ad72ec7bb4e1c3c33b2><a role=button></a></label><a href=https://docs.freebsd.org/ja/books/handbook/multimedia/>第7章 マルチメディア</a><ul><li><a href=https://docs.freebsd.org/ja/books/handbook/multimedia/#multimedia-synopsis>7.1. この章では</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/multimedia/#sound-setup>7.2. サウンドカードの設定</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/multimedia/#sound-mp3>7.3. MP3 オーディオ</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/multimedia/#video-playback>7.4. ビデオ再生</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/multimedia/#tvcard>7.5. TV カードの設定</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/multimedia/#mythtv>7.6. MythTV</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/multimedia/#scanners>7.7. 画像スキャナ</a></li></ul></li><li><input type=checkbox id=chapter-80888b4ee02e3e409e5f71cf97a36450 class=toggle>
<label class="icon cursor" for=chapter-80888b4ee02e3e409e5f71cf97a36450><a role=button></a></label><a href=https://docs.freebsd.org/ja/books/handbook/kernelconfig/>第8章 FreeBSD カーネルのコンフィグレーション</a><ul><li><a href=https://docs.freebsd.org/ja/books/handbook/kernelconfig/#kernelconfig-synopsis>8.1. この章では</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/kernelconfig/#kernelconfig-custom-kernel>8.2. なぜカスタムカーネルを作るか?</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/kernelconfig/#kernelconfig-devices>8.3. システムのハードウェアについて知る</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/kernelconfig/#kernelconfig-config>8.4. コンフィグレーションファイル</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/kernelconfig/#kernelconfig-building>8.5. カスタムカーネルの構築とインストール</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/kernelconfig/#kernelconfig-trouble>8.6. 問題が起きた場合には</a></li></ul></li><li><input type=checkbox id=chapter-cb174c55879b17ab955f2f16989a79e0 class=toggle checked>
<label class="icon cursor" for=chapter-cb174c55879b17ab955f2f16989a79e0><a role=button></a></label><a href=https://docs.freebsd.org/ja/books/handbook/printing/>第9章 プリンタの利用</a><ul><li><a href=https://docs.freebsd.org/ja/books/handbook/printing/#printing-synopsis>9.1. この章では</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/printing/#printing-intro-spooler>9.2. はじめに</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/printing/#printing-intro-setup>9.3. 基本的な設定</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/printing/#printing-advanced>9.4. プリンタ設定上級編</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/printing/#printing-using>9.5. プリンタを使う</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/printing/#printing-lpd-alternatives>9.6. 標準スプーラの代替品</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/printing/#printing-troubleshooting>9.7. トラブルシューティング</a></li></ul></li><li><input type=checkbox id=chapter-c12b8c3f2a8fcefce87087241f695c83 class=toggle>
<label class="icon cursor" for=chapter-c12b8c3f2a8fcefce87087241f695c83><a role=button></a></label><a href=https://docs.freebsd.org/ja/books/handbook/linuxemu/>第10章 Linux® バイナリ互換機能</a><ul><li><a href=https://docs.freebsd.org/ja/books/handbook/linuxemu/#linuxemu-synopsis>10.1. この章では</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/linuxemu/#linuxemu-lbc-install>10.2. Linux® バイナリ互換機能の設定</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/linuxemu/#linuxemu-advanced>10.3. 高度なトピックス</a></li></ul></li><li><input type=checkbox id=chapter-03b11ba627b9a0c85b247f5641bde272 class=toggle>
<label for=chapter-03b11ba627b9a0c85b247f5641bde272><a role=button></a></label><a href=https://docs.freebsd.org/ja/books/handbook/partiii/>パートIII. システム管理</a></li><li><input type=checkbox id=chapter-6c31587f8d736319f099cd4dc1961301 class=toggle>
<label class="icon cursor" for=chapter-6c31587f8d736319f099cd4dc1961301><a role=button></a></label><a href=https://docs.freebsd.org/ja/books/handbook/config/>第11章 設定とチューニング</a><ul><li><a href=https://docs.freebsd.org/ja/books/handbook/config/#_この章では>11.1. この章では</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/config/#configtuning-core-configuration>11.2. 中核となる設定</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/config/#configtuning-appconfig>11.3. アプリケーションの設定</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/config/#configtuning-starting-services>11.4. サービスの起動</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/config/#configtuning-virtual-hosts>11.5. バーチャルホスト</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/config/#configtuning-configfiles>11.6. 設定ファイル</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/config/#configtuning-sysctl>11.7. sysctl によるチューニング</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/config/#configtuning-disk>11.8. ディスクのチューニング</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/config/#configtuning-kernel-limits>11.9. Kernel 制限のチューニング</a></li></ul></li><li><input type=checkbox id=chapter-459f0012b3b4f0b6b123010f029da5e4 class=toggle>
<label class="icon cursor" for=chapter-459f0012b3b4f0b6b123010f029da5e4><a role=button></a></label><a href=https://docs.freebsd.org/ja/books/handbook/boot/>第12章 FreeBSD の起動のプロセス</a><ul><li><a href=https://docs.freebsd.org/ja/books/handbook/boot/#boot-synopsis>12.1. この章では</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/boot/#boot-introduction>12.2. FreeBSD の起動プロセス</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/boot/#device-hints>12.3. Device Hints</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/boot/#boot-shutdown>12.4. シャットダウン動作</a></li></ul></li><li><input type=checkbox id=chapter-917c75fcffbb14d48ed6d0a48e7028f2 class=toggle>
<label class="icon cursor" for=chapter-917c75fcffbb14d48ed6d0a48e7028f2><a role=button></a></label><a href=https://docs.freebsd.org/ja/books/handbook/security/>第13章 セキュリティ</a><ul><li><a href=https://docs.freebsd.org/ja/books/handbook/security/#security-synopsis>13.1. この章では</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/security/#security-intro>13.2. はじめに</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/security/#one-time-passwords>13.3. ワンタイムパスワード</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/security/#tcpwrappers>13.4. TCP Wrappers</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/security/#kerberos5>13.5. Kerberos5</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/security/#openssl>13.6. OpenSSL</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/security/#ipsec>13.7. VPN over IPsec</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/security/#openssh>13.8. OpenSSH</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/security/#fs-acl>13.9. ファイルシステムアクセス制御リスト (ACL)</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/security/#security-portaudit>13.10. サードパーティ製ソフトウェアのセキュリティ問題を監視する</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/security/#security-advisories>13.11. FreeBSD セキュリティ勧告</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/security/#security-accounting>13.12. プロセスアカウンティング</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/security/#security-resourcelimits>13.13. リソースの制限</a></li></ul></li><li><input type=checkbox id=chapter-e1edcad13d9db6e8e4cb645d378ecfaf class=toggle>
<label class="icon cursor" for=chapter-e1edcad13d9db6e8e4cb645d378ecfaf><a role=button></a></label><a href=https://docs.freebsd.org/ja/books/handbook/disks/>第14章 ストレージ</a><ul><li><a href=https://docs.freebsd.org/ja/books/handbook/disks/#disks-synopsis>14.1. この章では</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/disks/#disk-naming>14.2. デバイス名</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/disks/#disks-adding>14.3. ディスクの追加</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/disks/#raid>14.4. RAID</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/disks/#creating-cds>14.5. 光メディア (CD & DVD) の作成と使用</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/disks/#floppies>14.6. フロッピーディスクの作成と使用</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/disks/#backups-tapebackups>14.7. データテープの作成と使用</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/disks/#backups-floppybackups>14.8. フロッピーディスクへのバックアップ</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/disks/#backup-basics>14.9. バックアップの基本</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/disks/#disks-virtual>14.10. ネットワーク、メモリ、そしてファイルベースのファイルシステム</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/disks/#snapshots>14.11. ファイルシステムのスナップショット</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/disks/#quotas>14.12. ファイルシステムクォータ</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/disks/#disks-encrypting>14.13. ディスクパーティションの暗号化</a></li></ul></li><li><input type=checkbox id=chapter-49f1e96591c090304ea532012257f4ef class=toggle>
<label class="icon cursor" for=chapter-49f1e96591c090304ea532012257f4ef><a role=button></a></label><a href=https://docs.freebsd.org/ja/books/handbook/l10n/>第15章 地域化 (localization) - i18n/L10n の利用と設定</a><ul><li><a href=https://docs.freebsd.org/ja/books/handbook/l10n/#l10n-synopsis>15.1. この章では</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/l10n/#using-localization>15.2. 地域化の利用</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/l10n/#l10n-compiling>15.3. 国際化 (i18n) に対応したアプリケーションを見つける</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/l10n/#lang-setup>15.4. 特定の言語にロケールを設定する</a></li></ul></li><li><input type=checkbox id=chapter-dead2b4c5ea325dd390a9b0dccd8f763 class=toggle>
<label class="icon cursor" for=chapter-dead2b4c5ea325dd390a9b0dccd8f763><a role=button></a></label><a href=https://docs.freebsd.org/ja/books/handbook/cutting-edge/>第16章 FreeBSD のアップデートとアップグレード</a><ul><li><a href=https://docs.freebsd.org/ja/books/handbook/cutting-edge/#updating-upgrading-synopsis>16.1. この章では</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/cutting-edge/#updating-upgrading-freebsdupdate>16.2. FreeBSD Update</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/cutting-edge/#updating-bootcode>16.3. ブートコードのアップデート</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/cutting-edge/#updating-upgrading-documentation>16.4. ドキュメントのアップデート</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/cutting-edge/#current-stable>16.5. 開発ブランチを追いかける</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/cutting-edge/#makeworld>16.6. ソースを用いた FreeBSD のアップデート</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/cutting-edge/#small-lan>16.7. 複数のマシンで追いかける</a></li></ul></li><li><input type=checkbox id=chapter-bbd25f9a194f9c39ca2d658c75767db5 class=toggle>
<label for=chapter-bbd25f9a194f9c39ca2d658c75767db5><a role=button></a></label><a href=https://docs.freebsd.org/ja/books/handbook/partiv/>パートIV. ネットワーク通信</a></li><li><input type=checkbox id=chapter-499dab596afd7ddac77e80295314e0dd class=toggle>
<label class="icon cursor" for=chapter-499dab596afd7ddac77e80295314e0dd><a role=button></a></label><a href=https://docs.freebsd.org/ja/books/handbook/serialcomms/>第17章 シリアル通信</a><ul><li><a href=https://docs.freebsd.org/ja/books/handbook/serialcomms/#serial-synopsis>17.1. この章では</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/serialcomms/#serial>17.2. はじめに</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/serialcomms/#term>17.3. シリアル端末</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/serialcomms/#dialup>17.4. ダイアルインサービス</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/serialcomms/#dialout>17.5. ダイアルアウトサービス</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/serialcomms/#serialconsole-setup>17.6. シリアルコンソールの設定</a></li></ul></li><li><input type=checkbox id=chapter-95e4571c48bee1cced5e84a538d302e3 class=toggle>
<label class="icon cursor" for=chapter-95e4571c48bee1cced5e84a538d302e3><a role=button></a></label><a href=https://docs.freebsd.org/ja/books/handbook/ppp-and-slip/>第18章 PPP と SLIP</a><ul><li><a href=https://docs.freebsd.org/ja/books/handbook/ppp-and-slip/#_この章では>18.1. この章では</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/ppp-and-slip/#userppp>18.2. ユーザ ppp の利用</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/ppp-and-slip/#ppp>18.3. カーネル PPP の利用</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/ppp-and-slip/#pppoe>18.4. PPP オーバイーサネット (PPPoE) の利用</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/ppp-and-slip/#slip>18.5. SLIP の利用</a></li></ul></li><li><input type=checkbox id=chapter-f089ac726c401c9b4bd5c34a295e11bb class=toggle>
<label class="icon cursor" for=chapter-f089ac726c401c9b4bd5c34a295e11bb><a role=button></a></label><a href=https://docs.freebsd.org/ja/books/handbook/mail/>第19章 電子メール</a><ul><li><a href=https://docs.freebsd.org/ja/books/handbook/mail/#mail-synopsis>19.1. この章では</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/mail/#mail-using>19.2. 電子メールを使う</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/mail/#sendmail>19.3. sendmail の設定</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/mail/#mail-changingmta>19.4. MTA の変更</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/mail/#mail-trouble>19.5. トラブルシュート</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/mail/#mail-advanced>19.6. 先進的なトピックス</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/mail/#SMTP-UUCP>19.7. UUCP とともに SMTP を使う</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/mail/#SMTP-dialup>19.8. ダイアルアップ接続でメールを使う</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/mail/#SMTP-Auth>19.9. SMTP 認証</a></li></ul></li><li><input type=checkbox id=chapter-5b07f776a0e6155c1c89aa0d15610380 class=toggle>
<label class="icon cursor" for=chapter-5b07f776a0e6155c1c89aa0d15610380><a role=button></a></label><a href=https://docs.freebsd.org/ja/books/handbook/advanced-networking/>第20章 高度なネットワーク</a><ul><li><a href=https://docs.freebsd.org/ja/books/handbook/advanced-networking/#advanced-networking-synopsis>20.1. この章では</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/advanced-networking/#network-routing>20.2. ゲートウェイと経路</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/advanced-networking/#network-wireless>20.3. 無線ネットワーク</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/advanced-networking/#network-bluetooth>20.4. Bluetooth</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/advanced-networking/#network-bridging>20.5. ブリッジ</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/advanced-networking/#network-nfs>20.6. NFS</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/advanced-networking/#network-diskless>20.7. ディスクレス稼働</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/advanced-networking/#network-isdn>20.8. ISDN</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/advanced-networking/#network-nis>20.9. NIS/YP</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/advanced-networking/#network-dhcp>20.10. DHCP</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/advanced-networking/#network-dns>20.11. DNS</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/advanced-networking/#network-ntp>20.12. NTP</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/advanced-networking/#network-natd>20.13. ネットワークアドレス変換 (NAT)</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/advanced-networking/#network-inetd>20.14. inetd"スーパサーバ"</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/advanced-networking/#network-plip>20.15. パラレルライン IP (PLIP)</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/advanced-networking/#network-ipv6>20.16. IPv6</a></li></ul></li><li><input type=checkbox id=chapter-171a77aa9d067a1024f849470e1f33e8 class=toggle>
<label for=chapter-171a77aa9d067a1024f849470e1f33e8><a role=button></a></label><a href=https://docs.freebsd.org/ja/books/handbook/partv/>パートV. 付録</a></li><li><input type=checkbox id=chapter-8050f436a0a7986a4aaded93d8e49469 class=toggle>
<label class="icon cursor" for=chapter-8050f436a0a7986a4aaded93d8e49469><a role=button></a></label><a href=https://docs.freebsd.org/ja/books/handbook/mirrors/>付録A FreeBSD の入手方法</a><ul><li><a href=https://docs.freebsd.org/ja/books/handbook/mirrors/#mirrors>A.1. Mirrors</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/mirrors/#git>A.2. Git の利用</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/mirrors/#svn>A.3. Subversion の利用</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/mirrors/#mirrors-cdrom>A.4. CD および DVD セット</a></li></ul></li><li><input type=checkbox id=chapter-128b630a8f88f158e7027fe6c2184d21 class=toggle>
<label class="icon cursor" for=chapter-128b630a8f88f158e7027fe6c2184d21><a role=button></a></label><a href=https://docs.freebsd.org/ja/books/handbook/bibliography/>付録B. 参考図書</a><ul><li><a href=https://docs.freebsd.org/ja/books/handbook/bibliography/#bibliography-freebsd>B.1. FreeBSD 専門の書籍</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/bibliography/#bibliography-userguides>B.2. 利用者向けのガイド</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/bibliography/#bibliography-adminguides>B.3. 管理者向けのガイド</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/bibliography/#_プログラマ向けのガイド>B.4. プログラマ向けのガイド</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/bibliography/#_オペレーティングシステム内部>B.5. オペレーティングシステム内部</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/bibliography/#_セキュリティの参考資料>B.6. セキュリティの参考資料</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/bibliography/#bibliography-hardware>B.7. ハードウェアの参考資料</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/bibliography/#bibliography-history>B.8. UNIX® の歴史</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/bibliography/#bibliography-journals>B.9. 定期刊行物、雑誌およびジャーナル</a></li></ul></li><li><input type=checkbox id=chapter-8bbb8867c46dac315e2253945d8c18a8 class=toggle>
<label class="icon cursor" for=chapter-8bbb8867c46dac315e2253945d8c18a8><a role=button></a></label><a href=https://docs.freebsd.org/ja/books/handbook/eresources/>付録 C. インターネット上のリソース</a><ul><li><a href=https://docs.freebsd.org/ja/books/handbook/eresources/#eresources-www>C.1. ウェブサイト</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/eresources/#eresources-mail>C.2. メーリングリスト</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/eresources/#eresources-news>C.3. Usenet ニュースグループ</a></li><li><a href=https://docs.freebsd.org/ja/books/handbook/eresources/#eresources-web>C.4. オフィシャルミラー</a></li></ul></li><li><input type=checkbox id=chapter-a80ea4f5a4480b8725422710f954ef36 class=toggle>
<label class="icon cursor" for=chapter-a80ea4f5a4480b8725422710f954ef36><a role=button></a></label><a href=https://docs.freebsd.org/ja/books/handbook/pgpkeys/>付録 D. OpenPGP Keys</a><ul><li><a href=https://docs.freebsd.org/ja/books/handbook/pgpkeys/#pgpkeys-officers>D.1. オフィサ</a></li></ul></li><li></li></ul></nav></div></aside><div class=book><div class=book-menu-mobile><label for=menu-control><span class=menu-control-button><i class="fa fa-list" aria-hidden=true title="Book menu"></i>
Book menu</span></label></div><h1 class=title>第9章 プリンタの利用</h1><div class="admonitionblock note"><p><i class="fa fa-exclamation-circle" aria-hidden=true></i>
This translation may be out of date. To help with the translations please access the <a href=https://translate-dev.freebsd.org/ target=_blank>FreeBSD translations instance</a>.</p></div><div class=toc-mobile><h3>目次</h3><nav id=TableOfContents><ul><li><a href=#printing-synopsis>9.1. この章では</a></li><li><a href=#printing-intro-spooler>9.2. はじめに</a></li><li><a href=#printing-intro-setup>9.3. 基本的な設定</a></li><li><a href=#printing-advanced>9.4. プリンタ設定上級編</a></li><li><a href=#printing-using>9.5. プリンタを使う</a></li><li><a href=#printing-lpd-alternatives>9.6. 標準スプーラの代替品</a></li><li><a href=#printing-troubleshooting>9.7. トラブルシューティング</a></li></ul></nav></div><div class=book-content><div id=preamble><div class=sectionbody></div></div><div class=sect1><h2 id=printing-synopsis>9.1. この章では<a class=anchor href=#printing-synopsis></a></h2><div class=sectionbody><div class=paragraph><p>FreeBSD は古いインパクトプリンタから最新のレーザープリンタまで幅広いプリンタが利用でき、 実行しているアプリケーションから高品質な印刷出力が行えます。</p></div><div class=paragraph><p>FreeBSD はネットワーク上のプリンタサーバとして動作するように設定することもできます。 この機能は、他の FreeBSD コンピュータや、Windows® や Mac OS® ホストから印刷ジョブを受け取ることができます。 FreeBSD は印刷ジョブを 1 つずつ処理することを保証します。 また、どのユーザやマシンが最も多く印刷しているかの統計を取り、 どの印刷物が誰の物か表示する "バナー" ページの作成などを行うことができます。</p></div><div class=paragraph><p>この章を読めば以下のことがわかります。</p></div><div class=ulist><ul><li><p>FreeBSD プリントスプーラの設定方法。</p></li><li><p>入力ドキュメントをプリンタが扱える印刷フォーマットへ変換するなどといった、 特別な印刷ジョブを別に取り扱うための印刷フィルタのインストール方法。</p></li><li><p>印刷物へのヘッダやバナーの適用方法。</p></li><li><p>他のコンピュータに接続されたプリンタで印刷する方法。</p></li><li><p>ネットワークに直接接続されたプリンタで印刷する方法。</p></li><li><p>印刷ジョブの上限サイズや特定のユーザからの印刷拒否といった、 プリンタの制限の制御方法。</p></li><li><p>印刷の統計とプリンタの使用状況の取得方法。</p></li><li><p>印刷問題のトラブルシューティング方法。</p></li></ul></div><div class=paragraph><p>この章を読み始める前に以下を済ませておいてください。</p></div><div class=ulist><ul><li><p>新しいカーネルの設定とインストール方法について理解すること (<a href=../kernelconfig/#kernelconfig>FreeBSD カーネルのコンフィグレーション</a>)。</p></li></ul></div></div></div><div class=sect1><h2 id=printing-intro-spooler>9.2. はじめに<a class=anchor href=#printing-intro-spooler></a></h2><div class=sectionbody><div class=paragraph><p>FreeBSD でプリンタを使うために、それらを LPD スプーリングシステム、 または単に LPD としても知られる Berkeley ラインプリンタスプーリングシステムで動作するように設定できます。 これは FreeBSD での標準的なプリンタ制御システムです。 この章では、LPD を紹介し、 その設定方法について説明します。</p></div><div class=paragraph><p>あなたがすでに LPD やその他のプリンタスプーリングシステムに詳しいのなら、 <a href=#printing-intro-setup>基本的な設定</a> まで読み飛ばしてもかまいません。</p></div><div class=paragraph><p>LPD はホストのプリンタに関するあらゆることを制御します。 ここで言う制御としては、次のことがあげられます。</p></div><div class=ulist><ul><li><p>ホストに接続されたプリンタ、 あるいはネットワーク上の他ホストに接続されたプリンタに対するアクセス制御を行ないます。</p></li><li><p>ファイルをプリントする要求に対して許可を与えます。 この要求は特に<em>ジョブ</em>と呼ばれています。</p></li><li><p>各々のプリンタの<em>キュー</em>を管理することにより、 複数のユーザがあるプリンタに対して同時にアクセスすることを防ぎます。</p></li><li><p><em>ヘッダページ</em> (<em>バナー</em>または <em>バースト</em>ページとしても知られています) をプリントすることができます。 これにより、 プリントアウトの山の中から自分がプリントしたジョブを見つけやすくなります。</p></li><li><p>シリアルポートに接続したプリンタ用に通信パラメータを管理します。</p></li><li><p>ネットワーク経由で他のホスト上の LPD スプーラにジョブを送ることができます。</p></li><li><p>様々なプリンタ言語やプリンタの能力に応じてジョブの形式を整えるため、 特別なフィルタを起動することができます。</p></li><li><p>プリンタの使用に対して課金を行なうことができます。</p></li></ul></div><div class=paragraph><p>設定ファイル (<span class=filename>/etc/printcap</span>) を通して、専用のフィルタプログラムを用いることにより、 多種多様なプリンタ機器に対して、上述の機能の全部または一部を LPD システムに行なわせることができます。</p></div><div class=sect2><h3 id=printing-intro-why>9.2.1. どうしてスプーラを使うべきなのか<a class=anchor href=#printing-intro-why></a></h3><div class=paragraph><p>あなたのシステムを利用するのがあなた一人だけだとしても、 スプーラは有用ですし、使用すべきです。その理由は以下のとおりです。</p></div><div class=ulist><ul><li><p>LPD はジョブをバックグラウンドで処理します。 データがプリンタに送信されるまで待つ必要がなくなります。</p></li><li><p>LPD ではジョブをフィルタを通してプリントすることが簡単にできます。 これにより、印刷物のヘッダに時刻や日付を入れたり、 特別なファイル形式 (TeX の DVI ファイルなど) をプリンタが処理できる形式に変更することができ、 これらの作業を手動で行なう必要がなくなります。</p></li><li><p>プリント処理を行なうフリー、 または商用のプログラムのほとんどは、 システムのスプーラとやりとりするように作られています。 スプーリングシステムをセットアップすることで、 今後加えるかもしれない、あるいは、 すでに持っている別のソフトウェアをより簡単にサポートすることができるでしょう。</p></li></ul></div></div></div></div><div class=sect1><h2 id=printing-intro-setup>9.3. 基本的な設定<a class=anchor href=#printing-intro-setup></a></h2><div class=sectionbody><div class=paragraph><p>LPD スプーリングシステムを用いてプリンタを使用するためには、 プリンタ機器と LPD 用ソフトウェアの両方を準備する必要があります。 本文書では次の二段階のレベルに分けて説明をします。</p></div><div class=ulist><ul><li><p>プリンタを接続する方法、 プリンタにどのように通信するかを LPD に指示する方法や、 プレインテキストをプリンタで印字する方法については、 <a href=#printing-simple>プリンタの簡単な設定</a>をご覧ください。</p></li><li><p>様々な形式のファイルを印字する方法、 ヘッダページを印字する方法、 ネットワーク経由でプリンタに印字する方法、 プリンタを制御する方法、 プリンタの使用に対する課金を行なう方法については<a href=#printing-advanced>プリンタ設定上級編</a>をご覧ください。</p></li></ul></div><div class=sect2><h3 id=printing-simple>9.3.1. プリンタ設定導入編<a class=anchor href=#printing-simple></a></h3><div class=paragraph><p>この節では、プリンタ機器やプリンタを使用するための LPD 用ソフトウェアを設定する方法について述べます。 この節の概要は次のとおりです。</p></div><div class=ulist><ul><li><p><a href=#printing-hardware>プリンタ機器の設定</a>では、 プリンタをコンピュータに接続するためのヒントがいくつか書かれています。</p></li><li><p><a href=#printing-software>ソフトウェアの設定</a>では、 LPD のスプーラ設定ファイル (<span class=filename>/etc/printcap</span>) の設定方法について書かれています。</p></li></ul></div><div class=paragraph><p>データをプリンタに送るのにコンピュータのローカルインタフェースではなく、 ネットワークプロトコルを使用する場合は、 <a href=#printing-advanced-network-net-if>ネットワークにおけるデータストリームインタフェースを持つプリンタ</a>をご覧ください。</p></div><div class=paragraph><p>この節のタイトルは "プリンタ設定導入編" ですが、 実際の設定はかなり複雑です。 プリンタをコンピュータに接続し、 LPD スプーラを起動させることは一番困難な作業です。 ヘッダページを出力させたり課金したりするオプションの設定は、 一度プリンタがうまく動くようになればとても簡単です。</p></div><div class=sect3><h4 id=printing-hardware>9.3.1.1. プリンタ機器の設定<a class=anchor href=#printing-hardware></a></h4><div class=paragraph><p>この節では、プリンタに PC を接続するための様々な方法について説明しています。 ここでは、ポートやケーブルの種類、 FreeBSD がプリンタとの通信に必要なカーネルコンフィグレーションについても言及しています。</p></div><div class=paragraph><p>もしプリンタが既に接続されていて、 他のオペレーティングシステム上でプリンタからの印字に成功している場合は、 <a href=#printing-software>ソフトウェアの設定</a>まで読み飛ばすことが多分できるでしょう。</p></div><div class=sect4><h5 id=printing-ports>9.3.1.1.1. ポートとケーブル<a class=anchor href=#printing-ports></a></h5><div class=paragraph><p>今日 PC 用に売られているプリンタには通常、 次の 3 つのインタフェースのうち、どれか 1 つ以上がついてきます。</p></div><div class=ulist><ul><li><p><em>シリアル</em>インタフェース (RS-232 または COM ポートとも呼ばれます) は、 コンピュータにあるシリアルポートを使ってプリンタにデータを送信します。 シリアルインタフェースはコンピュータ業界で共通して使用されています。 そのケーブルは容易に手に入りますし、簡単に自作することもできます。 シリアルインタフェースの場合は時々、 特別なケーブルや何か複雑な通信方式選択の設定が必要になることがあります。 ほとんどの PC のシリアルポートは通信速度が最大で 115200 bps であり、 大きな画像を印刷するのには実用的ではありません。</p></li><li><p><em>パラレル</em>インタフェースではプリンタにデータを送信するために、 コンピュータにあるパラレルポートを使用します。 パラレルインタフェースは PC 業界ではよく使われており、 RS-232 シリアルよりも速いです。 ケーブルの入手は容易ですが、 自作するのはシリアルよりも困難です。 パラレルインタフェースには通常、通信方式の選択はなく、 設定は極めて単純です。</p><div class=paragraph><p>パラレルインタフェースは "セントロニクス" インタフェースとして知られています。 これは、プリンタ用のコネクタタイプとして採用された後に名付けられました。</p></div></li><li><p>USB インタフェースは、Universal Serial Bus (汎用シリアルバス) の略で、パラレルや RS-232 シリアルよりさらに速く動作します。 ケーブルは単純で安価です。USB は、印刷目的には RS-232 シリアルやパラレルよりも向いていますが、UNIX® システムでは十分対応されていません。 この問題を回避する手としては、多くのプリンタがそうですが、 USB とパラレルの両方のインタフェースを備えたプリンタを購入することが挙げられます。</p></li></ul></div><div class=paragraph><p>パラレルインタフェースでは、普通は (コンピュータからプリンタへの) 単方向通信のみを行なうのに対して、 シリアルおよび USB インタフェースは双方向通信を行ないます。 FreeBSD でも IEEE1284 準拠のケーブルを使えば、 最近のパラレルポート (EPP や ECP) とプリンタの多くで双方向通信を行なうことができます。</p></div><div class=paragraph><p>パラレルポート経由のプリンタとの双方向通信には、 通常 2 つの方法のどちらかが使われます。一つ目の方法は、 プリンタが使用しているプロプライエタリな言語を話す FreeBSD 用に作成されたプリンタドライバを使うものです。 これはインクジェットプリンタではよく使われる方法で、 インクの残量やその他の状態の情報を知らせるのに使えます。 二つ目の方法は、プリンタが PostScript® に対応している時に使われます。</p></div><div class=paragraph><p>PostScript® ジョブは、実際にはプリンタに送信されるプログラムです。 印字作業を行う必要は必ずしありませんし、 プログラムの結果を直接コンピュータに返してもよいのです。 PostScript® プリンタでは双方向通信を使って PostScript® プログラムのエラーや紙づまりといった問題をコンピュータに報告します。 ユーザはそれらの情報を知りたいと思うかも知れません。 また、PostScript® プリンタで課金作業をもっとも効率よく行なうためには、 双方向通信が必要となります。 この方法ではまず、プリンタの現在のページカウント (起動してから今まで何枚の紙を印字したか) の情報を得ます。 次に、ユーザのジョブを実行し、終了後、再びページカウントを得ます。 この二つの数を差によって、 課金対象となる紙の枚数を知ることができるのです。</p></div></div><div class=sect4><h5 id=printing-parallel>9.3.1.1.2. パラレルポート<a class=anchor href=#printing-parallel></a></h5><div class=paragraph><p>プリンタをパラレルインタフェースを使って接続する場合は、 セントロニクスケーブルでプリンタとコンピュータを接続してください。 詳しい説明はプリンタやコンピュータに付属する説明書に書かれているはずです。</p></div><div class=paragraph><p>その際、 どのパラレルポートを使用したかを覚えておいてください。 FreeBSD では最初のポートは <span class=filename>ppc0</span>、 二番目が <span class=filename>ppc1</span> であり、 三番目以降も同様に続きます。 プリンタのデバイス名にも同じ形式が使われており、 最初のパラレルポートに接続されたプリンタは <span class=filename>/dev/lpt0</span> などとなります。</p></div></div><div class=sect4><h5 id=printing-serial>9.3.1.1.3. シリアルポート<a class=anchor href=#printing-serial></a></h5><div class=paragraph><p>シリアルインタフェースを使ってプリンタを使う場合は、 適切なシリアルケーブルでプリンタとコンピュータを接続してください。 詳しい説明はプリンタ、コンピュータ、あるいは両方に付属する説 明書に書かれているはずです。</p></div><div class=paragraph><p>"適切なシリアルケーブル" が良くわからないときは、 次のどれかを試してみてください。</p></div><div class=ulist><ul><li><p><em>モデム</em>用ケーブルでは、 それぞれのピンは他方のコネクタの対応するピンと線でつながっています。 このタイプのケーブルは "DTE-DCE" 間ケーブルとしても知られています (訳注: 日本ではストレートケーブルという名前で売られています)。</p></li><li><p><em>ヌルモデム</em>用ケーブルでは、 あるピンは対応するピンとを接続していますが、 あるピン (たとえば、データ送信用とデータ受信用のピン) が交差して接続したり、 いくつかのピンは内部で短絡していたりします。 このタイプのケーブルは、 "DTE-DTE" 間ケーブルと呼ばれています (訳注: 日本ではクロスケーブルという名前で売られています)。</p></li><li><p>A <em>シリアルプリンタ</em>用ケーブルは、 ある特定のプリンタで必要とされるものです。 ヌルモデムケーブルと似ていますが、 内部で短絡させる代わりに、 ある信号を他方側に送るために使用しています。</p></li></ul></div><div class=paragraph><p>この他に、 プリンタ用の通信パラメータを設定する必要があります。 通常、プリンタのフロントパネルや DIP スイッチによって制御します。 コンピュータとプリンタの双方で設定できる最高の通信速度 [bps] (ビット/秒、 <em>ボーレート</em>と示されているときもある) を選んでください。そして、データビット (7 または 8)、 パリティ (偶/奇/なし)、ストップビット (1 または 2) を選んでください。 そして、フローコントロールの有無 (制御なし、または XON/XOFF ("イン・バンド" または "ソフトウェア" フローコントロールとも呼ばれる)) を選びます。 以下に続くソフトウェアの設定のために、 ここでの設定を覚えておいてください。</p></div></div></div><div class=sect3><h4 id=printing-software>9.3.1.2. ソフトウェアの設定<a class=anchor href=#printing-software></a></h4><div class=paragraph><p>本節では FreeBSD の LPD スプーリングシステムで印字をおこなうために 必要となるソフトウェアの設定について説明しています。</p></div><div class=paragraph><p>本節の概要は次のようになります。</p></div><div class="exampleblock procedure"><div class=content><div class="olist arabic"><ol class=arabic><li><p>プリンタで使用するポートのために、必要があれば、 カーネルの書き変えをおこないます。「<a href=#printing-kernel>カーネルの変更</a>」で、 このためにしなくてはならないことを説明しています。</p></li><li><p>パラレルポートを使用している場合は、 パラレルポートのための通信モードを設定します。 詳細は、 「<a href=#printing-parallel-port-mode>パラレルポートの通信モードを設定する</a>」 で説明しています。</p></li><li><p>オペレーティングシステムからプリンタにデータが送ら れているかをテストします。「<a href=#printing-testing>プリンタとの通信状況を調べる</a>」で、 どのようにテストするかの提案をいくつかおこなっています。</p></li><li><p>ファイル<span class=filename>/etc/printcap</span>を変更し、 LPD の設定をおこないます。 この節で、どのように変更するかを説明しています。</p></li></ol></div></div></div><div class=sect4><h5 id=printing-kernel>9.3.1.2.1. カーネルの変更<a class=anchor href=#printing-kernel></a></h5><div class=paragraph><p>オペレーティングシステムのカーネルの コンパイルをおこなうことによって、 指定されたデバイスが機能するようになります。シリアル、 または、パラレルインタフェースをプリンタで使用する場合、 必要なデバイスがこの指定の中に含まれていなくてはなりません。 したがって、 必要なデバイスがカーネルに組み込まれていない場合、 追加のシリアル、または、パラレルポートをサポートするために、 カーネルの再コンパイルが必要となるかもしれません。</p></div><div class=paragraph><p>シリアルポートが現在使用しているカーネルで サポートされているかどうかを調べるためには、 次のように入力します。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># grep sioN /var/run/dmesg.boot</span></code></pre></div></div><div class=paragraph><p>ここで、<em>N</em> はシリアルポートの番号を示し、この番号は 0 から始まります。 次のような出力があった場合、 カーネルはそのポートをサポートしています。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>sio2 at port 0x3e8-0x3ef irq 5 on isa
 sio2: <span class=nb>type </span>16550A</code></pre></div></div><div class=paragraph><p>パラレルポートが現在使用しているカーネルで サポートされているかどうかを調べるためには、 次のように入力します。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># grep ppcN /var/run/dmesg.boot</span></code></pre></div></div><div class=paragraph><p>ここで、<em>N</em> はパラレルポートの番号を示し、この番号は 0 から始まります。 次のような出力があった場合、 カーネルはそのポートをサポートしています。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>ppc0: &lt;Parallel port&gt; at port 0x378-0x37f irq 7 on isa0
ppc0: SMC-like chipset <span class=o>(</span>ECP/EPP/PS2/NIBBLE<span class=o>)</span> <span class=k>in </span>COMPATIBLE mode
ppc0: FIFO with 16/16/8 bytes threshold</code></pre></div></div><div class=paragraph><p>上記の出力が得られない場合、プリンタを使うため、 オペレーティングシステムにパラレル、または、 シリアルポートを認識し、使用できるようにするためには カーネルを変更する必要があります。</p></div><div class=paragraph><p>シリアルポートをサポートさせるには、「<a href=../kernelconfig/#kernelconfig>FreeBSD カーネルのコンフィグレーション</a>」の節をご覧く ださい。パラレルポートをサポートさせる場合も、その節と、 <em>あわせて</em>、 この節に続く節もご覧ください。</p></div></div></div><div class=sect3><h4 id=printing-parallel-port-mode>9.3.1.3. パラレルポートの通信モードを設定する<a class=anchor href=#printing-parallel-port-mode></a></h4><div class=paragraph><p>パラレルインタフェースを使用している場合、FreeBSD では、 割り込み駆動型にするか、 プリンタとの通信の状況をカーネルに監視させるかのいずれかを選択できます。 FreeBSD の汎用プリンタデバイスドライバ (<a href="https://man.freebsd.org/cgi/man.cgi?query=lpt&amp;sektion=4&amp;format=html">lpt(4)</a>) は <a href="https://man.freebsd.org/cgi/man.cgi?query=ppbus&amp;sektion=4&amp;format=html">ppbus(4)</a> システムを利用しています。 これは <a href="https://man.freebsd.org/cgi/man.cgi?query=ppc&amp;sektion=4&amp;format=html">ppc(4)</a> ドライバを使ってパラレルポートのチップセットを制御します。</p></div><div class=ulist><ul><li><p>GENERIC カーネルでは<em>割り込み駆動</em>方式がデフォルトになっています。 この方式では、 オペレーティングシステムはプリンタがデータを受け付けられるかどうかを調べるために、 IRQ ラインを一つ使用します。</p></li><li><p><em>監視</em>方式では、 オペレーティングシステムにプリンタがもっとデータを受け付けられるかどうかを繰り返し尋ねるように指示します。 そして、受け付けるという応答を受けたとき、 カーネルはさらなるデータを送信します。</p></li></ul></div><div class=paragraph><p>割り込み駆動方式は一般的にいくらか高速になりますが、貴重な IRQ ラインを一つ消費します。 HP の新しいプリンタの一部には、明らかに何かしらのタイミングの問題 (まだ正確にはわかっていません) で割り込みモードでは正常に動作しないものがあると言われています。 これらのプリンタにはポーリングモードが必要になります。 どちらかうまく機能する方を使ってください。 一部のプリンタはどちらの方式でも動作しますが、 割り込みモードでは苦痛を感じるほど低速です。</p></div><div class=paragraph><p>通信モードを設定するためには 2 つの方法があります。 1 つはカーネルを変更することで、もう一つは <a href="https://man.freebsd.org/cgi/man.cgi?query=lptcontrol&amp;sektion=8&amp;format=html">lptcontrol(8)</a> プログラムを使用する方法です。</p></div><div class=paragraph><p><em>カーネルを設定することによって、 通信モードを変更する。</em></p></div><div class="exampleblock procedure"><div class=content><div class="olist arabic"><ol class=arabic><li><p>カーネルコンフィグレーションファイルを変更します。 <code>ppc0</code> のエントリを探してください。 2 番目のパラレルポートを設定するときは、代わりに <code>ppc1</code> を使います。 以下、3 番目のポートは <code>ppc2</code> となっていきます。</p><div class=ulist><ul><li><p>割り込み駆動方式にする場合は、 <span class=filename>/boot/device.hints</span> ファイルの以下の行を編集して、 <em>N</em> を適切な IRQ 番号に置き換えてください。</p><div class="literalblock programlisting"><div class=content><pre>hint.ppc.0.irq=&#34;N&#34;</pre></div></div><div class=paragraph><p>カーネルの設定ファイルには <a href="https://man.freebsd.org/cgi/man.cgi?query=ppc&amp;sektion=4&amp;format=html">ppc(4)</a> ドライバも入れなければなりません。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>device ppc</code></pre></div></div></li><li><p>ポーリングモードを使用する場合は、 <span class=filename>/boot/device.hints</span> ファイルの以下の行を削除してください。</p><div class="literalblock programlisting"><div class=content><pre>hint.ppc.0.irq=&#34;N&#34;</pre></div></div><div class=paragraph><p>場合によっては、これだけでは FreeBSD でポートをポーリングモードにするには十分ではないことがあります。 多くの場合これは <a href="https://man.freebsd.org/cgi/man.cgi?query=acpi&amp;sektion=4&amp;format=html">acpi(4)</a> ドライバと併せて動作します。 これはデバイスのプローブとアタッチを行うので、 プリンタポートへのアクセスモードを制御できます。 問題を修正するために <a href="https://man.freebsd.org/cgi/man.cgi?query=acpi&amp;sektion=4&amp;format=html">acpi(4)</a> の設定を確認してください。</p></div></li></ul></div></li><li><p>ファイルをセーブし、config プログラムを起動し、 カーネルの構築、インストールをおこないます。そして、 リブートしてください。詳細は、「<a href=../kernelconfig/#kernelconfig>FreeBSDカーネルのコンフィグレーション</a>」を参照 してください。</p></li></ol></div></div></div><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=lptcontrol&amp;sektion=8&amp;format=html">lptcontrol(8)</a> <em>で通信モードを設定する場合</em></p></div><div class="exampleblock procedure"><div class=content><div class="olist arabic"><ol class=arabic><li><p><code>lptN</code> をイベント駆動方式に設定する場合は、 次のように入力します。</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># lptcontrol -i -d /dev/lptN</span></code></pre></div></div></li><li><p><code>lptN</code> を監視方式に設定する場合は、次のように入力します。</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># lptcontrol -p -d /dev/lptN</span></code></pre></div></div></li></ol></div></div></div><div class=paragraph><p>これらのコマンドを <span class=filename>/etc/rc.local</span> ファイルに追加 しておくと、システムをブートする度に通信モードを設定する ことができます。詳細については、 <a href="https://man.freebsd.org/cgi/man.cgi?query=lptcontrol&amp;sektion=8&amp;format=html">lptcontrol(8)</a> をご覧ください。</p></div></div><div class=sect3><h4 id=printing-testing>9.3.1.4. プリンタとの通信状況を調べる<a class=anchor href=#printing-testing></a></h4><div class=paragraph><p>スプーリングシステムの設定に進む前に、オペレーティング システムがプリンタにデータを送ることに成功しているかどうか を確かめるべきでしょう。これにより、印字がうまくいかないと き、プリンタとの通信が問題なのか、スプーリングシステムが問 題なのかを分けて調べることがかなり容易になります。</p></div><div class=paragraph><p>プリンタをテストするためには、 プリンタに何かのテキストを送 信してみます。送信した文字をすぐに印字してくれるプリンタに は、<a href="https://man.freebsd.org/cgi/man.cgi?query=lptest&amp;sektion=1&amp;format=html">lptest(1)</a> コマンドを使うと有用です。このコマンドは印 字可能な 96 文字の ASCII 文字すべてを 96 行生成します。</p></div><div class=paragraph><p>PostScript® (または他の言語に対応した) プリンタの場合 は、もっと巧妙なテストが必要になります。次のような、簡単な PostScript® プログラムを使えば十分でしょう。</p></div><div class="literalblock programlisting"><div class=content><pre>%!PS
100 100 moveto 300 300 lineto stroke
310 310 moveto
/Helvetica findfont 12 scalefont setfont
(Is this thing working?) show
showpage</pre></div></div><div class=paragraph><p>上の PostScript® コードはファイルに保存し、 以降の節で例として示されているように利用することができます。</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>このドキュメントでプリンタ用言語を参照するときは、 PostScript® のような言語を仮定しており、Hewlett Packard の PCL は考慮していません。PCL は非常に機能的なの ですが、 プレインテキストにエスケープシーケンスを混ぜること ができます。PostScript® ではプレインテキストを直接印字 することはできません。 このような種類のプリンタ言語に対しては、 特別な対応をおこなわなければなりません。</p></div></td></tr></tbody></table></div><div class=sect4><h5 id=printing-checking-parallel>9.3.1.4.1. パラレルポートのプリンタとの接続を調べる<a class=anchor href=#printing-checking-parallel></a></h5><div class=paragraph><p>この節では、FreeBSD がパラレルポートに接続されたプリ ンタと通信できているかどうかを調べる方法について説明し ています。</p></div><div class=paragraph><p><em>パラレルポートのプリンタをテストするために</em></p></div><div class="exampleblock procedure"><div class=content><div class="olist arabic"><ol class=arabic><li><p><a href="https://man.freebsd.org/cgi/man.cgi?query=su&amp;sektion=1&amp;format=html">su(1)</a> コマンドで <code>root</code> になります。</p></li><li><p>プリンタにデータを送ります。</p><div class=ulist><ul><li><p>プリンタがプレインテキストを印字できる場合、 <a href="https://man.freebsd.org/cgi/man.cgi?query=lptest&amp;sektion=1&amp;format=html">lptest(1)</a> コマンドを使います。 次のように入力してください。</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># lptest &gt; /dev/lptN</span></code></pre></div></div><div class=paragraph><p>ここで、<em>N</em> はパラレルポートの番号で、番号は 0 から始まります。</p></div></li><li><p>プリンタが PostScript® か他のプリンタ 言語を使用している場合、そのプリンタに簡単なプロ グラムを送信してください。次のように入力します。</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cat &gt; /dev/lptN</span></code></pre></div></div><div class=paragraph><p>そして、一行一行、 プログラムを<em>慎重に</em>入力して 下さい。RETUREN または ENTER キーを入力してしま うと、その行は編集できなくなります。プログラムの 入力が終わったら、CONTROL+D か、あなたが設定して いるファイル終了のキーを押してください。</p></div><div class=paragraph><p>もしくは、プログラムを入力したファイルがある 場合は、次のように入力してください。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cat file &gt; /dev/lptN</span></code></pre></div></div><div class=paragraph><p>ここで、<em>file</em> はプログラムが格納されていて、 プリンタに送信するファイルの名前です。</p></div></li></ul></div></li></ol></div></div></div><div class=paragraph><p>これで何かが印刷されるはずです。 印字されたテキストがおかしくても心配は無用です。 それについては、後で修正します。</p></div></div><div class=sect4><h5 id=printing-checking-serial>9.3.1.4.2. シリアルポートのプリンタとの接続を調べる<a class=anchor href=#printing-checking-serial></a></h5><div class=paragraph><p>この節では、FreeBSD がシリアルポートに接続されたプリ ンタと通信できているかどうかを調べる方法について述べられ ています。</p></div><div class=paragraph><p><em>シリアルポートのプリンタをテストするために</em></p></div><div class="exampleblock procedure"><div class=content><div class="olist arabic"><ol class=arabic><li><p><a href="https://man.freebsd.org/cgi/man.cgi?query=su&amp;sektion=1&amp;format=html">su(1)</a> コマンドで <code>root</code> になります。</p></li><li><p><span class=filename>/etc/remote</span> ファイルを編集します。次のエントリを加えてください。</p><div class="literalblock programlisting"><div class=content><pre>printer:dv=/dev/port:br#bps-rate:pa=parity</pre></div></div><div class=paragraph><p>ここで、<em>port</em> シリアルポート (<code>ttyu0</code>、 <code>ttyu1</code> など) のデバイスエントリで、 <em>bps-rate</em>は プリンタとの通信の転送速度[bit/秒]、 <em>parity</em>はプリ ンタとの通信で必要とされるパリティ (<code>even</code>、<code>odd</code>、 <code>none</code>、 <code>zero</code>のいずれか) を表わしていま す。</p></div><div class=paragraph><p>次の例は、 プリンタをシリアルケーブルでパリティなし、転送速度 19200 bps で第 3 番目のシリアルポートに接続した場 合です。</p></div><div class="literalblock programlisting"><div class=content><pre>printer:dv=/dev/ttyu2:br#19200:pa=none</pre></div></div></li><li><p><a href="https://man.freebsd.org/cgi/man.cgi?query=tip&amp;sektion=1&amp;format=html">tip(1)</a> コマンドでプリンタと接続します。 次のように入力してください。</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># tip printer</span></code></pre></div></div><div class=paragraph><p>これがうまくいかなかった場合は、 <span class=filename>/etc/remote</span>を編集して、 <span class=filename>/dev/ttyuN</span> の代わりに <span class=filename>/dev/cuaaN</span> を試してみてください。</p></div></li><li><p>プリンタにデータを送ります。</p><div class=ulist><ul><li><p>プリンタがプレインテキストを印字できる場合、 <a href="https://man.freebsd.org/cgi/man.cgi?query=lptest&amp;sektion=1&amp;format=html">lptest(1)</a> コマンドを使います。 次のように入力してください。</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% <span class=nv>$lptest</span></code></pre></div></div></li><li><p>プリンタが PostScript® か他のプリンタ言語を使用している場合、 そのプリンタに簡単なプログラムを入力します。 一行一行、プログラムを<em>慎重に</em>入力してください。 バックスペースキーや他の編集用のキーは、 プリンタの制御コードに割り当てられているかもしれません。 プログラムが終了したことをプリンタに伝えるための特別なファイル終了キーを 入力する必要があるかもしれません。 PostScript® プリンタの場合、 <code>CONTROL+D</code> を入力します。</p><div class=paragraph><p>もしくは、プログラムを入力したファイルがある場合は、 次のように入力してください。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% <span class=o>&gt;</span>file</code></pre></div></div><div class=paragraph><p>ここで、<em>file</em> はプログラムが格納されているファイル名です。 <a href="https://man.freebsd.org/cgi/man.cgi?query=tip&amp;sektion=1&amp;format=html">tip(1)</a> コマンドでファイルを送信した後は、 ファイル終了を表わすキーを入力する必要があります。</p></div></li></ul></div></li></ol></div></div></div><div class=paragraph><p>これで何かがプリントされることでしょう。 印字されたテキ ストがおかしくても心配しなくても構いません。 それについては、後で修正します。</p></div></div></div><div class=sect3><h4 id=printing-printcap>9.3.1.5. スプーラに許可を与える: <span class=filename>/etc/printcap</span> ファイル<a class=anchor href=#printing-printcap></a></h4><div class=paragraph><p>ここまでで、プリンタはコンピュータに接続され、(必要なら) プリンタと通信できるようにカーネルを変更し、 簡単なデータをプリンタに送信することができているはずです。 これで、LPD にプリンタへのアクセスを 制御させる設定をおこなう準備が整いました。</p></div><div class=paragraph><p>LPD の設定は <span class=filename>/etc/printcap</span> を編集することでおこないます。 LPD スプーリングシステムは スプーラが使われる毎にこのファイルを参照します。 そのため、ファイルを更新するとすぐにその変更が反映されます。</p></div><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=printcap&amp;sektion=5&amp;format=html">printcap(5)</a> ファイルの書式は簡単です。 <span class=filename>/etc/printcap</span> の編集はお好みのテキストエディタをお 使いください。このファイルの書式は、 <span class=filename>/usr/shared/misc/termcap</span> や <span class=filename>/etc/remote</span> といった他のケイパビリティファイルと一致しています。 この書式 についての詳細な情報については <a href="https://man.freebsd.org/cgi/man.cgi?query=cgetent&amp;sektion=3&amp;format=html">cgetent(3)</a> をご覧ください。</p></div><div class=paragraph><p>スプーラの単純な設定法は、 次のステップでおこないます。</p></div><div class="exampleblock procedure"><div class=content><div class="olist arabic"><ol class=arabic><li><p>プリンタに名前 (と簡単な別名 2 ～ 3 個) を付け、それを <span class=filename>/etc/printcap</span> ファイルに記述します。 これについては、「<a href=#printing-naming>プリンタに名前を付ける</a>」 を参照してください。</p></li><li><p><code>sh</code> の項目を追加することで、 ヘッダページの出力を禁止します (デフォルトは許可)。 これについては、「<a href=#printing-no-header-pages>ヘッダページの印字を禁止する</a>」 を参照してください。</p></li><li><p>スプール用のディレクトリを作成し、その位置を <code>sd</code> 項目で指定します。これについては、 「<a href=#printing-spooldir>スプーリングディレクトリの作成</a>」 を参照してください。</p></li><li><p>プリンタを使用するために <span class=filename>/dev</span> エントリを設定し、<span class=filename>/etc/printcap</span> の <code>lp</code> 項目でそのエントリを指定します。 これについては、「<a href=#printing-device>プリンタデバイスの特定</a>」 を参照してください。 プリンタをシリアルポートに接続した場合は、 <code>ms#</code> の項目を設定する必要があります。こちらについては、 「<a href=#printing-commparam>スプーラのための通信パラメータの設定</a>」 を参照してください。</p></li><li><p>プレインテキスト用の入力フィルタのインストールをおこないます。 「<a href=#printing-textfilter>テキストフィルタのインストール</a>」 を参照してください。</p></li><li><p><a href="https://man.freebsd.org/cgi/man.cgi?query=lpr&amp;sektion=1&amp;format=html">lpr(1)</a> コマンドで何かを印字することで設定のテストをおこないます。 <a href=#printing-trying>印字してみよう</a> と <a href=#printing-troubleshooting>トラブルシューティング</a> を参照してください。</p></li></ol></div></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>PostScript® プリンタのような、 プリンタ言語を使用しているプリンタには、 プレインテキストを直接印字させることができません。 上にアウトラインを示し、 以下の節で説明する簡単な設定方法の説明では、 そのようなプリンタを設置している場合は、 プリンタが認識できるファイルだけを印字の対象としているという 仮定をしています。</p></div></td></tr></tbody></table></div><div class=paragraph><p>多くの場合、 利用者はシステムに設置されているプリンタすべてで プレインテキストが印字できることを期待しています。 印字作業をおこなうために LPD のインタフェースを利用するプログラムでも、 通常、そのような仮定を置きます。 プリンタ言語を使用するプリンタを設置しており、 そのプリンタ言語で記述されたジョブと、 <em>これに加えて</em>、 プレインテキストのジョブも印字できるようにしたいならば、 上で示した簡単な設定方法に加えて、 さらなる設定をおこなうことを強くお勧めします。すなわち、 自動的にプレインテキストから PostScript® (もしくは、 他のプリンタ言語) に変換するプログラムをインストールしてください。「<a href=#printing-advanced-if-conversion>プレインテキストのジョブを PostScript® プリンタで印字する</a>」 で、それをどのようにおこなえばよいのかが説明されています。</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>日本語を印字したい場合は、プリンタ言語を使用し ていない「日本語プリンタ」についても、 プリンタ固有のエスケープシーケンスを送る必要があります。 また、漢字コードをプリン タが設定しているものに変換したりする必要があり、 各プリンタ毎に、日本語用のフィルタが必要になります。</p></div></td></tr></tbody></table></div><div class=sect4><h5 id=printing-naming>9.3.1.5.1. プリンタに名前を付ける<a class=anchor href=#printing-naming></a></h5><div class=paragraph><p>最初の (簡単な) ステップで、プリンタの名前を考えます。 プリンタには別名をいくつか付けることもできるので、 機能的な名前 でも風変わりな名前でもどちらを選んでもまったく 問題はありません。</p></div><div class=paragraph><p>少なくとも1つのプリンタには、 <span class=filename>/etc/printcap</span> の中で、 <code>lp</code> という別名を持たせるべきでしょう。 この名前はデフォルトのプリンタ名になっています。 ユーザが環境変数 <code>PRINTER</code> を設定しておらず、 かつ、LPD コマンドのコマンドラインで プリンタの名前が指定されていない場合、<code>lp</code> がデフォルトのプリンタ名となり、 そのプリンタに出力されます。</p></div><div class=paragraph><p>それから、これは共通の慣習ですが、 プリンタの最後の別名には、 メーカーやモデル名を含むプリンタの完全な名称をつけることに なっています。</p></div><div class=paragraph><p>名前と別名のいくつかを決めたら、 <span class=filename>/etc/printcap</span> ファイルに設定します。 プリンタ名は一番左のカラムから書き始めます。 別名はそれぞれ縦棒によって区切られ、 最後の別名の後ろにコロンを置きます。</p></div><div class=paragraph><p>次の例では、2 台のプリンタ (Diablo 630 ラインプリンタと Panasonic KX-P4455 PostScript® レーザライタプリンタ) が定義 されている <span class=filename>/etc/printcap</span> のスケルトンを記しています。</p></div><div class="literalblock programlisting"><div class=content><pre>#
#  /etc/printcap for host rose
#
rattan|line|diablo|lp|Diablo 630 Line Printer:

bamboo|ps|PS|S|panasonic|Panasonic KX-P4455 PostScript v51.4:</pre></div></div><div class=paragraph><p>この例では、最初のプリンタに <code>rattan</code> という名前と別名として、<code>line</code>、 <code>diablo</code>、<code>lp</code> そして <code>Diablo 630 Line Printer</code> が付けられています。別名とし て <code>lp</code> があるので、このプリンタはデフォルトのプリンタとなっ ています。2 番目は <code>bamboo</code> と名付けられ、 別名として、<code>ps</code> と <code>PS</code>、<code>S</code>、 <code>panasonic</code>、<code>Panasonic KX-P4455 PostScript v51.4</code> が付けられています。</p></div></div><div class=sect4><h5 id=printing-no-header-pages>9.3.1.5.2. ヘッダページの印字を禁止する<a class=anchor href=#printing-no-header-pages></a></h5><div class=paragraph><p>LPD スプーリングシステムでは、 デフォルトでジョブ毎に <em>ヘッダページ</em>を印字します。 ヘッダページにはジョブを要求したユーザ名、 ジョブが送られたホスト名、そして、ジョブの名前が素晴 らしい大きな文字で印字されています。 残念なことに、この余分なテキストすべてが、 簡単なプリンタ設定法のデバッグの際に紛れ込んできてしまいます。 このため、ヘッダページの出力を禁止しておきます。</p></div><div class=paragraph><p>ヘッダページの出力を禁止するには、 <span class=filename>/etc/printcap</span> にあるプリンタのエントリに <code>sh</code> の項目を追加します。次に、<code>sh</code> を加えた <span class=filename>/etc/printcap</span> の例を示します。</p></div><div class="literalblock programlisting"><div class=content><pre>#
#  /etc/printcap for host rose - no header pages anywhere
#
rattan|line|diablo|lp|Diablo 630 Line Printer:\
        :sh:

bamboo|ps|PS|S|panasonic|Panasonic KX-P4455 PostScript v51.4:\
        :sh:</pre></div></div><div class=paragraph><p>この書式を正しく使うための注意をしておきます。 最初の行は左端のカラムから始めます。 それに続く行は字下げします。最後の行以外のすべての行は、 行末にバックスラッシュを記述します。</p></div></div><div class=sect4><h5 id=printing-spooldir>9.3.1.5.3. スプーリングディレクトリの作成<a class=anchor href=#printing-spooldir></a></h5><div class=paragraph><p>スプーラの簡単な設定の次のステップでは、 <em>スプーリングディレクトリ</em>を作成します。 プリンタに送られるジョブは、 その印字が終了するまでこのディレクトリに置かれます。また、 他のたくさんのスプーラもこのディレクトリにファイルを置きます。</p></div><div class=paragraph><p>様々な事情によりスプーリングディレクトリは、通常、慣例 として <span class=filename>/var/spool</span> の下に置きます。 また、スプーリングディレクトリの内容は バックアップをする必要はありません。 <a href="https://man.freebsd.org/cgi/man.cgi?query=mkdir&amp;sektion=1&amp;format=html">mkdir(1)</a> によってディレクトリを 作るだけでスプーリングディレクトリの復旧は完了します。</p></div><div class=paragraph><p>スプーリングディレクトリの名前は、これも慣例ですが、 次のようにプリンタの名前と同じにします。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mkdir /var/spool/printer-name</span></code></pre></div></div><div class=paragraph><p>しかしながら、ネットワーク上に使用可能なプリンタがたく さんあるならば、LPD で印字するための専用のディレクトリにスプーリングディレクトリを置きたくなるかもしれません。 例に出てきたプリンタ <code>rattan</code> と <code>bamboo</code> について、この方式を採用すると、 次のようになります。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mkdir /var/spool/lpd</span>
<span class=c># mkdir /var/spool/lpd/rattan</span>
<span class=c># mkdir /var/spool/lpd/bamboo</span></code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>各ユーザが印字するジョブのプライバシを守りた いと考えているならば、スプーリングディレクトリを保護し て、これを誰からでもアクセスできないようにしたいと思う かもしれません。スプーリングディレクトリは、 <code>daemon</code> ユーザと <code>daemon</code> グループに所有され、 読み込み、書き込み、検 索可能であり、他からはアクセスできないようにするべきで す。例題のプリンタに対して、次のようにすることにしましょ う。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># chown daemon:daemon /var/spool/lpd/rattan</span>
<span class=c># chown daemon:daemon /var/spool/lpd/bamboo</span>
<span class=c># chmod 770 /var/spool/lpd/rattan</span>
<span class=c># chmod 770 /var/spool/lpd/bamboo</span></code></pre></div></div></td></tr></tbody></table></div><div class=paragraph><p>最後に、<span class=filename>/etc/printcap</span> ファイルで、 これらのディレクトリの位置を LPD に伝える必要があります。 スプーリングディレクトリのパス名は <code>sd</code> 項目で指定します。</p></div><div class="literalblock programlisting"><div class=content><pre>#
#  /etc/printcap for host rose - added spooling directories
#
rattan|line|diablo|lp|Diablo 630 Line Printer:\
        :sh:sd=/var/spool/lpd/rattan:

bamboo|ps|PS|S|panasonic|Panasonic KX-P4455 PostScript v51.4:\
        :sh:sd=/var/spool/lpd/bamboo:</pre></div></div><div class=paragraph><p>プリンタ名が最初のカラムから始まっており、 そのプリンタに関して記述される他の項目は字下げされていること、 各行がバックスラッシュで終わっていることに注意してください。</p></div><div class=paragraph><p><code>sd</code> によりスプーリングディレクトリが指定されていない場合、 スプーリングシステムは <span class=filename>/var/spool/lpd</span> をデフォルト値として使用します。</p></div></div><div class=sect4><h5 id=printing-device>9.3.1.5.4. プリンタデバイスの特定<a class=anchor href=#printing-device></a></h5><div class=paragraph><p><a href=#printing-hardware>プリンタ機器の設定</a> の節では、FreeBSD でプリンタとの通信に使用されるポートおよび <span class=filename>/dev</span> ディレクトリ内のエントリを特定します。 そして、LPD にその情報を伝えます。 印字するジョブを受け取ると、スプーリングシステムは、 (プリンタにデータを渡す義務がある) フィルタプログラムに代わって指定されたデバイスをオープンします。</p></div><div class=paragraph><p><span class=filename>/etc/printcap</span> ファイルで <code>lp</code> 項目を使って <span class=filename>/dev</span> エントリを記入します。</p></div><div class=paragraph><p>ここでの例では、<code>rattan</code> は 1 番目のパラレルポートに、<code>bamboo</code> は 6 番目のシリアルポートに接続されていることにしましょう。 このとき、<span class=filename>/etc/printcap</span> には 次のようになります。</p></div><div class="literalblock programlisting"><div class=content><pre>#
#  /etc/printcap for host rose - identified what devices to use
#
rattan|line|diablo|lp|Diablo 630 Line Printer:\
        :sh:sd=/var/spool/lpd/rattan:\
        :lp=/dev/lpt0:

bamboo|ps|PS|S|panasonic|Panasonic KX-P4455 PostScript v51.4:\
        :sh:sd=/var/spool/lpd/bamboo:\
        :lp=/dev/ttyu5:</pre></div></div><div class=paragraph><p><span class=filename>/etc/printcap</span> でプリンタの <code>lp</code> 項目が指定されていない場合は、 LPD はデフォルトとして <span class=filename>/dev/lp</span> を使用します。<span class=filename>/dev/lp</span> は、現在の FreeBSD には存在していません。</p></div><div class=paragraph><p>設置したプリンタがパラレルポートに 接続されている場合は、 「<a href=#printing-textfilter>テキストフィルタのインストール</a>」 まで読み飛ばしてください。 そうでない場合は、次節の説明に続いてください。</p></div></div><div class=sect4><h5 id=printing-commparam>9.3.1.5.5. スプーラのための通信パラメータの設定<a class=anchor href=#printing-commparam></a></h5><div class=paragraph><p>シリアルポートにプリンタを接続した場合、 LPD は、プリンタにデータを送信するフィルタプログラムに代わり、 通信速度やパリティ、 その他のシリアル通信パラメータを設定することができます。 このことによる利点は、</p></div><div class=ulist><ul><li><p><span class=filename>/etc/printcap</span> を編集するだけで、 様々な通信パラメータを試してみることができます。 フィルタプログラムを再コンパイルする必要はありません。</p></li><li><p>スプーリングシステムで、 シリアル通信の設定が異なっているかもしれない複数のプリンタに 同じフィルタプログラムを使うことが可能になります。</p></li></ul></div><div class=paragraph><p>次の <span class=filename>/etc/printcap</span> の項目で、 <code>lp</code> で指定された デバイスのシリアル通信パラメータを制御できます。</p></div><div class=dlist><dl><dt class=hdlist1><code>br#bps-rate</code></dt><dd><p>デバイスの通信速度を <em>bps-rate</em> に設定します。 ここで、<em>bps-rate</em> は 50, 75, 110, 134, 150, 200, 300, 600, 1200, 1800, 2400, 4800, 9600, 19200, 38400, 57600, 115200 [bit/秒] のいずれかです。</p></dd><dt class=hdlist1><code>ms#stty-mode</code></dt><dd><p>デバイスをオープンした後にターミナルデバイスのオプションを設定します。 利用できるオプションについては <a href="https://man.freebsd.org/cgi/man.cgi?query=stty&amp;sektion=1&amp;format=html">stty(1)</a> を参照してください。</p></dd></dl></div><div class=paragraph><p><code>lp</code> で指定されたデバイスをオープンするとき、 LPD は <code>ms#</code> で指定されたデバイスの特性を設定します。 特に関係があるのは、<code>parenb</code>, <code>parodd</code>, <code>cs5</code>, <code>cs6</code>, <code>cs7</code>, <code>cs8</code>, <code>cstopb</code>, <code>crtscts</code>, <code>ixon</code> モードです。 これらは <a href="https://man.freebsd.org/cgi/man.cgi?query=stty&amp;sektion=1&amp;format=html">stty(1)</a> のマニュアルページで説明されています。</p></div><div class=paragraph><p>例題のプリンタで6番目のシリアルポートに接続された プリンタの設定を追加してみましょう。 通信速度は 38400bps に設定します。 モードとして、<code>-parenb</code> でパリティ無し、 <code>cs8</code> で 8 ビットキャラクタ、 <code>clocal</code> でモデム制御無し、 そして <code>crtscts</code> でハードウェアフロー制御を設定します。</p></div><div class="literalblock programlisting"><div class=content><pre>bamboo|ps|PS|S|panasonic|Panasonic KX-P4455 PostScript v51.4:\
        :sh:sd=/var/spool/lpd/bamboo:\
        :lp=/dev/ttyu5:ms#-parenb cs8 clocal crtscts:</pre></div></div></div><div class=sect4><h5 id=printing-textfilter>9.3.1.5.6. テキストフィルタのインストール<a class=anchor href=#printing-textfilter></a></h5><div class=paragraph><p>ここまでで、 プリンタにジョブを送るために使うテキストフィルタを LPD に設定する準備が整いました。 <em>テキストフィルタ</em>とは、 <em>入力フィルタ</em>としても知られていますが、 印字するジョブがあるときに LPD が起動するプログラムです。 LPD がプリンタのためにテキストフィルタを起動するとき、 LPD はフィルタの標準入力からプリントするジョブを入力し、 フィルタの標準出力に項目 <code>lp</code> で指定されたプリンタデバイスを接続します。フィルタは、 標準入力からジョブを読み込み、 プリンタのための必要な変換をおこなった後、 その結果を標準出力に出力する、 これにより印字がなされることを期待されています。 テキストフィルタについての更に詳しい情報については、「<a href=#printing-advanced-filters>フィルタはどのように機能しているか</a>」 をご覧ください。</p></div><div class=paragraph><p>ここでの簡単なプリンタ設定では、 プリンタにジョブを送るため、<code>/bin/cat</code> を実行するだけの簡単なシェルスクリプトで間に合います。 FreeBSD に標準で付属している <code>lpf</code> というフィルタでは、バックスペース文字を使った 下線引きの動作をおこなう文字ストリームをうまく扱うことができない プリンタのための代替処理をおこなってくれます。 もちろん、 他のどんなフィルタプログラムを使っても構いません。 フィルタ <span class=filename>lpf</span> については、「<a href=#printing-advanced-lpf>テキストフィルタ lpf</a>」で詳しく説明します。</p></div><div class=paragraph><p>最初に、簡単なテキストフィルタであるシェルスクリプト <span class=filename>/usr/local/libexec/if-simple</span> を作ってみましょう。 次のテキストをお好みのテキストエディタでファイルに 書き込んでください。</p></div><div class="literalblock programlisting"><div class=content><pre>#!/bin/sh
#
# if-simple - Simple text input filter for lpd
# Installed in /usr/local/libexec/if-simple
#
# Simply copies stdin to stdout.  Ignores all filter arguments.

/bin/cat &amp;&amp; exit 0
exit 2</pre></div></div><div class=paragraph><p>そして、このファイルを実行可能にします。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># chmod 555 /usr/local/libexec/if-simple</span></code></pre></div></div><div class=paragraph><p>LPD にこのテキストフィルタを使うことを設定するためには、 <span class=filename>/etc/printcap</span> に <code>if</code> 項目を使って指定します。これまでの <span class=filename>/etc/printcap</span> の例のプリンタ 2 台に、 このフィルタを加えてみましょう。</p></div><div class="literalblock programlisting"><div class=content><pre>#
#  /etc/printcap for host rose - added text filter
#
rattan|line|diablo|lp|Diablo 630 Line Printer:\
        :sh:sd=/var/spool/lpd/rattan:\ :lp=/dev/lpt0:\
        :if=/usr/local/libexec/if-simple:

bamboo|ps|PS|S|panasonic|Panasonic KX-P4455 PostScript v51.4:\
        :sh:sd=/var/spool/lpd/bamboo:\
        :lp=/dev/ttyu5:ms#-parenb cs8 clocal crtscts:\
        :if=/usr/local/libexec/if-simple:</pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p><span class=filename>if-simple</span> スクリプトのコピーが <span class=filename>/usr/shared/examples/printing</span> ディレクトリにあります。</p></div></td></tr></tbody></table></div></div><div class=sect4><h5 id=_lpd_の起動>9.3.1.5.7. LPD の起動<a class=anchor href=#_lpd_の起動></a></h5><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=lpd&amp;sektion=8&amp;format=html">lpd(8)</a> は <code>lpd_enable</code> 変数に従って <span class=filename>/etc/rc</span> から実行されます。この変数の デフォルト値は <code>NO</code> です。まだ そうしていなかったならば</p></div><div class="literalblock programlisting"><div class=content><pre>lpd_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>の行を <span class=filename>/etc/rc.conf</span> に追加して 計算機を再起動するか、そのまま <a href="https://man.freebsd.org/cgi/man.cgi?query=lpd&amp;sektion=8&amp;format=html">lpd(8)</a> を 起動してください。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># lpd</span></code></pre></div></div></div><div class=sect4><h5 id=printing-trying>9.3.1.5.8. 印字してみよう<a class=anchor href=#printing-trying></a></h5><div class=paragraph><p>簡単な LPD 設定も終わりにたどり着きました。 残念ながら、設定はこれでおしまいというわけではありません。 なぜなら、さらに、設定をテストし、 すべての問題点を解決しなくてはならないからです。 設定をテストするために、 何かを印字してみましょう。 LPD システムで印字をするためには、 <a href="https://man.freebsd.org/cgi/man.cgi?query=lpr&amp;sektion=1&amp;format=html">lpr(1)</a> コマンドを使います。このコマンドは、 印字するためのジョブを投入する働きをします。</p></div><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=lpr&amp;sektion=1&amp;format=html">lpr(1)</a> コマンドを 「<a href=#printing-testing>プリンタとの通信状況を調べる</a>」で紹介した、 あるテスト用のテキストを生成してくれる <a href="https://man.freebsd.org/cgi/man.cgi?query=lptest&amp;sektion=1&amp;format=html">lptest(1)</a> プログラムと一緒に使うこともできます。</p></div><div class=paragraph><p><em>簡単な LPD 設定のテスト</em></p></div><div class=paragraph><p>次のように入力してください。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># lptest 20 5 | lpr -Pprinter-name</span></code></pre></div></div><div class=paragraph><p>ここで、<em>printer-name</em> は <span class=filename>/etc/printcap</span> で指定したプリンタ名 (もしくはその別名) です。デフォルト のプリンタを使用する場合は、 <code>-P</code> 引数を付けないで <a href="https://man.freebsd.org/cgi/man.cgi?query=lpr&amp;sektion=1&amp;format=html">lpr(1)</a> を打ち込んでください。もう一度述べますが、 PostScript® を期待しているプリンタをテストするならば、 <a href="https://man.freebsd.org/cgi/man.cgi?query=lptest&amp;sektion=1&amp;format=html">lptest(1)</a> を使う代わりに PostScript® で書かれた プログラムをプリンタに送ってください。 プログラムを送るためには、プログラムをファイルに格納して、 <code>lpr file</code> と打ち込みます。</p></div><div class=paragraph><p>PostScript® プリンタの場合、 送信したプログラムによる結果が得られるでしょう。 <a href="https://man.freebsd.org/cgi/man.cgi?query=lptest&amp;sektion=1&amp;format=html">lptest(1)</a> を使った場合は、 以下のような結果が見られるでしょう。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=o>!</span><span class=s2>&#34;#</span><span class=nv>$%</span><span class=s2>&amp;&#39;()*+,-./01234
&#34;</span><span class=c>#$%&amp;&#39;()*+,-./012345</span>
<span class=c>#$%&amp;&#39;()*+,-./0123456</span>
<span class=nv>$%</span>&amp;<span class=s1>&#39;()*+,-./01234567
%&amp;&#39;</span><span class=o>()</span><span class=k>*</span>+,-./012345678</code></pre></div></div><div class=paragraph><p>更にプリンタをテストしたい場合は、 (言語ベースのプリンタのための) もっと大きなプログラムを送信するか、 引数を変えて <a href="https://man.freebsd.org/cgi/man.cgi?query=lptest&amp;sektion=1&amp;format=html">lptest(1)</a> を実行します。たとえば、<code>lptest 80 60</code> で、それぞれ 80 文字の行を 60 行生成します。</p></div><div class=paragraph><p>プリンタがうまく動かなかった場合は、次の節、「<a href=#printing-troubleshooting>トラブルシューティング</a>」をご覧ください。</p></div></div></div></div></div></div><div class=sect1><h2 id=printing-advanced>9.4. プリンタ設定上級編<a class=anchor href=#printing-advanced></a></h2><div class=sectionbody><div class=paragraph><p>この節では、特殊な形式のファイルを印字するためのフィルタ、 ヘッダページ、ネットワーク越しのプリンタへの印字、そして、 プリンタ使用の制限や課金について説明しています。</p></div><div class=sect2><h3 id=printing-advanced-filter-intro>9.4.1. フィルタ<a class=anchor href=#printing-advanced-filter-intro></a></h3><div class=paragraph><p>LPD は、ネットワークプロトコル、キュー、アクセス制御などの 印刷にかかわるさまざまな点を扱いますが、 <em>実際の</em>作業のほとんどは <em>フィルタ</em>によっておこなわれています。 フィルタは、プリンタと通信し、 プリンタのデバイス依存性や特殊な要求を扱うプログラムです。 簡単なプリンタ設定では、 プレインテキストのためのフィルタをインストールしました。 このプレインテキストフィルタは、 ほとんどのプリンタで機能する極めて単純なものでした (「<a href=#printing-textfilter>テキストフィルタのインストール</a>」を参照)。</p></div><div class=paragraph><p>しかしながら、形式変換やプリンタ課金、特定のプリンタの癖、 など をうまく利用するためには、 フィルタがどのように機能するかという ことを理解しておくべきです。これらの側面を扱うことは、 最終的には、フィルタの責任であるからです。 そして、これは悪い情報ですが、ほとんどの場合において、 <em>あなた自身</em>が フィルタを供給する必要があるということです。また都合のよいことには、 たくさんのフィルタが一般的に利用できるということです。 もしフィルタがなかったとしても、 普通はフィルタを作るのは簡単です。</p></div><div class=paragraph><p>FreeBSD にも、プレインテキストを印字させることができる <span class=filename>/usr/libexec/lpr/lpf</span> というフィルタが 1 つ付いています (このフィルタはファイルに含まれるバックスペースやタブを扱います。 また、課金をすることもできますが、 できることはこれだけしかありません)。 いくつかのフィルタとフィルタの構成要素は FreeBSD Ports Collection にもあります。</p></div><div class=paragraph><p>この節で述べることは次の通りです。</p></div><div class=ulist><ul><li><p>「<a href=#printing-advanced-filters>フィルタはどのように機能しているか</a>」では、 印字の過程におけるフィルタの役割を概説します。 この節を読むことで、LPD がフィルタを使うときに、"見えないところで" 何が起こっているかが理解できるでしょう。このことを知っておくと、 プリンタそれぞれに様々なフィルタをインストールしたときに 遭遇するかもしれない問題を予期したり、 デバッグするときに役立つでしょう。</p></li><li><p>LPD は、すべてのプリンタがデフォルトでプレインテキストを印字できることを期待しています。 これは、プレインテキストを直接印字できない PostScript® (または他の言語対応の) プリンタで問題になります。「<a href=#printing-advanced-if-conversion>プレインテキストのジョブを PostScript® プリンタで印字する</a>」 で、 この問題を克服する方法について述べます。 PostScript® プリンタをお持ちの方は、 この節をお読みになることをおすすめします。</p></li><li><p>PostScript® は様々なプログラムのための有名な出力形式です。 PostScript® のコードを直接書いてしまう人すらいます。 残念ながら、PostScript® プリンタは高価です。「<a href=#printing-advanced-ps>非 PostScript® プリンタによる PostScript® のシミュレート</a>」節では、PostScript® データを<em>非 PostScript® プリンタ</em>に受けつけさせ、印字させるために、 どのようにしてプリンタ用のテキストフィルタをさらに変更すればよいのか、 ということについて説明しています。PostScript® プリンタを持っていない方は、 この節をお読みになることをおすすめします。</p></li><li><p>「<a href=#printing-advanced-convfilters>変換フィルタ</a>」では、 図形や組版データといった特定のファイル形式を、 プリンタが理解できる形式へ変換する作業を自動的におこなわせる方法について述べます。 この節を読むと、troff のデータを印字するには <code>lpr -t</code>, または、TeX DVI を印字するには <code>lpr -d</code>、 ラスタイメージデータを印字するには <code>lpr -v</code>、 などといったようにユーザが入力することができるように プリンタの設定をおこなうことができます。 この節もお読みになることをお薦めします。</p></li><li><p>「<a href=#printing-advanced-of>出力フィルタ</a>」 では、あまり使われない LPD の機能のすべて、すなわち、 出力フィルタに関することが記述されています。ヘッダページ (「<a href=#printing-advanced-header-pages>ヘッダページ</a>」参照) を印字させていない場合は、 多分、この節は飛ばしても構わないでしょう。</p></li><li><p>「<a href=#printing-advanced-lpf>テキストフィルタ lpf</a>」では、<code>lpf</code> についての説明が、ほぼ完全におこなわれています。これは FreeBSD に付属するラ インプリンタ (または、 ラインプリンタのように動作するレーザプリンタ) のための、 単純なテキストフィルタです。 プレインテキストを印字したことに対して課金をおこなう方法が 至急必要な場合、もしくは、バックスペース文字を印字しようと すると煙を発するプリンタを持っている場合は、絶対に <code>lpf</code> を検討するべきです。</p></li></ul></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>以下で述べられているさまざまなスクリプトは、<span class=filename>/usr/shared/examples/printing</span> ディレクトリにあります。</p></div></td></tr></tbody></table></div><div class=sect3><h4 id=printing-advanced-filters>9.4.1.1. フィルタはどのように機能しているか<a class=anchor href=#printing-advanced-filters></a></h4><div class=paragraph><p>既に言及したように、フィルタとは、プリンタにデータを送る際に、 デバイスに依存した部分を取り扱うために LPD によって起動される実行プログラムです。</p></div><div class=paragraph><p>LPD がジョブ中のファイルを印字しようとするとき、 LPD はフィルタプログラムを起動します。このとき、 フィルタの標準入力を印字するファイルに、 標準出力をプリンタに、そして、標準エラー出力を エラーログファイル (<span class=filename>/etc/printcap</span> 内の <code>lf</code> 項目で指定されたファイル、または、 指定されていない場合は、デフォルトとして <span class=filename>/dev/console</span>) にセットします。</p></div><div class=paragraph><p>LPD が起動するフィルタと、その引数が何であるかは、 <span class=filename>/etc/printcap</span> ファイルの内容と、ジョブの起動時にユーザが指定した <a href="https://man.freebsd.org/cgi/man.cgi?query=lpr&amp;sektion=1&amp;format=html">lpr(1)</a> コマンドの引数に依存しています。 たとえば、ユーザが <code>lpr -t</code> と入力した場合は、 LPD は出力先のプリンタ用の <code>tf</code> 項目で指定されている troff 用のフィルタを起動させるでしょう。 ユーザがプレインテキストの印字を指示したときは、 <code>if</code> で指定されたフィルタが起動されるでしょう (このことはほとんどの場合にあてはまります。 詳細については、「<a href=#printing-advanced-of>出力フィルタ</a>」をご覧ください)。</p></div><div class=paragraph><p><span class=filename>/etc/printcap</span> で指定可能なフィルタは次の3種類があります。</p></div><div class=ulist><ul><li><p><em>テキストフィルタ</em> (LPD のドキュメントでは紛らわしいことに <em>入力フィルタ</em>と呼んでいますが) は一般のテキストの印字を扱います。これはデフォルトのフィルタと 考えてください。LPD では、すべてのプリンタに対して、 デフォルトでプレインテキストが印字できることを期待しています。 さらに、バックスペースやタブを正しく扱い、また、 他の特殊な文字が入力されてもプリンタに混乱を来さないように するのはテキストフィルタの仕事であると考えています。 プリンタの使用に対して課金をしなくてはならない環境にあ るときは、テキストフィルタが印字したページ数を数える作 業もしなくてはなりません。この作業は、通常、印字した行 数を数え、これをプリンタが 1 ページ当たりに印字できる行 数と比較することでおこなわれます。 テキストフィルタは、次のような引数を付けて起動されます。</p><div class=paragraph><p><code>filter-name [ -c ] -w <em>width</em> -l <em>length</em> -i <em>indent</em> -n <em>login</em> -h <em>host</em> <em>acct-file</em></code></p></div><div class=paragraph><p>ここで、</p></div><div class=dlist><dl><dt class=hdlist1><code>-c</code></dt><dd><p><code>lpr -l</code> によってジョブが入力されたときに与えられます。</p></dd><dt class=hdlist1><em>width</em></dt><dd><p><span class=filename>/etc/printcap</span> で指定された <code>pw</code> (page width) 項目の値が与えられます。デフォルトは、 132 です。</p></dd><dt class=hdlist1><em>length</em></dt><dd><p><code>pl</code> (page length) 項目で指定された値が与えられます。 デフォルトは 66 です。</p></dd><dt class=hdlist1><em>indent</em></dt><dd><p><code>lpr -i</code> によって与えられた字下げの量で、 デフォルトは 0 です。</p></dd><dt class=hdlist1><em>login</em></dt><dd><p>ファイルを印字したユーザのアカウント名が 与えられます。</p></dd><dt class=hdlist1><em>host</em></dt><dd><p>ジョブが入力されたホスト名が 与えられます。</p></dd><dt class=hdlist1><em>acct-file</em></dt><dd><p><code>af</code> 項目で指定されている課金データファイル の名前が与えられます。</p></dd></dl></div></li><li><p><em>変換フィルタ</em>は、 特定のファイル形式をプリンタ が紙に印字できるようなものに変換します。たとえば、 プリンタで ditroff 組版データを直接印字することはできません。 しかし、ditroff データをプリンタが消化し、 印字することができる形式へ変換するために、ditroff ファイル用フィルタをインストールすることができます。 「<a href=#printing-advanced-convfilters>変換フィルタ</a>」 で、これらに関するすべてについて説明します。 プリンタの課金をする必要がある場合は、 変換フィルタでも印字ページを数える作業が必要となります。 変換フィルタは次の引数をとって起動されます。</p><div class=paragraph><p><code>filter-name -x <em>pixel-width</em> -y <em>pixel-height</em> -n <em>login</em> -h <em>host</em> <em>acct-file</em></code></p></div><div class=paragraph><p>ここで、<em>pixel-width</em> は、 <code>px</code> 項目で指定された値 (デフォルトは 0)、 <em>pixel-height</em> は、 <code>py</code> 項目で指定された値 (デフォルトは 0) です。</p></div></li><li><p><em>出力フィルタ</em>は、 テキストフィルタが指定されて おらず、かつ、 ヘッダページの出力が許可されている場合にのみ使われます。 「<a href=#printing-advanced-of>出力フィルタ</a>」で、これらのことについて説明します。 出力フィルタに対する引数は次の 2 つだけです。</p><div class=paragraph><p><code>filter-name -w <em>width</em> -l <em>length</em></code></p></div><div class=paragraph><p>ここで、<code>-w</code> と <code>-l</code> は、 テキストフィルタの場合と同じです。</p></div></li></ul></div><div class=paragraph><p>フィルタは、次に示す終了状態をもってプログラムを <em>exit</em> するべきです。</p></div><div class=dlist><dl><dt class=hdlist1>exit 0</dt><dd><p>フィルタがファイルを正常に印字した場合。</p></dd><dt class=hdlist1>exit 1</dt><dd><p>フィルタはファイルの印字に失敗したが、 LPD に再度ファイルの印字を試みて欲しい場合。 この終了状態で終了した場合、LPD はフィルタを再スタートします。</p></dd><dt class=hdlist1>exit 2</dt><dd><p>フィルタはファイルの印字に失敗し、かつ、LPD に再出力を試みて欲しくない場合。この場合、LPD はそのファイルを放棄します。</p></dd></dl></div><div class=paragraph><p>FreeBSD に付属するテキストフィルタ <span class=filename>/usr/libexec/lpr/lpf</span> は、FORM FEED 文字が送られたときやプリンタ使用に対する課金をどのようにするかを決定するために、 ページ幅やページ長の引数を利用します。また、 課金用のエントリを作成するため、ログイン名、ホスト名、 課金ファイル名の引数を利用します。</p></div><div class=paragraph><p>もし、フィルタの購入を検討しているならば、LPD と互換性があるかどうかを確認してください。もしそうならば、 上述の引数リストをサポートしていなければなりません。 一般向けの使用のためにフィルタを作成する計画をしている場合は、 同じ引数リストと終了コードをサポートしてください。</p></div></div><div class=sect3><h4 id=printing-advanced-if-conversion>9.4.1.2. プレインテキストのジョブを PostScript® プリンタで印字する<a class=anchor href=#printing-advanced-if-conversion></a></h4><div class=paragraph><p>コンピュータと PostScript® (または、他の言語に対応した) プリンタをあなたしか使用しない場合は、プリンタにプレ インテキストを絶対に送らない、そして、 プリンタにプレインテキストを送りたがっている 様々なプログラムの機能を決して使わないことにしてください。そうすれば、 この節に書かれたことに心を煩わせる必要はまったくなくなります。</p></div><div class=paragraph><p>しかし、PostScript® とプレインテキストの両方のジョブをプリンタへ送りたいと思っている場合は、 プリンタ設定についての要求が増えるでしょう。 両者をプリンタへ送信するためには、 到着したジョブがプレインテキストであるか PostScript® であるかを検出するテキストフィルタが必要です。 PostScript® のジョブはすべて <code>%!</code> で始まらなければならないことになっています (他のプリンタ言語に関しては、 プリンタのドキュメントをご覧ください)。 ジョブの最初の 2 文字がこれならば、PostScript® であることが分かります。 したがって、 ジョブのそれ以降の部分をプリンタに直接送ることができます (訳注: PostScript® では、<em>%</em> 以降はコメントとして扱われるので、最初の <em>%!</em> の行を読み捨てても問題はない)。 最初の2文字が <em>%!</em> でない場合は、 フィルタはテキストを PostScript® に変換し、 その結果を使って印字をおこないます。</p></div><div class=paragraph><p>この作業をどうやってやればよいのでしょうか。</p></div><div class=paragraph><p>シリアルポートにプリンタを接続した場合は、 <code>lprps</code> をインストールすることをお勧めします。 <code>lprps</code> は PostScript® 用のフィルタで、 プリンタとの双方向通信をおこないます。 このフィルタでは、プリンタからの冗長な情報を得ることで、 プリンタの状況を示すファイルが更新されていきます。 したがって、ユーザや管理者は (<code>トナー残量少</code>や <code>紙詰まり</code>といった) プリンタの状況を正確に知ることができます。しかし、 もっと重要なことは、<code>psif</code> と呼ばれるプログラムが含まれているということです。 このプログラムは、 入力されたジョブがプレインテキストかどうかを検出し、 これを PostScript® に変換するために、<code>textps</code> (<code>lprps</code> に付属する別のプログラム) を呼び出します。そして、このジョブをプリンタに送るために、 <code>lprps</code> が使われます。</p></div><div class=paragraph><p><code>lprps</code> は FreeBSD Ports Collection に含まれています (<a href=../ports/#ports>Ports Collection</a> を参照してください)。 紙のサイズに合わせて <a class=package href=https://cgit.freebsd.org/ports/tree/print/lprps-a4/>print/lprps-a4</a> または <a class=package href=https://cgit.freebsd.org/ports/tree/print/lprps-letter/>print/lprps-letter</a> port をインストールしてください。<code>lprps</code> をインストールした後は、<code>lprps</code> の一部である <code>psif</code> プログラムのパス名を指定するだけです。Ports Collection から <code>lprps</code> をインストールしたときは、 <span class=filename>/etc/printcap</span> の中のシリアル接続した PostScript® プリンタのエントリに対して、次を使ってください。</p></div><div class="literalblock programlisting"><div class=content><pre>:if=/usr/local/libexec/psif:</pre></div></div><div class=paragraph><p>LPD にプリンタをリード・ライトモードでオープンさせるために、 <code>rw</code> 項目も指定すべきです。</p></div><div class=paragraph><p>パラレルポート接続の PostScript® プリンタの場合 (すなわち、 <code>lprps</code> が 必要としているプリンタとの双方向通信ができない)、 テキストフィルタとして次のシェルスクリプトを使うことができます。</p></div><div class="literalblock programlisting"><div class=content><pre>#!/bin/sh
#
#  psif - Print PostScript or plain text on a PostScript printer
#  Script version; NOT the version that comes with lprps
#  Installed in /usr/local/libexec/psif
#

IFS=&#34;&#34; read -r first_line
first_two_chars=`expr &#34;$first_line&#34; : &#39;\(..\)&#39;`

if [ &#34;$first_two_chars&#34; = &#34;%!&#34; ]; then
   #
   #  PostScript job, print it.
   #
   echo &#34;$first_line&#34; &amp;&amp; cat &amp;&amp; printf &#34;\004&#34; &amp;&amp; exit 0
   exit 2
else
   #
   #  Plain text, convert it, then print it.
   #
   ( echo &#34;$first_line&#34;; cat ) | /usr/local/bin/textps &amp;&amp; printf &#34;\004&#34; &amp;&amp; exit 0
   exit 2
fi</pre></div></div><div class=paragraph><p>上記のスクリプトにおいて、<code>textps</code> はプレインテキストから PostScript® へ変換するために別にインストールしたプログラムです。 テキストから PostScript® へ変換するのには、 お好みのどんなプログラムでも使うことができます。FreeBSD Ports Collection (<a href=../ports/#ports>Ports Collection</a> を参照してください) には、<code>a2ps</code> と呼ばれるテキストから PostScript® に変換するプログラムが入っています。</p></div></div><div class=sect3><h4 id=printing-advanced-ps>9.4.1.3. 非 PostScript® プリンタによる PostScript® のシミュレート<a class=anchor href=#printing-advanced-ps></a></h4><div class=paragraph><p>PostScript® は質の高い組版と印字をおこなうための <em>事実上の</em>標準です。しかしながら、PostScript® は、<em>高価な</em>標準です。ありがたいことに、 Aladdin Enterprises から Ghostscript と呼ばれる、 PostScript® 互換の動作をするフリーのプログラムが出されていて、 FreeBSD で動きます。 Ghostscript はほとんどの PostScript® ファイルを読むことができ、 これらの各ページを多くのブランドの非 PostScript® プリンタを含む 様々なデバイス用に変換することができます。 Ghostscript をインストールし、 プリンタ用の特別なテキストフィルタを使うことによって、 非 PostScript® プリンタをあたかも本物の PostScript® プリンタであるかのように動作させることができます。</p></div><div class=paragraph><p>Ghostscript は FreeBSD Ports Collection に入っています。 複数のバージョンがありますが、最も良く使われているバージョンは <a class=package href=https://cgit.freebsd.org/ports/tree/print/ghostscript-gpl/>print/ghostscript-gpl</a> です。</p></div><div class=paragraph><p>PostScript® プリンタをシミュレートさせる場合は、 テキストフィルタに PostScript® ファイルを印字しようとしているかどうかを検出させます。 PostScript® ファイルでない場合は、 フィルタはそのファイルを直接プリンタに送ります (訳注: テキストファイルを直接印字できない場合は、もちろん、 変換フィルタを通す必要があります)。PostScript® の場合は、 まず、Ghostscript を使い、 ファイルをそのプリンタが理解できる形式へ変換します。</p></div><div class=paragraph><p>次の例のスクリプトは、Hewlett Packard DeskJet 500 プリンタ用 のテキストフィルタです。 他のプリンタで用いるときは、<code>-sDEVICE</code> 引数を <code>gs</code> (Ghostscript) コマンドに変えてください (<code>gs -h</code> と入力すると、現在インストールされている Ghostscript でサポートされているデバイスのリストが得られます)。</p></div><div class="literalblock programlisting"><div class=content><pre>#!/bin/sh
#
#  ifhp - Print Ghostscript-simulated PostScript on a DeskJet 500
#  Installed in /usr/local/libexec/ifhp

#
#  Treat LF as CR+LF (to avoid the &#34;staircase effect&#34; on HP/PCL
#  printers):
#
printf &#34;\033&amp;k2G&#34; || exit 2

#
#  Read first two characters of the file
#
IFS=&#34;&#34; read -r first_line
first_two_chars=`expr &#34;$first_line&#34; : &#39;\(..\)&#39;`

if [ &#34;$first_two_chars&#34; = &#34;%!&#34; ]; then
    #
    #  It is PostScript; use Ghostscript to scan-convert and print it.
    #
    /usr/local/bin/gs -dSAFER -dNOPAUSE -q -sDEVICE=djet500 \
      -sOutputFile=- - &amp;&amp; exit 0

else
    #
    #  Plain text or HP/PCL, so just print it directly; print a form feed
    #  at the end to eject the last page.
    #
    echo &#34;$first_line&#34; &amp;&amp; cat &amp;&amp; printf &#34;\033&amp;l0H&#34; &amp;&amp;
    exit 0
fi

exit 2</pre></div></div><div class=paragraph><p>最後に、<code>if</code> 項目を通して、LPD にこのフィルタを教えてやる必要があります。</p></div><div class="literalblock programlisting"><div class=content><pre>:if=/usr/local/libexec/ifhp:</pre></div></div><div class=paragraph><p>これでおしまいです。<code>lpr plain.text</code> とか <code>lpr whatever.ps</code> と入力してみましょう。どちらも正常に印字されるはずです。</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>日本語を印字する場合は、 日本語対応の Ghostscript が必要です。日本語対応版の Ghostscript も Ports Collection に入っています。</p></div></td></tr></tbody></table></div></div><div class=sect3><h4 id=printing-advanced-convfilters>9.4.1.4. 変換フィルタ<a class=anchor href=#printing-advanced-convfilters></a></h4><div class=paragraph><p>「<a href=#printing-simple>プリンタ設定導入編</a>」 に書かれた簡単な設定が完了したら、最初に、 やってみたいと思うことは、多分 (プレイン ASCII テキストに加えて) 好みのファイル形式のための変換フィルタをインストールすることでしょう。</p></div><div class=sect4><h5 id=_なぜ変換フィルタをインストールするのか>9.4.1.4.1. なぜ、変換フィルタをインストールするのか?<a class=anchor href=#_なぜ変換フィルタをインストールするのか></a></h5><div class=paragraph><p>変換フィルタによって、 様々な種類のファイルを印字することが簡単になります。たとえば、TeX 組版システムでたくさんの仕事をしたと仮定しましょう。 そして、PostScript® プリンタが接続 されているとします。 すると、TeX で DVI ファイルを作成する度に、DVI ファイルを印字するために、 これを PostScript® ファイルに変換する必要があります。 このコマンドは次のようになるでしょう。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% dvips seaweed-analysis.dvi
% lpr seaweed-analysis.ps</code></pre></div></div><div class=paragraph><p>DVI ファイル用の変換フィルタがインストールしてあると、 LPD に変換を肩代わりさせることで毎回毎回 おこなわなければならなかった面倒な変換作業を省くことができます。 つまり、DVI を生成したら、 次のようなコマンドを入力するだけで、これが印字されます。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% lpr <span class=nt>-d</span> seaweed-analysis.dvi</code></pre></div></div><div class=paragraph><p>LPD に DVI ファイルの変換をさせるためには、 <code>-d</code> オプション を指定します。 変換オプションのリストは「<a href=#printing-lpr-options-format>整形と変換に関するオプション</a>」 に載せてあります。</p></div><div class=paragraph><p>変化のオプションのそれぞれをプリンタに サポートさせるためには、 <em>変換フィルタ</em>をインストールし、 そのパス名を <span class=filename>/etc/printcap</span> の中で指定しなくてはなりません。変換フィルタは、 プレインテキストを印字する代わりに、フィルタはファイルを プリンタが理解できる形式に変換するところを除けば、 「プリンタの簡単な設定」で説明したテキストファイル (「<a href=#printing-textfilter>テキストフィルタのインストール</a>」 を見て下さい) に似ています。</p></div></div><div class=sect4><h5 id=_どの変換フィルタをインストールすべきか>9.4.1.4.2. どの変換フィルタをインストールすべきか?<a class=anchor href=#_どの変換フィルタをインストールすべきか></a></h5><div class=paragraph><p>使いたいと思う変換フィルタをインストールすべきです。 DVI のデータを頻繁に印字するならば、DVI 変換フィルタ をインストールするのが適切でしょう。印字しなくてはなら ない troff を大量に抱えている場合は、多分、 troff フィルタが欲しくなるはずです。</p></div><div class=paragraph><p>次の表は、LPD で動作するフィルタと、 <span class=filename>/etc/printcap</span> ファイルでのエントリする項目、そして、 <code>lpr</code> コマンドで呼び出す方法をまとめたものです。</p></div><table class="tableblock frame-none grid-all stretch informaltable"><col style=width:33.3333%><col style=width:33.3333%><col style=width:33.3334%><thead><tr><th class="tableblock halign-left valign-top">ファイル形式</th><th class="tableblock halign-left valign-top">/etc/printcap項目</th><th class="tableblock halign-left valign-top">lpr オプション</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock>cifplot</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>cf</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>-c</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>DVI</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>df</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>-d</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>plot</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>gf</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>-g</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>ditroff</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>nf</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>-n</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>FORTRAN text</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>rf</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>-f</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>troff</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>tf</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>-f</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>raster</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>vf</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>-v</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>プレインテキスト</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>if</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>なし、<code>-p</code>、または <code>-l</code></p></td></tr></tbody></table><div class=paragraph><p>先の例のように、<code>lpr -d</code> を使うためには、出力先のプリンタの <span class=filename>/etc/printcap</span> 内のエントリで、 <code>df</code> 項目が必要であることが分かります。</p></div><div class=paragraph><p>反論はあるかも知れませんが、FORTRAN テキストや plot のような形式は、多分、廃れてていくでしょう。 あなたのサイトで、自前のフィルタをインストールするだけで、 プリントオプションのいくつか、あるいは、 全部に新しい意味を与えることができます。たとえば、 Printerleaf ファイル (Interleaf デスクトップパブリッシングプログラムによるファイル) を直接印字したいとします。 そして、Printerleaf 用の変換フィルタを <code>gf</code> 項目で 指定したパスにインストールすれば、<code>lpr -g</code> の意味は "Printerleaf ファイルを印字する" 意味だとユーザに教えることができます。</p></div></div><div class=sect4><h5 id=_変換フィルタのインストール>9.4.1.4.3. 変換フィルタのインストール<a class=anchor href=#_変換フィルタのインストール></a></h5><div class=paragraph><p>変換フィルタは FreeBSD の基本システムのインストールとは別にインストールするプログラムなので、 変換フィルタは、 <span class=filename>/usr/local</span> ディレクトリの下に置くべきでしょう。 フィルタは LPD だけが実行する特別なプログラム、 すなわち、一般ユーザが実行する必要すらないプログラムなので、 <span class=filename>/usr/local/libexec</span> ディレクトリに置くのが普通です。</p></div><div class=paragraph><p>変換フィルタを使用可能にするためには、 <span class=filename>/etc/printcap</span> の目的のプリンタの適切な項目に フィルタがあるパス名を指定します。</p></div><div class=paragraph><p>DVI 変換フィルタをプリンタ <code>bamboo</code> のエントリに加えてみましょう。プリンタ <code>bamboo</code> の <code>df</code> 項目を新たに加えた <span class=filename>/etc/printcap</span> ファイルの例を以下に再掲します。</p></div><div class="literalblock programlisting"><div class=content><pre>#
#  /etc/printcap for host rose - added df filter for bamboo
#
rattan|line|diablo|lp|Diablo 630 Line Printer:\
        :sh:sd=/var/spool/lpd/rattan:\
        :lp=/dev/lpt0:\
        :if=/usr/local/libexec/if-simple:

bamboo|ps|PS|S|panasonic|Panasonic KX-P4455 PostScript v51.4:\
        :sh:sd=/var/spool/lpd/bamboo:\
        :lp=/dev/ttyu5:ms#-parenb cs8 clocal crtscts:rw:\
        :if=/usr/local/libexec/psif:\
        :df=/usr/local/libexec/psdf:</pre></div></div><div class=paragraph><p>DVI フィルタは <span class=filename>/usr/local/libexec/psdf</span> という 名前のシェルスクリプトです。 このスクリプトは次のようになっています。</p></div><div class="literalblock programlisting"><div class=content><pre>#!/bin/sh
#
#  psdf - DVI to PostScript printer filter
#  Installed in /usr/local/libexec/psdf
#
#  Invoked by lpd when user runs lpr -d
#
exec /usr/local/bin/dvips -f | /usr/local/libexec/lprps &#34;$@&#34;</pre></div></div><div class=paragraph><p>このスクリプトでは、<code>dvips</code> をフィルタモード (引数 <code>-f</code>) で、 標準入力上で起動しています。標準入力は印字するジョブです。 それから、PostScript® プリンタ用フィルタ <code>lprps</code> (これについては「<a href=#printing-advanced-if-conversion>プレインテキストのジョブを PostScript® プリンタで印字する</a>」 を参照してください) を LPD に与えられた引数を付けて起動します。 <code>lprps</code> はこれらの引数を印字されたページ分の課金をおこなうために使われます。</p></div></div><div class=sect4><h5 id=_変換フィルタのその他の例>9.4.1.4.4. 変換フィルタのその他の例<a class=anchor href=#_変換フィルタのその他の例></a></h5><div class=paragraph><p>変換フィルタのインストールには決まったステップがないので、 この節では、例をもっと挙げることにします。 これを自分でフィルタを作る際のガイドにしてください。 適当な例があったら、それをそのまま使ってください。</p></div><div class=paragraph><p>次のスクリプト例は、Hewlett Packard LaserJet III-Si のための、raster (ええと・・実は、GIF ファイル) 用の変換フィルタです。</p></div><div class="literalblock programlisting"><div class=content><pre>#!/bin/sh
#
#  hpvf - Convert GIF files into HP/PCL, then print
#  Installed in /usr/local/libexec/hpvf

PATH=/usr/X11R6/bin:$PATH; export PATH

giftopnm | ppmtopgm | pgmtopbm | pbmtolj -resolution 300 \
    &amp;&amp; exit 0 \
    || exit 2</pre></div></div><div class=paragraph><p>ここでは、GIF ファイルから PNM (portable anymap) 形式に変換し、次に PGM (portable graymap) 形式に変換してから、 LaserJet/PCL-互換データに変換しています。</p></div><div class=paragraph><p>上記のフィルタを使うプリンタのためのエントリを付け加えた <span class=filename>/etc/printcap</span> ファイルは次のようになります。</p></div><div class="literalblock programlisting"><div class=content><pre>#
#  /etc/printcap for host orchid
#
teak|hp|laserjet|Hewlett Packard LaserJet 3Si:\
        :lp=/dev/lpt0:sh:sd=/var/spool/lpd/teak:mx#0:\
        :if=/usr/local/libexec/hpif:\
        :vf=/usr/local/libexec/hpvf:</pre></div></div><div class=paragraph><p>次のスクリプトは、PostScript® プリンタ <code>bamboo</code> のための groff 組版システムの troff データのための変換フィルタです。</p></div><div class="literalblock programlisting"><div class=content><pre>#!/bin/sh
#
#  pstf - Convert groff&#39;s troff data into PS, then print.
#  Installed in /usr/local/libexec/pstf
#
exec grops | /usr/local/libexec/lprps &#34;$@&#34;</pre></div></div><div class=paragraph><p>上記のスクリプトではプリンタとの通信をおこなうため、 <code>lprps</code> をまた利用しています。 プリンタがパラレルポートに接続されている場合は、代わりに、 次のスクリプトを使うかもしれません。</p></div><div class="literalblock programlisting"><div class=content><pre>#!/bin/sh
#
#  pstf - Convert groff&#39;s troff data into PS, then print.
#  Installed in /usr/local/libexec/pstf
#
exec grops</pre></div></div><div class=paragraph><p>これで完成しました。次に、フィルタを使用可能にするため に <span class=filename>/etc/printcap</span> に加える必要があるエントリを示します。</p></div><div class="literalblock programlisting"><div class=content><pre>:tf=/usr/local/libexec/pstf:</pre></div></div><div class=paragraph><p>次の例をみたら、FORTRAN のベテランは赤面するかもしれません。 この FORTRAN テキストフィルタは、 プレインテキストを直接印字できるすべてのプリンタで利用できます。 このフィルタをプリンタ <code>teak</code> にインストールすることにしましょう。</p></div><div class="literalblock programlisting"><div class=content><pre>#!/bin/sh
#
# hprf - FORTRAN text filter for LaserJet 3si:
# Installed in /usr/local/libexec/hprf
#

printf &#34;\033&amp;k2G&#34; &amp;&amp; fpr &amp;&amp; printf &#34;\033&amp;l0H&#34; &amp;&amp; exit 0
exit 2</pre></div></div><div class=paragraph><p>そして、このフィルタを使用可能にするため、以下の行を <span class=filename>/etc/printcap</span> のプリンタ <code>teak</code> のエントリに加えます。</p></div><div class="literalblock programlisting"><div class=content><pre>:rf=/usr/local/libexec/hprf:</pre></div></div><div class=paragraph><p>これが最後の、そして、若干複雑な例です。前に紹介した LaserJet プリンタ <code>teak</code> に、DVI フィルタを加える ことにしましょう。最初に、 簡単な部分をおこないます。すなわち、DVI フィルタの位置を <span class=filename>/etc/printcap</span> に書き加えます。</p></div><div class="literalblock programlisting"><div class=content><pre>:df=/usr/local/libexec/hpdf:</pre></div></div><div class=paragraph><p>さて、難しい部分であるフィルタの作成をおこないます。 このために、DVI から LaserJet/PCL への変換プログラムが必要です。FreeBSD の Ports Collection (<a href=../ports/#ports>Ports Collection</a> を参照してください) には、それがあります。 <a class=package href=https://cgit.freebsd.org/ports/tree/dvi2xx/>dvi2xx</a> というのがその port の名前です。 これをインストールすると、必要なプログラム <code>dvilj2p</code> が使えます。このプログラムは DVI を LaserJet IIp、LaserJet III、そして LaserJet 2000 の互換コードへ変換してくれます。</p></div><div class=paragraph><p><code>dvilj2p</code> はフィルタ <code>hpdf</code> を極めて複雑にしています。 なぜなら、<code>dvilj2p</code> は標準入力からデータを読み込むことができないからです。 このプログラムを働かせるためには、ファイル名が必要です。 もっと悪いことに、ファイル名は <span class=filename>.dvi</span> で終わっている必要があり、標準入力の代わりに、 <span class=filename>/dev/fd/0</span> を使うのは問題があります。 この問題は、(<span class=filename>.dvi</span> で終わる) 一時的なファイル名から<span class=filename>/dev/fd/0</span> に (シンボリックな) リンクを張る ことで回避することができます。これで、 <code>dvilj2p</code> に強制的に標準入力からデータを読み込ませることができます。</p></div><div class=paragraph><p>もう1つの問題は、一時的なリンクを張るために <span class=filename>/tmp</span> ディレクトリを使うことができないという事実です。 シンボリックリンクはユーザ、グループが <code>bin</code> であるユーザに所有されています。フィルタはユーザ <code>daemon</code> として起動します。そして、 <span class=filename>/tmp</span> ディレクトリはスティッキービットが立っています。 フィルタはリンクを作ることができます。しかし、 リンクは別のユーザに所有されているため、 作業が終了したとき、このリンクを削除することができません。</p></div><div class=paragraph><p>その代わりに、シンボリックリンクは現在の作業ディレクトリ、 すなわち、スプーリングディレクトリ (<span class=filename>/etc/printcap</span> の <code>sd</code> 項目で指定する) に作ることにします。 フィルタが作業するにはここの場所は完璧な場所で、なぜなら、 特に、スプーリングディレクトリのディ スクの空き容量は (ときどき) <span class=filename>/tmp</span> ディレクトリよりもたくさんあるからです。</p></div><div class=paragraph><p>以下に示すのが最後のフィルタです。</p></div><div class="literalblock programlisting"><div class=content><pre>#!/bin/sh
#
#  hpdf - Print DVI data on HP/PCL printer
#  Installed in /usr/local/libexec/hpdf

PATH=/usr/local/bin:$PATH; export PATH

#
#  Define a function to clean up our temporary files.  These exist
#  in the current directory, which will be the spooling directory
#  for the printer.
#
cleanup() {
   rm -f hpdf$$.dvi
}

#
#  Define a function to handle fatal errors: print the given message
#  and exit 2.  Exiting with 2 tells LPD to do not try to reprint the
#  job.
#
fatal() {
    echo &#34;$@&#34; 1&gt;&amp;2
    cleanup
    exit 2
}

#
#  If user removes the job, LPD will send SIGINT, so trap SIGINT
#  (and a few other signals) to clean up after ourselves.
#
trap cleanup 1 2 15

#
#  Make sure we are not colliding with any existing files.
#
cleanup

#
#  Link the DVI input file to standard input (the file to print).
#
ln -s /dev/fd/0 hpdf$$.dvi || fatal &#34;Cannot symlink /dev/fd/0&#34;

#
#  Make LF = CR+LF
#
printf &#34;\033&amp;k2G&#34; || fatal &#34;Cannot initialize printer&#34;

#
#  Convert and print.  Return value from dvilj2p does not seem to be
#  reliable, so we ignore it.

#
dvilj2p -M1 -q -e- dfhp$$.dvi

#
#  Clean up and exit
#
cleanup
exit 0</pre></div></div></div><div class=sect4><h5 id=printing-advanced-autoconv>9.4.1.4.5. 自動変換: その他の変換フィルタ<a class=anchor href=#printing-advanced-autoconv></a></h5><div class=paragraph><p>ここまでに述べてきたフィルタによって、 印字環境の能率が上がったことと思います。しかし、 これはどのフィルタを使うかを (<a href="https://man.freebsd.org/cgi/man.cgi?query=lpr&amp;sektion=1&amp;format=html">lpr(1)</a> のコマンドライン上で) ユーザが指定しなくてはならないという代価を支払って実現されています。 コンピュータの事情にあまり詳しくないユーザにとって、 フィルタのオプションを指定させられるということは いらいらさせられるものになるでしょう。更に悪いことに、 間違ったフィルタオプションを指定されると、 間違った形式のファイルがそのフィルタに適用されることになり、 その結果、何百枚もの紙を吐き出すことになるかもしれません。</p></div><div class=paragraph><p>そのような結果になるならば、 変換フィルタをインストールするよりもむしろ、 テキストフィルタ (これがデフォルトフィルタなので) に印字するよう要求されたファイルの形式を検出させ、自動的に、 適切な変換フィルタを起動するようにしたいと思うかもしれません。 ここでは <code>file</code> コマンドのようなツールを役立たせることができます。 もちろん、<em>いくつかの</em> ファイル形式の違いを見分けることは難しいことでしょう。 そして、もちろん、それらのファイルに対しては、 変換フィルタを提供するだけで済ますこともできるのです。</p></div><div class=paragraph><p>FreeBSD Ports Collection には、<code>apsfilter</code> (<a class=package href=https://cgit.freebsd.org/ports/tree/print/apsfilter/>print/apsfilter</a>) と呼ばれる自動変換をおこなうテキストフィルタがあります。 このフィルタは プレインテキスト、PostScript®, DVI など、ほとんどすべてのファイル形式を検出し、適当な変換をおこなった後、 データを印字することができます。</p></div></div></div><div class=sect3><h4 id=printing-advanced-of>9.4.1.5. 出力フィルタ<a class=anchor href=#printing-advanced-of></a></h4><div class=paragraph><p>LPD スプーリングシステムでは、 ここまでにまだ取り上げていないフィルタ形式、 出力フィルタをサポートしています。出力フィルタは、 テキストフィルタのように、 プレインテキストのみを印字するために意図されたものですが、 非常に簡単化されています。テキストフィルタを用いずに、 出力フィルタを使っている場合は、次のようになります。</p></div><div class=ulist><ul><li><p>LPD はジョブ中の各ファイルに一度ではなく、 ジョブ全体に対して一度だけ出力フィルタを起動します。</p></li><li><p>LPD は出力フィルタに対し、 ジョブ中のファイルの先頭や末尾を特定するための対策を 一切おこなっていません。</p></li><li><p>LPD はユーザのログイン名やホスト名をフィルタに渡しません。 したがって、課金の処理をおこなうことは考えていません。 実際、出力フィルタには、以下2つの引数しか与えられません。</p><div class=paragraph><p><code>filter-name -w<em>width</em> -l<em>length</em></code></p></div><div class=paragraph><p>ここで、<em>width</em> は対象となるプリンタの <code>pw</code> 項目、 <em>length</em> は <code>pl</code> 項目に指定された数です。</p></div></li></ul></div><div class=paragraph><p>出力フィルタの簡便さに誘惑されてはいけません。もし、 ジョブ中のそれぞれのファイルに別のページ番号を付加しようとしても、 出力フィルタは<em>うまく動作しないでしょう</em>。 そのような動作を期待しているならば、 (入力フィルタとしても知られている) テキストフィルタを使ってください。 詳しくは、「<a href=#printing-textfilter>テキストフィルタのインストール</a>」をご覧ください。 さらに、出力フィルタは、実のところ、 <em>もっと複雑</em>になっています。まず、 特殊なフラグ文字を検出するために、 フィルタに送られてくるバイトストリームを検査する必要があります。 また、LPD に代わって、 自分自身にシグナルを送らなければなりません。</p></div><div class=paragraph><p>しかしながら、ヘッダページの印字をおこないたくて、 エスケープシーケンスやヘッダページを印字できるようにするその他の初期化文字列を送信する必要がある場合は、 出力ファイルが<em>必要</em>です。 (しかし、 ヘッダページを要求したユーザに対して課金しようとするのもまた無駄なことです。 LPD は出力フィルタにユーザやホストの情報を渡しません)。</p></div><div class=paragraph><p>1 台のプリンタに対し、LPD では出力フィルタとテキストやその他のフィルタを両方使うことができます。 このような場合、LPD はヘッダページ (「<a href=#printing-advanced-header-pages>ヘッダページ</a>」 を参照してください) だけを印字させるために、出力フィルタを起動させます。 それから LPD では、出力フィルタに 2 バイトの文字 (ASCII 031 の次に ASCII 001) を送ることで、 出力フィルタが<em>自分自身を停止する</em>ことを期待しています。 2 バイト (031, 001) が出力フィルタに送られたとき、 出力フィルタは自分自身にシグナル <code>SIGSTOP</code> を送ることによって停止するはずです。 LPD がその他のフィルタを動かし終わると、 出力フィルタにシグナル <code>SIGCONT</code> を送って、出力フィルタを再起動します。</p></div><div class=paragraph><p>出力フィルタがあり、 テキストフィルタが<em>ない</em>場合、 LPD はプレインテキストジョブを扱う場合に、 出力フィルタを使います。前述したように、出力フィルタでは、 ジョブ中の各ファイルの間に FORM FEED 文字や紙を送る他の文字を入れることはしません。 この動作は多分、 あなたが求めているものとは<em>異なっている</em>でしょう。 ほとんどの場合において、テキストフィルタが必要なはずです。</p></div><div class=paragraph><p>プログラム <code>lpf</code> は、 テキストフィルタの項で既に紹介しましたが、 出力フィルタとしても動作させることができます。もし、 簡便で極悪な出力フィルタが必要で、かつ、 バイトストリームを検査したりシグナルを送るコードを書きたくないときには、 <code>lpf</code> をお試しください。 あるいは、プリントが要求する初期化コードを送るために、 <code>lpf</code> をシェルスクリプトに包んで使うこともできます。</p></div></div><div class=sect3><h4 id=printing-advanced-lpf>9.4.1.6. テキストフィルタ <code>lpf</code><a class=anchor href=#printing-advanced-lpf></a></h4><div class=paragraph><p>プログラム <span class=filename>/usr/libexec/lpr/lpf</span> は、 FreeBSD の バイナリ配布に付属しているテキストフィルタ (入力フィルタ) で、出力を字下げしたり (<code>lpr -i</code> でジョブが入力さ れたとき)、 文字を未処理のままプリンタに送ったり (<code>lpr -l</code> でジョブが入力されたとき)、 ジョブ中のバックスペースやタブの印字位置を調節したり、 印字したページに対して課金したりすることができます。また、 このフィルタは出力フィルタとしても動作させることができます。</p></div><div class=paragraph><p><code>lpf</code> フィルタは多くの印字環境において使用することに適しています。 このフィルタには、プリンタに初期化文字列を送る機能はありませんが、 必要とされる初期化をおこない、それから <code>lpf</code> を実行させるためのシェルスクリプトを作成するのはたやすいことです。</p></div><div class=paragraph><p><code>lpf</code> に対して、 印字ページへの課金を正確におこなわせるためには、 <span class=filename>/etc/printcap</span> ファイルの中の <code>pw</code> と <code>pl</code> の項目に正確な値を入れておく必要があります。これらの値は、 どのくらいの量のテキストがページにフィットするか、また、 ユーザのジョブが何ページあるのかを調べるために使われます。 プリンタの課金についての詳しい情報については、「<a href=#printing-advanced-acct>プリンタの利用に対する課金</a>」をご覧ください。</p></div></div></div><div class=sect2><h3 id=printing-advanced-header-pages>9.4.2. ヘッダページ<a class=anchor href=#printing-advanced-header-pages></a></h3><div class=paragraph><p>あなたが管理するシステムのユーザが <em>たくさん</em>おり、 ユーザ全員が様々なプリンタを使用する場合、多分、 必要悪である<em>ヘッダページ</em>を 印字させることを検討したいと思うかもしれません。</p></div><div class=paragraph><p>ヘッダページは、<em>バナー</em> とか <em>バーストページ</em> としても知られていますが、 出力されたジョブが誰によるものなのかを特定させる働きがあります。 印字結果の山の中において、 ユーザのジョブによって印字された本物のドキュメント部分よりも際立たせるために、 ヘッダページは、通常、多分、縁が装飾されている大きな太文字で印字されます。 ヘッダページにより、 ユーザは自分が出したジョブがどこにあるのかをすばやく見つけることができます。 ヘッダページの欠点は、明らかに、すべてのジョブに対して、 紙が 1 枚余分に印字されるということです。 この紙の有効期間は短く、2 ～ 3 分も続きません。最終的に、 これらの紙は再利用紙入れの中かくずの山に入れられることでしょう (ヘッダページはジョブ中の各ファイル毎に印字されるのではなく、 ジョブ毎に印字されるということに注意してください。したがって、 紙の消費はそれほどひどくはないかもしれません)。</p></div><div class=paragraph><p><em>もし</em>、 プリンタがプレインテキストを直接印字できるならば、LPD システムは印字物に対して自動的にヘッダページを付けることができます。 PostScript® プリンタを使っている場合は、 ヘッダページを生成する外部プログラムが必要になります。これについては、 「<a href=#printing-advanced-header-pages-ps>PostScript® プリンタでのヘッダページ</a>」をご覧ください。</p></div><div class=sect3><h4 id=printing-advanced-header-pages-enabling>9.4.2.1. ヘッダページの印字を許可する<a class=anchor href=#printing-advanced-header-pages-enabling></a></h4><div class=paragraph><p>「<a href=#printing-simple>プリンタ設定導入編 </a>」節では、<span class=filename>/etc/printcap</span> ファイルの <code>sh</code> (''suppress header'' : "ヘッダを供給しない" という意味) を指定して、 ヘッダページの印字を止めていました。 プリンタでのヘッダページの印字を許可するには、 <code>sh</code> 項目を取り除くだけでよいのです。</p></div><div class=paragraph><p>とても簡単そうに見えるけど、本当かな?</p></div><div class=paragraph><p>それは本当です。 プリンタに初期化文字列を送るための 出力フィルタを用意しなくてはならないかもしれません。次に、Hewlett Packard PCL 互換プリンタの例を挙げます。</p></div><div class="literalblock programlisting"><div class=content><pre>#!/bin/sh
#
#  hpof - Output filter for Hewlett Packard PCL-compatible printers
#  Installed in /usr/local/libexec/hpof

printf &#34;\033&amp;k2G&#34; || exit 2
exec /usr/libexec/lpr/lpf</pre></div></div><div class=paragraph><p><code>of</code> 項目に出力フィルタのパス名を指定してください。 詳細については、「<a href=#printing-advanced-of>出力フィルタ</a>」節 をご覧ください。</p></div><div class=paragraph><p>次に、以前紹介したプリンタ <code>teak</code> のための <span class=filename>/etc/printcap</span> ファイルの例を示します。ここでは、 ヘッダページの印字を許可し、上記の出力フィルタを追加しました。</p></div><div class="literalblock programlisting"><div class=content><pre>#
#  /etc/printcap for host orchid
#
teak|hp|laserjet|Hewlett Packard LaserJet 3Si:\
        :lp=/dev/lpt0:sd=/var/spool/lpd/teak:mx#0:\
        :if=/usr/local/libexec/hpif:\
        :vf=/usr/local/libexec/hpvf:\
        :of=/usr/local/libexec/hpof:</pre></div></div><div class=paragraph><p>さて、ユーザが <code>teak</code> からジョブを印字させたとき、 それぞれのジョブ毎にヘッダページが印字されます。 もし、ユーザが印字物を探すのに時間を費やしたいと思うなら、 <code>lpr -h</code> によってジョブを入力することで、 ヘッダページの印字を止めることができます。 これ以外の <a href="https://man.freebsd.org/cgi/man.cgi?query=lpr&amp;sektion=1&amp;format=html">lpr(1)</a> のオプションについては、 「<a href=#printing-lpr-options-misc>ヘッダページ用オプション</a>」節をご覧ください。</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>LPD では、ヘッダページの最後に、 FORM FEED 文字が印字されます。 プリンタに紙排出をさせるために、別な文字、 もしくは、別な文字列が利用されている場合は、 <span class=filename>/etc/printcap</span> 中の <code>ff</code> 項目で指定することができます。</p></div></td></tr></tbody></table></div></div><div class=sect3><h4 id=printing-advanced-header-pages-controlling>9.4.2.2. ヘッダページを制御する<a class=anchor href=#printing-advanced-header-pages-controlling></a></h4><div class=paragraph><p>ヘッダページの印字が許可されていると、LPD は <em>長いヘッダ</em>を作ります。これには、 紙全面に大きな文字でユーザ名、ホスト名、 ジョブ名が書かれています。次に、このヘッダページの例を示 します (<code>kelly</code> がジョブ名 "outline" を <code>rose</code> というホストから印字 された場合)。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>      k                   ll       ll
      k                    l        l
      k                    l        l
      k   k     eeee       l        l     y    y
      k  k     e    e      l        l     y    y
      k k      eeeeee      l        l     y    y
      kk k     e           l        l     y    y
      k   k    e    e      l        l     y   yy
      k    k    eeee      lll      lll     yyy y
                                               y
                                          y    y
                                           yyyy

                                   ll
                          t         l        i
                          t         l
       oooo    u    u   ttttt       l       ii     n nnn     eeee
      o    o   u    u     t         l        i     nn   n   e    e
      o    o   u    u     t         l        i     n    n   eeeeee
      o    o   u    u     t         l        i     n    n   e
      o    o   u   uu     t  t      l        i     n    n   e    e
       oooo     uuu u      tt      lll      iii    n    n    eeee

      r rrr     oooo     ssss     eeee
      rr   r   o    o   s    s   e    e
      r        o    o    ss      eeeeee
      r        o    o      ss    e
      r        o    o   s    s   e    e
      r         oooo     ssss     eeee

                                              Job:  outline
                                              Date: Sun Sep 17 11:04:58 1995</code></pre></div></div><div class=paragraph><p>LPD はこのテキストの終わりに FORM FEED 文字を加えます ので、ジョブは新しいページから開始されます (ただし、 <span class=filename>/etc/printcap</span> で出力先のプリンタのエントリに <code>sf</code> (suppress form feeds) が指定されているときはこ の限りではありません)。</p></div><div class=paragraph><p>お望みならば、LPD に<em>短いヘッダページ</em>を出力させることもできます。 この場合は、 <span class=filename>/etc/printcap</span> ファイルの中で <code>sb</code> (short banner) を指定してください。 ヘッダページは次のようになります。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>rose:kelly  Job: outline  Date: Sun Sep 17 11:07:51 1995</code></pre></div></div><div class=paragraph><p>デフォルトでは、LPD はヘッダページを最初に印字し、次にジョブの印字をおこないます。 この順番を逆にするときは、 <span class=filename>/etc/printcap</span> で <code>hl</code> (header last) を指定してください。</p></div></div><div class=sect3><h4 id=printing-advanced-header-pages-accounting>9.4.2.3. ヘッダページに対する課金<a class=anchor href=#printing-advanced-header-pages-accounting></a></h4><div class=paragraph><p>LPD に備わっているヘッダページ出力機能を使うと、 入力されたジョブに対して課金をおこなうことができても、 ヘッダページは<em>無料</em>で提供しなくてはならない、 という特有のやり方を強要されます。</p></div><div class=paragraph><p>なぜでしょうか。</p></div><div class=paragraph><p>出力フィルタは単なる外部プログラムなので、 課金をするための制御をおこなうとすれば、 それはヘッダページを印字するときですが、出力フィルタには、 <em>ユーザ名とホスト名</em> の情報や課金情報を格納するファイルがどれな のかということが知らされません。それゆえ、出力ファイルには、 誰にプリンタ利用の課金をおこなえばよいのかが分からないのです。 テキストフィルタやその他の変換フィルタ (これらのフィルタはユーザやホストの情報が知らされます) が出力ページの枚数に "1 ページ分水増しする" だけでは十分ではありません。 なぜなら、ユーザは <code>lpr -h</code> に よってヘッダページの出力を止めることができるからです。 やみくもに 1 ページを水増しすると、 印字されてもいないヘッダページに対する 料金をとることになります。基本的に、<code>lpr -h</code> は環境に優しい心を持つユーザに好まれるオプションですが、 これを使うように奨励することもできません。</p></div><div class=paragraph><p>各々のフィルタに独自のヘッダページを生成させる (その結果、ヘッダページに課金することができる) という方法<em>でも十分であるとはいえません</em>。 この場合、LPD はフィルタに <code>-h</code> の情報を送りませんので、<code>lpr -h</code> によってヘッダページを印字しないオプションを選択したとしても、 依然としてヘッダページは印字され、 その分の課金がおこなわれてしまいます。</p></div><div class=paragraph><p>では、どのような選択肢があるのでしょうか。</p></div><div class=paragraph><p>ヘッダページへの課金に関しては、 次のことができます。</p></div><div class=ulist><ul><li><p>LPD のやり方を受け入れ、 ヘッダページは無料とする。</p></li><li><p>LPRng などの LPD の代替品をインストールする。 LPD と入れ替えが可能な他のスプーリングソフトウェアに関しては、 <a href=#printing-lpd-alternatives>標準スプーラの代替品</a> をご覧ください。</p></li><li><p><em>スマートな</em> 出力フィルタを作成する。通常、 出力フィルタはプリンタを初期化するか、 単純な文字列変換をする程度の働きしかしません。 (テキスト (入力) フィルタがない場合) 出力フィルタはヘッダページとプレインテキストの印字をおこなうのに適しています。 プレインテキストを印字するためのテキストフィルタがない場合、 LPD はヘッダページを印字するためだけの目的で出力フィルタを起動します。 そして、LPD が生成するヘッダページのテキストを解析することにより、 出力フィルタはヘッダページに課金するために必要なユーザ名と ホスト名を取得することができます。この方式の唯一の問題点は、 出力フィルタは課金情報を格納するデータファイルの名前を知ることが できないということです (<code>af</code> 項目で指定されたファイル名は 出力ファイルに渡されません)。しかし、既知の 名前の課金データファイルを使うのならば、 その名前を出力フィルタのプログラム中に埋め込むことができます。 解析の手順を簡単にするためには、 <span class=filename>/etc/printcap</span> で <code>sh</code> 項目 (短いヘッダを指定) を使うとよいでしょう。 そしてまた、 ここまでの方法は少なからぬトラブルを生じさせるかもしれません。 そうなれば、もちろんユーザはヘッダページを無料で 提供してくれる気前のよいシステム管理者に感謝することでしょう。</p></li></ul></div></div><div class=sect3><h4 id=printing-advanced-header-pages-ps>9.4.2.4. PostScript® プリンタでのヘッダページ<a class=anchor href=#printing-advanced-header-pages-ps></a></h4><div class=paragraph><p>これまでに述べたように、LPD ではプレインテキストのヘッダページをたくさんのプリンタに合うように生成することができます。 残念ながら、PostScript® プリンタは、 プレインテキストを直接印字することができません。ですから、 LPD のヘッダページ機能はまったく、 あるいはほとんどの場合、役に立ちません。</p></div><div class=paragraph><p>ヘッダページを出力するための自明な方法の1つに、 すべての変換フィルタとテキストフィルタにヘッダページを生成させる方法があります。 フィルタは、 適切なヘッダページを生成するために、 ユーザ名とホスト名の引数を使うべきです。この方法の欠点は、いつでも、 <code>lpr -h</code> によってジョブが入力された場合でさえも、 ヘッダページが印字されるということです。</p></div><div class=paragraph><p>この方法で試してみましょう。次のスクリプトは、3 つの引数 (ユーザ のログイン名、ホスト名、ジョブ名) をとり、簡単な PostScript® 用 のヘッダページを生成します。</p></div><div class="literalblock programlisting"><div class=content><pre>#!/bin/sh
#
#  make-ps-header - make a PostScript header page on stdout
#  Installed in /usr/local/libexec/make-ps-header
#

#
#  These are PostScript units (72 to the inch).  Modify for A4 or
#  whatever size paper you are using:
#
page_width=612
page_height=792
border=72

#
#  Check arguments
#
if [ $# -ne 3 ]; then
    echo &#34;Usage: `basename $0` &lt;user&gt; &lt;host&gt; &lt;job&gt;&#34; 1&gt;&amp;2
    exit 1
fi

#
#  Save these, mostly for readability in the PostScript, below.
#
user=$1
host=$2
job=$3
date=`date`

#
#  Send the PostScript code to stdout.
#
exec cat &lt;&lt;EOF
%!PS

%
%  Make sure we do not interfere with user&#39;s job that will follow
%
save

%
%  Make a thick, unpleasant border around the edge of the paper.
%
$border $border moveto
$page_width $border 2 mul sub 0 rlineto
0 $page_height $border 2 mul sub rlineto
currentscreen 3 -1 roll pop 100 3 1 roll setscreen
$border 2 mul $page_width sub 0 rlineto closepath
0.8 setgray 10 setlinewidth stroke 0 setgray

%
%  Display user&#39;s login name, nice and large and prominent
%
/Helvetica-Bold findfont 64 scalefont setfont
$page_width ($user) stringwidth pop sub 2 div $page_height 200 sub moveto
($user) show

%
%  Now show the boring particulars
%
/Helvetica findfont 14 scalefont setfont
/y 200 def
[ (Job:) (Host:) (Date:) ] {
200 y moveto show /y y 18 sub def
} forall

/Helvetica-Bold findfont 14 scalefont setfont
/y 200 def
[ ($job) ($host) ($date) ] {
        270 y moveto show /y y 18 sub def
} forall

%
%  That is it
%
restore
showpage
EOF</pre></div></div><div class=paragraph><p>そして、変換フィルタやテキストフィルタがそれぞれ、 最初にこのスクリプトを起動することで、 ヘッダページが出力され、それから、 ユーザのジョブの印字をおこないます。次に、 このドキュメントの始めのほうで紹介した DVI 変換フィルタを、 ヘッダページを印字するように変更したものを示します。</p></div><div class="literalblock programlisting"><div class=content><pre>#!/bin/sh
#
#  psdf - DVI to PostScript printer filter
#  Installed in /usr/local/libexec/psdf
#
#  Invoked by lpd when user runs lpr -d
#

orig_args=&#34;$@&#34;

fail() {
    echo &#34;$@&#34; 1&gt;&amp;2
    exit 2
}

while getopts &#34;x:y:n:h:&#34; option; do
    case $option in
        x|y)  ;; # Ignore
        n)    login=$OPTARG ;;
        h)    host=$OPTARG ;;
        *)    echo &#34;LPD started `basename $0` wrong.&#34; 1&gt;&amp;2
              exit 2
              ;;
    esac
done

[ &#34;$login&#34; ] || fail &#34;No login name&#34;
[ &#34;$host&#34; ] || fail &#34;No host name&#34;

( /usr/local/libexec/make-ps-header $login $host &#34;DVI File&#34;
  /usr/local/bin/dvips -f ) | eval /usr/local/libexec/lprps $orig_args</pre></div></div><div class=paragraph><p>このフィルタがユーザ名やホスト名を決定するために 引数リストをどのように解析しなくてはならないかという点に注意してください。 この解析方法は他の変換フィルタに対しても同様です。 しかしながら、テキストフィルタについては、 引数の設定が少し異なっています (これについては、「<a href=#printing-advanced-filters>フィルタはどのように機能しているか</a>」 をご覧ください)。</p></div><div class=paragraph><p>前述の通り、上記の手法は、極めて単純なのにも関らず、 <code>lpr</code> で "ヘッダページを印字しない" オプション (<code>-h</code> オプション) が使えなくなっています。 ユーザが森林資源を (あるいは、 ヘッダページが課金されているならば、その僅かな金額を)、 節約したいと望んでいる場合でも、 すべてのフィルタがすべてのジョブ毎にヘッダページを印字 することになっているので、節約することはできません。</p></div><div class=paragraph><p>ジョブ毎に印字されるヘッダページを ユーザが抑制できるようにするためには、「<a href=#printing-advanced-header-pages-accounting>ヘッダページに対する課金</a>」で紹介したトリックを 使う必要があります。すなわち、LPD が生成するヘッダページの解析をおこない、PostScript® 版のヘッダページを出力させる出力フィルタを作るのです。 この場合、ユーザが <code>lpr -h</code> でジョブを入力すると、 LPD はヘッダページを生成しなくなり、また、 出力フィルタも起動されません。そうでないならば、 作成した出力フィルタが LPD からのテキストを読み込み、ヘッダページを印字する適当な PostScript® のコードがプリンタに送られるでしょう。</p></div><div class=paragraph><p>PostScript® プリンタがシリアルポートに接続されている場合、 出力フィルタとして <code>lprps</code> を、 上記の動作をおこなうものとして <code>psof</code> を使うことができます。ただし、<code>psof</code> はヘッダページに対して課金をおこないませんので注意してください。</p></div></div></div><div class=sect2><h3 id=printing-advanced-network-printers>9.4.3. リモートプリンタからの出力<a class=anchor href=#printing-advanced-network-printers></a></h3><div class=paragraph><p>FreeBSD では、ネットワーク越しの印字、すなわち、 ジョブをリモートプリンタに送ることをサポートしています。 リモートプリンタからの出力をするには、一般に、 次の 2 つを参照してください。</p></div><div class=ulist><ul><li><p>リモートホストに接続されたプリンタにアクセスする方法。 プリンタがあるホストのシリアル、 または、パラレルインタフェースに接続されている場合、 ネットワーク上の他のホストからこのプリンタにアクセスできるように LPD を設定します。「<a href=#printing-advanced-network-rm>リモートホストに 接続されたプリンタ</a>」 でどのようにするかを説明します。</p></li><li><p>ネットワークに直接接続されているプリンタにアクセスする方法。 プリンタに、旧来のシリアル、または、 パラレルインタフェースに加えて (もしくは、これらに代わって) ネットワーク用のインタフェースがある場合。 そのようなプリンタは次のように動作するでしょう。</p><div class=ulist><ul><li><p>そのプリンタが LPD のプロトコルを理解でき、リモートホストからのジョブを キューに入れることさえできる場合。この場合、 プリンタは、LPD が起動している一般のホストのように振る舞います。 そのようなプリンタを設定するために、 「<a href=#printing-advanced-network-rm>リモートホストに接続されたプリンタ</a>」 と同様の手順をおこなってください。</p></li><li><p>そのプリンタが、 データストリームによるネットワーク接続をサポートしている場合。 この場合、ネットワーク上の1つのホストとしてプリンタを "接続" します。 このホストは、ジョブをスプーリングする責任を負い、 スプーリングされたジョブはプリンタに送られます。 そのようなプリンタをインストールするためのいくつかの提案が 「<a href=#printing-advanced-network-net-if>ネットワークにおけるデータストリームの インタフェースを持つプリンタ</a>」にあります。</p></li></ul></div></li></ul></div><div class=sect3><h4 id=printing-advanced-network-rm>9.4.3.1. リモートホストに接続されたプリンタ<a class=anchor href=#printing-advanced-network-rm></a></h4><div class=paragraph><p>LPD スプーリングシステムでは LPD (または LPD 互換のシステム) が起動している他のホストへジョブを送る機能が 始めからサポートされています。この機能により、 あるホストに接続されたプリンタへ、 他のホストからアクセスできるようになります。また、 LPD プロトコルを理解するネットワークインタフェースを持ったプリンタに対しても、 この機能は働きます。</p></div><div class=paragraph><p>リモートプリンタへの出力を許可するためには、最初に、 あるホスト (これを、 <em>プリンタホスト</em>と呼びます) にプリンタを接続します。そして、「<a href=#printing-simple>プリンタ設定導入編</a>」 に書かれた簡単なプリンタの設定をおこなってください。 必要ならば、「<a href=#printing-advanced>プリンタ設定上級編</a>」 にある、更に進んだ設定をおこなってください。そして、 そのプリンタをテストしてうまく動作することを確認し、LPD に許可した機能がうまく働くかどうかを見てください。さらに <em>ローカルホスト</em>が <em>プリンタホスト</em>の LPD サービスの使用を許可されているか確認して下さい (「<a href=#printing-advanced-restricting-remote>リモートホストからの利用を制限する </a>」参照)。</p></div><div class=paragraph><p>LPD 互換のネットワークインタフェースを持つプリンタを使用している場合は、 そのプリンタ自身が以下で説明する <em>プリンタホスト</em>になります。そして、 <em>プリンタ名</em>とは、 そのプリンタに設定した名前のことを指します。 これについては、プリンタ、および (または)、 プリンタのネットワークインタフェースに付属するドキュメントを参照してください。</p></div><div class="admonitionblock tip"><table><tbody><tr><td class=icon><i class="fa icon-tip" title=Tip></i></td><td class=content><div class=paragraph><p>ヒューレット・パッカード社の Laserjet シリーズを使用している場合には、 プリンタ名を <code>text</code> とすると、 自動的に LF から CRLF への変換が行なわれます。 そのため、<span class=filename>hpif</span> スクリプトは必要ありません。</p></div></td></tr></tbody></table></div><div class=paragraph><p>次に、 そのプリンタにアクセスしたいと思っている他ホストにおいて、 そのホストの <span class=filename>/etc/printcap</span> ファイルに次にあげるエントリを作ります。</p></div><div class="olist arabic"><ol class=arabic><li><p>名前のエントリ。どんな名前でもよいのですが、簡単のため、多分、 プリンタホストで設定されたプリンタ名や別名と同じものを使いたいと思うでしょう。</p></li><li><p><code>lp</code> 項目で指定されるデバイスは明示的に空にします (<code>:lp=:</code> とします)。</p></li><li><p>スプーリングディレクトリを作成し、 <code>sd</code> 項目でその位置を指定します。 LPD では、プリンタホストにジョブを送信するまでの間、 このディレクトリにジョブを格納します。</p></li><li><p><code>rm</code> 項目でプリンタホストの名前を指定します。</p></li><li><p><code>rp</code> 項目で <em>プリンタホスト</em>に接続したプリンタ名を指定します。</p></li></ol></div><div class=paragraph><p>これで終わりです。 変換フィルタやページの大きさやその他の事項を <span class=filename>/etc/printcap</span> に加える必要はありません。</p></div><div class=paragraph><p>次に、 リモートホストに接続されたプリンタで印字するための設定例を示します。 ホスト <code>rose</code> には 2 台のプリンタ <code>bamboo</code> と <code>rattan</code> が接続されています。これらのプリンタをホスト <code>orchid</code> のユーザが使えるようにしましょう。最初に <code>orchid</code> の <span class=filename>/etc/printcap</span> を示します (このファイルは、「<a href=#printing-advanced-header-pages-enabling>ヘッダページの出力を許可する</a>」 で参照することができます)。このファイルには、既に、プリンタ <code>teak</code> 用のエントリがありました。以下では、 これに、ホスト <code>rose</code> にある2台のプリンタ用のエントリが加えられています。</p></div><div class="literalblock programlisting"><div class=content><pre>#
#  /etc/printcap for host orchid - added (remote) printers on rose
#

#
#  teak is local; it is connected directly to orchid:
#
teak|hp|laserjet|Hewlett Packard LaserJet 3Si:\
        :lp=/dev/lpt0:sd=/var/spool/lpd/teak:mx#0:\
        :if=/usr/local/libexec/ifhp:\
        :vf=/usr/local/libexec/vfhp:\
        :of=/usr/local/libexec/ofhp:

#
#  rattan is connected to rose; send jobs for rattan to rose:
#
rattan|line|diablo|lp|Diablo 630 Line Printer:\
        :lp=:rm=rose:rp=rattan:sd=/var/spool/lpd/rattan:

#
#  bamboo is connected to rose as well:
#
bamboo|ps|PS|S|panasonic|Panasonic KX-P4455 PostScript v51.4:\
        :lp=:rm=rose:rp=bamboo:sd=/var/spool/lpd/bamboo:</pre></div></div><div class=paragraph><p><code>orchid</code> で必要となる作業はスプーリングディレクトリを作ることだけです。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mkdir -p /var/spool/lpd/rattan /var/spool/lpd/bamboo</span>
<span class=c># chmod 770 /var/spool/lpd/rattan /var/spool/lpd/bamboo</span>
<span class=c># chown daemon:daemon /var/spool/lpd/rattan /var/spool/lpd/bamboo</span></code></pre></div></div><div class=paragraph><p>これで、<code>orchid</code> のユーザが <code>rattan</code> と <code>bamboo</code> で印字することができるようになりました。 たとえば、<code>orchid</code> のユーザが次のように入力したとします。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% lpr <span class=nt>-P</span> bamboo <span class=nt>-d</span> sushi-review.dvi</code></pre></div></div><div class=paragraph><p>すると、<code>orchid</code> の LPD システムは、 ジョブをスプーリングディレクトリ <span class=filename>/var/spool/lpd/bamboo</span> にコピーし、これが DVI ファイルを印字するジョブであることを記録します。 ホスト <code>rose</code> の <code>bamboo</code> スプーリングディレクトリに十分な容量が確保でき次第、 両者の LPD は、ジョブのファイルを <code>rose</code> に転送します。 このファイルは、そのすべてが印字されるまで、<code>rose</code> のキューに留まります。 (<code>bamboo</code> は PostScript® プリンタなので) DVI から PostScript® への変換は <code>rose</code> でおこなわれます。</p></div></div><div class=sect3><h4 id=printing-advanced-network-net-if>9.4.3.2. ネットワークにおけるデータストリームの インタフェースを持つプリンタ<a class=anchor href=#printing-advanced-network-net-if></a></h4><div class=paragraph><p>プリンタのネットワークインタフェースカードは、 2 種類に分類することができます。 1 つはスプーラをエミュレートするもの (高価) で、もう 1 つはシリアルやパラレルポートを使うように プリンタにデータを送ることができるだけのもの (安価) です。この節では、 後者の使い方を説明します。前者のプリンタは、前節「<a href=#printing-advanced-network-rm>リモートホストに接続されたプリンタ</a>」 の方法が適用できます。</p></div><div class=paragraph><p><span class=filename>/etc/printcap</span> ファイルでは、 シリアルかパラレルのインタフェースのどちらを使うのか、 そして、(シリアルインタフェースを使う場合) そのボーレートはいくらであるか、フロー制御は使うのか、 タブのための遅延を加えるのか、 改行文字を変換するかなどの指定をおこなうことができます。 しかし、TCP/IP や他のネットワークポートからデータを受け取るプリンタを 接続するための指定をおこなうことはでき ません。</p></div><div class=paragraph><p>ネットワーク接続されたプリンタにデータを送るためには、 テキストフィルタと変換フィルタから呼び出すことができる 通信プログラムを開発する必要があります。以下に、 そのようなプログラムの例を示します。スクリプト <code>netprint</code> では、 標準入力から印字データをすべて受け取り、 ネットワーク接続されたプリンタにこれを送ります。 <code>netprint</code> の最初の引数でプリンタのホスト名を、 2 番目の引数で接続するポート番号を指定します。 このプログラムでは単方向通信 (FreeBSD からプリンタ) のみをサポートしていることに注意してください。 ネットワークプリンタの多くは双方向通信をサポートしていますので、 その恩恵 (プリンタの状態を得たり、 課金をおこなうなど) にあずかりたいと思われるかもしれません。</p></div><div class="literalblock programlisting"><div class=content><pre>#!/usr/bin/perl
#
#  netprint - Text filter for printer attached to network
#  Installed in /usr/local/libexec/netprint
#

$#ARGV eq 1 || die &#34;Usage: $0 &lt;printer-hostname&gt; &lt;port-number&gt;&#34;;

$printer_host = $ARGV[0];
$printer_port = $ARGV[1];

require &#39;sys/socket.ph&#39;;

($ignore, $ignore, $protocol) = getprotobyname(&#39;tcp&#39;);
($ignore, $ignore, $ignore, $ignore, $address)
    = gethostbyname($printer_host);

$sockaddr = pack(&#39;S n a4 x8&#39;, &amp;AF_INET, $printer_port, $address);

socket(PRINTER, &amp;PF_INET, &amp;SOCK_STREAM, $protocol)
    || die &#34;Can&#39;t create TCP/IP stream socket: $!&#34;;
connect(PRINTER, $sockaddr) || die &#34;Can&#39;t contact $printer_host: $!&#34;;
while (&lt;STDIN&gt;) { print PRINTER; }
exit 0;</pre></div></div><div class=paragraph><p>このスクリプトは、 様々なフィルタが利用することができます。仮に、Diablo 750-N ラインプリンタを持っており、 これがネットワークに接続されているとしましょう。 プリンタはポート番号 5100 にて印字するデータを受け取ります。 プリンタのホスト名は <code>scrivener</code> とします。このとき、 このプリンタのテキストフィルタは次のようになります。</p></div><div class="literalblock programlisting"><div class=content><pre>#!/bin/sh
#
#  diablo-if-net - Text filter for Diablo printer `scrivener&#39; listening
#  on port 5100.  Installed in /usr/local/libexec/diablo-if-net
#

exec /usr/libexec/lpr/lpf &#34;$@&#34; | /usr/local/libexec/netprint scrivener 5100</pre></div></div></div></div><div class=sect2><h3 id=printing-advanced-restricting>9.4.4. プリンタの利用に制約を与える<a class=anchor href=#printing-advanced-restricting></a></h3><div class=paragraph><p>本節では、プリンタの利用に制約を与えるための情報を記しています。 LPD システムでは、プリンタ (ローカル、 リモートのいずれに接続されていても) にアクセスできる人を制限する機能、 複数部のコピーの印字の可否を制御する機能、 ジョブのサイズの最大値やプリンタキューに入る ジョブの最大個数を制御する機能を提供しています。</p></div><div class=sect3><h4 id=printing-advanced-restricting-copies>9.4.4.1. 複数部のコピーの印字を制限する<a class=anchor href=#printing-advanced-restricting-copies></a></h4><div class=paragraph><p>LPD システムではユーザが複数部のコピーの印字を簡単におこなう 機能を提供しています。ユーザが、(たとえば) <code>lpr -#5</code> コマンドを使ってジョブを印字すると、 ジョブのそれぞれのファイルのコピーを 5 部得ることができます。 これがよい機能であると思うかどうかは人それぞれでしょう。</p></div><div class=paragraph><p>複数部のコピーの印字によってプリンタが 必要以上に消耗してしまうと感じるならば、 <span class=filename>/etc/printcap</span> ファイルに <code>sc</code> 項目を加えてください。これにより、 <a href="https://man.freebsd.org/cgi/man.cgi?query=lpr&amp;sektion=1&amp;format=html">lpr(1)</a> の <code>-<mark></mark></code> オプションの使用が禁止されます。 このオプションが指定されているにも関らず、 <code>-</code> オプションを使うと、 次のようなメッセージが表示され、 このオプションの利用できない旨を伝えます。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>lpr: multiple copies are not allowed</code></pre></div></div><div class=paragraph><p>リモートホストからプリンタをアクセスできる 設定にしている場合 (この 設定については、「<a href=#printing-advanced-network-rm>リモートホストに接続されたプリンタ</a>」 をご覧ください)、そのリモートホストの <span class=filename>/etc/printcap</span> にも同じように <code>sc</code> 項目を追加する必要があることに注意してください。 そうしないと、ユーザは別なホストから複数部のコピーの 印字をすることができてしまいます。</p></div><div class=paragraph><p>例を使って説明しましょう。次に示す <span class=filename>/etc/printcap</span> ファイルは、ホスト <code>rose</code> のものです。プリンタ <code>rattan</code> は極めて頑丈なので、 複数部のコピーの印字は許可されています。しかし、 レーザプリンタの <code>bamboo</code> はもう少しデリケートで、 このプリンタから複数部のコピーを印字することを <code>sc</code> 項目を追加することで禁止しています。</p></div><div class="literalblock programlisting"><div class=content><pre>#
#  /etc/printcap for host rose - restrict multiple copies on bamboo
#
rattan|line|diablo|lp|Diablo 630 Line Printer:\
        :sh:sd=/var/spool/lpd/rattan:\
        :lp=/dev/lpt0:\
        :if=/usr/local/libexec/if-simple:

bamboo|ps|PS|S|panasonic|Panasonic KX-P4455 PostScript v51.4:\
        :sh:sd=/var/spool/lpd/bamboo:sc:\
        :lp=/dev/ttyu5:ms#-parenb cs8 clocal crtscts:rw:\
        :if=/usr/local/libexec/psif:\
        :df=/usr/local/libexec/psdf:</pre></div></div><div class=paragraph><p>さらに、orchid の <span class=filename>/etc/printcap</span> にも</p></div><div class=literalblock><div class=content><pre>sc</pre></div></div><div class=paragraph><p>項目を追加する必要があります (<code>orchid</code> でこの編集をおこなっているときに、ついでに、プリンタ <code>teak</code> でも複数部のコピーの印字を禁止することにしましょう)。</p></div><div class="literalblock programlisting"><div class=content><pre>#
#  /etc/printcap for host orchid - no multiple copies for local
#  printer teak or remote printer bamboo

teak|hp|laserjet|Hewlett Packard LaserJet 3Si:\
        :lp=/dev/lpt0:sd=/var/spool/lpd/teak:mx#0:sc:\
        :if=/usr/local/libexec/ifhp:\
        :vf=/usr/local/libexec/vfhp:\
        :of=/usr/local/libexec/ofhp:

rattan|line|diablo|lp|Diablo 630 Line Printer:\
        :lp=:rm=rose:rp=rattan:sd=/var/spool/lpd/rattan:

bamboo|ps|PS|S|panasonic|Panasonic KX-P4455 PostScript v51.4:\
        :lp=:rm=rose:rp=bamboo:sd=/var/spool/lpd/bamboo:sc:</pre></div></div><div class=paragraph><p><code>sc</code> 項目を指定することにより、 <code>lpr -#</code> の使用を防ぐことができます。しかし、この状態では <a href="https://man.freebsd.org/cgi/man.cgi?query=lpr&amp;sektion=1&amp;format=html">lpr(1)</a> を複数回起動したり、 1 回のジョブで次のように同じファイルを複数個指定することを防ぐまでには至っていません。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% lpr forsale.sign forsale.sign forsale.sign forsale.sign forsale.sign</code></pre></div></div><div class=paragraph><p>このような悪用を防ぐ方法は (その指示を無視することも含めて) たくさんあります。 各自で調べてみてください。</p></div></div><div class=sect3><h4 id=printing-advanced-restricting-access>9.4.4.2. プリンタを使用できる人を限定する<a class=anchor href=#printing-advanced-restricting-access></a></h4><div class=paragraph><p>それぞれのプリンタを使用できる人を限定するには、UNIX® の グループ権限のメカニズムを利用し、さらに、 <span class=filename>/etc/printcap</span> で <code>rg</code> 項目を指定することでおこないます。 あるプリンタにアクセスさせてもよいと思うユーザすべてを グループのどれかに入れてください。そして、 そのグループ名を <code>rg</code> で指定します。</p></div><div class=paragraph><p>このとき、そのグループに含まれないユーザ (<code>root</code> も含みます) がプリントしようとすると、次のようなメッセージが表示されます。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>lpr: Not a member of the restricted group</code></pre></div></div><div class=paragraph><p><code>sc</code> (suppress multiple copies : 複数部のコピーの印字を禁止する) を指定するときと同様に、<code>rg</code> が指定されたプリンタがリモートホストからもアクセスでき (この設定については、 「<a href=#printing-advanced-network-rm>リモートホストに接続されたプリンタ</a>」 をご覧ください)、かつ、 そのホストでもプリンタを使用できる人を限定するのが 妥当であると思う場合は、 そのホストの <span class=filename>/etc/printcap</span> にも <em>rg</em> 指定をおこなう必要があります。</p></div><div class=paragraph><p>たとえば、プリンタ <code>rattan</code> は誰でも利用できるが、<code>bamboo</code> はグループ <code>artists</code> に属している人のみが利用できるようにしてみましょう。 以下に、もうお馴染みとなったホスト <code>rose</code> の <span class=filename>/etc/printcap</span> を示します。</p></div><div class="literalblock programlisting"><div class=content><pre>#
#  /etc/printcap for host rose - restricted group for bamboo
#
rattan|line|diablo|lp|Diablo 630 Line Printer:\
        :sh:sd=/var/spool/lpd/rattan:\
        :lp=/dev/lpt0:\
        :if=/usr/local/libexec/if-simple:

bamboo|ps|PS|S|panasonic|Panasonic KX-P4455 PostScript v51.4:\
        :sh:sd=/var/spool/lpd/bamboo:sc:rg=artists:\
        :lp=/dev/ttyu5:ms#-parenb cs8 clocal crtscts:rw:\
        :if=/usr/local/libexec/psif:\
        :df=/usr/local/libexec/psdf:</pre></div></div><div class=paragraph><p>これ以外の <span class=filename>/etc/printcap</span> ファイル (ホスト <code>orchid</code> のもの) はそのままにしておくことにします。もちろん、 <code>orchid</code> のユーザは全員 <code>bamboo</code> を利用することができます。これは、 <code>orchid</code> には特定のユーザのみにしかアクセスさせておらず、 そのユーザにはプリンタを利用させたいと思っているからなのかもしれませんし、 そうでないかもしれません。</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>1台のプリンタを複数グループのユーザに利用させることはできません。</p></div></td></tr></tbody></table></div></div><div class=sect3><h4 id=printing-advanced-restricting-sizes>9.4.4.3. 入力可能なジョブのサイズを制限する<a class=anchor href=#printing-advanced-restricting-sizes></a></h4><div class=paragraph><p>たくさんのユーザからプリンタが利用される場合には、多分、 ユーザが印字要求を出すことができるファイルのサイズに 上限値を置く必要が生じるでしょう。結局のところ、 スプーリングディレクトリ が置かれているファイルシステムの空き容量がその 上限値になる訳ですが、 あるユーザがこれを独占的に使用すること避けるために、 他ユーザからのジョブ用の空き容量を確保する必要もあります。</p></div><div class=paragraph><p>LPD では、<code>mx</code> 項目を指定することにより、 ジョブ中の個々のファイルのサイズの上限値を制限する機能を提供しています。 指定される ファイルサイズの単位は BUFSIZ ブロックで、1 <code>BUFSIZ</code> ブロックは 1024バイトを表わします。この <code>mx</code> 項目の値として 0 が指定されると、 ファイルサイズの制限はなくなります。 <code>mx</code> が指定されない場合は、 デフォルトの制限として 1000 ブロックが使われます。</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>この制限はジョブ中の各 <em>ファイル</em>に対して適用されるものであり、 ジョブ全体のサイズ を制限するものでは<em>ありません</em>。</p></div></td></tr></tbody></table></div><div class=paragraph><p>ところで、 プリンタに設定された上限値を超えるファイルサイズの ファイルが入力された場合でも、LPD はこれを拒否しません。その代わりに、このファイルは、 その先頭から上限値のファイルサイズまでしかキューに入れられません。 そして、その部分までが印字され、 残りの部分は捨てられます。 これが正しい動作といえるのかどうかは議論の余地があるところです。</p></div><div class=paragraph><p>それでは、設定例に登場しているプリンタ <code>rattan</code> と <code>bamboo</code> の印字可能なファイルサイズに制限を加えてみましょう。 <code>artists</code> グループの人達が作る PostScript® ファイルのサイズは 巨大になる傾向があるので、上限値を 5M バイトとします。 それから、 プレインテキスト用のラインプリンタは無制限とします。</p></div><div class="literalblock programlisting"><div class=content><pre>#
#  /etc/printcap for host rose
#

#
#  No limit on job size:
#
rattan|line|diablo|lp|Diablo 630 Line Printer:\
        :sh:mx#0:sd=/var/spool/lpd/rattan:\
        :lp=/dev/lpt0:\
        :if=/usr/local/libexec/if-simple:

#
#  Limit of five megabytes:
#
bamboo|ps|PS|S|panasonic|Panasonic KX-P4455 PostScript v51.4:\
        :sh:sd=/var/spool/lpd/bamboo:sc:rg=artists:mx#5000:\
        :lp=/dev/ttyu5:ms#-parenb cs8 clocal crtscts:rw:\
        :if=/usr/local/libexec/psif:\
        :df=/usr/local/libexec/psdf:</pre></div></div><div class=paragraph><p>この場合もそうですが、この制限はローカル (ホスト rose) のユーザのみに適用されます。 リモートホストからプリンタを利用できるように設定している場合は、 そのリモートホストのユーザはこの制限を受けません。 これらのユーザにも制限を加える場合は、リモートホストの <span class=filename>/etc/printcap</span> の <code>mx</code> を指定する必要があります。 リモートホストから印字するための詳しい情報については、 「<a href=#printing-advanced-network-rm>リモートホストに接続されたプリンタ</a>」 を参照してください。</p></div><div class=paragraph><p>リモートホストに接続されたプリンタへのジョブの サイズを制限する特別な方法は他にもあります。これについては、 「<a href=#printing-advanced-restricting-remote>リモートホストからの利用を制限する</a>」 を参照してください。</p></div></div><div class=sect3><h4 id=printing-advanced-restricting-remote>9.4.4.4. リモートホストからの利用を制限する<a class=anchor href=#printing-advanced-restricting-remote></a></h4><div class=paragraph><p>LPD スプーリングシステムでは、 リモートホストから要求されたジョブの印字を制限するための方法がいくつか提供されています。</p></div><div class=dlist><dl><dt class=hdlist1>ホストの制限</dt><dd><p>ローカルの LPD が印字要求を受け付けるリモートホストは、ファイル <span class=filename>/etc/hosts.equiv</span> と <span class=filename>/etc/hosts.lpd</span> によって制御することができます。LPD では、あるホストから印字の要求がきたとき、 このホストの名前がこれら 2 つのファイルのどちらかに含まれている かどうかを調べます。これが含まれていない場合は、LPD はこの要求を拒否します。</p><div class=paragraph><p>これらのファイルの形式は単純です。 各行にホストの名前を 1つずつ書いていきます。ファイル <span class=filename>/etc/hosts.equiv</span> の方は <a href="https://man.freebsd.org/cgi/man.cgi?query=ruserok&amp;sektion=3&amp;format=html">ruserok(3)</a> プロトコルでも利用され、 <a href="https://man.freebsd.org/cgi/man.cgi?query=rsh&amp;sektion=1&amp;format=html">rsh(1)</a> や <a href="https://man.freebsd.org/cgi/man.cgi?query=rcp&amp;sektion=1&amp;format=html">rcp(1)</a> といったプログラムの動作に影響するので注意が必要です。 <span class=filename>/etc/hosts.equiv</span> の記述は慎重におこないましょう。</p></div><div class=paragraph><p>例として、以下にホスト <code>rose</code> の <span class=filename>/etc/hosts.lpd</span> を示します。</p></div><div class="literalblock programlisting"><div class=content><pre>orchid
violet
madrigal.fishbaum.de</pre></div></div><div class=paragraph><p>この例では、<code>rose</code> はホスト <code>orchid</code>, <code>violet</code> そして <code>madrigal.fishbaum.de</code> からの要求を受け付けることになります。 その他のホストが <code>rose</code> の LPD にアクセスしようとしても、 LPD はそのジョブを拒否します (訳注: 拒否されるのは、そのホストが <span class=filename>/etc/hosts.equiv</span> にも含まれていない場合です)。</p></div></dd><dt class=hdlist1>サイズの制限</dt><dd><p>スプーリングディレクトリがある ファイルシステムに残しておく必要がある 空き容量の大きさを制御することができます。 ローカルプリンタ用のスプーリングディレクトリに <span class=filename>minfree</span> という名前のファイルを作成します。そして、 そのファイルの中にリモートホストからのジョブの 要求を受け付けるために必要な空き容量のディスクブロックサイズ (1 ディスクブロック = 512 バイト) を記します。</p><div class=paragraph><p>これで、 リモートホストのユーザにファイルシステムを満杯にされないことが保証されます。 この機能を使うと、 ローカルホストのユーザに対してある種の優先権を与えることもできます。 ローカルホストのユーザは、 <span class=filename>minfree</span> ファイルで指定された値よりもディスクの空き容量が下回った後でもずっと、 ジョブをキューに入れることができるのです。</p></div><div class=paragraph><p>たとえば、プリンタ <code>bamboo</code> 用の <span class=filename>minfree</span> を作ってみましょう。 このプリンタのスプーリングディレクトリを調べるために、 <span class=filename>/etc/printcap</span> を調べてみましょう。 以下に、<code>bamboo</code> のエントリ部分を示します。</p></div><div class="literalblock programlisting"><div class=content><pre>bamboo|ps|PS|S|panasonic|Panasonic KX-P4455 PostScript v51.4:\
        :sh:sd=/var/spool/lpd/bamboo:sc:rg=artists:mx#5000:\
        :lp=/dev/ttyu5:ms#-parenb cs8 clocal crtscts:rw:mx#5000:\
        :if=/usr/local/libexec/psif:\
        :df=/usr/local/libexec/psdf:</pre></div></div><div class=paragraph><p>スプーリングディレクトリは <code>sd</code> 項目で指定されます。LPD がリモートホストからのジョブを受け付けるために必要な ファイルシステムの空き容量を 3M バイト (= 6144 ディスクブロック) にすることにしましょう。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># echo 6144 &gt; /var/spool/lpd/bamboo/minfree</span></code></pre></div></div></dd><dt class=hdlist1>利用ユーザの制限</dt><dd><p><span class=filename>/etc/printcap</span> の <code>rs</code> 項目を指定することで、 ローカルプリンタを利用できるリモートホストのユーザを制限することができます。 ローカルホストに接続されたプリンタ用のエントリに <code>rs</code> 項目が指定されている場合、 LPD は、印字を要求したユーザのアカウントと同じログイン名が ローカルホストに登録されている<em>場合に限り</em>、 そのジョブを受け付けます。それ以外のジョブを LPD は拒否します。</p><div class=paragraph><p>この機能は、(たとえば) 複数の部署がネットワークを共有しており、 この内のあるユーザが部署の境界を越えて活動している場合には特に有用です。 そのようなユーザに対して、システムのアカウントを与えるだけで、 これらのユーザは自分が所属する部署のシステムから そのシステムに接続されているプリンタを使用することができます。 これらのユーザにはむしろ、 プリンタの使用<em>だけ</em>を認め、 その他のコンピュータ資源を利用させたくないときは、 それらのユーザにはホームディレクトリを与えず、 ログインシェルはシェルとしては何の役にも立たない <span class=filename>/usr/bin/false</span> などを指定して、 これらのユーザのアカウントはプリンタ用の "形式的な" ものとします。</p></div></dd></dl></div></div></div><div class=sect2><h3 id=printing-advanced-acct>9.4.5. プリンタの利用に対する課金<a class=anchor href=#printing-advanced-acct></a></h3><div class=paragraph><p>という訳で、印字するためには料金をとることが必要です。 取らない理由などありましょうか。紙やインクにはお金がかかります。 そして、プリンタの維持費もかかります。 プリンタには可動部分が搭載されており、 これらの部分は壊れやすいという傾向があります。 プリンタや、その利用形態、維持費について調査をし、1 ページ (1 フィート、1 メートルなど) 当たりにかかるコストを調べておいてください。 これに基づき、プリンタの利用に対する課金を、実際に、 どのように始めればよいのでしょうか。</p></div><div class=paragraph><p>さて、残念ながら、この部分に関しては LPD スプーリングシステムはほとんど役に立ちません。 課金は使用しているプリンタの種類、印字するもののファイルの形式、 プリンタの利用に対する課金での <em>あなた自身の</em>要求に大きく左右されます。</p></div><div class=paragraph><p>課金システムを実現するためには、プリンタのテキストフィルタ (プレインテキストのジョブに対して課金するため) と変換フィルタ (その他のファイル形式に対して課金するため) を変更して、 印字したページを数えたり、 プリンタに印字したページ数を取得するための要求を送る必要があります。 ただし、出力フィルタのみを利用している場合は、 課金をおこなうことができません。フィルタに関しては、 「<a href=#printing-advanced-filter-intro>フィルタ</a>」をご覧ください。</p></div><div class=paragraph><p>一般に、課金方式には次の 2 つがあります。</p></div><div class=ulist><ul><li><p><em>定期的に課金する方法</em> はよく利用される方法です。この理由は、 恐らく比較的簡単に実現できるからです。 誰かがジョブを印字する度に、フィルタはそのユーザ名、 ホスト名、印字したページ数を課金データファイルに記録します。 毎月、毎学期、毎年、その他お好みの時期に、 各プリンタの課金用ファイルを集め、 それぞれのユーザが印字したページ数を合計して その分の課金をおこないます。 次回の課金期間をデータを 0 にして課金を再開するために、 すべてのログファイルを削除します。</p></li><li><p><em>利用毎に課金する方法</em> はあまり利用されていません。これは、 実現するのが比較的難しいからです。この方式では、 プリンタを使用したらすぐに、 フィルタがユーザにその利用に対する課金をおこないます。 ディスククォータのように、課金作業は瞬時におこなわれます。 この方式では、ユーザのアカウントが赤字になる場合に、 ユーザが印字をおこなうことを拒否することができます。 また、ユーザに "プリンタ版 quota" を調べたり、 調整したりする方法を提供したいと思うかもしれ ません。 これを実現するためには、ユーザとその quota を追跡するために、 あるデータベース用のコードが必要となります。</p></li></ul></div><div class=paragraph><p>LPD スプーリングシステムでは、 どちらの方式にも簡単に対応できます。(ほとんどの場合は) フィルタを用意しなければならないので、 課金作業のためのコードも用意しなければなりません。 しかし、明るい面もあります。 それは、課金方式に関して、非常に大きな柔軟性が与えられたということです。 たとえば、「定期的に課金する方法」か、 「利用毎に課金する方法」のどちらかを選びまず、そして、 どんな情報 (ユーザ名、ホスト名、ジョブのタイプ、印字された頁数、 使用した紙の大きさ、印字をするために要した時間など) をログに記録するかを決めます。 以上のことをおこなうには、上記の情報を保持するために、 フィルタを変更しなくてはなりません。</p></div><div class=sect3><h4 id=_手軽なプリンタ課金方法>9.4.5.1. 手軽なプリンタ課金方法<a class=anchor href=#_手軽なプリンタ課金方法></a></h4><div class=paragraph><p>FreeBSD には、「定期的に課金する方法」による課金を すぐに設定できるように、2 個のプログラムを添付しています。 その内の1つはテキストフィルタ <code>lpf</code> で、 これについては、「<a href=#printing-advanced-lpf>テキストフィルタ lpf</a>」をご覧ください。もう1つは、 <a href="https://man.freebsd.org/cgi/man.cgi?query=pac&amp;sektion=8&amp;format=html">pac(8)</a> で、 これはプリンタの課金データファイルからのエントリを集め、 これを合計するプログラムです。</p></div><div class=paragraph><p>「<a href=#printing-advanced-filters>フィルタはどのように機能しているか</a>」で述べたように、 LPD ではテキストフィルタや変換フィルタを起動しますが、 そのコマンドラインで使用している課金データファイルの名前が指定されます。 両フィルタはこの引数を使って、 どの課金データファイルのエントリに書き込めばよいのかを知ることができます。 このファイルの名前は <span class=filename>/etc/printcap</span> 中の <code>af</code> 項目によって指定されます。 このファイルが絶対パ スで指定されない場合は、 スプーリングディレクトリからの相対パスとして扱われます。</p></div><div class=paragraph><p>LPD は、紙のページの幅と行数 (<code>pw</code> と <code>pl</code> 項目で 指定される) を引数として <code>lpf</code> を起動します。<code>lpf</code> フィルタでは、 何ページ印字したかを決定するためにこれらの引数を使用します。 ファイルをプリンタに送った後、 課金情報を課金データファイルに書き込みます。 このファイルは次のようになります。</p></div><div class="literalblock programlisting"><div class=content><pre>2.00 rose:andy
3.00 rose:kelly
3.00 orchid:mary
5.00 orchid:mary
2.00 orchid:zhang</pre></div></div><div class=paragraph><p>課金データファイルはプリンタ毎に分けて作るべきです。 これは、<code>lpf</code> にはファイルをロックする機構が組み込まれていないためです。 したがって、<code>lpf</code> が 2 つ起動されたとき、 同じファイルに同時に書き込みをおこなった場合、 お互いのエントリを破壊してしまうかもしれません。 課金用ファイルを各プリンタ毎に確実に分けるには、 <span class=filename>/etc/printcap</span> 中の <code>af=acct</code> 項目を使います。 そうすれば、それぞれの課金用ファイルがプリンタのスプーリングディレクトリに、 <span class=filename>acct</span> という名称で作成されます。</p></div><div class=paragraph><p>プリンタの利用に対してユーザに課金する準備ができたら、 <a href="https://man.freebsd.org/cgi/man.cgi?query=pac&amp;sektion=8&amp;format=html">pac(8)</a> プログラムを実行してください (課金したいプリンタのスプーリングディレクトリに移動した後、 <code>pac</code> と入力してください)。 次のような、ドル中心主義の課金リストが表示されます (訳注: ドル中心主義という表現は、 表示がドルで出ることへの著者の皮肉でしょう。 セントがあるので小数点以下が表示されますが、 この機能も日本では邪魔ですね)。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>  Login               pages/feet   runs    price
orchid:kelly                5.00    1   <span class=nv>$ </span> 0.10
orchid:mary                31.00    3   <span class=nv>$ </span> 0.62
orchid:zhang                9.00    1   <span class=nv>$ </span> 0.18
rose:andy                   2.00    1   <span class=nv>$ </span> 0.04
rose:kelly                177.00  104   <span class=nv>$ </span> 3.54
rose:mary                  87.00   32   <span class=nv>$ </span> 1.74
rose:root                  26.00   12   <span class=nv>$ </span> 0.52

total                     337.00  154   <span class=nv>$ </span> 6.74</code></pre></div></div><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=pac&amp;sektion=8&amp;format=html">pac(8)</a> が受け付ける引数には次のようなものがあります。</p></div><div class=dlist><dl><dt class=hdlist1><code>-P <em>printer</em></code></dt><dd><p>プリンタ <em>printer</em> の利用に対する課金リストを作成します。 このオプションは、<span class=filename>/etc/printcap</span> の <code>af</code> が絶対パスで指定されていた場合に限り、動作します。</p></dd><dt class=hdlist1><code>-c</code></dt><dd><p>ユーザ名のアルファベット順ではなく、 課金額の低い順にリストを並べます。</p></dd><dt class=hdlist1><code>-m</code></dt><dd><p>課金データファイルにあるホスト名を無視します。 このオプションを使用すると、ホスト <code>alpha</code> のユーザ <code>smith</code> とホスト <code>gamma</code> のユーザ <code>smith</code> は同一人物として扱われます。 このオプションが指定されない場合は、 両者は別なユーザとして扱います。</p></dd><dt class=hdlist1><code>-p <em>price</em></code></dt><dd><p><span class=filename>/etc/printcap</span> の <code>pc</code> 項目で指定された値、または、 デフォルトの値 (2 セント) に代わり、紙1ページ、または、 1フィート当たりの価格を指定します。 <em>price</em> として、 浮動小数点数を指定することができます。</p></dd><dt class=hdlist1><code>-r</code></dt><dd><p>リストの並べる順番を逆順にします。</p></dd><dt class=hdlist1><code>-s</code></dt><dd><p>課金リストを作成し、 課金データファイルを削除します。</p></dd><dt class=hdlist1><em>name…​</em></dt><dd><p>ユーザ <em>names</em> に対する課金情報のみを表示します。</p></dd></dl></div><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=pac&amp;sektion=8&amp;format=html">pac(8)</a> が生成するデフォルトのリストには、 各ホストのユーザ別に印字ページ数が表示されます。 (ユーザがサイト内のすべてのホストを使用できるため) ホスト名の情報が意味を持たない場合、 <code>pac -m</code> を実行してください。次のようなリストが得られます。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>  Login               pages/feet   runs    price
andy                        2.00    1   <span class=nv>$ </span> 0.04
kelly                     182.00  105   <span class=nv>$ </span> 3.64
mary                      118.00   35   <span class=nv>$ </span> 2.36
root                       26.00   12   <span class=nv>$ </span> 0.52
zhang                       9.00    1   <span class=nv>$ </span> 0.18

total                     337.00  154   <span class=nv>$ </span> 6.74</code></pre></div></div><div class=paragraph><p>課金額を決めるために、 <a href="https://man.freebsd.org/cgi/man.cgi?query=pac&amp;sektion=8&amp;format=html">pac(8)</a> は <span class=filename>/etc/printcap</span> ファイルの <code>pc</code> 項目で指定された値 (デフォルト値は 200、すなわち 1 ページ当たり 2 セント) を使います。この項目で、印字物に課金したい ファと思う 1 ページ当たり、 または、1 フィート当たりの価格を 100 分の 1 セント単位で指定します。 <a href="https://man.freebsd.org/cgi/man.cgi?query=pac&amp;sektion=8&amp;format=html">pac(8)</a> を <code>-p</code> オプション付きで起動すると、 この値を置き換えることができます。 この <code>-p</code> オプションで指定する額の単位は、 100 分の 1 セント単位ではなく、ドル単位です。たとえば、次の指定では、 1 ページ当たりの単価が 1 ドル 50 セントになります。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pac -p1.50</span></code></pre></div></div><div class=paragraph><p>このオプションを使うと、 実際の課金額を集計することができます。</p></div><div class=paragraph><p>最後に、<code>pac -s</code> を起動すると、課金情報は課金データ累計ファイルに保存されます。 このファイルの名前は、プリンタの課金データファイルの後ろに <code>_sum</code> を付けたものとなります。そして、 課金データファイルは削除されます。次に <a href="https://man.freebsd.org/cgi/man.cgi?query=pac&amp;sektion=8&amp;format=html">pac(8)</a> が起動されると、 その時点までの累計金額を得るために、 課金データ累計ファイルが読み込まれ、 通常の課金データファイルからの情報に加算されます。</p></div></div><div class=sect3><h4 id=_印字されたページ数をどのように数えるか>9.4.5.2. 印字されたページ数をどのように数えるか?<a class=anchor href=#_印字されたページ数をどのように数えるか></a></h4><div class=paragraph><p>課金を、リモートホストからの印字でさえも、 正確におこなうためには、 ジョブで使用された紙が何ページであるかを特定できる必要があります。 このことは、プリンタ利用に対する課金をおこなう上の根本的な問題です。</p></div><div class=paragraph><p>プレインテキストのジョブの場合、 問題を解決するのはさほど難しくはありません。 ジョブが何行であったかを数え、プリンタがサポートしている紙 1 ページに印字できる最大の行数と比較すればよいのです。 重ね打ちするために利用されるファイル中のバックスペース文字や、 物理的に複数の行に渡る長い論理行に対する取り扱いを忘れずにおこなってください。</p></div><div class=paragraph><p>(「<a href=#printing-advanced-lpf>テキストフィルタ lpf</a>」で紹介した) テキストフィルタ <code>lpf</code> では、課金をおこなうときに、 これらの取り扱いをおこなってくれます。 課金をおこなうために必要なテキストフィルタを作成している方は、 <code>lpf</code> のソースコードが参考になるでしょう。</p></div><div class=paragraph><p>これに対して、他のファイル形式の処理はどのようにすれば よいのでしょうか。</p></div><div class=paragraph><p>まず、DVI から LaserJet, または、DVI から PostScript® への変換の場合、フィルタが <code>dvilj</code> や <code>dvips</code> の 出力メッセージを解析することで、 何ページ分の変換がおこなわれたかを知ることができます。 他のファイル形式とその変換プログラムに関しても、 同様のことができるかもしれません。</p></div><div class=paragraph><p>しかし、この方式には問題点があります。それは、 変換されたページがすべて印字されるとは限らないということです。 たとえば、プリンタが紙詰まりを起こしたり、トナー切れになったり、 はたまた、爆発したりするかもしれません。 そのような状況により印字が途中で中止されたとしても、この方式では、 ユーザは全ページ分の料金を課されてしまうのです。</p></div><div class=paragraph><p>それでは、どのような対策をたてることができるのでしょうか。</p></div><div class=paragraph><p><em>正確な</em> 課金をおこなうための唯一の<em>確実な</em>方法は、 何ページ印字したのかを知らせることができるプリンタを入手し、 これをシリアルポートかネットワークに接続することです。 ほとんどすべての PostScript® プリンタではこの概念がサポートされています。 他のプリンタも同様です (Imagen レーザプリンタをネットワーク接続するなど)。 それぞれのプリンタのフィルタを、 ジョブを印字した後で印字ページ数を得るように変更してください。 そして、課金情報はここで得られた値<em>のみに</em> 基づいて記録してください。行数を数えたり、 エラーが生じやすいファイルの調査は必要とされません。</p></div><div class=paragraph><p>もちろん、 気前よく印字料金をすべて無料にすることもできます。</p></div></div></div></div></div><div class=sect1><h2 id=printing-using>9.5. プリンタを使う<a class=anchor href=#printing-using></a></h2><div class=sectionbody><div class=paragraph><p>この節では、FreeBSD で設定したプリンタを使う方法について説明します。 ここでは、ユーザレベルでのコマンドを概説します。</p></div><div class=dlist><dl><dt class=hdlist1><a href="https://man.freebsd.org/cgi/man.cgi?query=lpr&amp;sektion=1&amp;format=html">lpr(1)</a></dt><dd><p>印字をおこないます。</p></dd><dt class=hdlist1><a href="https://man.freebsd.org/cgi/man.cgi?query=lpq&amp;sektion=1&amp;format=html">lpq(1)</a></dt><dd><p>プリンタキューを調べます。</p></dd><dt class=hdlist1><a href="https://man.freebsd.org/cgi/man.cgi?query=lprm&amp;sektion=1&amp;format=html">lprm(1)</a></dt><dd><p>プリンタキューにあるジョブを削除します。</p></dd></dl></div><div class=paragraph><p>また、「<a href=#printing-lpc>プリンタの管理</a>」 節で説明されている管理者用コマンド <a href="https://man.freebsd.org/cgi/man.cgi?query=lpc&amp;sektion=8&amp;format=html">lpc(8)</a> もあり、 プリンタやそのキューの制御のために用いられています。</p></div><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=lpr&amp;sektion=1&amp;format=html">lpr(1)</a>、<a href="https://man.freebsd.org/cgi/man.cgi?query=lprm&amp;sektion=1&amp;format=html">lprm(1)</a>、そして <a href="https://man.freebsd.org/cgi/man.cgi?query=lpq&amp;sektion=1&amp;format=html">lpq(1)</a> の 3 コマンドは、<code>-P <em>printer-name</em></code> オプションをとり、これによって、 <span class=filename>/etc/printcap</span> のように操作の対象となる プリンタやキューを指定します。 これによって、様々なプリンタに対してジョブを送る、 取り消す、調査することができます。 <code>-P</code> が使われなかった場合は、これらのコマンドは <code>PRINTER</code> 環境変数で指定されたプリンタを使用します。 そして、<code>PRINTER</code> 環境変数がなかった場合は、 これらのコマンドはデフォルトのプリンタ <code>lp</code> を使います。</p></div><div class=paragraph><p>以下では、<em>デフォルトプリンタ</em> という用語が意味するプリンタは、<code>PRINTER</code> 環境変数で指定されたプリンタ、もしくは、<code>PRINTER</code> 環境変数がない場合は、<code>lp</code> という名前のプリンタです。</p></div><div class=sect2><h3 id=printing-lpr>9.5.1. 印字する<a class=anchor href=#printing-lpr></a></h3><div class=paragraph><p>ファイルを印字するためには、 次のように入力してください。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% lpr filename ...</code></pre></div></div><div class=paragraph><p>これにより、 入力されたファイルのそれぞれをデフォルトのプリンタ から印字します。ファイル名が与えられなかった場合、 <a href="https://man.freebsd.org/cgi/man.cgi?query=lpr&amp;sektion=1&amp;format=html">lpr(1)</a> は標準入力から印字するデータを読み込みます。たとえば、 次のコマンドにより、ある重要なシステムファイルが印字されます。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% lpr /etc/host.conf /etc/hosts.equiv</code></pre></div></div><div class=paragraph><p>印字させるプリンタを選択するためには、 次のように入力します。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% lpr <span class=nt>-P</span> printer-name filename ...</code></pre></div></div><div class=paragraph><p>次の例では、プリンタ <code>rattan</code> に、 カレントディレクトリにあるファイルの詳細なリストを印字しています。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% <span class=nb>ls</span> <span class=nt>-l</span> | lpr <span class=nt>-P</span> rattan</code></pre></div></div><div class=paragraph><p>上記の <a href="https://man.freebsd.org/cgi/man.cgi?query=lpr&amp;sektion=1&amp;format=html">lpr(1)</a> コマンドではファイル名の指定がないので、 <code>lpr</code> は標準入力から印字するデータ、 この場合、<code>ls -l</code> コマンドの出力、を読み込みます。</p></div><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=lpr&amp;sektion=1&amp;format=html">lpr(1)</a> コマンドでは、 出力の整形を制御したり、ファイル変換を適用したり、 複数部数のコピーを作成したり、 などといた様々な幅広いオプションを受け付けることもできます。 詳細については、 「<a href=#printing-lpr-options>その他の印字オプション</a>」をご覧ください。</p></div></div><div class=sect2><h3 id=printing-lpq>9.5.2. ジョブの処理状況を調べる<a class=anchor href=#printing-lpq></a></h3><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=lpr&amp;sektion=1&amp;format=html">lpr(1)</a> コマンドを使って印字をする場合、プリントしようと するデータは "プリントジョブ" と呼ばれる箱に一緒に置かれ、 これが LPD スプーリングシステムに送られます。 プリンタにはそれぞれジョブ用のキューがあり、 送られてきたジョブはあなたや他のユーザからの別のジョブと一緒にそのキューで並んで、 処理される順番を待ちます。 プリンタは到着順にこれらのジョブの印字をおこないます。</p></div><div class=paragraph><p>デフォルトプリンタのキューの状態を表示するには、 <a href="https://man.freebsd.org/cgi/man.cgi?query=lpq&amp;sektion=1&amp;format=html">lpq(1)</a> と入力します。プリンタを指定するときは、 <code>-P</code> オプションを使います。たとえば、次のコマンド</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% lpq <span class=nt>-P</span> bamboo</code></pre></div></div><div class=paragraph><p>は、プリンタ <code>bamboo</code> のキューの状態を表示します。この <code>lpq</code> コマンドの出力結果の例を次に示します。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>bamboo is ready and printing
Rank   Owner    Job  Files                              Total Size
active kelly    9    /etc/host.conf, /etc/hosts.equiv   88 bytes
2nd    kelly    10   <span class=o>(</span>standard input<span class=o>)</span>                   1635 bytes
3rd    mary     11   ...                                78519 bytes</code></pre></div></div><div class=paragraph><p>この例では、<code>bamboo</code> のキューに 3 つのジョブがあることが分かります。 最初のジョブはユーザ kelly からのものであり、 "ジョブ番号" 9 が割り当てられています。 プリンタのすべてのジョブには一意なジョブ番号が付けられています。 ほとんどの場合、このジョブ番号は無視することができますが、 ジョブをキャンセルするときにはこの番号が必要になります。 このことの詳細については、「<a href=#printing-lprm>ジョブの削除</a> 」をご覧ください。</p></div><div class=paragraph><p>ジョブ番号 9 のジョブは 2 つのファイルを処理します。すなわち、 <a href="https://man.freebsd.org/cgi/man.cgi?query=lpr&amp;sektion=1&amp;format=html">lpr(1)</a> のコマンドラインに複数のファイル名が与えられたときは、 1つのジョブとして扱われるのです。このジョブは、現在、 アクティブジョブ ("Rank" の欄の <code>active</code> という後に注目) になっています。 これは、プリンタからそのジョブが現在印字されているはずであることを意味しています。 2 番目のジョブでは、 <a href="https://man.freebsd.org/cgi/man.cgi?query=lpr&amp;sektion=1&amp;format=html">lpr(1)</a> コマンドに標準入力からデータが与えられています。 3番目のジョブはユーザ <code>mary</code> から与えられました。 このジョブのサイズはとても大きくなっています。 彼女がプリントしようとしたファイルのパス名はここで表示させるには長すぎるため、 <a href="https://man.freebsd.org/cgi/man.cgi?query=lpq&amp;sektion=1&amp;format=html">lpq(1)</a> コマンドはドットを 3 つだけ表示しています。</p></div><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=lpq&amp;sektion=1&amp;format=html">lpq(1)</a> からの出力で一番最初の行もまた有益な情報を与えています。 この行から、プリンタが現在何をしているか (あるいは、少なくとも LPD がプリンタがしていると思っていること) が分かります。</p></div><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=lpq&amp;sektion=1&amp;format=html">lpq(1)</a> コマンドは <code>-l</code> オプションもサポートしています。 これにより、 詳しい情報が表示されます。 <code>lpq -l</code> の実行例を次に示します。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>waiting <span class=k>for </span>bamboo to become ready <span class=o>(</span>offline ?<span class=o>)</span>
kelly: 1st                               <span class=o>[</span>job 009rose]
       /etc/host.conf                    73 bytes
       /etc/hosts.equiv                  15 bytes

kelly: 2nd                               <span class=o>[</span>job 010rose]
       <span class=o>(</span>standard input<span class=o>)</span>                  1635 bytes

mary: 3rd                                <span class=o>[</span>job 011rose]
      /home/orchid/mary/research/venus/alpha-regio/mapping 78519 bytes</code></pre></div></div></div><div class=sect2><h3 id=printing-lprm>9.5.3. ジョブの削除<a class=anchor href=#printing-lprm></a></h3><div class=paragraph><p>印字するようジョブを 送った後で印字を中断したくなったときは、 <a href="https://man.freebsd.org/cgi/man.cgi?query=lprm&amp;sektion=1&amp;format=html">lprm(1)</a> コマンドで、 キューの中からそのジョブを削除することができます。 大抵の場合、アクティブジョブでさえも <a href="https://man.freebsd.org/cgi/man.cgi?query=lprm&amp;sektion=1&amp;format=html">lprm(1)</a> を使って削除することができますが、 そのジョブの一部またはすべてが印字されてしまうかもしれません。</p></div><div class=paragraph><p>デフォルトプリンタへのジョブを削除するためには、最初に、 <a href="https://man.freebsd.org/cgi/man.cgi?query=lpq&amp;sektion=1&amp;format=html">lpq(1)</a> を使ってそのジョブ番号を調べます。 すなわち、それから、 次のように入力して、ジョブを削除します。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% lprm job-number</code></pre></div></div><div class=paragraph><p>特定のプリンタへのジョブを削除するときは、 <code>-P</code> オプションを使ってそのプリンタを指定します。 たとえば、プリンタ <code>bamboo</code> のキューからジョブ番号 10 のジョブを削除するには次のようにします。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% lprm <span class=nt>-P</span> bamboo 10</code></pre></div></div><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=lprm&amp;sektion=1&amp;format=html">lprm(1)</a> コマンドには略記法がいくつかあります。</p></div><div class=dlist><dl><dt class=hdlist1>lprm -</dt><dd><p>あなたが (デフォルトプリンタへ) 送ったジョブをすべて削除します。</p></dd><dt class=hdlist1>lprm <em>user</em></dt><dd><p>ユーザ <em>user</em> が (デフォルトプリンタへ) 送ったジョブをすべて削除します。 他のユーザのジョブを削除できるのはスーパユーザだけです。 あなたは、あなた自身のジョブしか削除することはできません。</p></dd><dt class=hdlist1>lprm</dt><dd><p>ジョブ番号もユーザ名もシンボル <code>-</code>も指定されないときは、 <a href="https://man.freebsd.org/cgi/man.cgi?query=lprm&amp;sektion=1&amp;format=html">lprm(1)</a> は現在のアクティブジョブを、 そのジョブを送ったのがあなた自身であるときに限り、 デフォルトプリンタから削除します。ただし、 スーパユーザは任意のアクティブジョブを削除することができます。</p></dd></dl></div><div class=paragraph><p>上記の略記法をデフォルトプリンタではなく 特定のプリンタに対しておこなうときは、<code>-P</code> オプションでそのプリンタを指定するだけよいのです。たとえば、 プリンタ <code>rattan</code> のキューへあなたが送ったジョブを すべて削除するためには次のようにします。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% lprm <span class=nt>-P</span> rattan -</code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>ネットワーク環境で作業をしている場合、 あるホストから送られたプリンタジョブは、これを送ったホストで <a href="https://man.freebsd.org/cgi/man.cgi?query=lprm&amp;sektion=1&amp;format=html">lprm(1)</a> を使った場合に限って、 これを削除することができます。 他のホストで同じプリンタを使えたとしても、 このジョブを削除することはできません。 次の例では、他ホストからジョブを削除することを試みています。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% lpr <span class=nt>-P</span> rattan myfile
% rlogin orchid
% lpq <span class=nt>-P</span> rattan
Rank   Owner      Job  Files                          Total Size
active seeyan     12    ...                           49123 bytes
2nd    kelly      13   myfile                         12 bytes
% lprm <span class=nt>-P</span> rattan 13
rose: Permission denied
% <span class=nb>logout</span>
% lprm <span class=nt>-P</span> rattan 13
dfA013rose dequeued
cfA013rose dequeued</code></pre></div></div></td></tr></tbody></table></div></div><div class=sect2><h3 id=printing-lpr-options>9.5.4. その他の印字オプション<a class=anchor href=#printing-lpr-options></a></h3><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=lpr&amp;sektion=1&amp;format=html">lpr(1)</a> コマンドには、テキストの整形や、 図や他のファイル形式の変換、複数部コピーの生成、 ジョブの扱いなどを制御することができます。 この節では、これに関するオプションについて記しています。</p></div><div class=sect3><h4 id=printing-lpr-options-format>9.5.4.1. 整形と変換に関するオプション<a class=anchor href=#printing-lpr-options-format></a></h4><div class=paragraph><p>以下の <a href="https://man.freebsd.org/cgi/man.cgi?query=lpr&amp;sektion=1&amp;format=html">lpr(1)</a> 用のオプションはジョブにおける ファイルの整形の制御に関するものです。 このオプションは、ジョブにプレインテキストが含まれない場合や <a href="https://man.freebsd.org/cgi/man.cgi?query=pr&amp;sektion=1&amp;format=html">pr(1)</a> ユーティリティを使ってプレインテキストを整形する場合に用いてください。</p></div><div class=paragraph><p>次の例では、プリンタ <code>bamboo</code> に (TeX 組版システムによる) DVI ファイル <span class=filename>fish-report.dvi</span> を印字しています。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% lpr <span class=nt>-P</span> bamboo <span class=nt>-d</span> fish-report.dvi</code></pre></div></div><div class=paragraph><p>このオプションは、 ジョブに含まれるすべてのファイルに対して適用されます。 したがって、1 つのジョブに (たとえば) DVI ファイルと ditroff ファイルを混在させることはできません。その代わりに、 ファイルを形式毎に別々のジョブに分け、 それぞれのジョブでその形式用の変換オプションを使って印字してください。</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p><code>-p</code> と <code>-T</code> を除くすべてのオプションを使用 するためには、 出力先プリンタ用の変換フィルタが必要です。たとえば、 <code>-d</code> オプションを使用するには、DVI 用の変換フィルタが必要 です。詳細については、「<a href=#printing-advanced-convfilters>変換フィルタ</a>」で説明しています。</p></div></td></tr></tbody></table></div><div class=dlist><dl><dt class=hdlist1><code>-c</code></dt><dd><p>cifplot ファイルを印字します。</p></dd><dt class=hdlist1><code>-d</code></dt><dd><p>DVI ファイルを印字します。</p></dd><dt class=hdlist1><code>-f</code></dt><dd><p>FORTRAN プログラムを印字します。</p></dd><dt class=hdlist1><code>-g</code></dt><dd><p>plot のデータを印字します。</p></dd><dt class=hdlist1><code>-i <em>number</em></code></dt><dd><p>出力に対して、<em>number</em> カラム分の字下げをおこないます。 <em>number</em> が省略されると、 8 カラム分字下げされます。 このオプションはある変換フィルタと一緒の指定されたときのみに機能します。</p><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p><code>-i</code> と数字の間に空白を入れてはいけません。</p></div></td></tr></tbody></table></div></dd><dt class=hdlist1><code>-l</code></dt><dd><p>制御文字を含む文字通りのテキストデータを印字します。</p></dd><dt class=hdlist1><code>-n</code></dt><dd><p>ditroff (device independent troff) データを印字します。</p></dd><dt class=hdlist1>-p</dt><dd><p>印字する前に <a href="https://man.freebsd.org/cgi/man.cgi?query=pr&amp;sektion=1&amp;format=html">pr(1)</a> によってプレインテキストを整形します。 詳細については <a href="https://man.freebsd.org/cgi/man.cgi?query=pr&amp;sektion=1&amp;format=html">pr(1)</a> をご覧ください。</p></dd><dt class=hdlist1><code>-T <em>title</em></code></dt><dd><p><a href="https://man.freebsd.org/cgi/man.cgi?query=pr&amp;sektion=1&amp;format=html">pr(1)</a> コマンドにより生成されるヘッダを、 ファイル名の代わりに <em>title</em> とする。 このオプションは、<code>-p</code> と一緒に使ったときのみ機能する。</p></dd><dt class=hdlist1><code>-t</code></dt><dd><p>troff データを印字します。</p></dd><dt class=hdlist1><code>-v</code></dt><dd><p>ラスタのデータを印字します。</p></dd></dl></div><div class=paragraph><p>次の例では、<a href="https://man.freebsd.org/cgi/man.cgi?query=ls&amp;sektion=1&amp;format=html">ls(1)</a> のマニュアルを美しく整形したものをデフォルトプリンタで印字しています。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% zcat /usr/shared/man/man1/ls.1.gz | troff <span class=nt>-t</span> <span class=nt>-man</span> | lpr <span class=nt>-t</span></code></pre></div></div><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=zcat&amp;sektion=1&amp;format=html">zcat(1)</a> コマンドで <a href="https://man.freebsd.org/cgi/man.cgi?query=ls&amp;sektion=1&amp;format=html">ls(1)</a> のマニュアルのソースファイルの圧縮を復元し、これを <a href="https://man.freebsd.org/cgi/man.cgi?query=troff&amp;sektion=1&amp;format=html">troff(1)</a> コマンドに渡しています。 これによりソースファイルが整形され GNU troff の形式となります。 その結果は <a href="https://man.freebsd.org/cgi/man.cgi?query=lpr&amp;sektion=1&amp;format=html">lpr(1)</a> に渡され、 LPD スプーラへジョブの要求が発せられます。 <a href="https://man.freebsd.org/cgi/man.cgi?query=lpr&amp;sektion=1&amp;format=html">lpr(1)</a> には <code>-t</code> オプションが使われているため、 スプーラでジョブを印字したときに GNU troff の形式から、デフォルトプリンタが解釈できる形式へと変換されます。</p></div></div><div class=sect3><h4 id=printing-lpr-options-job-handling>9.5.4.2. ジョブに関するオプション<a class=anchor href=#printing-lpr-options-job-handling></a></h4><div class=paragraph><p>以下のオプションは、<a href="https://man.freebsd.org/cgi/man.cgi?query=lpr&amp;sektion=1&amp;format=html">lpr(1)</a> によって、 そのジョブを特殊な扱いにするよう LPD に指示するためのものです。</p></div><div class=dlist><dl><dt class=hdlist1>-# <em>copies</em></dt><dd><p>ジョブに含まれるファイルのそれぞれを 1 部だけ印字するのではなく、 <em>copies</em> 部のコピーを生成させるものです。管理者によっては、 プリンタの消耗を避け、コピー機による複製を奨励するために このオプションの使用が禁止されているかもしれません。 これに関しては、「<a href=#printing-advanced-restricting-copies>複数部のコピーの印字を制限する </a>」をご覧ください。</p><div class=paragraph><p>次の例では、デフォルトプリンタで <span class=filename>parser.c</span> を 3 部コピーし、次に、 <span class=filename>parser.h</span> を 3 部コピーしています。</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% lpr -#3 parser.c parser.h</code></pre></div></div></dd><dt class=hdlist1>-m</dt><dd><p>印字ジョブが完了した後で、メールを送ります。 このオプションを付けると、LPD システムはジョブの処理が終了したときに、 あなたのアカウントにメールを送ります。 メールのメッセージには、ジョブが正常終了したのか、あるいは、 何か異常があり、(しばしば) その異常が何であったのかが書かれています。</p></dd><dt class=hdlist1>-s</dt><dd><p>印字ファイルをスプールディレクトリにコピーせず、 代わりに、 シンボリックリンクを作成するよう指示します。</p><div class=paragraph><p>印字させるジョブのサイズが大きいとき、 このオプションを使うと便利かもしれません。このオプションにより、 スプー ルディレクトリの容量が節約されます (それに、 巨大なジョブのお陰でスプールディレクトリのあるファイルシステムの空き容量がなくなってしまうかもしれません)。 さらに、LPD がいちいちすべてのデータをコピーする必要がなくなりますので、 時間の節約にもなります。</p></div><div class=paragraph><p>ただし、欠点もあります。LPD はオリジナルのファイルを直接参照するので、 印字が終了するまでそのファイルを変更したり削除することができません。</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>リモートのプリンタで印字している場合、 LPD は、結局のところ、 ローカルホストからリモートホストにファイルをコピーする必要があります。 したがって、<code>-s</code> オプションはローカルのスプーリングディレクトリの空き容量を節約するだけで、 リモート側では節約されません。 それでも、このオプションは有用です。</p></div></td></tr></tbody></table></div></dd><dt class=hdlist1>-r</dt><dd><p>ジョブに含まれるファイルを、 スプーリングディレクトリに ファイルをコピーした後に削除します。もしくは、 <code>-s</code> オプションと一緒に使われた場合は、 印字終了後に削除されます。 このオプションの使用には十分注意して下さい。</p></dd></dl></div></div><div class=sect3><h4 id=printing-lpr-options-misc>9.5.4.3. ヘッダページ用オプション<a class=anchor href=#printing-lpr-options-misc></a></h4><div class=paragraph><p>以下のオプションにより、 ジョブのヘッダページに通常印字さ れるテキストを <a href="https://man.freebsd.org/cgi/man.cgi?query=lpr&amp;sektion=1&amp;format=html">lpr(1)</a> に調整させることができます。 対象のプリンタからヘッダページが出力されない場合は、 これらのオプションは何の効力も持ちません。 ヘッダページの設定に関する情報については、 「<a href=#printing-advanced-header-pages>ヘッダページ</a>」を参照してください。</p></div><div class=dlist><dl><dt class=hdlist1>-C <em>text</em></dt><dd><p>ヘッダページに印字されるホスト名を <em>text</em> に置き換えます。なお、 ホスト名の場所には、通常、 ジョブの要求があったホストの名前が印字されます。</p></dd><dt class=hdlist1>-J <em>text</em></dt><dd><p>ヘッダページに印字されるジョブ名を <em>text</em> に置き換えます。 ジョブ名の場所には、通常、ジョブの最初のファイル名、 または、標準入力からデータが印字されたときは <span class=filename>stdin</span> が印字されます。</p></dd><dt class=hdlist1>-h</dt><dd><p>ヘッダページの出力を禁止します。</p><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>サイトによっては、 そのヘッダページの生成方法により、 このオプションの効果が現れないかもしれません。 詳細は、「<a href=#printing-advanced-header-pages>ヘッダページ</a>」をご覧ください。</p></div></td></tr></tbody></table></div></dd></dl></div></div></div><div class=sect2><h3 id=printing-lpc>9.5.5. プリンタの管理<a class=anchor href=#printing-lpc></a></h3><div class=paragraph><p>プリンタの管理者として、プリンタの設置、設定、 そして、それらのテストをおこなう必要がありました。 <a href="https://man.freebsd.org/cgi/man.cgi?query=lpc&amp;sektion=8&amp;format=html">lpc(8)</a> コマンドにより、 これまでとは別な管理方法がプリンタと対話的におこなわれます。 <a href="https://man.freebsd.org/cgi/man.cgi?query=lpc&amp;sektion=8&amp;format=html">lpc(8)</a> により、次のことが可能となります。</p></div><div class=ulist><ul><li><p>プリンタの起動、停止をおこなう。</p></li><li><p>キューへの入力の許可、禁止をおこなう。</p></li><li><p>それぞれのキューにあるジョブの順番を変更する。</p></li></ul></div><div class=paragraph><p>最初に用語に関する注意をしておきます。 プリンタが<em>停止している</em>とは、 キューの中にあるどのジョブも印字されることがない状態 を言います。この状態においても、 ユーザはまだジョブの要求をおこなうことができますが、 これらのジョブはキューの中で、 プリンタが<em>スタートする</em>状態になるまで、 あるいは、キューの内容が削除されるまで待たされることになります。</p></div><div class=paragraph><p>キューが<em>禁止状態</em>にあると、 (<code>root</code> 以外の) すべてのユーザがプリンタにジョブを要求することができません。 キューが<em>許可状態にある</em>場合は、 ジョブの入力が許可されます。 キューが<em>禁止状態にある</em>場合でも、 プリンタを<em>スタートす る</em>状態にすることは可能です。この場合は、 キューが空になるまで、 キュー内のジョブの印字が続けられます。</p></div><div class=paragraph><p>一般的に、<a href="https://man.freebsd.org/cgi/man.cgi?query=lpc&amp;sektion=8&amp;format=html">lpc(8)</a> コマンドを使用するには <code>root</code> 権限を持っている必要があります。 一般のユーザも <a href="https://man.freebsd.org/cgi/man.cgi?query=lpc&amp;sektion=8&amp;format=html">lpc(8)</a> コマンドを使うことはできますが、 プリンタの状態を取得することとハングしたプリンタ を再スタートすることだけに使用が制限されています。</p></div><div class=paragraph><p>以下に、 <a href="https://man.freebsd.org/cgi/man.cgi?query=lpc&amp;sektion=8&amp;format=html">lpc(8)</a> コマンドに関する説明の要約を述べます。 ほとんどのコマンドでは、操作対象となるプリンタを指定するため <em>printer-name</em> 引数を与えます。 <em>printer-name</em> の代わりに <code>all</code> が与えられると、操作は <span class=filename>/etc/printcap</span> 内にある全プリンタに対しておこなわれることになります。</p></div><div class=dlist><dl><dt class=hdlist1><code>abort printer-name</code></dt><dd><p>現在のジョブをキャンセルし、プリンタを停止させます。 キューが許可状態にある場合は、 ユーザはまだジョブを入力することができます。</p></dd><dt class=hdlist1><code>clean printer-name</code></dt><dd><p>プリンタのスプーリングディレクトリから、 ジョブの古いファイルを削除します。状況によって、 とりわけ、印字途中でエラーが発生していたり、 管理操作が頻発していた場合には、 ジョブで作られたファイルを LPD が完全に削除しないことがあります。このコマンドでは、 スプーリングディレクトリに入っていないファイルを見つけ出し、 それを削除しています。</p></dd><dt class=hdlist1><code>disable printer-name</code></dt><dd><p>キューに新しいジョブを入れることを禁止します。 プリンタが動作しているときは、 キューに残っているジョブの印字は続けられます。ただし、 キューが禁止状態にあったとしても、スーパーユーザ (<code>root</code>) は常にジョブを入力することができます。</p><div class=paragraph><p>このコマンドは、 新しいプリンタやフィルタを設置している間に使用すると有用です。 すなわち、キューを禁止状態にしておくと、 <code>root</code> によるジョブのみが入力されます。 そして、他のユーザは、テストが完了し、 <code>enable</code> コマンドでキューが再度許可状態になるまで、 ジョブの入力はできなくなります。</p></div></dd><dt class=hdlist1><code>down printer-name message</code></dt><dd><p>プリンタをダウンさせます。これは、 <code>disable</code> をおこなった後で、 <code>stop</code> をおこなった場合と等価になります。 <em>message</em> は、ユーザが <a href="https://man.freebsd.org/cgi/man.cgi?query=lpq&amp;sektion=1&amp;format=html">lpq(1)</a> コマンドでプリンタのキューの状態を調べたり、 <code>lpc status</code> でプリンタの状態を調べたときに、 プリンタの状況として表示されるメッセージです。</p></dd><dt class=hdlist1><code>enable printer-name</code></dt><dd><p>プリンタのキューを許可状態にします。 ユーザはジョブの入力ができるようになりますが、 プリンタがスタートの状態になるまでは、 プリンタからは何も印字されません。</p></dd><dt class=hdlist1><code>help command-name</code></dt><dd><p><em>command-name</em> コマンドのヘルプメッセージを表示します。 <em>command-name</em> が指定されなかった場合は、 利用できるコマンドの要約が表示されます。</p></dd><dt class=hdlist1><code>restart printer-name</code></dt><dd><p>プリンタをスタートさせます。通常のユーザは、 LPD がある異常な状況でハングしたときに限り、 このコマンドを使用することができます。しかし、 <code>stop</code> または <code>down</code> コマンドにより、 停止状態にあるプリンタをスタートさせることはできません。 <code>restart</code> コマンドは、 <code>abort</code> の後に <code>start</code> をおこなったことと同じになります。</p></dd><dt class=hdlist1><code>start printer-name</code></dt><dd><p>プリンタをスタートさせます。 プリンタのキューにあるジョブを印字することでしょう。</p></dd><dt class=hdlist1><code>stop printer-name</code></dt><dd><p>プリンタを停止します。プリンタは、 現在のジョブを終了させ、そして、 キューにあるその他のジョブは印字しません。 プリンタが停止状態にあったとしても、まだ、 許可状態にあるキューに対して、ジョブを送ることができます。</p></dd><dt class=hdlist1><code>topq printer-name job-or-username</code></dt><dd><p><em>printer-name</em> のキューに対して、ジョブ番号 <em>job</em> のジョブ、または、ユーザ <em>username</em> から送られたジョブを置き換えて、キューの先頭に持ってきます。 このコマンドに関しては、 <em>printer-name</em> の代わりに <code>all</code> を使用することはできません。</p></dd><dt class=hdlist1><code>up printer-name</code></dt><dd><p>プリンタをアップ状態にします。これの反対のコマンドが <code>down</code> です。<code>start</code> の次に <code>enable</code> をおこなったことと等しくなります。</p></dd></dl></div><div class=paragraph><p>コマンドラインから上記のコマンドを入力すると、 <a href="https://man.freebsd.org/cgi/man.cgi?query=lpc&amp;sektion=8&amp;format=html">lpc(8)</a> はこれを受け付けます。コマンドが入力されなかった場合は、 <a href="https://man.freebsd.org/cgi/man.cgi?query=lpc&amp;sektion=8&amp;format=html">lpc(8)</a> は対話モードに入り、 <code>exit</code>、<code>quit</code>、 または、 ファイル終端文字が入力されるまでコマンドの入力ができます。</p></div></div></div></div><div class=sect1><h2 id=printing-lpd-alternatives>9.6. 標準スプーラの代替品<a class=anchor href=#printing-lpd-alternatives></a></h2><div class=sectionbody><div class=paragraph><p>このマニュアルを最初から通読されている方ならば、ここまでで、 FreeBSD 付属の LPD スプーリングシステムに関して知っておくべきことすべてを学ばれたことと思います。 多分、このシステムにあるたくさんの欠点について認識できたことでしょう。 そこから "(FreeBSD 上で動作する) スプーリングシステムには他にどのようなものがあるのか" という疑問が自然と湧いてきます。</p></div><div class=dlist><dl><dt class=hdlist1>LPRng</dt><dd><p>"次世代 LPR" を称するLPRng は、 PLP を完全に書き換えたものです。 Patrick Powell と Justin Mason (PLP の主要な管理者) が共同で LPRng を作成しました。 LPRng の本サイトは <a href=http://www.lprng.org/>http://www.lprng.org/</a> です。</p></dd><dt class=hdlist1>CUPS</dt><dd><p>CUPS (the Common UNIX Printing System) は、UNIX® ベースのオペレーティングシステムに対して、 移植性の高い印刷レイヤを提供します。 CUPS は Easy Software Products によって、すべての UNIX® ベンダとユーザに、 標準的な印刷ソリューションを普及するために開発されています。</p><div class=paragraph><p>CUPS は、プリントジョブとキューを管理する基盤として Internet Printing Protocol (IPP) を使っています。機能は限定されますが、 ラインプリンタデーモン (LPD)、 サーバーメッセージブロック　(SMB) や AppSocket (JetDirect とも呼ばれています) プロトコルにも対応しています。 CUPS は、UNIX® に現実的なプリント機能を備えるため、 ネットワークプリンタの検索、 PostScript プリンタ記述言語 (PPD) に基づいた印刷オプションを追加します。</p></div><div class=paragraph><p>CUPS のメインサイトは <a href=http://www.cups.org/>http://www.cups.org/</a> です</p></div></dd><dt class=hdlist1>HPLIP</dt><dd><p>HPLIP (the HP Linux® Imaging and Printing system) は、 HP アプライアンス用に HP が開発した、 プリンタ、スキャナ、ファックスへの対応のためのプログラム群です。 このプログラムでは、印刷機能において CUPS 印刷システムをバックエンドとして利用しています。</p><div class=paragraph><p>HPLIP のメインサイトは、 <a href=http://hplipopensource.com/hplip-web/index.html>http://hplipopensource.com/hplip-web/index.html</a> です。</p></div></dd></dl></div></div></div><div class=sect1><h2 id=printing-troubleshooting>9.7. トラブルシューティング<a class=anchor href=#printing-troubleshooting></a></h2><div class=sectionbody><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=lptest&amp;sektion=1&amp;format=html">lptest(1)</a> を使った簡単なテストをおこなった結果、 正しい出 力を得られずに、以下に示すような出力が得られるかもしれません。</p></div><div class=dlist><dl><dt class=hdlist1>しばらくしたら出力される、または、 紙の全体が出てこない</dt><dd><p>プリンタは上で示されたような印字を おこなったのですが、しばらくして止まってしまい、 動かなくなってしまいました。 印字された結果をプリンタから取り出すためには、 プリンタにある PRINT REMAINING ボタン、または、FORM FEED ボタンを押す必要があるようです。</p><div class=paragraph><p>この場合は、 おそらくジョブはプリントをする前に 更にデータが送られてこないか待ち続けているのでしょう。 この問題を解決するためには、プリンタに FORM FEED 文字 (あるいは特定の必要な文字コード) を 送るテキストフィルタを使ってください。 プリンタ内部に残ったデータをプリンタにすぐに印字させるには、 普通はこれで十分です。 次のジョブが前のジョブの最終ページの中央の どこかから印字を開始させないためにも、 紙の途中で印字のジョブが終了したかどうかを確認するのは有益です。</p></div><div class=paragraph><p>シェルスクリプト <span class=filename>/usr/local/libexec/if-simple</span> を次のように変更して、プリンタへジョブを送信した後に FORM FEED 文字を印字させるようにします。</p></div><div class="literalblock programlisting"><div class=content><pre>#!/bin/sh
#
# if-simple - Simple text input filter for lpd
# Installed in /usr/local/libexec/if-simple
#
# Simply copies stdin to stdout.  Ignores all filter arguments.
# Writes a form feed character (\f) after printing job.

/bin/cat &amp;&amp; printf &#34;\f&#34; &amp;&amp; exit 0
exit 2</pre></div></div></dd><dt class=hdlist1>"階段効果" が現れた</dt><dd><p>出力された紙には次のように印字されていました。</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=o>!</span><span class=s2>&#34;#</span><span class=nv>$%</span><span class=s2>&amp;&#39;()*+,-./01234
                 &#34;</span><span class=c>#$%&amp;&#39;()*+,-./012345</span>
                                 <span class=c>#$%&amp;&#39;()*+,-./0123456</span></code></pre></div></div><div class=paragraph><p>あなたは<em>「階段効果」</em> の新たなる犠牲者になってしまいました。この原因は、 改行を表わすべき文字がなんであるか の解釈が混乱していることにあります。UNIX® スタイルのオペレーティングシステムでは、改行文字は ASCII コード 10 の line feed (LF) の 1 文字が使われています。MS-DOS® や OS/2® などは ASCII コード 10の LF <em>と</em>、ASCII コード 13 の文字 (carriage return または CR) をペアで使います (訳注: Macintosh では CR のみで表現されています)。大抵のプリンタでは、 改行を表わすために MS-DOS® の慣習にしたがいます。</p></div><div class=paragraph><p>FreeBSD で印字する場合、印字したテキストは LF 文字だけ が使われていました。プリンタでは LF 文字を見つけると、紙を 1 行分送り出しました。しかし、 次の文字を印字するた めの紙の水平方向の位置は維持されました。すなわち、CR 文字が意味することは、 次の文字を印字する位置を紙の左端に動かすことです。</p></div><div class=paragraph><p>FreeBSD がプリンタに動作をして欲しいと思っている動作を以下に示します。</p></div><table class="tableblock frame-none grid-all stretch informaltable"><col style=width:50%><col style=width:50%><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock>プリンタが CR を受け取ったとき</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>CR 動作 (復帰) をおこなう</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>プリンタが LF を受け取ったとき</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>CR + LF 動作 (復帰、改行) をおこなう</p></td></tr></tbody></table><div class=paragraph><p>このように動作させるための方法がいくつかあります。</p></div><div class=ulist><ul><li><p>これらの文字の解釈を変えるために、 プリンタの設定スイッチかコントロールパネルを操作する方法。 どのようにして設定をするかはプリンタのマニュアルを参照してください。</p><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>FreeBSD 以外のオペレーティングシステムを切り替えて使う場合、 CR と LF 文字の解釈をそのオペレーティングシステムで使われているようにプリンタを <em>再設定</em>する必要があるかもしれません。 以下に示す解決方法のいずれかを 選ぶのがよいかもしれませんね。</p></div></td></tr></tbody></table></div></li><li><p>自動的に LF を CR+LF に変換してくれる FreeBSD 用のシリアルドライバを入手する方法。 もちろん、このドライバはプリンタ専用に接続される シリアルポート <em>のみ</em>で動作します。 この機能を許可するためには、 <code>ms#</code> 項目を使い、 対象プリンタの <span class=filename>/etc/printcap</span> ファイルで<code>onlcr</code> モードを設定します。</p></li><li><p>LF 文字の扱いを一時的に変更するための <em>エスケープコード</em> をプリンタに送る方法。 プリンタがサポートしているかもしれないエスケープコード については、 プリンタのマニュアルを参照してください。 適切なエスケープコードが見つかったら、 最初にそのコードを送り、次にプリントジョブを送信 するようにテキストフィルタを変更してください。</p><div class=paragraph><p>次に、Hewlett Packard 社の PCL エスケープコードに対応しているプリンタのための テキストフィルタの例を示します。 このフィルタでは、プリンタ に LF 文字を LF と CR の2文字として扱わせます。 その後に、プリンタにジョブを送ります。最後に、 ジョブの最終ページの紙を排出するため、FROM FEED 文字を送ります。このフィルタは Hewlett Packard 社のほとんどすべてのプリンタで機能するはずです。</p></div><div class="literalblock programlisting"><div class=content><pre>#!/bin/sh
#
# hpif - Simple text input filter for lpd for HP-PCL based printers
# Installed in /usr/local/libexec/hpif
#
# Simply copies stdin to stdout.  Ignores all filter arguments.
# Tells printer to treat LF as CR+LF.  Ejects the page when done.

printf &#34;\033&amp;k2G&#34; &amp;&amp; cat &amp;&amp; printf &#34;\f&#34; &amp;&amp; exit 0
exit 2</pre></div></div><div class=paragraph><p>ホスト <code>orchid</code> の <span class=filename>/etc/printcap</span> の例を以下に示します。ここには、 一番目のパラレルポートにプリンタ (Hewlett Packard LaserJet 3Si) が一台接続されており、そのプリンタ名は <code>teak</code> です。</p></div><div class="literalblock programlisting"><div class=content><pre>#
#  /etc/printcap for host orchid
#
teak|hp|laserjet|Hewlett Packard LaserJet 3Si:\
        :lp=/dev/lpt0:sh:sd=/var/spool/lpd/teak:mx#0:\
        :if=/usr/local/libexec/hpif:</pre></div></div></li></ul></div></dd></dl></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>LF を CR+LF に置き換える cat コマンドを作る方法も当然考えられます。 そして、このコマンドと、<em>if-simple</em> の cat の部分を置き換えればよいわけです。 具体的にどのようにするかは、 読者への練習問題としましょう。</p></div></td></tr></tbody></table></div><div class=dlist><dl><dt class=hdlist1>各行が重ね書きされてしまった</dt><dd><p>プリンタは紙送りをまったくしませんでした。 テキストすべての行がある行の上で重ねて印字されてしまいました。</p><div class=paragraph><p>この問題は、 階段現象とは "正反対" な問題で、 ほとんどまれにしか起こりません。FreeBSD では行末として扱われる LF 文字が、紙の左端に印字位置を復帰しますが、 紙送りはしない CR 文字として扱われています。</p></div><div class=paragraph><p>プリンタの設定スイッチかコントロールパネルを使って、 LF と CR の文字を次のような解釈をするようにしてください。</p></div><table class="tableblock frame-none grid-all stretch informaltable"><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">プリンタが受け取ったとき</th><th class="tableblock halign-left valign-top">プリンタがおこなう</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock>CR</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>CR 動作 (復帰)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>LF</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>CR + LF (復帰、改行)</p></td></tr></tbody></table><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>LF を CR+LF に置き換える cat コマンドを作る方法も当然考えられます。 そして、このコマンドと、 <span class=filename>if-simple</span> の cat の部分を置き換えればよいわけです。 具体的にどのようにするかは、 読者への練習問題としましょう。</p></div></td></tr></tbody></table></div></dd><dt class=hdlist1>プリンタが文字を紛失してしまう</dt><dd><p>印字しているのですが、 各行の 2 ～ 3 文字が印字されません。 プリンタを動かせば動かすほど、 もっとたくさんの文字が紛失されていき、 この問題は更に悪くなっていくかもしれませんでした。</p><div class=paragraph><p>この問題は、 シリアルポートを通してコンピュータから送られてくるデータの速度に、 プリンタがついていけないことに起因します (この問題は、パラレルポートに接続された プリンタでは発生することはありません)。 この問題を克服する方法が2つあります。</p></div><div class=ulist><ul><li><p>プリンタが XON/XOFF のフロー制御をサポート している場合は、項目 <code>ms#</code> で <code>ixon</code> モードをセットして、FreeBSD にこの機能を使用させてください。</p></li><li><p>プリンタが Request to Send / Clear to Send ハードウェアハンドシェイク (通称 <code>RTS/CTS</code>) をサポートして いる場合は、項目 <code>ms#</code> で <code>crtscts</code> モードをセットして下さい。それから、 プリンタとコンピュータを接続しているシリアルケーブルが ハードウェアフロー制御用に正しく配線されたものかどうかを確認してください。</p></li></ul></div></dd><dt class=hdlist1>プリンタは意味不明な文字列を印字した</dt><dd><p>プリンタはランダムなゴミのように 見えるものを印字しましたが、 意図したテキストは印字してくれませんでした。</p><div class=paragraph><p>この問題は、通常、 シリアルポートに接続したプリンタでの 通信パラメータの誤りからくる前項とは別の症状です。 <code>br</code> 項目の通信速度と <code>ms#</code> 項目を再確認してください。 また、プリンタでの設定が <span class=filename>/etc/printcap</span> ファイルで設定した 内容と一致しているかどうかも確認してください。</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>simple-if のような単純なフィルタだけの状態で、 日本語を含むテキストを印字しようとした場合にも、 シリアルポート、パラレルポートの使用に関係なく、 このような症状は見られます。日本語プリンタの場合、 漢字コードそのもの を送信しただけでその漢字を印字してくれるものは、 少なくとも訳者は見たことがありません。 漢字を印字するための制御 コードを別途送信するフィルタが必要となります。 また、そのようなフィルタを使用していても、 そのフィルタが想定してる漢字コードと異なった文書を プリントしようとしたときもこのような症状は出ます。 もちろん、これはプリンタ用の 言語を持たないプリンタの話で、PostScript® プリンタ などにプレインテキストを送信しても、日本語対応、 非対応に関らず、意味不明な文字列が印字される (もしくは、何も印字されない) ことでしょう。</p></div></td></tr></tbody></table></div></dd><dt class=hdlist1>何も起きない</dt><dd><p>もしプリンタが何の動作もしないのであれば、 ハード的な問題ではなく、多分 FreeBSD の中に問題があります。 <span class=filename>/etc/printcap</span> ファイルで、 デバッグしているプリンタのエントリに (<code>lf</code> 項目で) ログファイルを取るように 設定を追加してください。たとえば、プリンタ <code>rattan</code> 用のエントリの項目 <code>lf</code> は次のようになります。</p><div class="literalblock programlisting"><div class=content><pre>rattan|line|diablo|lp|Diablo 630 Line Printer:\
        :sh:sd=/var/spool/lpd/rattan:\
        :lp=/dev/lpt0:\
        :if=/usr/local/libexec/if-simple:\
        :lf=/var/log/rattan.log</pre></div></div><div class=paragraph><p>次に、もう一度印字をおこなってみます。そして、 発生したと思われるエラーメッセージを見るためにログファイル (上記の例では、 <span class=filename>/var/log/rattan.log</span>) を調べます。そこで見られたメッセージを元に、 問題を解決してみてください。</p></div><div class=paragraph><p>項目 <code>lf</code> が指定されていない場合、LPD はデフォルトのログファイルとして <span class=filename>/dev/console</span> を使います。</p></div></dd></dl></div></div></div></div><hr><div class=last-modified><p><strong>最終更新日</strong>: 2024年3月9日 by <a href="https://cgit.freebsd.org/doc/commit/?id=6199af92e7" target=_blank>Danilo G. Baio</a></p></div><div class=buttons><div class=prev><i class="fa fa-angle-left" aria-hidden=true title=Prev></i><div class=container><a href=https://docs.freebsd.org/ja/books/handbook/kernelconfig class=direction>Prev</a></div></div><div class=home><i class="fa fa-home" aria-hidden=true title=Home></i><div class=container><a href=../ class=direction>Home</a></div></div><div class=next><div class=container><a href=https://docs.freebsd.org/ja/books/handbook/linuxemu class=direction>Next</a></div><i class="fa fa-angle-right" aria-hidden=true title=Next></i></div></div><label class="hidden book-menu-overlay" for=menu-control></label></div><aside class=toc><div class=toc-content><h3>目次</h3><nav id=TableOfContents><ul><li><a href=#printing-synopsis>9.1. この章では</a></li><li><a href=#printing-intro-spooler>9.2. はじめに</a></li><li><a href=#printing-intro-setup>9.3. 基本的な設定</a></li><li><a href=#printing-advanced>9.4. プリンタ設定上級編</a></li><li><a href=#printing-using>9.5. プリンタを使う</a></li><li><a href=#printing-lpd-alternatives>9.6. 標準スプーラの代替品</a></li><li><a href=#printing-troubleshooting>9.7. トラブルシューティング</a></li></ul></nav><hr><div class=resources><h3>リソース</h3><ul class=contents><li><i class="fa fa-file-pdf-o" aria-hidden=true title="PDF 版のダウンロード"></i><a href=https://download.freebsd.org/doc/ja/books/handbook/handbook_ja.pdf>PDF 版のダウンロード</a></li><li><i class="fa fa-pencil-square-o" aria-hidden=true title="Edit this page"></i><a href=https://github.com/freebsd/freebsd-doc/blob/main/documentation/content/ja/_index target=_blank>Edit this page</a></li></ul></div></div></aside><a class=to-top href=#top><i class="fa fa-arrow-circle-up" aria-hidden=true></i></a></main><footer><div class=footer-container><section class=logo-column><img src=https://docs.freebsd.org/images/FreeBSD-colors.svg width=160 height=50 alt="FreeBSD logo"><div class=options-container><div class=language-container><a id=languages href=https://docs.freebsd.org/ja/languages><img src=https://docs.freebsd.org/images/language.png class=language-image alt="Choose language">
<span>日本語</span></a></div><div class=theme-container><select id=theme-chooser><option value=theme-system>System</option><option value=theme-light>Light</option><option value=theme-dark>Dark</option><option value=theme-high-contrast>High contrast</option></select></div></div></section><section class=about-column><h3 class=column-title>About</h3><ul class=column-elements-container><li><a href=https://www.freebsd.org/about/ target=_blank class=column-element>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/ target=_blank class=column-element>FreeBSD Foundation</a></li><li><a href=https://www.freebsd.org/where/ target=_blank class=column-element>Get FreeBSD</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct target=_blank class=column-element>Code of Conduct</a></li><li><a href=https://www.freebsd.org/security/ target=_blank class=column-element>Security Advisories</a></li></ul></section><section class=documentation-column><h3 class=column-title>Documentation</h3><ul class=column-elements-container><li><a href=/ja class=column-element>Documentation portal</a></li><li><a href=https://man.FreeBSD.org target=_blank class=column-element>Manual pages</a></li><li><a href=https://papers.FreeBSD.org target=_blank class=column-element>Presentations and papers</a></li><li><a href=https://docs-archive.freebsd.org/doc/ target=_blank class=column-element>Previous versions</a></li><li><a href=https://docs-archive.freebsd.org/44doc/ target=_blank class=column-element>4.4BSD Documents</a></li><li><a href=https://wiki.freebsd.org/ target=_blank class=column-element>Wiki</a></li></ul></section><section class=community-column><h3 class=column-title>Community</h3><ul class=column-elements-container><li><a href=https://docs.freebsd.org/ja/articles/contributing class=column-element>Get involved</a></li><li><a href=https://forums.freebsd.org/ target=_blank class=column-element>Community forum</a></li><li><a href=https://lists.freebsd.org/ target=_blank class=column-element>Mailing lists</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank class=column-element>IRC Channels</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank class=column-element>Bug Tracker</a></li></ul></section><section class=legal-column><h3 class=column-title>Legal</h3><ul class=column-elements-container><li><a href=https://freebsdfoundation.org/donate/ target=_blank class=column-element>Donations</a></li><li><a href=https://www.freebsd.org/copyright/freebsd-license/ target=_blank class=column-element>Licensing</a></li><li><a href=https://www.freebsd.org/privacy/ target=_blank class=column-element>Privacy Policy</a></li><li><a href=https://www.freebsd.org/copyright/ target=_blank class=column-element>Legal notices</a></li></ul></section><section class=copyright-column><p>&copy; 1994-2024 The FreeBSD Project. All rights reserved</p><span>Made with <span class=heart>♥</span> by the FreeBSD Community</span></section></div></footer></body></html>