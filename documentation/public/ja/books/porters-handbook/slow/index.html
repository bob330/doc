<!doctype html><html class=theme-light lang=ja><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content><meta name=copyright content="1995-2024 The FreeBSD Foundation"><link rel=canonical href=http://172.16.201.134:1313/ja/books/porters-handbook/slow/><title>第4章 本格的な port | FreeBSD Documentation Portal</title>
<meta name=theme-color content="#790000"><meta name=color-scheme content="system light dark high-contrast"><link rel="shortcut icon" href=http://172.16.201.134:1313/favicon.ico><link rel=stylesheet href=http://172.16.201.134:1313/styles/main.min.css><link rel=stylesheet href=http://172.16.201.134:1313/css/font-awesome-min.css><script defer src=/js/theme-chooser.min.js></script><script defer src=/js/copy-clipboard.min.js></script><script defer src=/js/search.min.js></script><meta name=twitter:card content="summary"><meta name=twitter:domain content="docs.FreeBSD.org"><meta name=twitter:site content="@freebsd"><meta name=twitter:url content="https://twitter.com/freebsd"><meta property="og:title" content="第4章 本格的な port"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:image" content="http://172.16.201.134:1313/favicon.ico"><meta property="og:image:alt" content="FreeBSD Logo"><meta property="og:locale" content="ja"><meta property="og:url" content="http://172.16.201.134:1313/ja/books/porters-handbook/slow/"><meta property="og:site_name" content="FreeBSD Documentation Portal"><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","url":"http:\/\/172.16.201.134:1313\/ja\/books\/porters-handbook\/slow\/","name":"FreeBSD Documentation Portal","headline":"FreeBSD Documentation Portal","description":"FreeBSD Documentation Portal"}</script></head><body><header><div class=header-container><div class=logo-menu-bars-container><a href=https://www.FreeBSD.org class=logo><img src=http://172.16.201.134:1313/images/FreeBSD-monochromatic.svg width=160 height=50 alt="FreeBSD logo">
</a><label class=menu-bars for=menu-bars><i class="fa fa-bars" aria-hidden=true></i></label></div><input id=menu-bars type=checkbox><nav><ul class=menu><li class=menu-item><input id=about type=checkbox>
<a href=# aria-label="Navigate to About section"><label class=menu-item-description for=about>About
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/about/ target=_blank>About</a></li><li><a href=https://www.freebsd.org/about/ target=_blank>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/about-us/about-the-foundation/ target=_blank>FreeBSD Foundation</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct/ target=_blank>Code of Conduct</a></li></ul></li><li class=menu-item><input id=download type=checkbox>
<a href=# aria-label="Navigate to get FreeBSD section"><label class=menu-item-description for=download>Get FreeBSD
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/where/ target=_blank>Get FreeBSD</a></li><li><a href=https://www.freebsd.org/releases/ target=_blank>Release Information</a></li><li><a href=https://www.freebsd.org/releng/ target=_blank>Release Engineering</a></li><li><a href=https://www.freebsd.org/security/ target=_blank>Security Advisories</a></li></ul></li><li class=menu-item><input id=documentation type=checkbox>
<a href=# aria-label="Navigate to get Documentation section"><label class=menu-item-description for=documentation>Documentation
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=/ja>Documentation portal</a></li><li><a href=http://172.16.201.134:1313/ja/books/handbook>FreeBSD Handbook</a></li><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook>Porter's Handbook</a></li><li><a href=https://docs.FreeBSD.org/en/books/fdp-primer>Documentation Project Handbook</a></li><li><a href=https://man.FreeBSD.org target=_blank>Manual pages</a></li><li><a href=https://papers.FreeBSD.org target=_blank>Presentations and papers</a></li><li><a href=https://wiki.FreeBSD.org target=_blank>Wiki</a></li><li><a href=http://172.16.201.134:1313/ja/books>Books</a></li><li><a href=http://172.16.201.134:1313/ja/articles>Articles</a></li></ul></li><li class=menu-item><input id=community type=checkbox>
<a href=# aria-label="Navigate to get Community section"><label class=menu-item-description for=community>Community
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/community/>Community</a></li><li><a href=http://172.16.201.134:1313/ja/articles/contributing>Get involved</a></li><li><a href=https://forums.freebsd.org/ target=_blank>Forum</a></li><li><a href=https://lists.freebsd.org/ target=_blank>Mailing lists</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank>IRC Channels</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank>Bug Tracker</a></li><li><a href=https://www.freebsd.org/support/ target=_blank>Support</a></li></ul></li></ul></nav><div class=search-donate-container><form class=search method=get id=search-header-form action=https://docs.freebsd.org/search name=search-header-form><input type=hidden name=DB value=ja>
<input id=words name=P type=text size=20 maxlength=255>
<button>
<i class="fa fa-search" aria-hidden=true></i></button></form><div class=donate><a href=https://freebsdfoundation.org/donate/ target=_blank><span class=heart>♥</span>
Donate</a></div></div></div></header><input type=checkbox class="hidden toggle" id=menu-control><main class=main-wrapper-book><a id=top></a><aside class=book-menu><div class=book-menu-content><input id=search-book type=text placeholder=Search aria-label=Search maxlength=128><nav id=MenuContents><ul><li><input type=checkbox id=chapter-89897b13690206c8d016b08d866ebe49 class=toggle>
<label for=chapter-89897b13690206c8d016b08d866ebe49><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/porters-handbook/why-port/>第1章 はじめに</a></li><li><input type=checkbox id=chapter-6619d34d40746c4cdcc07a792381c027 class=toggle>
<label for=chapter-6619d34d40746c4cdcc07a792381c027><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/porters-handbook/own-port/>第2章 自分で port を作成するには</a></li><li><input type=checkbox id=chapter-c0d52b9121b517084e01f59cefa725e1 class=toggle>
<label class="icon cursor" for=chapter-c0d52b9121b517084e01f59cefa725e1><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/porters-handbook/quick-porting/>第3章 3 分間 porting</a><ul><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/quick-porting/#porting-makefile>3.1. <span class=filename>Makefile</span> の作成</a></li><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/quick-porting/#porting-desc>3.2. package 記述ファイルの作成</a></li><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/quick-porting/#porting-checksum>3.3. チェックサムファイルの作成</a></li><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/quick-porting/#porting-testing>3.4. port のテスト</a></li><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/quick-porting/#porting-portlint>3.5. <code>portlint</code> によるチェック</a></li><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/quick-porting/#porting-submitting>3.6. port の提出</a></li></ul></li><li><input type=checkbox id=chapter-78c64b7f0aa40d4648859dde83f4ee13 class=toggle checked>
<label class="icon cursor" for=chapter-78c64b7f0aa40d4648859dde83f4ee13><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/porters-handbook/slow/>第4章 本格的な port</a><ul><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/slow/#slow-work>4.1. port 構築の詳細</a></li><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/slow/#slow-sources>4.2. オリジナルのソースの入手</a></li><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/slow/#slow-modifying>4.3. port の修正</a></li><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/slow/#slow-patch>4.4. パッチの適用</a></li><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/slow/#slow-configure>4.5. コンフィグレーション</a></li><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/slow/#slow-user-input>4.6. ユーザからの入力の扱い</a></li></ul></li><li><input type=checkbox id=chapter-869403c3f74bf6ec89e800963596e31a class=toggle>
<label class="icon cursor" for=chapter-869403c3f74bf6ec89e800963596e31a><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/porters-handbook/makefile/>第5章 Makefile の作成</a><ul><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/makefile/#makefile-source>5.1. オリジナルのソース</a></li><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/makefile/#makefile-naming>5.2. 名前の付け方</a></li><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/makefile/#makefile-categories>5.3. カテゴリ分類</a></li><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/makefile/#makefile-distfiles>5.4. 配布ファイル</a></li><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/makefile/#makefile-maintainer>5.5. <code>MAINTAINER</code></a></li><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/makefile/#makefile-comment>5.6. <code>COMMENT</code></a></li><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/makefile/#makefile-depend>5.7. 依存関係</a></li><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/makefile/#makefile-wrkdir>5.8. 作業ディレクトリの指定</a></li><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/makefile/#conflicts>5.9. <code>CONFLICTS</code></a></li><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/makefile/#makefile-build>5.10. ビルドのメカニズム</a></li></ul></li><li><input type=checkbox id=chapter-19e3150e00beb84341d8ac1a73936ef0 class=toggle>
<label class="icon cursor" for=chapter-19e3150e00beb84341d8ac1a73936ef0><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/porters-handbook/special/>第6章 特別な配慮</a><ul><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/special/#porting-shlibs>6.1. 共有ライブラリ</a></li><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/special/#porting-restrictions>6.2. 配布制限がある ports</a></li><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/special/#using-perl>6.3. <code>perl</code> の利用</a></li><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/special/#using-x11>6.4. X11 の利用</a></li><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/special/#using-automake>6.5. <code>automake</code>, <code>autoconf</code> および <code>libtool</code> の利用</a></li><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/special/#using-gnome>6.6. GNOME の利用</a></li><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/special/#using-kde>6.7. KDE の利用</a></li><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/special/#using-bison>6.8. Bison の利用</a></li><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/special/#using-java>6.9. Java の利用</a></li><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/special/#using-python>6.10. Python の利用</a></li><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/special/#using-emacs>6.11. Emacs の利用</a></li><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/special/#using-ruby>6.12. Ruby の利用</a></li><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/special/#using-sdl>6.13. SDL の利用</a></li></ul></li><li><input type=checkbox id=chapter-cfdd4a61297a40347b44190bffb9e967 class=toggle>
<label for=chapter-cfdd4a61297a40347b44190bffb9e967><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/porters-handbook/porting-masterdir/>第7章 MASTERDIR</a></li><li><input type=checkbox id=chapter-22e9c415e2790a95b60e5aa0ef1a0965 class=toggle>
<label for=chapter-22e9c415e2790a95b60e5aa0ef1a0965><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/porters-handbook/shared/>第8章 共有ライブラリのバージョン</a></li><li><input type=checkbox id=chapter-0e9c6b3c9458983885b31acab2f13136 class=toggle>
<label for=chapter-0e9c6b3c9458983885b31acab2f13136><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/porters-handbook/porting-manpages/>第9章 マニュアルページ</a></li><li><input type=checkbox id=chapter-272fb4ef4cb19464343707eeb40986f2 class=toggle>
<label class="icon cursor" for=chapter-272fb4ef4cb19464343707eeb40986f2><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/porters-handbook/porting-motif/>第10章 Motif を必要とする port</a><ul><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/porting-motif/#motif-use>10.1. <code>USE_MOTIF</code></a></li><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/porting-motif/#motif-lib>10.2. <code>MOTIFLIB</code></a></li></ul></li><li><input type=checkbox id=chapter-045fe63771cd111bb783b4fa7409a860 class=toggle>
<label for=chapter-045fe63771cd111bb783b4fa7409a860><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/porters-handbook/x11-fonts/>第11章 X11 のフォント</a></li><li><input type=checkbox id=chapter-314ea4400f3f871d3e726d940cef30c0 class=toggle>
<label for=chapter-314ea4400f3f871d3e726d940cef30c0><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/porters-handbook/porting-info/>第12章 Info ファイル</a></li><li><input type=checkbox id=chapter-5955b0791ccd51005b5bc5bebeec91e5 class=toggle>
<label class="icon cursor" for=chapter-5955b0791ccd51005b5bc5bebeec91e5><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/porters-handbook/pkg-files/>第13章 pkg-* ファイル</a><ul><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/pkg-files/#porting-message>13.1. <span class=filename>pkg-message</span></a></li><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/pkg-files/#pkg-install>13.2. <span class=filename>pkg-install</span></a></li><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/pkg-files/#pkg-deinstall>13.3. <span class=filename>pkg-deinstall</span></a></li><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/pkg-files/#pkg-req>13.4. <span class=filename>pkg-req</span></a></li><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/pkg-files/#porting-plist>13.5. make の変数にあわせた <span class=filename>pkg-plist</span> の変更</a></li><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/pkg-files/#pkg-names>13.6. <span class=filename>pkg-*</span> ファイルの名前変更</a></li></ul></li><li><input type=checkbox id=chapter-ee86a11caedb6395ed82b94ec7a9c6cd class=toggle>
<label class="icon cursor" for=chapter-ee86a11caedb6395ed82b94ec7a9c6cd><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/porters-handbook/testing/>第14章 port のテスト</a><ul><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/testing/#testing-portlint>14.1. portlint</a></li><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/testing/#porting-prefix>14.2. <code>PREFIX</code></a></li><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/testing/#testing-freshports>14.3. FreshPorts 正当性テスト</a></li></ul></li><li><input type=checkbox id=chapter-24703a9f2b5ab277e796cbfa6f5fd1e4 class=toggle>
<label for=chapter-24703a9f2b5ab277e796cbfa6f5fd1e4><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/porters-handbook/port-upgrading/>第15章 アップグレード</a></li><li><input type=checkbox id=chapter-9a8875d5d59aa92f1e5a78e9ecd1fbe7 class=toggle>
<label class="icon cursor" for=chapter-9a8875d5d59aa92f1e5a78e9ecd1fbe7><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/porters-handbook/porting-dads/>第16章 やっていいことといけないこと</a><ul><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/porting-dads/#dads-intro>16.1. はじめに</a></li><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/porting-dads/#dads-strip>16.2. バイナリの strip</a></li><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/porting-dads/#dads-install>16.3. <code>INSTALL_*</code> マクロ</a></li><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/porting-dads/#porting-wrkdir>16.4. <code>WRKDIR</code></a></li><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/porting-dads/#porting-wrkdirprefix>16.5. <code>WRKDIRPREFIX</code></a></li><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/porting-dads/#porting-versions>16.6. OS の種類やバージョンの識別</a></li><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/porting-dads/#freebsd-versions>16.7. __FreeBSD_version の値</a></li><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/porting-dads/#dads-after-port-mk>16.8. <span class=filename>bsd.port.mk</span> の後に書くこと</a></li><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/porting-dads/#dads-documentation>16.9. 付加的な文書のインストール</a></li><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/porting-dads/#dads-subdirs>16.10. ディレクトリ構成</a></li><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/porting-dads/#porting-cleaning>16.11. 空のディレクトリの削除</a></li><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/porting-dads/#dads-uid>16.12. UID</a></li><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/porting-dads/#dads-rational>16.13. 合理的な port</a></li><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/porting-dads/#dads-cc>16.14. <code>CC</code> および <code>CXX</code> の尊重</a></li><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/porting-dads/#dads-cflags>16.15. <code>CFLAGS</code> の尊重</a></li><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/porting-dads/#dads-config>16.16. コンフィグレーション (設定) ファイル</a></li><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/porting-dads/#dads-freedback>16.17. フィードバック</a></li><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/porting-dads/#dads-readme>16.18. <span class=filename>README.html</span></a></li><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/porting-dads/#dads-broken>16.19. Port に <code>BROKEN</code>, <code>FORBIDDEN</code> などの印をつける</a></li><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/porting-dads/#dads-workarounds>16.20. 必要な回避策</a></li><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/porting-dads/#dads-misc>16.21. その他諸々</a></li><li><a href=http://172.16.201.134:1313/ja/books/porters-handbook/porting-dads/#dads-stuck>16.22. 困ったら…​</a></li></ul></li><li><input type=checkbox id=chapter-5ef4c4c471a3f55c74fb71881f9d8713 class=toggle>
<label for=chapter-5ef4c4c471a3f55c74fb71881f9d8713><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/porters-handbook/porting-samplem/>第17章 Makefile のサンプル</a></li><li><input type=checkbox id=chapter-b421e468bf239e07d899e0d2f5e7b2e5 class=toggle>
<label for=chapter-b421e468bf239e07d899e0d2f5e7b2e5><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/porters-handbook/porting-autoplist/>第18章 パッキングリストの自動生成</a></li><li><input type=checkbox id=chapter-9df8872e9cd736e47497099d9a6619cc class=toggle>
<label for=chapter-9df8872e9cd736e47497099d9a6619cc><a role=button></a></label><a href=http://172.16.201.134:1313/ja/books/porters-handbook/changes/>第19章 この文書と ports システムの変更</a></li><li></li></ul></nav></div></aside><div class=book><div class=book-menu-mobile><label for=menu-control><span class=menu-control-button><i class="fa fa-list" aria-hidden=true title="Book menu"></i>
Book menu</span></label></div><h1 class=title>第4章 本格的な port</h1><div class="admonitionblock note"><p><i class="fa fa-exclamation-circle" aria-hidden=true></i>
This translation may be out of date. To help with the translations please access the <a href=https://translate-dev.freebsd.org/ target=_blank>FreeBSD translations instance</a>.</p></div><div class=toc-mobile><h3>目次</h3><nav id=TableOfContents><ul><li><a href=#slow-work>4.1. port 構築の詳細</a></li><li><a href=#slow-sources>4.2. オリジナルのソースの入手</a></li><li><a href=#slow-modifying>4.3. port の修正</a></li><li><a href=#slow-patch>4.4. パッチの適用</a></li><li><a href=#slow-configure>4.5. コンフィグレーション</a></li><li><a href=#slow-user-input>4.6. ユーザからの入力の扱い</a></li></ul></nav></div><div class=book-content><div id=preamble><div class=sectionbody><div class=paragraph><p>残念ながら移植がそう簡単ではなく、それを動かすために 多少の変更が必要になる場合もあるでしょう。 このセクションでは、模範的な ports の作法に従い、 どのように変更を行なって動くようにするのかを 順を追って説明します。</p></div></div></div><div class=sect1><h2 id=slow-work>4.1. port 構築の詳細<a class=anchor href=#slow-work></a></h2><div class=sectionbody><div class=paragraph><p>まず、あなたが port のディレクトリで <code>make</code> と 入力してから起こる一連の出来事について、 順を追って説明します。 ここを読むときには、別のウィンドウに <span class=filename>bsd.port.mk</span> を表示しておくと 理解の助けになるかもしれません。</p></div><div class=paragraph><p>しかし、<span class=filename>bsd.port.mk</span> が何をしているのか 完全に理解できなくても 心配する必要はありません。 それほど多くの人が理解している というわけでは ありませんから…​。 <em>f(<sup></sup></em>;)_</p></div><div class="exampleblock procedure"><div class=content><div class="olist arabic"><ol class=arabic><li><p>まず、<code>fetch</code> という ターゲットが実行されます。 この <code>fetch</code> ターゲットは、 配布ファイルがローカルの <code>DISTDIR</code> に 存在することを保証する役目を持っています。 もし必要なファイルが <code>DISTDIR</code> に 存在しなければ、<code>fetch</code> ターゲットは <span class=filename>Makefile</span> で指定された <code>MASTER_SITES</code> 中の URL や、 FreeBSD のメイン FTP サイト <a href=ftp://ftp.FreeBSD.org/pub/FreeBSD/ports/distfiles/>ftp://ftp.FreeBSD.org/pub/FreeBSD/ports/distfiles/</a> (ここにはバックアップとして、われわれ ports 管理者が確認した 配布ファイルを置いてあります) を探しにいきます。 <code>make</code> を実行するマシンがインターネットに 接続されていて、目的のファイルを <code>FETCH</code> で 取ってこれた場合には、それを <code>DISTDIR</code> に 保存します。</p></li><li><p>次に <code>extract</code> ターゲットが実行されます。 このターゲットは <code>DISTDIR</code> から 配布ファイル (普通は gzip された tar ファイル) を読み込み、 その内容を作業ディレクトリ <code>WRKDIR</code> (デフォルトでは <span class=filename>work</span>) に展開します。</p></li><li><p>次に <code>patch</code> ターゲットが実行されます。 まず、<code>PATCHFILES</code> にパッチファイルが 指定されていれば、そのパッチを適用します。 次に、<code>PATCHDIR</code> ディレクトリ (デフォルトでは <span class=filename>files</span> サブディレクトリ) に <span class=filename>patch-*</span> という 名前のパッチファイルが存在すれば、 これらをアルファベット順に適用します。</p></li><li><p>次に <code>configure</code> ターゲットが 実行されます。 これには、いろいろな場合があります。</p><div class="olist loweralpha"><ol class=loweralpha type=a><li><p><span class=filename>scripts/configure</span> が 存在する場合には、そのスクリプトが実行されます。</p></li><li><p><code>HAS_CONFIGURE</code> または <code>GNU_CONFIGURE</code> がセットされていれば、 <span class=filename>WRKSRC/configure</span> が 実行されます。</p></li><li><p><code>USE_IMAKE</code> がセットされていれば、 <code>XMKMF</code> (デフォルトでは <code>xmkmf -a</code>) が 実行されます。</p></li></ol></div></li><li><p>最後に <code>build</code> ターゲットが実行されます。 これは作業ディレクトリ (<code>WRKSRC</code>) に降りていき、 ビルド (コンパイル) を実行するのが役目です。 <code>USE_GMAKE</code> がセットされていれば GNU <code>make</code> が使用され、 セットされていなければ FreeBSD の <code>make</code> が 使用されます。</p></li></ol></div></div></div><div class=paragraph><p>上記はデフォルトの動作です。これに加えて <code>pre-<em> 何とか</em></code>や <code>post-<em>何とか</em></code>という ターゲットを定義したり、そのような名前のスクリプトを <span class=filename>scripts</span> サブディレクトリに置くことも可能で、 それぞれデフォルトの動作の前や後に実行されます。</p></div><div class=paragraph><p>たとえば、<code>post-extract</code> ターゲットが <span class=filename>Makefile</span> に定義されていて、 <span class=filename>scripts</span> サブディレクトリに <span class=filename>pre-build</span> というファイルが置かれている場合、 <code>post-extract</code> ターゲットは 通常の展開動作の後に呼び出され、 <span class=filename>pre-build</span> スクリプトは デフォルトのコンパイル動作の前に実行されます。 実行する動作が簡単であれば、スクリプトよりも <span class=filename>Makefile</span> のターゲットを使用することが 推奨されています。 なぜなら、その port では どのような非標準の動作が必要とされるのか、 一箇所にまとめて書いてあった方が他の人に理解しやすいからです。</p></div><div class=paragraph><p>デフォルトの動作は <span class=filename>bsd.port.mk</span> の <code>do-<em>何とか</em></code>という ターゲットで実行されます。 たとえば port を展開するコマンドは <code>do-extract</code> ターゲットに書かれています。 もしデフォルトのターゲットに不満があれば、 <span class=filename>Makefile</span> 中で <code>do-<em> 何とか</em></code>という ターゲットを再定義することにより、 好きなように変更することができます。</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>"メイン"のターゲット (たとえば <code>extract</code>, <code>configure</code>、その他) は、 すべての前段階が実行されていることを確認してから、 実際のターゲットやスクリプトを呼び出す以外のことは 行ないませんし、これらが変更されることも想定されていません。 もし展開の方法を変更したいときには <code>do-extract</code> の変更によって実現し、 <code>extract</code> の動作は絶対に変更しないでください。</p></div></td></tr></tbody></table></div><div class=paragraph><p>これで、ユーザが <code>make</code> と 入力したときに何が起こるのかが理解できたと思います。 では、完璧な port を作成するための推奨手順を 順に見ていきましょう。</p></div></div></div><div class=sect1><h2 id=slow-sources>4.2. オリジナルのソースの入手<a class=anchor href=#slow-sources></a></h2><div class=sectionbody><div class=paragraph><p>(通常の場合、) 圧縮された tar ファイルの形 (<span class=filename>foo.tar.gz</span> あるいは <span class=filename>foo.tar.Z</span>) で オリジナルのソースを入手して、 それを <code>DISTDIR</code> にコピーします。 できる限り、<em>主流の</em>ソースを 使用するようにしてください。</p></div><div class=paragraph><p>もとの tar ファイルがどこにあるかを示すために、変数 <code>MASTER_SITES</code> を設定する必要があります。 主なサイトのほとんどについては省略形が <span class=filename>bsd.sites.mk</span> で定義されています。 これらのサイト (と付随する定義) を、ソースコード内で同じ情報が繰り返されるのを避けるために、 可能な限り使うようにしてください。 これらのサイトは時とともに変わってゆきますので、そうしないと、 関係者一同にとってメンテナンスの悪夢になってしまいます。</p></div><div class=paragraph><p>ネットワークへの接続の良好な FTP/HTTP サイトを 見つけることができなかったり、頭にくるような非標準的な形式しか 置いていないサイトしか見つけられないときには、 自分の管理下にあり信頼できる FTP サーバや HTTP サーバ (たとえば、あなた自身のホームページ) に置くこともできます。</p></div><div class=paragraph><p>そのような便利かつ信頼のおける置き場所が見つからない場合、 我々が <code>ftp.FreeBSD.org</code> に "置き場所"を提供することもできますが、 これはなるべく避けたい解決法です。 配布ファイルは、誰かの <code>freefall</code> アカウントの <span class=filename>~/public_distfiles/</span> に置かれることでしょう。 その port をコミットする人に、置いてもらえるように頼んでください。 その人は配布ファイルを置いて、<code>MASTER_SITES</code> を <code>MASTER_SITE_LOCAL</code> にセットし、 <code>MASTER_SITE_SUBDIR</code> には 自分の <code>freefall</code> ユーザ名を 入れておいてくれるでしょう。</p></div><div class=paragraph><p>その port の配布ファイルが、 作者によるバージョン更新のようなことがなく変更されるなら、 その配布ファイルを あなたのホームページに置いて、<code>MASTER_SITES</code> の 最初に指定することも考えてみてください。できれば、その port の作者にそういうことをしないようにお願いしてみてください。 そのためには、何かしらのソースコード管理を行うと役に立つでしょう。 あなたが独自のバージョンを置けば、ユーザが <code>checksum mismatch</code> エラーに悩まされることもなくなりますし、FreeBSD の FTP サイトの 保守担当者の負担も減らすこともできます。 また、その port にマスターサイトが一つしか存在しない場合には、 あなたのサイトにバックアップを置き、 それを <code>MASTER_SITES</code> の 2 番目に 指定すると良いでしょう。</p></div><div class=paragraph><p>その port がインターネット上で入手できる追加パッチを 必要とするのなら、それも取ってきて <code>DISTDIR</code> に置いてください。 それらがメインのソースの tar ファイルとは別のサイトに あったとしても、心配する必要はありません。 そのような状況にも ちゃんと対応できるようになっています (後述の <a href=#porting-patchfiles>PATCHFILES の記述</a>を ご覧ください)。</p></div></div></div><div class=sect1><h2 id=slow-modifying>4.3. port の修正<a class=anchor href=#slow-modifying></a></h2><div class=sectionbody><div class=paragraph><p>作業用のディレクトリに tar ファイルを展開し、 最新バージョンの FreeBSD 上で正しくコンパイルするために必要な、 あらゆる変更を行ないます。 この処理は最終的に自動化するわけですから、 何を行なったかを<em>注意深く記録しておきましょう</em>。 この port が完成した暁には、ファイルの削除、追加、 修正を含むすべての処理が自動化されたスクリプトや パッチファイルで行なえるようになっていなければなりません。</p></div><div class=paragraph><p>その port のコンパイルやインストールのために必要な手作業が あまりに多いようならば、Larry Wall の芸術的な Configure スクリプトを 参考にしたほうが良いかもしれません。 新しい ports collection は、エンドユーザにとって個々の port が 可能な限り"プラグ & プレイ"かつ 最小のディスク消費で make できることを目指しています。</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>明示的に記述されている場合を除き、あなたが作成して FreeBSD の ports collection に寄付したパッチファイル、 スクリプトおよびその他のファイルは、標準的な BSD の 著作権条件によりカバーされているものと見なされます。</p></div></td></tr></tbody></table></div></div></div><div class=sect1><h2 id=slow-patch>4.4. パッチの適用<a class=anchor href=#slow-patch></a></h2><div class=sectionbody><div class=paragraph><p>port の準備段階で追加されたり変更されたりしたファイルは、 再帰的 <a href="https://man.freebsd.org/cgi/man.cgi?query=diff&amp;sektion=1&amp;format=html">diff(1)</a> により後で <a href="https://man.freebsd.org/cgi/man.cgi?query=patch&amp;sektion=1&amp;format=html">patch(1)</a> に与えられる形にすることができます。 パッチは適当にまとめて <span class=filename>patch-<strong></strong></span><strong> という名前のファイルに入れてください。 <span class=filename></span></strong> はパッチが適用される順番を示します - これらは <em>アルファベット順</em>、 つまり <code>aa</code> が最初、 <code>ab</code> が その次といった順番で処理されます。 お望みなら、<span class=filename>patch-Imakefile</span> とか <span class=filename>patch-src-config.h</span> のように、 パッチ対象のファイルのパス名を示す名前を使うこともできます。 これらのファイルは <code>PATCHDIR</code> に置いてください。 そうすれば自動的に適用されるようになっています。 すべてのパッチは <code>WRKSRC</code> からの相対パスにするべきです (通常、<code>WRKSRC</code> は port の tar ファイルが展開されるディレクトリで、 make が実行されるところと同じです)。 修正やアップグレードを容易にするため、 複数のパッチで同じファイルを修正するのは避けてください (たとえば、<span class=filename>patch-aa</span> と <span class=filename>patch-ab</span> が共に <span class=filename>WRKSRC/foobar.c</span> を修正するなど)。</p></div><div class=paragraph><p>RCS にとって特別な意味を持つ文字列をパッチ内に入れないようにしてください。 ファイルを私たちのソースツリーに入れる時、 これらの文字列は CVS によって書き換えられてしまい、 後でまたパッチを使おうとした時にうまくいかないことがあります。 RCS 文字列はドル記号 (<code>$</code>) で囲まれており、 <code>$FreeBSD</code> や <code>$RCS</code> などで始まります。</p></div><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=diff&amp;sektion=1&amp;format=html">diff(1)</a> の再帰 (<code>-r</code>) フラグを使って再帰的なパッチを作るのは大変結構なのですが、 でき上がったパッチは必ず目でチェックして余計なゴミが入っていないことを確認してください。 よくあるのはバックアップファイル同士の変更点、あるいは <code>Imake</code> や GNU <code>configure</code> を使うソフトウェアの <span class=filename>Makefile</span> の変更点が入っている場合などです。 また <span class=filename>configure.in</span> を編集して <code>autoconf</code> を使って <code>configure</code> を作り直すときには、 <code>configure</code> の diff は含めずに (それらは良く数千行におよぶことがあります)、 <code>USE_AUTOCONF=yes</code> を定義して <span class=filename>configure.in</span> の diff をとってください。</p></div><div class=paragraph><p>ファイルをまるごと消す場合には、 パッチを使わずに <code>post-extract</code> ターゲットで消す方が簡単です。 できあがった差分に満足したら、 それらをソースのファイルごとに別々のパッチファイルに分割してください。</p></div></div></div><div class=sect1><h2 id=slow-configure>4.5. コンフィグレーション<a class=anchor href=#slow-configure></a></h2><div class=sectionbody><div class=paragraph><p>カスタマイズのために追加したいコマンドがあれば、 <span class=filename>configure</span> という名前のスクリプトに入れて <span class=filename>scripts</span> サブディレクトリに置いてください。 上で述べたように、<span class=filename>pre-configure</span> あるいは <span class=filename>post-configure</span> という <span class=filename>Makefile</span> ターゲットや、 スクリプトで処理することもできます。</p></div></div></div><div class=sect1><h2 id=slow-user-input>4.6. ユーザからの入力の扱い<a class=anchor href=#slow-user-input></a></h2><div class=sectionbody><div class=paragraph><p>もし、その port がビルド、コンフィグレーション、または インストールの際にユーザからの入力を必要とするならば、 <span class=filename>Makefile</span> 中で <code>IS_INTERACTIVE</code> を設定しなければなりません。 これにより、ユーザが環境変数 <code>BATCH</code> を セットしている場合には、この port の処理がスキップされるので "夜間の無人ビルド" が実行可能になります。 (逆に環境変数 <code>INTERACTIVE</code> がセットされていると、 ユーザからの入力を必要とする port <em>だけ</em>が コンパイルされます)。 これは、連続して ports をビルドするマシン群で、 無駄になる時間を大きく減らします。</p></div><div class=paragraph><p>もし、適切なデフォルト設定が存在するのであれば、 <code>PACKAGE_BUILDING</code> 変数をチェックして、 それが設定されている場合には ユーザ入力のスクリプトを起動しないようにしてください。 こうすることによって、我々 ports 管理者が CDROM や FTP に 置く package を作成することができます。</p></div></div></div></div><hr><div class=last-modified><p><strong>最終更新日</strong>: 2024年3月9日 by <a href="https://cgit.freebsd.org/doc/commit/?id=6199af92e7" target=_blank>Danilo G. Baio</a></p></div><div class=buttons><div class=prev><i class="fa fa-angle-left" aria-hidden=true title=Prev></i><div class=container><a href=http://172.16.201.134:1313/ja/books/porters-handbook/quick-porting class=direction>Prev</a></div></div><div class=home><i class="fa fa-home" aria-hidden=true title=Home></i><div class=container><a href=../ class=direction>Home</a></div></div><div class=next><div class=container><a href=http://172.16.201.134:1313/ja/books/porters-handbook/makefile class=direction>Next</a></div><i class="fa fa-angle-right" aria-hidden=true title=Next></i></div></div><label class="hidden book-menu-overlay" for=menu-control></label></div><aside class=toc><div class=toc-content><h3>目次</h3><nav id=TableOfContents><ul><li><a href=#slow-work>4.1. port 構築の詳細</a></li><li><a href=#slow-sources>4.2. オリジナルのソースの入手</a></li><li><a href=#slow-modifying>4.3. port の修正</a></li><li><a href=#slow-patch>4.4. パッチの適用</a></li><li><a href=#slow-configure>4.5. コンフィグレーション</a></li><li><a href=#slow-user-input>4.6. ユーザからの入力の扱い</a></li></ul></nav><hr><div class=resources><h3>リソース</h3><ul class=contents><li><i class="fa fa-file-pdf-o" aria-hidden=true title="PDF 版のダウンロード"></i><a href=https://download.freebsd.org/doc/ja/books/porters-handbook/porters-handbook_ja.pdf>PDF 版のダウンロード</a></li><li><i class="fa fa-pencil-square-o" aria-hidden=true title="Edit this page"></i><a href=https://github.com/freebsd/freebsd-doc/blob/main/documentation/content/ja/_index target=_blank>Edit this page</a></li></ul></div></div></aside><a class=to-top href=#top><i class="fa fa-arrow-circle-up" aria-hidden=true></i></a></main><footer><div class=footer-container><section class=logo-column><img src=http://172.16.201.134:1313/images/FreeBSD-colors.svg width=160 height=50 alt="FreeBSD logo"><div class=options-container><div class=language-container><a id=languages href=http://172.16.201.134:1313/ja/languages><img src=http://172.16.201.134:1313/images/language.png class=language-image alt="Choose language">
<span>日本語</span></a></div><div class=theme-container><select id=theme-chooser><option value=theme-system>System</option><option value=theme-light>Light</option><option value=theme-dark>Dark</option><option value=theme-high-contrast>High contrast</option></select></div></div></section><section class=about-column><h3 class=column-title>About</h3><ul class=column-elements-container><li><a href=https://www.freebsd.org/about/ target=_blank class=column-element>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/ target=_blank class=column-element>FreeBSD Foundation</a></li><li><a href=https://www.freebsd.org/where/ target=_blank class=column-element>Get FreeBSD</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct target=_blank class=column-element>Code of Conduct</a></li><li><a href=https://www.freebsd.org/security/ target=_blank class=column-element>Security Advisories</a></li></ul></section><section class=documentation-column><h3 class=column-title>Documentation</h3><ul class=column-elements-container><li><a href=/ja class=column-element>Documentation portal</a></li><li><a href=https://man.FreeBSD.org target=_blank class=column-element>Manual pages</a></li><li><a href=https://papers.FreeBSD.org target=_blank class=column-element>Presentations and papers</a></li><li><a href=https://docs-archive.freebsd.org/doc/ target=_blank class=column-element>Previous versions</a></li><li><a href=https://docs-archive.freebsd.org/44doc/ target=_blank class=column-element>4.4BSD Documents</a></li><li><a href=https://wiki.freebsd.org/ target=_blank class=column-element>Wiki</a></li></ul></section><section class=community-column><h3 class=column-title>Community</h3><ul class=column-elements-container><li><a href=http://172.16.201.134:1313/ja/articles/contributing class=column-element>Get involved</a></li><li><a href=https://forums.freebsd.org/ target=_blank class=column-element>Community forum</a></li><li><a href=https://lists.freebsd.org/ target=_blank class=column-element>Mailing lists</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank class=column-element>IRC Channels</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank class=column-element>Bug Tracker</a></li></ul></section><section class=legal-column><h3 class=column-title>Legal</h3><ul class=column-elements-container><li><a href=https://freebsdfoundation.org/donate/ target=_blank class=column-element>Donations</a></li><li><a href=https://www.freebsd.org/copyright/freebsd-license/ target=_blank class=column-element>Licensing</a></li><li><a href=https://www.freebsd.org/privacy/ target=_blank class=column-element>Privacy Policy</a></li><li><a href=https://www.freebsd.org/copyright/ target=_blank class=column-element>Legal notices</a></li></ul></section><section class=copyright-column><p>&copy; 1994-2024 The FreeBSD Project. All rights reserved</p><span>Made with <span class=heart>♥</span> by the FreeBSD Community</span></section></div></footer></body></html>