<!doctype html><html class=theme-light lang=ru><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content><meta name=copyright content="1995-2024 The FreeBSD Foundation"><link rel=canonical href=http://172.16.201.134:1313/ru/books/handbook/config/><title>Глава 12. Настройка и оптимизация | FreeBSD Documentation Portal</title>
<meta name=theme-color content="#790000"><meta name=color-scheme content="system light dark high-contrast"><link rel="shortcut icon" href=http://172.16.201.134:1313/favicon.ico><link rel=stylesheet href=http://172.16.201.134:1313/styles/main.min.css><link rel=stylesheet href=http://172.16.201.134:1313/css/font-awesome-min.css><script defer src=/js/theme-chooser.min.js></script><script defer src=/js/copy-clipboard.min.js></script><script defer src=/js/search.min.js></script><meta name=twitter:card content="summary"><meta name=twitter:domain content="docs.FreeBSD.org"><meta name=twitter:site content="@freebsd"><meta name=twitter:url content="https://twitter.com/freebsd"><meta property="og:title" content="Глава 12. Настройка и оптимизация"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:image" content="http://172.16.201.134:1313/favicon.ico"><meta property="og:image:alt" content="FreeBSD Logo"><meta property="og:locale" content="ru"><meta property="og:url" content="http://172.16.201.134:1313/ru/books/handbook/config/"><meta property="og:site_name" content="FreeBSD Documentation Portal"><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","url":"http:\/\/172.16.201.134:1313\/ru\/books\/handbook\/config\/","name":"FreeBSD Documentation Portal","headline":"FreeBSD Documentation Portal","description":"FreeBSD Documentation Portal"}</script></head><body><header><div class=header-container><div class=logo-menu-bars-container><a href=https://www.FreeBSD.org class=logo><img src=http://172.16.201.134:1313/images/FreeBSD-monochromatic.svg width=160 height=50 alt="FreeBSD logo">
</a><label class=menu-bars for=menu-bars><i class="fa fa-bars" aria-hidden=true></i></label></div><input id=menu-bars type=checkbox><nav><ul class=menu><li class=menu-item><input id=about type=checkbox>
<a href=# aria-label="Navigate to About section"><label class=menu-item-description for=about>О нас
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/about/ target=_blank>О нас</a></li><li><a href=https://www.freebsd.org/about/ target=_blank>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/about-us/about-the-foundation/ target=_blank>Фонд FreeBSD</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct/ target=_blank>Кодекс Этики</a></li></ul></li><li class=menu-item><input id=download type=checkbox>
<a href=# aria-label="Navigate to get FreeBSD section"><label class=menu-item-description for=download>Получить FreeBSD
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/where/ target=_blank>Получить FreeBSD</a></li><li><a href=https://www.freebsd.org/releases/ target=_blank>Информация о релизах</a></li><li><a href=https://www.freebsd.org/releng/ target=_blank>Подготовка релизов</a></li><li><a href=https://www.freebsd.org/security/ target=_blank>Бюллетени Безопасности</a></li></ul></li><li class=menu-item><input id=documentation type=checkbox>
<a href=# aria-label="Navigate to get Documentation section"><label class=menu-item-description for=documentation>Документация
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=/ru>Портал документации</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook>Руководство</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook>Руководство по созданию портов</a></li><li><a href=https://docs.FreeBSD.org/en/books/fdp-primer>Учебник Проекта Документирования</a></li><li><a href=https://man.FreeBSD.org target=_blank>Страницы Справочника</a></li><li><a href=https://papers.FreeBSD.org target=_blank>Презентации и публикации</a></li><li><a href=https://wiki.FreeBSD.org target=_blank>Wiki</a></li><li><a href=http://172.16.201.134:1313/ru/books>Книги</a></li><li><a href=http://172.16.201.134:1313/ru/articles>Статьи</a></li></ul></li><li class=menu-item><input id=community type=checkbox>
<a href=# aria-label="Navigate to get Community section"><label class=menu-item-description for=community>Сообщество
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/community/>Сообщество</a></li><li><a href=http://172.16.201.134:1313/ru/articles/contributing>Стать участником</a></li><li><a href=https://forums.freebsd.org/ target=_blank>Форум</a></li><li><a href=https://lists.freebsd.org/ target=_blank>Списки рассылки</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank>Каналы IRC</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank>Трекер ошибок</a></li><li><a href=https://www.freebsd.org/support/ target=_blank>Поддержка</a></li></ul></li></ul></nav><div class=search-donate-container><form class=search method=get id=search-header-form action=https://docs.freebsd.org/search name=search-header-form><input type=hidden name=DB value=ru>
<input id=words name=P type=text size=20 maxlength=255>
<button>
<i class="fa fa-search" aria-hidden=true></i></button></form><div class=donate><a href=https://freebsdfoundation.org/donate/ target=_blank><span class=heart>♥</span>
Пожертвования</a></div></div></div></header><input type=checkbox class="hidden toggle" id=menu-control><main class=main-wrapper-book><a id=top></a><aside class=book-menu><div class=book-menu-content><input id=search-book type=text placeholder=Поиск aria-label=Поиск maxlength=128><nav id=MenuContents><ul><li><input type=checkbox id=chapter-eb2a98ce203d8afd517726e6d8776be3 class=toggle>
<label class="icon cursor" for=chapter-eb2a98ce203d8afd517726e6d8776be3><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/preface/>Предисловие</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/preface/#preface-audience>Целевая аудитория</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/preface/#preface-changes-from4>Четвёртое издание</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/preface/#preface-changes-from3>Третье издание</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/preface/#preface-changes-from2>Второе издание (2004)</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/preface/#preface-changes>Первое издание (2001)</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/preface/#preface-overview>Структура этой книги</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/preface/#preface-conv>Договоренности, используемые в этой книге</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/preface/#preface-acknowledgements>Благодарности</a></li></ul></li><li><input type=checkbox id=chapter-14a525fce014b90b8a458a894818255a class=toggle>
<label for=chapter-14a525fce014b90b8a458a894818255a><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/parti/>Часть I. В начале</a></li><li><input type=checkbox id=chapter-f9c9f3451644df30d224350da97d5da6 class=toggle>
<label class="icon cursor" for=chapter-f9c9f3451644df30d224350da97d5da6><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/introduction/>Глава 1. Введение</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/introduction/#introduction-synopsis>1.1. Краткий обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/introduction/#nutshell>1.2. Добро пожаловать во FreeBSD!</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/introduction/#history>1.3. О Проекте FreeBSD</a></li></ul></li><li><input type=checkbox id=chapter-6aaec170775233b7c45f6cdcfb70d466 class=toggle>
<label class="icon cursor" for=chapter-6aaec170775233b7c45f6cdcfb70d466><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/install/>Глава 2. Установка FreeBSD версий 8.X и более ранних</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/install/#install-synopsis>2.1. Краткий обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/install/#install-hardware>2.2. Аппаратные требования</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/install/#install-pre>2.3. Перед установкой</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/install/#install-start>2.4. Начало установки</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/install/#using-sysinstall>2.5. Введение в Sysinstall</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/install/#install-steps>2.6. Выделение дискового пространства</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/install/#install-choosing>2.7. Выбор устанавливаемых компонентов</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/install/#install-media>2.8. Выбор источника для установки</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/install/#install-final-warning>2.9. Подтверждение установки</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/install/#install-post>2.10. После установки</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/install/#install-trouble>2.11. Решение проблем</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/install/#install-advanced>2.12. Расширенное руководство по установке</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/install/#install-diff-media>2.13. Подготовка собственного источника установки</a></li></ul></li><li><input type=checkbox id=chapter-f693a3fa687a72d63ec8129ee302d664 class=toggle>
<label class="icon cursor" for=chapter-f693a3fa687a72d63ec8129ee302d664><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/bsdinstall/>Глава 3. Установка FreeBSD версий 9.X и более поздних</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/bsdinstall/#bsdinstall-synopsis>3.1. Краткий обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/bsdinstall/#bsdinstall-hardware>3.2. Аппаратные требования</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/bsdinstall/#bsdinstall-pre>3.3. Перед установкой</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/bsdinstall/#bsdinstall-start>3.4. Начало установки</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/bsdinstall/#using-bsdinstall>3.5. Введение в bsdinstall</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/bsdinstall/#bsdinstall-netinstall>3.6. Установка по сети</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/bsdinstall/#bsdinstall-partitioning>3.7. Выделение дискового пространства</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/bsdinstall/#bsdinstall-final-warning>3.8. Завершение установки</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/bsdinstall/#bsdinstall-post>3.9. После установки</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/bsdinstall/#bsdinstall-install-trouble>3.10. Решение проблем</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/bsdinstall/#using-live-cd>3.11. Использование Live CD</a></li></ul></li><li><input type=checkbox id=chapter-9f6db261075f578742036fcc6000eecd class=toggle>
<label class="icon cursor" for=chapter-9f6db261075f578742036fcc6000eecd><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/basics/>Глава 4. Основы UNIX</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/basics/#basics-synopsis>4.1. Краткий обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/basics/#consoles>4.2. Виртуальные консоли и терминалы</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/basics/#users-synopsis>4.3. Пользователи и основы управления учетными записями</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/basics/#permissions>4.4. Права доступа</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/basics/#dirstructure>4.5. Структура каталогов</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/basics/#disk-organization>4.6. Организация дисков</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/basics/#mount-unmount>4.7. Монтирование и размонтирование файловых систем</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/basics/#basics-processes>4.8. Процессы</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/basics/#basics-daemons>4.9. Даемоны, сигналы, уничтожение процессов</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/basics/#shells>4.10. Интерпретатор команд</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/basics/#editors>4.11. Текстовые редакторы</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/basics/#basics-devices>4.12. Устройства и файлы устройств</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/basics/#binary-formats>4.13. Бинарные форматы</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/basics/#basics-more-information>4.14. Дополнительная информация</a></li></ul></li><li><input type=checkbox id=chapter-01c5707e95d14c0ff84bf62600c958d1 class=toggle>
<label class="icon cursor" for=chapter-01c5707e95d14c0ff84bf62600c958d1><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/ports/>Глава 5. Установка приложений: порты и пакеты</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/ports/#ports-synopsis>5.1. Обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/ports/#ports-overview>5.2. Обзор установки программного обеспечения</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/ports/#ports-finding-applications>5.3. Поиск программного обеспечения</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/ports/#packages-using>5.4. Использование бинарных пакетов</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/ports/#pkgng-intro>5.5. Использование pkgng для управления бинарными пакетами</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/ports/#ports-using>5.6. Использование Коллекции Портов</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/ports/#ports-nextsteps>5.7. Действия после установки</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/ports/#ports-broken>5.8. Обработка нерабочих портов</a></li></ul></li><li><input type=checkbox id=chapter-f56428b9e0d0b77cc8e863910f96bbde class=toggle>
<label class="icon cursor" for=chapter-f56428b9e0d0b77cc8e863910f96bbde><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/wayland/>Глава 6. Wayland</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/wayland/#wayland-synopsis>6.1. Общие сведения о Wayland</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/wayland/#wayland-wayfire>6.2. Композитный менеджер Wayfire</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/wayland/#wayland-hikari>6.3. Композитный менеджер Hikari</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/wayland/#wayland-sway>6.4. Композитный менеджер Sway</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/wayland/#wayland-xwayland>6.5. Использование Xwayland</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/wayland/#wayland-remotedesktop>6.6. Организация Удалённого Рабочего Стола при помощи VNC</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/wayland/#wayland-ly>6.7. Менеджер регистраций Wayland</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/wayland/#wayland-utilities>6.8. Полезные Инструменты</a></li></ul></li><li><input type=checkbox id=chapter-3405c00581365a8b5d16af70fe4d1b72 class=toggle>
<label class="icon cursor" for=chapter-3405c00581365a8b5d16af70fe4d1b72><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/x11/>Глава 6. X Window System</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/x11/#x11-synopsis>6.1. Обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/x11/#x-understanding>6.2. Основы X</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/x11/#x-install>6.3. Установка X11</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/x11/#x-config>6.4. Конфигурация X11</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/x11/#x-fonts>6.5. Использование шрифтов в X11</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/x11/#x-xdm>6.6. Менеджеры экранов (Display Managers) X</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/x11/#x11-wm>6.7. Графические оболочки</a></li></ul></li><li><input type=checkbox id=chapter-0eab3565e8f59f5a8a896dfba7eb3680 class=toggle>
<label for=chapter-0eab3565e8f59f5a8a896dfba7eb3680><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/partii/>Часть II. Общие задачи</a></li><li><input type=checkbox id=chapter-b33cf28993f3f7bf5baf036e79da0f39 class=toggle>
<label class="icon cursor" for=chapter-b33cf28993f3f7bf5baf036e79da0f39><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/desktop/>Глава 7. Приложения для настольного компьютера</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/desktop/#desktop-synopsis>7.1. Краткий обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/desktop/#desktop-browsers>7.2. Браузеры</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/desktop/#desktop-productivity>7.3. Бизнес приложения</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/desktop/#desktop-viewers>7.4. Программы просмотра документов</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/desktop/#desktop-finance>7.5. Финансовые программы</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/desktop/#desktop-summary>7.6. Итоги</a></li></ul></li><li><input type=checkbox id=chapter-152f694a19312ad72ec7bb4e1c3c33b2 class=toggle>
<label class="icon cursor" for=chapter-152f694a19312ad72ec7bb4e1c3c33b2><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/multimedia/>Глава 8. Мультимедиа</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/multimedia/#multimedia-synopsis>8.1. Краткий обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/multimedia/#sound-setup>8.2. Настройка звуковой карты</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/multimedia/#sound-mp3>8.3. Звук MP3</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/multimedia/#video-playback>8.4. Воспроизведение видео</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/multimedia/#tvcard>8.5. Настройка ТВ тюнеров</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/multimedia/#scanners>8.6. Сканеры</a></li></ul></li><li><input type=checkbox id=chapter-80888b4ee02e3e409e5f71cf97a36450 class=toggle>
<label class="icon cursor" for=chapter-80888b4ee02e3e409e5f71cf97a36450><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/kernelconfig/>Глава 9. Настройка ядра FreeBSD</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/kernelconfig/#kernelconfig-synopsis>9.1. Краткий обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/kernelconfig/#kernelconfig-custom-kernel>9.2. Зачем собирать собственное ядро?</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/kernelconfig/#kernelconfig-devices>9.3. Определение аппаратного обеспечения</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/kernelconfig/#kernelconfig-modules>9.4. Драйвера, подсистемы и модули ядра</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/kernelconfig/#kernelconfig-building>9.5. Сборка и установка собственного ядра</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/kernelconfig/#kernelconfig-config>9.6. Конфигурационный файл</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/kernelconfig/#kernelconfig-trouble>9.7. Решение проблем</a></li></ul></li><li><input type=checkbox id=chapter-cb174c55879b17ab955f2f16989a79e0 class=toggle>
<label class="icon cursor" for=chapter-cb174c55879b17ab955f2f16989a79e0><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/printing/>Глава 10. Печать</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/printing/#printing-synopsis>10.1. Краткий обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/printing/#printing-intro-spooler>10.2. Введение</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/printing/#printing-intro-setup>10.3. Основная настройка</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/printing/#printing-advanced>10.4. Расширенная настройка принтера</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/printing/#printing-using>10.5. Использование принтеров</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/printing/#printing-lpd-alternatives>10.6. Альтернативы стандартному спулеру</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/printing/#printing-troubleshooting>10.7. Выявление проблем</a></li></ul></li><li><input type=checkbox id=chapter-c12b8c3f2a8fcefce87087241f695c83 class=toggle>
<label class="icon cursor" for=chapter-c12b8c3f2a8fcefce87087241f695c83><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/linuxemu/>Глава 11. Двоичная совместимость с Linux</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/linuxemu/#linuxemu-synopsis>11.1. Краткий обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/linuxemu/#linuxemu-lbc-install>11.2. Установка</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/linuxemu/#linuxemu-mathematica>11.3. Установка Mathematica®</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/linuxemu/#linuxemu-maple>11.4. Установка Maple™</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/linuxemu/#linuxemu-matlab>11.5. Установка MATLAB®</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/linuxemu/#linuxemu-oracle>11.6. Установка Oracle®</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/linuxemu/#sapr3>11.7. Установка SAP® R/3®</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/linuxemu/#linuxemu-advanced>11.8. Дополнительные сведения</a></li></ul></li><li><input type=checkbox id=chapter-03b11ba627b9a0c85b247f5641bde272 class=toggle>
<label for=chapter-03b11ba627b9a0c85b247f5641bde272><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/partiii/>Часть III. Системное администрирование</a></li><li><input type=checkbox id=chapter-6c31587f8d736319f099cd4dc1961301 class=toggle checked>
<label class="icon cursor" for=chapter-6c31587f8d736319f099cd4dc1961301><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/config/>Глава 12. Настройка и оптимизация</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/config/#config-synopsis>12.1. Введение</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/config/#configtuning-initial>12.2. Начальное конфигурирование</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/config/#configtuning-core-configuration>12.3. Основные настройки</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/config/#configtuning-appconfig>12.4. Настройка приложений</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/config/#configtuning-starting-services>12.5. Запуск сервисов</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/config/#configtuning-cron>12.6. Настройка утилиты <code>cron</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/config/#configtuning-rcd>12.7. Использование rc во FreeBSD 5.X и последующих версиях</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/config/#config-network-setup>12.8. Настройка карт сетевых интерфейсов</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/config/#configtuning-virtual-hosts>12.9. Настройка виртуальных серверов</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/config/#configtuning-configfiles>12.10. Файлы настройки</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/config/#configtuning-sysctl>12.11. Настройка с помощью sysctl</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/config/#configtuning-disk>12.12. Оптимизация дисков</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/config/#configtuning-kernel-limits>12.13. Изменение ограничений, накладываемых ядром</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/config/#adding-swap-space>12.14. Увеличение объема подкачки</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/config/#acpi-overview>12.15. Управление питанием и ресурсами</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/config/#ACPI-debug>12.16. Использование и отладка FreeBSD ACPI</a></li></ul></li><li><input type=checkbox id=chapter-459f0012b3b4f0b6b123010f029da5e4 class=toggle>
<label class="icon cursor" for=chapter-459f0012b3b4f0b6b123010f029da5e4><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/boot/>Глава 13. Процесс загрузки FreeBSD</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/boot/#boot-synopsis>13.1. Описание</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/boot/#boot-introduction>13.2. Проблема загрузки</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/boot/#boot-blocks>13.3. Менеджер загрузки и этапы загрузки</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/boot/#boot-kernel>13.4. Взаимодействие с ядром во время загрузки</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/boot/#device-hints>13.5. Хинты устройств</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/boot/#boot-init>13.6. Init: инициализация управления процессами</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/boot/#boot-shutdown>13.7. Процесс остановки системы</a></li></ul></li><li><input type=checkbox id=chapter-917c75fcffbb14d48ed6d0a48e7028f2 class=toggle>
<label class="icon cursor" for=chapter-917c75fcffbb14d48ed6d0a48e7028f2><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/security/>Глава 14. Безопасность</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/security/#security-synopsis>14.1. Краткое описание</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/security/#security-intro>14.2. Введение</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/security/#securing-freebsd>14.3. Защита FreeBSD</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/security/#crypt>14.4. DES, MD5, и шифрование</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/security/#one-time-passwords>14.5. Одноразовые пароли</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/security/#tcpwrappers>14.6. TCP Wrappers</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/security/#kerberosIV>14.7. KerberosIV</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/security/#kerberos5>14.8. Kerberos5</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/security/#openssl>14.9. OpenSSL</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/security/#ipsec>14.10. VPN через IPsec</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/security/#openssh>14.11. OpenSSH</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/security/#fs-acl>14.12. Списки контроля доступа файловой системы (ACL)</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/security/#security-portaudit>14.13. Мониторинг вопросов безопасности в ПО сторонних разработчиков</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/security/#security-advisories>14.14. Сообщения безопасности FreeBSD</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/security/#security-accounting>14.15. Учёт используемых ресурсов</a></li></ul></li><li><input type=checkbox id=chapter-8f4620c77e572cbb58917911a33c73cf class=toggle>
<label class="icon cursor" for=chapter-8f4620c77e572cbb58917911a33c73cf><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/mac/>Глава 15. Принудительный контроль доступа (MAC)</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/mac/#mac-synopsis>15.1. Краткий обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mac/#mac-inline-glossary>15.2. Ключевые термины этой главы</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mac/#mac-initial>15.3. Описание MAC</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mac/#mac-understandlabel>15.4. Метки MAC</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mac/#mac-modules>15.5. Настройка модулей</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mac/#mac-bsdextended>15.6. Модуль MAC bsdextended</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mac/#mac-ifoff>15.7. Модуль MAC ifoff</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mac/#mac-portacl>15.8. Модуль MAC portacl</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mac/#mac-labelingpolicies>15.9. Политики MAC, использующие метки</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mac/#mac-partition>15.10. Модуль MAC partition</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mac/#mac-mls>15.11. Модуль многоуровневой безопасности MAC (MLS)</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mac/#mac-biba>15.12. Модуль MAC Biba</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mac/#mac-lomac>15.13. Модуль MAC LOMAC</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mac/#mac-implementing>15.14. Реализация защищенной среды с MAC</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mac/#MAC-examplehttpd>15.15. Другой пример: Использование MAC для защиты веб сервера</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mac/#mac-troubleshoot>15.16. Решение проблем с инфраструктурой MAC</a></li></ul></li><li><input type=checkbox id=chapter-9598d66a76cb3182057b6bcd775149a0 class=toggle>
<label class="icon cursor" for=chapter-9598d66a76cb3182057b6bcd775149a0><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/audit/>Глава 16. Аудит событий безопасности</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/audit/#audit-synopsis>16.1. Краткий обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/audit/#audit-inline-glossary>16.2. Ключевые понятия</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/audit/#audit-config>16.3. Настройка системы аудита</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/audit/#audit-administration>16.4. Работа с журналами аудита</a></li></ul></li><li><input type=checkbox id=chapter-e1edcad13d9db6e8e4cb645d378ecfaf class=toggle>
<label class="icon cursor" for=chapter-e1edcad13d9db6e8e4cb645d378ecfaf><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/disks/>Глава 17. Устройства хранения</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/disks/#disks-synopsis>17.1. Краткий обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/disks/#disks-naming>17.2. Имена устройств</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/disks/#disks-adding>17.3. Добавление дисков</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/disks/#raid>17.4. RAID</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/disks/#usb-disks>17.5. USB устройства хранения</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/disks/#creating-cds>17.6. Запись и использование оптических носителей (CD)</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/disks/#creating-dvds>17.7. Создание и использование оптических носителей (DVD)</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/disks/#floppies>17.8. Дискеты</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/disks/#backups-tapebackups>17.9. Создание и использование архивных копий на магнитной ленте</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/disks/#backups-floppybackups>17.10. Создание резервных копий на дискетах</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/disks/#backup-strategies>17.11. Стратегии резервного копирования</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/disks/#backup-basics>17.12. Основы технологии резервного копирования</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/disks/#disks-virtual>17.13. Сетевые файловые системы, файловые системы в памяти и с отображением в файл</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/disks/#snapshots>17.14. Мгновенные копии файловых систем</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/disks/#quotas>17.15. Квотирование файловых систем</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/disks/#disks-encrypting>17.16. Шифрование дисковых разделов</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/disks/#swap-encrypting>17.17. Шифрование области подкачки</a></li></ul></li><li><input type=checkbox id=chapter-dde37901a0e0ea32745b67607854900f class=toggle>
<label class="icon cursor" for=chapter-dde37901a0e0ea32745b67607854900f><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/geom/>Глава 18. GEOM: Модульная инфраструктура преобразования дисковых запросов</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/geom/#GEOM-synopsis>18.1. Краткий обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/geom/#GEOM-intro>18.2. Введение в GEOM</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/geom/#GEOM-striping>18.3. RAID0 - Создание дисковой последовательности (Striping)</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/geom/#GEOM-mirror>18.4. RAID1 - Зеркалирование (Mirroring)</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/geom/#geom-ggate>18.5. Сетевые устройства GEOM Gate</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/geom/#geom-glabel>18.6. Метки дисковых устройств</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/geom/#geom-gjournal>18.7. Журналирование UFS средствами GEOM</a></li></ul></li><li><input type=checkbox id=chapter-7af71270807eb7b70cd3eedc6577b254 class=toggle>
<label class="icon cursor" for=chapter-7af71270807eb7b70cd3eedc6577b254><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/filesystems/>Глава 19. Поддержка файловых систем</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/filesystems/#filesystems-synopsis>19.1. Краткий обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/filesystems/#filesystems-zfs>19.2. Файловая система ZFS</a></li></ul></li><li><input type=checkbox id=chapter-49f1e96591c090304ea532012257f4ef class=toggle>
<label class="icon cursor" for=chapter-49f1e96591c090304ea532012257f4ef><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/l10n/>Глава 20. Локализация - использование и настройка i18n/L10n</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/l10n/#l10n-synopsis>20.1. Краткий обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/l10n/#using-localization>20.2. Использование локализации</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/l10n/#l10n-compiling>20.3. Поиск приложений i18n</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/l10n/#lang-setup>20.4. Настройка локализации для некоторых языков</a></li></ul></li><li><input type=checkbox id=chapter-dead2b4c5ea325dd390a9b0dccd8f763 class=toggle>
<label class="icon cursor" for=chapter-dead2b4c5ea325dd390a9b0dccd8f763><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/cutting-edge/>Глава 21. Обновление системы и смена версии FreeBSD</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/cutting-edge/#updating-upgrading-synopsis>21.1. Краткий обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/cutting-edge/#updating-upgrading-freebsdupdate>21.2. Обновление FreeBSD</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/cutting-edge/#updating-upgrading-documentation>21.3. Обновление документации</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/cutting-edge/#current-stable>21.4. Использование ветви разработки</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/cutting-edge/#synching>21.5. Синхронизация исходных текстов</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/cutting-edge/#makeworld>21.6. Пересборка мира</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/cutting-edge/#small-lan>21.7. Отслеживание исходных текстов для нескольких машин</a></li></ul></li><li><input type=checkbox id=chapter-bbd25f9a194f9c39ca2d658c75767db5 class=toggle>
<label for=chapter-bbd25f9a194f9c39ca2d658c75767db5><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/partiv/>Часть IV. Сетевые коммуникации</a></li><li><input type=checkbox id=chapter-499dab596afd7ddac77e80295314e0dd class=toggle>
<label class="icon cursor" for=chapter-499dab596afd7ddac77e80295314e0dd><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/serialcomms/>Глава 22. Последовательные соединения</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/serialcomms/#serial-synopsis>22.1. Краткое описание</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/serialcomms/#serial>22.2. Введение</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/serialcomms/#term>22.3. Терминалы</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/serialcomms/#dialup>22.4. Входящие соединения по модему</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/serialcomms/#dialout>22.5. Исходящие соединения по модему</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/serialcomms/#serialconsole-setup>22.6. Настройка последовательной консоли</a></li></ul></li><li><input type=checkbox id=chapter-95e4571c48bee1cced5e84a538d302e3 class=toggle>
<label class="icon cursor" for=chapter-95e4571c48bee1cced5e84a538d302e3><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/ppp-and-slip/>Глава 23. PPP и SLIP</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/ppp-and-slip/#ppp-and-slip-synopsis>23.1. Краткий обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/ppp-and-slip/#userppp>23.2. PPP уровня пользователя</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/ppp-and-slip/#ppp>23.3. PPP уровня ядра</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/ppp-and-slip/#ppp-troubleshoot>23.4. Решение проблем с соединениями PPP</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/ppp-and-slip/#pppoe>23.5. Использование PPP через Ethernet (PPPoE)</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/ppp-and-slip/#pppoa>23.6. Использование PPP через ATM (PPPoA)</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/ppp-and-slip/#slip>23.7. Использование SLIP</a></li></ul></li><li><input type=checkbox id=chapter-f089ac726c401c9b4bd5c34a295e11bb class=toggle>
<label class="icon cursor" for=chapter-f089ac726c401c9b4bd5c34a295e11bb><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/mail/>Глава 24. Электронная почта</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/mail/#mail-synopsis>24.1. Краткий обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mail/#mail-using>24.2. Использование электронной почты</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mail/#sendmail>24.3. Настройка sendmail</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mail/#mail-changingmta>24.4. Установка другой почтовой программы</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mail/#mail-trouble>24.5. Поиск и устранение неисправностей</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mail/#mail-advanced>24.6. Расширенное руководство</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mail/#outgoing-only>24.7. Настройка почты только для отправки</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mail/#SMTP-dialup>24.8. Использование почты с коммутируемым соединением</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mail/#SMTP-Auth>24.9. SMTP аутентификация</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mail/#mail-agents>24.10. Почтовые программы пользователей</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mail/#mail-fetchmail>24.11. Использование fetchmail</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mail/#mail-procmail>24.12. Использование procmail</a></li></ul></li><li><input type=checkbox id=chapter-6de4de3fe925639d4175ce4b6f8c1829 class=toggle>
<label class="icon cursor" for=chapter-6de4de3fe925639d4175ce4b6f8c1829><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/network-servers/>Глава 25. Сетевые серверы</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/network-servers/#network-servers-synopsis>25.1. Краткий обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/network-servers/#network-inetd>25.2. "Супер-сервер"inetd</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/network-servers/#network-nfs>25.3. Network File System (NFS)</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/network-servers/#network-nis>25.4. Network Information System (NIS/YP)</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/network-servers/#network-dhcp>25.5. Автоматическая настройка сети (DHCP)</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/network-servers/#network-dns>25.6. Domain Name System (DNS)</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/network-servers/#network-apache>25.7. Apache HTTP сервер</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/network-servers/#network-samba>25.8. Файл сервер и печать для Microsoft® Windows® клиентов (Samba)</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/network-servers/#network-ftp>25.9. Протокол передачи файлов (FTP)</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/network-servers/#network-ntp>25.10. Синхронизация часов через NTP</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/network-servers/#network-syslogd>25.11. * Remote Host Logging with <code>syslogd</code></a></li></ul></li><li><input type=checkbox id=chapter-776d855c7b75e048f90b5c2c9b35ffe0 class=toggle>
<label class="icon cursor" for=chapter-776d855c7b75e048f90b5c2c9b35ffe0><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/firewalls/>Глава 26. Межсетевые экраны</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/firewalls/#firewalls-intro>26.1. Введение</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/firewalls/#firewalls-concepts>26.2. Принципы работы межсетевых экранов</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/firewalls/#firewalls-apps>26.3. Пакеты межсетевых экранов</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/firewalls/#firewalls-pf>26.4. Packet Filter (PF, межсетевой экран OpenBSD) и ALTQ</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/firewalls/#firewalls-ipf>26.5. * IPFILTER (IPF)</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/firewalls/#firewalls-ipfw>26.6. IPFW</a></li></ul></li><li><input type=checkbox id=chapter-5b07f776a0e6155c1c89aa0d15610380 class=toggle>
<label class="icon cursor" for=chapter-5b07f776a0e6155c1c89aa0d15610380><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/advanced-networking/>Глава 27. Сложные вопросы работы в сети</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/advanced-networking/#advanced-networking-synopsis>27.1. Краткий обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/advanced-networking/#network-routing>27.2. Сетевые шлюзы и маршруты</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/advanced-networking/#network-wireless>27.3. Беспроводные сети</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/advanced-networking/#network-bluetooth>27.4. Bluetooth</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/advanced-networking/#network-bridging>27.5. Мосты</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/advanced-networking/#network-diskless>27.6. Работа с бездисковыми станциями</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/advanced-networking/#network-isdn>27.7. ISDN</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/advanced-networking/#network-natd>27.8. Даемон преобразования сетевых адресов (natd)</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/advanced-networking/#network-plip>27.9. IP по параллельному порту (PLIP)</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/advanced-networking/#network-ipv6>27.10. IPv6</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/advanced-networking/#network-atm>27.11. Асинхронный режим передачи (ATM)</a></li></ul></li><li><input type=checkbox id=chapter-171a77aa9d067a1024f849470e1f33e8 class=toggle>
<label for=chapter-171a77aa9d067a1024f849470e1f33e8><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/partv/>Часть V. Приложения</a></li><li><input type=checkbox id=chapter-8050f436a0a7986a4aaded93d8e49469 class=toggle>
<label class="icon cursor" for=chapter-8050f436a0a7986a4aaded93d8e49469><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/mirrors/>Приложение A. Получение FreeBSD</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/mirrors/#mirrors-cdrom>A.1. Наборы CD и DVD</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mirrors/#mirrors-ftp>A.2. FTP сайты</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mirrors/#ctm>A.3. Использование CTM</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mirrors/#svn>A.4. Использование Subversion</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mirrors/#mirrors-rsync>A.5. Использование rsync</a></li></ul></li><li><input type=checkbox id=chapter-128b630a8f88f158e7027fe6c2184d21 class=toggle>
<label class="icon cursor" for=chapter-128b630a8f88f158e7027fe6c2184d21><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/bibliography/>Приложение B. Библиография</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/bibliography/#bibliography-freebsd>B.1. Книги и журналы, специализирующиеся на FreeBSD</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/bibliography/#bibliography-userguides>B.2. Руководства для пользователей</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/bibliography/#bibliography-adminguides>B.3. Руководства для администраторов</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/bibliography/#bibliography-programmers>B.4. Руководства для программистов</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/bibliography/#bibliography-osinternals>B.5. Внутренности операционной системы</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/bibliography/#bibliography-security>B.6. Безопасность</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/bibliography/#bibliography-hardware>B.7. Оборудование</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/bibliography/#bibliography-history>B.8. История UNIX®</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/bibliography/#bibliography-journals>B.9. Прочие издания</a></li></ul></li><li><input type=checkbox id=chapter-8bbb8867c46dac315e2253945d8c18a8 class=toggle>
<label class="icon cursor" for=chapter-8bbb8867c46dac315e2253945d8c18a8><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/eresources/>Приложение C. Ресурсы в интернет</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/eresources/#eresources-mail>C.1. Списки рассылки</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/eresources/#eresources-news>C.2. Новостные группы Usenet</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/eresources/#eresources-web>C.3. Серверы World Wide Web</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/eresources/#eresources-email>C.4. Адреса Email</a></li></ul></li><li><input type=checkbox id=chapter-a80ea4f5a4480b8725422710f954ef36 class=toggle>
<label class="icon cursor" for=chapter-a80ea4f5a4480b8725422710f954ef36><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/pgpkeys/>Приложение D. PGP ключи</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/pgpkeys/#pgpkeys-officers>D.1. Офицеры</a></li></ul></li><li></li></ul></nav></div></aside><div class=book><div class=book-menu-mobile><label for=menu-control><span class=menu-control-button><i class="fa fa-list" aria-hidden=true title="Меню книг"></i>
Меню книг</span></label></div><h1 class=title>Глава 12. Настройка и оптимизация</h1><div class="admonitionblock note"><p><i class="fa fa-exclamation-circle" aria-hidden=true></i>
Этот перевод может быть устаревшим. Для того, чтобы помочь с переводом, пожалуйста, обратитесь к <a href=https://translate-dev.freebsd.org/ target=_blank>Сервер переводов FreeBSD</a>.</p></div><div class=toc-mobile><h3>Содержание</h3><nav id=TableOfContents><ul><li><a href=#config-synopsis>12.1. Введение</a></li><li><a href=#configtuning-initial>12.2. Начальное конфигурирование</a></li><li><a href=#configtuning-core-configuration>12.3. Основные настройки</a></li><li><a href=#configtuning-appconfig>12.4. Настройка приложений</a></li><li><a href=#configtuning-starting-services>12.5. Запуск сервисов</a></li><li><a href=#configtuning-cron>12.6. Настройка утилиты <code>cron</code></a></li><li><a href=#configtuning-rcd>12.7. Использование rc во FreeBSD 5.X и последующих версиях</a></li><li><a href=#config-network-setup>12.8. Настройка карт сетевых интерфейсов</a></li><li><a href=#configtuning-virtual-hosts>12.9. Настройка виртуальных серверов</a></li><li><a href=#configtuning-configfiles>12.10. Файлы настройки</a></li><li><a href=#configtuning-sysctl>12.11. Настройка с помощью sysctl</a></li><li><a href=#configtuning-disk>12.12. Оптимизация дисков</a></li><li><a href=#configtuning-kernel-limits>12.13. Изменение ограничений, накладываемых ядром</a></li><li><a href=#adding-swap-space>12.14. Увеличение объема подкачки</a></li><li><a href=#acpi-overview>12.15. Управление питанием и ресурсами</a></li><li><a href=#ACPI-debug>12.16. Использование и отладка FreeBSD ACPI</a></li></ul></nav></div><div class=book-content><div id=preamble><div class=sectionbody></div></div><div class=sect1><h2 id=config-synopsis>12.1. Введение<a class=anchor href=#config-synopsis></a></h2><div class=sectionbody><div class=paragraph><p>Один из важных аспектов FreeBSD это настройка системы. Правильная настройка системы поможет избежать головной боли при последующих обновлениях. Эта глава описывает большую часть процесса настройки FreeBSD, включая некоторые параметры, которые можно установить для оптимизации системы FreeBSD.</p></div><div class=paragraph><p>После прочтения этой главы вы узнаете:</p></div><div class=ulist><ul><li><p>Как эффективно работать с файловыми системами и разделами подкачки.</p></li><li><p>Основы настройки <span class=filename>rc.conf</span> и системы запуска приложений <span class=filename>/usr/local/etc/rc.d</span>.</p></li><li><p>Как настроить и протестировать сетевую карту.</p></li><li><p>Как настроить виртуальные хосты на сетевых устройствах.</p></li><li><p>Как использовать различные файлы конфигурации в <span class=filename>/etc</span>.</p></li><li><p>Как оптимизировать FreeBSD, используя переменные <code>sysctl</code>.</p></li><li><p>Как увеличить скорость работы дисков и изменить ограничения, накладываемые ядром.</p></li></ul></div><div class=paragraph><p>Перед прочтением этой главы вам следует:</p></div><div class=ulist><ul><li><p>Понять основы UNIX® и FreeBSD (<a href=../basics/#basics>Основы UNIX</a>).</p></li><li><p>Ознакомиться с основами конфигурации/компиляции ядра (<a href=../kernelconfig/#kernelconfig>Настройка ядра FreeBSD</a>).</p></li></ul></div></div></div><div class=sect1><h2 id=configtuning-initial>12.2. Начальное конфигурирование<a class=anchor href=#configtuning-initial></a></h2><div class=sectionbody><div class=sect2><h3 id=_разделы_диска>12.2.1. Разделы диска<a class=anchor href=#_разделы_диска></a></h3><div class=sect3><h4 id=_основы_построения_разделов>12.2.1.1. Основы построения разделов<a class=anchor href=#_основы_построения_разделов></a></h4><div class=paragraph><p>Во время разметки жёсткого диска с помощью <a href="https://man.freebsd.org/cgi/man.cgi?query=bsdlabel&amp;sektion=8&amp;format=html">bsdlabel(8)</a> или <a href="https://man.freebsd.org/cgi/man.cgi?query=sysinstall&amp;sektion=8&amp;format=html">sysinstall(8)</a>, важно помнить, что скорость чтения и записи данных уменьшается от внешних к внутренним трекам диска. Самые маленькие и самые часто используемые файловые системы (корневая и раздел подкачки) должны быть расположены в начале диска, в то время как самые большие, такие, как <span class=filename>/usr</span>, в конце. Самым оптимальным считается следующий порядок расположения файловых систем: root, swap, <span class=filename>/var</span>, <span class=filename>/usr</span>.</p></div><div class=paragraph><p>Размер файловой системы <span class=filename>/var</span> определяется предназначением машины. <span class=filename>/var</span> используется для хранения почтовых ящиков, очередей печати и лог файлов. Размер почтовых ящиков и лог файлов может расти неограниченно в зависимости от количества пользователей системы и от того, как долго хранятся лог-файлы. Большинству пользователей никогда не потребуется гигабайт, но помните, что <span class=filename>/var/tmp</span> должен быть достаточно большим для пакетов.</p></div><div class=paragraph><p>В разделе <span class=filename>/usr</span> содержит большинство файлов, необходимых для поддержки системы, порты (<a href="https://man.freebsd.org/cgi/man.cgi?query=ports&amp;sektion=7&amp;format=html">ports(7)</a>, рекомендуется) и исходные тексты (опционально). Оба эти каталога опциональны при установке. Для этого раздела рекомендуется как минимум 2 гигабайта.</p></div><div class=paragraph><p>При установке размера разделов, не забудьте принять во внимание рост размера требуемого системе дискового пространства. Переполнение одного раздела даже при наличии свободного места на другом может вызвать затруднения.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Многие пользователи обнаружили, что размер разделов, предлагаемый <a href="https://man.freebsd.org/cgi/man.cgi?query=sysinstall&amp;sektion=8&amp;format=html">sysinstall(8)</a>'ом по умолчанию, иногда меньше подходящего для разделов <span class=filename>/var</span> и <span class=filename>/</span>. Тщательно планируйте размер разделов и не жалейте места.</p></div></td></tr></tbody></table></div></div><div class=sect3><h4 id=swap-design>12.2.1.2. Раздел подкачки<a class=anchor href=#swap-design></a></h4><div class=paragraph><p>Как правило, размер раздела подкачки должен быть равен удвоенному размеру оперативной памяти. Например, если на машине установлено 128 мегабайт памяти, раздел подкачки должен быть 256 мегабайт. Системы с меньшим количеством памяти могут работать лучше с большим объёмом раздела подкачки. Не рекомендуется устанавливать размер раздела подкачки меньше 256 мегабайт, необходимо также принять во внимание возможное наращивание объема установленной на машине памяти. Алгоритмы кэширования VM настроены на максимальное быстродействие, когда размер раздела подкачки равен как минимум удвоенному размеру памяти. Заниженный размер раздела подкачки может привести к неэффективной работе постраничного сканирования VM и вызвать проблемы при увеличении объёма памяти.</p></div><div class=paragraph><p>На больших системах с несколькими SCSI дисками (или несколькими IDE дисками, находящимися на разных контроллерах), рекомендуется создавать раздел подкачки на каждом диске (до четырёх дисков). Разделы подкачки должны быть примерно одного размера. Ядро не накладывает ограничений на размер раздела подкачки, но внутренние структуры позволяют иметь общий размер разделов подкачки, равный наибольшему, умноженному на четыре. Выделение под разделы подкачки примерно одинакового места позволить ядру оптимально расположить разделы подкачки. Установка размера подкачки больше требуемого нормальна, даже если этот объем не используется. В этих условиях может быть проще восстановиться после зависания программы перед тем, как возникнет необходимость перезагрузки.</p></div></div><div class=sect3><h4 id=_зачем_нужны_разделы>12.2.1.3. Зачем нужны разделы?<a class=anchor href=#_зачем_нужны_разделы></a></h4><div class=paragraph><p>Некоторые пользователи считают, что лучше использовать один большой раздел, но есть несколько причин, по которым этого лучше не делать. Во-первых, у каждого раздела свои характеристики, и отделяя их, можно выполнить соответствующие настройки. Например, корневая и файловая система и <span class=filename>/usr</span> в основном предназначены для чтения, без большого объема записи. В то же время множество операций чтения и записи выполняется в <span class=filename>/var</span> и <span class=filename>/var/tmp</span>.</p></div><div class=paragraph><p>При правильном размещении и выборе размера разделов системы, фрагментация в более маленьких разделах, куда часто записываются данные, не перенесётся на остальные разделы. Размещение самых часто используемых разделов ближе к началу диска увеличит скорость ввода/вывода там, где она нужна больше всего. Хотя производительность важна и для больших дисков, передвижение их ближе к концу диска не повлечёт значительного уменьшения быстродействия по сравнению с перемещением ближе к концу диска <span class=filename>/var</span>. И, наконец, разделы существуют и из соображений безопасности. Наличие маленького аккуратного корневого раздела, доступного только для чтения даёт значительные шансы на "выживание" после краха системы.</p></div></div></div></div></div><div class=sect1><h2 id=configtuning-core-configuration>12.3. Основные настройки<a class=anchor href=#configtuning-core-configuration></a></h2><div class=sectionbody><div class=paragraph><p>Основные настройки системы располагаются в <span class=filename>/etc/rc.conf</span>. Этот файл вмещает широкий спектр конфигурационной информации, используемой при загрузке системы. Имя этого файла прямо отражает его назначение, это файл настройки для файлов <span class=filename>rc*</span>.</p></div><div class=paragraph><p>Администратор должен сделать записи в <span class=filename>rc.conf</span>, чтобы переопределить строки по умолчанию из <span class=filename>/etc/defaults/rc.conf</span>. Файлы по умолчанию нельзя копировать в <span class=filename>/etc</span> - они вмещают значения по умолчанию, а не примеры значений. Все специфичные для данной системы изменения должны быть сделаны в файле <span class=filename>rc.conf</span>.</p></div><div class=paragraph><p>Существует несколько методов для отделения общей конфигурации для группы систем от конкретной для данной системы в целях уменьшения объема работы администратора. Рекомендуемый метод - прописать общую конфигурацию в отдельный файл, например, в <span class=filename>/etc/rc.conf.site</span>, и включить его название в <span class=filename>/etc/rc.conf</span>, который вмещает только специфичную для данной системы информацию.</p></div><div class=paragraph><p>Поскольку <span class=filename>rc.conf</span> читается <a href="https://man.freebsd.org/cgi/man.cgi?query=sh&amp;sektion=1&amp;format=html">sh(1)</a>, есть тривиальный способ сделать это. Например:</p></div><div class=ulist><ul><li><p>rc.conf:</p><div class="literalblock programlisting"><div class=content><pre>	. /etc/rc.conf.site
	hostname=&#34;node15.example.com&#34;
	network_interfaces=&#34;fxp0 lo0&#34;
	ifconfig_fxp0=&#34;inet 10.1.1.1&#34;</pre></div></div></li><li><p>rc.conf.site:</p><div class="literalblock programlisting"><div class=content><pre>	defaultrouter=&#34;10.1.1.254&#34;
	saver=&#34;daemon&#34;
	blanktime=&#34;100&#34;</pre></div></div></li></ul></div><div class=paragraph><p>Файл <span class=filename>rc.conf.site</span> может быть распространён на все системы, используя <code>rsync</code> или подобную ей программу, в то время, как <span class=filename>rc.conf</span> должен остаться только на одной машине.</p></div><div class=paragraph><p>Обновление системы с помощью <a href="https://man.freebsd.org/cgi/man.cgi?query=sysinstall&amp;sektion=8&amp;format=html">sysinstall(8)</a> или <code>make world</code> не повлекут за собой перезапись <span class=filename>rc.conf</span>. Вся информация в этом файле сохранится.</p></div></div></div><div class=sect1><h2 id=configtuning-appconfig>12.4. Настройка приложений<a class=anchor href=#configtuning-appconfig></a></h2><div class=sectionbody><div class=paragraph><p>Обычно, установленные приложения имеют свои конфигурационные файлы, со своим собственным синтаксисом. Важно хранить эти файлы отдельно от файлов основной системы, чтобы их можно было легко администрировать с помощью средств управления пакетами.</p></div><div class=paragraph><p>Обычно эти файлы устанавливаются в <span class=filename>/usr/local/etc</span>. В случае, если приложению нужно большое количество конфигурационных файлов, для их хранения будет создан подкаталог.</p></div><div class=paragraph><p>Обычно, вместе с установкой портов и пакетов, устанавливаются и примеры конфигурационных файлов. Обычно они имеют расширение <span class=filename>.default</span>. Если не существует конфигурационных файлов для этого приложения, они будут созданы путём копирования <span class=filename>.default</span> файлов.</p></div><div class=paragraph><p>Например, <span class=filename>/usr/local/etc/apache</span>:</p></div><div class=literalblock><div class=content><pre>-rw-r--r--  1 root  wheel   2184 May 20  1998 access.conf
-rw-r--r--  1 root  wheel   2184 May 20  1998 access.conf.default
-rw-r--r--  1 root  wheel   9555 May 20  1998 httpd.conf
-rw-r--r--  1 root  wheel   9555 May 20  1998 httpd.conf.default
-rw-r--r--  1 root  wheel  12205 May 20  1998 magic
-rw-r--r--  1 root  wheel  12205 May 20  1998 magic.default
-rw-r--r--  1 root  wheel   2700 May 20  1998 mime.types
-rw-r--r--  1 root  wheel   2700 May 20  1998 mime.types.default
-rw-r--r--  1 root  wheel   7980 May 20  1998 srm.conf
-rw-r--r--  1 root  wheel   7933 May 20  1998 srm.conf.default</pre></div></div><div class=paragraph><p>Размеры файлов показывают, что только файл <span class=filename>srm.conf</span> был изменён. При следующем обновлении Apache этот файл уже не будет перезаписан.</p></div></div></div><div class=sect1><h2 id=configtuning-starting-services>12.5. Запуск сервисов<a class=anchor href=#configtuning-starting-services></a></h2><div class=sectionbody><div class=paragraph><p>Многие пользователи предпочитают устанавливать программы сторонних производителей в FreeBSD из набора портов. В подобных случаях может потребоваться сконфигурировать программы так, чтобы они запускались при инициализации системы. Сервисы, такие как <a class=package href=https://cgit.freebsd.org/ports/tree/mail/postfix/>mail/postfix</a> или <a class=package href=https://cgit.freebsd.org/ports/tree/www/apache13/>www/apache13</a>, - это лишь два примера множества программных пакетов, которые можно запускать при инициализации системы. В этом разделе описывается процедура, предназначенная для запуска программ сторонних разработчиков.</p></div><div class=paragraph><p>Большинство входящих в FreeBSD сервисов, таких как <a href="https://man.freebsd.org/cgi/man.cgi?query=cron&amp;sektion=8&amp;format=html">cron(8)</a>, запускается с помощью стартовых скриптов системы. Эти скрипты могут различаться в зависимости от версии FreeBSD или ее производителя; однако важнее всего учитывать, что их начальную конфигурацию можно задать с помощью простых стартовых скриптов.</p></div><div class=paragraph><p>До появления <span class=filename>rc.d</span> приложения должны были помещать простой стартовый скрипт в каталог <span class=filename>/usr/local/etc/rc.d</span>, который затем читался скриптами инициализации системы. Эти скрипты затем выполнялись в ходе последующих стадий запуска системы.</p></div><div class=paragraph><p>Хотя много разработчиков потратили часы на попытки внедрить старый стиль конфигурирования в новую систему, остаётся фактом, что для некоторых утилит сторонних производителей по-прежнему необходим скрипт, помещённый в указанный выше каталог. Незначительные различия в скриптах зависят от того, используется ли <span class=filename>rc.d</span>. До версии FreeBSD 5.1 использовались скрипты в старом стиле, и почти во всех случаях скрипты в новом стиле должны подойти так же хорошо.</p></div><div class=paragraph><p>Хотя каждый скрипт должен соответствовать некоторым минимальным требованиям, в большинстве случаев эти требования не зависят от версии FreeBSD. Каждый скрипт должен иметь в конце расширение <span class=filename>.sh</span> и каждый скрипт должен быть выполняемым. Последнее требование может быть выполнено путем установки командой <code>chmod</code> уникальных прав доступа <code>755</code>. Также, как минимум, должна быть опция <code>start</code> для запуска приложения и опция <code>stop</code> для его остановки.</p></div><div class=paragraph><p>Простейший стартовый скрипт, пожалуй, будет похож на следующий:</p></div><div class="literalblock programlisting"><div class=content><pre>#!/bin/sh
echo -n &#39; utility&#39;

case &#34;$1&#34; in
start)
        /usr/local/bin/utility
        ;;
stop)
        kill -9 `cat /var/run/utility.pid`
        ;;
*)
        echo &#34;Usage: `basename $0` {start|stop}&#34; 2
        exit 64
        ;;
esac

exit 0</pre></div></div><div class=paragraph><p>Этот скрипт поддерживает опции <code>stop</code> и <code>start</code> для приложения, которое мы здесь называем просто - <code>utility</code>.</p></div><div class=paragraph><p>А можно запускать его и вручную, с помощью команды:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># /usr/local/etc/rc.d/utility.sh start</span></code></pre></div></div><div class=paragraph><p>Хотя и не все программы сторонних производителей требуют добавления строки в файл <span class=filename>rc.conf</span>, практически каждый день очередной новый порт меняется так, чтобы поддерживать подобную конфигурацию. Поищите в результатах, выдаваемых после установки более детальную информацию по конкретному приложению. Некоторые программы сторонних производителей будут включать стартовые скрипты, позволяющие использовать приложение с <span class=filename>rc.d</span>; но это мы еще обсудим в следующем разделе.</p></div><div class=sect2><h3 id=_расширенное_конфигурирование_приложения>12.5.1. Расширенное конфигурирование приложения<a class=anchor href=#_расширенное_конфигурирование_приложения></a></h3><div class=paragraph><p>Теперь, когда FreeBSD включает <span class=filename>rc.d</span>, конфигурирование запуска приложений стало более оптимальным; фактически, оно стало более тщательным. С помощью ключевых слов, рассмотренных в разделе <a href=#configtuning-rcd>rc.d</a>, приложения теперь можно настроить для запуска после других заданных сервисов, например, DNS; можно разрешить передачу дополнительных флагов через <span class=filename>rc.conf</span> вместо жесткого задания флагов в стартовых скриптах, и т.д. Простой скрипт может иметь следующий вид:</p></div><div class="literalblock programlisting"><div class=content><pre>#!/bin/sh
#
# PROVIDE: utility
# REQUIRE: DAEMON
# KEYWORD: shutdown

. /etc/rc.subr

name=utility
rcvar=utility_pidfile

command=&#34;/usr/local/sbin/utility&#34;

load_rc_config $name

#
# НЕ МЕНЯЙТЕ ЗДЕСЬ ЭТИ СТАНДАРТНЫЕ ЗНАЧЕНИЯ
# ЗАДАВАЙТЕ ИХ В ФАЙЛЕ /etc/rc.conf
#
utility_enable=${utility_enable-&#34;NO&#34;}
pidfile=${utility_pidfile-&#34;/var/run/utility.pid&#34;}

run_rc_command &#34;$1&#34;</pre></div></div><div class=paragraph><p>Этот скрипт будет гарантировать, что указанное приложение utility будет запущено после сервиса <code>daemon</code>. Он также предоставляет метод для создания и отслеживания файла идентификатора процесса, PID.</p></div><div class=paragraph><p>Для этого приложения затем можно поместить следующую строку в файл <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>utility_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>Этот новый метод также позволяет легко работать с аргументами командной строки, включать стандартные функции из файла <span class=filename>/etc/rc.subr</span>, обеспечивает совместимость с утилитой <a href="https://man.freebsd.org/cgi/man.cgi?query=rcorder&amp;sektion=8&amp;format=html">rcorder(8)</a> и упрощает конфигурирование с помощью файла <span class=filename>rc.conf</span>.</p></div></div><div class=sect2><h3 id=_использование_сервисов_для_запуска_сервисов>12.5.2. Использование сервисов для запуска сервисов<a class=anchor href=#_использование_сервисов_для_запуска_сервисов></a></h3><div class=paragraph><p>Другие сервисы, такие как даемоны сервера POP3, IMAP, и т.п. могут быть запущены с помощью <a href="https://man.freebsd.org/cgi/man.cgi?query=inetd&amp;sektion=8&amp;format=html">inetd(8)</a>. Для этого необходимо установить сервисную утилиту из набора портов и добавить соответствующую строчку конфигурации в файл <span class=filename>/etc/inetd.conf</span> или раскомментировать подходящую строку конфигурации из уже имеющихся. Работа с даемоном inetd и его конфигурирование подробно описаны в разделе <a href=../network-servers/#network-inetd>inetd</a>.</p></div><div class=paragraph><p>В некоторых случаях использование для запуска системных служб даемона <a href="https://man.freebsd.org/cgi/man.cgi?query=cron&amp;sektion=8&amp;format=html">cron(8)</a> может оказаться более приемлемым. Этот подход имеет несколько преимуществ, поскольку даемон <code>cron</code> запускает эти процессы от имени владельца файла <span class=filename>crontab</span>. Это позволяет обычным пользователям запускать и поддерживать некоторые приложения.</p></div><div class=paragraph><p>Утилита <code>cron</code> поддерживает уникальную возможность, <code>@reboot</code>, - это значение можно использовать вместо спецификации времени. В результате, задание будет выполнено при запуске <a href="https://man.freebsd.org/cgi/man.cgi?query=cron&amp;sektion=8&amp;format=html">cron(8)</a>, обычно - в ходе инициализации системы.</p></div></div></div></div><div class=sect1><h2 id=configtuning-cron>12.6. Настройка утилиты <code>cron</code><a class=anchor href=#configtuning-cron></a></h2><div class=sectionbody><div class=paragraph><p>Одна из наиболее полезных утилит FreeBSD это <a href="https://man.freebsd.org/cgi/man.cgi?query=cron&amp;sektion=8&amp;format=html">cron(8)</a>. Утилита <code>cron</code> работает в фоновом режиме и постоянно проверяет файл <span class=filename>/etc/crontab</span>. Утилита <code>cron</code> проверяет также каталог <span class=filename>/var/cron/tabs</span> в поиске новых файлов <span class=filename>crontab</span>. Файлы <span class=filename>crontab</span> содержат информацию об определенных функциях, которые <code>cron</code> выполняет в указанное время.</p></div><div class=paragraph><p>Утилита <code>cron</code> использует два разных типа конфигурационных файлов, системный и пользовательский. Все различие между этими двумя форматами заключается в шестом поле. В системном файле шестое поля это имя пользователя, с правами которого будет запущена команда. Это позволяет запускать команды из системного crontab от любого пользователя. В пользовательском файле шестое поле указывает запускаемую команду, и все команды запускаются от пользователя, который создал crontab; это важно для безопасности.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Пользовательские crontab позволяют индивидуальным пользователям планировать задачи без привилегий суперпользователя (<code>root</code>). Команды из crontab пользователя запускаются с привилегиями этого пользователя.</p></div><div class=paragraph><p>Пользователь <code>root</code> может использовать собственный crontab, как и любой другой пользователь. Он будет отличаться от системного crontab <span class=filename>/etc/crontab</span>. Поскольку существует системный crontab, обычно не требуется создавать пользовательский crontab для <code>root</code>.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Давайте заглянем в файл <span class=filename>/etc/crontab</span> (системный crontab):</p></div><div class="literalblock programlisting"><div class=content><pre># /etc/crontab - root&#39;s crontab for FreeBSD
#
# $FreeBSD: src/etc/crontab,v 1.32 2002/11/22 16:13:39 tom Exp $
#<i class=conum data-value=1></i><b>(1)</b>
#
SHELL=/bin/sh
PATH=/etc:/bin:/sbin:/usr/bin:/usr/sbin <i class=conum data-value=2></i><b>(2)</b>
HOME=/var/log
#
#
#minute	hour	mday	month	wday	who	command <i class=conum data-value=3></i><b>(3)</b>
#
#
*/5	*	*	*	*	root	/usr/libexec/atrun <i class=conum data-value=4></i><b>(4)</b></pre></div></div><div class="colist arabic"><table><tbody><tr><td><i class=conum data-value=1></i><b>1</b></td><td>Как и в большинстве файлов настройки FreeBSD, символы "#" означают комментарии. Комментарии нужны для напоминания о том, что означает строка и зачем она добавлена. Комментарии не могут находиться на той же строке, что и команда, или они будут восприняты как часть команды; располагайте их на новой строке. Пустые строки игнорируются.</td></tr><tr><td><i class=conum data-value=2></i><b>2</b></td><td>Сначала должны быть заданы переменные окружения. Знак равно (<code>=</code>) используется для задания переменных окружения, в этом примере <code>SHELL</code>, <code>PATH</code>, и <code>HOME</code>. Если переменная для оболочки не задана, <code>cron</code> использует оболочку по умолчанию, <code>sh</code>. Если не задана переменная <code>PATH</code>, значение по умолчанию не устанавливается и пути к файлам должны быть полными. Если не задана переменная <code>HOME</code>, <code>cron</code> будет использовать домашний каталог соответствующего пользователя.</td></tr><tr><td><i class=conum data-value=3></i><b>3</b></td><td>В строке всего семь полей. Их значения <code>minute</code>, <code>hour</code>, <code>mday</code>, <code>month</code>, <code>wday</code>, <code>who</code> (кто), и <code>command</code>. Значение полей почти очевидно. <code>minute</code> это время в минутах, когда будет запущена команда. <code>hour</code> означает то же самое для часов. <code>mday</code> означает день месяца. <code>month</code>, это то же самое, что час и минута, но для месяцев. Параметр <code>wday</code> это день недели. Все эти поля должны быть в числовом формате, время в двадцатичетырехчасовом исчислении. Поле <code>who</code> имеет специальное значение, и присутствует только в файле <span class=filename>/etc/crontab</span>. Это поле определяет пользователя, с правами которого должна быть запущена команда. Когда пользователь устанавливает собственный файл <span class=filename>crontab</span>, он не указывает этот параметр. Последний параметр <code>command</code>. Он указывает команду, которая должна быть запущена.</td></tr><tr><td><i class=conum data-value=4></i><b>4</b></td><td>Последняя строка определяет параметры, описанные выше. Здесь задано значение <code>*/5</code>, и несколько символов <code>\*</code>. Эти символы <code>*</code> означают "первый-последний", и могут быть интерпретированы как <em>каждый</em>. Таким образом, для этой строки соответствующая команда <code>atrun</code> вызывается под пользователем <code>root</code> каждые пять минут независимо от дня или месяца. За дополнительной информацией по команде <code>atrun</code> обращайтесь к странице справочника <a href="https://man.freebsd.org/cgi/man.cgi?query=atrun&amp;sektion=8&amp;format=html">atrun(8)</a>.Команды могут принимать любое количество параметров; однако команды, состоящие из нескольких строк, должны быть объединены символом "\".</td></tr></tbody></table></div><div class=paragraph><p>Этот формат одинаков для каждого файла <span class=filename>crontab</span>, за исключением одной детали. Шестое поле, где указано имя пользователя, присутствует только в файле <span class=filename>/etc/crontab</span>. Это поле должно быть исключено из <span class=filename>crontab</span> файлов пользователей.</p></div><div class=sect2><h3 id=configtuning-installcrontab>12.6.1. Установка crontab<a class=anchor href=#configtuning-installcrontab></a></h3><div class="admonitionblock important"><table><tbody><tr><td class=icon><i class="fa icon-important" title=Important></i></td><td class=content><div class=paragraph><p>Вы не должны использовать процедуру, описанную здесь, для установки системного crontab. Просто используйте свой любимый текстовый редактор: утилита <code>cron</code> узнает о том, что файл изменился и сразу начнет использовать обновленную версию. Обратитесь к <a href=https://docs.freebsd.org/ru/books/faq/#ROOT-NOT-FOUND-CRON-ERRORS>этой части FAQ</a> за дальнейшей информацией.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Для установки готового <span class=filename>crontab</span> пользователя, сначала создайте в вашем любимом редакторе файл соответствующего формата, а затем воспользуйтесь утилитой <code>crontab</code>. Обычно она запускается так:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% crontab crontab-file</code></pre></div></div><div class=paragraph><p>В этом примере, <span class=filename>crontab-file</span> это имя файла crontab, который только что был создан.</p></div><div class=paragraph><p>Существует также параметр для просмотра установленных файлов <span class=filename>crontab</span>: задайте <code>crontab</code> параметр <code>-l</code>.</p></div><div class=paragraph><p>Для пользователей, составляющих crontab вручную, без временного файла, существует параметр <code>crontab -e</code>. Она вызовет редактор с пустым файлом. Когда файл будет сохранен, <code>crontab</code> автоматически установит его.</p></div><div class=paragraph><p>Если позднее вы захотите полностью удалить свой <span class=filename>crontab</span>, используйте <code>crontab</code> с параметром <code>-r</code>.</p></div></div></div></div><div class=sect1><h2 id=configtuning-rcd>12.7. Использование rc во FreeBSD 5.X и последующих версиях<a class=anchor href=#configtuning-rcd></a></h2><div class=sectionbody><div class=paragraph><p>Во FreeBSD недавно была интегрирована из NetBSD система <span class=filename>rc.d</span>, используемая для старта системы. Многие из файлов в каталоге <span class=filename>/etc/rc.d</span> предназначены для основных сервисов, они могут управляться параметрами <code>start</code>, <code>stop</code>, и <code>restart</code>. Например, <a href="https://man.freebsd.org/cgi/man.cgi?query=sshd&amp;sektion=8&amp;format=html">sshd(8)</a> может быть перезапущен следующей командой:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># /etc/rc.d/sshd restart</span></code></pre></div></div><div class=paragraph><p>Эта процедура похожа для других сервисов. Конечно, сервисы обычно запускаются автоматически при загрузке системы, как указано в <a href="https://man.freebsd.org/cgi/man.cgi?query=rc.conf&amp;sektion=5&amp;format=html">rc.conf(5)</a>. Например, включение даемона Network Address Translation при запуске выполняется простым добавлением следующей строки в <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>natd_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>Если <code>natd_enable="NO"</code> уже присутствует, просто измените <code>NO</code> на <code>YES</code>. Скрипты rc автоматически загрузят все другие зависимые сервисы, как описано ниже.</p></div><div class=paragraph><p>Поскольку система <span class=filename>rc.d</span> в основном предназначена для запуска/отключения сервисов во время запуска/отключения системы, стандартные параметры <code>start</code>, <code>stop</code> и <code>restart</code> будут работать только если установлена соответствующая переменная в <span class=filename>/etc/rc.conf</span>. Например, команда выше <code>sshd restart</code> будет работать только если переменная <code>sshd_enable</code> в файле <span class=filename>/etc/rc.conf</span> установлена в <code>YES</code>. Для выполнения скриптов независимо от установок в <span class=filename>/etc/rc.conf</span>, параметры <code>start</code>, <code>stop</code> или <code>restart</code> необходимо задавать с префиксом "force". Например, для перезапуска <code>sshd</code> независимо от установок в <span class=filename>/etc/rc.conf</span>, выполните следующую команду:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># /etc/rc.d/sshd forcerestart</span></code></pre></div></div><div class=paragraph><p>Проверить состояние переменной в файле <span class=filename>/etc/rc.conf</span> легко: запустите соответствующий скрипт из <span class=filename>rc.d</span> с параметром <code>rcvar</code>. Проверка переменной для <code>sshd</code> выполняется следующей командой:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># /etc/rc.d/sshd rcvar</span>
<span class=c># sshd</span>
<span class=nv>$sshd_enable</span><span class=o>=</span>YES</code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Вторая строка (<code># sshd</code>) это вывод команды <code>sshd</code>, а не консоль <code>root</code>.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Чтобы определить, запущен ли сервис, существует параметр <code>status</code>. Например для проверки того, запущен ли <code>sshd</code>, выполните:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># /etc/rc.d/sshd status</span>
sshd is running as pid 433.</code></pre></div></div><div class=paragraph><p>В некоторых случаях возможна также перегрузка (<code>reload</code>) сервиса. Скрипт, запущенный с этим параметром, попытается отправить сервису сигнал, вызывающий перезагрузку файлов настройки. В большинстве случаев это означает отправку сервису сигнала <code>SIGHUP</code>. Следует помнить, что эту функцию поддерживают не все сервисы.</p></div><div class=paragraph><p>Система <span class=filename>rc.d</span> используется не только для сетевых серверов, она отвечает также за большую часть инициализации системы. Рассмотрим, к примеру, файл <span class=filename>bgfsck</span>. Во время выполнения этот скрипт выводит следующее сообщение:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>Starting background file system checks <span class=k>in </span>60 seconds.</code></pre></div></div><div class=paragraph><p>Следовательно, этот файл используется для фоновой проверки файловых систем, которая выполняется только в процессе инициализации системы.</p></div><div class=paragraph><p>Функционирование многих сервисов системы зависит от корректной работы других сервисов. Например, NIS и другие основанные на RPC сервисы могут не запуститься, пока не загрузится <code>rpcbind</code> (portmapper). Для разрешения этой проблемы, в начале каждого скрипта в комментарии включаются информация о зависимостях и другие метаданные. Программа <a href="https://man.freebsd.org/cgi/man.cgi?query=rcorder&amp;sektion=8&amp;format=html">rcorder(8)</a> используется для разбора этих комментариев во время старта системы для определения порядка, в котором должны вызываться системные сервисы в соответствии с зависимостями. В начало каждого стартового файла должны быть включены следующие строки:</p></div><div class=ulist><ul><li><p><code>PROVIDE</code>: Задает имя сервиса, предоставляемого этим файлом.</p></li><li><p><code>REQUIRE</code>: Список сервисов, необходимых этому сервису. Этот файл будет запущен <em>после</em> указанных сервисов.</p></li><li><p><code>BEFORE</code>: Список сервисов, зависящих от этого сервиса. Этот файл будет запущен <em>до</em> указанных сервисов.</p></li></ul></div><div class=paragraph><p>Используя этот метод, администратор может легко контролировать системные сервисы без использования "уровней запуска", как в некоторых других операционных системах UNIX®.</p></div><div class=paragraph><p>Дополнительную информацию о системе <span class=filename>rc.d</span> можно найти на страницах справочника <a href="https://man.freebsd.org/cgi/man.cgi?query=rc&amp;sektion=8&amp;format=html">rc(8)</a> и <a href="https://man.freebsd.org/cgi/man.cgi?query=rc.subr&amp;sektion=8&amp;format=html">rc.subr(8)</a>.</p></div></div></div><div class=sect1><h2 id=config-network-setup>12.8. Настройка карт сетевых интерфейсов<a class=anchor href=#config-network-setup></a></h2><div class=sectionbody><div class=paragraph><p>В наши дни мы не представляем себе компьютера без сетевого подключения. Добавление и настройка сетевой карты это обычная задача любого администратора FreeBSD.</p></div><div class=sect2><h3 id=_поиск_подходящего_драйвера>12.8.1. Поиск подходящего драйвера<a class=anchor href=#_поиск_подходящего_драйвера></a></h3><div class=paragraph><p>В первую очередь определите тип используемой карты (PCI или ISA), модель карты и используемый в ней чип. FreeBSD поддерживает многие PCI и ISA карты. Обратитесь к Списку поддерживаемого оборудования вашего релиза чтобы узнать, поддерживается ли карта.</p></div><div class=paragraph><p>Как только вы убедились, что карта поддерживается, потребуется определить подходящий драйвер. В файлах <span class=filename>/usr/src/sys/conf/NOTES</span> и <span class=filename>/usr/src/sys/arch/conf/NOTES</span> находится список драйверов сетевых интерфейсов с информацией о поддерживаемых чипсетах/картах. Если вы сомневаетесь в том, какой драйвер подойдет, прочтите страницу справочника к драйверу. Страница справочника содержит больше информации о поддерживаемом оборудовании и даже о проблемах, которые могут возникнуть.</p></div><div class=paragraph><p>Если ваша карта широко распространена, вам скорее всего не потребуется долго искать драйвер. Драйверы для широко распространенных карт представлены в ядре <span class=filename>GENERIC</span>, так что ваша карта должна определиться при загрузке, примерно так:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>dc0: &lt;82c169 PNIC 10/100BaseTX&gt; port 0xa000-0xa0ff mem 0xd3800000-0xd38
000ff irq 15 at device 11.0 on pci0
dc0: Ethernet address: 00:a0:cc:da:da:da
miibus0: &lt;MII bus&gt; on dc0
ukphy0: &lt;Generic IEEE 802.3u media interface&gt; on miibus0
ukphy0:  10baseT, 10baseT-FDX, 100baseTX, 100baseTX-FDX, auto
dc1: &lt;82c169 PNIC 10/100BaseTX&gt; port 0x9800-0x98ff mem 0xd3000000-0xd30
000ff irq 11 at device 12.0 on pci0
dc1: Ethernet address: 00:a0:cc:da:da:db
miibus1: &lt;MII bus&gt; on dc1
ukphy1: &lt;Generic IEEE 802.3u media interface&gt; on miibus1
ukphy1:  10baseT, 10baseT-FDX, 100baseTX, 100baseTX-FDX, auto</code></pre></div></div><div class=paragraph><p>В этом примере две карты используют имеющийся в системе драйвер <a href="https://man.freebsd.org/cgi/man.cgi?query=dc&amp;sektion=4&amp;format=html">dc(4)</a>.</p></div><div class=paragraph><p>Если драйвер вашей сетевой карты отсутствует в <span class=filename>GENERIC</span>, для ее использования потребуется загрузить подходящий драйвер. Это может быть сделано одним из двух способов:</p></div><div class=ulist><ul><li><p>Простейший способ - просто загрузить модуль ядра сетевой карты с помощью <a href="https://man.freebsd.org/cgi/man.cgi?query=kldload&amp;sektion=8&amp;format=html">kldload(8)</a>. Не все драйверы доступны в виде модулей; например, модули отсутствуют для ISA карт.</p></li><li><p>Вместо этого, вы можете статически включить поддержку карты, скомпилировав собственное ядро. Информацию о том, какие параметры нужно включать в ядро, можно получить из <span class=filename>/usr/src/sys/conf/NOTES</span>, <span class=filename>/usr/src/sys/arch/conf/NOTES</span> и страницы справочника драйвера сетевой карты. За более подробной информацией о сборке собственного ядра обращайтесь к <a href=../kernelconfig/#kernelconfig>Настройка ядра FreeBSD</a>. Если карта была обнаружена вашим ядром (<span class=filename>GENERIC</span>) во время загрузки, собирать ядро не потребуется.</p></li></ul></div></div><div class=sect2><h3 id=_настройка_сетевой_карты>12.8.2. Настройка сетевой карты<a class=anchor href=#_настройка_сетевой_карты></a></h3><div class=paragraph><p>Как только для сетевой карты загружен подходящий драйвер, ее потребуется настроить. Как и многое другое, сетевая карта может быть настроена во время установки с помощью sysinstall.</p></div><div class=paragraph><p>Для вывода информации о настройке сетевых интерфейсов системы, введите следующую команду:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% ifconfig
dc0: <span class=nv>flags</span><span class=o>=</span>8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500
        inet 192.168.1.3 netmask 0xffffff00 broadcast 192.168.1.255
        ether 00:a0:cc:da:da:da
        media: Ethernet autoselect <span class=o>(</span>100baseTX &lt;full-duplex&gt;<span class=o>)</span>
        status: active
dc1: <span class=nv>flags</span><span class=o>=</span>8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500
        inet 10.0.0.1 netmask 0xffffff00 broadcast 10.0.0.255
        ether 00:a0:cc:da:da:db
        media: Ethernet 10baseT/UTP
        status: no carrier
lp0: <span class=nv>flags</span><span class=o>=</span>8810&lt;POINTOPOINT,SIMPLEX,MULTICAST&gt; mtu 1500
lo0: <span class=nv>flags</span><span class=o>=</span>8049&lt;UP,LOOPBACK,RUNNING,MULTICAST&gt; mtu 16384
        inet 127.0.0.1 netmask 0xff000000
tun0: <span class=nv>flags</span><span class=o>=</span>8010&lt;POINTOPOINT,MULTICAST&gt; mtu 1500</code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Старые версии FreeBSD могут потребовать запуска <a href="https://man.freebsd.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;format=html">ifconfig(8)</a> с параметром <code>-a</code>, за более подробным описанием синтаксиса <a href="https://man.freebsd.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;format=html">ifconfig(8)</a> обращайтесь к странице справочника. Учтите также, что строки, относящиеся к IPv6 (<code>inet6</code> и т.п.) убраны из этого примера.</p></div></td></tr></tbody></table></div><div class=paragraph><p>В этом примере были показаны следующие устройства:</p></div><div class=ulist><ul><li><p><span class=filename>dc0</span>: первый Ethernet интерфейс</p></li><li><p><span class=filename>dc1</span>: второй Ethernet интерфейс</p></li><li><p><span class=filename>lp0</span>: интерфейс параллельного порта</p></li><li><p><span class=filename>lo0</span>: устройство loopback</p></li><li><p><span class=filename>tun0</span>: туннельное устройство, используемое ppp</p></li></ul></div><div class=paragraph><p>Для присвоения имени сетевой карте FreeBSD использует имя драйвера и порядковый номер, в котором карта обнаруживается при инициализации устройств. Например, <span class=filename>sis2</span> это третья сетевая карта, использующая драйвер <a href="https://man.freebsd.org/cgi/man.cgi?query=sis&amp;sektion=4&amp;format=html">sis(4)</a>.</p></div><div class=paragraph><p>В этом примере, устройство <span class=filename>dc0</span> включено и работает. Ключевые признаки таковы:</p></div><div class="olist arabic"><ol class=arabic><li><p><code>UP</code> означает, что карта настроена и готова.</p></li><li><p>У карты есть интернет (<code>inet</code>) адрес (в данном случае <code>192.168.1.3</code>).</p></li><li><p>Установлена маска подсети (<code>netmask</code>; <code>0xffffff00</code>, то же, что и <code>255.255.255.0</code>).</p></li><li><p>Широковещательный адрес (в данном случае, <code>192.168.1.255</code>).</p></li><li><p>Значение MAC адреса карты (<code>ether</code>) <code>00:a0:cc:da:da:da</code></p></li><li><p>Выбор физической среды передачи данных в режиме автовыбора (<code>media: Ethernet autoselect (100baseTX full-duplex)</code>). Мы видим, что <span class=filename>dc1</span> была настроена для работы с <code>10baseT/UTP</code>. За более подробной информацией о доступных драйверу типах среды обращайтесь к странице справочника.</p></li><li><p>Статус соединения (<code>status</code>) <code>active</code>, т.е. несущая обнаружена. Для <span class=filename>dc1</span>, мы видим <code>status: no carrier</code>. Это нормально, когда Ethernet кабель не подключен к карте.</p></li></ol></div><div class=paragraph><p>Если <a href="https://man.freebsd.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;format=html">ifconfig(8)</a> показывает примерно следующее:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>dc0: <span class=nv>flags</span><span class=o>=</span>8843&lt;BROADCAST,SIMPLEX,MULTICAST&gt; mtu 1500
	        ether 00:a0:cc:da:da:da</code></pre></div></div><div class=paragraph><p>это означает, что карта не была настроена.</p></div><div class=paragraph><p>Для настройки карты вам потребуются привилегии пользователя <code>root</code>. Настройка сетевой карты может быть выполнена из командной строки с помощью <a href="https://man.freebsd.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;format=html">ifconfig(8)</a>, но вам потребуется делать это после каждой перезагрузки системы. Подходящее место для настройки сетевых карт это файл <span class=filename>/etc/rc.conf</span>.</p></div><div class=paragraph><p>Откройте <span class=filename>/etc/rc.conf</span> в текстовом редакторе. Вам потребуется добавить строку для каждой сетевой карты, имеющейся в системе, например, в нашем случае, было добавлено две строки:</p></div><div class="literalblock programlisting"><div class=content><pre>ifconfig_dc0=&#34;inet 192.168.1.3 netmask 255.255.255.0&#34;
ifconfig_dc1=&#34;inet 10.0.0.1 netmask 255.255.255.0 media 10baseT/UTP&#34;</pre></div></div><div class=paragraph><p>Замените <span class=filename>dc0</span>, <span class=filename>dc1</span>, и так далее на соответствующие имена ваших карт, подставьте соответствующие адреса. Обратитесь к страницам справочника сетевой карты и <a href="https://man.freebsd.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;format=html">ifconfig(8)</a>, за подробной информацией о доступных опциях и к странице справочника <a href="https://man.freebsd.org/cgi/man.cgi?query=rc.conf&amp;sektion=5&amp;format=html">rc.conf(5)</a> за дополнительной информацией о синтаксисе <span class=filename>/etc/rc.conf</span>.</p></div><div class=paragraph><p>Если вы настроили сетевую карту в процессе установки системы, некоторые строки, касающиеся сетевой карты, могут уже присутствовать. Внимательно проверьте <span class=filename>/etc/rc.conf</span> перед добавлением каких-либо строк.</p></div><div class=paragraph><p>Отредактируйте также файл <span class=filename>/etc/hosts</span> для добавления имен и IP адресов различных компьютеров сети, если их еще там нет. За дополнительной информацией обращайтесь к man.hosts.5; и к <span class=filename>/usr/shared/examples/etc/hosts</span>.</p></div></div><div class=sect2><h3 id=_тестирование_и_решение_проблем>12.8.3. Тестирование и решение проблем<a class=anchor href=#_тестирование_и_решение_проблем></a></h3><div class=paragraph><p>Как только вы внесете необходимые изменения в <span class=filename>/etc/rc.conf</span>, перегрузите компьютер. Изменения настроек интерфейсов будут применены, кроме того будет проверена правильность настроек.</p></div><div class=paragraph><p>Как только система перезагрузится, проверьте сетевые интерфейсы.</p></div><div class=sect3><h4 id=_проверка_ethernet_карты>12.8.3.1. Проверка Ethernet карты<a class=anchor href=#_проверка_ethernet_карты></a></h4><div class=paragraph><p>Для проверки правильности настройки сетевой карты, попробуйте выполнить ping для самого интерфейса, а затем для другой машины в локальной сети.</p></div><div class=paragraph><p>Сначала проверьте локальный интерфейс:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% ping <span class=nt>-c5</span> 192.168.1.3
PING 192.168.1.3 <span class=o>(</span>192.168.1.3<span class=o>)</span>: 56 data bytes
64 bytes from 192.168.1.3: <span class=nv>icmp_seq</span><span class=o>=</span>0 <span class=nv>ttl</span><span class=o>=</span>64 <span class=nb>time</span><span class=o>=</span>0.082 ms
64 bytes from 192.168.1.3: <span class=nv>icmp_seq</span><span class=o>=</span>1 <span class=nv>ttl</span><span class=o>=</span>64 <span class=nb>time</span><span class=o>=</span>0.074 ms
64 bytes from 192.168.1.3: <span class=nv>icmp_seq</span><span class=o>=</span>2 <span class=nv>ttl</span><span class=o>=</span>64 <span class=nb>time</span><span class=o>=</span>0.076 ms
64 bytes from 192.168.1.3: <span class=nv>icmp_seq</span><span class=o>=</span>3 <span class=nv>ttl</span><span class=o>=</span>64 <span class=nb>time</span><span class=o>=</span>0.108 ms
64 bytes from 192.168.1.3: <span class=nv>icmp_seq</span><span class=o>=</span>4 <span class=nv>ttl</span><span class=o>=</span>64 <span class=nb>time</span><span class=o>=</span>0.076 ms

<span class=nt>---</span> 192.168.1.3 ping statistics <span class=nt>---</span>
5 packets transmitted, 5 packets received, 0% packet loss
round-trip min/avg/max/stddev <span class=o>=</span> 0.074/0.083/0.108/0.013 ms</code></pre></div></div><div class=paragraph><p>Затем проверьте другую машину в локальной сети:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% ping <span class=nt>-c5</span> 192.168.1.2
PING 192.168.1.2 <span class=o>(</span>192.168.1.2<span class=o>)</span>: 56 data bytes
64 bytes from 192.168.1.2: <span class=nv>icmp_seq</span><span class=o>=</span>0 <span class=nv>ttl</span><span class=o>=</span>64 <span class=nb>time</span><span class=o>=</span>0.726 ms
64 bytes from 192.168.1.2: <span class=nv>icmp_seq</span><span class=o>=</span>1 <span class=nv>ttl</span><span class=o>=</span>64 <span class=nb>time</span><span class=o>=</span>0.766 ms
64 bytes from 192.168.1.2: <span class=nv>icmp_seq</span><span class=o>=</span>2 <span class=nv>ttl</span><span class=o>=</span>64 <span class=nb>time</span><span class=o>=</span>0.700 ms
64 bytes from 192.168.1.2: <span class=nv>icmp_seq</span><span class=o>=</span>3 <span class=nv>ttl</span><span class=o>=</span>64 <span class=nb>time</span><span class=o>=</span>0.747 ms
64 bytes from 192.168.1.2: <span class=nv>icmp_seq</span><span class=o>=</span>4 <span class=nv>ttl</span><span class=o>=</span>64 <span class=nb>time</span><span class=o>=</span>0.704 ms

<span class=nt>---</span> 192.168.1.2 ping statistics <span class=nt>---</span>
5 packets transmitted, 5 packets received, 0% packet loss
round-trip min/avg/max/stddev <span class=o>=</span> 0.700/0.729/0.766/0.025 ms</code></pre></div></div><div class=paragraph><p>Вы можете также использовать имя машины вместо <code>192.168.1.2</code>, если настроен файл <span class=filename>/etc/hosts</span>.</p></div></div><div class=sect3><h4 id=_решение_проблем>12.8.3.2. Решение проблем<a class=anchor href=#_решение_проблем></a></h4><div class=paragraph><p>Решение проблем с аппаратным и программным обеспечением всегда вызывает сложности, которые можно уменьшить, проверив сначала самые простые варианты. Подключен ли сетевой кабель? Правильно ли настроены сетевые сервисы? Правильно ли настроен брандмауэр? Поддерживается ли используемая карта в FreeBSD? Всегда проверяйте информацию об оборудовании перед отправкой сообщения об ошибке. Обновите FreeBSD до последней версии STABLE. Просмотрите архивы списков рассылки, или поищите информацию в интернет.</p></div><div class=paragraph><p>Если карта работает, но производительность низка, может помочь чтение страницы справочника <a href="https://man.freebsd.org/cgi/man.cgi?query=tuning&amp;sektion=7&amp;format=html">tuning(7)</a>. Проверьте также настройки сети, поскольку неправильные настройки могут стать причиной низкой скорости соединения.</p></div><div class=paragraph><p>Некоторые пользователи встречаются с несколькими <code>device timeouts</code>, что нормально для некоторых сетевых карт. Если это продолжается и надоедает, убедитесь, что устройство не конфликтует с другим устройством. Внимательно проверьте подключение кабеля. Возможно также, что вам просто надо установить другую карту.</p></div><div class=paragraph><p>Время от времени, пользователи видят несколько ошибок <code>watchdog timeout</code>. Первое, что требуется сделать, это проверить сетевой кабель. Многие карты требуют поддержки Bus Mastering слотом PCI. На некоторых старых материнских платах, только один PCI слот имеет такую поддержку (обычно слот 0). Сверьтесь с документацией на сетевую карту и материнскую плату, чтобы определить, может ли это быть проблемой.</p></div><div class=paragraph><p>Сообщение <code>No route to host</code> появляются, если система не в состоянии доставить пакеты к хосту назначения. Это может случиться, если не определен маршрут по умолчанию, или кабель не подключен. Проверьте вывод команды <code>netstat -rn</code> и убедитесь, что к соответствующему хосту есть работающий маршрут. Если это не так, прочтите <a href=../advanced-networking/#advanced-networking>Сложные вопросы работы в сети</a>.</p></div><div class=paragraph><p>Сообщения <code>ping: sendto: Permission denied</code> зачастую появляются при неправильно настроенном брандмауэре. Если <code>ipfw</code> включен в ядре, но правила не определены, правило по умолчанию блокирует весь трафик, даже запросы ping! Прочтите <a href=../firewalls/#firewalls>Межсетевые экраны</a> с более подробной информацией.</p></div><div class=paragraph><p>Иногда скорость карты недостаточна, или ниже среднего. В этих случаях лучше всего изменить режим выбора типа подключения с <code>autoselect</code> на правильный тип. Обычно это работает для большинства оборудования, но не может решить проблему во всех случаях. Проверьте еще раз настройки сети и прочтите страницу справочника <a href="https://man.freebsd.org/cgi/man.cgi?query=tuning&amp;sektion=7&amp;format=html">tuning(7)</a>.</p></div></div></div></div></div><div class=sect1><h2 id=configtuning-virtual-hosts>12.9. Настройка виртуальных серверов<a class=anchor href=#configtuning-virtual-hosts></a></h2><div class=sectionbody><div class=paragraph><p>Очень часто FreeBSD используется для размещения сайтов, когда один сервер работает в сети как несколько серверов. Это достигается присвоением нескольких сетевых адресов одному интерфейсу.</p></div><div class=paragraph><p>У сетевого интерфейса всегда есть один "настоящий" адрес, хотя он может иметь любое количество "синонимов" (alias). Эти синонимы обычно добавляются путём помещения соответствующих записей в <span class=filename>/etc/rc.conf</span>.</p></div><div class=paragraph><p>Синоним для интерфейса <span class=filename>fxp0</span> выглядит следующим образом:</p></div><div class="literalblock programlisting"><div class=content><pre>ifconfig_fxp0_alias0=&#34;inet xxx.xxx.xxx.xxx netmask xxx.xxx.xxx.xxx&#34;</pre></div></div><div class=paragraph><p>Заметьте, что записи синонимов должны начинаться с <code>alias0</code> и идти далее в определенном порядке (например, <code>_alias1</code>, <code>_alias2</code>, и т.д.). Конфигурационный процесс остановится на первом по порядку отсутствующем числе.</p></div><div class=paragraph><p>Определение маски подсети для синонима очень важно, но к счастью, так же просто. Для каждого интерфейса должен быть один адрес с истинной маской подсети. Любой другой адрес в сети должен иметь маску подсети, состоящую из всех единичек (что выражается как <code>255.255.255.255</code> или как <code>0xffffffff</code>).</p></div><div class=paragraph><p>Например, рассмотрим случай, когда интерфейс <span class=filename>fxp0</span> подключён к двум сетям, к сети <code>10.1.1.0</code> с маской подсети <code>255.255.255.0</code> и к сети <code>202.0.75.16</code> с маской <code>255.255.255.240</code>. Мы хотим, чтобы система была видна по IP, начиная с <code>10.1.1.1</code> по <code>10.1.1.5</code> и с <code>202.0.75.17</code> по <code>202.0.75.20</code>. Как было сказано выше, только первый адрес в заданном диапазоне (в данном случае, <code>10.0.1.1</code> и <code>202.0.75.17</code>) должен иметь реальную маску сети; все остальные (с <code>10.1.1.2</code> по <code>10.1.1.5</code> и с <code>202.0.75.18</code> по <code>202.0.75.20</code>) должны быть сконфигурированы с маской сети <code>255.255.255.255</code>.</p></div><div class=paragraph><p>Для этого в файл <span class=filename>/etc/rc.conf</span> должны быть внесены следующие записи:</p></div><div class="literalblock programlisting"><div class=content><pre>ifconfig_fxp0=&#34;inet 10.1.1.1 netmask 255.255.255.0&#34;
ifconfig_fxp0_alias0=&#34;inet 10.1.1.2 netmask 255.255.255.255&#34;
ifconfig_fxp0_alias1=&#34;inet 10.1.1.3 netmask 255.255.255.255&#34;
ifconfig_fxp0_alias2=&#34;inet 10.1.1.4 netmask 255.255.255.255&#34;
ifconfig_fxp0_alias3=&#34;inet 10.1.1.5 netmask 255.255.255.255&#34;
ifconfig_fxp0_alias4=&#34;inet 202.0.75.17 netmask 255.255.255.240&#34;
ifconfig_fxp0_alias5=&#34;inet 202.0.75.18 netmask 255.255.255.255&#34;
ifconfig_fxp0_alias6=&#34;inet 202.0.75.19 netmask 255.255.255.255&#34;
ifconfig_fxp0_alias7=&#34;inet 202.0.75.20 netmask 255.255.255.255&#34;</pre></div></div></div></div><div class=sect1><h2 id=configtuning-configfiles>12.10. Файлы настройки<a class=anchor href=#configtuning-configfiles></a></h2><div class=sectionbody><div class=sect2><h3 id=_каталог_etc>12.10.1. Каталог <span class=filename>/etc</span><a class=anchor href=#_каталог_etc></a></h3><div class=paragraph><p>Во FreeBSD определён ряд каталогов, предназначенных для хранения конфигурационных файлов. Это:</p></div><table class="tableblock frame-none grid-all stretch informaltable"><col style=width:50%><col style=width:50%><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/etc</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Основные файлы конфигурации системы. Тут размещены системно-зависимые данные.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/etc/defaults</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Версии системных конфигурационных файлов по умолчанию.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/etc/mail</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Дополнительные конфигурационные файлы <a href="https://man.freebsd.org/cgi/man.cgi?query=sendmail&amp;sektion=8&amp;format=html">sendmail(8)</a>, другие конфигурационные файлы MTA.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/etc/ppp</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Настройка для user- и kernel-ppp программ.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/etc/namedb</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Основное место расположения данных <a href="https://man.freebsd.org/cgi/man.cgi?query=named&amp;sektion=8&amp;format=html">named(8)</a>. Обычно <span class=filename>named.conf</span> и файлы зон расположены здесь.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/usr/local/etc</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Конфигурационные файлы установленных приложений. Могут содержать подкаталоги приложений.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/usr/local/etc/rc.d</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Скрипты запуска/остановки установленных приложений.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>/var/db</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Автоматически генерируемые системно-специфичные файлы баз данных, такие как база данных пакетов, и так далее</p></td></tr></tbody></table></div><div class=sect2><h3 id=_имена_хостов>12.10.2. Имена хостов<a class=anchor href=#_имена_хостов></a></h3><div class=sect3><h4 id=_etcresolv_conf>12.10.2.1. <span class=filename>/etc/resolv.conf</span><a class=anchor href=#_etcresolv_conf></a></h4><div class=paragraph><p><span class=filename>/etc/resolv.conf</span> определяет, как резолвер (resolver) FreeBSD получает доступ к Системе Доменных Имён (DNS).</p></div><div class=paragraph><p>Основные записи <span class=filename>resolv.conf</span>:</p></div><table class="tableblock frame-none grid-all stretch informaltable"><col style=width:50%><col style=width:50%><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>nameserver</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>IP адрес сервера имён. Сервера опрашиваются в порядке описания. Максимальное количество адресов - три.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>search</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Список доменов для поиска с помощью hostname lookup. Обычно определяется доменом, в котором находится компьютер.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>domain</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Домен, в котором находится компьютер.</p></td></tr></tbody></table><div class=paragraph><p>Типичный вид <span class=filename>resolv.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>search example.com
nameserver 147.11.1.11
nameserver 147.11.100.30</pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Опции <code>search</code> и <code>domain</code> нельзя использовать совместно.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Если вы используете DHCP, <a href="https://man.freebsd.org/cgi/man.cgi?query=dhclient&amp;sektion=8&amp;format=html">dhclient(8)</a> обычно перезаписывает <span class=filename>resolv.conf</span> информацией, полученной от серверов DHCP.</p></div></div><div class=sect3><h4 id=_etchosts>12.10.2.2. <span class=filename>/etc/hosts</span><a class=anchor href=#_etchosts></a></h4><div class=paragraph><p><span class=filename>/etc/hosts</span> - простая текстовая база данных, напоминающая старый Интернет. Она работает совместно с DNS и NIS, сопоставляя доменные имена IP адресу. Отдельные компьютеры, соединённые с помощью локальной сети, могут быть записаны тут вместо <a href="https://man.freebsd.org/cgi/man.cgi?query=named&amp;sektion=8&amp;format=html">named(8)</a> сервера с целью упрощения. Кроме того, <span class=filename>/etc/hosts</span> используется для записи IP адресов и соответствующих им доменов, избавляя от внешнего трафика, используемого для запросов к DNS серверам.</p></div><div class="literalblock programlisting"><div class=content><pre># $FreeBSD$
#
# Host Database
# This file should contain the addresses and aliases
# for local hosts that share this file.
# In the presence of the domain name service or NIS, this file may
# not be consulted at all; see /etc/nsswitch.conf for the resolution order.
#
#
::1                     localhost localhost.my.domain myname.my.domain
127.0.0.1               localhost localhost.my.domain myname.my.domain

#
# Imaginary network.
#10.0.0.2               myname.my.domain myname
#10.0.0.3               myfriend.my.domain myfriend
#
# According to RFC 1918, you can use the following IP networks for
# private nets which will never be connected to the Internet:
#
#       10.0.0.0        -   10.255.255.255
#       172.16.0.0      -   172.31.255.255
#       192.168.0.0     -   192.168.255.255
#
# In case you want to be able to connect to the Internet, you need
# real official assigned numbers.  PLEASE PLEASE PLEASE do not try
# to invent your own network numbers but instead get one from your
# network provider (if any) or from the Internet Registry (ftp to
# rs.internic.net, directory `/templates&#39;).
#</pre></div></div><div class=paragraph><p>Формат <span class=filename>/etc/hosts</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>[IP адрес в Интернете] [имя компьютера] [alias1] [alias2] ...</pre></div></div><div class=paragraph><p>Например:</p></div><div class="literalblock programlisting"><div class=content><pre>10.0.0.1 myRealHostname.example.com myRealHostname foobar1 foobar2</pre></div></div><div class=paragraph><p>За дополнительной информацией обращайтесь к <a href="https://man.freebsd.org/cgi/man.cgi?query=hosts&amp;sektion=5&amp;format=html">hosts(5)</a>.</p></div></div></div><div class=sect2><h3 id=_настройка_лог_файлов>12.10.3. Настройка лог файлов<a class=anchor href=#_настройка_лог_файлов></a></h3><div class=sect3><h4 id=_syslog_conf>12.10.3.1. <span class=filename>syslog.conf</span><a class=anchor href=#_syslog_conf></a></h4><div class=paragraph><p><span class=filename>syslog.conf</span> is является файлом конфигурации для <a href="https://man.freebsd.org/cgi/man.cgi?query=syslogd&amp;sektion=8&amp;format=html">syslogd(8)</a>. В нём указываются, типы сообщений генерируемые <code>syslog</code>, и лог файлы, в которые они записываются.</p></div><div class="literalblock programlisting"><div class=content><pre># $FreeBSD$
#
#       Spaces ARE valid field separators in this file. However,
#       other *nix-like systems still insist on using tabs as field
#       separators. If you are sharing this file between systems, you
#       may want to use only tabs as field separators here.
#       Consult the syslog.conf(5) manual page.
*.err;kern.debug;auth.notice;mail.crit          /dev/console
*.notice;kern.debug;lpr.info;mail.crit;news.err /var/log/messages
security.*                                      /var/log/security
mail.info                                       /var/log/maillog
lpr.info                                        /var/log/lpd-errs
cron.*                                          /var/log/cron
*.err                                           root
*.notice;news.err                               root
*.alert                                         root
*.emerg                                         *
# uncomment this to log all writes to /dev/console to /var/log/console.log
#console.info                                   /var/log/console.log
# uncomment this to enable logging of all log messages to /var/log/all.log
#*.*                                            /var/log/all.log
# uncomment this to enable logging to a remote log host named loghost
#*.*                                            @loghost
# uncomment these if you&#39;re running inn
# news.crit                                     /var/log/news/news.crit
# news.err                                      /var/log/news/news.err
# news.notice                                   /var/log/news/news.notice
!startslip
*.*                                             /var/log/slip.log
!ppp
*.*                                             /var/log/ppp.log</pre></div></div><div class=paragraph><p>За более полной информацией обратитесь к <a href="https://man.freebsd.org/cgi/man.cgi?query=syslog.conf&amp;sektion=5&amp;format=html">syslog.conf(5)</a>.</p></div></div><div class=sect3><h4 id=_newsyslog_conf>12.10.3.2. <span class=filename>newsyslog.conf</span><a class=anchor href=#_newsyslog_conf></a></h4><div class=paragraph><p><span class=filename>newsyslog.conf</span> - конфигурационный файл <a href="https://man.freebsd.org/cgi/man.cgi?query=newsyslog&amp;sektion=8&amp;format=html">newsyslog(8)</a>, программы, обычно контролируемой <a href="https://man.freebsd.org/cgi/man.cgi?query=cron&amp;sektion=8&amp;format=html">cron(8)</a>. <a href="https://man.freebsd.org/cgi/man.cgi?query=newsyslog&amp;sektion=8&amp;format=html">newsyslog(8)</a> определяет, когда лог-файлы нуждаются в архивировании и перегруппировке. <span class=filename>logfile</span> перемещается в <span class=filename>logfile.0</span>, <span class=filename>logfile.0</span> перемещается в <span class=filename>logfile.1</span>, и так далее. Другое именование получится при архивировании с помощью <a href="https://man.freebsd.org/cgi/man.cgi?query=gzip&amp;sektion=1&amp;format=html">gzip(1)</a>: <span class=filename>logfile.0.gz</span>, <span class=filename>logfile.1.gz</span>, и т.д.</p></div><div class=paragraph><p><span class=filename>newsyslog.conf</span> показывает, какие лог файлы должны быть проинспектированы, сколько их должно быть сохранено, и когда они должны быть пересмотрены. Лог файлы могут быть перегруппированы и/или заархивированы, когда они либо достигнут определённого размера, либо при достижении определённых даты/времени.</p></div><div class="literalblock programlisting"><div class=content><pre># configuration file for newsyslog
# $FreeBSD$
#
# filename          [owner:group]    mode count size when [ZB] [/pid_file] [sig_num]
/var/log/cron                           600  3     100  *     Z
/var/log/amd.log                        644  7     100  *     Z
/var/log/kerberos.log                   644  7     100  *     Z
/var/log/lpd-errs                       644  7     100  *     Z
/var/log/maillog                        644  7     *    @T00  Z
/var/log/sendmail.st                    644  10    *    168   B
/var/log/messages                       644  5     100  *     Z
/var/log/all.log                        600  7     *    @T00  Z
/var/log/slip.log                       600  3     100  *     Z
/var/log/ppp.log                        600  3     100  *     Z
/var/log/security                       600  10    100  *     Z
/var/log/wtmp                           644  3     *    @01T05 B
/var/log/daily.log                      640  7     *    @T00  Z
/var/log/weekly.log                     640  5     1    $W6D0 Z
/var/log/monthly.log                    640  12    *    $M1D0 Z
/var/log/console.log                    640  5     100  *     Z</pre></div></div><div class=paragraph><p>За дополнительной информацией обращайтесь к <a href="https://man.freebsd.org/cgi/man.cgi?query=newsyslog&amp;sektion=8&amp;format=html">newsyslog(8)</a>.</p></div></div></div><div class=sect2><h3 id=configtuning-sysctlconf>12.10.4. <span class=filename>sysctl.conf</span><a class=anchor href=#configtuning-sysctlconf></a></h3><div class=paragraph><p><span class=filename>sysctl.conf</span> очень похож на <span class=filename>rc.conf</span>. Значения устанавливаются в виде <code>variable=value</code>. Указанные значения устанавливаются после перевода системы в многопользовательский режим. Однако не все переменные могут быть установлены в этом режиме.</p></div><div class=paragraph><p>Пример <span class=filename>sysctl.conf</span>, настроенного для выключения протоколирования фатальных ошибок программ и разрешения Linux-программам определять, что они запускаются под FreeBSD:</p></div><div class="literalblock programlisting"><div class=content><pre>kern.logsigexit=0       # Do not log fatal signal exits (e.g. sig 11)
compat.linux.osname=FreeBSD
compat.linux.osrelease=4.3-STABLE</pre></div></div></div></div></div><div class=sect1><h2 id=configtuning-sysctl>12.11. Настройка с помощью sysctl<a class=anchor href=#configtuning-sysctl></a></h2><div class=sectionbody><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a> - это интерфейс, позволяющий вам вносить изменения в работающую систему FreeBSD. Эти изменения касаются многих опций стека TCP/IP и виртуальной памяти; опытный системный администратор может использовать их для существенного увеличения производительности. Более пяти тысяч системных переменных могут быть прочитаны и записаны с помощью <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a>.</p></div><div class=paragraph><p>По своей сути, <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a> выполняет две функции: чтение и изменение настроек системы.</p></div><div class=paragraph><p>Для просмотра всех доступных для чтения переменных:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% sysctl <span class=nt>-a</span></code></pre></div></div><div class=paragraph><p>Чтобы прочитать определённую переменную, например, <code>kern.maxproc</code>, введите:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% sysctl kern.maxproc
kern.maxproc: 1044</code></pre></div></div><div class=paragraph><p>Для присвоения значения переменной, используйте выражение вида <em>переменная</em>=<em>значение</em>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sysctl kern.maxfiles=5000</span>
kern.maxfiles: 2088 -&gt; 5000</code></pre></div></div><div class=paragraph><p>Изменяемые с помощью sysctl переменные обычно принимают значения либо строкового, либо целого, либо булевого типа. Переменные булевого типа могут принимать два значения (<code>1</code> (истина) и <code>0</code> (ложь)).</p></div><div class=paragraph><p>Если вы хотите устанавливать некоторые переменные автоматически при каждой загрузке компьютера, добавьте их в файл <span class=filename>/etc/sysctl.conf</span>. За дополнительной информацией обращайтесь к странице справочника <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl.conf&amp;sektion=5&amp;format=html">sysctl.conf(5)</a> и к <a href=#configtuning-sysctlconf><span class=filename>sysctl.conf</span></a>.</p></div><div class=sect2><h3 id=sysctl-readonly>12.11.1. Переменные <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a> только для чтения<a class=anchor href=#sysctl-readonly></a></h3><div class=paragraph><p>В некоторых случаях желательно изменить переменные <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a> только для чтения. Иногда другого способа решить проблему нет; при этом, результат может быть достигнут только на этапе начальной загрузки.</p></div><div class=paragraph><p>Например, на некоторых моделях лэптопов диапазон памяти устройства <a href="https://man.freebsd.org/cgi/man.cgi?query=cardbus&amp;sektion=4&amp;format=html">cardbus(4)</a> не определяется и выдается приблизительно такая ошибка:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>cbb0: Could not map register memory
device_probe_and_attach: cbb0 attach returned 12</code></pre></div></div><div class=paragraph><p>Ситуации, похожие на эту, требуют изменения некоторых значений <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a>, модификация которых запрещена. Для разрешения этой ситуации пользователь может поместить <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a> "OID" в файл <span class=filename>/boot/loader.conf</span>. Значения по умолчанию хранятся в файле <span class=filename>/boot/defaults/loader.conf</span>.</p></div><div class=paragraph><p>Решение проблемы, приведенной выше, потребует помещения строки <code>hw.pci.allow_unsupported_io_range=1</code> в вышеупомянутый файл. Теперь <a href="https://man.freebsd.org/cgi/man.cgi?query=cardbus&amp;sektion=4&amp;format=html">cardbus(4)</a> будет работать нормально.</p></div></div></div></div><div class=sect1><h2 id=configtuning-disk>12.12. Оптимизация дисков<a class=anchor href=#configtuning-disk></a></h2><div class=sectionbody><div class=sect2><h3 id=_переменные_sysctl>12.12.1. Переменные Sysctl<a class=anchor href=#_переменные_sysctl></a></h3><div class=sect3><h4 id=_vfs_vmiodirenable>12.12.1.1. <code>vfs.vmiodirenable</code><a class=anchor href=#_vfs_vmiodirenable></a></h4><div class=paragraph><p>Значением переменной <code>vfs.vmiodirenable</code> может быть установлено в 0 (выключено) или 1 (включено); по умолчанию 1. Эта переменная отвечает за метод кэширования каталогов. Размер большинства каталогов невелик. Они могут поместиться в одном фрагменте (обычно 1K), и могут занимать ещё меньше места (обычно 512 байт) в кэше буфера. При отключении этой переменной (при установке значения 0) буфер прокэширует только заданное число каталогов даже если у вас много памяти. При включении (при установке значения 1) эта переменная sysctl позволит использовать страничное кэширование VM, делая доступным для кэширования каталогов весь объём памяти. Однако, минимальный объём памяти, используемой для кэширования каталогов стал равен объёму страницы (обычно 4 K) вместо 512 байт. Мы рекомендуем оставлять эту опцию включенной, если ваш компьютер исполняет программы, манипулирующие значительным количеством файлов. Примером таких программ могут быть кэширующие прокси-серверы, большие почтовые серверы и серверы новостей. Обычно включение этой опции не понижает производительности, однако лучше поэкспериментировать, чтобы узнать оптимальное значение для вашей машины.</p></div></div><div class=sect3><h4 id=_vfs_write_behind>12.12.1.2. <code>vfs.write_behind</code><a class=anchor href=#_vfs_write_behind></a></h4><div class=paragraph><p>Переменная sysctl <code>vfs.write_behind</code> по умолчанию установлена в <code>1</code> (включено). Она указывает системе выполнять запись на носитель по кластерам, что обычно делается для больших файлов. Идея в том, чтобы избежать заполнения кэша неполными буферами, когда это не увеличивает производительность. Однако, это может заблокировать процессы и в некоторых случаях вам может понадобиться отключить этот параметр.</p></div></div><div class=sect3><h4 id=_vfs_hirunningspace>12.12.1.3. <code>vfs.hirunningspace</code><a class=anchor href=#_vfs_hirunningspace></a></h4><div class=paragraph><p>Переменная sysctl <code>vfs.hirunningspace</code> определяет число запросов записи на диск, которые могут быть поставлены в очередь. Значение по умолчанию обычно подходит, но на компьютерах с большим количеством дисков вы можете увеличить его до четырех или пяти <em>мегабайт</em>. Учтите, что установка слишком большого значения (превышающего размер буфера записи) может привести к очень значительному падению общей производительности. Не делайте это значение произвольно большим! Большие значения могут привести к задержкам чтения, выполняемого в то же время</p></div><div class=paragraph><p>Есть много других переменных sysctl, относящихся к кэшированию в буфер и страничному кэшированию VM. Мы не рекомендуем изменять эти значения, поскольку система VM делает отличную работу по автоматической самонастройке.</p></div></div><div class=sect3><h4 id=_vm_swap_idle_enabled>12.12.1.4. <code>vm.swap_idle_enabled</code><a class=anchor href=#_vm_swap_idle_enabled></a></h4><div class=paragraph><p>Переменная sysctl <code>vm.swap_idle_enabled</code> полезна в больших многопользовательских системах, где есть много пользователей, входящих и выходящих из системы, и множество ожидающих процессов. Такие системы обычно генерируют большое количество запросов на выделение памяти. Включение этой переменной и настройка задержки выгрузки (swapout hysteresis, в секундах) установкой переменных <code>vm.swap_idle_threshold1</code> и <code>vm.swap_idle_threshold2</code> позволит освобождать страницы памяти, занятые ожидающими процессами, более быстро, чем при нормальном алгоритме выгрузки. Это помогает даемону выгрузки страниц. Не включайте этот параметр, пока он на самом деле вам не понадобится, поскольку его действие в сущности заключается в более ранней выгрузке страниц из памяти; это повышает нагрузку на подкачку и диск. В малых системах эффект от включения этого параметра предсказуем, но в больших системах нагруженной на подкачкой этот параметр позволяет системе VM проще загружать и выгружать процессы из памяти.</p></div></div><div class=sect3><h4 id=_hw_ata_wc>12.12.1.5. <code>hw.ata.wc</code><a class=anchor href=#_hw_ata_wc></a></h4><div class=paragraph><p>Во FreeBSD 4.3 кэширование записи на IDE диски было отключено. Это понижало производительность IDE дисков в тестах, но было необходимо для лучшей сохранности данных. Проблема состоит в том, что IDE диски неправильно указывают время завершения записи на диск. При включенном кэшировании IDE диски могут не только записать данные в неправильном порядке - при большой нагрузке на диск некоторые блоки могут задержаться до бесконечности. Сбой, или отключение питания могут могут стать причиной серьёзных повреждений в файловой системе. Поэтому для безопасности системы значение по умолчанию этого параметра было изменено. К сожалению, результатом этого стало столь значительная потеря производительности, что после выхода релиза значение этого параметра было возвращено в первоначальное состояние. Вам следует проверить значение переменной sysctl <code>hw.ata.wc</code> на вашей машине. Если кэширование выключено - вы можете включить его, установив значение переменной ядра, равное 1. Это должно быть сделано при помощи загрузчика при загрузке. Если вы сделаете это позже - изменения не будут иметь силы.</p></div><div class=paragraph><p>За более подробной информацией обращайтесь к <a href="https://man.freebsd.org/cgi/man.cgi?query=ata&amp;sektion=4&amp;format=html">ata(4)</a>.</p></div></div><div class=sect3><h4 id=_scsi_delay_kern_cam_scsi_delay>12.12.1.6. <code>SCSI_DELAY</code> (<code>kern.cam.scsi_delay</code>)<a class=anchor href=#_scsi_delay_kern_cam_scsi_delay></a></h4><div class=paragraph><p>Параметр настройки ядра <code>SCSI_DELAY</code> может использоваться для уменьшения времени загрузки системы. Значение по умолчанию велико и может составлять более <code>15</code> секунд в процессе загрузки. Уменьшение его до <code>5</code> секунд обычно работает (особенно с современными дисками). В новых версиях FreeBSD (5.0 и выше) должен использоваться параметр <code>kern.cam.scsi_delay</code>, настраиваемый во время загрузки. Этот параметр и параметр настройки ядра принимают значения в <em>миллисекундах</em>, а <em>не</em> в <em>секундах</em>.</p></div></div></div><div class=sect2><h3 id=soft-updates>12.12.2. Soft Updates<a class=anchor href=#soft-updates></a></h3><div class=paragraph><p>Программа <a href="https://man.freebsd.org/cgi/man.cgi?query=tunefs&amp;sektion=8&amp;format=html">tunefs(8)</a> используется для настройки файловой системы. Эта программа может принимать большое количество параметров, но мы рассмотрим лишь один из них - включение и выключение Soft Updates, что может быть достигнуто следующим образом:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># tunefs -n enable /filesystem</span>
<span class=c># tunefs -n disable /filesystem</span></code></pre></div></div><div class=paragraph><p>Нельзя изменять файловую систему с помощью <a href="https://man.freebsd.org/cgi/man.cgi?query=tunefs&amp;sektion=8&amp;format=html">tunefs(8)</a> когда она смонтирована. Самое подходящее время для включения "Soft Updates" - перед монтированием разделов, в однопользовательском режиме.</p></div><div class=paragraph><p>Soft Updates существенно увеличивают скорость создания и удаления файлов путём использования кэширования. Мы рекомендуем использовать Soft Updates на всех ваших файловых системах. Однако у Soft Updates есть и обратные стороны: во-первых, Soft Updates гарантирует целостность файловой системы в случае сбоя, но может наблюдаться задержка в несколько секунд (или даже минуту!) перед записью на жесткий диск. Если система зависнет - вы можете потерять больше, чем, если бы вы не включили Soft Updates. Во-вторых, Soft Updates задерживает освобождение блоков файловой системы. Если ваша файловая система заполнена, выполнение значительного обновления, например, <code>make installworld</code>, может вызвать переполнение.</p></div><div class=sect3><h4 id=_дополнительная_информация_о_soft_updates>12.12.2.1. Дополнительная информация о Soft Updates<a class=anchor href=#_дополнительная_информация_о_soft_updates></a></h4><div class=paragraph><p>Есть два традиционных способа записи метаданных файловых систем на диск (пример метаданных: индексные дескрипторы и каталоги).</p></div><div class=paragraph><p>Исторически, поведение по умолчанию заключается в синхронном обновлении метаданных. Если каталог был изменен, система ждет, пока изменение не будет физически записано на диск. Содержимое файлов проходит через кэш и записывается на диск асинхронно. Преимущество этого способа в его надежности. При сбое во время обновления метаданные остаются в нормальном состоянии. Файл либо создается целиком, либо вообще не создается. Если блоки данных не были записаны в файл из буфера во время сбоя, <a href="https://man.freebsd.org/cgi/man.cgi?query=fsck&amp;sektion=8&amp;format=html">fsck(8)</a> сможет определить это и восстановить файловую систему, установив длину файла в 0. Кроме того, реализация этого способа проста и понятна. Недостаток в том, что обновление метаданных занимает много времени. Команда <code>rm -r</code>, например, последовательно удаляет все файлы в каталоге, и каждое изменение в каталоге (удаление файла) будет синхронно записано на диск. Сюда включаются обновления самого каталога, таблицы индексных дескрипторов, и возможно блоков, занятых файлом. Те же соглашения работают при распаковке больших иерархий (<code>tar -x</code>).</p></div><div class=paragraph><p>Другой вариант это асинхронное обновление метаданных. Это поведение по умолчанию для Linux/ext2fs и *BSD ufs с параметром <code>mount -o async</code>. Все обновления метаданных просто пропускаются через кэш буфера, как и содержимое файлов. Преимущество этой реализации в том, что нет необходимости ждать каждый раз, пока метаданные будут записаны на диск, поэтому все операции с большим объемом обновления метаданных будут происходить гораздо быстрее, чем при синхронном обновлении. Кроме того, реализация все еще проста и понятна, поэтому риск появления ошибок в коде невелик. Недостаток в том, что нет никаких гарантий исправности файловой системы. Если во время обновления большого объема метаданных произойдет сбой (например, отключение питания, или нажатие кнопки reset), файловая система останется в непредсказуемом состоянии. Нет возможности определить состояние файловой системы после такого сбоя; блоки данных файла могут быть уже записаны на диск, а обновления таблицы индексных дескрипторов нет. Невозможно реализовать <code>fsck</code>, которая могла бы исправить получившийся хаос (поскольку необходимой информации нет на диске). Если файловая система была уничтожена во время восстановления, единственный способ восстановления - запустить <a href="https://man.freebsd.org/cgi/man.cgi?query=newfs&amp;sektion=8&amp;format=html">newfs(8)</a> и воспользоваться резервной копией.</p></div><div class=paragraph><p>Обычное решение этой проблемы состояло в реализации <em>протоколировании проблемной области (dirty region logging)</em>, известном как <em>журналирование</em>, хотя этот термин использовался неправильно и порой также применялся к другим формам протоколирования транзакций. Обновление метаданных как и прежде происходит синхронно, но в отдельную область диска. Позже они перемещаются туда, где должны быть. Поскольку область протоколирования это небольшая, последовательная область диска, головкам жесткого диска не приходится перемещаться на большие расстояния даже во время значительных обновлений, поэтому такой способ быстрее, чем синхронные обновления. Кроме того, сложность реализации довольно ограничена, поэтому риск внесения ошибок невелик. Недостаток в том, что все обновления метаданных записываются дважды (один раз в область протоколирования и один раз окончательно), поэтому при обычной работе производительность может понизиться. С другой стороны, в случае сбоя все незаконченные действия с метаданными могут быть быстро отменены, или завершены после загрузки системы, поэтому система после сбоя загружается быстрее.</p></div><div class=paragraph><p>Kirk McKusick, разработчик Berkeley FFS, решил эту проблему с помощью Soft Updates: все незавершенные обновления метаданных находятся в памяти и записываются на диск в упорядоченном виде ("упорядоченное обновления метаданных"). При значительных обновлениях метаданных более поздние обновления "присоединяются" к предыдущим, если они все еще находятся в памяти и еще не записаны на диск. Поэтому все операции, скажем, над каталогом, обычно выполняются в памяти перед записью обновления на диск (блоки данных сортируются в соответствии с их положением, так что они не будут записаны на диск до метаданных. При крахе операционной системы выполняется "откат": считается, что все операции, не записанные на диск, никогда не происходили. Файловая система находится в том состоянии, в котором она была за 30-60 секунд до сбоя. Используемый алгоритм гарантирует, что все используемые ресурсы маркированы соответствующим образом в своих областях: блоки и индексные дескрипторы. После сбоя могут остаться только ошибки выделения ресурсов, они помечаются как "используемые", хотя на самом деле "свободны". <a href="https://man.freebsd.org/cgi/man.cgi?query=fsck&amp;sektion=8&amp;format=html">fsck(8)</a> разбирается в ситуации и освобождает более не используемые ресурсы. После сбоя система может быть безопасно смонтирована с опцией <code>mount -f</code>. Для освобождения ресурсов, которые могут не использоваться, в дальнейшем потребуется запустить <a href="https://man.freebsd.org/cgi/man.cgi?query=fsck&amp;sektion=8&amp;format=html">fsck(8)</a>. Эта идея лежит в основе <em>background (фоновая) fsck</em>: во время запуска системы записывается только <em>снимок</em> файловой системы. Все системы могут быть смонтированы в "грязном" состоянии, и система загружается в многопользовательский режим. Затем, фоновые <code>fsck</code> ставятся в очередь для всех систем, где это требуется, чтобы освободить неиспользуемые ресурсы. (Файловые системы, где не используются Soft Updates, все еще требуют запуска <code>fsck</code> в обычном режиме).</p></div><div class=paragraph><p>Преимущество этого способа в том, что обновления метаданных происходят почти так же быстро, как при асинхронных обновлениях (т.е. быстрее, чем при <em>журналировании</em>, когда метаданные записываются дважды). Недостаток в сложности кода (подразумевающим больший риск появления ошибок в области, где вероятность потери данных пользователя особенно высока) и в более высоких требованиях к объему памяти. К тому же могут возникнуть некоторые странные на первый взгляд ситуации. После сбоя состояние файловой системы несколько более "старое". В ситуации, когда стандартный способ синхронизации оставит несколько файлов нулевой длины после выполнения <code>fsck</code>, в файловой системе с Soft Updates их не останется вовсе, поскольку ни метаданные, ни содержимое файлов не были записаны на диск. Дисковое пространство не будет освобождено пока обновления не будут записаны на диск, что может занять некоторое время после выполнения <code>rm</code>. Это может повлечь проблемы при установке большого количества файлов на файловую систему, где не хватает места для помещения всех файлов дважды.</p></div></div></div></div></div><div class=sect1><h2 id=configtuning-kernel-limits>12.13. Изменение ограничений, накладываемых ядром<a class=anchor href=#configtuning-kernel-limits></a></h2><div class=sectionbody><div class=sect2><h3 id=file-process-limits>12.13.1. Ограничения на Файлы/Процессы<a class=anchor href=#file-process-limits></a></h3><div class=sect3><h4 id=kern-maxfiles>12.13.1.1. <code>kern.maxfiles</code><a class=anchor href=#kern-maxfiles></a></h4><div class=paragraph><p>Значение <code>kern.maxfiles</code> может быть увеличено или уменьшено в зависимости от потребностей вашей системы. Эта переменная определяет максимальное число дескрипторов файлов. Когда таблица дескрипторов файлов полна, в очереди системных сообщений появится сообщение <code>file: table is full</code>. Это сообщение может быть прочитано с помощью команды <code>dmesg</code>.</p></div><div class=paragraph><p>Каждый открытый файл, сокет или буфер использует дескриптор файла. Широкомасштабному серверу может понадобиться много тысяч дескрипторов файлов, в зависимости от количества программ, одновременно выполняемых на сервере.</p></div><div class=paragraph><p>Стандартное значение <code>kern.maxfile</code> определяется переменной <code>maxusers</code> в вашем файле конфигурации ядра. Значение <code>kern.maxfiles</code> увеличивается пропорционально значению <code>maxusers</code>. При компилировании ядра, нужно установить эту переменную согласно потребностям вашей системы. Исходя из значения этой переменной, ядро устанавливает значения большинства предопределённых переменных. Даже если предполагается, что к компьютеру не будут одновременно подсоединяться 256 пользователей, требуемые ресурсы могут быть такими же, как у крупномасштабного сервера.</p></div><div class=paragraph><p>Система автоматически настроит <code>maxusers</code>, если вы явно установите его в <code>0</code>. Если вы желаете выставить значение самостоятельно, то задайте <code>maxusers</code> по меньшей мере равным 4, особенно если вы используйте X Window System или компилируйте программное обеспечение. Причина в том, что самая значимая таблица, устанавливаемая <code>maxusers</code> - это максимальное количество процессов, которая устанавливается равным <code>20 + 16 * maxusers</code>, и поэтому, если вы установите <code>maxusers</code> в 1, то вы сможете иметь только 36 одновременных процессов, включая 18 или около того, что система запустит во время загрузки и 15 или около того, что вы создадите при запуске X Window System. Даже простая задача, как чтение страницы справочника породит 9 процессов для фильтрации, декомпрессии и её просмотра. Установка <code>maxusers</code> в 64 позволит иметь вам до 1044 одновременных процессов, чего должно быть достаточно примерно для всех использований. Если, тем не менее, вы увидите пугающую ошибку при попытке запуска другой программы, или вы используйте сервер с большим количеством одновременных пользователей (как <code>ftp.FreeBSD.org</code>), то вы всегда можете увеличить значение и пересобрать систему.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p><code>maxusers</code> <em>не</em> ограничивает количество пользователей, которые могут заходить на вашу машину. Оно просто устанавливает различные размеры таблиц в разумные значения, учитывая максимальное количество пользователей, вы вероятно будете иметь на вашей системе и как много процессов каждый из них сможет запускать. Ключевое слово, которое ограничивает количество одновременных удаленных входов и терминальных X окон - это <a href=../kernelconfig/#kernelconfig-ptys><code>pseudo-device pty 16</code></a>. С FreeBSD 5.X вам не надо беспокоиться об этом значении, так как <a href="https://man.freebsd.org/cgi/man.cgi?query=pty&amp;sektion=4&amp;format=html">pty(4)</a> драйвер является "автоматически клонирующим"; вы просто используйте <code>device pty</code> в вашем конфигурационном файле.</p></div></td></tr></tbody></table></div></div><div class=sect3><h4 id=_kern_ipc_somaxconn>12.13.1.2. <code>kern.ipc.somaxconn</code><a class=anchor href=#_kern_ipc_somaxconn></a></h4><div class=paragraph><p>Переменная sysctl <code>kern.ipc.somaxconn</code> ограничивает размер очереди для приема новых TCP соединений. Значение по умолчанию <code>128</code> слишком мало для надежной обработки новых соединений для нагруженного web сервера. Для такого сервера рекомендуется увеличить это значение до <code>1024</code> или выше. Даемон сервиса может сам ограничивать очередь приема новых соединений (например, <a href="https://man.freebsd.org/cgi/man.cgi?query=sendmail&amp;sektion=8&amp;format=html">sendmail(8)</a>, или Apache), но обычно в файле настройки даемона есть директива для настройки длины очереди. Более длинная очередь также помогает избежать атак Denial of Service ().</p></div></div></div><div class=sect2><h3 id=nmbclusters>12.13.2. Сетевые Ограничения<a class=anchor href=#nmbclusters></a></h3><div class=paragraph><p>Опция ядра <code>NMBCLUSTERS</code> обуславливает количество Mbuf, доступных на машине. На сервере с большим трафиком и маленьким Mbuf производительность будет пониженной. Каждый кластер представлен двумя килобайтами памяти, поэтому значение 1024 означает 2 мегабайта памяти ядра, зарезервированной для сетевых буферов. Для определения оптимального значения необходимо провести простые вычисления. Если у вас веб сервер, который может обслуживать 1000 одновременных соединений, и каждое соединение "съедает" 16 K буфера приема и 16 K буфера отправки, вам потребуется 32 MB памяти под буферы. Хорошее правило - умножение этого значения на 2, 2x32 MB / 2 KB = 64 MB / 2 kB = 32768. Мы рекомендуем значения между 4096 и 32768 для машин с большим объемом памяти. Не указывайте произвольно большое значение параметра, это может привести к падению системы при загрузке. Используйте <a href="https://man.freebsd.org/cgi/man.cgi?query=netstat&amp;sektion=1&amp;format=html">netstat(1)</a> с опцией <code>-m</code> для определения количества используемых сетевых кластеров.</p></div><div class=paragraph><p>Для настройки в процессе загрузки используйте в loader переменную <code>kern.ipc.nmbclusters</code>. Только в старых версиях FreeBSD потребуется пересобрать ядро (<a href="https://man.freebsd.org/cgi/man.cgi?query=config&amp;sektion=8&amp;format=html">config(8)</a>) с измененным параметром <code>NMBCLUSTERS</code>.</p></div><div class=paragraph><p>Для нагруженных серверов, интенсивно использующих системный вызов <a href="https://man.freebsd.org/cgi/man.cgi?query=sendfile&amp;sektion=2&amp;format=html">sendfile(2)</a>, может потребоваться увеличения буферов <a href="https://man.freebsd.org/cgi/man.cgi?query=sendfile&amp;sektion=2&amp;format=html">sendfile(2)</a> с помощью параметра конфигурации ядра <code>NSFBUFS</code>, или изменения значения путем установки переменной в <span class=filename>/boot/loader.conf</span> (обратитесь к <a href="https://man.freebsd.org/cgi/man.cgi?query=loader&amp;sektion=8&amp;format=html">loader(8)</a> за подробностями). Общий признак того, что параметр требуется изменить - состояние процессов <code>sfbufa</code>. Переменная sysctl <code>kern.ipc.nsfbufs</code> установлена только для чтения. Этот параметр увеличивается вместе с <code>kern.maxusers</code>, хотя может потребоваться увеличить его отдельно.</p></div><div class="admonitionblock important"><table><tbody><tr><td class=icon><i class="fa icon-important" title=Important></i></td><td class=content><div class=paragraph><p>Даже если сокет помечен как неблокирующий, вызов <a href="https://man.freebsd.org/cgi/man.cgi?query=sendfile&amp;sektion=2&amp;format=html">sendfile(2)</a> на неблокирующем сокете может вызвать блокирование <a href="https://man.freebsd.org/cgi/man.cgi?query=sendfile&amp;sektion=2&amp;format=html">sendfile(2)</a>, пока не станет доступным достаточное количество <code>struct sf_buf</code>.</p></div></td></tr></tbody></table></div><div class=sect3><h4 id=_net_inet_ip_portrange>12.13.2.1. <code>net.inet.ip.portrange.*</code><a class=anchor href=#_net_inet_ip_portrange></a></h4><div class=paragraph><p>Переменные sysctl <code>net.inet.ip.portrange.*</code> контролируют диапазоны номеров портов, автоматически привязываемых к TCP и UDP сокетам. Есть три диапазона: нижний диапазон, диапазон по умолчанию и верхний диапазон. Большинство сетевых программ используют диапазон по умолчанию, контролируемый <code>net.inet.ip.portrange.first</code> и <code>net.inet.ip.portrange.last</code>, установленными соответственно в 1024 и 5000. Диапазоны портов привязки используются для исходящих соединений и при некоторых условиях портов может не хватить. Это чаще всего происходит на сильно загруженном прокси сервере. Диапазон портов не становится проблемой при работе серверов, которые обрабатывают в основном входящие соединения, или с небольшим количеством исходящих соединений, например mail relay. Для ситуаций, когда возможен недостаток портов, рекомендуется немного увеличить <code>net.inet.ip.portrange.last</code>. Может подойти значение <code>10000</code>, <code>20000</code>, или <code>30000</code>. Учтите также возможное влияние брандмауэра при изменении диапазона портов. Некоторые могут блокировать большие диапазоны портов (обычно с небольшими номерами) и вынуждают использовать более высокие диапазоны для исходящих соединений. По этой причине не рекомендуется уменьшать значение <code>net.inet.ip.portrange.first</code>.</p></div></div><div class=sect3><h4 id=_tcp_bandwidth_delay_product>12.13.2.2. TCP Bandwidth Delay Product<a class=anchor href=#_tcp_bandwidth_delay_product></a></h4><div class=paragraph><p>TCP Bandwidth Delay Product Limiting похоже на TCP/Vegas в NetBSD. Оно может быть включено установкой переменной sysctl <code>net.inet.tcp.inflight.enable</code> в <code>1</code>. Система попытается вычислить задержку пакетов для каждого соединения и ограничить объем данных в очереди сети до значения, требуемого для поддержания оптимальной пропускной способности.</p></div><div class=paragraph><p>Эта возможность полезна при передаче данных через модемы, Gigabit Ethernet, или даже через высокоскоростные WAN соединения (или любые другие соединения с большой задержкой передачи), особенно если вы также используете изменение размера окна или настроили большое окно передачи. Если вы включили этот параметр, убедитесь также, что переменная <code>net.inet.tcp.inflight.debug</code> установлена в <code>0</code> (отладка выключена), а для использования в реальных задачах может понадобиться установка переменной <code>net.inet.tcp.inflight.min</code> к значению как минимум <code>6144</code>. Но учтите, что установка большого значения этой переменной может фактически отключить ограничение в зависимости от вида соединения. Ограничение уменьшает количество данных на определенном маршруте и управляет очередью пакетов, как и уменьшает общее количество данных в очереди локального интерфейса хоста. С меньшим количеством пакетов в очереди двусторонние интерактивные соединения, особенно на медленных линиях, могут проходить быстрее. Но имейте ввиду, что эта функция работает только при передаче данных (передача данных / сторона сервера). Она не работает при получении данных (загрузке).</p></div><div class=paragraph><p>Изменение значения переменной <code>net.inet.tcp.inflight.stab</code> <em>не</em> рекомендуется. Этот параметр по умолчанию равен 20, что означает добавление 2 пакетов к вычислению задержки передачи. Дополнительное окно требуется для стабилизации алгоритма и улучшения ответной реакции на изменение условий, но также приводит к большему времени ping на медленных соединениях (задержка все же гораздо меньше, чем без алгоритма inflight). Вы можете попробовать уменьшить этот параметр до 15, 10 или 5; а также уменьшить <code>net.inet.tcp.inflight.min</code> (например, до 3500) для получения желаемого эффекта. Уменьшение значений этих параметров может использоваться только как крайняя мера.</p></div></div></div><div class=sect2><h3 id=_виртуальная_память>12.13.3. Виртуальная память<a class=anchor href=#_виртуальная_память></a></h3><div class=sect3><h4 id=_kern_maxvnodes>12.13.3.1. <code>kern.maxvnodes</code><a class=anchor href=#_kern_maxvnodes></a></h4><div class=paragraph><p>Файлы и каталоги в ядре представлены при помощи vnode (виртуальных узлов). Увеличение их числа может помочь уменьшить нагрузку на дисковую подсистему. Как правило, специальной настройки это значение не требует, однако, в некоторых случаях дисковая активность является узким местом, и система исчерпывает таблицу vnode, значение этой переменной следует увеличить. При этом необходимо оценить объем неактивной и свободной памяти.</p></div><div class=paragraph><p>Текущее количество использованных vnode можно посмотреть при помощи команды:</p></div><div class="literalblock programlisting"><div class=content><pre>#  sysctl vfs.numvnodes
vfs.numvnodes: 91349</pre></div></div><div class=paragraph><p>Максимальное количество vnode, доступных системе:</p></div><div class="literalblock programlisting"><div class=content><pre>#  sysctl kern.maxvnodes
kern.maxvnodes: 100000</pre></div></div><div class=paragraph><p>Если количество использованных vnode близко к максимуму, значение переменной <code>kern.maxvnodes</code> следует увеличить на 1000. Следите за динамикой изменения <code>vfs.numvnodes</code>. Если оно увеличивается, приближаясь к вновь установленному максимуму, процесс следует повторить. Изменение в распределении памяти должно быть видно в выводе утилиты <a href="https://man.freebsd.org/cgi/man.cgi?query=top&amp;sektion=1&amp;format=html">top(1)</a>: больше памяти перейдет в разряд активной.</p></div></div></div></div></div><div class=sect1><h2 id=adding-swap-space>12.14. Увеличение объема подкачки<a class=anchor href=#adding-swap-space></a></h2><div class=sectionbody><div class=paragraph><p>Вне зависимости от того, что вы планировали, иногда система ведет себя неожиданно. Если вам потребовался дополнительный объем подкачки, его довольно просто добавить. Есть три способа увеличения объема подкачки: добавить новый жесткий диск, включить подкачку по NFS, или создать файл подкачки на существующем разделе.</p></div><div class=paragraph><p>За информацией о криптовании раздела подкачки обращайтесь к <a href=../disks/#swap-encrypting>Шифрование области подкачки</a> данного Руководства.</p></div><div class=sect2><h3 id=new-drive-swap>12.14.1. Подкачка на новом жестком диске<a class=anchor href=#new-drive-swap></a></h3><div class=paragraph><p>Лучший способ добавить подкачку, конечно, использовать еще один жесткий диск. Вы можете сделать это в любой момент. Если такой способ подходит, прочтите еще раз информацию по пространству подкачки в <a href=#configtuning-initial>Начальное конфигурирование</a> Руководства, где рассказывается о наилучшем способе организации раздела подкачки.</p></div></div><div class=sect2><h3 id=nfs-swap>12.14.2. Подкачка через NFS<a class=anchor href=#nfs-swap></a></h3><div class=paragraph><p>Подкачка через NFS рекомендуется только в том случае, если в системе отсутствует жесткий диск; подкачка через NFS ограничена скоростью сетевого подключения и к тому же дополнительно нагружает NFS сервер.</p></div></div><div class=sect2><h3 id=create-swapfile>12.14.3. Файлы подкачки<a class=anchor href=#create-swapfile></a></h3><div class=paragraph><p>Вы можете создать файл определенного размера и использовать его как файл подкачки. В нашем примере будет использован файл <span class=filename>/usr/swap0</span> размером 64MB. Конечно, вы можете использовать любое имя.</p></div><div class=exampleblock><div class=title>Пример 1. Создание файла подкачки в FreeBSD</div><div class=content><div class="olist arabic"><ol class=arabic><li><p>Убедитесь, что в файле настройки ядра присутствует драйвер виртуального диска (<a href="https://man.freebsd.org/cgi/man.cgi?query=md&amp;sektion=4&amp;format=html">md(4)</a>). Он есть в ядре <span class=filename>GENERIC</span>.</p><div class="literalblock programlisting"><div class=content><pre>device   md   # Memory &#34;disks&#34;</pre></div></div></li><li><p>Создайте файл подкачки (<span class=filename>/usr/swap0</span>):</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># dd if=/dev/zero of=/usr/swap0 bs=1024k count=64</span></code></pre></div></div></li><li><p>Установите подходящие права на (<span class=filename>/usr/swap0</span>):</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># chmod 0600 /usr/swap0</span></code></pre></div></div></li><li><p>Включите файл подкачки в <span class=filename>/etc/rc.conf</span>:</p><div class="literalblock programlisting"><div class=content><pre>swapfile=&#34;/usr/swap0&#34;   # Set to name of swapfile if aux swapfile desired.</pre></div></div></li><li><p>Перегрузите компьютер или для включения подкачки прямо сейчас введите:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mdconfig -a -t vnode -f /usr/swap0 -u 0  swapon /dev/md0</span></code></pre></div></div></li></ol></div></div></div></div></div></div><div class=sect1><h2 id=acpi-overview>12.15. Управление питанием и ресурсами<a class=anchor href=#acpi-overview></a></h2><div class=sectionbody><div class=paragraph><p>Очень важно использовать аппаратные ресурсы эффективно. До того, как появился ACPI, управление потреблением питания и температурными характеристиками системы было очень сложной для операционной системы задачей. Аппаратное обеспечение контролировалось одним из видов встроенного интерфейса BIOS, таким как: <em>Plug and Play BIOS (PNPBIOS)</em>, <em>Advanced Power Management (APM)</em> и так далее. Управление питанием и ресурсами это один из ключевых компонентов современной операционной системы. Например, вам может потребоваться, чтобы операционная система следила за температурными ограничениями и возможно, предупреждала при неожиданном росте температуры.</p></div><div class=paragraph><p>В этом разделе Руководства FreeBSD, мы предоставим исчерпывающую информацию о ACPI. В конце раздела есть ссылки для дальнейшего чтения.</p></div><div class=sect2><h3 id=acpi-intro>12.15.1. Что такое ACPI?<a class=anchor href=#acpi-intro></a></h3><div class=paragraph><p>Advanced Configuration and Power Interface (ACPI) это стандарт, написанный объединением поставщиков в целях предоставления стандартного интерфейса для аппаратных ресурсов и управления питанием (отсюда и название). Это ключевой элемент <em>Operating System-directed configuration and Power Management</em>, т.е.: он предоставляет операционной системе (OS) больше контроля и более универсален. Современные системы вышли за пределы ограничений существующих Plug and Play интерфейсов до появления ACPI. ACPI это прямой наследник APM (Advanced Power Management).</p></div></div><div class=sect2><h3 id=acpi-old-spec>12.15.2. Недостатки Advanced Power Management (APM)<a class=anchor href=#acpi-old-spec></a></h3><div class=paragraph><p>Средства <em>Advanced Power Management (APM)</em> управляют энергопотреблением системы в зависимости от нагрузки. APM BIOS предоставляется поставщиком системы и специфичен для данной аппаратной платформы. Драйвер APM в OS обеспечивает доступ к <em>APM Software Interface</em>, который позволяет управлять уровнями потребления питания.</p></div><div class=paragraph><p>В APM имеется четыре основных проблемы. Во-первых, управление энергопотреблением осуществляется через зависимый от поставщика BIOS, и OS ничего не знает нем. Один пример: когда пользователь устанавливает время ожидания для жесткого диска в APM BIOS, и это время истекает, BIOS останавливает жесткий диск без согласования с OS. Во-вторых, алгоритм APM встроен в BIOS, и все действия происходят вне контроля OS. Это означает, что пользователи могут решить проблемы с APM BIOS только путем перепрошивки его ROM; это очень опасная процедура, и если она завершится неудачно, система может оказаться в невосстановимом состоянии. В-третьих, реализация технологии APM зависит от поставщика, что означает дублирование усилий и если в BIOS одного из поставщиков будет найдена и исправлена ошибка, ее могли не исправить другие поставщики. Наконец, объем APM BIOS недостаточно велик для реализации сложной политики управления питанием, или такой политики, которая может хорошо адаптироваться к потребностям компьютера.</p></div><div class=paragraph><p><em>Plug and Play BIOS (PNPBIOS)</em> был неудобен во многих ситуациях. PNPBIOS это 16-битная технология, поэтому OS требовалось использовать 16-битную эмуляцию для "взаимодействия" с методами PNPBIOS.</p></div><div class=paragraph><p>FreeBSD драйвер APM документирован в странице справочника <a href="https://man.freebsd.org/cgi/man.cgi?query=apm&amp;sektion=4&amp;format=html">apm(4)</a>.</p></div></div><div class=sect2><h3 id=acpi-config>12.15.3. Настройка ACPI<a class=anchor href=#acpi-config></a></h3><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=loader&amp;sektion=8&amp;format=html">loader(8)</a> загружает драйвер <span class=filename>acpi.ko</span> по умолчанию, его <em>не</em> надо встраивать в ядро. Причина в том, что с модулями проще работать, например переключиться на другой <span class=filename>acpi.ko</span> без пересборки ядра. Преимущество в упрощении тестирования. Другая причина в том, что запуск ACPI после старта системы не очень полезен и при некоторых условиях может приводить к краху. Если вы сомневаетесь, отключите ACPI совсем. Драйвер не должен и не может быть выгружен, поскольку системная шина используется для различных взаимодействий оборудования. ACPI может быть выключен с помощью утилиты <a href="https://man.freebsd.org/cgi/man.cgi?query=acpiconf&amp;sektion=8&amp;format=html">acpiconf(8)</a>. Фактически большинство взаимодействий с ACPI может быть выполнено через <a href="https://man.freebsd.org/cgi/man.cgi?query=acpiconf&amp;sektion=8&amp;format=html">acpiconf(8)</a>. В основном это означает, что если в выводе <a href="https://man.freebsd.org/cgi/man.cgi?query=dmesg&amp;sektion=8&amp;format=html">dmesg(8)</a> есть что-то об ACPI, он скорее всего работает.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>ACPI и APM не могут сосуществовать и должны использоваться раздельно. Каждый из них прервет загрузку, если обнаружит загруженный драйвер другого.</p></div></td></tr></tbody></table></div><div class=paragraph><p>В простейшей форме, ACPI может использоваться для перевода системы в спящий режим с помощью <a href="https://man.freebsd.org/cgi/man.cgi?query=acpiconf&amp;sektion=8&amp;format=html">acpiconf(8)</a>, с флагом <code>-s</code> и параметром <code>1-5</code>. Большинству пользователей нужен только параметр <code>1</code>. Параметр <code>5</code> сделает "мягкое" завершение работы, так же как и:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># halt -p</span></code></pre></div></div><div class=paragraph><p>Доступны и другие параметры. Обратитесь к странице справочника <a href="https://man.freebsd.org/cgi/man.cgi?query=acpiconf&amp;sektion=8&amp;format=html">acpiconf(8)</a> за дополнительной информацией.</p></div></div></div></div><div class=sect1><h2 id=ACPI-debug>12.16. Использование и отладка FreeBSD ACPI<a class=anchor href=#ACPI-debug></a></h2><div class=sectionbody><div class=paragraph><p>ACPI это фундаментально новый способ обнаружения устройств, управления энергопотреблением и предоставления стандартизированного доступа к различному оборудованию, ранее управлявшемуся BIOS. Был достигнут определенный прогресс в приспособлении ACPI к работе со всеми системами, но все еще встречаются ошибки в байткоде <em>ACPI Machine Language</em> (AML) некоторых материнских плат, незавершенные участки кода в подсистемах ядра FreeBSD и ошибки в интерпретаторе Intel® ACPI-CA.</p></div><div class=paragraph><p>Этот раздел предназначен для того, чтобы упростить ваше содействие разработчикам FreeBSD ACPI в определении причин наблюдаемых вами проблем, выполнении отладки и выработке решения. Спасибо за помощь и надеемся, что мы сможем помочь в решении проблем вашей системы.</p></div><div class=sect2><h3 id=ACPI-submitdebug>12.16.1. Отправка отладочной информации<a class=anchor href=#ACPI-submitdebug></a></h3><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Перед отправкой сообщения об ошибке убедитесь, что у вас последняя версия BIOS, и, если доступна, последняя версия firmware встроенного контроллера.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Те из вас, кто желает составить сообщение о проблеме прямо сейчас, могут воспользоваться адресом <a href=mailto:freebsd-acpi@FreeBSD.org></a><a href=mailto:freebsd-acpi@FreeBSD.org>freebsd-acpi@FreeBSD.org</a>, отправив на него следующую информацию:</p></div><div class=ulist><ul><li><p>Описание неправильного поведения, включая тип системы, модель и все, что приводит к появлению ошибки. Кроме того, сообщите настолько точно, насколько возможно, когда появилась ошибка, если ранее вы ее не видели.</p></li><li><p>Вывод <a href="https://man.freebsd.org/cgi/man.cgi?query=dmesg&amp;sektion=8&amp;format=html">dmesg(8)</a> после "boot <code>-v</code>", включая все сообщения, появившиеся при изучении ошибки.</p></li><li><p>Вывод <a href="https://man.freebsd.org/cgi/man.cgi?query=dmesg&amp;sektion=8&amp;format=html">dmesg(8)</a> после "boot <code>-v</code>" с выключенным ACPI, если его отключение помогает решить проблему.</p></li><li><p>Вывод <code>sysctl hw.acpi</code>. Это также хороший способ получения списка возможностей системы.</p></li><li><p>URL где можно найти ваш <em>ACPI Source Language</em> (ASL). <em>Не</em> отправляйте ASL непосредственно в список рассылки, поскольку он может быть очень большим. Копия ASL может быть создана командой:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># acpidump -t -d  name-system.asl</span></code></pre></div></div><div class=paragraph><p>(Замените вашим логином <span class=filename>name</span> и производителем/моделью <span class=filename>system</span>. Пример: <span class=filename>njl-FooCo6000.asl</span>)</p></div></li></ul></div><div class=paragraph><p>Большинство разработчиков читают <a href=https://lists.FreeBSD.org/subscription/freebsd-current>Список рассылки, посвящённый обсуждению FreeBSD-CURRENT</a>, но для уверенности, что проблему увидят, отправьте ее в <a href=https://lists.FreeBSD.org/subscription/freebsd-acpi>Список рассылки FreeBSD ACPI</a>. Будьте терпеливы, все мы заняты полный рабочий день где-то еще. Если ваше сообщение не заметили сразу, мы возможно попросим вас отправить PR (сообщение о проблеме) через <a href="https://man.freebsd.org/cgi/man.cgi?query=send-pr&amp;sektion=1&amp;format=html">send-pr(1)</a>. При вводе PR, включайте ту же информацию, что запрошена выше. Это поможет нам отследить проблему и решить ее. Не отправляйте PR без предварительной отправки письма в <a href=https://lists.FreeBSD.org/subscription/freebsd-acpi>Список рассылки FreeBSD ACPI</a>, поскольку мы используем PR в качестве напоминаний о существующих проблемах, а не как механизм сообщений об ошибках. Вероятно, о вашей проблеме кто-то уже сообщал ранее.</p></div></div><div class=sect2><h3 id=ACPI-background>12.16.2. Общие сведения<a class=anchor href=#ACPI-background></a></h3><div class=paragraph><p>ACPI представлен во всех современных компьютерах, соответствующих архитектурам ia32 (x86), ia64 (Itanium) и amd64 (AMD). Полный стандарт включает множество возможностей, в том числе управление производительностью CPU, уровнем питания, температурой, различными системами аккумуляторов, встроенными контроллерами и опросом шины. В большинстве систем стандарт реализован не полностью. Например, настольные системы обычно реализуют только опрос шины, а портативные компьютеры кроме того могут поддерживать управление охлаждением и энергопотреблением. Они также поддерживают приостановку и последующий запуск системы различного уровня сложности.</p></div><div class=paragraph><p>ACPI-совместимые системы состоят из различных компонентов. Производители BIOS и чипсетов предоставляют различные жестко заданные таблицы, (например, FADT), которые определяют функции вроде карты APIC (используется для SMP), регистры настройки и простые значения параметров. Кроме того, предоставляется таблица байткода (<em>Differentiated System Description Table</em>, DSDT), определяющая древоподобное пространство имен устройств и методов.</p></div><div class=paragraph><p>Драйвер ACPI должен прочесть заданные таблицы, реализовать интерпретатор для байткода, модифицировать драйвера устройств и ядро для приема информации от подсистемы ACPI. Для FreeBSD Intel® предоставила интерпретатор (ACPI-CA), тот же что для Linux и NetBSD. Исходный код ACPI-CA находится в каталоге <span class=filename>src/sys/contrib/dev/acpica</span>. Код для приспособления ACPI-CA к работе в FreeBSD, находится в <span class=filename>src/sys/dev/acpica/Osd</span>. Наконец, драйвера, реализующие различные ACPI устройства, находятся в <span class=filename>src/sys/dev/acpica</span>.</p></div></div><div class=sect2><h3 id=ACPI-comprob>12.16.3. Часто встречающиеся проблемы<a class=anchor href=#ACPI-comprob></a></h3><div class=paragraph><p>Для правильной работы ACPI все ее части должны работать правильно. Вот некоторые часто встречающиеся проблемы, в порядке частоты появления, и некоторые обходные пути или исправления.</p></div><div class=sect3><h4 id=_проблемы_с_мышью>12.16.3.1. Проблемы с мышью<a class=anchor href=#_проблемы_с_мышью></a></h4><div class=paragraph><p>В некоторых случаях при возобновлении работы после приостановки перестает работать мышь. Известным решением проблемы является добавление строки <code>hint.psm.0.flags="0x3000"</code> в файл <span class=filename>/boot/loader.conf</span>. Если это не помогло, стоит сообщить о проблеме, как описано выше.</p></div></div><div class=sect3><h4 id=_приостановкавозобновление_работы>12.16.3.2. Приостановка/возобновление работы<a class=anchor href=#_приостановкавозобновление_работы></a></h4><div class=paragraph><p>ACPI поддерживает три состояния приостановки в RAM (STR), <code>S1</code>-<code>S3</code>, и одно состояние приостановки на диск (<code>STD</code>), называемое <code>S4</code>. <code>S5</code> это "мягкое выключение" и это нормальное состояние системы, когда она подключена к сети, но не включена. <code>S4</code> может быть реализован двумя различными путями. <code>S4</code>BIOS это BIOS-поддерживаемая приостановка на диск. <code>S4</code>OS реализуется полностью операционной системой.</p></div><div class=paragraph><p>Начните с проверки переменных <code>sysctl hw.acpi</code>, относящихся к приостановке (suspend). Вот результат для Thinkpad:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>hw.acpi.supported_sleep_state: S3 S4 S5
hw.acpi.s4bios: 0</code></pre></div></div><div class=paragraph><p>Это означает, что мы можем использовать <code>acpiconf -s</code> для тестирования <code>S3</code>, <code>S4</code>OS, и <code>S5</code>. Если <code>s4bios</code> был единицей (<code>1</code>), это означает поддержку <code>S4</code>BIOS вместо <code>S4</code>OS.</p></div><div class=paragraph><p>При тестировании приостановки/возобновления работы, начните с <code>S1</code>, если этот режим поддерживается. Это состояние скорее всего поддерживается, поскольку не требует слишком серьезной поддержки со стороны драйвера. Никто не реализовал <code>S2</code>, который похож на <code>S1</code>. Следующий режим для тестирования это <code>S3</code>. Это наиболее глубокое STR состояние, оно требует существенной поддержки со стороны драйвера, чтобы правильно реинициализировать оборудование. Если у вас возникли проблемы при выходе из этого состояния, отправьте письмо в рассылку <a href=https://lists.FreeBSD.org/subscription/freebsd-acpi>Список рассылки FreeBSD ACPI</a>, но не ждите, что проблема будет обязательно решена, поскольку существует множество драйверов/оборудования, нуждающихся в дальнейшем тестировании и разработке.</p></div><div class=paragraph><p>Для изоляции проблемы удалите из ядра столько драйверов, сколько возможно. Если это работает, вы можете выяснить, какой драйвер вызывает проблему путем загрузки драйверов до тех пор, пока опять не произойдет сбой. Обычно бинарные драйвера, такие как <span class=filename>nvidia.ko</span>, драйвера дисплея X11 и USB вызывают большинство проблем, а драйвера Ethernet интерфейсов как правило работают отлично. Если вы можете нормально загрузить/выгрузить драйвера, автоматизируйте этот процесс, поместив соответствующие команды в <span class=filename>/etc/rc.suspend</span> и <span class=filename>/etc/rc.resume</span>. Это закомментированные примеры выгрузки и загрузки драйверов. Попробуйте установить параметр <code>hw.acpi.reset_video</code> в нуль (<code>0</code>), если ваш дисплей не включается после возобновления работы. Попробуйте установить большие или меньшие значения для <code>hw.acpi.sleep_delay</code>, чтобы проверить, поможет ли это.</p></div><div class=paragraph><p>Другой способ, который можно попробовать, это запуск последнего дистрибутива Linux с поддержкой ACPI и тестирование поддержки остановки/возобновления работы на том же оборудовании. Если она работает на Linux, проблема скорее всего в драйверах FreeBSD и поиск драйвера, вызывающего проблему, поможет разрешить ситуацию. Имейте ввиду, что разработчики ACPI обычно не поддерживают другие драйверы (звук, ATA, и т.п.), так что все результаты работы по поиску проблемы возможно необходимо отправить в список рассылки <a href=https://lists.FreeBSD.org/subscription/freebsd-current>Список рассылки, посвящённый обсуждению FreeBSD-CURRENT</a> и человеку, поддерживающему драйвер. Если вы решитесь заняться отладкой, поместите соответствующий код (<a href="https://man.freebsd.org/cgi/man.cgi?query=printf&amp;sektion=3&amp;format=html">printf(3)</a>) в вызывающий проблему драйвер для обнаружения места, где прерывается функция восстановления.</p></div><div class=paragraph><p>Наконец, попробуйте отключить ACPI и включить APM. Если приостановка/возобновление работает с APM, вам возможно лучше подойдет APM, особенно на старом оборудовании (до 2000). Включение корректной поддержки ACPI поставщиками оборудования требует времени и вероятно в старом оборудовании поддержка ACPI в BIOS была некорректна.</p></div></div><div class=sect3><h4 id=_система_останавливается_временно_или_постоянно>12.16.3.3. Система останавливается (временно или постоянно)<a class=anchor href=#_система_останавливается_временно_или_постоянно></a></h4><div class=paragraph><p>Большинство систем останавливаются в результате потери прерываний или "шторма" прерываний. В чипсетах существует много проблем, связанных с тем, как BIOS настраивает прерывания перед загрузкой, правильностью таблицы APIC (MADT), и маршрутизации <em>System Control Interrupt</em> (SCI).</p></div><div class=paragraph><p>"Шторм" прерываний может быть обнаружен по потерянным прерываниям путем проверки вывода строки с <code>acpi0</code> команды <code>vmstat -i</code>. Если счетчик увеличивается более, чем несколько раз в секунду, это "шторм" прерываний. Если система останавливается, попробуйте войти в DDB (<span class=keyseq><kbd>CTRL</kbd>+<kbd>ALT</kbd>+<kbd>ESC</kbd></span> на консоли) и ввести <code>show interrupts</code>.</p></div><div class=paragraph><p>Наиболее надежный способ избавиться от проблемы с прерываниями, это отключение поддержки APIC с помощью параметра <span class=filename>loader.conf</span><code>hint.apic.0.disabled="1"</code>.</p></div></div><div class=sect3><h4 id=_паника>12.16.3.4. Паника<a class=anchor href=#_паника></a></h4><div class=paragraph><p>Паника, связанная с ACPI, случается довольно редко и имеет наибольший приоритет исправления. Первый шаг это изоляция действий, приводящих к панике (если это возможно) и получение отладки. Следуйте инструкции по включению <code>options DDB</code> и настройке последовательной консоли (смотрите <a href=../serialcomms/#serialconsole-ddb>Вход в отладчик DDB с последовательной линии</a>) или настройке раздела <a href="https://man.freebsd.org/cgi/man.cgi?query=dump&amp;sektion=8&amp;format=html">dump(8)</a>. Вы можете получить отладочную информацию DDB с помощью <code>tr</code>. Если вы записываете отладку вручную, убедитесь, что переписали как минимум пять (5) строк снизу и пять (5) строк сверху.</p></div><div class=paragraph><p>Затем попробуйте изолировать проблему, загрузившись с выключенным ACPI. Если это работает, вы можете изолировать подсистему ACPI, используя различные параметры <code>debug.acpi.disable</code>. Обратитесь к странице справочника <a href="https://man.freebsd.org/cgi/man.cgi?query=acpi&amp;sektion=4&amp;format=html">acpi(4)</a> за примерами.</p></div></div><div class=sect3><h4 id=_система_включается_после_приостановки_или_завершения_работы>12.16.3.5. Система включается после приостановки или завершения работы<a class=anchor href=#_система_включается_после_приостановки_или_завершения_работы></a></h4><div class=paragraph><p>Во-первых, попробуйте установить в <a href="https://man.freebsd.org/cgi/man.cgi?query=loader.conf&amp;sektion=5&amp;format=html">loader.conf(5)</a> параметр <code>hw.acpi.disable_on_poweroff="0"</code>. Это предотвращает отключение различных событий в ACPI во время завершения работы. В некоторых системах этот параметр необходимо установить в <code>1</code> (по умолчанию) по тем же причинам. Обычно это решает проблему, если система неожиданно включается после приостановки или отключения питания.</p></div></div><div class=sect3><h4 id=_другие_проблемы>12.16.3.6. Другие проблемы<a class=anchor href=#_другие_проблемы></a></h4><div class=paragraph><p>Если вы наблюдаете другие проблемы с ACPI (работа с внешним оборудованием, проблемы с обнаружением устройств, и т.д.), отправьте описание проблемы в список рассылки; однако, некоторые из этих проблем могут относиться к незавершенным частям подсистемы ACPI, поэтому может потребоваться время на их реализацию. Будьте терпеливы, и подготовьтесь к тестированию исправлений, которые мы можем вам выслать.</p></div></div></div><div class=sect2><h3 id=ACPI-aslanddump>12.16.4. ASL, <code>acpidump</code>, и IASL<a class=anchor href=#ACPI-aslanddump></a></h3><div class=paragraph><p>Наиболее часто встречается проблема, связанная с предоставлением поставщиками BIOS некорректного (или полностью ошибочного!) байткода. Это обычно проявляется появлением консольных сообщений ядра, подобных этому:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>ACPI-1287: <span class=k>***</span> Error: Method execution failed <span class=o>[</span><span class=se>\\</span>_SB_.PCI0.LPC0.FIGD._STA] <span class=se>\\</span>
       <span class=o>(</span>Node 0xc3f6d160<span class=o>)</span>, AE_NOT_FOUND</code></pre></div></div><div class=paragraph><p>Зачастую вы можете разрешить эти проблемы путем обновления BIOS до последней ревизии. Большинство консольных сообщений безвредны, но если существуют другие проблемы, такие как не работающий статус батареи, возможно существуют проблемы в AML. Байткод, известный как AML, компилируется из исходного текста на языке ASL. AML находится в таблице, известной как DSDT. Для получения копии ASL, используйте <a href="https://man.freebsd.org/cgi/man.cgi?query=acpidump&amp;sektion=8&amp;format=html">acpidump(8)</a>. Вы можете использовать оба параметра <code>-t</code> (показывать содержимое постоянных таблиц) и <code>-d</code> (дизассемблировать AML в ASL). Обратитесь к разделу <a href=#ACPI-submitdebug>Отправка отладочной информации</a> за примером синтаксиса.</p></div><div class=paragraph><p>Простейшая первая проверка, которую вы можете провести, это перекомпиляция ASL для поиска ошибок. Предупреждения обычно могут быть проигнорированы, но ошибки обычно не позволяют ACPI работать правильно. Для перекомпиляции ASL, выполните следующую команду:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># iasl your.asl</span></code></pre></div></div></div><div class=sect2><h3 id=ACPI-fixasl>12.16.5. Исправление ASL<a class=anchor href=#ACPI-fixasl></a></h3><div class=paragraph><p>В дальней перспективе, наша задача состоит в том, чтобы обеспечить поддержку ACPI практически для каждой системы без вмешательства пользователя. Однако, на данный момент мы все еще разрабатываем обходные пути для ошибок, которые часто делают поставщики BIOS. Интерпретатор Microsoft® (<span class=filename>acpi.sys</span> и <span class=filename>acpiec.sys</span>) не занимается проверкой четкости соблюдения стандартов, поэтому многие поставщики BIOS, проверяющие ACPI только под Windows®, никогда не исправляют ASL. Мы надеемся продолжать обнаружение и документацию нестандартных поведений, позволяемых интерпретатором Microsoft®, и воспроизводить их, чтобы FreeBSD могла работать без необходимости исправления ASL пользователями. В качестве обходного пути для обнаружения неправильного поведения, вы можете исправить ASL вручную. Если исправления будут работать, пожалуйста отправьте <a href="https://man.freebsd.org/cgi/man.cgi?query=diff&amp;sektion=1&amp;format=html">diff(1)</a> между старым и новым ASL, чтобы мы могли реализовать обходной путь для неправильного поведения ACPI-CA, чтобы исправление вручную больше не требовалось.</p></div><div class=paragraph><p>Вот список наиболее часто встречающихся проблем, их причин и способы исправления:</p></div><div class=sect3><h4 id=_os_зависимости>12.16.5.1. OS зависимости<a class=anchor href=#_os_зависимости></a></h4><div class=paragraph><p>Некоторые AML предполагают, что мир состоит из различных версий Windows®. Вы можете настроить FreeBSD, чтобы она сообщала любое другое имя OS и посмотреть, исправит ли это имеющуюся проблему. Простой способ указания другого имени системы это установка переменной <span class=filename>/boot/loader.conf</span><code>hw.acpi.osname="Windows 2001"</code> или в другое подобное значение, имеющееся в ASL.</p></div></div><div class=sect3><h4 id=_отсутствие_возврата_значения>12.16.5.2. Отсутствие возврата значения<a class=anchor href=#_отсутствие_возврата_значения></a></h4><div class=paragraph><p>Некоторые методы не возвращают значение явно, как того требует стандарт. Хотя ACPI-CA не обрабатывает эту ситуацию, в FreeBSD существует обходной путь, позволяющей ей явно возвращать значение. Вы можете также добавить явные операторы Return (возврат) там, где требуется, если знаете, что значение должно быть возвращено. Для принудительного компилирования ASL командой <code>iasl</code>, используйте флаг <code>-f</code>.</p></div></div><div class=sect3><h4 id=_перезапись_aml_по_умолчанию>12.16.5.3. Перезапись AML по умолчанию<a class=anchor href=#_перезапись_aml_по_умолчанию></a></h4><div class=paragraph><p>После настройки <span class=filename>your.asl</span> для компиляции запустите:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># iasl your.asl</span></code></pre></div></div><div class=paragraph><p>Вы можете добавить флаг <code>-f</code> для создания AML даже при наличии ошибок компиляции. Помните, что некоторые ошибки (например, отсутствующие операторы Return), автоматически обходятся интерпретатором.</p></div><div class=paragraph><p>Файл <span class=filename>DSDT.aml</span> используется <code>iasl</code> по умолчанию. Вы можете загрузить его вместо ошибочной копии BIOS (которая остается в постоянной памяти) путем редактирования <span class=filename>/boot/loader.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>acpi_dsdt_load=&#34;YES&#34;
acpi_dsdt_name=&#34;/boot/DSDT.aml&#34;</pre></div></div><div class=paragraph><p>Убедитесь, что скопировали <span class=filename>DSDT.aml</span> в каталог <span class=filename>/boot</span>.</p></div></div></div><div class=sect2><h3 id=ACPI-debugoutput>12.16.6. Получение отладочной информации ACPI<a class=anchor href=#ACPI-debugoutput></a></h3><div class=paragraph><p>Возможности отладки драйвера ACPI очень гибкие. Они позволяют вам указывать набор подсистем, а также уровень отладки. Подсистемы, которые вы хотите отлаживать, указываются как "слои", и подразделяются на компоненты ACPI-CA (ACPI_ALL_COMPONENTS) и поддержку оборудования ACPI (ACPI_ALL_DRIVERS). Уровень отладки варьируется от ACPI_LV_ERROR (только сообщать об ошибках) до ACPI_LV_VERBOSE (все сообщения). Уровень отладки представляет собой битовую маску, поэтому возможна одновременная установка нескольких параметров, разделенных пробелами. На практике, при использовании для получения отладочной информации последовательной консоли, слишком большое количество информации может переполнить буфер консоли. Полный список отдельных слоев и уровней можно найти на странице справочника <a href="https://man.freebsd.org/cgi/man.cgi?query=acpi&amp;sektion=4&amp;format=html">acpi(4)</a>.</p></div><div class=paragraph><p>Вывод отладочной информации по умолчанию не включен. Для его включения добавьте параметр <code>options ACPI_DEBUG</code> к файлу настройки ядра, если ACPI встроен в ядро. Вы можете добавить параметр <code>ACPI_DEBUG=1</code> в файл <span class=filename>/etc/make.conf</span> для глобального включения этого параметра. Если вы используете модуль <span class=filename>acpi.ko</span> , его можно пересобрать индивидуально:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /sys/modules/acpi/acpi</span>
 make clean  make
<span class=nv>ACPI_DEBUG</span><span class=o>=</span>1</code></pre></div></div><div class=paragraph><p>Установите <span class=filename>acpi.ko</span> в <span class=filename>/boot/kernel</span> и добавьте предпочитаемый уровень и слой к <span class=filename>loader.conf</span>. Этот пример включает отладочные сообщения для всех компонентов ACPI-CA и всех драйверов оборудования ACPI (CPU, LID и т.д.). Будут выводиться только сообщения об ошибках, наименьший уровень отладки.</p></div><div class="literalblock programlisting"><div class=content><pre>debug.acpi.layer=&#34;ACPI_ALL_COMPONENTS ACPI_ALL_DRIVERS&#34;
debug.acpi.level=&#34;ACPI_LV_ERROR&#34;</pre></div></div><div class=paragraph><p>Если требуемая информация получается в результате определенного события (скажем, приостановка и восстановление), вы можете не изменять <span class=filename>loader.conf</span> и использовать для указания слоя и уровня <code>sysctl</code> после загрузки и подготовки системы к определенному событию. Имена переменных <code>sysctl</code> те же, что и имена параметров настройки в <span class=filename>loader.conf</span>.</p></div></div><div class=sect2><h3 id=ACPI-References>12.16.7. Ссылки<a class=anchor href=#ACPI-References></a></h3><div class=paragraph><p>Дальнейшую информацию о ACPI можно найти по следующим ссылкам:</p></div><div class=ulist><ul><li><p><a href=https://lists.FreeBSD.org/subscription/freebsd-acpi>Список рассылки FreeBSD ACPI</a></p></li><li><p>Архивы списка рассылки ACPI <a href=http://lists.freebsd.org/pipermail/freebsd-acpi/>http://lists.freebsd.org/pipermail/freebsd-acpi/</a></p></li><li><p>Старые архивы списка рассылки ACPI <a href=http://home.jp.FreeBSD.org/mail-list/acpi-jp/>http://home.jp.FreeBSD.org/mail-list/acpi-jp/</a></p></li><li><p><a href=https://uefi.org/specifications#ACPI>Спецификация ACPI</a></p></li><li><p>Страницы справочника FreeBSD: <a href="https://man.freebsd.org/cgi/man.cgi?query=acpi&amp;sektion=4&amp;format=html">acpi(4)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=acpi_thermal&amp;sektion=4&amp;format=html">acpi_thermal(4)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=acpidump&amp;sektion=8&amp;format=html">acpidump(8)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=iasl&amp;sektion=8&amp;format=html">iasl(8)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=acpidb&amp;sektion=8&amp;format=html">acpidb(8)</a></p></li><li><p><a href=http://www.cpqlinux.com/acpi-howto.html#fix_broken_dsdt>Ресурс по отладке DSDT</a>. (Использует в качестве примера Compaq, но обычно полезен.)</p></li></ul></div></div></div></div></div><hr><div class=last-modified><p><strong>Изменено</strong>: 9 марта 2024 г. by <a href="https://cgit.freebsd.org/doc/commit/?id=6199af92e7" target=_blank>Danilo G. Baio</a></p></div><div class=buttons><div class=prev><i class="fa fa-angle-left" aria-hidden=true title=Назад></i><div class=container><a href=http://172.16.201.134:1313/ru/books/handbook/partiii class=direction>Назад</a></div></div><div class=home><i class="fa fa-home" aria-hidden=true title=Главная></i><div class=container><a href=../ class=direction>Главная</a></div></div><div class=next><div class=container><a href=http://172.16.201.134:1313/ru/books/handbook/boot class=direction>Далее</a></div><i class="fa fa-angle-right" aria-hidden=true title=Далее></i></div></div><label class="hidden book-menu-overlay" for=menu-control></label></div><aside class=toc><div class=toc-content><h3>Содержание</h3><nav id=TableOfContents><ul><li><a href=#config-synopsis>12.1. Введение</a></li><li><a href=#configtuning-initial>12.2. Начальное конфигурирование</a></li><li><a href=#configtuning-core-configuration>12.3. Основные настройки</a></li><li><a href=#configtuning-appconfig>12.4. Настройка приложений</a></li><li><a href=#configtuning-starting-services>12.5. Запуск сервисов</a></li><li><a href=#configtuning-cron>12.6. Настройка утилиты <code>cron</code></a></li><li><a href=#configtuning-rcd>12.7. Использование rc во FreeBSD 5.X и последующих версиях</a></li><li><a href=#config-network-setup>12.8. Настройка карт сетевых интерфейсов</a></li><li><a href=#configtuning-virtual-hosts>12.9. Настройка виртуальных серверов</a></li><li><a href=#configtuning-configfiles>12.10. Файлы настройки</a></li><li><a href=#configtuning-sysctl>12.11. Настройка с помощью sysctl</a></li><li><a href=#configtuning-disk>12.12. Оптимизация дисков</a></li><li><a href=#configtuning-kernel-limits>12.13. Изменение ограничений, накладываемых ядром</a></li><li><a href=#adding-swap-space>12.14. Увеличение объема подкачки</a></li><li><a href=#acpi-overview>12.15. Управление питанием и ресурсами</a></li><li><a href=#ACPI-debug>12.16. Использование и отладка FreeBSD ACPI</a></li></ul></nav><hr><div class=resources><h3>Материалы</h3><ul class=contents><li><i class="fa fa-file-pdf-o" aria-hidden=true title="Скачать PDF"></i><a href=https://download.freebsd.org/doc/ru/books/handbook/handbook_ru.pdf>Скачать PDF</a></li><li><i class="fa fa-pencil-square-o" aria-hidden=true title="Редактировать эту страницу"></i><a href=https://github.com/freebsd/freebsd-doc/blob/main/documentation/content/ru/_index target=_blank>Редактировать эту страницу</a></li></ul></div></div></aside><a class=to-top href=#top><i class="fa fa-arrow-circle-up" aria-hidden=true></i></a></main><footer><div class=footer-container><section class=logo-column><img src=http://172.16.201.134:1313/images/FreeBSD-colors.svg width=160 height=50 alt="FreeBSD logo"><div class=options-container><div class=language-container><a id=languages href=http://172.16.201.134:1313/ru/languages><img src=http://172.16.201.134:1313/images/language.png class=language-image alt="Выберите язык">
<span>Русский</span></a></div><div class=theme-container><select id=theme-chooser><option value=theme-system>Система</option><option value=theme-light>Светлый</option><option value=theme-dark>Тёмный</option><option value=theme-high-contrast>Высокая контрастность</option></select></div></div></section><section class=about-column><h3 class=column-title>О нас</h3><ul class=column-elements-container><li><a href=https://www.freebsd.org/about/ target=_blank class=column-element>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/ target=_blank class=column-element>Фонд FreeBSD</a></li><li><a href=https://www.freebsd.org/where/ target=_blank class=column-element>Получить FreeBSD</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct target=_blank class=column-element>Кодекс Этики</a></li><li><a href=https://www.freebsd.org/security/ target=_blank class=column-element>Бюллетени Безопасности</a></li></ul></section><section class=documentation-column><h3 class=column-title>Документация</h3><ul class=column-elements-container><li><a href=/ru class=column-element>Портал документации</a></li><li><a href=https://man.FreeBSD.org target=_blank class=column-element>Страницы Справочника</a></li><li><a href=https://papers.FreeBSD.org target=_blank class=column-element>Презентации и публикации</a></li><li><a href=https://docs-archive.freebsd.org/doc/ target=_blank class=column-element>Предыдущие версии</a></li><li><a href=https://docs-archive.freebsd.org/44doc/ target=_blank class=column-element>Документы 4.4BSD</a></li><li><a href=https://wiki.freebsd.org/ target=_blank class=column-element>Wiki</a></li></ul></section><section class=community-column><h3 class=column-title>Сообщество</h3><ul class=column-elements-container><li><a href=http://172.16.201.134:1313/ru/articles/contributing class=column-element>Принять участие</a></li><li><a href=https://forums.freebsd.org/ target=_blank class=column-element>Форум Сообщества</a></li><li><a href=https://lists.freebsd.org/ target=_blank class=column-element>Списки рассылки</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank class=column-element>Каналы IRC</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank class=column-element>Трекер ошибок</a></li></ul></section><section class=legal-column><h3 class=column-title>Юридическая информация</h3><ul class=column-elements-container><li><a href=https://freebsdfoundation.org/donate/ target=_blank class=column-element>Пожертвования</a></li><li><a href=https://www.freebsd.org/copyright/freebsd-license/ target=_blank class=column-element>Лицензирование</a></li><li><a href=https://www.freebsd.org/privacy/ target=_blank class=column-element>Политика Конфиденциальности</a></li><li><a href=https://www.freebsd.org/copyright/ target=_blank class=column-element>Юридические оговорки</a></li></ul></section><section class=copyright-column><p>&copy; 1994-2024 Проект FreeBSD. Все права защищены</p><span>Сделано с помощью <span class=heart>♥</span> Сообществом FreeBSD</span></section></div></footer></body></html>