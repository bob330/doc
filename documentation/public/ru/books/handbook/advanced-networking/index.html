<!doctype html><html class=theme-light lang=ru><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content><meta name=copyright content="1995-2024 The FreeBSD Foundation"><link rel=canonical href=http://172.16.201.134:1313/ru/books/handbook/advanced-networking/><title>Глава 27. Сложные вопросы работы в сети | FreeBSD Documentation Portal</title>
<meta name=theme-color content="#790000"><meta name=color-scheme content="system light dark high-contrast"><link rel="shortcut icon" href=http://172.16.201.134:1313/favicon.ico><link rel=stylesheet href=http://172.16.201.134:1313/styles/main.min.css><link rel=stylesheet href=http://172.16.201.134:1313/css/font-awesome-min.css><script defer src=/js/theme-chooser.min.js></script><script defer src=/js/copy-clipboard.min.js></script><script defer src=/js/search.min.js></script><meta name=twitter:card content="summary"><meta name=twitter:domain content="docs.FreeBSD.org"><meta name=twitter:site content="@freebsd"><meta name=twitter:url content="https://twitter.com/freebsd"><meta property="og:title" content="Глава 27. Сложные вопросы работы в сети"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:image" content="http://172.16.201.134:1313/favicon.ico"><meta property="og:image:alt" content="FreeBSD Logo"><meta property="og:locale" content="ru"><meta property="og:url" content="http://172.16.201.134:1313/ru/books/handbook/advanced-networking/"><meta property="og:site_name" content="FreeBSD Documentation Portal"><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","url":"http:\/\/172.16.201.134:1313\/ru\/books\/handbook\/advanced-networking\/","name":"FreeBSD Documentation Portal","headline":"FreeBSD Documentation Portal","description":"FreeBSD Documentation Portal"}</script></head><body><header><div class=header-container><div class=logo-menu-bars-container><a href=https://www.FreeBSD.org class=logo><img src=http://172.16.201.134:1313/images/FreeBSD-monochromatic.svg width=160 height=50 alt="FreeBSD logo">
</a><label class=menu-bars for=menu-bars><i class="fa fa-bars" aria-hidden=true></i></label></div><input id=menu-bars type=checkbox><nav><ul class=menu><li class=menu-item><input id=about type=checkbox>
<a href=# aria-label="Navigate to About section"><label class=menu-item-description for=about>О нас
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/about/ target=_blank>О нас</a></li><li><a href=https://www.freebsd.org/about/ target=_blank>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/about-us/about-the-foundation/ target=_blank>Фонд FreeBSD</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct/ target=_blank>Кодекс Этики</a></li></ul></li><li class=menu-item><input id=download type=checkbox>
<a href=# aria-label="Navigate to get FreeBSD section"><label class=menu-item-description for=download>Получить FreeBSD
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/where/ target=_blank>Получить FreeBSD</a></li><li><a href=https://www.freebsd.org/releases/ target=_blank>Информация о релизах</a></li><li><a href=https://www.freebsd.org/releng/ target=_blank>Подготовка релизов</a></li><li><a href=https://www.freebsd.org/security/ target=_blank>Бюллетени Безопасности</a></li></ul></li><li class=menu-item><input id=documentation type=checkbox>
<a href=# aria-label="Navigate to get Documentation section"><label class=menu-item-description for=documentation>Документация
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=/ru>Портал документации</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook>Руководство</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook>Руководство по созданию портов</a></li><li><a href=https://docs.FreeBSD.org/en/books/fdp-primer>Учебник Проекта Документирования</a></li><li><a href=https://man.FreeBSD.org target=_blank>Страницы Справочника</a></li><li><a href=https://papers.FreeBSD.org target=_blank>Презентации и публикации</a></li><li><a href=https://wiki.FreeBSD.org target=_blank>Wiki</a></li><li><a href=http://172.16.201.134:1313/ru/books>Книги</a></li><li><a href=http://172.16.201.134:1313/ru/articles>Статьи</a></li></ul></li><li class=menu-item><input id=community type=checkbox>
<a href=# aria-label="Navigate to get Community section"><label class=menu-item-description for=community>Сообщество
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/community/>Сообщество</a></li><li><a href=http://172.16.201.134:1313/ru/articles/contributing>Стать участником</a></li><li><a href=https://forums.freebsd.org/ target=_blank>Форум</a></li><li><a href=https://lists.freebsd.org/ target=_blank>Списки рассылки</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank>Каналы IRC</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank>Трекер ошибок</a></li><li><a href=https://www.freebsd.org/support/ target=_blank>Поддержка</a></li></ul></li></ul></nav><div class=search-donate-container><form class=search method=get id=search-header-form action=https://docs.freebsd.org/search name=search-header-form><input type=hidden name=DB value=ru>
<input id=words name=P type=text size=20 maxlength=255>
<button>
<i class="fa fa-search" aria-hidden=true></i></button></form><div class=donate><a href=https://freebsdfoundation.org/donate/ target=_blank><span class=heart>♥</span>
Пожертвования</a></div></div></div></header><input type=checkbox class="hidden toggle" id=menu-control><main class=main-wrapper-book><a id=top></a><aside class=book-menu><div class=book-menu-content><input id=search-book type=text placeholder=Поиск aria-label=Поиск maxlength=128><nav id=MenuContents><ul><li><input type=checkbox id=chapter-eb2a98ce203d8afd517726e6d8776be3 class=toggle>
<label class="icon cursor" for=chapter-eb2a98ce203d8afd517726e6d8776be3><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/preface/>Предисловие</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/preface/#preface-audience>Целевая аудитория</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/preface/#preface-changes-from4>Четвёртое издание</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/preface/#preface-changes-from3>Третье издание</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/preface/#preface-changes-from2>Второе издание (2004)</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/preface/#preface-changes>Первое издание (2001)</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/preface/#preface-overview>Структура этой книги</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/preface/#preface-conv>Договоренности, используемые в этой книге</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/preface/#preface-acknowledgements>Благодарности</a></li></ul></li><li><input type=checkbox id=chapter-14a525fce014b90b8a458a894818255a class=toggle>
<label for=chapter-14a525fce014b90b8a458a894818255a><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/parti/>Часть I. В начале</a></li><li><input type=checkbox id=chapter-f9c9f3451644df30d224350da97d5da6 class=toggle>
<label class="icon cursor" for=chapter-f9c9f3451644df30d224350da97d5da6><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/introduction/>Глава 1. Введение</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/introduction/#introduction-synopsis>1.1. Краткий обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/introduction/#nutshell>1.2. Добро пожаловать во FreeBSD!</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/introduction/#history>1.3. О Проекте FreeBSD</a></li></ul></li><li><input type=checkbox id=chapter-6aaec170775233b7c45f6cdcfb70d466 class=toggle>
<label class="icon cursor" for=chapter-6aaec170775233b7c45f6cdcfb70d466><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/install/>Глава 2. Установка FreeBSD версий 8.X и более ранних</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/install/#install-synopsis>2.1. Краткий обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/install/#install-hardware>2.2. Аппаратные требования</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/install/#install-pre>2.3. Перед установкой</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/install/#install-start>2.4. Начало установки</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/install/#using-sysinstall>2.5. Введение в Sysinstall</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/install/#install-steps>2.6. Выделение дискового пространства</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/install/#install-choosing>2.7. Выбор устанавливаемых компонентов</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/install/#install-media>2.8. Выбор источника для установки</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/install/#install-final-warning>2.9. Подтверждение установки</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/install/#install-post>2.10. После установки</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/install/#install-trouble>2.11. Решение проблем</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/install/#install-advanced>2.12. Расширенное руководство по установке</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/install/#install-diff-media>2.13. Подготовка собственного источника установки</a></li></ul></li><li><input type=checkbox id=chapter-f693a3fa687a72d63ec8129ee302d664 class=toggle>
<label class="icon cursor" for=chapter-f693a3fa687a72d63ec8129ee302d664><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/bsdinstall/>Глава 3. Установка FreeBSD версий 9.X и более поздних</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/bsdinstall/#bsdinstall-synopsis>3.1. Краткий обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/bsdinstall/#bsdinstall-hardware>3.2. Аппаратные требования</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/bsdinstall/#bsdinstall-pre>3.3. Перед установкой</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/bsdinstall/#bsdinstall-start>3.4. Начало установки</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/bsdinstall/#using-bsdinstall>3.5. Введение в bsdinstall</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/bsdinstall/#bsdinstall-netinstall>3.6. Установка по сети</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/bsdinstall/#bsdinstall-partitioning>3.7. Выделение дискового пространства</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/bsdinstall/#bsdinstall-final-warning>3.8. Завершение установки</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/bsdinstall/#bsdinstall-post>3.9. После установки</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/bsdinstall/#bsdinstall-install-trouble>3.10. Решение проблем</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/bsdinstall/#using-live-cd>3.11. Использование Live CD</a></li></ul></li><li><input type=checkbox id=chapter-9f6db261075f578742036fcc6000eecd class=toggle>
<label class="icon cursor" for=chapter-9f6db261075f578742036fcc6000eecd><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/basics/>Глава 4. Основы UNIX</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/basics/#basics-synopsis>4.1. Краткий обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/basics/#consoles>4.2. Виртуальные консоли и терминалы</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/basics/#users-synopsis>4.3. Пользователи и основы управления учетными записями</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/basics/#permissions>4.4. Права доступа</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/basics/#dirstructure>4.5. Структура каталогов</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/basics/#disk-organization>4.6. Организация дисков</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/basics/#mount-unmount>4.7. Монтирование и размонтирование файловых систем</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/basics/#basics-processes>4.8. Процессы</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/basics/#basics-daemons>4.9. Даемоны, сигналы, уничтожение процессов</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/basics/#shells>4.10. Интерпретатор команд</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/basics/#editors>4.11. Текстовые редакторы</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/basics/#basics-devices>4.12. Устройства и файлы устройств</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/basics/#binary-formats>4.13. Бинарные форматы</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/basics/#basics-more-information>4.14. Дополнительная информация</a></li></ul></li><li><input type=checkbox id=chapter-01c5707e95d14c0ff84bf62600c958d1 class=toggle>
<label class="icon cursor" for=chapter-01c5707e95d14c0ff84bf62600c958d1><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/ports/>Глава 5. Установка приложений: порты и пакеты</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/ports/#ports-synopsis>5.1. Обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/ports/#ports-overview>5.2. Обзор установки программного обеспечения</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/ports/#ports-finding-applications>5.3. Поиск программного обеспечения</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/ports/#packages-using>5.4. Использование бинарных пакетов</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/ports/#pkgng-intro>5.5. Использование pkgng для управления бинарными пакетами</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/ports/#ports-using>5.6. Использование Коллекции Портов</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/ports/#ports-nextsteps>5.7. Действия после установки</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/ports/#ports-broken>5.8. Обработка нерабочих портов</a></li></ul></li><li><input type=checkbox id=chapter-f56428b9e0d0b77cc8e863910f96bbde class=toggle>
<label class="icon cursor" for=chapter-f56428b9e0d0b77cc8e863910f96bbde><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/wayland/>Глава 6. Wayland</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/wayland/#wayland-synopsis>6.1. Общие сведения о Wayland</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/wayland/#wayland-wayfire>6.2. Композитный менеджер Wayfire</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/wayland/#wayland-hikari>6.3. Композитный менеджер Hikari</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/wayland/#wayland-sway>6.4. Композитный менеджер Sway</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/wayland/#wayland-xwayland>6.5. Использование Xwayland</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/wayland/#wayland-remotedesktop>6.6. Организация Удалённого Рабочего Стола при помощи VNC</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/wayland/#wayland-ly>6.7. Менеджер регистраций Wayland</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/wayland/#wayland-utilities>6.8. Полезные Инструменты</a></li></ul></li><li><input type=checkbox id=chapter-3405c00581365a8b5d16af70fe4d1b72 class=toggle>
<label class="icon cursor" for=chapter-3405c00581365a8b5d16af70fe4d1b72><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/x11/>Глава 6. X Window System</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/x11/#x11-synopsis>6.1. Обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/x11/#x-understanding>6.2. Основы X</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/x11/#x-install>6.3. Установка X11</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/x11/#x-config>6.4. Конфигурация X11</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/x11/#x-fonts>6.5. Использование шрифтов в X11</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/x11/#x-xdm>6.6. Менеджеры экранов (Display Managers) X</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/x11/#x11-wm>6.7. Графические оболочки</a></li></ul></li><li><input type=checkbox id=chapter-0eab3565e8f59f5a8a896dfba7eb3680 class=toggle>
<label for=chapter-0eab3565e8f59f5a8a896dfba7eb3680><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/partii/>Часть II. Общие задачи</a></li><li><input type=checkbox id=chapter-b33cf28993f3f7bf5baf036e79da0f39 class=toggle>
<label class="icon cursor" for=chapter-b33cf28993f3f7bf5baf036e79da0f39><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/desktop/>Глава 7. Приложения для настольного компьютера</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/desktop/#desktop-synopsis>7.1. Краткий обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/desktop/#desktop-browsers>7.2. Браузеры</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/desktop/#desktop-productivity>7.3. Бизнес приложения</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/desktop/#desktop-viewers>7.4. Программы просмотра документов</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/desktop/#desktop-finance>7.5. Финансовые программы</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/desktop/#desktop-summary>7.6. Итоги</a></li></ul></li><li><input type=checkbox id=chapter-152f694a19312ad72ec7bb4e1c3c33b2 class=toggle>
<label class="icon cursor" for=chapter-152f694a19312ad72ec7bb4e1c3c33b2><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/multimedia/>Глава 8. Мультимедиа</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/multimedia/#multimedia-synopsis>8.1. Краткий обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/multimedia/#sound-setup>8.2. Настройка звуковой карты</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/multimedia/#sound-mp3>8.3. Звук MP3</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/multimedia/#video-playback>8.4. Воспроизведение видео</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/multimedia/#tvcard>8.5. Настройка ТВ тюнеров</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/multimedia/#scanners>8.6. Сканеры</a></li></ul></li><li><input type=checkbox id=chapter-80888b4ee02e3e409e5f71cf97a36450 class=toggle>
<label class="icon cursor" for=chapter-80888b4ee02e3e409e5f71cf97a36450><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/kernelconfig/>Глава 9. Настройка ядра FreeBSD</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/kernelconfig/#kernelconfig-synopsis>9.1. Краткий обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/kernelconfig/#kernelconfig-custom-kernel>9.2. Зачем собирать собственное ядро?</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/kernelconfig/#kernelconfig-devices>9.3. Определение аппаратного обеспечения</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/kernelconfig/#kernelconfig-modules>9.4. Драйвера, подсистемы и модули ядра</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/kernelconfig/#kernelconfig-building>9.5. Сборка и установка собственного ядра</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/kernelconfig/#kernelconfig-config>9.6. Конфигурационный файл</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/kernelconfig/#kernelconfig-trouble>9.7. Решение проблем</a></li></ul></li><li><input type=checkbox id=chapter-cb174c55879b17ab955f2f16989a79e0 class=toggle>
<label class="icon cursor" for=chapter-cb174c55879b17ab955f2f16989a79e0><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/printing/>Глава 10. Печать</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/printing/#printing-synopsis>10.1. Краткий обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/printing/#printing-intro-spooler>10.2. Введение</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/printing/#printing-intro-setup>10.3. Основная настройка</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/printing/#printing-advanced>10.4. Расширенная настройка принтера</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/printing/#printing-using>10.5. Использование принтеров</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/printing/#printing-lpd-alternatives>10.6. Альтернативы стандартному спулеру</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/printing/#printing-troubleshooting>10.7. Выявление проблем</a></li></ul></li><li><input type=checkbox id=chapter-c12b8c3f2a8fcefce87087241f695c83 class=toggle>
<label class="icon cursor" for=chapter-c12b8c3f2a8fcefce87087241f695c83><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/linuxemu/>Глава 11. Двоичная совместимость с Linux</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/linuxemu/#linuxemu-synopsis>11.1. Краткий обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/linuxemu/#linuxemu-lbc-install>11.2. Установка</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/linuxemu/#linuxemu-mathematica>11.3. Установка Mathematica®</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/linuxemu/#linuxemu-maple>11.4. Установка Maple™</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/linuxemu/#linuxemu-matlab>11.5. Установка MATLAB®</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/linuxemu/#linuxemu-oracle>11.6. Установка Oracle®</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/linuxemu/#sapr3>11.7. Установка SAP® R/3®</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/linuxemu/#linuxemu-advanced>11.8. Дополнительные сведения</a></li></ul></li><li><input type=checkbox id=chapter-03b11ba627b9a0c85b247f5641bde272 class=toggle>
<label for=chapter-03b11ba627b9a0c85b247f5641bde272><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/partiii/>Часть III. Системное администрирование</a></li><li><input type=checkbox id=chapter-6c31587f8d736319f099cd4dc1961301 class=toggle>
<label class="icon cursor" for=chapter-6c31587f8d736319f099cd4dc1961301><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/config/>Глава 12. Настройка и оптимизация</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/config/#config-synopsis>12.1. Введение</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/config/#configtuning-initial>12.2. Начальное конфигурирование</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/config/#configtuning-core-configuration>12.3. Основные настройки</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/config/#configtuning-appconfig>12.4. Настройка приложений</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/config/#configtuning-starting-services>12.5. Запуск сервисов</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/config/#configtuning-cron>12.6. Настройка утилиты <code>cron</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/config/#configtuning-rcd>12.7. Использование rc во FreeBSD 5.X и последующих версиях</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/config/#config-network-setup>12.8. Настройка карт сетевых интерфейсов</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/config/#configtuning-virtual-hosts>12.9. Настройка виртуальных серверов</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/config/#configtuning-configfiles>12.10. Файлы настройки</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/config/#configtuning-sysctl>12.11. Настройка с помощью sysctl</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/config/#configtuning-disk>12.12. Оптимизация дисков</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/config/#configtuning-kernel-limits>12.13. Изменение ограничений, накладываемых ядром</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/config/#adding-swap-space>12.14. Увеличение объема подкачки</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/config/#acpi-overview>12.15. Управление питанием и ресурсами</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/config/#ACPI-debug>12.16. Использование и отладка FreeBSD ACPI</a></li></ul></li><li><input type=checkbox id=chapter-459f0012b3b4f0b6b123010f029da5e4 class=toggle>
<label class="icon cursor" for=chapter-459f0012b3b4f0b6b123010f029da5e4><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/boot/>Глава 13. Процесс загрузки FreeBSD</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/boot/#boot-synopsis>13.1. Описание</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/boot/#boot-introduction>13.2. Проблема загрузки</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/boot/#boot-blocks>13.3. Менеджер загрузки и этапы загрузки</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/boot/#boot-kernel>13.4. Взаимодействие с ядром во время загрузки</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/boot/#device-hints>13.5. Хинты устройств</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/boot/#boot-init>13.6. Init: инициализация управления процессами</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/boot/#boot-shutdown>13.7. Процесс остановки системы</a></li></ul></li><li><input type=checkbox id=chapter-917c75fcffbb14d48ed6d0a48e7028f2 class=toggle>
<label class="icon cursor" for=chapter-917c75fcffbb14d48ed6d0a48e7028f2><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/security/>Глава 14. Безопасность</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/security/#security-synopsis>14.1. Краткое описание</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/security/#security-intro>14.2. Введение</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/security/#securing-freebsd>14.3. Защита FreeBSD</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/security/#crypt>14.4. DES, MD5, и шифрование</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/security/#one-time-passwords>14.5. Одноразовые пароли</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/security/#tcpwrappers>14.6. TCP Wrappers</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/security/#kerberosIV>14.7. KerberosIV</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/security/#kerberos5>14.8. Kerberos5</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/security/#openssl>14.9. OpenSSL</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/security/#ipsec>14.10. VPN через IPsec</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/security/#openssh>14.11. OpenSSH</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/security/#fs-acl>14.12. Списки контроля доступа файловой системы (ACL)</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/security/#security-portaudit>14.13. Мониторинг вопросов безопасности в ПО сторонних разработчиков</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/security/#security-advisories>14.14. Сообщения безопасности FreeBSD</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/security/#security-accounting>14.15. Учёт используемых ресурсов</a></li></ul></li><li><input type=checkbox id=chapter-8f4620c77e572cbb58917911a33c73cf class=toggle>
<label class="icon cursor" for=chapter-8f4620c77e572cbb58917911a33c73cf><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/mac/>Глава 15. Принудительный контроль доступа (MAC)</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/mac/#mac-synopsis>15.1. Краткий обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mac/#mac-inline-glossary>15.2. Ключевые термины этой главы</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mac/#mac-initial>15.3. Описание MAC</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mac/#mac-understandlabel>15.4. Метки MAC</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mac/#mac-modules>15.5. Настройка модулей</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mac/#mac-bsdextended>15.6. Модуль MAC bsdextended</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mac/#mac-ifoff>15.7. Модуль MAC ifoff</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mac/#mac-portacl>15.8. Модуль MAC portacl</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mac/#mac-labelingpolicies>15.9. Политики MAC, использующие метки</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mac/#mac-partition>15.10. Модуль MAC partition</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mac/#mac-mls>15.11. Модуль многоуровневой безопасности MAC (MLS)</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mac/#mac-biba>15.12. Модуль MAC Biba</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mac/#mac-lomac>15.13. Модуль MAC LOMAC</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mac/#mac-implementing>15.14. Реализация защищенной среды с MAC</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mac/#MAC-examplehttpd>15.15. Другой пример: Использование MAC для защиты веб сервера</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mac/#mac-troubleshoot>15.16. Решение проблем с инфраструктурой MAC</a></li></ul></li><li><input type=checkbox id=chapter-9598d66a76cb3182057b6bcd775149a0 class=toggle>
<label class="icon cursor" for=chapter-9598d66a76cb3182057b6bcd775149a0><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/audit/>Глава 16. Аудит событий безопасности</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/audit/#audit-synopsis>16.1. Краткий обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/audit/#audit-inline-glossary>16.2. Ключевые понятия</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/audit/#audit-config>16.3. Настройка системы аудита</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/audit/#audit-administration>16.4. Работа с журналами аудита</a></li></ul></li><li><input type=checkbox id=chapter-e1edcad13d9db6e8e4cb645d378ecfaf class=toggle>
<label class="icon cursor" for=chapter-e1edcad13d9db6e8e4cb645d378ecfaf><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/disks/>Глава 17. Устройства хранения</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/disks/#disks-synopsis>17.1. Краткий обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/disks/#disks-naming>17.2. Имена устройств</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/disks/#disks-adding>17.3. Добавление дисков</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/disks/#raid>17.4. RAID</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/disks/#usb-disks>17.5. USB устройства хранения</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/disks/#creating-cds>17.6. Запись и использование оптических носителей (CD)</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/disks/#creating-dvds>17.7. Создание и использование оптических носителей (DVD)</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/disks/#floppies>17.8. Дискеты</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/disks/#backups-tapebackups>17.9. Создание и использование архивных копий на магнитной ленте</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/disks/#backups-floppybackups>17.10. Создание резервных копий на дискетах</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/disks/#backup-strategies>17.11. Стратегии резервного копирования</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/disks/#backup-basics>17.12. Основы технологии резервного копирования</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/disks/#disks-virtual>17.13. Сетевые файловые системы, файловые системы в памяти и с отображением в файл</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/disks/#snapshots>17.14. Мгновенные копии файловых систем</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/disks/#quotas>17.15. Квотирование файловых систем</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/disks/#disks-encrypting>17.16. Шифрование дисковых разделов</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/disks/#swap-encrypting>17.17. Шифрование области подкачки</a></li></ul></li><li><input type=checkbox id=chapter-dde37901a0e0ea32745b67607854900f class=toggle>
<label class="icon cursor" for=chapter-dde37901a0e0ea32745b67607854900f><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/geom/>Глава 18. GEOM: Модульная инфраструктура преобразования дисковых запросов</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/geom/#GEOM-synopsis>18.1. Краткий обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/geom/#GEOM-intro>18.2. Введение в GEOM</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/geom/#GEOM-striping>18.3. RAID0 - Создание дисковой последовательности (Striping)</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/geom/#GEOM-mirror>18.4. RAID1 - Зеркалирование (Mirroring)</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/geom/#geom-ggate>18.5. Сетевые устройства GEOM Gate</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/geom/#geom-glabel>18.6. Метки дисковых устройств</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/geom/#geom-gjournal>18.7. Журналирование UFS средствами GEOM</a></li></ul></li><li><input type=checkbox id=chapter-7af71270807eb7b70cd3eedc6577b254 class=toggle>
<label class="icon cursor" for=chapter-7af71270807eb7b70cd3eedc6577b254><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/filesystems/>Глава 19. Поддержка файловых систем</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/filesystems/#filesystems-synopsis>19.1. Краткий обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/filesystems/#filesystems-zfs>19.2. Файловая система ZFS</a></li></ul></li><li><input type=checkbox id=chapter-49f1e96591c090304ea532012257f4ef class=toggle>
<label class="icon cursor" for=chapter-49f1e96591c090304ea532012257f4ef><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/l10n/>Глава 20. Локализация - использование и настройка i18n/L10n</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/l10n/#l10n-synopsis>20.1. Краткий обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/l10n/#using-localization>20.2. Использование локализации</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/l10n/#l10n-compiling>20.3. Поиск приложений i18n</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/l10n/#lang-setup>20.4. Настройка локализации для некоторых языков</a></li></ul></li><li><input type=checkbox id=chapter-dead2b4c5ea325dd390a9b0dccd8f763 class=toggle>
<label class="icon cursor" for=chapter-dead2b4c5ea325dd390a9b0dccd8f763><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/cutting-edge/>Глава 21. Обновление системы и смена версии FreeBSD</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/cutting-edge/#updating-upgrading-synopsis>21.1. Краткий обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/cutting-edge/#updating-upgrading-freebsdupdate>21.2. Обновление FreeBSD</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/cutting-edge/#updating-upgrading-documentation>21.3. Обновление документации</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/cutting-edge/#current-stable>21.4. Использование ветви разработки</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/cutting-edge/#synching>21.5. Синхронизация исходных текстов</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/cutting-edge/#makeworld>21.6. Пересборка мира</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/cutting-edge/#small-lan>21.7. Отслеживание исходных текстов для нескольких машин</a></li></ul></li><li><input type=checkbox id=chapter-bbd25f9a194f9c39ca2d658c75767db5 class=toggle>
<label for=chapter-bbd25f9a194f9c39ca2d658c75767db5><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/partiv/>Часть IV. Сетевые коммуникации</a></li><li><input type=checkbox id=chapter-499dab596afd7ddac77e80295314e0dd class=toggle>
<label class="icon cursor" for=chapter-499dab596afd7ddac77e80295314e0dd><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/serialcomms/>Глава 22. Последовательные соединения</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/serialcomms/#serial-synopsis>22.1. Краткое описание</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/serialcomms/#serial>22.2. Введение</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/serialcomms/#term>22.3. Терминалы</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/serialcomms/#dialup>22.4. Входящие соединения по модему</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/serialcomms/#dialout>22.5. Исходящие соединения по модему</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/serialcomms/#serialconsole-setup>22.6. Настройка последовательной консоли</a></li></ul></li><li><input type=checkbox id=chapter-95e4571c48bee1cced5e84a538d302e3 class=toggle>
<label class="icon cursor" for=chapter-95e4571c48bee1cced5e84a538d302e3><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/ppp-and-slip/>Глава 23. PPP и SLIP</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/ppp-and-slip/#ppp-and-slip-synopsis>23.1. Краткий обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/ppp-and-slip/#userppp>23.2. PPP уровня пользователя</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/ppp-and-slip/#ppp>23.3. PPP уровня ядра</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/ppp-and-slip/#ppp-troubleshoot>23.4. Решение проблем с соединениями PPP</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/ppp-and-slip/#pppoe>23.5. Использование PPP через Ethernet (PPPoE)</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/ppp-and-slip/#pppoa>23.6. Использование PPP через ATM (PPPoA)</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/ppp-and-slip/#slip>23.7. Использование SLIP</a></li></ul></li><li><input type=checkbox id=chapter-f089ac726c401c9b4bd5c34a295e11bb class=toggle>
<label class="icon cursor" for=chapter-f089ac726c401c9b4bd5c34a295e11bb><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/mail/>Глава 24. Электронная почта</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/mail/#mail-synopsis>24.1. Краткий обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mail/#mail-using>24.2. Использование электронной почты</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mail/#sendmail>24.3. Настройка sendmail</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mail/#mail-changingmta>24.4. Установка другой почтовой программы</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mail/#mail-trouble>24.5. Поиск и устранение неисправностей</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mail/#mail-advanced>24.6. Расширенное руководство</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mail/#outgoing-only>24.7. Настройка почты только для отправки</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mail/#SMTP-dialup>24.8. Использование почты с коммутируемым соединением</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mail/#SMTP-Auth>24.9. SMTP аутентификация</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mail/#mail-agents>24.10. Почтовые программы пользователей</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mail/#mail-fetchmail>24.11. Использование fetchmail</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mail/#mail-procmail>24.12. Использование procmail</a></li></ul></li><li><input type=checkbox id=chapter-6de4de3fe925639d4175ce4b6f8c1829 class=toggle>
<label class="icon cursor" for=chapter-6de4de3fe925639d4175ce4b6f8c1829><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/network-servers/>Глава 25. Сетевые серверы</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/network-servers/#network-servers-synopsis>25.1. Краткий обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/network-servers/#network-inetd>25.2. "Супер-сервер"inetd</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/network-servers/#network-nfs>25.3. Network File System (NFS)</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/network-servers/#network-nis>25.4. Network Information System (NIS/YP)</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/network-servers/#network-dhcp>25.5. Автоматическая настройка сети (DHCP)</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/network-servers/#network-dns>25.6. Domain Name System (DNS)</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/network-servers/#network-apache>25.7. Apache HTTP сервер</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/network-servers/#network-samba>25.8. Файл сервер и печать для Microsoft® Windows® клиентов (Samba)</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/network-servers/#network-ftp>25.9. Протокол передачи файлов (FTP)</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/network-servers/#network-ntp>25.10. Синхронизация часов через NTP</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/network-servers/#network-syslogd>25.11. * Remote Host Logging with <code>syslogd</code></a></li></ul></li><li><input type=checkbox id=chapter-776d855c7b75e048f90b5c2c9b35ffe0 class=toggle>
<label class="icon cursor" for=chapter-776d855c7b75e048f90b5c2c9b35ffe0><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/firewalls/>Глава 26. Межсетевые экраны</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/firewalls/#firewalls-intro>26.1. Введение</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/firewalls/#firewalls-concepts>26.2. Принципы работы межсетевых экранов</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/firewalls/#firewalls-apps>26.3. Пакеты межсетевых экранов</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/firewalls/#firewalls-pf>26.4. Packet Filter (PF, межсетевой экран OpenBSD) и ALTQ</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/firewalls/#firewalls-ipf>26.5. * IPFILTER (IPF)</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/firewalls/#firewalls-ipfw>26.6. IPFW</a></li></ul></li><li><input type=checkbox id=chapter-5b07f776a0e6155c1c89aa0d15610380 class=toggle checked>
<label class="icon cursor" for=chapter-5b07f776a0e6155c1c89aa0d15610380><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/advanced-networking/>Глава 27. Сложные вопросы работы в сети</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/advanced-networking/#advanced-networking-synopsis>27.1. Краткий обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/advanced-networking/#network-routing>27.2. Сетевые шлюзы и маршруты</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/advanced-networking/#network-wireless>27.3. Беспроводные сети</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/advanced-networking/#network-bluetooth>27.4. Bluetooth</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/advanced-networking/#network-bridging>27.5. Мосты</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/advanced-networking/#network-diskless>27.6. Работа с бездисковыми станциями</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/advanced-networking/#network-isdn>27.7. ISDN</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/advanced-networking/#network-natd>27.8. Даемон преобразования сетевых адресов (natd)</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/advanced-networking/#network-plip>27.9. IP по параллельному порту (PLIP)</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/advanced-networking/#network-ipv6>27.10. IPv6</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/advanced-networking/#network-atm>27.11. Асинхронный режим передачи (ATM)</a></li></ul></li><li><input type=checkbox id=chapter-171a77aa9d067a1024f849470e1f33e8 class=toggle>
<label for=chapter-171a77aa9d067a1024f849470e1f33e8><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/partv/>Часть V. Приложения</a></li><li><input type=checkbox id=chapter-8050f436a0a7986a4aaded93d8e49469 class=toggle>
<label class="icon cursor" for=chapter-8050f436a0a7986a4aaded93d8e49469><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/mirrors/>Приложение A. Получение FreeBSD</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/mirrors/#mirrors-cdrom>A.1. Наборы CD и DVD</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mirrors/#mirrors-ftp>A.2. FTP сайты</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mirrors/#ctm>A.3. Использование CTM</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mirrors/#svn>A.4. Использование Subversion</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mirrors/#mirrors-rsync>A.5. Использование rsync</a></li></ul></li><li><input type=checkbox id=chapter-128b630a8f88f158e7027fe6c2184d21 class=toggle>
<label class="icon cursor" for=chapter-128b630a8f88f158e7027fe6c2184d21><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/bibliography/>Приложение B. Библиография</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/bibliography/#bibliography-freebsd>B.1. Книги и журналы, специализирующиеся на FreeBSD</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/bibliography/#bibliography-userguides>B.2. Руководства для пользователей</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/bibliography/#bibliography-adminguides>B.3. Руководства для администраторов</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/bibliography/#bibliography-programmers>B.4. Руководства для программистов</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/bibliography/#bibliography-osinternals>B.5. Внутренности операционной системы</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/bibliography/#bibliography-security>B.6. Безопасность</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/bibliography/#bibliography-hardware>B.7. Оборудование</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/bibliography/#bibliography-history>B.8. История UNIX®</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/bibliography/#bibliography-journals>B.9. Прочие издания</a></li></ul></li><li><input type=checkbox id=chapter-8bbb8867c46dac315e2253945d8c18a8 class=toggle>
<label class="icon cursor" for=chapter-8bbb8867c46dac315e2253945d8c18a8><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/eresources/>Приложение C. Ресурсы в интернет</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/eresources/#eresources-mail>C.1. Списки рассылки</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/eresources/#eresources-news>C.2. Новостные группы Usenet</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/eresources/#eresources-web>C.3. Серверы World Wide Web</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/eresources/#eresources-email>C.4. Адреса Email</a></li></ul></li><li><input type=checkbox id=chapter-a80ea4f5a4480b8725422710f954ef36 class=toggle>
<label class="icon cursor" for=chapter-a80ea4f5a4480b8725422710f954ef36><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/pgpkeys/>Приложение D. PGP ключи</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/pgpkeys/#pgpkeys-officers>D.1. Офицеры</a></li></ul></li><li></li></ul></nav></div></aside><div class=book><div class=book-menu-mobile><label for=menu-control><span class=menu-control-button><i class="fa fa-list" aria-hidden=true title="Меню книг"></i>
Меню книг</span></label></div><h1 class=title>Глава 27. Сложные вопросы работы в сети</h1><div class="admonitionblock note"><p><i class="fa fa-exclamation-circle" aria-hidden=true></i>
Этот перевод может быть устаревшим. Для того, чтобы помочь с переводом, пожалуйста, обратитесь к <a href=https://translate-dev.freebsd.org/ target=_blank>Сервер переводов FreeBSD</a>.</p></div><div class=toc-mobile><h3>Содержание</h3><nav id=TableOfContents><ul><li><a href=#advanced-networking-synopsis>27.1. Краткий обзор</a></li><li><a href=#network-routing>27.2. Сетевые шлюзы и маршруты</a></li><li><a href=#network-wireless>27.3. Беспроводные сети</a></li><li><a href=#network-bluetooth>27.4. Bluetooth</a></li><li><a href=#network-bridging>27.5. Мосты</a></li><li><a href=#network-diskless>27.6. Работа с бездисковыми станциями</a></li><li><a href=#network-isdn>27.7. ISDN</a></li><li><a href=#network-natd>27.8. Даемон преобразования сетевых адресов (natd)</a></li><li><a href=#network-plip>27.9. IP по параллельному порту (PLIP)</a></li><li><a href=#network-ipv6>27.10. IPv6</a></li><li><a href=#network-atm>27.11. Асинхронный режим передачи (ATM)</a></li></ul></nav></div><div class=book-content><div id=preamble><div class=sectionbody></div></div><div class=sect1><h2 id=advanced-networking-synopsis>27.1. Краткий обзор<a class=anchor href=#advanced-networking-synopsis></a></h2><div class=sectionbody><div class=paragraph><p>Эта глава охватывает множество различных сетевых тематик повышенной сложности.</p></div><div class=paragraph><p>После чтения этой главы вы будете знать:</p></div><div class=ulist><ul><li><p>Основные понятия о маршрутизации и маршрутах.</p></li><li><p>Как настроить IEEE 802.11 и Bluetooth®.</p></li><li><p>Как заставить FreeBSD работать в качестве сетевого моста.</p></li><li><p>Как настроить загрузку по сети для бездисковой машины.</p></li><li><p>Как настроить трансляцию сетевых адресов.</p></li><li><p>Как соединить два компьютера посредством PLIP.</p></li><li><p>Как настроить IPv6 на машине FreeBSD.</p></li><li><p>Как настроить ATM.</p></li></ul></div><div class=paragraph><p>Перед чтением этой главы вы должны:</p></div><div class=ulist><ul><li><p>Понимать основы работы скриптов <span class=filename>/etc/rc</span>.</p></li><li><p>Свободно владеть основными сетевыми терминами.</p></li><li><p>Знать как настраивать и устанавливать новое ядро FreeBSD (<a href=../kernelconfig/#kernelconfig>Настройка ядра FreeBSD</a>).</p></li><li><p>Знать как устанавливать дополнительное программное обеспечение сторонних разработчиков (<a href=../ports/#ports>Установка приложений. порты и пакеты</a>).</p></li></ul></div></div></div><div class=sect1><h2 id=network-routing>27.2. Сетевые шлюзы и маршруты<a class=anchor href=#network-routing></a></h2><div class=sectionbody><div class=paragraph><p>Чтобы некоторая машина могла найти в сети другую, должен иметься механизм описания того, как добраться от одной машине к другой. Такой механизм называется <em>маршрутизацией</em>. "Маршрут" задаётся парой адресов: "адресом назначения" (destination) и "сетевым шлюзом" (gateway). Эта пара указывает на то, что если Вы пытаетесь соединиться с <em>адресом назначения</em>, то вам нужно устанавливать связь через "сетевой шлюз". Существует три типа адресов назначения: отдельные хосты, подсети и "маршрут по умолчанию" (default). "Маршрут по умолчанию" (default route) используется, если не подходит ни один из других маршрутов. Мы поговорим немного подробнее о маршрутах по умолчанию позже. Также имеется и три типа сетевых шлюзов: отдельные хосты, интерфейсы (также называемые "подключениями" (links)) и аппаратные адреса Ethernet (MAC-адреса).</p></div><div class=sect2><h3 id=_пример>27.2.1. Пример<a class=anchor href=#_пример></a></h3><div class=paragraph><p>Для иллюстрации различных аспектов маршрутизации мы будем использовать следующий пример использования команды <code>netstat</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% netstat <span class=nt>-r</span>
Routing tables

Destination      Gateway            Flags     Refs     Use     Netif Expire

default 	 outside-gw	    UGSc       37      418	ppp0
localhost	 localhost	    UH		0      181	 lo0
test0		 0:e0:b5:36:cf:4f   UHLW	5    63288	 ed0	 77
10.20.30.255	 <span class=nb>link</span><span class=c>#1 	    UHLW	1     2421</span>
example.com	 <span class=nb>link</span><span class=c>#1 	    UC		0	 0</span>
host1		 0:e0:a8:37:8:1e    UHLW	3     4601	 lo0
host2		 0:e0:a8:37:8:1e    UHLW	0	 5	 lo0 <span class=o>=&gt;</span>
host2.example.com <span class=nb>link</span><span class=c>#1 	    UC		0	 0</span>
224		 <span class=nb>link</span><span class=c>#1 	    UC		0	 0</span></code></pre></div></div><div class=paragraph><p>В первых двух строках задаются маршрут по умолчанию (который будет описан в <a href=#network-routing-default>следующем разделе</a>) и маршрут на <code>localhost</code>.</p></div><div class=paragraph><p>Интерфейс (колонка <code>Netif</code>), который указан в этой таблице маршрутов для использования с <code>localhost</code> и который назван <span class=filename>lo0</span>, имеет также второе название, устройство loopback. Это значит сохранение всего трафика для указанного адреса назначения внутри, без посылки его по сети, так как он все равно будет направлен туда, где был создан.</p></div><div class=paragraph><p>Следующими выделяющимися адресами являются адреса, начинающиеся с <code>0:e0:…​</code>. Это аппаратные адреса Ethernet, или MAC-адреса. FreeBSD будет автоматически распознавать любой хост (в нашем примере это <code>test0</code>) в локальной сети Ethernet и добавит маршрут для этого хоста, указывающий непосредственно на интерфейс Ethernet, <span class=filename>ed0</span>. С этим типом маршрута также связан параметр таймаута (колонка <code>Expire</code>), используемый в случае неудачной попытки услышать этот хост в течении некоторого периода времени. Если такое происходит, то маршрут до этого хоста будет автоматически удалён. Такие хосты поддерживаются при помощи механизма, известного как RIP (Routing Information Protocol), который вычисляет маршруты к хостам локальной сети при помощи определения кратчайшего расстояния.</p></div><div class=paragraph><p>FreeBSD добавит также все маршруты к подсетям для локальных подсетей (<code>10.20.30.255</code> является широковещательным адресом для подсети <code>10.20.30</code>, а имя <code>example.com</code> является именем домена, связанным с этой подсетью). Назначение <code>link#1</code> соответствует первому адаптеру Ethernet в машине. Отметьте отсутствие дополнительного интерфейса для этих строк.</p></div><div class=paragraph><p>В обеих этих группах (хосты и подсети локальной сети) маршруты конфигурируются автоматически даемоном, который называется routed. Если он не запущен, то будут существовать только статически заданные (то есть введенные явно) маршруты.</p></div><div class=paragraph><p>Строка <code>host1</code> относится к нашему хосту, который известен по адресу Ethernet. Так как мы являемся посылающим хостом, FreeBSD знает, что нужно использовать loopback-интерфейс (<span class=filename>lo0</span>) вместо того, чтобы осуществлять посылку в интерфейс Ethernet.</p></div><div class=paragraph><p>Две строки <code>host2</code> являются примером того, что происходит при использовании алиасов в команде <a href="https://man.freebsd.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;format=html">ifconfig(8)</a> (обратитесь к разделу об Ethernet для объяснения того, почему мы это делаем). Символ <code>⇒</code> после интерфейса <span class=filename>lo0</span> указывает на то, что мы используем не просто интерфейс loopback (так как это адрес, обозначающий локальный хост), но к тому же это алиас. Такие маршруты появляются только на хосте, поддерживающем алиасы; для всех остальных хостов в локальной сети для таких маршрутов будут показаны просто строчки <code>link#1</code>.</p></div><div class=paragraph><p>Последняя строчка (подсеть назначения <code>224</code>) имеет отношение к многоадресной посылке, которая будет рассмотрена в другом разделе.</p></div><div class=paragraph><p>И наконец, различные атрибуты каждого маршрута перечисляются в колонке <code>Flags</code>. Ниже приводится краткая таблица некоторых из этих флагов и их значений:</p></div><table class="tableblock frame-none grid-all stretch informaltable"><col style=width:50%><col style=width:50%><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock>U</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Up: Маршрут актуален.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>H</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Host: Адресом назначения является отдельный хост.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>G</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Gateway: Посылать все для этого адреса назначения на указанную удаленную систему, которая будет сама определять дальнейший путь прохождения информации.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>S</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Static: Маршрут был настроен вручную, а не автоматически сгенерирован системой.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>C</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Clone: Новый маршрут сгенерирован на основе указанного для машин, к которым мы подключены. Такой тип маршрута обычно используется для локальных сетей.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>W</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>WasCloned: Указывает на то, что маршрут был автоматически сконфигурирован на основе маршрута в локальной сети (Clone).</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>L</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Link: Маршрут включает ссылку на аппаратный адрес Ethernet.</p></td></tr></tbody></table></div><div class=sect2><h3 id=network-routing-default>27.2.2. Маршруты по умолчанию<a class=anchor href=#network-routing-default></a></h3><div class=paragraph><p>Когда локальной системе нужно установить соединение с удаленным хостом, она обращается к таблице маршрутов для того, чтобы определить, существует ли такой маршрут. Если удаленный хост попадает в подсеть, для которой известен способ ее достижения (маршруты типа Cloned), то система определяет возможность подключиться к ней по этому интерфейсу.</p></div><div class=paragraph><p>Если все известные маршруты не подходят, у системы имеется последняя возможность: маршрут "default". Это маршрут с особым типом сетевого шлюза (обычно единственным, присутствующим в системе), и в поле флагов он всегда помечен как <code>c</code>. Для хостов в локальной сети этот сетевой шлюз указывает на машину, имеющую прямое подключение к внешнему миру (неважно, используется ли связь по протоколу PPP, канал DSL, кабельный модем, T1 или какой-то другой сетевой интерфейс).</p></div><div class=paragraph><p>Если вы настраиваете маршрут по умолчанию на машине, которая сама является сетевым шлюзом во внешний мир, то маршрутом по умолчанию будет являться сетевой шлюз у Вашего провайдера Интернет (ISP).</p></div><div class=paragraph><p>Давайте взглянем на примеры маршрутов по умолчанию. Вот типичная конфигурация:</p></div><div class=imageblock><div class=content><img src=../../../../images/books/handbook/advanced-networking/net-routing.png alt="net routing"></div></div><div class=paragraph><p>Хосты <code>Local1</code> и <code>Local2</code> находятся в нашей сети. <code>Local1</code> подключён к ISP через коммутируемое соединение по протоколу PPP. Этот компьютер с сервером PPP подключён посредством локальной сети к другому шлюзовому компьютеру через внешний интерфейс самого ISP к Интернет.</p></div><div class=paragraph><p>Маршруты по умолчанию для каждой из ваших машин будут следующими:</p></div><table class="tableblock frame-none grid-all stretch informaltable"><col style=width:33.3333%><col style=width:33.3333%><col style=width:33.3334%><thead><tr><th class="tableblock halign-left valign-top">Хост</th><th class="tableblock halign-left valign-top">Маршрут по умолчанию</th><th class="tableblock halign-left valign-top">Интерфейс</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Local2</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Local1</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Ethernet</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Local1</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>T1-GW</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>PPP</p></td></tr></tbody></table><div class=paragraph><p>Часто задаётся вопрос "Почему (или каким образом) в качестве шлюза по умолчанию для машины <code>Local1</code> мы указываем <code>T1-GW</code>, а не сервер провайдера, к которому подключаемся?".</p></div><div class=paragraph><p>Запомните, что из-за использования PPP-интерфейсом адреса в сети провайдера Интернет с вашей стороны соединения, маршруты для всех других машин в локальной сети провайдера будут сгенерированы автоматически. Таким образом, вы уже будете знать, как достичь машины <code>T1-GW</code>, так что нет нужды в промежуточной точке при посылке трафика к серверу ISP.</p></div><div class=paragraph><p>В локальных сетях адрес <code>X.X.X.1</code> часто используется в качестве адреса сетевого шлюза. Тогда (при использовании того же самого примера) если пространство адресов класса C вашей локальной сети было задано как <code>10.20.30</code>, а ваш провайдер использует <code>10.9.9</code>, то маршруты по умолчанию будут такие:</p></div><table class="tableblock frame-none grid-all stretch informaltable"><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">Хост</th><th class="tableblock halign-left valign-top">Маршрут по умолчанию</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Local2 (10.20.30.2)</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Local1 (10.20.30.1)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Local1 (10.20.30.1, 10.9.9.30)</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>T1-GW (10.9.9.1)</p></td></tr></tbody></table><div class=paragraph><p>Вы можете легко задать используемый по умолчанию маршрутизатор посредством файла <span class=filename>/etc/rc.conf</span>. В нашем примере на машине <code>Local2</code> мы добавили такую строку в файл <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>defaultrouter=&#34;10.20.30.1&#34;</pre></div></div><div class=paragraph><p>Это также возможно сделать и непосредственно из командной строки при помощи команды <a href="https://man.freebsd.org/cgi/man.cgi?query=route&amp;sektion=8&amp;format=html">route(8)</a>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># route add default 10.20.30.1</span></code></pre></div></div><div class=paragraph><p>Для получения дополнительной информации об управлении таблицами маршрутизации обратитесь к справочной странице по команде <a href="https://man.freebsd.org/cgi/man.cgi?query=route&amp;sektion=8&amp;format=html">route(8)</a>.</p></div></div><div class=sect2><h3 id=_хосты_с_двойным_подключением>27.2.3. Хосты с двойным подключением<a class=anchor href=#_хосты_с_двойным_подключением></a></h3><div class=paragraph><p>Есть еще один тип подключения, который мы должны рассмотреть, и это случай, когда хост находится в двух различных сетях. Технически, любая машина, работающая как сетевой шлюз (в примере выше использовалось PPP-соединение), считается хостом с двойным подключением. Однако этот термин реально используется для описания машины, находящейся в двух локальных сетях.</p></div><div class=paragraph><p>В одном случае у машины имеется два адаптера Ethernet, каждый имеющий адрес в разделенных подсетях. Как альтернативу можно рассмотреть вариант с одним Ethernet-адаптером и использованием алиасов в команде <a href="https://man.freebsd.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;format=html">ifconfig(8)</a>. В первом случае используются два физически разделённые сети Ethernet, в последнем имеется один физический сегмент сети, но две логически разделённые подсети.</p></div><div class=paragraph><p>В любом случае таблицы маршрутизации настраиваются так, что для каждой подсети эта машина определена как шлюз (входной маршрут) в другую подсеть. Такая конфигурация, при которой машина выступает в роли маршрутизатора между двумя подсетями, часто используется, если нужно реализовать систему безопасности на основе фильтрации пакетов или функций брандмауэра в одном или обоих направлениях.</p></div><div class=paragraph><p>Если вы хотите, чтобы эта машина действительно перемещала пакеты между двумя интерфейсами, то вам нужно указать FreeBSD на включение этой функции. Обратитесь к следующей главе, чтобы узнать, как это сделать.</p></div></div><div class=sect2><h3 id=network-dedicated-router>27.2.4. Построение маршрутизатора<a class=anchor href=#network-dedicated-router></a></h3><div class=paragraph><p>Сетевой маршрутизатор является обычной системой, которая пересылает пакеты с одного интерфейса на другой. Стандарты Интернет и хорошая инженерная практика не позволяют Проекту FreeBSD включать эту функцию по умолчанию во FreeBSD. Вы можете включить эту возможность, изменив значение следующей переменной в <code>YES</code> в файле <a href="https://man.freebsd.org/cgi/man.cgi?query=rc.conf&amp;sektion=5&amp;format=html">rc.conf(5)</a>:</p></div><div class="literalblock programlisting"><div class=content><pre>gateway_enable=YES          # Set to YES if this host will be a gateway</pre></div></div><div class=paragraph><p>Этот параметр изменит значение <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a>-переменной <code>net.inet.ip.forwarding</code> в <code>1</code>. Если вам временно нужно выключить маршрутизацию, вы можете на время сбросить это значение в <code>0</code>.</p></div><div class=paragraph><p>Вашему новому маршрутизатору нужна информация о маршрутах для того, чтобы знать, куда пересылать трафик. Если ваша сеть достаточно проста, то вы можете использовать статические маршруты. С FreeBSD также поставляется стандартный даемон BSD для маршрутизации <a href="https://man.freebsd.org/cgi/man.cgi?query=routed&amp;sektion=8&amp;format=html">routed(8)</a>, который умеет работать с RIP (как версии 1, так и версии 2) и IRDP. Поддержка BGP v4, OSPF v2 и других сложных протоколов маршрутизации имеется в пакете <a class=package href=https://cgit.freebsd.org/ports/tree/net/zebra/>net/zebra</a>. Также существуют и коммерческие продукты, применяемые как более комплексное решение проблемы маршрутизации в сети, такие как GateD®.</p></div></div><div class=sect2><h3 id=_настройка_статических_маршрутов>27.2.5. Настройка статических маршрутов<a class=anchor href=#_настройка_статических_маршрутов></a></h3><div class=sect3><h4 id=_ручная_настройка>27.2.5.1. Ручная настройка<a class=anchor href=#_ручная_настройка></a></h4><div class=paragraph><p>Предположим, что у нас есть следующая сеть:</p></div><div class=imageblock><div class=content><img src=../../../../images/books/handbook/advanced-networking/static-routes.png alt="static routes"></div></div><div class=paragraph><p>В этом сценарии, <code>RouterA</code> это наш компьютер с FreeBSD, который выступает в качестве маршрутизатора в сеть Интернет. Его маршрут по умолчанию настроен на <code>10.0.0.1</code>, что позволяет ему соединяться с внешним миром. Мы будем предполагать, что <code>RouterB</code> уже правильно настроен и знает все необходимые маршруты (на этом рисунке все просто; добавьте на <code>RouterB</code> маршрут по умолчанию, используя <code>192.168.1.1</code> в качестве шлюза).</p></div><div class=paragraph><p>Если мы посмотрим на таблицу маршрутизации <code>RouterA</code>, то увидим примерно следующее:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% netstat <span class=nt>-nr</span>
Routing tables

Internet:
Destination        Gateway            Flags    Refs      Use  Netif  Expire
default            10.0.0.1           UGS         0    49378    xl0
127.0.0.1          127.0.0.1          UH          0        6    lo0
10.0.0/24          <span class=nb>link</span><span class=c>#1             UC          0        0    xl0</span>
192.168.1/24       <span class=nb>link</span><span class=c>#2             UC          0        0    xl1</span></code></pre></div></div><div class=paragraph><p>С текущей таблицей маршрутизации <code>RouterA</code> не сможет достичь внутренней сети 2 (Internal Net 2). Один из способов обхода этой проблемы - добавление маршрута вручную. Следующая команда добавляет внутреннюю сеть 2 к таблице маршрутизации <code>RouterA</code> с <code>192.168.1.2</code> в качестве следующего узла:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># route add -net 192.168.2.0/24 192.168.1.2</span></code></pre></div></div><div class=paragraph><p>Теперь <code>RouterA</code> сможет достичь любого хоста в сети <code>192.168.2.0/24</code>.</p></div></div><div class=sect3><h4 id=_постоянная_конфигурация>27.2.5.2. Постоянная конфигурация<a class=anchor href=#_постоянная_конфигурация></a></h4><div class=paragraph><p>Предыдущий пример прекрасно подходит для настройки статического маршрута в работающей системе. Однако, проблема заключается в том, что маршрутная информация не сохранится после перезагрузки FreeBSD. Способ сохранения добавленного маршрута заключается в добавлении его в файл <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre># Добавление статического маршрута в Internal Net 2
static_routes=&#34;internalnet2&#34;
route_internalnet2=&#34;-net 192.168.2.0/24 192.168.1.2&#34;</pre></div></div><div class=paragraph><p>В переменной <code>static_routes</code> находятся строки, разделенные пробелами. Каждая строка означает имя маршрута. В примере выше в <code>static_routes</code> есть только одна строка, это <em>internalnet2</em>. Затем мы добавили переменную <code>route__internalnet2_</code>, куда помещены все параметры, которые необходимо передать команде <a href="https://man.freebsd.org/cgi/man.cgi?query=route&amp;sektion=8&amp;format=html">route(8)</a>. В примере выше была использована команда:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># route add -net 192.168.2.0/24 192.168.1.2</span></code></pre></div></div><div class=paragraph><p>поэтому нам потребуется <code>"-net 192.168.2.0/24 192.168.1.2"</code>.</p></div><div class=paragraph><p>Как было сказано выше, мы можем добавить в <code>static_routes</code> более чем одну строку. Это позволит создать несколько статических маршрутов. В следующем примере показано добавление маршрутов для сетей <code>192.168.0.0/24</code> и <code>192.168.1.0/24</code> (этот маршрутизатор не показан на рисунке выше:</p></div><div class="literalblock programlisting"><div class=content><pre>static_routes=&#34;net1 net2&#34;
route_net1=&#34;-net 192.168.0.0/24 192.168.0.1&#34;
route_net2=&#34;-net 192.168.1.0/24 192.168.1.1&#34;</pre></div></div></div></div><div class=sect2><h3 id=_распространение_маршрутов>27.2.6. Распространение маршрутов<a class=anchor href=#_распространение_маршрутов></a></h3><div class=paragraph><p>Мы уже говорили о том, как мы задаем наши маршруты во внешний мир, но не упоминали о том, как внешний мир находит нас.</p></div><div class=paragraph><p>Мы уже знаем, что таблицы маршрутизации могут быть настроены так, что весь трафик для некоторого диапазона адресов (в нашем примере это подсеть класса C) может быть направлен заданному хосту в той сети, которая будет перенаправлять входящие пакеты дальше.</p></div><div class=paragraph><p>При получении адресного пространства, выделенного Вашей сети, Ваш провайдер настроит свои таблицы маршрутизации так, что весь трафик для Вашей подсети будет пересылаться по PPP-соединению к Вашей сети. Но как серверы по всей стране узнают, что Ваш трафик нужно посылать Вашему ISP?</p></div><div class=paragraph><p>Существует система (подобная распределению информации DNS), которая отслеживает все назначенные пространства адресов и определяет точку подключения к магистрали Интернет. "Магистралью" называют главные каналы, по которым идет трафик Интернет внутри страны и по всему миру. Каждая магистральная машина имеет копию основного набора таблиц, согласно которой трафик для конкретной сети направляется по конкретному магистральному каналу, и затем, передаваясь по цепочке провайдеров, он достигает вашей сети.</p></div><div class=paragraph><p>Задачей вашего провайдера является объявить на магистрали о том, что он отвечает за подключение (и поэтому на него указывает маршрут) вашей сети. Этот процесс называется распространением маршрута.</p></div></div><div class=sect2><h3 id=_устранение_неполадок>27.2.7. Устранение неполадок<a class=anchor href=#_устранение_неполадок></a></h3><div class=paragraph><p>Иногда с распространением маршрута возникают проблемы, и некоторые сайты не могут к вам подключиться. Наверное, самой полезной командой для определения точки неверной работы маршрутизации является <a href="https://man.freebsd.org/cgi/man.cgi?query=traceroute&amp;sektion=8&amp;format=html">traceroute(8)</a>. Она также полезна и когда вы сами не можете подключиться к удаленной машине (то есть команда <a href="https://man.freebsd.org/cgi/man.cgi?query=ping&amp;sektion=8&amp;format=html">ping(8)</a> не срабатывает).</p></div><div class=paragraph><p>Команда <a href="https://man.freebsd.org/cgi/man.cgi?query=traceroute&amp;sektion=8&amp;format=html">traceroute(8)</a> запускается с именем удаленного хоста, с которым вы хотите установить соединение, в качестве параметра. Она показывает промежуточные сетевые шлюзы по пути следования, в конце концов достигая адрес назначения или прерывая свою работу из-за отсутствия соединения.</p></div><div class=paragraph><p>За дополнительной информацией обратитесь к странице Справочника по <a href="https://man.freebsd.org/cgi/man.cgi?query=traceroute&amp;sektion=8&amp;format=html">traceroute(8)</a>.</p></div></div><div class=sect2><h3 id=_маршрутизация_многоадресного_трафика>27.2.8. Маршрутизация многоадресного трафика<a class=anchor href=#_маршрутизация_многоадресного_трафика></a></h3><div class=paragraph><p>FreeBSD изначально поддерживает как приложения, работающие с многоадресным трафиком, так и его маршрутизацию. Такие приложения не требуют особой настройки FreeBSD; обычно они работают сразу. Для маршрутизации многоадресного трафика требуется, чтобы поддержка этого была включена в ядро:</p></div><div class="literalblock programlisting"><div class=content><pre>options MROUTING</pre></div></div><div class=paragraph><p>Кроме того, даемон многоадресной маршрутизации, <a href="https://man.freebsd.org/cgi/man.cgi?query=mrouted&amp;sektion=8&amp;format=html">mrouted(8)</a>, должен быть настроен посредством файла <span class=filename>/etc/mrouted.conf</span> на использование туннелей и DVMRP. Дополнительную информацию о настройки многоадресного трафика можно найти на страницах справочной системы, посвящённых даемону <a href="https://man.freebsd.org/cgi/man.cgi?query=mrouted&amp;sektion=8&amp;format=html">mrouted(8)</a>.</p></div></div></div></div><div class=sect1><h2 id=network-wireless>27.3. Беспроводные сети<a class=anchor href=#network-wireless></a></h2><div class=sectionbody><div class=sect2><h3 id=_введение>27.3.1. Введение<a class=anchor href=#_введение></a></h3><div class=paragraph><p>Было бы весьма полезным иметь возможность использовать компьютер без хлопот, связанных с постоянно подключенным сетевым кабелем. FreeBSD может использоваться как клиент беспроводной сети, и даже в качестве "точки доступа" к ней.</p></div></div><div class=sect2><h3 id=_режимы_работы_беспроводной_связи>27.3.2. Режимы работы беспроводной связи<a class=anchor href=#_режимы_работы_беспроводной_связи></a></h3><div class=paragraph><p>Существуют два варианта конфигурации устройств беспроводного доступа 802.11: BSS и IBSS.</p></div><div class=sect3><h4 id=_режим_bss>27.3.2.1. Режим BSS<a class=anchor href=#_режим_bss></a></h4><div class=paragraph><p>Режим BSS является наиболее часто используемым. Режим BSS также называют режимом инфраструктуры. В этом режиме несколько точек доступа беспроводной сети подключаются к проводной сети передачи данных. Каждое беспроводная сеть имеет собственное имя. Это имя является идентификатором SSID сети.</p></div><div class=paragraph><p>Клиенты беспроводной сети подключаются к этим точкам доступа беспроводной сети. Стандарт IEEE 802.11 определяет протокол, используемый для связи в беспроводных сетях. Клиент сети беспроводного доступа может подключаться к некоторой сети, если задан её SSID. Клиент может также подключаться к любой сети, если SSID не задан.</p></div></div><div class=sect3><h4 id=_режим_ibss>27.3.2.2. Режим IBSS<a class=anchor href=#_режим_ibss></a></h4><div class=paragraph><p>Режим IBSS, также называемый ad-hoc, предназначен для соединений точка-точка. На самом деле существуют два типа режима ad-hoc. Один из них является режимом IBSS, называемый также режимом ad-hoc или IEEE ad-hoc. Этот режим определён стандартами IEEE 802.11. Второй режим называется демонстрационным режимом ad-hoc, или Lucent ad-hoc (или, иногда неправильно, режимом ad-hoc). Это старый, существовавший до появления 802.11, режим ad-hoc, и он должен использоваться только для старых сетей. В дальнейшем мы не будем рассматривать ни один из режимов ad-hoc.</p></div></div></div><div class=sect2><h3 id=_режим_инфраструктуры>27.3.3. Режим инфраструктуры<a class=anchor href=#_режим_инфраструктуры></a></h3><div class=sect3><h4 id=_точки_доступа>27.3.3.1. Точки доступа<a class=anchor href=#_точки_доступа></a></h4><div class=paragraph><p>Точки доступа представляют собой беспроводные сетевые устройства, позволяющие одному или большему количеству клиентов беспроводной сети использовать эти устройства в качестве центрального сетевого концентратора. При использовании точки доступа все клиенты работают через неё. Зачастую используются несколько точек доступа для полного покрытия беспроводной сетью некоторой зоны, такой, как дом, офис или парк.</p></div><div class=paragraph><p>Точки доступа обычно имеют несколько подключений к сети: адаптер беспроводной связи и один или большее количество сетевых ethernet-адаптеров для подключения к остальной части сети.</p></div><div class=paragraph><p>Точки доступа могут быть либо приобретены уже настроенными, либо вы можете создать собственную при помощи FreeBSD и поддерживаемого адаптера беспроводной связи. Несколько производителей выпускают точки беспроводного доступа и адаптеры беспроводной связи с различными возможностями.</p></div></div><div class=sect3><h4 id=_построение_точки_доступа_с_freebsd>27.3.3.2. Построение точки доступа с FreeBSD<a class=anchor href=#_построение_точки_доступа_с_freebsd></a></h4><div class=sect4><h5 id=_требования>27.3.3.2.1. Требования<a class=anchor href=#_требования></a></h5><div class=paragraph><p>Для того, чтобы создать беспроводную точку доступа на FreeBSD, вам нужно иметь совместимый адаптер беспроводной связи. На данный момент поддерживаются адаптеры только на основе набора микросхем Prism. Вам также потребуется поддерживаемый FreeBSD адаптер проводной сети (найти такой будет нетрудно, FreeBSD поддерживает множество различных устройств). В этом руководстве мы будем полагать, что вы будете строить сетевой мост (<a href="https://man.freebsd.org/cgi/man.cgi?query=bridge&amp;sektion=4&amp;format=html">bridge(4)</a>) для пропуска всего трафика между устройством беспроводной связи и сетью, подключенной к обычному Ethernet-адаптеру.</p></div><div class=paragraph><p>Функциональность hostap, которая используется FreeBSD для организации точки доступа, работает лучше всего с некоторыми версиями микрокода. Адаптеры Prism 2 должны использовать микрокод версии 1.3.4 или более новый. Адаптеры Prism 2.5 и Prism 3 должны использовать микрокод версии 1.4.9. Более старые версии микрокода могут работать нормально, а могут и некорректно. В настоящее время единственным способом обновления адаптеров является использование утилит обновления для Windows®, которые можно получить у производителя ваших адаптеров.</p></div></div><div class=sect4><h5 id=_настройка>27.3.3.2.2. Настройка<a class=anchor href=#_настройка></a></h5><div class=paragraph><p>Первым делом убедитесь, что ваша система распознаёт адаптер беспроводной связи:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig -a</span>
wi0: <span class=nv>flags</span><span class=o>=</span>8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500
        inet6 fe80::202:2dff:fe2d:c938%wi0 prefixlen 64 scopeid 0x7
        inet 0.0.0.0 netmask 0xff000000 broadcast 255.255.255.255
        ether 00:09:2d:2d:c9:50
        media: IEEE 802.11 Wireless Ethernet autoselect <span class=o>(</span>DS/2Mbps<span class=o>)</span>
        status: no carrier
        ssid <span class=s2>&#34;&#34;</span>
        stationname <span class=s2>&#34;FreeBSD Wireless node&#34;</span>
        channel 10 authmode OPEN powersavemode OFF powersavesleep 100
        wepmode OFF weptxkey 1</code></pre></div></div><div class=paragraph><p>На данном этапе не беспокойтесь о деталях, просто убедитесь, что выдаётся нечто, указывающее на установленный адаптер беспроводной связи. Если при этом у вас есть проблемы с недоступностью интерфейса беспроводной связи, и вы используете PC Card, то обратитесь к страницам справочной системы, описывающим <a href="https://man.freebsd.org/cgi/man.cgi?query=pccardc&amp;sektion=8&amp;format=html">pccardc(8)</a> и <a href="https://man.freebsd.org/cgi/man.cgi?query=pccardd&amp;sektion=8&amp;format=html">pccardd(8)</a> для получения более полной информации.</p></div><div class=paragraph><p>Теперь вам нужно загрузить модуль для подготовки той части FreeBSD, что отвечает за организацию сетевых мостов, для работы с точкой доступа. Для загрузки модуля <a href="https://man.freebsd.org/cgi/man.cgi?query=bridge&amp;sektion=4&amp;format=html">bridge(4)</a> просто выполните следующую команду:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># kldload bridge</span></code></pre></div></div><div class=paragraph><p>При загрузке модуля никаких сообщений об ошибках быть не должно. Если это всё же произошло, вам может потребоваться вкомпилировать код для модуля <a href="https://man.freebsd.org/cgi/man.cgi?query=bridge&amp;sektion=4&amp;format=html">bridge(4)</a> в ядро. В этом вам должен помочь раздел этого Руководства об <a href=#network-bridging>организации сетевых мостов</a>.</p></div><div class=paragraph><p>Теперь, когда вы завершили с той частью, что касается организации сетевого моста, нам нужно указать ядру FreeBSD, какие интерфейсы должны объединяться в сетевом мосте. Это мы делаем при помощи <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sysctl net.link.ether.bridge.enable=1</span>
<span class=c># sysctl net.link.ether.bridge.config=&#34;wi0 xl0&#34;</span>
<span class=c># sysctl net.inet.ip.forwarding=1</span></code></pre></div></div><div class=paragraph><p>В версиях FreeBSD, предшествующих 5.2, вместо указанных нужно использовать следующие параметры:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sysctl net.link.ether.bridge=1</span>
<span class=c># sysctl net.link.ether.bridge_cfg=&#34;wi0,xl0&#34;</span>
<span class=c># sysctl net.inet.ip.forwarding=1</span></code></pre></div></div><div class=paragraph><p>Теперь необходимо настроить адаптер беспроводной сети. Следующая команда заставит адаптер работать в режиме точки доступа:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig wi0 ssid my_net channel 11 media DS/11Mbps mediaopt hostap up stationname &#34;FreeBSD AP&#34;</span></code></pre></div></div><div class=paragraph><p>Строчка <a href="https://man.freebsd.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;format=html">ifconfig(8)</a> активизирует интерфейс <span class=filename>wi0</span>, конфигурирует его SSID как <em>my_net</em>, а имя станции как <em>FreeBSD AP</em>. <code>media DS/11Mbps</code> переводит адаптер в режим 11Mbps и нужен только для того, чтобы сработал параметр <code>mediaopt</code>. Параметр <code>mediaopt hostap</code> переводит интерфейс в режим точки доступа. Параметр <code>channel 11</code> задаёт использование канала 802.11b. Страница справки по команде <a href="https://man.freebsd.org/cgi/man.cgi?query=wicontrol&amp;sektion=8&amp;format=html">wicontrol(8)</a> перечисляет корректные значения каналов для ваших нужд.</p></div><div class=paragraph><p>Теперь у вас должна получиться полнофункциональная работающая точка доступа. Настоятельно советуем прочесть страницы справочной по <a href="https://man.freebsd.org/cgi/man.cgi?query=wicontrol&amp;sektion=8&amp;format=html">wicontrol(8)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;format=html">ifconfig(8)</a>, и <a href="https://man.freebsd.org/cgi/man.cgi?query=wi&amp;sektion=4&amp;format=html">wi(4)</a> для получения дополнительной информации.</p></div><div class=paragraph><p>Также полагаем, что вы прочтёте следующий раздел о шифровании.</p></div></div><div class=sect4><h5 id=_информация_о_состоянии>27.3.3.2.3. Информация о состоянии<a class=anchor href=#_информация_о_состоянии></a></h5><div class=paragraph><p>После того, как точка доступа сконфигурирована и начала свою работу, операторам может понадобиться видеть клиентов, связанных с этой точкой. В любой момент оператор может набрать:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># wicontrol -l</span>
1 station:
00:09:b7:7b:9d:16  <span class=nv>asid</span><span class=o>=</span>04c0, <span class=nv>flags</span><span class=o>=</span>3&lt;ASSOC,AUTH&gt;, <span class=nv>caps</span><span class=o>=</span>1&lt;ESS&gt;, <span class=nv>rates</span><span class=o>=</span>f&lt;1M,2M,5.5M,11M&gt;, <span class=nv>sig</span><span class=o>=</span>38/15</code></pre></div></div><div class=paragraph><p>Это показывает, что имеется одна связанная станция с перечисленными характеристиками. Выдаваемое значение сигнала должно использоваться только как сравнительный индикатор его силы. Его перевод в dBm или другие единицы измерения различаются в разных версиях микрокода.</p></div></div></div><div class=sect3><h4 id=_клиенты>27.3.3.3. Клиенты<a class=anchor href=#_клиенты></a></h4><div class=paragraph><p>Клиент в беспроводной сети представляет собой систему, которая обращается к точке доступа или непосредственно к другому клиенту.</p></div><div class=paragraph><p>Как правило, клиенты беспроводной сети имеют только один сетевой адаптер, а именно адаптер беспроводной сети.</p></div><div class=paragraph><p>Существует несколько различных способов конфигурации клиента беспроводной сети. Они основаны на различных режимах работы в беспроводной сети, обычно BSS (режим инфраструктуры, который требует точки доступа) или IBSS (ad-hoc или режим одноранговой сети). В нашем примере мы будем использовать самый популярный их них, режим BSS, для связи с точкой доступа.</p></div><div class=sect4><h5 id=_требования_2>27.3.3.3.1. Требования<a class=anchor href=#_требования_2></a></h5><div class=paragraph><p>Существует только одно жёсткое условие для настройки FreeBSD в качестве клиента беспроводной сети. Вам нужен адаптер беспроводной связи, поддерживаемый FreeBSD.</p></div></div><div class=sect4><h5 id=_конфигурация_freebsd_как_клиента_беспроводной_сети>27.3.3.3.2. Конфигурация FreeBSD как клиента беспроводной сети<a class=anchor href=#_конфигурация_freebsd_как_клиента_беспроводной_сети></a></h5><div class=paragraph><p>Перед тем, как подключиться к беспроводной сети, вам нужно будет узнать о ней несколько вещей. В этом примере мы подключаемся к сети, которая называется <em>my_net</em>, и шифрование в ней отключено.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>В этом примере мы не используем шифрование, но это небезопасно. В следующем разделе вы узнаете, как её включить, почему это так важно, и почему некоторые технологии шифрования всё же не могут полностью обеспечить вашу информационную безопасность.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Удостоверьтесь, что ваш адаптер распознаётся во FreeBSD:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig -a</span>
wi0: <span class=nv>flags</span><span class=o>=</span>8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500
        inet6 fe80::202:2dff:fe2d:c938%wi0 prefixlen 64 scopeid 0x7
        inet 0.0.0.0 netmask 0xff000000 broadcast 255.255.255.255
        ether 00:09:2d:2d:c9:50
        media: IEEE 802.11 Wireless Ethernet autoselect <span class=o>(</span>DS/2Mbps<span class=o>)</span>
        status: no carrier
        ssid <span class=s2>&#34;&#34;</span>
        stationname <span class=s2>&#34;FreeBSD Wireless node&#34;</span>
        channel 10 authmode OPEN powersavemode OFF powersavesleep 100
        wepmode OFF weptxkey 1</code></pre></div></div><div class=paragraph><p>Теперь мы можем изменить настройки адаптера на те, что соответствуют нашей сети:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig wi0 inet 192.168.0.20 netmask 255.255.255.0 ssid my_net</span></code></pre></div></div><div class=paragraph><p>Замените <code>192.168.0.20</code> и <code>255.255.255.0</code> на правильные IP-адрес и сетевую маску в вашей проводной сети. Запомните, что наша точка доступа выступает в роли моста для данных между беспроводной и проводной сетями, так что они будут доступны для других устройств, находящихся в сети, как будто они тоже находятся в проводной сети.</p></div><div class=paragraph><p>Как только вы это выполнили, то сможете получить ping от хостов в проводной сети, как будто вы подключены посредством обычных проводов.</p></div><div class=paragraph><p>Если вы столкнулись с проблемами при работе в беспроводной сети, удостоверьтесь, что вы ассоциированы (подключены) с точкой доступа:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig wi0</span></code></pre></div></div><div class=paragraph><p>должна выдать некоторую информацию, и вы должны увидеть:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>status: associated</code></pre></div></div><div class=paragraph><p>Если статус не будет соответствовать <code>associated</code>, это может значить, что вы оказались вне зоны досягаемости точки доступа, включили шифрование или, возможно, имеются проблемы с конфигурацией.</p></div></div></div><div class=sect3><h4 id=_шифрование>27.3.3.4. Шифрование<a class=anchor href=#_шифрование></a></h4><div class=paragraph><p>Шифрование в беспроводной сети имеет важное значение, потому что у вас нет больше возможности ограничить сеть хорошо защищённой областью. Данные вашей беспроводной сети вещаются по всей окрестности, так что любой заинтересовавшийся может их считать. Вот здесь используется шифрование. Шифруя данные, посылаемые в эфир, вы делаете их прямой перехват гораздо более сложным для всех любопытных.</p></div><div class=paragraph><p>Двумя наиболее широко применяемыми способами шифрования данных между вашим клиентом и точкой доступа являются WEP и <a href="https://man.freebsd.org/cgi/man.cgi?query=ipsec&amp;sektion=4&amp;format=html">ipsec(4)</a>.</p></div><div class=sect4><h5 id=_wep>27.3.3.4.1. WEP<a class=anchor href=#_wep></a></h5><div class=paragraph><p>WEP является сокращением от Wired Equivalency Protocol (Протокол Соответствия Проводной сети). WEP является попыткой сделать беспроводные сети такими же надёжными и безопасными, как проводные. К сожалению, он был взломан и сравнительно легко поддаётся вскрытию. Это означает также, что он не тот протокол, на который следует опираться, когда речь идёт о шифровании критически важных данных.</p></div><div class=paragraph><p>Он лучше, чем ничего, так что используйте следующую команду для включения WEP в вашей новой точке доступа FreeBSD:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig wi0 inet up ssid my_net wepmode on wepkey 0x1234567890 media DS/11Mbps mediaopt hostap</span></code></pre></div></div><div class=paragraph><p>Вы можете включить WEP на клиенте следующей командой:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig wi0 inet 192.168.0.20 netmask 255.255.255.0 ssid my_net wepmode on wepkey 0x1234567890</span></code></pre></div></div><div class=paragraph><p>Отметьте, что вы должны заменить <em>0x1234567890</em> на более уникальный ключ.</p></div></div><div class=sect4><h5 id=_ipsec>27.3.3.4.2. IPsec<a class=anchor href=#_ipsec></a></h5><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=ipsec&amp;sektion=4&amp;format=html">ipsec(4)</a> является гораздо более надёжным и мощным средством шифрования данных в сети. Этот метод определённо является предпочтительным для шифрования данных в беспроводной сети. Более детально ознакомиться с безопасностью и применением <a href="https://man.freebsd.org/cgi/man.cgi?query=ipsec&amp;sektion=4&amp;format=html">ipsec(4)</a> вы можете в разделе об <a href=../security/#ipsec>IPsec</a> этого Руководства.</p></div></div></div><div class=sect3><h4 id=_утилиты>27.3.3.5. Утилиты<a class=anchor href=#_утилиты></a></h4><div class=paragraph><p>Имеется несколько утилит, которые можно использовать для настройки и отладки вашей беспроводной сети, и здесь мы попытаемся описать некоторые из них и что они могут делать.</p></div><div class=sect4><h5 id=_пакет_bsd_airtools>27.3.3.5.1. Пакет bsd-airtools<a class=anchor href=#_пакет_bsd_airtools></a></h5><div class=paragraph><p>Пакет bsd-airtools представляет собой полный набор инструментов, включая инструменты для проверки беспроводной сети на предмет взлома WEP-ключа, обнаружения точки доступа и тому подобное.</p></div><div class=paragraph><p>Утилиты bsd-airtools можно установить из порта <a class=package href=https://cgit.freebsd.org/ports/tree/net-mgmt/bsd-airtools/>net-mgmt/bsd-airtools</a>. Информацию об установке портов можно найти в Главе <a href=../ports/#ports>Установка приложений. порты и пакеты</a> этого Руководства.</p></div><div class=paragraph><p>Программа <code>dstumbler</code> является инструментом, предназначенным для обнаружения точки доступа и выдачи отношения уровня сигнала к шуму. Если у вас с трудом получается запустить точку доступа, <code>dstumbler</code> может помочь вам начать.</p></div><div class=paragraph><p>Для тестирования информационной безопасности вашей беспроводной сети, вы можете воспользоваться набором "dweputils" (<code>dwepcrack</code>, <code>dwepdump</code> и <code>dwepkeygen</code>), который может помочь понять, является ли WEP подходящим решением для обеспечения ваших потребностей в информационной безопасности.</p></div></div><div class=sect4><h5 id=_утилиты_wicontrol_ancontrol_и_raycontrol>27.3.3.5.2. Утилиты <code>wicontrol</code>, <code>ancontrol</code> и <code>raycontrol</code><a class=anchor href=#_утилиты_wicontrol_ancontrol_и_raycontrol></a></h5><div class=paragraph><p>Это инструменты, которые могут быть использованы для управления поведением адаптера беспроводной связи в сети. В примере выше мы выбирали <a href="https://man.freebsd.org/cgi/man.cgi?query=wicontrol&amp;sektion=8&amp;format=html">wicontrol(8)</a>, так как нашим адаптером беспроводной сети был интерфейс <span class=filename>wi0</span>. Если у вас установлено устройство беспроводного доступа от Cisco, этим интерфейсом будет <span class=filename>an0</span>, и тогда вы будете использовать <a href="https://man.freebsd.org/cgi/man.cgi?query=ancontrol&amp;sektion=8&amp;format=html">ancontrol(8)</a>.</p></div></div><div class=sect4><h5 id=_команда_ifconfig>27.3.3.5.3. Команда <code>ifconfig</code><a class=anchor href=#_команда_ifconfig></a></h5><div class=paragraph><p>Команда <a href="https://man.freebsd.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;format=html">ifconfig(8)</a> может использоваться для установки многих из тех параметров, что задаёт <a href="https://man.freebsd.org/cgi/man.cgi?query=wicontrol&amp;sektion=8&amp;format=html">wicontrol(8)</a>, однако работа с некоторыми параметрами в ней отсутствует. Обратитесь к <a href="https://man.freebsd.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;format=html">ifconfig(8)</a> для выяснения параметров и опций командной строки.</p></div></div></div><div class=sect3><h4 id=_поддерживаемые_адаптеры>27.3.3.6. Поддерживаемые адаптеры<a class=anchor href=#_поддерживаемые_адаптеры></a></h4><div class=sect4><h5 id=_точки_доступа_2>27.3.3.6.1. Точки доступа<a class=anchor href=#_точки_доступа_2></a></h5><div class=paragraph><p>Единственными адаптерами, которые на данный момент поддерживаются в режиме BSS (как точка доступа), являются те устройства, что сделаны на основе набора микросхем Prism 2, 2.5 или 3). Полный список можно увидеть в <a href="https://man.freebsd.org/cgi/man.cgi?query=wi&amp;sektion=4&amp;format=html">wi(4)</a>.</p></div></div><div class=sect4><h5 id=_клиенты_802_11b>27.3.3.6.2. Клиенты 802.11b<a class=anchor href=#_клиенты_802_11b></a></h5><div class=paragraph><p>Практически все адаптеры беспроводной связи 802.11b на данный момент во FreeBSD поддерживаются. Большинство адаптеров, построенных на основе Prism, Spectrum24, Hermes, Aironet и Raylink, будут работать в качестве адаптера беспроводной сети в режиме IBSS (ad-hoc, одноранговая сеть и BSS).</p></div></div><div class=sect4><h5 id=_клиенты_802_11a_и_802_11g>27.3.3.6.3. Клиенты 802.11a и 802.11g<a class=anchor href=#_клиенты_802_11a_и_802_11g></a></h5><div class=paragraph><p>Драйвер устройства <a href="https://man.freebsd.org/cgi/man.cgi?query=ath&amp;sektion=4&amp;format=html">ath(4)</a> поддерживает 802.11a и 802.11g. Если ваша карта основана на чипсете Atheros, вы можете использовать этот драйвер.</p></div><div class=paragraph><p>К сожалению, все еще много производителей, не предоставляющих схематику своих драйверов сообществу open source, поскольку эта информация считается торговым секретом. Следовательно, у разработчиков FreeBSD и других операционных систем остается два варианта: разработать драйверы долгим и сложным методом обратного инжиниринга, или использовать существующие драйверы для платформ Microsoft® Windows®. Большинство разработчиков FreeBSD выбрали второй способ.</p></div><div class=paragraph><p>Благодаря усилиям Билла Пола (wpaul), начиная с FreeBSD 5.3-RELEASE существует "прозрачная" поддержка Network Driver Interface Specification (NDIS). FreeBSD NDISulator (известный также как Project Evil) преобразует бинарный драйвер Windows® так, что он работает так же как и в Windows®. Эта возможность всё ещё относительно нова, но в большинстве тестов она работает адекватно.</p></div><div class=paragraph><p>Для использования NDISulator потребуются три вещи:</p></div><div class="olist arabic"><ol class=arabic><li><p>Исходные тексты ядра</p></li><li><p>Бинарный драйвер Windows® XP (расширение <span class=filename>.SYS</span>)</p></li><li><p>Файл конфигурации бинарного драйвера Windows® XP (расширение <span class=filename>.INF</span>)</p></li></ol></div><div class=paragraph><p>Вам может потребоваться компиляция драйвера оболочки мини порта <a href="https://man.freebsd.org/cgi/man.cgi?query=ndis&amp;sektion=4&amp;format=html">ndis(4)</a>. Под <code>root</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/src/sys/modules/ndis</span>
<span class=c># make &amp;&amp; make install</span></code></pre></div></div><div class=paragraph><p>Определите местоположение файлов для вашей карты. Обычно их можно найти на входящем в комплект CD или на Web-сайте поставщика. В нашем примере используются файлы <span class=filename>W32DRIVER.SYS</span> и <span class=filename>W32DRIVER.INF</span>.</p></div><div class=paragraph><p>Следующий шаг это компиляция бинарного драйвера в загружаемый модуль ядра. Чтобы сделать это, сначала зайдите в каталог модуля <span class=filename>if_ndis</span> и с правами <code>root</code> скопируйте туда драйверы Windows®:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /usr/src/sys/modules/if_ndis</span>
<span class=c># cp /path/to/driver/W32DRIVER.SYS ./</span>
<span class=c># cp /path/to/driver/W32DRIVER.INF ./</span></code></pre></div></div><div class=paragraph><p>Теперь используйте утилиту <code>ndiscvt</code> для создания заголовка определения драйвера <span class=filename>ndis_driver_data.h</span> перед сборкой модуля:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ndiscvt -i W32DRIVER.INF -s W32DRIVER.SYS -o ndis_driver_data.h</span></code></pre></div></div><div class=paragraph><p>Параметры <code>-i</code> и <code>-s</code> задают соответственно файл настройки и бинарный файл. Мы используем параметр <code>-o ndis_driver_data.h</code>, поскольку <span class=filename>Makefile</span> при создании модуля будет обращаться именно к этому файлу.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Некоторым драйверам Windows® для работы требуются дополнительные файлы. Вы можете включить их параметром <code>ndiscvt -f</code>. Обратитесь к странице справочной системы <a href="https://man.freebsd.org/cgi/man.cgi?query=ndiscvt&amp;sektion=8&amp;format=html">ndiscvt(8)</a> за дополнительной информацией.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Наконец, соберите и установите модуль драйвера:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># make &amp;&amp; make install</span></code></pre></div></div><div class=paragraph><p>Для использования драйвера необходимо загрузить соответствующие модули:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># kldload ndis</span>
<span class=c># kldload if_ndis</span></code></pre></div></div><div class=paragraph><p>Первая команда загружает оболочку драйвера мини-порта NDIS, вторая загружает собственно сетевой интерфейс. Проверьте <a href="https://man.freebsd.org/cgi/man.cgi?query=dmesg&amp;sektion=8&amp;format=html">dmesg(8)</a> на предмет ошибок загрузки. Если все прошло хорошо, вывод должен быть примерно таким:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>ndis0: &lt;Wireless-G PCI Adapter&gt; mem 0xf4100000-0xf4101fff irq 3 at device 8.0 on pci1
ndis0: NDIS API version: 5.0
ndis0: Ethernet address: 0a:b1:2c:d3:4e:f5
ndis0: 11b rates: 1Mbps 2Mbps 5.5Mbps 11Mbps
ndis0: 11g rates: 6Mbps 9Mbps 12Mbps 18Mbps 36Mbps 48Mbps 54Mbps</code></pre></div></div><div class=paragraph><p>Начиная с этого момента вы можете использовать устройство <span class=filename>ndis0</span> как любое другое беспроводное устройство (например, <span class=filename>wi0</span>); в этой ситуации применима информация, приведенная в начале этой главы.</p></div></div></div></div></div></div><div class=sect1><h2 id=network-bluetooth>27.4. Bluetooth<a class=anchor href=#network-bluetooth></a></h2><div class=sectionbody><div class=sect2><h3 id=_введение_2>27.4.1. Введение<a class=anchor href=#_введение_2></a></h3><div class=paragraph><p>Bluetooth является беспроводной технологией для создания персональных сетей на расстоянии не более 10 метров, работающей на частоте 2.4 ГГц, которая не подлежит лицензированию. Обычно такие сети формируются из портативных устройств, таких, как сотовые телефоны, КПК и лэптопы. В отличие от Wi-Fi, другой популярной беспроводной технологии, Bluetooth предоставляет более высокий уровень сервиса, например, файловые серверы типа FTP, передачу файлов, голоса, эмуляцию последовательного порта и другие.</p></div><div class=paragraph><p>Стек протоколов Bluetooth во FreeBSD реализован на основе технологии Netgraph (обратитесь к <a href="https://man.freebsd.org/cgi/man.cgi?query=netgraph&amp;sektion=4&amp;format=html">netgraph(4)</a>). Широкий спектр USB-устройств Bluetooth поддерживается драйвером <a href="https://man.freebsd.org/cgi/man.cgi?query=ng_ubt&amp;sektion=4&amp;format=html">ng_ubt(4)</a>. Устройства Bluetooth на основе набора микросхем Broadcom BCM2033 поддерживается драйвером <a href="https://man.freebsd.org/cgi/man.cgi?query=ng_bt3c&amp;sektion=4&amp;format=html">ng_bt3c(4)</a>. Устройства Bluetooth, работающие через последовательные и UART-порты, поддерживаются драйверами <a href="https://man.freebsd.org/cgi/man.cgi?query=sio&amp;sektion=4&amp;format=html">sio(4)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=ng_h4&amp;sektion=4&amp;format=html">ng_h4(4)</a> и <a href="https://man.freebsd.org/cgi/man.cgi?query=hcseriald&amp;sektion=8&amp;format=html">hcseriald(8)</a>. В этом разделе описывается использование Bluetooth-устройств, подключаемых через USB.</p></div></div><div class=sect2><h3 id=_подключение_устройства>27.4.2. Подключение устройства<a class=anchor href=#_подключение_устройства></a></h3><div class=paragraph><p>По умолчанию драйверы устройств Bluetooth поставляются в виде модулей ядра. Перед подключением устройства вам необходимо подгрузить драйвер в ядро:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># kldload ng_ubt</span></code></pre></div></div><div class=paragraph><p>Если Bluetooth-устройство в момент запуска системы подключено, то загружайте модуль из файла <span class=filename>/boot/loader.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>ng_ubt_load=&#34;YES&#34;</pre></div></div><div class=paragraph><p>Подключите ваше USB-устройство. На консоли (или в журнале syslog) появится примерно такое сообщение:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>ubt0: vendor 0x0a12 product 0x0001, rev 1.10/5.25, addr 2
ubt0: Interface 0 endpoints: <span class=nv>interrupt</span><span class=o>=</span>0x81, bulk-in<span class=o>=</span>0x82, bulk-out<span class=o>=</span>0x2
ubt0: Interface 1 <span class=o>(</span>alt.config 5<span class=o>)</span> endpoints: isoc-in<span class=o>=</span>0x83, isoc-out<span class=o>=</span>0x3,
      <span class=nv>wMaxPacketSize</span><span class=o>=</span>49, <span class=nv>nframes</span><span class=o>=</span>6, buffer <span class=nv>size</span><span class=o>=</span>294</code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Стек протоколов Bluetooth запускается вручную во FreeBSD 6.0, и во FreeBSD 5.X, перед 5.5. Это делается автоматически через <a href="https://man.freebsd.org/cgi/man.cgi?query=devd&amp;sektion=8&amp;format=html">devd(8)</a> во FreeBSD 5.5, 6.1 и в более новых версиях.</p></div><div class=paragraph><p>Скопируйте файл <span class=filename>/usr/shared/examples/netgraph/bluetooth/rc.bluetooth</span> в какое-нибудь подходящее место, например, в файл <span class=filename>/etc/rc.bluetooth</span>. Этот скрипт используется для запуска и остановки работы Bluetooth-стека. Перед отключением устройства рекомендуется остановить его работы, хотя (обычно) это не фатально. При запуске стека вы получите сообщения, подобные следующим:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># /etc/rc.bluetooth start ubt0</span>
BD_ADDR: 00:02:72:00:d4:1a
Features: 0xff 0xff 0xf 00 00 00 00 00
&lt;3-Slot&gt; &lt;5-Slot&gt; &lt;Encryption&gt; &lt;Slot offset&gt;
&lt;Timing accuracy&gt; &lt;Switch&gt; &lt;Hold mode&gt; &lt;Sniff mode&gt;
&lt;Park mode&gt; &lt;RSSI&gt; &lt;Channel quality&gt; &lt;SCO <span class=nb>link</span><span class=o>&gt;</span>
&lt;HV2 packets&gt; &lt;HV3 packets&gt; &lt;u-law log&gt; &lt;A-law log&gt; &lt;CVSD&gt;
&lt;Paging scheme&gt; &lt;Power control&gt; &lt;Transparent SCO data&gt;
Max. ACL packet size: 192 bytes
Number of ACL packets: 8
Max. SCO packet size: 64 bytes
Number of SCO packets: 8</code></pre></div></div></td></tr></tbody></table></div></div><div class=sect2><h3 id=_host_controller_interface_hci>27.4.3. Host Controller Interface (HCI)<a class=anchor href=#_host_controller_interface_hci></a></h3><div class=paragraph><p>Host Controller Interface (HCI) предоставляет интерфейс для управления контроллером передатчика и менеджером соединений, а также доступ к данным о состоянии оборудования и его управляющим регистрам. Этот интерфейс предоставляет унифицированный метод доступа к передающим возможностям Bluetooth. Уровень HCI на управляющей машине обменивается данными и командами с микрокодом HCI в оборудовании Bluetooth. Драйвер для Host Controller Transport Layer (то есть физической шины) предоставляет обоим слоям HCI возможность обмениваться данными друг с другом.</p></div><div class=paragraph><p>Для одного Bluetooth-устройства создаётся один узел Netgraph типа <em>hci</em>. HCI-узел обычно подключается к узлу драйвера устройства Bluetooth (входящий поток) и к узлу L2CAP (исходящий поток). Все операции с HCI должны выполняться на узле HCI, но не на узле драйвера устройства. В качестве имени по умолчанию для узла HCI используется "devicehci". Дополнительные подробности можно найти на справочной странице <a href="https://man.freebsd.org/cgi/man.cgi?query=ng_hci&amp;sektion=4&amp;format=html">ng_hci(4)</a>.</p></div><div class=paragraph><p>Одной из самой часто выполняемой задач является обнаружение Bluetooth-устройств в радиусе RF-доступности. Эта операция называется <em>опросом</em> (inquiry). Опрос и другие операции, связанные с HCI, выполняются при помощи утилиты <a href="https://man.freebsd.org/cgi/man.cgi?query=hccontrol&amp;sektion=8&amp;format=html">hccontrol(8)</a>. Пример ниже показывает, как найти доступные устройства Bluetooth. Список таких устройств должен быть получен в течение нескольких секунд. Заметьте, что удалённые устройства будут отвечать на опрос, если только они находятся в режиме <em>обнаруживаемости</em> (discoverable).</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% hccontrol <span class=nt>-n</span> ubt0hci inquiry
Inquiry result, <span class=nv>num_responses</span><span class=o>=</span>1
Inquiry result <span class=c>#0</span>
       BD_ADDR: 00:80:37:29:19:a4
       Page Scan Rep. Mode: 0x1
       Page Scan Period Mode: 00
       Page Scan Mode: 00
       Class: 52:02:04
       Clock offset: 0x78ef
Inquiry complete. Status: No error <span class=o>[</span>00]</code></pre></div></div><div class=paragraph><p><code>BD_ADDR</code> является уникальным адресом устройства Bluetooth, вроде MAC-адресов сетевых адаптеров. Этот адрес необходим для дальнейшей работы с устройством. Адресу BD_ADDR можно присвоить удобное для чтения имя. Файл <span class=filename>/etc/bluetooth/hosts</span> содержит информацию об известных хостах Bluetooth. В следующем примере показано, как получить имя, назначенное удалённому устройству:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% hccontrol <span class=nt>-n</span> ubt0hci remote_name_request 00:80:37:29:19:a4
BD_ADDR: 00:80:37:29:19:a4
Name: Pav<span class=s1>&#39;s T39</span></code></pre></div></div><div class=paragraph><p>Если вы выполните опрос на другом Bluetooth-устройстве, но ваш компьютер будет опознан как "your.host.name (ubt0)". Имя, назначаемое локальному устройству, может быть в любой момент изменено.</p></div><div class=paragraph><p>Система Bluetooth предоставляет услуги по соединениям типа точка-точка (при этом задействованы только два устройства Bluetooth) или точка-ко-многим-точкам. В последнем случае соединение используется совместно несколькими устройствам Bluetooth. В следующем примере показывается, как получить список активных для локального устройства соединений:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% hccontrol <span class=nt>-n</span> ubt0hci read_connection_list
Remote BD_ADDR    Handle Type Mode Role Encrypt Pending Queue State
00:80:37:29:19:a4     41  ACL    0 MAST    NONE       0     0 OPEN</code></pre></div></div><div class=paragraph><p>Идентификатор соединения (<em>connection handle</em>) полезен, когда необходимо прекратить соединение. Заметьте, что обычно нет нужды делать это вручную. Стек будет автоматически разрывать неактивные соединения.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># hccontrol -n ubt0hci disconnect 41</span>
Connection handle: 41
Reason: Connection terminated by <span class=nb>local </span>host <span class=o>[</span>0x16]</code></pre></div></div><div class=paragraph><p>Обратитесь к помощи посредством <code>hccontrol help</code> для получения полного списка доступных HCI-команд. Большинство команд HCI для выполнения не требуют прав администратора системы.</p></div></div><div class=sect2><h3 id=_logical_link_control_and_adaptation_protocol_l2cap>27.4.4. Logical Link Control and Adaptation Protocol (L2CAP)<a class=anchor href=#_logical_link_control_and_adaptation_protocol_l2cap></a></h3><div class=paragraph><p>Протокол L2CAP (Logical Link Control and Adaptation Protocol) предоставляет услуги по работе с данными, как ориентированные на соединения, так и без ориентации на них, протоколам более высокого уровня с возможностями мультиплексирования и обеспечением операций по сегментации и обратной сборке. L2CAP позволяет протоколам более высокого уровня и приложениям передавать и получать пакеты данных L2CAP длиной до 64 Кбайт.</p></div><div class=paragraph><p>L2CAP основан на концепции <em>каналов</em>. Каналом является логическое соединение поверх соединения по радиоканалу. Каждый канал привязан к некоторому протоколу по принципу многие-к-одному. Несколько каналов могут быть привязаны к одному и тому же протоколу, но канал не может быть привязан к нескольким протоколам. Каждый пакет L2CAP, получаемый каналом, перенаправляется к соответствующему протоколу более высокого уровня. Несколько каналов могут совместно использовать одно и то же радиосоединение.</p></div><div class=paragraph><p>Для одного Bluetooth-устройства создается один узел Netgraph типа <em>l2cap</em>. Узел L2CAP обычно подключается к узлу Bluetooth HCI (нижестоящий) и узлам Bluetooth-сокетов (вышестоящие). По умолчанию для узла L2CAP используется имя "devicel2cap". Для получения дополнительной информации обратитесь к справочной странице по <a href="https://man.freebsd.org/cgi/man.cgi?query=ng_l2cap&amp;sektion=4&amp;format=html">ng_l2cap(4)</a>.</p></div><div class=paragraph><p>Полезной является программа <a href="https://man.freebsd.org/cgi/man.cgi?query=l2ping&amp;sektion=8&amp;format=html">l2ping(8)</a>, которая может использоваться для проверки связи с другими устройствами. Некоторые реализации Bluetooth могут не возвращать все данные, посылаемые им, так что <code>0 bytes</code> в следующем примере - это нормально.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># l2ping -a 00:80:37:29:19:a4</span>
0 bytes from 0:80:37:29:19:a4 <span class=nv>seq_no</span><span class=o>=</span>0 <span class=nb>time</span><span class=o>=</span>48.633 ms <span class=nv>result</span><span class=o>=</span>0
0 bytes from 0:80:37:29:19:a4 <span class=nv>seq_no</span><span class=o>=</span>1 <span class=nb>time</span><span class=o>=</span>37.551 ms <span class=nv>result</span><span class=o>=</span>0
0 bytes from 0:80:37:29:19:a4 <span class=nv>seq_no</span><span class=o>=</span>2 <span class=nb>time</span><span class=o>=</span>28.324 ms <span class=nv>result</span><span class=o>=</span>0
0 bytes from 0:80:37:29:19:a4 <span class=nv>seq_no</span><span class=o>=</span>3 <span class=nb>time</span><span class=o>=</span>46.150 ms <span class=nv>result</span><span class=o>=</span>0</code></pre></div></div><div class=paragraph><p>Утилита <a href="https://man.freebsd.org/cgi/man.cgi?query=l2control&amp;sektion=8&amp;format=html">l2control(8)</a> используется для выполнения различных операций с узлами L2CAP. В этом примере показано, как получить список логических соединений (каналов) и перечень радиосоединений локального устройства:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% l2control <span class=nt>-a</span> 00:02:72:00:d4:1a read_channel_list
L2CAP channels:
Remote BD_ADDR     SCID/ DCID   PSM  IMTU/ OMTU State
00:07:e0:00:0b:ca    66/   64     3   132/  672 OPEN
% l2control <span class=nt>-a</span> 00:02:72:00:d4:1a read_connection_list
L2CAP connections:
Remote BD_ADDR    Handle Flags Pending State
00:07:e0:00:0b:ca     41 O           0 OPEN</code></pre></div></div><div class=paragraph><p>Ещё одним диагностическим инструментом является <a href="https://man.freebsd.org/cgi/man.cgi?query=btsockstat&amp;sektion=1&amp;format=html">btsockstat(1)</a>. Она выполняет действия, подобные тем, что обычно выполняет <a href="https://man.freebsd.org/cgi/man.cgi?query=netstat&amp;sektion=1&amp;format=html">netstat(1)</a>, но со структурами данных, связанных с работой в сети Bluetooth. В примере ниже описывается то же самое логическое соединение, что и с <a href="https://man.freebsd.org/cgi/man.cgi?query=l2control&amp;sektion=8&amp;format=html">l2control(8)</a> выше.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% btsockstat
Active L2CAP sockets
PCB      Recv-Q Send-Q Local address/PSM       Foreign address   CID   State
c2afe900      0      0 00:02:72:00:d4:1a/3     00:07:e0:00:0b:ca 66    OPEN
Active RFCOMM sessions
L2PCB    PCB      Flag MTU   Out-Q DLCs State
c2afe900 c2b53380 1    127   0     Yes  OPEN
Active RFCOMM sockets
PCB      Recv-Q Send-Q Local address     Foreign address   Chan DLCI State
c2e8bc80      0    250 00:02:72:00:d4:1a 00:07:e0:00:0b:ca 3    6    OPEN</code></pre></div></div></div><div class=sect2><h3 id=_протокол_rfcomm>27.4.5. Протокол RFCOMM<a class=anchor href=#_протокол_rfcomm></a></h3><div class=paragraph><p>Протокол RFCOMM эмулирует последовательные порты поверх протокола L2CAP. Он основан на ETSI-стандарте TS 07.10. RFCOMM представляет собой простой транспортный протокол, с дополнительными возможностями по эмуляции 9 цепей последовательных портов RS-232 (EIATIA-232-E). Протокол RFCOMM поддерживает одновременно до 60 соединений (каналов RFCOMM) между двумя устройствами Bluetooth.</p></div><div class=paragraph><p>В рамках RFCOMM полный коммуникационный маршрут включает два приложения, работающие на разных устройствах (конечные коммуникационные точки) с коммуникационным сегментом между ними. RFCOMM предназначен для сокрытия приложений, использующих последовательные порты устройств, в которых они расположены. Коммуникационный сегмент по сути является Bluetooth-связью от одного устройства к другому (прямое соединение).</p></div><div class=paragraph><p>RFCOMM имеет дело с соединением между устройствами в случае прямого соединения, или между устройством и модемом в сетевом случае. RFCOMM может поддерживать и другие конфигурации, такие, как модули, работающие через беспроводную технологию Bluetooth с одной стороны и предоставляющие проводное соединение с другой стороны.</p></div><div class=paragraph><p>Во FreeBSD протокол RFCOMM реализован на уровне сокетов Bluetooth.</p></div></div><div class=sect2><h3 id=_pairing_of_devices>27.4.6. Pairing of Devices<a class=anchor href=#_pairing_of_devices></a></h3><div class=paragraph><p>По умолчанию связь Bluetooth не аутентифицируется, поэтому любое устройство может общаться с любым другим. Устройство Bluetooth (например, сотовый телефон) может задать обязательность аутентификации для предоставления определённого сервиса (в частности, услугу доступа по коммутируемой линии). Bluetooth-аутентификация обычно выполняется через <em>PIN-коды</em>. PIN-код представляет из себя ASCII-строку длиной до 16 символов. Пользователь обязан ввести один и тот же PIN-код на обоих устройствах. Как только он введёт PIN-код, оба устройства сгенерируют <em>ключ связи</em>. После этого ключ может быть сохранён либо в самом устройстве, либо на постоянном носителе. В следующий раз оба устройства будут использовать ранее сгенерированный ключ соединения. Процедура, описанная выше, носит название <em>подгонки пары</em> (pairing). Заметьте, что если ключ связи потерян любой из сторон, то подбор пары должен быть повторен.</p></div><div class=paragraph><p>За обработку всех запросов на Bluetooth-аутентификацию отвечает даемон <a href="https://man.freebsd.org/cgi/man.cgi?query=hcsecd&amp;sektion=8&amp;format=html">hcsecd(8)</a>. По умолчанию файл конфигурации называется <span class=filename>/etc/bluetooth/hcsecd.conf</span>. Пример раздела, содержащего информацию о сотовом телефоне с явно заданным PIN-кодом "1234" приведен ниже:</p></div><div class="literalblock programlisting"><div class=content><pre>device {
        bdaddr  00:80:37:29:19:a4;
        name    &#34;Pav&#39;s T39&#34;;
        key     nokey;
        pin     &#34;1234&#34;;
      }</pre></div></div><div class=paragraph><p>Кроме длины, на PIN-коды не накладывается никаких ограничений. Некоторые устройства (например, Bluetooth-гарнитуры) могут иметь фиксированный встроенный PIN-код. Параметр <code>-d</code> позволяет запустить <a href="https://man.freebsd.org/cgi/man.cgi?query=hcsecd&amp;sektion=8&amp;format=html">hcsecd(8)</a> как нефоновый процесс, что облегчает просмотр происходящих событий. Задайте получение парного ключа на удалённом устройстве и инициируйте Bluetooth-соединение с этим устройством. Удалённое устройство должно подтвердить получение пары и запросить PIN-код. Введите тот же самый код, что находится в <span class=filename>hcsecd.conf</span>. Теперь ваш ПК и удалённое устройство спарены. Альтернативным способом является инициация процесса создания пары на удалённом устройстве.</p></div><div class=paragraph><p>Во FreeBSD 5.5, 6.1 и в более новых, следующая строка может быть добавлена к <span class=filename>/etc/rc.conf</span>, чтобы hcsecd запускался автоматически во время старта системы:</p></div><div class="literalblock programlisting"><div class=content><pre>hcsecd_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>Ниже даётся пример выдачи протокола команды hcsecd:</p></div><div class="literalblock programlisting"><div class=content><pre>hcsecd[16484]: Got Link_Key_Request event from &#39;ubt0hci&#39;, remote bdaddr 0:80:37:29:19:a4
hcsecd[16484]: Found matching entry, remote bdaddr 0:80:37:29:19:a4, name &#39;Pav&#39;s T39&#39;, link key doesn&#39;t exist
hcsecd[16484]: Sending Link_Key_Negative_Reply to &#39;ubt0hci&#39; for remote bdaddr 0:80:37:29:19:a4
hcsecd[16484]: Got PIN_Code_Request event from &#39;ubt0hci&#39;, remote bdaddr 0:80:37:29:19:a4
hcsecd[16484]: Found matching entry, remote bdaddr 0:80:37:29:19:a4, name &#39;Pav&#39;s T39&#39;, PIN code exists
hcsecd[16484]: Sending PIN_Code_Reply to &#39;ubt0hci&#39; for remote bdaddr 0:80:37:29:19:a4</pre></div></div></div><div class=sect2><h3 id=_service_discovery_protocol_sdp>27.4.7. Service Discovery Protocol (SDP)<a class=anchor href=#_service_discovery_protocol_sdp></a></h3><div class=paragraph><p>Протокол обнаружения сервисов SDP даёт возможность клиентским приложениям осуществлять поиск услуг, предоставляемых серверными приложениями, а также характеристик этих услуг. В перечень атрибутов сервиса включается тип класса предлагаемого сервиса и информация о механизме или протоколе, требуемом для использования сервиса.</p></div><div class=paragraph><p>SDP подразумевает коммуникации между SDP-сервером и SDP-клиентом. Сервер поддерживает список сервисов, в котором описываются параметры сервисов, связанных с сервером. Каждая запись об услуге содержит информацию об одном сервисе. Клиент может запросить информацию об определённом сервисе, обслуживаемом SDP-сервером, выдавая SDP-запрос. Если клиент или приложение, связанное с клиентом, решат воспользоваться сервисом, то для его использования необходимо открыть отдельное соединение к устройству, предоставляющему сервис. SDP предоставляет механизм обнаружения услуг и их параметров, но не даёт механизма использования этих сервисов.</p></div><div class=paragraph><p>Обычно SDP-клиент выполняет поиск услуг на основе некоторых желаемых характеристик услуг. Однако иногда возникает необходимость выяснить полный перечень типов услуг, предоставляемых SDP-сервером, не имея никакой информации об имеющихся сервисах. Такой процесс всех предлагаемых сервисов называется <em>обзором</em> (browsing).</p></div><div class=paragraph><p>Bluetooth SDP сервер <a href="https://man.freebsd.org/cgi/man.cgi?query=sdpd&amp;sektion=8&amp;format=html">sdpd(8)</a> и клиент с интерфейсом командной строки <a href="https://man.freebsd.org/cgi/man.cgi?query=sdpcontrol&amp;sektion=8&amp;format=html">sdpcontrol(8)</a> включены в стандартную поставку FreeBSD. В следующем примере показано, как выполнять запрос на SDP-обзор.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% sdpcontrol <span class=nt>-a</span> 00:01:03:fc:6e:ec browse
Record Handle: 00000000
Service Class ID List:
        Service Discovery Server <span class=o>(</span>0x1000<span class=o>)</span>
Protocol Descriptor List:
        L2CAP <span class=o>(</span>0x0100<span class=o>)</span>
                Protocol specific parameter <span class=c>#1: u/int/uuid16 1</span>
                Protocol specific parameter <span class=c>#2: u/int/uuid16 1</span>

Record Handle: 0x00000001
Service Class ID List:
        Browse Group Descriptor <span class=o>(</span>0x1001<span class=o>)</span>

Record Handle: 0x00000002
Service Class ID List:
        LAN Access Using PPP <span class=o>(</span>0x1102<span class=o>)</span>
Protocol Descriptor List:
        L2CAP <span class=o>(</span>0x0100<span class=o>)</span>
        RFCOMM <span class=o>(</span>0x0003<span class=o>)</span>
                Protocol specific parameter <span class=c>#1: u/int8/bool 1</span>
Bluetooth Profile Descriptor List:
        LAN Access Using PPP <span class=o>(</span>0x1102<span class=o>)</span> ver. 1.0</code></pre></div></div><div class="olist lowerroman"><ol class=lowerroman type=i><li><p>и так далее. Заметьте, что каждый сервис имеет перечень атрибутов (например, канал RFCOMM). В зависимости от сервиса вам может потребоваться где-то сохранить эти атрибуты. Некоторые реализации Bluetooth не поддерживают просмотр сервисов и могут возвращать пустой список. В этом случае возможен поиск конкретной услуги. В примере ниже показано, как выполнить поиск службы OBEX Object Push (OPUSH):</p></li></ol></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% sdpcontrol <span class=nt>-a</span> 00:01:03:fc:6e:ec search OPUSH</code></pre></div></div><div class=paragraph><p>Во FreeBSD предоставление сервисов клиентам Bluetooth осуществляется сервером <a href="https://man.freebsd.org/cgi/man.cgi?query=sdpd&amp;sektion=8&amp;format=html">sdpd(8)</a>. Во FreeBSD 5.5, 6.1 и в более новых, следующая строка может быть добавлена в файл <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>sdpd_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>После этого sdpd даемон может быть запущен с помощью:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># /etc/rc.d/sdpd start</span></code></pre></div></div><div class=paragraph><p>Во FreeBSD 6.0, и во FreeBSD 5.X перед 5.5, sdpd не интегрирован в скрипты загрузки системы. Он должен запускаться автоматически командой:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sdpd</span></code></pre></div></div><div class=paragraph><p>Приложение на локальном сервере, желающее предоставить сервис Bluetooth удаленным клиентам, регистрирует сервис через локального даемона SDP. Пример такого приложения - <a href="https://man.freebsd.org/cgi/man.cgi?query=rfcomm_pppd&amp;sektion=8&amp;format=html">rfcomm_pppd(8)</a>. После запуска оно регистрирует Bluetooth LAN сервис через локального даемона SDP.</p></div><div class=paragraph><p>Список сервисов, зарегистрированных через локальный SDP сервер, может быть получен путем выдачи запроса на просмотр SDP через локальный контрольный канал:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sdpcontrol -l browse</span></code></pre></div></div></div><div class=sect2><h3 id=_доступ_к_сети_по_коммутируемой_линии_связи_dun_и_по_протоколу_ppp_lan>27.4.8. Доступ к сети по коммутируемой линии связи (DUN) и по протоколу PPP (LAN)<a class=anchor href=#_доступ_к_сети_по_коммутируемой_линии_связи_dun_и_по_протоколу_ppp_lan></a></h3><div class=paragraph><p>Модуль работы с коммутируемым доступом к сети (DUN - Dial-Up Networking) в большинстве случаев используется с модемами и сотовыми телефонами. Этот модуль покрывает следующие случаи:</p></div><div class=ulist><ul><li><p>сотовый телефон или модем используется вместе с компьютером в качестве беспроводного модема для подключения к серверу коммутируемого доступа в Интернет, или другой коммутируемой услуге;</p></li><li><p>сотовый телефон или модем используется компьютером для приёма входящих соединений.</p></li></ul></div><div class=paragraph><p>Модуль доступа к сети по протоколу PPP (Network Access with PPP - LAN) может использоваться в следующих ситуациях:</p></div><div class=ulist><ul><li><p>доступ к ЛВС для одного Bluetooth-устройства;</p></li><li><p>доступ к ЛВС для нескольких Bluetooth-устройств;</p></li><li><p>связь между двумя ПК (при помощи протокола PPP поверх эмулируемого последовательного канала связи).</p></li></ul></div><div class=paragraph><p>Во FreeBSD оба случая реализуются при помощи сервисных программ <a href="https://man.freebsd.org/cgi/man.cgi?query=ppp&amp;sektion=8&amp;format=html">ppp(8)</a> и <a href="https://man.freebsd.org/cgi/man.cgi?query=rfcomm_pppd&amp;sektion=8&amp;format=html">rfcomm_pppd(8)</a> - это обработчик, преобразующий RFCOMM-соединения Bluetooth в нечто, с чем может работать PPP. Перед тем, как использовать любой модуль, в файле <span class=filename>/etc/ppp/ppp.conf</span> должна быть создана новая PPP-метка. Примеры использования можно найти в справочной странице к <a href="https://man.freebsd.org/cgi/man.cgi?query=rfcomm_pppd&amp;sektion=8&amp;format=html">rfcomm_pppd(8)</a>.</p></div><div class=paragraph><p>В следующем примере <a href="https://man.freebsd.org/cgi/man.cgi?query=rfcomm_pppd&amp;sektion=8&amp;format=html">rfcomm_pppd(8)</a> будет использоваться для открытия RFCOMM-соединения к удалённому устройству с BD_ADDR 00:80:37:29:19:a4 на DUN RFCOMM-канале. Реальный номер RFCOMM-канала будет получаться с удалённого устройства через SDP. Возможно указать RFCOMM-канал вручную, и в этом случае <a href="https://man.freebsd.org/cgi/man.cgi?query=rfcomm_pppd&amp;sektion=8&amp;format=html">rfcomm_pppd(8)</a> не будет выполнять SDP-запрос. Для нахождения RFCOMM-канала на удалённом устройстве используйте утилиту <a href="https://man.freebsd.org/cgi/man.cgi?query=sdpcontrol&amp;sektion=8&amp;format=html">sdpcontrol(8)</a>.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># rfcomm_pppd -a 00:80:37:29:19:a4 -c -C dun -l rfcomm-dialup</span></code></pre></div></div><div class=paragraph><p>Для того, чтобы организовать сервис Network Access with PPP (LAN), необходимо запустить сервер <a href="https://man.freebsd.org/cgi/man.cgi?query=sdpd&amp;sektion=8&amp;format=html">sdpd(8)</a>. В файле <span class=filename>/etc/ppp/ppp.conf</span> должна быть создана новая запись для клиентов LAN. Примеры можно найти в справке по <a href="https://man.freebsd.org/cgi/man.cgi?query=rfcomm_pppd&amp;sektion=8&amp;format=html">rfcomm_pppd(8)</a>. Наконец, запустите RFCOMM PPP сервер на существующем номере канала RFCOMM. Сервер RFCOMM PPP автоматически зарегистрирует Bluetooth LAN сервис через локальный SDP даемон. В примере ниже показано, как запустить сервер RFCOMM PPP.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># rfcomm_pppd -s -C 7 -l rfcomm-server</span></code></pre></div></div></div><div class=sect2><h3 id=_obex_object_push_opush_profile>27.4.9. OBEX Object Push (OPUSH) Profile<a class=anchor href=#_obex_object_push_opush_profile></a></h3><div class=paragraph><p>OBEX является широко используемым протоколом для простой передачи файлов между мобильными устройствами. В основном он используется в коммуникациях через инфракрасный порт для передачи файлов между ноутбуками или КПК, а также для пересылки визитных карточек или календарных планов между сотовыми телефонами и другими устройствами с персональными информационными менеджерами.</p></div><div class=paragraph><p>Сервер и клиент OBEX реализованы в виде пакета стороннего разработчика obexapp, который доступен в виде порта <a class=package href=https://cgit.freebsd.org/ports/tree/comms/obexapp/>comms/obexapp</a>.</p></div><div class=paragraph><p>Клиент OBEX используется для посылки или приёма объектов с сервера OBEX. Объектом, к примеру, может быть визитная карточка или указание. Клиент OBEX может получить номер RFCOMM-канала, указав вместо него имя сервиса. Поддерживаются следующие имена сервиса: IrMC, FTRN и OPUSH. Канал RFCOMM можно задать его номером. Ниже даётся пример сеанса OBEX, где с сотового телефона забирается объект с информацией об устройстве, а новый объект (визитная карточка) передаётся в каталог сотового телефона.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% obexapp <span class=nt>-a</span> 00:80:37:29:19:a4 <span class=nt>-C</span> IrMC
obex&gt; get telecom/devinfo.txt devinfo-t39.txt
Success, response: OK, Success <span class=o>(</span>0x20<span class=o>)</span>
obex&gt; put new.vcf
Success, response: OK, Success <span class=o>(</span>0x20<span class=o>)</span>
obex&gt; di
Success, response: OK, Success <span class=o>(</span>0x20<span class=o>)</span></code></pre></div></div><div class=paragraph><p>Для того, чтобы предоставить сервис OBEX Push, должен быть запущен сервер <a href="https://man.freebsd.org/cgi/man.cgi?query=sdpd&amp;sektion=8&amp;format=html">sdpd(8)</a>. Должен быть создан корневой каталог, в котором будут сохраняться все поступающие объекты. По умолчанию корневым каталогом является <span class=filename>/var/spool/obex</span>. Наконец, запустите OBEX сервер на существующем номере канала RFCOMM. OBEX сервер автоматически зарегистрирует сервис OBEX Object Push через локального даемона SDP. В примере ниже показано, как запустить OBEX-сервер.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># obexapp -s -C 10</span></code></pre></div></div></div><div class=sect2><h3 id=_профиль_последовательного_порта_spp>27.4.10. Профиль последовательного порта (SPP)<a class=anchor href=#_профиль_последовательного_порта_spp></a></h3><div class=paragraph><p>Профиль последовательного порта (SPP - Serial Port Profile) позволяет Bluetooth-устройствам осуществлять эмуляцию последовательного порта RS232 (или подобного). Этот профиль покрывает случаи, касающиеся работы унаследованных приложений с Bluetooth в качестве замены кабельному соединению, при это используется абстракция виртуального последовательного порта.</p></div><div class=paragraph><p>Утилита <a href="https://man.freebsd.org/cgi/man.cgi?query=rfcomm_sppd&amp;sektion=1&amp;format=html">rfcomm_sppd(1)</a> реализует профиль последовательного порта. В качестве виртуального последовательного порта используется псевдо-терминал. В примере ниже показано, как подключиться к сервису Serial Port удалённого устройства. Заметьте, что вы не указываете RFCOMM-канал - <a href="https://man.freebsd.org/cgi/man.cgi?query=rfcomm_sppd&amp;sektion=1&amp;format=html">rfcomm_sppd(1)</a> может получить его с удалённого устройства через SDP. Если вы хотите переопределить это, укажите RFCOMM-канал явно в командной строке.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># rfcomm_sppd -a 00:07:E0:00:0B:CA -t /dev/ttyp6</span>
rfcomm_sppd[94692]: Starting on /dev/ttyp6...</code></pre></div></div><div class=paragraph><p>После подключения псевдо-терминал можно использовать как последовательный порт:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cu -l ttyp6</span></code></pre></div></div></div><div class=sect2><h3 id=_решение_проблем>27.4.11. Решение проблем<a class=anchor href=#_решение_проблем></a></h3><div class=sect3><h4 id=_удалённое_устройство_не_подключается>27.4.11.1. Удалённое устройство не подключается<a class=anchor href=#_удалённое_устройство_не_подключается></a></h4><div class=paragraph><p>Некоторые старые Bluetooth-устройства не поддерживают переключение ролей. По умолчанию, когда FreeBSD подтверждает новое соединение, она пытается выполнить переключение роли и стать ведущим устройством. Устройства, которые это не поддерживают, не смогут подключиться. Заметьте, что переключение ролей выполняется при установлении нового соединения, поэтому невозможно выяснить, поддерживает ли удалённое устройство переключение ролей. На локальной машине имеется возможность отключить переключение ролей при помощи HCI-параметра:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># hccontrol -n ubt0hci write_node_role_switch 0</span></code></pre></div></div></div><div class=sect3><h4 id=_что_то_идёт_не_так_можно_ли_посмотреть_что_в_точности_происходит>27.4.11.2. Что-то идёт не так, можно ли посмотреть, что в точности происходит?<a class=anchor href=#_что_то_идёт_не_так_можно_ли_посмотреть_что_в_точности_происходит></a></h4><div class=paragraph><p>Да, можно. Воспользуйтесь пакетом стороннего разработчика, hcidump который доступен в виде порта <a class=package href=https://cgit.freebsd.org/ports/tree/comms/hcidump/>comms/hcidump</a>. Утилита hcidump похожа на <a href="https://man.freebsd.org/cgi/man.cgi?query=tcpdump&amp;sektion=1&amp;format=html">tcpdump(1)</a>. Она может быть использована для вывода на терминал содержимого Bluetooth-пакетов и сбрасывать пакеты Bluetooth в файл.</p></div></div></div></div></div><div class=sect1><h2 id=network-bridging>27.5. Мосты<a class=anchor href=#network-bridging></a></h2><div class=sectionbody><div class=sect2><h3 id=_введение_3>27.5.1. Введение<a class=anchor href=#_введение_3></a></h3><div class=paragraph><p>Иногда полезно разделить одну физическую сеть (такую, как сегмент Ethernet) на два отдельных сегмента сети без необходимости создания подсетей IP и использования маршрутизатора для соединения сегментов. Устройство, которое соединяет две сети на такой манер, называется "сетевым мостом" ("bridge"). Система FreeBSD с двумя сетевыми адаптерами может выступать в роли моста.</p></div><div class=paragraph><p>Мост работает на основе изучения адресов уровня MAC (адресов Ethernet) устройств на каждом из своих сетевых интерфейсах. Он перенаправляет трафик между двумя сетями, только когда адреса отправителя и получателя находятся в разных сетях.</p></div><div class=paragraph><p>По многим параметрам мост работает также, как коммутатор Ethernet с малым количеством портов.</p></div></div><div class=sect2><h3 id=_ситуации_когда_можно_использовать_мосты>27.5.2. Ситуации, когда можно использовать мосты<a class=anchor href=#_ситуации_когда_можно_использовать_мосты></a></h3><div class=paragraph><p>На сегодняшний день есть две ситуации, когда можно использовать мост.</p></div><div class=sect3><h4 id=_большой_трафик_в_сегменте>27.5.2.1. Большой трафик в сегменте<a class=anchor href=#_большой_трафик_в_сегменте></a></h4><div class=paragraph><p>Первая ситуация возникает, когда ваша физическая сеть перегружена трафиком, но по каким-то соображениям вы не хотите разделять сеть на подсети и соединять их с помощью маршрутизатора.</p></div><div class=paragraph><p>Давайте рассмотрим в качестве примера газету, в которой редакторский и производственный отделы находятся в одной и той же подсети. Пользователи в редакторском отделе все используют сервер <code>A</code> для служб доступа к файлам, а пользователи производственного отдела используют сервер <code>B</code>. Для объединения всех пользователей используется сеть Ethernet, а высокая нагрузка на сеть замедляет работу.</p></div><div class=paragraph><p>Если пользователи редакторского отдела могут быть собраны в одном сегменте сети, а пользователи производственного отдела в другом, то два сетевых сегмента можно объединить мостом. Только сетевой трафик, предназначенный для интерфейсов с "другой" стороны моста, будет посылаться в другую сеть, тем самым снижая уровень нагрузки на каждый сегмент сети.</p></div></div><div class=sect3><h4 id=_сетевой_экран_с_возможностями_фильтрацииограничения_пропускной_способности_трафика>27.5.2.2. Сетевой экран с возможностями фильтрации/ограничения пропускной способности трафика<a class=anchor href=#_сетевой_экран_с_возможностями_фильтрацииограничения_пропускной_способности_трафика></a></h4><div class=paragraph><p>Второй распространённой ситуацией является необходимость в обеспечении функций сетевого экрана без трансляции сетевых адресов (NAT).</p></div><div class=paragraph><p>Для примера можно взять маленькую компанию, которая подключена к своему провайдеру по каналу DSL или ISDN. Для неё провайдер выделил 13 глобально доступных IP-адресов для имеющихся в сети 10 персональных компьютеров. В такой ситуации использование сетевого экрана на основе маршрутизатора затруднено из-за проблем с разделением на подсети.</p></div><div class=paragraph><p>Брандмауэр на основе моста может быть настроен и включен между маршрутизаторами DSL/ISDN без каких-либо проблем с IP-адресацией.</p></div></div></div><div class=sect2><h3 id=_настройка_моста>27.5.3. Настройка моста<a class=anchor href=#_настройка_моста></a></h3><div class=sect3><h4 id=_выбор_сетевого_адаптера>27.5.3.1. Выбор сетевого адаптера<a class=anchor href=#_выбор_сетевого_адаптера></a></h4><div class=paragraph><p>Для работы моста требуются по крайней мере два сетевых адаптера. К сожалению, не все сетевые адаптеры поддерживают функции моста. Прочтите страницу Справочника по <a href="https://man.freebsd.org/cgi/man.cgi?query=bridge&amp;sektion=4&amp;format=html">bridge(4)</a> для выяснения подробностей о поддерживаемых адаптерах.</p></div><div class=paragraph><p>Перед тем, как продолжить, сначала установите и протестируйте два сетевых адаптера.</p></div></div><div class=sect3><h4 id=_изменения_в_конфигурации_ядра>27.5.3.2. Изменения в конфигурации ядра<a class=anchor href=#_изменения_в_конфигурации_ядра></a></h4><div class=paragraph><p>Для включения поддержки функций сетевого моста в ядре, добавьте строчку</p></div><div class="literalblock programlisting"><div class=content><pre>options BRIDGE</pre></div></div><div class=paragraph><p>в файл конфигурации вашего ядра, и перестройте ядро.</p></div></div><div class=sect3><h4 id=_поддержка_функций_брандмауэра>27.5.3.3. Поддержка функций брандмауэра<a class=anchor href=#_поддержка_функций_брандмауэра></a></h4><div class=paragraph><p>Если вы планируете использовать мост в качестве брандмауэра, вам нужно также добавить опцию <code>IPFIREWALL</code>. Прочтите <a href=../firewalls/#firewalls>Межсетевые экраны</a>, содержащую общую информацию о настройке моста в качестве брандмауэра.</p></div><div class=paragraph><p>Если вам необходимо обеспечить прохождение не-IP пакетов (таких, как ARP) через мост, то имеется опция брандмауэра, которую можно задать. Это опция <code>IPFIREWALL_DEFAULT_TO_ACCEPT</code>. Заметьте, что при этом правило, используемое брандмауэром по умолчанию, меняется на разрешительное для всех пакетов. Перед тем, как задавать эту опцию, убедитесь, что вы понимаете работу вашего набора правил.</p></div></div><div class=sect3><h4 id=_поддержка_функций_ограничения_пропускной_способности>27.5.3.4. Поддержка функций ограничения пропускной способности<a class=anchor href=#_поддержка_функций_ограничения_пропускной_способности></a></h4><div class=paragraph><p>Если вы хотите использовать мост в качестве машины, ограничивающей пропускную способность, то добавьте в файл конфигурации ядра опцию <code>DUMMYNET</code>. Дополнительную информацию можно почерпнуть из страницы Справочника по <a href="https://man.freebsd.org/cgi/man.cgi?query=dummynet&amp;sektion=4&amp;format=html">dummynet(4)</a>.</p></div></div></div><div class=sect2><h3 id=_включение_функций_моста>27.5.4. Включение функций моста<a class=anchor href=#_включение_функций_моста></a></h3><div class=paragraph><p>Добавьте строку</p></div><div class="literalblock programlisting"><div class=content><pre>net.link.ether.bridge.enable=1</pre></div></div><div class=paragraph><p>в файл <span class=filename>/etc/sysctl.conf</span> для включения функций моста во время работы системы, и строку:</p></div><div class="literalblock programlisting"><div class=content><pre>net.link.ether.bridge.config=if1,if2</pre></div></div><div class=paragraph><p>для включения функций моста для указанных интерфейсов (замените <em>if1</em> и <em>if2</em> на имена двух ваших сетевых интерфейсов). Если вы хотите, чтобы проходящие через мост пакеты фильтровались посредством <a href="https://man.freebsd.org/cgi/man.cgi?query=ipfw&amp;sektion=8&amp;format=html">ipfw(8)</a>, вы должны также добавить строчку:</p></div><div class="literalblock programlisting"><div class=content><pre>net.link.ether.bridge.ipfw=1</pre></div></div><div class=paragraph><p>Для версий FreeBSD, предшествующих FreeBSD 5.2-RELEASE, нужно использовать следующие строки:</p></div><div class="literalblock programlisting"><div class=content><pre>net.link.ether.bridge=1
net.link.ether.bridge_cfg=if1,if2
net.link.ether.bridge_ipfw=1</pre></div></div></div><div class=sect2><h3 id=_дополнительные_замечания>27.5.5. Дополнительные замечания<a class=anchor href=#_дополнительные_замечания></a></h3><div class=paragraph><p>Если вы хотите осуществлять удалённый доступ на мост через <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;format=html">ssh(1)</a> из сети, то корректно назначить одному из сетевых адаптеров IP-адрес. Общепринято, что назначение адреса обоим сетевым адаптерам является не самой хорошей идеей.</p></div><div class=paragraph><p>Если в вашей сети присутствует несколько мостов, не должно быть более одного маршрута между любыми двумя рабочими станциями. С технической точки зрения это означает отсутствие поддержки протокола spanning tree.</p></div><div class=paragraph><p>Сетевой мост может увеличить задержки в замерах командой <a href="https://man.freebsd.org/cgi/man.cgi?query=ping&amp;sektion=8&amp;format=html">ping(8)</a>, особенно для трафика между двумя разными сегментами.</p></div></div></div></div><div class=sect1><h2 id=network-diskless>27.6. Работа с бездисковыми станциями<a class=anchor href=#network-diskless></a></h2><div class=sectionbody><div class=paragraph><p>Машина с FreeBSD может загружаться по сети и работать без наличия локального диска, используя файловые системы, монтируемые с сервера NFS. Кроме стандартных конфигурационных файлов, не нужны никакие модификации в системе. Такую систему легко настроить, потому что все необходимые элементы уже готовы:</p></div><div class=ulist><ul><li><p>Имеется по крайней мере два возможных способа загрузки ядра по сети:</p><div class=ulist><ul><li><p>PXE: Система Intel® Preboot eXecution Environment является формой загрузочного ПЗУ, встроенного в некоторые сетевые адаптеры или материнские платы. Обратитесь к справочной странице по <a href="https://man.freebsd.org/cgi/man.cgi?query=pxeboot&amp;sektion=8&amp;format=html">pxeboot(8)</a> для получения более полной информации.</p></li><li><p>Порт Etherboot (<a class=package href=https://cgit.freebsd.org/ports/tree/net/etherboot/>net/etherboot</a>) генерирует код, который может применяться в ПЗУ для загрузки ядра по сети. Код может быть либо прошит в загрузочный PROM на сетевом адаптере, либо загружен с локальной дискеты (или винчестера), или с работающей системы MS-DOS®. Поддерживаются многие сетевые адаптеры.</p></li></ul></div></li><li><p>Примерный скрипт (<span class=filename>/usr/shared/examples/diskless/clone_root</span>) облегчает создание и поддержку корневой файловой системы рабочей станции на сервере. Скрипт, скорее всего, потребует некоторых настроек, но он позволит вам быстро начать работу.</p></li><li><p>Стандартные файлы начального запуска системы, располагающиеся в <span class=filename>/etc</span>, распознают и поддерживают загрузку системы в бездисковом варианте.</p></li><li><p>Подкачка, если она нужна, может выполняться через файл NFS либо на локальный диск.</p></li></ul></div><div class=paragraph><p>Существует много способов настройки бездисковой рабочей станции. При этом задействованы многие компоненты, и большинство из них могут быть настроены для удовлетворения ваших вкусов. Далее будет описаны варианты полной настройки системы, при этом упор будет делаться на простоту и совместимость с стандартной системой скриптов начальной загрузки FreeBSD. Описываемая система имеет такие характеристики:</p></div><div class=ulist><ul><li><p>Бездисковые рабочие станции совместно используют файловую систему <span class=filename>/</span> в режиме только чтения, а также используют <span class=filename>/usr</span> совместно тоже в режиме только чтения.</p><div class=paragraph><p>Корневая файловая система является копией стандартной корневой системы FreeBSD (обычно сервера), с некоторыми настроечными файлами, измененными кем-то специально для бездисковых операций или, возможно, для рабочей станции, которой она предназначена.</p></div><div class=paragraph><p>Части корневой файловой системы, которые должны быть доступны для записи, перекрываются файловыми системами <a href="https://man.freebsd.org/cgi/man.cgi?query=md&amp;sektion=4&amp;format=html">md(4)</a>. Любые изменения будут потеряны при перезагрузках системы.</p></div></li><li><p>Ядро передается и загружается посредством Etherboot или PXE, и в некоторых ситуациях может быть использован любой из этих методов.</p></li></ul></div><div class="admonitionblock caution"><table><tbody><tr><td class=icon><i class="fa icon-caution" title=Caution></i></td><td class=content><div class=paragraph><p>Как описано, эта система не защищена. Она должна располагаться в защищенной части сети, а другие хосты не должны на нее полагаться.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Вся информация этого раздела была протестирована с релизом FreeBSD 5.2.1-RELEASE.</p></div><div class=sect2><h3 id=_общая_информация>27.6.1. Общая информация<a class=anchor href=#_общая_информация></a></h3><div class=paragraph><p>Настройка бездисковых рабочих станций относительно проста, но в то же время легко сделать ошибку. Иногда сложно диагностировать эти ошибки по нескольким причинам. Например:</p></div><div class=ulist><ul><li><p>Параметры компиляции могут по-разному проявлять себя во время работы.</p></li><li><p>Сообщения об ошибках бывают загадочны или вовсе отсутствуют.</p></li></ul></div><div class=paragraph><p>В данной ситуации некоторые знания, касающиеся используемых внутренних механизмов, очень полезны при разрешении проблем, которые могут возникнуть.</p></div><div class=paragraph><p>Для выполнения успешной загрузки необходимо произвести несколько операций:</p></div><div class=ulist><ul><li><p>Компьютеру необходимо получить начальные параметры, такие как собственный IP адрес, имя исполняемого файла, корневой каталог. Для этого используются протоколы DHCP или BOOTP. DHCP это совместимое расширение BOOTP, используются те же номера портов и основной формат пакетов.</p><div class=paragraph><p>Возможна настройка системы для использования только BOOTP. Серверная программа <a href="https://man.freebsd.org/cgi/man.cgi?query=bootpd&amp;sektion=8&amp;format=html">bootpd(8)</a> включена в основную систему FreeBSD.</p></div><div class=paragraph><p>Тем не менее, у DHCP есть множество преимуществ над BOOTP (лучше файлы настройки, возможность использования PXE, плюс многие другие преимущества, не относящиеся непосредственно к бездисковым операциям), и мы в основном будем описывать настройку DHCP, с эквивалентными примерами для <a href="https://man.freebsd.org/cgi/man.cgi?query=bootpd&amp;sektion=8&amp;format=html">bootpd(8)</a>, когда это возможно. Пример конфигурации будет использовать пакет ISC DHCP (релиз 3.0.1.r12 был установлен на тестовом сервере).</p></div></li><li><p>Компьютеру требуется загрузить в локальную память одну или несколько программ. Используются TFTP или NFS. Выбор между TFTP или NFS производится во время компилирования в нескольких местах. Часто встречающаяся ошибка это указание имен файлов для другого протокола: TFTP обычно загружает все файлы с одного каталога сервера, и принимает имена файлов относительно этого каталога. NFS нужны абсолютные пути к файлам.</p></li><li><p>Необходимо инициализировать и выполнить возможные промежуточные программы загрузки и ядро. В этой области существует несколько важных вариаций:</p><div class=ulist><ul><li><p>PXE загрузит <a href="https://man.freebsd.org/cgi/man.cgi?query=pxeboot&amp;sektion=8&amp;format=html">pxeboot(8)</a>, являющийся модифицированной версией загрузчика третьей стадии FreeBSD. <a href="https://man.freebsd.org/cgi/man.cgi?query=loader&amp;sektion=8&amp;format=html">loader(8)</a> получит большинство параметров, необходимых для старта системы, и оставит их в окружении ядра до контроля передачи. В этом случае возможно использование ядра <span class=filename>GENERIC</span>.</p></li><li><p>Etherboot, непосредственно загрузит ядро, с меньшей подготовкой. Вам потребуется собрать ядро со специальными параметрами.</p><div class=paragraph><p>PXE и Etherboot работают одинаково хорошо; тем не менее, поскольку ядро обычно позволяет <a href="https://man.freebsd.org/cgi/man.cgi?query=loader&amp;sektion=8&amp;format=html">loader(8)</a> выполнить больше предварительной работы, метод PXE предпочтителен.</p></div><div class=paragraph><p>Если ваш BIOS и сетевые карты поддерживают PXE, используйте его.</p></div></li></ul></div></li><li><p>Наконец, компьютеру требуется доступ к файловым системам. NFS используется во всех случаях.</p></li></ul></div><div class=paragraph><p>Обратитесь также к странице справочника <a href="https://man.freebsd.org/cgi/man.cgi?query=diskless&amp;sektion=8&amp;format=html">diskless(8)</a>.</p></div></div><div class=sect2><h3 id=_инструкции_по_настройке>27.6.2. Инструкции по настройке<a class=anchor href=#_инструкции_по_настройке></a></h3><div class=sect3><h4 id=_конфигурация_с_использованием_isc_dhcp>27.6.2.1. Конфигурация с использованием ISC DHCP<a class=anchor href=#_конфигурация_с_использованием_isc_dhcp></a></h4><div class=paragraph><p>Сервер ISC DHCP может обрабатывать как запросы BOOTP, так и запросы DHCP.</p></div><div class=paragraph><p>ISC DHCP 3.0 не включается в поставку системы. Сначала вам нужно будет установить порт <a class=package href=https://cgit.freebsd.org/ports/tree/net/isc-dhcp3-server/>net/isc-dhcp3-server</a> или соответствующий пакет.</p></div><div class=paragraph><p>После установки ISC DHCP ему для работы требуется конфигурационный файл (обычно называемый <span class=filename>/usr/local/etc/dhcpd.conf</span>). Вот прокомментированный пример, где хост <code>margaux</code> использует Etherboot, а хост <code>corbieres</code> использует PXE:</p></div><div class="literalblock programlisting"><div class=content><pre>default-lease-time 600;
max-lease-time 7200;
authoritative;

option domain-name &#34;example.com&#34;;
option domain-name-servers 192.168.4.1;
option routers 192.168.4.1;

subnet 192.168.4.0 netmask 255.255.255.0 {
  use-host-decl-names on; <i class=conum data-value=1></i><b>(1)</b>
  option subnet-mask 255.255.255.0;
  option broadcast-address 192.168.4.255;

  host margaux {
    hardware ethernet 01:23:45:67:89:ab;
    fixed-address margaux.example.com;
    next-server 192.168.4.4; <i class=conum data-value=2></i><b>(2)</b>
    filename &#34;/data/misc/kernel.diskless&#34;; <i class=conum data-value=3></i><b>(3)</b>
    option root-path &#34;192.168.4.4:/data/misc/diskless&#34;; <i class=conum data-value=4></i><b>(4)</b>
  }
  host corbieres {
    hardware ethernet 00:02:b3:27:62:df;
    fixed-address corbieres.example.com;
    next-server 192.168.4.4;
    filename &#34;pxeboot&#34;;
    option root-path &#34;192.168.4.4:/data/misc/diskless&#34;;
  }
}</pre></div></div><div class="colist arabic"><table><tbody><tr><td><i class=conum data-value=1></i><b>1</b></td><td>Этот параметр указывает dhcpd посылать значения деклараций <code>host</code> как имя хоста для бездисковой машины. Альтернативным способом было бы добавление <code>option host-name <em>margaux</em></code> внутри объявлений <code>host</code>.</td></tr><tr><td><i class=conum data-value=2></i><b>2</b></td><td>Директива <code>next-server</code> определяет сервер TFTP или NFS, используемый для получения загрузчика или файла ядра (по умолчанию используется тот же самый хост, на котором расположен сервер DHCP).</td></tr><tr><td><i class=conum data-value=3></i><b>3</b></td><td>Директива <code>filename</code> определяет файл, который Etherboot или PXE будут загружать для следующего шага выполнения. Он должен быть указан в соответствии с используемым методом передачи. Etherboot может быть скомпилирован для использования NFS или TFTP. FreeBSD порт по умолчанию использует NFS. PXE использует TFTP, поэтому здесь применяются относительные пути файлов (это может зависеть от настроек TFTP сервера, но обычно довольно типично). Кроме того, PXE загружает <span class=filename>pxeboot</span>, а не ядро. Существуют другие интересные возможности, такие как загрузка <span class=filename>pxeboot</span> из каталога <span class=filename>/boot</span> FreeBSD CD-ROM (поскольку <a href="https://man.freebsd.org/cgi/man.cgi?query=pxeboot&amp;sektion=8&amp;format=html">pxeboot(8)</a> может загружать <span class=filename>GENERIC</span> ядро, это делает возможной загрузку с удаленного CD-ROM).</td></tr><tr><td><i class=conum data-value=4></i><b>4</b></td><td>Параметр <code>root-path</code> определяет путь к корневой файловой системе, в обычной нотации NFS. При использовании PXE, можно оставить IP хоста отключенным, если параметр ядра BOOTP не используется. Затем NFS сервер может использоваться так же, как и TFTP.</td></tr></tbody></table></div></div><div class=sect3><h4 id=_настройка_с_использованием_bootp>27.6.2.2. Настройка с использованием BOOTP<a class=anchor href=#_настройка_с_использованием_bootp></a></h4><div class=paragraph><p>Далее описана эквивалентная конфигурация с использованием bootpd (для одного клиента). Она будет располагаться в <span class=filename>/etc/bootptab</span>.</p></div><div class=paragraph><p>Пожалуйста, отметьте, что Etherboot должен быть откомпилирован с нестандартной опцией <code>NO_DHCP_SUPPORT</code> для того, чтобы можно было использовать BOOTP, и что для работы PXE_необходим_DHCP. Единственным очевидным преимуществом bootpd является его наличие в поставке системы.</p></div><div class="literalblock programlisting"><div class=content><pre>.def100:\
  :hn:ht=1:sa=192.168.4.4:vm=rfc1048:\
  :sm=255.255.255.0:\
  :ds=192.168.4.1:\
  :gw=192.168.4.1:\
  :hd=&#34;/tftpboot&#34;:\
  :bf=&#34;/kernel.diskless&#34;:\
  :rp=&#34;192.168.4.4:/data/misc/diskless&#34;:

margaux:ha=0123456789ab:tc=.def100</pre></div></div></div><div class=sect3><h4 id=_подготовка_программы_загрузки_при_помощи_etherboot>27.6.2.3. Подготовка программы загрузки при помощи Etherboot<a class=anchor href=#_подготовка_программы_загрузки_при_помощи_etherboot></a></h4><div class=paragraph><p><a href=http://etherboot.sourceforge.net>Сайт Etherboot</a> содержит <a href=http://etherboot.sourceforge.net/doc/html/userman/t1.html>подробную документацию</a>, в основном предназначенную для систем Linux, но несомненно, она полезна. Далее будет просто кратко описано, как вы должны использовать Etherboot в системе FreeBSD.</p></div><div class=paragraph><p>Сначала вы должны установить пакет или порт <a class=package href=https://cgit.freebsd.org/ports/tree/net/etherboot/>net/etherboot</a>.</p></div><div class=paragraph><p>Вы можете изменить настройку Etherboot (например, для использования TFTP вместо NFS) путем редактирования файла <span class=filename>Config</span> в каталоге исходных текстов Etherboot.</p></div><div class=paragraph><p>В нашей ситуации мы будем использовать загрузочную дискету. Для других методов (PROM или программа MS-DOS®) пожалуйста, обратитесь к документации по Etherboot.</p></div><div class=paragraph><p>Для создания загрузочной дискеты, вставьте дискету в дисковод на машине, где установлен Etherboot, затем перейдите в каталог <span class=filename>src</span> в дереве Etherboot и наберите:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># gmake bin32/devicetype.fd0</span></code></pre></div></div><div class=paragraph><p><em>devicetype</em> зависит от типа адаптера Ethernet на бездисковой рабочей станции. Обратитесь к файлу <span class=filename>NIC</span> в том же самом каталоге для определения правильного значения для <em>devicetype</em>.</p></div></div><div class=sect3><h4 id=_загрузка_с_pxe>27.6.2.4. Загрузка с PXE<a class=anchor href=#_загрузка_с_pxe></a></h4><div class=paragraph><p>По умолчанию, <a href="https://man.freebsd.org/cgi/man.cgi?query=pxeboot&amp;sektion=8&amp;format=html">pxeboot(8)</a> загружает ядро через NFS. Он может быть скомпилирован для использования вместо него TFTP путем указания параметра <code>LOADER_TFTP_SUPPORT</code> в <span class=filename>/etc/make.conf</span>. Смотрите комментарии в файле <span class=filename>/usr/shared/examples/etc/make.conf</span>.</p></div><div class=paragraph><p>Есть два не документированных параметра <span class=filename>make.conf</span>, которые могут быть полезны для настройки бездискового компьютера с последовательной консолью: <code>BOOT_PXELDR_PROBE_KEYBOARD</code>, и <code>BOOT_PXELDR_ALWAYS_SERIAL</code>.</p></div><div class=paragraph><p>Для использования PXE при загрузке компьютера вам обычно потребуется выбрать параметр <code>Boot from network</code> (загрузка по сети) в настройках BIOS, или нажать функциональную клавишу во время загрузки PC.</p></div></div><div class=sect3><h4 id=_настройка_серверов_tftp_и_nfs>27.6.2.5. Настройка серверов TFTP и NFS<a class=anchor href=#_настройка_серверов_tftp_и_nfs></a></h4><div class=paragraph><p>Если вы используете PXE или Etherboot, настроенные для использования TFTP, вам нужно включить tftpd на файловом сервере:</p></div><div class="exampleblock procedure"><div class=content><div class="olist arabic"><ol class=arabic><li><p>Создайте каталог, файлы которого будет обслуживать tftpd, например, <span class=filename>/tftpboot</span>.</p></li><li><p>Добавьте в ваш <span class=filename>/etc/inetd.conf</span> такую строчку:</p><div class="literalblock programlisting"><div class=content><pre>tftp	dgram	udp	wait	root	/usr/libexec/tftpd	tftpd -l -s /tftpboot</pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Бывает, что некоторым версиям PXE требуется TCP-вариант TFTP. В таком случае добавьте вторую строчку, заменяющую <code>dgram udp</code> на <code>stream tcp</code>.</p></div></td></tr></tbody></table></div></li><li><p>Сообщите inetd о необходимости перечитать свой файл конфигурации. Файл <span class=filename>/etc/rc.conf</span> должен содержать строку <code>inetd_enable="YES"</code> для корректного исполнения команды</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># /etc/rc.d/inetd restart</span></code></pre></div></div></li></ol></div></div></div><div class=paragraph><p>Вы можете поместить каталог <span class=filename>tftpboot</span> в любом месте на сервере. Проверьте, что это местоположение указано как в <span class=filename>inetd.conf</span>, так и в <span class=filename>dhcpd.conf</span>.</p></div><div class=paragraph><p>Во всех случаях, вам также нужно включить NFS и экспортировать соответствующую файловую систему на сервере NFS.</p></div><div class="exampleblock procedure"><div class=content><div class="olist arabic"><ol class=arabic><li><p>Добавьте следующее в <span class=filename>/etc/rc.conf</span>:</p><div class="literalblock programlisting"><div class=content><pre>nfs_server_enable=&#34;YES&#34;</pre></div></div></li><li><p>Экспортируйте файловую систему, в которой расположен корневой каталог для бездисковой рабочей станции, добавив следующую строку в <span class=filename>/etc/exports</span> (подправьте точку монтирования и замените <em>margaux corbieres</em> именами бездисковых рабочих станций):</p><div class="literalblock programlisting"><div class=content><pre>/data/misc -alldirs -ro margaux corbieres</pre></div></div></li><li><p>Заставьте mountd перечитать настроечный файл. На самом деле если вам потребовалось на первом шаге включить NFS в <span class=filename>/etc/rc.conf</span>, то вам нужно будет выполнить перезагрузку.</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># /etc/rc.d/mountd restart</span></code></pre></div></div></li></ol></div></div></div></div><div class=sect3><h4 id=_построение_ядра_для_бездисковой_рабочей_станции>27.6.2.6. Построение ядра для бездисковой рабочей станции<a class=anchor href=#_построение_ядра_для_бездисковой_рабочей_станции></a></h4><div class=paragraph><p>При использовании Etherboot, вам потребуется создать конфигурационный файл ядра для бездискового клиента со следующими параметрами (вдобавок к обычным):</p></div><div class="literalblock programlisting"><div class=content><pre>options     BOOTP          # Use BOOTP to obtain IP address/hostname
options     BOOTP_NFSROOT  # NFS mount root filesystem using BOOTP info</pre></div></div><div class=paragraph><p>Вам может потребоваться использовать <code>BOOTP_NFSV3</code>, <code>BOOT_COMPAT</code> и <code>BOOTP_WIRED_TO</code> (посмотрите файл <span class=filename>NOTES</span>).</p></div><div class=paragraph><p>Эти имена параметров сложились исторически, и могут немного ввести в заблуждение, поскольку включают необязательное использование DHCP и BOOTP в ядре (возможно включение обязательного использования BOOTP или DHCP use).</p></div><div class=paragraph><p>Постройте ядро (обратитесь к <a href=../kernelconfig/#kernelconfig>Настройка ядра FreeBSD</a>) и скопируйте его в каталог, указанный в <span class=filename>dhcpd.conf</span>.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>При использовании PXE, сборка ядра с вышеприведенными параметрами не является совершенно необходимой (хотя желательна). Включение этих параметров приведет к выполнению большинства DHCP запросов во время загрузки ядра, с небольшим риском несоответствия новых значений и значений, полученных <a href="https://man.freebsd.org/cgi/man.cgi?query=pxeboot&amp;sektion=8&amp;format=html">pxeboot(8)</a> в некоторых особых случаях. Преимущество использования в том, что в качестве побочного эффекта будет установлено имя хоста. Иначе вам потребуется установить имя хоста другим методом, например в клиент-специфичном файле <span class=filename>rc.conf</span>.</p></div></td></tr></tbody></table></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Для включения возможности загрузки с Etherboot, в ядро необходимо включить устройство hints. Вам потребуется установить в файле конфигурации следующий параметр (см. файл комментариев <span class=filename>NOTES</span>):</p></div><div class="literalblock programlisting"><div class=content><pre>hints		&#34;GENERIC.hints&#34;</pre></div></div></td></tr></tbody></table></div></div><div class=sect3><h4 id=_подготовка_корневой_файловой_системы>27.6.2.7. Подготовка корневой файловой системы<a class=anchor href=#_подготовка_корневой_файловой_системы></a></h4><div class=paragraph><p>Вам нужно создать корневую файловую систему для бездисковых рабочих станций, в местоположении, заданном как <code>root-path</code> в <span class=filename>dhcpd.conf</span>.</p></div><div class=sect4><h5 id=_использование_процедуры_make_world>27.6.2.7.1. Использование процедуры <code>make world</code><a class=anchor href=#_использование_процедуры_make_world></a></h5><div class=paragraph><p>Этот метод установит новую систему (не только корневую) в <code>DESTDIR</code>. Все, что вам потребуется сделать, это просто выполнить следующий скрипт:</p></div><div class="literalblock programlisting"><div class=content><pre>#!/bin/sh
export DESTDIR=/data/misc/diskless
mkdir -p ${DESTDIR}
cd /usr/src; make buildworld &amp;&amp; make buildkernel
cd /usr/src/etc; make distribution</pre></div></div><div class=paragraph><p>Как только это будет сделано, вам может потребоваться настроить <span class=filename>/etc/rc.conf</span> и <span class=filename>/etc/fstab</span>, помещенные в <code>DESTDIR</code>, в соответствии с вашими потребностями.</p></div></div></div><div class=sect3><h4 id=_настройка_области_подкачки>27.6.2.8. Настройка области подкачки<a class=anchor href=#_настройка_области_подкачки></a></h4><div class=paragraph><p>Если это нужно, то файл подкачки, расположенный на сервере, можно использовать посредством NFS.</p></div><div class=sect4><h5 id=_подкачка_через_nfs>27.6.2.8.1. Подкачка через NFS<a class=anchor href=#_подкачка_через_nfs></a></h5><div class=paragraph><p>На стадии загрузки ядро не поддерживает подкачку через NFS. Подкачка должна быть разрешена при помощи загрузочных скриптов, монтирующих файловую систему, пригодную для записи и создающих на ней файл подкачки. Для создания файла подкачки подходящего размера вы можете выполнить следующие команды:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># dd if=/dev/zero of=/path/to/swapfile bs=1k count=1 oseek=100000</span></code></pre></div></div><div class=paragraph><p>Для активации этого файла подкачки следует добавить в файл <span class=filename>rc.conf</span> строку</p></div><div class="literalblock programlisting"><div class=content><pre>swapfile=/path/to/swapfile</pre></div></div></div></div><div class=sect3><h4 id=_различные_проблемы>27.6.2.9. Различные проблемы<a class=anchor href=#_различные_проблемы></a></h4><div class=sect4><h5 id=_работа_с_usr_доступной_только_для_чтения>27.6.2.9.1. Работа с <span class=filename>/usr</span>, доступной только для чтения<a class=anchor href=#_работа_с_usr_доступной_только_для_чтения></a></h5><div class=paragraph><p>Если бездисковая рабочая станция настроена на запуск X, вам нужно подправить настроечный файл для XDM, который по умолчанию помещает протокол ошибок в <span class=filename>/usr</span>.</p></div></div><div class=sect4><h5 id=_использование_не_freebsd_сервера>27.6.2.9.2. Использование не-FreeBSD сервера<a class=anchor href=#_использование_не_freebsd_сервера></a></h5><div class=paragraph><p>Если сервер с корневой файловой системой работает не под управлением FreeBSD, вам потребуется создать корневую файловую систему на машине FreeBSD, а затем скопировать ее в нужно место, при помощи <code>tar</code> или <code>cpio</code>.</p></div><div class=paragraph><p>В такой ситуации иногда возникают проблемы со специальными файлами в <span class=filename>/dev</span> из-за различной разрядности целых чисел для старшего/младшего чисел. Решением этой проблемы является экспортирование каталога с не-FreeBSD сервера, монтирование его на машине с FreeBSD и использование <a href="https://man.freebsd.org/cgi/man.cgi?query=devfs&amp;sektion=5&amp;format=html">devfs(5)</a> для создания файлов устройств прозрачно для пользователя.</p></div></div></div></div></div></div><div class=sect1><h2 id=network-isdn>27.7. ISDN<a class=anchor href=#network-isdn></a></h2><div class=sectionbody><div class=paragraph><p>Полезным источником информации о технологии ISDN и его аппаратном обеспечении является <a href=http://www.alumni.caltech.edu/~dank/isdn/>Страница Дэна Кегела (Dan Kegel) об ISDN</a>.</p></div><div class=paragraph><p>Быстрое введение в ISDN:</p></div><div class=ulist><ul><li><p>Если вы живёте в Европе, то вам может понадобиться изучить раздел об ISDN-адаптерах.</p></li><li><p>Если вы планируете использовать ISDN в основном для соединений с Интернет через провайдера по коммутируемому, не выделенному соединению, рекомендуется посмотреть информацию о терминальных адаптерах. Это даст вам самую большую гибкость и наименьшее количество проблем при смене провайдера.</p></li><li><p>Если вы объединяете две локальные сети или подключаетесь к Интернет через постоянное ISDN-соединение, рекомендуем остановить свой выбор на отдельном мосте/маршрутизаторе.</p></li></ul></div><div class=paragraph><p>Стоимость является важным фактором при выборе вашего решения. Далее перечислены все возможности от самого дешевого до самого дорогого варианта.</p></div><div class=sect2><h3 id=network-isdn-cards>27.7.1. Адаптеры ISDN<a class=anchor href=#network-isdn-cards></a></h3><div class=paragraph><p>Реализация ISDN во FreeBSD поддерживает только стандарт DSS1/Q.931 (или Евро-ISDN) при помощи пассивных адаптеров. Поддерживаются некоторые активные адаптеры, прошивки которых поддерживают также другие сигнальные протоколы; также сюда включена поддержка адаптеров ISDN Primary Rate (PRI).</p></div><div class=paragraph><p>Пакет программ isdn4bsd позволяет вам подключаться к другим маршрутизаторам ISDN при помощи IP поверх DHLC, либо при помощи синхронного PPP; либо при помощи PPP на уровне ядра с <code>isppp</code>, модифицированного драйвера <a href="https://man.freebsd.org/cgi/man.cgi?query=sppp&amp;sektion=4&amp;format=html">sppp(4)</a>, или при помощи пользовательского <a href="https://man.freebsd.org/cgi/man.cgi?query=ppp&amp;sektion=8&amp;format=html">ppp(8)</a>. При использовании пользовательского <a href="https://man.freebsd.org/cgi/man.cgi?query=ppp&amp;sektion=8&amp;format=html">ppp(8)</a> возможно использование двух и большего числа B-каналов ISDN. Также имеется приложение, работающее как автоответчик, и много утилит, таких, как программный модем на 300 Бод.</p></div><div class=paragraph><p>Во FreeBSD поддерживается все возрастающее число адаптеров ISDN для ПК, и сообщения показывают, что они успешно используются по всей Европе и других частях света.</p></div><div class=paragraph><p>Из пассивных адаптеров ISDN поддерживаются в основном те, которые сделаны на основе микросхем Infineon (бывший Siemens) ISAC/HSCX/IPAC ISDN, а также адаптеры ISDN с микросхемами от Cologne Chip (только для шины ISA), адаптеры PCI с микросхемами Winbond W6692, некоторые адаптеры с набором микросхем Tiger300/320/ISAC и несколько адаптеров, построенных на фирменных наборах микросхем, такие, как AVM Fritz!Card PCI V.1.0 и AVM Fritz!Card PnP.</p></div><div class=paragraph><p>На данный момент из активных адаптеров ISDN поддерживаются AVM B1 (ISA и PCI) адаптеры BRI и AVM T1 PCI адаптеры PRI.</p></div><div class=paragraph><p>Документацию по isdn4bsd можно найти в каталоге <span class=filename>/usr/shared/examples/isdn/</span> вашей системы FreeBSD или на <a href=http://www.freebsd-support.de/i4b/>домашней странице isdn4bsd</a>, на которой также размещены ссылки на советы, замечания по ошибкам и более подробную информацию, например, на <a href=http://people.FreeBSD.org/~hm/>руководство по isdn4bsd</a>.</p></div><div class=paragraph><p>Если вы заинтересованы в добавлении поддержки для различных протоколов ISDN, не поддерживаемых на данный момент адаптеров ISDN для PC или каких-то других усовершенствованиях isdn4bsd, пожалуйста, свяжитесь с Hellmuth Michaelis &lt;<a href=mailto:hm@FreeBSD.org>hm@FreeBSD.org</a>>.</p></div><div class=paragraph><p>Для обсуждения вопросов, связанных с установкой, настройкой и устранением неисправностей isdn4bsd, имеется список рассылки <a href=https://lists.FreeBSD.org/subscription/freebsd-isdn>freebsd-isdn</a>.</p></div><div class=paragraph><p><code>subscribe freebsd-isdn</code></p></div></div><div class=sect2><h3 id=_терминальные_адаптеры_isdn>27.7.2. Терминальные адаптеры ISDN<a class=anchor href=#_терминальные_адаптеры_isdn></a></h3><div class=paragraph><p>Терминальные адаптеры (TA) для ISDN выполняют ту же роль, что и модемы для обычных телефонных линий.</p></div><div class=paragraph><p>Большинство TA используют стандартный набор AT-команд Hayes-модемов, и могут использоваться в качестве простой замены для модемов.</p></div><div class=paragraph><p>TA будут работать точно так же, как и модемы, за исключением скорости соединения и пропускной способности, которые будут гораздо выше, чем у вашего старого модема. Вам потребуется настроить <a href=../ppp-and-slip/#ppp>PPP</a> точно также, как и в случае использования модема. Проверьте, что вы задали скорость работы последовательного порта максимально высокой.</p></div><div class=paragraph><p>Главным преимуществом использования TA для подключения к провайдеру Интернет является возможность использования динамического PPP. Так как пространство адресов IP истощается все больше, большинство провайдеров не хочет больше выдавать вам статический IP-адрес. Большинство же маршрутизаторов не может использовать динамическое выделение IP-адресов.</p></div><div class=paragraph><p>TA полностью полагаются на даемон PPP, который используете из-за его возможностей и стабильности соединения. Это позволяет вам при использовании FreeBSD легко заменить модем на ISDN, если у вас уже настроено соединение PPP. Однако, в тоже время любые проблемы, которые возникают с программой PPP, отражаются и здесь.</p></div><div class=paragraph><p>Если вы хотите максимальной надёжности, используйте <a href=../ppp-and-slip/#ppp>PPP</a> на уровне параметра ядра, а не <a href=../ppp-and-slip/#userppp>пользовательский PPP</a>.</p></div><div class=paragraph><p>Известно, что следующие TA работают с FreeBSD:</p></div><div class=ulist><ul><li><p>Motorola BitSurfer и Bitsurfer Pro</p></li><li><p>Adtran</p></li></ul></div><div class=paragraph><p>Большинство остальных TA, скорее всего, тоже будут работать, производители TA прилагают все усилия для обеспечения поддержки практически всего набора стандартных AT-команд модема.</p></div><div class=paragraph><p>Как и в случае модемов проблемой использования внешнего TA является потребность в хорошем последовательном адаптере на вашем компьютере.</p></div><div class=paragraph><p>Вы должны прочесть учебник <a href=https://docs.freebsd.org/en/articles/serial-uart/>Последовательные устройства во FreeBSD</a> для того, чтобы в деталях понять работу последовательных устройств и осознать различие между асинхронными и синхронными последовательными портами.</p></div><div class=paragraph><p>TA, работающий со стандартным последовательным (асинхронным) портом PC, ограничивает вас скоростью 115.2 Кбит/с, хотя реально у вас соединение на скорости 128 Кбит/с. Чтобы использовать 128 Кбит/с, которые обеспечивает ISDN, полностью, вы должны подключить TA к синхронному последовательному адаптеру.</p></div><div class=paragraph><p>Не обманывайте себя, думая, что покупка встроенного TA поможет избежать проблемы синхронности/асинхронности. Встроенные TA просто уже имеют внутри стандартный последовательный порт PC. Все, что при этом достигается - это экономия дополнительных последовательного кабеля и электрической розетки.</p></div><div class=paragraph><p>Синхронный адаптер с TA по крайней мере так же быстр, как и отдельный маршрутизатор, а если он работает под управлением машины класса 386 с FreeBSD, то это гораздо более гибкое решение.</p></div><div class=paragraph><p>Выбор между использованием синхронного адаптера/TA или отдельного маршрутизатора в большей степени является религиозным вопросом. По этому поводу в списках рассылки была некоторая дискуссия. Рекомендуем поискать в <a href=https://www.FreeBSD.org/search/>архивах</a> обсуждение полностью.</p></div></div><div class=sect2><h3 id=_отдельные_мостымаршрутизаторы_isdn>27.7.3. Отдельные мосты/маршрутизаторы ISDN<a class=anchor href=#_отдельные_мостымаршрутизаторы_isdn></a></h3><div class=paragraph><p>Мосты или маршрутизаторы ISDN не так уж специфичны для FreeBSD или для любой другой операционной системы. Для более подробного описания технологий маршрутизации и работы мостов, пожалуйста, обратитесь к справочникам по сетевым технологиям.</p></div><div class=paragraph><p>В контексте этого раздела термины маршрутизатор и сетевой мост будут использоваться как взаимозаменяемые.</p></div><div class=paragraph><p>Вместе с падением цен на простые мосты/маршрутизаторы ISDN, они становятся все более популярными. Маршрутизатор ISDN представляет собой маленькую коробочку, которая подключается непосредственно в вашу сеть Ethernet, и поддерживает связь с другим мостом/маршрутизатором. Всё программное обеспечение для работы по PPP и другим протоколам встроено в маршрутизатор.</p></div><div class=paragraph><p>Маршрутизатор обладает гораздо большей пропускной способностью, чем стандартный TA, так как он использует полное синхронное соединение ISDN.</p></div><div class=paragraph><p>Основной проблемой с маршрутизаторами и мостами ISDN является то, что их совместная работа с оборудованием других производителей может оказаться под вопросом. Если вы собираетесь подключаться к провайдеру, то вы должны обсудить с ним то, что вам нужно.</p></div><div class=paragraph><p>Если вы планируете объединить два сегмента локальной сети, например, домашнюю сеть с сетью офиса, это самое простое решение с минимальными издержками на обслуживание. Так как вы покупаете оборудование для обоих сторон соединения, то можете быть уверены, что связь будет работать нормально.</p></div><div class=paragraph><p>Например, для соединения домашнего компьютера или сети подразделения к сети центрального офиса, может использоваться такая настройка:</p></div><div class=exampleblock><div class=title>Пример 1. Офис подразделения или домашняя сеть</div><div class=content><div class=paragraph><p>Сеть построена в топологии общей шины на основе 10 base 2 Ethernet ("thinnet" - "тонкий Ethernet"). Подключите маршрутизатор к сетевому кабелю с помощью трансивера AUI/10BT, если это нужно.</p></div><div class=imageblock><div class=content><img src=../../../../images/books/handbook/advanced-networking/isdn-bus.png alt="10 Base 2 Ethernet"></div></div><div class=paragraph><p>Если ваш домашний или удаленный офис представляет собой один компьютер, то для непосредственного подключения к маршрутизатору вы вы можете использовать витую пару с перекрестным соединениям.</p></div></div></div><div class=exampleblock><div class=title>Пример 2. Центральный офис или другая локальная сеть</div><div class=content><div class=paragraph><p>Сеть построена в топологии звезды на основе 10 Base T Ethernet ("витая пара").</p></div><div class=imageblock><div class=content><img src=../../../../images/books/handbook/advanced-networking/isdn-twisted-pair.png alt="Схема сети с ISDN"></div></div></div></div><div class=paragraph><p>Одним большим преимуществом большинства маршрутизаторов/мостов является то, что они позволяют иметь 2 <em>отдельных независимых</em> соединения PPP к 2 различным сайтам <em>одновременно</em>. Это не поддерживается в большинстве TA, кроме специальных (обычно дорогих) моделей, имеющих по два последовательных порта. Не путайте это с балансировкой нагрузки, MPP и так далее.</p></div><div class=paragraph><p>Это может оказаться весьма полезной особенностью, например, если у вас имеется постоянное ISDN-соединение в вашем офисе, и вы хотите им воспользоваться, но не хотите задействовать дополнительный канал ISDN на работе. Маршрутизатор, расположенный в офисе, может использовать выделенное соединение по каналу B (64 Кбит/с) для Интернет, и одновременно другой канал B для отдельного соединения для передачи данных. Второй канал B может использоваться для входящих, исходящих и динамически распределяемых соединений (MPP и так далее) совместно с первым каналом B для повышения пропускной способности.</p></div><div class=paragraph><p>Мост Ethernet также позволяет вам передавать больше, чем просто трафик IP. Вы сможете передавать IPX/SPX и любые другие протоколы, которые вы используете.</p></div></div></div></div><div class=sect1><h2 id=network-natd>27.8. Даемон преобразования сетевых адресов (natd)<a class=anchor href=#network-natd></a></h2><div class=sectionbody><div class=sect2><h3 id=network-natoverview>27.8.1. Обзор<a class=anchor href=#network-natoverview></a></h3><div class=paragraph><p>Даемон преобразования сетевых адресов (Network Address Translation) во FreeBSD, широко известный как <a href="https://man.freebsd.org/cgi/man.cgi?query=natd&amp;sektion=8&amp;format=html">natd(8)</a>, является даемоном, который принимает входящие IP-пакеты, изменяет адрес отправителя на адрес локальной машины и повторно отправляет эти пакеты в потоке исходящих пакетов. <a href="https://man.freebsd.org/cgi/man.cgi?query=natd&amp;sektion=8&amp;format=html">natd(8)</a> делает это, меняя IP-адрес отправителя и порт таким образом, что когда данные принимаются обратно, он может определить расположение источника начальных данных и переслать их машине, которая запрашивала данные изначально.</p></div><div class=paragraph><p>Чаще всего NAT используется для организации так называемого Совместного Использования Интернет.</p></div></div><div class=sect2><h3 id=network-natsetup>27.8.2. Настройка<a class=anchor href=#network-natsetup></a></h3><div class=paragraph><p>Из-за исчерпания пространства адресов в IPv4 и увеличения количества пользователей высокоскоростных каналов связи, таких, как кабельное подключение или DSL, необходимость в решении по Совместному Использованию Интернет растёт. Возможность подключить несколько компьютеров через единственное соединение и IP-адрес делает <a href="https://man.freebsd.org/cgi/man.cgi?query=natd&amp;sektion=8&amp;format=html">natd(8)</a> подходящим решением.</p></div><div class=paragraph><p>Чаще всего у пользователя имеется машина, подключенная к кабельному каналу или каналу DSL с одним IP-адресом и есть желание использовать этот единственный подключенный компьютер для организации доступа в Интернет другим компьютерам в локальной сети.</p></div><div class=paragraph><p>Для этого машина FreeBSD, находящаяся в Интернет, должна выступать в роли шлюза. Эта шлюзовая машина должна иметь два сетевых адаптера-один для подключения к маршрутизатору Интернет, а другой для подключения к ЛВС. Все машины в локальной сети подключаются через сетевой концентратор или коммутатор.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Существует много способов подсоединить локальную сеть к Internet через шлюз FreeBSD. Этот пример показывает шлюз c двумя сетевыми картами.</p></div></td></tr></tbody></table></div><div class=imageblock><div class=content><img src=../../../../images/books/handbook/advanced-networking/natd.png alt="Структура сети"></div></div><div class=paragraph><p>Подобная конфигурация часто используется для совместного использования доступа в Интернет. Одна из подключенных к локальной сети машин подключается к Интернет. Остальные машины работают с Интернет посредством этой "шлюзовой" машины.</p></div></div><div class=sect2><h3 id=network-natdkernconfiguration>27.8.3. Настройка<a class=anchor href=#network-natdkernconfiguration></a></h3><div class=paragraph><p>В файле конфигурации ядра должны присутствовать следующие параметры:</p></div><div class="literalblock programlisting"><div class=content><pre>options IPFIREWALL
options IPDIVERT</pre></div></div><div class=paragraph><p>Дополнительно, если это нужно, можно добавить следующее:</p></div><div class="literalblock programlisting"><div class=content><pre>options IPFIREWALL_DEFAULT_TO_ACCEPT
options IPFIREWALL_VERBOSE</pre></div></div><div class=paragraph><p>В файле <span class=filename>/etc/rc.conf</span> должны быть такие строки:</p></div><div class="literalblock programlisting"><div class=content><pre>gateway_enable=&#34;YES&#34; <i class=conum data-value=1></i><b>(1)</b>
firewall_enable=&#34;YES&#34; <i class=conum data-value=2></i><b>(2)</b>
firewall_type=&#34;OPEN&#34; <i class=conum data-value=3></i><b>(3)</b>
natd_enable=&#34;YES&#34;
natd_interface=&#34;fxp0&#34; <i class=conum data-value=4></i><b>(4)</b>
natd_flags=&#34;&#34; <i class=conum data-value=5></i><b>(5)</b></pre></div></div><div class="colist arabic"><table><tbody><tr><td><i class=conum data-value=1></i><b>1</b></td><td>Указывает машине выступать в качестве шлюза. Выполнение команды <code>sysctl net.inet.ip.forwarding=1</code> приведёт к тому же самому результату.</td></tr><tr><td><i class=conum data-value=2></i><b>2</b></td><td>При загрузке включает использование правил брандмауэра из файла <span class=filename>/etc/rc.firewall</span>.</td></tr><tr><td><i class=conum data-value=3></i><b>3</b></td><td>Здесь задается предопределенный набор правил брандмауэра, который разрешает все. Посмотрите файл <span class=filename>/etc/rc.firewall</span> для нахождения дополнительных типов.</td></tr><tr><td><i class=conum data-value=4></i><b>4</b></td><td>Указывает, через какой интерфейс передавать пакеты (интерфейс, подключенный к Интернет).</td></tr><tr><td><i class=conum data-value=5></i><b>5</b></td><td>Любые дополнительный параметры, передаваемые при запуске даемону <a href="https://man.freebsd.org/cgi/man.cgi?query=natd&amp;sektion=8&amp;format=html">natd(8)</a>.</td></tr></tbody></table></div><div class=paragraph><p>При использовании вышеуказанных параметров в файле <span class=filename>/etc/rc.conf</span> при загрузке будет запущена команда <code>natd -interface fxp0</code>. Эту команду можно запустить и вручную.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Если для передачи <a href="https://man.freebsd.org/cgi/man.cgi?query=natd&amp;sektion=8&amp;format=html">natd(8)</a> набирается слишком много параметров, возможно также использовать конфигурационный файл. В этом случае имя настроечного файла должно быть задано добавлением следующей строки в <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>natd_flags=&#34;-f /etc/natd.conf&#34;</pre></div></div><div class=paragraph><p>Файл <span class=filename>/etc/natd.conf</span> будет содержать перечень конфигурационных параметров, по одному в строке. К примеру, для примера из следующего раздела будет использоваться такой файл:</p></div><div class="literalblock programlisting"><div class=content><pre>redirect_port tcp 192.168.0.2:6667 6667
redirect_port tcp 192.168.0.3:80 80</pre></div></div><div class=paragraph><p>Для получения более полной информации о конфигурационном файле прочтите страницу справки по <a href="https://man.freebsd.org/cgi/man.cgi?query=natd&amp;sektion=8&amp;format=html">natd(8)</a> относительно параметра <code>-f</code>.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Каждой машине и интерфейсу в ЛВС должен быть назначен IP-адрес из адресного пространства частных сетей, как это определено в <a href=ftp://ftp.isi.edu/in-notes/rfc1918.txt>RFC 1918</a>, а в качестве маршрутизатора по умолчанию должен быть задан IP-адрес машины с natd из внутренней сети.</p></div><div class=paragraph><p>Например, клиенты <code>A</code> и <code>B</code> в ЛВС имеют IP-адреса <code>192.168.0.2</code> и <code>192.168.0.3</code>, а интерфейс машины с natd в локальной сети имеет IP-адрес <code>192.168.0.1</code>. Маршрутизатором по умолчанию для клиентов <code>A</code> и <code>B</code> должна быть назначена машина с natd, то есть <code>192.168.0.1</code>. Внешний, или Интернет-интерфейс машины с natd не требует особых настроек для работы <a href="https://man.freebsd.org/cgi/man.cgi?query=natd&amp;sektion=8&amp;format=html">natd(8)</a>.</p></div></div><div class=sect2><h3 id=network-natdport-redirection>27.8.4. Перенаправление портов<a class=anchor href=#network-natdport-redirection></a></h3><div class=paragraph><p>Минусом использования <a href="https://man.freebsd.org/cgi/man.cgi?query=natd&amp;sektion=8&amp;format=html">natd(8)</a> является то, что машины в локальной сети недоступны из Интернет. Клиенты в ЛВС могут выполнять исходящие соединения во внешний мир, но не могут обслуживать входящие. Это является проблемой при запуске служб Интернет на клиентских машинах в локальной сети. Простым решением является перенаправление некоторых портов Интернет машины с natd на клиента локальной сети.</p></div><div class=paragraph><p>Пусть, к примеру, сервер IRC запущен на клиенте <code>A</code>, а Web-сервер работает на клиенте <code>B</code>. Чтобы это работало, соединения, принимаемые на портах 6667 (IRC) и 80 (Web), должны перенаправляться на соответствующие машины.</p></div><div class=paragraph><p>Программе <a href="https://man.freebsd.org/cgi/man.cgi?query=natd&amp;sektion=8&amp;format=html">natd(8)</a> должна быть передана команда <code>-redirect_port</code> с соответствующими параметрами. Синтаксис следующий:</p></div><div class="literalblock programlisting"><div class=content><pre>     -redirect_port proto targetIP:targetPORT[-targetPORT]
                 [aliasIP:]aliasPORT[-aliasPORT]
                 [remoteIP[:remotePORT[-remotePORT]]]</pre></div></div><div class=paragraph><p>В примере выше аргументы должен быть такими:</p></div><div class="literalblock programlisting"><div class=content><pre>    -redirect_port tcp 192.168.0.2:6667 6667
    -redirect_port tcp 192.168.0.3:80 80</pre></div></div><div class=paragraph><p>При этом будут перенаправлены соответствующие порты <em>tcp</em> на клиентские машины в локальной сети.</p></div><div class=paragraph><p>Аргумент <code>-redirect_port</code> может использоваться для указания диапазонов портов, а не конкретного порта. Например, <em>tcp 192.168.0.2:2000-3000 2000-3000</em> будет перенаправлять все соединения, принимаемые на портах от 2000 до 3000, на порты от 2000 до 3000 клиента <code>A</code>.</p></div><div class=paragraph><p>Эти параметры можно указать при непосредственном запуске <a href="https://man.freebsd.org/cgi/man.cgi?query=natd&amp;sektion=8&amp;format=html">natd(8)</a>, поместить их в параметр <code>natd_flags=""</code> файла <span class=filename>/etc/rc.conf</span>, либо передать через конфигурационный файл.</p></div><div class=paragraph><p>Для получение информации о других параметрах настройки обратитесь к справочной странице по <a href="https://man.freebsd.org/cgi/man.cgi?query=natd&amp;sektion=8&amp;format=html">natd(8)</a></p></div></div><div class=sect2><h3 id=network-natdaddress-redirection>27.8.5. Перенаправление адреса<a class=anchor href=#network-natdaddress-redirection></a></h3><div class=paragraph><p>Перенаправление адреса полезно, если имеется несколько адресов IP, и они должны быть на одной машине. В этой ситуации <a href="https://man.freebsd.org/cgi/man.cgi?query=natd&amp;sektion=8&amp;format=html">natd(8)</a> может назначить каждому клиенту ЛВС свой собственный внешний IP-адрес. Затем <a href="https://man.freebsd.org/cgi/man.cgi?query=natd&amp;sektion=8&amp;format=html">natd(8)</a> преобразует исходящие от клиентов локальной сети пакеты, заменяя IP-адреса на соответствующие внешние, и перенаправляет весь трафик, входящий на некоторый IP-адрес, обратно конкретному клиенту локальной сети. Это также называют статическим NAT. К примеру, пусть IP-адреса <code>128.1.1.1</code>, <code>128.1.1.2</code> и <code>128.1.1.3</code> принадлежат шлюзовой машине natd. <code>128.1.1.1</code> может использоваться в качестве внешнего IP-адреса шлюзовой машины natd, тогда как <code>128.1.1.2</code> и <code>128.1.1.3</code> будут перенаправляться обратно к клиентам ЛВС <code>A</code> и <code>B</code>.</p></div><div class=paragraph><p>Синтаксис для <code>-redirect_address</code> таков:</p></div><div class="literalblock programlisting"><div class=content><pre>-redirect_address localIP publicIP</pre></div></div><table class="tableblock frame-none grid-all stretch informaltable"><col style=width:50%><col style=width:50%><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock>localIP</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Внутренний IP-адрес клиента локальной сети.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>publicIP</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Внешний IP, соответствующий клиенту локальной сети.</p></td></tr></tbody></table><div class=paragraph><p>В примере этот аргумент будет выглядеть так:</p></div><div class="literalblock programlisting"><div class=content><pre>-redirect_address 192.168.0.2 128.1.1.2
-redirect_address 192.168.0.3 128.1.1.3</pre></div></div><div class=paragraph><p>Как и для <code>-redirect_port</code>, эти аргументы также помещаются в строку <code>natd_flags=""</code> файла <span class=filename>/etc/rc.conf</span> или передаются через конфигурационный файл. При перенаправлении адресов нет нужды в перенаправлении портов, потому что перенаправляются все данные, принимаемые для конкретного IP-адреса.</p></div><div class=paragraph><p>Внешние IP-адреса машины с natd должны быть активизированы и являться синонимами для внешнего интерфейса. Обратитесь к <a href="https://man.freebsd.org/cgi/man.cgi?query=rc.conf&amp;sektion=5&amp;format=html">rc.conf(5)</a>, чтобы это сделать.</p></div></div></div></div><div class=sect1><h2 id=network-plip>27.9. IP по параллельному порту (PLIP)<a class=anchor href=#network-plip></a></h2><div class=sectionbody><div class=paragraph><p>PLIP позволяет нам работать с TCP/IP по параллельному порту. Это полезно для машин без сетевых адаптеров или для установки на лэптопы. В этом разделе мы обсудим:</p></div><div class=ulist><ul><li><p>создание кабеля для параллельного порта (laplink).</p></li><li><p>Соединение двух компьютеров посредством PLIP.</p></li></ul></div><div class=sect2><h3 id=network-create-parallel-cable>27.9.1. Создание параллельного кабеля<a class=anchor href=#network-create-parallel-cable></a></h3><div class=paragraph><p>Вы можете приобрести кабель для параллельного порта в большинстве магазинов, торгующих комплектующими. Если вы его не найдете, или же просто хотите знать, как он делается, то следующая таблица поможет вам сделать такой кабель из обычного принтерного кабеля для параллельного порта.</p></div><table class="tableblock frame-none grid-all stretch"><caption class=title>Таблица 1. Распайка кабеля для параллельного порта для сетевой работы</caption><col style=width:20%><col style=width:20%><col style=width:20%><col style=width:20%><col style=width:20%><thead><tr><th class="tableblock halign-left valign-top">A-name</th><th class="tableblock halign-left valign-top">A-End</th><th class="tableblock halign-left valign-top">B-End</th><th class="tableblock halign-left valign-top">Описание</th><th class="tableblock halign-left valign-top">Post/Bit</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><div class=literal><pre>....
DATA0
-ERROR
....</pre></div></td><td class="tableblock halign-left valign-top"><div class=literal><pre>....
2
15
....</pre></div></td><td class="tableblock halign-left valign-top"><div class=literal><pre>....
15
2
....</pre></div></td><td class="tableblock halign-left valign-top"><p class=tableblock>Data</p></td><td class="tableblock halign-left valign-top"><div class=literal><pre>....
0/0x01
1/0x08
....</pre></div></td></tr><tr><td class="tableblock halign-left valign-top"><div class=literal><pre>....
DATA1
+SLCT
....</pre></div></td><td class="tableblock halign-left valign-top"><div class=literal><pre>....
3
13
....</pre></div></td><td class="tableblock halign-left valign-top"><div class=literal><pre>....
13
3
....</pre></div></td><td class="tableblock halign-left valign-top"><p class=tableblock>Data</p></td><td class="tableblock halign-left valign-top"><div class=literal><pre>....
0/0x02
1/0x10
....</pre></div></td></tr><tr><td class="tableblock halign-left valign-top"><div class=literal><pre>....
DATA2
+PE
....</pre></div></td><td class="tableblock halign-left valign-top"><div class=literal><pre>....
4
12
....</pre></div></td><td class="tableblock halign-left valign-top"><div class=literal><pre>....
12
4
....</pre></div></td><td class="tableblock halign-left valign-top"><p class=tableblock>Data</p></td><td class="tableblock halign-left valign-top"><div class=literal><pre>....
0/0x04
1/0x20
....</pre></div></td></tr><tr><td class="tableblock halign-left valign-top"><div class=literal><pre>....
DATA3
-ACK
....</pre></div></td><td class="tableblock halign-left valign-top"><div class=literal><pre>....
5
10
....</pre></div></td><td class="tableblock halign-left valign-top"><div class=literal><pre>....
10
5
....</pre></div></td><td class="tableblock halign-left valign-top"><p class=tableblock>Strobe</p></td><td class="tableblock halign-left valign-top"><div class=literal><pre>....
0/0x08
1/0x40
....</pre></div></td></tr><tr><td class="tableblock halign-left valign-top"><div class=literal><pre>....
DATA4
BUSY
....</pre></div></td><td class="tableblock halign-left valign-top"><div class=literal><pre>....
6
11
....</pre></div></td><td class="tableblock halign-left valign-top"><div class=literal><pre>....
11
6
....</pre></div></td><td class="tableblock halign-left valign-top"><p class=tableblock>Data</p></td><td class="tableblock halign-left valign-top"><div class=literal><pre>....
0/0x10
1/0x80
....</pre></div></td></tr><tr><td class="tableblock halign-left valign-top"><div class=literal><pre>GND</pre></div></td><td class="tableblock halign-left valign-top"><div class=literal><pre>18-25</pre></div></td><td class="tableblock halign-left valign-top"><div class=literal><pre>18-25</pre></div></td><td class="tableblock halign-left valign-top"><p class=tableblock>GND</p></td><td class="tableblock halign-left valign-top"><div class=literal><pre>-</pre></div></td></tr></tbody></table></div><div class=sect2><h3 id=network-plip-setup>27.9.2. Настройка PLIP<a class=anchor href=#network-plip-setup></a></h3><div class=paragraph><p>Прежде всего вы должны найти laplink-кабель. Затем удостоверьтесь, что на обоих компьютерах в ядро включена поддержка драйвера <a href="https://man.freebsd.org/cgi/man.cgi?query=lpt&amp;sektion=4&amp;format=html">lpt(4)</a>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># grep lp /var/run/dmesg.boot</span>
lpt0: &lt;Printer&gt; on ppbus0
lpt0: Interrupt-driven port</code></pre></div></div><div class=paragraph><p>Управление параллельным портом должно выполняться по прерываниям. Файл <span class=filename>/boot/device.hints</span> должен содержать следующие строки:</p></div><div class="literalblock programlisting"><div class=content><pre>hint.ppc.0.at=&#34;isa&#34;
hint.ppc.0.irq=&#34;7&#34;</pre></div></div><div class=paragraph><p>Затем проверьте, что файл конфигурации ядра имеет строку <code>device plip</code>, или загружен ли модуль ядра <span class=filename>plip.ko</span>. В обоих случаях интерфейс работы с сетью по параллельному порту должен присутствовать на момент использования команды <a href="https://man.freebsd.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;format=html">ifconfig(8)</a>.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig plip0</span>
plip0: <span class=nv>flags</span><span class=o>=</span>8810&lt;POINTOPOINT,SIMPLEX,MULTICAST&gt; mtu 1500</code></pre></div></div><div class=paragraph><p>Подключите кабель laplink к параллельным интерфейсам на обоих компьютерах.</p></div><div class=paragraph><p>Настройте параметры сетевого интерфейса с обеих сторон, работая как пользователь <code>root</code>. К примеру, если вы хотите соединить хост <code>host1</code>, на котором работает FreeBSD 4.X, с хостом <code>host2</code> под управлением FreeBSD 5.X:</p></div><div class="literalblock programlisting"><div class=content><pre>                 host1 &lt;-----&gt; host2
IP Address    10.0.0.1      10.0.0.2</pre></div></div><div class=paragraph><p>Настройте интерфейс на машине <code>host1</code>, выполнив:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig plip0 10.0.0.1 10.0.0.2</span></code></pre></div></div><div class=paragraph><p>Настройте интерфейс на машине <code>host2</code>, выполнив:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig lp0 10.0.0.2 10.0.0.1</span></code></pre></div></div><div class=paragraph><p>Теперь вы должны получить работающее соединение. Пожалуйста, прочтите страницы руководства по <a href="https://man.freebsd.org/cgi/man.cgi?query=lp&amp;sektion=4&amp;format=html">lp(4)</a> и <a href="https://man.freebsd.org/cgi/man.cgi?query=lpt&amp;sektion=4&amp;format=html">lpt(4)</a> для выяснения деталей.</p></div><div class=paragraph><p>Вы должны также добавить оба хоста в <span class=filename>/etc/hosts</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>127.0.0.1               localhost.my.domain localhost
10.0.0.1                host1.my.domain host1
10.0.0.2                host2.my.domain</pre></div></div><div class=paragraph><p>Чтобы проверить работу соединения, перейдите к каждому хосту и выполните тестирование соединения с другой машиной посредством команды ping. К примеру, на машине <code>host1</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig lp0</span>
lp0: <span class=nv>flags</span><span class=o>=</span>8851&lt;UP,POINTOPOINT,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500
	inet 10.0.0.1 <span class=nt>--</span><span class=o>&gt;</span> 10.0.0.2 netmask 0xff000000
<span class=c># netstat -r</span>
Routing tables

Internet:
Destination        Gateway          Flags     Refs     Use      Netif Expire
host2              host1              UH          0       0       lp0
<span class=c># ping -c 4 host2</span>
PING host2 <span class=o>(</span>10.0.0.2<span class=o>)</span>: 56 data bytes
64 bytes from 10.0.0.2: <span class=nv>icmp_seq</span><span class=o>=</span>0 <span class=nv>ttl</span><span class=o>=</span>255 <span class=nb>time</span><span class=o>=</span>2.774 ms
64 bytes from 10.0.0.2: <span class=nv>icmp_seq</span><span class=o>=</span>1 <span class=nv>ttl</span><span class=o>=</span>255 <span class=nb>time</span><span class=o>=</span>2.530 ms
64 bytes from 10.0.0.2: <span class=nv>icmp_seq</span><span class=o>=</span>2 <span class=nv>ttl</span><span class=o>=</span>255 <span class=nb>time</span><span class=o>=</span>2.556 ms
64 bytes from 10.0.0.2: <span class=nv>icmp_seq</span><span class=o>=</span>3 <span class=nv>ttl</span><span class=o>=</span>255 <span class=nb>time</span><span class=o>=</span>2.714 ms

<span class=nt>---</span> host2 ping statistics <span class=nt>---</span>
4 packets transmitted, 4 packets received, 0% packet loss
round-trip min/avg/max/stddev <span class=o>=</span> 2.530/2.643/2.774/0.103 ms</code></pre></div></div></div></div></div><div class=sect1><h2 id=network-ipv6>27.10. IPv6<a class=anchor href=#network-ipv6></a></h2><div class=sectionbody><div class=paragraph><p>IPv6 (также называемый IPng "IP next generation" - следующее поколение IP) является новой версией широко известного протокола IP (называемого также IPv4). Как и другие современные системы *BSD, FreeBSD включает эталонную реализацию IPv6 от KAME. Так что система FreeBSD поставляется со всем, что вам нужно для экспериментирования с IPv6. Этот раздел посвящён настройке и запуску в работу IPv6.</p></div><div class=paragraph><p>В начале 1990-х люди стали беспокоиться о быстро иссякающем адресном пространстве IPv4. Принимая во внимание темпы роста Интернет, имелись основные проблемы:</p></div><div class=ulist><ul><li><p>Нехватка адресов. Сегодня это не такая большая проблема, так как стали применяться адресные пространства для частных сетей (RFC1918) (<code>10.0.0.0/8</code>, <code>172.16.0.0/12</code> и <code>192.168.0.0/24</code>) и технология преобразования сетевых адресов (NAT - Network Address Translation).</p></li><li><p>Таблицы маршрутов становятся чересчур большими. Это всё ещё является проблемой сегодня.</p></li></ul></div><div class=paragraph><p>IPv6 решает эти и многие другие вопросы:</p></div><div class=ulist><ul><li><p>128-битное адресное пространство. Другими словами, теоретически доступны 340,282,366,920,938,463,463,374,607,431,768,211,456 адреса. Это означает плотность примерно в 6.67 * 10^27 адресов IPv6 на квадратный метр нашей планеты.</p></li><li><p>Маршрутизаторы будут хранить в своих таблицах только агрегированные адреса сетей, что уменьшает средний размер таблицы маршрутизации до 8192 записей.</p></li></ul></div><div class=paragraph><p>Имеется также множество других полезных особенностей IPv6, таких, как:</p></div><div class=ulist><ul><li><p>Автоматическая настройка адреса (<a href=http://www.ietf.org/rfc/rfc2462.txt>RFC2462</a>)</p></li><li><p>Групповые адреса ("один к нескольким из многих")</p></li><li><p>Обязательные адреса множественной рассылки</p></li><li><p>IPsec (IP security - безопасный IP)</p></li><li><p>Упрощённая структура заголовка</p></li><li><p>Мобильный IP</p></li><li><p>Механизмы преобразования IPv6-в-IPv4</p></li></ul></div><div class=paragraph><p>Для получения дополнительной информации посмотрите:</p></div><div class=ulist><ul><li><p>Обзор IPv6 на сайте <a href=http://playground.sun.com/pub/ipng/html/ipng-main.html>playground.sun.com</a></p></li><li><p><a href=http://www.kame.net>KAME.net</a></p></li><li><p><a href=http://www.6bone.net>6bone.net</a></p></li></ul></div><div class=sect2><h3 id=_основы_адресации_ipv6>27.10.1. Основы адресации IPv6<a class=anchor href=#_основы_адресации_ipv6></a></h3><div class=paragraph><p>Существуют различные типы адресов IPv6: одноадресные (Unicast), групповые (Anycast) и многоадресные (Multicast).</p></div><div class=paragraph><p>Адреса типа Unicast хорошо всем известны. Пакет, посланный на такой адрес, достигает в точности интерфейса, который этому адресу соответствует.</p></div><div class=paragraph><p>Адреса типа Anycast синтаксически неотличимы от адресов Unicast, но они адресуют группу интерфейсов. Пакет, направленный такому адресу, попадёт в ближайший (согласно метрике маршрутизатора) интерфейс. Адреса Anycast могут использоваться только маршрутизаторами.</p></div><div class=paragraph><p>Адреса типа Multicast идентифицируют группу интерфейсов. Пакет, посланный на такой адрес, достигнет всех интерфейсов, привязанных к группе многоадресного вещания.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Широковещательные адреса IPv4 (обычно <code>xxx.xxx.xxx.255</code>) выражаются адресами многоадресного вещания IPv6.</p></div></td></tr></tbody></table></div><table class="tableblock frame-none grid-all stretch"><caption class=title>Таблица 2. Зарезервированные адреса IPv6</caption><col style=width:25%><col style=width:25%><col style=width:25%><col style=width:25%><thead><tr><th class="tableblock halign-left valign-top">IPv6 адрес</th><th class="tableblock halign-left valign-top">Длина префикса (биты)</th><th class="tableblock halign-left valign-top">Описание</th><th class="tableblock halign-left valign-top">Заметки</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>::</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>128 бит</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>нет описания</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>cf. <code>0.0.0.0</code> в IPv4</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>::1</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>128 бит</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>loopback адрес</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>cf. <code>127.0.0.1</code> в IPv4</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>::00:xx:xx:xx:xx</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>96 бит</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>встроенный IPv4</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Нижние 32 бита это адрес IPv4. Также называется "IPv4 совместимым IPv6 адресом"</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>::ff:xx:xx:xx:xx</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>96 бит</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Адрес IPv6, отображенный на IPv4</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Нижние 32 бита это адрес IPv4. Для хостов, не поддерживающих IPv6.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>fe80::</code> - <code>feb::</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>10 бит</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>link-local</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>cf. loopback адрес в IPv4</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>fec0::</code> - <code>fef::</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>10 бит</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>site-local</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>ff::</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>8 бит</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>широковещательный</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>001</code> (основание 2)</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>3 бит</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>global unicast</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Все global unicast адреса присваиваются из этого пула. Первые три бита "001".</p></td></tr></tbody></table></div><div class=sect2><h3 id=_чтение_адресов_ipv6>27.10.2. Чтение адресов IPv6<a class=anchor href=#_чтение_адресов_ipv6></a></h3><div class=paragraph><p>Каноническая форма представляется в виде <code>x:x:x:x:x:x:x:x</code>, где каждый символ "x" является 16-разрядным числом в шестнадцатеричной форме. К примеру, <code>FEBC:A574:382B:23C1:AA49:4592:4EFE:9982</code></p></div><div class=paragraph><p>Часто в адресе присутствуют длинные строчки, заполненные нулями, поэтому одна такая последовательность на адрес может быть сокращена до "::". Кроме того, до трех ведущих "0" на шестнадцатеричную четверку могут быть пропущены. К примеру, <code>fe80::1</code> соответствует канонической форме <code>fe80:0000:0000:0000:0000:0000:0000:0001</code>.</p></div><div class=paragraph><p>В третьей форме последние 32 бита записываются в широко известном (десятичном) стиле IPv4 с точками "." в качестве разделителей. Например, <code>f2002::10.0.0.1</code> соответствует (шестнадцатеричному) каноническому представлению <code>2002:0000:0000:0000:0000:0000:0a00:0001</code>, которое, в свою очередь, равнозначно записи <code>2002::a00:1</code>.</p></div><div class=paragraph><p>Теперь читатель должен понять следующую запись:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig</span></code></pre></div></div><div class="literalblock programlisting"><div class=content><pre>rl0: flags=8943&lt;UP,BROADCAST,RUNNING,PROMISC,SIMPLEX,MULTICAST&gt; mtu 1500
         inet 10.0.0.10 netmask 0xffffff00 broadcast 10.0.0.255
         inet6 fe80::200:21ff:fe03:8e1%rl0 prefixlen 64 scopeid 0x1
         ether 00:00:21:03:08:e1
         media: Ethernet autoselect (100baseTX )
         status: active</pre></div></div><div class=paragraph><p><code>fe80::200:21ff:fe03:8e1%rl0</code> является автоматически настроенным локальным адресом. Он генерируется из MAC адреса в процессе автоматической конфигурации.</p></div><div class=paragraph><p>Для получения дополнительной информации о структуре адресов IPv6 обратитесь к <a href=http://www.ietf.org/rfc/rfc3513.txt>RFC3513</a>.</p></div></div><div class=sect2><h3 id=_настройка_подключения>27.10.3. Настройка подключения<a class=anchor href=#_настройка_подключения></a></h3><div class=paragraph><p>На данный момент существуют четыре способа подключиться к другим хостам и сетям IPv6:</p></div><div class=ulist><ul><li><p>Подключиться к экспериментальному 6bone</p></li><li><p>Получить сеть IPv6 от вышестоящего провайдера. Для получения рекомендаций обратитесь к вашему провайдеру Интернет.</p></li><li><p>Туннелировать посредством 6-в-4 (<a href=http://www.ietf.org/rfc/rfc3068.txt>RFC3068</a>)</p></li><li><p>Использовать порт <a class=package href=https://cgit.freebsd.org/ports/tree/net/freenet6/>net/freenet6</a>, если вы используете коммутируемое соединение.</p></li></ul></div><div class=paragraph><p>Здесь мы будем рассматривать подключение к 6bone, так как на данный момент это является самым популярным способом.</p></div><div class=paragraph><p>Сначала взгляните на сайт <a href=http://www.6bone.net/>6bone</a> и найдите ближайшую к вам точку подключения к 6bone. Напишите ответственному и при некоторой удаче вам дадут инструкции по настройке соединения. Обычно это касается настройки туннеля GRE (gif).</p></div><div class=paragraph><p>Вот типичный пример настройки туннеля <a href="https://man.freebsd.org/cgi/man.cgi?query=gif&amp;sektion=4&amp;format=html">gif(4)</a>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig gif0 create</span>
<span class=c># ifconfig gif0</span>
gif0: <span class=nv>flags</span><span class=o>=</span>8010&lt;POINTOPOINT,MULTICAST&gt; mtu 1280
<span class=c># ifconfig gif0 tunnel MY_IPv4_ADDR  MY_IPv4_REMOTE_TUNNEL_ENDPOINT_ADDR</span>
<span class=c># ifconfig gif0 inet6 alias MY_ASSIGNED_IPv6_TUNNEL_ENDPOINT_ADDR MY_IPv6_REMOTE_TUNNEL_ENDPOINT_ADDR</span></code></pre></div></div><div class=paragraph><p>Замените слова, написанные заглавными буквами, информацией, которую вам дал вышестоящий узел 6bone.</p></div><div class=paragraph><p>При этом установится туннель. Проверьте работу туннеля утилитой <a href="https://man.freebsd.org/cgi/man.cgi?query=ping6&amp;sektion=8&amp;format=html">ping6(8)</a> с адресом <code>ff02::1%gif0</code>. Вы должны получить два положительных ответа.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Если вы заинтригованы адресом <code>ff02:1%gif0</code>, скажем, что это адрес многоадресного вещания. <code>%gif0</code> указывает на использование такого адреса с сетевым интерфейсом <span class=filename>gif0</span>. Так как мы выполняем <code>ping</code> над адресом многоадресного вещания, то другая сторона туннеля также должна ответить.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Теперь настройка маршрута к вашей вышестоящей точке подключения 6bone должна быть весьма проста:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># route add -inet6 default -interface gif0</span>
<span class=c># ping6 -n MY_UPLINK</span></code></pre></div></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># traceroute6 www.jp.FreeBSD.org</span>
<span class=o>(</span>3ffe:505:2008:1:2a0:24ff:fe57:e561<span class=o>)</span> from 3ffe:8060:100::40:2, 30 hops max, 12 byte packets
     1  atnet-meta6  14.147 ms  15.499 ms  24.319 ms
     2  6bone-gw2-ATNET-NT.ipv6.tilab.com  103.408 ms  95.072 ms <span class=k>*</span>
     3  3ffe:1831:0:ffff::4  138.645 ms  134.437 ms  144.257 ms
     4  3ffe:1810:0:6:290:27ff:fe79:7677  282.975 ms  278.666 ms  292.811 ms
     5  3ffe:1800:0:ff00::4  400.131 ms  396.324 ms  394.769 ms
     6  3ffe:1800:0:3:290:27ff:fe14:cdee  394.712 ms  397.19 ms  394.102 ms</code></pre></div></div><div class=paragraph><p>Эта выдача будет отличаться от машины к машине. Теперь вы должны суметь достигнуть сайта IPv6 <a href=http://www.kame.net>www.kame.net</a> и увидеть танцующую черепаху - в случае, если ваш браузер поддерживает IPv6, как, например, <a class=package href=https://cgit.freebsd.org/ports/tree/www/mozilla/>www/mozilla</a> или Konqueror, который входит в <a class=package href=https://cgit.freebsd.org/ports/tree/x11/kdebase3/>x11/kdebase3</a>, или <a class=package href=https://cgit.freebsd.org/ports/tree/www/epiphany/>www/epiphany</a>.</p></div></div><div class=sect2><h3 id=_dns_в_мире_ipv6>27.10.4. DNS в мире IPv6<a class=anchor href=#_dns_в_мире_ipv6></a></h3><div class=paragraph><p>Для IPv6 использовались два типа записей DNS. IETF объявил записи A6 устаревшими. Стандартом на данный момент являются записи AAAA.</p></div><div class=paragraph><p>Использование записей AAAA достаточно просто. Назначение вашему имени хоста нового адреса IPv6 достигается просто добавлением:</p></div><div class="literalblock programlisting"><div class=content><pre>MYHOSTNAME           AAAA    MYIPv6ADDR</pre></div></div><div class=paragraph><p>к вашему первичному файлу DNS зоны. В случае, если вы не обслуживаете собственные зоны DNS, обратитесь к вашему провайдеру DNS. Имеющиеся версии bind (версий 8.3 и 9) и <a class=package href=https://cgit.freebsd.org/ports/tree/dns/djbdns/>dns/djbdns</a> (с патчем IPv6) поддерживают записи AAAA.</p></div></div><div class=sect2><h3 id=_внесение_необходимых_изменений_в_etcrc_conf>27.10.5. Внесение необходимых изменений в <span class=filename>/etc/rc.conf</span><a class=anchor href=#_внесение_необходимых_изменений_в_etcrc_conf></a></h3><div class=sect3><h4 id=_настройки_клиентов_ipv6>27.10.5.1. Настройки клиентов IPv6<a class=anchor href=#_настройки_клиентов_ipv6></a></h4><div class=paragraph><p>Эти установки помогут вам настроить компьютер, который будет работать в сети как клиент, а не как маршрутизатор. Для включения настройки интерфейсов через <a href="https://man.freebsd.org/cgi/man.cgi?query=rtsol&amp;sektion=8&amp;format=html">rtsol(8)</a> при загрузке, все, что вам потребуется, это добавить следующую строку:</p></div><div class="literalblock programlisting"><div class=content><pre>ipv6_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>Для статического присвоения IP адреса, такого как <code>2001:471:1f11:251:290:27ff:fee0:2093</code>, интерфейсу <span class=filename>fxp0</span>, добавьте:</p></div><div class="literalblock programlisting"><div class=content><pre>ipv6_ifconfig_fxp0=&#34;2001:471:1f11:251:290:27ff:fee0:2093&#34;</pre></div></div><div class=paragraph><p>Для назначения маршрутизатором по умолчанию <code>2001:471:1f11:251::1</code>, добавьте следующую строку к <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>ipv6_defaultrouter=&#34;2001:471:1f11:251::1&#34;</pre></div></div></div><div class=sect3><h4 id=_настройки_маршрутизаторашлюза_ipv6>27.10.5.2. Настройки маршрутизатора/шлюза IPv6<a class=anchor href=#_настройки_маршрутизаторашлюза_ipv6></a></h4><div class=paragraph><p>Этот раздел поможет вам использовать инструкции, которые выдал провайдер туннеля, например, <a href=http://www.6bone.net/>6bone</a>, и сделать эти настройки постоянными. Для восстановления туннеля при загрузке системы используйте в <span class=filename>/etc/rc.conf</span> нижеприведенные настройки.</p></div><div class=paragraph><p>Задайте список туннельных интерфейсов (Generic Tunneling interfaces), которые необходимо настроить, например <span class=filename>gif0</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>gif_interfaces=&#34;gif0&#34;</pre></div></div><div class=paragraph><p>Для настройки интерфейса с локальным подключением на <em>MY_IPv4_ADDR</em> к удаленной точке <em>REMOTE_IPv4_ADDR</em>:</p></div><div class="literalblock programlisting"><div class=content><pre>gifconfig_gif0=&#34;MY_IPv4_ADDR REMOTE_IPv4_ADDR&#34;</pre></div></div><div class=paragraph><p>Для включения IPv6 адреса, который был вам присвоен для использования в подключении к туннелю IPv6, добавьте:</p></div><div class="literalblock programlisting"><div class=content><pre>ipv6_ifconfig_gif0=&#34;MY_ASSIGNED_IPv6_TUNNEL_ENDPOINT_ADDR&#34;</pre></div></div><div class=paragraph><p>Затем все, что вам потребуется сделать, это добавить маршрут по умолчанию для IPv6. Это другая сторона туннеля IPv6:</p></div><div class="literalblock programlisting"><div class=content><pre>ipv6_defaultrouter=&#34;MY_IPv6_REMOTE_TUNNEL_ENDPOINT_ADDR&#34;</pre></div></div></div><div class=sect3><h4 id=_настройка_туннелирования_ipv6>27.10.5.3. Настройка туннелирования IPv6<a class=anchor href=#_настройка_туннелирования_ipv6></a></h4><div class=paragraph><p>Если сервер будет обеспечивать маршрутизацию между вашей сетью и остальным миром, то в файле <span class=filename>/etc/rc.conf</span> понадобится следующая строка:</p></div><div class="literalblock programlisting"><div class=content><pre>ipv6_gateway_enable=&#34;YES&#34;</pre></div></div></div></div><div class=sect2><h3 id=_распространение_маршрутов_и_автоматическая_настройка_хостов>27.10.6. Распространение маршрутов и автоматическая настройка хостов<a class=anchor href=#_распространение_маршрутов_и_автоматическая_настройка_хостов></a></h3><div class=paragraph><p>Этот раздел поможет вам настроить <a href="https://man.freebsd.org/cgi/man.cgi?query=rtadvd&amp;sektion=8&amp;format=html">rtadvd(8)</a> для распространения маршрута IPv6 по умолчанию.</p></div><div class=paragraph><p>Для включения <a href="https://man.freebsd.org/cgi/man.cgi?query=rtadvd&amp;sektion=8&amp;format=html">rtadvd(8)</a> вам понадобится добавить в <span class=filename>/etc/rc.conf</span> следующую строку:</p></div><div class="literalblock programlisting"><div class=content><pre>rtadvd_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>Важно указать интерфейс, на котором выполняется запрос маршрутизатора IPv6. Например, для указания <a href="https://man.freebsd.org/cgi/man.cgi?query=rtadvd&amp;sektion=8&amp;format=html">rtadvd(8)</a> использовать <span class=filename>fxp0</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>rtadvd_interfaces=&#34;fxp0&#34;</pre></div></div><div class=paragraph><p>Теперь мы должны создать файл настройки, <span class=filename>/etc/rtadvd.conf</span>. Вот пример:</p></div><div class="literalblock programlisting"><div class=content><pre>fxp0:\
        :addrs#1:addr=&#34;2001:471:1f11:246::&#34;:prefixlen#64:tc=ether:</pre></div></div><div class=paragraph><p>Замените <span class=filename>fxp0</span> на интерфейс, который вы будете использовать.</p></div><div class=paragraph><p>Затем, замените <code>2001:471:1f11:246::</code> на префикс вашего размещения.</p></div><div class=paragraph><p>Если у вас выделенная подсеть <code>/64</code>, больше ничего менять не потребуется. Иначе, вам потребуется изменить <code>prefixlen#</code> на корректное значение.</p></div></div></div></div><div class=sect1><h2 id=network-atm>27.11. Асинхронный режим передачи (ATM)<a class=anchor href=#network-atm></a></h2><div class=sectionbody><div class=sect2><h3 id=_классическая_настройка_ip_через_atm_pvc>27.11.1. Классическая настройка IP через ATM (PVC)<a class=anchor href=#_классическая_настройка_ip_через_atm_pvc></a></h3><div class=paragraph><p>Классический IP через ATM (CLIP) это простейший метод использования асинхронного режима передачи (Asynchronous Transfer Mode, ATM) с IP. Он может быть использован с коммутируемыми подключениями (switched connections, SVC) и с постоянными подключениями (permanent connections, PVC). В этом разделе будет описано как настроить сеть на основе PVC.</p></div><div class=sect3><h4 id=_полностью_объединенные_конфигурации>27.11.1.1. Полностью объединенные конфигурации<a class=anchor href=#_полностью_объединенные_конфигурации></a></h4><div class=paragraph><p>Первый метод для настройки CLIP с PVC это подключение каждого компьютера к каждому в сети с выделенным PVC. Хотя настройка проста, она непрактична для большого количества компьютеров. В примере предполагается, что в сети есть четыре компьютера, каждый подключенный к ATM сети с помощью карты ATM адаптера. Первый шаг это планирование IP адресов и ATM подключений между компьютерами. Мы используем:</p></div><table class="tableblock frame-none grid-all stretch informaltable"><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">Хост</th><th class="tableblock halign-left valign-top">IP адрес</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>hostA</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>192.168.173.1</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>hostB</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>192.168.173.2</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>hostC</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>192.168.173.3</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>hostD</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>192.168.173.4</code></p></td></tr></tbody></table><div class=paragraph><p>Для сборки полностью объединенной сети нам потребуется по одному ATM соединению между каждой парой компьютеров:</p></div><table class="tableblock frame-none grid-all stretch informaltable"><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">Компьютеры</th><th class="tableblock halign-left valign-top">VPI.VCI соединение</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>hostA</code> - <code>hostB</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>0.100</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>hostA</code> - <code>hostC</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>0.101</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>hostA</code> - <code>hostD</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>0.102</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>hostB</code> - <code>hostC</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>0.103</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>hostB</code> - <code>hostD</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>0.104</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>hostC</code> - <code>hostD</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>0.105</p></td></tr></tbody></table><div class=paragraph><p>Значения VPI и VCI на каждом конце соединения конечно могут отличаться, но для упрощения мы предполагаем, что они одинаковы. Затем нам потребуется настроить ATM интерфейсы на каждом хосте:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>hostA# ifconfig hatm0 192.168.173.1 up
hostB# ifconfig hatm0 192.168.173.2 up
hostC# ifconfig hatm0 192.168.173.3 up
hostD# ifconfig hatm0 192.168.173.4 up</code></pre></div></div><div class=paragraph><p>предполагая, что ATM интерфейс называется <span class=filename>hatm0</span> на всех хостах. Теперь PVC необходимо настроить на <code>hostA</code> (мы предполагаем, что ATM коммутаторы уже настроены, вам необходимо свериться с руководством на коммутатор за информацией по настройке).</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>hostA# atmconfig natm add 192.168.173.2 hatm0 0 100 llc/snap ubr
hostA# atmconfig natm add 192.168.173.3 hatm0 0 101 llc/snap ubr
hostA# atmconfig natm add 192.168.173.4 hatm0 0 102 llc/snap ubr

hostB# atmconfig natm add 192.168.173.1 hatm0 0 100 llc/snap ubr
hostB# atmconfig natm add 192.168.173.3 hatm0 0 103 llc/snap ubr
hostB# atmconfig natm add 192.168.173.4 hatm0 0 104 llc/snap ubr

hostC# atmconfig natm add 192.168.173.1 hatm0 0 101 llc/snap ubr
hostC# atmconfig natm add 192.168.173.2 hatm0 0 103 llc/snap ubr
hostC# atmconfig natm add 192.168.173.4 hatm0 0 105 llc/snap ubr

hostD# atmconfig natm add 192.168.173.1 hatm0 0 102 llc/snap ubr
hostD# atmconfig natm add 192.168.173.2 hatm0 0 104 llc/snap ubr
hostD# atmconfig natm add 192.168.173.3 hatm0 0 105 llc/snap ubr</code></pre></div></div><div class=paragraph><p>Конечно, вместо UBR может быть использован другой тип, если ATM адаптер поддерживает это. В этом случае имя типа дополняется параметрами трафика. Помощь по <a href="https://man.freebsd.org/cgi/man.cgi?query=atmconfig&amp;sektion=8&amp;format=html">atmconfig(8)</a> может быть получена командой:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># atmconfig help natm add</span></code></pre></div></div><div class=paragraph><p>или на странице справочника <a href="https://man.freebsd.org/cgi/man.cgi?query=atmconfig&amp;sektion=8&amp;format=html">atmconfig(8)</a>.</p></div><div class=paragraph><p>Та же настройка может быть выполнена через <span class=filename>/etc/rc.conf</span>. Для <code>hostA</code> это будет выглядеть примерно так:</p></div><div class="literalblock programlisting"><div class=content><pre>network_interfaces=&#34;lo0 hatm0&#34;
ifconfig_hatm0=&#34;inet 192.168.173.1 up&#34;
natm_static_routes=&#34;hostB hostC hostD&#34;
route_hostB=&#34;192.168.173.2 hatm0 0 100 llc/snap ubr&#34;
route_hostC=&#34;192.168.173.3 hatm0 0 101 llc/snap ubr&#34;
route_hostD=&#34;192.168.173.4 hatm0 0 102 llc/snap ubr&#34;</pre></div></div><div class=paragraph><p>Текущий статус всех маршрутов CLIP может быть получен командой:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>hostA# atmconfig natm show</code></pre></div></div></div></div></div></div></div><hr><div class=last-modified><p><strong>Изменено</strong>: 9 марта 2024 г. by <a href="https://cgit.freebsd.org/doc/commit/?id=6199af92e7" target=_blank>Danilo G. Baio</a></p></div><div class=buttons><div class=prev><i class="fa fa-angle-left" aria-hidden=true title=Назад></i><div class=container><a href=http://172.16.201.134:1313/ru/books/handbook/firewalls class=direction>Назад</a></div></div><div class=home><i class="fa fa-home" aria-hidden=true title=Главная></i><div class=container><a href=../ class=direction>Главная</a></div></div><div class=next><div class=container><a href=http://172.16.201.134:1313/ru/books/handbook/partv class=direction>Далее</a></div><i class="fa fa-angle-right" aria-hidden=true title=Далее></i></div></div><label class="hidden book-menu-overlay" for=menu-control></label></div><aside class=toc><div class=toc-content><h3>Содержание</h3><nav id=TableOfContents><ul><li><a href=#advanced-networking-synopsis>27.1. Краткий обзор</a></li><li><a href=#network-routing>27.2. Сетевые шлюзы и маршруты</a></li><li><a href=#network-wireless>27.3. Беспроводные сети</a></li><li><a href=#network-bluetooth>27.4. Bluetooth</a></li><li><a href=#network-bridging>27.5. Мосты</a></li><li><a href=#network-diskless>27.6. Работа с бездисковыми станциями</a></li><li><a href=#network-isdn>27.7. ISDN</a></li><li><a href=#network-natd>27.8. Даемон преобразования сетевых адресов (natd)</a></li><li><a href=#network-plip>27.9. IP по параллельному порту (PLIP)</a></li><li><a href=#network-ipv6>27.10. IPv6</a></li><li><a href=#network-atm>27.11. Асинхронный режим передачи (ATM)</a></li></ul></nav><hr><div class=resources><h3>Материалы</h3><ul class=contents><li><i class="fa fa-file-pdf-o" aria-hidden=true title="Скачать PDF"></i><a href=https://download.freebsd.org/doc/ru/books/handbook/handbook_ru.pdf>Скачать PDF</a></li><li><i class="fa fa-pencil-square-o" aria-hidden=true title="Редактировать эту страницу"></i><a href=https://github.com/freebsd/freebsd-doc/blob/main/documentation/content/ru/_index target=_blank>Редактировать эту страницу</a></li></ul></div></div></aside><a class=to-top href=#top><i class="fa fa-arrow-circle-up" aria-hidden=true></i></a></main><footer><div class=footer-container><section class=logo-column><img src=http://172.16.201.134:1313/images/FreeBSD-colors.svg width=160 height=50 alt="FreeBSD logo"><div class=options-container><div class=language-container><a id=languages href=http://172.16.201.134:1313/ru/languages><img src=http://172.16.201.134:1313/images/language.png class=language-image alt="Выберите язык">
<span>Русский</span></a></div><div class=theme-container><select id=theme-chooser><option value=theme-system>Система</option><option value=theme-light>Светлый</option><option value=theme-dark>Тёмный</option><option value=theme-high-contrast>Высокая контрастность</option></select></div></div></section><section class=about-column><h3 class=column-title>О нас</h3><ul class=column-elements-container><li><a href=https://www.freebsd.org/about/ target=_blank class=column-element>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/ target=_blank class=column-element>Фонд FreeBSD</a></li><li><a href=https://www.freebsd.org/where/ target=_blank class=column-element>Получить FreeBSD</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct target=_blank class=column-element>Кодекс Этики</a></li><li><a href=https://www.freebsd.org/security/ target=_blank class=column-element>Бюллетени Безопасности</a></li></ul></section><section class=documentation-column><h3 class=column-title>Документация</h3><ul class=column-elements-container><li><a href=/ru class=column-element>Портал документации</a></li><li><a href=https://man.FreeBSD.org target=_blank class=column-element>Страницы Справочника</a></li><li><a href=https://papers.FreeBSD.org target=_blank class=column-element>Презентации и публикации</a></li><li><a href=https://docs-archive.freebsd.org/doc/ target=_blank class=column-element>Предыдущие версии</a></li><li><a href=https://docs-archive.freebsd.org/44doc/ target=_blank class=column-element>Документы 4.4BSD</a></li><li><a href=https://wiki.freebsd.org/ target=_blank class=column-element>Wiki</a></li></ul></section><section class=community-column><h3 class=column-title>Сообщество</h3><ul class=column-elements-container><li><a href=http://172.16.201.134:1313/ru/articles/contributing class=column-element>Принять участие</a></li><li><a href=https://forums.freebsd.org/ target=_blank class=column-element>Форум Сообщества</a></li><li><a href=https://lists.freebsd.org/ target=_blank class=column-element>Списки рассылки</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank class=column-element>Каналы IRC</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank class=column-element>Трекер ошибок</a></li></ul></section><section class=legal-column><h3 class=column-title>Юридическая информация</h3><ul class=column-elements-container><li><a href=https://freebsdfoundation.org/donate/ target=_blank class=column-element>Пожертвования</a></li><li><a href=https://www.freebsd.org/copyright/freebsd-license/ target=_blank class=column-element>Лицензирование</a></li><li><a href=https://www.freebsd.org/privacy/ target=_blank class=column-element>Политика Конфиденциальности</a></li><li><a href=https://www.freebsd.org/copyright/ target=_blank class=column-element>Юридические оговорки</a></li></ul></section><section class=copyright-column><p>&copy; 1994-2024 Проект FreeBSD. Все права защищены</p><span>Сделано с помощью <span class=heart>♥</span> Сообществом FreeBSD</span></section></div></footer></body></html>