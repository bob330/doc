<!doctype html><html class=theme-light lang=ru><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content><meta name=copyright content="1995-2024 The FreeBSD Foundation"><link rel=canonical href=http://172.16.201.134:1313/ru/books/handbook/firewalls/><title>Глава 26. Межсетевые экраны | FreeBSD Documentation Portal</title>
<meta name=theme-color content="#790000"><meta name=color-scheme content="system light dark high-contrast"><link rel="shortcut icon" href=http://172.16.201.134:1313/favicon.ico><link rel=stylesheet href=http://172.16.201.134:1313/styles/main.min.css><link rel=stylesheet href=http://172.16.201.134:1313/css/font-awesome-min.css><script defer src=/js/theme-chooser.min.js></script><script defer src=/js/copy-clipboard.min.js></script><script defer src=/js/search.min.js></script><meta name=twitter:card content="summary"><meta name=twitter:domain content="docs.FreeBSD.org"><meta name=twitter:site content="@freebsd"><meta name=twitter:url content="https://twitter.com/freebsd"><meta property="og:title" content="Глава 26. Межсетевые экраны"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:image" content="http://172.16.201.134:1313/favicon.ico"><meta property="og:image:alt" content="FreeBSD Logo"><meta property="og:locale" content="ru"><meta property="og:url" content="http://172.16.201.134:1313/ru/books/handbook/firewalls/"><meta property="og:site_name" content="FreeBSD Documentation Portal"><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","url":"http:\/\/172.16.201.134:1313\/ru\/books\/handbook\/firewalls\/","name":"FreeBSD Documentation Portal","headline":"FreeBSD Documentation Portal","description":"FreeBSD Documentation Portal"}</script></head><body><header><div class=header-container><div class=logo-menu-bars-container><a href=https://www.FreeBSD.org class=logo><img src=http://172.16.201.134:1313/images/FreeBSD-monochromatic.svg width=160 height=50 alt="FreeBSD logo">
</a><label class=menu-bars for=menu-bars><i class="fa fa-bars" aria-hidden=true></i></label></div><input id=menu-bars type=checkbox><nav><ul class=menu><li class=menu-item><input id=about type=checkbox>
<a href=# aria-label="Navigate to About section"><label class=menu-item-description for=about>О нас
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/about/ target=_blank>О нас</a></li><li><a href=https://www.freebsd.org/about/ target=_blank>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/about-us/about-the-foundation/ target=_blank>Фонд FreeBSD</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct/ target=_blank>Кодекс Этики</a></li></ul></li><li class=menu-item><input id=download type=checkbox>
<a href=# aria-label="Navigate to get FreeBSD section"><label class=menu-item-description for=download>Получить FreeBSD
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/where/ target=_blank>Получить FreeBSD</a></li><li><a href=https://www.freebsd.org/releases/ target=_blank>Информация о релизах</a></li><li><a href=https://www.freebsd.org/releng/ target=_blank>Подготовка релизов</a></li><li><a href=https://www.freebsd.org/security/ target=_blank>Бюллетени Безопасности</a></li></ul></li><li class=menu-item><input id=documentation type=checkbox>
<a href=# aria-label="Navigate to get Documentation section"><label class=menu-item-description for=documentation>Документация
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=/ru>Портал документации</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook>Руководство</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook>Руководство по созданию портов</a></li><li><a href=https://docs.FreeBSD.org/en/books/fdp-primer>Учебник Проекта Документирования</a></li><li><a href=https://man.FreeBSD.org target=_blank>Страницы Справочника</a></li><li><a href=https://papers.FreeBSD.org target=_blank>Презентации и публикации</a></li><li><a href=https://wiki.FreeBSD.org target=_blank>Wiki</a></li><li><a href=http://172.16.201.134:1313/ru/books>Книги</a></li><li><a href=http://172.16.201.134:1313/ru/articles>Статьи</a></li></ul></li><li class=menu-item><input id=community type=checkbox>
<a href=# aria-label="Navigate to get Community section"><label class=menu-item-description for=community>Сообщество
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/community/>Сообщество</a></li><li><a href=http://172.16.201.134:1313/ru/articles/contributing>Стать участником</a></li><li><a href=https://forums.freebsd.org/ target=_blank>Форум</a></li><li><a href=https://lists.freebsd.org/ target=_blank>Списки рассылки</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank>Каналы IRC</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank>Трекер ошибок</a></li><li><a href=https://www.freebsd.org/support/ target=_blank>Поддержка</a></li></ul></li></ul></nav><div class=search-donate-container><form class=search method=get id=search-header-form action=https://docs.freebsd.org/search name=search-header-form><input type=hidden name=DB value=ru>
<input id=words name=P type=text size=20 maxlength=255>
<button>
<i class="fa fa-search" aria-hidden=true></i></button></form><div class=donate><a href=https://freebsdfoundation.org/donate/ target=_blank><span class=heart>♥</span>
Пожертвования</a></div></div></div></header><input type=checkbox class="hidden toggle" id=menu-control><main class=main-wrapper-book><a id=top></a><aside class=book-menu><div class=book-menu-content><input id=search-book type=text placeholder=Поиск aria-label=Поиск maxlength=128><nav id=MenuContents><ul><li><input type=checkbox id=chapter-eb2a98ce203d8afd517726e6d8776be3 class=toggle>
<label class="icon cursor" for=chapter-eb2a98ce203d8afd517726e6d8776be3><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/preface/>Предисловие</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/preface/#preface-audience>Целевая аудитория</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/preface/#preface-changes-from4>Четвёртое издание</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/preface/#preface-changes-from3>Третье издание</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/preface/#preface-changes-from2>Второе издание (2004)</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/preface/#preface-changes>Первое издание (2001)</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/preface/#preface-overview>Структура этой книги</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/preface/#preface-conv>Договоренности, используемые в этой книге</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/preface/#preface-acknowledgements>Благодарности</a></li></ul></li><li><input type=checkbox id=chapter-14a525fce014b90b8a458a894818255a class=toggle>
<label for=chapter-14a525fce014b90b8a458a894818255a><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/parti/>Часть I. В начале</a></li><li><input type=checkbox id=chapter-f9c9f3451644df30d224350da97d5da6 class=toggle>
<label class="icon cursor" for=chapter-f9c9f3451644df30d224350da97d5da6><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/introduction/>Глава 1. Введение</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/introduction/#introduction-synopsis>1.1. Краткий обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/introduction/#nutshell>1.2. Добро пожаловать во FreeBSD!</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/introduction/#history>1.3. О Проекте FreeBSD</a></li></ul></li><li><input type=checkbox id=chapter-6aaec170775233b7c45f6cdcfb70d466 class=toggle>
<label class="icon cursor" for=chapter-6aaec170775233b7c45f6cdcfb70d466><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/install/>Глава 2. Установка FreeBSD версий 8.X и более ранних</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/install/#install-synopsis>2.1. Краткий обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/install/#install-hardware>2.2. Аппаратные требования</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/install/#install-pre>2.3. Перед установкой</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/install/#install-start>2.4. Начало установки</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/install/#using-sysinstall>2.5. Введение в Sysinstall</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/install/#install-steps>2.6. Выделение дискового пространства</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/install/#install-choosing>2.7. Выбор устанавливаемых компонентов</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/install/#install-media>2.8. Выбор источника для установки</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/install/#install-final-warning>2.9. Подтверждение установки</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/install/#install-post>2.10. После установки</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/install/#install-trouble>2.11. Решение проблем</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/install/#install-advanced>2.12. Расширенное руководство по установке</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/install/#install-diff-media>2.13. Подготовка собственного источника установки</a></li></ul></li><li><input type=checkbox id=chapter-f693a3fa687a72d63ec8129ee302d664 class=toggle>
<label class="icon cursor" for=chapter-f693a3fa687a72d63ec8129ee302d664><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/bsdinstall/>Глава 3. Установка FreeBSD версий 9.X и более поздних</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/bsdinstall/#bsdinstall-synopsis>3.1. Краткий обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/bsdinstall/#bsdinstall-hardware>3.2. Аппаратные требования</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/bsdinstall/#bsdinstall-pre>3.3. Перед установкой</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/bsdinstall/#bsdinstall-start>3.4. Начало установки</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/bsdinstall/#using-bsdinstall>3.5. Введение в bsdinstall</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/bsdinstall/#bsdinstall-netinstall>3.6. Установка по сети</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/bsdinstall/#bsdinstall-partitioning>3.7. Выделение дискового пространства</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/bsdinstall/#bsdinstall-final-warning>3.8. Завершение установки</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/bsdinstall/#bsdinstall-post>3.9. После установки</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/bsdinstall/#bsdinstall-install-trouble>3.10. Решение проблем</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/bsdinstall/#using-live-cd>3.11. Использование Live CD</a></li></ul></li><li><input type=checkbox id=chapter-9f6db261075f578742036fcc6000eecd class=toggle>
<label class="icon cursor" for=chapter-9f6db261075f578742036fcc6000eecd><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/basics/>Глава 4. Основы UNIX</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/basics/#basics-synopsis>4.1. Краткий обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/basics/#consoles>4.2. Виртуальные консоли и терминалы</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/basics/#users-synopsis>4.3. Пользователи и основы управления учетными записями</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/basics/#permissions>4.4. Права доступа</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/basics/#dirstructure>4.5. Структура каталогов</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/basics/#disk-organization>4.6. Организация дисков</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/basics/#mount-unmount>4.7. Монтирование и размонтирование файловых систем</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/basics/#basics-processes>4.8. Процессы</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/basics/#basics-daemons>4.9. Даемоны, сигналы, уничтожение процессов</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/basics/#shells>4.10. Интерпретатор команд</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/basics/#editors>4.11. Текстовые редакторы</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/basics/#basics-devices>4.12. Устройства и файлы устройств</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/basics/#binary-formats>4.13. Бинарные форматы</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/basics/#basics-more-information>4.14. Дополнительная информация</a></li></ul></li><li><input type=checkbox id=chapter-01c5707e95d14c0ff84bf62600c958d1 class=toggle>
<label class="icon cursor" for=chapter-01c5707e95d14c0ff84bf62600c958d1><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/ports/>Глава 5. Установка приложений: порты и пакеты</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/ports/#ports-synopsis>5.1. Обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/ports/#ports-overview>5.2. Обзор установки программного обеспечения</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/ports/#ports-finding-applications>5.3. Поиск программного обеспечения</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/ports/#packages-using>5.4. Использование бинарных пакетов</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/ports/#pkgng-intro>5.5. Использование pkgng для управления бинарными пакетами</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/ports/#ports-using>5.6. Использование Коллекции Портов</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/ports/#ports-nextsteps>5.7. Действия после установки</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/ports/#ports-broken>5.8. Обработка нерабочих портов</a></li></ul></li><li><input type=checkbox id=chapter-f56428b9e0d0b77cc8e863910f96bbde class=toggle>
<label class="icon cursor" for=chapter-f56428b9e0d0b77cc8e863910f96bbde><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/wayland/>Глава 6. Wayland</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/wayland/#wayland-synopsis>6.1. Общие сведения о Wayland</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/wayland/#wayland-wayfire>6.2. Композитный менеджер Wayfire</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/wayland/#wayland-hikari>6.3. Композитный менеджер Hikari</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/wayland/#wayland-sway>6.4. Композитный менеджер Sway</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/wayland/#wayland-xwayland>6.5. Использование Xwayland</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/wayland/#wayland-remotedesktop>6.6. Организация Удалённого Рабочего Стола при помощи VNC</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/wayland/#wayland-ly>6.7. Менеджер регистраций Wayland</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/wayland/#wayland-utilities>6.8. Полезные Инструменты</a></li></ul></li><li><input type=checkbox id=chapter-3405c00581365a8b5d16af70fe4d1b72 class=toggle>
<label class="icon cursor" for=chapter-3405c00581365a8b5d16af70fe4d1b72><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/x11/>Глава 6. X Window System</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/x11/#x11-synopsis>6.1. Обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/x11/#x-understanding>6.2. Основы X</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/x11/#x-install>6.3. Установка X11</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/x11/#x-config>6.4. Конфигурация X11</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/x11/#x-fonts>6.5. Использование шрифтов в X11</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/x11/#x-xdm>6.6. Менеджеры экранов (Display Managers) X</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/x11/#x11-wm>6.7. Графические оболочки</a></li></ul></li><li><input type=checkbox id=chapter-0eab3565e8f59f5a8a896dfba7eb3680 class=toggle>
<label for=chapter-0eab3565e8f59f5a8a896dfba7eb3680><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/partii/>Часть II. Общие задачи</a></li><li><input type=checkbox id=chapter-b33cf28993f3f7bf5baf036e79da0f39 class=toggle>
<label class="icon cursor" for=chapter-b33cf28993f3f7bf5baf036e79da0f39><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/desktop/>Глава 7. Приложения для настольного компьютера</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/desktop/#desktop-synopsis>7.1. Краткий обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/desktop/#desktop-browsers>7.2. Браузеры</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/desktop/#desktop-productivity>7.3. Бизнес приложения</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/desktop/#desktop-viewers>7.4. Программы просмотра документов</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/desktop/#desktop-finance>7.5. Финансовые программы</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/desktop/#desktop-summary>7.6. Итоги</a></li></ul></li><li><input type=checkbox id=chapter-152f694a19312ad72ec7bb4e1c3c33b2 class=toggle>
<label class="icon cursor" for=chapter-152f694a19312ad72ec7bb4e1c3c33b2><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/multimedia/>Глава 8. Мультимедиа</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/multimedia/#multimedia-synopsis>8.1. Краткий обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/multimedia/#sound-setup>8.2. Настройка звуковой карты</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/multimedia/#sound-mp3>8.3. Звук MP3</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/multimedia/#video-playback>8.4. Воспроизведение видео</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/multimedia/#tvcard>8.5. Настройка ТВ тюнеров</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/multimedia/#scanners>8.6. Сканеры</a></li></ul></li><li><input type=checkbox id=chapter-80888b4ee02e3e409e5f71cf97a36450 class=toggle>
<label class="icon cursor" for=chapter-80888b4ee02e3e409e5f71cf97a36450><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/kernelconfig/>Глава 9. Настройка ядра FreeBSD</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/kernelconfig/#kernelconfig-synopsis>9.1. Краткий обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/kernelconfig/#kernelconfig-custom-kernel>9.2. Зачем собирать собственное ядро?</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/kernelconfig/#kernelconfig-devices>9.3. Определение аппаратного обеспечения</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/kernelconfig/#kernelconfig-modules>9.4. Драйвера, подсистемы и модули ядра</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/kernelconfig/#kernelconfig-building>9.5. Сборка и установка собственного ядра</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/kernelconfig/#kernelconfig-config>9.6. Конфигурационный файл</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/kernelconfig/#kernelconfig-trouble>9.7. Решение проблем</a></li></ul></li><li><input type=checkbox id=chapter-cb174c55879b17ab955f2f16989a79e0 class=toggle>
<label class="icon cursor" for=chapter-cb174c55879b17ab955f2f16989a79e0><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/printing/>Глава 10. Печать</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/printing/#printing-synopsis>10.1. Краткий обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/printing/#printing-intro-spooler>10.2. Введение</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/printing/#printing-intro-setup>10.3. Основная настройка</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/printing/#printing-advanced>10.4. Расширенная настройка принтера</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/printing/#printing-using>10.5. Использование принтеров</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/printing/#printing-lpd-alternatives>10.6. Альтернативы стандартному спулеру</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/printing/#printing-troubleshooting>10.7. Выявление проблем</a></li></ul></li><li><input type=checkbox id=chapter-c12b8c3f2a8fcefce87087241f695c83 class=toggle>
<label class="icon cursor" for=chapter-c12b8c3f2a8fcefce87087241f695c83><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/linuxemu/>Глава 11. Двоичная совместимость с Linux</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/linuxemu/#linuxemu-synopsis>11.1. Краткий обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/linuxemu/#linuxemu-lbc-install>11.2. Установка</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/linuxemu/#linuxemu-mathematica>11.3. Установка Mathematica®</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/linuxemu/#linuxemu-maple>11.4. Установка Maple™</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/linuxemu/#linuxemu-matlab>11.5. Установка MATLAB®</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/linuxemu/#linuxemu-oracle>11.6. Установка Oracle®</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/linuxemu/#sapr3>11.7. Установка SAP® R/3®</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/linuxemu/#linuxemu-advanced>11.8. Дополнительные сведения</a></li></ul></li><li><input type=checkbox id=chapter-03b11ba627b9a0c85b247f5641bde272 class=toggle>
<label for=chapter-03b11ba627b9a0c85b247f5641bde272><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/partiii/>Часть III. Системное администрирование</a></li><li><input type=checkbox id=chapter-6c31587f8d736319f099cd4dc1961301 class=toggle>
<label class="icon cursor" for=chapter-6c31587f8d736319f099cd4dc1961301><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/config/>Глава 12. Настройка и оптимизация</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/config/#config-synopsis>12.1. Введение</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/config/#configtuning-initial>12.2. Начальное конфигурирование</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/config/#configtuning-core-configuration>12.3. Основные настройки</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/config/#configtuning-appconfig>12.4. Настройка приложений</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/config/#configtuning-starting-services>12.5. Запуск сервисов</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/config/#configtuning-cron>12.6. Настройка утилиты <code>cron</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/config/#configtuning-rcd>12.7. Использование rc во FreeBSD 5.X и последующих версиях</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/config/#config-network-setup>12.8. Настройка карт сетевых интерфейсов</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/config/#configtuning-virtual-hosts>12.9. Настройка виртуальных серверов</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/config/#configtuning-configfiles>12.10. Файлы настройки</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/config/#configtuning-sysctl>12.11. Настройка с помощью sysctl</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/config/#configtuning-disk>12.12. Оптимизация дисков</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/config/#configtuning-kernel-limits>12.13. Изменение ограничений, накладываемых ядром</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/config/#adding-swap-space>12.14. Увеличение объема подкачки</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/config/#acpi-overview>12.15. Управление питанием и ресурсами</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/config/#ACPI-debug>12.16. Использование и отладка FreeBSD ACPI</a></li></ul></li><li><input type=checkbox id=chapter-459f0012b3b4f0b6b123010f029da5e4 class=toggle>
<label class="icon cursor" for=chapter-459f0012b3b4f0b6b123010f029da5e4><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/boot/>Глава 13. Процесс загрузки FreeBSD</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/boot/#boot-synopsis>13.1. Описание</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/boot/#boot-introduction>13.2. Проблема загрузки</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/boot/#boot-blocks>13.3. Менеджер загрузки и этапы загрузки</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/boot/#boot-kernel>13.4. Взаимодействие с ядром во время загрузки</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/boot/#device-hints>13.5. Хинты устройств</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/boot/#boot-init>13.6. Init: инициализация управления процессами</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/boot/#boot-shutdown>13.7. Процесс остановки системы</a></li></ul></li><li><input type=checkbox id=chapter-917c75fcffbb14d48ed6d0a48e7028f2 class=toggle>
<label class="icon cursor" for=chapter-917c75fcffbb14d48ed6d0a48e7028f2><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/security/>Глава 14. Безопасность</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/security/#security-synopsis>14.1. Краткое описание</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/security/#security-intro>14.2. Введение</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/security/#securing-freebsd>14.3. Защита FreeBSD</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/security/#crypt>14.4. DES, MD5, и шифрование</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/security/#one-time-passwords>14.5. Одноразовые пароли</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/security/#tcpwrappers>14.6. TCP Wrappers</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/security/#kerberosIV>14.7. KerberosIV</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/security/#kerberos5>14.8. Kerberos5</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/security/#openssl>14.9. OpenSSL</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/security/#ipsec>14.10. VPN через IPsec</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/security/#openssh>14.11. OpenSSH</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/security/#fs-acl>14.12. Списки контроля доступа файловой системы (ACL)</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/security/#security-portaudit>14.13. Мониторинг вопросов безопасности в ПО сторонних разработчиков</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/security/#security-advisories>14.14. Сообщения безопасности FreeBSD</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/security/#security-accounting>14.15. Учёт используемых ресурсов</a></li></ul></li><li><input type=checkbox id=chapter-8f4620c77e572cbb58917911a33c73cf class=toggle>
<label class="icon cursor" for=chapter-8f4620c77e572cbb58917911a33c73cf><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/mac/>Глава 15. Принудительный контроль доступа (MAC)</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/mac/#mac-synopsis>15.1. Краткий обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mac/#mac-inline-glossary>15.2. Ключевые термины этой главы</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mac/#mac-initial>15.3. Описание MAC</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mac/#mac-understandlabel>15.4. Метки MAC</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mac/#mac-modules>15.5. Настройка модулей</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mac/#mac-bsdextended>15.6. Модуль MAC bsdextended</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mac/#mac-ifoff>15.7. Модуль MAC ifoff</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mac/#mac-portacl>15.8. Модуль MAC portacl</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mac/#mac-labelingpolicies>15.9. Политики MAC, использующие метки</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mac/#mac-partition>15.10. Модуль MAC partition</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mac/#mac-mls>15.11. Модуль многоуровневой безопасности MAC (MLS)</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mac/#mac-biba>15.12. Модуль MAC Biba</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mac/#mac-lomac>15.13. Модуль MAC LOMAC</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mac/#mac-implementing>15.14. Реализация защищенной среды с MAC</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mac/#MAC-examplehttpd>15.15. Другой пример: Использование MAC для защиты веб сервера</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mac/#mac-troubleshoot>15.16. Решение проблем с инфраструктурой MAC</a></li></ul></li><li><input type=checkbox id=chapter-9598d66a76cb3182057b6bcd775149a0 class=toggle>
<label class="icon cursor" for=chapter-9598d66a76cb3182057b6bcd775149a0><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/audit/>Глава 16. Аудит событий безопасности</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/audit/#audit-synopsis>16.1. Краткий обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/audit/#audit-inline-glossary>16.2. Ключевые понятия</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/audit/#audit-config>16.3. Настройка системы аудита</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/audit/#audit-administration>16.4. Работа с журналами аудита</a></li></ul></li><li><input type=checkbox id=chapter-e1edcad13d9db6e8e4cb645d378ecfaf class=toggle>
<label class="icon cursor" for=chapter-e1edcad13d9db6e8e4cb645d378ecfaf><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/disks/>Глава 17. Устройства хранения</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/disks/#disks-synopsis>17.1. Краткий обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/disks/#disks-naming>17.2. Имена устройств</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/disks/#disks-adding>17.3. Добавление дисков</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/disks/#raid>17.4. RAID</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/disks/#usb-disks>17.5. USB устройства хранения</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/disks/#creating-cds>17.6. Запись и использование оптических носителей (CD)</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/disks/#creating-dvds>17.7. Создание и использование оптических носителей (DVD)</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/disks/#floppies>17.8. Дискеты</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/disks/#backups-tapebackups>17.9. Создание и использование архивных копий на магнитной ленте</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/disks/#backups-floppybackups>17.10. Создание резервных копий на дискетах</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/disks/#backup-strategies>17.11. Стратегии резервного копирования</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/disks/#backup-basics>17.12. Основы технологии резервного копирования</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/disks/#disks-virtual>17.13. Сетевые файловые системы, файловые системы в памяти и с отображением в файл</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/disks/#snapshots>17.14. Мгновенные копии файловых систем</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/disks/#quotas>17.15. Квотирование файловых систем</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/disks/#disks-encrypting>17.16. Шифрование дисковых разделов</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/disks/#swap-encrypting>17.17. Шифрование области подкачки</a></li></ul></li><li><input type=checkbox id=chapter-dde37901a0e0ea32745b67607854900f class=toggle>
<label class="icon cursor" for=chapter-dde37901a0e0ea32745b67607854900f><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/geom/>Глава 18. GEOM: Модульная инфраструктура преобразования дисковых запросов</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/geom/#GEOM-synopsis>18.1. Краткий обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/geom/#GEOM-intro>18.2. Введение в GEOM</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/geom/#GEOM-striping>18.3. RAID0 - Создание дисковой последовательности (Striping)</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/geom/#GEOM-mirror>18.4. RAID1 - Зеркалирование (Mirroring)</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/geom/#geom-ggate>18.5. Сетевые устройства GEOM Gate</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/geom/#geom-glabel>18.6. Метки дисковых устройств</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/geom/#geom-gjournal>18.7. Журналирование UFS средствами GEOM</a></li></ul></li><li><input type=checkbox id=chapter-7af71270807eb7b70cd3eedc6577b254 class=toggle>
<label class="icon cursor" for=chapter-7af71270807eb7b70cd3eedc6577b254><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/filesystems/>Глава 19. Поддержка файловых систем</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/filesystems/#filesystems-synopsis>19.1. Краткий обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/filesystems/#filesystems-zfs>19.2. Файловая система ZFS</a></li></ul></li><li><input type=checkbox id=chapter-49f1e96591c090304ea532012257f4ef class=toggle>
<label class="icon cursor" for=chapter-49f1e96591c090304ea532012257f4ef><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/l10n/>Глава 20. Локализация - использование и настройка i18n/L10n</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/l10n/#l10n-synopsis>20.1. Краткий обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/l10n/#using-localization>20.2. Использование локализации</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/l10n/#l10n-compiling>20.3. Поиск приложений i18n</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/l10n/#lang-setup>20.4. Настройка локализации для некоторых языков</a></li></ul></li><li><input type=checkbox id=chapter-dead2b4c5ea325dd390a9b0dccd8f763 class=toggle>
<label class="icon cursor" for=chapter-dead2b4c5ea325dd390a9b0dccd8f763><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/cutting-edge/>Глава 21. Обновление системы и смена версии FreeBSD</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/cutting-edge/#updating-upgrading-synopsis>21.1. Краткий обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/cutting-edge/#updating-upgrading-freebsdupdate>21.2. Обновление FreeBSD</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/cutting-edge/#updating-upgrading-documentation>21.3. Обновление документации</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/cutting-edge/#current-stable>21.4. Использование ветви разработки</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/cutting-edge/#synching>21.5. Синхронизация исходных текстов</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/cutting-edge/#makeworld>21.6. Пересборка мира</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/cutting-edge/#small-lan>21.7. Отслеживание исходных текстов для нескольких машин</a></li></ul></li><li><input type=checkbox id=chapter-bbd25f9a194f9c39ca2d658c75767db5 class=toggle>
<label for=chapter-bbd25f9a194f9c39ca2d658c75767db5><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/partiv/>Часть IV. Сетевые коммуникации</a></li><li><input type=checkbox id=chapter-499dab596afd7ddac77e80295314e0dd class=toggle>
<label class="icon cursor" for=chapter-499dab596afd7ddac77e80295314e0dd><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/serialcomms/>Глава 22. Последовательные соединения</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/serialcomms/#serial-synopsis>22.1. Краткое описание</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/serialcomms/#serial>22.2. Введение</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/serialcomms/#term>22.3. Терминалы</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/serialcomms/#dialup>22.4. Входящие соединения по модему</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/serialcomms/#dialout>22.5. Исходящие соединения по модему</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/serialcomms/#serialconsole-setup>22.6. Настройка последовательной консоли</a></li></ul></li><li><input type=checkbox id=chapter-95e4571c48bee1cced5e84a538d302e3 class=toggle>
<label class="icon cursor" for=chapter-95e4571c48bee1cced5e84a538d302e3><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/ppp-and-slip/>Глава 23. PPP и SLIP</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/ppp-and-slip/#ppp-and-slip-synopsis>23.1. Краткий обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/ppp-and-slip/#userppp>23.2. PPP уровня пользователя</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/ppp-and-slip/#ppp>23.3. PPP уровня ядра</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/ppp-and-slip/#ppp-troubleshoot>23.4. Решение проблем с соединениями PPP</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/ppp-and-slip/#pppoe>23.5. Использование PPP через Ethernet (PPPoE)</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/ppp-and-slip/#pppoa>23.6. Использование PPP через ATM (PPPoA)</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/ppp-and-slip/#slip>23.7. Использование SLIP</a></li></ul></li><li><input type=checkbox id=chapter-f089ac726c401c9b4bd5c34a295e11bb class=toggle>
<label class="icon cursor" for=chapter-f089ac726c401c9b4bd5c34a295e11bb><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/mail/>Глава 24. Электронная почта</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/mail/#mail-synopsis>24.1. Краткий обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mail/#mail-using>24.2. Использование электронной почты</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mail/#sendmail>24.3. Настройка sendmail</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mail/#mail-changingmta>24.4. Установка другой почтовой программы</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mail/#mail-trouble>24.5. Поиск и устранение неисправностей</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mail/#mail-advanced>24.6. Расширенное руководство</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mail/#outgoing-only>24.7. Настройка почты только для отправки</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mail/#SMTP-dialup>24.8. Использование почты с коммутируемым соединением</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mail/#SMTP-Auth>24.9. SMTP аутентификация</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mail/#mail-agents>24.10. Почтовые программы пользователей</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mail/#mail-fetchmail>24.11. Использование fetchmail</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mail/#mail-procmail>24.12. Использование procmail</a></li></ul></li><li><input type=checkbox id=chapter-6de4de3fe925639d4175ce4b6f8c1829 class=toggle>
<label class="icon cursor" for=chapter-6de4de3fe925639d4175ce4b6f8c1829><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/network-servers/>Глава 25. Сетевые серверы</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/network-servers/#network-servers-synopsis>25.1. Краткий обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/network-servers/#network-inetd>25.2. "Супер-сервер"inetd</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/network-servers/#network-nfs>25.3. Network File System (NFS)</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/network-servers/#network-nis>25.4. Network Information System (NIS/YP)</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/network-servers/#network-dhcp>25.5. Автоматическая настройка сети (DHCP)</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/network-servers/#network-dns>25.6. Domain Name System (DNS)</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/network-servers/#network-apache>25.7. Apache HTTP сервер</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/network-servers/#network-samba>25.8. Файл сервер и печать для Microsoft® Windows® клиентов (Samba)</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/network-servers/#network-ftp>25.9. Протокол передачи файлов (FTP)</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/network-servers/#network-ntp>25.10. Синхронизация часов через NTP</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/network-servers/#network-syslogd>25.11. * Remote Host Logging with <code>syslogd</code></a></li></ul></li><li><input type=checkbox id=chapter-776d855c7b75e048f90b5c2c9b35ffe0 class=toggle checked>
<label class="icon cursor" for=chapter-776d855c7b75e048f90b5c2c9b35ffe0><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/firewalls/>Глава 26. Межсетевые экраны</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/firewalls/#firewalls-intro>26.1. Введение</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/firewalls/#firewalls-concepts>26.2. Принципы работы межсетевых экранов</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/firewalls/#firewalls-apps>26.3. Пакеты межсетевых экранов</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/firewalls/#firewalls-pf>26.4. Packet Filter (PF, межсетевой экран OpenBSD) и ALTQ</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/firewalls/#firewalls-ipf>26.5. * IPFILTER (IPF)</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/firewalls/#firewalls-ipfw>26.6. IPFW</a></li></ul></li><li><input type=checkbox id=chapter-5b07f776a0e6155c1c89aa0d15610380 class=toggle>
<label class="icon cursor" for=chapter-5b07f776a0e6155c1c89aa0d15610380><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/advanced-networking/>Глава 27. Сложные вопросы работы в сети</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/advanced-networking/#advanced-networking-synopsis>27.1. Краткий обзор</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/advanced-networking/#network-routing>27.2. Сетевые шлюзы и маршруты</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/advanced-networking/#network-wireless>27.3. Беспроводные сети</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/advanced-networking/#network-bluetooth>27.4. Bluetooth</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/advanced-networking/#network-bridging>27.5. Мосты</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/advanced-networking/#network-diskless>27.6. Работа с бездисковыми станциями</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/advanced-networking/#network-isdn>27.7. ISDN</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/advanced-networking/#network-natd>27.8. Даемон преобразования сетевых адресов (natd)</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/advanced-networking/#network-plip>27.9. IP по параллельному порту (PLIP)</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/advanced-networking/#network-ipv6>27.10. IPv6</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/advanced-networking/#network-atm>27.11. Асинхронный режим передачи (ATM)</a></li></ul></li><li><input type=checkbox id=chapter-171a77aa9d067a1024f849470e1f33e8 class=toggle>
<label for=chapter-171a77aa9d067a1024f849470e1f33e8><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/partv/>Часть V. Приложения</a></li><li><input type=checkbox id=chapter-8050f436a0a7986a4aaded93d8e49469 class=toggle>
<label class="icon cursor" for=chapter-8050f436a0a7986a4aaded93d8e49469><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/mirrors/>Приложение A. Получение FreeBSD</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/mirrors/#mirrors-cdrom>A.1. Наборы CD и DVD</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mirrors/#mirrors-ftp>A.2. FTP сайты</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mirrors/#ctm>A.3. Использование CTM</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mirrors/#svn>A.4. Использование Subversion</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/mirrors/#mirrors-rsync>A.5. Использование rsync</a></li></ul></li><li><input type=checkbox id=chapter-128b630a8f88f158e7027fe6c2184d21 class=toggle>
<label class="icon cursor" for=chapter-128b630a8f88f158e7027fe6c2184d21><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/bibliography/>Приложение B. Библиография</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/bibliography/#bibliography-freebsd>B.1. Книги и журналы, специализирующиеся на FreeBSD</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/bibliography/#bibliography-userguides>B.2. Руководства для пользователей</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/bibliography/#bibliography-adminguides>B.3. Руководства для администраторов</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/bibliography/#bibliography-programmers>B.4. Руководства для программистов</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/bibliography/#bibliography-osinternals>B.5. Внутренности операционной системы</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/bibliography/#bibliography-security>B.6. Безопасность</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/bibliography/#bibliography-hardware>B.7. Оборудование</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/bibliography/#bibliography-history>B.8. История UNIX®</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/bibliography/#bibliography-journals>B.9. Прочие издания</a></li></ul></li><li><input type=checkbox id=chapter-8bbb8867c46dac315e2253945d8c18a8 class=toggle>
<label class="icon cursor" for=chapter-8bbb8867c46dac315e2253945d8c18a8><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/eresources/>Приложение C. Ресурсы в интернет</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/eresources/#eresources-mail>C.1. Списки рассылки</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/eresources/#eresources-news>C.2. Новостные группы Usenet</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/eresources/#eresources-web>C.3. Серверы World Wide Web</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook/eresources/#eresources-email>C.4. Адреса Email</a></li></ul></li><li><input type=checkbox id=chapter-a80ea4f5a4480b8725422710f954ef36 class=toggle>
<label class="icon cursor" for=chapter-a80ea4f5a4480b8725422710f954ef36><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/handbook/pgpkeys/>Приложение D. PGP ключи</a><ul><li><a href=http://172.16.201.134:1313/ru/books/handbook/pgpkeys/#pgpkeys-officers>D.1. Офицеры</a></li></ul></li><li></li></ul></nav></div></aside><div class=book><div class=book-menu-mobile><label for=menu-control><span class=menu-control-button><i class="fa fa-list" aria-hidden=true title="Меню книг"></i>
Меню книг</span></label></div><h1 class=title>Глава 26. Межсетевые экраны</h1><div class="admonitionblock note"><p><i class="fa fa-exclamation-circle" aria-hidden=true></i>
Этот перевод может быть устаревшим. Для того, чтобы помочь с переводом, пожалуйста, обратитесь к <a href=https://translate-dev.freebsd.org/ target=_blank>Сервер переводов FreeBSD</a>.</p></div><div class=toc-mobile><h3>Содержание</h3><nav id=TableOfContents><ul><li><a href=#firewalls-intro>26.1. Введение</a></li><li><a href=#firewalls-concepts>26.2. Принципы работы межсетевых экранов</a></li><li><a href=#firewalls-apps>26.3. Пакеты межсетевых экранов</a></li><li><a href=#firewalls-pf>26.4. Packet Filter (PF, межсетевой экран OpenBSD) и ALTQ</a></li><li><a href=#firewalls-ipf>26.5. * IPFILTER (IPF)</a></li><li><a href=#firewalls-ipfw>26.6. IPFW</a></li></ul></nav></div><div class=book-content><div id=preamble><div class=sectionbody></div></div><div class=sect1><h2 id=firewalls-intro>26.1. Введение<a class=anchor href=#firewalls-intro></a></h2><div class=sectionbody><div class=paragraph><p>Межсетевые экраны (firewall, брандмауэр) делают возможной фильтрацию входящего и исходящего трафика, идущего через вашу систему. Межсетевой экран использует один или более наборов "правил" для проверки сетевых пакетов при их входе или выходе через сетевое соединение, он или позволяет прохождение трафика или блокирует его. Правила межсетевого экрана могут проверять одну или более характеристик пакетов, включая но не ограничиваясь типом протокола, адресом хоста источника или назначения и портом источника или назначения.</p></div><div class=paragraph><p>Межсетевые экраны могут серьезно повысить уровень безопасности хоста или сети. Они могут быть использованы для выполнения одной или более нижеперечисленных задач:</p></div><div class=ulist><ul><li><p>Для защиты и изоляции приложений, сервисов и машин во внутренней сети от нежелательного трафика, приходящего из внешней сети интернет.</p></li><li><p>Для ограничения или запрещения доступа хостов внутренней сети к сервисам внешней сети интернет.</p></li><li><p>Для поддержки преобразования сетевых адресов (network address translation, NAT), что дает возможность задействовать во внутренней сети приватные IP адреса и совместно использовать одно подключение к сети Интернет (либо через один выделенный IP адрес, либо через адрес из пула автоматически присваиваемых публичных адресов).</p></li></ul></div><div class=paragraph><p>После прочтения этой главы вы узнаете:</p></div><div class=ulist><ul><li><p>Как правильно задать правила фильтрации пакетов.</p></li><li><p>Разницу между межсетевыми экранами, встроенными в FreeBSD</p></li><li><p>Как использовать и настраивать межсетевой экран OpenBSD PF.</p></li><li><p>Как использовать и настраивать IPFILTER.</p></li><li><p>Как использовать и настраивать IPFW.</p></li></ul></div><div class=paragraph><p>Перед прочтением этой главы вам потребуется:</p></div><div class=ulist><ul><li><p>Ознакомиться с основами FreeBSD и интернет.</p></li></ul></div></div></div><div class=sect1><h2 id=firewalls-concepts>26.2. Принципы работы межсетевых экранов<a class=anchor href=#firewalls-concepts></a></h2><div class=sectionbody><div class=paragraph><p>Существует два основных способа создания наборов правил межсетевого экрана: "включающий" и "исключающий". Исключающий межсетевой экран позволяет прохождение всего трафика, за исключением трафика, соответствующего набору правил. Включающий межсетевой экран действует прямо противоположным образом. Он пропускает только трафик, соответствующий правилам и блокирует все остальное.</p></div><div class=paragraph><p>Включающий межсетевой экран обеспечивает гораздо большую степень контроля исходящего трафика. Поэтому включающий межсетевой экран является лучшим выбором для систем, предоставляющих сервисы в сети Интернет. Он также контролирует тип трафика, порождаемого вне и направляющегося в вашу приватную сеть. Трафик, не попавший в правила, блокируется, а в файл протокола вносятся соответствующие записи. Включающие межсетевые экраны обычно более безопасны, чем исключающие, поскольку они существенно уменьшают риск пропуска межсетевым экраном нежелательного трафика.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Если не указано иначе, то все приведенные в этом разделе примеры наборов правил и конфигураций относятся к типу включающего межсетевого экрана.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Безопасность может быть дополнительно повышена с использованием "межсетевого экрана с сохранением состояния". Такой межсетевой экран сохраняет информацию об открытых соединениях и разрешает только трафик через открытые соединения или открытие новых соединений. Недостаток межсетевого экрана с сохранением состояния в том, что он может быть уязвим для атак DoS (Denial of Service, отказ в обслуживании), если множество новых соединений открывается очень быстро. Большинство межсетевых экранов позволяют комбинировать поведение с сохранением состояния и без сохранения состояния, что позволяет создавать оптимальную конфигурацию для каждой конкретной системы.</p></div></div></div><div class=sect1><h2 id=firewalls-apps>26.3. Пакеты межсетевых экранов<a class=anchor href=#firewalls-apps></a></h2><div class=sectionbody><div class=paragraph><p>В базовую систему FreeBSD встроено три программных межсетевых экрана. Это <em>IPFILTER</em> (известный также как IPF), <em>IPFIREWALL</em> (известный также как IPFW) и <em>OpenBSD PacketFilter</em> (также известный как PF). Помимо этого, FreeBSD содержит два пакета ограничения трафика (по существу, предназначенных для контроля пропускной способности сетевого соединения): <a href="https://man.freebsd.org/cgi/man.cgi?query=altq&amp;sektion=4&amp;format=html">altq(4)</a> и <a href="https://man.freebsd.org/cgi/man.cgi?query=dummynet&amp;sektion=4&amp;format=html">dummynet(4)</a>. Dummynet традиционно сильно связан с IPFW, а ALTQ с PF. В настоящее время IPFILTER не поддерживает ограничение пропускной способности сетевого соединения. Для реализации этой функции предлагается использовать IPFILTER совместно с одним из двух существующих пакетов ограничения трафика. Конфигурация следующая: IPFILTER задействуется для фильтрации и трансляции трафика, а IPFW с <a href="https://man.freebsd.org/cgi/man.cgi?query=dummynet&amp;sektion=4&amp;format=html">dummynet(4)</a> _или_PF с ALTQ - для контроля пропускной способности сетевого соединения. IPFW и PF для контроля исходящих и входящих пакетов используют наборы правил, хотя и разными способами с разным синтаксисом правил.</p></div><div class=paragraph><p>Причина, по которой в FreeBSD включено более одного пакета межсетевых экранов, заключается в том, что разные пользователи выдвигают к ним различные требования и используют разные предпочтения. Нет одного пакета, который был бы очевидно лучше других.</p></div><div class=paragraph><p>Автор предпочитает IPFILTER, поскольку его правила с сохранением состояния гораздо проще использовать совместно с NAT; кроме того, в него встроен ftp прокси, что упрощает правила для фильтрации исходящих FTP соединений.</p></div><div class=paragraph><p>Поскольку все межсетевые экраны основаны на анализе значений выбранных полей заголовка пакета, для создания правил межсетевого экрана необходимо понимание принципов TCP/IP, того, что означают различные поля заголовка пакета, и как эти поля используются в обычной сессии. Хорошим примером является: <a href=http://www.ipprimer.com/overview.cfm>http://www.ipprimer.com/overview.cfm</a>.</p></div></div></div><div class=sect1><h2 id=firewalls-pf>26.4. Packet Filter (PF, межсетевой экран OpenBSD) и ALTQ<a class=anchor href=#firewalls-pf></a></h2><div class=sectionbody><div class=paragraph><p>В июле 2003 программный межсетевой экран OpenBSD, известный как PF, был портирован в FreeBSD и стал доступен из коллекции портов FreeBSD; первым релизом, где PF был интегрирован в основную систему, стала FreeBSD 5.3 в ноябре 2004. PF это полноценный межсетевой экран с широким набором возможностей, в котором есть опциональная поддержка ALTQ (Alternate Queuing). ALTQ предоставляет управление пропускной способностью Quality of Service (QoS).</p></div><div class=paragraph><p>Проект OpenBSD осуществляет замечательную работу по поддержке <a href=http://www.openbsd.org/faq/pf/>PF FAQ</a>. Этот раздел руководства фокусируется на взаимосвязи PF и FreeBSD, предоставляя лишь общую информацию по его использованию. За более подробной информацией по использованию PF обратитесь к <a href=http://www.openbsd.org/faq/pf/>PF FAQ</a>.</p></div><div class=paragraph><p>Дополнительные сведения о PF для FreeBSD можно получить с веб сайта: <a href=http://pf4freebsd.love2party.net/>http://pf4freebsd.love2party.net/</a>.</p></div><div class=sect2><h3 id=_использование_модуля_ядра_pf>26.4.1. Использование модуля ядра PF<a class=anchor href=#_использование_модуля_ядра_pf></a></h3><div class=paragraph><p>Чтобы загрузить PF как модуль ядра, добавьте следующую строку в <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>pf_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>Далее, выполните стартовый скрипт:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># /etc/rc.d/pf start</span></code></pre></div></div><div class=paragraph><p>Учтите, модуль PF не загрузится, если он не сможет найти конфигурационный файл с набором правил. По умолчанию размещение файла с правилами следующее: <span class=filename>/etc/pf.conf</span>. Если путь к файлу отличается от вышеприведённого, то внесите в <span class=filename>/etc/rc.conf</span> строку вида:</p></div><div class="literalblock programlisting"><div class=content><pre>pf_rules=&#34;/path/to/pf.conf&#34;</pre></div></div><div class=paragraph><p>Файл с примерами конфигураций <span class=filename>pf.conf</span> находится в каталоге <span class=filename>/usr/shared/examples/pf/</span>.</p></div><div class=paragraph><p>Модуль PF можно также загрузить вручную:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># kldload pf.ko</span></code></pre></div></div><div class=paragraph><p>Поддержка ведения логов для PF обеспечивается модулем <code>pflog.ko</code>, для загрузки которого добавьте следующую строку в <span class=filename>/etc/rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>pflog_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>и запустите на выполнение скрипт:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># /etc/rc.d/pflog start</span></code></pre></div></div><div class=paragraph><p>Если вам необходимы другие функциональные возможности PF, то придется добавить поддержку PF в ядро.</p></div></div><div class=sect2><h3 id=_параметры_ядра>26.4.2. Параметры ядра<a class=anchor href=#_параметры_ядра></a></h3><div class=paragraph><p>Включение PF путем компиляции с ядром FreeBSD не является обязательным требованием, однако вам может понадобиться одна из функциональных возможностей, которая не включена в загружаемый модуль. Например, <a href="https://man.freebsd.org/cgi/man.cgi?query=pfsync&amp;sektion=4&amp;format=html">pfsync(4)</a> являет собой псевдоустройство, которое вносит определенные изменения в таблицу состояний, используемую PF. В дальнейшем, это псевдоустройство может быть скомпоновано с <a href="https://man.freebsd.org/cgi/man.cgi?query=carp&amp;sektion=4&amp;format=html">carp(4)</a> чтобы создать отказоустойчивую систему межсетевых экранов на основе PF.</p></div><div class=paragraph><p>Пример параметров конфигурации ядра для включения PF находится в <span class=filename>/usr/src/sys/conf/NOTES</span> и показан здесь:</p></div><div class="literalblock programlisting"><div class=content><pre>device pf
device pflog
device pfsync</pre></div></div><div class=paragraph><p><code>device pf</code> включает поддержку межсетевого экрана "Packet Filter" (<a href="https://man.freebsd.org/cgi/man.cgi?query=pf&amp;sektion=4&amp;format=html">pf(4)</a>).</p></div><div class=paragraph><p><code>device pflog</code> включает необязательное сетевое псевдоустройство <a href="https://man.freebsd.org/cgi/man.cgi?query=pflog&amp;sektion=4&amp;format=html">pflog(4)</a>, которое может использоваться для протоколирования трафика через <a href="https://man.freebsd.org/cgi/man.cgi?query=bpf&amp;sektion=4&amp;format=html">bpf(4)</a>. Даемон <a href="https://man.freebsd.org/cgi/man.cgi?query=pflogd&amp;sektion=8&amp;format=html">pflogd(8)</a> может использоваться для сохранения протоколируемой информации на диск.</p></div><div class=paragraph><p><code>device pfsync</code> включает необязательное сетевое псевдоустройство <a href="https://man.freebsd.org/cgi/man.cgi?query=pfsync&amp;sektion=4&amp;format=html">pfsync(4)</a>, используемое для отслеживания "изменений состояния".</p></div></div><div class=sect2><h3 id=_доступные_параметры_rc_conf>26.4.3. Доступные параметры rc.conf<a class=anchor href=#_доступные_параметры_rc_conf></a></h3><div class=paragraph><p>Для активации PF и <a href="https://man.freebsd.org/cgi/man.cgi?query=pflog&amp;sektion=4&amp;format=html">pflog(4)</a> во время загрузки в <a href="https://man.freebsd.org/cgi/man.cgi?query=rc.conf&amp;sektion=5&amp;format=html">rc.conf(5)</a> должны быть включены следующие переменные:</p></div><div class="literalblock programlisting"><div class=content><pre>pf_enable=&#34;YES&#34;                 # Включить PF (загрузить модуль если необходимо)
pf_rules=&#34;/etc/pf.conf&#34;         # определение правил для pf
pf_flags=&#34;&#34;                     # дополнительные флаги для запуска pfctl
pflog_enable=&#34;YES&#34;              # запустить pflogd(8)
pflog_logfile=&#34;/var/log/pflog&#34;  # где pflogd должен сохранять протокол
pflog_flags=&#34;&#34;                  # дополнительные флаги для запуска pflogd</pre></div></div><div class=paragraph><p>Если за межсетевым экраном находится локальная сеть и необходимо передавать пакеты для компьютеров этой сети, или использовать NAT, включите также следующий параметр:</p></div><div class="literalblock programlisting"><div class=content><pre>gateway_enable=&#34;YES&#34;            # Включить сетевой шлюз</pre></div></div></div><div class=sect2><h3 id=_создание_правил_фильтрации>26.4.4. Создание правил фильтрации<a class=anchor href=#_создание_правил_фильтрации></a></h3><div class=paragraph><p>Пакет PF читает конфигурацию из файла <a href="https://man.freebsd.org/cgi/man.cgi?query=pf.conf&amp;sektion=5&amp;format=html">pf.conf(5)</a> (полный путь: <span class=filename>/etc/pf.conf</span>); пакеты отвергаются, пропускаются или модифицируются в соответствии с правилами и определениями из этого файла. В стандартную поставку FreeBSD входят несколько файлов с примерами конфигураций, которые находятся в каталоге <span class=filename>/usr/shared/examples/pf/</span>. За исчерпывающим описанием правил PF обратитесь к <a href=http://www.openbsd.org/faq/pf/>PF FAQ</a>.</p></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>Изучая <a href=http://www.openbsd.org/faq/pf/>PF FAQ</a>, имейте в виду, что различные версии FreeBSD могут содержать разные версии pf. В настоящий момент FreeBSD использует ту же версию PF, которая включена в OpenBSD 4.1.</p></div></td></tr></tbody></table></div><div class=paragraph><p><a href=https://lists.FreeBSD.org/subscription/freebsd-pf>Список рассылки, посвящённый FreeBSD packet filter</a> является хорошим местом, чтобы задавать вопросы по конфигурации и использованию пакета PF. Не забудьте проверить архивы списка рассылки перед тем, как задавать вопрос.</p></div></div><div class=sect2><h3 id=_работа_с_pf>26.4.5. Работа с PF<a class=anchor href=#_работа_с_pf></a></h3><div class=paragraph><p>Для управления PF используйте утилиту <a href="https://man.freebsd.org/cgi/man.cgi?query=pfctl&amp;sektion=8&amp;format=html">pfctl(8)</a>. Ниже приведено несколько полезных команд (все возможные команды и опции приведены на странице справочника <a href="https://man.freebsd.org/cgi/man.cgi?query=pfctl&amp;sektion=8&amp;format=html">pfctl(8)</a>):</p></div><table class="tableblock frame-none grid-all stretch informaltable"><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">Команда</th><th class="tableblock halign-left valign-top">Действие</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>pfctl -e</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Включить PF</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>pfctl -d</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Выключить PF</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>pfctl -F all -f /etc/pf.conf</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Сбросить все правила (NAT, правила фильтрации, состояния соединений, таблицы и т.д.) и загрузить новые с файла <span class=filename>/etc/pf.conf</span></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>pfctl -s [ rules | nat | state ]</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Отобразить правила фильтрации, правила NAT или таблицу состояний соединений</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>pfctl -vnf /etc/pf.conf</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Проверить <span class=filename>/etc/pf.conf</span> на наличие ошибок, но сами наборы правил не загружать</p></td></tr></tbody></table></div><div class=sect2><h3 id=_включение_altq>26.4.6. Включение ALTQ<a class=anchor href=#_включение_altq></a></h3><div class=paragraph><p>ALTQ может быть включен только путем компилирования ядра FreeBSD с соответствующими параметрами. ALTQ поддерживается не всеми существующими драйверами сетевых карт. Для просмотра списка поддерживаемых устройств в вашем релизе FreeBSD обратитесь к странице справочника <a href="https://man.freebsd.org/cgi/man.cgi?query=altq&amp;sektion=4&amp;format=html">altq(4)</a>.</p></div><div class=paragraph><p>Следующие параметры включат ALTQ и добавят дополнительную функциональность.</p></div><div class="literalblock programlisting"><div class=content><pre>options         ALTQ
options         ALTQ_CBQ        # Class Bases Queuing (CBQ)
options         ALTQ_RED        # Random Early Detection (RED)
options         ALTQ_RIO        # RED In/Out
options         ALTQ_HFSC       # Hierarchical Packet Scheduler (HFSC)
options         ALTQ_PRIQ       # Priority Queuing (PRIQ)
options         ALTQ_NOPCC      # Required for SMP build</pre></div></div><div class=paragraph><p><code>options ALTQ</code> включает подсистему ALTQ.</p></div><div class=paragraph><p><code>options ALTQ_CBQ</code> включает <em>Class Based Queuing</em> (CBQ). CBQ позволяет распределять пропускную способность соединений по классам или очередям для выставления приоритетов трафика на основе правил фильтрации.</p></div><div class=paragraph><p><code>options ALTQ_RED</code> включает <em>Random Early Detection</em> (RED). RED используется для предотвращения перегрузки сети. RED вычисляет длину очереди и сравнивает ее с минимальным и максимальным значением длины очереди. Если очередь превышает максимум, все новые пакеты будут отброшены. В соответствии со своим названием, RED отбрасывает пакеты из различных соединений в произвольном порядке.</p></div><div class=paragraph><p><code>options ALTQ_RIO</code> включает <em>Random Early Detection In and Out</em>.</p></div><div class=paragraph><p><code>options ALTQ_HFSC</code> включает <em>Hierarchical Fair Service Curve Packet Scheduler</em>. Дополнительная информация о HFSC находится по адресу: <a href=http://www-2.cs.cmu.edu/~hzhang/HFSC/main.html>http://www-2.cs.cmu.edu/~hzhang/HFSC/main.html</a>.</p></div><div class=paragraph><p><code>options ALTQ_PRIQ</code> включает <em>Priority Queuing</em> (PRIQ). PRIQ всегда первым пропускает трафик из очереди c более высоким приоритетом.</p></div><div class=paragraph><p><code>options ALTQ_NOPCC</code> включает поддержку SMP для ALTQ. Эта опция необходима для SMP систем.</p></div></div></div></div><div class=sect1><h2 id=firewalls-ipf>26.5. * IPFILTER (IPF)<a class=anchor href=#firewalls-ipf></a></h2><div class=sectionbody><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>Перевод раздела не завершен.</p></div></td></tr></tbody></table></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Этот раздел находится в процессе написания; содержание может не вполне соответствовать действительности.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Автором IPFILTER является Darren Reed. IPFILTER не зависит от операционной системы: это приложение с открытыми исходными текстами, которое было портировано на операционные системы FreeBSD, NetBSD, OpenBSD, SunOS™, HP/UX, и Solaris™. IPFILTER активно разрабатывается и поддерживается, регулярно выпускаются обновленные версии.</p></div><div class=paragraph><p>IPFILTER основан на межсетевом экране и механизме NAT уровня ядра, которые управляются и контролируются утилитами уровня пользовательских процессов. Правила межсетевого экрана могут устанавливаться или удаляться утилитой <a href="https://man.freebsd.org/cgi/man.cgi?query=ipf&amp;sektion=8&amp;format=html">ipf(8)</a>. Правила NAT могут устанавливаться или удаляться утилитой <a href="https://man.freebsd.org/cgi/man.cgi?query=ipnat&amp;sektion=1&amp;format=html">ipnat(1)</a>. Утилита <a href="https://man.freebsd.org/cgi/man.cgi?query=ipfstat&amp;sektion=8&amp;format=html">ipfstat(8)</a> выводит статистику IPFILTER для ядра. Программа <a href="https://man.freebsd.org/cgi/man.cgi?query=ipmon&amp;sektion=8&amp;format=html">ipmon(8)</a> может заносить действия IPFILTER в файлы системных протоколов.</p></div><div class=paragraph><p>IPF был первоначально написан с использованием правила "последнее совпадение применяется" и только с правилами без сохранения состояния. Со временем IPF был расширен и включает параметры "quick" и "keep state" (сохранение состояния), которые кардинальным образом изменяют логику обработки пакетов. Официальная документация IPF включает традиционные параметры правил с традиционной последовательностью обработки пакетов. Измененные функции включены в виде дополнительных параметров, они необходимы для создания эффективного межсетевого экрана.</p></div><div class=paragraph><p>Инструкции этого раздела подразумевают использование параметра "quick" и параметра сохранения состояния "keep state". Это основа для создания включающего межсетевого экрана.</p></div><div class=paragraph><p>Детальное описание традиционных методов обработки правил: <a href=http://www.obfuscation.org/ipf/ipf-howto.html#TOC_1>http://www.obfuscation.org/ipf/ipf-howto.html#TOC_1</a> и <a href=http://coombs.anu.edu.au/~avalon/ip-filter.html>http://coombs.anu.edu.au/~avalon/ip-filter.html</a>.</p></div><div class=paragraph><p>IPF FAQ находится по адресу <a href=http://www.phildev.net/ipf/index.html>http://www.phildev.net/ipf/index.html</a>.</p></div><div class=paragraph><p>Архив списка рассылки по IPFilter с возможностью поиска доступен по адресу <a href="http://marc.theaimsgroup.com/?l=ipfilter">http://marc.theaimsgroup.com/?l=ipfilter</a>.</p></div><div class=sect2><h3 id=_включение_ipf>26.5.1. Включение IPF<a class=anchor href=#_включение_ipf></a></h3><div class=paragraph><p>IPF включен в базовую систему FreeBSD в качестве отдельного загружаемого модуля. Система динамически загрузит модуль IPF, если в <span class=filename>rc.conf</span> указана переменная <code>ipfilter_enable="YES"</code>. Модуль создается с включенным протоколированием и правилом по умолчанию <code>pass all</code> (пропускать все). Для изменения правила по умолчанию не обязательно собирать ядро с новыми параметрами. Просто добавьте в конец набора правило, блокирующее все пакеты.</p></div></div><div class=sect2><h3 id=_параметры_ядра_2>26.5.2. Параметры ядра<a class=anchor href=#_параметры_ядра_2></a></h3><div class=paragraph><p>Включение IPF в ядро FreeBSD не является обязательным требованием. Эта процедура представлена здесь в качестве дополнительной информации. При включении IPF в ядро загружаемый модуль не используется.</p></div><div class=paragraph><p>Пример параметров настройки ядра для IPF находится в <span class=filename>/usr/src/sys/conf/NOTES</span> и воспроизведен здесь:</p></div><div class="literalblock programlisting"><div class=content><pre>options IPFILTER
options IPFILTER_LOG
options IPFILTER_DEFAULT_BLOCK</pre></div></div><div class=paragraph><p><code>options IPFILTER</code> включает поддержку межсетевого экрана "IPFILTER".</p></div><div class=paragraph><p><code>options IPFILTER_LOG</code> включает протоколирование трафика через IPF путем записи его в псевдо-устройство протоколирования пакетов <span class=filename>ipl</span> для каждого правила, содержащего ключевое слово <code>log</code>.</p></div><div class=paragraph><p><code>options IPFILTER_DEFAULT_BLOCK</code> изменяет поведение по умолчанию так, что блокируется каждый пакет, не соответствующий правилу <code>pass</code>.</p></div><div class=paragraph><p>Эти настройки будут работать только после сборки и установки нового ядра.</p></div></div><div class=sect2><h3 id=_доступные_параметры_rc_conf_2>26.5.3. Доступные параметры rc.conf<a class=anchor href=#_доступные_параметры_rc_conf_2></a></h3><div class=paragraph><p>Для активации IPF во время загрузки в <span class=filename>/etc/rc.conf</span> потребуется добавить следующие переменные:</p></div><div class="literalblock programlisting"><div class=content><pre>ipfilter_enable=&#34;YES&#34;             # Запуск межсетевого экрана ipf
ipfilter_rules=&#34;/etc/ipf.rules&#34;   # Загрузка файла с правилами
ipmon_enable=&#34;YES&#34;                # Включение протоколирования IP monitor
ipmon_flags=&#34;-Ds&#34;                 # D = запуск в виде даемона
                                  # s = протоколирование в syslog
                                  # v = протоколирование tcp window, ack, seq
                                  # n = отображение имен IP и портов</pre></div></div><div class=paragraph><p>Если за межсетевым экраном находится локальная сеть, использующая приватные IP адреса, для включения NAT потребуется добавить следующие переменные:</p></div><div class="literalblock programlisting"><div class=content><pre>gateway_enable=&#34;YES&#34;              # Включение шлюза для локальной сети
ipnat_enable=&#34;YES&#34;                # Запуск функции ipnat
ipnat_rules=&#34;/etc/ipnat.rules&#34;    # Определение файла правил для ipnat</pre></div></div></div><div class=sect2><h3 id=_ipf>26.5.4. IPF<a class=anchor href=#_ipf></a></h3><div class=paragraph><p>Команда <a href="https://man.freebsd.org/cgi/man.cgi?query=ipf&amp;sektion=8&amp;format=html">ipf(8)</a> используется для загрузки файла с правилами. Обычно создается файл, содержащий подготовленный набор правил, который полностью замещает набор, используемый на данный момент:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ipf -Fa -f /etc/ipf.rules</span></code></pre></div></div><div class=paragraph><p><code>-Fa</code> означает сброс всех внутренних таблиц правил.</p></div><div class=paragraph><p><code>-f</code> указывает файл с правилами, который необходимо загрузить.</p></div><div class=paragraph><p>Это дает вам возможность отредактировать файл с правилами, запустить вышеприведенную команду IPF, тем самым обновить набор правил работающего межсетевого экрана без перезагрузки системы. Для обновления правил такой подход очень удобен, поскольку команду можно выполнять столько раз, сколько нужно.</p></div><div class=paragraph><p>На странице справочной системы <a href="https://man.freebsd.org/cgi/man.cgi?query=ipf&amp;sektion=8&amp;format=html">ipf(8)</a> находится подробная информация по всем флагам этой команды.</p></div><div class=paragraph><p>Набор правил для команды <a href="https://man.freebsd.org/cgi/man.cgi?query=ipf&amp;sektion=8&amp;format=html">ipf(8)</a> должен быть в виде стандартного текстового файла. Правила, написанные в виде скрипта с символами подстановки, не принимаются.</p></div><div class=paragraph><p>Есть способ составления правил IPF, использующих символы подстановки. Обратитесь к <a href=#firewalls-ipf-rules-script>Создание набора правил с использованием символьной подстановки</a>.</p></div></div><div class=sect2><h3 id=_ipfstat>26.5.5. IPFSTAT<a class=anchor href=#_ipfstat></a></h3><div class=paragraph><p>По умолчанию <a href="https://man.freebsd.org/cgi/man.cgi?query=ipfstat&amp;sektion=8&amp;format=html">ipfstat(8)</a> получает и отображает суммарную статистику, полученную в результате применения действующих правил к пакетам, проходящим через межсетевой экран с момента его последнего запуска, или с того момента, когда статистика была последний раз обнулена командой <code>ipf -Z</code>.</p></div><div class=paragraph><p>Детальная информация приводится на странице справочника <a href="https://man.freebsd.org/cgi/man.cgi?query=ipfstat&amp;sektion=8&amp;format=html">ipfstat(8)</a>.</p></div><div class=paragraph><p>Вывод команды <a href="https://man.freebsd.org/cgi/man.cgi?query=ipfstat&amp;sektion=8&amp;format=html">ipfstat(8)</a> по умолчанию выглядит примерно так:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>input packets: blocked 99286 passed 1255609 nomatch 14686 counted 0
 output packets: blocked 4200 passed 1284345 nomatch 14687 counted 0
 input packets logged: blocked 99286 passed 0
 output packets logged: blocked 0 passed 0
 packets logged: input 0 output 0
 log failures: input 3898 output 0
 fragment state<span class=o>(</span><span class=k>in</span><span class=o>)</span>: kept 0 lost 0
 fragment state<span class=o>(</span>out<span class=o>)</span>: kept 0 lost 0
 packet state<span class=o>(</span><span class=k>in</span><span class=o>)</span>: kept 169364 lost 0
 packet state<span class=o>(</span>out<span class=o>)</span>: kept 431395 lost 0
 ICMP replies: 0 TCP RSTs sent: 0
 Result cache hits<span class=o>(</span><span class=k>in</span><span class=o>)</span>: 1215208 <span class=o>(</span>out<span class=o>)</span>: 1098963
 IN Pullups succeeded: 2 failed: 0
 OUT Pullups succeeded: 0 failed: 0
 Fastroute successes: 0 failures: 0
 TCP <span class=nb>cksum </span>fails<span class=o>(</span><span class=k>in</span><span class=o>)</span>: 0 <span class=o>(</span>out<span class=o>)</span>: 0
 Packet log flags <span class=nb>set</span>: <span class=o>(</span>0<span class=o>)</span></code></pre></div></div><div class=paragraph><p>При задании флага <code>-i</code> или <code>-o</code> соответственно для входящих или исходящих пакетов, команда извлечет и отобразит соответствующий список правил, установленных и используемых на данный момент.</p></div><div class=paragraph><p><code>ipfstat -in</code> отображает правила, применяемые к входящим пакетам, вместе с номерами этих правил.</p></div><div class=paragraph><p><code>ipfstat -on</code> отображает правила, применяемые к исходящим пакетам, вместе с номерами этих правил.</p></div><div class=paragraph><p>Вывод команды будет выглядеть примерно так:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>@1 pass out on xl0 from any to any
@2 block out on dc0 from any to any
@3 pass out quick on dc0 proto tcp/udp from any to any keep state</code></pre></div></div><div class=paragraph><p><code>ipfstat -ih</code> отображает правила, применяемые к входящим пакетам, со счетчиком количества совпадений для каждого правила.</p></div><div class=paragraph><p><code>ipfstat -oh</code> отображает правила, применяемые к исходящим пакетам, со счетчиком количества совпадений для каждого правила.</p></div><div class=paragraph><p>Вывод команды будет выглядеть примерно так:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>2451423 pass out on xl0 from any to any
354727 block out on dc0 from any to any
430918 pass out quick on dc0 proto tcp/udp from any to any keep state</code></pre></div></div><div class=paragraph><p>Одна из наиболее важных функций команды <code>ipfstat</code> активируется флагом <code>-t</code>, правила отображаются подобно тому, как <a href="https://man.freebsd.org/cgi/man.cgi?query=top&amp;sektion=1&amp;format=html">top(1)</a> показывает таблицу запущенных процессов FreeBSD. Когда межсетевой экран подвергается атаке, эта функция позволяет обнаружить соответствующие пакеты. Дополнительные флаги дают возможность выбирать IP адрес назначения или источника, порт или протокол, которые будут отслеживаться в реальном времени. Подробная информация приведена на странице <a href="https://man.freebsd.org/cgi/man.cgi?query=ipfstat&amp;sektion=8&amp;format=html">ipfstat(8)</a>.</p></div></div><div class=sect2><h3 id=_ipmon>26.5.6. IPMON<a class=anchor href=#_ipmon></a></h3><div class=paragraph><p>Для того, чтобы стало возможно использование команды <code>ipmon</code>, необходимо включить параметр ядра <code>IPFILTER_LOG</code>. Эта команда может использоваться в двух различных режимах. В основном режиме, который используется по умолчанию, она используется без флага <code>-D</code>.</p></div><div class=paragraph><p>В режиме даемона создается непрерывный протокол, и возможен просмотр предыдущих событий. В этом режиме IPFILTER работает в FreeBSD. Поскольку в FreeBSD встроена функция ротации файлов протокола, лучше использовать <a href="https://man.freebsd.org/cgi/man.cgi?query=syslogd&amp;sektion=8&amp;format=html">syslogd(8)</a>, чем используемый по умолчанию вывод в обычный файл. В <span class=filename>rc.conf</span> по умолчанию <code>ipmon_flags</code> имеет значение <code>-Ds</code>:</p></div><div class="literalblock programlisting"><div class=content><pre>ipmon_flags=&#34;-Ds&#34; # D = start as daemon
                  # s = log to syslog
                  # v = log tcp window, ack, seq
                  # n = map IP &amp; port to names</pre></div></div><div class=paragraph><p>Описывать преимущества протоколирования излишне. Например, оно дает возможность отложенного просмотра информации об отброшенных пакетах, откуда они пришли и куда направлялись. Эта информация существенно помогает при отслеживании атак.</p></div><div class=paragraph><p>Даже с включенным протоколированием, IPF не ведет протокол для каждого правила. Администратор межсетевого экран должен решить, по каким правилам набора нужно вести протокол и добавить ключевое слово log к этим правилам. Обычно протоколируются только правила, отбрасывающие пакеты.</p></div><div class=paragraph><p>Включение в набор последнего правила, запрещающего прохождение пакетов, в сочетании с ключевым словом <code>log</code> является довольно распространённой практикой. Так вы можете увидеть все пакеты, не попадающие ни под одно правило набора.</p></div></div><div class=sect2><h3 id=_протоколирование_ipmon>26.5.7. Протоколирование IPMON<a class=anchor href=#_протоколирование_ipmon></a></h3><div class=paragraph><p>Для разделения собираемых данных syslogd использует свой собственный специальный метод. Он использует группировку по категории ("facility") и уровню ("level"). IPMON в режиме <code>-Ds</code> использует <code>local0</code> в качестве имени "категории". Для дальнейшего разделения протоколируемых данных, если такое необходимо, могут быть использованы следующие уровни:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>LOG_INFO - packets logged using the <span class=s2>&#34;log&#34;</span> keyword as the action rather than pass or block.
LOG_NOTICE - packets logged which are also passed
LOG_WARNING - packets logged which are also blocked
LOG_ERR - packets which have been logged and which can be considered short</code></pre></div></div><div class=paragraph><p>Для указания IPFILTER протоколировать все данные в <span class=filename>/var/log/ipfilter.log</span>, создайте этот файл заранее, выполнив следующую команду:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># touch /var/log/ipfilter.log</span></code></pre></div></div><div class=paragraph><p>Функционирование <a href="https://man.freebsd.org/cgi/man.cgi?query=syslogd&amp;sektion=8&amp;format=html">syslogd(8)</a> управляется настройками в файле <span class=filename>/etc/syslog.conf</span>. Файл <span class=filename>syslog.conf</span> позволяет достаточно гибко настроить обработку системных сообщений, выдаваемых программами, такими как IPF.</p></div><div class=paragraph><p>Добавьте в <span class=filename>/etc/syslog.conf</span> следующую запись:</p></div><div class="literalblock programlisting"><div class=content><pre>local0.* /var/log/ipfilter.log</pre></div></div><div class=paragraph><p><code>local0.*</code> означает запись всех протоколируемых сообщений в указанный файл.</p></div><div class=paragraph><p>Для применения внесенных в <span class=filename>/etc/syslog.conf</span> изменений вы можете перезагрузиться или заставить <a href="https://man.freebsd.org/cgi/man.cgi?query=syslogd&amp;sektion=8&amp;format=html">syslogd(8)</a> перечитать <span class=filename>/etc/syslog.conf</span>, выполнив команду <code>/etc/rc.d/syslogd reload</code>.</p></div><div class=paragraph><p>Не забудьте отредактировать <span class=filename>/etc/newsyslog.conf</span> для ротации только что созданного лог файла.</p></div></div><div class=sect2><h3 id=_формат_протоколируемых_сообщений>26.5.8. Формат протоколируемых сообщений<a class=anchor href=#_формат_протоколируемых_сообщений></a></h3><div class=paragraph><p>Сообщения, генерируемые <code>ipmon</code>, состоят из полей данных, разделенных пробелами. Поля, общие для всех сообщений:</p></div><div class="olist arabic"><ol class=arabic><li><p>Дата получения пакета.</p></li><li><p>Время получения пакета. Формат времени HH:MM:SS.F для часов, минут, секунд и долей секунд (последнее поле может состоять из нескольких цифр).</p></li><li><p>Имя интерфейса, через который прошел пакет, например <span class=filename>dc0</span>.</p></li><li><p>Группа и номер правила, например <code>@0:17</code>.</p></li></ol></div><div class=paragraph><p>Эти сообщения могут быть просмотрены командой <code>ipfstat -in</code>.</p></div><div class="olist arabic"><ol class=arabic><li><p>Действие: p для пропущенных, b для заблокированных, S для пакетов с неполным заголовком (short packet), n для пакетов, не соответствующих какому-либо правилу, L для соответствующих правилу протоколирования. Порядок следования по флагам: S, p, b, n, L. Знаки P или B в верхнем регистре означают, что пакет был протоколирован в соответствии с общими настройками, а не каким-то конкретным правилом.</p></li><li><p>Адреса. Всего три поля: адрес и порт источника (разделенные запятой), →, адрес и порт назначения. 209.53.17.22,80 → 198.73.220.17,1722.</p></li><li><p><code>PR</code>, с последующим именем или номером протокола, например <code>PR tcp</code>.</p></li><li><p><code>len</code>, с последующей длиной заголовка и общей длиной пакета, например <code>len 20 40</code>.</p></li></ol></div><div class=paragraph><p>Для TCP пакетов добавляется дополнительное поле, начинающееся с дефиса, за которым следуют буквы, соответствующие установленным флагам. На странице справочника <a href="https://man.freebsd.org/cgi/man.cgi?query=ipf&amp;sektion=5&amp;format=html">ipf(5)</a> находится список букв и флагов.</p></div><div class=paragraph><p>Для пакетов ICMP, в конце находятся два поля, одно всегда "ICMP", а второе содержит тип и подтип ICMP сообщения (message и sub-message), разделенные символом косой черты, например ICMP 3/3 для сообщения "port unreachable".</p></div></div><div class=sect2><h3 id=firewalls-ipf-rules-script>26.5.9. Создание набора правил с использованием символьной подстановки<a class=anchor href=#firewalls-ipf-rules-script></a></h3><div class=paragraph><p>Некоторые опытные пользователи IPF создают файл правил, поддерживающий использование символьной подстановки. Основное преимущество использования такого подхода заключается в возможности изменения значения, присваиваемого символьному имени, в результате чего во всех правилах, содержащих эту символьную подстановку, будет использоваться новое значение. В начале скрипта вы можете поместить часто используемые переменные, а затем использовать их сразу в нескольких правилах. Ниже дан пример такого использования.</p></div><div class=paragraph><p>Синтаксис скрипта совместим с <a href="https://man.freebsd.org/cgi/man.cgi?query=sh&amp;sektion=1&amp;format=html">sh(1)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=csh&amp;sektion=1&amp;format=html">csh(1)</a>, и <a href="https://man.freebsd.org/cgi/man.cgi?query=tcsh&amp;sektion=1&amp;format=html">tcsh(1)</a>.</p></div><div class=paragraph><p>Символьная подстановка предваряется знаком доллара: <code>$</code>.</p></div><div class=paragraph><p>Для присвоения значения символьным переменным знак $ не используется.</p></div><div class=paragraph><p>Присваиваемое символической переменной значение должно быть заключено в двойные кавычки (<code>"</code>).</p></div><div class=paragraph><p>Начните файл правил примерно так:</p></div><div class="literalblock programlisting"><div class=content><pre>############# Start of IPF rules script ########################

oif=&#34;dc0&#34;            # name of the outbound interface
odns=&#34;192.0.2.11&#34;    # ISP&#39;s DNS server IP address
myip=&#34;192.0.2.7&#34;     # my static IP address from ISP
ks=&#34;keep state&#34;
fks=&#34;flags S keep state&#34;

# You can choose between building /etc/ipf.rules file
# from this script or running this script &#34;as is&#34;.
#
# Uncomment only one line and comment out another.
#
# 1) This can be used for building /etc/ipf.rules:
#cat &gt; /etc/ipf.rules &lt;&lt; EOF
#
# 2) This can be used to run script &#34;as is&#34;:
/sbin/ipf -Fa -f - &lt;&lt; EOF

# Allow out access to my ISP&#39;s Domain name server.
pass out quick on $oif proto tcp from any to $odns port = 53 $fks
pass out quick on $oif proto udp from any to $odns port = 53 $ks

# Allow out non-secure standard www function
pass out quick on $oif proto tcp from $myip to any port = 80 $fks

# Allow out secure www function https over TLS SSL
pass out quick on $oif proto tcp from $myip to any port = 443 $fks
EOF
################## End of IPF rules script ########################</pre></div></div><div class=paragraph><p>Это все, что требовалось сделать. В данном примере сами правила не важны; важно то, как используется символьная подстановка. Если вышеприведенный пример помещен в файл <span class=filename>/etc/ipf.rules.script</span>, то набор правил можно перезагрузить, введя следующую команду:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sh /etc/ipf.rules.script</span></code></pre></div></div><div class=paragraph><p>С использованием в правилах символьной подстановки связана одна проблема: IPF не понимает символьную подстановку и не может обработать такой скрипт непосредственно.</p></div><div class=paragraph><p>Скрипт может использоваться одним из следующих двух способов:</p></div><div class=ulist><ul><li><p>Уберите комментарий перед строкой, начинающейся с <code>cat</code>, и закомментируйте строку, начинающуюся с <code>/sbin/ipf</code>. Поместите строку <code>ipfilter_enable="YES"</code> в файл <span class=filename>/etc/rc.conf</span> как обычно, и запускайте скрипт после каждого его обновления для создания или обновления файла <span class=filename>/etc/ipf.rules</span>.</p></li><li><p>Отключите IPFILTER в стартовых скриптах системы, поместив строку <code>ipfilter_enable="NO"</code> (это значение по умолчанию) в файл <span class=filename>/etc/rc.conf</span>.</p><div class=paragraph><p>Поместите скрипт, подобный нижеприведенному, в каталог <span class=filename>/usr/local/etc/rc.d/</span>. У него должно быть однозначно говорящее о его назначении имя, например <span class=filename>ipf.loadrules.sh</span>. Расширение <span class=filename>.sh</span> обязательно.</p></div><div class="literalblock programlisting"><div class=content><pre>#!/bin/sh
sh /etc/ipf.rules.script</pre></div></div><div class=paragraph><p>Права, установленные на этот файл, должны разрешать чтение, запись и выполнение владельцу <code>root</code>.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># chmod 700 /usr/local/etc/rc.d/ipf.loadrules.sh</span></code></pre></div></div></li></ul></div><div class=paragraph><p>Теперь, правила IPF будут загружаться при загрузке системы.</p></div></div><div class=sect2><h3 id=_наборы_правил_ipf>26.5.10. Наборы правил IPF<a class=anchor href=#_наборы_правил_ipf></a></h3><div class=paragraph><p>Набор правил ipf это группа правил, составленных для пропускания или блокирования пакетов на основе их содержимого. Двусторонний обмен пакетами между хостами составляет сессию. Межсетевой экран обрабатывает как входящие из Интернет пакеты, так и исходящие пакеты, которые сгенерированы самой системой в ответ на входящий трафик. Для каждой службы TCP/IP (например, telnet, www, mail, и т.п.) назначен протокол и номер привилегированного (прослушиваемого) порта. Пакеты, предназначенные для определенного сервиса, порождаются с некоторым исходящим адресом и портом из непривилегированного диапазона и направляются на определенный адрес и определенный порт назначения. Все упомянутые параметры (номера портов и адреса) могут использоваться как критерии выбора в правилах, пропускающих или блокирующих доступ к службам TCP/IP.</p></div><div class=paragraph><p>IPF был первоначально написан с использованием логики "последнее совпадающее правило побеждает" и только с правилами без сохранения состояния. Со временем в IPF был включен параметр "quick" и параметр сохранения состояния "keep state", что существенно улучшило логику обработки правил.</p></div><div class=paragraph><p>Инструкции, помещенные в эту главу, созданы с использованием параметров "quick" и "keep state". Это основа для создания набора правил включающего межсетевого экрана.</p></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>При работе с правилами межсетевого экрана, будьте <em>очень осторожны</em>. Некоторые конфигурации <em>могут заблокировать вам доступ</em> к серверу. В целях предосторожности, первоначальную настройку межсетевого экрана вы можете выполнить с локальной консоли, а не через удаленное подключение, такое как ssh.</p></div></td></tr></tbody></table></div></div></div></div><div class=sect1><h2 id=firewalls-ipfw>26.6. IPFW<a class=anchor href=#firewalls-ipfw></a></h2><div class=sectionbody><div class=paragraph><p>IPFIREWALL (IPFW) - представляет собой межсетевой экран, написанный и поддерживаемый добровольными участниками проекта FreeBSD. Он использует stateless правила, т.е. правила без учета состояния, и наследование техники кодирования правил для получения того, что называется простой логикой с сохранением состояния (stateful).</p></div><div class=paragraph><p>Пример простейшего набора правил IPFW (находится в <span class=filename>/etc/rc.firewall</span> и <span class=filename>/etc/rc.firewall6</span>) в стандартной установке FreeBSD достаточно прост и не рассчитан на непосредственное использование без изменений. В нём не используется фильтрация с сохранением состояния, которая даёт преимущества во многих конфигурациях, поэтому он не может быть взят за основу для этого раздела.</p></div><div class=paragraph><p>Синтаксис правил IPFW без сохранения состояния обеспечивает расширенные возможности фильтрации, которые намного превосходят уровень знаний обычного пользователя межсетевого экрана. IPFW рассчитан на профессиональных пользователей или технически продвинутых любителей, которые предъявляют повышенные требования к фильтрации пакетов. Чтобы использовать возможности IPFW в полную силу, необходимы углубленные знания того, как в различных протоколах формируются и используются заголовки пакетов. Углубленное изучение работы протоколов выходит за рамки этого раздела Руководства.</p></div><div class=paragraph><p>IPFW состоит из семи компонентов, главный из которых - процессор правил фильтрации уровня ядра и интегрированный в него механизм учета пакетов, а также средства протоколирования пакетов, правило <code>divert</code>, посредством которых вызывается функция NAT и другие возможности специального назначения, средства для ограничения скорости (шейпинга) трафика (dummynet), средства перенаправления <code>fwd</code>, средства организации сетевого моста bridge и механизм ipstealth. IPFW поддерживает протоколы IPv4 и IPv6.</p></div><div class=sect2><h3 id=firewalls-ipfw-enable>26.6.1. Включение IPFW<a class=anchor href=#firewalls-ipfw-enable></a></h3><div class=paragraph><p>IPFW включён в базовую установку FreeBSD в виде отдельного подгружаемого модуля. Система динамически загружает модуль ядра, когда в <span class=filename>rc.conf</span> присутствует строка <code>firewall_enable="YES"</code>. Если использовать функциональность NAT не планируется, то в этом случае дополнительно компилировать IPFW в состав ядра FreeBSD не требуется.</p></div><div class=paragraph><p>После перезагрузки системы с <code>firewall_enable="YES"</code> в <span class=filename>rc.conf</span> на экране в процессе загрузки отобразится выделенное белым сообщение:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>ipfw2 initialized, divert disabled, rule-based forwarding disabled, default to deny, logging disabled</code></pre></div></div><div class=paragraph><p>Загружаемый модуль скомпилирован с возможностью протоколирования информации о трафике. Для включения протоколирования и установки уровня его детализации имеется переключатель, значение которого можно установить в конфигурационном файле <span class=filename>/etc/sysctl.conf</span>. При добавлении следующих двух строк протоколирование будет включено при следующей загрузке системы:</p></div><div class="literalblock programlisting"><div class=content><pre>net.inet.ip.fw.verbose=1
net.inet.ip.fw.verbose_limit=5</pre></div></div></div><div class=sect2><h3 id=firewalls-ipfw-kernel>26.6.2. Параметры ядра<a class=anchor href=#firewalls-ipfw-kernel></a></h3><div class=paragraph><p>Включение следующих параметров в ядро FreeBSD не является обязательным, если дополнительно не требуется функциональность NAT. Эти параметры представлены здесь в качестве справочной информации для дальнейших примеров.</p></div><div class="literalblock programlisting"><div class=content><pre>options    IPFIREWALL</pre></div></div><div class=paragraph><p>Этот параметр включает IPFW в состав ядра.</p></div><div class="literalblock programlisting"><div class=content><pre>options    IPFIREWALL_VERBOSE</pre></div></div><div class=paragraph><p>Этот параметр включает протоколирование пакетов, которые проходят через IPFW по правилам с ключевым словом <code>log</code>.</p></div><div class="literalblock programlisting"><div class=content><pre>options    IPFIREWALL_VERBOSE_LIMIT=5</pre></div></div><div class=paragraph><p>Ограничение числа пакетов, прошедших через <a href="https://man.freebsd.org/cgi/man.cgi?query=syslogd&amp;sektion=8&amp;format=html">syslogd(8)</a>, отдельно для каждого правила. Этот параметр имеет смысл использовать в недружественной среде, когда необходимо отслеживать активность межсетевого экрана. Это закрывает возможность атак типа "отказ в обслуживании" через флуд сообщениями syslog.</p></div><div class="literalblock programlisting"><div class=content><pre>options    IPFIREWALL_DEFAULT_TO_ACCEPT</pre></div></div><div class=paragraph><p>Этот параметр включает для IPFW разрешающую политику по умолчанию. Это удобно на первых этапах настройки IPFW.</p></div><div class="literalblock programlisting"><div class=content><pre>options    IPDIVERT</pre></div></div><div class=paragraph><p>Включение функциональности NAT.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Межсетевой экран будет блокировать все входящие и исходящие пакеты, если отсутствует параметр ядра <code>IPFIREWALL_DEFAULT_TO_ACCEPT</code> или правило, явно разрешающее эти соединения.</p></div></td></tr></tbody></table></div></div><div class=sect2><h3 id=firewalls-ipfw-rc>26.6.3. Параметры <span class=filename>/etc/rc.conf</span><a class=anchor href=#firewalls-ipfw-rc></a></h3><div class=paragraph><p>Включение межсетевого экрана:</p></div><div class="literalblock programlisting"><div class=content><pre>firewall_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>Для выбора одного из стандартных режимов работы межсетевого экрана, предоставляемых FreeBSD, выберите наиболее подходящий в файле <span class=filename>/etc/rc.firewall</span> и разместите так, как указано ниже:</p></div><div class="literalblock programlisting"><div class=content><pre>firewall_type=&#34;open&#34;</pre></div></div><div class=paragraph><p>Возможны следующие значения для этого параметра:</p></div><div class=ulist><ul><li><p><code>open</code> - пропускать весь трафик.</p></li><li><p><code>client</code> - защищать только эту машину.</p></li><li><p><code>simple</code> - защищать всю сеть.</p></li><li><p><code>closed</code> - полностью запретить IP трафик, за исключением loopback интерфейса.</p></li><li><p><code>UNKNOWN</code> - отключить загрузку правил межсетевого экрана.</p></li><li><p><span class=filename>filename</span> - абсолютный путь к файлу, содержащему правила межсетевого экрана.</p></li></ul></div><div class=paragraph><p>Есть два варианта загрузки собственных правил в межсетевой экран ipfw. Первый способ - задать переменную <code>firewall_type</code> в виде абсолютного пути файла, содержащего <em>правила межсетевого экрана</em> без каких-либо параметров командной строки для самого <a href="https://man.freebsd.org/cgi/man.cgi?query=ipfw&amp;sektion=8&amp;format=html">ipfw(8)</a>. Ниже приведён простой пример набора правил, который блокирует весь входящий и исходящий трафик:</p></div><div class="literalblock programlisting"><div class=content><pre>add deny in
add deny out</pre></div></div><div class=paragraph><p>Второй способ - установить значение переменной <code>firewall_script</code> в виде абсолютного пути исполняемого скрипта, содержащего команды <code>ipfw</code>, которые будут выполнены во время загрузки операционной системы. Правильный формат правил исполняемого скрипта должен соответствовать формату файла, приведённому ниже:</p></div><div class="literalblock programlisting"><div class=content><pre>#!/bin/sh

ipfw -q flush

ipfw add deny in
ipfw add deny out</pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Если переменной <code>firewall_type</code> присвоено значение <code>client</code> или <code>simple</code>, то правила, расположенные по умолчанию в <span class=filename>/etc/rc.firewall</span>, должны быть приведены в соответствие с конфигурацией данной машины. Также заметим, что для используемых в этой главе примеров в качестве значения переменной <code>firewall_script</code> используется <span class=filename>/etc/ipfw.rules</span>.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Включение протоколирования:</p></div><div class="literalblock programlisting"><div class=content><pre>firewall_logging=&#34;YES&#34;</pre></div></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>Единственное, что делает параметр <code>firewall_logging</code>, - присвоение логической единицы (<code>1</code>) переменной sysctl <code>net.inet.ip.fw.verbose</code> (смотрите <a href=#firewalls-ipfw-enable>Включение IPFW</a>). В <span class=filename>rc.conf</span> нет переменной для ограничения протоколирования, но это можно сделать через переменную sysctl вручную либо используя файл <span class=filename>/etc/sysctl.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>net.inet.ip.fw.verbose_limit=5</pre></div></div></td></tr></tbody></table></div><div class=paragraph><p>Если ваша машина выполняет роль шлюза, т.е. обеспечивает трансляцию сетевых адресов (NAT) с помощью <a href="https://man.freebsd.org/cgi/man.cgi?query=natd&amp;sektion=8&amp;format=html">natd(8)</a>, имеет смысл сразу перейти к чтению <a href=../advanced-networking/#network-natd>Даемон преобразования сетевых адресов (natd)</a> для уточнения информации относительно параметров <span class=filename>/etc/rc.conf</span>.</p></div></div><div class=sect2><h3 id=firewalls-ipfw-cmd>26.6.4. Команда IPFW<a class=anchor href=#firewalls-ipfw-cmd></a></h3><div class=paragraph><p>Команда <code>ipfw</code> - это стандартный механизм для ручного добавления/удаления отдельных правил в активной цепочке правил межсетевого экрана. Основная проблема при использовании этого метода состоит в том, что при перезагрузке операционной системы все изменения, сделанные с помощью данной команды, будут утеряны. Вместо этого рекомендуется записать все правила в файл, из которого они будут считываться во время загрузки операционной системы, а также для полной замены текущего набора правил на содержимое из файла.</p></div><div class=paragraph><p>Тем не менее, команду <code>ipfw</code> удобно использовать для отображения текущей конфигурации правил на экране консоли. Учетный модуль IPFW динамически создаёт счётчики для каждого правила, которые подсчитывают количество пакетов, соответствующих условиям срабатывания правила. В процессе тестирования отображение правила со своим счётчиком является одним из способов проверки, срабатывает ли правило при прохождении через него пакета или нет.</p></div><div class=paragraph><p>Вывод полного списка правил:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ipfw list</span></code></pre></div></div><div class=paragraph><p>Вывод полного списка правил с маркером времени последнего срабатывания правила:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ipfw -t list</span></code></pre></div></div><div class=paragraph><p>Следующий пример выводит учетную информацию, количество совпавших пакетов и сами правила. Первым столбцом идет номер правила, за ним следует число совпавших исходящих пакетов, третий столбец - число соответствующих входящих пакетов, и затем само правило.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ipfw -a list</span></code></pre></div></div><div class=paragraph><p>Вывод динамических правил вместе со статическими:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ipfw -d list</span></code></pre></div></div><div class=paragraph><p>Отобразить статические и динамические правила, в т.ч. с истекшим временем действия:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ipfw -d -e list</span></code></pre></div></div><div class=paragraph><p>Обнуление счетчиков:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ipfw zero</span></code></pre></div></div><div class=paragraph><p>Обнулить счетчики для правила под номером <em>NUM</em>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ipfw zero NUM</span></code></pre></div></div></div><div class=sect2><h3 id=firewalls-ipfw-rules>26.6.5. Набор правил IPFW<a class=anchor href=#firewalls-ipfw-rules></a></h3><div class=paragraph><p>Набор правил (ruleset) представляет собой группу правил IPFW, которые разрешают или запрещают прохождение пакета через межсетевой экран на основании значений, содержащихся в пакете. Двунаправленный обмен пакетов между машинами является сессией. Набор правил межсетевого экрана анализирует как пакеты, приходящие из глобальной сети, так и ответные пакеты, исходящие из системы. Каждый TCP/IP сервис (такой как telnet, www, mail, и т.д.) принадлежит определенному протоколу и привилегированному (прослушиваемому) порту. Пакеты, предназначенные для конкретного сервиса, передаются с непривилегированного (с высоким значением) порта по адресу назначения на указанный порт сервиса. Все эти параметры (т.е. порты и адреса) могут быть использованы в качестве критериев фильтрации при создании правил, которые пропускают или блокируют сервисы.</p></div><div class=paragraph><p>Когда пакет попадает в межсетевой экран, он сравнивается с каждым правилом, начиная с первого, двигаясь по множеству правил верху вниз в порядке увеличения номера правил. Когда пакет совпадает с критерием выбора правила, выполняется действие, указанное в правиле, и на этом поиск правил прекращается. Такой метод поиска известен как "выигрыш первого совпадения", т.е. после срабатывания правила оставшиеся не просматриваются. Если содержимое пакета не соответствует ни одному из правил, он принудительно попадает на встроенное правило по умолчанию, заданное под номером 65535, которое запрещает и отбрасывает все пакеты без какого-либо отклика в сторону отправителя.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Поиск продолжается после правил <code>count</code>, <code>skipto</code> и <code>tee</code>.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Упомянутые здесь инструкции основаны на использовании правил, содержащих параметры с сохранением состояния <code>keep state</code>, <code>limit</code>, <code>in</code>, <code>out</code> и <code>via</code>. Это основной механизм для кодирования набора правил межсетевого экрана закрытого типа.</p></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>Будьте осторожны, когда работаете с правилами межсетевого экрана, так как вы можете легко заблокировать самого себя.</p></div></td></tr></tbody></table></div><div class=sect3><h4 id=firewalls-ipfw-rules-syntax>26.6.5.1. Синтаксис правил<a class=anchor href=#firewalls-ipfw-rules-syntax></a></h4><div class=paragraph><p>Представленный здесь синтаксис правил был упрощен для создания стандартного набора правил межсетевого экрана закрытого типа. Для полного описания синтаксиса правил смотрите страницу Справочника <a href="https://man.freebsd.org/cgi/man.cgi?query=ipfw&amp;sektion=8&amp;format=html">ipfw(8)</a>.</p></div><div class=paragraph><p>Правила содержат ключевые слова: эти ключевые слова записываются в строке в определенном порядке слева направо. Ключевые слова выделены полужирным шрифтом. Некоторые ключевые слова имеют дополнительные параметры, которые могут являться ключевыми словами для них самих и также содержать вложенные дополнительные параметры.</p></div><div class=paragraph><p>Символ <code>#</code> используется для обозначения начала комментария и может быть расположен в конце строки с правилом или в начале строки над правилом. Пустые строки игнорируются.</p></div><div class=paragraph><p><em>CMD RULE_NUMBER ACTION LOGGING SELECTION STATEFUL</em></p></div><div class=sect4><h5 id=_cmd>26.6.5.1.1. CMD<a class=anchor href=#_cmd></a></h5><div class=paragraph><p>Каждое новое правило должно начинаться с префикса <span class=parameter>add</span> для добавления во внутреннюю таблицу.</p></div></div><div class=sect4><h5 id=_rule_number>26.6.5.1.2. RULE_NUMBER<a class=anchor href=#_rule_number></a></h5><div class=paragraph><p>Каждое правило обозначено номером в диапазоне 1..65535.</p></div></div><div class=sect4><h5 id=_action>26.6.5.1.3. ACTION<a class=anchor href=#_action></a></h5><div class=paragraph><p>При соответствии пакета описанным в правиле критериям фильтрации будет выполнено одно из следующих действий.</p></div><div class=paragraph><p><span class=parameter>allow | accept | pass | permit</span></p></div><div class=paragraph><p>Все эти действия означают одно и то же - пакеты, совпадающие с правилом, могут покинуть обработку правил межсетевого экрана. На этом поиск прекращается.</p></div><div class=paragraph><p><span class=parameter>check-state</span></p></div><div class=paragraph><p>Проверяет пакет на соответствие динамической таблице правил. Если совпадение найдено, выполняется действие, содержащееся в правиле, породившем данное динамическое правило, иначе выполняется переход к следующему правилу. Правило check-state не имеет критериев фильтрации. При отсутствии правила check-state в наборе правил проверка по динамической таблице происходит на первом правиле keep-state или limit.</p></div><div class=paragraph><p><span class=parameter>deny | drop</span></p></div><div class=paragraph><p>Оба слова означают отбрасывание пакетов, совпавших с правилом. Поиск прекращается.</p></div></div><div class=sect4><h5 id=_протоколирование>26.6.5.1.4. Протоколирование<a class=anchor href=#_протоколирование></a></h5><div class=paragraph><p><span class=parameter>log</span> или <span class=parameter>logamount</span></p></div><div class=paragraph><p>Когда пакет совпадает с правилом, содержащим ключевое слово <code>log</code>, информация об этом событии записывается в <a href="https://man.freebsd.org/cgi/man.cgi?query=syslogd&amp;sektion=8&amp;format=html">syslogd(8)</a> с пометкой SECURITY. Запись в журнал происходит только в том случае, если число срабатываний для данного правила не превышает значения параметра <code>logamount</code>. Если значение <code>logamount</code> не объявлено, то ограничение берется из значения переменной sysctl <code>net.inet.ip.fw.verbose_limit</code>. В обоих случаях обнуление значения отменяет ограничение. По достижению установленного лимита запись в журнал может быть повторно включена путем сброса счетчика срабатываний или счетчика пакетов для этого правила; смотрите описание команды <code>ipfw reset log</code>.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Протоколирование осуществляется после проверки на соответствие всем условиям в правиле и перед выполнением окончательного действия (accept, deny) над пакетом. Вы должны выбрать сами, какие действия правил вы хотите включить в журнал.</p></div></td></tr></tbody></table></div></div><div class=sect4><h5 id=_условия_отбора>26.6.5.1.5. Условия отбора<a class=anchor href=#_условия_отбора></a></h5><div class=paragraph><p>Ключевые слова, представленные в этом разделе, используются для описания атрибутов пакета, по которым проверяется условие срабатывания того или иного правила. Для совпадения используется следующая последовательность атрибутов общего назначения:</p></div><div class=paragraph><p><span class=parameter>udp | tcp | icmp</span></p></div><div class=paragraph><p>Также могут быть использованы имена протоколов, описанные в <span class=filename>/etc/protocols</span>. Указанное значение обозначает протокол для совпадения. Это является обязательным требованием.</p></div><div class=paragraph><p><span class=parameter>from src to dst</span></p></div><div class=paragraph><p>Ключевые слова <code>from</code> и <code>to</code> служат для фильтрации по IP адресам. Обязательно должны быть указаны и источник, и получатель. <code>any</code> - это специальное ключевое слово, которое соответствует любому IP адресу. <code>me</code> - это специальное ключевое слово, которое соответствует любому из IP адресов, сконфигурированных на интерфейсе вашей системы FreeBSD, и служит для указания компьютера, на котором работает межсетевой экран (т.е. этот компьютер), как показано на примерах <code>from me to any</code>, <code>from any to me</code>, <code>from 0.0.0.0/0 to any</code>, <code>from any to 0.0.0.0/0</code>, <code>from 0.0.0.0 to any</code>, <code>from any to 0.0.0.0</code> и <code>from me to 0.0.0.0</code>. IP адрес указывается в виде четырёх чисел, разделённых точками, или дополнительно с префиксом сети (нотация CIDR). Это является обязательным требованием. Для упрощения вычислений, связанных с IP адресами, используйте порт <a class=package href=https://cgit.freebsd.org/ports/tree/net-mgmt/ipcalc/>net-mgmt/ipcalc</a>. Более подробную информацию можно посмотреть на странице программы: <a href=http://jodies.de/ipcalc>http://jodies.de/ipcalc</a>.</p></div><div class=paragraph><p><span class=parameter>port number</span></p></div><div class=paragraph><p>Для протоколов, работающих с портами (такие как TCP и UDP), обязательным требованием является указание номера порта соответствующего сервиса. Вместо номера порта можно использовать имя сервиса (из <span class=filename>/etc/services</span>).</p></div><div class=paragraph><p><span class=parameter>in | out</span></p></div><div class=paragraph><p>Отбор соответственно по входящим и исходящим пакетам. Присутствие одного из этих ключевым слов в правиле обязательно для формирования критерия фильтрации.</p></div><div class=paragraph><p><span class=parameter>via IF</span></p></div><div class=paragraph><p>Совпадает с пакетами, проходящими через указанный интерфейс. Ключевое слово <code>via</code> включает обязательную проверку на указанном интерфейсе в общий процесс поиска совпадений.</p></div><div class=paragraph><p><span class=parameter>setup</span></p></div><div class=paragraph><p>Это обязательное ключевое слово определяет начало запроса сессии для TCP пакетов.</p></div><div class=paragraph><p><span class=parameter>keep-state</span></p></div><div class=paragraph><p>Это обязательное ключевое слово. При совпадении межсетевой экран создает динамическое правило, которое по умолчанию будет совпадать с двунаправленным трафиком между отправителем и получателем для данной пары IP/порт по указанному протоколу.</p></div><div class=paragraph><p><span class=parameter>limit {src-addr | src-port | dst-addr | dst-port}</span></p></div><div class=paragraph><p>Межсетевой экран разрешит только <em>N</em> соединений с одинаковым набором параметров, указанных в правиле. Можно задавать один или несколько адресов и портов отправителя и получателя. В одном и том же правиле использование <code>limit</code> и <code>keep-state</code> не допускается. Параметр <code>limit</code> предоставляет такую же функцию с сохранением состояний, что и <code>keep-state</code>, плюс свои собственные.</p></div></div></div><div class=sect3><h4 id=_параметры_для_правил_с_сохранением_состояния>26.6.5.2. Параметры для правил с сохранением состояния<a class=anchor href=#_параметры_для_правил_с_сохранением_состояния></a></h4><div class=paragraph><p>С точки зрения фильтрации по правилам с сохранением состояния весь трафик выглядит как двусторонний обмен пакетами, включая данные о сессиях. При такой фильтрации у нас есть средства сопоставления и определения корректности процедуры двустороннего обмена пакетами между стороной, породившей пакет, и стороной-получателем. Любые пакеты, которые не подходят под шаблон сессии, автоматически отбрасываются как злонамеренные.</p></div><div class=paragraph><p>Параметр <code>check-state</code> служит для указания места в наборе правил IPFW, в котором пакет будет передан на поиск соответствий динамическим правилам. В случае совпадения пакет пропускается, при этом создается новое динамическое правило для следующего пакета, принадлежащего данной двусторонней сессии. В противном случае пакет движется по обычным правилам, начиная со следующей позиции.</p></div><div class=paragraph><p>Динамические правила уязвимы к атаке SYN-пакетами, которые могут породить гигантское количество динамических правил. Для предотвращения такого рода атак во FreeBSD предусмотрен еще один параметр - <code>limit</code>. Этот параметр служит для ограничения количества одновременно установленных сессий путём проверки полей отправителя и получателя, в зависимости от параметра <code>limit</code>, с использованием IP адреса пакета для поиска открытых динамических правил, которые представляют собой счетчик количества совпадений для данного IP адреса и этого правила. Если это количество превышает значение, указанное в параметре <code>limit</code>, то такой пакет отбрасывается.</p></div></div><div class=sect3><h4 id=_протоколирование_сообщений_межсетевого_экрана>26.6.5.3. Протоколирование сообщений межсетевого экрана<a class=anchor href=#_протоколирование_сообщений_межсетевого_экрана></a></h4><div class=paragraph><p>Преимущества протоколирования очевидны: это предоставляет возможность отслеживать постфактум, прохождение каких пакетов было отклонено, откуда эти пакеты пришли и куда они назначались для тех правил, в которых включена функция записи в журнал. Это замечательный инструмент для отслеживания атак на вашу систему.</p></div><div class=paragraph><p>Даже при включенной функции ведения журнала само по себе оно производиться не будет. Администратор межсетевого экрана определяет, для каких правил будет включена функция ведения журнала, и добавляет к этим правилам <code>log</code>. Обычно в журнал пишутся только запрещающие правила, такие как правила deny для входящего ICMP ping. Довольно часто конец списка добавляют дублирующее правило вида "ipfw default deny everything" с приставкой <code>log</code>. Это позволяет отслеживать все пакеты, не совпадающие ни с одним из правил в вашем наборе.</p></div><div class=paragraph><p>Будьте крайне осмотрительны при использовании функции ведения журнала, так как это чревато несоразмерным разрастанием файла журнала, вплоть до полного заполнения им места на жестком диске. DoS атаки, направленные на переполнение свободного пространства жесткого диска, являются одними из самых старейших. Помимо заполнения жесткого диска это неприятно еще и тем, что сообщения журнала пишутся не только в syslogd, но также отображаются на экране системной консоли, и это вскоре начинает сильно раздражать.</p></div><div class=paragraph><p>Параметр ядра <code>IPFIREWALL_VERBOSE_LIMIT=5</code> ограничивает число идущих подряд сообщений в системный регистратор <a href="https://man.freebsd.org/cgi/man.cgi?query=syslogd&amp;sektion=8&amp;format=html">syslogd(8)</a>, касающихся пакетов, совпавших с правилом. Когда этот параметр включен в ядро, число последовательно идущих сообщений для определенного правила обрезается указанным числом. От записи 200 идентичных сообщений особого прока нет. В данном случае для сработавшего правила в журнале syslogd будут зафиксированы 5 сообщений подряд, остальные идентичные сообщения будут подсчитаны и отправлены в syslogd как одно сообщение такого вида:</p></div><div class="literalblock programlisting"><div class=content><pre>last message repeated 45 times</pre></div></div><div class=paragraph><p>Путь к файлу, в который пишутся сообщения, задается в файле <span class=filename>/etc/syslog.conf</span>. По умолчанию это файл <span class=filename>/var/log/security</span>.</p></div></div><div class=sect3><h4 id=firewalls-ipfw-rules-script>26.6.5.4. Написание скрипта правил<a class=anchor href=#firewalls-ipfw-rules-script></a></h4><div class=paragraph><p>Наиболее опытные пользователи IPFW создают скрипт, содержащий в себе правила, оформленные таким образом, что они могут быть исполнены как обыкновенный sh-скрипт. Основное преимущество такого подхода в том, что правила можно полностью заменить на новые без необходимости в перезагрузке системы для их активации. Это крайне удобно на этапе разработки и тестирования набора правил, т.к. перезагружать весь список правил можно сколь угодно часто. Помимо того, поскольку это скрипт, то здесь можно объявить некие часто используемые значения в виде переменной, и использовать её во множестве правил, как показано в примере ниже.</p></div><div class=paragraph><p>Синтаксис примера, приведенного ниже, совместим с тремя командными оболочками: <a href="https://man.freebsd.org/cgi/man.cgi?query=sh&amp;sektion=1&amp;format=html">sh(1)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=csh&amp;sektion=1&amp;format=html">csh(1)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=tcsh&amp;sektion=1&amp;format=html">tcsh(1)</a>. Для использования значения ранее объявленной переменной имя переменной предваряется символом $. Во время присвоения имя переменной не имеет префикса $, присваиваемое значение должно быть заключено в "двойные кавычки".</p></div><div class=paragraph><p>Так выглядит файл с правилами, с которого вы можете начать:</p></div><div class="literalblock programlisting"><div class=content><pre>############### начало примера скрипта с правилами ipfw #############
#
ipfw -q -f flush	# Сброс всех правил.
# Установки по умолчанию
oif=&#34;tun0&#34;		# наш интерфейс
odns=&#34;192.0.2.11&#34;	# IP DNS сервера провайдера
cmd=&#34;ipfw -q add &#34;	# префикс для создания правил
ks=&#34;keep-state&#34;		# просто лень вводить каждый раз
$cmd 00500 check-state
$cmd 00502 deny all from any to any frag
$cmd 00501 deny tcp from any to any established
$cmd 00600 allow tcp from any to any 80 out via $oif setup $ks
$cmd 00610 allow tcp from any to $odns 53 out via $oif setup $ks
$cmd 00611 allow udp from any to $odns 53 out via $oif $ks
################### конец примера скрипта с правилами ipfw ############</pre></div></div><div class=paragraph><p>Вот и все, что нужно сделать. Сами правила в этом примере не столь важны, они написаны ради того, чтобы продемонстрировать использование подстановки значения переменной по ее имени.</p></div><div class=paragraph><p>Если бы этот скрипт находился в файле <span class=filename>/etc/ipfw.rules</span>, то правила можно было бы перезагрузить следующей командой.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># sh /etc/ipfw.rules</span></code></pre></div></div><div class=paragraph><p>Имя и расположение файла <span class=filename>/etc/ipfw.rules</span> могут быть какими угодно.</p></div><div class=paragraph><p>Такой же результат можно получить, выполнив вручную следующие команды:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ipfw -q -f flush</span>
<span class=c># ipfw -q add check-state</span>
<span class=c># ipfw -q add deny all from any to any frag</span>
<span class=c># ipfw -q add deny tcp from any to any established</span>
<span class=c># ipfw -q add allow tcp from any to any 80 out via tun0 setup keep-state</span>
<span class=c># ipfw -q add allow tcp from any to 192.0.2.11 53 out via tun0 setup keep-state</span>
<span class=c># ipfw -q add 00611 allow udp from any to 192.0.2.11 53 out via tun0 keep-state</span></code></pre></div></div></div><div class=sect3><h4 id=_набор_правил_с_сохранением_состояния>26.6.5.5. Набор правил с сохранением состояния<a class=anchor href=#_набор_правил_с_сохранением_состояния></a></h4><div class=paragraph><p>Следующий набор правил, не включающий в себя правила трансляции адресов NAT, является примером того, как создавать правила для межсетевого экрана закрытого типа высокого уровня защиты. Закрытый межсетевой экран разрешает трафик, описанный в разрешающих правилах, и по умолчанию блокирует всё остальное. Межсетевой экран, предназначенный для защиты сегментов сети, имеет как минимум два интерфейса, для которых должны быть написаны правила для работы межсетевого экрана.</p></div><div class=paragraph><p>Все разновидности операционных систем UNIX®, включая FreeBSD, используют интерфейс <span class=filename>lo0</span> и IP адрес <code>127.0.0.1</code> для передачи данных внутри операционной системы. Правила межсетевого экрана должны содержать в своем составе правила, разрешающие беспрепятственное прохождение трафика по этому интерфейсу.</p></div><div class=paragraph><p>Интерфейс, подключенный к Интернет, является местом для размещения правил авторизации и контроля доступа исходящих и входящих соединений. Это может быть туннельный интерфейс PPP <span class=filename>tun0</span> или сетевой адаптер, подключенный к DSL или кабельному модему.</p></div><div class=paragraph><p>В случае, когда за межсетевым экраном один и более интерфейсов подсоединён к локальной сети, должны присутствовать правила для беспрепятственного прохождения исходящих пакетов с этих интерфейсов LAN.</p></div><div class=paragraph><p>Правила изначально разделяются на три основных раздела: интерфейсы, не ограниченные правилами, правила для исходящего трафика на внешнем интерфейсе и правила для входящего трафика на внешнем интерфейсе.</p></div><div class=paragraph><p>В каждом из разделов, относящихся к внешнему интерфейсу, правила должны быть упорядоченны по следующему принципу: наиболее используемые расположены в начале, наименее используемые - в конце. Последним должно идти правило блокирования и занесения в журнал информации о пакетах на этом интерфейсе, не попавших под предыдущие правила.</p></div><div class=paragraph><p>Раздел, описывающий правила для исходящего трафика на внешнем интерфейсе, содержит только разрешающие правила <code>allow</code>, состоящие из значений фильтрации, которые однозначно определяют сервис, которому разрешен доступ в Интернет. Все правила включают в себя поля <code>proto</code>, <code>port</code>, <code>in/out</code>, <code>via</code> и <code>keep state</code>. Правила, содержащие <code>proto tcp</code>, имеют также параметр <code>setup</code>, который служит для определения начала сессии, которое в дальнейшем передается как условие срабатывания в динамическую таблицу.</p></div><div class=paragraph><p>В разделе, описывающем правила для входящего трафика на внешнем интерфейсе, в самом начале должны стоять правила, блокирующие нежелательные пакеты. Так должно быть по двум причинам. Первая состоит в том, что пакеты, сформированные злоумышленником, могут частично или полностью соответствовать разрешающим правилам <code>allow</code>. Вторая причина состоит в том, что заведомо не интересующие нас пакеты могут быть просто отклонены, вместо того, чтобы быть перехваченными и записанными в файл журнала по последнему правилу. Последнее правило в каждом разделе блокирует и регистрирует в журнале все пакеты и может быть использовано для юридических обоснований в ходе разбирательств против злоумышленников, атаковавших вашу систему.</p></div><div class=paragraph><p>Также следует убедиться в том, что ваш сервер не отвечает ни на какие другие формы непредусмотренного трафика. Некорректные пакеты должны быть просто отброшены. В результате атакующие не получат информацию о том, достиг ли его пакет вашего сервера. Чем меньше атакующие будут знать о вашей системе, тем более она защищена. Назначение нераспознанного номера порта можно посмотреть в файле <span class=filename>/etc/services/</span> или по адресу <a href=http://en.wikipedia.org/wiki/List_of_TCP_and_UDP_port_numbers>http://en.wikipedia.org/wiki/List_of_TCP_and_UDP_port_numbers</a>. Рекомендуем ознакомиться с содержимым ссылки относительно номеров портов, используемых троянами: <a href=http://www.sans.org/security-resources/idfaq/oddports.php>http://www.sans.org/security-resources/idfaq/oddports.php</a>.</p></div></div><div class=sect3><h4 id=_пример_правил_для_межсетевого_экрана_закрытого_типа>26.6.5.6. Пример правил для межсетевого экрана закрытого типа.<a class=anchor href=#_пример_правил_для_межсетевого_экрана_закрытого_типа></a></h4><div class=paragraph><p>Следующие правила, не включающие поддержку NAT, являются логически полным набором правил для межсетевого экрана закрытого типа. При использовании этого набора правил вы вполне можете быть уверены в безопасности вашей системы. Просто закомментируйте некоторые из правил <code>pass</code> для тех служб, которые вам не требуются. Чтобы избежать занесения в журнал нежелательных сообщений, добавьте правило <code>deny</code> в раздел, описывающий входящий трафик на интерфейсе. Замените название интерфейса <span class=filename>dc0</span>, упоминающегося в правилах ниже, на название интерфейса (NIC), который соединяет вашу систему с глобальной сетью. Для PPP соединений это будет <span class=filename>tun0</span>.</p></div><div class=paragraph><p>Примечание по использованию этих правил.</p></div><div class=ulist><ul><li><p>Все запросы начала сессии с внешней сетью используют параметр <code>keep-state</code>.</p></li><li><p>Все разрешенные сервисы внешней сети имеют параметр <code>limit</code> для защиты от флуда.</p></li><li><p>Все правила используют параметры <code>in</code> или <code>out</code> для указания направления трафика.</p></li><li><p>Все правила используют параметр <code>via</code> <em>имя-интерфейса</em> для уточнения интерфейса, через который проходит пакет.</p></li></ul></div><div class=paragraph><p>Следующие правила записываются в <span class=filename>/etc/ipfw.rules</span>.</p></div><div class="literalblock programlisting"><div class=content><pre>################ Начало файла с правилами IPFW ###############################
# Сброс всех правил перед началом работы скрипта.
ipfw -q -f flush

# Префикс для создания правил
cmd=&#34;ipfw -q add&#34;
pif=&#34;dc0&#34;		# название внешнего интерфейса,
			# принадлежащего глобальной сети

#################################################################
# Нет ограничений на внутреннем интерфейсе локальной сети
# Нет необходимости в этом, если у вас нет локальной сети.
# Замените xl0 на название интерфейса вашей локальной сети
#################################################################
#$cmd 00005 allow all from any to any via xl0

#################################################################
# Нет ограничений на интерфейсе Loopback
#################################################################
$cmd 00010 allow all from any to any via lo0

#################################################################
# Разрешить пакет, если он был ранее добавлен в &#34;динамическую&#34;
# таблицу при помощи выражения allow keep-state
#################################################################
$cmd 00015 check-state

#################################################################
# Раздел правил для исходящего трафика на внешнем интерфейсе
# Анализ запросов начала сессии, идущих из-за межсетевого экрана
# в локальную сеть или от этого шлюза в интернет.
#################################################################

# Разрешить исходящий трафик к DNS серверу провайдера
# x.x.x.x должен быть IP адресом DNS сервера вашего провайдера
# Продублируйте эти строки, если у вас больше одного DNS сервера
# Эти IP адреса можно взять из файла /etc/resolv.conf
$cmd 00110 allow tcp from any to x.x.x.x 53 out via $pif setup keep-state
$cmd 00111 allow udp from any to x.x.x.x 53 out via $pif keep-state

# Разрешить исходящий трафик к DHCP серверу провайдера для cable/DSL конфигураций.
# Это правило не нужно для .user ppp. соединений с глобальной сетью
# в этом случае вы можете удалить эти правила.
# Используйте это правило для записи необходимого нам IP адреса в лог-файл.
# Затем укажите IP адрес в закомментированном правиле и удалите первое правило.
$cmd 00120 allow log udp from any to any 67 out via $pif keep-state
#$cmd 00120 allow udp from any to x.x.x.x 67 out via $pif keep-state

# Разрешить исходящий трафик для незащищенного www соединения
$cmd 00200 allow tcp from any to any 80 out via $pif setup keep-state

# Разрешить исходящий трафик для защищенного www соединения
# https с поддержкой TLS и SSL
$cmd 00220 allow tcp from any to any 443 out via $pif setup keep-state

# Разрешить исходящий POP/SMTP
$cmd 00230 allow tcp from any to any 25 out via $pif setup keep-state
$cmd 00231 allow tcp from any to any 110 out via $pif setup keep-state

# Разрешить исходящий трафик для FreeBSD (make install &amp; CVSUP)
# По сути назначаем пользователю root полные привилегии.
$cmd 00240 allow tcp from me to any out via $pif setup keep-state uid root

# Разрешаем исходящий icmp ping
$cmd 00250 allow icmp from any to any out via $pif keep-state

# Разрешаем исходящий трафик Time
$cmd 00260 allow tcp from any to any 37 out via $pif setup keep-state

# Разрешаем исходящий трафик nntp news
$cmd 00270 allow tcp from any to any 119 out via $pif setup keep-state

# Разрешаем исходящий защищённый трафик FTP, Telnet и SCP
# Эта функция использует SSH (secure shell)
$cmd 00280 allow tcp from any to any 22 out via $pif setup keep-state

# Разрешаем исходящий трафик whois
$cmd 00290 allow tcp from any to any 43 out via $pif setup keep-state

# Запрещаем и заносим в журнал остальной исходящий трафик.
# Обеспечивает политику межсетевого экрана закрытого типа
$cmd 00299 deny log all from any to any out via $pif

#################################################################
# Раздел правил для входящего трафика на внешнем интерфейсе
# Анализ пакетов, приходящих из глобальной сети,
# предназначенных для этого шлюза или локальной сети
########################################################################

# Запрещаем весь входящий трафик с немаршрутизируемых сетей
$cmd 00300 deny all from 192.168.0.0/16 to any in via $pif  #RFC 1918 private IP
$cmd 00301 deny all from 172.16.0.0/12 to any in via $pif     #RFC 1918 private IP
$cmd 00302 deny all from 10.0.0.0/8 to any in via $pif          #RFC 1918 private IP
$cmd 00303 deny all from 127.0.0.0/8 to any in via $pif        #loopback
$cmd 00304 deny all from 0.0.0.0/8 to any in via $pif            #loopback
$cmd 00305 deny all from 169.254.0.0/16 to any in via $pif   #DHCP auto-config
$cmd 00306 deny all from 192.0.2.0/24 to any in via $pif       #reserved for docs
$cmd 00307 deny all from 204.152.64.0/23 to any in via $pif  #Sun cluster interconnect
$cmd 00308 deny all from 224.0.0.0/3 to any in via $pif         #Class D &amp; E multicast

# Запрещаем пинг извне
$cmd 00310 deny icmp from any to any in via $pif

# Запрещаем ident
$cmd 00315 deny tcp from any to any 113 in via $pif

# Запрещаем все Netbios службы. 137=name, 138=datagram, 139=session
# Netbios это MS/Windows сервис обмена.
# Блокируем MS/Windows hosts2 запросы сервера имен на порту 81
$cmd 00320 deny tcp from any to any 137 in via $pif
$cmd 00321 deny tcp from any to any 138 in via $pif
$cmd 00322 deny tcp from any to any 139 in via $pif
$cmd 00323 deny tcp from any to any 81 in via $pif

# Запрещаем любые опоздавшие пакеты
$cmd 00330 deny all from any to any frag in via $pif

# Запрещаем ACK пакеты, которые не соответствуют динамической таблице правил.
$cmd 00332 deny tcp from any to any established in via $pif

# Разрешаем входящий трафик с DHCP сервера провайдера.  Это правило
# должно содержать IP адрес DHCP сервера вашего провайдера, поскольку
# только ему разрешено отправлять пакеты данного типа.  Необходимо только
# для проводных и DSL соединений.  Для &#39;user ppp&#39; соединений с глобальной
# сетью использовать это правило нет необходимости.  Это тот же IP адрес,
# выбранный и используемый вами в разделе правил для исходящего трафика.
#$cmd 00360 allow udp from any to x.x.x.x 67 in via $pif keep-state

# Разрешить входящий трафик для www, так как я использую сервер apache
$cmd 00400 allow tcp from any to me 80 in via $pif setup limit src-addr 2

# Разрешить входящий трафик безопасных FTP, Telnet и SCP из глобальной сети
$cmd 00410 allow tcp from any to me 22 in via $pif setup limit src-addr 2

# Разрешить входящий нешифрованный трафик Telnet из глобальной сети
# считается небезопасным, потому что ID и PW передаются через глобальную
# сеть в открытом виде.
# Удалите этот шаблон, если вы не используете telnet.
$cmd 00420 allow tcp from any to me 23 in via $pif setup limit src-addr 2

# Отбрасываем и заносим в журнал все входящие соединения снаружи
$cmd 00499 deny log all from any to any in via $pif

# Всё остальное запрещено по умолчанию
# Запрещаем и заносим в журнал все пакеты для дальнейшего анализа
$cmd 00999 deny log all from any to any
################ Конец файла правил IPFW ###############################</pre></div></div></div><div class=sect3><h4 id=_пример_правил_с_сохранением_состояний_и_поддержкой_nat>26.6.5.7. Пример правил с сохранением состояний и поддержкой NAT<a class=anchor href=#_пример_правил_с_сохранением_состояний_и_поддержкой_nat></a></h4><div class=paragraph><p>Здесь перечислены некоторые дополнительные конфигурационные параметры, которые нужно включить, чтобы активировать функцию NAT в IPFW. В файл конфигурации ядра к остальным параметрам IPFIREWALL нужно добавить строку <code>option IPDIVERT</code>.</p></div><div class=paragraph><p>В дополнение к обычным параметрам IPFW в <span class=filename>/etc/rc.conf</span> добавим следующее:</p></div><div class="literalblock programlisting"><div class=content><pre>natd_enable=&#34;YES&#34;		# Включить функцию NATD
natd_interface=&#34;rl0&#34;		# Название внешнего сетевого интерфейса
natd_flags=&#34;-dynamic -m&#34;	# -m = по возможности сохранить номера портов</pre></div></div><div class=paragraph><p>Использование динамических правил с правилом <code>divert natd</code> (Network Address Translation) значительно затрудняет логику составления правил. Расположение <code>check-state</code> и <code>divert natd</code> в таблице правил влияет на поведение межсетевого экрана. Это уже не просто последовательный логический поток. При применении вышеозначенных параметров становится доступным новый тип действия <code>skipto</code>. При использовании <code>skipto</code> нумерация правил становится обязательной. В качестве аргумента <code>skipto</code> используется номер правила, к которому нужно перейти.</p></div><div class=paragraph><p>Ниже последует пример метода кодирования, не снабженный комментариями, приведенный здесь для внесения ясности относительно последовательности прохождения пакетов через набор правил.</p></div><div class=paragraph><p>Обработка правил начинается с первого по счету и идет последовательно, по правилу за раз, до достижения конца файла, либо если проверяемый пакет соответствует критериям фильтрации; в последнем случае пакет покидает межсетевой экран. Для правил под номерами 100, 101, 450, 500 и 510 важен порядок их расположения. Эти правила управляют трансляцией исходящих и входящих пакетов, таким образом в таблицу keep-state заносятся только приватные IP адреса локальной сети. Обратите внимание, что все правила allow и deny указывают направление, по которому передается пакет (исходящее или входящее) и сетевой интерфейс. Также стоит отметить, что все запросы начала исходящей сессии передаются с использованием <code>skipto rule 500</code> для трансляции адресов.</p></div><div class=paragraph><p>Предположим, что пользователь локальной сети запрашивает страницу через браузер. Веб-страницы передаются по порту 80. Пакет входит в межсетевой экран. Этот пакет не попадает под правило 100, потому что в критериях фильтрации этого правила указан параметр <code>in</code>. Этот пакет не попадает под правило 101, потому что это первый пакет сессии и он еще не был занесен в динамическую таблицу keep-state. Достигнув, наконец, правила 125, пакет удовлетворяет всем критериям фильтрации. Этот пакет является выходящим из интерфейса, взаимодействующим с глобальной сетью. На данном этапе у пакета в качестве исходящего адреса всё еще указан приватный IP адрес локальной сети. По условию этого правила к пакету применяются два действия. Параметр <code>keep-state</code> создаст новую запись в динамической таблице keep-state, и выполнится действие, указанное в правиле. Указанное действие является частью информации, заносимой в динамическую таблицу. В данном случае это <code>skipto rule 500</code>. Правило 500 транслирует (NAT) адреса пакета и отпускает его наружу. Данное замечание очень важно. Этот пакет идет к цели, где генерируется ответный пакет и отправляется обратно. Этот новый пакет входит в начало списка правил. На этот раз пакет соответствует правилу 100 и его IP адрес назначения транслируется обратно на соответствующий IP адрес локальной сети. Затем он обрабатывается правилом <code>check-state</code>, и поскольку для него уже присутствует в динамической таблице правило, соответствующее данной сессии, пакет пропускается в локальную сеть. Дальше пакет приходит к отправившему его компьютеру локальной сети, и генерируется новый пакет, запрашивающий новую порцию данных с удаленного сервера. На этот раз пакет сразу проверяется правилом <code>check-state</code>, и в случае присутствия исходящей записи данного пакета выполняется действие <code>skipto 500</code>. Пакет переходит к правилу 500, транслируется и пропускается во внешнюю сеть.</p></div><div class=paragraph><p>Для входящего трафика все пакеты, являющиеся частью уже установленной сессии, автоматически разбираются правилом <code>check-state</code> и правильно расположенными правилами <code>divert natd</code>. Всё, что нам остается сделать, это запретить все плохие пакеты и разрешить прохождение внутрь сети пакетов только для разрешенных сервисов. Допустим, на сервере с межсетевым экраном запущен apache, и мы хотим разрешить людям из глобальной сети доступ на локальный веб-сайт. Новый входящий пакет, запрашивающий начало сессии, соответствует правилу 100, и его IP адрес транслируется как локальный IP системы с межсетевым экраном. Далее пакет проверяется на соответствие вредоносному трафику и в случае отсутствия соответствия попадает на правило 425. В случае соответствия данному правилу происходят две вещи. Пакет правил помещается в динамическую таблицу keep-state, но в этот раз любая новая сессия запросов, порожденных с этого IP, ограничена 2 одновременными соединениями. Это защищает от перегрузки сервис, работающей по указанному номеру порта. В качестве действия в правиле указан <code>allow</code>, следовательно пакет пропускается в локальную сеть. Пакет, сформированный в качестве ответа, попадает под <code>check-state</code> и распознается им как принадлежащий существующей сессии. Далее он передаётся на правило 500, где происходит обратная трансляция, после чего пакет пропускается на внешний интерфейс.</p></div><div class=paragraph><p>Пример файла правил #1:</p></div><div class="literalblock programlisting"><div class=content><pre>#!/bin/sh
cmd=&#34;ipfw -q add&#34;
skip=&#34;skipto 500&#34;
pif=rl0
ks=&#34;keep-state&#34;
good_tcpo=&#34;22,25,37,43,53,80,443,110,119&#34;

ipfw -q -f flush

$cmd 002 allow all from any to any via xl0  # разрешаем трафик на локальном интерфейсе
$cmd 003 allow all from any to any via lo0  # разрешаем трафик на интерфейсе loopback

$cmd 100 divert natd ip from any to any in via $pif
$cmd 101 check-state

# Разрешенные исходящие пакеты
$cmd 120 $skip udp from any to xx.168.240.2 53 out via $pif $ks
$cmd 121 $skip udp from any to xx.168.240.5 53 out via $pif $ks
$cmd 125 $skip tcp from any to any $good_tcpo out via $pif setup $ks
$cmd 130 $skip icmp from any to any out via $pif $ks
$cmd 135 $skip udp from any to any 123 out via $pif $ks

# Запрещаем весь входящий трафик с немаршрутизируемых адресных пространств
$cmd 300 deny all from 192.168.0.0/16  to any in via $pif  #RFC 1918 для локальных IP
$cmd 301 deny all from 172.16.0.0/12   to any in via $pif  #RFC 1918 для локальных IP
$cmd 302 deny all from 10.0.0.0/8      to any in via $pif  #RFC 1918 для локальных IP
$cmd 303 deny all from 127.0.0.0/8     to any in via $pif  #loopback
$cmd 304 deny all from 0.0.0.0/8       to any in via $pif  #loopback
$cmd 305 deny all from 169.254.0.0/16  to any in via $pif  #DHCP авто-конфигурации
$cmd 306 deny all from 192.0.2.0/24    to any in via $pif  #Зарезервировано для документации
$cmd 307 deny all from 204.152.64.0/23 to any in via $pif  #Sun cluster
$cmd 308 deny all from 224.0.0.0/3     to any in via $pif  #Class D &amp; E multicast

# Разрешаем входящие пакеты
$cmd 400 allow udp from xx.70.207.54 to any 68 in $ks
$cmd 420 allow tcp from any to me 80 in via $pif setup limit src-addr 1

$cmd 450 deny log ip from any to any

# Раздел skipto для правил с сохранением состояния для исходящих пакетов
$cmd 500 divert natd ip from any to any out via $pif
$cmd 510 allow ip from any to any

######################## Окончание файла правил ##################</pre></div></div><div class=paragraph><p>Следующий пример во многом повторяет то, что приведено выше, но использует самодокументирующий стиль записи с исчерпывающими комментариями для того, чтобы помочь начинающему составителю правил IPFW лучше понимать, для чего предназначено то или иное правило.</p></div><div class=paragraph><p>Пример файла правил #2:</p></div><div class="literalblock programlisting"><div class=content><pre>#!/bin/sh
################ Начало файла правил IPFW ###############################
# Сброс всех правил перед началом работы скрипта.
ipfw -q -f flush

# Задание стандартных переменных
cmd=&#34;ipfw -q add&#34;
skip=&#34;skipto 800&#34;
pif=&#34;rl0&#34;		# название внешнего интерфейса,
			# принадлежащего глобальной сети

#################################################################
# Нет ограничений на внутреннем интерфейсе локальной сети
# Замените xl0 на название интерфейса вашей локальной сети
#################################################################
$cmd 005 allow all from any to any via xl0

#################################################################
# Нет ограничений на интерфейсе Loopback
#################################################################
$cmd 010 allow all from any to any via lo0

#################################################################
# Трансляция адреса, если пакет является входящим
#################################################################
$cmd 014 divert natd ip from any to any in via $pif

#################################################################
# Разрешить пакет, если он был ранее добавлен в динамическую
# таблицу при помощи выражения allow keep-state
#################################################################
$cmd 015 check-state

#################################################################
# Раздел правил для исходящего трафика на внешнем интерфейсе
# Анализ запросов начала сессии, идущих из-за межсетевого экрана
# в локальную сеть или от этого шлюза в интернет.
#################################################################

# Разрешить исходящий трафик к DNS серверу провайдера
# x.x.x.x должен быть IP адресом DNS сервера вашего провайдера
# Продублируйте эти строки, если у вас больше одного DNS сервер
# Эти IP адреса можно взять из файла /etc/resolv.conf
$cmd 020 $skip tcp from any to x.x.x.x 53 out via $pif setup keep-state

# Разрешить исходящий трафик к DHCP серверу провайдера для cable/DSL конфигураций.
$cmd 030 $skip udp from any to x.x.x.x 67 out via $pif keep-state

# Разрешить исходящий трафик для незащищенного www соединения
$cmd 040 $skip tcp from any to any 80 out via $pif setup keep-state

# Разрешить исходящий трафик для защищенного www соединения
# https с поддержкой TLS и SSL
$cmd 050 $skip tcp from any to any 443 out via $pif setup keep-state

# Разрешить исходящий POP/SMTP
$cmd 060 $skip tcp from any to any 25 out via $pif setup keep-state
$cmd 061 $skip tcp from any to any 110 out via $pif setup keep-state

# Разрешить исходящий трафик для FreeBSD (make install &amp; CVSUP)
# По сути назначаем пользователю root полные привилегии.
$cmd 070 $skip tcp from me to any out via $pif setup keep-state uid root

# Разрешаем исходящий icmp ping
$cmd 080 $skip icmp from any to any out via $pif keep-state

# Разрешаем исходящий трафик Time
$cmd 090 $skip tcp from any to any 37 out via $pif setup keep-state

# Разрешаем исходящий трафик nntp news (т.е. news groups)
$cmd 100 $skip tcp from any to any 119 out via $pif setup keep-state

# Разрешаем исходящий защищённый трафик FTP, Telnet и SCP
# Эта функция использует SSH (secure shell)
$cmd 110 $skip tcp from any to any 22 out via $pif setup keep-state

# Разрешаем исходящий трафик whois
$cmd 120 $skip tcp from any to any 43 out via $pif setup keep-state

# Разрешаем исходящий трафик ntp
$cmd 130 $skip udp from any to any 123 out via $pif keep-state

#################################################################
# Раздел правил для входящего трафика на внешнем интерфейсе
# Анализ пакетов, приходящих из глобальной сети,
# предназначенных для этого шлюза или локальной сети
#################################################################

# Запрещаем весь входящий трафик с немаршрутизируемых сетей
$cmd 300 deny all from 192.168.0.0/16  to any in via $pif  #RFC 1918 private IP
$cmd 301 deny all from 172.16.0.0/12   to any in via $pif  #RFC 1918 private IP
$cmd 302 deny all from 10.0.0.0/8      to any in via $pif  #RFC 1918 private IP
$cmd 303 deny all from 127.0.0.0/8     to any in via $pif  #loopback
$cmd 304 deny all from 0.0.0.0/8       to any in via $pif  #loopback
$cmd 305 deny all from 169.254.0.0/16  to any in via $pif  #DHCP auto-config
$cmd 306 deny all from 192.0.2.0/24    to any in via $pif  #reserved for docs
$cmd 307 deny all from 204.152.64.0/23 to any in via $pif  #Sun cluster
$cmd 308 deny all from 224.0.0.0/3     to any in via $pif  #Class D &amp; E multicast

# Запрещаем ident
$cmd 315 deny tcp from any to any 113 in via $pif

# Запрещаем все Netbios службы. 137=name, 138=datagram, 139=session
# Netbios это MS/Windows сервис обмена.
# Блокируем MS/Windows hosts2 запросы сервера имен на порту 81
$cmd 320 deny tcp from any to any 137 in via $pif
$cmd 321 deny tcp from any to any 138 in via $pif
$cmd 322 deny tcp from any to any 139 in via $pif
$cmd 323 deny tcp from any to any 81  in via $pif

# Запрещаем любые опоздавшие пакеты
$cmd 330 deny all from any to any frag in via $pif

# Запрещаем ACK пакеты, которые не соответствуют динамической таблице правил.
$cmd 332 deny tcp from any to any established in via $pif

# Разрешаем входящий трафик с DHCP сервера провайдера. Это правило
# должно содержать IP адрес DHCP сервера вашего провайдера, поскольку
# только ему разрешено отправлять пакеты данного типа. Необходимо только
# для проводных и DSL соединений. Для &#39;user ppp&#39; соединений с глобальной
# сетью использовать это правило нет необходимости. Это тот же IP адрес,
# выбранный и используемый вами в разделе правил для исходящего трафика.
$cmd 360 allow udp from x.x.x.x to any 68 in via $pif keep-state

# Разрешить входящий трафик для www, т.к. я использую Apache сервер.
$cmd 370 allow tcp from any to me 80 in via $pif setup limit src-addr 2

# Разрешить входящий трафик безопасных FTP, Telnet и SCP из глобальной сети
$cmd 380 allow tcp from any to me 22 in via $pif setup limit src-addr 2

# Разрешить входящий нешифрованный трафик Telnet из глобальной сети
# считается небезопасным, потому что ID и PW передаются через глобальную
# сеть в открытом виде.
# Удалите этот шаблон, если вы не используете telnet.
$cmd 390 allow tcp from any to me 23 in via $pif setup limit src-addr 2

# Отбрасываем и заносим в журнал все неразрешенные входящие соединения из глобальной сети
$cmd 400 deny log all from any to any in via $pif

# Отбрасываем и заносим в журнал все неразрешенные исходящие соединения в глобальную сеть
$cmd 450 deny log all from any to any out via $pif

# Место для skipto в правилах с сохранением состояния для исходящих соединений
$cmd 800 divert natd ip from any to any out via $pif
$cmd 801 allow ip from any to any

# Всё остальное запрещено по умолчанию
# Запрещаем и заносим в журнал все пакеты для дальнейшего анализа
$cmd 999 deny log all from any to any
################ Окончание файла правил IPFW ###############################</pre></div></div></div></div></div></div></div><hr><div class=last-modified><p><strong>Изменено</strong>: 9 марта 2024 г. by <a href="https://cgit.freebsd.org/doc/commit/?id=6199af92e7" target=_blank>Danilo G. Baio</a></p></div><div class=buttons><div class=prev><i class="fa fa-angle-left" aria-hidden=true title=Назад></i><div class=container><a href=http://172.16.201.134:1313/ru/books/handbook/network-servers class=direction>Назад</a></div></div><div class=home><i class="fa fa-home" aria-hidden=true title=Главная></i><div class=container><a href=../ class=direction>Главная</a></div></div><div class=next><div class=container><a href=http://172.16.201.134:1313/ru/books/handbook/advanced-networking class=direction>Далее</a></div><i class="fa fa-angle-right" aria-hidden=true title=Далее></i></div></div><label class="hidden book-menu-overlay" for=menu-control></label></div><aside class=toc><div class=toc-content><h3>Содержание</h3><nav id=TableOfContents><ul><li><a href=#firewalls-intro>26.1. Введение</a></li><li><a href=#firewalls-concepts>26.2. Принципы работы межсетевых экранов</a></li><li><a href=#firewalls-apps>26.3. Пакеты межсетевых экранов</a></li><li><a href=#firewalls-pf>26.4. Packet Filter (PF, межсетевой экран OpenBSD) и ALTQ</a></li><li><a href=#firewalls-ipf>26.5. * IPFILTER (IPF)</a></li><li><a href=#firewalls-ipfw>26.6. IPFW</a></li></ul></nav><hr><div class=resources><h3>Материалы</h3><ul class=contents><li><i class="fa fa-file-pdf-o" aria-hidden=true title="Скачать PDF"></i><a href=https://download.freebsd.org/doc/ru/books/handbook/handbook_ru.pdf>Скачать PDF</a></li><li><i class="fa fa-pencil-square-o" aria-hidden=true title="Редактировать эту страницу"></i><a href=https://github.com/freebsd/freebsd-doc/blob/main/documentation/content/ru/_index target=_blank>Редактировать эту страницу</a></li></ul></div></div></aside><a class=to-top href=#top><i class="fa fa-arrow-circle-up" aria-hidden=true></i></a></main><footer><div class=footer-container><section class=logo-column><img src=http://172.16.201.134:1313/images/FreeBSD-colors.svg width=160 height=50 alt="FreeBSD logo"><div class=options-container><div class=language-container><a id=languages href=http://172.16.201.134:1313/ru/languages><img src=http://172.16.201.134:1313/images/language.png class=language-image alt="Выберите язык">
<span>Русский</span></a></div><div class=theme-container><select id=theme-chooser><option value=theme-system>Система</option><option value=theme-light>Светлый</option><option value=theme-dark>Тёмный</option><option value=theme-high-contrast>Высокая контрастность</option></select></div></div></section><section class=about-column><h3 class=column-title>О нас</h3><ul class=column-elements-container><li><a href=https://www.freebsd.org/about/ target=_blank class=column-element>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/ target=_blank class=column-element>Фонд FreeBSD</a></li><li><a href=https://www.freebsd.org/where/ target=_blank class=column-element>Получить FreeBSD</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct target=_blank class=column-element>Кодекс Этики</a></li><li><a href=https://www.freebsd.org/security/ target=_blank class=column-element>Бюллетени Безопасности</a></li></ul></section><section class=documentation-column><h3 class=column-title>Документация</h3><ul class=column-elements-container><li><a href=/ru class=column-element>Портал документации</a></li><li><a href=https://man.FreeBSD.org target=_blank class=column-element>Страницы Справочника</a></li><li><a href=https://papers.FreeBSD.org target=_blank class=column-element>Презентации и публикации</a></li><li><a href=https://docs-archive.freebsd.org/doc/ target=_blank class=column-element>Предыдущие версии</a></li><li><a href=https://docs-archive.freebsd.org/44doc/ target=_blank class=column-element>Документы 4.4BSD</a></li><li><a href=https://wiki.freebsd.org/ target=_blank class=column-element>Wiki</a></li></ul></section><section class=community-column><h3 class=column-title>Сообщество</h3><ul class=column-elements-container><li><a href=http://172.16.201.134:1313/ru/articles/contributing class=column-element>Принять участие</a></li><li><a href=https://forums.freebsd.org/ target=_blank class=column-element>Форум Сообщества</a></li><li><a href=https://lists.freebsd.org/ target=_blank class=column-element>Списки рассылки</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank class=column-element>Каналы IRC</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank class=column-element>Трекер ошибок</a></li></ul></section><section class=legal-column><h3 class=column-title>Юридическая информация</h3><ul class=column-elements-container><li><a href=https://freebsdfoundation.org/donate/ target=_blank class=column-element>Пожертвования</a></li><li><a href=https://www.freebsd.org/copyright/freebsd-license/ target=_blank class=column-element>Лицензирование</a></li><li><a href=https://www.freebsd.org/privacy/ target=_blank class=column-element>Политика Конфиденциальности</a></li><li><a href=https://www.freebsd.org/copyright/ target=_blank class=column-element>Юридические оговорки</a></li></ul></section><section class=copyright-column><p>&copy; 1994-2024 Проект FreeBSD. Все права защищены</p><span>Сделано с помощью <span class=heart>♥</span> Сообществом FreeBSD</span></section></div></footer></body></html>