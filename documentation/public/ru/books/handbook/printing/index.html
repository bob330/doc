<!doctype html><html class=theme-light lang=ru><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content><meta name=copyright content="1995-2024 The FreeBSD Foundation"><link rel=canonical href=https://docs.freebsd.org/ru/books/handbook/printing/><title>Глава 10. Печать | FreeBSD Documentation Portal</title>
<meta name=theme-color content="#790000"><meta name=color-scheme content="system light dark high-contrast"><link rel="shortcut icon" href=https://docs.freebsd.org/favicon.ico><link rel=stylesheet href=https://docs.freebsd.org/styles/main.min.css><link rel=stylesheet href=https://docs.freebsd.org/css/font-awesome-min.css><script defer src=/js/theme-chooser.min.js></script><script defer src=/js/copy-clipboard.min.js></script><script defer src=/js/search.min.js></script><meta name=twitter:card content="summary"><meta name=twitter:domain content="docs.FreeBSD.org"><meta name=twitter:site content="@freebsd"><meta name=twitter:url content="https://twitter.com/freebsd"><meta property="og:title" content="Глава 10. Печать"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:image" content="https://docs.freebsd.org/favicon.ico"><meta property="og:image:alt" content="FreeBSD Logo"><meta property="og:locale" content="ru"><meta property="og:url" content="https://docs.freebsd.org/ru/books/handbook/printing/"><meta property="og:site_name" content="FreeBSD Documentation Portal"><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","url":"https:\/\/docs.freebsd.org\/ru\/books\/handbook\/printing\/","name":"FreeBSD Documentation Portal","headline":"FreeBSD Documentation Portal","description":"FreeBSD Documentation Portal"}</script></head><body><header><div class=header-container><div class=logo-menu-bars-container><a href=https://www.FreeBSD.org class=logo><img src=https://docs.freebsd.org/images/FreeBSD-monochromatic.svg width=160 height=50 alt="FreeBSD logo">
</a><label class=menu-bars for=menu-bars><i class="fa fa-bars" aria-hidden=true></i></label></div><input id=menu-bars type=checkbox><nav><ul class=menu><li class=menu-item><input id=about type=checkbox>
<a href=# aria-label="Navigate to About section"><label class=menu-item-description for=about>О нас
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/about/ target=_blank>О нас</a></li><li><a href=https://www.freebsd.org/about/ target=_blank>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/about-us/about-the-foundation/ target=_blank>Фонд FreeBSD</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct/ target=_blank>Кодекс Этики</a></li></ul></li><li class=menu-item><input id=download type=checkbox>
<a href=# aria-label="Navigate to get FreeBSD section"><label class=menu-item-description for=download>Получить FreeBSD
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/where/ target=_blank>Получить FreeBSD</a></li><li><a href=https://www.freebsd.org/releases/ target=_blank>Информация о релизах</a></li><li><a href=https://www.freebsd.org/releng/ target=_blank>Подготовка релизов</a></li><li><a href=https://www.freebsd.org/security/ target=_blank>Бюллетени Безопасности</a></li></ul></li><li class=menu-item><input id=documentation type=checkbox>
<a href=# aria-label="Navigate to get Documentation section"><label class=menu-item-description for=documentation>Документация
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=/ru>Портал документации</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook>Руководство</a></li><li><a href=https://docs.freebsd.org/ru/books/porters-handbook>Руководство по созданию портов</a></li><li><a href=https://docs.FreeBSD.org/en/books/fdp-primer>Учебник Проекта Документирования</a></li><li><a href=https://man.FreeBSD.org target=_blank>Страницы Справочника</a></li><li><a href=https://papers.FreeBSD.org target=_blank>Презентации и публикации</a></li><li><a href=https://wiki.FreeBSD.org target=_blank>Wiki</a></li><li><a href=https://docs.freebsd.org/ru/books>Книги</a></li><li><a href=https://docs.freebsd.org/ru/articles>Статьи</a></li></ul></li><li class=menu-item><input id=community type=checkbox>
<a href=# aria-label="Navigate to get Community section"><label class=menu-item-description for=community>Сообщество
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/community/>Сообщество</a></li><li><a href=https://docs.freebsd.org/ru/articles/contributing>Стать участником</a></li><li><a href=https://forums.freebsd.org/ target=_blank>Форум</a></li><li><a href=https://lists.freebsd.org/ target=_blank>Списки рассылки</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank>Каналы IRC</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank>Трекер ошибок</a></li><li><a href=https://www.freebsd.org/support/ target=_blank>Поддержка</a></li></ul></li></ul></nav><div class=search-donate-container><form class=search method=get id=search-header-form action=https://docs.freebsd.org/search name=search-header-form><input type=hidden name=DB value=ru>
<input id=words name=P type=text size=20 maxlength=255>
<button>
<i class="fa fa-search" aria-hidden=true></i></button></form><div class=donate><a href=https://freebsdfoundation.org/donate/ target=_blank><span class=heart>♥</span>
Пожертвования</a></div></div></div></header><input type=checkbox class="hidden toggle" id=menu-control><main class=main-wrapper-book><a id=top></a><aside class=book-menu><div class=book-menu-content><input id=search-book type=text placeholder=Поиск aria-label=Поиск maxlength=128><nav id=MenuContents><ul><li><input type=checkbox id=chapter-eb2a98ce203d8afd517726e6d8776be3 class=toggle>
<label class="icon cursor" for=chapter-eb2a98ce203d8afd517726e6d8776be3><a role=button></a></label><a href=https://docs.freebsd.org/ru/books/handbook/preface/>Предисловие</a><ul><li><a href=https://docs.freebsd.org/ru/books/handbook/preface/#preface-audience>Целевая аудитория</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/preface/#preface-changes-from4>Четвёртое издание</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/preface/#preface-changes-from3>Третье издание</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/preface/#preface-changes-from2>Второе издание (2004)</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/preface/#preface-changes>Первое издание (2001)</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/preface/#preface-overview>Структура этой книги</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/preface/#preface-conv>Договоренности, используемые в этой книге</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/preface/#preface-acknowledgements>Благодарности</a></li></ul></li><li><input type=checkbox id=chapter-14a525fce014b90b8a458a894818255a class=toggle>
<label for=chapter-14a525fce014b90b8a458a894818255a><a role=button></a></label><a href=https://docs.freebsd.org/ru/books/handbook/parti/>Часть I. В начале</a></li><li><input type=checkbox id=chapter-f9c9f3451644df30d224350da97d5da6 class=toggle>
<label class="icon cursor" for=chapter-f9c9f3451644df30d224350da97d5da6><a role=button></a></label><a href=https://docs.freebsd.org/ru/books/handbook/introduction/>Глава 1. Введение</a><ul><li><a href=https://docs.freebsd.org/ru/books/handbook/introduction/#introduction-synopsis>1.1. Краткий обзор</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/introduction/#nutshell>1.2. Добро пожаловать во FreeBSD!</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/introduction/#history>1.3. О Проекте FreeBSD</a></li></ul></li><li><input type=checkbox id=chapter-6aaec170775233b7c45f6cdcfb70d466 class=toggle>
<label class="icon cursor" for=chapter-6aaec170775233b7c45f6cdcfb70d466><a role=button></a></label><a href=https://docs.freebsd.org/ru/books/handbook/install/>Глава 2. Установка FreeBSD версий 8.X и более ранних</a><ul><li><a href=https://docs.freebsd.org/ru/books/handbook/install/#install-synopsis>2.1. Краткий обзор</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/install/#install-hardware>2.2. Аппаратные требования</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/install/#install-pre>2.3. Перед установкой</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/install/#install-start>2.4. Начало установки</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/install/#using-sysinstall>2.5. Введение в Sysinstall</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/install/#install-steps>2.6. Выделение дискового пространства</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/install/#install-choosing>2.7. Выбор устанавливаемых компонентов</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/install/#install-media>2.8. Выбор источника для установки</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/install/#install-final-warning>2.9. Подтверждение установки</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/install/#install-post>2.10. После установки</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/install/#install-trouble>2.11. Решение проблем</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/install/#install-advanced>2.12. Расширенное руководство по установке</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/install/#install-diff-media>2.13. Подготовка собственного источника установки</a></li></ul></li><li><input type=checkbox id=chapter-f693a3fa687a72d63ec8129ee302d664 class=toggle>
<label class="icon cursor" for=chapter-f693a3fa687a72d63ec8129ee302d664><a role=button></a></label><a href=https://docs.freebsd.org/ru/books/handbook/bsdinstall/>Глава 3. Установка FreeBSD версий 9.X и более поздних</a><ul><li><a href=https://docs.freebsd.org/ru/books/handbook/bsdinstall/#bsdinstall-synopsis>3.1. Краткий обзор</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/bsdinstall/#bsdinstall-hardware>3.2. Аппаратные требования</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/bsdinstall/#bsdinstall-pre>3.3. Перед установкой</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/bsdinstall/#bsdinstall-start>3.4. Начало установки</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/bsdinstall/#using-bsdinstall>3.5. Введение в bsdinstall</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/bsdinstall/#bsdinstall-netinstall>3.6. Установка по сети</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/bsdinstall/#bsdinstall-partitioning>3.7. Выделение дискового пространства</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/bsdinstall/#bsdinstall-final-warning>3.8. Завершение установки</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/bsdinstall/#bsdinstall-post>3.9. После установки</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/bsdinstall/#bsdinstall-install-trouble>3.10. Решение проблем</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/bsdinstall/#using-live-cd>3.11. Использование Live CD</a></li></ul></li><li><input type=checkbox id=chapter-9f6db261075f578742036fcc6000eecd class=toggle>
<label class="icon cursor" for=chapter-9f6db261075f578742036fcc6000eecd><a role=button></a></label><a href=https://docs.freebsd.org/ru/books/handbook/basics/>Глава 4. Основы UNIX</a><ul><li><a href=https://docs.freebsd.org/ru/books/handbook/basics/#basics-synopsis>4.1. Краткий обзор</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/basics/#consoles>4.2. Виртуальные консоли и терминалы</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/basics/#users-synopsis>4.3. Пользователи и основы управления учетными записями</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/basics/#permissions>4.4. Права доступа</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/basics/#dirstructure>4.5. Структура каталогов</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/basics/#disk-organization>4.6. Организация дисков</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/basics/#mount-unmount>4.7. Монтирование и размонтирование файловых систем</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/basics/#basics-processes>4.8. Процессы</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/basics/#basics-daemons>4.9. Даемоны, сигналы, уничтожение процессов</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/basics/#shells>4.10. Интерпретатор команд</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/basics/#editors>4.11. Текстовые редакторы</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/basics/#basics-devices>4.12. Устройства и файлы устройств</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/basics/#binary-formats>4.13. Бинарные форматы</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/basics/#basics-more-information>4.14. Дополнительная информация</a></li></ul></li><li><input type=checkbox id=chapter-01c5707e95d14c0ff84bf62600c958d1 class=toggle>
<label class="icon cursor" for=chapter-01c5707e95d14c0ff84bf62600c958d1><a role=button></a></label><a href=https://docs.freebsd.org/ru/books/handbook/ports/>Глава 5. Установка приложений: порты и пакеты</a><ul><li><a href=https://docs.freebsd.org/ru/books/handbook/ports/#ports-synopsis>5.1. Обзор</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/ports/#ports-overview>5.2. Обзор установки программного обеспечения</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/ports/#ports-finding-applications>5.3. Поиск программного обеспечения</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/ports/#packages-using>5.4. Использование бинарных пакетов</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/ports/#pkgng-intro>5.5. Использование pkgng для управления бинарными пакетами</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/ports/#ports-using>5.6. Использование Коллекции Портов</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/ports/#ports-nextsteps>5.7. Действия после установки</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/ports/#ports-broken>5.8. Обработка нерабочих портов</a></li></ul></li><li><input type=checkbox id=chapter-f56428b9e0d0b77cc8e863910f96bbde class=toggle>
<label class="icon cursor" for=chapter-f56428b9e0d0b77cc8e863910f96bbde><a role=button></a></label><a href=https://docs.freebsd.org/ru/books/handbook/wayland/>Глава 6. Wayland</a><ul><li><a href=https://docs.freebsd.org/ru/books/handbook/wayland/#wayland-synopsis>6.1. Общие сведения о Wayland</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/wayland/#wayland-wayfire>6.2. Композитный менеджер Wayfire</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/wayland/#wayland-hikari>6.3. Композитный менеджер Hikari</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/wayland/#wayland-sway>6.4. Композитный менеджер Sway</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/wayland/#wayland-xwayland>6.5. Использование Xwayland</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/wayland/#wayland-remotedesktop>6.6. Организация Удалённого Рабочего Стола при помощи VNC</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/wayland/#wayland-ly>6.7. Менеджер регистраций Wayland</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/wayland/#wayland-utilities>6.8. Полезные Инструменты</a></li></ul></li><li><input type=checkbox id=chapter-3405c00581365a8b5d16af70fe4d1b72 class=toggle>
<label class="icon cursor" for=chapter-3405c00581365a8b5d16af70fe4d1b72><a role=button></a></label><a href=https://docs.freebsd.org/ru/books/handbook/x11/>Глава 6. X Window System</a><ul><li><a href=https://docs.freebsd.org/ru/books/handbook/x11/#x11-synopsis>6.1. Обзор</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/x11/#x-understanding>6.2. Основы X</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/x11/#x-install>6.3. Установка X11</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/x11/#x-config>6.4. Конфигурация X11</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/x11/#x-fonts>6.5. Использование шрифтов в X11</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/x11/#x-xdm>6.6. Менеджеры экранов (Display Managers) X</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/x11/#x11-wm>6.7. Графические оболочки</a></li></ul></li><li><input type=checkbox id=chapter-0eab3565e8f59f5a8a896dfba7eb3680 class=toggle>
<label for=chapter-0eab3565e8f59f5a8a896dfba7eb3680><a role=button></a></label><a href=https://docs.freebsd.org/ru/books/handbook/partii/>Часть II. Общие задачи</a></li><li><input type=checkbox id=chapter-b33cf28993f3f7bf5baf036e79da0f39 class=toggle>
<label class="icon cursor" for=chapter-b33cf28993f3f7bf5baf036e79da0f39><a role=button></a></label><a href=https://docs.freebsd.org/ru/books/handbook/desktop/>Глава 7. Приложения для настольного компьютера</a><ul><li><a href=https://docs.freebsd.org/ru/books/handbook/desktop/#desktop-synopsis>7.1. Краткий обзор</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/desktop/#desktop-browsers>7.2. Браузеры</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/desktop/#desktop-productivity>7.3. Бизнес приложения</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/desktop/#desktop-viewers>7.4. Программы просмотра документов</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/desktop/#desktop-finance>7.5. Финансовые программы</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/desktop/#desktop-summary>7.6. Итоги</a></li></ul></li><li><input type=checkbox id=chapter-152f694a19312ad72ec7bb4e1c3c33b2 class=toggle>
<label class="icon cursor" for=chapter-152f694a19312ad72ec7bb4e1c3c33b2><a role=button></a></label><a href=https://docs.freebsd.org/ru/books/handbook/multimedia/>Глава 8. Мультимедиа</a><ul><li><a href=https://docs.freebsd.org/ru/books/handbook/multimedia/#multimedia-synopsis>8.1. Краткий обзор</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/multimedia/#sound-setup>8.2. Настройка звуковой карты</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/multimedia/#sound-mp3>8.3. Звук MP3</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/multimedia/#video-playback>8.4. Воспроизведение видео</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/multimedia/#tvcard>8.5. Настройка ТВ тюнеров</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/multimedia/#scanners>8.6. Сканеры</a></li></ul></li><li><input type=checkbox id=chapter-80888b4ee02e3e409e5f71cf97a36450 class=toggle>
<label class="icon cursor" for=chapter-80888b4ee02e3e409e5f71cf97a36450><a role=button></a></label><a href=https://docs.freebsd.org/ru/books/handbook/kernelconfig/>Глава 9. Настройка ядра FreeBSD</a><ul><li><a href=https://docs.freebsd.org/ru/books/handbook/kernelconfig/#kernelconfig-synopsis>9.1. Краткий обзор</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/kernelconfig/#kernelconfig-custom-kernel>9.2. Зачем собирать собственное ядро?</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/kernelconfig/#kernelconfig-devices>9.3. Определение аппаратного обеспечения</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/kernelconfig/#kernelconfig-modules>9.4. Драйвера, подсистемы и модули ядра</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/kernelconfig/#kernelconfig-building>9.5. Сборка и установка собственного ядра</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/kernelconfig/#kernelconfig-config>9.6. Конфигурационный файл</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/kernelconfig/#kernelconfig-trouble>9.7. Решение проблем</a></li></ul></li><li><input type=checkbox id=chapter-cb174c55879b17ab955f2f16989a79e0 class=toggle checked>
<label class="icon cursor" for=chapter-cb174c55879b17ab955f2f16989a79e0><a role=button></a></label><a href=https://docs.freebsd.org/ru/books/handbook/printing/>Глава 10. Печать</a><ul><li><a href=https://docs.freebsd.org/ru/books/handbook/printing/#printing-synopsis>10.1. Краткий обзор</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/printing/#printing-intro-spooler>10.2. Введение</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/printing/#printing-intro-setup>10.3. Основная настройка</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/printing/#printing-advanced>10.4. Расширенная настройка принтера</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/printing/#printing-using>10.5. Использование принтеров</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/printing/#printing-lpd-alternatives>10.6. Альтернативы стандартному спулеру</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/printing/#printing-troubleshooting>10.7. Выявление проблем</a></li></ul></li><li><input type=checkbox id=chapter-c12b8c3f2a8fcefce87087241f695c83 class=toggle>
<label class="icon cursor" for=chapter-c12b8c3f2a8fcefce87087241f695c83><a role=button></a></label><a href=https://docs.freebsd.org/ru/books/handbook/linuxemu/>Глава 11. Двоичная совместимость с Linux</a><ul><li><a href=https://docs.freebsd.org/ru/books/handbook/linuxemu/#linuxemu-synopsis>11.1. Краткий обзор</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/linuxemu/#linuxemu-lbc-install>11.2. Установка</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/linuxemu/#linuxemu-mathematica>11.3. Установка Mathematica®</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/linuxemu/#linuxemu-maple>11.4. Установка Maple™</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/linuxemu/#linuxemu-matlab>11.5. Установка MATLAB®</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/linuxemu/#linuxemu-oracle>11.6. Установка Oracle®</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/linuxemu/#sapr3>11.7. Установка SAP® R/3®</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/linuxemu/#linuxemu-advanced>11.8. Дополнительные сведения</a></li></ul></li><li><input type=checkbox id=chapter-03b11ba627b9a0c85b247f5641bde272 class=toggle>
<label for=chapter-03b11ba627b9a0c85b247f5641bde272><a role=button></a></label><a href=https://docs.freebsd.org/ru/books/handbook/partiii/>Часть III. Системное администрирование</a></li><li><input type=checkbox id=chapter-6c31587f8d736319f099cd4dc1961301 class=toggle>
<label class="icon cursor" for=chapter-6c31587f8d736319f099cd4dc1961301><a role=button></a></label><a href=https://docs.freebsd.org/ru/books/handbook/config/>Глава 12. Настройка и оптимизация</a><ul><li><a href=https://docs.freebsd.org/ru/books/handbook/config/#config-synopsis>12.1. Введение</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/config/#configtuning-initial>12.2. Начальное конфигурирование</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/config/#configtuning-core-configuration>12.3. Основные настройки</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/config/#configtuning-appconfig>12.4. Настройка приложений</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/config/#configtuning-starting-services>12.5. Запуск сервисов</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/config/#configtuning-cron>12.6. Настройка утилиты <code>cron</code></a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/config/#configtuning-rcd>12.7. Использование rc во FreeBSD 5.X и последующих версиях</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/config/#config-network-setup>12.8. Настройка карт сетевых интерфейсов</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/config/#configtuning-virtual-hosts>12.9. Настройка виртуальных серверов</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/config/#configtuning-configfiles>12.10. Файлы настройки</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/config/#configtuning-sysctl>12.11. Настройка с помощью sysctl</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/config/#configtuning-disk>12.12. Оптимизация дисков</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/config/#configtuning-kernel-limits>12.13. Изменение ограничений, накладываемых ядром</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/config/#adding-swap-space>12.14. Увеличение объема подкачки</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/config/#acpi-overview>12.15. Управление питанием и ресурсами</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/config/#ACPI-debug>12.16. Использование и отладка FreeBSD ACPI</a></li></ul></li><li><input type=checkbox id=chapter-459f0012b3b4f0b6b123010f029da5e4 class=toggle>
<label class="icon cursor" for=chapter-459f0012b3b4f0b6b123010f029da5e4><a role=button></a></label><a href=https://docs.freebsd.org/ru/books/handbook/boot/>Глава 13. Процесс загрузки FreeBSD</a><ul><li><a href=https://docs.freebsd.org/ru/books/handbook/boot/#boot-synopsis>13.1. Описание</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/boot/#boot-introduction>13.2. Проблема загрузки</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/boot/#boot-blocks>13.3. Менеджер загрузки и этапы загрузки</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/boot/#boot-kernel>13.4. Взаимодействие с ядром во время загрузки</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/boot/#device-hints>13.5. Хинты устройств</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/boot/#boot-init>13.6. Init: инициализация управления процессами</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/boot/#boot-shutdown>13.7. Процесс остановки системы</a></li></ul></li><li><input type=checkbox id=chapter-917c75fcffbb14d48ed6d0a48e7028f2 class=toggle>
<label class="icon cursor" for=chapter-917c75fcffbb14d48ed6d0a48e7028f2><a role=button></a></label><a href=https://docs.freebsd.org/ru/books/handbook/security/>Глава 14. Безопасность</a><ul><li><a href=https://docs.freebsd.org/ru/books/handbook/security/#security-synopsis>14.1. Краткое описание</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/security/#security-intro>14.2. Введение</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/security/#securing-freebsd>14.3. Защита FreeBSD</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/security/#crypt>14.4. DES, MD5, и шифрование</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/security/#one-time-passwords>14.5. Одноразовые пароли</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/security/#tcpwrappers>14.6. TCP Wrappers</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/security/#kerberosIV>14.7. KerberosIV</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/security/#kerberos5>14.8. Kerberos5</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/security/#openssl>14.9. OpenSSL</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/security/#ipsec>14.10. VPN через IPsec</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/security/#openssh>14.11. OpenSSH</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/security/#fs-acl>14.12. Списки контроля доступа файловой системы (ACL)</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/security/#security-portaudit>14.13. Мониторинг вопросов безопасности в ПО сторонних разработчиков</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/security/#security-advisories>14.14. Сообщения безопасности FreeBSD</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/security/#security-accounting>14.15. Учёт используемых ресурсов</a></li></ul></li><li><input type=checkbox id=chapter-8f4620c77e572cbb58917911a33c73cf class=toggle>
<label class="icon cursor" for=chapter-8f4620c77e572cbb58917911a33c73cf><a role=button></a></label><a href=https://docs.freebsd.org/ru/books/handbook/mac/>Глава 15. Принудительный контроль доступа (MAC)</a><ul><li><a href=https://docs.freebsd.org/ru/books/handbook/mac/#mac-synopsis>15.1. Краткий обзор</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/mac/#mac-inline-glossary>15.2. Ключевые термины этой главы</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/mac/#mac-initial>15.3. Описание MAC</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/mac/#mac-understandlabel>15.4. Метки MAC</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/mac/#mac-modules>15.5. Настройка модулей</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/mac/#mac-bsdextended>15.6. Модуль MAC bsdextended</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/mac/#mac-ifoff>15.7. Модуль MAC ifoff</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/mac/#mac-portacl>15.8. Модуль MAC portacl</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/mac/#mac-labelingpolicies>15.9. Политики MAC, использующие метки</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/mac/#mac-partition>15.10. Модуль MAC partition</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/mac/#mac-mls>15.11. Модуль многоуровневой безопасности MAC (MLS)</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/mac/#mac-biba>15.12. Модуль MAC Biba</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/mac/#mac-lomac>15.13. Модуль MAC LOMAC</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/mac/#mac-implementing>15.14. Реализация защищенной среды с MAC</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/mac/#MAC-examplehttpd>15.15. Другой пример: Использование MAC для защиты веб сервера</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/mac/#mac-troubleshoot>15.16. Решение проблем с инфраструктурой MAC</a></li></ul></li><li><input type=checkbox id=chapter-9598d66a76cb3182057b6bcd775149a0 class=toggle>
<label class="icon cursor" for=chapter-9598d66a76cb3182057b6bcd775149a0><a role=button></a></label><a href=https://docs.freebsd.org/ru/books/handbook/audit/>Глава 16. Аудит событий безопасности</a><ul><li><a href=https://docs.freebsd.org/ru/books/handbook/audit/#audit-synopsis>16.1. Краткий обзор</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/audit/#audit-inline-glossary>16.2. Ключевые понятия</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/audit/#audit-config>16.3. Настройка системы аудита</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/audit/#audit-administration>16.4. Работа с журналами аудита</a></li></ul></li><li><input type=checkbox id=chapter-e1edcad13d9db6e8e4cb645d378ecfaf class=toggle>
<label class="icon cursor" for=chapter-e1edcad13d9db6e8e4cb645d378ecfaf><a role=button></a></label><a href=https://docs.freebsd.org/ru/books/handbook/disks/>Глава 17. Устройства хранения</a><ul><li><a href=https://docs.freebsd.org/ru/books/handbook/disks/#disks-synopsis>17.1. Краткий обзор</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/disks/#disks-naming>17.2. Имена устройств</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/disks/#disks-adding>17.3. Добавление дисков</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/disks/#raid>17.4. RAID</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/disks/#usb-disks>17.5. USB устройства хранения</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/disks/#creating-cds>17.6. Запись и использование оптических носителей (CD)</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/disks/#creating-dvds>17.7. Создание и использование оптических носителей (DVD)</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/disks/#floppies>17.8. Дискеты</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/disks/#backups-tapebackups>17.9. Создание и использование архивных копий на магнитной ленте</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/disks/#backups-floppybackups>17.10. Создание резервных копий на дискетах</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/disks/#backup-strategies>17.11. Стратегии резервного копирования</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/disks/#backup-basics>17.12. Основы технологии резервного копирования</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/disks/#disks-virtual>17.13. Сетевые файловые системы, файловые системы в памяти и с отображением в файл</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/disks/#snapshots>17.14. Мгновенные копии файловых систем</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/disks/#quotas>17.15. Квотирование файловых систем</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/disks/#disks-encrypting>17.16. Шифрование дисковых разделов</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/disks/#swap-encrypting>17.17. Шифрование области подкачки</a></li></ul></li><li><input type=checkbox id=chapter-dde37901a0e0ea32745b67607854900f class=toggle>
<label class="icon cursor" for=chapter-dde37901a0e0ea32745b67607854900f><a role=button></a></label><a href=https://docs.freebsd.org/ru/books/handbook/geom/>Глава 18. GEOM: Модульная инфраструктура преобразования дисковых запросов</a><ul><li><a href=https://docs.freebsd.org/ru/books/handbook/geom/#GEOM-synopsis>18.1. Краткий обзор</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/geom/#GEOM-intro>18.2. Введение в GEOM</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/geom/#GEOM-striping>18.3. RAID0 - Создание дисковой последовательности (Striping)</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/geom/#GEOM-mirror>18.4. RAID1 - Зеркалирование (Mirroring)</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/geom/#geom-ggate>18.5. Сетевые устройства GEOM Gate</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/geom/#geom-glabel>18.6. Метки дисковых устройств</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/geom/#geom-gjournal>18.7. Журналирование UFS средствами GEOM</a></li></ul></li><li><input type=checkbox id=chapter-7af71270807eb7b70cd3eedc6577b254 class=toggle>
<label class="icon cursor" for=chapter-7af71270807eb7b70cd3eedc6577b254><a role=button></a></label><a href=https://docs.freebsd.org/ru/books/handbook/filesystems/>Глава 19. Поддержка файловых систем</a><ul><li><a href=https://docs.freebsd.org/ru/books/handbook/filesystems/#filesystems-synopsis>19.1. Краткий обзор</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/filesystems/#filesystems-zfs>19.2. Файловая система ZFS</a></li></ul></li><li><input type=checkbox id=chapter-49f1e96591c090304ea532012257f4ef class=toggle>
<label class="icon cursor" for=chapter-49f1e96591c090304ea532012257f4ef><a role=button></a></label><a href=https://docs.freebsd.org/ru/books/handbook/l10n/>Глава 20. Локализация - использование и настройка i18n/L10n</a><ul><li><a href=https://docs.freebsd.org/ru/books/handbook/l10n/#l10n-synopsis>20.1. Краткий обзор</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/l10n/#using-localization>20.2. Использование локализации</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/l10n/#l10n-compiling>20.3. Поиск приложений i18n</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/l10n/#lang-setup>20.4. Настройка локализации для некоторых языков</a></li></ul></li><li><input type=checkbox id=chapter-dead2b4c5ea325dd390a9b0dccd8f763 class=toggle>
<label class="icon cursor" for=chapter-dead2b4c5ea325dd390a9b0dccd8f763><a role=button></a></label><a href=https://docs.freebsd.org/ru/books/handbook/cutting-edge/>Глава 21. Обновление системы и смена версии FreeBSD</a><ul><li><a href=https://docs.freebsd.org/ru/books/handbook/cutting-edge/#updating-upgrading-synopsis>21.1. Краткий обзор</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/cutting-edge/#updating-upgrading-freebsdupdate>21.2. Обновление FreeBSD</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/cutting-edge/#updating-upgrading-documentation>21.3. Обновление документации</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/cutting-edge/#current-stable>21.4. Использование ветви разработки</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/cutting-edge/#synching>21.5. Синхронизация исходных текстов</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/cutting-edge/#makeworld>21.6. Пересборка мира</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/cutting-edge/#small-lan>21.7. Отслеживание исходных текстов для нескольких машин</a></li></ul></li><li><input type=checkbox id=chapter-bbd25f9a194f9c39ca2d658c75767db5 class=toggle>
<label for=chapter-bbd25f9a194f9c39ca2d658c75767db5><a role=button></a></label><a href=https://docs.freebsd.org/ru/books/handbook/partiv/>Часть IV. Сетевые коммуникации</a></li><li><input type=checkbox id=chapter-499dab596afd7ddac77e80295314e0dd class=toggle>
<label class="icon cursor" for=chapter-499dab596afd7ddac77e80295314e0dd><a role=button></a></label><a href=https://docs.freebsd.org/ru/books/handbook/serialcomms/>Глава 22. Последовательные соединения</a><ul><li><a href=https://docs.freebsd.org/ru/books/handbook/serialcomms/#serial-synopsis>22.1. Краткое описание</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/serialcomms/#serial>22.2. Введение</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/serialcomms/#term>22.3. Терминалы</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/serialcomms/#dialup>22.4. Входящие соединения по модему</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/serialcomms/#dialout>22.5. Исходящие соединения по модему</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/serialcomms/#serialconsole-setup>22.6. Настройка последовательной консоли</a></li></ul></li><li><input type=checkbox id=chapter-95e4571c48bee1cced5e84a538d302e3 class=toggle>
<label class="icon cursor" for=chapter-95e4571c48bee1cced5e84a538d302e3><a role=button></a></label><a href=https://docs.freebsd.org/ru/books/handbook/ppp-and-slip/>Глава 23. PPP и SLIP</a><ul><li><a href=https://docs.freebsd.org/ru/books/handbook/ppp-and-slip/#ppp-and-slip-synopsis>23.1. Краткий обзор</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/ppp-and-slip/#userppp>23.2. PPP уровня пользователя</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/ppp-and-slip/#ppp>23.3. PPP уровня ядра</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/ppp-and-slip/#ppp-troubleshoot>23.4. Решение проблем с соединениями PPP</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/ppp-and-slip/#pppoe>23.5. Использование PPP через Ethernet (PPPoE)</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/ppp-and-slip/#pppoa>23.6. Использование PPP через ATM (PPPoA)</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/ppp-and-slip/#slip>23.7. Использование SLIP</a></li></ul></li><li><input type=checkbox id=chapter-f089ac726c401c9b4bd5c34a295e11bb class=toggle>
<label class="icon cursor" for=chapter-f089ac726c401c9b4bd5c34a295e11bb><a role=button></a></label><a href=https://docs.freebsd.org/ru/books/handbook/mail/>Глава 24. Электронная почта</a><ul><li><a href=https://docs.freebsd.org/ru/books/handbook/mail/#mail-synopsis>24.1. Краткий обзор</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/mail/#mail-using>24.2. Использование электронной почты</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/mail/#sendmail>24.3. Настройка sendmail</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/mail/#mail-changingmta>24.4. Установка другой почтовой программы</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/mail/#mail-trouble>24.5. Поиск и устранение неисправностей</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/mail/#mail-advanced>24.6. Расширенное руководство</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/mail/#outgoing-only>24.7. Настройка почты только для отправки</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/mail/#SMTP-dialup>24.8. Использование почты с коммутируемым соединением</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/mail/#SMTP-Auth>24.9. SMTP аутентификация</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/mail/#mail-agents>24.10. Почтовые программы пользователей</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/mail/#mail-fetchmail>24.11. Использование fetchmail</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/mail/#mail-procmail>24.12. Использование procmail</a></li></ul></li><li><input type=checkbox id=chapter-6de4de3fe925639d4175ce4b6f8c1829 class=toggle>
<label class="icon cursor" for=chapter-6de4de3fe925639d4175ce4b6f8c1829><a role=button></a></label><a href=https://docs.freebsd.org/ru/books/handbook/network-servers/>Глава 25. Сетевые серверы</a><ul><li><a href=https://docs.freebsd.org/ru/books/handbook/network-servers/#network-servers-synopsis>25.1. Краткий обзор</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/network-servers/#network-inetd>25.2. "Супер-сервер"inetd</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/network-servers/#network-nfs>25.3. Network File System (NFS)</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/network-servers/#network-nis>25.4. Network Information System (NIS/YP)</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/network-servers/#network-dhcp>25.5. Автоматическая настройка сети (DHCP)</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/network-servers/#network-dns>25.6. Domain Name System (DNS)</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/network-servers/#network-apache>25.7. Apache HTTP сервер</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/network-servers/#network-samba>25.8. Файл сервер и печать для Microsoft® Windows® клиентов (Samba)</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/network-servers/#network-ftp>25.9. Протокол передачи файлов (FTP)</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/network-servers/#network-ntp>25.10. Синхронизация часов через NTP</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/network-servers/#network-syslogd>25.11. * Remote Host Logging with <code>syslogd</code></a></li></ul></li><li><input type=checkbox id=chapter-776d855c7b75e048f90b5c2c9b35ffe0 class=toggle>
<label class="icon cursor" for=chapter-776d855c7b75e048f90b5c2c9b35ffe0><a role=button></a></label><a href=https://docs.freebsd.org/ru/books/handbook/firewalls/>Глава 26. Межсетевые экраны</a><ul><li><a href=https://docs.freebsd.org/ru/books/handbook/firewalls/#firewalls-intro>26.1. Введение</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/firewalls/#firewalls-concepts>26.2. Принципы работы межсетевых экранов</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/firewalls/#firewalls-apps>26.3. Пакеты межсетевых экранов</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/firewalls/#firewalls-pf>26.4. Packet Filter (PF, межсетевой экран OpenBSD) и ALTQ</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/firewalls/#firewalls-ipf>26.5. * IPFILTER (IPF)</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/firewalls/#firewalls-ipfw>26.6. IPFW</a></li></ul></li><li><input type=checkbox id=chapter-5b07f776a0e6155c1c89aa0d15610380 class=toggle>
<label class="icon cursor" for=chapter-5b07f776a0e6155c1c89aa0d15610380><a role=button></a></label><a href=https://docs.freebsd.org/ru/books/handbook/advanced-networking/>Глава 27. Сложные вопросы работы в сети</a><ul><li><a href=https://docs.freebsd.org/ru/books/handbook/advanced-networking/#advanced-networking-synopsis>27.1. Краткий обзор</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/advanced-networking/#network-routing>27.2. Сетевые шлюзы и маршруты</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/advanced-networking/#network-wireless>27.3. Беспроводные сети</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/advanced-networking/#network-bluetooth>27.4. Bluetooth</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/advanced-networking/#network-bridging>27.5. Мосты</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/advanced-networking/#network-diskless>27.6. Работа с бездисковыми станциями</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/advanced-networking/#network-isdn>27.7. ISDN</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/advanced-networking/#network-natd>27.8. Даемон преобразования сетевых адресов (natd)</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/advanced-networking/#network-plip>27.9. IP по параллельному порту (PLIP)</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/advanced-networking/#network-ipv6>27.10. IPv6</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/advanced-networking/#network-atm>27.11. Асинхронный режим передачи (ATM)</a></li></ul></li><li><input type=checkbox id=chapter-171a77aa9d067a1024f849470e1f33e8 class=toggle>
<label for=chapter-171a77aa9d067a1024f849470e1f33e8><a role=button></a></label><a href=https://docs.freebsd.org/ru/books/handbook/partv/>Часть V. Приложения</a></li><li><input type=checkbox id=chapter-8050f436a0a7986a4aaded93d8e49469 class=toggle>
<label class="icon cursor" for=chapter-8050f436a0a7986a4aaded93d8e49469><a role=button></a></label><a href=https://docs.freebsd.org/ru/books/handbook/mirrors/>Приложение A. Получение FreeBSD</a><ul><li><a href=https://docs.freebsd.org/ru/books/handbook/mirrors/#mirrors-cdrom>A.1. Наборы CD и DVD</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/mirrors/#mirrors-ftp>A.2. FTP сайты</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/mirrors/#ctm>A.3. Использование CTM</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/mirrors/#svn>A.4. Использование Subversion</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/mirrors/#mirrors-rsync>A.5. Использование rsync</a></li></ul></li><li><input type=checkbox id=chapter-128b630a8f88f158e7027fe6c2184d21 class=toggle>
<label class="icon cursor" for=chapter-128b630a8f88f158e7027fe6c2184d21><a role=button></a></label><a href=https://docs.freebsd.org/ru/books/handbook/bibliography/>Приложение B. Библиография</a><ul><li><a href=https://docs.freebsd.org/ru/books/handbook/bibliography/#bibliography-freebsd>B.1. Книги и журналы, специализирующиеся на FreeBSD</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/bibliography/#bibliography-userguides>B.2. Руководства для пользователей</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/bibliography/#bibliography-adminguides>B.3. Руководства для администраторов</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/bibliography/#bibliography-programmers>B.4. Руководства для программистов</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/bibliography/#bibliography-osinternals>B.5. Внутренности операционной системы</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/bibliography/#bibliography-security>B.6. Безопасность</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/bibliography/#bibliography-hardware>B.7. Оборудование</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/bibliography/#bibliography-history>B.8. История UNIX®</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/bibliography/#bibliography-journals>B.9. Прочие издания</a></li></ul></li><li><input type=checkbox id=chapter-8bbb8867c46dac315e2253945d8c18a8 class=toggle>
<label class="icon cursor" for=chapter-8bbb8867c46dac315e2253945d8c18a8><a role=button></a></label><a href=https://docs.freebsd.org/ru/books/handbook/eresources/>Приложение C. Ресурсы в интернет</a><ul><li><a href=https://docs.freebsd.org/ru/books/handbook/eresources/#eresources-mail>C.1. Списки рассылки</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/eresources/#eresources-news>C.2. Новостные группы Usenet</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/eresources/#eresources-web>C.3. Серверы World Wide Web</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook/eresources/#eresources-email>C.4. Адреса Email</a></li></ul></li><li><input type=checkbox id=chapter-a80ea4f5a4480b8725422710f954ef36 class=toggle>
<label class="icon cursor" for=chapter-a80ea4f5a4480b8725422710f954ef36><a role=button></a></label><a href=https://docs.freebsd.org/ru/books/handbook/pgpkeys/>Приложение D. PGP ключи</a><ul><li><a href=https://docs.freebsd.org/ru/books/handbook/pgpkeys/#pgpkeys-officers>D.1. Офицеры</a></li></ul></li><li></li></ul></nav></div></aside><div class=book><div class=book-menu-mobile><label for=menu-control><span class=menu-control-button><i class="fa fa-list" aria-hidden=true title="Меню книг"></i>
Меню книг</span></label></div><h1 class=title>Глава 10. Печать</h1><div class="admonitionblock note"><p><i class="fa fa-exclamation-circle" aria-hidden=true></i>
Этот перевод может быть устаревшим. Для того, чтобы помочь с переводом, пожалуйста, обратитесь к <a href=https://translate-dev.freebsd.org/ target=_blank>Сервер переводов FreeBSD</a>.</p></div><div class=toc-mobile><h3>Содержание</h3><nav id=TableOfContents><ul><li><a href=#printing-synopsis>10.1. Краткий обзор</a></li><li><a href=#printing-intro-spooler>10.2. Введение</a></li><li><a href=#printing-intro-setup>10.3. Основная настройка</a></li><li><a href=#printing-advanced>10.4. Расширенная настройка принтера</a></li><li><a href=#printing-using>10.5. Использование принтеров</a></li><li><a href=#printing-lpd-alternatives>10.6. Альтернативы стандартному спулеру</a></li><li><a href=#printing-troubleshooting>10.7. Выявление проблем</a></li></ul></nav></div><div class=book-content><div id=preamble><div class=sectionbody></div></div><div class=sect1><h2 id=printing-synopsis>10.1. Краткий обзор<a class=anchor href=#printing-synopsis></a></h2><div class=sectionbody><div class=paragraph><p>FreeBSD можно использовать для печати на широком спектре принтеров, от старых матричных до новейших лазерных, без исключений, что позволяет создавать высококачественные распечатки из используемых приложений.</p></div><div class=paragraph><p>FreeBSD можно также сконфигурировать для работы в качестве сервера печати в сети; в этом качестве FreeBSD может получать задания печати от множества других компьютеров, включая другие компьютеры под управлением ОС FreeBSD, хосты Windows® и Mac OS®. FreeBSD будет гарантировать печать заданий по одному и может сохранять информацию о том, какие пользователи и машины выполняют основную часть печати, выдавать страницы-"баннеры", показывающие, кому принадлежит распечатка, и многое другое.</p></div><div class=paragraph><p>При прочтении этой главы вы узнаете:</p></div><div class=ulist><ul><li><p>Как конфигурировать спулер печати FreeBSD.</p></li><li><p>Как устанавливать фильтры печати для специфической обработки определенных заданий печати, включая преобразование поступающих на печать документов в форматы, которые понимает принтер.</p></li><li><p>Как включить при печати колонтитулы или выдачу страниц-баннеров.</p></li><li><p>Как печатать на принтеры, подключенные к другим компьютерам.</p></li><li><p>Как печатать на принтеры, подключенные непосредственно к сети.</p></li><li><p>Как задавать ограничения для принтера, включая ограничение размера заданий печати и запрет печати для отдельных пользователей.</p></li><li><p>Как сохранять статистическую информацию о печати и учитывать использование принтера.</p></li><li><p>Как решать проблемы печати.</p></li></ul></div><div class=paragraph><p>Прежде чем читать эту главу, вы должны:</p></div><div class=ulist><ul><li><p>Знать, как сконфигурировать и установить новое ядро (<a href=../kernelconfig/#kernelconfig>Настройка ядра FreeBSD</a>).</p></li></ul></div></div></div><div class=sect1><h2 id=printing-intro-spooler>10.2. Введение<a class=anchor href=#printing-intro-spooler></a></h2><div class=sectionbody><div class=paragraph><p>Для использования принтеров в ОС FreeBSD вы можете настроить их для работы с системой спулинга печати Беркли (Berkeley line printer spooling system), также известной как система спулинга LPD. Это - стандартная система управления принтером во FreeBSD. В этой главе представлена система спулинга LPD и описано ее конфигурирование.</p></div><div class=paragraph><p>Если вы уже знакомы с LPD или другой системой спулинга печати, вы можете сразу перейти к разделу <a href=#printing-intro-setup>Базовая настройка</a>.</p></div><div class=paragraph><p>LPD управляет всеми аспектами работы принтеров хоста. Она отвечает за несколько вещей:</p></div><div class=ulist><ul><li><p>Она управляет доступом к непосредственно подключенным принтерам и принтерам, подключенным к другим хостам в сети.</p></li><li><p>Она позволяет пользователям посылать файлы на печать; эти данные называют <em>заданиями</em>.</p></li><li><p>Она предотвращает одновременный доступ к принтеру нескольких пользователей путем поддержки <em>очереди</em> для каждого принтера.</p></li><li><p>Она позволяет печатать <em>страницы заголовка</em> (их также называют <em>баннерными</em> или <em>начальными</em> страницами), чтобы пользователи могли легко находить распечатанные задания в пачке распечаток.</p></li><li><p>Она обеспечивает установку параметров взаимодействия для принтеров, подключенных к последовательным портам.</p></li><li><p>Она может отправлять задания по сети спулеру LPD на другом хосте.</p></li><li><p>Она может применять специальные фильтры для форматирования заданий для печати на разных языках описания страниц или задействования специфических возможностей принтера.</p></li><li><p>Она учитывает использование принтера.</p></li></ul></div><div class=paragraph><p>С помощью файла конфигурации (<span class=filename>/etc/printcap</span>) и за счет предоставления специальных программ фильтрования, можно потребовать от системы LPD выполнять все или некоторые из перечисленных выше функций на широком спектре принтерного оборудования.</p></div><div class=sect2><h3 id=printing-intro-why>10.2.1. Зачем использовать спулер<a class=anchor href=#printing-intro-why></a></h3><div class=paragraph><p>Если вы - единственный пользователь системы, вы можете спросить, зачем возиться со спулером, если управление доступом, страницы заголовка или учет использования принтера вам не нужны. Хотя можно обеспечить непосредственный доступ к принтеру, в любом случае следует использовать спулер, поскольку:</p></div><div class=ulist><ul><li><p>LPD печатает задания в фоновом режиме; вам не придется ждать, пока данные будут скопированы на принтер.</p></li><li><p>LPD позволяет легко пропустить задание печати через фильтры для добавления заголовков с датой/временем или преобразования специального формата файлов (такого как TeX DVI) в формат, который понимает принтер. Вам не придется выполнять эти шаги вручную.</p></li><li><p>Многие свободно распространяемые и коммерческие программы, обеспечивающие возможность печати, обычно предполагают взаимодействие со спулером системы. Путем настройки системы спулинга вы упростите поддержку другого программного обеспечения, которое может быть добавлено в дальнейшем или уже установлено.</p></li></ul></div></div></div></div><div class=sect1><h2 id=printing-intro-setup>10.3. Основная настройка<a class=anchor href=#printing-intro-setup></a></h2><div class=sectionbody><div class=paragraph><p>Для использования принтеров с системой спулинга LPD, необходимо настроить как сам принтер, так и программное обеспечение LPD. Этот документ описывает два уровня настройки:</p></div><div class=ulist><ul><li><p>См. раздел <a href=#printing-simple>Простая настройка принтера</a>, чтобы узнать, как подключить принтер, объяснить LPD, как с ним взаимодействовать, и отправлять на принтер простые текстовые файлы.</p></li><li><p>См. раздел <a href=#printing-advanced>Расширенная настройка принтера</a>, чтобы узнать, как печатать файлы множества специальных форматов, как печатать страницы заголовка, печатать по сети, управлять доступом к принтерам и учитывать использование принтера.</p></li></ul></div><div class=sect2><h3 id=printing-simple>10.3.1. Простая настройка принтера<a class=anchor href=#printing-simple></a></h3><div class=paragraph><p>В этом разделе описано, как сконфигурировать принтер и программное обеспечение LPD для использования принтера. Здесь рассматриваются следующие вопросы:</p></div><div class=ulist><ul><li><p>В разделе <a href=#printing-hardware>Настройка оборудования</a> представлены советы по подключению принтера к порту компьютера.</p></li><li><p>В разделе <a href=#printing-software>Настройка программного обеспечения</a> показано, как настроить файл конфигурации спулера LPD (<span class=filename>/etc/printcap</span>).</p></li></ul></div><div class=paragraph><p>Если вы настраиваете принтер, использующий для принятия заданий печати сетевой протокол, вместо локальных интерфейсов компьютера, см. раздел <a href=#printing-advanced-network-net-if>Принтеры с сетевыми интерфейсами</a>.</p></div><div class=paragraph><p>Хотя этот раздел и назван "Простая настройка принтера", это, на самом деле, достаточно сложно. Заставить принтер работать с компьютером и спулером LPD - самая сложная часть. Расширенные опции, вроде выдачи страниц заголовков и учета использования, установить несложно, как только принтер заработает.</p></div><div class=sect3><h4 id=printing-hardware>10.3.1.1. Настройка оборудования<a class=anchor href=#printing-hardware></a></h4><div class=paragraph><p>В этом разделе описаны различные способы подключения принтера к ПК. Рассматриваются различные порты и кабели, а также параметры конфигурации ядра, которые может потребоваться установить, чтобы ОС FreeBSD могла взаимодействовать с принтером.</p></div><div class=paragraph><p>Если вы уже подключили ваш принтер и успешно печатали на него в другой операционной системе, можете перейти к разделу <a href=#printing-software>Настройка программного обеспечения</a>.</p></div><div class=sect4><h5 id=printing-ports>10.3.1.1.1. Порты и кабели<a class=anchor href=#printing-ports></a></h5><div class=paragraph><p>Принтеры, которые продаются сегодня для использования на ПК, обычно поддерживают один или несколько из следующих интерфейсов:</p></div><div class=ulist><ul><li><p><em>Последовательные</em> интерфейсы, также известные как RS-232, или COM-порты, используют для посылки данных на принтер последовательный порт компьютера. Последовательные интерфейсы широко распространены в компьютерной индустрии, кабели для них легко найти и просто сделать. Для последовательных интерфейсов иногда нужны специальные кабели, и для их использования может потребоваться настраивать достаточно сложные опции взаимодействия. Большинство последовательных портов ПК имеют максимальную скорость передачи 115200 бит/сек, поэтому печатать через них большие графические задания неудобно.</p></li><li><p><em>Параллельные</em> интерфейсы используют параллельный порт компьютера для посылки данных на принтер. Параллельные интерфейсы широко распространены на рынке ПК и работают быстрее, чем последовательные RS-232. Кабели легко найти, но сделать самостоятельно сложнее. При использовании параллельных интерфейсов опции взаимодействия обычно задавать не надо, что делает их конфигурирование существенно проще.</p><div class=paragraph><p>Параллельные интерфейсы иногда называют интерфейсами "Centronics", по названию типа разъема на принтере.</p></div></li><li><p>Интерфейсы USB (сокращение от Universal Serial Bus - универсальная последовательная шина), могут работать на еще больших скоростях, чем параллельные или последовательные интерфейсы RS-232. Кабели для них - простые и дешевые. USB превосходит последовательный RS-232 и параллельный интерфейсы для печати, но не слишком хорошо поддерживается в UNIX®-системах. Обойти эту проблему можно, купив принтер с двумя интерфейсами, USB и параллельным, как у многих принтеров.</p></li></ul></div><div class=paragraph><p>В общем случае, параллельные интерфейсы обычно обеспечивают только одностороннюю передачу (с компьютера на принтер), тогда как последовательные и USB поддерживают двустороннюю. Более новые параллельные порты (EPP и ECP) и принтеры могут взаимодействовать в обоих направлениях под FreeBSD, если используется кабель, соответствующий стандарту IEEE-1284.</p></div><div class=paragraph><p>Двустороннее взаимодействие с принтером через параллельный порт обычно выполняется одним из двух способов. Первый метод опирается на использование специально созданного драйвера принтера для FreeBSD, который поддерживает специфический язык данного принтера. Этот метод типичен для струйных принтеров и может использоваться для получения информации об уровне чернил и другой информации о состоянии. Второй метод используется, когда принтер поддерживает PostScript®.</p></div><div class=paragraph><p>Фактически, задания PostScript® являются программами, посылаемыми для выполнения принтеру; они вообще могут не выдавать результат на бумагу и возвращать его непосредственно компьютеру. PostScript® также использует двустороннее взаимодействие для сообщения компьютеру о проблемах, таких как ошибки в PostScript®-программе или замятие бумаги. Такая информация может пригодиться пользователям. Более того, лучший способ эффективного учета использования PostScript®-принтера требует двустороннего взаимодействия: вы запрашиваете у принтера значение счетчика страниц (сколько страниц напечатал принтер за все время существования), затем посылаете задание пользователя, затем снова запрашиваете значение его счетчика страниц. Вычитаем одно значение из другого, и узнаем, сколько бумаги потратил пользователь.</p></div></div><div class=sect4><h5 id=printing-parallel>10.3.1.1.2. Параллельные порты<a class=anchor href=#printing-parallel></a></h5><div class=paragraph><p>Для подключения принтера через параллельный интерфейс, соедините принтер и компьютер кабелем Centronics. Инструкции для принтера, для компьютера или обе должны полностью описывать эту процедуру.</p></div><div class=paragraph><p>Помните, какой параллельный порт компьютера вы использовали. Первый параллельный порт в ОС FreeBSD - <span class=filename>ppc0</span>; второй - <span class=filename>ppc1</span>, и так далее. Имена устройств для принтеров используют ту же схему: <span class=filename>/dev/lpt0</span> для принтера на первом параллельном порту и т.д.</p></div></div><div class=sect4><h5 id=printing-serial>10.3.1.1.3. Последовательные порты<a class=anchor href=#printing-serial></a></h5><div class=paragraph><p>Для подключения принтера через последовательный интерфейс, соедините принтер с компьютером подходящим последовательным кабелем. Инструкции для принтера, для компьютера или обе должны полностью описывать эту процедуру.</p></div><div class=paragraph><p>Если вы не знаете, что такое "подходящий последовательный кабель", можете попробовать использовать один из следующих:</p></div><div class=ulist><ul><li><p><em>Модемный</em> кабель соединяет каждый штырёк на одном конце кабеля напрямую с соответствующим штырьком на другом конце. Кабель такого типа также называют кабелем "DTE-to-DCE".
*</p><div class=paragraph><p><em>Нуль-модемный</em> кабель соединяет часть штырьков напрямую, другие - меняет (пересылку данных на приём данных, например), а некоторые - закорачивает на каждом разъеме. Кабель такого типа также называют кабелем "DTE-to-DTE" cable.</p></div></li><li><p>Кабель <em>последовательного принтера</em>, необходимый для некоторых редко используемых принтеров, похож на нуль-модемный кабель, но посылает часть сигналов на соответствующие штырьки, а не закорачивает их.</p></li></ul></div><div class=paragraph><p>Вам надо также настроить эти параметры взаимодействия с принтером, обычно - через элементы управления на лицевой панели или переключатели (DIP switches) на принтере. Выберите максимальную скорость передачи <code>bps</code> (бит в секунду, иногда - <em>baud rate</em>), которую могут поддерживать как компьютер, так и принтер. Выберите 7 или 8 битов данных; четность none, even или odd; и 1 или 2 стоп-бита. Также надо выбрать протокол управления передачей: none или XON/XOFF (также известный как "внутриполосный" или "программный"). Запомните выбранные установки для последующего конфигурирования программного обеспечения.</p></div></div></div><div class=sect3><h4 id=printing-software>10.3.1.2. Настройка программного обеспечения<a class=anchor href=#printing-software></a></h4><div class=paragraph><p>В этом разделе описана настройка программного обеспечения, необходимая для печати с помощью системы спулинга LPD в ОС FreeBSD.</p></div><div class=paragraph><p>Вот план действий, которые необходимо выполнить:</p></div><div class="exampleblock procedure"><div class=content><div class="olist arabic"><ol class=arabic><li><p>При необходимости, сконфигурировать в ядре поддержку порта, к которому подключен принтер; в разделе <a href=#printing-kernel>Конфигурирование ядра</a> описано, что надо сделать.</p></li><li><p>Установить режим взаимодействия для параллельного порта, если используется параллельный порт; детали представлены в разделе <a href=#printing-parallel-port-mode>Настройка режима взаимодействия для параллельного порта</a>.</p></li><li><p>Проверить, может ли операционная система посылать данные на принтер. В разделе <a href=#printing-testing>Проверка взаимодействия с принтером</a> даны советы, как это сделать.</p></li><li><p>Настроить LPD для принтера, изменяя файл <span class=filename>/etc/printcap</span>. Как это сделать описано далее в этой главе.</p></li></ol></div></div></div><div class=sect4><h5 id=printing-kernel>10.3.1.2.1. Конфигурирование ядра<a class=anchor href=#printing-kernel></a></h5><div class=paragraph><p>Ядро операционной системы компилируется для работы с конкретным набором устройств. Последовательный или параллельный интерфейс для принтера входит в этот набор. Поэтому может понадобиться добавить поддержку для дополнительного последовательного или параллельного порта, если он еще не сконфигурирован в ядре.</p></div><div class=paragraph><p>Чтобы узнать, поддерживает ли используемое в настоящий момент ядро последовательный интерфейс, наберите:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># grep sioN /var/run/dmesg.boot</span></code></pre></div></div><div class=paragraph><p>Где <em>N</em> - номер последовательного порта, начиная с нуля. Если вы получаете результат, подобный следующему:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>sio2 at port 0x3e8-0x3ef irq 5 on isa
sio2: <span class=nb>type </span>16550A</code></pre></div></div><div class=paragraph><p>значит, ядро поддерживает порт.</p></div><div class=paragraph><p>Чтобы узнать, поддерживает ли ядро параллельный интерфейс, наберите:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># grep ppcN /var/run/dmesg.boot</span></code></pre></div></div><div class=paragraph><p>Где <em>N</em> номер параллельного порта, начиная с нуля. Если вы получаете результат, подобный следующему:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>ppc0: &lt;Parallel port&gt; at port 0x378-0x37f irq 7 on isa0
ppc0: SMC-like chipset <span class=o>(</span>ECP/EPP/PS2/NIBBLE<span class=o>)</span> <span class=k>in </span>COMPATIBLE mode
ppc0: FIFO with 16/16/8 bytes threshold</code></pre></div></div><div class=paragraph><p>значит, ядро поддерживает порт.</p></div><div class=paragraph><p>Может потребоваться переконфигурировать ядро, чтобы операционная система распознала и использовала параллельный или последовательный порт, используемый для подключения принтера.</p></div><div class=paragraph><p>Чтобы добавить поддержку последовательного порта, обратитесь к разделу, посвященному конфигурированию ядра. Чтобы добавить поддержку параллельного порта, почитайте этот же раздел <em>и</em> следующий раздел.</p></div></div></div><div class=sect3><h4 id=printing-parallel-port-mode>10.3.1.3. Настройка режима взаимодействия для параллельного порта<a class=anchor href=#printing-parallel-port-mode></a></h4><div class=paragraph><p>При использовании параллельного интерфейса можно выбрать, должна ли ОС FreeBSD взаимодействовать с принтером на основе прерываний или путем опроса. Универсальный драйвер принтера (<a href="https://man.freebsd.org/cgi/man.cgi?query=lpt&amp;sektion=4&amp;format=html">lpt(4)</a>) во FreeBSD использует систему <a href="https://man.freebsd.org/cgi/man.cgi?query=ppbus&amp;sektion=4&amp;format=html">ppbus(4)</a>, которая управляет чипсетом порта с помощью драйвера <a href="https://man.freebsd.org/cgi/man.cgi?query=ppc&amp;sektion=4&amp;format=html">ppc(4)</a>.</p></div><div class=ulist><ul><li><p>Метод взаимодействия <em>на основе прерываний</em> является стандартным для ядра GENERIC. По этому методу, операционная система использует линию запроса прерывания (IRQ line) для определения готовности принтера к приему данных.</p></li><li><p>Метод взаимодействия <em>путем опроса</em> требует от операционной системы постоянно запрашивать принтер, готов ли он к приему данных. Когда он отвечает, что готов, ядро посылает дополнительные данные.</p></li></ul></div><div class=paragraph><p>Метод взаимодействия на основе прерываний обычно работает несколько быстрее, но использует ценную линию запроса прерывания. Про некоторые новые принтеры HP утверждают, что они работают некорректно в режиме взаимодействия на основе прерываний, вероятно, из-за некоторой (еще не вполне понятной) проблемы синхронизации. Для этих принтеров необходимо устанавливать режим опроса. Используйте тот режим, который работает. Некоторые принтеры будут работать в обоих режимах, но оказываются крайне медленными в режиме на основе прерываний.</p></div><div class=paragraph><p>Режим взаимодействия можно установить двумя способами: конфигурируя ядро или с помощью программы <a href="https://man.freebsd.org/cgi/man.cgi?query=lptcontrol&amp;sektion=8&amp;format=html">lptcontrol(8)</a>.</p></div><div class=paragraph><p><em>Для установки режима взаимодействия путем конфигурирования ядра:</em></p></div><div class="exampleblock procedure"><div class=content><div class="olist arabic"><ol class=arabic><li><p>Отредактируйте файл конфигурации ядра. Найдите запись <code>ppc0</code>. Если вы настраиваете второй параллельный порт, ищите запись <code>ppc1</code>. Используйте запись <code>ppc2</code> для третьего порта, и так далее.</p><div class=ulist><ul><li><p>Если необходимо установить режим на основе прерываний, отредактируйте следующую строку:</p><div class="literalblock programlisting"><div class=content><pre>hint.ppc.0.irq=&#34;N&#34;</pre></div></div><div class=paragraph><p>в файле <span class=filename>/boot/device.hints</span>, заменив <em>N</em> соответствующим номером IRQ. Файл конфигурации ядра также должен содержать драйвер <a href="https://man.freebsd.org/cgi/man.cgi?query=ppc&amp;sektion=4&amp;format=html">ppc(4)</a>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>device ppc</code></pre></div></div></li><li><p>Если необходимо установить режим опроса, удалите из файла <span class=filename>/boot/device.hints</span> следующую строку:</p><div class="literalblock programlisting"><div class=content><pre>hint.ppc.0.irq=&#34;N&#34;</pre></div></div><div class=paragraph><p>В некоторых случаях, этого недостаточно для перевода порта в режим опроса под FreeBSD. Чаще всего, проблема связана с драйвером <a href="https://man.freebsd.org/cgi/man.cgi?query=acpi&amp;sektion=4&amp;format=html">acpi(4)</a>, который может опрашивать и подключать устройства и, тем самым, управлять режимом доступа к порту принтера. Чтобы решить эту проблему, проверьте конфигурацию <a href="https://man.freebsd.org/cgi/man.cgi?query=acpi&amp;sektion=4&amp;format=html">acpi(4)</a>.</p></div></li></ul></div></li><li><p>Сохраните файл. Затем сконфигурируйте, соберите и установите ядро и перезагрузите систему. Подробнее см. в разделе <a href=../kernelconfig/#kernelconfig>конфигурирование ядра</a>.</p></li></ol></div></div></div><div class=paragraph><p><em>Для настройки режима взаимодействия с помощью утилиты</em> <a href="https://man.freebsd.org/cgi/man.cgi?query=lptcontrol&amp;sektion=8&amp;format=html">lptcontrol(8)</a>:</p></div><div class="exampleblock procedure"><div class=content><div class="olist arabic"><ol class=arabic><li><p>Введите команду:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># lptcontrol -i -d /dev/lptN</span></code></pre></div></div><div class=paragraph><p>для установки режима взаимодействия на основе прерываний для <code>lpt<em>N</em></code>.</p></div></li><li><p>Введите команду:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># lptcontrol -p -d /dev/lptN</span></code></pre></div></div><div class=paragraph><p>для установки режима взаимодействия по опросу для <code>lpt<em>N</em></code>.</p></div></li></ol></div></div></div><div class=paragraph><p>Вы можете поместить эти команды в файл <span class=filename>/etc/rc.local</span> для установки требуемого режима при каждой загрузке системы. Дополнительную информацию об этом ищите на странице справочного руководства <a href="https://man.freebsd.org/cgi/man.cgi?query=lptcontrol&amp;sektion=8&amp;format=html">lptcontrol(8)</a>.</p></div></div><div class=sect3><h4 id=printing-testing>10.3.1.4. Проверка взаимодействия с принтером<a class=anchor href=#printing-testing></a></h4><div class=paragraph><p>Прежде чем переходить к конфигурированию системы спулинга, надо убедиться, что операционная система может успешно посылать данные на принтер. Намного проще отлаживать взаимодействие с принтером и систему спулинга отдельно.</p></div><div class=paragraph><p>Для тестирования принтера мы пошлем на него текст. Для принтеров, которые могут непосредственно печатать посланные на них символы, идеально подходит программа <a href="https://man.freebsd.org/cgi/man.cgi?query=lptest&amp;sektion=1&amp;format=html">lptest(1)</a>: она генерирует все 96 печатных символов ASCII в 96 строках.</p></div><div class=paragraph><p>Для PostScript®- (или основанного на другом языке) принтера, необходим более сложный тест. Подойдет небольшая PostScript®-программа, вроде следующей:</p></div><div class="literalblock programlisting"><div class=content><pre>%!PS
100 100 moveto 300 300 lineto stroke
310 310 moveto /Helvetica findfont 12 scalefont setfont
(Is this thing working?) show
showpage</pre></div></div><div class=paragraph><p>Представленный выше PostScript®-код можно поместить в в файл и использовать, как показано в примерах в следующих разделах.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Когда в этом документе речь идет о языке принтера, подразумевается язык типа PostScript®, а не PCL компании Hewlett Packard. Хотя PCL имеет прекрасные функциональные возможности, в нем можно смешивать обычный текст с его управляющими последовательностями. PostScript® не позволяет непосредственно печатать обычный текст, и это язык принтера именно того рода, для которого надо выполнять специальные настройки.</p></div></td></tr></tbody></table></div><div class=sect4><h5 id=printing-checking-parallel>10.3.1.4.1. Проверка параллельного принтера<a class=anchor href=#printing-checking-parallel></a></h5><div class=paragraph><p>В этом разделе описано, как проверить, может ли ОС FreeBSD взаимодействовать с принтером, подключенным к параллельному порту.</p></div><div class=paragraph><p><em>Для тестирования принтера на параллельном порту:</em></p></div><div class="exampleblock procedure"><div class=content><div class="olist arabic"><ol class=arabic><li><p>Станьте пользователем <code>root</code> с помощью команды <a href="https://man.freebsd.org/cgi/man.cgi?query=su&amp;sektion=1&amp;format=html">su(1)</a>.</p></li><li><p>Пошлите данные на принтер.</p><div class=ulist><ul><li><p>Если принтер может печатать обычный текст, используйте утилиту <a href="https://man.freebsd.org/cgi/man.cgi?query=lptest&amp;sektion=1&amp;format=html">lptest(1)</a>. Введите команду:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># lptest &gt; /dev/lptN</span></code></pre></div></div><div class=paragraph><p>Где <em>N</em> - номер параллельного порта, начиная с нуля.</p></div></li><li><p>Если принтер понимает PostScript® или другой язык принтера, пошлите на принтер небольшую программу. Введите команду:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cat &gt; /dev/lptN</span></code></pre></div></div><div class=paragraph><p>Затем, построчно, <em>внимательно</em> введите программу, поскольку вы не сможете отредактировать строку после нажатия клавиши <code>RETURN</code> или <code>ENTER</code>. По окончании ввода программы, нажмите <code>CONTROL+D</code> или другую комбинацию клавиш, используемую для ввода символа конца файла.</p></div><div class=paragraph><p>Можно также поместить программу в файл и выполнить команду:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cat file &gt; /dev/lptN</span></code></pre></div></div><div class=paragraph><p>Где <em>file</em> - имя файла, содержащего программу, которую вы хотите послать принтеру.</p></div></li></ul></div></li></ol></div></div></div><div class=paragraph><p>Вы должны увидеть распечатку. Не переживайте, если текст выглядит не так, как предполагалось; этими проблемами мы займемся позже.</p></div></div><div class=sect4><h5 id=printing-checking-serial>10.3.1.4.2. Проверка последовательного принтера<a class=anchor href=#printing-checking-serial></a></h5><div class=paragraph><p>В этом разделе описано, как проверить, может ли ОС FreeBSD взаимодействовать с принтером, подключенным к последовательному порту.</p></div><div class=paragraph><p><em>Для тестирования принтера на последовательном порту:</em></p></div><div class="exampleblock procedure"><div class=content><div class="olist arabic"><ol class=arabic><li><p>Станьте пользователем <code>root</code> с помощью команды <a href="https://man.freebsd.org/cgi/man.cgi?query=su&amp;sektion=1&amp;format=html">su(1)</a>.</p></li><li><p>Отредактируйте файл <span class=filename>/etc/remote</span>. Добавьте следующую запись:</p><div class="literalblock programlisting"><div class=content><pre>printer:dv=/dev/port:br#bps-rate:pa=parity</pre></div></div><div class=paragraph><p>Где <em>port</em> - специальный файл устройства для последовательного порта (<code>ttyd0</code>, <code>ttyd1</code> и т.д.), <em>bps-rate</em> - скорость обработки данных принтером, в битах в секунду, а <em>parity</em> - требуемая принтером четность (значение <code>even</code>, <code>odd</code>, <code>none</code> или <code>zero</code>).</p></div><div class=paragraph><p>Вот пример записи для принтера, подключенного к третьему последовательному порту на скорости 19200 bps без четности:</p></div><div class="literalblock programlisting"><div class=content><pre>printer:dv=/dev/ttyd2:br#19200:pa=none</pre></div></div></li><li><p>Подключитесь к принтеру с помощью <a href="https://man.freebsd.org/cgi/man.cgi?query=tip&amp;sektion=1&amp;format=html">tip(1)</a>. Введите команду:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># tip printer</span></code></pre></div></div><div class=paragraph><p>Если этот шаг не срабатывает, снова отредактируйте файл <span class=filename>/etc/remote</span> и попробуйте использовать устройство <span class=filename>/dev/cuaaN</span> вместо <span class=filename>/dev/ttydN</span>.</p></div></li><li><p>Пошлите данные на принтер.</p><div class=ulist><ul><li><p>Если принтер может печатать обычный текст, используйте утилиту <a href="https://man.freebsd.org/cgi/man.cgi?query=lptest&amp;sektion=1&amp;format=html">lptest(1)</a>. Введите команду:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% <span class=nv>$lptest</span></code></pre></div></div></li><li><p>Если принтер понимает PostScript® или другой язык принтера, пошлите на принтер небольшую программу. Вводите программу, построчно, <em>очень внимательно</em>, поскольку нажатие клавиши Backspacе или других клавиш редактирования может иметь значение для принтера. Может также понадобиться нажать специальную комбинацию клавиш, обозначающую конец файла, чтобы принтер понял, что получена вся программа. Для PostScript®-принтеров нажмите <code>CONTROL+D</code>.</p><div class=paragraph><p>Можно также поместить программу в файл и ввести команду:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% <span class=o>&gt;</span>file</code></pre></div></div><div class=paragraph><p>Где <em>file</em> - имя файла, содержащего программу. После того, как утилита <a href="https://man.freebsd.org/cgi/man.cgi?query=tip&amp;sektion=1&amp;format=html">tip(1)</a> пошлет файл, нажмите требуемую для ввода признака конца файла комбинацию клавиш.</p></div></li></ul></div></li></ol></div></div></div><div class=paragraph><p>Вы должны увидеть распечатку. Не переживайте, если текст выглядит не так, как предполагалось; этими проблемами мы займемся позже.</p></div></div></div><div class=sect3><h4 id=printing-printcap>10.3.1.5. Включение спулера: файл <span class=filename>/etc/printcap</span><a class=anchor href=#printing-printcap></a></h4><div class=paragraph><p>Сейчас ваш принтер уже должен быть подключен, ядро (при необходимости) - сконфигурировано для взаимодействия с ним, и вы смогли послать на принтер простые данные. Теперь мы готовы к конфигурированию системы LPD для управления доступом к принтеру.</p></div><div class=paragraph><p>Система LPD конфигурируется путем редактирования файла <span class=filename>/etc/printcap</span>. Система спулинга LPD читает этот файл при каждом использовании спулера, так что, изменения в файле сразу же учитываются.</p></div><div class=paragraph><p>Формат файла <a href="https://man.freebsd.org/cgi/man.cgi?query=printcap&amp;sektion=5&amp;format=html">printcap(5)</a> прост. Используйте свой любимый текстовый редактор для изменения файла <span class=filename>/etc/printcap</span>. Формат файла идентичен формату других файлов, описывающих характеристики, например, <span class=filename>/usr/shared/misc/termcap</span> и <span class=filename>/etc/remote</span>. Полная информация о формате представлена на странице справочного руководства <a href="https://man.freebsd.org/cgi/man.cgi?query=cgetent&amp;sektion=3&amp;format=html">cgetent(3)</a>.</p></div><div class=paragraph><p>Простое конфигурирование спулера включает следующие шаги:</p></div><div class="exampleblock procedure"><div class=content><div class="olist arabic"><ol class=arabic><li><p>Выберите имя (и несколько удобных псевдонимов) для принтера и поместите их в файл <span class=filename>/etc/printcap</span>; подробнее об именовании см. в разделе <a href=#printing-naming>Именование принтера</a>.</p></li><li><p>Отключите выдачу начальных страниц (которые по умолчанию выдаются), вставив характеристику <code>sh</code>; подробнее об этом см. в разделе <a href=#printing-no-header-pages>Подавление выдачи начальных страниц</a>.</p></li><li><p>Создайте каталог для спулинга и укажите его местонахождение с помощью характеристики <code>sd</code>; подробнее об этом см. в разделе <a href=#printing-spooldir>Создание каталога спулинга</a>.</p></li><li><p>Выберите специальный файл устройства <span class=filename>/dev</span> для использования с принтером и укажите его в файле <span class=filename>/etc/printcap</span> с помощью характеристики <code>lp</code>; подробнее об этом см. в разделе <a href=#printing-device>Выбор устройства для принтера</a>. Кроме того, если принтер подключен к последовательному порту, настройте параметры взаимодействия с помощью характеристики <code>ms#</code>, которая обсуждается в разделе <a href=#printing-commparam>Конфигурирование параметров взаимодействия для спулера</a>.</p></li><li><p>Установите фильтр для обычного текста; подробнее об этом см. в разделе <a href=#printing-textfilter>Установка текстового фильтра</a>.</p></li><li><p>Проверьте настройку, напечатав что-нибудь с помощью команды <a href="https://man.freebsd.org/cgi/man.cgi?query=lpr&amp;sektion=1&amp;format=html">lpr(1)</a>. Подробнее об этом см. в разделах <a href=#printing-trying>Проверка</a> и <a href=#printing-troubleshooting>Выявление проблем</a>.</p></li></ol></div></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Принтеры, использующие специальные языки, например, PostScript®-принтеры, не могут непосредственно печатать обычный текст. Простая настройка, представленная выше и описанная в следующих разделах, предполагает, что, если вы устанавливаете такой принтер, то будете печатать только файлы, которые он может обработать.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Пользователи часто предполагают, что они могут печатать обычный текст на любом из установленных в системе принтеров. Программы, взаимодействующие для обеспечения печати с системой LPD, обычно исходят из этого же предположения. Если вы устанавливаете такой принтер и хотите иметь возможность посылать на печать задания на языке принтера <em>и</em> в виде обычного текста, настоятельно рекомендуется добавить дополнительный шаг к представленной выше простой последовательности настройки: установите программу автоматического преобразования обычного текста в PostScript® (или другой язык принтера). В разделе <a href=#printing-advanced-if-conversion>Прием заданий с обычным текстом на PostScript®-принтеры</a> рассказано, как это сделать.</p></div><div class=sect4><h5 id=printing-naming>10.3.1.5.1. Именование принтера<a class=anchor href=#printing-naming></a></h5><div class=paragraph><p>Первый (простой) шаг - выбрать имя для принтера. На самом деле, не важно, выберете ли вы функциональное имя или причудливое, поскольку для принтера можно также задать несколько псевдонимов.</p></div><div class=paragraph><p>По крайней мере, один из принтеров, указанных в файле <span class=filename>/etc/printcap</span>, должен иметь псевдоним <code>lp</code>. Это - стандартное имя принтера. Если пользователи не установят переменную среды <code>PRINTER</code> и не укажут имя принтера в командной сроке при вводе любой команды системы LPD, по умолчанию для ее выполнения будет использован принтер <code>lp</code>.</p></div><div class=paragraph><p>Также широко распространена практика в качестве последнего псевдонима для принтера задавать полное его описание, включая производителя и модель.</p></div><div class=paragraph><p>После выбора имени и нескольких популярных псевдонимов поместите их в файл <span class=filename>/etc/printcap</span>. Имя принтера должно начинаться с крайнего левого столбца. Каждый псевдоним отделяйте вертикальной чертой, а после последнего псевдонима поместите двоеточие.</p></div><div class=paragraph><p>В следующем примере мы начнем со скелетного файла <span class=filename>/etc/printcap</span>, определяющего два принтера (построчный принтер Diablo 630 и лазерный PostScript®-принтер Panasonic KX-P4455):</p></div><div class="literalblock programlisting"><div class=content><pre>#
#  /etc/printcap для хоста rose
#
rattan|line|diablo|lp|Diablo 630 Line Printer:

bamboo|ps|PS|S|panasonic|Panasonic KX-P4455 PostScript v51.4:</pre></div></div><div class=paragraph><p>В этом примере первый принтер назван <code>rattan</code> и ему заданы псевдонимы <code>line</code>, <code>diablo</code>, <code>lp</code> и <code>Diablo 630 Line Printer</code>. Поскольку у него есть псевдоним <code>lp</code>, он является стандартным принтером. Второму принтеру дано имя <code>bamboo</code> и ему заданы псевдонимы <code>ps</code>, <code>PS</code>, <code>S</code>, <code>panasonic</code> и <code>Panasonic KX-P4455 PostScript v51.4</code>.</p></div></div><div class=sect4><h5 id=printing-no-header-pages>10.3.1.5.2. Подавление выдачи начальных страниц<a class=anchor href=#printing-no-header-pages></a></h5><div class=paragraph><p>Система спулинга LPD будет по умолчанию печатать <em>заголовочную страницу</em> для каждого задания. Заголовочная страница содержит имя пользователя, отправившего задание, хост, с которого поступило задание, и имя задания, красивыми большими буквами. К сожалению, все эти дополнительные тексты мешают отладке простой настройки принтера, поэтому мы будет отключать выдачу начальных страниц.</p></div><div class=paragraph><p>Для подавления выдачи начальных страниц добавьте характеристику <code>sh</code> к записи принтера в файле <span class=filename>/etc/printcap</span>. Вот пример файла <span class=filename>/etc/printcap</span> с добавлением <code>sh</code>:</p></div><div class="literalblock programlisting"><div class=content><pre>#
#  /etc/printcap для хоста rose - никаких начальных страниц
#
rattan|line|diablo|lp|Diablo 630 Line Printer:\
        :sh:

bamboo|ps|PS|S|panasonic|Panasonic KX-P4455 PostScript v51.4:\
        :sh:</pre></div></div><div class=paragraph><p>Обратите внимание, как мы использовали правильный формат: первая строка начинается с самого левого столбца, а последующие строки смещены. Каждая строка в записи, кроме последней, завершается символом обратной косой черты.</p></div></div><div class=sect4><h5 id=printing-spooldir>10.3.1.5.3. Создание каталога для спулинга<a class=anchor href=#printing-spooldir></a></h5><div class=paragraph><p>Следующий шаг в простой настройке спулера - создать <em>каталог для спулинга</em>, каталог, в котором находятся задания печати, пока не будут напечатаны, и где находятся еще несколько других файлов для поддержки спулера.</p></div><div class=paragraph><p>Из-за присущих каталогам спулинга постоянных изменений, принято помещать эти каталоги в каталог <span class=filename>/var/spool</span>. Кроме того, не нужно создавать резервные копии содержимого каталогов спулинга. Пересоздать их можно с помощью простой команды <a href="https://man.freebsd.org/cgi/man.cgi?query=mkdir&amp;sektion=1&amp;format=html">mkdir(1)</a>.</p></div><div class=paragraph><p>Принято также задавать для каталога имя, совпадающее с именем принтера, как показано ниже:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mkdir /var/spool/имя-принтера</span></code></pre></div></div><div class=paragraph><p>Однако при наличии большого количества принтеров в сети может иметь смысл поместить все каталоги спулинга в один каталог, который просто резервируется для печати с помощью LPD. Мы сделаем это для наших двух принтеров, <code>rattan</code> и <code>bamboo</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mkdir /var/spool/lpd</span>
<span class=c># mkdir /var/spool/lpd/rattan</span>
<span class=c># mkdir /var/spool/lpd/bamboo</span></code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Если вас интересует конфиденциальность заданий, отправляемых пользователями на печать, можно защитить каталог спулинга, чтобы он не был общедоступным. Каталоги спулинга должны принадлежать и быть доступны на чтение, запись и просмотр содержимого пользователю daemon и группе daemon, и никому больше. Мы установим это для каталогов спулинга принтеров из нашего примера:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># chown daemon:daemon /var/spool/lpd/rattan</span>
<span class=c># chown daemon:daemon /var/spool/lpd/bamboo</span>
<span class=c># chmod 770 /var/spool/lpd/rattan</span>
<span class=c># chmod 770 /var/spool/lpd/bamboo</span></code></pre></div></div></td></tr></tbody></table></div><div class=paragraph><p>Наконец, надо сообщить системе LPD об этих каталогах с помощью файла <span class=filename>/etc/printcap</span>. Полное имя каталога спулинга задается с помощью характеристики <code>sd</code>:</p></div><div class="literalblock programlisting"><div class=content><pre>#
#  /etc/printcap для хоста rose - добавлены каталоги спулинга
#
rattan|line|diablo|lp|Diablo 630 Line Printer:\
        :sh:sd=/var/spool/lpd/rattan:

bamboo|ps|PS|S|panasonic|Panasonic KX-P4455 PostScript v51.4:\
        :sh:sd=/var/spool/lpd/bamboo:</pre></div></div><div class=paragraph><p>Обратите внимание, что имя принтера начинается с самого первого столбца, а все последующие строки смещены, и каждая строка в записи, кроме последней, завершается символом обратной косой черты.</p></div><div class=paragraph><p>Если вы не зададите каталог спулинга с помощью характеристики <code>sd</code>, система спулинга будет использовать по умолчанию каталог <span class=filename>/var/spool/lpd</span>.</p></div></div><div class=sect4><h5 id=printing-device>10.3.1.5.4. Выбор устройства для принтера<a class=anchor href=#printing-device></a></h5><div class=paragraph><p>Мы выяснили, какой специальный файл устройства в каталоге <span class=filename>/dev</span> FreeBSD будет использовать для взаимодействия с принтером. Теперь мы сообщаем эту информацию системе LPD. Когда у системы спулинга есть задание для печати, она будет открывать указанное устройство от имени программы-фильтра (которая отвечает за передачу данных на принтер).</p></div><div class=paragraph><p>Задайте полное имя устройства <span class=filename>/dev</span> в файле <span class=filename>/etc/printcap</span> с помощью характеристики <code>lp</code>.</p></div><div class=paragraph><p>В нашем текущем примере давайте предположим, что принтер <code>rattan</code> подключен к первому параллельному порту, а принтер <code>bamboo</code> - к шестому последовательному порту; вот что нужно добавить в файл <span class=filename>/etc/printcap</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>#
#  /etc/printcap для хоста rose - указано, какие устройства использовать
#
rattan|line|diablo|lp|Diablo 630 Line Printer:\
        :sh:sd=/var/spool/lpd/rattan:\
        :lp=/dev/lpt0:

bamboo|ps|PS|S|panasonic|Panasonic KX-P4455 PostScript v51.4:\
        :sh:sd=/var/spool/lpd/bamboo:\
        :lp=/dev/ttyd5:</pre></div></div><div class=paragraph><p>Если вы не укажете характеристику <code>lp</code> для принтера в файле <span class=filename>/etc/printcap</span>, система LPD использует по умолчанию устройство <span class=filename>/dev/lp</span>. Устройство <span class=filename>/dev/lp</span> сейчас в ОС FreeBSD не существует.</p></div><div class=paragraph><p>Если устанавливаемый принтер подключен к параллельному порту, перейдите к разделу <a href=#printing-textfilter>Установка текстового фильтра</a>. Иначе выполните сначала инструкции, представленные в следующем разделе.</p></div></div><div class=sect4><h5 id=printing-commparam>10.3.1.5.5. Конфигурирование параметров взаимодействия спулера<a class=anchor href=#printing-commparam></a></h5><div class=paragraph><p>Для принтеров на последовательных портах система LPD может устанавливать скорость передачи, четность и другие параметры взаимодействия через последовательных порт от имени программы-фильтра, которая посылает данные на принтер. Это полезно потому, что:</p></div><div class=ulist><ul><li><p>Позволяет опробовать различные параметры взаимодействия, просто редактируя файл <span class=filename>/etc/printcap</span>; программу-фильтр перекомпилировать не нужно.</p></li><li><p>Позволяет системе спулинга использовать одну и ту же программу-фильтр для нескольких принтеров, которые могут иметь различные установки для взаимодействия через последовательный порт.</p></li></ul></div><div class=paragraph><p>Следующие характеристики в файле <span class=filename>/etc/printcap</span> задают параметры взаимодействия через последовательный порт для устройства, указанного в качестве значения характеристики <code>lp</code>:</p></div><div class=dlist><dl><dt class=hdlist1><code>br#<em>bps-rate</em></code></dt><dd><p>Устанавливает скорость взаимодействия для устройства в <em>bps-rate</em>, где <em>bps-rate</em> может иметь значение 50, 75, 110, 134, 150, 200, 300, 600, 1200, 1800, 2400, 4800, 9600, 19200, 38400, 57600 или 115200 бит в секунду.</p></dd><dt class=hdlist1><code>ms#<em>stty-mode</em></code></dt><dd><p>Устанавливает опции для терминального устройства после открытия устройства. Поддерживаемые опции описаны на странице справочного руководства <a href="https://man.freebsd.org/cgi/man.cgi?query=stty&amp;sektion=1&amp;format=html">stty(1)</a>.</p></dd></dl></div><div class=paragraph><p>Когда система LPD открывает устройство, заданное характеристикой <code>lp</code>, она устанавливает опции устройства в соответствии со значением характеристики <code>ms#</code>. Наибольший интерес представляют режимы <code>parenb</code>, <code>parodd</code>, <code>cs5</code>, <code>cs6</code>, <code>cs7</code>, <code>cs8</code>, <code>cstopb</code>, <code>crtscts</code> и <code>ixon</code>, которые описаны на странице справочного руководства <a href="https://man.freebsd.org/cgi/man.cgi?query=stty&amp;sektion=1&amp;format=html">stty(1)</a>.</p></div><div class=paragraph><p>Давайте зададим опции для нашего принтера на шестом последовательном порту. Мы установим скорость передачи 38400. В качестве режима установим режим без четности с помощью <code>-parenb</code>, 8-битовые символы с помощью <code>cs8</code>, отсутствие модемного управления с помощью <code>clocal</code> и аппаратное управление потоком с помощью опции <code>crtscts</code>:</p></div><div class="literalblock programlisting"><div class=content><pre>bamboo|ps|PS|S|panasonic|Panasonic KX-P4455 PostScript v51.4:\
        :sh:sd=/var/spool/lpd/bamboo:\
        :lp=/dev/ttyd5:ms#-parenb cs8 clocal crtscts:</pre></div></div></div><div class=sect4><h5 id=printing-textfilter>10.3.1.5.6. Установка текстового фильтра<a class=anchor href=#printing-textfilter></a></h5><div class=paragraph><p>Теперь мы готовы задать системе LPD, какой текстовый фильтр использовать для посылки заданий на принтер. <em>Текстовый фильтр</em>, известный также как <em>входной фильтр</em>, - это программа, которую система LPD запускает при получении задания на печать. Когда система LPD запускает текстовый фильтр для принтера, она направляет на стандартный входной поток фильтра задание печати, а его стандартный выходной поток - на устройство принтера, заданное характеристикой <code>lp</code>. Предполагается, что фильтр прочитает задание из стандартного входного потока, выполнит все необходимые для принтера преобразования и выдаст результат в стандартный выходной поток, который и будет напечатан. Подробнее о текстовом фильтре см. в разделе <a href=#printing-advanced-filters>Фильтры</a>.</p></div><div class=paragraph><p>Для простой настройки принтера в качестве текстового фильтра можно задать небольшой скрипт командного интерпретатора, который просто выполняет <code>/bin/cat</code> для посылки задания на принтер. В составе FreeBSD поставляется другой фильтр, <span class=filename>lpf</span>, обрабатывающий забой и подчеркивание для принтеров, которые не слишком хорошо справляются с потоком данных, содержащих такие символы. И, конечно же, вы можете использовать любую другую необходимую программу-фильтр. Фильтр <code>lpf</code> детально описан в разделе <a href=#printing-advanced-lpf>lpf: текстовый фильтр</a>.</p></div><div class=paragraph><p>Сначала давайте создадим скрипт командного интерпретатора <span class=filename>/usr/local/libexec/if-simple</span> для простого тестового фильтра. Поместите в этот файл следующий текст с помощью любимого текстового редактора:</p></div><div class="literalblock programlisting"><div class=content><pre>#!/bin/sh
#
# if-simple - Простой фильтр входного текста для lpd
# Установлен в /usr/local/libexec/if-simple
#
# Просто копирует stdin в stdout. Игнорирует все аргументы фильтра.

/bin/cat &amp;&amp; exit 0
exit 2</pre></div></div><div class=paragraph><p>Сделайте этот файл выполняемым:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># chmod 555 /usr/local/libexec/if-simple</span></code></pre></div></div><div class=paragraph><p>А теперь потребуйте от системы LPD его использовать, указав его в качестве значения характеристики <code>if</code> в файле <span class=filename>/etc/printcap</span>. Мы добавим его для двух принтеров, имеющихся пока в примере файла <span class=filename>/etc/printcap</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>#
#  /etc/printcap для хоста rose - добавлен текстовый фильтр
#
rattan|line|diablo|lp|Diablo 630 Line Printer:\
        :sh:sd=/var/spool/lpd/rattan:\ :lp=/dev/lpt0:\
        :if=/usr/local/libexec/if-simple:

bamboo|ps|PS|S|panasonic|Panasonic KX-P4455 PostScript v51.4:\
        :sh:sd=/var/spool/lpd/bamboo:\
        :lp=/dev/ttyd5:ms#-parenb cs8 clocal crtscts:\
        :if=/usr/local/libexec/if-simple:</pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Копию скрипта <span class=filename>if-simple</span> можно найти в каталоге <span class=filename>/usr/shared/examples/printing</span>.</p></div></td></tr></tbody></table></div></div><div class=sect4><h5 id=_запуск_системы_lpd>10.3.1.5.7. Запуск системы LPD<a class=anchor href=#_запуск_системы_lpd></a></h5><div class=paragraph><p>Даемон <a href="https://man.freebsd.org/cgi/man.cgi?query=lpd&amp;sektion=8&amp;format=html">lpd(8)</a> запускается из <span class=filename>/etc/rc</span>, а необходимость запуска задается переменной <code>lpd_enable</code>. Эта переменная по умолчанию имеет значение <code>NO</code>. Если вы еще этого не сделали, добавьте строку:</p></div><div class="literalblock programlisting"><div class=content><pre>lpd_enable=&#34;YES&#34;</pre></div></div><div class=paragraph><p>в файл <span class=filename>/etc/rc.conf</span>, а затем либо перезапустите машину, либо просто выполните команду <a href="https://man.freebsd.org/cgi/man.cgi?query=lpd&amp;sektion=8&amp;format=html">lpd(8)</a>.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># lpd</span></code></pre></div></div></div><div class=sect4><h5 id=printing-trying>10.3.1.5.8. Проверка<a class=anchor href=#printing-trying></a></h5><div class=paragraph><p>Вы добрались до конца простой настройки системы LPD. К сожалению, поздравлять вас еще рано, поскольку надо еще проверить настройку и устранить все выявленные проблемы. Для проверки настройки, попытайтесь что-то распечатать. Для печати с помощью системы LPD используется команда <a href="https://man.freebsd.org/cgi/man.cgi?query=lpr&amp;sektion=1&amp;format=html">lpr(1)</a>, которая посылает задание на печать.</p></div><div class=paragraph><p>Можно скомбинировать <a href="https://man.freebsd.org/cgi/man.cgi?query=lpr&amp;sektion=1&amp;format=html">lpr(1)</a> с программой <a href="https://man.freebsd.org/cgi/man.cgi?query=lptest&amp;sektion=1&amp;format=html">lptest(1)</a>, представленной в разделе <a href=#printing-testing>Проверка взаимодействия с принтером</a>, генерирующей тестовый текст.</p></div><div class=paragraph><p><em>Для тестирования простой настройки LPD:</em></p></div><div class=paragraph><p>Введите команду:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># lptest 20 5 | lpr -Pprinter-name</span></code></pre></div></div><div class=paragraph><p>Где <em>printer-name</em> - имя (или псевдоним) принтера, заданное в файле <span class=filename>/etc/printcap</span>. Для проверки стандартного принтера, введите команду <a href="https://man.freebsd.org/cgi/man.cgi?query=lpr&amp;sektion=1&amp;format=html">lpr(1)</a> без аргумента <code>-P</code>. Как уже отмечалось, если тестируется принтер, предполагающий использование PostScript®, пошлите ему PostScript®-программу вместо использования утилиты <a href="https://man.freebsd.org/cgi/man.cgi?query=lptest&amp;sektion=1&amp;format=html">lptest(1)</a>. Это можно сделать, поместив программу в файл и выполнив команду <code>lpr <em>file</em></code>.</p></div><div class=paragraph><p>Для PostScript®-принтера вы должны получить результаты выполнения программы. Если вы используете <a href="https://man.freebsd.org/cgi/man.cgi?query=lptest&amp;sektion=1&amp;format=html">lptest(1)</a>, ваши результаты должны иметь такой вид:</p></div><div class="literalblock programlisting"><div class=content><pre>!&#34;#$%&amp;&#39;()*+,-./01234
&#34;#$%&amp;&#39;()*+,-./012345
#$%&amp;&#39;()*+,-./0123456
$%&amp;&#39;()*+,-./01234567
%&amp;&#39;()*+,-./012345678</pre></div></div><div class=paragraph><p>Для дальнейшего тестирования принтера, попытайтесь загрузить программы побольше (для принтеров, поддерживающих определенный язык) или выполните команду <a href="https://man.freebsd.org/cgi/man.cgi?query=lptest&amp;sektion=1&amp;format=html">lptest(1)</a> с другими аргументами. Например, команда <code>lptest 80 60</code> выдаст 60 строк по 80 символов в каждой.</p></div><div class=paragraph><p>Если принтер не работает, см. раздел <a href=#printing-troubleshooting>Выявление проблем</a>.</p></div></div></div></div></div></div><div class=sect1><h2 id=printing-advanced>10.4. Расширенная настройка принтера<a class=anchor href=#printing-advanced></a></h2><div class=sectionbody><div class=paragraph><p>В этом разделе описаны фильтры для печати специально сформатированных файлов, начальных страниц, печати по сети, ограничения и учета использования принтера.</p></div><div class=sect2><h3 id=printing-advanced-filter-intro>10.4.1. Фильтры<a class=anchor href=#printing-advanced-filter-intro></a></h3><div class=paragraph><p>Хотя система LPD поддерживает сетевые протоколы, очереди, контроль доступа и другие аспекты печати, большая часть <em>реальной</em> работы происходит в <em>фильтрах</em>. Фильтры - это программы, взаимодействующие с принтером и обеспечивающие учет особенностей устройства и специальных требований. При простой настройке принтера мы установили фильтр для обычного текста - крайне простой, который должен работать с большинством принтеров (см. раздел <a href=#printing-textfilter>Установка текстового фильтра</a>).</p></div><div class=paragraph><p>Однако, чтобы обеспечить преобразования формата, учет использования принтера и индивидуальных особенностей отдельных принтеров и т.п., надо разобраться, как работают фильтры. В конечном итоге, всеми этими аспектами печати должен заниматься фильтр. А плохая новость состоит в том, что, в большинстве случаев, вы <em>сами</em> должны предоставить соответствующие фильтры. Хорошая новость состоит в том, что многие фильтры общедоступны; а если подходящих нет, их обычно легко написать.</p></div><div class=paragraph><p>Кроме того, в составе ОС FreeBSD поставляется один фильтр, <span class=filename>/usr/libexec/lpr/lpf</span>, работающий со многими принтерами, которые могут печатать обычный текст. (Он обрабатывает символы забоя и табуляции в файле, выполняет учет использования, но и не более того.) Есть также ряд фильтров и компонентов фильтров в наборе портов FreeBSD.</p></div><div class=paragraph><p>Вот что вы найдете в этом разделе:</p></div><div class=ulist><ul><li><p>В разделе <a href=#printing-advanced-filters>Как работают фильтры</a> сделана попытка дать обзор роли фильтра в процессе печати. Прочтите этот раздел, чтобы понять, что происходит "за кадром", когда система LPD использует фильтры. Это понимание поможет предвидеть и решать проблемы, с которыми вы можете столкнуться при добавлении дополнительных фильтров для каждого из принтеров.</p></li><li><p>Система LPD предполагает, что каждый принтер, по умолчанию, может печатать обычный текст. Это проблематично для PostScript®-принтеров (или принтеров на базе другого языка), поскольку они не могут печатать обычный текст непосредственно. В разделе <a href=#printing-advanced-if-conversion>Прием заданий с обычным текстом на PostScript®-принтеры</a> описано, что нужно сделать, чтобы решить эту проблему. Прочтите этот раздел, если используете PostScript®-принтер.</p></li><li><p>PostScript® - популярный формат выдачи для многих программ. Некоторые люди даже пишут PostScript®-код непосредственно. К сожалению, PostScript®-принтеры дороги. В разделе <a href=#printing-advanced-ps>Имитация PostScript® на не-PostScript® принтерах</a> описано, как можно дополнительно изменить текстовый фильтр принтера для приема и печати данных PostScript® не <em>не-PostScript®</em> принтере. Прочтите этот раздел, если ваш принтер не поддерживает PostScript®.</p></li><li><p>В разделе <a href=#printing-advanced-convfilters>Фильтры преобразования</a> описан способ автоматизации преобразования определенных форматов файлов, например, графики или данных для печатного станка, в форматы, которые может обработать ваш принтер. После чтения этого раздела вы сможете настроить свои принтеры так, что пользователи смогут выполнять команду <code>lpr -t</code> для печати данных troff, или <code>lpr -d</code> для печати данных TeX DVI, или <code>lpr -v</code> - для печати растровых изображений, и так далее. Я рекомендую прочитать этот раздел.</p></li><li><p>В разделе <a href=#printing-advanced-of>Выходные фильтры</a> описана не часто используемая возможность задавать выходные фильтры в системе LPD. Если только вы не печатаете начальные страницы (см. <a href=#printing-advanced-header-pages>Начальные страницы</a>), можно, пожалуй, вообще пропустить этот раздел.</p></li><li><p>В разделе <a href=#printing-advanced-lpf>lpf: текстовый фильтр</a> описана команда <code>lpf</code>, - достаточно полный, хотя и простой текстовый фильтр для строчных принтеров (и лазерных принтеров, работающих как строчные), поставляемый в составе ОС FreeBSD. Если надо быстро настроить учет использования принтера для обычного текста или если используется принтер, из которого при получении символов забоя идет дым, несомненно, стоит подумать об использовании <code>lpf</code>.</p></li></ul></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Различные скрипты, описанные далее, можно найти в каталоге <span class=filename>/usr/shared/examples/printing</span>.</p></div></td></tr></tbody></table></div><div class=sect3><h4 id=printing-advanced-filters>10.4.1.1. Как работают фильтры<a class=anchor href=#printing-advanced-filters></a></h4><div class=paragraph><p>Как уже упоминалось, фильтр - это выполняемая программа, запускаемая системой LPD для поддержки специфических особенностей устройства при взаимодействии с принтером.</p></div><div class=paragraph><p>Когда системе LPD надо напечатать входящий в задание файл, она запускает программу-фильтр. Стандартный входной поток фильтра связывается с файлом, который надо распечатать, его стандартный выходной поток - с принтером, а стандартный поток ошибок перенаправляется в файл регистрации ошибок (задается характеристикой <code>lf</code> в файле <span class=filename>/etc/printcap</span>, или используется стандартное устройство <span class=filename>/dev/console</span>).</p></div><div class=paragraph><p>Запускаемый системой LPD фильтр и его аргументы зависят от того, что указано в файле <span class=filename>/etc/printcap</span>, и какие аргументы указал пользователь для задания в команде <a href="https://man.freebsd.org/cgi/man.cgi?query=lpr&amp;sektion=1&amp;format=html">lpr(1)</a>. Например, если пользователь ввел команду <code>lpr -t</code>, система LPD должна запустить фильтр troff, заданный характеристикой <code>tf</code> для соответствующего принтера. Если пользователь хочет печатать обычный текст, система должна запустить фильтр <code>if</code> (это верно в большинстве случаев: подробнее см. в разделе <a href=#printing-advanced-of>Выходные фильтры</a>).</p></div><div class=paragraph><p>В файле <span class=filename>/etc/printcap</span> можно задавать три вида фильтров:</p></div><div class=ulist><ul><li><p><em>Текстовый фильтр</em>, который в документации LPD двусмысленно называют <em>входным фильтром</em>, обеспечивает печать обычного текста. Рассматривайте его как стандартный фильтр. Система LPD предполагает, что любой принтер может по умолчанию печатать обычный текст, а на текстовый фильтр возлагается задача обеспечить, чтобы символы забоя, табуляции или другие специальные символы не сбивали принтер с толку. Если вы работаете в среде, где надо учитывать использование принтера, текстовый фильтр должен также учитывать количество напечатанных страниц, обычно, подсчитывая количество напечатанных строк и сравнивая их с количеством строк на страницу, поддерживаемых принтером. Текстовый фильтр запускается со следующим списком аргументов:</p><div class=paragraph><p><code>имя-фильтра [-c] -wширина -lдлина -iсдвиг -n имя-пользователя -h хост учетный-файл</code></p></div><div class=dlist><dl><dt class=hdlist1><code>-c</code></dt><dd><p>указывается, если задание послано командой <code>lpr -l</code></p></dd><dt class=hdlist1><em>ширина</em></dt><dd><p>значение из характеристики <code>pw</code> (page width - ширина страницы), указанной в файле <span class=filename>/etc/printcap</span>, по умолчанию - 132</p></dd><dt class=hdlist1><em>длина</em></dt><dd><p>значение из характеристики <code>pl</code> (page length - длина страницы), по умолчанию - 66</p></dd><dt class=hdlist1><em>сдвиг</em></dt><dd><p>сдвиг, заданный командой <code>lpr -i</code>, по умолчанию - 0</p></dd><dt class=hdlist1><em>имя-пользователя</em></dt><dd><p>регистрационное имя пользователя, печатающего файл</p></dd><dt class=hdlist1><em>хост</em></dt><dd><p>имя хоста, с которого было послано задание</p></dd><dt class=hdlist1><em>учетный-файл</em></dt><dd><p>имя учетного файла, задаваемое характеристикой <code>af</code>.</p></dd></dl></div></li><li><p><em>Фильтр преобразования</em> преобразует специфичный формат файла в то, что принтер может воспроизвести на бумаге. Например, данные системы набора ditroff нельзя печатать непосредственно, но можно установить фильтр преобразования для файлов ditroff, чтобы преобразовывать данные ditroff в тот вид, который принтер может воспринять и напечатать. В разделе <a href=#printing-advanced-convfilters>Фильтры преобразования</a> написано всё об этих фильтрах. Фильтры преобразования также необходимы для учета, если предполагается учет использования принтера. Фильтры преобразования запускаются со следующими аргументами:</p><div class=paragraph><p><code>имя-фильтра</code> -x<em>ширина-пиксела</em> -y<em>высота-пиксела</em> -n <em>имя-пользователя</em> -h <em>хост</em> <em>учетный-файл</em> где <em>ширина-пиксела</em> - значение характеристики px (по умолчанию - 0), а <em>высота-пиксела</em> - значение характеристики py (по умолчанию - 0).</p></div></li><li><p><em>Выходной фильтр</em> используется только если нет текстового фильтра или если включена выдача начальных страниц. Судя по моему опыту, выходные фильтры используются редко. Они описаны в разделе <a href=#printing-advanced-of>Выходные фильтры</a>. У выходного фильтра есть всего два аргумента:</p><div class=paragraph><p><code>имя-фильтра</code> -w<em>ширина</em> -l<em>длина</em> которые идентичны аргументам <code>-w</code> и <code>-l</code> текстового фильтра.</p></div></li></ul></div><div class=paragraph><p>Фильтры также должны <em>завершать работу</em> со следующим статусом выхода:</p></div><div class=dlist><dl><dt class=hdlist1>exit 0</dt><dd><p>Если фильтр успешно напечатал файл.</p></dd><dt class=hdlist1>exit 1</dt><dd><p>Если фильтр не смог напечатать файл, но хочет, чтобы система LPD попыталась распечатать файл ещё раз. Система LPD перезапустит фильтр, если его работа завершена с этим статусом.</p></dd><dt class=hdlist1>exit 2</dt><dd><p>Если фильтр не смог напечатать файл и не хочет, чтобы система LPD пыталась его печатать еще раз. Система LPD удалит файл.</p></dd></dl></div><div class=paragraph><p>Поставляемый в составе FreeBSD текстовый фильтр <span class=filename>/usr/libexec/lpr/lpf</span> использует аргументы, задающие ширину и длину страницы для определения того, когда посылать символ прогона страницы (form feed) и как учитывать использование принтера. Он использует переданные в качестве аргументов имя пользователя, хост и учетный файл для внесения учетных записей.</p></div><div class=paragraph><p>При поиске фильтров убедитесь, что они совместимы с системой LPD. Если да, они должны поддерживать описанные выше списки аргументов. Если вы планируете создавать фильтры для общего использования, позаботьтесь о поддержке этих списков аргументов и кодов выхода.</p></div></div><div class=sect3><h4 id=printing-advanced-if-conversion>10.4.1.2. Прием заданий с обычным текстом на PostScript®-принтеры<a class=anchor href=#printing-advanced-if-conversion></a></h4><div class=paragraph><p>Если вы - единственный пользователь компьютера и PostScript®-принтера (или принтера на основе другого языка), и вы обещаете никогда не посылать на принтер обычный текст и никогда не использовать возможностей различных программ, требующих посылки на принтер обычного текста, вам можно не заботиться о том, что описано в этом разделе.</p></div><div class=paragraph><p>Но, если вы хотите посылать на принтер как задания PostScript®, так и обычный текст, рекомендуется дополнить настройку принтера. Для этого надо, чтобы текстовый фильтр определял, является ли поступающее задание обычным текстом или программой на языке PostScript®. Все PostScript®-задания должны начинаться с <code>%!</code> (для других языков принтеров обратитесь к соответствующей документации). Если первые два символа в задании - именно эти, речь идет о PostScript®, и мы можем остальную часть задания передавать непосредственно. Если же первые два символа в файле - другие, фильтр будет преобразовывать текст в PostScript® и печатать результат.</p></div><div class=paragraph><p>Как нам это сделать?</p></div><div class=paragraph><p>Если вы используете последовательный принтер, хороший способ достичь поставленной цели состоит в установке <code>lprps</code>. <code>lprps</code> - это фильтр для PostScript®-принтера, выполняющий двустороннее взаимодействие с принтером. Он обновляет файл состояния принтера, помещая в него подробную информацию, выданную принтером, так что пользователи и администраторы могут узнать, в каком именно состоянии (например, <code>toner low</code> или <code>paper jam</code>) находится принтер. Но еще важнее, что он включает программу <code>psif</code>, которая определяет, является ли входящее задание обычным текстом, и вызывает <code>textps</code> (еще одну программу, поставляемую вместе с <code>lprps</code>) для преобразования его в PostScript®. Затем <code>lprps</code> посылает преобразованное задание на принтер.</p></div><div class=paragraph><p><code>lprps</code> входит в набор портов FreeBSD (см. <a href=../ports/#ports>Набор портов</a>). Вы, конечно, можете загрузить, собрать и установить его самостоятельно. После установки <code>lprps</code> просто укажите путь к программе <code>psif</code>, входящей в состав пакета <code>lprps</code>. Если вы установили <code>lprps</code> из Коллекции Портов, используйте следующий текст в записи для последовательного PostScript®-принтера в файле <span class=filename>/etc/printcap</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>:if=/usr/local/libexec/psif:</pre></div></div><div class=paragraph><p>Надо также задать характеристику <code>rw</code>; она требует от системы LPD открывать принтер в режиме чтения и записи.</p></div><div class=paragraph><p>При использовании параллельного PostScript®-принтера (что не позволяет обеспечить двустороннее взаимодействие с принтером, необходимое для системы <code>lprps</code>), можно использовать в качестве текстового фильтра следующий скрипт командного интерпретатора:</p></div><div class="literalblock programlisting"><div class=content><pre>#!/bin/sh
#
#  psif - Печать PostScript или обычного текста на PostScript-принтере
#  Скрипт, а НЕ версия, входящая в состав lprps
#  Установлен в /usr/local/libexec/psif
#

IFS=&#34;&#34; read -r first_line
first_two_chars=`expr &#34;$first_line&#34; : &#39;\(..\)&#39;`

if [ &#34;$first_two_chars&#34; = &#34;%!&#34; ]; then
    #
    #  Задание PostScript, печатать его.
    #
    echo &#34;$first_line&#34; &amp;&amp; cat &amp;&amp; printf &#34;\004&#34; &amp;&amp; exit 0
    exit 2
else
    #
    #  Обычный текст, преобразовать его, а затем напечатать.
    #
    ( echo &#34;$first_line&#34;; cat ) | /usr/local/bin/textps &amp;&amp; printf &#34;\004&#34; &amp;&amp; exit 0
    exit 2
fi</pre></div></div><div class=paragraph><p>В представленном выше скрипте, <code>textps</code> - отдельно установленная программа для преобразования обычного текста в PostScript®. Можно использовать любую программу преобразования текста в PostScript®. Коллекция Портов FreeBSD (см. материал о <a href=../ports/#ports>Коллекции Портов</a>) включает полнофункциональную программу преобразования текста в PostScript® под названием <code>a2ps</code>, которую тоже можно попробовать использовать.</p></div></div><div class=sect3><h4 id=printing-advanced-ps>10.4.1.3. Имитация PostScript® на не-PostScript® принтерах<a class=anchor href=#printing-advanced-ps></a></h4><div class=paragraph><p>PostScript® является <em>фактическим</em> стандартом для высококачественного набора и печати. PostScript®, однако, - <em>дорогой</em> стандарт. К счастью, благодаря компании Aladdin Enterprises есть свободный аналог PostScript® под названием Ghostscript, который работает с FreeBSD. Ghostscript может читать большинство PostScript®-файлов и выдавать соответствующие страницы на множество устройств, включая многие моделей не-PostScript принтеров. Установив Ghostscript и используя специальный текстовый фильтр для принтера, можно заставить ваш не-PostScript® принтер работать фактически как PostScript®-принтер.</p></div><div class=paragraph><p>Ghostscript входит в набор портов FreeBSD, если вы хотите устанавливать его оттуда. Вы можете также легко загрузить, собрать и установить его самостоятельно.</p></div><div class=paragraph><p>Для имитации PostScript® надо, чтобы текстовый фильтр определял, печатается ли PostScript®-файл. Если нет, фильтр будет передавать файл на принтер непосредственно; в противном случае, он будет использовать Ghostscript, чтобы сначала преобразовать файл в формат, который поймет принтер.</p></div><div class=paragraph><p>Рассмотрим пример: следующий сценарий представляет собой текстовый фильтр для принтеров Hewlett Packard DeskJet 500. Для других принтеров замените аргумент <code>-sDEVICE</code> в команде <code>gs</code> (Ghostscript). (Введите команду <code>gs -h</code> для получения списка устройств, поддерживаемых установленной версией Ghostscript.)</p></div><div class="literalblock programlisting"><div class=content><pre>#!/bin/sh
#
#  ifhp - Печать Ghostscript-эмулированного PostScript на DeskJet 500
#  Установлен в /usr/local/libexec/ifhp

#
#  Обрабатывать LF как CR+LF (чтобы избежать &#34;эффекта ступенек&#34;
#  на принтерах HP/PCL:
#
printf &#34;\033&amp;k2G&#34; || exit 2

#
#  Прочитать первые два символа файла
#
IFS=&#34;&#34; read -r first_line
first_two_chars=`expr &#34;$first_line&#34; : &#39;\(..\)&#39;`

if [ &#34;$first_two_chars&#34; = &#34;%!&#34; ]; then
    #
    #  Это PostScript; используем Ghostscript для чтения, преобразования и печати.
    #
    /usr/local/bin/gs -dSAFER -dNOPAUSE -q -sDEVICE=djet500 \
        -sOutputFile=- - &amp;&amp; exit 0
else
    #
    #  Обычный текст или HP/PCL, поэтому просто печатаем его напрямую; печатаем в
    #  конце символ прогона страницы, чтобы была выдана последняя страница.
    #
    echo &#34;$first_line&#34; &amp;&amp; cat &amp;&amp; printf &#34;\033&amp;l0H&#34; &amp;&amp;
exit 0
fi

exit 2</pre></div></div><div class=paragraph><p>Наконец, надо указать системе LPD, какой фильтр использовать, задав характеристику <code>if</code>:</p></div><div class="literalblock programlisting"><div class=content><pre>:if=/usr/local/libexec/ifhp:</pre></div></div><div class=paragraph><p>Вот и все. Теперь можно выполнять <code>lpr plain.text</code> и <span class=filename>lpr whatever.ps</span>, и обе команды должны успешно печатать.</p></div></div><div class=sect3><h4 id=printing-advanced-convfilters>10.4.1.4. Фильтры преобразования<a class=anchor href=#printing-advanced-convfilters></a></h4><div class=paragraph><p>После завершения простой настройки, описанной в разделе <a href=#printing-simple>Простая настройка принтера</a>, прежде всего, вам может потребоваться установить фильтры преобразования для любимых форматов файлов (кроме обычных текстов ASCII).</p></div><div class=sect4><h5 id=_зачем_устанавливать_фильтры_преобразования>10.4.1.4.1. Зачем устанавливать фильтры преобразования?<a class=anchor href=#_зачем_устанавливать_фильтры_преобразования></a></h5><div class=paragraph><p>Фильтры преобразования упрощают печать различного рода файлов. В качестве примера, предположим, что активно используется издательская система TeX и имеется PostScript®-принтер. При каждой генерации DVI-файла из TeX, мы не можем печатать его непосредственно, пока не преобразуем в PostScript®. Для этого используется такая последовательность команд:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% dvips seaweed-analysis.dvi
% lpr seaweed-analysis.ps</code></pre></div></div><div class=paragraph><p>Установив фильтр преобразования для файлов DVI, мы можем не конвертировать файл каждый раз вручную, возложив эту задачу на систему LPD. Теперь при каждом получении DVI-файла нас от его распечатки отделяет только один шаг:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% lpr <span class=nt>-d</span> seaweed-analysis.dvi</code></pre></div></div><div class=paragraph><p>Мы заставили систему LPD автоматически преобразовывать DVI-файл, указав опцию <code>-d</code>. Все опции преобразования представлены в разделе <a href=#printing-lpr-options-format>Опции форматирования и преобразования</a>.</p></div><div class=paragraph><p>Для каждой из опций преобразования, которая должна поддерживаться принтером, установите <em>фильтр преобразования</em> и укажите его полное имя в файле <span class=filename>/etc/printcap</span>. Фильтр преобразования аналогичен текстовому фильтру для простой настройки принтера (см. раздел <a href=#printing-textfilter>Установка текстового фильтра</a>), но вместо печати обычного текста он преобразует файл в формат, который может понять принтер.</p></div></div><div class=sect4><h5 id=_какие_фильтры_преобразования_следует_устанавливать>10.4.1.4.2. Какие фильтры преобразования следует устанавливать?<a class=anchor href=#_какие_фильтры_преобразования_следует_устанавливать></a></h5><div class=paragraph><p>Устанавливать надо те фильтры преобразования, которые предполагается использовать. Если вы часто печатаете файлы DVI, значит, фильтр преобразования DVI необходим. Если вам часто приходится печатать результаты работы troff, может потребоваться фильтр troff.</p></div><div class=paragraph><p>В следующей таблице представлены фильтры, с которыми работает система LPD, их соответствующие характеристики для файла <span class=filename>/etc/printcap</span>, а также способ их вызова в команде <code>lpr</code>:</p></div><table class="tableblock frame-none grid-all stretch informaltable"><col style=width:33.3333%><col style=width:33.3333%><col style=width:33.3334%><thead><tr><th class="tableblock halign-left valign-top">Тип файла</th><th class="tableblock halign-left valign-top">Характеристика /etc/printcap</th><th class="tableblock halign-left valign-top">Опция lpr</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock>cifplot</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>cf</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>-c</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>DVI</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>df</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>-d</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>plot</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>gf</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>-g</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>ditroff</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>nf</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>-n</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Текст на языке FORTRAN</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>rf</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>-f</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>troff</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>tf</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>-f</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>растровое изображение</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>vf</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>-v</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>обычный текст</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>if</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>никакой, <code>-p</code> или <code>-l</code></p></td></tr></tbody></table><div class=paragraph><p>В нашем примере использование <code>lpr -d</code> означает, что для принтера должна быть задана характеристика <code>df</code> в записи в файле <span class=filename>/etc/printcap</span>.</p></div><div class=paragraph><p>Вопреки мнению многих, форматы вроде текста на языке FORTRAN и plot, вероятно, устарели. У себя на машине вы можете дать новые значения этим или любым другим опциям форматирования, установив соответствующие специализированные фильтры. Например, пусть необходимо напрямую печатать файлы Printerleaf (файлы настольной издательской системы Interleaf), но вообще вы не собираетесь печатать файлы типа plot. Можно установить фильтр преобразования Printerleaf в качестве значения характеристики <code>gf</code> и научить своих пользователей, что команда <code>lpr -g</code> означает "печатать файлы Printerleaf".</p></div></div><div class=sect4><h5 id=_установка_фильтров_преобразования>10.4.1.4.3. Установка фильтров преобразования<a class=anchor href=#_установка_фильтров_преобразования></a></h5><div class=paragraph><p>Поскольку фильтры преобразования представляют собой программы, не входящие в базовую поставку FreeBSD, их, видимо, надо помещать в каталоге <span class=filename>/usr/local</span>. Популярное местонахождение - каталог <span class=filename>/usr/local/libexec</span>, поскольку эти фильтры являются специализированными программами для выполнения системой LPD; обычным пользователям никогда не понадобится их выполнять.</p></div><div class=paragraph><p>Для включения фильтра преобразования, укажите его полное имя в качестве значения соответствующей характеристики для принтера в файле <span class=filename>/etc/printcap</span>.</p></div><div class=paragraph><p>В качестве примера, давайте добавим фильтр преобразования DVI в запись для принтера <code>bamboo</code>. Вот опять пример файла <span class=filename>/etc/printcap</span>, с новой характеристикой <code>df</code> для принтера <code>bamboo</code>.</p></div><div class="literalblock programlisting"><div class=content><pre>#
#  /etc/printcap для хоста rose - добавлен фильтр df для bamboo
#
rattan|line|diablo|lp|Diablo 630 Line Printer:\
        :sh:sd=/var/spool/lpd/rattan:\
        :lp=/dev/lpt0:\
        :if=/usr/local/libexec/if-simple:

bamboo|ps|PS|S|panasonic|Panasonic KX-P4455 PostScript v51.4:\
        :sh:sd=/var/spool/lpd/bamboo:\
        :lp=/dev/ttyd5:ms#-parenb cs8 clocal crtscts:rw:\
        :if=/usr/local/libexec/psif:\
        :df=/usr/local/libexec/psdf:</pre></div></div><div class=paragraph><p>Фильтр DVI - скрипт командного интерпретатора по имени <span class=filename>/usr/local/libexec/psdf</span>. Вот его текст:</p></div><div class="literalblock programlisting"><div class=content><pre>#!/bin/sh
#
#  psdf - фильтр принтера, преобразующий DVI в PostScript
#  Установлен в /usr/local/libexec/psdf
#
# Вызывается системой lpd при выполнении пользователем команды lpr -d
#
exec /usr/local/bin/dvips -f | /usr/local/libexec/lprps &#34;$@&#34;</pre></div></div><div class=paragraph><p>Это скрипт выполняет команду <code>dvips</code> в режиме фильтрования (аргумент <code>-f</code>) входного потока, представляющего собой задание для печати. Затем запускается фильтр PostScript®-принтера <code>lprps</code> (см. раздел <a href=#printing-advanced-if-conversion>Прием заданий с обычным текстом на PostScript®-принтеры</a>) с аргументами, переданными системой LPD этому скрипту. Команда <code>lprps</code> будет использовать эти аргументы для учета распечатанных страниц.</p></div></div><div class=sect4><h5 id=_дополнительные_примеры_фильтров_преобразования>10.4.1.4.4. Дополнительные примеры фильтров преобразования<a class=anchor href=#_дополнительные_примеры_фильтров_преобразования></a></h5><div class=paragraph><p>Поскольку нет фиксированного набора шагов для установки фильтров преобразования, я просто представлю дополнительные примеры. Используйте их в качестве руководства при создании собственных фильтров. Используйте их непосредственно, если нужно.</p></div><div class=paragraph><p>Следующий пример фильтра преобразует растровый файл (точнее, GIF-файл) для печати на принтере Hewlett Packard LaserJet III-Si:</p></div><div class="literalblock programlisting"><div class=content><pre>#!/bin/sh
#
#  hpvf - Преобразовать GIF-файлы в HP/PCL и напечатать
#  Установлен в /usr/local/libexec/hpvf

PATH=/usr/X11R6/bin:$PATH; export PATH
giftopnm | ppmtopgm | pgmtopbm | pbmtolj -resolution 300 \
    &amp;&amp; exit 0 \
    || exit 2</pre></div></div><div class=paragraph><p>Он работает путем преобразования GIF-файла в переносимый формат anymap, его - в переносимый формат graymap, затем - в переносимый bitmap, а уже его - в данные, подходящие для LaserJet/PCL.</p></div><div class=paragraph><p>Вот файл <span class=filename>/etc/printcap</span> с записью для принтера, в которой используется представленный выше фильтр:</p></div><div class="literalblock programlisting"><div class=content><pre>#
#  /etc/printcap для хоста orchid
#
teak|hp|laserjet|Hewlett Packard LaserJet 3Si:\
        :lp=/dev/lpt0:sh:sd=/var/spool/lpd/teak:mx#0:\
        :if=/usr/local/libexec/hpif:\
        :vf=/usr/local/libexec/hpvf:</pre></div></div><div class=paragraph><p>Следующий скрипт является фильтром преобразования для печати данных troff, получаемых из системы набора groff, на PostScript®-принтере <code>bamboo</code>:</p></div><div class="literalblock programlisting"><div class=content><pre>#!/bin/sh
#
#  pstf - Преобразует выдаваемые groff данные troff в PS и печатает.
#  Установлен в /usr/local/libexec/pstf
#
exec grops | /usr/local/libexec/lprps &#34;$@&#34;</pre></div></div><div class=paragraph><p>Представленный выше скрипт снова использует команду <code>lprps</code> для взаимодействия с принтером. Если принтер подключен к параллельному порту, придется использовать следующий скрипт:</p></div><div class="literalblock programlisting"><div class=content><pre>#!/bin/sh
#
#  pstf - Преобразует выдаваемые groff данные troff в PS и печатает.
#  Установлен в /usr/local/libexec/pstf
#
exec grops</pre></div></div><div class=paragraph><p>Вот и все. Вот какую запись надо добавить в файл <span class=filename>/etc/printcap</span>, чтобы включить этот фильтр:</p></div><div class="literalblock programlisting"><div class=content><pre>:tf=/usr/local/libexec/pstf:</pre></div></div><div class=paragraph><p>Вот пример, который пригодится старым специалистам по языку FORTRAN. Это фильтр для печати текста программы на языке FORTRAN на любом принтере, который может непосредственно печатать обычный текст. Мы установим его для принтера <code>teak</code>:</p></div><div class="literalblock programlisting"><div class=content><pre>#!/bin/sh
#
# hprf - Фильтр текста на языке FORTRAN для LaserJet 3si:
# Установлен в /usr/local/libexec/hprf
#

printf &#34;\033&amp;k2G&#34; &amp;&amp; fpr &amp;&amp; printf &#34;\033&amp;l0H&#34; &amp;&amp;
 exit 0
exit 2</pre></div></div><div class=paragraph><p>Надо добавить следующую строку к записи в файле <span class=filename>/etc/printcap</span> для принтера <code>teak</code>, чтобы включить этот фильтр:</p></div><div class="literalblock programlisting"><div class=content><pre>:rf=/usr/local/libexec/hprf:</pre></div></div><div class=paragraph><p>Перейдем к последнему, более сложному примеру. Мы добавим фильтр DVI для уже использовавшегося принтера LaserJet по имени <code>teak</code>. Сначала простая часть: изменить файл <span class=filename>/etc/printcap</span>, указав местонахождение фильтра DVI:</p></div><div class="literalblock programlisting"><div class=content><pre>:df=/usr/local/libexec/hpdf:</pre></div></div><div class=paragraph><p>А теперь - часть посложнее: создать фильтр. Для этого нам понадобится программа преобразования DVI в LaserJet/PCL. Набор портов FreeBSD (см. <a href=../ports/#ports>Набор портов</a>) содержит одну: соответствующий пакет называется <code>dvi2xx</code>. Установка этого пакета дает нам необходимую программу, <code>dvilj2p</code>, которая преобразует DVI в коды, подходящие для LaserJet IIp, LaserJet III и LaserJet 2000.</p></div><div class=paragraph><p>Команда <code>dvilj2p</code> требует создания достаточно сложного фильтра <code>hpdf</code>, поскольку она не может читать стандартный входной поток. Она хочет работать с именем файла. Что еще хуже, имя файла должно завершаться расширением <span class=filename>.dvi</span>, так что использование стандартного входного потока <span class=filename>/dev/fd/0</span> тоже проблематично. Мы можем обойти эту проблему, создав (символическую) связь (с именем, завершающимся суффиксом <span class=filename>.dvi</span>) с устройством <span class=filename>/dev/fd/0</span>, тем самым, заставив команду <code>dvilj2p</code> читать из стандартного входного потока.</p></div><div class=paragraph><p>Единственная оставшаяся проблема состоит в том, что мы не можем создавать временную связь в каталоге <span class=filename>/tmp</span>. Символьные связи принадлежат пользователю и группе <code>bin</code>. Фильтр же работает от имени пользователя <code>daemon</code>. А у каталога <span class=filename>/tmp</span> установлен sticky bit. Фильтр сможет создать связь, но не сможет почистить за собой и удалить ее, поскольку связь будет принадлежать другому пользователю.</p></div><div class=paragraph><p>Вместо этого, фильтр будет создавать символическую связь в текущем рабочем каталоге, которым является каталог спулинга (задаваемый характеристикой <code>sd</code> в файле <span class=filename>/etc/printcap</span>). Это отличное место для выполнения фильтрами своих действий, особенно потому, что (иногда) в каталоге спулинга места больше, чем в <span class=filename>/tmp</span>.</p></div><div class=paragraph><p>Вот, наконец, и сам фильтр:</p></div><div class="literalblock programlisting"><div class=content><pre>#!/bin/sh
#
#  hpdf - Печать данных DVI на принтере HP/PCL
#  Установлен в /usr/local/libexec/hpdf

PATH=/usr/local/bin:$PATH; export PATH

#
#  Определяем функцию для удаления временных файлов. Они существуют
#  в текущем каталоге - в каталоге спулинга для принтера.
#
cleanup() {
   rm -f hpdf$$.dvi
}

#
#  Определяем функцию для обработки критических ошибок: напечатать заданное
#  сообщение и выйти с кодом 2. Код выхода 2 сообщает системе LPD, что не
#  надо повторно пытаться печатать задание.
#
fatal() {
    echo &#34;$@&#34; 1&gt;&amp;2
    cleanup
    exit 2
}

#
#  Если пользователь удаляет задание, система LPD будет посылать сигнал SIGINT,
#  поэтому перехватываем SIGINT (и пару других сигналов), чтобы убрать за собой.
#
trap cleanup 1 2 15

#
#  Гарантируем, что не конфликтуем с существующими файлами.
#
cleanup

#
#  Связываем входной файл DVI со стандартным входным потоком (файлом для печати).
#
ln -s /dev/fd/0 hpdf$$.dvi || fatal &#34;Cannot symlink /dev/fd/0&#34;

#
#  Заменяем LF = CR+LF
#
printf &#34;\033&amp;k2G&#34; || fatal &#34;Cannot initialize printer&#34;

#
#  Преобразуем и печатаем. Значение, возвращаемое программой dvilj2p, не надежно,
#  так что мы его игнорируем.
#
dvilj2p -M1 -q -e- dfhp$$.dvi

#
#  Убираем за собой и завершаем работу
#
cleanup
exit 0</pre></div></div></div><div class=sect4><h5 id=printing-advanced-autoconv>10.4.1.4.5. Автоматизированное преобразование: альтернатива фильтрам преобразования<a class=anchor href=#printing-advanced-autoconv></a></h5><div class=paragraph><p>Все эти фильтры преобразования многое дают для среды печати, но требуют от пользователя указывать (в командной строке <a href="https://man.freebsd.org/cgi/man.cgi?query=lpr&amp;sektion=1&amp;format=html">lpr(1)</a>), какой именно фильтр использовать. Если пользователи не особенно разбираются в компьютерах, необходимость указывать опцию фильтра будет их раздражать. Что еще хуже, однако, при неправильном указании опции фильтрования может быть применен фильтр, не соответствующий типу файла, и принтер испортит несколько сотен страниц бумаги.</p></div><div class=paragraph><p>Вместо установки фильтров преобразования, можно попытаться заставить текстовый фильтр (поскольку он применяется по умолчанию) определять тип файла, который его попросили напечатать, и затем автоматически вызывать соответствующий фильтр преобразования. В этом могут помочь утилиты вроде <code>file</code>. Конечно, будет сложно различать <em>некоторые</em> типы файлов - и, конечно же, можно задавать фильтры преобразования только для них.</p></div><div class=paragraph><p>В наборе портов FreeBSD есть текстовый фильтр, выполняющий автоматическое преобразование; это <code>apsfilter</code>. Он может выявлять обычный текст, PostScript® и файлы DVI, выполнять соответствующие преобразования и печатать результат.</p></div></div></div><div class=sect3><h4 id=printing-advanced-of>10.4.1.5. Выходные фильтры<a class=anchor href=#printing-advanced-of></a></h4><div class=paragraph><p>Система спулинга LPD поддерживает еще один тип фильтров, который мы еще не рассматривали: выходные фильтры. Выходной фильтр предназначен только для печати обычного текста, как текстовый фильтр, но с множеством упрощений. Если вы используете выходной фильтр, а текстовый фильтр не задан, то:</p></div><div class=ulist><ul><li><p>Система LPD запускает выходной фильтр один раз для всего задания, а не для каждого файла задания.</p></li><li><p>Система LPD не пытается определить начало или конец файлов в задании для выходного фильтра.</p></li><li><p>Система LPD не передает выходному фильтру имя пользователя или хоста, так что этот фильтр не предназначен для учета использования принтера. Фактически, он получает всего два аргумента:</p><div class=paragraph><p><code>имя-фильтра</code> -w<em>ширина</em> -l<em>длина</em></p></div><div class=paragraph><p>Где <em>ширина</em> берется из характеристики <code>pw</code>, а <em>длина</em> - из характеристики <code>pl</code> для соответствующего принтера.</p></div></li></ul></div><div class=paragraph><p>Не соблазняйтесь простотой выходного фильтра. Если вы хотите, чтобы каждый файл в задании начинал печататься с новой страницы, выходной фильтр <em>не поможет</em>. Используйте текстовый фильтр (также известный как входной); см. раздел <a href=#printing-textfilter>Установка текстового фильтра</a>. Более того, выходной фильтр, фактически, - <em>более сложный</em>, поскольку он должен проверять посылаемый ему поток байтов в поисках специальных символов-флагов и посылать себе сигналы от имени системы LPD.</p></div><div class=paragraph><p>Однако выходной фильтр <em>необходим</em>, если надо выдавать начальные страницы и требуется посылать управляющие последовательности или другие строки инициализации, чтобы можно было напечатать начальную страницу. (Но он <em>не поможет</em>, если необходимо учитывать начальные страницы для пользователя, поскольку система LPD не передает выходному фильтру никакой информации о пользователе или хосте.)</p></div><div class=paragraph><p>На одном принтере система LPD позволяет совместно с выходным использовать текстовый или другие фильтры. В таких случаях, система LPD будет запускать выходной фильтр только для печати начальной страницы (см. раздел <a href=#printing-advanced-header-pages>Начальные страницы</a>). Система LPD затем предполагает, что выходной фильтр <em>остановится</em>, посылая ему два байта: ASCII 031 и ASCII 001. Когда выходной фильтр видит эти два байта (031, 001), он должен остановиться, посылая себе сигнал <code>SIGSTOP</code>. Когда система LPD закончит выполнение остальных фильтров, она перезапускает выходной фильтр, посылая ему сигнал <code>SIGCONT</code>.</p></div><div class=paragraph><p>Если есть выходной фильтр, но <em>нет</em> текстового, и система LPD обрабатывает задания с обычным текстом, LPD использует для выполнения задания выходной фильтр. Как уже было сказано, выходной фильтр будет печатать все файлы задания последовательно, без прогонов страниц или других настроек бумаги, а это <em>вряд ли</em> вас устроит. Почти во всех случаях необходим текстовый фильтр.</p></div><div class=paragraph><p>Программа <code>lpf</code>, которую мы представили ранее как текстовый фильтр, может также работать как выходной фильтр. Если срочно необходим простой выходной фильтр, но вы не хотите писать код для выявления байтов и посылки сигнала, попробуйте использовать <code>lpf</code>. Можно также поместить <code>lpf</code> в скрипт командного интерпретатора для обработки любых кодов инициализации, которые может потребовать принтер.</p></div></div><div class=sect3><h4 id=printing-advanced-lpf>10.4.1.6. <code>lpf</code>: текстовый фильтр<a class=anchor href=#printing-advanced-lpf></a></h4><div class=paragraph><p>Программа <span class=filename>/usr/libexec/lpr/lpf</span>, поставляемая в составе двоичного дистрибутива FreeBSD, представляет собой текстовый (входной) фильтр, который может печатать с отступом (если задание послано командой <code>lpr -i</code>), пропускать все символы на печать (если задание послано командой <code>lpr -l</code>), настраивать позицию печати при получении в задании символов забоя и табуляции, а также учитывать количество напечатанных страниц. Она может также использоваться как выходной фильтр.</p></div><div class=paragraph><p>Программа <code>lpf</code> подходит для многих сред печати. И хотя она не позволяет посылать на принтер инициализационные последовательности, легко написать скрипт командного интерпретатора, который будет выполнять необходимую инициализацию, а затем вызывать <code>lpf</code>.</p></div><div class=paragraph><p>Чтобы программа <code>lpf</code> корректно выполняла учет страниц, ей необходимо указать корректные значения характеристик <code>pw</code> и <code>pl</code> в файле <span class=filename>/etc/printcap</span>. Она использует эти значения для определения того, сколько текста может поместиться на странице и сколько страниц было в задании пользователя. Подробнее об учете использования принтера см. в разделе <a href=#printing-advanced-acct>Учет использования принтера</a>.</p></div></div></div><div class=sect2><h3 id=printing-advanced-header-pages>10.4.2. Начальные страницы<a class=anchor href=#printing-advanced-header-pages></a></h3><div class=paragraph><p>При наличии <em>множества</em> пользователей, использующих различные принтеры, вероятно, можно считать <em>начальные страницы</em> неизбежным злом.</p></div><div class=paragraph><p>Начальные страницы, которые также называют <em>баннерными</em> или <em>разделительными страницами</em>, идентифицируют, кому принадлежат задания после их печати. Обычно информация на них выдается большими, жирными буквами, возможно, с декоративными рамочками, чтобы в пачке распечаток они отличались от реальных документов, образующих задания пользователей. Они позволяют пользователям быстро находить свои задания. Очевидный недостаток выдачи начальных страниц состоит в том, что для каждого задания надо печатать на одну страницу больше, причем, страница эта хоть сколько-нибудь нужна несколько минут, а затем она оказывается в мусорной корзине или сдается в макулатуру. (Учтите, что начальная страница выдается в начале задания, а не перед каждым файлом, так что бумаги может теряться не так уж и много.)</p></div><div class=paragraph><p>Система LPD может выдавать заголовочные страницы для ваших распечаток автоматически, <em>если</em> ваш принтер может непосредственно печатать обычный текст. Если используется PostScript®-принтер, потребуется внешняя программа для генерации начальной страницы; см. <a href=#printing-advanced-header-pages-ps>Начальные страницы на PostScript®-принтерах</a>.</p></div><div class=sect3><h4 id=printing-advanced-header-pages-enabling>10.4.2.1. Включение выдачи начальных страниц<a class=anchor href=#printing-advanced-header-pages-enabling></a></h4><div class=paragraph><p>В разделе <a href=#printing-simple>Простая настройка принтера</a> мы отключили выдачу начальных страниц, задав характеристику <code>sh</code> (что означает "suppress header") в файле <span class=filename>/etc/printcap</span>. Для включения выдачи начальных страниц на принтер, просто удалите характеристику <code>sh</code>.</p></div><div class=paragraph><p>Кажется слишком просто, правда?</p></div><div class=paragraph><p>Вы правы. <em>Может</em> потребоваться задать выходной фильтр для посылки строк инициализации на принтер. Вот пример выходного фильтра для Hewlett Packard PCL-совместимых принтеров:</p></div><div class="literalblock programlisting"><div class=content><pre>#!/bin/sh
#
#  hpof - Выходной фильтр для Hewlett Packard PCL-совместимых принтеров
#  Установлен в /usr/local/libexec/hpof

printf &#34;\033&amp;k2G&#34; || exit 2
exec /usr/libexec/lpr/lpf</pre></div></div><div class=paragraph><p>Задайте полное имя выходного фильтра в качестве значения характеристики <code>of</code>. Подробнее об этом см. в разделе <a href=#printing-advanced-of>Выходные фильтры</a>.</p></div><div class=paragraph><p>Вот пример файла <span class=filename>/etc/printcap</span> для принтера <code>teak</code>, который мы представили ранее; мы включили выдачу начальных страниц и добавили показанный выше выходной фильтр:</p></div><div class="literalblock programlisting"><div class=content><pre>#
#  /etc/printcap для хоста orchid
#
teak|hp|laserjet|Hewlett Packard LaserJet 3Si:\
        :lp=/dev/lpt0:sd=/var/spool/lpd/teak:mx#0:\
        :if=/usr/local/libexec/hpif:\
        :vf=/usr/local/libexec/hpvf:\
        :of=/usr/local/libexec/hpof:</pre></div></div><div class=paragraph><p>Теперь, когда пользователи выдают задания на принтер <code>teak</code>, они получают начальную страницу с каждым заданием. Если пользователи хотят тратить время на поиск своих распечаток, они могут подавить вывод начальных страниц, посылая задание с опцией <code>lpr -h</code>; другие опции <a href="https://man.freebsd.org/cgi/man.cgi?query=lpr&amp;sektion=1&amp;format=html">lpr(1)</a> см. в разделе <a href=#printing-lpr-options-misc>Опции начальных страниц</a>.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Система LPD выдает символ прогона страницы (form feed) после начальной страницы. Если ваш принтер использует другой символ или последовательность символов для выброса напечатанной страницы, укажите их в качестве значения характеристики <code>ff</code> в файле <span class=filename>/etc/printcap</span>.</p></div></td></tr></tbody></table></div></div><div class=sect3><h4 id=printing-advanced-header-pages-controlling>10.4.2.2. Управление начальными страницами<a class=anchor href=#printing-advanced-header-pages-controlling></a></h4><div class=paragraph><p>Включая выдачу начальных страниц, система LPD будет выдавать длинный <em>длинный заголовок</em>, целую страницу с большими буквами, идентифицирующими пользователя, хост и задание. Ниже представлен пример (kelly напечатала задание по имени outline с хоста <code>rose</code>):</p></div><div class="literalblock programlisting"><div class=content><pre>      k                   ll       ll
      k                    l        l
      k                    l        l
      k   k     eeee       l        l     y    y
      k  k     e    e      l        l     y    y
      k k      eeeeee      l        l     y    y
      kk k     e           l        l     y    y
      k   k    e    e      l        l     y   yy
      k    k    eeee      lll      lll     yyy y
                                               y
                                          y    y
                                           yyyy

                                   ll
                          t         l        i
                          t         l
       oooo    u    u   ttttt       l       ii     n nnn     eeee
      o    o   u    u     t         l        i     nn   n   e    e
      o    o   u    u     t         l        i     n    n   eeeeee
      o    o   u    u     t         l        i     n    n   e
      o    o   u   uu     t  t      l        i     n    n   e    e
       oooo     uuu u      tt      lll      iii    n    n    eeee

      r rrr     oooo     ssss     eeee
      rr   r   o    o   s    s   e    e
      r        o    o    ss      eeeeee
      r        o    o      ss    e
      r        o    o   s    s   e    e
      r         oooo     ssss     eeee

                                              Job:  outline
                                              Date: Sun Sep 17 11:04:58 1995</pre></div></div><div class=paragraph><p>Система LPD добавляет прогон страницы после этого текста, чтобы задание начиналось с новой страницы (если только вы не указали характеристику <code>sf</code> (suppress form feeds) в записи соответствующего принтера в файле <span class=filename>/etc/printcap</span>).</p></div><div class=paragraph><p>Если вы предпочитаете, чтобы система LPD создавала <em>короткий заголовок</em>, укажите характеристику <code>sb</code> (short banner) в файле <span class=filename>/etc/printcap</span>. Начальная страница будет иметь следующий вид:</p></div><div class="literalblock programlisting"><div class=content><pre>rose:kelly  Job: outline  Date: Sun Sep 17 11:07:51 1995</pre></div></div><div class=paragraph><p>Также по умолчанию система LPD печатает начальную страницу перед заданием. Для изменения порядка на обратный, укажите характеристику <code>hl</code> (header last) в файле <span class=filename>/etc/printcap</span>.</p></div></div><div class=sect3><h4 id=printing-advanced-header-pages-accounting>10.4.2.3. Учет начальных страниц<a class=anchor href=#printing-advanced-header-pages-accounting></a></h4><div class=paragraph><p>Использование встроенных начальных страниц системы LPD порождает определенную парадигму учета использования принтера: начальные страницы пользователи <em>не должны оплачивать</em>.</p></div><div class=paragraph><p>Почему?</p></div><div class=paragraph><p>Поскольку выходной фильтр - единственная внешняя программа, управляющая выдачей начальных страниц, которая может выполнять учет, а ей не передают информацию о <em>пользователе или хосте</em> и учётный файл, так что, она не имеет никакого представления о том, на чей счет отнести использование принтера. Также недостаточно просто "добавлять одну страницу" в текстовом фильтре или в любом из фильтров преобразований (которые имеют информацию о пользователе и хосте), поскольку пользователи могут подавлять выдачу начальных страниц с помощью опции <code>lpr -h</code>. И их заставят оплачивать начальные страницы, которые они не печатали. Понятно, что опцию <code>lpr -h</code> будут использовать в большинстве случаев те, кто озабочен проблемами окружающей среды, но вы никак не можете стимулировать ее использование.</p></div><div class=paragraph><p>Также <em>недостаточно</em>, чтобы каждый из фильтров генерировал собственные начальные страницы (и, тем самым, мог их учитывать). Если пользователи захотят отказаться от выдачи начальных страниц и укажут опцию <code>lpr -h</code>, они все равно их получат, и будут вынуждены оплатить, поскольку система LPD не передает информации о наличии опции <code>-h</code> ни одному из этих фильтров.</p></div><div class=paragraph><p>Итак, что же вы можете сделать?</p></div><div class=paragraph><p>Вы можете:</p></div><div class=ulist><ul><li><p>Принять парадигму системы LPD и сделать начальные страницы бесплатными.</p></li><li><p>Установить альтернативную систему вместо LPD, такую как LPRng. В разделе <a href=#printing-lpd-alternatives>Альтернативы стандартному спулеру</a> представлена дополнительная информация о других системах спулинга, которые можно использовать вместо LPD.</p></li><li><p>Написать <em>умный</em> выходной фильтр. Обычно выходной фильтр не предназначен для выполнения чего-то кроме инициализации принтера и простых преобразований символов. Он подходит для начальных страниц и заданий с обычным текстом (когда нет текстового (входного) фильтра). Но, если есть текстовый фильтр для заданий с обычным текстом, то система LPD будет запускать выходной фильтр только для начальных страниц. И выходной фильтр может анализировать текст начальной страницы, которую генерирует система LPD, чтобы определить, на счет какого пользователя и хоста отнести начальную страницу. Единственная проблема этого метода в том, что выходной фильтр все равно не знает, какой учетный файл использовать (ему не передают имя файла, заданное в качестве значения характеристики <code>af</code>), но при наличии хорошо известного учетного файла, его имя можно явно указать в выходном фильтре. Для упрощения этапа анализа задайте характеристику <code>sh</code> (short header) в файле <span class=filename>/etc/printcap</span>. Повторимся, что это может оказаться слишком сложным, и пользователи, несомненно, больше оценят великодушного системного администратора, который сделает начальные страницы бесплатными.</p></li></ul></div></div><div class=sect3><h4 id=printing-advanced-header-pages-ps>10.4.2.4. Начальные страницы на PostScript®-принтерах<a class=anchor href=#printing-advanced-header-pages-ps></a></h4><div class=paragraph><p>Как было описано выше, система LPD может генерировать начальную страницу в виде обычного текста, что подходит для многих принтеров. Конечно, PostScript®-принтеры не могут непосредственно печатать обычный текст, так что, для них возможность выдачи начальных страниц системы LPD бесполезна - или почти бесполезна.</p></div><div class=paragraph><p>Один очевидный способ получить начальные страницы - заставить каждый фильтр преобразования и текстовый фильтр генерировать начальную страницу. Эти фильтры должны использовать аргументы имя пользователя и хост для генерации соответствующей начальной страницы. Недостаток этого метода состоит в том, что пользователи будут всегда получать начальные страницы, даже если будут посылать задания с помощью команды <code>lpr -h</code>.</p></div><div class=paragraph><p>Давайте рассмотрим этот метод детально. Следующий сценарий принимает три аргумента (регистрационное имя пользователя, имя хоста и имя задания) и создает простую начальную страницу на языке PostScript®:</p></div><div class="literalblock programlisting"><div class=content><pre>#!/bin/sh
#
#  make-ps-header - выдать начальную страницу на языке PostScript в stdout
#  Установлен в /usr/local/libexec/make-ps-header
#

#
#  Это единицы измерения PostScript (72 на дюйм). Измените значения для A4 или
#  другого используемого формата бумаги:
#
page_width=612
page_height=792
border=72

#
#  Проверяем аргументы
#
if [ $# -ne 3 ]; then
    echo &#34;Usage: `basename $0` &lt;user&gt; &lt;host&gt; &lt;job&gt;&#34; 1&gt;&amp;2
    exit 1
fi

#
#  Сохраняем значения в переменных, в основном, для упрощения понимания
#  последующего PostScript-кода.
#
user=$1
host=$2
job=$3
date=`date`

#
#  Посылаем PostScript-код в stdout.
#
exec cat &lt;&lt;EOF
%!PS

%
%  Гарантируем, что не будем влиять на следующее далее задание пользователя
%
save

%
%  Делаем тонкую некрасивую рамку по краям бумаги.
%
$border $border moveto
$page_width $border 2 mul sub 0 rlineto
0 $page_height $border 2 mul sub rlineto
currentscreen 3 -1 roll pop 100 3 1 roll setscreen
$border 2 mul $page_width sub 0 rlineto closepath
0.8 setgray 10 setlinewidth stroke 0 setgray

%
%  Выдаем регистрационное имя пользователя, красивыми, большими и рельефными буквами
%
/Helvetica-Bold findfont 64 scalefont setfont
$page_width ($user) stringwidth pop sub 2 div $page_height 200 sub moveto
($user) show

%
%  Теперь выдаем всякие детали
%
/Helvetica findfont 14 scalefont setfont
/y 200 def
[ (Job:) (Host:) (Date:) ] {
200 y moveto show /y y 18 sub def }
forall

/Helvetica-Bold findfont 14 scalefont setfont
/y 200 def
[ ($job) ($host) ($date) ] {
        270 y moveto show /y y 18 sub def
} forall

%
% Вот и все
%
restore
showpage
EOF</pre></div></div><div class=paragraph><p>Теперь, каждый из фильтров преобразования и текстовый фильтр может вызвать этот сценарий, чтобы сначала сгенерировать начальную страницу, а затем напечатать задание пользователя. Вот фильтр преобразования DVI, представленный ранее в этом документе, измененный для выдачи начальной страницы:</p></div><div class="literalblock programlisting"><div class=content><pre>#!/bin/sh
#
#  psdf - фильтр преобразования DVI в PostScript
#  Установлен в /usr/local/libexec/psdf
#
#  Вызывается системой lpd при выполнении пользователем команды lpr -d
#

orig_args=&#34;$@&#34;

fail() {
    echo &#34;$@&#34; 1&gt;&amp;2
    exit 2
}

while getopts &#34;x:y:n:h:&#34; option; do
    case $option in
        x|y)  ;; # Ignore
        n)    login=$OPTARG ;;
        h)    host=$OPTARG ;;
        *)    echo &#34;LPD started `basename $0` wrong.&#34; 1&gt;&amp;2
              exit 2
              ;;
    esac
done

[ &#34;$login&#34; ] || fail &#34;No login name&#34;
[ &#34;$host&#34; ] || fail &#34;No host name&#34;

( /usr/local/libexec/make-ps-header $login $host &#34;DVI File&#34;
  /usr/local/bin/dvips -f ) | eval /usr/local/libexec/lprps $orig_args</pre></div></div><div class=paragraph><p>Обратите внимание, как фильтр должен анализировать список аргументов, чтобы определить имя пользователя и имя хоста. Анализ аргументов в других фильтрах аргументов выполняется точно так же. Текстовый фильтр принимает, однако, немного другой набор аргументов (см. раздел <a href=#printing-advanced-filters>Как работают фильтры</a>).</p></div><div class=paragraph><p>Как уже упоминалось, представленная выше схема хотя и достаточно проста, но не позволяет учесть опцию "подавить вывод начальной страницы" (опция <code>-h</code>) команды <code>lpr</code>. Если пользователи хотят сберечь деревья (или несколько копеек, если вы берете деньги и за начальные страницы), они не смогут этого сделать, поскольку каждый фильтр будет выдавать начальную страницу для каждого задания.</p></div><div class=paragraph><p>Чтобы позволить пользователям отключать выдачу начальной страницы для отдельного задания, надо будет использовать прием, представленный в разделе <a href=#printing-advanced-header-pages-accounting>Учет начальных страниц</a>: написать выходной фильтр, который анализирует сгенерированную системой LPD начальную страницу и выдает ее PostScript®-версию. Если пользователь посылает задание командой <code>lpr -h</code>, система LPD не будет генерировать начальную страницу, как и ваш выходной фильтр. В противном случае, ваш выходной фильтр будет читать текст, полученный от системы LPD, и посылать на принтер соответствующий PostScript®-код для начальной страницы.</p></div><div class=paragraph><p>Если вы используете PostScript®-принтер с последовательным интерфейсом, можно использовать систему <code>lprps</code>, которая включает выходной фильтр, <code>psof</code>, делающий то, что описано выше. Помните, что программа <code>psof</code> не учитывает напечатанные пользователями начальные страницы.</p></div></div></div><div class=sect2><h3 id=printing-advanced-network-printers>10.4.3. Печать по сети<a class=anchor href=#printing-advanced-network-printers></a></h3><div class=paragraph><p>FreeBSD поддерживает печать по сети: посылку заданий на удаленные принтеры. Печатью по сети обычно называют две разные ситуации:</p></div><div class=ulist><ul><li><p>Работа с принтером, подключенным к удаленному хосту. Вы устанавливаете принтер с обычным последовательным или параллельным интерфейсом на одном хосте. Затем, вы настраиваете систему LPD для обеспечения доступа к принтеру с других хостов в сети. В разделе <a href=#printing-advanced-network-rm>"Принтеры, установленные на удаленных хостах"</a> описано, как это сделать.</p></li><li><p>Работа с принтером, подключенным непосредственно к сети. Принтер имеет сетевой интерфейс, кроме (или вместо) более традиционного последовательного или параллельного. Такой принтер может работать следующим образом:</p><div class=ulist><ul><li><p>Он может понимать протокол LPD и даже поддерживать очереди заданий с удаленных хостов. В этом случае, он работает просто как обычный хост с системой LPD. Для настройки такого принтера следуйте той же процедуре, которая описана в разделе <a href=#printing-advanced-network-rm>"Принтеры, установленные на удаленных хостах"</a>.</p></li><li><p>Он может поддерживать получение потока данных по сети. В этом случае, вы "подключаете" принтер к одному из хостов в сети, делая этот хост ответственным за поддержку очередей заданий и их посылку на принтер. В разделе <a href=#printing-advanced-network-net-if>Принтеры с сетевыми интерфейсами</a> представлен ряд советов по установке таких принтеров.</p></li></ul></div></li></ul></div><div class=sect3><h4 id=printing-advanced-network-rm>10.4.3.1. Принтеры, установленные на удаленных хостах<a class=anchor href=#printing-advanced-network-rm></a></h4><div class=paragraph><p>Система спулинга LPD имеет встроенную поддержку посылки заданий на другие хосты, на которых тоже работает система LPD (или совместимая с LPD). Это позволяет установить принтер на одном хосте и сделать его доступным с других хостов. Она также работает с принтерами, имеющими сетевые интерфейсы и понимающими протокол LPD.</p></div><div class=paragraph><p>Для обеспечения такого рода удаленной печати, сначала установите принтер на одном хосте, <em>хосте принтера</em>, с помощью процедуры, описанной в разделе <a href=#printing-simple>Простая настройка принтера</a>. Выполните любые необходимые дополнительные настройки, как описано в разделе <a href=#printing-advanced>Расширенная настройка принтера</a>. Не забудьте протестировать принтер и убедиться, обеспечивает ли он заданные возможности системы LPD. Также проверьте, что <em>локальный хост</em> имеет право использовать службу LPD на <em>удаленном хосте</em> (см. раздел <a href=#printing-advanced-restricting-remote>Ограничение приема заданий с удаленных хостов</a>).</p></div><div class=paragraph><p>Если вы используете принтер с сетевым интерфейсом, совместимый с системой LPD, упомянутым в обсуждении выше <em>хостом принтера</em> будет сам принтер, а в качестве <em>имени принтера</em> будет выступать имя, которое вы сконфигурировали для принтера. См. документацию, поставляемую с принтером и/или сетевым интерфейсом принтера.</p></div><div class="admonitionblock tip"><table><tbody><tr><td class=icon><i class="fa icon-tip" title=Tip></i></td><td class=content><div class=paragraph><p>Если вы используете Hewlett Packard Laserjet, то при задании принтеру имени <code>text</code> будет автоматически выполняться преобразование символа LF в последовательность CRLF, так что, сценарий <span class=filename>hpif</span> не понадобится.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Затем, на других хостах, для которых вы хотите обеспечить доступ к принтеру, создайте запись в их файлах <span class=filename>/etc/printcap</span> со следующими компонентами:</p></div><div class="olist arabic"><ol class=arabic><li><p>Дайте записи любое подходящее имя. Для простоты, однако, имеет смысл задавать такое же имя и псевдонимы, как и на хосте принтера.</p></li><li><p>Характеристику <code>lp</code> оставьте пустой, указав это явно (<code>:lp=:</code>).</p></li><li><p>Создайте каталог спулинга и укажите его местонахождение в характеристике <code>sd</code>. Система LPD будет сохранять задания в нем, прежде чем они будут посланы на хост принтера.</p></li><li><p>Укажите имя хоста принтера в качестве значения характеристики <code>rm</code>.</p></li><li><p>Укажите имя принтера на <em>хосте принтера</em> в качестве значения характеристики <code>rp</code>.</p></li></ol></div><div class=paragraph><p>Вот и все. Не нужно перечислять фильтры преобразования, размеры страницы и вообще ничего больше в файле <span class=filename>/etc/printcap</span>.</p></div><div class=paragraph><p>Рассмотрим пример. На хосте <code>rose</code> есть два принтера, <code>bamboo</code> и <code>rattan</code>. Мы позволим пользователям хоста <code>orchid</code> печатать на эти принтеры. Вот файл <span class=filename>/etc/printcap</span> для хоста <code>orchid</code> (из раздела <a href=#printing-advanced-header-pages-enabling>Включение выдачи начальных страниц</a>). В нем уже есть запись для принтера <code>teak</code>; мы добавили две записи для принтеров на хосте <code>rose</code>:</p></div><div class="literalblock programlisting"><div class=content><pre>#
#  /etc/printcap для хоста orchid - добавлены (удаленные) принтеры на rose
#

#
#  teak - локальный принтер; он подключен непосредственно к orchid:
#
teak|hp|laserjet|Hewlett Packard LaserJet 3Si:\
        :lp=/dev/lpt0:sd=/var/spool/lpd/teak:mx#0:\
        :if=/usr/local/libexec/ifhp:\
        :vf=/usr/local/libexec/vfhp:\
        :of=/usr/local/libexec/ofhp:

#
#  rattan подключен к rose; посылать задания для rattan на хост rose:
#
rattan|line|diablo|lp|Diablo 630 Line Printer:\
        :lp=:rm=rose:rp=rattan:sd=/var/spool/lpd/rattan:

#
#  bamboo тоже подключен к rose:
#
bamboo|ps|PS|S|panasonic|Panasonic KX-P4455 PostScript v51.4:\
        :lp=:rm=rose:rp=bamboo:sd=/var/spool/lpd/bamboo:</pre></div></div><div class=paragraph><p>Затем достаточно только создать каталоги спулинга на <code>orchid</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mkdir -p /var/spool/lpd/rattan /var/spool/lpd/bamboo</span>
<span class=c># chmod 770 /var/spool/lpd/rattan /var/spool/lpd/bamboo</span>
<span class=c># chown daemon:daemon /var/spool/lpd/rattan /var/spool/lpd/bamboo</span></code></pre></div></div><div class=paragraph><p>Теперь пользователи хоста <code>orchid</code> могут печатать на принтеры <code>rattan</code> и <code>bamboo</code>. Если, например, пользователь на <code>orchid</code> выполнит команду</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% lpr <span class=nt>-P</span> bamboo <span class=nt>-d</span> sushi-review.dvi</code></pre></div></div><div class=paragraph><p>система LPD на <code>orchid</code> будет копировать задание в каталог спулинга <span class=filename>/var/spool/lpd/bamboo</span> и учтет, что печатается задание DVI. Как только на хосте <code>rose</code> появится место в каталоге спулинга принтера <code>bamboo</code>, две системы LPD передадут файл на хост <code>rose</code>. Файл будет ждать в очереди на <code>rose</code> пока, наконец, не будет напечатан. Он будет преобразован из формата DVI в PostScript® (поскольку <code>bamboo</code> является PostScript®-принтером) на хосте <code>rose</code>.</p></div></div><div class=sect3><h4 id=printing-advanced-network-net-if>10.4.3.2. Принтеры с сетевыми интерфейсами<a class=anchor href=#printing-advanced-network-net-if></a></h4><div class=paragraph><p>Часто при покупке сетевой карты для принтера можно приобрести две версии: эмулирующую спулер (более дорогая версия) или просто позволяющую принимать на принтер данные так, как если бы использовался последовательный или параллельный порт (более дешевая версия). В этом разделе описано, как использовать более дешёвую версию. Использование более дорогой версии описано в предыдущем разделе <a href=#printing-advanced-network-rm>"Принтеры, установленные на удаленных хостах"</a>.</p></div><div class=paragraph><p>Формат файла <span class=filename>/etc/printcap</span> позволяет указывать, какой последовательный или параллельный интерфейс использовать, и (при использовании последовательного интерфейса), какую установить скорость, использовать ли управление потоком, размер отступов для табуляций, преобразование символов новой строки и другие параметры. Но нет способа указать подключение к принтеру, прослушивающему TCP/IP или другой сетевой порт.</p></div><div class=paragraph><p>Для посылки данных на подключенный к сети принтер, надо разработать программу взаимодействия, которую могут вызывать текстовый фильтр и фильтры преобразований. Вот один из примеров: скрипт <code>netprint</code> принимает все данные со стандартного входного потока и посылает их на принтер, подключенный к сети. Мы указываем имя хоста принтера в качестве первого аргумента, а номер порта, к которому надо подключаться - в качестве второго аргумента команды <code>netprint</code>. Учтите, что поддерживается только одностороннее взаимодействие (с ОС FreeBSD на принтер); многие сетевые принтеры поддерживают двустороннее взаимодействие, и вы можете захотеть его использовать (для получения состояния принтера, учета и т.п.).</p></div><div class="literalblock programlisting"><div class=content><pre>#!/usr/bin/perl
#
#  netprint - Текстовый фильтр для принтера, подключенного к сети
#  Установлен в /usr/local/libexec/netprint
#
$#ARGV eq 1 || die &#34;Usage: $0 &lt;printer-hostname&gt; &lt;port-number&gt;&#34;;

$printer_host = $ARGV[0];
$printer_port = $ARGV[1];

require &#39;sys/socket.ph&#39;;

($ignore, $ignore, $protocol) = getprotobyname(&#39;tcp&#39;);
($ignore, $ignore, $ignore, $ignore, $address)
    = gethostbyname($printer_host);

$sockaddr = pack(&#39;S n a4 x8&#39;, &amp;AF_INET, $printer_port, $address);

socket(PRINTER, &amp;PF_INET, &amp;SOCK_STREAM, $protocol)
    || die &#34;Can&#39;t create TCP/IP stream socket: $!&#34;;
connect(PRINTER, $sockaddr) || die &#34;Can&#39;t contact $printer_host: $!&#34;;
while (&lt;STDIN&gt;) { print PRINTER; }
exit 0;</pre></div></div><div class=paragraph><p>Затем можно использовать этот сценарий в различных фильтрах. Пусть у нас есть строчный принтер Diablo 750-N, подключенный к сети. Принтер принимает данные на печать через порт 5100. Имя хоста для принтера - scrivener. Вот текстовый фильтр для этого принтера:</p></div><div class="literalblock programlisting"><div class=content><pre>#!/bin/sh
#
#  diablo-if-net - Текстовый фильтр для принтера Diablo `scrivener&#39;,
#  прослушивающего порт 5100. Установлен в /usr/local/libexec/diablo-if-net
#
exec /usr/libexec/lpr/lpf &#34;$@&#34; | /usr/local/libexec/netprint scrivener 5100</pre></div></div></div></div><div class=sect2><h3 id=printing-advanced-restricting>10.4.4. Ограничение использования принтера<a class=anchor href=#printing-advanced-restricting></a></h3><div class=paragraph><p>В этом разделе представлена информация об ограничении доступа к принтеру. Система LPD позволяет управлять тем, кто может обращаться к принтеру, как локально, так и удаленно, смогут ли они печатать несколько копий, насколько большими могут быть их задания и насколько могут разрастаться очереди печати.</p></div><div class=sect3><h4 id=printing-advanced-restricting-copies>10.4.4.1. Ограничение количества копий<a class=anchor href=#printing-advanced-restricting-copies></a></h4><div class=paragraph><p>Система LPD позволяет пользователям легко печатать несколько копий файла. Пользователи могут печатать задания с помощью команды <code>lpr -#5</code> (например) и получать пять копий каждого файла в задании. Хорошо это или нет - решать вам.</p></div><div class=paragraph><p>Если вы считаете, что многочисленные копии только изнашивают ваши принтеры, можете отключить опцию <code>-<mark></mark></code> команды <a href="https://man.freebsd.org/cgi/man.cgi?query=lpr&amp;sektion=1&amp;format=html">lpr(1)</a>, добавив характеристику <code>sc</code> в файл <span class=filename>/etc/printcap</span>. Когда пользователи пошлют задания с опцией <code>-#</code>, они увидят:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>lpr: multiple copies are not allowed</code></pre></div></div><div class=paragraph><p>Учтите, что если вы настроили удаленный доступ к принтеру (см. раздел <a href=#printing-advanced-network-rm>"Принтеры, установленные на удаленных хостах"</a>), необходимо задать характеристику <code>sc</code> также и в файлах <span class=filename>/etc/printcap</span> удаленных хостов, иначе пользователи все равно смогут посылать задания с несколькими копиями с других хостов.</p></div><div class=paragraph><p>Рассмотрим пример. Вот файл <span class=filename>/etc/printcap</span> для хоста <code>rose</code>. Принтер <code>rattan</code> вполне надежен, поэтому мы разрешим печатать на него несколько копий, но лазерный принтер <code>bamboo</code> несколько более изношен, поэтому мы отключим для него печать нескольких копий, добавив характеристику <code>sc</code>:</p></div><div class="literalblock programlisting"><div class=content><pre>#
#  /etc/printcap для хоста rose - запрещает печать нескольких копий на bamboo
#
rattan|line|diablo|lp|Diablo 630 Line Printer:\
        :sh:sd=/var/spool/lpd/rattan:\
        :lp=/dev/lpt0:\
        :if=/usr/local/libexec/if-simple:

bamboo|ps|PS|S|panasonic|Panasonic KX-P4455 PostScript v51.4:\
        :sh:sd=/var/spool/lpd/bamboo:sc:\
        :lp=/dev/ttyd5:ms#-parenb cs8 clocal crtscts:rw:\
        :if=/usr/local/libexec/psif:\
        :df=/usr/local/libexec/psdf:</pre></div></div><div class=paragraph><p>Теперь нам также нужно добавить характеристику <code>sc</code> в файле <span class=filename>/etc/printcap</span> на хосте <code>orchid</code> (и раз уж мы его меняем, давайте отключим печать нескольких копий для принтера <code>teak</code>):</p></div><div class="literalblock programlisting"><div class=content><pre>#
#  /etc/printcap для хоста orchid - отключена печать нескольких копий на
#  локальном принтере teak и на удаленном принтере bamboo
teak|hp|laserjet|Hewlett Packard LaserJet 3Si:\
        :lp=/dev/lpt0:sd=/var/spool/lpd/teak:mx#0:sc:\
        :if=/usr/local/libexec/ifhp:\
        :vf=/usr/local/libexec/vfhp:\
        :of=/usr/local/libexec/ofhp:

rattan|line|diablo|lp|Diablo 630 Line Printer:\
        :lp=:rm=rose:rp=rattan:sd=/var/spool/lpd/rattan:

bamboo|ps|PS|S|panasonic|Panasonic KX-P4455 PostScript v51.4:\
        :lp=:rm=rose:rp=bamboo:sd=/var/spool/lpd/bamboo:sc:</pre></div></div><div class=paragraph><p>С помощью характеристики <code>sc</code> мы предотвращаем использование команды <code>lpr -#</code>, но это не мешает пользователям просто выполнить команду <a href="https://man.freebsd.org/cgi/man.cgi?query=lpr&amp;sektion=1&amp;format=html">lpr(1)</a> несколько раз или просто послать один и тот же файл несколько раз в одном задании следующим образом:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% lpr forsale.sign forsale.sign forsale.sign forsale.sign forsale.sign</code></pre></div></div><div class=paragraph><p>Есть много способов предотвратить такое некорректное использование (включая его игнорирование), которые вы можете разработать самостоятельно.</p></div></div><div class=sect3><h4 id=printing-advanced-restricting-access>10.4.4.2. Ограничение доступа к принтерам<a class=anchor href=#printing-advanced-restricting-access></a></h4><div class=paragraph><p>Вы можете управлять тем, кто и на какие принтеры может печатать, с помощью механизма групп UNIX® и характеристики <code>rg</code> в файле <span class=filename>/etc/printcap</span>. Просто поместите пользователей, которым необходимо предоставить доступ к принтеру, в определенную группу, a затем укажите эту группу в качестве значения характеристики <code>rg</code>.</p></div><div class=paragraph><p>Пользователи, не входящие в эту группу (включая <code>root</code>) будут получать уведомление <code>lpr: Not a member of the restricted group</code> при попытке печатать на контролируемый принтер.</p></div><div class=paragraph><p>Как и в случае с характеристикой <code>sc</code> (подавить выдачу нескольких копий), при необходимости, надо указывать характеристику <code>rg</code> и на удаленных хостах, имеющих доступ к вашим принтерам (см. раздел <a href=#printing-advanced-network-rm>"Принтеры, установленные на удаленных хостах"</a>).</p></div><div class=paragraph><p>Например, давайте разрешим всем обращаться к принтеру <code>rattan</code>, но только пользователи группы <code>artists</code> смогут использовать принтер <code>bamboo</code>. Вот знакомый уже файл <span class=filename>/etc/printcap</span> для хоста <code>rose</code>:</p></div><div class="literalblock programlisting"><div class=content><pre>#
#  /etc/printcap для хоста rose - ограничение группы для bamboo
#
rattan|line|diablo|lp|Diablo 630 Line Printer:\
        :sh:sd=/var/spool/lpd/rattan:\
        :lp=/dev/lpt0:\
        :if=/usr/local/libexec/if-simple:

bamboo|ps|PS|S|panasonic|Panasonic KX-P4455 PostScript v51.4:\
        :sh:sd=/var/spool/lpd/bamboo:sc:rg=artists:\
        :lp=/dev/ttyd5:ms#-parenb cs8 clocal crtscts:rw:\
        :if=/usr/local/libexec/psif:\
        :df=/usr/local/libexec/psdf:</pre></div></div><div class=paragraph><p>Давайте не будем менять другой рассматриваемый файл <span class=filename>/etc/printcap</span> (для хоста <code>orchid</code>). Конечно, в результате, любой пользователь <code>orchid</code> может печатать на <code>bamboo</code>. Возможно, на хосте <code>orchid</code> учетных записей и так немного, и вы хотите, чтобы все они имели доступ к принтеру. Или нет.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Для принтера может быть только одна ограниченная группа.</p></div></td></tr></tbody></table></div></div><div class=sect3><h4 id=printing-advanced-restricting-sizes>10.4.4.3. Контроль размеров посылаемых заданий<a class=anchor href=#printing-advanced-restricting-sizes></a></h4><div class=paragraph><p>Если к принтеру обращается несколько пользователей, вам, возможно, понадобиться установить ограничение на максимальный размер файлов, которые пользователи могут посылать на печать. В конечном итоге, размер файловой системы, в которой находятся каталоги спулинга, ограничен, и надо гарантировать, что в нем останется место для заданий других пользователей.</p></div><div class=paragraph><p>Система LPD ограничить максимально допустимый размер файла в задании с помощью характеристики <code>mx</code>. Размер задается в блоках, размер которых, <code>BUFSIZ</code>, составляет 1024 байта. Если задать этой характеристике значение ноль, размер файла ограничиваться не будет; однако, если характеристика <code>mx</code> вообще не задана, то будет использоваться стандартное ограничение - 1000 блоков.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Ограничение применяется к <em>файлам в задании</em>, а <em>не</em> к общему размеру задания.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Система LPD не откажется печатать файл больше максимально допустимого для принтера размера. Вместо этого, она поставит в очередь часть файла до заданного предела, и она будет напечатана. Остальное не будет напечатано. Правильность такого поведения не бесспорна.</p></div><div class=paragraph><p>Давайте установим ограничения для принтеров из наших примеров, <code>rattan</code> и <code>bamboo</code>. Поскольку PostScript®-файлы этих художников обычно бывают весьма большими, мы ограничим их размер пятью мегабайтами. Мы не будем ограничивать использование обычного текстового строчного принтера:</p></div><div class="literalblock programlisting"><div class=content><pre>#
#  /etc/printcap для хоста rose
#

#
#  Без ограничения на размер задания:
#
rattan|line|diablo|lp|Diablo 630 Line Printer:\
        :sh:mx#0:sd=/var/spool/lpd/rattan:\
        :lp=/dev/lpt0:\
        :if=/usr/local/libexec/if-simple:

#
#  Размер файла - не более пяти мегабайт:
#
bamboo|ps|PS|S|panasonic|Panasonic KX-P4455 PostScript v51.4:\
        :sh:sd=/var/spool/lpd/bamboo:sc:rg=artists:mx#5000:\
        :lp=/dev/ttyd5:ms#-parenb cs8 clocal crtscts:rw:\
        :if=/usr/local/libexec/psif:\
        :df=/usr/local/libexec/psdf:</pre></div></div><div class=paragraph><p>Опять таки, ограничения применяются только для локальных пользователей. Если вы настроили удаленный доступ к принтерам, для удаленных пользователей эти ограничения не действуют. Надо задать характеристику <code>mx</code> и в файлах <span class=filename>/etc/printcap</span> удаленных хостов. Более детальную информацию по удаленной печати см. в разделе <a href=#printing-advanced-network-rm>"Принтеры, установленные на удаленных хостах"</a>.</p></div><div class=paragraph><p>Есть еще один специализированный способ ограничить размер заданий печати с удаленных принтеров; см. раздел <a href=#printing-advanced-restricting-remote>Ограничение печати заданий с удаленных хостов</a>.</p></div></div><div class=sect3><h4 id=printing-advanced-restricting-remote>10.4.4.4. Ограничение печати заданий с удаленных хостов<a class=anchor href=#printing-advanced-restricting-remote></a></h4><div class=paragraph><p>Система спулинга LPD обеспечивает несколько способов ограничить посылку заданий с удаленных хостов:</p></div><div class=dlist><dl><dt class=hdlist1>Ограничения хостов</dt><dd><p>Вы можете управлять тем, с каких удаленных хостов локальная система LPD принимает запросы, с помощью файлов <span class=filename>/etc/hosts.equiv</span> и <span class=filename>/etc/hosts.lpd</span>. Система LPD проверяет, поступает ли входящий запрос с хоста, указанного в одном из этих файлов. Если нет, система LPD отвергает запрос.</p><div class=paragraph><p>Формат этих файлов простой: по одному имени хоста в строке. Учтите, что файл <span class=filename>/etc/hosts.equiv</span> также используется протоколом <a href="https://man.freebsd.org/cgi/man.cgi?query=ruserok&amp;sektion=3&amp;format=html">ruserok(3)</a> и влияет на программы <a href="https://man.freebsd.org/cgi/man.cgi?query=rsh&amp;sektion=1&amp;format=html">rsh(1)</a> и <a href="https://man.freebsd.org/cgi/man.cgi?query=rcp&amp;sektion=1&amp;format=html">rcp(1)</a>, так что, будьте внимательны.</p></div><div class=paragraph><p>Например, вот файл <span class=filename>/etc/hosts.lpd</span> для хоста <code>rose</code>:</p></div><div class="literalblock programlisting"><div class=content><pre>orchid
violet
madrigal.fishbaum.de</pre></div></div><div class=paragraph><p>Это означает, что хост <code>rose</code> будет принимать запросы с хостов <code>orchid</code>, <code>violet</code> и <code>madrigal.fishbaum.de</code>. Если любой другой хост попытается обратиться к системе LPD хоста <code>rose</code>, его задание будет отвергнуто.</p></div></dd><dt class=hdlist1>Ограничения размера</dt><dd><p>Вы можете управлять тем, сколько свободного места должно оставаться в файловой системе, в которой находится каталог спулинга. Создайте файл с именем <span class=filename>minfree</span> в каталоге спулинга для локального принтера. Вставьте в этот файл число, задающее, сколько блоков диска (по 512 байтов) должно быть свободными, чтобы удаленное задание было принято.</p><div class=paragraph><p>Это позволяет гарантировать, что удаленные пользователи не заполнят вашу файловую систему. Можно также использовать этот механизм для предоставления определенного преимущества локальным пользователям: они смогут ставить задания в очередь еще долго после того, как свободного места на диске станет меньше, чем указано в файле <span class=filename>minfree</span>.</p></div><div class=paragraph><p>Например, давайте добавим файл <span class=filename>minfree</span> для принтера <code>bamboo</code>. Найдем в файле <span class=filename>/etc/printcap</span> каталог спулинга для этого принтера; вот запись для принтера <code>bamboo</code>:</p></div><div class="literalblock programlisting"><div class=content><pre>bamboo|ps|PS|S|panasonic|Panasonic KX-P4455 PostScript v51.4:\
        :sh:sd=/var/spool/lpd/bamboo:sc:rg=artists:mx#5000:\
        :lp=/dev/ttyd5:ms#-parenb cs8 clocal crtscts:rw:mx#5000:\
        :if=/usr/local/libexec/psif:\
        :df=/usr/local/libexec/psdf:</pre></div></div><div class=paragraph><p>Каталог спулинга задается характеристикой <code>sd</code>. Укажем, что в файловой системе должно быть три мегабайта (что составляет 6144 блоков диска) свободного места, чтобы система LPD принимала удаленные задания:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># echo 6144 &gt; /var/spool/lpd/bamboo/minfree</span></code></pre></div></div></dd><dt class=hdlist1>Ограничения пользователей</dt><dd><p>Вы можете управлять тем, какие удаленные пользователи смогут печатать на локальные принтеры, задавая характеристику <code>rs</code> в файле <span class=filename>/etc/printcap</span>. Когда характеристика <code>rs</code> указана в записи для локально подключенного принтера, система LPD будет принимать задания с удаленных хостов, <em>если</em> пользователь, посылающий задание, также имеет учетную запись с тем же именем на локальном хосте. В противном случае, система LPD отвергает задание.</p><div class=paragraph><p>Эта возможность особенно полезна в среде, где есть, например, несколько отделов, совместно использующих сеть, и некоторые пользователи могут переходить из отдела в отдел. Если дать им учетные записи в системах, они смогут использовать принтеры из систем в своих отделах. Если вы хотели бы позволить им использовать <em>только</em> принтеры, но не остальные ресурсы вашего компьютера, можно дать им "формальные" учетные записи, без начального каталога и с бесполезным начальным командным интерпретатором вроде <span class=filename>/usr/bin/false</span>.</p></div></dd></dl></div></div></div><div class=sect2><h3 id=printing-advanced-acct>10.4.5. Учет использования принтера<a class=anchor href=#printing-advanced-acct></a></h3><div class=paragraph><p>Итак, вам надо брать деньги за распечатки. А почему нет? Бумага и чернила стоят денег. А есть еще и затраты на поддержку в работоспособном состоянии - принтеры имеют множество движущихся частей и склонны к поломкам. Вы проанализировали состояние принтеров, объемы использования и затраты на их эксплуатацию, и получили определенную стоимость страницы (или фута, метра или чего угодно). Теперь, как же начать реально учитывать распечатки?</p></div><div class=paragraph><p>Итак, плохая новость состоит в том, что система спулинга LPD в этом не сильно поможет. Учет сильно зависит от типа используемого принтера, форматов распечаток и <em>ваших</em> требований к оплате использования принтеров.</p></div><div class=paragraph><p>Для реализации учета надо изменить текстовый фильтр принтера (чтобы учитывать обычные текстовые задания) и фильтры преобразования (чтобы учитывать другие форматы файлов), для подсчета страниц или запроса количества напечатанных страниц у принтера. Не получится обойтись использованием простого выходного фильтра, поскольку он не может выполнять учет. См. раздел <a href=#printing-advanced-filter-intro>Фильтры</a>.</p></div><div class=paragraph><p>Обычно есть два способа выполнения учета:</p></div><div class=ulist><ul><li><p><em>Периодический учет</em> - более распространенный способ, возможно, потому, что он проще. Когда кто-то печатает задание, фильтр регистрирует пользователя, хост и количество страниц в учетном файле. Каждый месяц, семестр, год или раз в любой желаемый период времени, вы собираете учетные файлы для различных принтеров, суммируете напечатанные каждым пользователем страницы и выставляете суммы за использование. Затем вы очищаете все регистрационные файлы, начиная с чистого листа новый отчетный период.</p></li><li><p><em>Постоянный учет</em> используется реже, вероятно, потому, что сложнее в реализации. Этот метод требует от фильтров выставлять пользователям суммы за распечатки сразу после использования принтеров. Как и проверка дисковых квот, этот учет выполняется немедленно. Вы можете не давать пользователям печатать, если баланс на их счету стал отрицательным, а также предоставить им способ проверить и изменить свои "квоты печати". Но этот метод требует поддержки базы данных для отслеживания пользователей и квот.</p></li></ul></div><div class=paragraph><p>Система спулинга LPD легко поддерживает оба метода: поскольку вы (в большинстве случаев) должны предоставить фильтры, вам придется предоставить и код для учета. Но есть и положительный момент: методы учета могут быть сколько угодно гибкими. Например, можно выбрать периодический или постоянный учет. Можно выбрать, какую именно информацию регистрировать: имена пользователей, имена хостов, типы заданий, количество напечатанных страниц, квадратные метры использованной бумаги, продолжительность печати заданий, и т.д. Это делается путем изменения фильтров так, чтобы они сохраняли соответствующую информацию.</p></div><div class=sect3><h4 id=_простая_система_учета_использования_принтера>10.4.5.1. Простая система учета использования принтера<a class=anchor href=#_простая_система_учета_использования_принтера></a></h4><div class=paragraph><p>В составе FreeBSD поставляется две программы, которые можно сразу использовать для организации простой системы периодического учета. Речь идет о текстовом фильтре <code>lpf</code>, описанном в разделе <a href=#printing-advanced-lpf>lpf: текстовый фильтр</a>, и о программе <a href="https://man.freebsd.org/cgi/man.cgi?query=pac&amp;sektion=8&amp;format=html">pac(8)</a>, обеспечивающей сбор и суммирование записей из учетных файлов принтеров.</p></div><div class=paragraph><p>Как уже упоминалось в разделе, посвященном фильтрам (<a href=#printing-advanced-filters>Фильтры</a>), система LPD при запуске текстового фильтра и фильтров преобразований передает им имя учетного файла в командной строке. Фильтры могут использовать соответствующий аргумент, чтобы определить, куда записывать учетную информацию. Имя этого файла берется из значения характеристики <code>af</code> в файле <span class=filename>/etc/printcap</span> и, если не заданно как абсолютное, интерпретируется относительно каталога спулинга.</p></div><div class=paragraph><p>Система LPD запускает <code>lpf</code> с аргументами ширины и длины страницы (которые берутся из характеристик <code>pw</code> и <code>pl</code>). Программа <code>lpf</code> использует эти аргументы для определения количества бумаги, которая будет использована. После посылки файла на принтер она вносит запись в учетный файл. Эти записи имеют следующий вид:</p></div><div class="literalblock programlisting"><div class=content><pre>2.00 rose:andy
3.00 rose:kelly
3.00 orchid:mary
5.00 orchid:mary
2.00 orchid:zhang</pre></div></div><div class=paragraph><p>Следует использовать отдельный учетный файл для каждого принтера, поскольку программа <code>lpf</code> не реализует механизм блокирования файлов, и два экземпляра <code>lpf</code> могут повредить записи друг друга, если записывают одновременно в один и тот же файл. Простой способ выделить отдельный учетный файл для каждого принтера - использовать характеристику <code>af=acct</code> в файле <span class=filename>/etc/printcap</span>. Тогда каждый учетный файл окажется в каталоге спулинга соответствующего принтера и будет назван <span class=filename>acct</span>.</p></div><div class=paragraph><p>Когда вы будете готовы выставить пользователям счет за распечатки, запустите программу <a href="https://man.freebsd.org/cgi/man.cgi?query=pac&amp;sektion=8&amp;format=html">pac(8)</a>. Просто перейдите в каталог спулинга принтера, учетную информацию которого вы хотите обработать, и введите команду <code>pac</code>. Вы получите итоговые суммы в долларах, как показано ниже:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>  Login	       pages/feet   runs    price
orchid:kelly                5.00    1   <span class=nv>$ </span> 0.10
orchid:mary                31.00    3   <span class=nv>$ </span> 0.62
orchid:zhang                9.00    1   <span class=nv>$ </span> 0.18
rose:andy                   2.00    1   <span class=nv>$ </span> 0.04
rose:kelly                177.00  104   <span class=nv>$ </span> 3.54
rose:mary                  87.00   32   <span class=nv>$ </span> 1.74
rose:root                  26.00   12   <span class=nv>$ </span> 0.52

total                     337.00  154   <span class=nv>$ </span> 6.74</code></pre></div></div><div class=paragraph><p>Команда <a href="https://man.freebsd.org/cgi/man.cgi?query=pac&amp;sektion=8&amp;format=html">pac(8)</a> принимает следующие аргументы:</p></div><div class=dlist><dl><dt class=hdlist1><code>-P <em>принтер</em></code></dt><dd><p>По какому <em>принтеру</em> подсчитывать итоговые суммы. Эта опция работает, только если в качестве значения характеристики <code>af</code> в файле <span class=filename>/etc/printcap</span> указано абсолютное имя.</p></dd><dt class=hdlist1><code>-c</code></dt><dd><p>Сортировать отчет по сумме, а не по имени пользователя в алфавитном порядке.</p></dd><dt class=hdlist1><code>-m</code></dt><dd><p>Игнорировать имя хоста в учетных файлах. При указании этой опции, пользователь <code>smith</code> на хосте <code>alpha</code> считается тем же, что и пользователь <code>smith</code> на хосте <code>gamma</code>. Обычно эти пользователи считаются разными.</p></dd><dt class=hdlist1><code>-p <em>стоимость</em></code></dt><dd><p>Вычислять суммы из расчета <em>стоимость</em> долларов за страницу или за фут, вместо использования значения характеристики <code>pc</code> в файле <span class=filename>/etc/printcap</span>, или двух центов (как принято по умолчанию). Можно задавать <em>стоимость</em> как число с плавающей запятой.</p></dd><dt class=hdlist1><code>-r</code></dt><dd><p>Изменить порядок сортировки.</p></dd><dt class=hdlist1><code>-s</code></dt><dd><p>Создать итоговый учетный файл и очистить учетный файл.</p></dd><dt class=hdlist1><em>имя…​</em></dt><dd><p>Выдать учетную информацию только для пользователей с заданными <em>именами</em>.</p></dd></dl></div><div class=paragraph><p>В стандартном отчете, который создает команда <a href="https://man.freebsd.org/cgi/man.cgi?query=pac&amp;sektion=8&amp;format=html">pac(8)</a>, выдается количество страниц, напечатанное каждым из пользователей с различных хостов. Если для вас хосты не имеют значения (поскольку пользователи могут работать на любом хосте), выполните команду <code>pac -m</code> для получения следующих итогов:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>  Login	       pages/feet   runs    price
andy                        2.00    1   <span class=nv>$ </span> 0.04
kelly                     182.00  105   <span class=nv>$ </span> 3.64
mary                      118.00   35   <span class=nv>$ </span> 2.36
root                       26.00   12   <span class=nv>$ </span> 0.52
zhang                       9.00    1   <span class=nv>$ </span> 0.18

total                     337.00  154   <span class=nv>$ </span> 6.74</code></pre></div></div><div class=paragraph><p>Для получения сумм в долларах программа <a href="https://man.freebsd.org/cgi/man.cgi?query=pac&amp;sektion=8&amp;format=html">pac(8)</a> использует значение характеристики <code>pc</code> в файле <span class=filename>/etc/printcap</span> (по умолчанию - 200, или 2 цента за страницу). Укажите в качестве значения этой характеристики, в сотых долях цента, стоимость страницы или фута, исходя из которой вы хотите брать деньги за распечатки. Это значение можно переопределить при вызове команды <a href="https://man.freebsd.org/cgi/man.cgi?query=pac&amp;sektion=8&amp;format=html">pac(8)</a> с помощью опции <code>-p</code>. Но при использовании опции <code>-p</code> стоимость надо указывать в долларах, а не в сотых долях цента. Например, команда</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># pac -p1.50</span></code></pre></div></div><div class=paragraph><p>приводит к тому, что страница будет стоить один доллар пятьдесят центов. Используя эту опцию, можно фактически начинать грести деньги лопатой.</p></div><div class=paragraph><p>Наконец, при выполнении команды <code>pac -s</code> итоговая информация будет сохранена в итоговом учетном файле, имя которого строится как имя учетного файла принтера с суффиксом <code>_sum</code>. Затем учетный файл принтера очищается. Когда команда <a href="https://man.freebsd.org/cgi/man.cgi?query=pac&amp;sektion=8&amp;format=html">pac(8)</a> выполняется повторно, она перечитывает итоговый файл для получения начальных сумм, а затем добавляет информацию из обычного учетного файла.</p></div></div><div class=sect3><h4 id=_как_можно_подсчитать_количество_напечатанных_страниц>10.4.5.2. Как можно подсчитать количество напечатанных страниц?<a class=anchor href=#_как_можно_подсчитать_количество_напечатанных_страниц></a></h4><div class=paragraph><p>Для выполнения хоть отдаленно точного учета надо уметь определять, сколько бумаги использовано для печати задания. Это - основная проблема учета использования принтеров.</p></div><div class=paragraph><p>Для обычных текстовых заданий решить эту проблему не сложно: надо считать, сколько строк входит в задание, и сравнивать с количеством строк на страницу, которые поддерживает принтер. Не забывайте учитывать символы забоя в файлах, которые приводят к перепечатке строк поверх, а также длинные логические строки, которые переносятся на несколько физических.</p></div><div class=paragraph><p>Текстовый фильтр <code>lpf</code> (представленный в разделе <a href=#printing-advanced-lpf>lpf: текстовый фильтр</a>) учитывает эти вещи при выполнении учета. Если вы пишете текстовый фильтр, который должен осуществлять учет, может иметь смысл просмотреть исходный код программы <code>lpf</code>.</p></div><div class=paragraph><p>Но как обрабатывать файлы других форматов?</p></div><div class=paragraph><p>Ну, для преобразования из DVI в формат LaserJet или из DVI в PostScript®, можно в фильтре анализировать диагностические результаты команды <code>dvilj</code> или <code>dvips</code>, чтобы определить, сколько страниц было преобразовано. Может оказаться возможным применить этот прием и для других форматов файлов и программ преобразования.</p></div><div class=paragraph><p>Но эти методы несовершенны из-за того, что принтер мог фактически и не напечатать все эти страницы. Например, он мог замять бумагу, в нем мог закончиться тонер или он мог вообще взорваться - и пользователю все равно пришлось бы платить.</p></div><div class=paragraph><p>Так что же делать?</p></div><div class=paragraph><p>Есть только один <em>надежный</em> способ <em>точного</em> учета. Купите принтер, который может сообщать, сколько бумаги он использовал, и подключите его через последовательный порт или по сети. Практически все PostScript®-принтеры поддерживают такую возможность. Другие модели - тоже (сетевые лазерные принтеры Imagen, например). Измените фильтры для этих принтеров так, чтобы получать количество использованных страниц после печати каждого задания, и пусть они записывают учетную информацию <em>только</em> на основе этого значения. Не надо ни считать строки, ни выполнять чреватую ошибками обработку файла.</p></div><div class=paragraph><p>Конечно, всегда можно поступить великодушно и не брать денег за распечатки.</p></div></div></div></div></div><div class=sect1><h2 id=printing-using>10.5. Использование принтеров<a class=anchor href=#printing-using></a></h2><div class=sectionbody><div class=paragraph><p>В этом разделе описано, как использовать настроенные принтеры в ОС FreeBSD. Вот сводка команд пользовательского уровня:</p></div><div class=dlist><dl><dt class=hdlist1><a href="https://man.freebsd.org/cgi/man.cgi?query=lpr&amp;sektion=1&amp;format=html">lpr(1)</a></dt><dd><p>Печать заданий</p></dd><dt class=hdlist1><a href="https://man.freebsd.org/cgi/man.cgi?query=lpq&amp;sektion=1&amp;format=html">lpq(1)</a></dt><dd><p>Проверка очередей принтеров</p></dd><dt class=hdlist1><a href="https://man.freebsd.org/cgi/man.cgi?query=lprm&amp;sektion=1&amp;format=html">lprm(1)</a></dt><dd><p>Удаление заданий из очередей принтеров</p></dd></dl></div><div class=paragraph><p>Есть также административная команда, <a href="https://man.freebsd.org/cgi/man.cgi?query=lpc&amp;sektion=8&amp;format=html">lpc(8)</a>, описанная в разделе <a href=#printing-lpc>Администрирование принтеров</a>, используемая для управления принтерами и их очередями.</p></div><div class=paragraph><p>Все три команды, <a href="https://man.freebsd.org/cgi/man.cgi?query=lpr&amp;sektion=1&amp;format=html">lpr(1)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=lprm&amp;sektion=1&amp;format=html">lprm(1)</a> и <a href="https://man.freebsd.org/cgi/man.cgi?query=lpq&amp;sektion=1&amp;format=html">lpq(1)</a>, поддерживают опцию <code>-P <em>имя-принтера</em></code>, позволяющую указать, с каким принтером/очередью из указанных в файле <span class=filename>/etc/printcap</span> работать. Это позволяет посылать, удалять и проверять задания на разных принтерах. Если вы не используете опцию <code>-P</code>, эти команды используют принтер, указанный в качестве значения переменной среды <code>PRINTER</code>. Наконец, если переменная среды <code>PRINTER</code> не задана, эти команды по умолчанию направляются на принтер по имени <code>lp</code>.</p></div><div class=paragraph><p>Далее термин <em>стандартный принтер</em> означает принтер, указанный переменной среды <code>PRINTER</code> или принтер по имени <code>lp</code>, если переменная среды <code>PRINTER</code> не задана.</p></div><div class=sect2><h3 id=printing-lpr>10.5.1. Задания печати<a class=anchor href=#printing-lpr></a></h3><div class=paragraph><p>Для печати файлов, выполните команду:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% lpr имя-файла ...</code></pre></div></div><div class=paragraph><p>Эта команда печатает каждый из перечисленных файлов на стандартный принтер. Если файлы не указаны, команда <a href="https://man.freebsd.org/cgi/man.cgi?query=lpr&amp;sektion=1&amp;format=html">lpr(1)</a> читает данные для печати со стандартного входного потока. Например, следующая команда печатает некоторые важные системные файлы:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% lpr /etc/host.conf /etc/hosts.equiv</code></pre></div></div><div class=paragraph><p>Для выбора конкретного принтера, введите:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% lpr <span class=nt>-P</span> имя-принтера имя-файла ...</code></pre></div></div><div class=paragraph><p>Следующая команда печатает подробный листинг текущего каталога на принтере <code>rattan</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% <span class=nb>ls</span> <span class=nt>-l</span> | lpr <span class=nt>-P</span> rattan</code></pre></div></div><div class=paragraph><p>Поскольку для команды <a href="https://man.freebsd.org/cgi/man.cgi?query=lpr&amp;sektion=1&amp;format=html">lpr(1)</a> файлы не указаны, команда <code>lpr</code> читает данные для печати из стандартного входного потока, который содержит результат выполнения команды <code>ls -l</code>.</p></div><div class=paragraph><p>Команда <a href="https://man.freebsd.org/cgi/man.cgi?query=lpr&amp;sektion=1&amp;format=html">lpr(1)</a> может также принимать множество опций для управления форматированием, применения преобразований, печати нескольких копий и т.д. Дополнительную информацию см. в разделе <a href=#printing-lpr-options>Опции печати</a>.</p></div></div><div class=sect2><h3 id=printing-lpq>10.5.2. Проверка заданий<a class=anchor href=#printing-lpq></a></h3><div class=paragraph><p>При печати с помощью команды <a href="https://man.freebsd.org/cgi/man.cgi?query=lpr&amp;sektion=1&amp;format=html">lpr(1)</a>, данные, которые надо напечатать, помещаются вместе в пакет, который называют "заданием печати", и посылаются системе спулинга LPD. Каждый принтер имеет очередь заданий, и ваше задание ждет в этой очереди вместе с другими вашими заданиями и заданиями других пользователей. Принтер печатает эти задания по принципу первым пришло, первым выполнено.</p></div><div class=paragraph><p>Для получения очереди стандартного принтера, введите команду <a href="https://man.freebsd.org/cgi/man.cgi?query=lpq&amp;sektion=1&amp;format=html">lpq(1)</a>. Чтобы указать конкретный принтер, используйте опцию <code>-P</code>. Например, команда</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% lpq <span class=nt>-P</span> bamboo</code></pre></div></div><div class=paragraph><p>показывает очередь для принтера по имени <code>bamboo</code>. Вот пример результатов выполнения команды <code>lpq</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>bamboo is ready and printing
Rank   Owner    Job  Files                              Total Size
active kelly    9    /etc/host.conf, /etc/hosts.equiv   88 bytes
2nd    kelly    10   <span class=o>(</span>standard input<span class=o>)</span>                   1635 bytes
3rd    mary     11   ...                                78519 bytes</code></pre></div></div><div class=paragraph><p>Показано, что в очереди <code>bamboo</code> есть три задания. Первое задание, посланное пользователем kelly, получило "номер задания" 9. Каждое задание для принтера получает уникальный номер задания. В большинстве случаев номер задания можно игнорировать, но он потребуется, если надо будет отменить задание; подробнее об этом см. в разделе <a href=#printing-lprm>Удаление заданий</a>.</p></div><div class=paragraph><p>Задание номер 9 состоит из двух файлов; несколько файлов, указанных в командной строке <a href="https://man.freebsd.org/cgi/man.cgi?query=lpr&amp;sektion=1&amp;format=html">lpr(1)</a>, считаются частью одного задания. Это задание является текущим активным (обратите внимание на слово <code>active</code> в столбце "Rank"), т.е. принтер должен сейчас печатать это задание. Второе задание состоит из данных, передаваемых в качестве стандартного входного потока команде <a href="https://man.freebsd.org/cgi/man.cgi?query=lpr&amp;sektion=1&amp;format=html">lpr(1)</a>. Третье задание послано пользователем <code>mary</code>; оно намного больше по объему. Полное имя файла, который печатается, слишком длинное и не помещается, поэтому команда <a href="https://man.freebsd.org/cgi/man.cgi?query=lpq&amp;sektion=1&amp;format=html">lpq(1)</a> просто выдает три точки.</p></div><div class=paragraph><p>Самая первая строка результатов команды <a href="https://man.freebsd.org/cgi/man.cgi?query=lpq&amp;sektion=1&amp;format=html">lpq(1)</a> тоже полезна: она говорит о том, что сейчас делает принтер (или, по крайней мере, что он делает по мнению системы LPD).</p></div><div class=paragraph><p>Команда <a href="https://man.freebsd.org/cgi/man.cgi?query=lpq&amp;sektion=1&amp;format=html">lpq(1)</a> также поддерживает опцию <code>-l</code> для генерации подробного длинного листинга. Вот пример результатов выполнения команды <code>lpq -l</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>waiting <span class=k>for </span>bamboo to become ready <span class=o>(</span>offline ?<span class=o>)</span>
kelly: 1st                 <span class=o>[</span>job 009rose]
       /etc/host.conf                    73 bytes
       /etc/hosts.equiv                  15 bytes

kelly: 2nd                 <span class=o>[</span>job 010rose]
       <span class=o>(</span>standard input<span class=o>)</span>                  1635 bytes

mary: 3rd                                <span class=o>[</span>job 011rose]
      /home/orchid/mary/research/venus/alpha-regio/mapping 78519 bytes</code></pre></div></div></div><div class=sect2><h3 id=printing-lprm>10.5.3. Удаление заданий<a class=anchor href=#printing-lprm></a></h3><div class=paragraph><p>Если вы передумали печатать задание, можно удалить его из очереди заданий с помощью команды <a href="https://man.freebsd.org/cgi/man.cgi?query=lprm&amp;sektion=1&amp;format=html">lprm(1)</a>. Часто можно использовать <a href="https://man.freebsd.org/cgi/man.cgi?query=lprm&amp;sektion=1&amp;format=html">lprm(1)</a> для удаления активного задания, но часть задания или даже все задание все равно может быть напечатано.</p></div><div class=paragraph><p>Для удаления задания со стандартного принтера сначала используйте команду <a href="https://man.freebsd.org/cgi/man.cgi?query=lpq&amp;sektion=1&amp;format=html">lpq(1)</a> для поиска номера задания. Затем введите команду:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% lprm номер-задания</code></pre></div></div><div class=paragraph><p>Для удаления задания с указанного принтера, задайте опцию <code>-P</code> option. Следующая команда удаляет задание номер 10 из очереди заданий принтера <code>bamboo</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% lprm <span class=nt>-P</span> bamboo 10</code></pre></div></div><div class=paragraph><p>Для команды <a href="https://man.freebsd.org/cgi/man.cgi?query=lprm&amp;sektion=1&amp;format=html">lprm(1)</a> есть ряд сокращений:</p></div><div class=dlist><dl><dt class=hdlist1>lprm -</dt><dd><p>Удаляет все задания (со стандартного принтера), принадлежащие пользователю, который выполнил команду.</p></dd><dt class=hdlist1>lprm <em>пользователь</em></dt><dd><p>Удаляет все задания (для стандартного принтера), принадлежащие указанному <em>пользователю</em>. Суперпользователь может удалять задания других пользователей; обычный пользователь может удалять только собственные задания.</p></dd><dt class=hdlist1>lprm</dt><dd><p>Если в командной строке не указаны номер задания, имя пользователя, или указана опция <code>-</code>, команда <a href="https://man.freebsd.org/cgi/man.cgi?query=lprm&amp;sektion=1&amp;format=html">lprm(1)</a> удаляет текущее активное задание на стандартном принтере, если оно принадлежит вам. Суперпользователь может удалять любое активное задание.</p></dd></dl></div><div class=paragraph><p>Добавьте опцию <code>-P</code> для любого из перечисленных выше сокращений, чтобы работать с любым необходимым принтером вместо стандартного. Например, следующая команда удаляет все задания текущего пользователя из очереди принтера по имени <code>rattan</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% lprm <span class=nt>-P</span> rattan -</code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Если вы работаете в сетевой среде, команда <a href="https://man.freebsd.org/cgi/man.cgi?query=lprm&amp;sektion=1&amp;format=html">lprm(1)</a> позволит вам удалять задания только с хоста, с которого они были посланы, даже если тот же принтер доступен и с других хостов. Следующая последовательность команд демонстрирует это:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% lpr <span class=nt>-P</span> rattan myfile
% rlogin orchid
% lpq <span class=nt>-P</span> rattan
Rank   Owner      Job  Files                          Total Size
active seeyan      12    ...                           49123 bytes
2nd    kelly      13   myfile                         12 bytes
% lprm <span class=nt>-P</span> rattan 13
rose: Permission denied
% <span class=nb>logout</span>
% lprm <span class=nt>-P</span> rattan 13
dfA013rose dequeued
cfA013rose dequeued</code></pre></div></div></td></tr></tbody></table></div></div><div class=sect2><h3 id=printing-lpr-options>10.5.4. Не только обычный текст: опции печати<a class=anchor href=#printing-lpr-options></a></h3><div class=paragraph><p>Команда <a href="https://man.freebsd.org/cgi/man.cgi?query=lpr&amp;sektion=1&amp;format=html">lpr(1)</a> поддерживает несколько опций, управляющих форматированием текста, преобразованием графики и других форматов файлов, выдачей нескольких копий, обработкой задания и др. В этом разделе описаны эти опции.</p></div><div class=sect3><h4 id=printing-lpr-options-format>10.5.4.1. Опции форматирования и преобразования<a class=anchor href=#printing-lpr-options-format></a></h4><div class=paragraph><p>Следующие опции команды <a href="https://man.freebsd.org/cgi/man.cgi?query=lpr&amp;sektion=1&amp;format=html">lpr(1)</a> управляют форматированием файлов в задании. Используйте эти опции, если задание содержит не простой текст или если вы хотите сформатировать простой текст с помощью утилиты <a href="https://man.freebsd.org/cgi/man.cgi?query=pr&amp;sektion=1&amp;format=html">pr(1)</a>.</p></div><div class=paragraph><p>Например, следующая команда печатает файл DVI (из системы верстки TeX) по имени <span class=filename>fish-report.dvi</span> на принтере <code>bamboo</code>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% lpr <span class=nt>-P</span> bamboo <span class=nt>-d</span> fish-report.dvi</code></pre></div></div><div class=paragraph><p>Эти опции применяются для каждого файла в задании, так что нельзя смешивать (например) файлы DVI и ditroff в одном задании. Вместо этого посылайте однотипные файлы отдельными заданиями, используя для каждого задания соответствующие опции преобразования.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Все эти опции, кроме <code>-p</code> и <code>-T</code>, требуют наличия установленных для целевого принтера фильтров преобразования. Например, опция <code>-d</code> требует фильтра преобразования DVI. Подробнее см. в разделе <a href=#printing-advanced-convfilters>Фильтры преобразования</a>.</p></div></td></tr></tbody></table></div><div class=dlist><dl><dt class=hdlist1><code>-c</code></dt><dd><p>Печать файлов cifplot.</p></dd><dt class=hdlist1><code>-d</code></dt><dd><p>Печать файлов DVI.</p></dd><dt class=hdlist1><code>-f</code></dt><dd><p>Печать текстовых файлов на языке FORTRAN.</p></dd><dt class=hdlist1><code>-g</code></dt><dd><p>Печать графиков.</p></dd><dt class=hdlist1><code>-i <em>число</em></code></dt><dd><p>Сдвинуть результат вправо на <em>число</em> столбцов; если <em>число</em> не указано, сдвиг выполняется на 8 столбцов. Эта опция работает только с определенными фильтрами преобразования.</p><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Не помещайте пробелы между <code>-i</code> и числом.</p></div></td></tr></tbody></table></div></dd><dt class=hdlist1><code>-l</code></dt><dd><p>Печать текстовых данных буквально, включая управляющие символы.</p></dd><dt class=hdlist1><code>-n</code></dt><dd><p>Печать данных ditroff (device independent troff).</p></dd><dt class=hdlist1>-p</dt><dd><p>Форматировать обычный текст перед печатью утилитой <a href="https://man.freebsd.org/cgi/man.cgi?query=pr&amp;sektion=1&amp;format=html">pr(1)</a>. Подробнее см. <a href="https://man.freebsd.org/cgi/man.cgi?query=pr&amp;sektion=1&amp;format=html">pr(1)</a>.</p></dd><dt class=hdlist1><code>-T <em>заголовок</em></code></dt><dd><p>Использовать указанный <em>заголовок</em> в колонтитуле <a href="https://man.freebsd.org/cgi/man.cgi?query=pr&amp;sektion=1&amp;format=html">pr(1)</a> вместо имени файла. Эта опция учитывается только при использовании вместе с опцией <code>-p</code>.</p></dd><dt class=hdlist1><code>-t</code></dt><dd><p>Печать данных troff.</p></dd><dt class=hdlist1><code>-v</code></dt><dd><p>Печать растровых данных.</p></dd></dl></div><div class=paragraph><p>Вот пример: следующая команда печатает красиво сформатированную версию справочного руководства по команде <a href="https://man.freebsd.org/cgi/man.cgi?query=ls&amp;sektion=1&amp;format=html">ls(1)</a> на стандартный принтер:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% zcat /usr/shared/man/man1/ls.1.gz | troff <span class=nt>-t</span> <span class=nt>-man</span> | lpr <span class=nt>-t</span></code></pre></div></div><div class=paragraph><p>Команда <a href="https://man.freebsd.org/cgi/man.cgi?query=zcat&amp;sektion=1&amp;format=html">zcat(1)</a> распаковывает исходный код страницы справочного руководства <a href="https://man.freebsd.org/cgi/man.cgi?query=ls&amp;sektion=1&amp;format=html">ls(1)</a> и передает его команде <a href="https://man.freebsd.org/cgi/man.cgi?query=troff&amp;sektion=1&amp;format=html">troff(1)</a>, которая форматирует его и выдает результат в формате GNU troff, передаваемый команде <a href="https://man.freebsd.org/cgi/man.cgi?query=lpr&amp;sektion=1&amp;format=html">lpr(1)</a>, посылающей задание спулеру LPD. Поскольку мы использовали опцию <code>-t</code> команды <a href="https://man.freebsd.org/cgi/man.cgi?query=lpr&amp;sektion=1&amp;format=html">lpr(1)</a>, спулер при печати задания будет преобразовывать результат GNU troff в формат, понятный стандартному принтеру.</p></div></div><div class=sect3><h4 id=printing-lpr-options-job-handling>10.5.4.2. Опции обработки заданий<a class=anchor href=#printing-lpr-options-job-handling></a></h4><div class=paragraph><p>Следующие опции команды <a href="https://man.freebsd.org/cgi/man.cgi?query=lpr&amp;sektion=1&amp;format=html">lpr(1)</a> требуют от системы LPD специальной обработки задания:</p></div><div class=dlist><dl><dt class=hdlist1>-# <em>копий</em></dt><dd><p>Выдавать указанное количество <em>копий</em> каждого файла в задании вместо одной. Администратор может отключить эту опцию для уменьшения износа принтера и поощрения использования ксерокса. См. раздел <a href=#printing-advanced-restricting-copies>Ограничение количества копий</a>.</p><div class=paragraph><p>В следующем примере на стандартный принтер печатается три копии файла <span class=filename>parser.c</span>, а затем - три копии <span class=filename>parser.h</span>:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% lpr -#3 parser.c parser.h</code></pre></div></div></dd><dt class=hdlist1>-m</dt><dd><p>Посылать почту после завершения задания печати. При указании этой опции, система LPD будет посылать почту на ваше имя после завершения обработки вашего задания. В сообщении будет сказано, выполнено ли задание успешно или по ходу была ошибка, и (часто) - в чем она состояла.</p></dd><dt class=hdlist1>-s</dt><dd><p>Не копировать файлы в каталог спулинга, а сделать там на них символические связи.</p><div class=paragraph><p>Эту опцию имеет смысл использовать при печати больших заданий. Она экономит место в каталоге спулинга (ваше задание может занять все свободное место в файловой системе, в которой находится каталог спулинга). Она также экономит время, поскольку системе LPD не придется копировать каждый байт задания в каталог спулинга.</p></div><div class=paragraph><p>Есть, однако, и недостаток: поскольку система LPD будет ссылаться на исходные файлы непосредственно, вы не сможете изменять или удалять их, пока они не будут распечатаны.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Если вы печатаете на удаленный принтер, система LPD будет вынуждена, так или иначе, скопировать файлы с локального хоста на удаленный, поэтому опция <code>-s</code>сэкономит место только в локальном каталоге спулинга, но не в удаленном. Но, она все равно полезна.</p></div></td></tr></tbody></table></div></dd><dt class=hdlist1>-r</dt><dd><p>Удалять файлы в задании после копирования в каталог спулинга или после печати, если указана опция <code>-s</code>. Будьте внимательны при использовании этой опции!</p></dd></dl></div></div><div class=sect3><h4 id=printing-lpr-options-misc>10.5.4.3. Опции начальных страниц<a class=anchor href=#printing-lpr-options-misc></a></h4><div class=paragraph><p>Эти опции команды <a href="https://man.freebsd.org/cgi/man.cgi?query=lpr&amp;sektion=1&amp;format=html">lpr(1)</a> изменяют текст, который обычно выдается на начальной странице задания. Если выдача начальных страниц для целевого принтера отключена, эти опции не действуют. Информацию по настройке начальных страниц см. в разделе <a href=#printing-advanced-header-pages>Начальные страницы</a>.</p></div><div class=dlist><dl><dt class=hdlist1>-C <em>текст</em></dt><dd><p>Заменить имя хоста на начальной странице <em>текстом</em>. Обычно на ней выдается имя хоста, с которого было послано задание.</p></dd><dt class=hdlist1>-J <em>текст</em></dt><dd><p>Заменить имя задания на начальной странице <em>текстом</em>. Имя задания обычно совпадает с именем первого файла в задании или имеет значение <span class=filename>stdin</span>, если печатается стандартный входной поток.</p></dd><dt class=hdlist1>-h</dt><dd><p>Не выдавать начальной страницы.</p><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>В некоторых организациях эта опция может не действовать, что определяется способом генерации начальных страниц. Подробнее см. в разделе <a href=#printing-advanced-header-pages>Начальные страницы</a>.</p></div></td></tr></tbody></table></div></dd></dl></div></div></div><div class=sect2><h3 id=printing-lpc>10.5.5. Администрирование принтеров<a class=anchor href=#printing-lpc></a></h3><div class=paragraph><p>Как администратор принтеров, вы должны их установить, настроить и протестировать. С помощью команды <a href="https://man.freebsd.org/cgi/man.cgi?query=lpc&amp;sektion=8&amp;format=html">lpc(8)</a> вы можете взаимодействовать с принтерами и другими способами. С помощью <a href="https://man.freebsd.org/cgi/man.cgi?query=lpc&amp;sektion=8&amp;format=html">lpc(8)</a> вы можете:</p></div><div class=ulist><ul><li><p>Запускать и останавливать принтеры</p></li><li><p>Включать и отключать их очереди</p></li><li><p>Изменять порядок заданий в каждой очереди.</p></li></ul></div><div class=paragraph><p>Начнем с замечания по терминологии: если принтер <em>остановлен</em>, он не будет печатать ничего из своей очереди. Пользователи могут продолжать посылать задания, которые будут ждать в очереди, пока принтер не будет <em>запущен</em> или пока очередь не будет очищена.</p></div><div class=paragraph><p>Если очередь <em>отключена</em>, ни один пользователь (кроме <code>root</code>) не может посылать задания на принтер. Во <em>включенную</em> очередь можно посылать задания. Принтер для отключенной очереди может быть <em>запущен</em>; при этом он будет продолжать печатать находящиеся в очереди задания, пока очередь не станет пустой.</p></div><div class=paragraph><p>В общем случае, для использования команды <a href="https://man.freebsd.org/cgi/man.cgi?query=lpc&amp;sektion=8&amp;format=html">lpc(8)</a> необходимо иметь привилегии <code>root</code>. Обычные пользователи могут использовать команду <a href="https://man.freebsd.org/cgi/man.cgi?query=lpc&amp;sektion=8&amp;format=html">lpc(8)</a> только для получения состояния принтера и перезапуска зависшего принтера.</p></div><div class=paragraph><p>Далее представлена сводка команд <a href="https://man.freebsd.org/cgi/man.cgi?query=lpc&amp;sektion=8&amp;format=html">lpc(8)</a>. Большинство команд принимает аргумент <em>имя-принтера</em>, задающий, с каким принтером работать. Можно использовать значение <code>all</code> вместо <em>имени-принтера</em>, означающее все принтеры, перечисленные в файле <span class=filename>/etc/printcap</span>.</p></div><div class=dlist><dl><dt class=hdlist1><code>abort <em>имя-принтера</em></code></dt><dd><p>Снять текущее задание и остановить принтер. Пользователи могут продолжать посылать задания, если очередь включена.</p></dd><dt class=hdlist1><code>clean <em>имя-принтера</em></code></dt><dd><p>Удалить старые файлы из каталога спулинга принтера. Иногда файлы, составляющие задание, не удаляются как положено системой LPD, особенно если в ходе печати были ошибки и выполнялось много административных действий. Эта команда находит файлы, не принадлежащие каталогу спулинга, и удаляет их.</p></dd><dt class=hdlist1><code>disable <em>имя-принтера</em></code></dt><dd><p>Отключить постановку новых заданий в очередь. Если принтер работает, он продолжит печатать задания, остающиеся в очереди. Суперпользователь (<code>root</code>) всегда может посылать задания, даже в отключенную очередь.</p><div class=paragraph><p>Эта команда полезна при тестировании вновь установленного принтера или фильтра: отключаем очередь и посылаем задания как <code>root</code>. Другие пользователи не смогут посылать задания, пока вы не закончите тестирование и не включите очередь повторно командой <code>enable</code>.</p></div></dd><dt class=hdlist1><code>down <em>имя-принтера</em> <em>сообщение</em></code></dt><dd><p>Отключить принтер. Аналогична последовательности команд <code>disable</code> и <code>stop</code>. Указанное <em>сообщение</em> выдается как состояние принтера при проверке пользователем очереди принтера с помощью <a href="https://man.freebsd.org/cgi/man.cgi?query=lpq&amp;sektion=1&amp;format=html">lpq(1)</a> или запросе его состояния командой <code>lpc status</code>.</p></dd><dt class=hdlist1><code>enable <em>имя-принтера</em></code></dt><dd><p>Включить очередь для принтера. Пользователи могут посылать задания, но принтер не будет их печатать, пока не будет запущен.</p></dd><dt class=hdlist1><code>help <em>имя-команды</em></code></dt><dd><p>Выдать справочную информацию по команде <em>имя-команды</em>. Если <em>имя-команды</em> не указано, выдает сводку по имеющимся командам.</p></dd><dt class=hdlist1><code>restart <em>имя-принтера</em></code></dt><dd><p>Перезапустить принтер. Обычные пользователи могут использовать эту команду, если в результате неких чрезвычайных обстоятельств система LPD зависла, но они не могут запустить принтер, остановленный командами <code>stop</code> или <code>down</code>. Команда <code>restart</code> эквивалентна последовательности команд <code>abort</code> и <code>start</code>.</p></dd><dt class=hdlist1><code>start <em>имя-принтера</em></code></dt><dd><p>Запустить принтер. Принтер будет печатать задания, находящиеся в его очереди.</p></dd><dt class=hdlist1><code>stop <em>имя-принтера</em></code></dt><dd><p>Остановить принтер. Принтер закончит печать текущего задания и больше ничего из очереди печатать не будет. Хотя принтер и остановлен, пользователи могут посылать задания во включенную очередь.</p></dd><dt class=hdlist1><code>topq <em>имя-принтера</em> <em>задание-или-имя-пользователя</em></code></dt><dd><p>Переупорядочить очередь для указанного принтера, помещая указанные по номеру <em>задания</em> или задания указанного по имени <em>пользователя</em> в начало очереди. Для этой команды нельзя использовать <code>all</code> в качестве <em>имени-принтера</em>.</p></dd><dt class=hdlist1><code>up <em>имя-принтера</em></code></dt><dd><p>Включить принтер; команда по действию противоположна команде <code>down</code>. Эквивалентна последовательности команд <code>start</code> и <code>enable</code>.</p></dd></dl></div><div class=paragraph><p>Утилита <a href="https://man.freebsd.org/cgi/man.cgi?query=lpc&amp;sektion=8&amp;format=html">lpc(8)</a> принимает перечисленные выше команды в командной строке. Если команда не указана, утилита <a href="https://man.freebsd.org/cgi/man.cgi?query=lpc&amp;sektion=8&amp;format=html">lpc(8)</a> входит в интерактивный режим, в котором можно вводить команды, пока не будет введена команда <code>exit</code>, <code>quit</code> или символ конца файла.</p></div></div></div></div><div class=sect1><h2 id=printing-lpd-alternatives>10.6. Альтернативы стандартному спулеру<a class=anchor href=#printing-lpd-alternatives></a></h2><div class=sectionbody><div class=paragraph><p>Если вы прочитали все это руководство, к этому моменту вы знаете практически все, что надо знать о системе спулинга LPD, входящей в состав ОС FreeBSD. Вы, возможно, уже осознали многие из ее недостатков, что, естественно, приводит к вопросу: "Какие еще системы спулинга существуют (и работают с ОС FreeBSD)"?</p></div><div class=dlist><dl><dt class=hdlist1>LPRng</dt><dd><p>Система LPRng, имя которой означает "LPR: the Next Generation" (LPR: следующее поколение) - это полностью переписанная система PLP. Патрик Пауэл (Patrick Powell) и Джастин Мейсон (Justin Mason) (основной специалист, занимающийся поддержкой PLP) объединили усилия для создания системы LPRng. Основной сайт по системе LPRng - <a href=http://www.lprng.org/>http://www.lprng.org/</a>.</p></dd><dt class=hdlist1>CUPS</dt><dd><p>Система CUPS (сокращение от Common UNIX Printing System) предоставляет переносимый механизм печати для операционных систем, основанных на UNIX®. Она была разработана компанией Easy Software Products в качестве стандартного механизма печати для всех производителей и пользователей UNIX®.</p><div class=paragraph><p>Система CUPS использует протокол Internet Printing Protocol (IPP) для управления заданиями и очередями. Протоколы Line Printer Daemon (LPD), Server Message Block (SMB) и AppSocket (известный также как JetDirect) также поддерживаются, но с меньшими возможностями. Система CUPS добавляет поиск сетевых принтеров и опции печати на основе PostScript Printer Description (PPD), для поддержки практической печати в UNIX®.</p></div><div class=paragraph><p>Основной сайт по системе CUPS - <a href=http://www.cups.org/>http://www.cups.org/</a>.</p></div></dd></dl></div></div></div><div class=sect1><h2 id=printing-troubleshooting>10.7. Выявление проблем<a class=anchor href=#printing-troubleshooting></a></h2><div class=sectionbody><div class=paragraph><p>После выполнения простого тестирования с помощью команды <a href="https://man.freebsd.org/cgi/man.cgi?query=lptest&amp;sektion=1&amp;format=html">lptest(1)</a> вы можете получить один из следующих результатов вместо корректной распечатки:</p></div><div class=dlist><dl><dt class=hdlist1>Все работает, после определенной задержки; или не выдается распечатанная страница.</dt><dd><p>Принтер напечатал все, что нужно, но он на некоторое время задумывался и ничего не делал. Фактически, могло потребоваться нажать кнопку PRINT REMAINING или FORM FEED на принтере, чтобы результаты были выданы.</p><div class=paragraph><p>Если это произошло, вероятно, принтер ждал, нет ли в задании еще данных, прежде чем что бы то ни было печатать. Для решения этой проблемы можно посылать в текстовом фильтре на принтер символ FORM FEED (или любую необходимую последовательность символов). Этого обычно достаточно, чтобы принтер немедленно распечатал любой остающийся в его внутреннем буфере текст. Также полезно убедиться, что каждое задание печати заканчивается полной страницей, чтобы следующее задание не начиналось где-то с середины последней страницы предыдущего задания.</p></div><div class=paragraph><p>Следующий измененный скрипт командного интерпретатора <span class=filename>/usr/local/libexec/if-simple</span> выдает символ прогона страницы после посылки задания на принтер:</p></div><div class="literalblock programlisting"><div class=content><pre>#!/bin/sh
#
# if-simple - Простой текстовый входной фильтр для lpd
# Установлен в /usr/local/libexec/if-simple
#
# Просто копирует stdin в stdout. Игнорирует все аргументы фильтра.
# Выдает символ прогона страницы (\f) после печати задания.

/bin/cat &amp;&amp; printf &#34;\f&#34; &amp;&amp; exit 0
exit 2</pre></div></div></dd><dt class=hdlist1>Принтер печатает "лесенкой".</dt><dd><p>Вы получаете на бумаге следующее:</p><div class="literalblock programlisting"><div class=content><pre>!&#34;#$%&amp;&#39;()*+,-./01234
                &#34;#$%&amp;&#39;()*+,-./012345
                                 #$%&amp;&#39;()*+,-./0123456</pre></div></div><div class=paragraph><p>Вы стали очередной жертвой <em>эффекта лесенки</em>, вызванного различными интерпретациями того, какие символы должны обозначать новую строку. Операционные системы UNIX®-стиля используют один символ: ASCII-код 10, перевод строки (line feed - LF). MS-DOS®, OS/2® и другие используют пару символов, ASCII-код 10 <em>и</em> ASCII-код 13 (возврат каретки, carriage return или CR). Многие принтеры используют соглашение MS-DOS® для представления новых строк.</p></div><div class=paragraph><p>При печати из FreeBSD в тексте используется только символ перевода строки. Принтер, встретив символ перевода строки, переходит на следующую строку, но оставляет ту же горизонтальную позицию на строке для следующего печатаемого символа. Вот зачем нужен символ возврата каретки: чтобы перенести следующий печатаемый символ на левый край бумаги.</p></div><div class=paragraph><p>Вот что ОС FreeBSD хочет от принтера:</p></div><table class="tableblock frame-none grid-all stretch informaltable"><col style=width:50%><col style=width:50%><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Принтер получает CR</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Принтер печатает CR</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>Принтер получает LF</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Принтер печатает CR + LF</p></td></tr></tbody></table><div class=paragraph><p>Вот несколько способов этого добиться:</p></div><div class=ulist><ul><li><p>Использовать переключатели конфигурации принтера или панель управления, чтобы изменить его интерпретацию этих символов. Поищите как это сделать в руководстве по своему принтеру.</p><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Если вы загружаете другие операционные системы, кроме FreeBSD, может иметь смысл <em>переконфигурировать</em> принтер для использования такой интерпретации символов CR и LF, которая принята в этих операционных системах. Затем можно использовать одно из представленных далее решений.</p></div></td></tr></tbody></table></div></li><li><p>Заставить драйвер последовательного порта FreeBSD автоматически преобразовывать LF в CR+LF. Конечно, это подойдет <em>только</em> для принтеров, подключенных к последовательным портам. Для включения этой возможности используйте характеристику <code>ms#</code> и установите режим <code>onlcr</code> для принтера в файле <span class=filename>/etc/printcap</span>.</p></li><li><p>Послать <em>управляющий код</em> на принтер, заставляющий его временно обрабатывать символы LF по-другому. Управляющие коды, которые может поддерживать ваш принтер, поищите в руководстве своего принтера. Когда найдете соответствующий управляющий код, измените текстовый фильтр для посылки сначала этого кода, а затем - задания печати.</p><div class=paragraph><p>Вот пример текстового фильтра для принтеров, понимающих управляющие последовательности языка Hewlett-Packard PCL. Этот фильтр заставляет принтер обрабатывать символы LF как LF и CR; затем он посылает задание; наконец, он посылает символ прогона страницы для выдачи последней страницы задания. Он должен работать практически со всеми принтерами Hewlett Packard.</p></div><div class="literalblock programlisting"><div class=content><pre>#!/bin/sh
#
# hpif - Простой текстовый входной фильтр для lpd для принтеров на базе HP-PCL
# Установлен в /usr/local/libexec/hpif
#
# Просто копирует stdin в stdout. Игнорирует все аргументы фильтра.
# Требует от принтера обрабатывать LF как CR+LF. Выдает страницу по окончании.

printf &#34;\033&amp;k2G&#34; &amp;&amp; cat &amp;&amp; printf &#34;\033&amp;l0H&#34; &amp;&amp; exit 0
exit 2</pre></div></div><div class=paragraph><p>Вот пример файла <span class=filename>/etc/printcap</span> с хоста <code>orchid</code>. К нему через первый параллельный порт подключен один принтер, Hewlett Packard LaserJet 3Si, по имени <code>teak</code>. Для него в качестве текстового фильтра используется представленный выше скрипт:</p></div><div class="literalblock programlisting"><div class=content><pre>#
#  /etc/printcap для хоста orchid
#
teak|hp|laserjet|Hewlett Packard LaserJet 3Si:\
        :lp=/dev/lpt0:sh:sd=/var/spool/lpd/teak:mx#0:\
        :if=/usr/local/libexec/hpif:</pre></div></div></li></ul></div></dd><dt class=hdlist1>Строки напечатаны одна поверх другой.</dt><dd><p>Принтер так и не перешел на следующую строку. Все строки текста были напечатаны одна поверх другой, на одной строке.</p><div class=paragraph><p>Эта проблема "обратна" эффекту лесенки, описанному выше, и встречается намного реже. Каким-то образом, символы LF, которые ОС FreeBSD использует для завершения строк, обрабатывались как символы CR и вызывали перевод позиции печати на левый край бумаги, но не переход на следующую строку.</p></div><div class=paragraph><p>Используйте переключатели конфигурации принтера или панель управления для обеспечения следующей интерпретации символов LF и CR:</p></div><table class="tableblock frame-none grid-all stretch informaltable"><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">Принтер получает</th><th class="tableblock halign-left valign-top">Принтер печатает</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock>CR</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>CR</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>LF</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>CR + LF</p></td></tr></tbody></table></dd><dt class=hdlist1>Принтер теряет символы.</dt><dd><p>По ходу печати принтер не печатает несколько символов в каждой строке. Проблема со временем может становиться все хуже, так что теряется все больше символов.</p><div class=paragraph><p>Проблема состоит в том, что принтер не справляется с той скоростью, с которой компьютер посылает данные по последовательной линии (эта проблема не должна возникать на принтерах, подключенных к параллельным портам). Есть два способа решить проблему:</p></div><div class=ulist><ul><li><p>Если принтер поддерживает управление потоком XON/XOFF, заставить FreeBSD использовать его, указав режим <code>ixon</code> в характеристике <code>ms#</code>.</p></li><li><p>Если принтер поддерживает управление несущим потоком (carrier flow control), укажите режим <code>crtscts</code> в характеристике <code>ms#</code>. Убедитесь, что кабель, соединяющий принтер с компьютером, правильно распаян для управления несущим потоком.</p></li></ul></div></dd><dt class=hdlist1>Напечатан мусор.</dt><dd><p>Принтер напечатал нечто похожее на случайный мусор, а не требуемый текст.</p><div class=paragraph><p>Это, обычно, - еще один симптом неправильных параметров взаимодействия с последовательным принтером. Перепроверьте скорость взаимодействия в характеристике <code>br</code> и установку четности в характеристике <code>ms#</code>; проверьте, что принтер использует те же установки, которые заданы в файле <span class=filename>/etc/printcap</span>.</p></div></dd><dt class=hdlist1>Ничего не произошло.</dt><dd><p>Если ничего не произошло, проблема, вероятно, связана с FreeBSD, а не с оборудованием. Добавьте характеристику журнального файла (<code>lf</code>) в файл <span class=filename>/etc/printcap</span> для принтера, работу с которым отлаживаете. Например, вот запись для принтера <code>rattan</code> с характеристикой <code>lf</code>:</p><div class="literalblock programlisting"><div class=content><pre>rattan|line|diablo|lp|Diablo 630 Line Printer:\
        :sh:sd=/var/spool/lpd/rattan:\
        :lp=/dev/lpt0:\
        :if=/usr/local/libexec/if-simple:\
        :lf=/var/log/rattan.log</pre></div></div><div class=paragraph><p>Затем попытайтесь напечатать снова. Поищите в журнальном файле (в нашем примере - <span class=filename>/var/log/rattan.log</span>) возможные сообщения об ошибках. На основе полученных сообщений попытайтесь решить проблему.</p></div><div class=paragraph><p>Если вы не зададите характеристику <code>lf</code>, система LPD использует по умолчанию <span class=filename>/dev/console</span>.</p></div></dd></dl></div></div></div></div><hr><div class=last-modified><p><strong>Изменено</strong>: 9 марта 2024 г. by <a href="https://cgit.freebsd.org/doc/commit/?id=6199af92e7" target=_blank>Danilo G. Baio</a></p></div><div class=buttons><div class=prev><i class="fa fa-angle-left" aria-hidden=true title=Назад></i><div class=container><a href=https://docs.freebsd.org/ru/books/handbook/kernelconfig class=direction>Назад</a></div></div><div class=home><i class="fa fa-home" aria-hidden=true title=Главная></i><div class=container><a href=../ class=direction>Главная</a></div></div><div class=next><div class=container><a href=https://docs.freebsd.org/ru/books/handbook/linuxemu class=direction>Далее</a></div><i class="fa fa-angle-right" aria-hidden=true title=Далее></i></div></div><label class="hidden book-menu-overlay" for=menu-control></label></div><aside class=toc><div class=toc-content><h3>Содержание</h3><nav id=TableOfContents><ul><li><a href=#printing-synopsis>10.1. Краткий обзор</a></li><li><a href=#printing-intro-spooler>10.2. Введение</a></li><li><a href=#printing-intro-setup>10.3. Основная настройка</a></li><li><a href=#printing-advanced>10.4. Расширенная настройка принтера</a></li><li><a href=#printing-using>10.5. Использование принтеров</a></li><li><a href=#printing-lpd-alternatives>10.6. Альтернативы стандартному спулеру</a></li><li><a href=#printing-troubleshooting>10.7. Выявление проблем</a></li></ul></nav><hr><div class=resources><h3>Материалы</h3><ul class=contents><li><i class="fa fa-file-pdf-o" aria-hidden=true title="Скачать PDF"></i><a href=https://download.freebsd.org/doc/ru/books/handbook/handbook_ru.pdf>Скачать PDF</a></li><li><i class="fa fa-pencil-square-o" aria-hidden=true title="Редактировать эту страницу"></i><a href=https://github.com/freebsd/freebsd-doc/blob/main/documentation/content/ru/_index target=_blank>Редактировать эту страницу</a></li></ul></div></div></aside><a class=to-top href=#top><i class="fa fa-arrow-circle-up" aria-hidden=true></i></a></main><footer><div class=footer-container><section class=logo-column><img src=https://docs.freebsd.org/images/FreeBSD-colors.svg width=160 height=50 alt="FreeBSD logo"><div class=options-container><div class=language-container><a id=languages href=https://docs.freebsd.org/ru/languages><img src=https://docs.freebsd.org/images/language.png class=language-image alt="Выберите язык">
<span>Русский</span></a></div><div class=theme-container><select id=theme-chooser><option value=theme-system>Система</option><option value=theme-light>Светлый</option><option value=theme-dark>Тёмный</option><option value=theme-high-contrast>Высокая контрастность</option></select></div></div></section><section class=about-column><h3 class=column-title>О нас</h3><ul class=column-elements-container><li><a href=https://www.freebsd.org/about/ target=_blank class=column-element>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/ target=_blank class=column-element>Фонд FreeBSD</a></li><li><a href=https://www.freebsd.org/where/ target=_blank class=column-element>Получить FreeBSD</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct target=_blank class=column-element>Кодекс Этики</a></li><li><a href=https://www.freebsd.org/security/ target=_blank class=column-element>Бюллетени Безопасности</a></li></ul></section><section class=documentation-column><h3 class=column-title>Документация</h3><ul class=column-elements-container><li><a href=/ru class=column-element>Портал документации</a></li><li><a href=https://man.FreeBSD.org target=_blank class=column-element>Страницы Справочника</a></li><li><a href=https://papers.FreeBSD.org target=_blank class=column-element>Презентации и публикации</a></li><li><a href=https://docs-archive.freebsd.org/doc/ target=_blank class=column-element>Предыдущие версии</a></li><li><a href=https://docs-archive.freebsd.org/44doc/ target=_blank class=column-element>Документы 4.4BSD</a></li><li><a href=https://wiki.freebsd.org/ target=_blank class=column-element>Wiki</a></li></ul></section><section class=community-column><h3 class=column-title>Сообщество</h3><ul class=column-elements-container><li><a href=https://docs.freebsd.org/ru/articles/contributing class=column-element>Принять участие</a></li><li><a href=https://forums.freebsd.org/ target=_blank class=column-element>Форум Сообщества</a></li><li><a href=https://lists.freebsd.org/ target=_blank class=column-element>Списки рассылки</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank class=column-element>Каналы IRC</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank class=column-element>Трекер ошибок</a></li></ul></section><section class=legal-column><h3 class=column-title>Юридическая информация</h3><ul class=column-elements-container><li><a href=https://freebsdfoundation.org/donate/ target=_blank class=column-element>Пожертвования</a></li><li><a href=https://www.freebsd.org/copyright/freebsd-license/ target=_blank class=column-element>Лицензирование</a></li><li><a href=https://www.freebsd.org/privacy/ target=_blank class=column-element>Политика Конфиденциальности</a></li><li><a href=https://www.freebsd.org/copyright/ target=_blank class=column-element>Юридические оговорки</a></li></ul></section><section class=copyright-column><p>&copy; 1994-2024 Проект FreeBSD. Все права защищены</p><span>Сделано с помощью <span class=heart>♥</span> Сообществом FreeBSD</span></section></div></footer></body></html>