<!doctype html><html class=theme-light lang=ru><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content><meta name=copyright content="1995-2024 The FreeBSD Foundation"><link rel=canonical href=http://172.16.201.134:1313/ru/books/porters-handbook/makefiles/><title>Глава 5. Настройка файла Makefile | FreeBSD Documentation Portal</title>
<meta name=theme-color content="#790000"><meta name=color-scheme content="system light dark high-contrast"><link rel="shortcut icon" href=http://172.16.201.134:1313/favicon.ico><link rel=stylesheet href=http://172.16.201.134:1313/styles/main.min.css><link rel=stylesheet href=http://172.16.201.134:1313/css/font-awesome-min.css><script defer src=/js/theme-chooser.min.js></script><script defer src=/js/copy-clipboard.min.js></script><script defer src=/js/search.min.js></script><meta name=twitter:card content="summary"><meta name=twitter:domain content="docs.FreeBSD.org"><meta name=twitter:site content="@freebsd"><meta name=twitter:url content="https://twitter.com/freebsd"><meta property="og:title" content="Глава 5. Настройка файла Makefile"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:image" content="http://172.16.201.134:1313/favicon.ico"><meta property="og:image:alt" content="FreeBSD Logo"><meta property="og:locale" content="ru"><meta property="og:url" content="http://172.16.201.134:1313/ru/books/porters-handbook/makefiles/"><meta property="og:site_name" content="FreeBSD Documentation Portal"><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","url":"http:\/\/172.16.201.134:1313\/ru\/books\/porters-handbook\/makefiles\/","name":"FreeBSD Documentation Portal","headline":"FreeBSD Documentation Portal","description":"FreeBSD Documentation Portal"}</script></head><body><header><div class=header-container><div class=logo-menu-bars-container><a href=https://www.FreeBSD.org class=logo><img src=http://172.16.201.134:1313/images/FreeBSD-monochromatic.svg width=160 height=50 alt="FreeBSD logo">
</a><label class=menu-bars for=menu-bars><i class="fa fa-bars" aria-hidden=true></i></label></div><input id=menu-bars type=checkbox><nav><ul class=menu><li class=menu-item><input id=about type=checkbox>
<a href=# aria-label="Navigate to About section"><label class=menu-item-description for=about>О нас
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/about/ target=_blank>О нас</a></li><li><a href=https://www.freebsd.org/about/ target=_blank>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/about-us/about-the-foundation/ target=_blank>Фонд FreeBSD</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct/ target=_blank>Кодекс Этики</a></li></ul></li><li class=menu-item><input id=download type=checkbox>
<a href=# aria-label="Navigate to get FreeBSD section"><label class=menu-item-description for=download>Получить FreeBSD
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/where/ target=_blank>Получить FreeBSD</a></li><li><a href=https://www.freebsd.org/releases/ target=_blank>Информация о релизах</a></li><li><a href=https://www.freebsd.org/releng/ target=_blank>Подготовка релизов</a></li><li><a href=https://www.freebsd.org/security/ target=_blank>Бюллетени Безопасности</a></li></ul></li><li class=menu-item><input id=documentation type=checkbox>
<a href=# aria-label="Navigate to get Documentation section"><label class=menu-item-description for=documentation>Документация
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=/ru>Портал документации</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook>Руководство</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook>Руководство по созданию портов</a></li><li><a href=https://docs.FreeBSD.org/en/books/fdp-primer>Учебник Проекта Документирования</a></li><li><a href=https://man.FreeBSD.org target=_blank>Страницы Справочника</a></li><li><a href=https://papers.FreeBSD.org target=_blank>Презентации и публикации</a></li><li><a href=https://wiki.FreeBSD.org target=_blank>Wiki</a></li><li><a href=http://172.16.201.134:1313/ru/books>Книги</a></li><li><a href=http://172.16.201.134:1313/ru/articles>Статьи</a></li></ul></li><li class=menu-item><input id=community type=checkbox>
<a href=# aria-label="Navigate to get Community section"><label class=menu-item-description for=community>Сообщество
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/community/>Сообщество</a></li><li><a href=http://172.16.201.134:1313/ru/articles/contributing>Стать участником</a></li><li><a href=https://forums.freebsd.org/ target=_blank>Форум</a></li><li><a href=https://lists.freebsd.org/ target=_blank>Списки рассылки</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank>Каналы IRC</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank>Трекер ошибок</a></li><li><a href=https://www.freebsd.org/support/ target=_blank>Поддержка</a></li></ul></li></ul></nav><div class=search-donate-container><form class=search method=get id=search-header-form action=https://docs.freebsd.org/search name=search-header-form><input type=hidden name=DB value=ru>
<input id=words name=P type=text size=20 maxlength=255>
<button>
<i class="fa fa-search" aria-hidden=true></i></button></form><div class=donate><a href=https://freebsdfoundation.org/donate/ target=_blank><span class=heart>♥</span>
Пожертвования</a></div></div></div></header><input type=checkbox class="hidden toggle" id=menu-control><main class=main-wrapper-book><a id=top></a><aside class=book-menu><div class=book-menu-content><input id=search-book type=text placeholder=Поиск aria-label=Поиск maxlength=128><nav id=MenuContents><ul><li><input type=checkbox id=chapter-c934186a5adac4f64b993f751abed30c class=toggle>
<label for=chapter-c934186a5adac4f64b993f751abed30c><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/porters-handbook/porting-why/>Глава 1. Введение</a></li><li><input type=checkbox id=chapter-2798d78fe854f2709bab5ca473b97050 class=toggle>
<label for=chapter-2798d78fe854f2709bab5ca473b97050><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/porters-handbook/new-port/>Глава 2. Как самому сделать новый порт</a></li><li><input type=checkbox id=chapter-c0d52b9121b517084e01f59cefa725e1 class=toggle>
<label class="icon cursor" for=chapter-c0d52b9121b517084e01f59cefa725e1><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/porters-handbook/quick-porting/>Глава 3. Быстрое портирование</a><ul><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/quick-porting/#porting-makefile>3.1. Создание файла <span class=filename>Makefile</span></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/quick-porting/#porting-desc>3.2. Создание информационных файлов</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/quick-porting/#porting-checksum>3.3. Создание файла с контрольной суммой</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/quick-porting/#porting-testing>3.4. Тестирование порта</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/quick-porting/#porting-portlint>3.5. Проверка вашего порта утилитой <code>portlint</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/quick-porting/#porting-submitting>3.6. Посылка нового порта</a></li></ul></li><li><input type=checkbox id=chapter-3694de03923da61ba10a0a25efca6ef0 class=toggle>
<label class="icon cursor" for=chapter-3694de03923da61ba10a0a25efca6ef0><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/porters-handbook/slow-porting/>Глава 4. Медленное портирование</a><ul><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/slow-porting/#slow-work>4.1. Как всё это работает</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/slow-porting/#slow-sources>4.2. Получение исходного кода</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/slow-porting/#slow-modifying>4.3. Модификация порта</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/slow-porting/#slow-patch>4.4. Создание патчей</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/slow-porting/#slow-configure>4.5. Конфигурирование</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/slow-porting/#slow-user-input>4.6. Обработка пользовательского ввода</a></li></ul></li><li><input type=checkbox id=chapter-165f6a6dba6651f8c25fc63ab83d6538 class=toggle checked>
<label class="icon cursor" for=chapter-165f6a6dba6651f8c25fc63ab83d6538><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/porters-handbook/makefiles/>Глава 5. Настройка файла Makefile</a><ul><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/makefiles/#makefile-source>5.1. Оригинальные исходный код</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/makefiles/#makefile-naming>5.2. Именование</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/makefiles/#makefile-categories>5.3. Разделение по категориям</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/makefiles/#makefile-distfiles>5.4. Дистрибутивные файлы</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/makefiles/#makefile-maintainer>5.5. <code>MAINTAINER</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/makefiles/#makefile-comment>5.6. <code>COMMENT</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/makefiles/#makefile-portscout>5.7. <code>PORTSCOUT</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/makefiles/#makefile-depend>5.8. Зависимости</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/makefiles/#makefile-masterdir>5.9. <code>MASTERDIR</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/makefiles/#makefile-manpages>5.10. Страницы Справочника</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/makefiles/#makefile-info>5.11. Файлы в формате info</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/makefiles/#makefile-options>5.12. Опции для Makefile</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/makefiles/#makefile-wrkdir>5.13. Задание рабочего каталога</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/makefiles/#conflicts>5.14. Разрешение конфликтов</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/makefiles/#install>5.15. Установка файлов</a></li></ul></li><li><input type=checkbox id=chapter-19e3150e00beb84341d8ac1a73936ef0 class=toggle>
<label class="icon cursor" for=chapter-19e3150e00beb84341d8ac1a73936ef0><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/porters-handbook/special/>Глава 6. Особые соглашения</a><ul><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/special/#staging>6.1. Staging</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/special/#porting-shlibs>6.2. Динамические библиотеки</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/special/#porting-restrictions>6.3. Порты с ограничениями на распространение или с правовым обременением</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/special/#building>6.4. Механизмы построения</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/special/#using-autotools>6.5. Использование GNU Autotools</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/special/#using-gettext>6.6. Использование GNU <code>gettext</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/special/#using-perl>6.7. Использование Perl</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/special/#using-x11>6.8. Использование X11</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/special/#using-gnome>6.9. Использование GNOME</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/special/#using-qt>6.10. Использование Qt</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/special/#using-kde>6.11. Использование KDE</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/special/#using-java>6.12. Использование Java</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/special/#using-php>6.13. Веб-приложения, Apache и PHP</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/special/#using-python>6.14. Использование Python</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/special/#using-tcl>6.15. Использование Tcl/Tk</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/special/#using-emacs>6.16. Использование Emacs</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/special/#using-ruby>6.17. Использование Ruby</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/special/#using-sdl>6.18. Использование SDL</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/special/#using-wx>6.19. Использование wxWidgets</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/special/#using-lua>6.20. Использование Lua</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/special/#using-iconv>6.21. Использование <code>iconv</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/special/#using-xfce>6.22. Использование Xfce</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/special/#using-mozilla>6.23. Использование Mozilla</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/special/#using-databases>6.24. Использование баз данных</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/special/#rc-scripts>6.25. Запуск и остановка служб (сценарии <code>rc</code>)</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/special/#users-and-groups>6.26. Добавление пользователей и групп</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/special/#requiring-kernel-sources>6.27. Порты, требующие наличия исходных текстов ядра</a></li></ul></li><li><input type=checkbox id=chapter-154554011c772e1e6cc0108eef5e0b2b class=toggle>
<label class="icon cursor" for=chapter-154554011c772e1e6cc0108eef5e0b2b><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/porters-handbook/plist/>Глава 7. Продвинутые практики pkg-plist</a><ul><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/plist/#plist-sub>7.1. Изменение содержимого <span class=filename>pkg-plist</span> в зависимости от make-переменных</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/plist/#plist-cleaning>7.2. Пустые каталоги</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/plist/#plist-config>7.3. Конфигурационные файлы</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/plist/#plist-dynamic>7.4. Динамический или статический список упаковки</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/plist/#plist-autoplist>7.5. Автоматическое создание списка упаковки</a></li></ul></li><li><input type=checkbox id=chapter-5955b0791ccd51005b5bc5bebeec91e5 class=toggle>
<label class="icon cursor" for=chapter-5955b0791ccd51005b5bc5bebeec91e5><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/porters-handbook/pkg-files/>Глава 8. Файлы pkg-*</a><ul><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/pkg-files/#porting-message>8.1. <span class=filename>pkg-message</span></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/pkg-files/#pkg-install>8.2. <span class=filename>pkg-install</span></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/pkg-files/#pkg-deinstall>8.3. <span class=filename>pkg-deinstall</span></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/pkg-files/#pkg-names>8.4. Изменение имён файлов <span class=filename>pkg-*</span></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/pkg-files/#using-sub-files>8.5. Использование <code>SUB_FILES</code> и <code>SUB_LIST</code></a></li></ul></li><li><input type=checkbox id=chapter-ee86a11caedb6395ed82b94ec7a9c6cd class=toggle>
<label class="icon cursor" for=chapter-ee86a11caedb6395ed82b94ec7a9c6cd><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/porters-handbook/testing/>Глава 9. Тестирование вашего порта</a><ul><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/testing/#make-describe>9.1. Запуск <code>make describe</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/testing/#testing-portlint>9.2. Portlint</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/testing/#testing-porttools>9.3. Port Tools</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/testing/#porting-prefix>9.4. <code>PREFIX</code> и <code>DESTDIR</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/testing/#testing-tinderbox>9.5. Tinderbox</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/testing/#testing-poudriere>9.6. Poudriere</a></li></ul></li><li><input type=checkbox id=chapter-4ccaefe2590c044ca2b79c46e79fe17f class=toggle>
<label class="icon cursor" for=chapter-4ccaefe2590c044ca2b79c46e79fe17f><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/porters-handbook/upgrading/>Глава 10. Обновление отдельного порта</a><ul><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/upgrading/#svn-diff>10.1. Использование Subversion для создания патчей</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/upgrading/#moved-and-updating-files>10.2. Файлы <span class=filename>UPDATING</span> и <span class=filename>MOVED</span></a></li></ul></li><li><input type=checkbox id=chapter-1023911bc0041506653280b832dea3b2 class=toggle>
<label class="icon cursor" for=chapter-1023911bc0041506653280b832dea3b2><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/porters-handbook/security/>Глава 11. Безопасность портов</a><ul><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/security/#security-intro>11.1. Почему безопасность так важна</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/security/#security-fix>11.2. Исправление уязвимостей безопасности</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/security/#security-notify>11.3. Обеспечение сообщества информацией</a></li></ul></li><li><input type=checkbox id=chapter-9a8875d5d59aa92f1e5a78e9ecd1fbe7 class=toggle>
<label class="icon cursor" for=chapter-9a8875d5d59aa92f1e5a78e9ecd1fbe7><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/porters-handbook/porting-dads/>Глава 12. Что делать нужно, и что делать нельзя</a><ul><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/porting-dads/#dads-intro>12.1. Введение</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/porting-dads/#porting-wrkdir>12.2. <code>WRKDIR</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/porting-dads/#porting-wrkdirprefix>12.3. <code>WRKDIRPREFIX</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/porting-dads/#porting-versions>12.4. Различение операционных систем и версий ОС</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/porting-dads/#dads-after-port-mk>12.5. Написание чего-либо после <span class=filename>bsd.port.mk</span></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/porting-dads/#dads-sh-exec>12.6. Использование выражения <code>exec</code> в сценариях обёртках</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/porting-dads/#dads-rational>12.7. Поступайте разумно</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/porting-dads/#dads-cc>12.8. Работа как с <code>CC</code>, так и <code>CXX</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/porting-dads/#dads-cflags>12.9. Использование <code>CFLAGS</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/porting-dads/#dads-pthread>12.10. Библиотеки потоков</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/porting-dads/#dads-feedback>12.11. Пожелания</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/porting-dads/#dads-readme>12.12. <span class=filename>README.html</span></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/porting-dads/#dads-noinstall>12.13. Пометка неустанавливаемого порта как <code>BROKEN</code>, <code>FORBIDDEN</code> или <code>IGNORE</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/porting-dads/#dads-deprecated>12.14. Пометка порта на удаление с <code>DEPRECATED</code> или <code>EXPIRATION_DATE</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/porting-dads/#dads-dot-error>12.15. Избегайте использования конструкции <code>.error</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/porting-dads/#dads-sysctl>12.16. Использование <span class=filename>sysctl</span></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/porting-dads/#dads-rerolling-distfiles>12.17. Меняющиеся дистрибутивные файлы</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/porting-dads/#dads-avoiding-linuxisms>12.18. Избегание линуксизмов</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/porting-dads/#dads-misc>12.19. Разное</a></li></ul></li><li><input type=checkbox id=chapter-5ef4c4c471a3f55c74fb71881f9d8713 class=toggle>
<label for=chapter-5ef4c4c471a3f55c74fb71881f9d8713><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/porters-handbook/porting-samplem/>Глава 13. Примерный Makefile</a></li><li><input type=checkbox id=chapter-70f5a4755700a24529175d26e65871bf class=toggle>
<label class="icon cursor" for=chapter-70f5a4755700a24529175d26e65871bf><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/porters-handbook/keeping-up/>Глава 14. Актуализация</a><ul><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/keeping-up/#freshports>14.1. FreshPorts</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/keeping-up/#svnweb>14.2. Web-интерфейс к хранилищу исходных текстов</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/keeping-up/#ports-mailing-list>14.3. Список рассылки FreeBSD, посвящённый портам</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/keeping-up/#build-cluster>14.4. Кластер построения портов FreeBSD</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/keeping-up/#distfile-survey>14.5. Portscout: сканер дистрибутивных файлов портов FreeBSD</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/keeping-up/#portsmon>14.6. Система мониторинга портов FreeBSD</a></li></ul></li><li><input type=checkbox id=chapter-8225273087f0e195be28132f4b5a0562 class=toggle>
<label class="icon cursor" for=chapter-8225273087f0e195be28132f4b5a0562><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/>Глава 15. Значения USES</a><ul><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-intro>15.1. An Introduction to <code>USES</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-7z>15.2. <code>7z</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-ada>15.3. <code>ada</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-autoreconf>15.4. <code>autoreconf</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-blaslapack>15.5. <code>blaslapack</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-bdb>15.6. <code>bdb</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-bison>15.7. <code>bison</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-cabal>15.8. <code>cabal</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-cargo>15.9. <code>cargo</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-charsetfix>15.10. <code>charsetfix</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-cmake>15.11. <code>cmake</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-compiler>15.12. <code>compiler</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-cpe>15.13. <code>cpe</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-cran>15.14. <code>cran</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-desktop-file-utils>15.15. <code>desktop-file-utils</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-desthack>15.16. <code>desthack</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-display>15.17. <code>display</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-dos2unix>15.18. <code>dos2unix</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-drupal>15.19. <code>drupal</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-eigen>15.20. <code>eigen</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-fakeroot>15.21. <code>fakeroot</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-fam>15.22. <code>fam</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-firebird>15.23. <code>firebird</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-fonts>15.24. <code>fonts</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-fortran>15.25. <code>fortran</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-fuse>15.26. <code>fuse</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-gem>15.27. <code>gem</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-gettext>15.28. <code>gettext</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-gettext-runtime>15.29. <code>gettext-runtime</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-gettext-tools>15.30. <code>gettext-tools</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-ghostscript>15.31. <code>ghostscript</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-gl>15.32. <code>gl</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-gmake>15.33. <code>gmake</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-gnome>15.34. <code>gnome</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-go>15.35. <code>go</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-gperf>15.36. <code>gperf</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-grantlee>15.37. <code>grantlee</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-groff>15.38. <code>groff</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-gssapi>15.39. <code>gssapi</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-horde>15.40. <code>horde</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-iconv>15.41. <code>iconv</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-imake>15.42. <code>imake</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-kde>15.43. <code>kde</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-kmod>15.44. <code>kmod</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-lha>15.45. <code>lha</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-libarchive>15.46. <code>libarchive</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-libedit>15.47. <code>libedit</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-libtool>15.48. <code>libtool</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-linux>15.49. <code>linux</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-localbase>15.50. <code>localbase</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-lua>15.51. <code>lua</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-lxqt>15.52. <code>lxqt</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-makeinfo>15.53. <code>makeinfo</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-makeself>15.54. <code>makeself</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-mate>15.55. <code>mate</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-meson>15.56. <code>meson</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-metaport>15.57. <code>metaport</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-mysql>15.58. <code>mysql</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-mono>15.59. <code>mono</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-motif>15.60. <code>motif</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-ncurses>15.61. <code>ncurses</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-ninja>15.62. <code>ninja</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-objc>15.63. <code>objc</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-openal>15.64. <code>openal</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-pathfix>15.65. <code>pathfix</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-pear>15.66. <code>pear</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-perl5>15.67. <code>perl5</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-pgsql>15.68. <code>pgsql</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-php>15.69. <code>php</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-pkgconfig>15.70. <code>pkgconfig</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-pure>15.71. <code>pure</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-pyqt>15.72. <code>pyqt</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-python>15.73. <code>python</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-qmail>15.74. <code>qmail</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-qmake>15.75. <code>qmake</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-qt>15.76. <code>qt</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-qt-dist>15.77. <code>qt-dist</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-readline>15.78. <code>readline</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-samba>15.79. <code>samba</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-scons>15.80. <code>scons</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-shared-mime-info>15.81. <code>shared-mime-info</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-shebangfix>15.82. <code>shebangfix</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-sqlite>15.83. <code>sqlite</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-ssl>15.84. <code>ssl</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-tar>15.85. <code>tar</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-tcl>15.86. <code>tcl</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-terminfo>15.87. <code>terminfo</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-tk>15.88. <code>tk</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-uidfix>15.89. <code>uidfix</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-uniquefiles>15.90. <code>uniquefiles</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-varnish>15.91. <code>varnish</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-webplugin>15.92. <code>webplugin</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-xfce>15.93. <code>xfce</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-xorg>15.94. <code>xorg</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-xorg-cat>15.95. <code>xorg-cat</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-zip>15.96. <code>zip</code></a></li></ul></li><li><input type=checkbox id=chapter-7713ccc63287693c9be6c832b2c1e850 class=toggle>
<label class="icon cursor" for=chapter-7713ccc63287693c9be6c832b2c1e850><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/porters-handbook/versions/>Глава 16. Значения __FreeBSD_version</a><ul><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/versions/#versions-13>16.1. FreeBSD 13 Versions</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/versions/#versions-12>16.2. FreeBSD 12 Versions</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/versions/#versions-11>16.3. FreeBSD 11 Versions</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/versions/#versions-10>16.4. FreeBSD 10 Versions</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/versions/#versions-9>16.5. FreeBSD 9 Versions</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/versions/#versions-8>16.6. FreeBSD 8 Versions</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/versions/#versions-7>16.7. FreeBSD 7 Versions</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/versions/#versions-6>16.8. FreeBSD 6 Versions</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/versions/#versions-5>16.9. FreeBSD 5 Versions</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/versions/#versions-4>16.10. FreeBSD 4 Versions</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/versions/#versions-3>16.11. FreeBSD 3 Versions</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/versions/#versions-2.2>16.12. FreeBSD 2.2 Versions</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/versions/#versions-2>16.13. FreeBSD 2 Before 2.2-RELEASE Versions</a></li></ul></li><li></li></ul></nav></div></aside><div class=book><div class=book-menu-mobile><label for=menu-control><span class=menu-control-button><i class="fa fa-list" aria-hidden=true title="Меню книг"></i>
Меню книг</span></label></div><h1 class=title>Глава 5. Настройка файла Makefile</h1><div class="admonitionblock note"><p><i class="fa fa-exclamation-circle" aria-hidden=true></i>
Этот перевод может быть устаревшим. Для того, чтобы помочь с переводом, пожалуйста, обратитесь к <a href=https://translate-dev.freebsd.org/ target=_blank>Сервер переводов FreeBSD</a>.</p></div><div class=toc-mobile><h3>Содержание</h3><nav id=TableOfContents><ul><li><a href=#makefile-source>5.1. Оригинальные исходный код</a></li><li><a href=#makefile-naming>5.2. Именование</a></li><li><a href=#makefile-categories>5.3. Разделение по категориям</a></li><li><a href=#makefile-distfiles>5.4. Дистрибутивные файлы</a></li><li><a href=#makefile-maintainer>5.5. <code>MAINTAINER</code></a></li><li><a href=#makefile-comment>5.6. <code>COMMENT</code></a></li><li><a href=#makefile-portscout>5.7. <code>PORTSCOUT</code></a></li><li><a href=#makefile-depend>5.8. Зависимости</a></li><li><a href=#makefile-masterdir>5.9. <code>MASTERDIR</code></a></li><li><a href=#makefile-manpages>5.10. Страницы Справочника</a></li><li><a href=#makefile-info>5.11. Файлы в формате info</a></li><li><a href=#makefile-options>5.12. Опции для Makefile</a></li><li><a href=#makefile-wrkdir>5.13. Задание рабочего каталога</a></li><li><a href=#conflicts>5.14. Разрешение конфликтов</a></li><li><a href=#install>5.15. Установка файлов</a></li></ul></nav></div><div class=book-content><div id=preamble><div class=sectionbody><div class=paragraph><p>Настройка файла <span class=filename>Makefile</span> достаточно проста, и мы снова предполагаем, что перед тем, как начать, вы посмотрите на существующие примеры. К тому же в этом руководстве имеется <a href=#porting-samplem>примерный Makefile</a>, так что взгляните на него и, пожалуйста, следуйте порядку переменных и разделов в этом образце, чтобы облегчить чтение вашего порта другими людьми.</p></div><div class=paragraph><p>Итак, расположим решаемые задачи в порядке их возникновения при создании вашего нового файла <span class=filename>Makefile</span>:</p></div></div></div><div class=sect1><h2 id=makefile-source>5.1. Оригинальные исходный код<a class=anchor href=#makefile-source></a></h2><div class=sectionbody><div class=paragraph><p>Находится ли он в каталоге <code>DISTDIR</code> в виде стандартного упакованного архиватором <code>gzip</code> tar-архива с именем типа <span class=filename>foozolix-1.2.tar.gz</span>? Если это так, можно перейти к следующему шагу. Если нет, то вы должны попытаться переопределить некоторые из переменных <code>DISTVERSION</code>, <code>DISTNAME</code>, <code>EXTRACT_CMD</code>, <code>EXTRACT_BEFORE_ARGS</code>, <code>EXTRACT_AFTER_ARGS</code>, <code>EXTRACT_SUFX</code> или <code>DISTFILES</code> в зависимости от того, насколько необычен формат дистрибутивного файла.</p></div><div class=paragraph><p>В худшем случае вы можете просто определить свою собственную цель <code>do-extract</code> для переопределения действий по умолчанию, хотя к этому нужно будет прибегать в очень редких случаях, если вообще придётся.</p></div></div></div><div class=sect1><h2 id=makefile-naming>5.2. Именование<a class=anchor href=#makefile-naming></a></h2><div class=sectionbody><div class=paragraph><p>В первой части <span class=filename>Makefile</span> порта ему даётся название, указывается его номер версии и принадлежность к правильной категории.</p></div><div class=sect2><h3 id=_portname_и_portversion>5.2.1. <code>PORTNAME</code> и <code>PORTVERSION</code><a class=anchor href=#_portname_и_portversion></a></h3><div class=paragraph><p>В переменной <code>PORTNAME</code> вы должны указать основную часть имени вашего порта, а в переменной <code>PORTVERSION</code> - номер версии.</p></div></div><div class=sect2><h3 id=makefile-naming-revepoch>5.2.2. <code>PORTREVISION</code> и <code>PORTEPOCH</code><a class=anchor href=#makefile-naming-revepoch></a></h3><div class=sect3><h4 id=_portrevision>5.2.2.1. <code>PORTREVISION</code><a class=anchor href=#_portrevision></a></h4><div class=paragraph><p>Переменная <code>PORTREVISION</code> представляет собой монотонно увеличивающееся число, которое обнуляется при каждом увеличении значения переменной <code>PORTVERSION</code> (то есть каждый раз, когда создателями выпускается новый официальный релиз), и добавляется к имени пакета, если оно не равно нулю. Изменения в <code>PORTREVISION</code> используются автоматизированными инструментами (например, <code>pkg version</code>, см. <a href="https://man.freebsd.org/cgi/man.cgi?query=pkg-version&amp;sektion=8&amp;format=html">pkg-version(8)</a>) для определения факта появления нового пакета.</p></div><div class=paragraph><p>Значение <code>PORTREVISION</code> должно увеличиваться каждый раз, когда в порте FreeBSD делаются изменения, которые как-либо меняют получаемый пакет. Сюда относятся только изменения, затрагивающие построение пакета с <a href=#makefile-options>параметрами</a> по умолчанию.</p></div><div class=paragraph><p>Примеры случаев, когда значение <code>PORTREVISION</code> должно быть увеличено:</p></div><div class=ulist><ul><li><p>Добавление патчей для исправления уязвимостей, ошибок, или добавления новой функциональности в порт.</p></li><li><p>Изменения в файле <span class=filename>Makefile</span> порта для включения и выключения параметров, определяемых при компиляции пакета.</p></li><li><p>Изменения в списке упаковки или в поведении пакета во время его установки (например, изменение скрипта, генерирующего начальные данные для пакета, такие, как ssh-ключи для хоста).</p></li><li><p>Увеличение версии динамической библиотеки, от которой зависит порт (в этом случае тот, кто попытается установить старый пакет после установки более новой версии библиотеки, не сможет этого сделать, потому что при этом будет делаться поиск старой библиотеки libfoo.x, а не libfoo.(x+1)).</p></li><li><p>Большие функциональные изменения в дистрибутивном файле порта, происходящие без объявлений, и приводящие к большим изменениям, то есть изменения в дистрибутиве требуют корректировки файла <span class=filename>distinfo</span> без соответствующего изменения <code>PORTVERSION</code>, когда как команда <code>diff -ru</code> между новой и старой версиями показывает нетривиальные изменения в коде.</p></li></ul></div><div class=paragraph><p>Примеры изменений, которые не требуют увеличения переменной <code>PORTREVISION</code>:</p></div><div class=ulist><ul><li><p>Изменения стиля в скелете порта без функциональных изменений в пакете.</p></li><li><p>Изменения в переменной <code>MASTER_SITES</code> или другие функциональные изменения порта, которые не затрагивают получающегося пакета.</p></li><li><p>Тривиальные патчи к дистрибутивному файлу, такие, как исправления опечаток, которые не так уж важны, что пользователи пакета должны озаботиться обновлением.</p></li><li><p>Исправления, касающиеся этапа построения, которые делают возможным построение пакета, если ранее это было невозможно сделать (пока изменения не приводят к изменению работы на любых других платформах, на которых порт ранее строился). Так как <code>PORTREVISION</code> отражает содержимое пакета, то, если ранее пакет не строился, то нет нужды увеличивать <code>PORTREVISION</code> для отметки изменения.</p></li></ul></div><div class=paragraph><p>Правило, которому нужно приблизительно следовать, заключается в том, что нужно спрашивать себя, является ли вносимое в порт изменение таким, что от него выиграют все (в виде усовершенствования, исправления или благодаря тому, что новый пакет будет вообще работоспособным), и примите во внимание тот факт, что при этом все, кто регулярно обновляют своё дерево портов, будут обязаны это сделать. Если это так, то переменная <code>PORTREVISION</code> должна быть увеличена.</p></div></div><div class=sect3><h4 id=_portepoch>5.2.2.2. <code>PORTEPOCH</code><a class=anchor href=#_portepoch></a></h4><div class=paragraph><p>Время от времени разработчик программного обеспечения или создатель порта FreeBSD делают что-то не так и выпускают версию программы, номер которой меньше предыдущей версии. Примером этого является порт, название которого меняется с foo-20000801 на foo-1.0 (изначально это не считалось бы более новой версией, так как 20000801 численно больше, чем 1).</p></div><div class="admonitionblock tip"><table><tbody><tr><td class=icon><i class="fa icon-tip" title=Tip></i></td><td class=content><div class=paragraph><p>Результат сравнения номера версии не всегда очевиден. Для выполнения сравнения двух строк с номером версии можно использовать <code>pkg version</code> (см. <a href="https://man.freebsd.org/cgi/man.cgi?query=pkg-version&amp;sektion=8&amp;format=html">pkg-version(8)</a>). Например:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>% pkg version <span class=nt>-t</span> 0.031 0.29
<span class=o>&gt;</span></code></pre></div></div><div class=paragraph><p>Строка <code>></code> в выводе команды означает, что версия 0.031 считается выше, чем версия 0.29, что может быть не очевидно для того, кто выполняет портирование.</p></div></td></tr></tbody></table></div><div class=paragraph><p>В ситуациях, подобных этой, должно быть увеличено значение <code>PORTEPOCH</code>. Если значение <code>PORTEPOCH</code> не равно нулю, то оно добавляется к имени пакета, как описано в разделе выше. Значение <code>PORTEPOCH</code> никогда не должно уменьшаться или сбрасываться в ноль, потому что это приведёт к ошибке сравнения с пакетом с меньшим номером эпохи (то есть то, что пакет устарел, обнаружено не будет): номер новой версии (например, <code>1.0,1</code> в примере выше) останется меньше, чем номер предыдущей версии (20000801), однако суффикс <code>,1</code> интерпретируется различными автоматизированными утилитами особым образом, и окажется больше, чем предполагаемый суффикс <code>,0</code> более раннего пакета).</p></div><div class=paragraph><p>Некорректное уменьшение или сброс <code>PORTEPOCH</code> приводит к печальным последствиям; если вы не поняли, о чём шла речь ранее, пожалуйста, всё же разберитесь с этим, либо спросите в списках рассылки.</p></div><div class=paragraph><p>Предполагается, что в большинстве портов переменная <code>PORTEPOCH</code> использоваться не будет, но при корректном использовании <code>PORTVERSION</code> может появиться необходимость её иметь, если в будущих релизах программное обеспечение должно изменить структуру номера версии. Однако создателям портов для FreeBSD нужно быть внимательными, когда разработчик выпускает релиз без официального номера версии - эдакие "промежуточные" релизы. Имеется соблазн пометить релиз датой его выхода, что может вызвать проблемы, как и в примере выше, когда будет выпущен новый "официальный" релиз.</p></div><div class=paragraph><p>Например, если промежуточный релиз помечен датой 20000917, а предыдущая версия программного обеспечения имела номер 1.2, то промежуточному релизу должно быть поставлено в соответствие значение <code>PORTVERSION</code>, равное 1.2.20000917 или что-то похожее, но не 20000917, так как последующий релиз, скажем, 1.3, должен иметь численно большее значение.</p></div></div><div class=sect3><h4 id=_пример_использования_переменных_portrevision_и_portepoch>5.2.2.3. Пример использования переменных <code>PORTREVISION</code> и <code>PORTEPOCH</code><a class=anchor href=#_пример_использования_переменных_portrevision_и_portepoch></a></h4><div class=paragraph><p>Выполнен коммит порта <code>gtkmumble</code>, версии <code>0.10</code>, в коллекцию портов.</p></div><div class="literalblock programlisting"><div class=content><pre>PORTNAME=	gtkmumble
PORTVERSION=	0.10</pre></div></div><div class=paragraph><p>Значение <code>PKGNAME</code> станет равным <code>gtkmumble-0.10</code>.</p></div><div class=paragraph><p>Обнаружена брешь в безопасности, исправление которой потребовало создания локального патча для FreeBSD. Соответственно было увеличено значение переменной <code>PORTREVISION</code>.</p></div><div class="literalblock programlisting"><div class=content><pre>PORTNAME=	gtkmumble
PORTVERSION=	0.10
PORTREVISION=	1</pre></div></div><div class=paragraph><p><code>PKGNAME</code> принимает значение <code>gtkmumble-0.10_1</code></p></div><div class=paragraph><p>Разработчиком выпущена новая версия с номером <code>0.2</code> (оказалось, что под номером <code>0.10</code> автор имел в виду <code>0.1.0</code>, а не "то, что будет выпущено после версии 0.9" - извините, теперь уже поздно). Так как новый младший номер версии <code>2</code> по значению меньше, чем номер предыдущей версии <code>10</code>, то должно быть увеличено значение <code>PORTEPOCH</code> для того, чтобы заставить распознавать вновь создаваемый пакет как "более новый". Так как это новый релиз программы, то <code>PORTREVISION</code> обнуляется (или удаляется из файла <span class=filename>Makefile</span>).</p></div><div class="literalblock programlisting"><div class=content><pre>PORTNAME=	gtkmumble
PORTVERSION=	0.2
PORTEPOCH=	1</pre></div></div><div class=paragraph><p><code>PKGNAME</code> принимает значение <code>gtkmumble-0.2,1</code></p></div><div class=paragraph><p>Следующий релиз имеет номер версии 0.3. Так как значение переменной <code>PORTEPOCH</code> никогда не уменьшается, что переменные, определяющие версии, теперь выглядят так:</p></div><div class="literalblock programlisting"><div class=content><pre>PORTNAME=	gtkmumble
PORTVERSION=	0.3
PORTEPOCH=	1</pre></div></div><div class=paragraph><p><code>PKGNAME</code> принимает значение <code>gtkmumble-0.3,1</code></p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Если значение <code>PORTEPOCH</code> этим обновлением было бы сброшено в <code>0</code>, то кто-нибудь, имеющий установленный пакет <code>gtkmumble-0.10_1</code>, не смог бы опознать пакет <code>gtkmumble-0.3</code> как более новый, так как <code>3</code> было бы меньше, чем <code>10</code>. Помните, что в первую очередь это касается <code>PORTEPOCH</code>.</p></div></td></tr></tbody></table></div></div></div><div class=sect2><h3 id=_переменные_pkgnameprefix_и_pkgnamesuffix>5.2.3. Переменные <code>PKGNAMEPREFIX</code> и <code>PKGNAMESUFFIX</code><a class=anchor href=#_переменные_pkgnameprefix_и_pkgnamesuffix></a></h3><div class=paragraph><p>Две необязательные переменные, <code>PKGNAMEPREFIX</code> и <code>PKGNAMESUFFIX</code>, объединяются со значениями <code>PORTNAME</code> и <code>PORTVERSION</code> для формирования <code>PKGNAME</code> в форме <code>${PKGNAMEPREFIX}${PORTNAME}${PKGNAMESUFFIX}-${PORTVERSION}</code>. Добейтесь того, чтобы это соответствовало нашим <a href=#porting-pkgname>рекомендациям по правильному выбору названий для пакетов</a>. В частности, в переменной <code>PORTVERSION</code> <em>не разрешается</em> использование дефиса (<code>-</code>). Кроме того, если в имени пакета присутствует часть <em>language-</em> или <em>-compiled.specifics</em> (смотрите ниже), то используйте переменные <code>PKGNAMEPREFIX</code> и <code>PKGNAMESUFFIX</code>, соответственно. Не делайте их частью значения переменной <code>PORTNAME</code>.</p></div></div><div class=sect2><h3 id=porting-pkgname>5.2.4. Соглашения по именованию пакетов<a class=anchor href=#porting-pkgname></a></h3><div class=paragraph><p>Далее описаны некоторые соглашения, которым вы должны следовать в именовании ваших пакетов. Они были разработаны для облегчения просмотра каталога, так как имеется уже тысячи пакетов, а пользователи отвернутся от нас, если список не понравится их взору!</p></div><div class=paragraph><p>Имя пакета должно иметь вид <span class=filename>language_region-name-compiled.specifics-version.numbers</span>.</p></div><div class=paragraph><p>Имя пакета определяется как <code>${PKGNAMEPREFIX}${PORTNAME}${PKGNAMESUFFIX}-${PORTVERSION}</code>. Вы должны задавать значения переменных в соответствии с этим форматом.</p></div><div class="olist arabic"><ol class=arabic><li><p>FreeBSD пытается поддерживать языки, на которых разговаривают её пользователи. Часть <em>language-</em> должна быть двухсимвольным сокращением от названия языка по стандарту ISO-639, если порт специфичен для конкретного языка. Примерами являются <code>ja</code> для японского, <code>ru</code> для русского, <code>vi</code> для вьетнамского, <code>zh</code> для китайского, <code>ko</code> для корейского и <code>de</code> для немецкого языков.</p><div class=paragraph><p>Если ваш порт специфичен для конкретного региона внутри области использования языка, добавьте также двухсимвольный код страны. Примерами являются <code>en_US</code> для US English и <code>fr_CH</code> для Swiss French.</p></div><div class=paragraph><p>Часть <em>language-</em> должна задаваться в переменной <code>PKGNAMEPREFIX</code>.</p></div></li><li><p>Первая буква части <span class=filename>name</span> должна быть в нижнем регистре. (Оставшаяся часть названия может содержать буквы в верхнем регистре, так что принимайте решение сами, когда преобразуете имя программного пакета, содержащего в имени некоторое количество заглавных букв.) Существует традиция именовать модули для <code>Perl 5</code>, добавляя впереди <code>p5-</code> и преобразуя пару двоеточий в дефис; например, модуль <code>Data::Dumper</code> будет именоваться <code>p5-Data-Dumper</code>.</p></li><li><p>Убедитесь, что имя порта и версия четко отделены и размещаются в переменных <code>PORTNAME</code> и <code>PORTVERSION</code>. Единственная причина, по которой <code>PORTNAME</code> содержит версионную часть, это если полученный дистрибутив сам назван таким образом, как это сделано для портов <span class=filename>textproc/libxml2</span> или <span class=filename>japanese/kinput2-freewnn</span>. В противном случае <code>PORTNAME</code> не должен содержать никакой информации, указывающей на версию. То, что некоторые порты имеют одинаковый <code>PORTNAME</code>, является вполне нормальным, как для портов <span class=filename>www/apache*</span>; в этом случае различные версии (и различные записи в индексе) отличаются по значениям <code>PKGNAMEPREFIX</code> и <code>PKGNAMESUFFIX</code>.</p></li><li><p>Если порт может быть построен с различными <a href=#makefile-masterdir>статически заданными значениями по умолчанию</a> (обычно это часть имени каталога в семействе портов), то часть <em>-compiled.specifics</em> должна определять вкомпилированные значения по умолчанию (дефис не обязателен). Примерами являются размеры бумаги и шрифтов.</p><div class=paragraph><p>Часть <em>-compiled.specifics</em> должна задаваться в переменной <code>PKGNAMESUFFIX</code>.</p></div></li><li><p>Строка с номером версии должна следовать за дефисом (<code>-</code>) и являться списком разделенных двоеточием чисел и букв в нижнем регистре. В частности, не разрешается иметь еще один дефис внутри строки с обозначением номера версии. Единственным исключением является строчка <code>pl</code> (означающая "patchlevel"), которая может использоваться <em>только</em> тогда, когда у программного обеспечения нет старшего и младшего номера версии. Если в номер версии программного обеспечения включена строчка типа "alpha", "beta", "rc" или "pre", возьмите из неё первую букву и поставьте её непосредственно после точки. Если после таких строк номер версии ещё продолжается, то после буквы должно следовать число без дополнительной разделяющей точки.</p><div class=paragraph><p>Смысл такого формата заключается в удобстве сортировки портов по номеру версии. В частности, следите за тем, чтобы компоненты номера версии разделялись точкой, и если там присутствует дата, то используйте формат <code>0.0.yyyy.mm.dd</code>, но не <code>dd.mm.yyyy</code> или не совместимый с проблемой Y2K <code>yy.mm.dd</code>. Добавление к версии префикса <code>0.0.</code> является важным, в случае если выпущен релиз с присвоением настоящей версии, которая в числовом представлении, конечно же, будет ниже, чем <code>yyyy</code>.</p></div></li></ol></div><div class=paragraph><p>Вот несколько (реальных) примеров того, как преобразовать имя из оригинального, придуманного авторами, к подходящему для имени пакета:</p></div><table class="tableblock frame-none grid-all stretch informaltable"><col style=width:16.6666%><col style=width:16.6666%><col style=width:16.6666%><col style=width:16.6666%><col style=width:16.6666%><col style=width:16.667%><thead><tr><th class="tableblock halign-left valign-top">Имя дистрибутива</th><th class="tableblock halign-left valign-top">PKGNAMEPREFIX</th><th class="tableblock halign-left valign-top">PORTNAME</th><th class="tableblock halign-left valign-top">PKGNAMESUFFIX</th><th class="tableblock halign-left valign-top">PORTVERSION</th><th class="tableblock halign-left valign-top">Обоснование</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock>mule-2.2.2</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>(пусто)</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>mule</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>(пусто)</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>2.2.2</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Изменений не потребовалось</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>EmiClock-1.0.2</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>(пусто)</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>emiclock</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>(пусто)</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>1.0.2</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Для отдельных программ имена с заглавными буквами запрещены</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>rdist-1.3alpha</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>(пусто)</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>rdist</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>(пусто)</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>1.3.a</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Строчки типа <code>alpha</code> запрещены</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>es-0.9-beta1</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>(пусто)</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>es</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>(пусто)</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>0.9.b1</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Строчки типа <code>beta</code> запрещены</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>mailman-2.0rc3</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>(пусто)</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>mailman</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>(пусто)</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>2.0.r3</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Строчки типа <code>rc</code> запрещены</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>v3.3beta021.src</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>(пусто)</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>tiff</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>(пусто)</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>3.3</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Что это такое было вообще?</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>tvtwm</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>(пусто)</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>tvtwm</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>(пусто)</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>pl11</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Всегда требуется указание номера версии</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>piewm</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>(пусто)</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>piewm</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>(пусто)</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>1.0</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Всегда требуется указание номера версии</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>xvgr-2.10pl1</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>(пусто)</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>xvgr</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>(пусто)</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>2.10.1</p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>pl</code> разрешено только при отсутствии старшего/младшего номера версии</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>gawk-2.15.6</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>ja-</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>gawk</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>(пусто)</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>2.15.6</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Версия на японском языке</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>psutils-1.13</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>(пусто)</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>psutils</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>-letter</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>1.13</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Размер бумаги задается статически во время построения пакета</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>pkfonts</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>(пусто)</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>pkfonts</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>300</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>1.0</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>пакет для шрифтов 300dpi</p></td></tr></tbody></table><div class=paragraph><p>Если в исходном коде абсолютно нет информации о номере версии и не похоже, что автор собирается выпускать другую версию, то в качестве номера версии задайте просто <code>1.0</code> (как в примере с <code>piewm</code> выше). В противном случае спросите автора программы или используйте дату (<code>0.0.yyyy.mm.dd</code>) в качестве номера версии.</p></div></div></div></div><div class=sect1><h2 id=makefile-categories>5.3. Разделение по категориям<a class=anchor href=#makefile-categories></a></h2><div class=sectionbody><div class=sect2><h3 id=_categories>5.3.1. <code>CATEGORIES</code><a class=anchor href=#_categories></a></h3><div class=paragraph><p>В процессе создания пакета он помещается в каталог <span class=filename>/usr/ports/packages/All</span>, а в одном или более подкаталогов из <span class=filename>/usr/ports/packages</span> создаются на него ссылки. Имена этих подкаталогов определяются переменной <code>CATEGORIES</code>. Такая схема нужна для облегчения жизни пользователя, когда он сталкивается с массой пакетов на FTP-сервере или компакт-диске. Пожалуйста, посмотрите на <a href=#porting-categories>текущий список категорий</a> и выберите те из них, которые более всего подходят к вашему порту.</p></div><div class=paragraph><p>Этот список также определяет, куда в дереве портов будет помещен порт. Если вы укажете здесь более одной категории, то предполагается, что файлы порта будут помещены в подкаталог с именем первой категории. Посмотрите <a href=#choosing-categories>ниже</a> для получения подробной информации о том, как правильно выбрать категории.</p></div></div><div class=sect2><h3 id=porting-categories>5.3.2. Текущий список категорий<a class=anchor href=#porting-categories></a></h3><div class=paragraph><p>Вот текущий список категорий. Те, которые отмечены звёздочкой (<code>*</code>), являются <em>виртуальными</em> категориями-они не имеют собственного подкаталога в дереве портов. Они используются только в качестве вторичных категорий, и только для поиска.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Для невиртуальных категорий имеется однострочное описание в <code>COMMENT</code> в <span class=filename>Makefile</span> соответствующего подкаталога.</p></div></td></tr></tbody></table></div><table class="tableblock frame-none grid-all stretch informaltable"><col style=width:33.3333%><col style=width:33.3333%><col style=width:33.3334%><thead><tr><th class="tableblock halign-left valign-top">Категория</th><th class="tableblock halign-left valign-top">Описание</th><th class="tableblock halign-left valign-top">Примечания</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>accessibility</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Порты для помощи пользователям с ограниченными возможностями.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>afterstep*</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Порты, поддерживающие менеджер окон <a href=http://www.afterstep.org>AfterStep</a>.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>arabic</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Поддержка арабского языка.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>archivers</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Инструменты для работы с архивами.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>astro</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Приложения, связанные с астрономией.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>audio</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Поддержка работы со звуком.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>benchmarks</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Утилиты для измерения производительности системы.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>biology</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Программное обеспечение, связанное с биологией.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>cad</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Инструменты Систем Автоматизированного Проектирования.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>chinese</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Поддержка китайского языка.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>comms</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Коммуникационное программное обеспечение.</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>В основном программы для работы с последовательным портом.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>converters</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Утилиты для преобразования символьных форматов.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>databases</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Базы данных.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>deskutils</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>То, что было на столе до изобретения компьютеров.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>devel</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Утилиты для разработки программного обеспечения.</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Не помещайте сюда библиотеки просто потому, что это библиотеки-если они подпадают под какую-то другую категорию, то их быть здесь не должно.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>dns</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Программное обеспечение для работы DNS.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>docs*</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Мета-порты для документации FreeBSD.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>editors</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Редакторы общего назначения.</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Специализированные редакторы относят к разделу для соответствующих инструментов (например, редактор математических формул попадает в категорию <span class=filename>math</span>).</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>elisp*</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Порты для Emacs lisp.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>emulators</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Эмуляторы других операционных систем.</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Эмуляторы терминалов сюда <em>не</em> относятся-те, которые разработаны для X, должны быть в категории <span class=filename>x11</span>, а текстовые в <span class=filename>comms</span> или <span class=filename>misc</span>, в зависимости от конкретного их предназначения.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>finance</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Приложения для работы с деньгами, финансами и всем, что с этим связано.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>french</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Поддержка французского языка.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>ftp</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Клиенты и серверы FTP.</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Если ваш порт понимает как FTP, так и HTTP, поместите его в категорию <span class=filename>ftp</span> и укажите вторичную категорию <span class=filename>www</span>.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>games</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Игры.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>geography*</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Программное обеспечение, связанное с географией.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>german</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Поддержка немецкого языка.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>gnome*</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Порты Проекта <a href=http://www.gnome.org>GNOME</a>.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>gnustep*</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Программное обеспечение для окружения рабочего стола GNUstep.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>graphics</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Графические утилиты.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>hamradio*</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Программное обеспечение для любительского радио</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>haskell*</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Программное обеспечение, связанное с языком Haskell.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>hebrew</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Поддержка иврита.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>hungarian</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Поддержка венгерского языка.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>ipv6*</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Программное обеспечение, связанное с IPv6.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>irc</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Утилиты для Internet Relay Chat.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>japanese</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Поддержка японского языка.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>java</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Программное обеспечение, связанное с языком Java™.</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Категория <span class=filename>java</span> ни в коем случае не должна быть единственной для порта. Оставьте для портов, непосредственно имеющих отношение к языку Java, портерам также рекомендуется не использовать <span class=filename>java</span> как основную категорию порта.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>kde*</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Порты проекта <a href=http://www.kde.org>KDE</a>.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>kld*</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Загружаемые модули ядра.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>korean</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Поддержка корейского языка.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>lang</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Языки программирования.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>linux*</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Linux приложения и утилиты.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>lisp*</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Программное обеспечение, связанное с языком Lisp.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>mail</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Программы для работы с почтой.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>math</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Программное обеспечение для численных вычислений и другие утилиты, связанные с математикой.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>mbone*</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Приложения для MBone.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>misc</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Различные утилиты</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>В общем, то, что не попадает в другие категории. Если это возможно, попробуйте найти более подходящую, чем <code>misc</code>, категорию для вашего порта, так как здесь порты теряются.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>multimedia</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Программное обеспечение для работы с мультимедиа.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>net</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Различное сетевое программное обеспечение.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>net-im</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Программы мгновенного обмена сообщениями.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>net-mgmt</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Программное обеспечение для сетевого управления.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>net-p2p</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Приложения для пиринговых сетей.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>news</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Программное обеспечение для работы с конференциями USENET.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>palm</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Программная поддержка <a href=http://www.palm.com/>Palm™</a>.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>parallel*</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Приложения, связанные с параллельными вычислениями.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>pear*</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Порты, относящиеся к технологии Pear PHP.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>perl5*</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Порты, которым для работы требуется Perl версии 5.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>plan9*</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Различные программы из <a href=http://www.cs.bell-labs.com/plan9dist/>Plan9</a>.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>polish</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Поддержка польского языка.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>ports-mgmt</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Порты для управления, установки и разработки портов и пакетов FreeBSD.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>portuguese</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Поддержка португальского языка.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>print</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Программное обеспечение для печати.</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Инструменты для вёрстки (просмотрщики и тому подобное) тоже относятся сюда.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>python*</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Программное обеспечение, связанное с языком <a href=http://www.python.org/>Python</a>.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>ruby*</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Программное обеспечение, связанное с языком <a href=http://www.ruby-lang.org/>Ruby</a>.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>rubygems*</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Порты для пакетов <a href=http://www.rubygems.org/>RubyGems</a>.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>russian</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Поддержка русского языка.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>scheme*</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Программное обеспечение, связанное с языком Scheme.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>science</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Научные программы, которые не подпадают под другие категории, скажем, <span class=filename>astro</span>, <span class=filename>biology</span> или <span class=filename>math</span>.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>security</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Программы, обеспечивающие безопасность системы.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>shells</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Различные командные процессоры.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>sysutils</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Системные утилиты.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>spanish*</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Поддержка испанского языка.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>tcl*</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Порты, для работы которых нужен Tcl.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>textproc</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Утилиты для обработки текстов.</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Инструменты для вёрстки помещаются в категорию <span class=filename>print</span>, а не сюда.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>tk*</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Порты, для работы которых нужен Tk.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>ukrainian</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Поддержка украинского языка.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>vietnamese</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Поддержка вьетнамского языка.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>windowmaker*</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Порты для поддержки менеджера окон WindowMaker.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>www</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Программное обеспечение, связанное со всемирной паутиной.</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Поддержка языка HTML относится сюда же.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>x11</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>X Window System и иже с ними.</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Эта категория предназначена только для программного обеспечения, которое поддерживает саму оконную систему. Не помещайте сюда обычные приложения для X: большинство из них должны быть перенесены в другие категории <span class=filename>x11-*</span> (смотрите ниже).</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>x11-clocks</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Часы для X11.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>x11-drivers</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Драйверы X11.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>x11-fm</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Менеджеры файлов для X11.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>x11-fonts</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Шрифты для X11 и утилиты для работы с ними.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>x11-servers</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Серверы для X11.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>x11-themes</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Темы для X11.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>x11-toolkits</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Пакеты разработчика для X11.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>x11-wm</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Оконные менеджеры для X11.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>xfce*</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Порты, связанные с окружением рабочего стола <a href=http://www.xfce.org/>Xfce</a>.</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>zope*</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Поддержка <a href=http://www.zope.org/>Zope</a>.</p></td><td class="tableblock halign-left valign-top"></td></tr></tbody></table></div><div class=sect2><h3 id=choosing-categories>5.3.3. Выбор правильной категории<a class=anchor href=#choosing-categories></a></h3><div class=paragraph><p>Так как многие категории перекрываются, вам часто необходимо будет выбирать, какая их них должна быть основной для вашего порта. Есть несколько правил, по которым можно решить этот вопрос. Вот список приоритетов, в уменьшающейся степени предпочтения:</p></div><div class=ulist><ul><li><p>Первая категория должна быть физической категорий (смотрите <a href=#porting-categories>выше</a>). Это необходимо для создания пакетов. После этого виртуальные и физические категории могут смешиваться.</p></li><li><p>Сначала всегда идут категории, специфичные для языков. Например, если ваш порт устанавливает японские шрифты для X11, то строчка <code>CATEGORIES</code> должна иметь вид <span class=filename>japanese x11-fonts</span>.</p></li><li><p>Более конкретные категории идут первыми перед более общими. В частности, редактор HTML должен быть описан как <span class=filename>www editors</span>, а не наоборот. Кроме того, вы не должны указывать категорию <span class=filename>net</span>, если порт относится к одной из категорий <span class=filename>irc</span>, <span class=filename>mail</span>, <span class=filename>news</span>, <span class=filename>security</span> или <span class=filename>www</span>, так как <span class=filename>net</span> включается автоматически.</p></li><li><p><span class=filename>x11</span> используется как вторичная категория только в случае, если в качестве основной категории указан естественный язык. В частности, вам не нужно указывать <span class=filename>x11</span> в качестве категории для приложений X.</p></li><li><p>Режимы для редактора Emacs должны помещаться в ту же категорию, что и приложение, которое поддерживается этим режимом, а не в <span class=filename>editors</span>. Например, режим Emacs для редактирования исходного кода некоторого языка программирования должен быть помещен в категорию <span class=filename>lang</span>.</p></li><li><p>Порты, устанавливающие загружаемые модули ядра, должны содержать виртуальную категорию <span class=filename>kld</span> в строке <code>CATEGORIES</code>. Это одно из действий, выполняемых автоматически с добавлением <code>kmod</code> в строке <code>USES</code>.</p></li><li><p><span class=filename>misc</span> не должна указываться вместе с любой другой невиртуальной категорией. Если вы указываете <code>misc</code> вместе с чем-то ещё в строке <code>CATEGORIES</code>, это значит, что вы можете спокойно удалить <code>misc</code> и просто поместить порт в этот другой подкаталог!</p></li><li><p>Если ваш порт решительным образом не подпадает ни под какую категорию, поместите его в <span class=filename>misc</span>.</p></li></ul></div><div class=paragraph><p>Если вы не уверены в правильности выбора категории, пожалуйста, отметьте это в вашем сообщении <a href="https://man.freebsd.org/cgi/man.cgi?query=send-pr&amp;sektion=1&amp;format=html">send-pr(1)</a>, чтобы мы могли обсудить это до того, как включить порт в Коллекцию. Если вы являетесь коммиттером, пошлите замечание на адрес <a href=https://lists.FreeBSD.org/subscription/freebsd-ports>Список рассылки, посвящённый Портам FreeBSD</a>, чтобы мы могли обсудить это. Зачастую новые порты помещаются не в ту категорию только для того, чтобы их оттуда сразу же удалили. Это приводит к излишнему и ненужному росту основного хранилища исходных текстов.</p></div></div><div class=sect2><h3 id=proposing-categories>5.3.4. Предложение новой категории<a class=anchor href=#proposing-categories></a></h3><div class=paragraph><p>Поскольку со временем Коллекция Портов увеличилась, то в связи с этим были добавлены различные новые категории. Новые категории могут быть или <em>виртуальными</em> категориями-которые не имеют соответствующего подкаталога в дереве портов-или <em>физическими</em> категориями-у которых он есть. Следующий текст содержит обсуждение вопросов, возникающих при создании новой физической категории, чтобы вы могли понимать их, когда предложите новую категорию.</p></div><div class=paragraph><p>В соответствие с существующей практикой мы избегаем создания новой физической категории, пока достаточно большое число портов логически ей не принадлежит или же порты, которые могли бы ей принадлежать, не являются логически обособленной группой, представляющей для всех ограниченный интерес (в частности, категории, относящиеся к естественным языкам); предпочтительно выполнение обоих условий.</p></div><div class=paragraph><p>Основной причиной для этого является то, что такое изменение создает <a href=https://docs.freebsd.org/ru/articles/committers-guide/#ports>изрядное количество работы</a> и для коммиттеров, и для всех тех пользователей, которые отслеживают изменения в Коллекции Портов. В дополнение, предложенная категория создает естественное разногласие. (Пожалуй, потому что не существует четкого соглашения, является ли категория "слишком большой", или должны ли категории предоставлять себя для просмотра (и, таким образом, какое количество категорий было бы идеальным значением), и так далее.)</p></div><div class=paragraph><p>Процедура:</p></div><div class="exampleblock procedure"><div class=content><div class="olist arabic"><ol class=arabic><li><p>Предложите новую категорию на <a href=https://lists.FreeBSD.org/subscription/freebsd-ports>Список рассылки, посвящённый Портам FreeBSD</a>. Вам следует включить для новой категории детальное обоснование, в том числе почему вы считаете, что существующие категории не являются достаточными, и список существующих портов, предложенных для перемещения. (Если есть новые порты, ожидающие в GNATS и попадающие в эту категорию, то укажите их тоже.) Если вы являетесь сопровождающим и/или отправителем, то укажите это соответственно, так как это может помочь вам в вашем деле.</p></li><li><p>Принимайте участие в обсуждении.</p></li><li><p>Если кажется, что для вашей идеи появилась поддержка, отправьте PR, который будет включать обоснование и список существующих портов, которые надо переместить. В идеале этот PR должен также включать патчи для следующего:</p><div class=ulist><ul><li><p><span class=filename>Makefile</span>'ы для новых портов в результате репозиторного копирования</p></li><li><p><span class=filename>Makefile</span> для категорий старых портов</p></li><li><p><span class=filename>Makefile</span>'ы для портов, зависящих от старых портов</p></li><li><p>(в дополнение, вы можете включить другие файлы, требующие изменений, согласно процедуре из Руководства Коммиттера.)</p></li></ul></div></li><li><p>Поскольку это затрагивает инфраструктуру портов и охватывает не только выполнение репозиторного копирования, но также, возможно, и выполнение регрессивных тестов на кластере построения, то PR должна назначать себе Группа Менеджеров Дерева Портов FreeBSD &lt;<a href=mailto:portmgr@FreeBSD.org>portmgr@FreeBSD.org</a>>.</p></li><li><p>Если этот PR одобрен, то коммиттеру нужно продолжить остальную часть процедуры, которая <a href=https://docs.freebsd.org/ru/articles/committers-guide/#ports>изложена в Руководстве Коммиттера</a>.</p></li></ol></div></div></div><div class=paragraph><p>Предложение новой виртуальной категории должно быть схожим с вышеизложенным, но при этом затрагивать намного меньше, поскольку ни один из портов не будет перемещен в действительности. В этом случае единственными патчами, включенными в PR, будут те, что добавляют новую категорию в <code>CATEGORIES</code> каждого из затрагиваемых портов.</p></div></div><div class=sect2><h3 id=proposing-reorg>5.3.5. Предложение реорганизации всех категорий<a class=anchor href=#proposing-reorg></a></h3><div class=paragraph><p>Время от времени кто-нибудь предлагает произвести реорганизацию категорий либо до двухуровневой, либо другого типа на основе ключевых слов. На данный момент из этих предложений ничего не получилось, потому что, хотя они просты в реализации, но предполагаемая переделка всей коллекции портов по меньшей мере приводит в уныние. Пожалуйста, прочтите историю этих предложений в архивах рассылок перед тем, как присылать свои соображения; более того, вы должны быть готовы представить работающий прототип.</p></div></div></div></div><div class=sect1><h2 id=makefile-distfiles>5.4. Дистрибутивные файлы<a class=anchor href=#makefile-distfiles></a></h2><div class=sectionbody><div class=paragraph><p>Во второй части <span class=filename>Makefile</span> задаётся, какие файлы и откуда должны быть сгружены для того, чтобы построить порт.</p></div><div class=sect2><h3 id=_distversiondistname>5.4.1. <code>DISTVERSION/DISTNAME</code><a class=anchor href=#_distversiondistname></a></h3><div class=paragraph><p>В переменной <code>DISTNAME</code> указывается имя порта так, как назвали его создатели программного обеспечения. Значение <code>DISTNAME</code> по умолчанию совпадает с <code>${PORTNAME}-${PORTVERSION}</code>, так что переопределяете её значение только в случае необходимости. <code>DISTNAME</code> используется только в двух местах. Во-первых, список дистрибутивных файлов (<code>DISTFILES</code>) по умолчанию состоит из <code>${DISTNAME}${EXTRACT_SUFX}</code>. И во-вторых, предполагается, что дистрибутивный файл будет распакован в подкаталог с именем <code>WRKSRC</code>, значение которого по умолчанию есть не что иное, как <span class=filename>work/${DISTNAME}</span>.</p></div><div class=paragraph><p>Названия некоторых дистрибутивов, которые не укладываются в <code>${PORTNAME}-${PORTVERSION}</code>-схему, могут быть автоматически обработаны посредством установки переменной <code>DISTVERSION</code>. <code>PORTVERSION</code> и <code>DISTNAME</code> будут унаследованы автоматически, но конечно же могут быть переопределены. Следующая таблица демонстрирует некоторые примеры:</p></div><table class="tableblock frame-none grid-all stretch informaltable"><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">DISTVERSION</th><th class="tableblock halign-left valign-top">PORTVERSION</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock>0.7.1d</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>0.7.1.d</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>10Alpha3</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>10.a3</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>3Beta7-pre2</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>3.b7.p2</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock>8:f_17</p></td><td class="tableblock halign-left valign-top"><p class=tableblock>8f.17</p></td></tr></tbody></table><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Значения переменных <code>PKGNAMEPREFIX</code> и <code>PKGNAMESUFFIX</code> не влияют на значение <code>DISTNAME</code>. Заметьте также, что если значение <code>WRKSRC</code> равно <span class=filename>work/${PORTNAME}-${PORTVERSION}</span>, и в случае, когда оригинальный архив называется по имени, отличном от <code>${PORTNAME}-${PORTVERSION}${EXTRACT_SUFX}</code>, скорее всего, вы должны оставить <code>DISTNAME</code> как есть- лучше переопределить <code>DISTFILES</code>, чем задавать значения как <code>DISTNAME</code>, так и <code>WRKSRC</code> (и, возможно, ещё и <code>EXTRACT_SUFX</code>).</p></div></td></tr></tbody></table></div></div><div class=sect2><h3 id=_master_sites>5.4.2. <code>MASTER_SITES</code><a class=anchor href=#_master_sites></a></h3><div class=paragraph><p>Содержит часть с каталогом FTP/HTTP-URL, которая указывает на оригинальный архив на сервере <code>MASTER_SITES</code>. Не забудьте лидирующий слэш (<span class=filename>/</span>)!</p></div><div class=paragraph><p>Макрос команды <code>make</code> будет пытаться воспользоваться этой переменной для получения дистрибутивного файла с помощью программы <code>FETCH</code>, если он не будет найден в системе.</p></div><div class=paragraph><p>Рекомендуется помещать в список много сайтов, предпочтительно с разных континентов. Это поможет при наличии проблем с мировой сетью. Мы даже планируем добавить поддержку автоматического определения ближайшего сайта и сгрузки файлов оттуда; наличие нескольких сайтов будет способствовать этому начинанию.</p></div><div class=paragraph><p>Если оригинальный архив находится на одном из таких популярных серверов, как SourceForge, GNU или Perl CPAN, то указывайте эти сайты в простой форме при помощи <code>MASTER_SITE_*</code> (к примеру, <code>MASTER_SITE_SOURCEFORGE</code>, <code>MASTER_SITE_GNU</code> или <code>MASTER_SITE_PERL_CPAN</code>. Просто укажите в переменной <code>MASTER_SITES</code> одно из этих значений, а в переменной <code>MASTER_SITE_SUBDIR</code> задайте путь к архиву. Вот пример:</p></div><div class="literalblock programlisting"><div class=content><pre>MASTER_SITES=		${MASTER_SITE_GNU}
MASTER_SITE_SUBDIR=	make</pre></div></div><div class=paragraph><p>Или можно использовать сокращенный формат:</p></div><div class="literalblock programlisting"><div class=content><pre>MASTER_SITES=	GNU/make</pre></div></div><div class=paragraph><p>Эти переменные определены в файле <span class=filename>/usr/ports/Mk/bsd.sites.mk</span>. Всё время добавляются новые записи, так что обращайтесь к последней версии этого файла перед тем, как послать нам свой порт.</p></div><div class=paragraph><p>Для популярных сайтов существует несколько <em>магических</em> макросов с заранее известной структурой каталогов. Используйте для них сокращения, и система попытается угадать для вас правильный подкаталог.</p></div><div class="literalblock programlisting"><div class=content><pre>MASTER_SITES=	SF</pre></div></div><div class=paragraph><p>Если попытка угадать не удалась, то это может быть переписано следующим образом.</p></div><div class="literalblock programlisting"><div class=content><pre>MASTER_SITES=	SF/stardict/WyabdcRealPeopleTTS/${PORTVERSION}</pre></div></div><div class=paragraph><p>Что также можно записать в таком виде:</p></div><div class="literalblock programlisting"><div class=content><pre>MASTER_SITES=	SF
MASTER_SITE_SUBDIR=	stardict/WyabdcRealPeopleTTS/${PORTVERSION}</pre></div></div><table class="tableblock frame-none grid-all stretch"><caption class=title>Таблица 1. Популярные магические макросы для <code>MASTER_SITES</code></caption><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">Макрос</th><th class="tableblock halign-left valign-top">Предполагаемый подкаталог</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>APACHE_JAKARTA</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>/dist/jakarta/${PORTNAME:S,-,,/,}/source</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>BERLIOS</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>/${PORTNAME:L}</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>CHEESESHOP</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>/packages/source/source/${DISTNAME:C/(.).*/\1/}/${DISTNAME:C/(.*)-[0-9].*/\1/}</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>DEBIAN</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>/debian/pool/main/${PORTNAME:C/^((lib)?.).*$/\1/}/${PORTNAME}</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>GCC</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>/pub/gcc/releases/${DISTNAME}</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>GNOME</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>/pub/GNOME/sources/${PORTNAME}/${PORTVERSION:C/^(<span class=0-9>\.[0-9]</span>).*/\1/}</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>GNU</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>/gnu/${PORTNAME}</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>MOZDEV</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>/pub/mozdev/${PORTNAME:L}</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>PERL_CPAN</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>/pub/CPAN/modules/by-module/${PORTNAME:C/-.*//}</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>PYTHON</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>/ftp/python/${PYTHON_PORTVERSION:C/rc[0-9]//}</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>RUBYFORGE</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>/${PORTNAME:L}</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>SAVANNAH</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>/${PORTNAME:L}</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>SF</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock><code>/project/${PORTNAME:L}/${PORTNAME:L}/${PORTVERSION}</code></p></td></tr></tbody></table></div><div class=sect2><h3 id=_extract_sufx>5.4.3. <code>EXTRACT_SUFX</code><a class=anchor href=#_extract_sufx></a></h3><div class=paragraph><p>Если у вас имеется один дистрибутивный файл, и в его имени используется странное окончание для указания типа сжатия, задайте переменную <code>EXTRACT_SUFX</code>.</p></div><div class=paragraph><p>К примеру, если дистрибутивный файл носит имя <span class=filename>foo.tgz</span>, а не более привычное <span class=filename>foo.tar.gz</span>, вы должны написать:</p></div><div class="literalblock programlisting"><div class=content><pre>DISTNAME=	foo
EXTRACT_SUFX=	.tgz</pre></div></div><div class=paragraph><p>Переменные <code>USE_BZIP2</code>, <code>USE_XZ</code> и <code>USE_ZIP</code> при необходимости автоматически устанавливают значение <code>EXTRACT_SUFX</code> в <code>.tar.bz2</code>, <code>.tar.xz</code> или <code>.zip</code>. Если ни одна из этих переменных не задана, то значение <code>EXTRACT_SUFX</code> по умолчанию устанавливается в <code>.tar.gz</code>.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Вам не нужно задавать значения <code>EXTRACT_SUFX</code> и <code>DISTFILES</code> одновременно.</p></div></td></tr></tbody></table></div></div><div class=sect2><h3 id=_distfiles>5.4.4. <code>DISTFILES</code><a class=anchor href=#_distfiles></a></h3><div class=paragraph><p>Иногда имена сгружаемых файлов не соответствуют имени порта. К примеру, файл может называться <span class=filename>source.tar.gz</span> или подобным образом. В других случаях исходный код приложения может располагаться в нескольких отличающихся архивах, и все они должны быть сгружены.</p></div><div class=paragraph><p>Если это ваш случай, то задайте в переменной <code>DISTFILES</code> список разделённых пробелами имён файлов, которые нужно сгрузить.</p></div><div class="literalblock programlisting"><div class=content><pre>DISTFILES=	source1.tar.gz source2.tar.gz</pre></div></div><div class=paragraph><p>Если переменная <code>DISTFILES</code> не задана явно, то её значением по умолчанию будет <code>${DISTNAME}${EXTRACT_SUFX}</code>.</p></div></div><div class=sect2><h3 id=_extract_only>5.4.5. <code>EXTRACT_ONLY</code><a class=anchor href=#_extract_only></a></h3><div class=paragraph><p>Если только некоторые из <code>DISTFILES</code> должны быть распакованы-к примеру, часть из них является исходным кодом, а другие представляют собой неупакованную документацию-перечислите имена файлов, которые должны быть распакованы, в <code>EXTRACT_ONLY</code>.</p></div><div class="literalblock programlisting"><div class=content><pre>DISTFILES=	source.tar.gz manual.html
EXTRACT_ONLY=	source.tar.gz</pre></div></div><div class=paragraph><p>Если <em>ни один</em> из <code>DISTFILES</code> не должен распаковываться, то установите пустое значение переменной <code>EXTRACT_ONLY</code>.</p></div><div class="literalblock programlisting"><div class=content><pre>EXTRACT_ONLY=</pre></div></div></div><div class=sect2><h3 id=porting-patchfiles>5.4.6. <code>PATCHFILES</code><a class=anchor href=#porting-patchfiles></a></h3><div class=paragraph><p>Если вашему порту требуются некоторых дополнительные патчи, которые доступны по FTP или HTTP, задайте имена этих файлов в переменной <code>PATCHFILES</code>, а в переменной <code>PATCH_SITES</code> укажите URL того каталога, в котором они содержатся (формат такой же, как для <code>MASTER_SITES</code>).</p></div><div class=paragraph><p>Если патч не относится к самому верху дерева исходных текстов (то есть <code>WRKSRC</code>), потому что он содержит некоторые дополнительные пути, установите соответственно значение переменной <code>PATCH_DIST_STRIP</code>. В частности, если все имена путей в патче имеют дополнительный путь <code>foozolix-1.0/</code> перед именем файла, то задайте <code>PATCH_DIST_STRIP=-p1</code>.</p></div><div class=paragraph><p>Не волнуйтесь, если патчи упакованы; они будут распакованы автоматически, если имена файлов оканчиваются на <span class=filename>.gz</span> или <span class=filename>.Z</span>.</p></div><div class=paragraph><p>Если патч распространяется вместе с какими-то другими файлами, такими, как документация, в виде tar-архива <code>gzip</code>, вы не можете просто использовать <code>PATCHFILES</code>. Если это ваш случай, добавьте имя и местоположение архива с патчем к <code>DISTFILES</code> и <code>MASTER_SITES</code>. Затем воспользуйтесь переменной <code>EXTRA_PATCHES</code> для указания этих файлов, и <span class=filename>bsd.port.mk</span> автоматически применит эти патчи. В частности, <em>не копируйте</em> файлы с патчами в каталог <code>PATCHDIR</code>-этот каталог может быть недоступным для записи.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Архив будет распакован вне исходного кода, как обычно, и к тому же его не нужно явно распаковывать, если это обычный архив <code>gzip</code> или <code>compress</code>. Если вы сделаете последнее, приложите дополнительные усилия для того, чтобы не перезаписать что-либо, уже существующее в этом каталоге. Также не забудьте добавить команду для удаления скопированного патча в цели <code>pre-clean</code>.</p></div></td></tr></tbody></table></div></div><div class=sect2><h3 id=porting-master-sites-n>5.4.7. Несколько дистрибутивных файлов или патчей с различных серверов и подкаталогов (<code>MASTER_SITES:n</code>)<a class=anchor href=#porting-master-sites-n></a></h3><div class=paragraph><p>(Этот раздел можно считать немного "повышенной трудности"; те, кто впервые знакомятся с этим текстом, могут пропустить этот раздел).</p></div><div class=paragraph><p>В этом разделе находится информация о механизме сгрузки, известном как <code>MASTER_SITES:n</code> и <code>MASTER_SITES_NN</code>. Далее мы будем называть этот механизм <code>MASTER_SITES:n</code>.</p></div><div class=paragraph><p>Сначала немного общей информации. В OpenBSD имеется полезная возможность, используемая в переменных <code>DISTFILES</code> и <code>PATCHFILES</code>, которая позволяет закреплять после имен файлов и патчей идентификаторы типа <code>:n</code>. Здесь <code>n</code> может быть из диапазона <code>[0-9]</code> и обозначать закреплённую группу. К примеру:</p></div><div class="literalblock programlisting"><div class=content><pre>DISTFILES=	alpha:0 beta:1</pre></div></div><div class=paragraph><p>В OpenBSD дистрибутивный файл <span class=filename>alpha</span> будет связан с переменной <code>MASTER_SITES0</code>, но не с нашей общей переменной <code>MASTER_SITES</code>, а файл <span class=filename>beta</span> с переменной <code>MASTER_SITES1</code>.</p></div><div class=paragraph><p>Этот очень интересная возможность, которая может уменьшить этот бесконечный поиск работающего сайта для сгрузки.</p></div><div class=paragraph><p>Просто представьте себе 2 файла в <code>DISTFILES</code> и 20 сайтов в <code>MASTER_SITES</code>; сайты очень медленные, причём <span class=filename>beta</span> находится на всех сайтах из <code>MASTER_SITES</code>, а <span class=filename>alpha</span> может быть найден только на 20-м сайте. Будет неправильно проверять их все, если создатель знает об этом, не правда ли? Неподходящее начало для таких прекрасных выходных!</p></div><div class=paragraph><p>Теперь, когда вы получили общее представление, просто представьте ещё большее количество <code>DISTFILES</code> и <code>MASTER_SITES</code>. Конечно, наш "магистр доступности дистрибутивов" представляет масштабы нагрузки на сеть, которую это даёт.</p></div><div class=paragraph><p>В последующих разделах информация будет даваться вместе с реализацией этой идеи во FreeBSD. Мы несколько улучшили концепцию OpenBSD.</p></div><div class=sect3><h4 id=_упрощённая_информация>5.4.7.1. Упрощённая информация<a class=anchor href=#_упрощённая_информация></a></h4><div class=paragraph><p>В этом разделе рассказывается, как быстро подготовить точную сгрузку нескольких дистрибутивных файлов и патчей с разных сайтов и каталогов. Мы описываем здесь случай упрощённого использования <code>MASTER_SITES:n</code>. Для большинства сценариев этого будет достаточно. Однако, если вам нужна дополнительная информация, обратитесь к следующему разделу.</p></div><div class=paragraph><p>Некоторые приложения состоят из многих дистрибутивных файлов, которые должны быть сгружены с нескольких различных сайтов. К примеру, Ghostscript состоит из основной программы и большого числа файлов драйверов, которые используются в зависимости от принтера пользователя. Некоторые из этих файлов драйверов поставляются с основной программой, но при этом многие другие должны быть сгружены с множества различных сайтов.</p></div><div class=paragraph><p>Чтобы это поддерживать, за каждой записью в <code>DISTFILES</code> может следовать символ двоеточия и "имя метки". За каждым сайтом, перечисленным в <code>MASTER_SITES</code>, тоже следует двоеточие и метка, которая указывает, какие файлы дистрибутива должны быть сгружены с этого сайта.</p></div><div class=paragraph><p>Например, рассмотрим приложение, исходный код которого разделён на две части, <span class=filename>source1.tar.gz</span> и <span class=filename>source2.tar.gz</span>, которые должны быть сгружены с двух различных источников. Файл <span class=filename>Makefile</span> порта будет содержать строчки типа <a href=#ports-master-sites-n-example-simple-use-one-file-per-site>Упрощённое использование <code>MASTER_SITES:n</code> с 1 файлом на каждом сайте</a>.</p></div><div id=ports-master-sites-n-example-simple-use-one-file-per-site class=exampleblock><div class=title>Пример 1. Упрощённое использование <code>MASTER_SITES:n</code> с 1 файлом на каждом сайте</div><div class=content><div class="literalblock programlisting"><div class=content><pre>MASTER_SITES=	ftp://ftp.example1.com/:source1 \
		ftp://ftp.example2.com/:source2
DISTFILES=	source1.tar.gz:source1 \
		source2.tar.gz:source2</pre></div></div></div></div><div class=paragraph><p>Несколько дистрибутивных файлов могут иметь одну и ту же метку. Продолжая предыдущий пример, положим, что имеется и третий дистрибутивный файл, <span class=filename>source3.tar.gz</span>, который должен быть сгружен с <code>ftp.example2.com</code>. Тогда файл <span class=filename>Makefile</span> будет написан как <a href=#ports-master-sites-n-example-simple-use-more-than-one-file-per-site>Упрощённое использование <code>MASTER_SITES:n</code> с более чем 1 файлом на каждом сервере</a>.</p></div><div id=ports-master-sites-n-example-simple-use-more-than-one-file-per-site class=exampleblock><div class=title>Пример 2. Упрощённое использование <code>MASTER_SITES:n</code> с более чем 1 файлом на каждом сервере</div><div class=content><div class="literalblock programlisting"><div class=content><pre>MASTER_SITES=	ftp://ftp.example1.com/:source1 \
		ftp://ftp.example2.com/:source2
DISTFILES=	source1.tar.gz:source1 \
		source2.tar.gz:source2 \
		source3.tar.gz:source2</pre></div></div></div></div></div><div class=sect3><h4 id=_подробная_информация>5.4.7.2. Подробная информация<a class=anchor href=#_подробная_информация></a></h4><div class=paragraph><p>Прекрасно, но пример из предыдущего раздела не показал вам всё, что вам нужно? В этом разделе мы подробно опишем, как работает механизм <code>MASTER_SITES:n</code> точной сгрузки и как вы можете изменить ваши порты, чтобы это использовать.</p></div><div class="olist arabic"><ol class=arabic><li><p>За элементами могут следовать символы <code>:n</code>, где <em>n</em> это <code><span class=^:>`, то есть _n_ может теоретически быть любой алфавитно-цифровой строкой, но пока мы будем ограничивать их `[a-zA-Z_][0-9a-zA-Z_]</span></code>.</p><div class=paragraph><p>Более того, совпадение строк чувствительно к регистру; другими словами, <code>n</code> отличается от <code>N</code>.</p></div><div class=paragraph><p>Однако следующие слова не могут использоваться для этих нужд, так как они имеют особое значение: <code>default</code>, <code>all</code> и <code>ALL</code> (они используются для своих нужд в <a href=#porting-master-sites-n-what-changes-in-port-targets>ii</a>). Кроме того, <code>DEFAULT</code> является специальным ключевым словом (посмотрите <a href=#porting-master-sites-n-DEFAULT-group>3</a>).</p></div></li><li><p>Элементы, за которыми следуют <code>:n</code>, принадлежат группе <code>n</code>, <code>:m</code> относится к группе <code>m</code> и так далее.</p></li><li><p>Элементы без таких суффиксов не относятся ни к какой группе, то есть они принадлежат к особой группе <code>DEFAULT</code>. Если вы укажете суффиксом любого элемента <code>DEFAULT</code>, вы просто выполните излишнюю работу, если только вы не хотите отнесения элемента как к группе <code>DEFAULT</code>, так и какой-то другой в одно и то же время (посмотрите на пункт <a href=#porting-master-sites-n-comma-operator>5</a>).</p><div class=paragraph><p>Следующие примеры равнозначны, но первый более предпочтителен:</p></div><div class="literalblock programlisting"><div class=content><pre>MASTER_SITES=	alpha</pre></div></div><div class="literalblock programlisting"><div class=content><pre>MASTER_SITES=	alpha:DEFAULT</pre></div></div></li><li><p>Группы не являются эксклюзивными, элемент может принадлежать к нескольким отличающимся группам одновременно, а группа может либо иметь несколько различных элементов, либо не иметь их вовсе. Повторяющиеся элементы в одной и той же группе будут являться просто повторяющимися элементами.</p></li><li><p>Если в хотите, чтобы элемент принадлежал к нескольким группам одновременно, вы можете использовать запятую (<code>,</code>).</p><div class=paragraph><p>Вместо того, чтобы повторять их несколько раз, каждый раз с разным постфиксом, мы можем перечислить несколько групп за раз в одном постфиксе. Например, <code>:m,n,o</code> определяет элемент, принадлежащий группам <code>m</code>, <code>n</code> и <code>o</code>.</p></div><div class=paragraph><p>Все следующие примеры имеют один смысл, но последний является предпочтительным:</p></div><div class="literalblock programlisting"><div class=content><pre>MASTER_SITES=	alpha alpha:SOME_SITE</pre></div></div><div class="literalblock programlisting"><div class=content><pre>MASTER_SITES=	alpha:DEFAULT alpha:SOME_SITE</pre></div></div><div class="literalblock programlisting"><div class=content><pre>MASTER_SITES=	alpha:SOME_SITE,DEFAULT</pre></div></div><div class="literalblock programlisting"><div class=content><pre>MASTER_SITES=	alpha:DEFAULT,SOME_SITE</pre></div></div></li><li><p>Все серверы внутри определённой группы сортируются в соответствии с <code>MASTER_SORT_AWK</code>. Все группы в <code>MASTER_SITES</code> и <code>PATCH_SITES</code> тоже сортируются.</p></li><li><p>Семантика групп может использоваться в любой из следующих переменных <code>MASTER_SITES</code>, <code>PATCH_SITES</code>, <code>MASTER_SITE_SUBDIR</code>, <code>PATCH_SITE_SUBDIR</code>, <code>DISTFILES</code> и <code>PATCHFILES</code> в соответствии со следующим синтаксисом:</p><div class="olist loweralpha"><ol class=loweralpha type=a><li><p>Все элементы <code>MASTER_SITES</code>, <code>PATCH_SITES</code>, <code>MASTER_SITE_SUBDIR</code> и <code>PATCH_SITE_SUBDIR</code> должны заканчиваться символом прямого слэша <code>/</code>. Если какие-то элементы принадлежат каким-то группам, постфикс группы <code>:n</code> должен следовать сразу после завершающего символа <code>/</code>. Механизм <code>MASTER_SITES:n</code> опирается на наличие завершающего символа <code>/</code> во избежание совпадающих элементов, где <code>:n</code> является корректной частью элемента с вхождениями, где <code>:n</code> обозначает группу <code>n</code>. Для целей совместимости, так как завершающий символ <code>/</code> ранее не требовался в элементах <code>MASTER_SITE_SUBDIR</code> и <code>PATCH_SITE_SUBDIR</code>, если символ, сразу предшествующий постфиксу, не является символом <code>/</code>, то <code>:n</code> будет считаться корректной частью элемента, а не постфиксом группы, даже если за элементом следует <code>:n</code>. Посмотрите <a href=#ports-master-sites-n-example-detailed-use-master-site-subdir>Подробное использование <code>MASTER_SITES:n</code> в <code>MASTER_SITE_SUBDIR</code></a> и <a href=#ports-master-sites-n-example-detailed-use-complete-example-master-sites>Подробное использование <code>MASTER_SITES:n</code> с запятыми, несколькими файлами, несколькими серверами и несколькими подкаталогами</a>.</p><div id=ports-master-sites-n-example-detailed-use-master-site-subdir class=exampleblock><div class=title>Пример 3. Подробное использование <code>MASTER_SITES:n</code> в <code>MASTER_SITE_SUBDIR</code></div><div class=content><div class="literalblock programlisting"><div class=content><pre>MASTER_SITE_SUBDIR=	old:n new/:NEW</pre></div></div><div class=ulist><ul><li><p>Каталоги внутри группы <code>DEFAULT</code> → old:n</p></li><li><p>Каталоги внутри группы <code>NEW</code> → new</p></li></ul></div></div></div><div id=ports-master-sites-n-example-detailed-use-complete-example-master-sites class=exampleblock><div class=title>Пример 4. Подробное использование <code>MASTER_SITES:n</code> с запятыми, несколькими файлами, несколькими серверами и несколькими подкаталогами</div><div class=content><div class="literalblock programlisting"><div class=content><pre>MASTER_SITES=	http://site1/%SUBDIR%/ http://site2/:DEFAULT \
		http://site3/:group3 http://site4/:group4 \
		http://site5/:group5 http://site6/:group6 \
		http://site7/:DEFAULT,group6 \
		http://site8/%SUBDIR%/:group6,group7 \
		http://site9/:group8
DISTFILES=	file1 file2:DEFAULT file3:group3 \
		file4:group4,group5,group6 file5:grouping \
		file6:group7
MASTER_SITE_SUBDIR=	directory-trial:1 directory-n/:groupn \
			directory-one/:group6,DEFAULT \
			directory</pre></div></div><div class=paragraph><p>Предыдущий пример приводит к следующей точной сгрузке. Серверы перечислены в точном порядке их использования.</p></div><div class=ulist><ul><li><p><span class=filename>file1</span> будет сгружаться с</p><div class=ulist><ul><li><p><code>MASTER_SITE_OVERRIDE</code></p></li><li><p><a href=http://site1/directory-trial:1/ class=bare>http://site1/directory-trial:1/</a></p></li><li><p><a href=http://site1/directory-one/ class=bare>http://site1/directory-one/</a></p></li><li><p><a href=http://site1/directory/ class=bare>http://site1/directory/</a></p></li><li><p><a href=http://site2/ class=bare>http://site2/</a></p></li><li><p><a href=http://site7/ class=bare>http://site7/</a></p></li><li><p><code>MASTER_SITE_BACKUP</code></p></li></ul></div></li><li><p><span class=filename>file2</span> будет сгружаться точно также, как <span class=filename>file1</span>, так как они оба относятся к одной и той же группе</p><div class=ulist><ul><li><p><code>MASTER_SITE_OVERRIDE</code></p></li><li><p><a href=http://site1/directory-trial:1/ class=bare>http://site1/directory-trial:1/</a></p></li><li><p><a href=http://site1/directory-one/ class=bare>http://site1/directory-one/</a></p></li><li><p><a href=http://site1/directory/ class=bare>http://site1/directory/</a></p></li><li><p><a href=http://site2/ class=bare>http://site2/</a></p></li><li><p><a href=http://site7/ class=bare>http://site7/</a></p></li><li><p><code>MASTER_SITE_BACKUP</code></p></li></ul></div></li><li><p><span class=filename>file3</span> будет сгружен с</p><div class=ulist><ul><li><p><code>MASTER_SITE_OVERRIDE</code></p></li><li><p><a href=http://site3/ class=bare>http://site3/</a></p></li><li><p><code>MASTER_SITE_BACKUP</code></p></li></ul></div></li><li><p><span class=filename>file4</span> будет сгружаться с</p><div class=ulist><ul><li><p><code>MASTER_SITE_OVERRIDE</code></p></li><li><p><a href=http://site4/ class=bare>http://site4/</a></p></li><li><p><a href=http://site5/ class=bare>http://site5/</a></p></li><li><p><a href=http://site6/ class=bare>http://site6/</a></p></li><li><p><a href=http://site7/ class=bare>http://site7/</a></p></li><li><p><a href=http://site8/directory-one/ class=bare>http://site8/directory-one/</a></p></li><li><p><code>MASTER_SITE_BACKUP</code></p></li></ul></div></li><li><p><span class=filename>file5</span> будет сгружен с</p><div class=ulist><ul><li><p><code>MASTER_SITE_OVERRIDE</code></p></li><li><p><code>MASTER_SITE_BACKUP</code></p></li></ul></div></li><li><p><span class=filename>file6</span> будет сгружаться с</p><div class=ulist><ul><li><p><code>MASTER_SITE_OVERRIDE</code></p></li><li><p><a href=http://site8/ class=bare>http://site8/</a></p></li><li><p><code>MASTER_SITE_BACKUP</code></p></li></ul></div></li></ul></div></div></div></li></ol></div></li><li><p>Как мне группировать одну из специальных переменных из <span class=filename>bsd.sites.mk</span>, например, <code>MASTER_SITE_SOURCEFORGE</code>?</p><div class=paragraph><p>Посмотрите <a href=#ports-master-sites-n-example-detailed-use-master-site-sourceforge>Подробное использование <code>MASTER_SITES:n</code> с <code>MASTER_SITE_SOURCEFORGE</code></a>.</p></div><div id=ports-master-sites-n-example-detailed-use-master-site-sourceforge class=exampleblock><div class=title>Пример 5. Подробное использование <code>MASTER_SITES:n</code> с <code>MASTER_SITE_SOURCEFORGE</code></div><div class=content><div class="literalblock programlisting"><div class=content><pre>MASTER_SITES=	http://site1/ ${MASTER_SITE_SOURCEFORGE:S/$/:sourceforge,TEST/}
DISTFILES=	something.tar.gz:sourceforge</pre></div></div></div></div><div class=paragraph><p><span class=filename>something.tar.gz</span> будет сгружаться со всех сайтов из <code>MASTER_SITE_SOURCEFORGE</code>.</p></div></li><li><p>Как мне использовать это с переменными <code>PATCH*</code>?</p><div class=paragraph><p>Все примеры выполнялись с переменными <code>MASTER*</code>, и они работают точно так же и для <code>PATCH*</code>, как это можно видеть в <a href=#ports-master-sites-n-example-detailed-use-patch-sites>Упрощённое использование <code>MASTER_SITES:n</code> с <code>PATCH_SITES</code>.</a>.</p></div><div id=ports-master-sites-n-example-detailed-use-patch-sites class=exampleblock><div class=title>Пример 6. Упрощённое использование <code>MASTER_SITES:n</code> с <code>PATCH_SITES</code>.</div><div class=content><div class="literalblock programlisting"><div class=content><pre>PATCH_SITES=	http://site1/ http://site2/:test
PATCHFILES=	patch1:test</pre></div></div></div></div></li></ol></div></div><div class=sect3><h4 id=_что_изменится_для_портов_а_что_не_изменится>5.4.7.3. Что изменится для портов? А что не изменится?<a class=anchor href=#_что_изменится_для_портов_а_что_не_изменится></a></h4><div class="olist lowerroman"><ol class=lowerroman type=i><li><p>Все имеющиеся порты остаются без изменений. Код для механизма <code>MASTER_SITES:n</code> активируется, если только есть элементы, которые заканчиваются на <code>:n</code>, как и элементы в соответствии с вышеописанным синтаксисом, особенно как это показано в пункте <a href=#porting-master-sites-n-group-semantics>7</a>.</p></li><li><p>Цели порт остаются теми же самыми: <code>checksum</code>, <code>makesum</code>, <code>patch</code>, <code>configure</code>, <code>build</code> и так далее. С обычными исключениями для <code>do-fetch</code>, <code>fetch-list</code>, <code>master-sites</code> и <code>patch-sites</code>.</p><div class=ulist><ul><li><p><code>do-fetch</code>: использует новую группировку с постфиксами в <code>DISTFILES</code> и <code>PATCHFILES</code> с соответствующими элементами групп в <code>MASTER_SITES</code> и <code>PATCH_SITES</code>, которые используют группы из <code>MASTER_SITE_SUBDIR</code> и <code>PATCH_SITE_SUBDIR</code>. Посмотрите <a href=#ports-master-sites-n-example-detailed-use-complete-example-master-sites>Подробное использование <code>MASTER_SITES:n</code> с запятыми, несколькими файлами, несколькими серверами и несколькими подкаталогами</a>.</p></li><li><p><code>fetch-list</code>: работает так же, как старая цель <code>fetch-list</code> с тем исключением, что она группирует, как и <code>do-fetch</code>.</p></li><li><p><code>master-sites</code> и <code>patch-sites</code>: (несовместимы со старыми версиями) только возвращают элементы группы <code>DEFAULT</code>; на самом деле они выполняют цели <code>master-sites-default</code> и <code>patch-sites-default</code> соответственно.</p><div class=paragraph><p>Более того, использование целей <code>master-sites-all</code> или <code>patch-sites-all</code> предпочтительно для непосредственной проверки <code>MASTER_SITES</code> или <code>PATCH_SITES</code>. Также работа прямой проверки в последующих версиях не гарантируется. Посмотрите <a href=#porting-master-sites-n-new-port-targets-master-sites-all>B</a> для получения более дополнительной информации об этих новых целях.</p></div></li></ul></div></li><li><p>Новые цели построения портов</p><div class="olist loweralpha"><ol class=loweralpha type=a><li><p>Имеются цели <code>master-sites-<em>n</em></code> и <code>patch-sites-<em>n</em></code>, которые будут перечислять элементы соответствующей группы <em>n</em> из <code>MASTER_SITES</code> и <code>PATCH_SITES</code> соответственно. К примеру, <code>master-sites-DEFAULT</code> и <code>patch-sites-DEFAULT</code> обе будут возвращать элементы группы <code>DEFAULT</code>, <code>master-sites-test</code> и <code>patch-sites-test</code> группы <code>test</code> и так далее.</p></li><li><p>Имеются новые цели <code>master-sites-all</code> и <code>patch-sites-all</code>, которые выполняют работу старых <code>master-sites</code> и <code>patch-sites</code>. Они возвращают элементы всех групп, как если бы они все принадлежали одной и той же группе с тем, что она перечисляет ровно столько <code>MASTER_SITE_BACKUP</code> и <code>MASTER_SITE_OVERRIDE</code>, как и группы, определённые в <code>DISTFILES</code> или <code>PATCHFILES</code>; соответственно для <code>master-sites-all</code> и <code>patch-sites-all</code>.</p></li></ol></div></li></ol></div></div></div><div class=sect2><h3 id=_dist_subdir>5.4.8. <code>DIST_SUBDIR</code><a class=anchor href=#_dist_subdir></a></h3><div class=paragraph><p>Не позволяйте вашему порту засорять <span class=filename>/usr/ports/distfiles</span>. Если вашему порту требуется сгрузить много файлов, или он содержит имя файла, могущее вызвать конфликты с другими портами (например, <span class=filename>Makefile</span>), то укажите в переменной <code>DIST_SUBDIR</code> имя порта (должны подойти <code>${PORTNAME}</code> или <code>${PKGNAMEPREFIX}${PORTNAME}</code>). Это изменит значение переменной <code>DISTDIR</code> со значения по умолчанию <span class=filename>/usr/ports/distfiles</span> к значению <span class=filename>/usr/ports/distfiles/DIST_SUBDIR</span>, и в результате всё, что требуется для порта, будет помещено в этот подкаталог.</p></div><div class=paragraph><p>Он заглянет также в подкаталог с тем же именем на основном резервном сервере <span class=filename>ftp.FreeBSD.org</span>. (Явное задание переменной <code>DISTDIR</code> в вашем файле <code>Makefile</code> этого не сделает, так что, пожалуйста, воспользуйтесь <code>DIST_SUBDIR</code>.)</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Это не коснётся тех сайтов <code>MASTER_SITES</code>, которые вы указали в вашем файле <span class=filename>Makefile</span>.</p></div></td></tr></tbody></table></div></div><div class=sect2><h3 id=_always_keep_distfiles>5.4.9. <code>ALWAYS_KEEP_DISTFILES</code><a class=anchor href=#_always_keep_distfiles></a></h3><div class=paragraph><p>Если ваш порт использует двоичные дистрибутивные файлы и обладает лицензией, требующей, чтобы исходный код предоставлялся вместе с пакетами, распространяемыми в двоичной форме, например GPL, то <code>ALWAYS_KEEP_DISTFILES</code> даст кластеру построения FreeBSD указание сохранять копию файлов, указанных в <code>DISTFILES</code>. Пользователям таких портов эти файлы в основном не нужны, поэтому хорошей идеей является добавление в <code>DISTFILES</code> исходных дистрибутивных файлов, только когда определена переменная <code>PACKAGE_BUILDING</code>.</p></div><div id=ports-master-sites-n-example-always-keep-distfiles class=exampleblock><div class=title>Пример 7. Использование <code>ALWAYS_KEEP_DISTFILES</code>.</div><div class=content><div class="literalblock programlisting"><div class=content><pre>.if defined(PACKAGE_BUILDING)
DISTFILES+=		foo.tar.gz
ALWAYS_KEEP_DISTFILES=	yes
.endif</pre></div></div></div></div><div class=paragraph><p>При добавлении дополнительных файлов в <code>DISTFILES</code> убедитесь, что вы их также добавляете в <span class=filename>distinfo</span>. Кроме того, дополнительные файлы обычно распаковываются также в <code>WRKDIR</code>, что для некоторых портов может вызывать нежелательные подобные эффекты и требовать особую обработку.</p></div></div></div></div><div class=sect1><h2 id=makefile-maintainer>5.5. <code>MAINTAINER</code><a class=anchor href=#makefile-maintainer></a></h2><div class=sectionbody><div class=paragraph><p>Укажите здесь ваш адрес электронной почты. Пожалуйста. <em>:-)</em></p></div><div class=paragraph><p>Заметьте, что в качестве значения для <code>MAINTAINER</code> допустимо использование только одного адреса без поля комментария. Должен использоваться формат <code>user@hostname.domain</code>. Пожалуйста, не включайте никакого описательного текста, например, вашего настоящего имени в эту строку-это несколько сбивает с толку <span class=filename>bsd.port.mk</span>.</p></div><div class=paragraph><p>Сопровождающий ответственен за поддержание порта в актуальном состоянии и обеспечение правильной работы порта. За подробным описанием обязанностей сопровождающего порт обращайтесь к главе <a href=https://docs.freebsd.org/ru/articles/contributing/#maintain-port>The challenge for port maintainers</a>.</p></div><div class=paragraph><p>Перед фиксацией в репозитории изменения в порте будут отправлены сопровождающему для просмотра и одобрения. Если сопровождающий порта не ответил на запрос пользователя об обновлении в течение двух недель (исключая большие праздники), то это можно считать тайм-аутом сопровождающего, и обновление может быть выполнено без явного подтверждения от сопровождающего. Если сопровождающий не отвечает в течение трёх месяцев, то считается, что он отсутствует, и как сопровождающий порта, о котором идёт речь, может быть заменён. Исключениями из этого правила является всё, что сопровождает Группа Менеджеров Дерева Портов FreeBSD &lt;<a href=mailto:portmgr@FreeBSD.org>portmgr@FreeBSD.org</a>> или Группа Офицеров Безопасности &lt;<a href=mailto:security-officer@FreeBSD.org>security-officer@FreeBSD.org</a>>. Запрещено делать любые несанкционированные изменения в портах, которые ведут эти группы.</p></div><div class=paragraph><p>Мы оставляем за собой право изменять сообщение сопровождающего для лучшего соответствия существующим политикам и стилю Коллекции Портов без явного одобрения со стороны отправителя. Также, крупные изменения в инфраструктуре могут повлечь изменения в порте без согласия сопровождающего. Такой вид изменений никогда не будет затрагивать функциональность порта.</p></div><div class=paragraph><p>За Группа Менеджеров Дерева Портов FreeBSD &lt;<a href=mailto:portmgr@FreeBSD.org>portmgr@FreeBSD.org</a>> оставляется право снять или назначить кого-либо сопровождающим по любой причине, а за Группа Офицеров Безопасности &lt;<a href=mailto:security-officer@FreeBSD.org>security-officer@FreeBSD.org</a>> оставляется право лишать или назначать права на сопровождение порта по соображениям информационной безопасности.</p></div></div></div><div class=sect1><h2 id=makefile-comment>5.6. <code>COMMENT</code><a class=anchor href=#makefile-comment></a></h2><div class=sectionbody><div class=paragraph><p>Содержит однострочное описание порта. Пожалуйста, соблюдайте следующие правила:</p></div><div class="olist arabic"><ol class=arabic><li><p>Старайтесь делать строку COMMENT длиной не больше, чем 70 символов, так как эта строка будет использована командой <code>pkg info</code> (см. <a href="https://man.freebsd.org/cgi/man.cgi?query=pkg-info&amp;sektion=8&amp;format=html">pkg-info(8)</a>) для отображения однострочного описания порта;</p></li><li><p><em>Не</em> включайте сюда название пакета (или номер версии программного обеспечения);</p></li><li><p>Комментарий должен начинаться с заглавной буквы и не заканчиваться точкой;</p></li><li><p>Не начинайте комментарий с неопределённого артикля (A или An);</p></li><li><p>Имена пишутся с заглавной буквы (например, Apache, JavaScript, Perl);</p></li><li><p>Для перечислений используйте английскую Оксфордскую запятую (англ. Oxford comma) (например, green, red, and blue);</p></li><li><p>Используйте программу проверки орфографии.</p></li></ol></div><div class=paragraph><p>Вот пример:</p></div><div class="literalblock programlisting"><div class=content><pre>COMMENT=	Cat chasing a mouse all over the screen</pre></div></div><div class=paragraph><p>В файле <span class=filename>Makefile</span> переменная COMMENT должна следовать сразу за переменной MAINTAINER.</p></div></div></div><div class=sect1><h2 id=makefile-portscout>5.7. <code>PORTSCOUT</code><a class=anchor href=#makefile-portscout></a></h2><div class=sectionbody><div class=paragraph><p>Portscout являет собой автоматизированное средство проверки доступности дистрибутивных файлов для Коллекции Портов FreeBSD, подробное описание которого предоставляет <a href=../keeping-up/#distfile-survey>Portscout: сканер дистрибутивных файлов портов FreeBSD</a>.</p></div><div class=paragraph><p>Переменная <code>PORTSCOUT</code> задаёт специальные условия, ограничивающие работу Portscout - сканера дистрибутивных файлов.</p></div><div class=paragraph><p>Ситуации, при которых следует указывать переменную <code>PORTSCOUT</code>:</p></div><div class=ulist><ul><li><p>Когда должны игнорироваться дистрибутивные файлы для конкретных версий или младших ревизий. Например, чтобы исключить из проверок новых версий дистрибутивных файлов версию <em>8.2</em> по причине того, что она является поломанной, добавьте следующее:</p><div class="literalblock programlisting"><div class=content><pre>PORTSCOUT=	ignore:8.2</pre></div></div></li><li><p>Когда должны проверяться конкретные версии или старшие и младшие ревизии дистрибутивных файлов. Например, если следует ограничиться проверкой версии <em>0.6.4</em>, потому что более новые версии имеют проблемы совместимости с FreeBSD, добавьте:</p><div class="literalblock programlisting"><div class=content><pre>PORTSCOUT=	limit:^0\.6\.4</pre></div></div></li><li><p>Когда URL, в которых указаны доступные версии, отличаются от URL их загрузки. Например, чтобы привязать проверку новых версий дистрибутивных файлов к странице загрузки для порта <a class=package href=https://cgit.freebsd.org/ports/tree/databases/pgtune/>databases/pgtune</a>, добавьте:</p><div class="literalblock programlisting"><div class=content><pre>PORTSCOUT=	site:http://pgfoundry.org/frs/?group_id=1000416</pre></div></div></li></ul></div></div></div><div class=sect1><h2 id=makefile-depend>5.8. Зависимости<a class=anchor href=#makefile-depend></a></h2><div class=sectionbody><div class=paragraph><p>Многие порты зависят от других портов. Это очень удобная замечательная особенность большинства Unix-подобных операционных систем, включая FreeBSD. Множество портов могут использовать общую зависимость совместно, а не включать её в состав каждого порта или пакета, который в ней нуждается. Имеется семь переменных, которые вы можете использовать для обеспечения того, что всё требуемое находится на машине пользователя. Имеется также несколько предопределённых переменных, отражающих зависимости для общих случаев, плюс ещё несколько для управления поведением зависимостей.</p></div><div class=sect2><h3 id=_lib_depends>5.8.1. <code>LIB_DEPENDS</code><a class=anchor href=#_lib_depends></a></h3><div class=paragraph><p>Эта переменная указывает, от каких совместно используемых библиотек зависит порт. Это список пар lib:dir, где <em>lib</em> - это имя библиотеки, <em>dir</em> - это каталог, в котором можно ее найти в случае, если ее нет на машине. Например,</p></div><div class="literalblock programlisting"><div class=content><pre>LIB_DEPENDS=	libjpeg.so:${PORTSDIR}/graphics/jpeg</pre></div></div><div class=paragraph><p>проверит наличие библиотеки jpeg с любым номером версии и перейдет в подкаталог <span class=filename>graphics/jpeg</span> вашего дерева портов для ее построения и установки, если библиотека отсутствует.</p></div><div class=paragraph><p>Зависимость проверяется дважды, один раз внутри цели <code>build</code>, а затем из цели <code>install</code>. Кроме того, имя зависимости помещается в пакет, так что <code>pkg install</code> (см. <a href="https://man.freebsd.org/cgi/man.cgi?query=pkg-install&amp;sektion=8&amp;format=html">pkg-install(8)</a>) будет автоматически её устанавливать, если её нет на пользовательской системе.</p></div></div><div class=sect2><h3 id=_run_depends>5.8.2. <code>RUN_DEPENDS</code><a class=anchor href=#_run_depends></a></h3><div class=paragraph><p>В этой переменной перечисляются выполнимые файлы или файлы, от которых зависит работа порта. Это список пар вида path:dir:target, где <em>path</em> - это имя программы или файла, а <em>dir</em> - каталог, в котором можно найти порт в случае, если его нет в системе, и <em>target</em> - это цель, которую нужно вызвать в этом каталоге. Если <em>path</em> начинается со слэша (<code>/</code>), он воспринимается как файл и его существование проверяется командой <code>test -e</code>; в противном случае предполагается, что это выполнимый файл, и для определения того, имеется ли программа в пути поиска, используется команда <code>which -s</code>.</p></div><div class=paragraph><p>Например,</p></div><div class="literalblock programlisting"><div class=content><pre>RUN_DEPENDS=	${LOCALBASE}/news/bin/innd:${PORTSDIR}/news/inn \
		xmlcatmgr:${PORTSDIR}/textproc/xmlcatmgr</pre></div></div><div class=paragraph><p>проверит существование файла или каталога <span class=filename>/usr/local/news/bin/innd</span>, и если ничего не будет найдено, то построит и установит порт из подкаталога <span class=filename>news/inn</span> дерева портов. Также будет выполнена проверка, присутствует ли в пути поиска исполняемый файл с именем <code>xmlcatmgr</code>, и перейдет в подкаталог <span class=filename>textproc/xmlcatmgr</span> вашего дерева портов для его построения и установки, если он не будет найден.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>В приведенном примере <code>innd</code> является выполнимым файлом; если выполнимый файл находится в месте, которое отсутствует в списке путей файлов, то вы должны указать полный путь к файлу.</p></div></td></tr></tbody></table></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Официальным значением переменной поиска <code>PATH</code>, используемым в кластере построения портов является</p></div><div class="literalblock programlisting"><div class=content><pre>/sbin:/bin:/usr/sbin:/usr/bin:/usr/local/sbin:/usr/local/bin</pre></div></div></td></tr></tbody></table></div><div class=paragraph><p>Зависимость проверяется внутри цели <code>install</code>. Кроме того, имя зависимости помещается в пакет, так что <code>pkg install</code> (см. <a href="https://man.freebsd.org/cgi/man.cgi?query=pkg-install&amp;sektion=8&amp;format=html">pkg-install(8)</a>) будет автоматически его устанавливать, если он не будет найден в пользовательской системе. Часть <em>target</em> может быть опущена, если она совпадает с <code>DEPENDS_TARGET</code>.</p></div><div class=paragraph><p>Довольно распространенной является ситуация, когда <code>RUN_DEPENDS</code> буквально такая же как <code>BUILD_DEPENDS</code>, особенно если переносимое программное обеспечение написано на языке сценариев, или если оно требует такое же окружение для исполнения, как и используемое во время построения. В этом случае, очень заманчивым или довольно естественным является присвоение одного другому:</p></div><div class="literalblock programlisting"><div class=content><pre>RUN_DEPENDS=	${BUILD_DEPENDS}</pre></div></div><div class=paragraph><p>Тем не менее, подобные присвоения могут загрязнять зависимости времени исполнения содержимым, не заданным в <code>BUILD_DEPENDS</code> исходного порта. Такое случается из-за ленивого вычисления в <a href="https://man.freebsd.org/cgi/man.cgi?query=make&amp;sektion=1&amp;format=html">make(1)</a> присваиваемых переменных. Представьте <span class=filename>Makefile</span> с переменными <code>USE_*</code>, которые обрабатываются в <span class=filename>ports/Mk/bsd.*.mk</span> для пополнения первоначальных зависимостей построения. Например, <code>USES= gmake</code> добавляет <a class=package href=https://cgit.freebsd.org/ports/tree/devel/gmake/>devel/gmake</a> в <code>BUILD_DEPENDS</code>. Для предотвращения загрязнения <code>RUN_DEPENDS</code> подобными дополнительными зависимостями проявляйте осторожность с присвоением с раскрытием, т.е. с раскрытием значения перед его присвоением переменной:</p></div><div class="literalblock programlisting"><div class=content><pre>RUN_DEPENDS:=	${BUILD_DEPENDS}</pre></div></div></div><div class=sect2><h3 id=_build_depends>5.8.3. <code>BUILD_DEPENDS</code><a class=anchor href=#_build_depends></a></h3><div class=paragraph><p>В этой переменной перечисляются выполнимые или обычные файлы, которые требуются порту для его построения. Как и <code>RUN_DEPENDS</code>, это список пар path:dir:target. Например,</p></div><div class="literalblock programlisting"><div class=content><pre>BUILD_DEPENDS=	unzip:${PORTSDIR}/archivers/unzip</pre></div></div><div class=paragraph><p>будет проверять наличие выполнимого фала с именем <code>unzip</code> и перейдет в подкаталог <span class=filename>archivers/unzip</span> вашего дерева портов для его построения и установки, если последний не будет найден.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Под "построением" здесь понимается всё, от распаковки до компиляции. Зависимость проверяется из цели <code>extract</code>. Часть <em>target</em> может быть опущена, если она совпадает с <code>DEPENDS_TARGET</code>.</p></div></td></tr></tbody></table></div></div><div class=sect2><h3 id=_fetch_depends>5.8.4. <code>FETCH_DEPENDS</code><a class=anchor href=#_fetch_depends></a></h3><div class=paragraph><p>В этой переменной перечисляются выполняемые файлы или просто файлы, которые требуются порту для сгрузки. Как и предыдущие две переменные, это список пар path:dir:target. Например,</p></div><div class="literalblock programlisting"><div class=content><pre>FETCH_DEPENDS=	ncftp2:${PORTSDIR}/net/ncftp2</pre></div></div><div class=paragraph><p>будет проверять наличие выполняемого файла с именем <code>ncftp2</code> и перейдет в каталог <span class=filename>net/ncftp2</span> вашего дерева портов для его построения и установки, если тот не будет найден.</p></div><div class=paragraph><p>Зависимость проверяется при выполнении цели <code>fetch</code>. Часть <em>target</em> может быть опущена, если она совпадает с <code>DEPENDS_TARGET</code>.</p></div></div><div class=sect2><h3 id=_extract_depends>5.8.5. <code>EXTRACT_DEPENDS</code><a class=anchor href=#_extract_depends></a></h3><div class=paragraph><p>В этой переменной указываются программы или файлы, которые требуются для распаковки порта. Как и в предыдущих случаях, это список пар вида path:dir:target. Например,</p></div><div class="literalblock programlisting"><div class=content><pre>EXTRACT_DEPENDS=	unzip:${PORTSDIR}/archivers/unzip</pre></div></div><div class=paragraph><p>будет проверять наличие программы с именем <code>unzip</code>, и перейдёт в подкаталог <span class=filename>archivers/unzip</span> вашего дерева портов для её построения и установки, если такой программы не будет найдено.</p></div><div class=paragraph><p>Зависимость проверяется внутри цели <code>extract</code>. Часть <em>target</em> может быть опущена, если она совпадает с <code>DEPENDS_TARGET</code>.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Используйте эту переменную, только если распаковка не работает (по умолчанию предполагается использование <code>gzip</code>) и это не исправляется при помощи <code>USE_ZIP</code> или <code>USE_BZIP2</code>, которые описаны в <a href=#use-vars><code>USE_*</code></a>.</p></div></td></tr></tbody></table></div></div><div class=sect2><h3 id=_patch_depends>5.8.6. <code>PATCH_DEPENDS</code><a class=anchor href=#_patch_depends></a></h3><div class=paragraph><p>Эта переменная указывает на программы или файлы, которые нужны порту для применения патчей. Как и в предыдущих случаях, это список пар вида path:dir:target. Например,</p></div><div class="literalblock programlisting"><div class=content><pre>PATCH_DEPENDS=	${NONEXISTENT}:${PORTSDIR}/java/jfc:extract</pre></div></div><div class=paragraph><p>будет переходить в подкаталог <span class=filename>java/jfc</span> вашего дерева портов для распаковки.</p></div><div class=paragraph><p>Зависимость проверяется внутри цели <code>patch</code>. Часть <em>target</em> может быть опущена, если она совпадает с <code>DEPENDS_TARGET</code>.</p></div></div><div class=sect2><h3 id=uses-makefiles>5.8.7. <code>USES</code><a class=anchor href=#uses-makefiles></a></h3><div class=paragraph><p>Могут быть добавлены параметры для определения различных характерных особенностей и зависимостей, которыми обладает данный порт. Они указываются путём добавления в <span class=filename>Makefile</span> этой строки:</p></div><div class="literalblock programlisting"><div class=content><pre>USES= feature[:arguments]</pre></div></div><div class=paragraph><p>Для получения полного списка значений смотрите <a href=#uses-makefiles><code>USES</code></a>.</p></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>Значение <code>USES</code> нельзя присваивать после подключения <span class=filename>bsd.port.pre.mk</span>.</p></div></td></tr></tbody></table></div></div><div class=sect2><h3 id=use-vars>5.8.8. <code>USE_*</code><a class=anchor href=#use-vars></a></h3><div class=paragraph><p>Для определения общих зависимостей, совместно используемых многими портами, предназначено несколько переменных. Их использование является необязательным, но помогает упростить избыточность файлов <span class=filename>Makefile</span> порта. Каждый из них оформляется как <code>USE_*</code>. Эти переменные можно использовать только в <span class=filename>Makefile</span> порта и <span class=filename>ports/Mk/bsd.*.mk</span>. Они не предназначены для установки пользователями параметров - используйте для этих целей <code>PORT_OPTIONS</code>.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Установка любых <code>USE_*</code> в <span class=filename>/etc/make.conf</span> <em>всегда</em> является ошибочным действием. В частности, установка</p></div><div class="literalblock programlisting"><div class=content><pre>USE_GCC=X.Y</pre></div></div><div class=paragraph><p>(где X.Y соответствует версии) добавит зависимость от gccXY к каждому порту, включая и сам <code>lang/gccXY</code>!</p></div></td></tr></tbody></table></div><table class="tableblock frame-none grid-all stretch"><caption class=title>Таблица 2. Переменные <code>USE_*</code></caption><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">Переменная</th><th class="tableblock halign-left valign-top">Значение</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>USE_BZIP2</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>tar-архивы порта упакованы при помощи <code>bzip2</code>.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>USE_ZIP</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>tar-архивы порта упакованы при помощи <code>zip</code>.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>USE_GCC</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Для сборки порта требуется GCC (gcc или g++). Некоторым портам подходит любая версия, для других требуются последние современные версии. Обычно используется со значением <code>any</code> (в этом случае используется встроенный GCC в тех версиях FreeBSD, в состав которых он всё ещё входит, или устанавливается порт <code>lang/gcc</code>, когда Clang является компилятором C/C++ по умолчанию) или <code>yes</code> (всегда используется стабильная современная версия GCC из порта <code>lang/gcc</code>). Также в значении переменной можно указать точную версию, например <code>4.7</code>. Минимально допустимую версию можно указать как <code>4.6+</code>. GCC из основной системы используется в случае, если его версия удовлетворяет запрошенной, иначе собирается подходящая версии компилятора из порта с соответствующей коррекцией переменных <code>CC</code> и <code>CXX</code>.</p></td></tr></tbody></table><div class=paragraph><p>Переменные, относящиеся к gmake и сценарию <span class=filename>configure</span>, описаны в <a href=../special/#building>Механизмы построения</a>, а autoconf, automake и libtool описаны в <a href=../special/#using-autotools>Использование GNU Autotools</a>. Переменные, связанные с Perl, описаны в <a href=../special/#using-perl>Использование Perl</a>. Переменные X11 перечислены в <a href=../special/#using-x11>Использование X11</a>. <a href=../special/#using-gnome>Использование GNOME</a> работает с переменными GNOME и <a href=../special/#using-kde>Использование KDE</a> с KDE. <a href=../special/#using-java>Использование Java</a> описывает переменные Java, а <a href=../special/#using-php>Веб-приложения</a> содержит информацию об Apache, PHP и модулях PEAR. Python обсуждается в <a href=../special/#using-python>Использование Python</a>, а Ruby в <a href=../special/#using-ruby>Использование Ruby</a>. <a href=../special/#using-sdl>Использование SDL</a> предоставляет переменные, используемые для приложений SDL, и, наконец, <a href=../special/#using-xfce>Использование Xfce</a> содержит информацию о приложении Xfce.</p></div></div><div class=sect2><h3 id=_минимальная_версия_зависимости>5.8.9. Минимальная версия зависимости<a class=anchor href=#_минимальная_версия_зависимости></a></h3><div class=paragraph><p>Минимальная версия зависимости может быть указана в любой переменной <code>*_DEPENDS</code>, за исключением <code>LIB_DEPENDS</code>, с использованием следующего синтаксиса:</p></div><div class="literalblock programlisting"><div class=content><pre>p5-Spiffy&gt;=0.26:${PORTSDIR}/devel/p5-Spiffy</pre></div></div><div class=paragraph><p>Первое поле содержит название зависимого пакета, которое обязано совпадать с записью в базе данные пакетов, знак сравнения и версию пакета. Зависимость удовлетворяется, если на машине установлен p5-Spiffy-0.26 или новее.</p></div></div><div class=sect2><h3 id=_замечания_касательно_зависимостей>5.8.10. Замечания касательно зависимостей<a class=anchor href=#_замечания_касательно_зависимостей></a></h3><div class=paragraph><p>Как уже отмечено выше, целью, которая вызывается по умолчанию в случае, когда это требует зависимость, является <code>DEPENDS_TARGET</code>. Она по умолчанию есть <code>install</code>. Это пользовательская переменная; она нигде не определена в файле <span class=filename>Makefile</span> порта. Если вашему порту требуется особый метод обработки зависимости, воспользуйтесь частью <code>:target</code> переменной <code>*_DEPENDS</code> вместо того, чтобы переопределять <code>DEPENDS_TARGET</code>.</p></div><div class=paragraph><p>Когда вы набираете команду <code>make clean</code>, эта операция также выполняется и над зависимостями этого порта. Если вы не хотите, чтобы это случилось, определите переменную <code>NOCLEANDEPENDS</code> в вашем окружении. Это может быть особенно нужным, если порт имеет нечто, что занимает много времени на построение, в своём списке зависимостей, например, KDE, GNOME или Mozilla.</p></div><div class=paragraph><p>Чтобы безусловно зависеть от другого порта, укажите переменную <code>${NONEXISTENT}</code> в качестве первого поля переменной <code>BUILD_DEPENDS</code> или <code>RUN_DEPENDS</code>. Пользуйтесь этим, только когда вам нужно иметь исходный код другого порта. Вы можете сэкономить время на компиляции, указав также и цель. Например,</p></div><div class="literalblock programlisting"><div class=content><pre>BUILD_DEPENDS=	${NONEXISTENT}:${PORTSDIR}/graphics/jpeg:extract</pre></div></div><div class=paragraph><p>всегда будет переходить в каталог с портом <code>jpeg</code> и распаковывать его.</p></div></div><div class=sect2><h3 id=_зацикленные_зависимости_фатальны>5.8.11. Зацикленные зависимости фатальны<a class=anchor href=#_зацикленные_зависимости_фатальны></a></h3><div class="admonitionblock important"><table><tbody><tr><td class=icon><i class="fa icon-important" title=Important></i></td><td class=content><div class=paragraph><p>Не помещайте зацикливающиеся зависимости в дерево портов!</p></div></td></tr></tbody></table></div><div class=paragraph><p>Технология построения портов не защищена от зацикленных зависимостей. Если вы создадите такую, то у кого-нибудь и где-нибудь установка FreeBSD будет немедленно сломана, а у остальных сломается несколько позже. Это на самом деле очень трудно распознать; если вы сомневаетесь, то перед внесением изменений проверьте, что выполнили следующее: <code>cd /usr/ports; make index</code>. Этот процесс может быть достаточно медленным на старых машинах, хотя вы сможете спасти большое количество людей-включая себя-от грядущих бед.</p></div></div><div class=sect2><h3 id=_автоматические_зависимости_и_проблемы_которые_они_вызывают>5.8.12. Автоматические зависимости и проблемы, которые они вызывают<a class=anchor href=#_автоматические_зависимости_и_проблемы_которые_они_вызывают></a></h3><div class=paragraph><p>Зависимости должны быть указаны либо явно, либо с использованием <a href=#makefile-options>фреймворка OPTIONS</a>. Использование прочих методов, таких как автоматическое обнаружение зависимостей, усложняет индексирование, что вызывает проблемы в управлении портами и пакетами.</p></div><div class=exampleblock><div class=title>Пример 8. Некорректное объявление необязательной зависимости</div><div class=content><div class="literalblock programlisting"><div class=content><pre>.include &lt;bsd.port.pre.mk&gt;

.if exists(${LOCALBASE}/bin/foo)
LIB_DEPENDS=	libbar.so:${PORTSDIR}/foo/bar
.endif</pre></div></div></div></div><div class=paragraph><p>Проблема автоматического добавления зависимостей заключается в том, что файлы и настройки за пределами порта могут произвольно меняться. Пример: после построения индекса устанавливается набор портов. При этом один из них устанавливает проверяемый файл. На этом этапе индекс будет неправильным, потому что установленный порт неожиданно получит новую зависимость. Индекс может быть по прежнему неправильным даже после его перестроения, в случае если другие порты также определят дополнительные зависимости, основываясь на существовании других файлов.</p></div><div class=exampleblock><div class=title>Пример 9. Корректное объявление необязательной зависимости</div><div class=content><div class="literalblock programlisting"><div class=content><pre>OPTIONS_DEFINE=	BAR
BAR_DESC=	Bar support

.include &lt;bsd.port.options.mk&gt;

.if ${PORT_OPTIONS:MBAR}
LIB_DEPENDS=	libbar.so:${PORTSDIR}/foo/bar
.endif</pre></div></div></div></div><div class=paragraph><p>Правильным способом является проверка переменных параметров. Этот способ не приводит к несоответствиям в индексе набора портов, поскольку параметры определены до построения индекса. При этом можно использовать простые скрипты для автоматизации построения, установки и обновления этих портов и соответствующих им пакетов.</p></div></div><div class=sect2><h3 id=use-want>5.8.13. <code>USE_</code> и <code>WANT_</code><a class=anchor href=#use-want></a></h3><div class=paragraph><p>Переменные <code>USE_</code> задаются мейнтейнером порта для определения программного обеспечения, от которого этот порт зависит. Порт, для которого нужен Firefox, укажет</p></div><div class="literalblock programlisting"><div class=content><pre>USE_FIREFOX=	yes</pre></div></div><div class=paragraph><p>Некоторые переменные <code>USE_</code> могут принимать номера версий или другие параметры. Например, порт, который требует Apache 2.2, укажет</p></div><div class="literalblock programlisting"><div class=content><pre>USE_APACHE=	22</pre></div></div><div class=paragraph><p>В некоторых случаях для большего контроля над зависимостями используются переменные <code>WANT_</code>, которые позволяют указывать требования в более точной форме. Например, взгляните на порт <a class=package href=https://cgit.freebsd.org/ports/tree/mail/squirrelmail/>mail/squirrelmail</a>. Этому порту нужны несколько модулей PHP, которые перечислены в переменной <code>USE_PHP</code>:</p></div><div class="literalblock programlisting"><div class=content><pre>USE_PHP=	session mhash gettext mbstring pcre openssl xml</pre></div></div><div class=paragraph><p>Эти модули доступны в версиях CLI и web, поэтому версия web выбрана с переменной <code>WANT_</code>:</p></div><div class="literalblock programlisting"><div class=content><pre>WANT_PHP_WEB=	yes</pre></div></div><div class=paragraph><p>Имеющиеся переменные <code>USE_</code> и <code>WANT_</code> определены в файлах в <span class=filename>/usr/ports/Mk</span>.</p></div></div></div></div><div class=sect1><h2 id=makefile-masterdir>5.9. <code>MASTERDIR</code><a class=anchor href=#makefile-masterdir></a></h2><div class=sectionbody><div class=paragraph><p>Если вашему порту требуется построение довольно различающихся версий пакетов через переменную (задающую, например, разрешение, или размер бумаги), которая принимает различные значения, создайте для каждого пакета отдельный подкаталог, чтобы пользователям было легче определить, каким пакетом воспользоваться, но попробуйте использовать совместно между портами как можно больше файлов. В типичном случае вам потребуются только очень короткие файлы <span class=filename>Makefile</span> во всех каталогах, кроме одного, если вы будете использовать переменные с умом. В отдельных файлах <span class=filename>Makefile</span> вы можете использовать переменную <code>MASTERDIR</code> для указания каталога, в котором находятся все остальные файлы. Также используйте переменную как часть <a href=#porting-pkgname><code>PKGNAMESUFFIX</code></a>, чтобы пакеты имели разные имена.</p></div><div class=paragraph><p>Продемонстрируем это на примере. Вот часть файла <span class=filename>japanese/xdvi300/Makefile</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>PORTNAME=	xdvi
PORTVERSION=	17
PKGNAMEPREFIX=	ja-
PKGNAMESUFFIX=	${RESOLUTION}
 :
# default
RESOLUTION?=	300
.if ${RESOLUTION} != 118 &amp;&amp; ${RESOLUTION} != 240 &amp;&amp; \
	${RESOLUTION} != 300 &amp;&amp; ${RESOLUTION} != 400
	@${ECHO_MSG} &#34;Error: invalid value for RESOLUTION: \&#34;${RESOLUTION}\&#34;&#34;
	@${ECHO_MSG} &#34;Possible values are: 118, 240, 300 (default) and 400.&#34;
	@${FALSE}
.endif</pre></div></div><div class=paragraph><p>Порт <a class=package href=https://cgit.freebsd.org/ports/tree/japanese/xdvi300/>japanese/xdvi300</a> содержит также все обычные патчи, файлы для пакета и так далее. Если вы введете здесь команду <code>make</code>, она возьмет в качестве разрешения значение по умолчанию (300) и построит порт обычным образом.</p></div><div class=paragraph><p>Для другого разрешения приведем <em>полный</em><span class=filename>xdvi118/Makefile</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>RESOLUTION=	118
MASTERDIR=	${.CURDIR}/../xdvi300

.include &#34;${MASTERDIR}/Makefile&#34;</pre></div></div><div class=paragraph><p>(<span class=filename>xdvi240/Makefile</span> и <span class=filename>xdvi400/Makefile</span> похожи). Задание <code>MASTERDIR</code> говорит <span class=filename>bsd.port.mk</span>, что обычный набор подкаталогов типа <code>FILESDIR</code> и <code>SCRIPTDIR</code> находится в каталоге <span class=filename>xdvi300</span>. Строчка <code>RESOLUTION=118</code> переопределят строку <code>RESOLUTION=300</code> в файле <span class=filename>xdvi300/Makefile</span> и порт будет построен с разрешением 118.</p></div></div></div><div class=sect1><h2 id=makefile-manpages>5.10. Страницы Справочника<a class=anchor href=#makefile-manpages></a></h2><div class=sectionbody><div class=paragraph><p>Если ваш порт определяет корнем для файлов Справочника каталог, отличный от <code>PREFIX</code>, вы можете использовать переменную <code>MANDIRS</code>, чтобы указать эти каталоги. Обратите внимание, что файлы страниц справочника следует размещать в <span class=filename>pkg-plist</span> наряду с остальными файлами. <code>MANDIRS</code> предназначена для автоматического сжатия страниц справочника, так чтобы имена файлов оканчивались на <span class=filename>.gz</span>.</p></div></div></div><div class=sect1><h2 id=makefile-info>5.11. Файлы в формате info<a class=anchor href=#makefile-info></a></h2><div class=sectionbody><div class=paragraph><p>Если в вашем пакете нужна установка файлов GNU info, они должны быть перечислены в переменной <code>INFO</code> (без окончания <code>.info</code>), по записи на документ. Предполагается, что эти файлы устанавливаются в <span class=filename>PREFIX/INFO_PATH</span>. Вы можете изменить <code>INFO_PATH</code>, если ваш пакет использует другое место для размещения. Однако, это не рекомендуется делать. Эти записи всего лишь содержат путь относительно <span class=filename>PREFIX/INFO_PATH</span>. Например, <a class=package href=https://cgit.freebsd.org/ports/tree/lang/gcc34/>lang/gcc34</a> устанавливает файлы info в <span class=filename>PREFIX/INFO_PATH/gcc34</span>, и в <code>INFO</code> будет что-то вроде этого:</p></div><div class="literalblock programlisting"><div class=content><pre>INFO=	gcc34/cpp gcc34/cppinternals gcc34/g77 ...</pre></div></div><div class=paragraph><p>Перед регистрацией пакета соответствующий код установки/удаления будет автоматически добавлен во временный <span class=filename>pkg-plist</span>.</p></div></div></div><div class=sect1><h2 id=makefile-options>5.12. Опции для Makefile<a class=anchor href=#makefile-options></a></h2><div class=sectionbody><div class=paragraph><p>Многие приложения могут быть построены в различных конфигурациях и с дополнительной функциональностью. Например, выбор естественного (человеческого) языка, GUI против командной строки или типа используемой базы данных. Пользователи могут нуждаться в различных конфигурациях, отличных от используемой по умолчанию, поэтому в системе портов предусмотрен механизм, позволяющий автору порта управлять сборкой того или иного варианта конфигурации. Правильная поддержка этих необязательных параметров облегчает пользователям жизнь и даёт два или более порта по цене одного.</p></div><div class=sect2><h3 id=_knobs>5.12.1. Knobs<a class=anchor href=#_knobs></a></h3><div class=sect3><h4 id=_with_и_without>5.12.1.1. <code>WITH<em>*<em></em></em></code><em><em> и <code>WITHOUT</code></em><code>*</code></em><a class=anchor href=#_with_и_without></a></h4><div class=paragraph><p>Эти переменные предназначены для установки системным администратором. Многие из них стандартизованы в файле <a href="http://svnweb.FreeBSD.org/ports/head/KNOBS?view=markup">ports/KNOBS</a>.</p></div><div class=paragraph><p>При создании порта не давайте имя для knob, специфичное для данного приложения. На примере порта Avahi, используйте <code>WITHOUT_MDNS</code> вместо <code>WITHOUT_AVAHI_MDNS</code>.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Не стоит рассчитывать, что <code>WITH<em>*<em></em></em></code><em><em> обязательно имеет соответствующую переменную <code>WITHOUT</code></em><code>*</code></em>, и наоборот. В общем случае, предполагается значение по умолчанию.</p></div></td></tr></tbody></table></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Если обратное не указано, то проверяется только факт установки самих переменных, но не их конкретное значение типа <code>YES</code> или <code>NO</code>.</p></div></td></tr></tbody></table></div><table class="tableblock frame-none grid-all stretch"><caption class=title>Таблица 3. Основные переменные <code>WITH<em>*<em></em></em></code><em><em> и <code>WITHOUT</code></em><code>*</code></em></caption><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">Переменная</th><th class="tableblock halign-left valign-top">Значение</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>WITH_OPENSSL_BASE</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Использовать версию OpenSSL из базовой системы.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>WITH_OPENSSL_PORT</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Устанавливает версию OpenSSL из <a class=package href=https://cgit.freebsd.org/ports/tree/security/openssl/>security/openssl</a>, даже если в базовой системе последняя версия.</p></td></tr></tbody></table></div><div class=sect3><h4 id=_наименование_knobs>5.12.1.2. Наименование KNOBS<a class=anchor href=#_наименование_knobs></a></h4><div class=paragraph><p>Портеры должны использовать так называемые knobs для помощи конечным пользователям и для поддержания количества наименований knobs в небольшом количестве. Список популярных названий knobs можно найти в файле <a href="http://svnweb.FreeBSD.org/ports/head/KNOBS?view=markup">KNOBS</a></p></div><div class=paragraph><p>Названия knobs должны отражать, что это такое и что выполняет. Если у порта имеется библиотечный префикс в <code>PORTNAME</code>, то он должен присутствовать в названии knobs.</p></div></div></div><div class=sect2><h3 id=_options>5.12.2. <code>OPTIONS</code><a class=anchor href=#_options></a></h3><div class=sect3><h4 id=_описание>5.12.2.1. Описание<a class=anchor href=#_описание></a></h4><div class=paragraph><p>При установке порта переменные <code>OPTIONS_*</code> предоставляют пользователю окно диалога с отображением доступных параметров, с записью выбранных параметров в файл <span class=filename>/var/db/ports/${UNIQUENAME}/options</span>. Эти опции повторно используются при следующем построении порта.</p></div><div class=paragraph><p>Когда пользователь запускает <code>make config</code> (или запускает впервые <code>make build</code>), инфраструктура выполняет проверку существования файла <span class=filename>/var/db/ports/${UNIQUENAME}/options</span>. Если этот файл не существует, то используются значения <code>OPTIONS_*</code> и отображается диалоговое окно, в котором эти параметры можно включить или выключить. Затем сохраняется файл опций <span class=filename>options</span>, и выбранные переменные используются при построении порта.</p></div><div class=paragraph><p>Если новая версия порта добавляет новые значения <code>OPTIONS</code>, то пользователю будет представлено окно диалога с сохраненными заполненными значениями старых <code>OPTIONS.</code></p></div><div class=paragraph><p><code>make showconfig</code> отображает сохраненную конфигурацию. Для удаления сохраненной конфигурации используйте <code>make rmconfig</code>.</p></div></div><div class=sect3><h4 id=_синтаксис>5.12.2.2. Синтаксис<a class=anchor href=#_синтаксис></a></h4><div class=paragraph><p><code>OPTIONS_DEFINE</code> содержит список используемых <code>OPTIONS</code>. Они независимы друг от друга и не сгруппированы:</p></div><div class="literalblock programlisting"><div class=content><pre>OPTIONS_DEFINE=	OPT1 OPT2</pre></div></div><div class=paragraph><p>Далее после определения следует описание <code>OPTIONS</code> (не является обязательным, но настоятельно рекомендуется):</p></div><div class="literalblock programlisting"><div class=content><pre>OPT1_DESC=	Describe OPT1
OPT2_DESC=	Describe OPT2
OPT3_DESC=	Describe OPT3
OPT4_DESC=	Describe OPT4
OPT5_DESC=	Describe OPT5
OPT6_DESC=	Describe OPT6</pre></div></div><div class="admonitionblock tip"><table><tbody><tr><td class=icon><i class="fa icon-tip" title=Tip></i></td><td class=content><div class=paragraph><p><span class=filename>ports/Mk/bsd.options.desc.mk</span> содержит описание множества наиболее используемых <code>OPTIONS</code>; переопределять их, как правило, не нужно.</p></div></td></tr></tbody></table></div><div class="admonitionblock tip"><table><tbody><tr><td class=icon><i class="fa icon-tip" title=Tip></i></td><td class=content><div class=paragraph><p>При описании параметров старайтесь представить себя на месте пользователя: "Что это делает?" и "Для чего бы я захотел включить это?" Не делайте простое повторение названия. Например, описание параметра <code>NLS</code> как "include NLS support" ("включить поддержку NLS") не поможет пользователю, который уже видит название параметра, но может не знать, что это означает. Описав его как "Native Language Support via gettext utilities" ("Поддержка национального языка через утилиты gettext"), вы поможете пользователю гораздо больше.</p></div></td></tr></tbody></table></div><div class=paragraph><p><code>OPTIONS</code> можно группировать в виде переключателей, для которых разрешен выбор единственного варианта в каждой группе:</p></div><div class="literalblock programlisting"><div class=content><pre>OPTIONS_SINGLE=		SG1
OPTIONS_SINGLE_SG1=	OPT3 OPT4</pre></div></div><div class=paragraph><p><code>OPTIONS</code> можно группировать в виде переключателей, для которых разрешен выбор единственного варианта (или ни одного) в каждой группе:</p></div><div class="literalblock programlisting"><div class=content><pre>OPTIONS_RADIO=		RG1
OPTIONS_RADIO_RG1=	OPT7 OPT8</pre></div></div><div class=paragraph><p><code>OPTIONS</code> также можно группировать в виде списков со множественным выбором, для которых обязан быть включен <em>по крайней мере один</em> из параметров:</p></div><div class="literalblock programlisting"><div class=content><pre>OPTIONS_MULTI=		MG1
OPTIONS_MULTI_MG1=	OPT5 OPT6</pre></div></div><div class=paragraph><p><code>OPTIONS</code> также можно группировать в виде списков со множественным выбором, для которых могут быть включены любые параметры, включая отсутствие выбора:</p></div><div class="literalblock programlisting"><div class=content><pre>OPTIONS_GROUP=		GG1
OPTIONS_GROUP_GG1=	OPT9 OPT10</pre></div></div><div class=paragraph><p>По умолчанию <code>OPTIONS</code> находится в выключенном положении, если при этом оно также отсутствует в списке <code>OPTIONS_DEFAULT</code>:</p></div><div class="literalblock programlisting"><div class=content><pre>OPTIONS_DEFAULT=	OPT1 OPT3 OPT6</pre></div></div><div class=paragraph><p>Определения <code>OPTIONS</code> обязаны быть до подключения <span class=filename>bsd.port.options.mk</span>. Переменные <code>PORT_OPTIONS</code> могут быть проверены только после подключения <span class=filename>bsd.port.options.mk</span>. Вместо этого также можно использовать подключение <span class=filename>bsd.port.pre.mk</span>, что все еще широко используется в портах, написанных до появления <span class=filename>bsd.port.options.mk</span>. Но имейте в виду, что некоторые переменные, обычно, это некоторые флаги <code>USE_*</code>, после подключения <span class=filename>bsd.port.pre.mk</span> будут работать не так, как этого от них ожидают.</p></div><div id=ports-options-simple-use class=exampleblock><div class=title>Пример 10. Простое использование <code>OPTIONS</code></div><div class=content><div class="literalblock programlisting"><div class=content><pre>OPTIONS_DEFINE=	FOO BAR
FOO_DESC=	Enable option foo
BAR_DESC=	Support feature bar

.include &lt;bsd.port.options.mk&gt;

.if ${PORT_OPTIONS:MFOO}
CONFIGURE_ARGS+=--with-foo
.else
CONFIGURE_ARGS+=--without-foo
.endif

.if ${PORT_OPTIONS:MBAR}
RUN_DEPENDS+=	bar:${PORTSDIR}/bar/bar
.endif

.include &lt;bsd.port.mk&gt;</pre></div></div></div></div><div id=ports-options-check-unset class=exampleblock><div class=title>Пример 11. Проверка незаданных значений <code>OPTIONS</code></div><div class=content><div class="literalblock programlisting"><div class=content><pre>.if ! ${PORT_OPTIONS:MEXAMPLES}
CONFIGURE_ARGS+=--without-examples
.endif</pre></div></div></div></div><div id=ports-options-practical-use class=exampleblock><div class=title>Пример 12. Пример реального использования <code>OPTIONS</code></div><div class=content><div class="literalblock programlisting"><div class=content><pre>OPTIONS_DEFINE=		EXAMPLES

OPTIONS_SINGLE=		BACKEND
OPTIONS_SINGLE_BACKEND=	MYSQL PGSQL BDB

OPTIONS_MULTI=		AUTH
OPTIONS_MULTI_AUTH=	LDAP PAM SSL

EXAMPLES_DESC=		Install extra examples
MYSQL_DESC=		Use MySQL as backend
PGSQL_DESC=		Use PostgreSQL as backend
BDB_DESC=		Use Berkeley DB as backend
LDAP_DESC=		Build with LDAP authentication support
PAM_DESC=		Build with PAM support
SSL_DESC=		Build with OpenSSL support

OPTIONS_DEFAULT=	PGSQL LDAP SSL

.include &lt;bsd.port.options.mk&gt;

.if ${PORT_OPTIONS:MPGSQL}
USE_PGSQL=		yes
CONFIGURE_ARGS+=	--with-postgres
.else
CONFIGURE_ARGS+=	--without-postgres
.endif

.if ${PORT_OPTIONS:MICU}
LIB_DEPENDS+=	libicuuc.so:${PORTSDIR}/devel/icu
.endif

.if ! ${PORT_OPTIONS:MEXAMPLES}
CONFIGURE_ARGS+=	--without-examples
.endif

# Проверка других параметров OPTIONS

.include &lt;bsd.port.mk&gt;</pre></div></div></div></div></div><div class=sect3><h4 id=_параметры_по_умолчанию>5.12.2.3. Параметры по умолчанию<a class=anchor href=#_параметры_по_умолчанию></a></h4><div class=paragraph><p>Следующие параметры по умолчанию всегда включены.</p></div><div class=ulist><ul><li><p><code>DOCS</code> - построение и установка документации.</p></li><li><p><code>NLS</code> - интернационализация.</p></li><li><p><code>EXAMPLES</code> - построение и установка примеров использования.</p></li><li><p><code>IPV6</code> - поддержка протокола IPv6.</p></li></ul></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Нет необходимости добавлять эти параметры в <code>OPTIONS_DEFAULT</code>. Тем не менее, чтобы отобразить их в окне диалога выбора параметров, они должны быть добавлены в <code>OPTIONS_DEFINE</code>.</p></div></td></tr></tbody></table></div></div></div><div class=sect2><h3 id=_функция_автоматической_активации>5.12.3. Функция автоматической активации<a class=anchor href=#_функция_автоматической_активации></a></h3><div class=paragraph><p>При использовании сценария GNU configure, следите за тем, какие необязательные функции задействуются посредством автоматической активации. Отключайте явным образом те необязательные функции, которые вы не хотели бы использовать, через передачу соответствующих <code>--without-xxx</code> или <code>--disable-xxx</code> в переменной <code>CONFIGURE_ARGS</code>.</p></div><div class=exampleblock><div class=title>Пример 13. Неправильное управление опцией</div><div class=content><div class="literalblock programlisting"><div class=content><pre>.if ${PORT_OPTIONS:MFOO}
LIB_DEPENDS+=		libfoo.so:${PORTSDIR}/devel/foo
CONFIGURE_ARGS+=	--enable-foo
.endif</pre></div></div></div></div><div class=paragraph><p>В приведенном выше примере представьте себе библиотеку libfoo, установленную в системе. Пользователь не желает, чтобы приложение использовало libfoo, и поэтому он выключает соответствующую опцию в диалоге <code>make config</code>. Но сценарий configure приложения определяет наличие библиотеки в системе и включает ее поддержку в итоговый исполняемый файл. Теперь, когда пользователь решит удалить libfoo из системы, система портов позволит это сделать (т.к. зависимость от libfoo не была записана), но приложение перестанет работать.</p></div><div class=exampleblock><div class=title>Пример 14. Правильное управление опцией</div><div class=content><div class="literalblock programlisting"><div class=content><pre>.if ${PORT_OPTIONS:MFOO}
LIB_DEPENDS+=		libfoo.so:${PORTSDIR}/devel/foo
CONFIGURE_ARGS+=	--enable-foo
.else
CONFIGURE_ARGS+=	--disable-foo
.endif</pre></div></div></div></div><div class=paragraph><p>Во втором примере библиотека libfoo отключена явным образом. Сценарий configure не включает соответствующие функции в приложении, несмотря на присутствие библиотеки в системе.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>При определенных условиях сокращенный синтаксис записи условий может вызывать проблемы со сложными конструкциями. Если вы получаете ошибки, такие как <code>Malformed conditional</code>, то может быть использован альтернативный синтаксис.</p></div><div class="literalblock programlisting"><div class=content><pre>.if !empty(VARIABLE:MVALUE)
# as an alternative to
.if ${VARIABLE:MVALUE}</pre></div></div></td></tr></tbody></table></div></div><div class=sect2><h3 id=_вспомогательные_макросы>5.12.4. Вспомогательные макросы<a class=anchor href=#_вспомогательные_макросы></a></h3><div class=paragraph><p>Существует несколько макросов, упрощающих запись условных значений, которые отличаются в зависимости от набора параметров.</p></div><div class=paragraph><p>Если переменная <code>OPTIONS_SUB</code> имеет значение <code>yes</code>, то каждый из указанных в <code>OPTIONS_DEFINE</code> параметров будет добавлен в <code>PLIST_SUB</code>. Следующая запись:</p></div><div class="literalblock programlisting"><div class=content><pre>OPTIONS_DEFINE=	OPT1
OPTIONS_SUB=	yes</pre></div></div><div class=paragraph><p>соответствует:</p></div><div class="literalblock programlisting"><div class=content><pre>OPTIONS_DEFINE=	OPT1

.include &lt;bsd.port.options.mk&gt;

.if ${PORT_OPTIONS:MOPT1}
PLIST_SUB+=	OPT1=&#34;&#34;
.else
PLIST_SUB+=	OPT1=&#34;@comment &#34;
.endif</pre></div></div><div class=paragraph><p><code>X_CONFIGURE_ENABLE</code> дописывает в <code>CONFIGURE_ARGS</code> строку <code>--enable-${X_CONFIGURE_ENABLE}</code> или <code>--disable-${X_CONFIGURE_ENABLE}</code> в соответствии с состоянием <code>X</code>. Следующая запись:</p></div><div class="literalblock programlisting"><div class=content><pre>OPTIONS_DEFINE=	OPT1
OPT1_CONFIGURE_ENABLE=	test</pre></div></div><div class=paragraph><p>соответствует:</p></div><div class="literalblock programlisting"><div class=content><pre>OPTIONS_DEFINE=	OPT1

.include &lt;bsd.port.options.mk&gt;

.if ${PORT_OPTIONS:MOPT1}
CONFIGURE_ARGS+=	--enable-test
.else
CONFIGURE_ARGS+=	--disable-test
.endif</pre></div></div><div class=paragraph><p><code>X_CONFIGURE_WITH</code> дописывает в <code>CONFIGURE_ARGS</code> строку <code>--with-${X_CONFIGURE_WITH}</code> или <code>--without-${X_CONFIGURE_WITH}</code> в соответствии с состоянием <code>X</code>. Следующая запись:</p></div><div class="literalblock programlisting"><div class=content><pre>OPTIONS_DEFINE=	OPT1
OPT1_CONFIGURE_WITH=	test</pre></div></div><div class=paragraph><p>соответствует:</p></div><div class="literalblock programlisting"><div class=content><pre>OPTIONS_DEFINE=	OPT1

.include &lt;bsd.port.options.mk&gt;

.if ${PORT_OPTIONS:MOPT1}
CONFIGURE_ARGS+=	--with-test
.else
CONFIGURE_ARGS+=	--without-test
.endif</pre></div></div><div class=paragraph><p>Значение переменной <code>X_CONFIGURE_ON</code> будет дописано в <code>CONFIGURE_ARGS</code> в соответствии с состоянием <code>X</code>. Следующая запись:</p></div><div class="literalblock programlisting"><div class=content><pre>OPTIONS_DEFINE=	OPT1
OPT1_CONFIGURE_ON=	--add-test</pre></div></div><div class=paragraph><p>соответствует:</p></div><div class="literalblock programlisting"><div class=content><pre>OPTIONS_DEFINE=	OPT1

.include &lt;bsd.port.options.mk&gt;

.if ${PORT_OPTIONS:MOPT1}
CONFIGURE_ARGS+=	--add-test
.endif</pre></div></div><div class=paragraph><p>Значение переменной <code>X_CONFIGURE_OFF</code> будет дописано в <code>CONFIGURE_ARGS</code> в соответствии с состоянием <code>X</code>. Следующая запись:</p></div><div class="literalblock programlisting"><div class=content><pre>OPTIONS_DEFINE=	OPT1
OPT1_CONFIGURE_OFF=	--no-test</pre></div></div><div class=paragraph><p>соответствует:</p></div><div class="literalblock programlisting"><div class=content><pre>OPTIONS_DEFINE=	OPT1
.include &lt;bsd.port.options.mk&gt;
.if ! ${PORT_OPTIONS:MOPT1}
CONFIGURE_ARGS+=	--no-test
.endif</pre></div></div><div class=paragraph><p>Значение переменной <code>X_CMAKE_ON</code> будет дописано в <code>CMAKE_ARGS</code> в соответствии с состоянием <code>X</code>. Следующая запись:</p></div><div class="literalblock programlisting"><div class=content><pre>OPTIONS_DEFINE=	OPT1
OPT1_CMAKE_ON=	-DTEST:BOOL=true</pre></div></div><div class=paragraph><p>соответствует:</p></div><div class="literalblock programlisting"><div class=content><pre>OPTIONS_DEFINE=	OPT1

.include &lt;bsd.port.options.mk&gt;

.if ${PORT_OPTIONS:MOPT1}
CMAKE_ARGS+=	-DTEST:BOOL=true
.endif</pre></div></div><div class=paragraph><p>Значение переменной <code>X_CMAKE_OFF</code> будет дописано в <code>CMAKE_ARGS</code> в соответствии с состоянием <code>X</code>. Следующая запись:</p></div><div class="literalblock programlisting"><div class=content><pre>OPTIONS_DEFINE=	OPT1
OPT1_CMAKE_OFF=	-DTEST:BOOL=false</pre></div></div><div class=paragraph><p>соответствует:</p></div><div class="literalblock programlisting"><div class=content><pre>OPTIONS_DEFINE=	OPT1

.include &lt;bsd.port.options.mk&gt;

.if ! ${PORT_OPTIONS:MOPT1}
CMAKE_ARGS+=	-DTEST:BOOL=false
.endif</pre></div></div><div class=paragraph><p>Для любой из следующих переменных:</p></div><div class=ulist><ul><li><p><code>ALL_TARGET</code></p></li><li><p><code>CATEGORIES</code></p></li><li><p><code>CFLAGS</code></p></li><li><p><code>CPPFLAGS</code></p></li><li><p><code>CXXFLAGS</code></p></li><li><p><code>CONFIGURE_ENV</code></p></li><li><p><code>DISTFILES</code></p></li><li><p><code>EXTRA_PATCHES</code></p></li><li><p><code>INSTALL_TARGET</code></p></li><li><p><code>LDFLAGS</code></p></li><li><p><code>MAKE_ARGS</code></p></li><li><p><code>MAKE_ENV</code></p></li><li><p><code>PATCH_SITES</code></p></li><li><p><code>PATCHFILES</code></p></li><li><p><code>PLIST_FILES</code></p></li><li><p><code>PLIST_DIRS</code></p></li><li><p><code>PLIST_DIRSTRY</code></p></li><li><p><code>USES</code></p></li></ul></div><div class=paragraph><p>Значение переменной <code>X_ABOVEVARIABLE</code> будет дописано в <code>ABOVEVARIABLE</code> в соответствии с состоянием <code>X</code>. Следующая запись:</p></div><div class="literalblock programlisting"><div class=content><pre>OPTIONS_DEFINE=	OPT1
OPT1_USES=	gmake
OPT1_CFLAGS=	-DTEST</pre></div></div><div class=paragraph><p>соответствует:</p></div><div class="literalblock programlisting"><div class=content><pre>OPTIONS_DEFINE=	OPT1

.include &lt;bsd.port.options.mk&gt;

.if ${PORT_OPTIONS:MOPT1}
USES+=		gmake
CFLAGS+=	-DTEST
.endif</pre></div></div><div class=paragraph><p>Если установлена <code>X_ABOVEVARIABLE_OFF</code>, то флаг <code>ABOVEVARIABLE</code> будет автоматически выставлен при выключенном параметре <code>X</code>. Например:</p></div><div class="literalblock programlisting"><div class=content><pre>OPTIONS_DEFINE=	OPT1
OPT1_USES_OFF=gmake</pre></div></div><div class=paragraph><p>соответствует:</p></div><div class="literalblock programlisting"><div class=content><pre>OPTIONS_DEFINE=	OPT1

.include &lt;bsd.port.options.mk&gt;

.if ! ${PORT_OPTIONS:MOPT1}
USES+=	gmake
.endif</pre></div></div><div class=paragraph><p>Для любого из следующих типов зависимости:</p></div><div class=ulist><ul><li><p><code>PKG_DEPENDS</code></p></li><li><p><code>EXTRACT_DEPENDS</code></p></li><li><p><code>PATCH_DEPENDS</code></p></li><li><p><code>FETCH_DEPENDS</code></p></li><li><p><code>BUILD_DEPENDS</code></p></li><li><p><code>LIB_DEPENDS</code></p></li><li><p><code>RUN_DEPENDS</code></p></li></ul></div><div class=paragraph><p>Значение переменной <code>X_ABOVEVARIABLE</code> будет дописано в <code>ABOVEVARIABLE</code> в соответствии с состоянием <code>X</code>. Следующая запись:</p></div><div class="literalblock programlisting"><div class=content><pre>OPTIONS_DEFINE=	OPT1
OPT1_LIB_DEPENDS=	liba.so:${PORTSDIR}/devel/a</pre></div></div><div class=paragraph><p>соответствует:</p></div><div class="literalblock programlisting"><div class=content><pre>OPTIONS_DEFINE=	OPT1

.include &lt;bsd.port.options.mk&gt;

.if ${PORT_OPTIONS:MOPT1}
LIB_DEPENDS+=	liba.so:${PORTSDIR}/devel/a
.endif</pre></div></div><div class=paragraph><p>Если установлена <code>X_ABOVEVARIABLE_OFF</code>, то зависимость типа <code>ABOVEVARIABLE</code> будет добавлена при выключенном параметре <code>X</code>. Например:</p></div><div class="literalblock programlisting"><div class=content><pre>OPTIONS_DEFINE=	OPT1
OPT1_LIB_DEPENDS_OFF= liba.so:${PORTSDIR}/devel/a</pre></div></div><div class=paragraph><p>соответствует:</p></div><div class="literalblock programlisting"><div class=content><pre>OPTIONS_DEFINE= OPT1

.include &lt;bsd.port.options.mk&gt;

. if ! ${PORT_OPTIONS:MOPT1}
LIB_DEPENDS+=	liba.so:${PORTSDIR}/devel/a
.endif</pre></div></div></div></div></div><div class=sect1><h2 id=makefile-wrkdir>5.13. Задание рабочего каталога<a class=anchor href=#makefile-wrkdir></a></h2><div class=sectionbody><div class=paragraph><p>Каждый порт распаковывается в рабочий каталог, который должен быть доступным для записи. В системе портов по умолчанию <code>DISTFILES</code> распаковываются в каталог с именем <code>${DISTNAME}</code>. Другими словами, если вы задали:</p></div><div class="literalblock programlisting"><div class=content><pre>PORTNAME=	foo
PORTVERSION=	1.0</pre></div></div><div class=paragraph><p>то дистрибутивные файлы порта содержат каталог верхнего уровня, <span class=filename>foo-1.0</span>, и все файлы расположены в этом каталоге.</p></div><div class=paragraph><p>Если это не ваш случай, то имеется несколько переменных, которые вы можете переопределить.</p></div><div class=sect2><h3 id=_wrksrc>5.13.1. <code>WRKSRC</code><a class=anchor href=#_wrksrc></a></h3><div class=paragraph><p>Эта переменная задаёт имя каталога, который создаётся при распаковке исходных файлов приложения. В нашем предыдущем примере если бы распаковка происходила в каталог с именем <span class=filename>foo</span> (а не <span class=filename>foo-1.0</span>), то вы должны написать:</p></div><div class="literalblock programlisting"><div class=content><pre>WRKSRC=	${WRKDIR}/foo</pre></div></div><div class=paragraph><p>или, как вариант</p></div><div class="literalblock programlisting"><div class=content><pre>WRKSRC=	${WRKDIR}/${PORTNAME}</pre></div></div></div><div class=sect2><h3 id=_no_wrksubdir>5.13.2. <code>NO_WRKSUBDIR</code><a class=anchor href=#_no_wrksubdir></a></h3><div class=paragraph><p>Если порт вообще не распаковывается ни в какой каталог, то вы должны задать для этого переменную <code>NO_WRKSUBDIR</code>.</p></div><div class="literalblock programlisting"><div class=content><pre>NO_WRKSUBDIR=	yes</pre></div></div></div></div></div><div class=sect1><h2 id=conflicts>5.14. Разрешение конфликтов<a class=anchor href=#conflicts></a></h2><div class=sectionbody><div class=paragraph><p>Для регистрации конфликта между пакетами и портами используются три различные переменные: <code>CONFLICTS</code>, <code>CONFLICTS_INSTALL</code> и <code>CONFLICTS_BUILD</code>.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Переменные регистрации конфликта автоматически определяют переменную <code>IGNORE</code>, которая более подробно описана в <a href=../porting-dads/#dads-noinstall>Пометка неустанавливаемого порта как <code>BROKEN</code>, <code>FORBIDDEN</code> или <code>IGNORE</code> </a>.</p></div></td></tr></tbody></table></div><div class=paragraph><p>При удалении одного из конфликтующих портов целесообразно сохранить записи <code>CONFLICTS</code> в тех других портах в течении нескольких месяцев, чтобы позаботиться о тех пользователей, которые обновляются от случая к случаю.</p></div><div class=sect2><h3 id=_conflicts_install>5.14.1. <code>CONFLICTS_INSTALL</code><a class=anchor href=#_conflicts_install></a></h3><div class=paragraph><p>Если ваш пакет не может существовать вместе с другими (из-за конфликта файлов, несовместимости времени выполнения и так далее), перечислите имена остальных пакетов в переменной <code>CONFLICTS_INSTALL</code>. Здесь вы можете использовать шаблоны командного интерпретатора, такие как <code>*</code> и <code>?</code>. Имена пакетов должны выглядеть так же, как в <span class=filename>/var/db/pkg</span>. Пожалуйста, убедитесь, что <code>CONFLICTS_INSTALL</code> не содержит пакет самого этого порта. В противном случае не будет работать установка с использованием переменной <code>FORCE_PKG_REGISTER</code>. Проверка CONFLICTS_INSTALL выполняется после процесса сборки и до процесса установки.</p></div></div><div class=sect2><h3 id=_conflicts_build>5.14.2. <code>CONFLICTS_BUILD</code><a class=anchor href=#_conflicts_build></a></h3><div class=paragraph><p>Если ваш порт не может быть собран, когда уже установлен другой, перечислите имена остальных портов в переменной <code>CONFLICTS_BUILD</code>. Здесь вы можете использовать шаблоны командного интерпретатора, такие как <code>*</code> и <code>?</code>. Имена пакетов должны выглядеть так же, как в <span class=filename>/var/db/pkg</span>. Проверка CONFLICTS_BUILD выполняется до процесса сборки. Конфликты сборки в получаемом пакете не записываются.</p></div></div><div class=sect2><h3 id=_conflicts>5.14.3. <code>CONFLICTS</code><a class=anchor href=#_conflicts></a></h3><div class=paragraph><p>Если ваш порт не может быть собран, когда уже установлен другой, а получаемый пакет не может существовать вместе с другими, перечислите имена остальных пакетов в переменной <code>CONFLICTS</code>. Здесь вы можете использовать шаблоны командного интерпретатора, такие как <code>*</code> и <code>?</code>. Имена пакетов должны выглядеть так же, как в <span class=filename>/var/db/pkg</span>. Пожалуйста, убедитесь, что <code>CONFLICTS</code> не содержит пакет самого этого порта. В противном случае не будет работать установка с использованием переменной <code>FORCE_PKG_REGISTER</code>. Проверка CONFLICTS выполняется до процессов сборки и установки.</p></div></div></div></div><div class=sect1><h2 id=install>5.15. Установка файлов<a class=anchor href=#install></a></h2><div class=sectionbody><div class=sect2><h3 id=install-macros>5.15.1. Макросы <code>INSTALL_*</code><a class=anchor href=#install-macros></a></h3><div class=paragraph><p>Используйте макросы, которые есть в файле <span class=filename>bsd.port.mk</span> для обеспечения правильных прав доступа файлов в целях <code>*-install</code> порта. Устанавливайте права владения напрямую в <span class=filename>pkg-plist</span> через соответствующие записи <code>@owner owner</code> и <code>@group group</code>. Эти операторы работают до момента их переопределения или до конца <span class=filename>pkg-plist</span>, поэтому не забывайте их сбрасывать, когда они больше не нужны. По умолчанию владение устанавливается для <code>root:wheel</code>.</p></div><div class=ulist><ul><li><p><code>INSTALL_PROGRAM</code> - это команда для установки бинарных выполнимых файлов.</p></li><li><p><code>INSTALL_SCRIPT</code> - это команда для установки выполнимых скриптов.</p></li><li><p><code>INSTALL_LIB</code> - это команда для установки динамических библиотек.</p></li><li><p><code>INSTALL_KLD</code> - это команда для установки загружаемых модулей ядра. Некоторые архитектуры предпочитают, чтобы для модулей сохранялись отладочные сведения, по этой причине используйте эту команду вместо <code>INSTALL_PROGRAM</code>.</p></li><li><p><code>INSTALL_DATA</code> - это команда для установки совместно используемых файлов данных.</p></li><li><p><code>INSTALL_MAN</code> - это команда для установки страниц Справочника и другой документации (никаких файлов она не сжимает).</p></li></ul></div><div class=paragraph><p>В основе работы этих макросов лежит команда <code>install</code> со всеми соответствующими флагами. Смотрите пример их использования ниже.</p></div></div><div class=sect2><h3 id=install-strip>5.15.2. Удаление отладочной информации в бинарных файлах и динамических библиотеках<a class=anchor href=#install-strip></a></h3><div class=paragraph><p>Не удаляйте отладочную информацию из бинарных файлов вручную, если вы это делали. Во всех двоичных файлах отладочная информация должна быть удалена, и макрос <code>INSTALL_PROGRAM</code> выполнит установку и удаление отладочной информации одновременно (обратитесь к следующему разделу). Макрос <code>INSTALL_LIB</code> делает то же самое для динамических библиотек.</p></div><div class=paragraph><p>Если вам нужно удалить отладочную информацию из файла без использования макросов <code>INSTALL_PROGRAM</code> и <code>INSTALL_LIB</code>, то это можно сделать при помощи <code>${STRIP_CMD}</code>. Обычно это делается внутри цели <code>post-install</code>. К примеру:</p></div><div class="literalblock programlisting"><div class=content><pre>post-install:
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/bin/xdl</pre></div></div><div class=paragraph><p>Удаление отладочной информации из нескольких файлов:</p></div><div class="literalblock programlisting"><div class=content><pre>post-install:
	.for l in geometry media body track world
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/lib/lib${PORTNAME}-${l}.so.0
	.endfor</pre></div></div><div class=paragraph><p>Для проверки того, удалена ли отладочная информация из файла, используйте <a href="https://man.freebsd.org/cgi/man.cgi?query=file&amp;sektion=1&amp;format=html">file(1)</a>. Для двоичных файлов <a href="https://man.freebsd.org/cgi/man.cgi?query=file&amp;sektion=1&amp;format=html">file(1)</a> печатает <code>stripped</code> или <code>not stripped</code>. Кроме того, <a href="https://man.freebsd.org/cgi/man.cgi?query=strip&amp;sektion=1&amp;format=html">strip(1)</a> определяет, была ли уже удалена из программы отладочная информация, и в этом случае просто завершает свою работу.</p></div></div><div class=sect2><h3 id=install-copytree>5.15.3. Установка целого дерева файлов<a class=anchor href=#install-copytree></a></h3><div class=paragraph><p>Иногда должно быть установлено большое количество файлов с сохранением их иерархической организации. Например, копирование дерева каталогов целиком из <code>WRKSRC</code> в целевой каталог внутри <code>PREFIX</code>. Обратите внимание, что <code>PREFIX</code>, <code>EXAMPLESDIR</code>, <code>DATADIR</code> и другие переменные пути всегда должны предваряться <code>STAGEDIR</code>, чтобы не ломать staging (смотрите <a href=#staging>[staging]</a>).</p></div><div class=paragraph><p>Для этой ситуации существует два макроса. Преимущество от использования этих макросов вместо команды <code>cp</code> в том, что они гарантируют установку правильного владельца и прав на конечные файлы. Первый макрос, <code>COPYTREE_BIN</code>, делает все устанавливаемые файлы исполняемыми, что подходит для установки в <span class=filename>PREFIX/bin</span>. Второй макрос, <code>COPYTREE_SHARE</code>, не устанавливает на файлы права исполнения, и, таким образом, подходит для установки файлов внутри каталога <span class=filename>PREFIX/share</span>.</p></div><div class="literalblock programlisting"><div class=content><pre>post-install:
	${MKDIR} ${STAGEDIR}${EXAMPLESDIR}
	(cd ${WRKSRC}/examples &amp;&amp; ${COPYTREE_SHARE} . ${STAGEDIR}${EXAMPLESDIR})</pre></div></div><div class=paragraph><p>В этом примере устанавливается содержимое каталога <span class=filename>examples</span> из установочных файлов производителя в надлежащее место для примеров вашего порта.</p></div><div class="literalblock programlisting"><div class=content><pre>post-install:
	${MKDIR} ${STAGEDIR}${DATADIR}/summer
	(cd ${WRKSRC}/temperatures &amp;&amp; ${COPYTREE_SHARE} &#34;June July August&#34; ${STAGEDIR}${DATADIR}/summer)</pre></div></div><div class=paragraph><p>А в этом примере будут установлены данные летних месяцев в подкаталог <span class=filename>summer</span> каталога <span class=filename>DATADIR</span>.</p></div><div class=paragraph><p>В качестве третьего параметра в макросе <code>COPYTREE_*</code> можно передать дополнительные параметры <code>find</code>. Например, чтобы в первом примере установить все файлы кроме файлов Makefile, можно использовать следующую команду.</p></div><div class="literalblock programlisting"><div class=content><pre>post-install:
	${MKDIR} ${STAGEDIR}${EXAMPLESDIR}
	(cd ${WRKSRC}/examples &amp;&amp; \
	${COPYTREE_SHARE} . ${STAGEDIR}${EXAMPLESDIR} &#34;! -name Makefile&#34;)</pre></div></div><div class=paragraph><p>Эти макросы не производят добавление устанавливаемых файлов в <span class=filename>pkg-plist</span>. Они должны быть добавлены туда вручную. Необязательные файлы документации (<code>PORTDOCS</code>, смотрите <a href=#install-documentation>Установка дополнительной документации</a>) и примеров (<code>PORTEXAMPLES</code>) всегда должны предваряться в <span class=filename>pkg-plist</span> префиксами <code>%%PORTDOCS%%</code> или <code>%%PORTEXAMPLES%%</code>.</p></div></div><div class=sect2><h3 id=install-documentation>5.15.4. Установка дополнительной документации<a class=anchor href=#install-documentation></a></h3><div class=paragraph><p>Если с вашим программным обеспечением поставляется некоторая документация, отличающаяся от стандартных страниц Справочника и файлов info, которая, как вы думаете, будет полезна пользователям, установите ее в каталог <span class=filename>PREFIX/shared/doc</span>. Это может быть сделано, как и в предыдущем разделе, в цели <code>post-install</code>.</p></div><div class=paragraph><p>Создайте для вашего порта новый каталог. Имя каталога должно соответствовать тому, что представляет из себя порт. Обычно это означает <code>PORTNAME</code>. Однако, если вы думаете, что пользователь захочет иметь разные версии порта, установленные одновременно, то вы можете использовать полное имя <code>PKGNAME</code>.</p></div><div class=paragraph><p>Поскольку устанавливаются только файлы, перечисленные в <span class=filename>pkg-plist</span>, безопасным способом будет устанавливать документацию в <code>STAGEDIR</code> всегда (смотрите <a href=../special/#staging>Staging</a>). Следовательно, блоки <code>.if</code> нужны только для файлов достаточно большого размера, установка которых влечёт значительные накладные расходы на операции ввода/вывода.</p></div><div class="literalblock programlisting"><div class=content><pre>post-install:
	${MKDIR} ${STAGEDIR}${DOCSDIR}
	${INSTALL_MAN} ${WRKSRC}/docs/xvdocs.ps ${STAGEDIR}${DOCSDIR}</pre></div></div><div class=paragraph><p>Вот несколько полезных переменных и то, как они преобразуются по умолчанию при использовании в <span class=filename>Makefile</span>:</p></div><div class=ulist><ul><li><p><code>DATADIR</code> преобразуется в <span class=filename>PREFIX/shared/PORTNAME</span>.</p></li><li><p><code>DATADIR_REL</code> преобразуется в <span class=filename>share/PORTNAME</span>.</p></li><li><p><code>DOCSDIR</code> преобразуется в <span class=filename>PREFIX/shared/doc/PORTNAME</span>.</p></li><li><p><code>DOCSDIR_REL</code> преобразуется в <span class=filename>share/doc/PORTNAME</span>.</p></li><li><p><code>EXAMPLESDIR</code> преобразуется в <span class=filename>PREFIX/shared/examples/PORTNAME</span>.</p></li><li><p><code>EXAMPLESDIR_REL</code> преобразуется в <span class=filename>share/examples/PORTNAME</span>.</p></li></ul></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Параметр <code>DOCS</code> управляет установкой дополнительной документации в <code>DOCSDIR</code>. Это не относится к стандартным страницам справочника и страницам info. Все, что устанавливается в <code>DATADIR</code> и <code>EXAMPLESDIR</code>, соответственно управляется через параметры <code>DATA</code> и <code>EXAMPLES</code>.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Эти переменные экспортируются в <code>PLIST_SUB</code>. Их значения появятся там в виде имён путей относительно <span class=filename>PREFIX</span>, если это возможно. То есть <span class=filename>share/doc/PORTNAME</span> в списке сборки по умолчанию будет заменен на <code>%%DOCSDIR%%</code>, и так далее. (Дополнительную информацию о подстановке в <span class=filename>pkg-plist</span> можно найти <a href=#plist-sub>здесь</a>.)</p></div><div class=paragraph><p>Все условно устанавливаемые файлы и каталоги с документацией должны быть перечислены в файле <span class=filename>pkg-plist</span> с префиксом <code>%%PORTDOCS%%</code>, например:</p></div><div class="literalblock programlisting"><div class=content><pre>%%PORTDOCS%%%%DOCSDIR%%/AUTHORS
%%PORTDOCS%%%%DOCSDIR%%/CONTACT
%%PORTDOCS%%@dirrm %%DOCSDIR%%</pre></div></div><div class=paragraph><p>В качестве альтернативы перечислению файлов документации в файле <span class=filename>pkg-plist</span>, порт может указать в переменной <code>PORTDOCS</code> список имён файлов и глобальных шаблонов командного процессора для добавления в окончательный список сборки. Имена будут задаваться относительно <code>DOCSDIR</code>. Таким образом, порт, использующий <code>PORTDOCS</code> и нестандартное местоположение документации, должен задавать соответствующим образом и <code>DOCSDIR</code>. Если каталог указан в <code>PORTDOCS</code> или соответствует шаблону для этой переменной, то полное поддерево с входящими в него файлами и каталогами будет регистрироваться в окончательном списке сборки. Если параметр <code>DOCS</code> не задан, то файлы и каталоги, перечисленные в <code>PORTDOCS</code>, не будут установлены и добавлены в список сборки порта. Установка документации в <code>PORTDOCS</code>, как это показано выше, остаётся за самим портом. Типичный пример использования <code>PORTDOCS</code> выглядит следующим образом:</p></div><div class="literalblock programlisting"><div class=content><pre>PORTDOCS=	README.* ChangeLog docs/*</pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Эквивалентами <code>PORTDOCS</code> для файлов, устанавливаемых в <code>DATADIR</code> и <code>EXAMPLESDIR</code> являются <code>PORTDATA</code> и <code>PORTEXAMPLES</code> соответственно.</p></div><div class=paragraph><p>Во время установки выводится содержимое <span class=filename>pkg-message</span>. За подробной информацией обратитесь к <a href=#porting-message>разделу об использовании <span class=filename>pkg-message</span></a>. Файл <span class=filename>pkg-message</span> не нужно добавлять в <span class=filename>pkg-plist</span>.</p></div></td></tr></tbody></table></div></div><div class=sect2><h3 id=install-subdirs>5.15.5. Подкаталоги внутри PREFIX<a class=anchor href=#install-subdirs></a></h3><div class=paragraph><p>Попробуйте поместить все файлы порта в правильных подкаталогах каталога <code>PREFIX</code>. Некоторые порты игнорируют все установки и помещают все в подкаталог с именем порта, что неправильно. Также многие порты помещают все, кроме бинарных файлов, файлов заголовков и страниц Справочника, в подкаталог каталога <span class=filename>lib</span>, что не очень хорошо работает с подходом BSD. Многие файлы должны быть перемещены в одно из следующих местоположений: <span class=filename>etc</span> (настроечные/конфигурационные файлы), <span class=filename>libexec</span> (выполнимые файлы, запускаемые из других программ), <span class=filename>sbin</span> (исполнимые файлы для администраторов/менеджеров системы), <span class=filename>info</span> (документация в формате info для просмотрщика info) или <span class=filename>share</span> (независимые от архитектуры файлы). Обратитесь к <a href="https://man.freebsd.org/cgi/man.cgi?query=hier&amp;sektion=7&amp;format=html">hier(7)</a> для прояснения деталей; правила, покрывающие <span class=filename>/usr</span>, достаточно хорошо подходят также и к <span class=filename>/usr/local</span>. Исключением являются порты, имеющие дело с "новостями" USENET. Они могут использовать каталог <span class=filename>PREFIX/news</span> для установки своих файлов.</p></div></div></div></div></div><hr><div class=last-modified><p><strong>Изменено</strong>: 9 марта 2024 г. by <a href="https://cgit.freebsd.org/doc/commit/?id=6199af92e7" target=_blank>Danilo G. Baio</a></p></div><div class=buttons><div class=prev><i class="fa fa-angle-left" aria-hidden=true title=Назад></i><div class=container><a href=http://172.16.201.134:1313/ru/books/porters-handbook/slow-porting class=direction>Назад</a></div></div><div class=home><i class="fa fa-home" aria-hidden=true title=Главная></i><div class=container><a href=../ class=direction>Главная</a></div></div><div class=next><div class=container><a href=http://172.16.201.134:1313/ru/books/porters-handbook/special class=direction>Далее</a></div><i class="fa fa-angle-right" aria-hidden=true title=Далее></i></div></div><label class="hidden book-menu-overlay" for=menu-control></label></div><aside class=toc><div class=toc-content><h3>Содержание</h3><nav id=TableOfContents><ul><li><a href=#makefile-source>5.1. Оригинальные исходный код</a></li><li><a href=#makefile-naming>5.2. Именование</a></li><li><a href=#makefile-categories>5.3. Разделение по категориям</a></li><li><a href=#makefile-distfiles>5.4. Дистрибутивные файлы</a></li><li><a href=#makefile-maintainer>5.5. <code>MAINTAINER</code></a></li><li><a href=#makefile-comment>5.6. <code>COMMENT</code></a></li><li><a href=#makefile-portscout>5.7. <code>PORTSCOUT</code></a></li><li><a href=#makefile-depend>5.8. Зависимости</a></li><li><a href=#makefile-masterdir>5.9. <code>MASTERDIR</code></a></li><li><a href=#makefile-manpages>5.10. Страницы Справочника</a></li><li><a href=#makefile-info>5.11. Файлы в формате info</a></li><li><a href=#makefile-options>5.12. Опции для Makefile</a></li><li><a href=#makefile-wrkdir>5.13. Задание рабочего каталога</a></li><li><a href=#conflicts>5.14. Разрешение конфликтов</a></li><li><a href=#install>5.15. Установка файлов</a></li></ul></nav><hr><div class=resources><h3>Материалы</h3><ul class=contents><li><i class="fa fa-file-pdf-o" aria-hidden=true title="Скачать PDF"></i><a href=https://download.freebsd.org/doc/ru/books/porters-handbook/porters-handbook_ru.pdf>Скачать PDF</a></li><li><i class="fa fa-pencil-square-o" aria-hidden=true title="Редактировать эту страницу"></i><a href=https://github.com/freebsd/freebsd-doc/blob/main/documentation/content/ru/_index target=_blank>Редактировать эту страницу</a></li></ul></div></div></aside><a class=to-top href=#top><i class="fa fa-arrow-circle-up" aria-hidden=true></i></a></main><footer><div class=footer-container><section class=logo-column><img src=http://172.16.201.134:1313/images/FreeBSD-colors.svg width=160 height=50 alt="FreeBSD logo"><div class=options-container><div class=language-container><a id=languages href=http://172.16.201.134:1313/ru/languages><img src=http://172.16.201.134:1313/images/language.png class=language-image alt="Выберите язык">
<span>Русский</span></a></div><div class=theme-container><select id=theme-chooser><option value=theme-system>Система</option><option value=theme-light>Светлый</option><option value=theme-dark>Тёмный</option><option value=theme-high-contrast>Высокая контрастность</option></select></div></div></section><section class=about-column><h3 class=column-title>О нас</h3><ul class=column-elements-container><li><a href=https://www.freebsd.org/about/ target=_blank class=column-element>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/ target=_blank class=column-element>Фонд FreeBSD</a></li><li><a href=https://www.freebsd.org/where/ target=_blank class=column-element>Получить FreeBSD</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct target=_blank class=column-element>Кодекс Этики</a></li><li><a href=https://www.freebsd.org/security/ target=_blank class=column-element>Бюллетени Безопасности</a></li></ul></section><section class=documentation-column><h3 class=column-title>Документация</h3><ul class=column-elements-container><li><a href=/ru class=column-element>Портал документации</a></li><li><a href=https://man.FreeBSD.org target=_blank class=column-element>Страницы Справочника</a></li><li><a href=https://papers.FreeBSD.org target=_blank class=column-element>Презентации и публикации</a></li><li><a href=https://docs-archive.freebsd.org/doc/ target=_blank class=column-element>Предыдущие версии</a></li><li><a href=https://docs-archive.freebsd.org/44doc/ target=_blank class=column-element>Документы 4.4BSD</a></li><li><a href=https://wiki.freebsd.org/ target=_blank class=column-element>Wiki</a></li></ul></section><section class=community-column><h3 class=column-title>Сообщество</h3><ul class=column-elements-container><li><a href=http://172.16.201.134:1313/ru/articles/contributing class=column-element>Принять участие</a></li><li><a href=https://forums.freebsd.org/ target=_blank class=column-element>Форум Сообщества</a></li><li><a href=https://lists.freebsd.org/ target=_blank class=column-element>Списки рассылки</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank class=column-element>Каналы IRC</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank class=column-element>Трекер ошибок</a></li></ul></section><section class=legal-column><h3 class=column-title>Юридическая информация</h3><ul class=column-elements-container><li><a href=https://freebsdfoundation.org/donate/ target=_blank class=column-element>Пожертвования</a></li><li><a href=https://www.freebsd.org/copyright/freebsd-license/ target=_blank class=column-element>Лицензирование</a></li><li><a href=https://www.freebsd.org/privacy/ target=_blank class=column-element>Политика Конфиденциальности</a></li><li><a href=https://www.freebsd.org/copyright/ target=_blank class=column-element>Юридические оговорки</a></li></ul></section><section class=copyright-column><p>&copy; 1994-2024 Проект FreeBSD. Все права защищены</p><span>Сделано с помощью <span class=heart>♥</span> Сообществом FreeBSD</span></section></div></footer></body></html>