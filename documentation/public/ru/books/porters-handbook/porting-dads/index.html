<!doctype html><html class=theme-light lang=ru><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content><meta name=copyright content="1995-2024 The FreeBSD Foundation"><link rel=canonical href=http://172.16.201.134:1313/ru/books/porters-handbook/porting-dads/><title>Глава 12. Что делать нужно, и что делать нельзя | FreeBSD Documentation Portal</title>
<meta name=theme-color content="#790000"><meta name=color-scheme content="system light dark high-contrast"><link rel="shortcut icon" href=http://172.16.201.134:1313/favicon.ico><link rel=stylesheet href=http://172.16.201.134:1313/styles/main.min.css><link rel=stylesheet href=http://172.16.201.134:1313/css/font-awesome-min.css><script defer src=/js/theme-chooser.min.js></script><script defer src=/js/copy-clipboard.min.js></script><script defer src=/js/search.min.js></script><meta name=twitter:card content="summary"><meta name=twitter:domain content="docs.FreeBSD.org"><meta name=twitter:site content="@freebsd"><meta name=twitter:url content="https://twitter.com/freebsd"><meta property="og:title" content="Глава 12. Что делать нужно, и что делать нельзя"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:image" content="http://172.16.201.134:1313/favicon.ico"><meta property="og:image:alt" content="FreeBSD Logo"><meta property="og:locale" content="ru"><meta property="og:url" content="http://172.16.201.134:1313/ru/books/porters-handbook/porting-dads/"><meta property="og:site_name" content="FreeBSD Documentation Portal"><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","url":"http:\/\/172.16.201.134:1313\/ru\/books\/porters-handbook\/porting-dads\/","name":"FreeBSD Documentation Portal","headline":"FreeBSD Documentation Portal","description":"FreeBSD Documentation Portal"}</script></head><body><header><div class=header-container><div class=logo-menu-bars-container><a href=https://www.FreeBSD.org class=logo><img src=http://172.16.201.134:1313/images/FreeBSD-monochromatic.svg width=160 height=50 alt="FreeBSD logo">
</a><label class=menu-bars for=menu-bars><i class="fa fa-bars" aria-hidden=true></i></label></div><input id=menu-bars type=checkbox><nav><ul class=menu><li class=menu-item><input id=about type=checkbox>
<a href=# aria-label="Navigate to About section"><label class=menu-item-description for=about>О нас
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/about/ target=_blank>О нас</a></li><li><a href=https://www.freebsd.org/about/ target=_blank>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/about-us/about-the-foundation/ target=_blank>Фонд FreeBSD</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct/ target=_blank>Кодекс Этики</a></li></ul></li><li class=menu-item><input id=download type=checkbox>
<a href=# aria-label="Navigate to get FreeBSD section"><label class=menu-item-description for=download>Получить FreeBSD
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/where/ target=_blank>Получить FreeBSD</a></li><li><a href=https://www.freebsd.org/releases/ target=_blank>Информация о релизах</a></li><li><a href=https://www.freebsd.org/releng/ target=_blank>Подготовка релизов</a></li><li><a href=https://www.freebsd.org/security/ target=_blank>Бюллетени Безопасности</a></li></ul></li><li class=menu-item><input id=documentation type=checkbox>
<a href=# aria-label="Navigate to get Documentation section"><label class=menu-item-description for=documentation>Документация
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=/ru>Портал документации</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook>Руководство</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook>Руководство по созданию портов</a></li><li><a href=https://docs.FreeBSD.org/en/books/fdp-primer>Учебник Проекта Документирования</a></li><li><a href=https://man.FreeBSD.org target=_blank>Страницы Справочника</a></li><li><a href=https://papers.FreeBSD.org target=_blank>Презентации и публикации</a></li><li><a href=https://wiki.FreeBSD.org target=_blank>Wiki</a></li><li><a href=http://172.16.201.134:1313/ru/books>Книги</a></li><li><a href=http://172.16.201.134:1313/ru/articles>Статьи</a></li></ul></li><li class=menu-item><input id=community type=checkbox>
<a href=# aria-label="Navigate to get Community section"><label class=menu-item-description for=community>Сообщество
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/community/>Сообщество</a></li><li><a href=http://172.16.201.134:1313/ru/articles/contributing>Стать участником</a></li><li><a href=https://forums.freebsd.org/ target=_blank>Форум</a></li><li><a href=https://lists.freebsd.org/ target=_blank>Списки рассылки</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank>Каналы IRC</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank>Трекер ошибок</a></li><li><a href=https://www.freebsd.org/support/ target=_blank>Поддержка</a></li></ul></li></ul></nav><div class=search-donate-container><form class=search method=get id=search-header-form action=https://docs.freebsd.org/search name=search-header-form><input type=hidden name=DB value=ru>
<input id=words name=P type=text size=20 maxlength=255>
<button>
<i class="fa fa-search" aria-hidden=true></i></button></form><div class=donate><a href=https://freebsdfoundation.org/donate/ target=_blank><span class=heart>♥</span>
Пожертвования</a></div></div></div></header><input type=checkbox class="hidden toggle" id=menu-control><main class=main-wrapper-book><a id=top></a><aside class=book-menu><div class=book-menu-content><input id=search-book type=text placeholder=Поиск aria-label=Поиск maxlength=128><nav id=MenuContents><ul><li><input type=checkbox id=chapter-c934186a5adac4f64b993f751abed30c class=toggle>
<label for=chapter-c934186a5adac4f64b993f751abed30c><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/porters-handbook/porting-why/>Глава 1. Введение</a></li><li><input type=checkbox id=chapter-2798d78fe854f2709bab5ca473b97050 class=toggle>
<label for=chapter-2798d78fe854f2709bab5ca473b97050><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/porters-handbook/new-port/>Глава 2. Как самому сделать новый порт</a></li><li><input type=checkbox id=chapter-c0d52b9121b517084e01f59cefa725e1 class=toggle>
<label class="icon cursor" for=chapter-c0d52b9121b517084e01f59cefa725e1><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/porters-handbook/quick-porting/>Глава 3. Быстрое портирование</a><ul><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/quick-porting/#porting-makefile>3.1. Создание файла <span class=filename>Makefile</span></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/quick-porting/#porting-desc>3.2. Создание информационных файлов</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/quick-porting/#porting-checksum>3.3. Создание файла с контрольной суммой</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/quick-porting/#porting-testing>3.4. Тестирование порта</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/quick-porting/#porting-portlint>3.5. Проверка вашего порта утилитой <code>portlint</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/quick-porting/#porting-submitting>3.6. Посылка нового порта</a></li></ul></li><li><input type=checkbox id=chapter-3694de03923da61ba10a0a25efca6ef0 class=toggle>
<label class="icon cursor" for=chapter-3694de03923da61ba10a0a25efca6ef0><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/porters-handbook/slow-porting/>Глава 4. Медленное портирование</a><ul><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/slow-porting/#slow-work>4.1. Как всё это работает</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/slow-porting/#slow-sources>4.2. Получение исходного кода</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/slow-porting/#slow-modifying>4.3. Модификация порта</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/slow-porting/#slow-patch>4.4. Создание патчей</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/slow-porting/#slow-configure>4.5. Конфигурирование</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/slow-porting/#slow-user-input>4.6. Обработка пользовательского ввода</a></li></ul></li><li><input type=checkbox id=chapter-165f6a6dba6651f8c25fc63ab83d6538 class=toggle>
<label class="icon cursor" for=chapter-165f6a6dba6651f8c25fc63ab83d6538><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/porters-handbook/makefiles/>Глава 5. Настройка файла Makefile</a><ul><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/makefiles/#makefile-source>5.1. Оригинальные исходный код</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/makefiles/#makefile-naming>5.2. Именование</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/makefiles/#makefile-categories>5.3. Разделение по категориям</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/makefiles/#makefile-distfiles>5.4. Дистрибутивные файлы</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/makefiles/#makefile-maintainer>5.5. <code>MAINTAINER</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/makefiles/#makefile-comment>5.6. <code>COMMENT</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/makefiles/#makefile-portscout>5.7. <code>PORTSCOUT</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/makefiles/#makefile-depend>5.8. Зависимости</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/makefiles/#makefile-masterdir>5.9. <code>MASTERDIR</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/makefiles/#makefile-manpages>5.10. Страницы Справочника</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/makefiles/#makefile-info>5.11. Файлы в формате info</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/makefiles/#makefile-options>5.12. Опции для Makefile</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/makefiles/#makefile-wrkdir>5.13. Задание рабочего каталога</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/makefiles/#conflicts>5.14. Разрешение конфликтов</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/makefiles/#install>5.15. Установка файлов</a></li></ul></li><li><input type=checkbox id=chapter-19e3150e00beb84341d8ac1a73936ef0 class=toggle>
<label class="icon cursor" for=chapter-19e3150e00beb84341d8ac1a73936ef0><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/porters-handbook/special/>Глава 6. Особые соглашения</a><ul><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/special/#staging>6.1. Staging</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/special/#porting-shlibs>6.2. Динамические библиотеки</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/special/#porting-restrictions>6.3. Порты с ограничениями на распространение или с правовым обременением</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/special/#building>6.4. Механизмы построения</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/special/#using-autotools>6.5. Использование GNU Autotools</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/special/#using-gettext>6.6. Использование GNU <code>gettext</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/special/#using-perl>6.7. Использование Perl</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/special/#using-x11>6.8. Использование X11</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/special/#using-gnome>6.9. Использование GNOME</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/special/#using-qt>6.10. Использование Qt</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/special/#using-kde>6.11. Использование KDE</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/special/#using-java>6.12. Использование Java</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/special/#using-php>6.13. Веб-приложения, Apache и PHP</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/special/#using-python>6.14. Использование Python</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/special/#using-tcl>6.15. Использование Tcl/Tk</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/special/#using-emacs>6.16. Использование Emacs</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/special/#using-ruby>6.17. Использование Ruby</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/special/#using-sdl>6.18. Использование SDL</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/special/#using-wx>6.19. Использование wxWidgets</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/special/#using-lua>6.20. Использование Lua</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/special/#using-iconv>6.21. Использование <code>iconv</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/special/#using-xfce>6.22. Использование Xfce</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/special/#using-mozilla>6.23. Использование Mozilla</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/special/#using-databases>6.24. Использование баз данных</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/special/#rc-scripts>6.25. Запуск и остановка служб (сценарии <code>rc</code>)</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/special/#users-and-groups>6.26. Добавление пользователей и групп</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/special/#requiring-kernel-sources>6.27. Порты, требующие наличия исходных текстов ядра</a></li></ul></li><li><input type=checkbox id=chapter-154554011c772e1e6cc0108eef5e0b2b class=toggle>
<label class="icon cursor" for=chapter-154554011c772e1e6cc0108eef5e0b2b><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/porters-handbook/plist/>Глава 7. Продвинутые практики pkg-plist</a><ul><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/plist/#plist-sub>7.1. Изменение содержимого <span class=filename>pkg-plist</span> в зависимости от make-переменных</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/plist/#plist-cleaning>7.2. Пустые каталоги</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/plist/#plist-config>7.3. Конфигурационные файлы</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/plist/#plist-dynamic>7.4. Динамический или статический список упаковки</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/plist/#plist-autoplist>7.5. Автоматическое создание списка упаковки</a></li></ul></li><li><input type=checkbox id=chapter-5955b0791ccd51005b5bc5bebeec91e5 class=toggle>
<label class="icon cursor" for=chapter-5955b0791ccd51005b5bc5bebeec91e5><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/porters-handbook/pkg-files/>Глава 8. Файлы pkg-*</a><ul><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/pkg-files/#porting-message>8.1. <span class=filename>pkg-message</span></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/pkg-files/#pkg-install>8.2. <span class=filename>pkg-install</span></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/pkg-files/#pkg-deinstall>8.3. <span class=filename>pkg-deinstall</span></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/pkg-files/#pkg-names>8.4. Изменение имён файлов <span class=filename>pkg-*</span></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/pkg-files/#using-sub-files>8.5. Использование <code>SUB_FILES</code> и <code>SUB_LIST</code></a></li></ul></li><li><input type=checkbox id=chapter-ee86a11caedb6395ed82b94ec7a9c6cd class=toggle>
<label class="icon cursor" for=chapter-ee86a11caedb6395ed82b94ec7a9c6cd><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/porters-handbook/testing/>Глава 9. Тестирование вашего порта</a><ul><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/testing/#make-describe>9.1. Запуск <code>make describe</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/testing/#testing-portlint>9.2. Portlint</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/testing/#testing-porttools>9.3. Port Tools</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/testing/#porting-prefix>9.4. <code>PREFIX</code> и <code>DESTDIR</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/testing/#testing-tinderbox>9.5. Tinderbox</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/testing/#testing-poudriere>9.6. Poudriere</a></li></ul></li><li><input type=checkbox id=chapter-4ccaefe2590c044ca2b79c46e79fe17f class=toggle>
<label class="icon cursor" for=chapter-4ccaefe2590c044ca2b79c46e79fe17f><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/porters-handbook/upgrading/>Глава 10. Обновление отдельного порта</a><ul><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/upgrading/#svn-diff>10.1. Использование Subversion для создания патчей</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/upgrading/#moved-and-updating-files>10.2. Файлы <span class=filename>UPDATING</span> и <span class=filename>MOVED</span></a></li></ul></li><li><input type=checkbox id=chapter-1023911bc0041506653280b832dea3b2 class=toggle>
<label class="icon cursor" for=chapter-1023911bc0041506653280b832dea3b2><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/porters-handbook/security/>Глава 11. Безопасность портов</a><ul><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/security/#security-intro>11.1. Почему безопасность так важна</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/security/#security-fix>11.2. Исправление уязвимостей безопасности</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/security/#security-notify>11.3. Обеспечение сообщества информацией</a></li></ul></li><li><input type=checkbox id=chapter-9a8875d5d59aa92f1e5a78e9ecd1fbe7 class=toggle checked>
<label class="icon cursor" for=chapter-9a8875d5d59aa92f1e5a78e9ecd1fbe7><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/porters-handbook/porting-dads/>Глава 12. Что делать нужно, и что делать нельзя</a><ul><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/porting-dads/#dads-intro>12.1. Введение</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/porting-dads/#porting-wrkdir>12.2. <code>WRKDIR</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/porting-dads/#porting-wrkdirprefix>12.3. <code>WRKDIRPREFIX</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/porting-dads/#porting-versions>12.4. Различение операционных систем и версий ОС</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/porting-dads/#dads-after-port-mk>12.5. Написание чего-либо после <span class=filename>bsd.port.mk</span></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/porting-dads/#dads-sh-exec>12.6. Использование выражения <code>exec</code> в сценариях обёртках</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/porting-dads/#dads-rational>12.7. Поступайте разумно</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/porting-dads/#dads-cc>12.8. Работа как с <code>CC</code>, так и <code>CXX</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/porting-dads/#dads-cflags>12.9. Использование <code>CFLAGS</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/porting-dads/#dads-pthread>12.10. Библиотеки потоков</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/porting-dads/#dads-feedback>12.11. Пожелания</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/porting-dads/#dads-readme>12.12. <span class=filename>README.html</span></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/porting-dads/#dads-noinstall>12.13. Пометка неустанавливаемого порта как <code>BROKEN</code>, <code>FORBIDDEN</code> или <code>IGNORE</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/porting-dads/#dads-deprecated>12.14. Пометка порта на удаление с <code>DEPRECATED</code> или <code>EXPIRATION_DATE</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/porting-dads/#dads-dot-error>12.15. Избегайте использования конструкции <code>.error</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/porting-dads/#dads-sysctl>12.16. Использование <span class=filename>sysctl</span></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/porting-dads/#dads-rerolling-distfiles>12.17. Меняющиеся дистрибутивные файлы</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/porting-dads/#dads-avoiding-linuxisms>12.18. Избегание линуксизмов</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/porting-dads/#dads-misc>12.19. Разное</a></li></ul></li><li><input type=checkbox id=chapter-5ef4c4c471a3f55c74fb71881f9d8713 class=toggle>
<label for=chapter-5ef4c4c471a3f55c74fb71881f9d8713><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/porters-handbook/porting-samplem/>Глава 13. Примерный Makefile</a></li><li><input type=checkbox id=chapter-70f5a4755700a24529175d26e65871bf class=toggle>
<label class="icon cursor" for=chapter-70f5a4755700a24529175d26e65871bf><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/porters-handbook/keeping-up/>Глава 14. Актуализация</a><ul><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/keeping-up/#freshports>14.1. FreshPorts</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/keeping-up/#svnweb>14.2. Web-интерфейс к хранилищу исходных текстов</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/keeping-up/#ports-mailing-list>14.3. Список рассылки FreeBSD, посвящённый портам</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/keeping-up/#build-cluster>14.4. Кластер построения портов FreeBSD</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/keeping-up/#distfile-survey>14.5. Portscout: сканер дистрибутивных файлов портов FreeBSD</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/keeping-up/#portsmon>14.6. Система мониторинга портов FreeBSD</a></li></ul></li><li><input type=checkbox id=chapter-8225273087f0e195be28132f4b5a0562 class=toggle>
<label class="icon cursor" for=chapter-8225273087f0e195be28132f4b5a0562><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/>Глава 15. Значения USES</a><ul><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-intro>15.1. An Introduction to <code>USES</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-7z>15.2. <code>7z</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-ada>15.3. <code>ada</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-autoreconf>15.4. <code>autoreconf</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-blaslapack>15.5. <code>blaslapack</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-bdb>15.6. <code>bdb</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-bison>15.7. <code>bison</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-cabal>15.8. <code>cabal</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-cargo>15.9. <code>cargo</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-charsetfix>15.10. <code>charsetfix</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-cmake>15.11. <code>cmake</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-compiler>15.12. <code>compiler</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-cpe>15.13. <code>cpe</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-cran>15.14. <code>cran</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-desktop-file-utils>15.15. <code>desktop-file-utils</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-desthack>15.16. <code>desthack</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-display>15.17. <code>display</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-dos2unix>15.18. <code>dos2unix</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-drupal>15.19. <code>drupal</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-eigen>15.20. <code>eigen</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-fakeroot>15.21. <code>fakeroot</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-fam>15.22. <code>fam</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-firebird>15.23. <code>firebird</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-fonts>15.24. <code>fonts</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-fortran>15.25. <code>fortran</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-fuse>15.26. <code>fuse</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-gem>15.27. <code>gem</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-gettext>15.28. <code>gettext</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-gettext-runtime>15.29. <code>gettext-runtime</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-gettext-tools>15.30. <code>gettext-tools</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-ghostscript>15.31. <code>ghostscript</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-gl>15.32. <code>gl</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-gmake>15.33. <code>gmake</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-gnome>15.34. <code>gnome</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-go>15.35. <code>go</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-gperf>15.36. <code>gperf</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-grantlee>15.37. <code>grantlee</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-groff>15.38. <code>groff</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-gssapi>15.39. <code>gssapi</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-horde>15.40. <code>horde</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-iconv>15.41. <code>iconv</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-imake>15.42. <code>imake</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-kde>15.43. <code>kde</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-kmod>15.44. <code>kmod</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-lha>15.45. <code>lha</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-libarchive>15.46. <code>libarchive</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-libedit>15.47. <code>libedit</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-libtool>15.48. <code>libtool</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-linux>15.49. <code>linux</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-localbase>15.50. <code>localbase</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-lua>15.51. <code>lua</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-lxqt>15.52. <code>lxqt</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-makeinfo>15.53. <code>makeinfo</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-makeself>15.54. <code>makeself</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-mate>15.55. <code>mate</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-meson>15.56. <code>meson</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-metaport>15.57. <code>metaport</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-mysql>15.58. <code>mysql</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-mono>15.59. <code>mono</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-motif>15.60. <code>motif</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-ncurses>15.61. <code>ncurses</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-ninja>15.62. <code>ninja</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-objc>15.63. <code>objc</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-openal>15.64. <code>openal</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-pathfix>15.65. <code>pathfix</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-pear>15.66. <code>pear</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-perl5>15.67. <code>perl5</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-pgsql>15.68. <code>pgsql</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-php>15.69. <code>php</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-pkgconfig>15.70. <code>pkgconfig</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-pure>15.71. <code>pure</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-pyqt>15.72. <code>pyqt</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-python>15.73. <code>python</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-qmail>15.74. <code>qmail</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-qmake>15.75. <code>qmake</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-qt>15.76. <code>qt</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-qt-dist>15.77. <code>qt-dist</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-readline>15.78. <code>readline</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-samba>15.79. <code>samba</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-scons>15.80. <code>scons</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-shared-mime-info>15.81. <code>shared-mime-info</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-shebangfix>15.82. <code>shebangfix</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-sqlite>15.83. <code>sqlite</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-ssl>15.84. <code>ssl</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-tar>15.85. <code>tar</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-tcl>15.86. <code>tcl</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-terminfo>15.87. <code>terminfo</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-tk>15.88. <code>tk</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-uidfix>15.89. <code>uidfix</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-uniquefiles>15.90. <code>uniquefiles</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-varnish>15.91. <code>varnish</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-webplugin>15.92. <code>webplugin</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-xfce>15.93. <code>xfce</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-xorg>15.94. <code>xorg</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-xorg-cat>15.95. <code>xorg-cat</code></a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/uses/#uses-zip>15.96. <code>zip</code></a></li></ul></li><li><input type=checkbox id=chapter-7713ccc63287693c9be6c832b2c1e850 class=toggle>
<label class="icon cursor" for=chapter-7713ccc63287693c9be6c832b2c1e850><a role=button></a></label><a href=http://172.16.201.134:1313/ru/books/porters-handbook/versions/>Глава 16. Значения __FreeBSD_version</a><ul><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/versions/#versions-13>16.1. FreeBSD 13 Versions</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/versions/#versions-12>16.2. FreeBSD 12 Versions</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/versions/#versions-11>16.3. FreeBSD 11 Versions</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/versions/#versions-10>16.4. FreeBSD 10 Versions</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/versions/#versions-9>16.5. FreeBSD 9 Versions</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/versions/#versions-8>16.6. FreeBSD 8 Versions</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/versions/#versions-7>16.7. FreeBSD 7 Versions</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/versions/#versions-6>16.8. FreeBSD 6 Versions</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/versions/#versions-5>16.9. FreeBSD 5 Versions</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/versions/#versions-4>16.10. FreeBSD 4 Versions</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/versions/#versions-3>16.11. FreeBSD 3 Versions</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/versions/#versions-2.2>16.12. FreeBSD 2.2 Versions</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook/versions/#versions-2>16.13. FreeBSD 2 Before 2.2-RELEASE Versions</a></li></ul></li><li></li></ul></nav></div></aside><div class=book><div class=book-menu-mobile><label for=menu-control><span class=menu-control-button><i class="fa fa-list" aria-hidden=true title="Меню книг"></i>
Меню книг</span></label></div><h1 class=title>Глава 12. Что делать нужно, и что делать нельзя</h1><div class="admonitionblock note"><p><i class="fa fa-exclamation-circle" aria-hidden=true></i>
Этот перевод может быть устаревшим. Для того, чтобы помочь с переводом, пожалуйста, обратитесь к <a href=https://translate-dev.freebsd.org/ target=_blank>Сервер переводов FreeBSD</a>.</p></div><div class=toc-mobile><h3>Содержание</h3><nav id=TableOfContents><ul><li><a href=#dads-intro>12.1. Введение</a></li><li><a href=#porting-wrkdir>12.2. <code>WRKDIR</code></a></li><li><a href=#porting-wrkdirprefix>12.3. <code>WRKDIRPREFIX</code></a></li><li><a href=#porting-versions>12.4. Различение операционных систем и версий ОС</a></li><li><a href=#dads-after-port-mk>12.5. Написание чего-либо после <span class=filename>bsd.port.mk</span></a></li><li><a href=#dads-sh-exec>12.6. Использование выражения <code>exec</code> в сценариях обёртках</a></li><li><a href=#dads-rational>12.7. Поступайте разумно</a></li><li><a href=#dads-cc>12.8. Работа как с <code>CC</code>, так и <code>CXX</code></a></li><li><a href=#dads-cflags>12.9. Использование <code>CFLAGS</code></a></li><li><a href=#dads-pthread>12.10. Библиотеки потоков</a></li><li><a href=#dads-feedback>12.11. Пожелания</a></li><li><a href=#dads-readme>12.12. <span class=filename>README.html</span></a></li><li><a href=#dads-noinstall>12.13. Пометка неустанавливаемого порта как <code>BROKEN</code>, <code>FORBIDDEN</code> или <code>IGNORE</code></a></li><li><a href=#dads-deprecated>12.14. Пометка порта на удаление с <code>DEPRECATED</code> или <code>EXPIRATION_DATE</code></a></li><li><a href=#dads-dot-error>12.15. Избегайте использования конструкции <code>.error</code></a></li><li><a href=#dads-sysctl>12.16. Использование <span class=filename>sysctl</span></a></li><li><a href=#dads-rerolling-distfiles>12.17. Меняющиеся дистрибутивные файлы</a></li><li><a href=#dads-avoiding-linuxisms>12.18. Избегание линуксизмов</a></li><li><a href=#dads-misc>12.19. Разное</a></li></ul></nav></div><div class=book-content><div id=preamble><div class=sectionbody></div></div><div class=sect1><h2 id=dads-intro>12.1. Введение<a class=anchor href=#dads-intro></a></h2><div class=sectionbody><div class=paragraph><p>Вот список часто встречающихся действий, которые нужно и которые нельзя делать во время процесса портирования. Проверьте порт по этому списку, и также проверьте порты в <a href=http://www.FreeBSD.org/cgi/query-pr-summary.cgi?query>базе сообщений PR</a>, которые присланы другими людьми. Присылайте любые комментарии о портах, которые вы проверили, так, как это описано в статье о <a href=https://docs.freebsd.org/ru/articles/contributing/#CONTRIB-GENERAL>Сообщениях об ошибках и общих замечаниях</a>. Проверка портов в базе сообщений PR позволит нам быстрее коммиттить их и удостовериться, что вы знаете, что делаете.</p></div></div></div><div class=sect1><h2 id=porting-wrkdir>12.2. <code>WRKDIR</code><a class=anchor href=#porting-wrkdir></a></h2><div class=sectionbody><div class=paragraph><p>Не пишите ничего в файлы вне каталога <code>WRKDIR</code>. Каталог <code>WRKDIR</code> является единственным местом, которое гарантированно будет доступно для записи во время построения порта (обратитесь к главе об <a href=https://docs.freebsd.org/ru/books/handbook/ports#PORTS-CD>установке портов с CDROM</a> за примером построения портов из дерева, доступного только для чтения). Если вам нужно изменить какой-либо из файлов <span class=filename>pkg-*</span>, сделайте это, <a href=#porting-pkgfiles>переопределив переменную</a>, но не перезаписывая их.</p></div></div></div><div class=sect1><h2 id=porting-wrkdirprefix>12.3. <code>WRKDIRPREFIX</code><a class=anchor href=#porting-wrkdirprefix></a></h2><div class=sectionbody><div class=paragraph><p>Добейтесь того, чтобы ваш порт принимал во внимание значение переменной <code>WRKDIRPREFIX</code>. Большинство портов об этом не заботятся. В частности, если вы обращаетесь к каталогу <code>WRKDIR</code> другого порта, заметьте, что его правильным местоположением является <span class=filename>WRKDIRPREFIXPORTSDIR/subdir/name/work</span>, а не <span class=filename>PORTSDIR/subdir/work</span> или <span class=filename>.CURDIR/../../subdir/name/work</span> мли что-то подобное.</p></div><div class=paragraph><p>Кроме того, если вы сами задаете <code>WRKDIR</code>, то должны поставить перед ним знак <code>${WRKDIRPREFIX}${.CURDIR}</code>.</p></div></div></div><div class=sect1><h2 id=porting-versions>12.4. Различение операционных систем и версий ОС<a class=anchor href=#porting-versions></a></h2><div class=sectionbody><div class=paragraph><p>Вы можете встретиться с кодом, который требует модификаций или условной компиляции в зависимости от того, с какой версией FreeBSD Unix он работает. Предпочтительным способом отделения кода для версий FreeBSD является использование макросов __FreeBSD_version и __FreeBSD__, определённых в <a href="http://svnweb.freebsd.org/base/head/sys/sys/param.h?view=markup">sys/param.h</a>. Если этот файл не подключен, добавьте код</p></div><div class="literalblock programlisting"><div class=content><pre>#include &lt;sys/param.h&gt;</pre></div></div><div class=paragraph><p>в нужном месте файла <span class=filename>.c</span>.</p></div><div class=paragraph><p>__FreeBSD__ определён во всех версиях FreeBSD в качестве старшего номера версии системы. Например, в FreeBSD 9.x __FreeBSD__ определён со значением <code>9</code>.</p></div><div class="literalblock programlisting"><div class=content><pre>#if __FreeBSD__ &gt;= 9
#  if __FreeBSD_version &gt;= 901000
	 /* здесь особый код для версий 9.1+ */
#  endif
#endif</pre></div></div></div></div><div class=sect1><h2 id=dads-after-port-mk>12.5. Написание чего-либо после <span class=filename>bsd.port.mk</span><a class=anchor href=#dads-after-port-mk></a></h2><div class=sectionbody><div class=paragraph><p>Не пишите ничего после строки <code>.include &lt;bsd.port.mk></code>. Этой строки можно избежать, включив в где-то в середину вашего файла <span class=filename>Makefile</span> файл <span class=filename>bsd.port.pre.mk</span>, и файл <span class=filename>bsd.port.post.mk</span> в конец.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Вам нужно включить либо пару файлов <span class=filename>bsd.port.pre.mk</span>/<span class=filename>bsd.port.post.mk</span>, либо только <span class=filename>bsd.port.mk</span>; не используйте оба этих метода одновременно.</p></div></td></tr></tbody></table></div><div class=paragraph><p>В файле <span class=filename>bsd.port.pre.mk</span> определяются лишь несколько переменных, которые могут быть использованы в тестах из файла <span class=filename>Makefile</span>, в файле <span class=filename>bsd.port.post.mk</span> заданы остальные.</p></div><div class=paragraph><p>Вот некоторые важные переменные, определенные в файле <span class=filename>bsd.port.pre.mk</span> (это не полный список, для выяснения полного списка прочтите, пожалуйста, сам файл <span class=filename>bsd.port.mk</span>).</p></div><table class="tableblock frame-none grid-all stretch informaltable"><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">Переменная</th><th class="tableblock halign-left valign-top">Описание</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>ARCH</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Архитектура машины в виде, получаемом по команде <code>uname -m</code> (например, <code>i386</code>)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>OPSYS</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Тип операционной системы, получаемый по команде <code>uname -s</code> (например, <code>FreeBSD</code>)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>OSREL</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Версия релиза операционной системы (например, <code>2.1.5</code> или <code>2.2.7</code>)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>OSVERSION</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Версия операционной системы в виде числа, та же, что и <a href=#freebsd-versions><code>__FreeBSD_version</code></a>.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>LOCALBASE</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Корень дерева "local" (например, <code>/usr/local</code>)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><code>PREFIX</code></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Куда, собственно, устанавливается порт (обратитесь к <a href=#porting-prefix>подробной информации о <code>PREFIX</code></a>).</p></td></tr></tbody></table><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Если вы задаете переменную <code>MASTERDIR</code>, делайте это до подключения <span class=filename>bsd.port.pre.mk</span>.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Вот несколько примеров того, что вы можете написать после <span class=filename>bsd.port.pre.mk</span>:</p></div><div class="literalblock programlisting"><div class=content><pre># no need to compile lang/perl5 if perl5 is already in system
.if ${OSVERSION} &gt; 300003
BROKEN=	perl is in system
.endif</pre></div></div><div class=paragraph><p>Вы не забываете об использовании табуляции вместо пробелов после <code>BROKEN=</code>:-).</p></div></div></div><div class=sect1><h2 id=dads-sh-exec>12.6. Использование выражения <code>exec</code> в сценариях обёртках<a class=anchor href=#dads-sh-exec></a></h2><div class=sectionbody><div class=paragraph><p>Если порт устанавливает сценарий на языке shell, который служит для запуска другой программы, и если запуск этой программы является последним действием сценария, убедитесь, что запуск программы производится с использованием выражения <code>exec</code>, например:</p></div><div class="literalblock programlisting"><div class=content><pre>#!/bin/sh
exec %%LOCALBASE%%/bin/java -jar %%DATADIR%%/foo.jar &#34;$@&#34;</pre></div></div><div class=paragraph><p>Выражение <code>exec</code> заменяет процесс сценария на указанную программу. Если <code>exec</code> опущен, то процесс сценария во время работы программы остается в памяти, бесполезно потребляя системные ресурсы.</p></div></div></div><div class=sect1><h2 id=dads-rational>12.7. Поступайте разумно<a class=anchor href=#dads-rational></a></h2><div class=sectionbody><div class=paragraph><p>Файл <span class=filename>Makefile</span> должен выполнять действия просто и небеспричинно. Если вы можете сделать что-то на несколько строк короче или более читабельно, сделайте это. В качестве примеров можно привести использование конструкций <code>.if</code> утилиты make вместо соответствующей конструкции <code>if</code> командного процессора, ненужность переопределения цели <code>do-extract</code> при возможности переопределения <code>EXTRACT*</code> и использование <code>GNU_CONFIGURE</code> вместо <code>CONFIGURE_ARGS += --prefix=${PREFIX}</code>.</p></div><div class=paragraph><p>Если вы обнаружите, что для выполнения чего-то приходится писать много нового кода, то, пожалуйста, просмотрите файл <span class=filename>bsd.port.mk</span> на предмет того, не содержит ли он решение именно вашей проблемы. Хотя его трудно читать, имеется много проблем, выглядящих сложными, для которых файл <span class=filename>bsd.port.mk</span> уже содержит быстрое решение.</p></div></div></div><div class=sect1><h2 id=dads-cc>12.8. Работа как с <code>CC</code>, так и <code>CXX</code><a class=anchor href=#dads-cc></a></h2><div class=sectionbody><div class=paragraph><p>Порт должен принимать во внимание как переменную <code>CC</code>, так и <code>CXX</code>. Под этим мы подразумеваем, что порт ни в коем случае не должен устанавливать значения этих переменных, переопределяя имеющиеся значения; вместо этого можно добавлять нужные значения к уже имеющимся. Это связано с тем, что параметры построения, относящиеся ко всем портам, могут быть заданы глобально.</p></div><div class=paragraph><p>Если порты не учитывают значения этих переменных, добавьте строку <code>NO_PACKAGE=ignores either cc or cxx</code> в файл <span class=filename>Makefile</span>.</p></div><div class=paragraph><p>Далее следует пример файла <span class=filename>Makefile</span>, использующего как переменную <code>CC</code>, так и <code>CXX</code>. Обратите внимание на использование символов <code>?=</code>:</p></div><div class="literalblock programlisting"><div class=content><pre>CC?= gcc</pre></div></div><div class="literalblock programlisting"><div class=content><pre>CXX?= g++</pre></div></div><div class=paragraph><p>Вот пример, в котором не принимаются во внимание ни <code>CC</code>, ни <code>CXX</code>:</p></div><div class="literalblock programlisting"><div class=content><pre>CC= gcc</pre></div></div><div class="literalblock programlisting"><div class=content><pre>CXX= g++</pre></div></div><div class=paragraph><p>В системах FreeBSD обе переменные <code>CC</code> и <code>CXX</code> могут быть определены в файле <span class=filename>/etc/make.conf</span>. В первом примере задаётся значение, если оно ранее не было определено в <span class=filename>/etc/make.conf</span>, что сохраняет любые определения, данные на уровне системы в целом. Второй пример переопределяет всё, что было задано ранее.</p></div></div></div><div class=sect1><h2 id=dads-cflags>12.9. Использование <code>CFLAGS</code><a class=anchor href=#dads-cflags></a></h2><div class=sectionbody><div class=paragraph><p>Порт должен учитывать переменную <code>CFLAGS</code>. Под этим мы подразумеваем, что порт ни в коем случае не должен устанавливать значения этой переменной, переопределяя имеющиеся значения; вместо этого можно добавлять нужные значения к уже имеющимся. Это связано с тем, что параметры построения, относящиеся ко всем портам, могут быть заданы глобально.</p></div><div class=paragraph><p>Если порты не учитывают значения этой переменной, добавьте строку <code>NO_PACKAGE=ignores cflags</code> в файл <span class=filename>Makefile</span>.</p></div><div class=paragraph><p>Далее следует пример файла <span class=filename>Makefile</span>, использующего переменную <code>CFLAGS</code>. Обратите внимание на использование символов <code>+=</code>:</p></div><div class="literalblock programlisting"><div class=content><pre>CFLAGS+= -Wall -Werror</pre></div></div><div class=paragraph><p>А вот пример, в котором не учитывается значение переменной <code>CFLAGS</code>:</p></div><div class="literalblock programlisting"><div class=content><pre>CFLAGS= -Wall -Werror</pre></div></div><div class=paragraph><p>В системе FreeBSD переменная <code>CFLAGS</code> определена в файле <span class=filename>/etc/make.conf</span>. В первом примере к переменной <code>CFLAGS</code> добавляются дополнительные флаги, при этом сохраняются все определения, данные ранее на уровне системы. Во втором примере всё, что было задано ранее, игнорируется.</p></div><div class=paragraph><p>Из сторонних файлов <span class=filename>Makefile</span> следует удалить флаги оптимизации. Общесистемные флаги оптимизации находятся в системной переменной <code>CFLAGS</code>. Пример из немодифицированного <span class=filename>Makefile</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>CFLAGS= -O3 -funroll-loops -DHAVE_SOUND</pre></div></div><div class=paragraph><p>При использовании системных флагов оптимизации <span class=filename>Makefile</span> станет похожим на следующий пример:</p></div><div class="literalblock programlisting"><div class=content><pre>CFLAGS+= -DHAVE_SOUND</pre></div></div></div></div><div class=sect1><h2 id=dads-pthread>12.10. Библиотеки потоков<a class=anchor href=#dads-pthread></a></h2><div class=sectionbody><div class=paragraph><p>Во FreeBSD библиотека потоков обязана быть скомпонована с исполняемыми файлами с использованием специального флага <code>-pthread</code>. Если порт настаивает на прямой компоновке с <code>-lpthread</code>, создайте патч для использования <code>-pthread</code>.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Если построение порта заканчивается ошибкой <code>unrecognized option '-pthread'</code>, то может быть желательно использование <code>cc</code> в качестве компоновщика через установку <code>CONFIGURE_ENV</code> в <code>LD=$Cheng Cui &lt;<a href=mailto:cc@FreeBSD.org>cc@FreeBSD.org</a>></code>. Параметр <code>-pthread</code> напрямую командой <code>ld</code> не поддерживается.</p></div></td></tr></tbody></table></div></div></div><div class=sect1><h2 id=dads-feedback>12.11. Пожелания<a class=anchor href=#dads-feedback></a></h2><div class=sectionbody><div class=paragraph><p>Посылайте подходящие изменения/патчи автору/сопровождающему для включения в следующий релиз. Это только сделает вашу работу гораздо легче при выходе следующего релиза.</p></div></div></div><div class=sect1><h2 id=dads-readme>12.12. <span class=filename>README.html</span><a class=anchor href=#dads-readme></a></h2><div class=sectionbody><div class=paragraph><p><span class=filename>README.html</span> не является частью порта и генерируется при помощи <code>make readme</code>. Не включайте этот файл в патчи или коммиты.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Если не удается выполнить <code>make readme</code>, убедитесь, что значение по умолчанию <code>ECHO_MSG</code> не изменено внутри порта.</p></div></td></tr></tbody></table></div></div></div><div class=sect1><h2 id=dads-noinstall>12.13. Пометка неустанавливаемого порта как <code>BROKEN</code>, <code>FORBIDDEN</code> или <code>IGNORE</code><a class=anchor href=#dads-noinstall></a></h2><div class=sectionbody><div class=paragraph><p>В некоторых случаях пользователи не должны допускаться к установке порта. Для того, чтобы сообщить пользователю, что порт не следует устанавливать, имеется несколько <code>make</code>-переменных, которые могут быть использованы в файле <span class=filename>Makefile</span> порта. Значения следующих <code>make</code>-переменных будут причиной, возвращаемой пользователям, по которой порт отказывает в установке. Пожалуйста, используйте корректные <code>make</code>-переменные, так как каждая переменная make передает абсолютно различный смысл как для пользователей, так и для автоматизированных систем, которые полагаются на файлы <span class=filename>Makefile</span>, таких как <a href=#build-cluster>кластер построения портов</a>, <a href=#freshports>FreshPorts</a> и <a href=#portsmon>portsmon</a>.</p></div><div class=sect2><h3 id=dads-noinstall-variables>12.13.1. Переменные<a class=anchor href=#dads-noinstall-variables></a></h3><div class=ulist><ul><li><p><code>BROKEN</code> предназначена для портов, которые в настоящее время не компилируются, не устанавливаются или не удаляются правильно. Следует использовать, когда проблема считается временной.</p><div class=paragraph><p>В особых случаях кластер построения будет продолжать попытки собрать их, чтобы показать, решена ли основная проблема. (Однако, как правило, кластер запускается без этой возможности.)</p></div><div class=paragraph><p>В частности, используйте <code>BROKEN</code>, когда порт:</p></div><div class=ulist><ul><li><p>не компилируется</p></li><li><p>не выполняет процесс своей конфигурации или установки</p></li><li><p>устанавливает файлы вовне <span class=filename>${LOCALBASE}</span></p></li><li><p>не удаляет полностью все свои файлы при деинсталляции (тем не менее, это может быть допустимо, и подходит для портов, оставляющих после себя файлы, измененные пользователем)</p></li></ul></div></li><li><p><code>FORBIDDEN</code> используется для портов, которые содержат уязвимости в информационной безопасности или являются потенциально вредными в плане обеспечения информационной безопасности системы FreeBSD при установке данного порта (например: заведомо небезопасная программа или программа, которая предоставляет легко взламываемые сервисы). Порты должны помечаться как <code>FORBIDDEN</code>, как только в конкретном программном обеспечении обнаружилась уязвимость, но обновление выпущено не было. В идеальном случае порты должны обновляться максимально быстро после обнаружения уязвимости, чтобы уменьшить число уязвимых хостов FreeBSD (нам нравится иметь репутацию безопасной системы), однако иногда случается значительный временной разрыв между обнаружением уязвимости и выходом обновлённого релиза уязвимого программного обеспечения. Не помечайте порт как <code>FORBIDDEN</code>, если причина не вызвана соображениями информационной безопасности.</p></li><li><p><code>IGNORE</code> предназначена для портов, которые не должны строиться по какой-либо другой причине. Следует использовать для портов, в случае когда проблема считается структурной. Кластер построения ни при каких условиях не будет строить порты, помеченные как <code>IGNORE</code>. В частности, используйте <code>IGNORE</code>, когда порт:</p><div class=ulist><ul><li><p>компилируется, но работает неправильно</p></li><li><p>не работает на установленной версии FreeBSD</p></li><li><p>имеет дистрибутивный файл, который не может быть автоматически извлечен из-за лицензионных ограничений</p></li><li><p>не работает с каким-либо другим портом, установленным в настоящее время (например, порт зависит от <a class=package href=https://cgit.freebsd.org/ports/tree/www/apache20/>www/apache20</a>, но установлен <a class=package href=https://cgit.freebsd.org/ports/tree/www/apache22/>www/apache22</a>)</p></li></ul></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Если порт будет конфликтовать с уже установленным портом (например, если они устанавливают файл в то же место, но с иным функциональным назначением), то <a href=#conflicts>используйте вместо этого <code>CONFLICTS</code></a>. <code>CONFLICTS</code> сам установит значение <code>IGNORE</code>.</p></div></td></tr></tbody></table></div></li><li><p>Если порт нужно пометить как <code>IGNORE</code> только на некоторых архитектурах, для этого есть две другие удобные переменные, которые автоматически установят для вас значения: <code>ONLY_FOR_ARCHS</code> и <code>NOT_FOR_ARCHS</code>. Примеры:</p><div class="literalblock programlisting"><div class=content><pre>ONLY_FOR_ARCHS=	i386 amd64</pre></div></div><div class="literalblock programlisting"><div class=content><pre>NOT_FOR_ARCHS=	ia64 sparc64</pre></div></div><div class=paragraph><p>Собственное сообщение <code>IGNORE</code> можно задать с использованием <code>ONLY_FOR_ARCHS_REASON</code> и <code>NOT_FOR_ARCHS_REASON</code>. Отдельно для каждой архитектуры это возможно с использованием <code>ONLY_FOR_ARCHS_REASON_ARCH</code> и <code>NOT_FOR_ARCHS_REASON_ARCH</code>.</p></div></li><li><p>Если порт загружает и устанавливает исполняемые файлы i386, то следует установить <code>IA32_BINARY_PORT</code>. Если эта переменная установлена, будет выполнена проверка доступности каталога <span class=filename>/usr/lib32</span> для библиотек версии IA32 и поддержки IA32 в ядре. При невыполнении любого из этих условий будет автоматически установлена переменная <code>IGNORE</code>.</p></li></ul></div></div><div class=sect2><h3 id=dads-noinstall-notes>12.13.2. Замечания по реализации<a class=anchor href=#dads-noinstall-notes></a></h3><div class=paragraph><p>Строки не следует брать в кавычки. Также построение строки должно несколько различаться из-за способа отображения информации пользователю. Примеры:</p></div><div class="literalblock programlisting"><div class=content><pre>BROKEN=	fails to link with base -lcrypto</pre></div></div><div class="literalblock programlisting"><div class=content><pre>IGNORE=	unsupported on recent versions</pre></div></div><div class=paragraph><p>получаемые в результате следующего вывода <code>make describe</code>:</p></div><div class="literalblock programlisting"><div class=content><pre>===&gt;  foobar-0.1 is marked as broken: fails to link with base -lcrypto.</pre></div></div><div class="literalblock programlisting"><div class=content><pre>===&gt;  foobar-0.1 is unsupported on recent versions.</pre></div></div></div></div></div><div class=sect1><h2 id=dads-deprecated>12.14. Пометка порта на удаление с <code>DEPRECATED</code> или <code>EXPIRATION_DATE</code><a class=anchor href=#dads-deprecated></a></h2><div class=sectionbody><div class=paragraph><p>Помните, что <code>BROKEN</code> и <code>FORBIDDEN</code> будут использованы как временное средство, если порт не является работающим. Постоянно неработоспособные порты должны полностью удаляться из дерева.</p></div><div class=paragraph><p>В подходящих ситуациях пользователи могут быть оповещены о предстоящем удалении через переменные <code>DEPRECATED</code> и <code>EXPIRATION_DATE</code>. Первое - это просто строка, сообщающая причину запланированного удаления порта; вторая является строкой в формате ISO 8601 (YYYY-MM-DD). Обе будут показаны пользователю.</p></div><div class=paragraph><p>Переменную <code>DEPRECATED</code> можно установить без использования <code>EXPIRATION_DATE</code> (в частности, при рекомендации новой версии порта), но обратный порядок не имеет никакого смысла.</p></div><div class=paragraph><p>Не существует устоявшейся политики, как долго следует продолжать уведомления. Текущая практика дает около месяца для решения проблем безопасности и два месяца для проблем построения. Это также дает немного времени на исправление проблем любым заинтересованным коммиттерам.</p></div></div></div><div class=sect1><h2 id=dads-dot-error>12.15. Избегайте использования конструкции <code>.error</code><a class=anchor href=#dads-dot-error></a></h2><div class=sectionbody><div class=paragraph><p>Правильным способом подать сигнал для <span class=filename>Makefile</span> о том, что порт не может быть установлен из-за какого-то внешнего фактора (например, пользователь указал недопустимую комбинацию опций построения), является установка непустого значения для <code>IGNORE</code>. Это значение будет сформатировано и показано пользователю во время <code>make install</code>.</p></div><div class=paragraph><p>Использование для этих целей <code>.error</code> является распространенной ошибкой. Проблема в том, что в этой ситуации будут повреждены многие инструменты автоматизации, работающие с деревом портов. Наибольшим образом это распространено при попытке построить <span class=filename>/usr/ports/INDEX</span> (смотрите <a href=../testing/#make-describe>Запуск <code>make describe</code></a>). Тем не менее, даже более простые команды, такие как <code>make maintainer</code>, в этом случае также вернут ошибку. Это не является приемлемым.</p></div><div id=dot-error-breaks-index class=exampleblock><div class=title>Пример 1. Как избегать использования <code>.error</code></div><div class=content><div class=paragraph><p>Из следующих двух вариантов строки файла <span class=filename>Makefile</span> первый приведёт к неудачному завершению работы <code>make index</code>, а второй - нет:</p></div><div class="literalblock programlisting"><div class=content><pre>.error &#34;option is not supported&#34;</pre></div></div><div class="literalblock programlisting"><div class=content><pre>IGNORE=option is not supported</pre></div></div></div></div></div></div><div class=sect1><h2 id=dads-sysctl>12.16. Использование <span class=filename>sysctl</span><a class=anchor href=#dads-sysctl></a></h2><div class=sectionbody><div class=paragraph><p>Использование <span class=filename>sysctl</span> не рекомендуется, кроме как при выполнении целей. Это вызвано тем, что вычисление любых <code>makevar</code>, таких как во время команды <code>make index</code>, с необходимостью запуска этой команды, еще больше замедляет весь процесс.</p></div><div class=paragraph><p><a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a> следует всегда использовать через переменную <code>SYSCTL</code>, поскольку она содержит полностью заданный путь, и при необходимости может быть переопределена.</p></div></div></div><div class=sect1><h2 id=dads-rerolling-distfiles>12.17. Меняющиеся дистрибутивные файлы<a class=anchor href=#dads-rerolling-distfiles></a></h2><div class=sectionbody><div class=paragraph><p>Иногда авторы программного обеспечения меняют содержимое выпущенных дистрибутивных файлов без смены названия. Вы должны проверять, что изменения являются официальными и произведены автором. В прошлом бывало, что дистрибутивный файл молча изменялся на сайтах загрузки с намерением нанести вред или скомпрометировать безопасность конечного пользователя.</p></div><div class=paragraph><p>Отложите старый файл с дистрибутивом в сторону, загрузите новый, распакуйте его и сравните содержимое при помощи <a href="https://man.freebsd.org/cgi/man.cgi?query=diff&amp;sektion=1&amp;format=html">diff(1)</a>. Если вы не видите ничего подозрительного, то можете обновить файл <span class=filename>distinfo</span>. Убедитесь, что вы подытожили различия в вашем PR или описании коммита, чтобы другие люди были в курсе, что вы позаботились о том, что ничего плохого не случилось.</p></div><div class=paragraph><p>Возможно вы также захотите связаться с автором этого программного обеспечения для подтверждения изменений.</p></div></div></div><div class=sect1><h2 id=dads-avoiding-linuxisms>12.18. Избегание линуксизмов<a class=anchor href=#dads-avoiding-linuxisms></a></h2><div class=sectionbody><div class=paragraph><p>Не используйте <span class=filename>/proc</span>, если доступны любые другие источники получения информации, например, <code>setprogname(argv[0])</code> в <code>main()</code> и <a href="https://man.freebsd.org/cgi/man.cgi?query=getprogname&amp;sektion=3&amp;format=html">getprogname(3)</a>, в случае если вы хотите "знать своё имя".</p></div><div class=paragraph><p>Не полагайтесь на поведение, не регламентированное POSIX.</p></div><div class=paragraph><p>Не выполняйте запись временных меток в критических путях выполнения приложения, если можно обойтись без этого. Получение временных меток может быть медленным, в зависимости от степени точности используемых часов в операционной системе. Если временные метки действительно нужны, определите степень требуемой точности и используйте тот API, в котором документируется получение достаточной точности.</p></div><div class=paragraph><p>Ряд простых системных вызовов (например, <a href="https://man.freebsd.org/cgi/man.cgi?query=gettimeofday&amp;sektion=2&amp;format=html">gettimeofday(2)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=getpid&amp;sektion=2&amp;format=html">getpid(2)</a>) работают намного быстрее в Linux® по сравнению с любой другой операционной системой из-за кеширования и используемой оптимизации vsyscall. Не полагайтесь на их дешевизну в критичных к производительности приложениях. В целом, старайтесь избегать системных вызовов там, где это возможно.</p></div><div class=paragraph><p>Не полагайтесь на специфичное для Linux® поведение сокета. В частности, отличаются размеры буфера сокета по умолчанию (выполните вызов <a href="https://man.freebsd.org/cgi/man.cgi?query=setsockopt&amp;sektion=2&amp;format=html">setsockopt(2)</a> с <code>SO_SNDBUF</code> и <code>SO_RCVBUF</code>, и в то время как в Linux® при заполнении буфера сокета <a href="https://man.freebsd.org/cgi/man.cgi?query=send&amp;sektion=2&amp;format=html">send(2)</a> блокируется, FreeBSD возвращает ошибку и устанавливает <code>ENOBUFS</code> в качестве значения errno.</p></div><div class=paragraph><p>Если требуется рассчитывать на нестандартное поведение, инкапсулируйте это должным образом в общий для всех API с проверкой поведения на этапе конфигурации, и если требуемое поведение не найдено, прекращайте выполнение.</p></div><div class=paragraph><p>Используйте <a href=http://www.freebsd.org/cgi/man.cgi>страницы справочника</a> для проверки, относится ли функция к интерфейсу POSIX (ищите раздел "STANDARDS" на странице справочника).</p></div><div class=paragraph><p>Не рассчитывайте на то, что в качестве <span class=filename>/bin/sh</span> используется bash. Убедитесь, что командная строка, переданная в <a href="https://man.freebsd.org/cgi/man.cgi?query=system&amp;sektion=3&amp;format=html">system(3)</a>, будет работать в POSIX-совместимой оболочке.</p></div><div class=paragraph><p>Список основных bash-измов расположен <a href=https://wiki.ubuntu.com/DashAsBinSh>здесь</a>.</p></div><div class=paragraph><p>Проверьте, что используемые заголовочные файлы включены в POSIX или список, рекомендуемый страницей справочника, т.к. например, забыть подключить <span class=filename>sys/types.h</span> - не такая уж проблема в Linux®, однако это не так во FreeBSD.</p></div><div class=paragraph><p>Компилируйте многопоточные приложения с ключом "-pthread", а не "-lpthread" или как-либо ещё.</p></div></div></div><div class=sect1><h2 id=dads-misc>12.19. Разное<a class=anchor href=#dads-misc></a></h2><div class=sectionbody><div class=paragraph><p>Файлы <span class=filename>pkg-descr</span> и <span class=filename>pkg-plist</span> должны проверяться дважды. Если вы пересматриваете порт и думаете, что его можно описать иначе, сделайте это.</p></div><div class=paragraph><p>Пожалуйста, не создавайте дополнительных копий лицензии GNU General Public License в нашей системе.</p></div><div class=paragraph><p>Будьте внимательны с юридическими вопросами! Не делайте из нас нелегальных распространителей ПО!</p></div></div></div></div><hr><div class=last-modified><p><strong>Изменено</strong>: 9 марта 2024 г. by <a href="https://cgit.freebsd.org/doc/commit/?id=6199af92e7" target=_blank>Danilo G. Baio</a></p></div><div class=buttons><div class=prev><i class="fa fa-angle-left" aria-hidden=true title=Назад></i><div class=container><a href=http://172.16.201.134:1313/ru/books/porters-handbook/security class=direction>Назад</a></div></div><div class=home><i class="fa fa-home" aria-hidden=true title=Главная></i><div class=container><a href=../ class=direction>Главная</a></div></div><div class=next><div class=container><a href=http://172.16.201.134:1313/ru/books/porters-handbook/porting-samplem class=direction>Далее</a></div><i class="fa fa-angle-right" aria-hidden=true title=Далее></i></div></div><label class="hidden book-menu-overlay" for=menu-control></label></div><aside class=toc><div class=toc-content><h3>Содержание</h3><nav id=TableOfContents><ul><li><a href=#dads-intro>12.1. Введение</a></li><li><a href=#porting-wrkdir>12.2. <code>WRKDIR</code></a></li><li><a href=#porting-wrkdirprefix>12.3. <code>WRKDIRPREFIX</code></a></li><li><a href=#porting-versions>12.4. Различение операционных систем и версий ОС</a></li><li><a href=#dads-after-port-mk>12.5. Написание чего-либо после <span class=filename>bsd.port.mk</span></a></li><li><a href=#dads-sh-exec>12.6. Использование выражения <code>exec</code> в сценариях обёртках</a></li><li><a href=#dads-rational>12.7. Поступайте разумно</a></li><li><a href=#dads-cc>12.8. Работа как с <code>CC</code>, так и <code>CXX</code></a></li><li><a href=#dads-cflags>12.9. Использование <code>CFLAGS</code></a></li><li><a href=#dads-pthread>12.10. Библиотеки потоков</a></li><li><a href=#dads-feedback>12.11. Пожелания</a></li><li><a href=#dads-readme>12.12. <span class=filename>README.html</span></a></li><li><a href=#dads-noinstall>12.13. Пометка неустанавливаемого порта как <code>BROKEN</code>, <code>FORBIDDEN</code> или <code>IGNORE</code></a></li><li><a href=#dads-deprecated>12.14. Пометка порта на удаление с <code>DEPRECATED</code> или <code>EXPIRATION_DATE</code></a></li><li><a href=#dads-dot-error>12.15. Избегайте использования конструкции <code>.error</code></a></li><li><a href=#dads-sysctl>12.16. Использование <span class=filename>sysctl</span></a></li><li><a href=#dads-rerolling-distfiles>12.17. Меняющиеся дистрибутивные файлы</a></li><li><a href=#dads-avoiding-linuxisms>12.18. Избегание линуксизмов</a></li><li><a href=#dads-misc>12.19. Разное</a></li></ul></nav><hr><div class=resources><h3>Материалы</h3><ul class=contents><li><i class="fa fa-file-pdf-o" aria-hidden=true title="Скачать PDF"></i><a href=https://download.freebsd.org/doc/ru/books/porters-handbook/porters-handbook_ru.pdf>Скачать PDF</a></li><li><i class="fa fa-pencil-square-o" aria-hidden=true title="Редактировать эту страницу"></i><a href=https://github.com/freebsd/freebsd-doc/blob/main/documentation/content/ru/_index target=_blank>Редактировать эту страницу</a></li></ul></div></div></aside><a class=to-top href=#top><i class="fa fa-arrow-circle-up" aria-hidden=true></i></a></main><footer><div class=footer-container><section class=logo-column><img src=http://172.16.201.134:1313/images/FreeBSD-colors.svg width=160 height=50 alt="FreeBSD logo"><div class=options-container><div class=language-container><a id=languages href=http://172.16.201.134:1313/ru/languages><img src=http://172.16.201.134:1313/images/language.png class=language-image alt="Выберите язык">
<span>Русский</span></a></div><div class=theme-container><select id=theme-chooser><option value=theme-system>Система</option><option value=theme-light>Светлый</option><option value=theme-dark>Тёмный</option><option value=theme-high-contrast>Высокая контрастность</option></select></div></div></section><section class=about-column><h3 class=column-title>О нас</h3><ul class=column-elements-container><li><a href=https://www.freebsd.org/about/ target=_blank class=column-element>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/ target=_blank class=column-element>Фонд FreeBSD</a></li><li><a href=https://www.freebsd.org/where/ target=_blank class=column-element>Получить FreeBSD</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct target=_blank class=column-element>Кодекс Этики</a></li><li><a href=https://www.freebsd.org/security/ target=_blank class=column-element>Бюллетени Безопасности</a></li></ul></section><section class=documentation-column><h3 class=column-title>Документация</h3><ul class=column-elements-container><li><a href=/ru class=column-element>Портал документации</a></li><li><a href=https://man.FreeBSD.org target=_blank class=column-element>Страницы Справочника</a></li><li><a href=https://papers.FreeBSD.org target=_blank class=column-element>Презентации и публикации</a></li><li><a href=https://docs-archive.freebsd.org/doc/ target=_blank class=column-element>Предыдущие версии</a></li><li><a href=https://docs-archive.freebsd.org/44doc/ target=_blank class=column-element>Документы 4.4BSD</a></li><li><a href=https://wiki.freebsd.org/ target=_blank class=column-element>Wiki</a></li></ul></section><section class=community-column><h3 class=column-title>Сообщество</h3><ul class=column-elements-container><li><a href=http://172.16.201.134:1313/ru/articles/contributing class=column-element>Принять участие</a></li><li><a href=https://forums.freebsd.org/ target=_blank class=column-element>Форум Сообщества</a></li><li><a href=https://lists.freebsd.org/ target=_blank class=column-element>Списки рассылки</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank class=column-element>Каналы IRC</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank class=column-element>Трекер ошибок</a></li></ul></section><section class=legal-column><h3 class=column-title>Юридическая информация</h3><ul class=column-elements-container><li><a href=https://freebsdfoundation.org/donate/ target=_blank class=column-element>Пожертвования</a></li><li><a href=https://www.freebsd.org/copyright/freebsd-license/ target=_blank class=column-element>Лицензирование</a></li><li><a href=https://www.freebsd.org/privacy/ target=_blank class=column-element>Политика Конфиденциальности</a></li><li><a href=https://www.freebsd.org/copyright/ target=_blank class=column-element>Юридические оговорки</a></li></ul></section><section class=copyright-column><p>&copy; 1994-2024 Проект FreeBSD. Все права защищены</p><span>Сделано с помощью <span class=heart>♥</span> Сообществом FreeBSD</span></section></div></footer></body></html>