<!doctype html><html class=theme-light lang=ru><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content><meta name=copyright content="1995-2024 The FreeBSD Foundation"><link rel=canonical href=https://docs.freebsd.org/ru/books/developers-handbook/><title>Руководство FreeBSD для разработчиков | FreeBSD Documentation Portal</title>
<meta name=theme-color content="#790000"><meta name=color-scheme content="system light dark high-contrast"><link rel="shortcut icon" href=https://docs.freebsd.org/favicon.ico><link rel=stylesheet href=https://docs.freebsd.org/styles/main.min.css><link rel=stylesheet href=https://docs.freebsd.org/css/font-awesome-min.css><script defer src=/js/theme-chooser.min.js></script><script defer src=/js/copy-clipboard.min.js></script><script defer src=/js/search.min.js></script><meta name=twitter:card content="summary"><meta name=twitter:domain content="docs.FreeBSD.org"><meta name=twitter:site content="@freebsd"><meta name=twitter:url content="https://twitter.com/freebsd"><meta property="og:title" content="Руководство FreeBSD для разработчиков"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:image" content="https://docs.freebsd.org/favicon.ico"><meta property="og:image:alt" content="FreeBSD Logo"><meta property="og:locale" content="ru"><meta property="og:url" content="https://docs.freebsd.org/ru/books/developers-handbook/"><meta property="og:site_name" content="FreeBSD Documentation Portal"><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","url":"https:\/\/docs.freebsd.org\/ru\/books\/developers-handbook\/","name":"FreeBSD Documentation Portal","headline":"FreeBSD Documentation Portal","description":"FreeBSD Documentation Portal"}</script></head><body><header><div class=header-container><div class=logo-menu-bars-container><a href=https://www.FreeBSD.org class=logo><img src=https://docs.freebsd.org/images/FreeBSD-monochromatic.svg width=160 height=50 alt="FreeBSD logo">
</a><label class=menu-bars for=menu-bars><i class="fa fa-bars" aria-hidden=true></i></label></div><input id=menu-bars type=checkbox><nav><ul class=menu><li class=menu-item><input id=about type=checkbox>
<a href=# aria-label="Navigate to About section"><label class=menu-item-description for=about>О нас
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/about/ target=_blank>О нас</a></li><li><a href=https://www.freebsd.org/about/ target=_blank>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/about-us/about-the-foundation/ target=_blank>Фонд FreeBSD</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct/ target=_blank>Кодекс Этики</a></li></ul></li><li class=menu-item><input id=download type=checkbox>
<a href=# aria-label="Navigate to get FreeBSD section"><label class=menu-item-description for=download>Получить FreeBSD
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/where/ target=_blank>Получить FreeBSD</a></li><li><a href=https://www.freebsd.org/releases/ target=_blank>Информация о релизах</a></li><li><a href=https://www.freebsd.org/releng/ target=_blank>Подготовка релизов</a></li><li><a href=https://www.freebsd.org/security/ target=_blank>Бюллетени Безопасности</a></li></ul></li><li class=menu-item><input id=documentation type=checkbox>
<a href=# aria-label="Navigate to get Documentation section"><label class=menu-item-description for=documentation>Документация
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=/ru>Портал документации</a></li><li><a href=https://docs.freebsd.org/ru/books/handbook>Руководство</a></li><li><a href=https://docs.freebsd.org/ru/books/porters-handbook>Руководство по созданию портов</a></li><li><a href=https://docs.FreeBSD.org/en/books/fdp-primer>Учебник Проекта Документирования</a></li><li><a href=https://man.FreeBSD.org target=_blank>Страницы Справочника</a></li><li><a href=https://papers.FreeBSD.org target=_blank>Презентации и публикации</a></li><li><a href=https://wiki.FreeBSD.org target=_blank>Wiki</a></li><li><a href=https://docs.freebsd.org/ru/books>Книги</a></li><li><a href=https://docs.freebsd.org/ru/articles>Статьи</a></li></ul></li><li class=menu-item><input id=community type=checkbox>
<a href=# aria-label="Navigate to get Community section"><label class=menu-item-description for=community>Сообщество
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/community/>Сообщество</a></li><li><a href=https://docs.freebsd.org/ru/articles/contributing>Стать участником</a></li><li><a href=https://forums.freebsd.org/ target=_blank>Форум</a></li><li><a href=https://lists.freebsd.org/ target=_blank>Списки рассылки</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank>Каналы IRC</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank>Трекер ошибок</a></li><li><a href=https://www.freebsd.org/support/ target=_blank>Поддержка</a></li></ul></li></ul></nav><div class=search-donate-container><form class=search method=get id=search-header-form action=https://docs.freebsd.org/search name=search-header-form><input type=hidden name=DB value=ru>
<input id=words name=P type=text size=20 maxlength=255>
<button>
<i class="fa fa-search" aria-hidden=true></i></button></form><div class=donate><a href=https://freebsdfoundation.org/donate/ target=_blank><span class=heart>♥</span>
Пожертвования</a></div></div></div></header><input type=checkbox class="hidden toggle" id=menu-control><main class=main-wrapper-book><a id=top></a><div class=book><h1 class=title>Руководство FreeBSD для разработчиков</h1><div class="admonitionblock note"><p><i class="fa fa-exclamation-circle" aria-hidden=true></i>
Этот перевод может быть устаревшим. Для того, чтобы помочь с переводом, пожалуйста, обратитесь к <a href=https://translate-dev.freebsd.org/ target=_blank>Сервер переводов FreeBSD</a>.</p></div><div class=copyright>Copyright © 1995-2020 The FreeBSD Documentation Project</div><div class=legalnotice><a id=trademarks></a><details><summary>товарные знаки</summary><p>FreeBSD является зарегистрированным товарным знаком Фонда FreeBSD.</p><p>IBM, AIX, OS/2, PowerPC, PS/2, S/390 и ThinkPad являются товарными знаками International Business Machines Corporation в Соединённых Штатах, других странах, или по всему миру.</p><p>IEEE, POSIX и 802 являются зарегистрированными товарными знаками Institute of Electrical and Electronics Engineers, Inc. в Соединённых Штатах.</p><p>Apple, AirPort, FireWire, Mac, Macintosh, Mac OS, Quicktime и TrueType это торговые марки Apple Computer, Inc., зарегистрированные в Соединенных Штатах и других странах.</p><p>Intel, Celeron, EtherExpress, i386, i486, Itanium, Pentium и Xeon это торговые марки или зарегистрированные торговые марки Intel Corporation или ее дочерних компаний в Соединенных Штатах и других странах.</p><p>Linux является торговым знаком Linus Torvalds.</p><p>Microsoft, FrontPage, IntelliMouse, MS-DOS, Outlook, Windows, Windows Media и Windows NT это или зарегистрированные торговые марки или торговые марки Microsoft Corporation в Соединенных Штатах и/или других странах.</p><p>Motif, OSF/1 и UNIX это зарегистрированные торговые марки, а IT DialTone и The Open Group это торговые марки Open Group в Соединенных Штатах и других странах.</p><p>Sun, Sun Microsystems, Java, Java Virtual Machine, JDK, JRE, JSP, JVM, Netra, Solaris, StarOffice, SunOS это торговые марки или зарегистрированные торговые марки Sun Microsystems, Inc. в Соединенных Штатах и других странах.</p><p>Многие из обозначений, используемые производителями и продавцами для обозначения своих продуктов, заявляются в качестве товарных знаков. Когда такие обозначения появляются в этом документе, и Проекту FreeBSD известно о товарном знаке, к обозначению добавляется знак “™” или “®”.</p></details></div><div class=toc-mobile><h3>Содержание</h3><nav id=TableOfContents><ul><li><a href=#introduction>Часть I: Введение</a><ul><li><a href=#developmentplatform>Глава 1. Разработка во FreeBSD</a></li><li><a href=#bsdvision>Глава 2. Парадигма BSD</a></li><li><a href=#archoverview>Глава 3. Обзор архитектуры</a></li><li><a href=#sourcelayout>Глава 4. Структура /usr/src</a></li></ul></li><li><a href=#Basics>Часть II: Основы</a><ul><li><a href=#secure>Глава 5. Безопасное программирование</a></li></ul></li><li><a href=#kernel>Часть III: Ядро</a><ul><li><a href=#kernelhistory>Глава 6. История ядра Unix</a></li></ul></li><li><a href=#memory>Часть IV: Память и виртуальная память</a><ul><li><a href=#virtualmemory>Глава 7. Виртуальная память</a></li></ul></li><li><a href=#iosystem>Часть V: Система ввода/вывода</a><ul><li><a href=#ufs>Глава 8. UFS</a></li></ul></li><li><a href=#ipc>Часть VI: Межпроцессное взаимодействие</a><ul><li><a href=#signals>Глава 9. Сигналы</a></li></ul></li><li><a href=#networking>Часть VII: Работа в сети</a><ul><li><a href=#sockets>Глава 10. Сокеты</a></li></ul></li><li><a href=#networkfs>Часть VIII: Сетевые файловые системы</a><ul><li><a href=#afs>Глава 11. AFS</a></li></ul></li><li><a href=#terminal>Часть IX: Работа с терминалами</a><ul><li><a href=#syscons>Глава 12. Системные консоли</a></li></ul></li><li><a href=#sound>Часть X: Звук</a><ul><li><a href=#oss>Глава 13. OSS</a></li></ul></li><li><a href=#devicedrivers>Часть XI: Драйверы устройств</a><ul><li><a href=#usb>Глава 14. Устройства USB</a></li><li><a href=#newbus>Глава 15. NewBus</a></li></ul></li><li><a href=#architectures>Часть XII: Аппаратные платформы</a><ul><li><a href=#ia32>Глава 16. IA-32</a></li><li><a href=#alpha>Глава 17. Alpha</a></li><li><a href=#ia64>Глава 18. IA-64</a></li></ul></li><li><a href=#debuggingpart>Часть XIII: Отладка</a><ul><li><a href=#truss>Глава 19. Truss</a></li></ul></li><li><a href=#compatibility>Часть XIV: Обеспечение совместимости</a><ul><li><a href=#linux>Глава 20. Linux</a></li></ul></li><li><a href=#appendices>Приложения</a></li></ul></nav></div><div class=book-content><div id=preamble><div class=sectionbody><div class="paragraph abstract-title"><p>Аннотация</p></div><div class=paragraph><p>Добро пожаловать в руководство FreeBSD для разработчиков.</p></div><hr></div></div><h1 id=introduction class=sect0>Часть I: Введение<a class=anchor href=#introduction></a></h1><div class=sect1><h2 id=developmentplatform>Глава 1. Разработка во FreeBSD<a class=anchor href=#developmentplatform></a></h2><div class=sectionbody><div class=paragraph><p>Здесь необходимо будет обсудить FreeBSD в качестве платформы для разработки, подход к этому BSD, обзор архитектуры, структура /usr/src, история и так далее.</p></div><div class=paragraph><p>Спасибо вам за выбор FreeBSD в качестве платформы разработки! Надеемся, что она вас не подведет.</p></div></div></div><div class=sect1><h2 id=bsdvision>Глава 2. Парадигма BSD<a class=anchor href=#bsdvision></a></h2><div class=sectionbody></div></div><div class=sect1><h2 id=archoverview>Глава 3. Обзор архитектуры<a class=anchor href=#archoverview></a></h2><div class=sectionbody></div></div><div class=sect1><h2 id=sourcelayout>Глава 4. Структура /usr/src<a class=anchor href=#sourcelayout></a></h2><div class=sectionbody><div class=paragraph><p>Полный исходный код FreeBSD имеется на нашем общедоступном хранилище CVS. Как правило, исходный код устанавливается в каталог <span class=filename>/usr/src</span>, содержащий следующие подкаталоги.</p></div><table class="tableblock frame-none grid-all stretch informaltable"><col style=width:50%><col style=width:50%><thead><tr><th class="tableblock halign-left valign-top">Каталог</th><th class="tableblock halign-left valign-top">Описание</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>bin/</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Исходный код файлов из <span class=filename>/bin</span></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>contrib/</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Исходный код файлов программного обеспечения, которое предоставлено третьими лицами.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>crypto/</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Исходный код DES</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>etc/</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Исходный код файлов из <span class=filename>/etc</span></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>games/</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Исходный код файлов из <span class=filename>/usr/games</span></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>gnu/</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Утилиты, подпадающие под условия GNU Public License</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>include/</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Исходный код файлов из <span class=filename>/usr/include</span></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>kerberosIV/</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Исходный код Kerbereros версии IV</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>kerberos5/</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Исходный код Kerbereros версии 5</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>lib/</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Исходный код файлов из <span class=filename>/usr/lib</span></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>libexec/</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Исходный код файлов из <span class=filename>/usr/libexec</span></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>release/</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Файлы, необходимые для выпуска релиза FreeBSD</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>sbin/</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Исходный код файлов из <span class=filename>/sbin</span></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>secure/</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Исходный код FreeSec</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>share/</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Исходный код файлов из <span class=filename>/sbin</span></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>sys/</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Исходные тексты ядра</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>tools/</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Инструментальные средства, использемые для обслуживания и тестирования FreeBSD</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>usr.bin/</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Исходный код файлов из <span class=filename>/usr/bin</span></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class=tableblock><span class=filename>usr.sbin/</span></p></td><td class="tableblock halign-left valign-top"><p class=tableblock>Исходный код файлов из <span class=filename>/usr/sbin</span></p></td></tr></tbody></table></div></div><h1 id=Basics class=sect0>Часть II: Основы<a class=anchor href=#Basics></a></h1><div class=sect1><h2 id=secure>Глава 5. Безопасное программирование<a class=anchor href=#secure></a></h2><div class=sectionbody><div class=sect2><h3 id=secure-synopsis>5.1. Обзор<a class=anchor href=#secure-synopsis></a></h3><div class=paragraph><p>Эта глава описывает некоторые из проблем обеспечения безопасности, которые десятилетиями преследовали программистов UNIX®, а также несколько новых доступных инструментов, помогающих программистам избежать написания небезопасного кода.</p></div></div><div class=sect2><h3 id=secure-philosophy>5.2. Методология обеспечения безопасности<a class=anchor href=#secure-philosophy></a></h3><div class=paragraph><p>Написание безопасных приложений требует весьма критического и пессимистического взгляда на жизнь. Приложения должны работать по принципу "наименьших привилегий", при котором никакой процесс не должен работать с привилегиями, превышающими минимально необходимый для выполнения своих функций минимум. Ранее проверенный код должен использоваться там, где только это возможно для избежания общих ошибок, которые могли быть уже исправлены другими.</p></div><div class=paragraph><p>Одной из неприятностей в среде UNIX® является легкость в предположении безопасности этого окружения. Приложения никогда не должны верить пользовательскому вводу (во всех его формах), ресурсам системы, межпроцессному взаимодействию или времени выполнения событий. Процессы UNIX® выполняются не синхронно, так что логические операции редко бывают атомарными.</p></div></div><div class=sect2><h3 id=secure-bufferov>5.3. Переполнения буфера<a class=anchor href=#secure-bufferov></a></h3><div class=paragraph><p>Переполнения буфера появились вместе с появление архитектуры Фон-Неймана <a href=#COD>Впервые широкую известность они получили в 1988 году вместе с Интернет-червем Морриса (Morris). К сожалению, точно такая же атака остаётся эффективной и в наши дни. Из 17 бюллетеней безопасности CERT за 1999 год, 10 были непосредственно вызваны ошибкам в программном обеспечении, связанным с переполнениями буфера. Самые распространенные типы атак с использованием переполнения буфера основаны на разрушении стека.</a></p></div><div class=paragraph><p>Самые современные вычислительные системы используют стек для передачи аргументов процедурам и сохранения локальных переменных. Стек является буфером типа LIFO (последним вошел первым вышел) в верхней части области памяти процесса. Когда программа вызывает функцию, создается новая "граница стека". Эта граница состоит из аргументов, переданных в функцию, а также динамического количества пространства локальных переменных. "Указатель стека" является регистром, хранящим текущее положение вершины стека. Так как это значение постоянно меняется вместе с помещением новых значений на вершину стека, многие реализации также предусматривают "указатель границы", который расположен около начала стека, так что локальные переменные можно легко адресовать относительно этого значения. <a href=#COD>Адрес возврата из функции также сохраняется в стеке, и это является причиной нарушений безопасности, связанных с переполнением стека, так как перезаписывание локальной переменной в функции может изменить адрес возврата из этой функции, потенциально позволяя злоумышленнику выполнить любой код.</a></p></div><div class=paragraph><p>Хотя атаки с переполнением стека являются самыми распространенными, стек можно также перезаписать при помощи атаки, основанной на выделении памяти (malloc/free) из "кучи".</p></div><div class=paragraph><p>Как и во многих других языках программирования, в C не выполняется автоматической проверки границ в массивах или указателях. Кроме того, стандартная библиотека C полна очень опасных функций.</p></div></div><div class=sect2><h3 id=_пример_переполнения_буфера>5.4. Пример переполнения буфера<a class=anchor href=#_пример_переполнения_буфера></a></h3><div class=paragraph><p>В следующем примере кода имеется ошибка переполнения буфера, предназначенная для перезаписи адреса возврата и обхода инструкции, следующей непосредственно за вызовом функции. (По мотивам <a href=#Phrack>)</a></p></div><div class="literalblock programlisting"><div class=content><pre>#include stdio.h

void manipulate(char *buffer) {
  char newbuffer[80];
  strcpy(newbuffer,buffer);
}

int main() {
  char ch,buffer[4096];
  int i=0;

  while ((buffer[i++] = getchar()) != &#39;\n&#39;) {};

  i=1;
  manipulate(buffer);
  i=2;
  printf(&#34;The value of i is : %d\n&#34;,i);
  return 0;
}</pre></div></div><div class=paragraph><p>Давайте посмотрим, как будет выглядеть образ процесса, если в нашу маленькую программу мы введем 160 пробелов.</p></div><div class=paragraph><p>Очевидно, что для выполнения реальных инструкций (таких, как exec(/bin/sh)), может быть придуман более вредоносный ввод.</p></div><div class=sect3><h4 id=_как_избежать_переполнений_буфера>5.4.1. Как избежать переполнений буфера<a class=anchor href=#_как_избежать_переполнений_буфера></a></h4><div class=paragraph><p>Самым прямолинейным решением проблемы переполнения стека является использование только памяти фиксированного размера и функций копирования строк. Функции <code>strncpy</code> и <code>strncat</code> являются частью стандартной библиотеки C. Эти функции будут копировать не более указанного количества байт из исходной строки в целевую. Однако у этих функций есть несколько проблем. Ни одна из них не гарантирует наличие символа NUL, если размер входного буфера больше, чем целевого. Параметр длины также по-разному используется в strncpy и strncat, так что для программистов легко запутаться в правильном использовании. Есть также и значительная потеря производительности по сравнению с <code>strcpy</code> при копировании короткой строки в большой буфер, потому что <code>strncpy</code> заполняет символами NUL пространство до указанной длины.</p></div><div class=paragraph><p>Для избежания этих проблем в OpenBSD была сделана другая реализация копирования памяти. Функции <code>strlcpy</code> и <code>strlcat</code> гарантируют, что они они всегда терминируют целевую строку нулевым символом, если им будет передан аргумент ненулевой длины. Более подробная информация об этом находится здесь <a href=#OpenBSD>Инструкции OpenBSD <code>strlcpy</code> и <code>strlcat</code> существуют во FreeBSD начиная с версии 3.3.</a></p></div><div class=sect4><h5 id=_вкомпилированная_проверка_границ_во_время_выполнения>5.4.1.1. Вкомпилированная проверка границ во время выполнения<a class=anchor href=#_вкомпилированная_проверка_границ_во_время_выполнения></a></h5><div class=paragraph><p>К сожалению, все еще широко используется очень большой объём кода, который слепо копирует память без использования только что рассмотренных функций с проверкой границ. Однако есть другое решение. Существует несколько расширений к компилятору и библиотек для выполнения контроля границ во время выполнения (C/C++).</p></div><div class=paragraph><p>Одним из таких добавлений является StackGuard, который реализован как маленький патч к генератору кода gcc. Согласно <a href=http://immunix.org/stackguard.html>web сайту StackGuard</a>:</p></div><div class=paragraph><p>"StackGuard распознает и защищает стек от атак, не позволяя изменять адрес возврата в стеке. При вызове функции StackGuard помещает вслед за адресом возврата сигнальное слово. Если после возврата из функции оно оказывается измененным, то была попытка выполнить атаку на стек, и программа отвечает на это генерацией сообщения о злоумышленнике в системном журнале, а затем прекращает работу."</p></div><div class=paragraph><p>"StackGuard реализован в виде маленького патча к генератору кода gcc, а именно процедур function_prolog() и function_epilog(). function_prolog() усовершенствована для создания пометок в стеке при начале работы функции, а function_epilog() проверяет целостность пометки при возврате из функции. Таким образом, любые попытки изменения адреса возврата определяются до возврата из функции."</p></div><div class=paragraph><p>Перекомпиляция вашего приложения со StackGuard является эффективным способом остановить большинство атак переполнений буфера, но все же полностью это проблемы не решает.</p></div></div><div class=sect4><h5 id=_проверка_границ_во_время_выполнения_с_использованием_библиотек>5.4.1.2. Проверка границ во время выполнения с использованием библиотек.<a class=anchor href=#_проверка_границ_во_время_выполнения_с_использованием_библиотек></a></h5><div class=paragraph><p>Механизмы на основе компилятора полностью бесполезны для программного обеспечения, поставляемого в двоичном виде, которое вы не можете перекомпилировать. В этих ситуациях имеется некоторое количество библиотек, в которых реализованы небезопасные функции библиотеки C (<code>strcpy</code>, <code>fscanf</code>, <code>getwd</code>, и так далее..), обеспечивающие невозможность записи после указателя стека.</p></div><div class=ulist><ul><li><p>libsafe</p></li><li><p>libverify</p></li><li><p>libparanoia</p></li></ul></div><div class=paragraph><p>К сожалению, эти защиты имеют некоторое количество недостатков. Эти библиотеки могут защитить только против малого количества проблем, и не могут исправить реальные проблемы. Эти защиты могут не сработать, если приложение скомпилировано с параметром -fomit-frame-pointer. К тому же переменные окружения LD_PRELOAD и LD_LIBRARY_PATH могут быть переопределены/сняты пользователем.</p></div></div></div></div><div class=sect2><h3 id=secure-setuid>5.5. Проблемы с установленным битом UID<a class=anchor href=#secure-setuid></a></h3><div class=paragraph><p>Имеется по крайней мере 6 различных идентификаторов (ID), связанных с любым взятым процессом. Поэтому вы должны быть очень осторожны с тем, какие права имеет ваш процесс в каждый момент времени. В частности, все seteuid-приложения должны понижать свои привилегии, как только в них отпадает необходимость.</p></div><div class=paragraph><p>Реальный ID пользователя может быть изменен только процессом администратора. Программа login устанавливает его, когда пользователь входит в систему, и он редко меняется.</p></div><div class=paragraph><p>Эффективный ID пользователя устанавливается функциями <code>exec()</code>, если у программы установлен бит seteuidt. Приложение может выполнить вызов <code>seteuid()</code> в любой момент для установки эффективного ID пользователя в значение реального ID пользователя или сохраняемого set-user-ID. Когда эффективный ID пользователя устанавливается функциями <code>exec()</code>, его предыдущее значение сохраняется в сохраняемом set-user-ID.</p></div></div><div class=sect2><h3 id=secure-chroot>5.6. Ограничение среды работы вашей программы<a class=anchor href=#secure-chroot></a></h3><div class=paragraph><p>Традиционно используемым методом ограничения процесса является использование системного вызова <code>chroot()</code>. Этот системный вызов меняет корневой каталог, относительно которого определяются все остальные пути в самом процессе и всех порожденных ими процессах. Для того, чтобы этот вызов был выполнен успешно, процесс должен иметь право на выполнение (поиск) каталога, о котором идет речь. Новая среда реально не вступит в силу, пока вы не выполните вызов <code>chdir()</code> в вашей новой среде. Следует также отметить, что процесс может с легкостью выйти из chroot-среды, если он имеет привилегии администратора. Это может быть достигнуто созданием файлов устройств для чтения памяти ядра, подключением отладчика к процессу вне узницы и многими другими способами.</p></div><div class=paragraph><p>Поведение системного вызова <code>chroot()</code> можно некоторым образом контролировать <code>sysctl</code>-переменной kern.chroot_allow_open_directories. Когда эта переменная установлена в 0, <code>chroot()</code> не сработает с ошибкой EPERM, если есть какие-либо открытые каталоги. Если она установлена в значение по умолчанию, равное 1, то <code>chroot()</code> не сработает с ошибкой EPERM, если есть какие-либо открытые каталоги и процесс уже подвергнут вызову <code>chroot()</code>. Для всех других значений проверка открытости каталогов будет полностью опущена.</p></div><div class=sect3><h4 id=_функциональность_джейлов_jail_во_freebsd>5.6.1. Функциональность джейлов (jail) во FreeBSD<a class=anchor href=#_функциональность_джейлов_jail_во_freebsd></a></h4><div class=paragraph><p>Концепция джейлов (Jail) расширяет возможности <code>chroot()</code>, ограничивая власть администратора созданием настоящих `виртуальных серверов'. Как только тюремная камера создана, все сетевые коммуникации должны осуществляться через выделенный адрес IP, а сила "привилегий пользователя root" в этой тюрьме довольно ограничена.</p></div><div class=paragraph><p>При работе внутри тюрьмы, любые проверки силы администратора в ядре при помощи вызова <code>suser()</code> будут оканчиваться неудачно. Однако некоторые вызовы к <code>suser()</code> были изменены на новый интерфейс <code>suser_xxx()</code>. Эта функция отвечает за распознание и разрешение доступа к власти администратора для процессов, не находящихся в неволе.</p></div><div class=paragraph><p>Процесс администратора внутри среды джейла имеет право:</p></div><div class=ulist><ul><li><p>Манипулировать привилегиями с помощью <code>setuid</code>, <code>seteuid</code>, <code>setgid</code>, <code>setegid</code>, <code>setgroups</code>, <code>setreuid</code>, <code>setregid</code> и <code>setlogin</code></p></li><li><p>Устанавливать ограничения на использование ресурсов при помощи <code>setrlimit</code></p></li><li><p>Модифицировать некоторые sysctl-переменные (kern.hostname)</p></li><li><p><code>chroot()</code></p></li><li><p>Устанавливать следующие флаги на vnode: <code>chflags</code>, <code>fchflags</code></p></li><li><p>Устанавливать такие атрибуты vnode, как права доступа к файлу, изменять его владельца, группу, размер, время доступа и модификации.</p></li><li><p>Осуществлять привязку к привилегированному порту в области портов Интернет (порты с номерами 1024)</p></li></ul></div><div class=paragraph><p><code>Jail</code> является очень полезным инструментом для запуска приложений в защищенном окружении, но есть и некоторые недостатки. На текущий момент к формату <code>suser_xxx</code> не преобразованы механизмы IPC, так что такие приложения, как MySQL, не могут работать в джейле. Права администратора могут имеет малую силу внутри джейла, но нет способа определить, что значит "малую".</p></div></div><div class=sect3><h4 id=_posix_1e_возможности_процессов>5.6.2. POSIX®.1e возможности процессов<a class=anchor href=#_posix_1e_возможности_процессов></a></h4><div class=paragraph><p>POSIX® выпустила рабочий документ, который добавляет аудит событий, списки управления доступом, тонко настраиваемые привилегии, метки информации и жесткое управление доступом.</p></div><div class=paragraph><p>Этот документ находится в работе и находится в центре внимания проекта <a href=http://www.trustedbsd.org/>TrustedBSD</a>. Некоторая начальная функциональность уже была добавлена во FreeBSD-CURRENT (cap_set_proc(3)).</p></div></div></div><div class=sect2><h3 id=secure-trust>5.7. Доверие<a class=anchor href=#secure-trust></a></h3><div class=paragraph><p>Приложение никогда не должно полагать, что среда пользователя безопасна. Сюда включается (но этим не ограничено): ввод пользователя, сигналы, переменные среды, ресурсы, IPC, отображаемая в файл память (mmap), рабочий каталог файловой системы, дескрипторы файлов, число открытых файлов и прочее.</p></div><div class=paragraph><p>Никогда не думайте, что сможете предусмотреть все формы неправильного ввода, который может дать пользователь. Вместо этого ваше приложение должно осуществлять позитивную фильтрацию, пропуская только конечное множество возможных вариантов ввода, которые вы считаете безопасными. Неполная проверка данных была причиной многих нарушений защиты, особенно CGI-скриптов на веб-сайтах. Для имен файлов вам нужно уделять особое внимание путям ("../", "/"), символическим ссылкам и экранирующим символам оболочки.</p></div><div class=paragraph><p>В Perl имеется такая очень полезная вещь, как "безупречный" (taint) режим, который можно использовать для запрещения скриптам использовать данные, порожденные вне программы, не безопасным способом. Этот режим проверяет аргументы командной строки, переменные окружения, информацию локализации, результаты некоторых системных вызовов (<code>readdir()</code>, <code>readlink()</code>, <code>getpwxxx()</code> и весь файловый ввод.</p></div></div><div class=sect2><h3 id=secure-race-conditions>5.8. Неожиданное поведение<a class=anchor href=#secure-race-conditions></a></h3><div class=paragraph><p>Неожиданное поведение - это аномальное поведение, вызванное непредусмотренной зависимостью от относительной последовательности событий. Другими словами, программист неправильно предположил, что некоторое событие всегда случается перед другим.</p></div><div class=paragraph><p>Некоторые из широко распространенных причин возникновения таких проблем являются сигналы, проверки доступа и открытия файлов. Сигналы по своей природе являются асинхронными событиями, так что по отношению к ним нужно проявлять особое внимание. Проверка доступа функцией <code>access(2)</code> с последующим вызовом <code>open(2)</code> полностью не атомарно. Пользователи могут переместить файлы в промежутке между двумя вызовами. Вместо этого привилегированное приложение должно выполнить <code>seteuid()</code>, а затем сразу вызвать <code>open()</code>. В тех же строках приложение должно всегда устанавливать явно маску прав доступа (umask) перед вызовом функции <code>open()</code> во избежание беспорядочных вызовов <code>chmod()</code>.</p></div></div></div></div><h1 id=kernel class=sect0>Часть III: Ядро<a class=anchor href=#kernel></a></h1><div class=sect1><h2 id=kernelhistory>Глава 6. История ядра Unix<a class=anchor href=#kernelhistory></a></h2><div class=sectionbody><div class=paragraph><p>Немного истории о ядре Unix/BSD, системных вызовах, как работают процессы, блокировке, планировке задач, нити (ядра), переключение контекста, сигналы, прерывания, модули и так далее.</p></div></div></div><h1 id=memory class=sect0>Часть IV: Память и виртуальная память<a class=anchor href=#memory></a></h1><div class=sect1><h2 id=virtualmemory>Глава 7. Виртуальная память<a class=anchor href=#virtualmemory></a></h2><div class=sectionbody><div class=paragraph><p>VM, постраничная подкачка и свопирование, выделение памяти, тестирование ошибок утечки памяти, mmap, vnode и так далее.</p></div></div></div><h1 id=iosystem class=sect0>Часть V: Система ввода/вывода<a class=anchor href=#iosystem></a></h1><div class=sect1><h2 id=ufs>Глава 8. UFS<a class=anchor href=#ufs></a></h2><div class=sectionbody><div class=paragraph><p>UFS, FFS, Ext2FS, JFS, inodes, buffer cache, labeling, locking, metadata, soft-updates, LFS, portalfs, procfs, vnodes, memory sharing, memory objects, TLBs, caching</p></div></div></div><h1 id=ipc class=sect0>Часть VI: Межпроцессное взаимодействие<a class=anchor href=#ipc></a></h1><div class=sect1><h2 id=signals>Глава 9. Сигналы<a class=anchor href=#signals></a></h2><div class=sectionbody><div class=paragraph><p>Сигналы, конвейеры, семафоры, очереди сообщений, совместно используемая память, сокеты, двери</p></div></div></div><h1 id=networking class=sect0>Часть VII: Работа в сети<a class=anchor href=#networking></a></h1><div class=sect1><h2 id=sockets>Глава 10. Сокеты<a class=anchor href=#sockets></a></h2><div class=sectionbody><div class=paragraph><p>Сокеты, bpf, IP, TCP, UDP, ICMP, OSI, bridging, firewalling, NAT, коммутация и так далее</p></div></div></div><h1 id=networkfs class=sect0>Часть VIII: Сетевые файловые системы<a class=anchor href=#networkfs></a></h1><div class=sect1><h2 id=afs>Глава 11. AFS<a class=anchor href=#afs></a></h2><div class=sectionbody><div class=paragraph><p>AFS, NFS, SANs etc]</p></div></div></div><h1 id=terminal class=sect0>Часть IX: Работа с терминалами<a class=anchor href=#terminal></a></h1><div class=sect1><h2 id=syscons>Глава 12. Системные консоли<a class=anchor href=#syscons></a></h2><div class=sectionbody><div class=paragraph><p>Syscons, tty, PCVT, последовательная консоль, хранители экрана и так далее</p></div></div></div><h1 id=sound class=sect0>Часть X: Звук<a class=anchor href=#sound></a></h1><div class=sect1><h2 id=oss>Глава 13. OSS<a class=anchor href=#oss></a></h2><div class=sectionbody><div class=paragraph><p>OSS, waveforms, etc</p></div></div></div><h1 id=devicedrivers class=sect0>Часть XI: Драйверы устройств<a class=anchor href=#devicedrivers></a></h1><div class=sect1><h2 id=usb>Глава 14. Устройства USB<a class=anchor href=#usb></a></h2><div class=sectionbody><div class=paragraph><p>Эта глава расскажет о механизмах, используемых во FreeBSD для написания драйверов для устройств на шине USB.</p></div></div></div><div class=sect1><h2 id=newbus>Глава 15. NewBus<a class=anchor href=#newbus></a></h2><div class=sectionbody><div class=paragraph><p>Эта глава расскажет об архитектуре NewBus во FreeBSD.</p></div></div></div><h1 id=architectures class=sect0>Часть XII: Аппаратные платформы<a class=anchor href=#architectures></a></h1><div class=sect1><h2 id=ia32>Глава 16. IA-32<a class=anchor href=#ia32></a></h2><div class=sectionbody><div class=paragraph><p>Рассказ об архитектурных особенностях FreeBSD/x86.</p></div></div></div><div class=sect1><h2 id=alpha>Глава 17. Alpha<a class=anchor href=#alpha></a></h2><div class=sectionbody><div class=paragraph><p>Рассказ об архитектурных особенностях FreeBSD/alpha.</p></div><div class=paragraph><p>Описание ошибок выравнивания, как их исправлять и как игнорировать.</p></div><div class=paragraph><p>Пример ассемблерного кода для FreeBSD/alpha.</p></div></div></div><div class=sect1><h2 id=ia64>Глава 18. IA-64<a class=anchor href=#ia64></a></h2><div class=sectionbody><div class=paragraph><p>Рассказ об архитектурных особенностях FreeBSD/ia64.</p></div></div></div><h1 id=debuggingpart class=sect0>Часть XIII: Отладка<a class=anchor href=#debuggingpart></a></h1><div class=sect1><h2 id=truss>Глава 19. Truss<a class=anchor href=#truss></a></h2><div class=sectionbody><div class=paragraph><p>Различные описания того, как отлаживать отдельные компоненты системы при помощи утилит truss, ktrace, gdb, kgdb, etc</p></div></div></div><h1 id=compatibility class=sect0>Часть XIV: Обеспечение совместимости<a class=anchor href=#compatibility></a></h1><div class=sect1><h2 id=linux>Глава 20. Linux<a class=anchor href=#linux></a></h2><div class=sectionbody><div class=paragraph><p>Linux, SVR4 и так далее</p></div></div></div><div class=sect1><h2 id=appendices>Приложения<a class=anchor href=#appendices></a></h2><div class=sectionbody><div class=paragraph><p><a id=COD></a>[1] Dave A Patterson and John L Hennessy. Copyright® 1998 Morgan Kaufmann Publishers, Inc. 1-55860-428-6. Morgan Kaufmann Publishers, Inc. Computer Organization and Design. The Hardware / Software Interface. 1-2.</p></div><div class=paragraph><p><a id=APUE></a>[2] W. Richard Stevens. Copyright® 1993 Addison Wesley Longman, Inc. 0-201-56317-7. Addison Wesley Longman, Inc. Advanced Programming in the Unix Environment. 1-2.</p></div><div class=paragraph><p><a id=DIFOS></a>[3] Marshall Kirk McKusick and George Neville-Neil. Copyright® 2004 Addison-Wesley. 0-201-70245-2. Addison-Wesley. The Design and Implementation of the FreeBSD Operating System. 1-2.</p></div><div class=paragraph><p><a id=Phrack></a>[4] Aleph One. Phrack 49; "Smashing the Stack for Fun and Profit".</p></div><div class=paragraph><p><a id=StackGuard></a>[5] Chrispin Cowan, Calton Pu, and Dave Maier. StackGuard; Automatic Adaptive Detection and Prevention of Buffer-Overflow Attacks.</p></div><div class=paragraph><p><a id=OpenBSD></a>[6] Todd Miller and Theo de Raadt. strlcpy and strlcat — consistent, safe string copy and concatenation.</p></div></div></div></div><hr><div class=last-modified><p><strong>Изменено</strong>: 3 ноября 2021 г. by <a href="https://cgit.freebsd.org/doc/commit/?id=64acd169b8" target=_blank>Sergio Carlavilla Delgado</a></p></div><div class=buttons><div class=home><i class="fa fa-home" aria-hidden=true title=Главная></i><div class=container><a href=../ class=direction>Главная</a></div></div></div><label class="hidden book-menu-overlay" for=menu-control></label></div><aside class=toc><div class=toc-content><h3>Содержание</h3><nav id=TableOfContents><ul><li><a href=#introduction>Часть I: Введение</a><ul><li><a href=#developmentplatform>Глава 1. Разработка во FreeBSD</a></li><li><a href=#bsdvision>Глава 2. Парадигма BSD</a></li><li><a href=#archoverview>Глава 3. Обзор архитектуры</a></li><li><a href=#sourcelayout>Глава 4. Структура /usr/src</a></li></ul></li><li><a href=#Basics>Часть II: Основы</a><ul><li><a href=#secure>Глава 5. Безопасное программирование</a></li></ul></li><li><a href=#kernel>Часть III: Ядро</a><ul><li><a href=#kernelhistory>Глава 6. История ядра Unix</a></li></ul></li><li><a href=#memory>Часть IV: Память и виртуальная память</a><ul><li><a href=#virtualmemory>Глава 7. Виртуальная память</a></li></ul></li><li><a href=#iosystem>Часть V: Система ввода/вывода</a><ul><li><a href=#ufs>Глава 8. UFS</a></li></ul></li><li><a href=#ipc>Часть VI: Межпроцессное взаимодействие</a><ul><li><a href=#signals>Глава 9. Сигналы</a></li></ul></li><li><a href=#networking>Часть VII: Работа в сети</a><ul><li><a href=#sockets>Глава 10. Сокеты</a></li></ul></li><li><a href=#networkfs>Часть VIII: Сетевые файловые системы</a><ul><li><a href=#afs>Глава 11. AFS</a></li></ul></li><li><a href=#terminal>Часть IX: Работа с терминалами</a><ul><li><a href=#syscons>Глава 12. Системные консоли</a></li></ul></li><li><a href=#sound>Часть X: Звук</a><ul><li><a href=#oss>Глава 13. OSS</a></li></ul></li><li><a href=#devicedrivers>Часть XI: Драйверы устройств</a><ul><li><a href=#usb>Глава 14. Устройства USB</a></li><li><a href=#newbus>Глава 15. NewBus</a></li></ul></li><li><a href=#architectures>Часть XII: Аппаратные платформы</a><ul><li><a href=#ia32>Глава 16. IA-32</a></li><li><a href=#alpha>Глава 17. Alpha</a></li><li><a href=#ia64>Глава 18. IA-64</a></li></ul></li><li><a href=#debuggingpart>Часть XIII: Отладка</a><ul><li><a href=#truss>Глава 19. Truss</a></li></ul></li><li><a href=#compatibility>Часть XIV: Обеспечение совместимости</a><ul><li><a href=#linux>Глава 20. Linux</a></li></ul></li><li><a href=#appendices>Приложения</a></li></ul></nav><hr><div class=resources><h3>Материалы</h3><ul class=contents><li><i class="fa fa-file-pdf-o" aria-hidden=true title="Скачать PDF"></i><a href=https://download.freebsd.org/doc/ru/books/developers-handbook/developers-handbook_ru.pdf>Скачать PDF</a></li><li><i class="fa fa-pencil-square-o" aria-hidden=true title="Редактировать эту страницу"></i><a href=https://github.com/freebsd/freebsd-doc/blob/main/documentation/content/ru/_index target=_blank>Редактировать эту страницу</a></li></ul></div></div></aside><a class=to-top href=#top><i class="fa fa-arrow-circle-up" aria-hidden=true></i></a></main><footer><div class=footer-container><section class=logo-column><img src=https://docs.freebsd.org/images/FreeBSD-colors.svg width=160 height=50 alt="FreeBSD logo"><div class=options-container><div class=language-container><a id=languages href=https://docs.freebsd.org/ru/languages><img src=https://docs.freebsd.org/images/language.png class=language-image alt="Выберите язык">
<span>Русский</span></a></div><div class=theme-container><select id=theme-chooser><option value=theme-system>Система</option><option value=theme-light>Светлый</option><option value=theme-dark>Тёмный</option><option value=theme-high-contrast>Высокая контрастность</option></select></div></div></section><section class=about-column><h3 class=column-title>О нас</h3><ul class=column-elements-container><li><a href=https://www.freebsd.org/about/ target=_blank class=column-element>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/ target=_blank class=column-element>Фонд FreeBSD</a></li><li><a href=https://www.freebsd.org/where/ target=_blank class=column-element>Получить FreeBSD</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct target=_blank class=column-element>Кодекс Этики</a></li><li><a href=https://www.freebsd.org/security/ target=_blank class=column-element>Бюллетени Безопасности</a></li></ul></section><section class=documentation-column><h3 class=column-title>Документация</h3><ul class=column-elements-container><li><a href=/ru class=column-element>Портал документации</a></li><li><a href=https://man.FreeBSD.org target=_blank class=column-element>Страницы Справочника</a></li><li><a href=https://papers.FreeBSD.org target=_blank class=column-element>Презентации и публикации</a></li><li><a href=https://docs-archive.freebsd.org/doc/ target=_blank class=column-element>Предыдущие версии</a></li><li><a href=https://docs-archive.freebsd.org/44doc/ target=_blank class=column-element>Документы 4.4BSD</a></li><li><a href=https://wiki.freebsd.org/ target=_blank class=column-element>Wiki</a></li></ul></section><section class=community-column><h3 class=column-title>Сообщество</h3><ul class=column-elements-container><li><a href=https://docs.freebsd.org/ru/articles/contributing class=column-element>Принять участие</a></li><li><a href=https://forums.freebsd.org/ target=_blank class=column-element>Форум Сообщества</a></li><li><a href=https://lists.freebsd.org/ target=_blank class=column-element>Списки рассылки</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank class=column-element>Каналы IRC</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank class=column-element>Трекер ошибок</a></li></ul></section><section class=legal-column><h3 class=column-title>Юридическая информация</h3><ul class=column-elements-container><li><a href=https://freebsdfoundation.org/donate/ target=_blank class=column-element>Пожертвования</a></li><li><a href=https://www.freebsd.org/copyright/freebsd-license/ target=_blank class=column-element>Лицензирование</a></li><li><a href=https://www.freebsd.org/privacy/ target=_blank class=column-element>Политика Конфиденциальности</a></li><li><a href=https://www.freebsd.org/copyright/ target=_blank class=column-element>Юридические оговорки</a></li></ul></section><section class=copyright-column><p>&copy; 1994-2024 Проект FreeBSD. Все права защищены</p><span>Сделано с помощью <span class=heart>♥</span> Сообществом FreeBSD</span></section></div></footer></body></html>