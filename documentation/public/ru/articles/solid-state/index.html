<!doctype html><html class=theme-light lang=ru><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content><meta name=copyright content="1995-2024 The FreeBSD Foundation"><link rel=canonical href=http://172.16.201.134:1313/ru/articles/solid-state/><title>FreeBSD и твердотельные устройства | FreeBSD Documentation Portal</title>
<meta name=theme-color content="#790000"><meta name=color-scheme content="system light dark high-contrast"><link rel="shortcut icon" href=http://172.16.201.134:1313/favicon.ico><link rel=stylesheet href=http://172.16.201.134:1313/styles/main.min.css><link rel=stylesheet href=http://172.16.201.134:1313/css/font-awesome-min.css><script defer src=/js/theme-chooser.min.js></script><script defer src=/js/copy-clipboard.min.js></script><script defer src=/js/search.min.js></script><meta name=twitter:card content="summary"><meta name=twitter:domain content="docs.FreeBSD.org"><meta name=twitter:site content="@freebsd"><meta name=twitter:url content="https://twitter.com/freebsd"><meta property="og:title" content="FreeBSD и твердотельные устройства"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:image" content="http://172.16.201.134:1313/favicon.ico"><meta property="og:image:alt" content="FreeBSD Logo"><meta property="og:locale" content="ru"><meta property="og:url" content="http://172.16.201.134:1313/ru/articles/solid-state/"><meta property="og:site_name" content="FreeBSD Documentation Portal"><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","url":"http:\/\/172.16.201.134:1313\/ru\/articles\/solid-state\/","name":"FreeBSD Documentation Portal","headline":"FreeBSD Documentation Portal","description":"FreeBSD Documentation Portal"}</script></head><body><header><div class=header-container><div class=logo-menu-bars-container><a href=https://www.FreeBSD.org class=logo><img src=http://172.16.201.134:1313/images/FreeBSD-monochromatic.svg width=160 height=50 alt="FreeBSD logo">
</a><label class=menu-bars for=menu-bars><i class="fa fa-bars" aria-hidden=true></i></label></div><input id=menu-bars type=checkbox><nav><ul class=menu><li class=menu-item><input id=about type=checkbox>
<a href=# aria-label="Navigate to About section"><label class=menu-item-description for=about>О нас
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/about/ target=_blank>О нас</a></li><li><a href=https://www.freebsd.org/about/ target=_blank>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/about-us/about-the-foundation/ target=_blank>Фонд FreeBSD</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct/ target=_blank>Кодекс Этики</a></li></ul></li><li class=menu-item><input id=download type=checkbox>
<a href=# aria-label="Navigate to get FreeBSD section"><label class=menu-item-description for=download>Получить FreeBSD
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/where/ target=_blank>Получить FreeBSD</a></li><li><a href=https://www.freebsd.org/releases/ target=_blank>Информация о релизах</a></li><li><a href=https://www.freebsd.org/releng/ target=_blank>Подготовка релизов</a></li><li><a href=https://www.freebsd.org/security/ target=_blank>Бюллетени Безопасности</a></li></ul></li><li class=menu-item><input id=documentation type=checkbox>
<a href=# aria-label="Navigate to get Documentation section"><label class=menu-item-description for=documentation>Документация
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=/ru>Портал документации</a></li><li><a href=http://172.16.201.134:1313/ru/books/handbook>Руководство</a></li><li><a href=http://172.16.201.134:1313/ru/books/porters-handbook>Руководство по созданию портов</a></li><li><a href=https://docs.FreeBSD.org/en/books/fdp-primer>Учебник Проекта Документирования</a></li><li><a href=https://man.FreeBSD.org target=_blank>Страницы Справочника</a></li><li><a href=https://papers.FreeBSD.org target=_blank>Презентации и публикации</a></li><li><a href=https://wiki.FreeBSD.org target=_blank>Wiki</a></li><li><a href=http://172.16.201.134:1313/ru/books>Книги</a></li><li><a href=http://172.16.201.134:1313/ru/articles>Статьи</a></li></ul></li><li class=menu-item><input id=community type=checkbox>
<a href=# aria-label="Navigate to get Community section"><label class=menu-item-description for=community>Сообщество
<i class="fa fa-angle-down fa-lg" aria-hidden=true></i></label></a><ul class=sub-menu><li class=title><a href=https://www.freebsd.org/community/>Сообщество</a></li><li><a href=http://172.16.201.134:1313/ru/articles/contributing>Стать участником</a></li><li><a href=https://forums.freebsd.org/ target=_blank>Форум</a></li><li><a href=https://lists.freebsd.org/ target=_blank>Списки рассылки</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank>Каналы IRC</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank>Трекер ошибок</a></li><li><a href=https://www.freebsd.org/support/ target=_blank>Поддержка</a></li></ul></li></ul></nav><div class=search-donate-container><form class=search method=get id=search-header-form action=https://docs.freebsd.org/search name=search-header-form><input type=hidden name=DB value=ru>
<input id=words name=P type=text size=20 maxlength=255>
<button>
<i class="fa fa-search" aria-hidden=true></i></button></form><div class=donate><a href=https://freebsdfoundation.org/donate/ target=_blank><span class=heart>♥</span>
Пожертвования</a></div></div></div></header><main class=main-wrapper-article><div class=article><h1 class=title>FreeBSD и твердотельные устройства</h1><div class="admonitionblock note"><p><i class="fa fa-exclamation-circle" aria-hidden=true></i>
Этот перевод может быть устаревшим. Для того, чтобы помочь с переводом, пожалуйста, обратитесь к <a href=https://translate-dev.freebsd.org/ target=_blank>Сервер переводов FreeBSD</a>.</p></div><div class=copyright>Copyright © 2001, 2009 The FreeBSD Documentation Project</div><div class=legalnotice><a id=trademarks></a><details><summary>товарные знаки</summary><p>FreeBSD является зарегистрированным товарным знаком Фонда FreeBSD.</p><p>Многие из обозначений, используемые производителями и продавцами для обозначения своих продуктов, заявляются в качестве товарных знаков. Когда такие обозначения появляются в этом документе, и Проекту FreeBSD известно о товарном знаке, к обозначению добавляется знак “™” или “®”.</p></details></div><div class=toc-mobile><h3>Содержание</h3><nav id=TableOfContents><ul><li><a href=#intro>1. Твердотельные дисковые устройства</a></li><li><a href=#kernel>2. Параметры ядра</a></li><li><a href=#ro-fs>3. Подсистема <code>rc</code> и файловые системы в режиме только чтения</a></li><li><a href=#_создание_файловой_системы_с_нуля>4. Создание файловой системы с нуля</a></li><li><a href=#strategies>5. Стратегии работы с системой для случаев небольших и доступных только для чтения файловых систем</a></li></ul></nav></div><div id=preamble><div class=sectionbody><div class="paragraph abstract-title"><p>Аннотация</p></div><div class=paragraph><p>В этой статье описывается использование твердотельных дисковых устройств для создания встраиваемых систем на основе FreeBSD</p></div><div class=paragraph><p>Встраиваемые системы имеют преимущество в повышенной надежности по причине отсутствия в них движущихся частей (жестких дисков). Однако, следует принять во внимание, что системе, как правило, доступно очень малое дисковое пространство и ограниченный объем запоминающего устройства.</p></div><div class=paragraph><p>К отдельно рассматриваемым вопросам относятся типы и характеристики твердотельных носителей, подходящих для использования в качестве дисков во FreeBSD, параметры ядра, которые представляют интерес в таких условиях, механизмы <span class=filename>rc.initdiskless</span>, автоматизирующие инициализацию таких систем и удовлетворяющие требованиям файловых систем, доступных только для чтения, а также построение файловых систем с нуля. Статья заканчивается описанием некоторых общих стратегий для случаев малых систем FreeBSD и работ в режиме только для чтения.</p></div><hr></div></div><div class=sect1><h2 id=intro>1. Твердотельные дисковые устройства<a class=anchor href=#intro></a></h2><div class=sectionbody><div class=paragraph><p>Эта статья будет ограничиваться рассмотрением твердотельных дисковых устройств, которые делаются на основе флэш-памяти. Флэш-память является твердотельным (здесь нет движущихся частей) запоминающим устройством, которое является энергонезависимым (данные остаются в памяти даже после отключения всех источников питания). Флэш-память может быть нечувствительной к сильным физическим воздействиям и достаточно быстра (решения на основе флэш-памяти, описываемые в этой статье, гораздо медленнее, чем диски EIDE для операций записи, и гораздо быстрее их в случае выполнения операций чтения). Одним из очень важных свойств флэш-памяти, различные варианты которого будут рассмотрены далее в этой статье, является то, что каждый сектор имеет ограниченные возможности по перезаписыванию. Вы можете только записывать, стирать и снова записывать на сектор флэш-памяти определенное количество раз до того, как сектор станет полностью неработоспособным. Хотя многие продукты на основе флэш-памяти автоматически перенаправляют испорченные блоки, а некоторые даже распределяют операции записи по всему модулю, фактом является наличие ограничения на количество операций записи, которые могут выполняться с устройством. Современные модули имеют характеристики от 1,000,000 до 10,000,000 циклов записи на сектор. Эти характеристики могут зависеть от температуры рабочей среды.</p></div><div class=paragraph><p>В частности, мы обсудим компактные модули флэш-памяти, совместимые со стандартом ATA, которые стали весьма популярными в качестве носителя данных для цифровых камер. Особый интерес представляет тот факт, что они соответствуют шине IDE по контактам и совместимы с набором команд ATA. Таким образом, при помощи очень простого и дешевого адаптера такие устройства могут подключаться непосредственно к шине IDE компьютера. Если поступить таким образом, то такие операционные системы, как FreeBSD, распознают диск как обычный винчестер (весьма маленький).</p></div><div class=paragraph><p>Существуют и другие решения для твердотельных дисков, но их стоимость, безвестность и сравнительная сложность использования выводят их за рамки этой статьи.</p></div></div></div><div class=sect1><h2 id=kernel>2. Параметры ядра<a class=anchor href=#kernel></a></h2><div class=sectionbody><div class=paragraph><p>Для тех, кто создает встраиваемую систему FreeBSD, интерес представляют несколько параметров ядра.</p></div><div class=paragraph><p>Все встраиваемые системы FreeBSD, которые используют флэш-память в качестве системного диска, заинтересованы в использовании дисков в памяти и файловых систем в памяти. Из-за ограниченного количества циклов записи, которые можно выполнить с флэш-памятью, диск и файловые системы на нем будут, скорее всего, монтироваться в режиме доступа только для чтения. В таком случае файловые системы типа <span class=filename>/tmp</span> и <span class=filename>/var</span> монтируются как файловые системы в памяти для того, чтобы позволить системе создать журналы и обновить счетчики и временные файлы. Файловые системы в памяти являются критическим компонентом успешной работы FreeBSD на твердотельных устройствах.</p></div><div class=paragraph><p>Вы должны удостовериться, что в конфигурационном файле вашего ядра присутствуют следующие строки:</p></div><div class="literalblock programlisting"><div class=content><pre>options         MFS             # Memory Filesystem
options         MD_ROOT         # md device usable as a potential root device
pseudo-device   md              # memory disk</pre></div></div></div></div><div class=sect1><h2 id=ro-fs>3. Подсистема <code>rc</code> и файловые системы в режиме только чтения<a class=anchor href=#ro-fs></a></h2><div class=sectionbody><div class=paragraph><p>Инициализация встраиваемой системы FreeBSD после загрузки управляется <span class=filename>/etc/rc.initdiskless</span>.</p></div><div class=paragraph><p><span class=filename>/etc/rc.d/var</span> монтирует <span class=filename>/var</span> как файловую систему в памяти, создает указываемый список каталогов в <span class=filename>/var</span> при помощи команды <a href="https://man.freebsd.org/cgi/man.cgi?query=mkdir&amp;sektion=1&amp;format=html">mkdir(1)</a>, изменяет режимы доступа на некоторые из этих каталогов. В процессе выполнения <span class=filename>/etc/rc.d/var</span> задействуется еще одна переменная <span class=filename>rc.conf</span> - <code>varsize</code>. Скрипт <span class=filename>/etc/rc.d/var</span> создает раздел <span class=filename>/var</span> на основе значения этой переменной из <span class=filename>rc.conf</span>:</p></div><div class="literalblock programlisting"><div class=content><pre>varsize=8192</pre></div></div><div class=paragraph><p>Запомните, что по умолчанию это значение указано в секторах.</p></div><div class=paragraph><p>Факт использования файловой системы <span class=filename>/var</span> в режиме чтения и записи является важным признаком, так как раздел <span class=filename>/</span> (и любые другие разделы, которые могут находиться на флэш-носителе) должен монтироваться в режиме только для чтения. Вспомните, что в <a href=#intro>Твердотельные дисковые устройства</a> мы касались ограничений флэш-памяти - особенно ограничений, касающихся возможностей записи. Важно не монтировать файловые системы на флэш-носителях в режимах чтения и записи, и важность отказа от файла подкачки не может быть переоценена. Файл подкачки на загруженной системе может пережечь кусок флэш-носителя менее чем за год. Частое журналирование и создание временных файлов приводят к тому же результату. Поэтому, кроме удаления записи <code>swap</code> из вашего файла <span class=filename>/etc/fstab</span>, вы должны также изменить поле параметров каждой файловой системы на <code>ro</code> таким образом:</p></div><div class="literalblock programlisting"><div class=content><pre># Device                Mountpoint      FStype  Options         Dump    Pass#
/dev/ad0s1a             /               ufs     ro              1       1</pre></div></div><div class=paragraph><p>В результате этих изменений в среднестатистической системе несколько приложений немедленно перестанут работать. Например, cron не будет нормально запускаться в результате отсутствия таблиц для него в каталоге <span class=filename>/var</span>, созданном <span class=filename>/etc/rc.d/var</span>, а syslog и dhcp будут испытывать проблемы из-за доступа файловой системы только для чтения, а также отсутствия записей в <span class=filename>/var</span>, который был создан скриптом <span class=filename>/etc/rc.d/var</span>. Хотя эти проблемы являются временными и обсуждаются вместе с решением проблем с запуском распространенных программных пакетов, в <a href=#strategies>Стратегии работы с системой для случаев небольших и доступных только для чтения файловых систем</a>.</p></div><div class=paragraph><p>Важно помнить, что файловая система, которая была смонтирована только для чтения при помощи файла <span class=filename>/etc/fstab</span>, в любой момент может быть сделана доступной по чтению и записи выдачей команды:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># /sbin/mount -uw partition</span></code></pre></div></div><div class=paragraph><p>и может быть возвращена к режиму доступа только для чтения по такой команде:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># /sbin/mount -ur partition</span></code></pre></div></div></div></div><div class=sect1><h2 id=_создание_файловой_системы_с_нуля>4. Создание файловой системы с нуля<a class=anchor href=#_создание_файловой_системы_с_нуля></a></h2><div class=sectionbody><div class=paragraph><p>Так как совместимые с ATA компактные флэш-карты распознаются во FreeBSD как обычные жесткие диски IDE, то теоретически вы можете установить FreeBSD по сети при помощи дискет kern и mfsroot или с компакт-диска.</p></div><div class=paragraph><p>Однако даже маленькая установка FreeBSD при помощи обычных процедур установки может привести к созданию системы размером, превышающим 200 мегабайт. Так как большинство людей используют устройства флэш-памяти меньшего размера (128 мегабайт считается весьма большим - 32 или даже 16 мегабайт используются гораздо чаще), то установка обычным образом не подходит-просто на диске нет места даже для самой минимальной установки.</p></div><div class=paragraph><p>Самым простым способом обойти это ограничение на объем является установка FreeBSD обычным образом на обычный жесткий диск. После окончания установки, обрежьте операционную систему до размера, который помещается на ваш флэш-носитель, а затем полностью заархивируйте файловую систему. Следующие шаги поведут вас через процесс подготовки части флэш-памяти для вашей заархивированной файловой системы. Запомните, что из-за того, что обычная установка не выполнялась, такие операции, как разбиение на разделы, разметка, создание файловой системы и так далее должны быть выполнены вручную. Кроме дискет kern и mfsroot вам также нужно воспользоваться дискетой fixit.</p></div><div class="olist arabic procedure"><ol class=arabic><li><p>Разбиение вашего флэш-носителя на разделы</p><div class=paragraph><p>После загрузки при помощи дискет kern и mfsroot, выберите пункт <code>custom</code> из меню установки. Из следующего пункта меню выберите <code>partition</code>. В меню работы с разделами вы должны удалить все существующие разделы при помощи клавиши <kbd>d</kbd>. После удаления всех имеющихся разделов создайте раздел при помощи клавиши <kbd>c</kbd> и согласитесь с предлагаемым по умолчанию размером раздела. Когда вы будете опрошены на предмет типа раздела, удостоверьтесь, что значение типа равно <code>165</code>. Теперь запишите эту таблицу разделов на диск, нажав клавишу <kbd>w</kbd> (на этом экране эта опция скрыта). Если вы используете компактную флэш-карту, совместимую с ATA, вы должны выбрать FreeBSD Boot Manager. Теперь нажмите клавишу <kbd>q</kbd> для выхода из меню работы с разделами. Должно быть выдано еще раз меню для выбора менеджера загрузки - повторите то, что вы выбирали ранее.</p></div></li><li><p>Создание файловых систем на вашем устройстве флэш-памяти</p><div class=paragraph><p>Выйдите из меню установки custom, и из главного меню установки выберите пункт <code>fixit</code>. После входа в режим работы fixit, введите следующую команду:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># disklabel -e /dev/ad0c</span></code></pre></div></div><div class=paragraph><p>В этот момент вы войдете в редактор vi из-под команды disklabel. Затем, вам нужно добавить строку <code>a:</code> в конце файла. Эта строка <code>a:</code> должна выглядеть примерно так:</p></div><div class="literalblock programlisting"><div class=content><pre>a:      123456  0       4.2BSD  0       0</pre></div></div><div class=paragraph><p>Здесь <em>123456</em> является числом, в точности совпадающим с тем, что характеризует размер имеющейся записи для <code>c:</code>. В общем, вы копируете существующую строку для <code>c:</code> для строки <code>a:</code>, не забывая определить fstype как <code>4.2BSD</code>. Сохраните файл и завершите редактирование.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># disklabel -B -r /dev/ad0c</span>
<span class=c># newfs /dev/ad0a</span></code></pre></div></div></li><li><p>Размещение вашей файловой системы на флэш-носителе</p><div class=paragraph><p>Смонтируйте только что подготовленный флэш-носитель:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mount /dev/ad0a /flash</span></code></pre></div></div><div class=paragraph><p>Подключите эту машину к сети, чтобы можно было перенести наш tar-файл и распаковать его в файловую систему на флэш-носителе. Вот пример того, как это можно сделать:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ifconfig xl0 192.168.0.10 netmask 255.255.255.0</span>
<span class=c># route add default 192.168.0.1</span></code></pre></div></div><div class=paragraph><p>Теперь, когда машина находится в сети, перепишите ваш tar-файл. Здесь вы можете столкнуться с некоторой проблемой - если объем вашей флэш-памяти равен, к примеру, 128 мегабайтам, а ваш tar-файл превышает 64 мегабайта, то вы не можете одновременно разместить tar-файл на флэш-носителе и распаковать его - вам не хватит места. Одним из решений этой проблемы, если вы используете FTP, является распаковка файла во время его передачи по FTP. Если вы передаете файл именно так, то вы никогда не получите на диске одновременно архивный файл и его содержимое:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>ftp&gt; get tarfile.tar <span class=s2>&#34;| tar xvf -&#34;</span></code></pre></div></div><div class=paragraph><p>Если ваш файл обработан утилитой gzip, вы также можете этого добиться:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell>ftp&gt; get tarfile.tar <span class=s2>&#34;| zcat | tar xvf -&#34;</span></code></pre></div></div><div class=paragraph><p>После того, как вы получили содержимое вашей заархивированной файловой системы на файловой системе флэш-памяти, вы можете размонтировать флэш-память и выполнить перезагрузку:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># cd /</span>
<span class=c># umount /flash</span>
<span class=c># exit</span></code></pre></div></div><div class=paragraph><p>Полагая, что вы правильно настроили вашу файловую систему при ее построении на обычном диске (с вашей файловой системой, смонтированной в режиме доступа только для чтения, и необходимыми параметрами, присутствующими в ядре) вы должны успешно загрузить вашу встраиваемую систему на основе FreeBSD.</p></div></li></ol></div></div></div><div class=sect1><h2 id=strategies>5. Стратегии работы с системой для случаев небольших и доступных только для чтения файловых систем<a class=anchor href=#strategies></a></h2><div class=sectionbody><div class=paragraph><p>В <a href=#ro-fs>Подсистема <code>rc</code> и файловые системы в режиме только чтения</a> было указано, что файловая система <span class=filename>/var</span>, создаваемая скриптом <span class=filename>/etc/rc.d/var</span>, и наличие корневой файловой системы, доступной только для чтения, приводят к проблемам при работе многих распространенных программных пакетов, используемых во FreeBSD. В этой статье будут даны рекомендации по настройке нормальной работы cron и syslog, установке портов и веб-сервера Apache.</p></div><div class=sect2><h3 id=_cron>5.1. cron<a class=anchor href=#_cron></a></h3><div class=paragraph><p>Во время загрузки содержимое каталогa <span class=filename>/var</span> формируется скриптом <span class=filename>/etc/rc.d/var</span> используя данные из <span class=filename>/etc/mtree/BSD.var.dist</span>, поэтому в нем создается несколько стандартных каталогов, в числе которых - <span class=filename>cron</span>, <span class=filename>cron/tabs</span>, <span class=filename>at</span>.</p></div><div class=paragraph><p>Однако это не решает проблему с сохранением cron-таблиц между перезагрузками. Когда система перезагружается, то файловая система <span class=filename>/var</span>, которая располагается в памяти, будет уничтожена, вместе со всеми cron-таблицами, которые вы могли там иметь. Поэтому одним из решений может стать создание cron-таблиц для пользователей, которым они нужны, монтирование вашей файловой системы <span class=filename>/</span> в режиме чтения и записи, и копирование этих cron-таблиц в безопасное место, например, в <span class=filename>/etc/tabs</span>, и последующее добавление строки в конец скрипта <span class=filename>/etc/rc.initdiskless</span> для копирования этих cron-таблиц в каталог <span class=filename>/var/cron/tabs</span> после его создания во время инициализации системы. Вам может также потребоваться добавить строку, которая изменяет режимы доступа и права на каталоги, которые вы создали, и на файлы, которые вы скопировали в скрипте <span class=filename>/etc/rc.initdiskless</span>.</p></div></div><div class=sect2><h3 id=_syslog>5.2. syslog<a class=anchor href=#_syslog></a></h3><div class=paragraph><p>В файле <span class=filename>syslog.conf</span> задано местоположение некоторых файлов протоколов, которые имеются в каталоге <span class=filename>/var/log</span>. Эти файлы не создаются скриптом <span class=filename>/etc/rc.d/var</span> во время инициализации системы. Поэтому где-нибудь в скрипте <span class=filename>/etc/rc.d/var</span>, после секции, создающей каталоги в <span class=filename>/var</span>, вам нужно добавить нечто вроде следующего:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># touch /var/log/security /var/log/maillog /var/log/cron /var/log/messages</span>
<span class=c># chmod 0644 /var/log/*</span></code></pre></div></div></div><div class=sect2><h3 id=_установка_портов>5.3. Установка портов<a class=anchor href=#_установка_портов></a></h3><div class=paragraph><p>Перед тем, как обсудить изменения, которые нужно сделать для успешного использования дерева портов, необходимо напомнить о том, что ваши файловые системы на флэш-носителях доступны только для чтения. Поэтому вам нужно временно монтировать их в режиме чтения и записи, используя параметры командной строки, как это показано в <a href=#ro-fs>Подсистема <code>rc</code> и файловые системы в режиме только чтения</a>. Вы всегда должны перемонтировать эти файловые системы в режим только для чтения после окончания работ - излишние записи на флеш носитель могут значительно сократить его срок эксплуатации.</p></div><div class=paragraph><p>Чтобы можно было войти в каталог с портами и успешно выполнить команду make <code>install</code>, необходимо создать каталог для пакаджей в файловой системе, не располагающейся в памяти, где будут храниться пакаджи между перезагрузками. Так как для установки пакаджа в любом случае требуется монтирование ваших файловых систем для чтения и записи, имеет смысл выделить область флэш-носителя также и для записи информации о пакадже.</p></div><div class=paragraph><p>Прежде всего создайте каталог с базой данных о пакаджах. Обычно это каталог <span class=filename>/var/db/pkg</span>, но мы не можем разместить базу именно здесь, так как она исчезнет после перезагрузки системы.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># mkdir /etc/pkg</span></code></pre></div></div><div class=paragraph><p>Теперь в скрипт <span class=filename>/etc/rc.d/var</span> добавьте строку, которая связывает каталог <span class=filename>/etc/pkg</span> с <span class=filename>/var/db/pkg</span>. Например:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># ln -s /etc/pkg /var/db/pkg</span></code></pre></div></div><div class=paragraph><p>Теперь каждый раз при монтировании ваших файловых систем для чтения и записи и установки пакаджа, команда make <code>install</code> будет работать, а информация о пакадже будет успешно записана в каталог <span class=filename>/etc/pkg</span> (так как файловая система будет в это время смонтирована для чтения и записи), который всегда будет доступным операционной системе как <span class=filename>/var/db/pkg</span>.</p></div></div><div class=sect2><h3 id=_веб_сервер_apache>5.4. Веб-сервер Apache<a class=anchor href=#_веб_сервер_apache></a></h3><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>Шаги, описанные в этой части статьи, необходимо выполнить лишь в том случае, если Apache настроен сохранять свой pid или лог файл вне каталога <span class=filename>/var</span>. С настройками по умолчанию Apache формирует свой pid файл в <span class=filename>/var/run/httpd.pid</span>, а лог файлы - в <span class=filename>/var/log</span>.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Далее в статье подразумевается, что Apache сохраняет свои лог файлы в каталог <span class=filename>apache_log_dir</span> вне каталога <span class=filename>/var</span>. Когда этот каталог расположен на файловой системе, смонтированной в режиме только для чтения, Apache не сможет сохранять лог файлы, что в свою очередь может вызывать проблемы в работе веб-сервера. В таком случае необходимо добавить новый каталог к списку каталогов из <span class=filename>/etc/rc.d/var</span> для их создания в каталоге <span class=filename>/var</span> и связать <span class=filename>apache_log_dir</span> с <span class=filename>/var/log/apache</span>. Нужно также задать права доступа и владельца нового каталога.</p></div><div class=paragraph><p>Сначала добавьте каталог <code>log/apache</code> к списку каталогов, создаваемых скриптом <span class=filename>/etc/rc.d/var</span>.</p></div><div class=paragraph><p>Затем добавьте в скрипт <span class=filename>/etc/rc.d/var</span> после секции создания каталогов такие команды:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># chmod 0774 /var/log/apache</span>
<span class=c># chown nobody:nobody /var/log/apache</span></code></pre></div></div><div class=paragraph><p>И наконец, удалите существующий каталог <span class=filename>apache_install/logs</span> и замените его ссылкой:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=shell><span class=c># rm -rf apache_log_dir</span>
<span class=c># ln -s apache_log_dir</span></code></pre></div></div></div></div></div><hr><div class=last-modified><p><strong>Изменено</strong>: 3 ноября 2021 г. by <a href="https://cgit.freebsd.org/doc/commit/?id=64acd169b8" target=_blank>Sergio Carlavilla Delgado</a></p></div></div><aside class=toc><div class=toc-content><h3>Содержание</h3><nav id=TableOfContents><ul><li><a href=#intro>1. Твердотельные дисковые устройства</a></li><li><a href=#kernel>2. Параметры ядра</a></li><li><a href=#ro-fs>3. Подсистема <code>rc</code> и файловые системы в режиме только чтения</a></li><li><a href=#_создание_файловой_системы_с_нуля>4. Создание файловой системы с нуля</a></li><li><a href=#strategies>5. Стратегии работы с системой для случаев небольших и доступных только для чтения файловых систем</a></li></ul></nav><hr><div class=resources><h3>Материалы</h3><ul class=contents><li><i class="fa fa-file-pdf-o" aria-hidden=true title="Скачать PDF"></i><a href=https://download.freebsd.org/doc/ru/articles/solid-state/solid-state_ru.pdf>Скачать PDF</a></li><li><i class="fa fa-pencil-square-o" aria-hidden=true title="Редактировать эту страницу"></i><a href=https://github.com/freebsd/freebsd-doc/blob/main/documentation/content/ru/_index target=_blank>Редактировать эту страницу</a></li></ul></div></div></aside></main><footer><div class=footer-container><section class=logo-column><img src=http://172.16.201.134:1313/images/FreeBSD-colors.svg width=160 height=50 alt="FreeBSD logo"><div class=options-container><div class=language-container><a id=languages href=http://172.16.201.134:1313/ru/languages><img src=http://172.16.201.134:1313/images/language.png class=language-image alt="Выберите язык">
<span>Русский</span></a></div><div class=theme-container><select id=theme-chooser><option value=theme-system>Система</option><option value=theme-light>Светлый</option><option value=theme-dark>Тёмный</option><option value=theme-high-contrast>Высокая контрастность</option></select></div></div></section><section class=about-column><h3 class=column-title>О нас</h3><ul class=column-elements-container><li><a href=https://www.freebsd.org/about/ target=_blank class=column-element>FreeBSD</a></li><li><a href=https://freebsdfoundation.org/ target=_blank class=column-element>Фонд FreeBSD</a></li><li><a href=https://www.freebsd.org/where/ target=_blank class=column-element>Получить FreeBSD</a></li><li><a href=https://www.freebsd.org/internal/code-of-conduct target=_blank class=column-element>Кодекс Этики</a></li><li><a href=https://www.freebsd.org/security/ target=_blank class=column-element>Бюллетени Безопасности</a></li></ul></section><section class=documentation-column><h3 class=column-title>Документация</h3><ul class=column-elements-container><li><a href=/ru class=column-element>Портал документации</a></li><li><a href=https://man.FreeBSD.org target=_blank class=column-element>Страницы Справочника</a></li><li><a href=https://papers.FreeBSD.org target=_blank class=column-element>Презентации и публикации</a></li><li><a href=https://docs-archive.freebsd.org/doc/ target=_blank class=column-element>Предыдущие версии</a></li><li><a href=https://docs-archive.freebsd.org/44doc/ target=_blank class=column-element>Документы 4.4BSD</a></li><li><a href=https://wiki.freebsd.org/ target=_blank class=column-element>Wiki</a></li></ul></section><section class=community-column><h3 class=column-title>Сообщество</h3><ul class=column-elements-container><li><a href=http://172.16.201.134:1313/ru/articles/contributing class=column-element>Принять участие</a></li><li><a href=https://forums.freebsd.org/ target=_blank class=column-element>Форум Сообщества</a></li><li><a href=https://lists.freebsd.org/ target=_blank class=column-element>Списки рассылки</a></li><li><a href=https://wiki.freebsd.org/IRC/Channels target=_blank class=column-element>Каналы IRC</a></li><li><a href=https://bugs.freebsd.org/bugzilla/ target=_blank class=column-element>Трекер ошибок</a></li></ul></section><section class=legal-column><h3 class=column-title>Юридическая информация</h3><ul class=column-elements-container><li><a href=https://freebsdfoundation.org/donate/ target=_blank class=column-element>Пожертвования</a></li><li><a href=https://www.freebsd.org/copyright/freebsd-license/ target=_blank class=column-element>Лицензирование</a></li><li><a href=https://www.freebsd.org/privacy/ target=_blank class=column-element>Политика Конфиденциальности</a></li><li><a href=https://www.freebsd.org/copyright/ target=_blank class=column-element>Юридические оговорки</a></li></ul></section><section class=copyright-column><p>&copy; 1994-2024 Проект FreeBSD. Все права защищены</p><span>Сделано с помощью <span class=heart>♥</span> Сообществом FreeBSD</span></section></div></footer></body></html>